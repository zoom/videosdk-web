function e(e,t){if(!{}.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var t=0;function r(e){return"__private_"+t+++"_"+e}function n(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(!{}.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var s=0;function u(e){return"__private_"+s+++"_"+e}const c="4.0.0",d=`https://dmogdx0jrul3u.cloudfront.net/${c}/lib/av`,l=`https://source.zoom.us/${c}/lib/av`,h=`https://jssdk.zoomus.cn/${c}/lib/av`,f="function"==typeof Buffer,p="function"==typeof TextDecoder?new TextDecoder:void 0,v="function"==typeof TextEncoder?new TextEncoder:void 0,g=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),m=(()=>{let e={};return g.forEach(((t,r)=>e[t]=r)),e})(),y=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,S=String.fromCharCode.bind(String),A="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),b=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),E="function"==typeof btoa?e=>btoa(e):f?e=>Buffer.from(e,"binary").toString("base64"):e=>{let t,r,n,i,a="";const o=e.length%3;for(let o=0;o<e.length;){if((r=e.charCodeAt(o++))>255||(n=e.charCodeAt(o++))>255||(i=e.charCodeAt(o++))>255)throw new TypeError("invalid character found");t=r<<16|n<<8|i,a+=g[t>>18&63]+g[t>>12&63]+g[t>>6&63]+g[63&t]}return o?a.slice(0,o-3)+"===".substring(o):a},k=f?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let r=0,n=e.length;r<n;r+=4096)t.push(S.apply(null,e.subarray(r,r+4096)));return E(t.join(""))},C=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?S(192|t>>>6)+S(128|63&t):S(224|t>>>12&15)+S(128|t>>>6&63)+S(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return S(240|t>>>18&7)+S(128|t>>>12&63)+S(128|t>>>6&63)+S(128|63&t)},w=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,T=f?e=>Buffer.from(e,"utf8").toString("base64"):v?e=>k(v.encode(e)):e=>E((e=>e.replace(w,C))(e)),R=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,I=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return S((t>>>10)+55296)+S(56320+(1023&t));case 3:return S((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return S((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},D="function"==typeof atob?e=>atob(b(e)):f?e=>Buffer.from(e,"base64").toString("binary"):e=>{if(e=e.replace(/\s+/g,""),!y.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,r,n,i="";for(let a=0;a<e.length;)t=m[e.charAt(a++)]<<18|m[e.charAt(a++)]<<12|(r=m[e.charAt(a++)])<<6|(n=m[e.charAt(a++)]),i+=64===r?S(t>>16&255):64===n?S(t>>16&255,t>>8&255):S(t>>16&255,t>>8&255,255&t);return i},M=f?e=>A(Buffer.from(e,"base64")):e=>A(D(e).split("").map((e=>e.charCodeAt(0)))),O=f?e=>Buffer.from(e,"base64").toString("utf8"):p?e=>p.decode(M(e)):e=>(e=>e.replace(R,I))(D(e)),x=(e,t=!1)=>t?(e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_")))(T(e)):T(e),P=e=>O((e=>b(e.replace(/[-_]/g,(e=>"-"==e?"+":"/"))))(e));function L(e){return x(e,!0)}function N(e){return P(e)}const V=e=>{try{const t=new URL(e);return!("data:"===t.protocol&&"null"===t.origin)&&t.origin!==location.origin}catch(e){return!0}};[d,h,l].map((e=>function(e,t){let r=e;/^https?:\/\//.test(r)||(r=`https://${e}`);try{const e=new URL(r);if(!t)return e.href;if(t.hostname)return e.hostname}catch(e){return""}return""}(e,{hostname:!0})));var U="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var F,B={exports:{}},W=B.exports,G=(F||(F=1,function(e,t){var r,n,i=["matchRegex"],a=["el"];function o(e){var t="function"==typeof Map?new Map:void 0;return o=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,r){if(l())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var i=new(e.bind.apply(e,n));return r&&p(i,r.prototype),i}(e,arguments,h(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),p(r,e)},o(e)}function s(e,t,r,n){var i=u(h(e.prototype),t,r);return"function"==typeof i?function(e){return i.apply(r,e)}:i}function u(){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},u.apply(null,arguments)}function c(e,t,r){return t=h(t),function(e,t){if(t&&("object"==j(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}(e,l()?Reflect.construct(t,r||[],h(e).constructor):t.apply(e,r))}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(l=function(){return!!e})()}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t){return m(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a,o,s=[],u=!0,c=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||b(e,t)||g()}function g(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(e){if(Array.isArray(e))return e}function y(e){return function(e){if(Array.isArray(e))return E(e)}(e)||S(e)||b(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function A(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=b(e))||t){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}})),e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function b(e,t){if(e){if("string"==typeof e)return E(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(e,t):void 0}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach((function(t){w(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function w(e,t,r){return(t=M(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function R(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,M(n.key),n)}}function D(e,t,r){return t&&I(e.prototype,t),r&&I(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function M(e){var t=function(e,t){if("object"!=j(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!=j(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==j(t)?t:t+""}function O(){var e=F(),t=e.m(O),r=(Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__).constructor;function n(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===r||"GeneratorFunction"===(t.displayName||t.name))}var i={throw:1,return:2,break:3,continue:3};function a(e){var t,r;return function(n){t||(t={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(e,t){return r(n.a,i[e],t)},delegateYield:function(e,i,a){return t.resultName=i,r(n.d,x(e),a)},finish:function(e){return r(n.f,e)}},r=function(e,r,i){n.p=t.prev,n.n=t.next;try{return e(r,i)}finally{t.next=n.n}}),t.resultName&&(t[t.resultName]=n.v,t.resultName=void 0),t.sent=n.v,t.next=n.n;try{return e.call(this,t)}finally{n.p=t.prev,n.n=t.next}}}return(O=function(){return{wrap:function(t,r,n,i){return e.w(a(t),r,n,i&&i.reverse())},isGeneratorFunction:n,mark:e.m,awrap:function(e,t){return new X(e,t)},AsyncIterator:V,async:function(e,t,r,i,o){return(n(t)?N:L)(a(e),t,r,i,o)},keys:P,values:x}})()}function x(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(j(e)+" is not iterable")}function P(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}}function L(e,t,r,n,i){var a=N(e,t,r,n,i);return a.next().then((function(e){return e.done?e.value:a.next()}))}function N(e,t,r,n,i){return new V(F().w(e,t,r,n),i||Promise)}function V(e,t){function r(n,i,a,o){try{var s=e[n](i),u=s.value;return u instanceof X?t.resolve(u.v).then((function(e){r("next",e,a,o)}),(function(e){r("throw",e,a,o)})):t.resolve(u).then((function(e){s.value=e,a(s)}),(function(e){return r("throw",e,a,o)}))}catch(e){o(e)}}var n;this.next||(B(V.prototype),B(V.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),B(this,"_invoke",(function(e,i,a){function o(){return new t((function(t,n){r(e,a,t,n)}))}return n=n?n.then(o,o):o()}),!0)}function F(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function a(r,n,i,a){var u=n&&n.prototype instanceof s?n:s,c=Object.create(u.prototype);return B(c,"_invoke",function(r,n,i){var a,s,u,c=0,d=i||[],l=!1,h={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,s=0,u=e,h.n=r,o}};function f(r,n){for(s=r,u=n,t=0;!l&&c&&!i&&t<d.length;t++){var i,a=d[t],f=h.p,p=a[2];r>3?(i=p===n)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=f&&((i=r<2&&f<a[1])?(s=0,h.v=n,h.n=a[1]):f<p&&(i=r<3||a[0]>n||n>p)&&(a[4]=r,a[5]=n,h.n=p,s=0))}if(i||r>1)return o;throw l=!0,n}return function(i,d,p){if(c>1)throw TypeError("Generator is already running");for(l&&1===d&&f(d,p),s=d,u=p;(t=s<2?e:u)||!l;){a||(s?s<3?(s>1&&(h.n=-1),f(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),t=a[i]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=e}else if((t=(l=h.n<0)?u:r.call(n,h))!==o)break}catch(t){a=e,s=1,u=t}finally{c=1}}return{value:t,done:l}}}(r,i,a),!0),c}var o={};function s(){}function u(){}function c(){}t=Object.getPrototypeOf;var d=[][n]?t(t([][n]())):(B(t={},n,(function(){return this})),t),l=c.prototype=s.prototype=Object.create(d);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,B(e,i,"GeneratorFunction")),e.prototype=Object.create(l),e}return u.prototype=c,B(l,"constructor",c),B(c,"constructor",u),u.displayName="GeneratorFunction",B(c,i,"GeneratorFunction"),B(l),B(l,i,"Generator"),B(l,n,(function(){return this})),B(l,"toString",(function(){return"[object Generator]"})),(F=function(){return{w:a,m:h}})()}function B(e,t,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(B=function(e,t,r,n){if(t)i?i(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r;else{var a=function(t,r){B(e,t,(function(e){return this._invoke(t,r,e)}))};a("next",0),a("throw",1),a("return",2)}})(e,t,r,n)}function G(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function H(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){G(a,n,i,o,s,"next",e)}function s(e){G(a,n,i,o,s,"throw",e)}o(void 0)}))}}function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function K(e){return function(){return new z(e.apply(this,arguments))}}function z(e){var t,r;function n(t,r){try{var a=e[t](r),o=a.value,s=o instanceof X;Promise.resolve(s?o.v:o).then((function(r){if(s){var u="return"===t?"return":"next";if(!o.k||r.done)return n(u,r);r=e[u](r).value}i(a.done?"return":"normal",r)}),(function(e){n("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(e,i){return new Promise((function(a,o){var s={key:e,arg:i,resolve:a,reject:o,next:null};r?r=r.next=s:(t=r=s,n(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function q(e){return new X(e,0)}function Y(e){var t={},r=!1;function n(t,n){return r=!0,{done:!1,value:new X(n=new Promise((function(r){r(e[t](n))})),1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return r?(r=!1,e):n("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(r)throw r=!1,e;return n("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return r?(r=!1,e):n("return",e)}),t}function X(e,t){this.v=e,this.k=t}function Q(e){var t,r,n,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new J(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function J(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return(J=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new J(e)}z.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},z.prototype.next=function(e){return this._invoke("next",e)},z.prototype.throw=function(e){return this._invoke("throw",e)},z.prototype.return=function(e){return this._invoke("return",e)},r=W,n=function(e){var t;function r(e){this.message=e}r.prototype=new Error,r.prototype.name="InvalidCharacterError";var n="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new r("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,i,a=0,o=0,s="";i=t.charAt(o++);~i&&(n=a%4?64*n+i:i,a++%4)?s+=String.fromCharCode(255&n>>(-2*a&6)):0)i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i);return s};function u(e){this.message=e}function l(e,t){if("string"!=typeof e)throw new u("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return decodeURIComponent(n(t).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}catch(e){return n(t)}}(e.split(".")[r]))}catch(e){throw new u("Invalid token specified: "+e.message)}}u.prototype=new Error,u.prototype.name="InvalidTokenError";var h,p=function(e){return e[e.START_MEDIA=0]="START_MEDIA",e[e.ADD_RENDER_VIDEO=1]="ADD_RENDER_VIDEO",e[e.STOP_RENDER_VIDEO=2]="STOP_RENDER_VIDEO",e[e.START_CAPTURE_VIDEO=3]="START_CAPTURE_VIDEO",e[e.STOP_CAPTURE_VIDEO=4]="STOP_CAPTURE_VIDEO",e[e.ADD_RENDER_AUDIO=5]="ADD_RENDER_AUDIO",e[e.STOP_RENDER_AUDIO=6]="STOP_RENDER_AUDIO",e[e.UNMUTE_AUDIO=7]="UNMUTE_AUDIO",e[e.MUTE_AUDIO=8]="MUTE_AUDIO",e[e.CHANGE_FRAME_RATE=9]="CHANGE_FRAME_RATE",e[e.CHANGE_VIDEO_RESOLUTION=10]="CHANGE_VIDEO_RESOLUTION",e[e.CHANGE_AUDIO_SPEAKER=11]="CHANGE_AUDIO_SPEAKER",e[e.CHANGE_VIDEO_CAPTURE_DEVICE=12]="CHANGE_VIDEO_CAPTURE_DEVICE",e[e.CHANGE_CURRENT_ACTIVE_SSRC=13]="CHANGE_CURRENT_ACTIVE_SSRC",e[e.REMOVE_AUDIO_CAPTURE=14]="REMOVE_AUDIO_CAPTURE",e[e.LEAVE_MEETING=15]="LEAVE_MEETING",e[e.MEETING_FAIL_OVER=16]="MEETING_FAIL_OVER",e[e.END_MEDIA=17]="END_MEDIA",e[e.CHANGE_AUDIO_MIC=18]="CHANGE_AUDIO_MIC",e[e.WEBRTC_RESTART=19]="WEBRTC_RESTART",e[e.REMOVE_RENDER_AUDIO=20]="REMOVE_RENDER_AUDIO",e[e.LEAVE_COMPUTER_AUDIO=21]="LEAVE_COMPUTER_AUDIO",e[e.JOIN_COMPUTER_AUDIO=22]="JOIN_COMPUTER_AUDIO",e[e.START_SHARING=23]="START_SHARING",e[e.STOP_SHARING=24]="STOP_SHARING",e[e.SWITCH_CANVAS_FOR_VIDEO_CAPTURE=25]="SWITCH_CANVAS_FOR_VIDEO_CAPTURE",e[e.START_REMOTE_CONTROL=26]="START_REMOTE_CONTROL",e[e.UPDATE_REMOTE_CONTROL_PROPERTIES=27]="UPDATE_REMOTE_CONTROL_PROPERTIES",e[e.CANCEL_REMOTE_CONTROL=28]="CANCEL_REMOTE_CONTROL",e[e.UPDATE_SUBSCRIBE_VIDEO=29]="UPDATE_SUBSCRIBE_VIDEO",e[e.START_DESKTOP_SHARING=30]="START_DESKTOP_SHARING",e[e.STOP_DESKTOP_SHARING=31]="STOP_DESKTOP_SHARING",e[e.PAUSE_DESKTOP_SHARING=32]="PAUSE_DESKTOP_SHARING",e[e.RESUME_DESKTOP_SHARING=33]="RESUME_DESKTOP_SHARING",e[e.CHECK_CHROME_SHARING_EXTENSION=34]="CHECK_CHROME_SHARING_EXTENSION",e[e.SWITCH_CANVAS_FOR_SHARING_CAPTURE=35]="SWITCH_CANVAS_FOR_SHARING_CAPTURE",e[e.CHANGE_CURRENT_SHARING_ACTIVE_SSRC=36]="CHANGE_CURRENT_SHARING_ACTIVE_SSRC",e[e.COMMAND_SOCKET_MESSAGE_NOTIFY=40]="COMMAND_SOCKET_MESSAGE_NOTIFY",e[e.RESEND_REMOTE_CONTROL_POSITION_PDU=41]="RESEND_REMOTE_CONTROL_POSITION_PDU",e[e.AES_GCM_IV_VALUE=42]="AES_GCM_IV_VALUE",e[e.USER_NODE_LIST=43]="USER_NODE_LIST",e[e.UPDATE_SHARING_DECODE_PARAM=44]="UPDATE_SHARING_DECODE_PARAM",e[e.PAUSE_OR_RESUME_AUDIO_DECODE=45]="PAUSE_OR_RESUME_AUDIO_DECODE",e[e.UPDATE_CANVAS_SIZE=46]="UPDATE_CANVAS_SIZE",e[e.CLEAR_CANVAS=47]="CLEAR_CANVAS",e[e.ZOOM_RENDER=48]="ZOOM_RENDER",e[e.SET_OTHER_AUDIO_VOLUME_LEVEL=50]="SET_OTHER_AUDIO_VOLUME_LEVEL",e[e.AUIOD_INTERPRETATION_MUTE=58]="AUIOD_INTERPRETATION_MUTE",e[e.AUDIO_INTERPRETATION_SELECT_LANGUAGE=59]="AUDIO_INTERPRETATION_SELECT_LANGUAGE",e[e.AUDIO_INTERPRETATION_LIST_INFO=60]="AUDIO_INTERPRETATION_LIST_INFO",e[e.AUDIO_INTERPRETATION_ENABLE=61]="AUDIO_INTERPRETATION_ENABLE",e[e.VIDEO_MASK_SETTING=62]="VIDEO_MASK_SETTING",e[e.UPDATE_BG_IMAGE=63]="UPDATE_BG_IMAGE",e[e.UPDATE_MASK_INFO=64]="UPDATE_MASK_INFO",e[e.FINISH_MASK_SETTING=65]="FINISH_MASK_SETTING",e[e.START_VIDEO_STREAM_IN_MASK_SETTING_SUCCESS=66]="START_VIDEO_STREAM_IN_MASK_SETTING_SUCCESS",e[e.VIDEO_ENABLE_DECODE_HW=70]="VIDEO_ENABLE_DECODE_HW",e[e.VIDEO_ENABLE_ENCODE_HW=71]="VIDEO_ENABLE_ENCODE_HW",e[e.JOIN_DESKTOP_AUDIO=72]="JOIN_DESKTOP_AUDIO",e[e.LEAVE_DESKTOP_AUDIO=73]="LEAVE_DESKTOP_AUDIO",e[e.SET_DESKTOP_VOLUME=74]="SET_DESKTOP_VOLUME",e[e.MIRROR_MY_VIDEO=75]="MIRROR_MY_VIDEO",e[e.QOS_SENDER_REPORT=1176]="QOS_SENDER_REPORT",e[e.CHANGE_AUDIO_VOLUME=1177]="CHANGE_AUDIO_VOLUME",e[e.UPDATE_COOK=1178]="UPDATE_COOK",e[e.ENABLE_VIDEO_OBSERVER=99]="ENABLE_VIDEO_OBSERVER",e[e.NOTIFY_SDK_JOIN_RWG_SUCCESS=113]="NOTIFY_SDK_JOIN_RWG_SUCCESS",e[e.SWITCH_WATER_MARK_FLAG=90]="SWITCH_WATER_MARK_FLAG",e}(p||{}),E=function(e){return e[e.INIT_SUCCESS_VIDEO=1.1]="INIT_SUCCESS_VIDEO",e[e.INIT_SUCCESS_VIDEO_ENCODE=1]="INIT_SUCCESS_VIDEO_ENCODE",e[e.INIT_SUCCESS_VIDEO_DECODE=2]="INIT_SUCCESS_VIDEO_DECODE",e[e.INIT_SUCCESS_AUDIO=1.2]="INIT_SUCCESS_AUDIO",e[e.INIT_SUCCESS_AUDIO_ENCODE=1]="INIT_SUCCESS_AUDIO_ENCODE",e[e.INIT_SUCCESS_AUDIO_DECODE=2]="INIT_SUCCESS_AUDIO_DECODE",e[e.INIT_SUCCESS_SHARING=1.3]="INIT_SUCCESS_SHARING",e[e.INIT_SUCCESS_SHARING_ENCODE=1]="INIT_SUCCESS_SHARING_ENCODE",e[e.INIT_SUCCESS_SHARING_DECODE=2]="INIT_SUCCESS_SHARING_DECODE",e[e.USER_GRANT_AUDIO_CAPTURE=2]="USER_GRANT_AUDIO_CAPTURE",e[e.CURRENT_VIDEO_RESOLUTION=3]="CURRENT_VIDEO_RESOLUTION",e[e.JPEG_DEC_THREAD_OK=4]="JPEG_DEC_THREAD_OK",e[e.JPEG_DATA=5]="JPEG_DATA",e[e.SHARING_PARA=6]="SHARING_PARA",e[e.SHARING_MORE_INFO=6.1]="SHARING_MORE_INFO",e[e.VIDEO_DECODE_MAX_SIZE=7]="VIDEO_DECODE_MAX_SIZE",e[e.CURRENT_CAPTURE_VIDEO_WIDTH_HEIGHT=8]="CURRENT_CAPTURE_VIDEO_WIDTH_HEIGHT",e[e.START_VIDEO_CAPTURE_SUCCESS=9]="START_VIDEO_CAPTURE_SUCCESS",e[e.STOP_VIDEO_CAPTURE_SUCCESS=10]="STOP_VIDEO_CAPTURE_SUCCESS",e[e.START_REMOTE_CONTROL_SUCCESS=11]="START_REMOTE_CONTROL_SUCCESS",e[e.CANCEL_REMOTE_CONTROL_SUCCESS=12]="CANCEL_REMOTE_CONTROL_SUCCESS",e[e.REMOTE_CONTROL_COPIED_TEXT_NOTIFY=13]="REMOTE_CONTROL_COPIED_TEXT_NOTIFY",e[e.MONITOR_LOG=14]="MONITOR_LOG",e[e.SHARING_DECODE_MAX_SIZE=18]="SHARING_DECODE_MAX_SIZE",e[e.SEND_MESSAGE_TO_RWG=20]="SEND_MESSAGE_TO_RWG",e[e.AES_GCM_IV_RESPONSE=21]="AES_GCM_IV_RESPONSE",e[e.SHARING_DESKTOP_STREAM_HAVE_AUDIO=23]="SHARING_DESKTOP_STREAM_HAVE_AUDIO",e[e.JOIN_COMPUTER_AUDIO_COMPLETE=24]="JOIN_COMPUTER_AUDIO_COMPLETE",e[e.JOIN_DESKTOP_AUDIO_COMPLETE=25]="JOIN_DESKTOP_AUDIO_COMPLETE",e[e.LEAVE_COMPUTER_AUDIO_COMPLETE=26]="LEAVE_COMPUTER_AUDIO_COMPLETE",e[e.LEAVE_DESKTOP_AUDIO_COMPLETE=27]="LEAVE_DESKTOP_AUDIO_COMPLETE",e[e.QOS_RECEIVER_CMD=1128]="QOS_RECEIVER_CMD",e[e.VIDEO_REQUEST_IDR=1128.5]="VIDEO_REQUEST_IDR",e[e.FIRST_FRAME=1190]="FIRST_FRAME",e[e.DATACHANNEL_OPEN=1128]="DATACHANNEL_OPEN",e[e.DATACHANNEL_CLOSE=1130]="DATACHANNEL_CLOSE",e[e.DATACHANNEL_RECOVER=1140]="DATACHANNEL_RECOVER",e[e.START_VIDEO_STREAM_IN_MASK_SETTING_SUCCESS=66]="START_VIDEO_STREAM_IN_MASK_SETTING_SUCCESS",e[e.CURRENT_DECODE_VIDEO_QUALITY=66.5]="CURRENT_DECODE_VIDEO_QUALITY",e[e.SHARING_FIRST_DECODE_FRAME_RECEIVED_SSRC=70]="SHARING_FIRST_DECODE_FRAME_RECEIVED_SSRC",e[e.INIT_FAILED=-1]="INIT_FAILED",e[e.INIT_FAILED_VIDEO=-1.1]="INIT_FAILED_VIDEO",e[e.INIT_FAILED_VIDEO_ENCODE=-1]="INIT_FAILED_VIDEO_ENCODE",e[e.INIT_FAILED_VIDEO_DECODE=-2]="INIT_FAILED_VIDEO_DECODE",e[e.INIT_FAILED_AUDIO=-1.2]="INIT_FAILED_AUDIO",e[e.INIT_FAILED_AUDIO_ENCODE=-1]="INIT_FAILED_AUDIO_ENCODE",e[e.INIT_FAILED_AUDIO_DECODE=-2]="INIT_FAILED_AUDIO_DECODE",e[e.INIT_FAILED_SHARING=-1.3]="INIT_FAILED_SHARING",e[e.USER_FORBIDDED_CAPTURE_AUDIO=-2]="USER_FORBIDDED_CAPTURE_AUDIO",e[e.AUDIO_WEBSOCKET_BROKEN=-3]="AUDIO_WEBSOCKET_BROKEN",e[e.VIDEO_WEBSOCKET_BROKEN=-4]="VIDEO_WEBSOCKET_BROKEN",e[e.JPEG_DEC_THREAD_FAILED=-5]="JPEG_DEC_THREAD_FAILED",e[e.AUDIO_ZERO_DATA=-6]="AUDIO_ZERO_DATA",e[e.USER_FORBIDDED_CAPTURE_VIDEO=-8]="USER_FORBIDDED_CAPTURE_VIDEO",e[e.USER_CAMERA_IS_TAKEN_BY_OTHER_PROGRAMS=-9]="USER_CAMERA_IS_TAKEN_BY_OTHER_PROGRAMS",e[e.START_REMOTE_CONTROL_FAILED=-11]="START_REMOTE_CONTROL_FAILED",e[e.AUDIO_SPEAKER_SET_ERROR=-12]="AUDIO_SPEAKER_SET_ERROR",e[e.DATA_CHANNEL_OFFER=20]="DATA_CHANNEL_OFFER",e[e.AUDIO_AUTO_PLAY_FAILED=-24]="AUDIO_AUTO_PLAY_FAILED",e[e.SHARING_DESKTOP_STREAM_HAVE_NO_AUDIO=-27]="SHARING_DESKTOP_STREAM_HAVE_NO_AUDIO",e[e.WEBGL_LOST_IN_MULTI_VIEW=-32]="WEBGL_LOST_IN_MULTI_VIEW",e[e.FAIL_OVER_RESULT_TO_OUTSIDE_SDK=21]="FAIL_OVER_RESULT_TO_OUTSIDE_SDK",e[e.MASK_SETTING_PARA_ERROR=-33]="MASK_SETTING_PARA_ERROR",e}(E||{}),k="VIDEO_QOS_DATA",I={exports:{}};I.exports=(h=window["disk-file-writer"],function(){var e,t,r={8935:function(e,t,r){function n(){return/\bCrOS\b/.test(navigator.userAgent)}function a(){var e,t;if(n())return!1;var r=((null==navigator?void 0:navigator.userAgent)||"").toLowerCase();if(/ipad|android(?!.*mobile)|tablet/i.test(r))return!0;var i=Math.min((null==(e=null==window?void 0:window.screen)?void 0:e.width)||0,(null==(t=null==window?void 0:window.screen)?void 0:t.height)||0),a="ontouchstart"in window||navigator.maxTouchPoints>0;return i>=600&&i<=1280&&a&&"orientation"in window}function o(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||/iPad/i.test(navigator.userAgent)||/Macintosh/i.test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}r.d(t,{Cd:function(){return Ze},D:function(){return $e},D$:function(){return Je},GN:function(){return Ke},GQ:function(){return He},GY:function(){return d},HR:function(){return Qe},Pg:function(){return a},Qf:function(){return nt},R_:function(){return g},U0:function(){return rt},U4:function(){return xe},UP:function(){return Ue},Xb:function(){return o},Y9:function(){return Ye},Z_:function(){return qe},Zs:function(){return n},_J:function(){return We},bw:function(){return l},cX:function(){return p},gG:function(){return Me},gi:function(){return it},gm:function(){return Ge},j4:function(){return at},j9:function(){return st},lT:function(){return Ve},n_:function(){return f},nr:function(){return je},pb:function(){return c},uF:function(){return v},uw:function(){return h},vb:function(){return u},vk:function(){return ze},w_:function(){return et},zG:function(){return s},zQ:function(){return ot},zX:function(){return Xe}});var s=function(){return!!(navigator.maxTouchPoints&&navigator.maxTouchPoints>2)&&(/iPad/.test(navigator.platform)||/MacIntel/.test(navigator.platform))},u=function(){return/MSFT Teams Android Room/i.test(navigator.userAgent)},c=function(){var e=null==window?void 0:window.meetingHost;return!!e&&"MSFT"===e.getHostState().vendorId&&!u()},d=function(){return/GoogleMeetRoomDeviceWebViewApp/.test(navigator.userAgent)},l=function(){return/TESLA/.test(navigator.userAgent)},h=function(){return/(iPhone)/.test(navigator.userAgent)},f=function(){return/(iPad|iPhone)/g.test(navigator.userAgent)},p=function(){return navigator.platform.indexOf("Mac")>-1},v=function(){return navigator.platform.indexOf("Win")>-1},g=function(){var e=H(O().mark((function e(){var t,r,n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1==navigator.userAgent.indexOf("WOW64")){e.next=2;break}return e.abrupt("return",!0);case 2:if(null==(t=null==navigator?void 0:navigator.userAgentData)||!t.getHighEntropyValues){e.next=7;break}return e.next=5,null==(r=null==navigator?void 0:navigator.userAgentData)?void 0:r.getHighEntropyValues(["wow64"]);case 5:return n=e.sent,e.abrupt("return",!(null==n||!n.wow64));case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),m=function(e){return"string"==typeof e},y=function(e,t){if(m(e))return e=b(/^\s\s*/,e),void 0===t?e:e.substring(0,500)},_=function(e){return m(e)?e.toLowerCase():e},S=function(e,t){if("object"==j(e)&&e.length>0){for(var r in e)if(_(e[r])==_(t))return!0;return!1}return!!m(e)&&-1!==_(t).indexOf(_(e))},A=function(e,t){for(var r in t)if("object"==j(t[r])&&t[r].length>0){for(var n=0;n<t[r].length;n++)if(S(t[r][n],e))return"?"===r?void 0:r}else if(S(t[r],e))return"?"===r?void 0:r;return"*"in t?t["*"]:e},b=function(e,t){return m(t)?t.replace(e,""):t},E=function(e){return m(e)&&b(/[^\d\.]/g,e).split(".")[0]||""},k=function(e){return m(e)&&b(/[^\d\.]/g,e).split(".")[1]||""},w=function(e){return/^\d/.test(String(e))},I=function(e,t){var r={};if(!e||!t)return{};for(var n,i,a,o,s,u,c=0;c<t.length&&!s;){var d=t[c],l=t[c+1];for(n=0,i=0;n<d.length&&!s&&d[n];)if(s=d[n++].exec(e))for(r.matchRegex=String(d[n-1]),a=0;a<l.length;a++)u=s[++i],"object"==j(o=l[a])&&o.length>0?2===o.length?"function"==typeof o[1]?r[o[0]]=o[1](u):r[o[0]]=o[1]:3===o.length?"function"!=typeof o[1]||o[1].exec&&o[1].test?r[o[0]]=u?u.replace(o[1],o[2]):void 0:r[o[0]]=u?o[1](u,o[2]):void 0:4===o.length&&(r[o[0]]=u?o[3](u.replace(o[1],o[2])):void 0):r[o]=u||void 0;c+=2}return r||{}},M=function(e){for(var t=e.split(".");t.length>1&&0===parseInt(t[t.length-1],10);)t.pop();return t.join(".")},x="version",P="name",L="type",N="inapp",V="model",U="vendor",F="architecture",B="console",W="mobile",G="tablet",K="smarttv",z="wearable",q="xr",Y="embedded",X="Amazon",Q="Apple",J="ASUS",$="BlackBerry",Z="Google",ee="Huawei",te="Lenovo",re="Honor",ne="LG",ie="Microsoft",ae="Motorola",oe="Nvidia",se="OnePlus",ue="OPPO",ce="Samsung",de="Sharp",le="Sony",he="Xiaomi",fe="Zebra",pe="Chrome",ve="Chromecast",ge="Firefox",me="Opera",ye="Facebook",_e="Sogou",Se="Mobile Safari",Ae=" Browser",be="Chromium OS",Ee="Mac OS",ke={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Ce=[[/\b(?:crmo|crios)\/([\w\.]+)/i],[x,[P,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[x,[P,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[P,x],[/opios[\/ ]+([\w\.]+)/i],[x,[P,me+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[x,[P,me+" GX"]],[/\bopr\/([\w\.]+)/i],[x,[P,me]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[x,[P,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[x,[P,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[P,x],[/quark(?:pc)?\/([-\w\.]+)/i],[x,[P,"Quark"]],[/\bddg\/([\w\.]+)/i],[x,[P,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[x,[P,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[x,[P,"WeChat"]],[/konqueror\/([\w\.]+)/i],[x,[P,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[x,[P,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[x,[P,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[x,[P,"Smart "+te+Ae]],[/(avast|avg)\/([\w\.]+)/i],[[P,/(.+)/,"$1 Secure"+Ae],x],[/\bfocus\/([\w\.]+)/i],[x,[P,ge+" Focus"]],[/\bopt\/([\w\.]+)/i],[x,[P,me+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[x,[P,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[x,[P,"Dolphin"]],[/coast\/([\w\.]+)/i],[x,[P,me+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[x,[P,"MIUI"+Ae]],[/fxios\/([\w\.-]+)/i],[x,[P,""+ge]],[/\bqihoobrowser\/?([\w\.]*)/i],[x,[P,"360"]],[/\b(qq)\/([\w\.]+)/i],[[P,/(.+)/,"$1Browser"],x],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[P,/(.+)/,"$1"+Ae],x],[/samsungbrowser\/([\w\.]+)/i],[x,[P,ce+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[x,[P,_e+" Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[P,_e+" Mobile"],x],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[P,x],[/(lbbrowser|rekonq)/i],[P],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[x,P],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[P,ye],x,[L,N]],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(instagram|snapchat)[\/ ]([-\w\.]+)/i],[P,x,[L,N]],[/\bgsa\/([\w\.]+) .*safari\//i],[x,[P,"GSA"],[L,N]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[x,[P,"TikTok"],[L,N]],[/\[(linkedin)app\]/i],[P,[L,N]],[/(chromium)[\/ ]([-\w\.]+)/i],[P,x],[/headlesschrome(?:\/([\w\.]+)| )/i],[x,[P,pe+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[P,pe+" WebView"],x],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[x,[P,"Android"+Ae]],[/chrome\/([\w\.]+) mobile/i],[x,[P,"Chrome"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[P,x],[/version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i],[x,[P,Se]],[/iphone .*mobile(?:\/\w+ | ?)safari/i],[[P,Se]],[/version\/([\w\.\,]+) .*(safari)/i],[x,P],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[P,[x,"1"]],[/(webkit|khtml)\/([\w\.]+)/i],[P,x],[/(?:mobile|tablet);.*(firefox)\/([\w\.-]+)/i],[[P,""+ge],x],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[P,"Netscape"],x],[/(wolvic|librewolf)\/([\w\.]+)/i],[P,x],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[x,[P,ge+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[P,[x,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[P,[x,/[^\d\.]+./,""]]],we=[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[V,[U,ce],[L,G]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[V,[U,ce],[L,W]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[V,[U,Q],[L,W]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[V,[U,Q],[L,G]],[/(macintosh);/i],[V,[U,Q]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[V,[U,de],[L,W]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[V,[U,re],[L,G]],[/honor([-\w ]+)[;\)]/i],[V,[U,re],[L,W]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[V,[U,ee],[L,G]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[V,[U,ee],[L,W]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[V,/_/g," "],[U,he],[L,G]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[V,/_/g," "],[U,he],[L,W]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[V,[U,ue],[L,W]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[V,[U,A,{OnePlus:["304","403","203"],"*":ue}],[L,G]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[V,[U,"Vivo"],[L,W]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[V,[U,"Realme"],[L,W]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[V,[U,ae],[L,W]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[V,[U,ae],[L,G]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[V,[U,ne],[L,G]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[V,[U,ne],[L,W]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[V,[U,te],[L,G]],[/(nokia) (t[12][01])/i],[U,V,[L,G]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?(([-\w\.]*))/i],[[V,/_/g," "],[L,W],[U,"Nokia"]],[/(pixel (c|tablet))\b/i],[V,[U,Z],[L,G]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[V,[U,Z],[L,W]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[V,[U,le],[L,W]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[V,"Xperia Tablet"],[U,le],[L,G]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[V,[U,se],[L,W]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[V,[U,X],[L,G]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[V,/(.+)/g,"Fire Phone $1"],[U,X],[L,W]],[/(playbook);[-\w\),; ]+(rim)/i],[V,U,[L,G]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[V,[U,$],[L,W]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[V,[U,J],[L,G]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[V,[U,J],[L,W]],[/(nexus 9)/i],[V,[U,"HTC"],[L,G]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[U,[V,/_/g," "],[L,W]],[/tcl (xess p17aa)/i,/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])(_\w(\w|\w\w))?(\)| bui)/i],[V,[U,"TCL"],[L,G]],[/droid [\w\.]+; (418(?:7d|8v)|5087z|5102l|61(?:02[dh]|25[adfh]|27[ai]|56[dh]|59k|65[ah])|a509dl|t(?:43(?:0w|1[adepqu])|50(?:6d|7[adju])|6(?:09dl|10k|12b|71[efho]|76[hjk])|7(?:66[ahju]|67[hw]|7[045][bh]|71[hk]|73o|76[ho]|79w|81[hks]?|82h|90[bhsy]|99b)|810[hs]))(_\w(\w|\w\w))?(\)| bui)/i],[V,[U,"TCL"],[L,W]],[/(itel) ((\w+))/i],[[U,_],V,[L,A,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[V,[U,"Acer"],[L,G]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[V,[U,"Meizu"],[L,W]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[V,[U,"Ulefone"],[L,W]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[V,[U,"Energizer"],[L,W]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[V,[U,"Cat"],[L,W]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[V,[U,"Smartfren"],[L,W]],[/droid.+; (a(?:015|06[35]|142p?))/i],[V,[U,"Nothing"],[L,W]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[U,V,[L,G]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[U,V,[L,W]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i],[U,V,[L,G]],[/(surface duo)/i],[V,[U,ie],[L,G]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[V,[U,"Fairphone"],[L,W]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[V,[U,oe],[L,G]],[/(sprint) (\w+)/i],[U,V,[L,W]],[/(kin\.[onetw]{3})/i],[[V,/\./g," "],[U,ie],[L,W]],[/droid.+; ([c6]+|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[V,[U,fe],[L,G]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[V,[U,fe],[L,W]],[/smart-tv.+(samsung)/i],[U,[L,K]],[/hbbtv.+maple;(\d+)/i],[[V,/^/,"SmartTV"],[U,ce],[L,K]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[U,ne],[L,K]],[/(apple) ?tv/i],[U,[V,Q+" TV"],[L,K]],[/crkey.*devicetype\/chromecast/i],[[V,ve+" Third Generation"],[U,Z],[L,K]],[/crkey.*devicetype\/([^/]*)/i],[[V,/^/,"Chromecast "],[U,Z],[L,K]],[/fuchsia.*crkey/i],[[V,ve+" Nest Hub"],[U,Z],[L,K]],[/crkey/i],[[V,ve],[U,Z],[L,K]],[/droid.+aft(\w+)( bui|\))/i],[V,[U,X],[L,K]],[/(shield \w+ tv)/i],[V,[U,oe],[L,K]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[V,[U,de],[L,K]],[/(bravia[\w ]+)( bui|\))/i],[V,[U,le],[L,K]],[/(mi(tv|box)-?\w+) bui/i],[V,[U,he],[L,K]],[/Hbbtv.*(technisat) (.*);/i],[U,V,[L,K]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[U,y],[V,y],[L,K]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[V,[L,K]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[L,K]],[/(ouya)/i,/(nintendo) (\w+)/i],[U,V,[L,B]],[/droid.+; (shield)( bui|\))/i],[V,[U,oe],[L,B]],[/(playstation \w+)/i],[V,[U,le],[L,B]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[V,[U,ie],[L,B]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[V,[U,ce],[L,z]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[U,V,[L,z]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[V,[U,ue],[L,z]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[V,[U,Q],[L,z]],[/(opwwe\d{3})/i],[V,[U,se],[L,z]],[/(moto 360)/i],[V,[U,ae],[L,z]],[/(smartwatch 3)/i],[V,[U,le],[L,z]],[/(g watch r)/i],[V,[U,ne],[L,z]],[/droid.+; (wt63?0{2,3})\)/i],[V,[U,fe],[L,z]],[/droid.+; (glass) \d/i],[V,[U,Z],[L,q]],[/(pico) (4|neo3(?: link|pro)?)/i],[U,V,[L,q]],[/; (quest( \d| pro)?)/i],[V,[U,ye],[L,q]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[U,[L,Y]],[/(aeobc)\b/i],[V,[U,X],[L,Y]],[/(homepod).+mac os/i],[V,[U,Q],[L,Y]],[/windows iot/i],[[L,Y]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+?(mobile|vr|\d) safari/i],[V,[L,A,{mobile:"Mobile",xr:"VR","*":G}]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[L,G]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[L,W]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[V,[U,"Generic"]]],Te=[[/microsoft (windows) (vista|xp)/i],[P,x],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[P,[x,A,ke]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[x,A,ke],[P,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[x,/_/g,"."],[P,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[P,Ee],[x,/_/g,"."]],[/android ([\d\.]+).*crkey/i],[x,[P,ve+" Android"]],[/fuchsia.*crkey\/([\d\.]+)/i],[x,[P,ve+" Fuchsia"]],[/crkey\/([\d\.]+).*devicetype\/smartspeaker/i],[x,[P,ve+" SmartSpeaker"]],[/linux.*crkey\/([\d\.]+)/i],[x,[P,ve+" Linux"]],[/crkey\/([\d\.]+)/i],[x,[P,ve]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[x,P],[/(ubuntu) ([\w\.]+) like android/i],[[P,/(.+)/,"$1 Touch"],x],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[P,x],[/\(bb(10);/i],[x,[P,$]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[x,[P,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[x,[P,ge+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[x,[P,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[x,[P,"watchOS"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[P,be],x],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) (\w+)/i,/(xbox); +xbox ([^\);]+)/i,/(pico) .+os([\w\.]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[P,x],[/(sunos) ?([\w\.\d]*)/i],[[P,"Solaris"],x],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[P,x]],Re=[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[F,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)\b/i],[[F,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[F,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[F,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[F,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[F,/ower/,"",_]],[/ sun4\w[;\)]/i],[[F,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[F,_]]],Ie=[[/windows.+ edge\/([\w\.]+)/i],[x,[P,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[P,x],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[x,[P,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[P,x],[/ladybird\//i],[[P,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[x,P]],De=new(D((function e(){R(this,e),this.ua=navigator.userAgent}),[{key:"removeMatchRegex",value:function(e){return e.matchRegex?(e.matchRegex,T(e,i)):e}},{key:"getDefaultResult",value:function(e){var t,r,n,i=(t=e||this.ua,null!=(r=I(t,Ce))&&r.version&&(r.major=E(String(r.version))||"",r.minor=k(String(r.version))||""),r),a=(n=e||this.ua,I(n,Ie)),o=function(e){var t,r,n=I(e,we);return!n.type&&null!=navigator&&navigator.userAgentData&&null!=(t=null==navigator?void 0:navigator.userAgentData)&&t.mobile&&(n.type=null==(r=null==navigator?void 0:navigator.userAgentData)?void 0:r.mobile),"Macintosh"==n.model&&navigator&&void 0!==(null==navigator?void 0:navigator.standalone)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&(n.model="iPad",n.type="tablet"),n}(e||this.ua),s=function(e){var t,r,n=I(e,Te);return!n.name&&null!=navigator&&navigator.userAgentData&&null!=(t=null==navigator?void 0:navigator.userAgentData)&&t.platform&&(n.name=null==(r=null==navigator?void 0:navigator.userAgentData)?void 0:r.platform),null!=n&&n.version&&w(null==n?void 0:n.version)&&(n.major=E(String(n.version))||"",n.minor=k(String(n.version))||""),n}(e||this.ua),u=function(e){var t=I(e,Re);return t.architecture||(t.architecture=""),t}(e||this.ua);return{ua:e||this.ua,browser:this.removeMatchRegex(i),device:this.removeMatchRegex(o),os:this.removeMatchRegex(s),cpu:this.removeMatchRegex(u),engine:this.removeMatchRegex(a)}}},{key:"getResult",value:function(){var e=H(O().mark((function e(t){var r,n,i,a,o,s,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getDefaultResult(t),!t&&this.isSupportUserAgentData()){e.next=3;break}return e.abrupt("return",r);case 3:return n={},e.prev=4,e.next=7,this.getHighEntropyValues();case 7:n=e.sent,e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",C(C({},r),{},{error:e.t0}));case 13:return i=this.handleBrowser(n,r.browser),a=this.handleDevice(n,r.device),o=this.handleOs(n,r.os),s=this.handleCpu(n,r.cpu),u=this.handleEngine(n,r.engine),e.abrupt("return",{ua:this.ua,browser:this.removeMatchRegex(i),device:this.removeMatchRegex(a),os:this.removeMatchRegex(o),cpu:this.removeMatchRegex(s),engine:this.removeMatchRegex(u),originHighEntropyValues:n});case 15:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isSupportUserAgentData",value:function(){return"object"==("undefined"==typeof navigator?"undefined":j(navigator))&&"userAgentData"in navigator}},{key:"getHighEntropyValues",value:function(){var e=H(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isSupportUserAgentData()){e.next=6;break}return e.next=3,navigator.userAgentData.getHighEntropyValues(["brands","fullVersionList","mobile","model","platform","platformVersion","architecture","formFactors","bitness"]);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0={};case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleBrowser",value:function(e,t){var r=t||{},n=e.fullVersionList||e.brands,i="";if(n)for(var a in n){var o=n[a].brand,s=n[a].version;/not.a.brand/i.test(o)||i&&(!/chrom/i.test(i)||"Chromium"==o)||(i=o=A(o,{Chrome:"Google Chrome",Edge:"Microsoft Edge","Chrome WebView":"Android WebView","Chrome Headless":"HeadlessChrome"}),r={name:o,version:s,major:s?E(s):"",minor:s?k(s):""})}return r}},{key:"handleEngine",value:function(e,t){var r=t||{},n=e.fullVersionList||e.brands;if(n)for(var i in n){var a=n[i].brand,o=n[i].version;"Chromium"===a&&(r.version=o)}return r}},{key:"handleDevice",value:function(e,t){var r=t;if(e.mobile&&(r.type="mobile"),e.model&&(r.model=e.model,!r.type||!r.vendor)){var n=I("droid 9; "+e.model+")",we);!r.type&&n.type&&(r.type=n.type),!r.vendor&&n.vendor&&(r.vendor=n.vendor)}"Macintosh"==r.model&&navigator&&void 0!==(null==navigator?void 0:navigator.standalone)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&(r.model="iPad",r.type="tablet");var i={embedded:"Automotive",mobile:"Mobile",tablet:["Tablet","EInk"],smarttv:"TV",wearable:"Watch",xr:["VR","XR"],"?":["Desktop","Unknown"],"*":void 0};if(e.formFactors){var a;if("string"!=typeof e.formFactors)for(var o=0;!a&&o<e.formFactors.length;)a=A(e.formFactors[o++],i);else a=A(e.formFactors,i);a&&(r.type=a)}return r}},{key:"handleOs",value:function(e,t){var r,n,i=t||{};!i.name&&navigator.userAgentData&&null!=(r=navigator.userAgentData)&&r.platform&&(i.name=null==(n=navigator.userAgentData)?void 0:n.platform);var a=e.platform;if(a){var o=e.platformVersion;if(a.includes("win")&&o){var s=parseInt(E(o),10)||0;o=s>=13?"11":s>0?"10":"7"}i.name=a,i.version=o,o&&w(o)?(i.major=E(o)||"",i.minor=k(o)||""):(i.major="",i.minor="")}return i.name&&(i.name=i.name.replace(/chrome os/i,be).replace(/macos/i,Ee)),i}},{key:"handleCpu",value:function(e,t){var r=t||{},n=e.architecture;return n&&(n&&"64"==e.bitness&&(n+="64"),r=I(n+";",Re)),r}}])),Me=De.getDefaultResult(),Oe=!1,xe=function(){var e=H(O().mark((function e(){var t;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Oe){e.next=2;break}return e.abrupt("return",Me);case 2:if(e.prev=2,!De.isSupportUserAgentData()){e.next=8;break}return e.next=6,De.getResult();case 6:t=e.sent,Me=Object.assign({},t),Oe=!0;case 8:e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(2),e.abrupt("return",(Oe=!1,Promise.reject(e.t0)));case 13:return e.abrupt("return",Me);case 14:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}(),Pe=function(){return(null==Me?void 0:Me.os)||{}},Le=function(){var e;return(null==(e=null==Me?void 0:Me.browser)?void 0:e.name)||""},Ne=function(){var e;return(null==(e=null==Me?void 0:Me.os)?void 0:e.name)||""},Ve=function(){var e=Le();return["IE","IEMobile"].includes(e)},Ue=function(){return"Edge"===Le()},Fe=function(){var e=Le();return["Chrome","Chrome Headless","Chrome WebView"].includes(e)},Be=function(){return"Chromium"===Le()},We=function(){return Fe()||Be()},Ge=function(){var e=Le();return["Firefox","Firefox Focus","Firefox Reality","Iceweasel"].includes(e)},He=function(){var e=Le();return["Opera","Opera Coast","Opera GX","Opera Mini","Opera Mobi","Opera Tablet","Opera Touch"].includes(e)},je=function(){var e;return null==(e=Le().toLocaleLowerCase())?void 0:e.includes("safari")},Ke=function(){var e,t=Ne();return/android/i.test(navigator.userAgent)||(null==(e=t.toLocaleLowerCase())?void 0:e.includes("android"))},ze=function(){return"webos"===Ne().toLowerCase()},qe=function(){return"Oculus Browser"===Le()},Ye=function(){return Fe()&&/windows/i.test(navigator.userAgent)},Xe=function(){return"OpenHarmony"===Ne()},Qe=function(){return"HarmonyOS"===Ne()||Xe()},Je=function(e,t){if((e=e.toString())===(t=t.toString()))return!0;for(var r=M(e),n=M(t),i=r.split("."),a=n.split("."),o=i.length,s=a.length,u=Math.min(s,o),c=0;c<u;c++){var d=parseInt(i[c],10),l=parseInt(a[c],10);if(d!==l)return d>l}return o>=s},$e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t||(t=((null==Me?void 0:Me.browser)||{}).version||""),Je(t||"",e)},Ze=function(){var e=Pe().major;return e?parseInt(e,10):0},et=function(){var e=Pe().minor;return e?parseInt(e,10):0},tt=function(){var e={vendor:"",renderInfo:"",isAstcSupported:!1,isWebGLContextInvalid:!0},t={noCanvas:"",noContext:"",contextLost:"",noVendor:"",catchError:""};try{var r=document.createElement("canvas");if(!r)return t.noCanvas="Error: document.createElement return a null canvas!",{attrs:e,errorMsg:t};var n,i,a,o=r.getContext("webgl")||r.getContext("moz-webgl")||r.getContext("webkit-3d")||r.getContext("experimental-webgl");if(!o)return t.noContext="Error: canvas.getContext fail, context:".concat(o,", size:(").concat(r.width,",").concat(r.height,")"),{attrs:e,errorMsg:t};o&&(e.isWebGLContextInvalid=!1,null!=o&&o.isContextLost()&&(t.contextLost="Error: webgl context is lost, canvas(".concat(r.width,",").concat(r.height,")!")),Ge()?(n=o.getParameter(o.RENDERER),i=o.getParameter(o.VENDOR)):(a=o.getExtension("WEBGL_debug_renderer_info"),n=o.getParameter(a.UNMASKED_RENDERER_WEBGL),i=o.getParameter(a.UNMASKED_VENDOR_WEBGL)),e.renderInfo=null==n?void 0:n.toLowerCase(),e.vendor=null==i?void 0:i.toLowerCase(),e.isAstcSupported=-1!==o.getSupportedExtensions().indexOf("WEBGL_compressed_texture_astc"),""==i&&(t.noVendor="Error: vendor is null, debug:".concat(a,", render:").concat(a.UNMASKED_RENDERER_WEBGL,", vendor:").concat(a.UNMASKED_VENDOR_WEBGL,", contextLost:").concat(o.isContextLost(),"!")))}catch(e){t.catchError=e}return{attrs:e,errorMsg:t}}(),rt=function(){return"Mac OS"===Ne()&&!s()},nt=function(){try{return!(!je()||navigator.maxTouchPoints&&!(navigator.maxTouchPoints<=2)||tt.attrs.isAstcSupported||!p())}catch(e){return!1}},it=function(){var e;try{return!!((Fe()||Be())&&(!navigator.maxTouchPoints||navigator.maxTouchPoints<=2)&&(null==(e=tt.attrs.vendor)?void 0:e.indexOf("intel"))>-1&&p())}catch(e){return!1}},at=function(){return nt()||it()},ot=function(){var e=p()||rt();return je()&&e},st=function(){var e;return(null==(e=null==navigator?void 0:navigator.platform)?void 0:e.indexOf("Linux"))>-1&&!n()&&!Ke()}},1241:function(e,t,r){r.d(t,{_:function(){return n}});var n=!1},3750:function(e,t,r){r.d(t,{p:function(){return s},E:function(){return u}});var n=r(2754),i=r(9415),a=D((function e(){R(this,e);var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._unusedIds=[],this._nextId=t}),[{key:"generateNextId",value:function(){var e;return this._unusedIds.length>0?e=this._unusedIds.shift():(e=this._nextId,this._nextId+=1),e}},{key:"release",value:function(e){this._unusedIds.push(e)}}]),o=D((function e(t){R(this,e),this._onmessage=null,this._messager=t}),[{key:"onmessage",set:function(e){var t,r;null!==this._onmessage&&this._messager.removeEventListener("message",this._onmessage),this._messager.addEventListener("message",e),null===this._onmessage&&(null===(r=(t=this._messager).start)||void 0===r||r.call(t)),this._onmessage=e}},{key:"postMessage",value:function(e,t){this._messager.postMessage(e,t)}},{key:"close",value:function(){var e,t;null!==this._onmessage&&(this._messager.removeEventListener("message",this._onmessage),this._onmessage=null),null===(t=(e=this._messager).close)||void 0===t||t.call(e)}}]),s=D((function e(){R(this,e),this._connection=null}),[{key:"connection",get:function(){return(0,n.vA)(null!==this._connection),this._connection},set:function(e){this._connection=e}}]),u=D((function e(t,r,n,i){var s=this;R(this,e),this._idGenerator=new a(2),this._invokeHandlers={},this._invokeResults=new Set,this._resolveInvokeResultsSended=null,this._responseHandlers=new Map,this._notifyHandlers={},this._transferObjs=[],this._closed=!1,this._onClose=null,this._messager=new o(t),this._messager.onmessage=this._handleMessage.bind(this),this._logErrorFn=i,r&&(this.localPeerObject=r),n&&(this._proxyFuncs=n);var u=new Promise((function(e){s._resolveCloseSent=e})),c=new Promise((function(e){s._resolveCloseReceived=e}));Promise.all([u,c]).then((function(){s._messager.close(),s._messager=null}))}),[{key:"localPeerObject",get:function(){return this._localPeerObject},set:function(e){var t,r=this;if(this._invokeHandlers={},e instanceof s){var n=Object.getPrototypeOf(e);t=Object.getOwnPropertyNames(n)}else t=Object.getOwnPropertyNames(e);var i,a=A(t.filter((function(t){return"function"==typeof e[t]&&"constructor"!==t&&!t.startsWith("_")})));try{var o=function(){var t=i.value;r.expose(t,(function(){return e[t].apply(e,arguments)}))};for(a.s();!(i=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}this._localPeerObject=e,e instanceof s&&(e.connection=this)}},{key:"remotePeerProxy",get:function(){var e=this,t=this;if(this._remotePeerProxy)return this._remotePeerProxy;var r=new Map;return this._remotePeerProxy=new Proxy({},{get:function(n,i,a){var o,s=null===(o=e._proxyFuncs)||void 0===o?void 0:o[i];return s||(s=r.get(i))||(s=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.invoke.apply(t,[i].concat(r))},r.set(i,s),s)}}),this._remotePeerProxy}},{key:"_logError",value:function(e,t){var r;null===(r=this._logErrorFn)||void 0===r||r.call(this,e,t)}},{key:"transfer",value:function(e){return this._transferObjs.push(e),e}},{key:"expose",value:function(e,t){this._invokeHandlers[e]=t}},{key:"on",value:function(e,t){this._notifyHandlers[e]=t}},{key:"notify",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this._postRequest(1,e,r)}},{key:"invoke",value:function(e){for(var t=this,r=this._idGenerator.generateNextId(),n=new Promise((function(e,n){t._responseHandlers.set(r,{resolve:e,reject:n})})),i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return this._postRequest(r,e,a),n}},{key:"_postRequest",value:function(e,t,r){if(this._closed)throw new Error("Can not postRequest after closed!!");try{this._messager.postMessage({id:e,name:t,args:r},this._transferObjs)}catch(e){(0,i.B)().tracing.Log_Error("[rpc] Error in postRequest",e)}this._transferObjs=[]}},{key:"_postReponse",value:function(e,t){if(this._closed)throw new Error("Can not postReponse after closed!!");this._messager.postMessage({id:0,resId:e,response:t},this._transferObjs),this._transferObjs=[]}},{key:"_serializeError",value:function(e){return e instanceof Error?{message:e.message,name:e.name,stack:e.stack}:e}},{key:"_handleMessage",value:function(e){var t=this,r=e.data;if("id"in r)try{if(r.id<0)-1===r.id?(this._closePeerIfNeeded(r.reason),this._resolveCloseReceived()):(0,n.Yu)();else{if(0===r.id){var i=this._responseHandlers.get(r.resId);if(!i)return void this._logError("DualRPC.handleMessage: ".concat(r.resId," not found!"));var a=r.response;return"ret"in a?i.resolve(a.ret):"err"in a?(i.reject(a.err),this._logError("DualRPC.handleMessage err: ".concat(a.err))):(0,n.Yu)("Invalid Response"),this._responseHandlers.delete(r.resId),void this._idGenerator.release(r.resId)}if(1===r.id){try{var o=this._notifyHandlers[r.name];o&&o.apply(void 0,y(r.args))}catch(e){}return}if((0,n.vA)(r.id>1),!(r.name in this._invokeHandlers))return void this._logError("DualRPC.handleMessage: ".concat(r.name," not registered!"));var s,u;try{var c=this._invokeHandlers[r.name];s=c.apply(void 0,y(r.args))}catch(e){u=e}if(u)return void this._postReponse(r.id,{err:this._serializeError(u)});if(!(s instanceof Promise)){try{this._postReponse(r.id,{ret:s})}catch(e){this._postReponse(r.id,{err:this._serializeError(e)})}return}this._invokeResults.add(s),s.then((function(e){t._postReponse(r.id,{ret:e})})).catch((function(e){t._postReponse(r.id,{err:t._serializeError(e)})})).finally((function(){t._invokeResults.delete(s),t._resolveInvokeResultsSended&&0===t._invokeResults.size&&t._resolveInvokeResultsSended()}))}}catch(e){this._logError("DualRPC.handleMessage err!!",e)}}},{key:"_closePeerIfNeeded",value:function(e){var t=this;this._closed||(this._closed=!0,this._onClose&&this._onClose(e),0===this._invokeResults.size?(this._messager.postMessage({id:-1,reason:e},[]),setTimeout((function(){t._resolveCloseSent()}),10)):new Promise((function(e){t._resolveInvokeResultsSended=e})).then((function(){t._messager.postMessage({id:-1,reason:e},[])})).then((function(){setTimeout((function(){t._resolveCloseSent()}),10)})))}},{key:"close",value:function(e){this._closePeerIfNeeded(e)}},{key:"onClose",set:function(e){this._onClose=e}}])},2484:function(e,t,r){r.d(t,{n:function(){return n}});var n={AUDIO_BRIDGE_1:{index:1,default:15},AUDIO_BRIDGE_2:{index:2,default:1},HW_ENCODER_FOR_360P:{index:3,default:0},WEBGL_CONTEXT_LOST_OPT:{index:4,default:0},RECEIVE_720P_ON_SAFARI:{index:5,default:0},MULTI_VIEW_ON_MOBILE:{index:8,default:0},CHROMEOS_AEC:{index:10,default:1},AUDIO_DENOISE:{index:11,default:1,candidates:{NO_CONFIG:0,SHOW_IN_PROFILE:1,DEFAULT_VALUE_GREATER_THAN_4_CORES:2}},VB_ON_FIREFOX:{index:12,default:0},ENABLE_DECODE_720P_ON_IOS:{index:15,default:1},UNIFIED_RENDER:{index:20,default:0},WEBGPU_RENDERER:{index:21,default:0},ORIGINAL_SOUND:{index:22,default:0},SEND_1080P_VIDEO:{index:24,default:0},SEND_1080P_VIDEO_SHARE:{index:25,default:0},VB_ON_SAFARI_17:{index:27,default:0},WEBGL2_RENDERER:{index:29,default:1},AUDIO_ECHO_DETECT:{index:31,default:0},UNIFIED_RENDER_ON_MOBILE:{index:34,default:0},WEBCODEC_DECODE_OPTION:{index:36,default:0},HW_WEBCODEC_ON_SAFARI:{index:37,default:1},HW_DECODE_FOR_360P:{index:38,default:0},WEBCODEC_ON_ANDROID_CHROME:{index:39,default:0},WEBCODEC_ENCODE_OPT_1ON1:{index:41,default:0},CAP_WEBCODEC_SUPPORT:{index:42,default:0},WEBRTC_STG:{index:43,default:0},WEBGL_CANVAS_OPTION_OPT:{index:44,default:1},DEFAULT_RENDERER:{index:45,default:3},WEB_TRANSPORT_CONTROL:{index:46,default:0},ENABLE_TP_RLB_WEBSOCKET:{index:47,default:0},ENABLE_TRANSFERABLE_RTC_DATACHANNEL:{index:48,default:1},ENABLE_WEBRTC_FEATURE:{index:49,default:0},WEBRTC_SMART_AUTO_STG_1:{index:50,default:0,candidates:{NO_CONFIG:0,MOB_ANDROID:1,MOB_IOS:2,DESKTOP:4,SAB_OFF_NO_OFFSCREENCANVAS_NO_GPU:8}},WEBRTC_SMART_AUTO_STG_2:{index:51,default:0,candidates:{NO_CONFIG:0,AUDIO_ON_BROWSER_32BIT:1,VIDEO_ON_BROWSER_32BIT:2,DESKTOP_LOW_PERF_DEVICE:4}},ENABLE_WEBRTC_TURN_SERVERS:{index:52,default:0},EXTRA_DEVICE_INTERVAL_ENUMERATE:{index:53,default:0,candidates:{DISABLE:0,ENABLE:1}},ENABLE_MEDIA_PROCESSOR:{index:54,default:0,candidates:{NONE:0,VIDEO_PROCESSOR:1,AUDIO_PROCESSOR:2,SHARE_PROCESSOR:4}},MOBILE_FORCE_AUTO_CHOOSE_AUDIO_DEVICE:{index:55,default:0,candidates:{DISABLE:0,IOS:1,ANDROID:2,ANDROID_EARPIECE:4}},WEBRTC_SMART_AUTO_STG_3:{index:57,default:0,candidates:{NO_CONFIG:0,WEBCODEC_NOT_SUPPORT:1}},WEBRTC_SMART_AUTO_STG_4:{index:58,default:0,candidates:{NO_CONFIG:0}},WASM_MOBILE_30FPS:{index:59,default:0},ENABLE_FALLBACK_TO_TAG_RENDERER:{index:61,default:0,candidates:{NO_CONFIG:0,FALLBACK_TO_TAG_RENDERER_ON_CHROME:1,FALLBACK_TO_TAG_RENDERER_ON_SAFARI:2,FALLBACK_TO_TAG_RENDERER_ON_FIREFOX:4}},ENABLE_WASM_TAG_RENDERER:{index:62,default:0,candidates:{NO_CONFIG:0,TAG_RENDERER_ON_CHROME:1,TAG_RENDERER_ON_SAFARI:2,TAG_RENDERER_ON_FIREFOX:4}},ENABLE_WEBRTC_AUDIO_2_0:{index:63,default:0,candidates:{DISABLE:0,ENABLE:1}},SUPPORT_ANNOTATION:{index:64,default:0,candidates:{VIEWER:1,PRESENTER:2}},ANDROID_WEBCODEC_CAP:{index:65,default:2,candidates:{DISABLE_ENCODER:1,DISABLE_DECODER:2}},HW_ENC_ENABLE_L1T1:{index:66,default:0,candidates:{DISABLE:0,ANDROID:1,CHROMEOS:2,HARMONY:4,ALL:8}},ENABLE_MESH:{index:67,default:0,candidates:{WEBNIAR:2,WITHSTUN:3,ALLOWTALK_ENABLE:64}},MESH_NODE:{index:68,default:11},SUPPORT_AV_SIMULTANEOUS_FALLBACK:{index:70,default:0,candidates:{DISABLE:0,ENABLE:1}},ENABLE_FALLBACK_WEBRTC_AUDIO_STG:{index:69,default:0,candidates:{DISABLE:0,ENABLE:1}}}},5830:function(e,t,r){r.d(t,{A:function(){return i}});var n=r(5408),i=D((function e(){R(this,e)}),null,[{key:"read",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!e)return n.Ay.error("[ABOptionsReader] error in read(): options(".concat(e,") is invalid, ").concat(t,", ").concat(r,", ").concat(i)),i;var a=e.length;if(t<0||r<=0||t>a||t+r-1>a)return n.Ay.warn("[ABOptionsReader] error in read(): invalid parameters! opLen=".concat(a,", bitIndex=").concat(t,", readCount=").concat(r)),i;var o=a-t-r+1,s=a-t+1;try{var u=e.slice(o,s),c=parseInt(u,16);return isNaN(c)?i:c}catch(e){n.Ay.error("[ABOptionsReader] error in read()",e)}return i}},{key:"batchRead",value:function(e,t){for(var r=new Map,n=0;n<t.length;n++){var i=t[n],a=i.bitIndex,o=i.readCount,s=void 0===o?1:o,u=i.defaultVal,c=void 0===u?0:u,d=this.read(e,a,s,c);r.set(a,d)}return r}}])},2754:function(e,t,r){r.d(t,{HB:function(){return s},KR:function(){return u},Yu:function(){return o},vA:function(){return a}});var n=r(1241),i=r(9415),a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!e){var r=new Error(t);if((0,i.B)().tracing.Log_Error("Assert: ".concat(t),r),n._)throw r}},o=function(e){var t=new Error(e);if((0,i.B)().tracing.Log_Error("AssertWithFailed: ".concat(e),t),n._)throw t},s=function(){var e=new Error("Unreachable code reached!");if((0,i.B)().tracing.Log_Error("Unreachable!",e),n._)throw e},u=function(){var e=new Error("call abstract method!");if((0,i.B)().tracing.Log_Error("AbstractMethod!",e),n._)throw e}},3323:function(e,t,r){r.d(t,{bQ:function(){return i},ey:function(){return o}});var n=r(5408),i=D((function e(t){R(this,e),this.options=Object.assign({analyserFrequent:100},t||{}),this.asnTime=performance.now(),this.audioStream=null,this.analyserNodeBufferDataArray=null,this.audioCtx=null,this.destinationNode=null,"function"==typeof AudioContext&&(this.audioCtx=new window.AudioContext,this.destinationNode=new MediaStreamAudioDestinationNode(this.audioCtx),this.initAnalyserNode()),this.lastUILevel=0}),[{key:"initAnalyserNode",value:function(){this.analyserNode=this.audioCtx.createAnalyser(),this.analyserNode.connect(this.destinationNode),this.analyserNode.fftSize=1024}},{key:"setAudioStream",value:function(e){this.audioStream=e}},{key:"start",value:function(){var e=this;if(this.audioCtx)return this.getAnalyzingStatus()&&this.stop(),this.getDestroyedStatus()?Promise.reject(new Error("instance is destroyed already")):new Promise((function(t){e.setAnalyzingStatus(!0),e.sourceNode=e.audioCtx.createMediaStreamSource(e.audioStream),e.sourceNode.connect(e.analyserNode),e.resumeAudioCtx(),e.setAnalyzeInterval(),t(!0)}))}},{key:"stop",value:function(){this.setAnalyzingStatus(!1),this.clearAnalyzeInterval()}},{key:"destroy",value:function(){var e,t=this;this.stop(),this.analyserNode&&this.destinationNode&&this.analyserNode.disconnect(this.destinationNode),this.setDestroyedStatus(!0),null===(e=this.audioCtx)||void 0===e||e.suspend().finally((function(){var e;return null===(e=t.audioCtx)||void 0===e?void 0:e.close()})),this.audioStream=null,this.analyserNodeBufferDataArray=null}},{key:"analyserNodeIntervalCallback",value:function(){if(this.analyserNodeBufferDataArray){this.analyserNode.getFloatTimeDomainData(this.analyserNodeBufferDataArray);var e=function(e){for(var t=0,r=0,n=0;n<e.length;n+=2){r+=e[n]*e[n];var i=Math.abs(e[n]);i>t&&(t=i)}return t=t>1?1:t,{sumRms:r/e.length/2,absMax:t}}(this.analyserNodeBufferDataArray),t=(e.sumRms,o(e.absMax));t!==this.lastUILevel&&(this.lastUILevel=t,this.options.analyserCallback(t))}}},{key:"setAnalyzeInterval",value:function(){this.clearAnalyzeInterval();var e=this.analyserNode.fftSize;this.analyserNodeBufferDataArray=new Float32Array(e),this.analyserNodeTimer=window.setInterval(this.analyserNodeIntervalCallback.bind(this),this.options.analyserFrequent)}},{key:"clearAnalyzeInterval",value:function(){this.analyserNodeTimer&&(window.clearInterval(this.analyserNodeTimer),this.analyserNodeTimer=null,this.analyserNodeBufferDataArray=null)}},{key:"getAnalyzingStatus",value:function(){return!!this.isAnalyzing}},{key:"setAnalyzingStatus",value:function(e){this.isAnalyzing=!!e}},{key:"getDestroyedStatus",value:function(){return!!this.isDestroyed}},{key:"setDestroyedStatus",value:function(e){this.isDestroyed=!!e}},{key:"resumeAudioCtx",value:function(){"running"!==this.audioCtx.state&&this.audioCtx.resume().catch((function(e){n.Ay.error("audio-level audio context resume error: ",e)}))}}]),a=[0,1,2,3,4,4,5,5,5,5,6,6,6,6,6,7,7,7,7,8,8,8,9,9,9,9,9,9,9,9,9,9,9];function o(e){if("number"!=typeof e||e<0||e>1)return-1;var t=Math.floor(32768*e/1e3);return 0==t&&e>250&&(t=1),a[t]}},9482:function(e,t,r){r.d(t,{BX:function(){return d},Go:function(){return a},Tl:function(){return s},Xt:function(){return o},_c:function(){return u},d:function(){return c},is:function(){return l},oB:function(){return i},wd:function(){return n}});var n={ZOOM_CONNECTION_COMMAND:0,ZOOM_CONNECTION_AUDIO:1,ZOOM_CONNECTION_VIDEO:2,ZOOM_CONNECTION_SHARING_JPEG:3,ZOOM_CONNECTION_SHARING_VIDEO:4,ZOOM_CONNECTION_MEDIA_LOG:5,ZOOM_CONNECTION_SHARING_REMOTE_CONTROL:6,ZOOM_CONNECTION_UNKNOW:7},i={NET_WEBSOCKET:0,NET_DATACHANNEL:1,NET_WEBTRANSPORT:2},a={encode:1,decode:2},o={AUDIO:1,SHARING:2,VIDEO:3,MESH:4},s={UNKNOWN:0,WIN:1,MAC:2,PAD:3,MOBILE:4,CALL_IN:5,LINUX:6,WEB:7,CHROME:8},u={VIDEO_ENCODE:"0",VIDEO_DECODE:"1",AUDIO_ENCODE:"2",AUDIO_DECODE:"3",SHARING_ENCODE:"4",SHARING_DECODE:"5",WORKER_SERVICE:"6",NET:"net",MESH:"mesh"},c=function(){var e={};for(var t in u)e[u[t]]="WCL_"+t;return e}(),d={ComputerAudio_Null:0,ComputerAudio_Connecting:1,ComputerAudio_Connected:2,DesktopAudio_Null:0,DesktopAudio_Connecting:1,DesktopAudio_Connected:2},l=w(w(w(w(w(w(w(w({},u.AUDIO_ENCODE,"audio.encode"),u.AUDIO_DECODE,"audio.decode"),u.VIDEO_ENCODE,"video.encode"),u.VIDEO_DECODE,"video.decode"),u.SHARING_ENCODE,"share.encode"),u.SHARING_DECODE,"share.decode"),u.NET,"net.thread"),u.MESH,"mesh.thread")},5600:function(e,t,r){r.d(t,{S_:function(){return l},Yd:function(){return c},r1:function(){return d},r9:function(){return u}});var n=r(9407),i=r(1461),a=r(5408),o=r(701),s="function"!=typeof importScripts;function u(e){postMessage({status:n.Bi,data:e})}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;s?a.Ay.error(e,t):d(e,t)}function d(e){var t,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(i instanceof Error||i instanceof ErrorEvent){var a=i;e+=" Code: "+(null==a?void 0:a.code)+" Message: "+(null==i?void 0:i.message)+" Stack: "+(null!==(r=null===(t=null==a?void 0:a.error)||void 0===t?void 0:t.stack)&&void 0!==r?r:null==a?void 0:a.stack),i=null}postMessage({status:n.AC,errorMessage:e,errorEvent:i})}function l(e){s?(0,o.iK)(i.AoB,e):postMessage({status:n.V_,where:e})}},9470:function(e,t,r){r.d(t,{H0:function(){return i},JF:function(){return l},LZ:function(){return o},PF:function(){return h},b2:function(){return u},cO:function(){return d},i$:function(){return s}});var n=r(8935),i=function(){return n.gG.browser||{}},a=function(e,t){var r=i().version;return"chrome"!==e&&"chromium"!==e||!((0,n._J)()||(0,n.UP)()||(0,n.GQ)())?!!{safari:(0,n.nr)(),edge:(0,n.UP)(),firefox:(0,n.gm)(),opera:(0,n.GQ)(),ie:(0,n.lT)()}[e]&&(0,n.D$)(r,String(t)):(0,n.D$)(r,String(t))},o=function(){return a("chrome",arguments.length>0&&void 0!==arguments[0]?arguments[0]:90)},s=function(e){return a("firefox",e)},u=function(e){return a("safari",e)};function c(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}var d=function(){if("undefined"==typeof window||!window.navigator)return{browser:"",version:""};var e=i().major,t=parseInt(e,10);return(0,n._J)()?(0,n.n_)()?{browser:"safari",version:c(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}:{browser:"chrome",version:t}:(0,n.gm)()?{browser:"firefox",version:t}:(0,n.UP)()?{browser:"edge",version:t}:(0,n.nr)()?{browser:"safari",version:c(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}:{browser:"",version:""}},l=function(){var e=i().major;return e?parseInt(e,10):"other"},h=function(){var e,t,r,i,a;try{var o={osType:0,os:"",osVersion:"",browser:{},kernal:{}},s=Object.assign({},n.gG);"Chromium"===(null===(e=null==s?void 0:s.browser)||void 0===e?void 0:e.name)&&(s.browser.name="Chrome");var u="tablet"==(null===(t=null==s?void 0:s.device)||void 0===t?void 0:t.type)||(0,n.Pg)(),c="mobile"==(null===(r=null==s?void 0:s.device)||void 0===r?void 0:r.type)||(0,n.Xb)(),d=null===(i=null==s?void 0:s.os)||void 0===i?void 0:i.name,l=null===(a=null==s?void 0:s.os)||void 0===a?void 0:a.version,h=0;if(u?h=4:c&&(h=1),!d){var f=navigator.userAgent.match(/\(([^;]+); OpenHarmony ([\d.]+)\)/);f&&f.length>2&&(d="OpenHarmony",l=f[2],"Tablet"===f[1]?h=4:"Phone"===f[1]&&(h=1))}return o.osType=h,o.osVersion=l,o.browser=Object.assign({},s.browser),o.kernal=Object.assign({},s.engine),o.os=d,navigator.userAgentData||((null==d?void 0:d.toLowerCase().includes("mac"))&&(u||c)&&(o.os="iOS"),(null==d?void 0:d.toLowerCase().includes("linux"))&&(u||c)&&(o.os="Android")),o}catch(e){return{}}}},9415:function(e,t,r){var n;function i(e){n=e}r.d(t,{B:function(){return a},d:function(){return i}});var a=function(){return n}},5999:function(e,t,r){var n,i;r.d(t,{Mr:function(){return o},f7:function(){return a},xv:function(){return s},zu:function(){return n}}),(i=n||(n={})).MainAudio="MainAudio",i.ShareAudio="ShareAudio",i.MainVideo="MainVideo",i.ShareVideo="ShareVideo";var a={Track:"Track",CodecsChange:"CodecsChange",SignalingStateChange:"SignalingStateChange",IceConnectionStateChange:"IceConnectionStateChange",ConnectionStateChange:"ConnectionStateChange",NegotiationNeeded:"NegotiationNeeded",IceGatheringStateChange:"IceGatheringStateChange",IceCandidateError:"IceCandidateError",StatsReport:"StatsReport",LocalCandidateStats:"LocalCandidateStats",RemoteCandidateStats:"RemoteCandidateStats",CandidatePairStats:"CandidatePairStats",TransportStats:"TransportStats",MediaSourceStats:"MediaSourceStats",OutboundRtpStats:"OutboundRtpStats",RemoteInboundRtpStats:"RemoteInboundRtpStats",InboundRtpStats:"InboundRtpStats",RemoteOutboundRtpStats:"RemoteOutboundRtpStats"},o=1e3;function s(e){switch(e){case n.MainAudio:case n.ShareAudio:return"audio";case n.MainVideo:case n.ShareVideo:return"video";default:return}}},9102:function(e,t,r){r.d(t,{e:function(){return k}});var n=r(6984),i=r.n(n),a=r(1241),o=r(3750),u=r(2754),d=r(9407),l=r(5408),h=r(9415),p=r(3021),g=D((function e(t,r){R(this,e),this._connection=null,this._services=[],this._registerPromise=null,this._serviceName=t,this._serviceCtor=r}),[{key:"register",value:function(e){var t=this;if(null===this._registerPromise){var r=new MessageChannel;this._connection=new o.E(r.port1,{requestPort:function(e){var r=t.accquirePort(e);return t._connection.transfer(r)}}),this._registerPromise=p.D.registerService(this._serviceName,p.D.transfer(r.port2),e)}}},{key:"unregister",value:function(){var e=this;if(null!==this._registerPromise){var t=this._connection;this._registerPromise.then((function(r){p.D.unregisterService(e._serviceName,r),t.close()})),this._connection=null,this._registerPromise=null}}},{key:"registerPromise",value:function(){return e=this,r=O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._registerPromise.then((function(e){return e>=0})));case 1:case"end":return e.stop()}}),e,this)})),new((t=void 0)||(t=Promise))((function(n,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function o(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var r;e.done?n(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(a,o)}s((r=r.apply(e,[])).next())}));var e,t,r}},{key:"accquirePort",value:function(e){var t=this,r=new MessageChannel,n=new this._serviceCtor(e);return new o.E(r.port1,n).onClose=function(){t._services.splice(t._services.indexOf(n),1),n.closeService()},this._services.push(n),r.port2}},{key:"close",value:function(){this.unregister();var e,t=A(this._services);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.closeService(),r.connection.close()}}catch(e){t.e(e)}finally{t.f()}this._services=[]}}]),m=D((function e(t,r){R(this,e),this._provider=null,this._serviceName=t,this._serviceCtor=r}),[{key:"exposed",value:function(){return null!==this._provider}},{key:"exposeService",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._provider||(this._provider=new g(this._serviceName,this._serviceCtor)),t&&this._provider.register(e),this._provider}},{key:"unexposeService",value:function(){this._provider&&this._provider.unregister()}}]),y=r(5600),_=function(e,t,r,n){return new(r||(r=Promise))((function(t,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,o)}s((n=n.apply(e,[])).next())}))},S=D((function e(){R(this,e),this.nextServiceId=0,this.serviceMap=new Map,this.loadingServiceModules=new Map,this.loadedServiceModules=new Set}),[{key:"clear",value:function(){var e,t=A(this.serviceMap);try{for(t.s();!(e=t.n()).done;){var r,n=v(e.value,2),i=(n[0],A(n[1]));try{for(i.s();!(r=i.n()).done;)r.value.connection.close()}catch(e){i.e(e)}finally{i.f()}}}catch(e){t.e(e)}finally{t.f()}this.serviceMap.clear()}}]),b=new S,E=function(e){function t(){return R(this,t),c(this,t,arguments)}return f(t,e),D(t,[{key:"closeService",value:function(){(0,u.HB)()}},{key:"registerService",value:function(e,t,r){var n=b.nextServiceId++,i=new o.E(t),a=b.serviceMap.get(e),s={serviceId:n,connection:i,constraints:r};return a?a.push(s):b.serviceMap.set(e,[s]),n}},{key:"unregisterService",value:function(e,t){var r=b.serviceMap.get(e);if(r){var n=r.findIndex((function(e){return e.serviceId===t}));r.splice(n,1)}}},{key:"_fetchBlob",value:function(e){return _(this,0,void 0,O().mark((function t(){var r,n,i,a;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=(0,h.B)().config.getBaseScriptUrl(),n="".concat(r,"/").concat(e,".min.js"),t.next=4,fetch(n);case 4:return i=t.sent,t.next=7,i.arrayBuffer();case 7:return a=t.sent,t.abrupt("return",new Blob([a],{type:"application/javascript"}));case 9:case"end":return t.stop()}}),t)})))}},{key:"_loadServiceModule",value:function(e){var t=this;return new Promise((function(r){t._fetchBlob(e).then((function(t){var n,s=i().createObjectURL(t);(n=a._?new Worker(s,{name:e}):new Worker(s)).onerror=function(t){(0,y.Yd)("Load service ".concat(e,": worker error!!"),t),r(!1)},n.onmessage=function(e){var t=e.data;if(t.status===d.AC)if("low"==t.level)l.Ay.directReport("".concat(t.errorMessage));else{var r="Error from worker service: ".concat(t.errorMessage);-1==r.indexOf("E:H")&&l.Ay.error(r,t.errorEvent)}};var u=new o.E(n),c=(0,h.B)().config;return u.remotePeerProxy.load(u.transfer(k.exposeService().accquirePort()),{renderUserAgentInfo:(0,h.B)().userAgent.info(),renderCapabilitiesDesc:(0,h.B)().capabilities.desc(),renderConfigDesc:c.desc()})})).then((function(e){r(e)})).catch((function(t){(0,y.Yd)("Load service ".concat(e," error!!"),t),r(!1)}))}))}},{key:"findService",value:function(e,t){return _(this,0,void 0,O().mark((function t(){var r,n,i,a,o;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=(r=b).serviceMap.get(e))&&0!==n.length){t.next=18;break}if(i=e.split("/"),(0,u.vA)(2===i.length),a=i[0],(0,u.vA)("builtin"!==a),a in r.loadedServiceModules){t.next=18;break}if(!(o=r.loadingServiceModules.get(a))){t.next=12;break}return t.next=10,o;case 10:t.next=18;break;case 12:return o=this._loadServiceModule(a),r.loadingServiceModules.set(a,o),t.next=16,o;case 16:r.loadingServiceModules.delete(a),r.loadedServiceModules.add(a);case 18:return t.abrupt("return",(n=r.serviceMap.get(e),(0,u.vA)(n&&n.length>0,"Not Found ".concat(e," after service module loaded")),n.map((function(e){return{serviceId:e.serviceId,constraints:e.constraints}}))));case 19:case"end":return t.stop()}}),t,this)})))}},{key:"requestService",value:function(e,t,r){return _(this,0,void 0,O().mark((function n(){var i,a,o;return O().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((i=b.serviceMap.get(e))&&0!==i.length){n.next=3;break}return n.abrupt("return");case 3:if(a=i.find((function(e){return e.serviceId===t}))){n.next=6;break}return n.abrupt("return",void(0,u.Yu)("RequestService error: Can not find service ".concat(e,":").concat(t)));case 6:return n.next=8,a.connection.invoke("requestPort",r);case 8:return o=n.sent,n.abrupt("return",this.connection.transfer(o));case 10:case"end":return n.stop()}}),n,this)})))}}])}(p.k),k=new(function(e){function t(){return R(this,t),c(this,t,["builtin/RegistryService",E])}return f(t,e),D(t,[{key:"exposeService",value:function(){var e=this.exposed(),r=s(t,"exposeService",this)([void 0,!1]);if(!e){var n=r.accquirePort();p.D.setRegistryServicePort(n)}return r}},{key:"unexposeService",value:function(){(0,u.HB)()}},{key:"reset",value:function(){b.clear(),b=new S}}])}(m))},3021:function(e,t,r){r.d(t,{D:function(){return o},k:function(){return a}});var n=r(3750),i=r(2754),a=function(e){function t(){return R(this,t),c(this,t,arguments)}return f(t,e),D(t)}(n.p),o=new(D((function e(){R(this,e),this._connection=null}),[{key:"setRegistryServicePort",value:function(e){this._connection=new n.E(e)}},{key:"transfer",value:function(e){return this._connection.transfer(e)}},{key:"registerService",value:function(e,t,r){return this._connection.invoke("registerService",e,t,r)}},{key:"unregisterService",value:function(e,t){this._connection.invoke("unregisterService",e,t)}},{key:"findService",value:function(e){return this._connection.invoke("findService",e)}},{key:"requestService",value:function(e,t,r){return this._connection.invoke("requestService",e,t,r)}},{key:"acquireService",value:function(e,t){return r=this,s=O().mark((function r(){var a,s,u;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,o.findService(e);case 2:return a=r.sent,t&&t.selectService?s=t.selectService(a):1===a.length?s=a[0].serviceId:(0,i.Yu)("AcquireService Error: select service failed!"),r.next=6,o.requestService(e,s,t?t.serviceParams:void 0);case 6:return u=r.sent,r.abrupt("return",new n.E(u));case 8:case"end":return r.stop()}}),r)})),new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{o(s.next(e))}catch(e){t(e)}}function i(e){try{o(s.throw(e))}catch(e){t(e)}}function o(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a((function(e){e(r)}))).then(n,i)}o((s=s.apply(r,[])).next())}));var r,a,s}}]))},701:function(e,t,r){r.d(t,{Lg:function(){return u},Xe:function(){return v},_G:function(){return p},iG:function(){return o},iK:function(){return g},pg:function(){return s}});var n=r(7201),i=r.n(n),a=r(5408);function o(e){this.name="CameraOccupiedError",this.message=e,this.stack=(new Error).stack}o.prototype=new Error;var s={EXCEPTION:-1,PERMISSION_RESET:-2,LOST_ACCESS:-3},u={INTERNAL_ERROR:-1,BROWSER_ERROR:1,UNSUPPORTED_BROWSER:2,UNSUPPORTED_THRESHOLD:3,PARAMATER_INVALID:4,INVALID_STATE:5,NOT_READY:6,MISSING_REQUIRED_PARAM:7,TIMEOUT:8,ALREADY_IN_PROGRESS:9,FREQUENCY_LIMITED:10},c=5e3,d=new Map;function l(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"|";return e?i()(t=e.toString()).call(t,/[,]/g,r):""}var h=null,f=null;function p(e){h=e}function v(e){f=e}function g(e,t){var r,n;if(i=e,o=performance.now(),(!d.has(i)||o-d.get(i)>c)&&(d.set(i,o),1)){var i,o,s;try{s=l("object"==j(t)?JSON.stringify(t):t)}catch(i){s=l(t)}null===(r=f)||void 0===r||r("NEM-".concat(e,"-").concat(s)),a.Ay.error("NotifyUIError,event=".concat(e,",data=").concat(s)),null===(n=h)||void 0===n||n(e,t)}}},5090:function(e,t,r){r.d(t,{A:function(){return o}});var n=r(5408),i=r(14),a=r(2737),o={isOnWebCodecWhitelist:function(e,t,r,i,a){if(""===e||void 0===e||void 0===t||""===t||!a)return!1;if(!i){var o=e.includes("arm"),s=t.includes("intel"),u=t.includes("amd"),c=t.includes("nvidia");return"encoder"===r?!o&&!!(s||u||c):!("decoder"!==r||o||!u&&(s?this.isInRangeOfGenerations("intel",t,1e3,4e3):c&&this.isLowerThanMinGeneration("nvidia",t,"600")))}for(var d=0;d<i.length;d++){var l=i[d],h="vendor"in l,f="model"in l,p="renderInfo"in l,v="blacklist"in l,g="";h&&""!==l.vendor&&(g=l.vendor.toLowerCase());var m="";f&&""!==l.model&&(m=l.model.toLowerCase());var y="";p&&""!==l.renderInfo&&(y=l.renderInfo.toLowerCase());var _=null;if(v&&l.blacklist.length>0&&(_=l.blacklist),h){if(""!==g&&e.includes(g))return""===m&&""===y&&!_||!!(t===y||""!==y&&t.includes(y))||(""!==m&&t.includes(m)||""===m)&&(!_||!this.isHitBlacklist(e,t,r,m,_,a))}else n.Ay.error("isOnWebCodecWhitelist() no vendor field in the json entry! entry:".concat(l))}return!1},isGPUProfileOnWebCodecWhitelist:function(e,t,r,i){if(!this.isOffscreenCanvasSupported())return n.Ay.log("isGPUProfileOnWebCodecWhitelist() OffscreenCanvas is not supported."),!1;try{var a=r.vendor,o=r.renderInfo,s=this.isOnWebCodecWhitelist(a,o,e,t,i);return n.Ay.directReport("isGPUProfileOnWebCodecWhitelist() isOnWhitelist:".concat(s,", vendor:").concat(a,", renderInfo:").concat(o,", codecType:").concat(e,", config:").concat(JSON.stringify(t))),s}catch(e){return!1}},readWebRTCVideoCodecConfig:function(e,t){var r,i,o,s,u=this;if(!e)return null;var c,d=(null==t||null===(r=t.browser)||void 0===r?void 0:r.name)||"",l=(null==t||null===(i=t.browser)||void 0===i?void 0:i.version)||"",h=a.Ay.getGpuInfo(),f={os:null==t?void 0:t.os.toLowerCase(),browserName:d.toLowerCase(),browserVersion:l.toLowerCase(),engineName:null==t||null===(o=t.engine)||void 0===o?void 0:o.name.toLowerCase(),engineVersion:null==t||null===(s=t.engine)||void 0===s?void 0:s.version.toLowerCase(),vendor:h.vendor.toLowerCase(),renderInfo:h.renderInfo.toLowerCase(),isAstcSupported:h.isAstcSupported},p=null,v=A(e);try{var g,m=function(){var t=c.value;if(t.os&&""!==t.os&&!f.os.includes(t.os.toLowerCase()))return 0;var r=!1;if(t.browser&&t.browser.name&&""!==t.browser.name){if(!f.browserName.includes(t.browser.name.toLowerCase()))return 0;if(!!f.browserName.includes("safari")||f.browserName.includes("samsung internet")&&(r=!0),t.browser.versions&&t.browser.versions.length>0&&!t.browser.versions.some((function(e){return u.isBrowserVersionHitBlacklist(f.browserVersion,e,r,f.engineVersion)})))return 0}if((!t.vendor||""===t.vendor||f.vendor.includes(t.vendor.toLowerCase()))&&(!t.renderInfo||""===t.renderInfo||f.renderInfo.includes(t.renderInfo.toLowerCase()))){try{if(t.config){var i=!1;"true"===t.config.preferSoftwareEncoder&&(i=!0);var a=!1;if("true"===t.config.preferSoftwareDecoder&&(a=!0),p={preferSoftwareCodec:{send:i,recv:a}},t.config.maxEncodingLayers){var o=parseInt(t.config.maxEncodingLayers);p.maxEncodingLayers=o}}}catch(t){n.Ay.error("readWebRTCVideoCodecConfig() videoCodecConfig:".concat(e),t)}if(p)return 1}};for(v.s();!(c=v.n()).done&&(0===(g=m())||1!==g););}catch(e){v.e(e)}finally{v.f()}return p},evalWebRTCStrategy:function(e,t,r,a){var o,s,u,c,d,l,h,f=this,p={stg:i.BH.DISABLED,errNo:i.Qb.UNKNOWN,errMsg:""};if(!r)return p.stg=i.BH.DISABLED,p.errNo=i.Qb.BROWSER_NOT_SPT,p.errMsg="webrtc is disabled(not supported by browser).",p;if(a===i.BH.DISABLED)return p.stg=i.BH.DISABLED,p.errNo=i.Qb.SUCCEED,p;if(!e||0==e.length)return p.stg=a,p.errNo=i.Qb.SUCCEED,p;var v,g={os:null===(o=t.os)||void 0===o?void 0:o.toLowerCase(),browserName:null===(s=t.browserName)||void 0===s?void 0:s.toLowerCase(),browserVersion:null===(u=t.browserVersion)||void 0===u?void 0:u.toLowerCase(),engineName:null===(c=t.engineName)||void 0===c?void 0:c.toLowerCase(),engineVersion:null===(d=t.engineVersion)||void 0===d?void 0:d.toLowerCase(),vendor:null===(l=t.vendor)||void 0===l?void 0:l.toLowerCase(),renderInfo:null===(h=t.renderInfo)||void 0===h?void 0:h.toLowerCase(),isAstcSupported:t.isAstcSupported},m=A(e);try{var y,_=function(){var e=v.value,t=0,r=!1;if(e.os&&""!==e.os){if(!g.os.includes(e.os.toLowerCase()))return 0;g.os.includes("mac")&&(r=!0),t|=4096}var a=!1,o=!1;if(e.browser&&e.browser.name&&""!==e.browser.name){if(!g.browserName.includes(e.browser.name.toLowerCase()))return 0;if(g.browserName.includes("safari")?a=!0:g.browserName.includes("samsung internet")&&(o=!0),e.browser.versions&&e.browser.versions.length>0){if(!e.browser.versions.some((function(e){return f.isBrowserVersionHitBlacklist(g.browserVersion,e,o,g.engineVersion)})))return 0;t|=256}else t|=256}if(e.vendor&&""!==e.vendor)if(g.vendor.includes(e.vendor.toLowerCase()))t|=16;else{if(!r||!a||"intel"!==e.vendor.toLowerCase()||g.isAstcSupported)return 0;t|=16}if(e.renderInfo&&""!==e.renderInfo){if(g.renderInfo!==e.renderInfo.toLowerCase())return 0;t|=1}if(t>0)return{v:(p.stg=i.BH.DISABLED,p.errNo=i.Qb.DEVICE_ON_BLACKLIST,p.errMsg="webrtc is disabled(hit blacklist).",n.Ay.log("evalWebRTCStrategy() stg:".concat(JSON.stringify(p))),p)}};for(m.s();!(v=m.n()).done;)if(0!==(y=_())&&y)return y.v}catch(e){m.e(e)}finally{m.f()}return p.stg=a,p.errNo=i.Qb.SUCCEED,p},isOnWebRTCWhitelist:function(e,t){var r,i;if(!t)return{isInWhitelist:!1,blacklist:null};n.Ay.directReport("isOnWebRTCWhitelist() deviceInfo=".concat(JSON.stringify(t)));var a={os:null===(r=t.os)||void 0===r?void 0:r.toLowerCase(),browserName:null===(i=t.browserName)||void 0===i?void 0:i.toLowerCase()};if(!e){var o=[{browserName:"chrome",os:["win","mac","ios","android","chromium os"]},{browserName:"edge",os:["win"]},{browserName:"safari",os:["mac","ios"]},{browserName:"mobile safari",os:["ios"]}].some((function(e){return e.browserName===a.browserName&&e.os.some((function(e){return a.os.includes(e)}))}));return n.Ay.log("isOnWebRTCWhitelist() no new whitelist configured. use old whitelist. isInWhitelist:".concat(o)),{isInWhitelist:o,blacklist:null}}var s=e.find((function(e){return e.browser===a.browserName&&a.os.includes(e.os)}));return{isInWhitelist:!!s,blacklist:(null==s?void 0:s.blacklist)||null}},isLowerThanMinGeneration:function(e,t,r){try{var i=e.toLowerCase(),a=t.toLowerCase(),o=parseInt(r);if("nvidia"===i){if(a.includes("geforce")){var s=a.indexOf("geforce gt ");if(parseInt(a.slice(s+11))<o)return!0}}else if("intel"===i&&a.includes("hd graphics")){var u=a.indexOf("hd graphics ");if(parseInt(a.slice(u+12))<o)return!0}return!1}catch(e){return n.Ay.error(e),!1}},isInRangeOfGenerations:function(e,t,r,i){try{var a=e.toLowerCase(),o=t.toLowerCase();if("intel"===a&&o.includes("hd graphics")){var s=o.indexOf("hd graphics "),u=parseInt(o.slice(s+12));if(u>r&&u<i)return!0}return!1}catch(e){return n.Ay.error(e),!1}},isOffscreenCanvasSupported:function(){return"function"==typeof OffscreenCanvas},isHitBlacklist:function(e,t,r,i,a,o){if(!t||""===t||!o)return n.Ay.error("isHitBlacklist() targetRenderInfo is invalid"),!0;if(!a)return n.Ay.error("isHitBlacklist() an invalid blacklist configuration object"),!1;if("encoder"!==r&&"decoder"!==r&&"all"!==r)return n.Ay.error("isHitBlacklist() an invalid codecType(".concat(r,").")),!0;var s,u=i.toLowerCase(),c=!1,d=A(a);try{for(d.s();!(s=d.n()).done;){var l=s.value,h="model"in l,f="codecType"in l,p="renderInfo"in l,v="minGeneration"in l,g="os"in l,m=null;h&&""!==l.model&&(m=l.model.toLowerCase());var y=null;if(f)if("all"===(y=l.codecType)||"encoder"===y||"decoder"===y){var _=null;p&&""!==l.renderInfo&&(_=l.renderInfo.toLowerCase());var S=null;v&&(S=l.minGeneration);var b=null;if(g&&""!==l.os&&(b=l.os.toLowerCase()),!h&&!p){if(!g){n.Ay.warn("isHitBlacklist() invalid blacklist entry. entry:".concat(l));continue}if(b.includes(o.os.toLowerCase())){c=!0;break}}if(p&&""!==_&&(t===_||t.includes(_))&&("all"===y||y===r)){if(!g){c=!0;break}if(b.includes(o.os.toLowerCase())){c=!0;break}}if(m)if(""!==u){if(m!==u){n.Ay.warn("isHitBlacklist() model(".concat(m,") in blacklist entry and model(").concat(u,") in whitelist should be same!"));continue}if("all"===y||y===r)if(S&&""!==S){if(this.isLowerThanMinGeneration(e,t,S)){if(!g){c=!0;break}if(b.includes(o.os.toLowerCase())){c=!0;break}}}else{if(!g){c=!0;break}if(b.includes(o.os.toLowerCase())){c=!0;break}}}else if(t.includes(m)&&("all"===y||y===r))if(S&&""!==S){if(this.isLowerThanMinGeneration(e,t,S)){if(!g){c=!0;break}if(b.includes(o.os.toLowerCase())){c=!0;break}}}else{if(!g){c=!0;break}if(b.includes(o.os.toLowerCase())){c=!0;break}}}else n.Ay.error("isHitBlacklist() codecType(".concat(y,") should be all/(empty)/encoder/decoder."));else n.Ay.warn("isHitBlacklist() miss codecType field in the configuration.")}}catch(e){d.e(e)}finally{d.f()}return c},isBrowserVersionHitBlacklist:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(!e||!t)return n.Ay.error("compareBrowserVersion() invalid parameters! browserVersion:".concat(e,", blacklistVersion:").concat(t)),!1;var a=[];if(r&&i)if(-1!==t.indexOf(":")){var o=v(t.split(":"),2),s=o[0],u=o[1];""!==s&&a.push(s),""!==u&&a.push(u)}else a.push(t);else a.push(t);for(var c=!1,d=0;d<a.length;d++){var l=a[d],h=l[0],f=0;"<"==h?f=-1:"="==h?f=0:">"==h?f=1:(n.Ay.error("isBrowserVersionHitBlacklist() invalid operator! operator:".concat(h)),f=0);for(var p=l.slice(1),g=e.toString().split("."),m=p.toString().split("."),y=Math.min(g.length,m.length),_=0;_<y;_++){var S=parseInt(g[_],10),A=parseInt(m[_],10);if(isNaN(S)||isNaN(A))n.Ay.error("Invalid version number detected!"),c=!1;else if(0!=f){if(-1==f){if(S<A){c=!0;break}if(S==A){c=!0;continue}c=!1;break}if(1==f){if(S>A){c=!0;break}if(S==A){c=!0;continue}c=!1;break}}else{if(S!==A){c=!1;break}c=!0}}if(!c)return!1}return c}}},4865:function(e,t,r){r.d(t,{N6:function(){return a},l8:function(){return o},nC:function(){return s}});var n=r(456),i=r(5408),a=D((function e(t){R(this,e);var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t.byteLength,s=arguments.length>6?arguments[6]:void 0;this.offset=a,this._BYTES_PER_ELEMENT=r,this.capacity=(o-8)/r,this.usableCapacity=this.capacity-1,this.buf=t,this.write_ptr=new Uint32Array(this.buf,a,1),this.read_ptr=new Uint32Array(this.buf,a+4,1),this.storageUint8sByteOffset=a+8,this.storageUint8s=new Uint8Array(this.buf,this.storageUint8sByteOffset,o-8),this.byteLength=o,this.label=n,this.usingOneElementBuffer=i,s&&(this.wasmMemory=s),i&&(this.oneElementBuffer=new ArrayBuffer(r)),this.repushhander=0,this.repushlogcount=0,this.monitorpace=0}),[{key:"checkBuffer",value:function(){this.wasmMemory&&this.wasmMemory.buffer!=this.buf&&(console.log("buffer change"),this.buf=this.wasmMemory.buffer,this.storageUint8s=new Uint8Array(this.buf,this.storageUint8sByteOffset,this.byteLength-8))}},{key:"enqueue",value:function(e){return this.available_write()>0&&this.push(e),{rd:Atomics.load(this.read_ptr,0),wr:Atomics.load(this.write_ptr,0)}}},{key:"enqueueSafe",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;for(this.dataBuffer||(this.dataBuffer=new n.A);this.dataBuffer.getLength()>0&&this.available_write()>0;){var o=this.dataBuffer.dequeue();o&&this.push(o)}var s=this.dataBuffer.getLength();if(e){if(this.available_write()>0&&0==s)return this.push(e),!0;if(!r)return!1;this.dataBuffer.enqueue(e),++s}if(s>0&&!this.repushhander&&(this.repushhander=setTimeout((function(){t.repushlogcount%10==0&&console.warn("<<< retry consume cache data"),t.repushlogcount++,t.repushhander=0,t.enqueueSafe(null)}),30)),s>=1e3&&(i.Ay.warn("Cached data in SAB reached critical value, will be cleared"),this.dataBuffer.clear(),a&&a("vqslclear")),s>0&&a){var u=performance.now();(!this.monitorpace||u-this.monitorpace>2e4)&&(this.monitorpace=u,a&&a("vqsl"+s))}return!0}},{key:"push",value:function(e){return e instanceof Array?this._pushArray(e):this._push(e)}},{key:"_pushArray",value:function(e){var t=this,r=Atomics.load(this.write_ptr,0);this.checkBuffer();var n=0;e.forEach((function(e){t.storageUint8s.set(e,r*t._BYTES_PER_ELEMENT+8+4+n),n+=e.byteLength})),new Uint32Array(this.buf,this.offset+r*this._BYTES_PER_ELEMENT+8,1)[0]=n;var i=(r+1)%this.capacity;return Atomics.store(this.write_ptr,0,i),!0}},{key:"_push",value:function(e){var t=Atomics.load(this.write_ptr,0);this.checkBuffer(),this.storageUint8s.set(e,t*this._BYTES_PER_ELEMENT+8+4,e.byteLength),new Uint32Array(this.buf,this.offset+t*this._BYTES_PER_ELEMENT+8,1)[0]=e.byteLength;var r=(t+1)%this.capacity;return Atomics.store(this.write_ptr,0,r),!0}},{key:"addReadPtr",value:function(){var e=Atomics.load(this.read_ptr,0);Atomics.store(this.read_ptr,0,(e+1)%this.capacity)}},{key:"dequeue",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=Atomics.load(this.read_ptr,0);this.checkBuffer();var r,n,i,a=new Uint32Array(this.buf,this.offset+t*this._BYTES_PER_ELEMENT+8,1);if(e){r=this.oneElementBuffer?new Uint8Array(this.oneElementBuffer,0,a[0]):new Uint8Array(a[0]);var o=new Uint8Array(this.storageUint8s.buffer,t*this._BYTES_PER_ELEMENT+8+4+this.storageUint8sByteOffset,r.byteLength);r.set(o,0)}else r=this.storageUint8s.subarray(t*this._BYTES_PER_ELEMENT+8+4,t*this._BYTES_PER_ELEMENT+8+4+a[0]),n=t*this._BYTES_PER_ELEMENT+8+4+this.storageUint8sByteOffset,i=t*this._BYTES_PER_ELEMENT+8+4+a[0]+this.storageUint8sByteOffset;return e&&Atomics.store(this.read_ptr,0,(t+1)%this.capacity),e?r:{bCopyData:e,uint8s:r,begin:n,end:i}}},{key:"available_read",value:function(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_read(e,t)}},{key:"available_write",value:function(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_write(e,t)}},{key:"is_available_write",value:function(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._is_available_write(e,t)}},{key:"_available_read",value:function(e,t){return(t+this.capacity-e)%this.capacity}},{key:"_available_write",value:function(e,t){return this.usableCapacity-this._available_read(e,t)}},{key:"_is_available_write",value:function(e,t){return this._available_write(e,t)>0}},{key:"_storage_capacity",value:function(){return this.capacity}}],[{key:"getStorageForCapacity",value:function(){return new SharedArrayBuffer(8+((arguments.length>0&&void 0!==arguments[0]?arguments[0]:80)+1)*(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500))}}]),o=D((function e(t,r){R(this,e);var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:80;if(!(t instanceof a))throw new Error("RingBuffer required");this.rb=t,this.dataCallback=r,this.interval=null,this.requestID=null,this.timeout_call=n,this.tick_lasted_time=0,this.timeoutMS=i,this.maxCount=o}),[{key:"setDataCallback",value:function(e){this.dataCallback=e}},{key:"consume",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.interval||(this.bCopyData=r,this.interval=setInterval((function(){var t=performance.now();if(e.timeout_call){if(0!=e.tick_lasted_time){var r=t-e.tick_lasted_time;r>=e.timeoutMS&&e.timeout_call(r,t)}e.tick_lasted_time=t}e._dequeue()}),t),console.log("consume interval ".concat(this.interval)))}},{key:"consumeAll",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.bCopyData=e,this._dequeue()}},{key:"_dequeue",value:function(){var e=Math.min(this.rb.available_read(),this.maxCount);for(this.consoume_count=0;this.consoume_count<e;){this.consoume_count++;var t=this.rb.dequeue(this.bCopyData);this.dataCallback(t),this.bCopyData||this.rb.addReadPtr()}}},{key:"_consumeForAnimationFrame",value:function(){this._dequeue(),this.requestID=requestAnimationFrame(this._consumeForAnimationFrame.bind(this))}},{key:"consumeUsingRequestAnimationFrame",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.requestID||(this.bCopyData=e,this._consumeForAnimationFrame())}},{key:"cancelConsume",value:function(){console.log("cancelConsume interval ".concat(this.interval," requestID ").concat(this.requestID)),this.tick_lasted_time=0,clearInterval(this.interval),this.requestID&&cancelAnimationFrame(this.requestID),this.interval=null,this.requestID=null}}]),s=D((function e(){R(this,e),this.timeStampKey="video_timestamp",this.keysList=["video_ssrc","video_width","video_height","rendering_x","rendering_y","rendering_w","rendering_h","rotation","yuv_limited"],this.bCopyData=null,this.begin=null,this.end=null}),[{key:"setOBJ",value:function(e){this.obj=e,this.yuvUint8s=e.data}},{key:"setBuffer",value:function(e){!1===e.bCopyData?(this.objUint8s=e.uint8s,this.bCopyData=e.bCopyData,this.begin=e.begin,this.end=e.end):(this.objUint8s=e,this.bCopyData=!0,this.begin=0,this.end=e.byteLength)}},{key:"buffer2Obj",value:function(){var e=new Uint32Array(this.objUint8s.buffer,this.begin,9),t=new DataView(this.objUint8s.buffer,this.begin+40,16),r={};this.keysList.forEach((function(t,n){r[t]=e[n]})),r[this.timeStampKey]=Number(t.getBigUint64(0,!0));var n,i=Number(t.getBigUint64(8,!0)),a=new Uint8Array(this.objUint8s.buffer,this.begin+40+8+8,i);return this.bCopyData,n=a,r.data=n,r}},{key:"obj2buffer",value:function(){var e=this,t=new Uint8Array(56),r=this.keysList,n=new Uint32Array(t.buffer,0,9),i=new DataView(t.buffer,40,16);return r.forEach((function(t,r){n[r]=e.obj[t]})),i.setBigUint64(0,BigInt(this.obj[this.timeStampKey]),!0),i.setBigUint64(8,BigInt(this.yuvUint8s.byteLength),!0),[t,this.yuvUint8s]}}])},7243:function(e,t,r){r.d(t,{A:function(){return i}});var n=function(){};n.prototype={threads:function(){var e=H(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=H(O().mark((function e(t){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(WebAssembly.validate(t)){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,e.abrupt("return",((new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),!0));case 6:return e.prev=6,e.t0=e.catch(2),e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e,null,[[2,6]])})));return function(t){return e.apply(this,arguments)}}()(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),simd:function(){var e=H(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11])));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()};var i=new n},5408:function(e,t,r){r.d(t,{Ay:function(){return o},GW:function(){return i},ZN:function(){return a}});var n="MEDIASDK_CACHE_INFO",i=D((function e(){R(this,e),this._highFrequencyLogs={},this.fixVersion="",this.cacheLogStack=[],this.isFlushing=!1}),[{key:"setInstance",value:function(e,t){this._instance=e,this.fixVersion=t}},{key:"getMessageFromErrorOrEvent",value:function(e,t){var r=e;return t instanceof ErrorEvent?(t.filename&&(r+=" File: ".concat(t.filename)),(t.lineno||t.colno)&&(r+=" Line: ".concat(t.lineno,":").concat(t.colno)),t.message&&(r+=" Message: ".concat(t.message)),t.error&&(r+="\nStack: ".concat(t.error.stack))):t instanceof Error?(t.fileName&&(r+=" File: ".concat(t.fileName)),(t.lineNumber||t.columnNumber)&&(r+=" Line: ".concat(t.lineNumber,":").concat(t.columnNumber)),t.message&&(r+=" Message: ".concat(t.message)),t.stack&&(r+=" Stack: ".concat(t.stack)),t.name&&(r+=" Name: ".concat(t.name)),t.constraint&&(r+=" Constraint: ".concat(t.constraint))):t instanceof CloseEvent?(t.code&&(r+=" Code: ".concat(t.code)),t.reason&&(r+=" Reason: ".concat(t.reason)),r+=" wasClean: ".concat(t.wasClean)):t instanceof DOMException?(t.message&&(r+=" Message: ".concat(t.message)),t.name&&(r+=" Name: ".concat(t.name))):r+=t?t.toString():"",r}},{key:"_addCacheLog",value:function(e,t){this.cacheLogStack.length<100&&this.cacheLogStack.push({type:e,message:t})}},{key:"flushCacheLog",value:function(){var e=this;if(this._instance&&this.cacheLogStack.length>0&&!this.isFlushing){this.isFlushing=!0;var t="";this.cacheLogStack.forEach((function(r){var i=r.type,a=r.message,o=a.message,s=void 0===o?"":o,u=a.tags,c=void 0===u?[]:u,d=s?"".concat(c.join("|"),":").concat(s).concat("|----|"):"";switch(i){case"log":e._log(s,[].concat(y(c),[n]));break;case"warn":case"error":case"severityerror":case"directReport":t+=d}})),t&&this._directReport(t,[n]),this.cacheLogStack=[],this.isFlushing=!1}}},{key:"log",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this._instance?(this.flushCacheLog(),this._log(e,t)):this._addCacheLog("log",{message:e,tags:t})}},{key:"warn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];e=this.getMessageFromErrorOrEvent(e,t),this._instance?(this.flushCacheLog(),this._warn(e,r)):this._addCacheLog("warn",{message:e,tags:r})}},{key:"error",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];e=this.getMessageFromErrorOrEvent(e,t),this._highFrequencyLogs[e]?this._highFrequencyLogs[e]+=1:this._highFrequencyLogs[e]=1,a(this._highFrequencyLogs[e])&&(this._instance?(this.flushCacheLog(),this._error(e,r)):this._addCacheLog("error",{message:e,tags:r}))}},{key:"severityerror",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this._instance?(this.flushCacheLog(),this._severityerror(JSON.stringify(e),t)):this._addCacheLog("severityerror",{message:JSON.stringify(e),tags:t})}},{key:"directReport",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["MEDIASDK_INFO"];this._instance?(this.flushCacheLog(),null===(t=this._directReport)||void 0===t||t.call(this,e,r)):this._addCacheLog("directReport",{message:e,tags:r})}},{key:"_log",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this._instance&&this._instance.log(e,t)}},{key:"_warn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this._instance&&this._instance.warn(e,t)}},{key:"_error",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this._instance&&this._instance.error(e,[this.fixVersion].concat(y(t)))}},{key:"_severityerror",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this._instance&&this._instance.error(e,t)}},{key:"_directReport",value:function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this._instance&&(null===(t=(r=this._instance).directReport)||void 0===t||t.call(r,{msg:e},n))}},{key:"clearHighFrequencyLogs",value:function(){this._highFrequencyLogs={}}}]),a=function(e){return!(e&e-1)},o=new i},1461:function(e,t,r){r.d(t,{$8e:function(){return qt},$MS:function(){return St},$qV:function(){return jr},$xb:function(){return En},A3p:function(){return E},A7G:function(){return Hn},AL$:function(){return Mt},AV$:function(){return vn},A_T:function(){return Yr},Abc:function(){return xn},Aew:function(){return Ze},Ah8:function(){return _n},AjI:function(){return Me},AmQ:function(){return Se},AoB:function(){return Vr},Azg:function(){return qr},BBN:function(){return Qn},BJf:function(){return zr},BSK:function(){return mr},BgG:function(){return Cr},BqC:function(){return n},Bse:function(){return rn},CIY:function(){return Kt},CQt:function(){return o},CXV:function(){return qe},CY1:function(){return Ot},CcD:function(){return Zt},CpQ:function(){return Be},DCT:function(){return de},DjR:function(){return jt},ETO:function(){return kr},EUC:function(){return Rt},EWx:function(){return lr},EYN:function(){return me},EcQ:function(){return An},Ewj:function(){return Bt},Eym:function(){return Xr},FQb:function(){return en},FjO:function(){return In},Fxk:function(){return gr},G9o:function(){return Kr},GT7:function(){return $},GtU:function(){return oe},HKK:function(){return u},HL3:function(){return Pt},HOE:function(){return Pr},HVQ:function(){return ht},HjG:function(){return Tn},I6S:function(){return ln},I8$:function(){return m},IQ_:function(){return or},IV3:function(){return Mn},IkA:function(){return xe},Ikw:function(){return a},JoO:function(){return Er},Joy:function(){return Sn},K3m:function(){return He},K9M:function(){return z},KYx:function(){return te},KqK:function(){return Tr},LL7:function(){return Mr},LYk:function(){return pn},L_m:function(){return Ln},Lmp:function(){return Xn},M5B:function(){return O},M5F:function(){return yt},M9W:function(){return pr},MP_:function(){return lt},Mhb:function(){return S},N6$:function(){return Ge},NPX:function(){return Ut},O06:function(){return X},ONI:function(){return Fr},P79:function(){return _e},PMP:function(){return Ne},PSY:function(){return K},PcV:function(){return Ve},PgM:function(){return mn},Q$T:function(){return _t},QQs:function(){return rt},Qc:function(){return v},QoY:function(){return i},QyH:function(){return kn},RJ8:function(){return Re},RmE:function(){return N},SUv:function(){return we},ScD:function(){return Ar},Sed:function(){return w},Shw:function(){return Tt},TB5:function(){return Le},TRD:function(){return ut},TSA:function(){return Je},TaW:function(){return bn},Tbw:function(){return Gn},UFw:function(){return dn},UGN:function(){return b},U_k:function(){return Y},Ubu:function(){return Gt},UsF:function(){return Pe},UyE:function(){return Xt},V36:function(){return Ye},V5N:function(){return er},Vtx:function(){return Ke},VxP:function(){return ce},WCu:function(){return cn},WP5:function(){return Cn},Wcg:function(){return It},X0s:function(){return C},X10:function(){return M},X1W:function(){return Kn},XDu:function(){return kt},XE6:function(){return p},XHL:function(){return pe},XbU:function(){return x},Y7X:function(){return bt},Y9c:function(){return sn},YD4:function(){return R},YG0:function(){return Qr},YTV:function(){return W},Ya9:function(){return wt},ZFN:function(){return Hr},ZIm:function(){return Q},ZSj:function(){return Nr},_7f:function(){return ke},_9I:function(){return rr},_Gi:function(){return s},_Nl:function(){return ie},_Zs:function(){return g},a$m:function(){return Fe},a1o:function(){return Ur},a6z:function(){return Jt},aE$:function(){return Z},aKW:function(){return fr},aYB:function(){return ae},ahr:function(){return tn},bKC:function(){return L},bSz:function(){return I},bVv:function(){return pt},bW9:function(){return Ht},baF:function(){return vt},bes:function(){return Gr},bjn:function(){return _r},bo2:function(){return ur},cBD:function(){return Dt},cJy:function(){return G},cYb:function(){return Ct},cjy:function(){return mt},dUL:function(){return Ir},dsK:function(){return yr},eEQ:function(){return _},eJx:function(){return Oe},ee7:function(){return ve},ekh:function(){return Yt},epV:function(){return At},exH:function(){return l},f8O:function(){return q},fAR:function(){return fe},fmn:function(){return nt},fxd:function(){return wn},g$j:function(){return se},g8Z:function(){return f},g9q:function(){return tr},gFh:function(){return hr},gh2:function(){return hn},gle:function(){return V},h73:function(){return Et},hG:function(){return Yn},hcn:function(){return De},hd7:function(){return gt},hs:function(){return y},i0n:function(){return Ee},i3D:function(){return Or},i8:function(){return ue},i9k:function(){return Xe},i9w:function(){return Te},iDK:function(){return J},iQY:function(){return gn},j4N:function(){return T},jCp:function(){return ge},jhI:function(){return $t},kPo:function(){return st},kQe:function(){return U},kqY:function(){return Zr},l8t:function(){return $e},lA5:function(){return vr},lLs:function(){return Pn},lOl:function(){return Qe},lyw:function(){return H},m1Q:function(){return k},m7W:function(){return D},mrR:function(){return Jn},msu:function(){return On},mxj:function(){return Br},n7n:function(){return dt},nEg:function(){return dr},naM:function(){return tt},npe:function(){return Wt},oDm:function(){return cr},oFc:function(){return it},oQY:function(){return Rr},oUP:function(){return yn},ovL:function(){return ee},p4Z:function(){return Un},p8Y:function(){return Lt},pHx:function(){return Dr},pOT:function(){return d},pn7:function(){return be},pvo:function(){return br},px:function(){return Nt},qRr:function(){return Rn},qUx:function(){return sr},qmK:function(){return Ce},qnv:function(){return ne},qqH:function(){return wr},qw$:function(){return $r},r2c:function(){return j},r4R:function(){return an},rME:function(){return qn},rNn:function(){return ir},rSS:function(){return le},rV1:function(){return Fn},rcl:function(){return B},rje:function(){return ze},rpL:function(){return Ue},rt8:function(){return nn},rwH:function(){return je},s8N:function(){return P},sCk:function(){return et},sCw:function(){return Wr},sfr:function(){return Bn},ssE:function(){return ot},t4x:function(){return at},tMo:function(){return Dn},tN9:function(){return ft},tav:function(){return A},tjY:function(){return zt},tm0:function(){return ye},u1v:function(){return he},uiF:function(){return h},uiQ:function(){return ar},uoF:function(){return Lr},uxR:function(){return F},vIC:function(){return jn},vd4:function(){return fn},vjv:function(){return Jr},wIu:function(){return We},wYI:function(){return re},wb7:function(){return Nn},wk9:function(){return c},x$W:function(){return Vn},x3x:function(){return Qt},xQc:function(){return un},xlY:function(){return ct},xzH:function(){return Wn},yEo:function(){return Sr},yGo:function(){return xt},yHE:function(){return Ae},yJV:function(){return Ft},zFT:function(){return nr},zag:function(){return on},zby:function(){return zn},zds:function(){return xr},ziT:function(){return Ie},zj1:function(){return Vt}});var n=1,i=2,a=3,o=4,s=5,u=6,c=7,d=8,l=9,h=10,f=11,p=12,v=13,g=15,m=16,y=17,_=18,S=19,A=21,b=22,E=23,k=24,C=25,w=26,T=27,R=28,I=30,D=30.1,M=31,O=31.1,x=32,P=33,L=34,N=36,V=37,U=38,F=40,B=41,W=43,G=44,H=45,j=46,K=48,z=49,q=50,Y=51,X=52,Q=53,J=54,$=55,Z=57,ee=58,te=59,re=60,ne=61,ie=62,ae=63,oe=64,se=65,ue=66,ce=70,de=71,le=72,he=73,fe=74,pe=75,ve=76,ge=77,me=78,ye=79,_e=80,Se=81,Ae=82,be=83,Ee=84,ke=85,Ce=86,we=87,Te=90,Re=91,Ie=92,De=93,Me=94,Oe=96,xe=97,Pe=98,Le=99,Ne=101,Ve=100,Ue=102,Fe=103,Be=104,We=110,Ge=111,He=112,je=113,Ke=116,ze=117,qe=118,Ye=120,Xe=121,Qe=123,Je=124,$e=125,Ze=126,et=127,tt=128,rt=129,nt=130,it=132,at=133,ot=135,st=136,ut=137,ct=138,dt=150,lt=152,ht=153,ft=156,pt=158,vt=159,gt=160,mt=161,yt=162,_t=163,St=1.1,At=1.2,bt=1.3,Et=2,kt=3,Ct=6,wt=7,Tt=8,Rt=9,It=10,Dt=11,Mt=12,Ot=13,xt=14,Pt=15,Lt=16,Nt=17,Vt=18,Ut=19,Ft=20,Bt=21,Wt=23,Gt=24,Ht=25,jt=26,Kt=27,zt=28,qt=29,Yt=30,Xt=31,Qt=32,Jt=33,$t=34,Zt=35,er=36,tr=37,rr=38,nr=39,ir=-1.1,ar=-1.2,or=-1.3,sr=-2,ur=-3,cr=-4,dr=-8,lr=-9,hr=-10,fr=-11,pr=-12,vr=-14,gr=-15,mr=-20,yr=-21,_r=-22,Sr=-24,Ar=-28,br=-27,Er=-29,kr=-31,Cr=-32,wr=-33,Tr=-34,Rr=-35,Ir=-36,Dr=-37,Mr=-38,Or=-39,xr=-40,Pr=-41,Lr=-44,Nr=-45,Vr=-51,Ur=-52,Fr=-60,Br=-53,Wr=-70,Gr=-129,Hr=-130,jr=-136,Kr=-137,zr=-138,qr=-140,Yr=0,Xr=1,Qr=2,Jr="SHARING_PARAM_INFO_FROM_SOCKET",$r=24321,Zr=24322,en=24322,tn=24323,rn=24322,nn=4300,an=4299,on=7939,sn=32772,un=12303,cn=12305,dn=4167,ln=4355,hn={ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT:"ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT",ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT:"ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT",END_MEDIA:"END_MEDIA",DESTROY:"DESTROY",DC_COMING_MESSAGE:"DC_COMING_MESSAGE",AUDIO_BRIDGE_WS_TOKEN:"AUDIO_BRIDGE_WS_TOKEN"},fn=70,pn=170,vn=121,gn="AUDIO_QOS_DATA",mn="VIDEO_QOS_DATA",yn="VIDEOSHARE_QOS_DATA",_n="NETWORK_QUALITY_CHANGE",Sn="NETWORK_QUALITY_CHANGE_AUDIO",An={VIDEO_ENCODE:"0",VIDEO_DECODE:"1",AUDIO_ENCODE:"2",AUDIO_DECODE:"3",SHARING_ENCODE:"4",SHARING_DECODE:"5"},bn=66.5,En=66.6,kn="ENABLE_REUSE_STREAM",Cn="PRESET_MEDIA_CONSTRAINTS",wn="DESTORY_REUSE_STREAM",Tn={FAIL:4},Rn="AUDIO_STREAM_MUTED",In="AUDIO_STREAM_UNMUTED",Dn="VIDEO_STREAM_MUTED",Mn="VIDEO_STREAM_UNMUTED",On="EXPOSE_VB_FRAME",xn="UNIFIED_VB_FRAME",Pn="UNIFIED_VB_STOP",Ln="UNIFIED_VB_PAUSE",Nn="UNIFIED_VB_ACK",Vn="ANNO_UNDO_STATUS",Un="ANNO_REDO_STATUS",Fn="ANNO_VIEWER_REQUEST_DRAW",Bn={USER_DENIED:1,SYSTEM_DENIED:2,DEVICE_IN_USE:3,NO_DEVICE:4,UNKNOWN_REASON:5,OVERCONSTRAINED:6,USER_DISMISS:7},Wn={GRANTED_AUDIO_VIDEO:1,GRANTED_AUDIO:2,DENIED:3,EXCEPTION_FAILS:4,DISMISS:5},Gn=1128,Hn=1128.5,jn=1190,Kn=1178,zn=1176,qn=1177,Yn=1128,Xn=1130,Qn=1140,Jn=4},8353:function(e,t,r){r.d(t,{A:function(){return a}});var n="object"==("undefined"==typeof localStorage?"undefined":j(localStorage))&&localStorage.__islogdebug,i=function(e,t){function r(){var e=[];return e.push.apply(e,arguments),e}!0===t&&(n=!0);var i=function(){var t;n&&(t=console).log.apply(t,[e].concat(y(r(arguments))))};return["log","info","warn","error"].forEach((function(t){i[t]=function(){var i;n&&(i=console)[t].apply(i,[e].concat(y(r(arguments))))}})),i.isEnable=function(){return n},i};i.isEnable=function(){return n};var a=i},6687:function(e,t,r){r.d(t,{h:function(){return h},b:function(){return l}});var n=r(7857),i=r(7201),a=r.n(i),o=r(9549);function s(e){var t=e||{};this._samples=[],this._interval_id=0,this._lasted_update_time=0,this._lasted_group_time=0,this._enable=!1,this._interval_time=t.interval||3e4,this._customer_callback=t.report_call,this._tag=t.tag||"netreport",this._group_interval=t.group_interval||1e3,this._enable_advanced=t.advanced||!1,this._current_count=0,this._qos_report=new o.V_({tag:"jitter",interval:3e4,reportcallback:this._qos_report_timeout.bind(this)}),this._qos_report_samples=[],this._cureen_qos_report=0}s.prototype._qos_report_timeout=function(e,t,r,n){if(this._customer_callback){var i="".concat(e,",").concat(t,",").concat(r,",").concat(n);this._customer_callback(this._tag+"TimeOut",i)}},s.prototype._report=function(){var e=(new Date).getTime(),t="".concat(e,"-").concat(this._samples.length,"-").concat(this._samples),r="".concat(e,"-").concat(this._qos_report_samples.length,"-").concat(this._qos_report_samples);t=a()(t).call(t,",","|"),r=a()(r).call(r,",","|"),this._customer_callback?(this._customer_callback(this._tag,t),this._enable_advanced&&this._customer_callback(this._tag+"QOS",r)):console.error("tag:".concat(this._tag,",").concat(t))},s.prototype._group=function(){var e=performance.now();if(e>=this._lasted_group_time+1700)for(var t=Math.round((e-this._lasted_group_time)/1e3)-1,r=0;r<t;r++)this._samples.push(-1);this._lasted_group_time=e,this._samples.push(this._current_count),this._qos_report_samples.push(this._cureen_qos_report),this._cureen_qos_report=0,this._current_count=0,e>=this._lasted_update_time+this._interval_time&&(this._lasted_update_time=e,this._report(),this._samples=[],this._qos_report_samples=[])},s.prototype.start=function(){this._enable||(this._lasted_update_time=performance.now(),this._lasted_group_time=this._lasted_update_time,this._samples=[],this._current_count=0,this._qos_report_samples=[],this._cureen_qos_report=0,this._interval_id=setInterval(this._group.bind(this),this._group_interval),this._enable=!0)},s.prototype.stop=function(){this._enable&&(clearInterval(this._interval_id),this._interval_id=0,this._enable=!1)},s.prototype.sample=function(e){if(this._enable&&(this._current_count++,this._enable_advanced)){if(o.J0.IsQosReport(e))return void this._cureen_qos_report++;if(o.J0.IsVideoPkg(e)){var t=o.J0.GetQOSTime(e),r=performance.now();if(this._lasted_qos_ts){var n=r-this._lasted_sys_ts-(t-this._lasted_qos_ts);n>30&&this._qos_report.timeoutReport(n,r)}this._lasted_qos_ts=t,this._lasted_sys_ts=r,this._lasted_data=e}}};var u=r(9693),c=r(9482),d=r(9407),l=D((function e(t,r){R(this,e),this.type=t,this.transportlists=[],this.transfered=!!r,this.onmessage=function(){}}),[{key:"send",value:function(){}},{key:"isReady",value:function(){return!1}}]),h=function(){function e(t,r,n,i,a,o){R(this,e),this.id=t,this.tag=a||"",this.type=r,this.datachannel=n,this._recv_statistic=null,this.onmessageFn=function(){},this.disconnectedFn=null,this.connectedFn=null,this._status=e.UNINIT,this.target_thread=i,this.transfered=!1,this._listener=null,this.transportlists=[],this._send_statistic=null,this.report_monitor_func=function(){},this.bsuppend=!1,this.mgr=o,this.bufferIncreaseCount=0,this.lastBufferedAmount=0,this.highWaterMarkCount=0}return D(e,[{key:"isReady",value:function(){return this._status===e.CONNECTED}},{key:"send",value:function(e){this.datachannel.send(e),this._send_statistic.sample(!1)}},{key:"open",value:function(){if(this.target_thread)try{var e;return this.target_thread.postMessage({command:u.F,id:this.id,type:this.type,channel:this.datachannel,transportlists:this.transportlists,tag:this.tag},[this.datachannel]),this.transfered=!0,this.datachannel=null,void(null===(e=this.mgr)||void 0===e||e.addRTCChannel(this))}catch(e){this.target_thread=null}this._addEventListener()}},{key:"close",value:function(){var t;null===(t=this.mgr)||void 0===t||t.removeRTCChannel(this);var r=this.disconnectedFn;this.transfered&&this.target_thread&&this.target_thread.postMessage({command:u.vC,id:this.id,type:this.type}),this._status!=e.DISCONNECT&&this._clear(),this._status=e.DISCONNECT,null==r||r()}},{key:"onmessage",value:function(e){this.onmessageFn=e}},{key:"onopen",value:function(e){this.connectedFn=e}},{key:"onclose",value:function(e){this.disconnectedFn=e}},{key:"onerror",value:function(e){this.errorFn=e}},{key:"_addEventListener",value:function(){this.datachannel.onmessage=this._onmessage.bind(this),this.datachannel.onopen=this._onopen.bind(this),this.datachannel.onclose=this._onclose.bind(this),this.datachannel.onclosing=this._onclose.bind(this),this.datachannel.onerror=this._onerror.bind(this),"open"==this.datachannel.readyState&&this._status==e.UNINIT&&this._onopen()}},{key:"_onmessage",value:function(e){this._recv_statistic.sample(!1),this.onmessageFn(e)}},{key:"_onopen",value:function(t){var r,n=this._status;if(this._status=e.CONNECTED,!this.transfered){var i=this.report_monitor_func;if(!this._send_statistic){var a=this.tag?this.tag+"_SEND":this.type==c.Xt.VIDEO?"VDCS":"ADCS";this._send_statistic=new s({tag:a,report_call:i})}if(!this._recv_statistic){var o=this.tag?this.tag+"_RECV":this.type==c.Xt.VIDEO?"VDCR":"ADCR";this._recv_statistic=new s({tag:o,report_call:i})}this._send_statistic.start(),this._recv_statistic.start()}n!=e.CONNECTED&&(null===(r=this.connectedFn)||void 0===r||r.call(this))}},{key:"_onerror",value:function(e){var t;null===(t=this.errorFn)||void 0===t||t.call(this,e),this._onclose(e)}},{key:"_onclose",value:function(t){var r=this._status;this._status=e.DISCONNECT;var n=this.disconnectedFn;this._clear(),r!=e.DISCONNECT&&(null==n||n())}},{key:"_clear",value:function(){var e,t;!this.transfered&&this.datachannel&&(this.datachannel.onmessage=null,this.datachannel.onopen=null,this.datachannel.onclose=null,this.datachannel.onclosing=null,this.datachannel.onerror=null),this.onmessageFn=null,this.connectedFn=null,this.disconnectedFn=null,this.errorFn=null;var r=this.datachannel;this.datachannel=null,null===(e=this._send_statistic)||void 0===e||e.stop(),null===(t=this._recv_statistic)||void 0===t||t.stop(),null==r||r.close()}},{key:"mesagelistener",value:function(e){var t=e.data;if(t&&t.id==this.id)switch(t.cmd){case d.Lm:this._onclose();break;case d.hG:this._onopen();break;case d.Zk:this._onerror(t.ev);break;case d.vr:this.report_monitor_func(t.tag,t.data)}}}])}();(0,n.A)(h,"UNINIT",0),(0,n.A)(h,"CONNECTED",1),(0,n.A)(h,"DISCONNECT",2)},5061:function(e,t,r){r.d(t,{r:function(){return n}});var n={NO_THREAD:0,SELF_THREAD:1}},2614:function(e,t,r){r.d(t,{G1:function(){return b},qK:function(){return h},xm:function(){return A},uB:function(){return y},Eg:function(){return p},tH:function(){return g},np:function(){return _},L:function(){return v}});var n=r(9482),i=r(6687),a=r(7857),o=r(9710),s=r(5061),u=function(e){function t(){return R(this,t),c(this,t)}return f(t,e),D(t,[{key:"TransportListChange",value:function(e,t){}},{key:"TransportStatus",value:function(e,t,r){}},{key:"DataChannelStatus",value:function(e,t){}}])}(o.cS),d=function(e){function t(e){var r;return R(this,t),(r=c(this,t)).transportMap={},r.type=e.type,r.mgr=e,r.channellists=[],r.channelListeners=[],r}return f(t,e),D(t,[{key:"addDataChannel",value:function(e){if(e instanceof i.h){if(-1==this.channellists.findIndex((function(t){return t==e}))){this.channellists.push(e);try{this.mgr.checkTransport(e)}catch(e){console.error("addDataChannel error",e)}this.channelListeners.forEach((function(t){t.DataChannelStatus(e,!0)}))}}else console.error("channel must be a DataChannelWrapper")}},{key:"TransportListChange",value:function(e,t){var r=this.getChannelByTransportType(e.type);if(t&&null!=r&&r.isReady()){var n=r.target_thread||s.r.SELF_THREAD;this.mgr.addTransportForTargetThread(e,n)}t||this.mgr.closeTransportForTargetThread(e),r&&this.channelListeners.forEach((function(n){n.TransportStatus(e,r,t)})),this.channelListeners.forEach((function(r){r.TransportListChange(e,t)}))}},{key:"removeDataChannel",value:function(e){if(e instanceof i.h){var t=this.channellists.indexOf(e);-1!==t&&this.channellists.splice(t,1),this.channelListeners.forEach((function(t){t.DataChannelStatus(e,!1)}))}else console.error("channel must be a DataChannelWrapper")}},{key:"addMediaChannelController",value:function(e){e instanceof u?-1==this.channelListeners.findIndex((function(t){return t==e}))&&this.channelListeners.push(e):console.error("controller must be a MediaChannelController")}},{key:"rmMediaChannelController",value:function(e){var t=this.channelListeners.findIndex((function(t){return t==e}));-1!=t&&this.channelListeners.splice(t,1)}},{key:"getChannelByTransportType",value:function(e){for(var t=0;t<this.channellists.length;t++){var r=this.channellists[t];if(r.isReady()&&r.transportlists.includes(e))return r}return null}},{key:"reinit",value:function(){var e=this,t=this.channellists;this.channellists=[],t.forEach((function(t){t.isReady()&&(t.close(),e.channelListeners.forEach((function(e){e.DataChannelStatus(t,!1)})))}))}}])}(o.cS);(0,a.A)(d,"target",null);var l=r(1758);function h(e){try{var t="undefined"!=typeof DedicatedWorkerGlobalScope;if(o.m3.dataTransportMgr)return;var r=new l.H({type:t?l.H.THREAD_SUB:l.H.THREAD_MAIN,remote:t?self:null});o.m3.dataTransportMgr=r,r.monitorlogfn=e,d.target||(d.target=new d(r),r.addTransportListChangeListener(d.target)),t&&self.addEventListener("message",r._onrecvmainthreadlistener.bind(r))}catch(e){console.error("<<<< InitDataTransportModule",e)}}function p(e,t){try{var r="undefined"!=typeof DedicatedWorkerGlobalScope;if(!o.m3.dataTransportMgr&&!r)return void console.error("not InitDataTransportModule");var n=o.m3.dataTransportMgr;if(t in n.refs)return;var i=n._onrecvsubthreadlistener.bind(n,e);e.addEventListener("message",i);var a={worker:e,type:t,listener:i};n.refs[t]=a,n.checkTransportForThread()}catch(e){console.error("<<<< initTransportWorker",e)}}function v(e){try{var t="undefined"!=typeof DedicatedWorkerGlobalScope;if(!o.m3.dataTransportMgr&&!t)throw new Error("not InitDataTransportModule");var r=o.m3.dataTransportMgr;if(!(e in r.refs))return;var n=r.refs[e],i=n.worker;o.m3.dataTransportMgr.removeTransportByRemote(i),delete r.refs[e],n.worker.removeEventListener("message",n.listener)}catch(e){console.error("<<<< uninitWorker ",e)}}function g(){var e=o.m3.dataTransportMgr;Object.keys(e.refs).forEach((function(t){var r=e.refs[t];delete e.refs[t],r.worker.removeEventListener("message",r.listener)})),e.reinit(),d.target.reinit()}function m(e){return o.m3.dataTransportMgr.getTransportByType(e)}function y(e){if(!o.m3.dataTransportMgr)throw new Error("not InitDataTransportModule");d.target.addDataChannel(e)}function _(e){if(!o.m3.dataTransportMgr)throw new Error("not InitDataTransportModule");d.target.removeDataChannel(e)}var S=function(e){function t(){return R(this,t),c(this,t)}return f(t,e),D(t,[{key:"register",value:function(){if(!o.m3.dataTransportMgr)throw new Error("not InitDataTransportModule");d.target.addMediaChannelController(this)}},{key:"unRegister",value:function(){if(!o.m3.dataTransportMgr)throw new Error("not InitDataTransportModule");d.target.rmMediaChannelController(this)}}])}(u),A=function(e){function t(){return R(this,t),c(this,t)}return f(t,e),D(t,[{key:"TransportStatus",value:function(e,t,r){t&&this.DataChannelStatus(t,!0)}},{key:"DataChannelStatus",value:function(e,t){var r=e,a=e.type;e.transfered||(t||(r=new i.b(e.type,e.transfered)),a==n.Xt.VIDEO&&this.connectVideoSession(r),a==n.Xt.AUDIO&&this.connectAudioSession(r),a===n.Xt.MESH&&this.connectMeshPort(r))}},{key:"connectVideoSession",value:function(e){var t=new o.Vk,r=m(o.vK.VIDEO_NETRTC)||t,n=(null==e?void 0:e.isReady())?o.tE.OPEN:o.tE.CLOSED;r.setStatus(n),e.onmessage((function(e){var t=new Uint8Array(e.data);r.send(t)})),r.onmessage=function(t){e.send(t)}}},{key:"connectAudioSession",value:function(e){var t=new o.Vk,r=m(o.vK.AUDIO_NETRTC)||t,n=e.isReady()?o.tE.OPEN:o.tE.CLOSED;r.setStatus(n),e.onmessage((function(e){var t=new Uint8Array(e.data);r.send(t)})),r.onmessage=function(t){e.send(t)}}},{key:"connectMeshPort",value:function(e){var t=new o.Vk,r=m(o.vK.MESH_NETRTC)||t,n=e.isReady()?o.tE.OPEN:o.tE.CLOSED;r.setStatus(n),e.onmessage((function(e){var t=new Uint8Array(e.data);r.send(t)})),r.onmessage=function(t){e.send(t)}}}])}(S),b=function(e){function t(){var e;return R(this,t),(e=c(this,t)).videodecodeWorker=null,e.sharedecodeWorker=null,e.audiodecodeWorker=null,e.transportLists=[],e}return f(t,e),D(t,[{key:"TransportListChange",value:function(e,t){var r=o.m3.dataTransportMgr;if(e.type==o.vK.MESHBRIDGEAUDIO){var i,a=null===(i=r.refs[n._c.AUDIO_DECODE])||void 0===i?void 0:i.worker;a&&t&&r.addTransportForTargetThread(e,a),t||r.closeTransportForTargetThread(e)}if(e.type==o.vK.VIDEO_ENCODE||e.type==o.vK.VIDEO_DECODE||e.type==o.vK.SHARE_ENCODE||e.type==o.vK.SHARE_DECODE||e.type==o.vK.AUDIO_DECODE||e.type==o.vK.AUDIO_ENCODE||e.type==o.vK.MAUDIO_DECODE||e.type==o.vK.MSHARE_DECODE||e.type==o.vK.MESHBRIDGE){var s,u=null===(s=r.refs[n._c.NET])||void 0===s?void 0:s.worker;u&&t&&r.addTransportForTargetThread(e,u),t||r.closeTransportForTargetThread(e)}}}])}(S)},9710:function(e,t,r){r.d(t,{Eb:function(){return p},Vk:function(){return m},cS:function(){return v},m3:function(){return g},tE:function(){return h},vK:function(){return d}});var n=r(7857),i=r(9549),a=r(4865),o=r(9407),s=r(5061),u=r(1758),d={AUDIO_ENCODE:4,AUDIO_DECODE:5,MAUDIO_DECODE:7,SHARE_ENCODE:8,SHARE_DECODE:9,MSHARE_DECODE:11,VIDEO_ENCODE:12,VIDEO_DECODE:13,AUDIO_NETRTC:64,VIDEO_NETRTC:128,MESH_NETRTC:256,CUSTOME_TYPE:1<<31,MESHBRIDGEAUDIO:1<<31|1,MESHBRIDGE:1<<31|2},l=function(e){},h=function(){function e(){R(this,e),this.onmessage=l,this.status=e.CLOSED,this.onopen=l,this.onclose=l,this.onwer=null}return D(e,[{key:"send",value:function(e){}},{key:"delete",value:function(){this.onmessage=l,this.onopen=l,this.onclose=l,this.close()}},{key:"sendVideo",value:function(e,t){}},{key:"sendWasm",value:function(e){}},{key:"sendCommand",value:function(e){}},{key:"open",value:function(){this.status=e.OPEN,this.onopen()}},{key:"close",value:function(){this.status=e.CLOSED,this.onclose()}},{key:"isReady",value:function(){return!1}}])}();(0,n.A)(h,"OPEN",1),(0,n.A)(h,"CLOSED",2);var p=function(e){function t(){var e;return R(this,t),(e=c(this,t,[{}])).sab={},e.port=null,e.onmessage=l,e.sender=l,e.videoSender=l,e.reciver=l,e.wasmSender=l,e.oncommand=function(e){},e}return f(t,e),D(t,[{key:"sendCommand",value:function(e){var t;null===(t=this.port)||void 0===t||t.postMessage({cmd:o.q3,data:e})}},{key:"send",value:function(e){this.sender(e)}},{key:"sendVideo",value:function(e,t){this.videoSender(e,t)}},{key:"sendWasm",value:function(e){this.wasmSender(e)}},{key:"delete",value:function(){try{var e,t;this.onmessage=l,this.sender=l,this.videoSender=l,this.reciver=l,this.wasmSender=l;var r=((null===(e=this.sab)||void 0===e?void 0:e.reciver)||{}).consumer;null==r||r.setDataCallback(l),null==r||r.cancelConsume(),this.sab={},this.port&&(this.port.onmessage=l),null===(t=this.port)||void 0===t||t.close()}catch(e){}}},{key:"open",value:function(){this.status!=h.OPEN||this.onopen()}},{key:"close",value:function(){this.status=h.CLOSED,this.delete(),this.onclose()}},{key:"_onmessage",value:function(e){var t=e.data,r=t.cmd,n=t.data;switch(r){case o.F4:this.reciver();break;case o.TE:this.onmessage(n,0);break;case o.nl:this.status=n,this.status==h.OPEN?this.onopen():this.onclose();break;case o.q3:this.oncommand(n)}}},{key:"createSendAndReceive",value:function(){var e=this;if(this.port){var t=this.sab,r=t.sender,n=t.reciver,s=r||{},u=s.sabqueue,c=s.interval;u?c?(this.sender=function(e){u.enqueue(e)},this.wasmSender=function(e){u.enqueue(e)},this.videoSender=function(e,t){if(!u.enqueueSafe([e,t],!1)){var r=new Uint8Array(t.length+e.length);r.set(e,0),r.set(t,e.length),u.enqueueSafe(r)}}):(this.sender=function(t){u.enqueue(t),e.port.postMessage({cmd:o.F4})},this.wasmSender=function(t){u.enqueue(t),e.port.postMessage({cmd:o.F4})},this.videoSender=function(t,r){if(!u.enqueueSafe([t,r],!1)){var n=new Uint8Array(r.length+t.length);n.set(t,0),n.set(r,t.length),u.enqueueSafe(n)}e.port.postMessage({cmd:o.F4})}):(this.sender=function(t){e.port.postMessage({cmd:o.TE,data:t},[t.buffer])},this.wasmSender=function(t){var r=new Uint8Array(t.length);r.set(t,0),e.port.postMessage({cmd:o.TE,data:r},[r.buffer])},this.videoSender=function(t,r){var n=new Uint8Array(r.length+t.length);n.set(t,0),n.set(r,t.length),e.port.postMessage({cmd:o.TE,data:n},[n.buffer])});var d=n||{},l=d.sabqueue,h=d.consumer,f=d.useCopy,p=d.interval,v=d.offset;if(h&&(h.cancelConsume(),h=null),l){var m=f?function(t){e.onmessage(t,0)}:v?function(t){e.onmessage(t.uint8s,t.begin)}:function(t){e.onmessage(t.uint8s,0)},_=null,S=g.dataTransportMgr.monitorlogfn;if(p&&S){var A,b=new i.V_({tag:"WCL_M,VDRB"+(null===(A=this.onwer)||void 0===A?void 0:A.type),interval:1e4,reportcallback:y});_=b.timeoutReport.bind(b)}h=new a.l8(l,m,_),n.consumer=h,p?h.consume(p,f):this.reciver=function(){h.consumeAll(f)}}}}},{key:"setMsgPort",value:function(e){e!=this.port&&(this.port&&(this.port.onmessage=l,this.port.close(),this.port=null),this.port=e,this.port&&(this._listeners||(this._listeners=this._onmessage.bind(this)),this.port.onmessage=this._listeners,this.createSendAndReceive()))}},{key:"setSabBuffer",value:function(e,t){if(null!=e&&e.sab){var r=e.sab,n=e.useCopy,i=e.interval,o=e.offset,s=e.length,u=e.useOneElement,c=new a.N6(o>0?r.buffer:r,void 0,void 0,!!u,o,s,o>0?r:null);this.sab.sender={sabqueue:c,interval:i,useCopy:n,offset:o}}if(null!=t&&t.sab){var d,l=t.sab,h=t.useCopy,f=t.interval,p=t.offset,v=t.length,g=t.useOneElement,m=new a.N6(p>0?l.buffer:l,void 0,void 0,!!g,p,v,p>0?l:null),y=((null===(d=this.sab)||void 0===d?void 0:d.reciver)||{}).consumer;y&&(y.cancelConsume(),this.sab.reciver.consumer=null,this.sab.reciver.sabqueue=null),this.sab.reciver={sabqueue:m,interval:f,useCopy:h,offset:p}}this.createSendAndReceive()}},{key:"setStatus",value:function(e){this.port?this.status!=e&&(this.status=e,this.port.postMessage({cmd:o.nl,data:e})):console.error("MsgQueueSocket not initialized")}}])}(h),v=D((function e(){R(this,e)}),[{key:"TransportListChange",value:function(e,t){}}]),g=function(){function e(t){R(this,e),this.onmessage=l,this.onopen=l,this.onclose=l,this.oncommand=l,this.type=t.type,this.id=t.id||Math.floor(performance.now())<<10|t.type,this.sock=t.sock||new h,this.mgr=t.mgr,this.sock.onmessage=this._onmessage.bind(this),this.sock.onclose=this._onclose.bind(this),this.sock.onopen=this._onopen.bind(this),this.sock.oncommand=this._oncommand.bind(this),this.sock.onwer=this,this.remote=t.remote,this.sabInfo=null,this.portInfo=null,this.target_thread=s.r.NO_THREAD,this.local=!!t.local,this.args=t.args,this._create()}return D(e,[{key:"_create",value:function(){var t=e.dataTransportMgr;t.createTransport(this),!this.local&&t&&t.mainThread&&t.type==u.H.THREAD_SUB&&t.createRemoteTransportRPC(this,t.mainThread)}},{key:"_close",value:function(){var t=e.dataTransportMgr,r=t.transportIsExit(this);!this.local&&r&&t.type==u.H.THREAD_SUB&&t.closeRemoteTransportRPC(this,t.mainThread),r&&t.closeTransport(this)}},{key:"_oncommand",value:function(e){this.oncommand(e)}},{key:"_onmessage",value:function(e,t){this.onmessage(e,t)}},{key:"_onclose",value:function(){this.onclose()}},{key:"_onopen",value:function(){this.onopen()}},{key:"isReady",value:function(){return!0}},{key:"send",value:function(e){this.sock.send(e)}},{key:"sendCommand",value:function(e){this.sock.sendCommand(e)}},{key:"sendVideo",value:function(e,t){this.sock.sendVideo(e,t)}},{key:"sendWasmData",value:function(e){this.sock.sendWasm(e)}},{key:"setSocket",value:function(e){var t=this.sock;this.sock=e,this.sock&&(this.sock.onwer=this,this.sock.onmessage=this._onmessage.bind(this),this.sock.onclose=this._onclose.bind(this),this.sock.onopen=this._onopen.bind(this)),t&&t.delete()}},{key:"open",value:function(){this.sock.open()}},{key:"close",value:function(){this._close(),this.sock.close()}},{key:"setMsgPort",value:function(e){if(!(this.sock instanceof p))throw new Error("tansport sock is not a MsgQueueSocket");this.sock.setMsgPort(e)}},{key:"setSabBuffer",value:function(e,t){if(!(this.sock instanceof p))throw new Error("tansport sock is not a MsgQueueSocket");this.sock.setSabBuffer(e,t)}},{key:"setStatus",value:function(e){this.sock instanceof p&&this.sock.setStatus(e)}}])}();(0,n.A)(g,"UDP",0),(0,n.A)(g,"TCP",1),(0,n.A)(g,"RLB_UDP",2),(0,n.A)(g,"dataTransportMgr",null);var m=D((function e(t){R(this,e),this.sock=null,this.onmessage=l}),[{key:"isReady",value:function(){return!1}},{key:"send",value:function(){}},{key:"sendVideo",value:function(){}},{key:"sendCommand",value:function(){}},{key:"setStatus",value:function(e){}}]);function y(e,t,r,n){var i;null===(i=u.H.monitorlogfn)||void 0===i||i.call(u.H,e,"".concat(t,",").concat(r,",").concat(n))}},1758:function(e,t,r){r.d(t,{H:function(){return s}});var n=r(7857),i=r(9407),a=r(9710),o=r(5061),s=function(){function e(t){R(this,e);var r=t||{};this.type=r.type||e.THREAD_MAIN,this.refs={},this.transportlists=[],this.mainThread=r.remote,this.subthreadlistner=null,this.transportListeners=[],this.onRemoteTransportFn=function(){}}return D(e,[{key:"_onrecvmainthreadlistener",value:function(e){var t=e.data,r=t.cmd,n=t.transportId,o=t.data,s=this.transportlists.find((function(e){return e.id===n}));if(s||r==i.rl)switch(r){case i.rl:this.addRemoteTransport(e.data,null);break;case i.SK:s.setMsgPort(o||new a.Vk);break;case i.DT:s.setSabBuffer(e.data.sender,e.data.reciver);break;case i.tO:s.remote=null,this.removeTransport(s)}}},{key:"_onrecvsubthreadlistener",value:function(e,t){var r=t.data,n=r.cmd,a=r.transportId,o=this.transportlists.find((function(e){return e.id===a}));switch(n){case i.rl:this.addRemoteTransport(t.data,e);break;case i.DT:this.setSabBufferInfo(o,t.data.sender,t.data.reciver);break;case i.tO:o.remote==e&&(o.remote=null),this.removeTransport(o)}}},{key:"createTransport",value:function(e){var t=this;this.transportlists.push(e),setTimeout((function(){t.transportListeners.forEach((function(t){t.TransportListChange(e,!0)}))}),0)}},{key:"transportIsExit",value:function(e){return-1!=this.transportlists.indexOf(e)}},{key:"closeTransport",value:function(e){var t=this,r=this.transportlists.indexOf(e);return-1!=r&&(this.transportlists.splice(r,1),setTimeout((function(){t.transportListeners.forEach((function(t){t.TransportListChange(e,!1)}))}),0),!0)}},{key:"createRemoteTransportRPC",value:function(e,t){var r={cmd:i.rl,transportType:e.type,transportId:e.id};e.portInfo?(r.port=e.portInfo,t.postMessage(r,[e.portInfo])):t.postMessage(r)}},{key:"closeRemoteTransportRPC",value:function(e,t){t.postMessage({cmd:i.tO,transportType:e.type,transportId:e.id})}},{key:"setRemoteTransportSABBUfferRPC",value:function(e,t){var r,n,a,o;(null!==(r=e.sabInfo)&&void 0!==r&&r.sender||null!==(n=e.sabInfo)&&void 0!==n&&n.reciver)&&t.postMessage({cmd:i.DT,transportId:e.id,sender:null===(a=e.sabInfo)||void 0===a?void 0:a.sender,reciver:null===(o=e.sabInfo)||void 0===o?void 0:o.reciver})}},{key:"addRemoteTransport",value:function(e,t){var r,n=e.transportId,i=e.port,a=e.transportType,o=this.createMsgSocketTransport(a,n);o.id=n,o.remote=t,o.portInfo=i,i?o.setMsgPort(o.portInfo):this.bindMessageChannel(o),i&&(null===(r=this.onRemoteTransportFn)||void 0===r||r.call(this,o))}},{key:"removeTransport",value:function(e){-1!=this.transportlists.indexOf(e)&&(this.closeTransport(e),e.close(),e.remote&&this.closeRemoteTransportRPC(e,e.remote),this.closeTransportForTargetThread(e))}},{key:"createMsgSocketTransport",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new a.m3({mgr:this,sock:new a.Eb,type:e,local:!0,id:t})}},{key:"bindMessageChannel",value:function(t){if(this.type==e.THREAD_MAIN){var r=new MessageChannel;t.portInfo=r.port1,t.remote.postMessage({cmd:i.SK,transportId:t.id,data:r.port2},[r.port2])}else console.error("error this call only in main thread")}},{key:"setSabBufferInfo",value:function(t,r,n){this.type==e.THREAD_MAIN&&(t.sabInfo||(t.sabInfo={}),n&&(n.useCopy=!0),r&&(r.useCopy=!0),t.sabInfo={sender:r,reciver:n},t.target_thread!=o.r.NO_THREAD&&(t.target_thread!=o.r.SELF_THREAD?this.setRemoteTransportSABBUfferRPC(t,t.target_thread):t.setSabBuffer(r,n)))}},{key:"removeTransportByRemote",value:function(e){for(var t=[],r=0;r<this.transportlists.length;r++){var n=this.transportlists[r];n.remote===e&&t.push(n)}for(var i=0;i<t.length;i++)this.removeTransport(t[i])}},{key:"reinit",value:function(){for(var e=y(this.transportlists),t=0;t<e.length;t++)this.removeTransport(e[t])}},{key:"getTransportByType",value:function(e){for(var t in this.transportlists){var r=this.transportlists[t],n=r.target_thread==o.r.SELF_THREAD;if(r.type==e&&n)return r}return null}},{key:"addTransportListChangeListener",value:function(e){-1==this.transportListeners.indexOf(e)&&this.transportListeners.push(e)}},{key:"remoteTransportListChangeListener",value:function(e){var t=this.transportListeners.indexOf(e);-1!=t&&this.transportListeners.splice(t,1)}},{key:"checkTransport",value:function(e){var t=this;this.transportlists.forEach((function(r){if(e.transportlists.includes(r.type)){var n=e.target_thread||o.r.SELF_THREAD;t.addTransportForTargetThread(r,n)}}))}},{key:"checkTransportForThread",value:function(){var e=this;setTimeout((function(){e.transportlists.forEach((function(t){e.transportListeners.forEach((function(e){e.TransportListChange(t,!0)}))}))}),0)}},{key:"addTransportForTargetThread",value:function(t,r){var n,i,a,s,u=r;t.target_thread!=u&&u!=o.r.NO_THREAD&&(this.type==e.THREAD_MAIN&&t.target_thread!=o.r.NO_THREAD&&t.target_thread!=u&&(this.closeTransportForTargetThread(t),this.bindMessageChannel(t)),t.target_thread=u,u!=o.r.SELF_THREAD?(this.createRemoteTransportRPC(t,u),this.setRemoteTransportSABBUfferRPC(t,u)):(t.portInfo&&t.setMsgPort(t.portInfo),(null!==(n=t.sabInfo)&&void 0!==n&&n.sender||null!==(i=t.sabInfo)&&void 0!==i&&i.reciver)&&t.setSabBuffer(null===(a=t.sabInfo)||void 0===a?void 0:a.sender,null===(s=t.sabInfo)||void 0===s?void 0:s.reciver)))}},{key:"closeTransportForTargetThread",value:function(t){t.target_thread!=o.r.NO_THREAD&&t.target_thread!=o.r.SELF_THREAD&&this.type==e.THREAD_MAIN&&this.closeRemoteTransportRPC(t,t.target_thread),t.target_thread=o.r.NO_THREAD}}])}();(0,n.A)(s,"THREAD_MAIN",1),(0,n.A)(s,"THREAD_SUB",2)},3404:function(e,t,r){r.d(t,{Y:function(){return u},q:function(){return c}});var n=r(2710),i=r(5408),a="audioBridge",o=D((function e(t){R(this,e),this.version=t}),[{key:"getWebRTCConnectivityResult",value:function(){var e=c.get("".concat(this.version,"Connectivity"))||{},t=e.time;return!1!==e.result?{time:t,result:!0}:{time:t,result:!1}}},{key:"updateWebRTCConnectivityResult",value:function(e){var t=Date.now();c.set("".concat(this.version,"Connectivity"),{time:t,result:e})}},{key:"checkWebRTCConnectivity",value:function(e,t){var r=this.getWebRTCConnectivityResult(),n=r.time,i=void 0===n?0:n,o=r.result;void 0===o||o||Date.now()-i<864e5||(this.version===a?this.checkAudioBridgeConnectivity(e,t):this.checkWMSCConnectivity(e,t))}},{key:"checkAudioBridgeConnectivity",value:function(){var e=H(O().mark((function e(t,n){var i,a,o,s,u,c=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.rwgHost,a=t.cid,o=t.abToken,s="wss://".concat(i,"/ab/signal?rwg=").concat(i,"&cid=").concat(a),e.next=4,Promise.resolve().then(r.bind(r,4666));case 4:u=e.sent.default,this.webrtcInstance=new u(a,s,!1,!1,!1,void 0,(function(e,t){var r;"updateConnectionResult"===e&&(c.updateWebRTCConnectivityResult(t),null===(r=c.webrtcInstance)||void 0===r||r.destroy(),c.webrtcInstance=null)}),!0),this.webrtcInstance.setIceServers(n),this.webrtcInstance.join(!1,o);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"checkWMSCConnectivity",value:function(){var e=H(O().mark((function e(t,i){var a,o,s,u,c,d,l=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.rwgHost,o=t.cid,s=t.meetingNumber,e.next=3,r.e(557).then(r.bind(r,90));case 3:u=e.sent,c=u.WMSCManager,d="wss://".concat(a,"/wc/media/").concat(s,"?type=v&cid=").concat(o,"&mode=16&prob=1"),this.webrtcInstance=new c({webRTCWebSocketUrl:d,confId:o,nodeId:0,hdVideoEnabled:!1,mediaStreamController:void 0,iceServers:i,videoCodecConfig:void 0,webrtcMode:n.h|n.Q9,requestHandler:function(e,t){l.updateWebRTCConnectivityResult(t),l.webrtcInstance.destroy(),l.webrtcInstance=null},probe:!0});case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),s=D((function e(t){R(this,e),this.mediaType=t}),[{key:"getInfo",value:function(){try{return JSON.parse(localStorage.getItem("webcodec".concat(this.mediaType)))||{}}catch(e){return{}}}},{key:"updateInfo",value:function(e,t){try{var r=this.getInfo(),n=r.usedcount||{failed:0,total:0},a=n.failed,o=n.total,s=r.usedtime||{avgusedtime:0,usedmaxtime:0},u=s.avgusedtime,c=s.usedmaxtime,d=r.ratio||{avgratio:0,maxratio:0},l=d.avgratio,h=d.maxratio,f=(r.delay||{avgdelay:0}).avgdelay;e.failed&&(a++,u=(3*u+e.elapsed)/4,c=e.elapsed>c?e.elapsed:c,r.usedtime=Object.assign(r.usedtime||{},{usedmaxtime:c,avgusedtime:u})),e.elapsed>31e3&&e.failed||o++,r.usedcount=Object.assign(r.usedcount||{},{failed:a,total:o}),e.outputIndex>3&&(f=(3*f+e.avgDelay)/4,r.delay=Object.assign(r.delay||{},{avgdelay:f})),e.inputIndex>5&&(l=(3*l+e.ratio)/4,h=e.ratio>h?e.ratio:h,r.ratio=Object.assign(r.ratio||{},{avgratio:l,maxratio:h}));var p=t.osVersion,v=t.browserVersion,g=t.sdkVersion;r.version={osVersion:p,browserVersion:v,sdbversion:g},localStorage.setItem("webcodec".concat(this.mediaType),JSON.stringify(r))}catch(e){i.Ay.error("<<< update localStorage error",e)}}}]),u=D((function e(){R(this,e),this.audioBridgeConnectivityInfo=new o(a),this.WMSCConnectivityInfo=new o("wmsc"),this.videoEncoderInfo=new s("videoencode"),this.videoDecoderInfo=new s("videodecode")}),[{key:"getAudioBridgeConnectivityInfo",value:function(){return this.audioBridgeConnectivityInfo}},{key:"getWMSCConnectivityInfo",value:function(){return this.WMSCConnectivityInfo}},{key:"getVideoEncoderInfo",value:function(){return this.videoEncoderInfo}},{key:"getVideoDecoderInfo",value:function(){return this.videoDecoderInfo}}]),c=D((function e(){R(this,e)}),null,[{key:"set",value:function(e,t){try{var r=JSON.stringify(t);localStorage.setItem(e,r)}catch(e){console.error("Failed to set localStorage:",e)}}},{key:"get",value:function(e){try{var t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(e){return console.error("Failed to get localStorage:",e),null}}},{key:"remove",value:function(e){localStorage.removeItem(e)}},{key:"clear",value:function(){localStorage.clear()}},{key:"has",value:function(e){return null!==localStorage.getItem(e)}}])},5740:function(e,t,r){r.d(t,{A:function(){return s}});var n=r(3224),i=r(2193),a=n;r.n(i)()(n)&&(a=window.PubSub);var o=function(){};o.prototype={publish:function(){return a.publish.apply(this,arguments)},publishSync:function(){return a.publishSync.apply(this,arguments)},trigger:function(){return this.publish.apply(this,arguments)},triggerSync:function(){return this.publishSync.apply(this,arguments)},emit:function(){return this.publish.apply(this,arguments)},subscribe:function(){return a.subscribe.apply(this,arguments)},on:function(){return this.subscribe.apply(this,arguments)},unsubscribe:function(){return a.unsubscribe.apply(this,arguments)},clearAllSubscriptions:function(){a.clearAllSubscriptions()}};var s=new o},456:function(e,t,r){function n(){this.a=[],this.b=0,this.residue=null}r.d(t,{A:function(){return i}}),n.prototype.getLength=function(){return this.a.length-this.b},n.prototype.isEmpty=function(){return 0==this.a.length},n.prototype.enqueue=function(e){this.a.push(e)},n.prototype.dequeue=function(){if(0!=this.a.length){var e=this.a[this.b];return 2*++this.b>=this.a.length&&(this.a=this.a.slice(this.b),this.b=0),e}return null},n.prototype.peek=function(){return 0<this.a.length?this.a[this.b]:void 0},n.prototype.clear=function(){this.a=[],this.b=0};var i=n},9407:function(e,t,r){r.d(t,{$E:function(){return _},$U:function(){return we},$x:function(){return H},AC:function(){return B},AP:function(){return Ye},Ah:function(){return ae},Bi:function(){return w},Bm:function(){return R},Cm:function(){return ne},D1:function(){return ie},DT:function(){return ye},F4:function(){return he},Fb:function(){return g},Gg:function(){return Pe},H4:function(){return se},HL:function(){return K},HX:function(){return Ne},I:function(){return h},Ji:function(){return v},Jj:function(){return De},Jo:function(){return oe},Jw:function(){return a},KA:function(){return Re},KE:function(){return We},Ke:function(){return Ve},LG:function(){return A},Lm:function(){return de},M9:function(){return Ge},NO:function(){return Xe},Os:function(){return Ae},Pp:function(){return Oe},QT:function(){return Se},Qt:function(){return Qe},Rk:function(){return x},Rm:function(){return L},Rw:function(){return f},SG:function(){return N},SK:function(){return _e},Sh:function(){return j},T:function(){return G},TE:function(){return le},TK:function(){return xe},Tf:function(){return Ke},U2:function(){return Te},UG:function(){return re},Ub:function(){return Z},V_:function(){return je},Vd:function(){return $},Wr:function(){return T},Xd:function(){return D},Xg:function(){return E},Xk:function(){return Q},Y:function(){return ee},YQ:function(){return b},YS:function(){return J},Yx:function(){return ve},Zc:function(){return P},Zk:function(){return ce},_0:function(){return $e},_Q:function(){return V},aY:function(){return He},av:function(){return I},b5:function(){return O},bC:function(){return Fe},bq:function(){return m},c:function(){return o},dh:function(){return d},ef:function(){return C},ex:function(){return n},f9:function(){return X},hA:function(){return F},hG:function(){return ue},hd:function(){return qe},hz:function(){return Ce},iU:function(){return u},jA:function(){return ze},l6:function(){return l},lN:function(){return s},my:function(){return i},nl:function(){return fe},oU:function(){return Le},pJ:function(){return Be},q3:function(){return pe},qi:function(){return ke},rl:function(){return me},s6:function(){return c},s8:function(){return Me},sY:function(){return Y},sv:function(){return S},tO:function(){return ge},ty:function(){return M},uL:function(){return Ee},uP:function(){return Ue},uf:function(){return U},v7:function(){return Ie},vP:function(){return q},vr:function(){return y},wQ:function(){return k},wo:function(){return be},x8:function(){return W},xD:function(){return z},xQ:function(){return te},yC:function(){return Je},zS:function(){return p}});var n=1,i=2,a=3,o=4,s=7,u=8,c=9,d=10,l=11,h=12,f=14,p=15,v=16,g=18,m=20,y=21,_=22,S=23,A=24,b=26,E=27,k=30,C=31,w=35,T=36,R=37,I=38,D=42,M=47,O=48,x=50,P=51,L=52,N=53,V=56,U=57,F=60,B=61,W=62,G=66.5,H=66.6,j=67,K=68,z=69,q=71,Y=72,X=73,Q=75,J=76,$=78,Z=105,ee=106,te=107,re=108,ne=109,ie=120,ae=121,oe=122,se=123,ue=124,ce=125,de=126,le=127,he=128,fe=129,pe=130,ve=131,ge=132,me=133,ye=135,_e=136,Se=137,Ae=138,be=139,Ee=151,ke=171,Ce=194,we=199,Te=200,Re=201,Ie=-1,De=-2,Me=-3,Oe=-4,xe=-5,Pe=-7,Le=-8,Ne=-9,Ve=-10,Ue=-11,Fe=-12,Be=-14,We=-15,Ge=-23,He=-26,je=-27,Ke=-28,ze=-35,qe=-129,Ye=-130,Xe=-131,Qe=-135,Je=49,$e=79},2737:function(e){function t(t,r,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,r){r.d(t,{i1:function(){return oe},cY:function(){return J},XF:function(){return z},gP:function(){return $},Yu:function(){return me},uF:function(){return K},SI:function(){return ae},qs:function(){return ie},zV:function(){return ne},I4:function(){return V},jo:function(){return ce},gd:function(){return Y},Bw:function(){return q},Gj:function(){return he},bD:function(){return ee},Ay:function(){return Q},kA:function(){return re},B0:function(){return Se},OC:function(){return ye},DR:function(){return te},Az:function(){return _e},uE:function(){return se},Tv:function(){return le},e5:function(){return ue},iD:function(){return de},h:function(){return fe},SE:function(){return Z},Sq:function(){return ge}});var n,i,a=r(7857),o=r(6984),s=r.n(o),u=(r(7855),r(7201)),c=r.n(u),d=r(7243),l=r(3578),h=r(5408),f=r(9109),p=r(14),g=r(7080),m=function(e,t,r,n){return new(r||(r=Promise))((function(t,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,o)}s((n=n.apply(e,[])).next())}))},y=new(D((function e(){var t=this;R(this,e),this.sentinel=null,this.isSupport=function(){return"wakeLock"in navigator&&"request"in navigator.wakeLock},this.requestWakeLock=function(){return m(t,0,void 0,O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isSupport()){e.next=13;break}if(!this.sentinel||this.sentinel.released){e.next=5;break}e.t1=Promise.reject("wakeLock has requested"),e.next=10;break;case 5:return e.next=7,this.release();case 7:document.addEventListener("visibilitychange",this.handleVisibilityChange),document.addEventListener("fullscreenchange",this.handleVisibilityChange),e.t1=this.initWakeLock();case 10:e.t0=e.t1,e.next=14;break;case 13:e.t0=Promise.reject("wakeLock API not available");case 14:return e.abrupt("return",e.t0);case 15:case"end":return e.stop()}}),e,this)})))},this.release=function(){return m(t,0,void 0,O().mark((function e(){var t=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.isSupport()?this.sentinel?(document.removeEventListener("visibilitychange",this.handleVisibilityChange),document.removeEventListener("fullscreenchange",this.handleVisibilityChange),this.sentinel.release().then((function(){return t.sentinel=null,"WakeLock release success"})).catch((function(e){return h.Ay.error("Error WakeLock release:",e),e}))):"WakeLock not exist":"wakeLock API not available");case 1:case"end":return e.stop()}}),e,this)})))},this.handleVisibilityChange=function(){"visible"===document.visibilityState&&(!t.sentinel||t.sentinel&&t.sentinel.released)&&(t.sentinel=null,t.initWakeLock())},this.initWakeLock=function(){return m(t,0,void 0,O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.wakeLock.request("screen");case 3:return this.sentinel=e.sent,e.abrupt("return",this.sentinel);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",(h.Ay.error("Error WakeLock request:",e.t0),Promise.reject(e.t0)));case 10:case"end":return e.stop()}}),e,this,[[0,7]])})))}}))),S=r(5090),A=r(3404),b=r(5830),E=r(2484);(i=n||(n={})).WEBASSEMBLY="wasm_audio",i.WEBRTC_AUDIO_1="webrtc_audio_1.0",i.WEBRTC_AUDIO_2="webrtc_audio_2.0";var k=r(8935),C=r(9470),w=r(9415);function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach((function(t){(0,a.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var M,x={},P=!1,L=!1,N=(0,C.cO)(),V=new(D((function e(){R(this,e),this._isSupportMultiThread=!1,this._isSupportSIMD=!1,this.inProgressPromise={checkSupportMultiThread:null,checkSupportSIMD:null},this._isSupportWebtransport=!1,this._isSupportVirtualBackground=!1}),[{key:"checkIsSupportMultiThread",value:function(){var e=H(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.getIsSupportMultiThread()){e.next=18;break}if(e.prev=1,!this.inProgressPromise.checkSupportMultiThread){e.next=7;break}return e.next=5,this.inProgressPromise.checkSupportMultiThread;case 5:e.next=13;break;case 7:return this.inProgressPromise.checkSupportMultiThread=d.A.threads(),e.t0=this,e.next=11,this.inProgressPromise.checkSupportMultiThread;case 11:e.t1=e.sent,e.t0._setIsSupportMultiThread.call(e.t0,e.t1);case 13:e.next=18;break;case 15:e.prev=15,e.t2=e.catch(1),this._setIsSupportMultiThread(!1);case 18:case"end":return e.stop()}}),e,this,[[1,15]])})));return function(){return e.apply(this,arguments)}}()},{key:"_setIsSupportMultiThread",value:function(e){this._isSupportMultiThread=e}},{key:"getIsSupportMultiThread",value:function(){return this._isSupportMultiThread}},{key:"checkIsSupportSIMD",value:function(){var e=H(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.getIsSupportSIMD()){e.next=18;break}if(e.prev=1,!this.inProgressPromise.checkSupportSIMD){e.next=7;break}return e.next=5,this.inProgressPromise.checkSupportSIMD;case 5:e.next=13;break;case 7:return this.inProgressPromise.checkSupportSIMD=d.A.simd(),e.t0=this,e.next=11,this.inProgressPromise.checkSupportSIMD;case 11:e.t1=e.sent,e.t0._setIsSupportSIMD.call(e.t0,e.t1);case 13:e.next=18;break;case 15:e.prev=15,e.t2=e.catch(1),this._setIsSupportSIMD(!1);case 18:case"end":return e.stop()}}),e,this,[[1,15]])})));return function(){return e.apply(this,arguments)}}()},{key:"_setIsSupportSIMD",value:function(e){this._isSupportSIMD=e}},{key:"getIsSupportSIMD",value:function(){return this._isSupportSIMD}},{key:"getIsSupportWebtransport",value:function(){return(0,C.LZ)(97)&&"function"==typeof WebTransport&&this._isSupportWebtransport}},{key:"setIsSupportWebtransport",value:function(e){this._isSupportWebtransport=!!e}},{key:"getIsSupportVirtualBackground",value:function(){var e=(0,C.LZ)(91)||(0,C.i$)(89)||(0,C.b2)(17.4);return navigator.hardwareConcurrency&&navigator.hardwareConcurrency>2&&e&&"function"==typeof OffscreenCanvas&&this._isSupportVirtualBackground}},{key:"setIsSupportVirtualBackground",value:function(e){this._isSupportVirtualBackground=!!e}},{key:"getIsRenderSelfVideoInEncodeWorker",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!f.A.enableMultiDecodeVideoWithoutSAB&&e&&!this.getIsSupportMultiThread()&&this.getIsSupportVirtualBackground()}}])),U={capacity:void 0,capacity1080:!0,get capacityfor720(){return void 0!==this.capacity&&this.capacity},set capacityfor720(e){this.capacity=e}},F={capacitydeco:void 0,get capacitydecofor1080(){return void 0!==this.capacitydeco&&this.capacitydeco},set capacitydecofor1080(e){this.capacitydeco=e}},B=function(){var e={vendor:"",renderInfo:"",isAstcSupported:!1,isWebGLContextInvalid:!0};try{var t=document.createElement("canvas");t||h.Ay.error("Error: document.createElement return a null canvas!");var r=t.getContext("webgl")||t.getContext("moz-webgl")||t.getContext("webkit-3d")||t.getContext("experimental-webgl");if(!r){var n="Error: canvas.getContext fail, context:".concat(r,", lost:").concat(null==r?void 0:r.isContextLost(),", size:(").concat(t.width,",").concat(t.height,")");h.Ay.error(n)}if(r){var i,a,o,s,u;if(e.isWebGLContextInvalid=!1,r.isContextLost()){var c="Error: webgl context is lost, canvas(".concat(t.width,",").concat(t.height,")!");h.Ay.error(c)}if("firefox"===N.browser?(s=r.getParameter(r.RENDERER),u=r.getParameter(r.VENDOR)):(o=r.getExtension("WEBGL_debug_renderer_info"),s=r.getParameter(o.UNMASKED_RENDERER_WEBGL),u=r.getParameter(o.UNMASKED_VENDOR_WEBGL)),e.renderInfo=null===(i=s)||void 0===i?void 0:i.toLowerCase(),e.vendor=null===(a=u)||void 0===a?void 0:a.toLowerCase(),e.isAstcSupported=-1!==r.getSupportedExtensions().indexOf("WEBGL_compressed_texture_astc"),""==u){var d="Error: vendor is null, debug:".concat(o,", render:").concat(o.UNMASKED_RENDERER_WEBGL,", vendor:").concat(o.UNMASKED_VENDOR_WEBGL,", contextLost:").concat(r.isContextLost(),"!");h.Ay.error(d)}}}catch(e){h.Ay.error("Error while get webgl context:",e)}return e}(),W=function(){if("function"!=typeof OffscreenCanvas)return!1;var e={isSupportWebgl:!1,isSupportWebgl2:!1};try{var t=new OffscreenCanvas(1,1);(t.getContext("webgl")||t.getContext("experimental-webgl")||t.getContext("moz-webgl")||t.getContext("webkit-3d"))&&(e.isSupportWebgl=!0)}catch(e){h.Ay.error("Error while get webglcontext:",e)}try{e.isSupportWebgl&&new OffscreenCanvas(1,1).getContext("webgl2")&&(e.isSupportWebgl2=!0)}catch(e){h.Ay.error("Error while get webglcontext2:",e)}return e}(),G=function(){var e=Object.assign({},W,B);return e.cpu=navigator.hardwareConcurrency?navigator.hardwareConcurrency:0,e.VE=0,e.SE=0,e.VD=0,e.SD=0,e.SAB="undefined"!=typeof SharedArrayBuffer,e.errorMessage=null,e.visibility=!0,e.unvisibilitycount=0,e.time=0,e}();function K(){return W.isSupportWebgl}function z(e){return e?e>>10<<10:-1}function q(){return Y("Main",X.getAudioContextConfigure())}function Y(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"function"!=typeof AudioContext?(h.Ay.error("Not Support AudioContext"),null):(h.Ay.log("Creating ".concat(e," AudioContext")),(t=r?new AudioContext(r):new AudioContext).onstatechange=function(){h.Ay.log("".concat(e," AudioContext state changed to ").concat(t.state)),g.A.add_monitor("ACSC:".concat(e,":").concat(t.state))},t.onsinkchange=function(){"object"==j(t.sinkId)&&"none"===t.sinkId.type?h.Ay.log("".concat(e," AudioContext - Audio changed to not play on any device")):h.Ay.log("".concat(e," AudioContext - Audio output device changed to ").concat(t.sinkId))},t)}var X={initAsyncJob:function(){var e=this;return H(O().mark((function t(){var r,n,i,a,o;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,k.U4)();case 3:return o=t.sent,h.Ay.directReport("enableUAHelperHighAccurate success: ".concat(JSON.stringify(o))),g.A.add_monitor("UAHD:".concat(de(JSON.stringify(o)))),e.browserEngine={name:null==o||null===(r=o.engine)||void 0===r?void 0:r.name,version:null==o||null===(n=o.engine)||void 0===n?void 0:n.version,isBlink:"Blink"===(null==o||null===(i=o.engine)||void 0===i?void 0:i.name),isWebkit:"WebKit"===(null==o||null===(a=o.engine)||void 0===a?void 0:a.name)},N=(0,C.cO)(),t.next=10,V.checkIsSupportMultiThread();case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),h.Ay.error("enableUAHelperHighAccurate fail: ".concat(t.t0.name,":").concat(t.t0.message));case 15:return t.next=17,e.is32bitChrome();case 17:if(L=!!t.sent,t.prev=18,!(0,k.Zs)()){t.next=25;break}return t.next=22,e.getBandWidth();case 22:t.t1=t.sent,t.next=26;break;case 25:t.t1=null;case 26:M=t.t1,t.next=32;break;case 29:t.prev=29,t.t2=t.catch(18),M=null;case 32:case"end":return t.stop()}}),t,null,[[0,12],[18,29]])})))()},getOSInfo:function(){return(0,C.PF)()},getGpuInfo:function(){return B},isUsingSwiftShader:function(){return/SwiftShader/i.test(X.getGpuInfo().renderInfo)},isAndroidIntegrationWithSAB:function(){return((0,k.vb)()||(0,k.GY)())&&"undefined"!=typeof SharedArrayBuffer},browserType:N,browser:{isFirefox:"firefox"===N.browser,isChromeOrEdge:"chrome"===N.browser||"edge"===N.browser,isSafari:"safari"===N.browser},browserEngine:{name:"",version:"",isBlink:!1,isWebkit:!1},isChromiumVersionHigherThan:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:90;return(0,C.LZ)(e)||this.browserEngine.isBlink&&(0,k.D$)(this.browserEngine.version,String(e))},isAppleBrowserVersionHigherThan:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"17.5";if(!this.browserEngine.isWebkit)return!1;if((0,k.nr)())return this.isSafariVersionHigherThan(e);var t=(0,C.PF)().osVersion,r=void 0===t?"":t;return(0,k.D$)(r,e)},isIphoneOrIpadSafari:function(){return this.isIphoneOrIpadBrowser()||this.isIpadOS()},isOpera65:function(){try{var e=navigator.userAgent.match(/OPR\/(\d+)\./);return!!(e&&Number(e[1])<66)}catch(e){return!1}},isOperaVersionHigherThan:function(e){try{var t=navigator.userAgent.match(/OPR\/(\d+)\./);return!!(t&&Number(t[1])>=e)}catch(e){return!1}},isOpera:k.GQ,isAndroidBrowser:function(){return(0,k.GN)()},isAndroidVersionLessEqual:function(e){var t=(0,C.PF)().osVersion,r=void 0===t?"":t;if(!this.isAndroidBrowser()||!r)return!1;var n=r.toString().split(".");return parseInt(n[0])<=e},isQuestBrowser:k.Z_,isMacIntelSafari:k.Qf,isMacIntelChrome:k.gi,isIphoneBrowser:k.uw,isIphoneOrIpadBrowser:k.n_,isIpadOS:k.zG,isIpadOSNew:function(){return navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&(/iPad/.test(navigator.platform)||/MacIntel/.test(navigator.platform)||/Intel Mac/.test(navigator.platform))},isChromeOS:k.Zs,isWindowsChrome:k.Y9,isTeslaMode:k.bw,isMac:k.cX,isWindows:k.uF,isLinux:k.j9,isMTRAndroid:k.vb,isGoogleMeetAndroid:k.GY,isMTRWindows:k.pb,is32bitChrome:k.R_,isChromeVersionHigherThan:C.LZ,isFirefoxVersionHigherThan:C.i$,isSafariVersionHigherThan:C.b2,getBrowserVersion:C.JF,isMobileDevice:k.Xb,isSupport2DCanvasDrawFrame:function(){return"function"==typeof MediaStreamTrackProcessor&&this.browser.isChromeOrEdge&&N.version>=104&&-1==navigator.appVersion.indexOf("Mac")},checkLocalP2PConnection:function(){return new Promise(function(){var e=H(O().mark((function e(t,r){var n,i,a,o,s,u,c,d;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=function(e){e&&e.close()},n=function(e){return new Promise((function(t,r){e.onconnectionstatechange=function(r){"connected"===e.connectionState&&t(!0)}}))},s=null,u=null,c=document.createElement("canvas"),e.prev=3,c.width=200,c.height=200,c.getContext("2d"),d=c.captureStream(),"function"==typeof RTCPeerConnection){e.next=8;break}return e.abrupt("return",void t(!1));case 8:if(s=new RTCPeerConnection,u=new RTCPeerConnection,s.onicecandidate=function(e){e.candidate&&u.addIceCandidate(new RTCIceCandidate(e.candidate))},u.onicecandidate=function(e){e.candidate&&s.addIceCandidate(new RTCIceCandidate(e.candidate))},Promise.all([n(s),n(u)]).then((function(){t(!0),i(s),i(u)})),"function"==typeof s.addStream){e.next=10;break}return e.abrupt("return",void t(!1));case 10:return e.next=12,s.addStream(d);case 12:return e.next=14,s.createOffer();case 14:return a=e.sent,e.next=17,s.setLocalDescription(a);case 17:return e.next=19,u.setRemoteDescription(a);case 19:return e.next=21,u.createAnswer();case 21:return o=e.sent,e.next=24,u.setLocalDescription(o);case 24:return e.next=26,s.setRemoteDescription(o);case 26:setTimeout((function(){t(!1),i(s),i(u)}),200),e.next=32;break;case 29:e.prev=29,e.t0=e.catch(3),h.Ay.error("Error when trying to check for local RTC peer connection",e.t0),t(!1);case 32:case"end":return e.stop()}}),e,null,[[3,29]])})));return function(t,r){return e.apply(this,arguments)}}())},getDocumentHandle:function(e){return document.getElementById(e)},isSupportVideoFrame:function(){return"undefined"!=typeof VideoFrame},isMobileSafariSupportVideoFrame:function(){return(this.isIphoneOrIpadBrowser()||this.isIpadOS()&&f.A.rwgAgent)&&this.isSupportVideoFrame()},isSelfPreviewRenderWithVideo:function(){return!!this.isMobileSafariSupportVideoFrame()||!V.getIsSupportMultiThread()&&!V.getIsSupportVirtualBackground()&&this.isSupportVideoFrameOrBitmapCapture()||this.isAndroidBrowser()&&!this.isAndroidIntegrationWithSAB()},isSupportNewWaitRoomFlow:function(){return!0},isSupportChromeWideAEC:function(e){var t=!!b.A.read(e,10,1)&&this.isChromeOS()&&(0,C.LZ)(116);return(this.isMac()||this.isWindows()||this.isLinux())&&(0,C.LZ)(111)||t||f.A.isGoogleMeetMode},isSupportOpenMicWhenShareAudio:function(e){return this.isSupportChromeWideAEC(e)&&!f.A.shareSystemAudio},getAudioFeatureFlags:function(){return f.A.enableAudioBridge?4:12},isSupportShareMultiStream:function(){return!0},isSupportVideoLTR:function(){return!0},isSupportAudioBridgeAvsync:function(){return!0},getAudioContextConfigure:function(){var e={};return(this.isChromiumVersionHigherThan(74)||this.isSafariVersionHigherThan(14.1))&&(e={sampleRate:48e3,latencyHint:.02}),e},download:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(x[e])return x[e];var r=new Promise(function(){var r=H(O().mark((function r(n,i){var a,o,s;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a={},t&&(a.integrity=t),o=0;case 3:if(!(o<3)){r.next=20;break}return r.prev=4,r.next=7,fetch(e,a);case 7:if(null==(s=r.sent)||!s.ok){r.next=11;break}return n(s.text()),o>0&&h.Ay.error("after ".concat(o," retry download js ").concat(e," successed ")),r.abrupt("break",20);case 11:2==o&&i("download failed ".concat(e," ").concat(null==s?void 0:s.status)),r.next=17;break;case 14:r.prev=14,r.t0=r.catch(4),2==o&&i(r.t0);case 17:o++,r.next=3;break;case 20:case"end":return r.stop()}}),r,null,[[4,14]])})));return function(e,t){return r.apply(this,arguments)}}());return x[e]=r,r},downloadAndCompileWebAssembly:function(e,t,r){var n=arguments;return H(O().mark((function i(){var a,o,s;return O().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=!(n.length>3&&void 0!==n[3])||n[3],o="".concat(e).concat(a),!x[o]){i.next=4;break}return i.abrupt("return",x[o]);case 4:return s=new Promise(function(){var n=H(O().mark((function n(i,o){var s,u,c,d,l;return O().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:s=null,r.add_monitor("CS".concat(t)),u=0;case 3:if(!(u<3)){n.next=46;break}if(n.prev=4,!a){n.next=11;break}return n.next=8,WebAssembly.compileStreaming(fetch(e,{priority:"high"}));case 8:s=n.sent,n.next=17;break;case 11:return n.next=13,fetch(e,{priority:"high"});case 13:return c=n.sent,n.next=16,c.arrayBuffer();case 16:s=n.sent;case 17:r.add_monitor("CE".concat(t)),n.next=41;break;case 20:if(n.prev=20,n.t0=n.catch(4),"TypeError"!==n.t0.name){n.next=40;break}return n.prev=23,n.next=26,fetch(e,{priority:"high"});case 26:return d=n.sent,n.next=29,d.arrayBuffer();case 29:return l=n.sent,n.next=32,WebAssembly.compile(l);case 32:s=n.sent,n.next=38;break;case 35:n.prev=35,n.t1=n.catch(23),2==u&&(r.add_monitor("".concat(a?"CF":"FF").concat(t)),h.Ay.error("Failed to download WASM file using compile: ".concat(e," for worker type: ").concat(t),n.t1));case 38:n.next=41;break;case 40:2==u&&h.Ay.error("Failed to download WASM file using ".concat(a?"compileStreaming":"fetch",": ").concat(e," for worker type: ").concat(t),n.t0);case 41:if(!s){n.next=43;break}return n.abrupt("return",(i(s),void(u>0&&h.Ay.error("after ".concat(u," retry download wasm ").concat(e," successed ")))));case 43:u++,n.next=3;break;case 46:o(new Error("Unable to download and compile WASM file: ".concat(e," for worker type: ").concat(t)));case 47:case"end":return n.stop()}}),n,null,[[4,20],[23,35]])})));return function(e,t){return n.apply(this,arguments)}}()),i.abrupt("return",(x[o]=s,s));case 6:case"end":return i.stop()}}),i)})))()},readBlob:function(e){return new Promise((function(t,r){var n=new FileReader;n.onload=function(){t(n.result)},n.readAsText(e)}))},readBlobAsBuffer:function(e){return new Promise((function(t,r){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsArrayBuffer(e)}))},lengthInUtf8Bytes:function(e){var t=encodeURIComponent(e).match(/%[89ABab]/g);return e.length+(t?t.length:0)},isLittleEndian:function(){var e=new ArrayBuffer(2),t=new Uint8Array(e),r=new Uint16Array(e);return t[0]=170,t[1]=187,48042===r[0]},sleep:function(e){return new Promise((function(t,r){setTimeout((function(){t(!0)}),e)}))},isSDKSupportMultiThread:function(){var e=H(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V.checkIsSupportMultiThread();case 2:return e.abrupt("return",V.getIsSupportMultiThread());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),isAMDGraphic:function(){try{return this.graphicName.includes("amd")}catch(e){return!1}},graphicName:B.renderInfo,graphicvendorname:B.vendor,isGraphicShouldUseHardwareAccelerationDecode:function(){return!!P||!(!this.isAMDGraphic()||!this.isChromeOS())||!(this.isAMDGraphic()&&!this.isChromeOS())},VP9MachineDetect:function(){var e=navigator.mediaCapabilities.decodingInfo({type:"webrtc",video:{contentType:"video/vp9",bitrate:1e7,framerate:25,height:1920,width:1080}});return new Promise((function(t,r){e.then((function(e){e.supported||(h.Ay.log("video/vp9 codec isn't supported in software or hardware"),t(!1)),t(e.powerEfficient)})).catch((function(e){h.Ay.warn("Error when trying to determine support for VP9 codec",e),t(!1)}))}))},IsSupportVideoDecodeHardwareAcceleration:function(){var e=arguments,t=this;return H(O().mark((function r(){var n,i;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.length>0&&void 0!==e[0]&&e[0],!P){r.next=3;break}return r.abrupt("return",!0);case 3:if("function"==typeof VideoDecoder&&(!t.browser.isSafari||t.isAppleBrowserVersionHigherThan("17.5"))){r.next=5;break}return r.abrupt("return",!1);case 5:return i={codec:"avc1.640028",description:new Uint8Array([1,100,0,31,255,225,0,14,103,100,0,51,172,27,26,17,129,64,22,201,160,16,7,0,5,104,200,66,60,48,0,5,104,82,16,207,12,0,25,104,114,16,143,24,67,17,132,56,140,84,81,8,18,22,41,3,194,98,3,5,32,122,9,140,0,5,104,36,132,51,203,0,5,104,46,132,51,195,0,25,104,54,132,35,198,16,196,97,14,35,21,20,66,4,133,138,64,240,152,128,193,72,30,130,99,0,5,104,62,132,51,203]),codedWidth:1280,codedHeight:720,optimizeForLatency:!0,hardwareAcceleration:n?"no-preference":"prefer-hardware"},r.prev=6,r.next=9,VideoDecoder.isConfigSupported(i);case 9:return r.abrupt("return",!!r.sent.supported);case 12:return r.prev=12,r.t0=r.catch(6),r.abrupt("return",!1);case 15:case"end":return r.stop()}}),r,null,[[6,12]])})))()},IsSupportVideoEncodeHardwareAcceleration:function(){var e=arguments,t=this;return H(O().mark((function r(){var n,i;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.length>0&&void 0!==e[0]?e[0]:{bitrateMode:"constant",scalabilityMode:"L1T2"},!P){r.next=3;break}return r.abrupt("return",!0);case 3:if("function"==typeof VideoEncoder&&(!t.browser.isSafari||t.isAppleBrowserVersionHigherThan("17.5"))){r.next=5;break}return r.abrupt("return",!1);case 5:return i=I(I({},{codec:"avc1.640028",bitrate:15e5,width:1280,height:720,avc:{format:"annexb"},framerate:25,hardwareAcceleration:"no-preference",latencyMode:"realtime"}),n),r.next=8,VideoEncoder.isConfigSupported(i);case 8:return r.abrupt("return",r.sent.supported);case 9:case"end":return r.stop()}}),r)})))()},isVideoEncoderPreconditionMatched:function(){return"function"==typeof VideoEncoder&&(!this.browser.isSafari||(0,C.b2)("17.5"))},isVideoDecoderPreconditionMatched:function(){return"function"==typeof VideoDecoder&&(!this.browser.isSafari||(0,C.b2)("17.5"))},AdapterWhiteListCheckForEncoder:function(){if(!K())return-1;try{var e=B.renderInfo,t=B.vendor,r=e.toLowerCase(),n=t.includes("ARM"),i=(r.includes("amd"),r.includes("intel"));return r.includes("hd graphics"),r.includes("nvidia"),r.includes("geforce"),i?0:n?-1:0}catch(e){return 0}},isSDKSupportSIMD:function(){var e=this;return H(O().mark((function t(){return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("object"==("undefined"==typeof WebAssembly?"undefined":j(WebAssembly))){t.next=2;break}return t.abrupt("return",!1);case 2:if(!e.browser.isChromeOrEdge){t.next=9;break}if(N.version>=84){t.next=5;break}return t.abrupt("return",!1);case 5:return t.next=7,V.checkIsSupportSIMD();case 7:t.next=11;break;case 9:return t.next=11,V.checkIsSupportSIMD();case 11:return t.abrupt("return",V.getIsSupportSIMD());case 12:case"end":return t.stop()}}),t)})))()},buffer2stringSplitByComma:function(e){return new Uint8Array(e).join(",")},stringSplitByComma2Buffer:function(e){try{for(var t=e.split(",").map((function(e){return parseInt(e)})),r=new ArrayBuffer(t.length),n=new Uint8Array(r),i=0;i<t.length;i++)n[i]=t[i];return r}catch(e){return null}},removeDuplicates:function(e,t){var r=[];return e.forEach((function(e){for(var n=!1,i=0;i<r.length;i++)if(!t.call(null,r[i],e)){n=!0;break}n||r.push(e)})),r},getIOSMajorVersion:function(){if(/iP(hone|od|ad)/.test(navigator.platform)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return parseInt(e[1],10)}return null},getMacSafariMajorVersion:function(){if(this.browser.isSafari){var e=navigator.userAgent.match(/Version\/([\d.]+)/);return e&&e[1]?parseFloat(e[1]):null}return null},isSupportDefaultDeviceId:function(){return navigator.webkitGetUserMedia&&!(0,k.vk)()&&!(0,k.zX)()},isSupportImageCapture:function(){return!1},isSupportOffscreenCanvas:function(){return K()},isSupport2dOffscreenCanvas:function(){return"function"==typeof OffscreenCanvas},isSupportVideoTrackReader:function(){return!1},isSupportMediaStreamTrackProcessor:function(){return"function"==typeof MediaStreamTrackProcessor&&(K()||(0,w.B)().config.canUseSsrcStream())},isSupportVideoFrameOrBitmapCapture:function(){return this.isSupportMediaStreamTrackProcessor()},isSupportSharedArrayBuffer:function(){return"undefined"!=typeof SharedArrayBuffer},queryPTZPermisson:function(){return H(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.permissions.query({name:"camera",panTiltZoom:!0});case 3:return e.t0=e.sent.state,e.abrupt("return","granted"==e.t0);case 7:return e.prev=7,e.t1=e.catch(0),e.abrupt("return",(h.Ay.error("Error when querying pan-tilt-zoom permission",e.t1),!1));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},isSupportCameraPan:function(){var e,t;return!(null===(e=navigator.mediaDevices)||void 0===e||null===(t=e.getSupportedConstraints)||void 0===t||null===(t=t.call(e))||void 0===t||!t.pan)},isSupportCameraTilt:function(){var e,t;return!(null===(e=navigator.mediaDevices)||void 0===e||null===(t=e.getSupportedConstraints)||void 0===t||null===(t=t.call(e))||void 0===t||!t.tilt)},isSupportCameraZoom:function(){var e,t;return!(null===(e=navigator.mediaDevices)||void 0===e||null===(t=e.getSupportedConstraints)||void 0===t||null===(t=t.call(e))||void 0===t||!t.zoom)},isSupportPTZ:function(){var e,t,r=null===(e=navigator.mediaDevices)||void 0===e||null===(t=e.getSupportedConstraints)||void 0===t?void 0:t.call(e);return r&&r.pan&&r.tilt&&r.zoom},get720pcapacity:function(){return U.capacityfor720},set720pcapacity:function(e){U.capacityfor720=e},get1080pcapacity:function(){return U.capacity1080},set1080pcapacity:function(e){U.capacity1080=e},isSupportBrowserWebRTC:function(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&window.RTCPeerConnection)},getsub1080pcapacity:function(){return F.capacitydecofor1080},setsub1080pcapacity:function(e){F.capacitydecofor1080=e},isSupportMultiViewAPI:function(){var e;return(K()||(0,w.B)().config.configDone()&&(0,w.B)().config.canUseSsrcStream())&&(null===(e=navigator)||void 0===e?void 0:e.hardwareConcurrency)>=2&&"function"==typeof requestAnimationFrame&&"function"==typeof SharedArrayBuffer},getMaxCountRender:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return void 0===t||void 0===r||t||this.isSupportMultiViewAPI()?(0,k.HR)()?1:null!==(e=navigator)&&void 0!==e&&e.hardwareConcurrency?navigator.hardwareConcurrency<4||(0,k.Xb)()?9:25:1:"object"==j(r)&&null!=r&&r.disableRenderLimits?25:"boolean"==typeof r&&r?4:1},checkAudioAutoPlay:function(){return new Promise((function(e,t){var r=null,n=new ArrayBuffer(684),i=new Uint32Array(n);i.set([1179011410,676,1163280727,544501094,16,65539,16e3,64e3,2097156,1635017060,640],0);var a=new Blob([i],{type:"audio/wav"}),o=s().createObjectURL(a),u=document.createElement("audio");document.body.appendChild(u),u.src=o,u.addEventListener("canplaythrough",(function(){u.play().then((function(){e(!0)})).catch((function(e){h.Ay.error("Unable to auto play audio",e),t(e)})).finally((function(){s().revokeObjectURL(o),document.body.removeChild(u),document.removeEventListener("visibilitychange",c),r&&(clearTimeout(r),r=null)}))})),u.load&&u.load();var c=function(){"visible"===document.visibilityState?r=setTimeout((function(){h.Ay.error("checkAudioAutoPlay did not complete within 1 second while the page was in the foreground"),document.body.removeChild(u),document.removeEventListener("visibilitychange",c),t(!1)}),1e3):r&&(clearTimeout(r),r=null)};c(),document.addEventListener("visibilitychange",c)}))},isSupportSendVideoFullHD:function(e){return!(navigator.hardwareConcurrency<8||!this.isSupportVideoShareSend()||!b.A.read(e,E.n.SEND_1080P_VIDEO.index,1))},isSupportSendVideoShareFullHD:function(e){return!(navigator.hardwareConcurrency<8||!this.isSupportVideoShareSend()||!b.A.read(e,E.n.SEND_1080P_VIDEO_SHARE.index,1))},isSupportVideoShare:function(){return!0},hwEncConfigReported:!1,canReportHWEncConfig:function(){return!this.hwEncConfigReported},didReportHWEncConfig:function(){this.hwEncConfigReported=!0},isSupportVideoShareSend:function(){var e;return(0,C.cO)(),this.browser.isChromeOrEdge&&(e=this.getBrowserVersion()),!!this.isSupportSharedArrayBuffer()&&!(!this.browser.isChromeOrEdge||e&&e<=100||navigator.hardwareConcurrency<=2||this.isTeslaMode()||this.isAndroidBrowser()&&!this.isAndroidIntegrationWithSAB()||this.isIphoneOrIpadBrowser())},isSupportVideoShareReceive:function(){return!0},getOption:function(e,t,r){try{var n=e.length;if(t>n)return 0;var i=e.slice(n-t-r+1,n-t+1);if(i)return parseInt(i,16)}catch(e){}return 0},isSupportWebGPURender:function(e){var t=this;return H(O().mark((function r(){var n;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.parseGPUBlacklist(e),r.next=3,t.evaluateRendererType(!0,!1,n);case 3:return r.t0=r.sent,r.t1=p.h3.WEBGPU,r.abrupt("return",r.t0==r.t1);case 6:case"end":return r.stop()}}),r)})))()},getMachineCapability:function(){var e,t,r,n,i,a,o;return G.VE=null===f.A||void 0===f.A||null===(e=f.A.localVideoPara)||void 0===e||null===(e=e.VE)||void 0===e?void 0:e.buffer.byteLength,G.VD=null===f.A||void 0===f.A||null===(t=f.A.localVideoPara)||void 0===t||null===(t=t.VD)||void 0===t?void 0:t.buffer.byteLength,G.SE=null===f.A||void 0===f.A||null===(r=f.A.localVideoPara)||void 0===r||null===(r=r.SE)||void 0===r?void 0:r.buffer.byteLength,G.SD=null===f.A||void 0===f.A||null===(n=f.A.localVideoPara)||void 0===n||null===(n=n.SD)||void 0===n?void 0:n.buffer.byteLength,G.dt=null===f.A||void 0===f.A||null===(i=f.A.localVideoPara)||void 0===i?void 0:i.videodecodethreadnumb,G.et=null===f.A||void 0===f.A||null===(a=f.A.localVideoPara)||void 0===a?void 0:a.videoencodethreadnumb,G.MT=null===f.A||void 0===f.A||null===(o=f.A.localVideoPara)||void 0===o?void 0:o.isSupportMultiThread,G.time=performance.now(),G},watermark:function(){var e=new l.A,t=document.createElement("canvas"),r={enableWaterMark:!1,waterMarkText:"",watermarkOpacity:0,watermarkRepeated:!1,watermarkPosition:void 0};return{getWaterMarkData:function(n){var i=n.width,a=n.height;if(!r.enableWaterMark)return null;var o=i<512||a<288?16:r.watermarkPosition,s=r.watermarkRepeated&&i>306&&a>202,u=function(e,t){if(e<640&&e){var r=640/e;e=640,t=Math.round(t*r)}return{width:e,height:t}}(i,a);return i=u.width,a=u.height,s?e.Get_Repeated_WaterMarkRGBA({canvas:t,name:r.waterMarkText,width:u.width,height:u.height,opacity:r.watermarkOpacity,position:o,convertToDataUrl:!0}):e.Get_WaterMarkRGBA({canvas:t,name:r.waterMarkText,width:u.width,height:u.height,opacity:r.watermarkOpacity,position:o,convertToDataUrl:!0})},updateWaterMarkInfo:function(e){Object.assign(r,e)}}}(),isSupportAudioDenoise:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!b.A.read(e,11,1)||"function"!=typeof AudioContext)return!1;if(this.browser.isChromeOrEdge&&this.getBrowserVersion()<=100)return!1;var r=WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]));return!(!1===r||(!0!==r?(h.Ay.error("WebAssembly.validate don't return a boolean"),1):!t&&!this.isSupportSharedArrayBuffer()||navigator.hardwareConcurrency<=2||this.isTeslaMode()||this.isAndroidBrowser()&&!this.isAndroidIntegrationWithSAB()||this.isIphoneOrIpadBrowser()))},getAudioDenoiseDefaultValue:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.isSupportAudioDenoise(e,t))return 0;var r=b.A.read(e,11,1);return navigator.hardwareConcurrency>4&&r&&r&E.n.AUDIO_DENOISE.candidates.DEFAULT_VALUE_GREATER_THAN_4_CORES?1:0},isSupportOriginalSound:function(e){return!!b.A.read(e,22,1)},isSupportPlayStereo:function(e){return!!(this.browser.isFirefox||this.browser.isSafari||this.isSupportChromeWideAEC(e))},isBrowserSupportStereo:function(){return!this.browser.isSafari},isSupportShare2ndAudioDevice:function(e){return!(this.browser.isSafari||this.isIphoneOrIpadBrowser()||this.isAndroidBrowser()||!e&&(this.isMac()&&!(0,C.LZ)(126)||!this.isSupportSharedArrayBuffer()))},isSupportSharingStereo:function(){return!1},isSupportVideoActiveChannel:function(){return!0},evaluateRendererType:function(){var e=arguments,t=this;return H(O().mark((function r(){var n,i,a,o,s,u,c,d,l;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.length>0&&void 0!==e[0]&&e[0],i=e.length>1&&void 0!==e[1]&&e[1],a=e.length>2&&void 0!==e[2]?e[2]:null,o=(0,w.B)().config,r.next=4,o.configDonePromise();case 4:if(!o.canUseSsrcStream()){r.next=6;break}return r.abrupt("return",p.h3.VIDEO_TAG);case 6:if(s=p.h3.WEBGL,u=K(),r.prev=8,t.isWebGL2Supported(i)?s=p.h3.WEBGL_2:h.Ay.log("evaluateRendererType() WebGL 2 is not supported."),t.isSupportVideoFrame()){r.next=11;break}return r.abrupt("return",(h.Ay.log("evaluateRendererType() WebGPU is not supported. (reason: VideoFrame is not supported)"),s));case 11:if(t.isMac()||t.isWindows()||t.isChromeOS()||t.isLinux()){r.next=13;break}return r.abrupt("return",(h.Ay.log("evaluateRendererType() WebGPU is not supported. (reason: unsupported platform)"),s));case 13:if(t.browser.isChromeOrEdge&&t.isChromeVersionHigherThan(119)||t.isOpera()&&t.isOperaVersionHigherThan(108)||t.browser.isChromeOrEdge&&(t.isLinux()||t.isAndroidBrowser())&&t.isChromeVersionHigherThan(121)){r.next=15;break}return r.abrupt("return",(h.Ay.log("evaluateRendererType() WebGPU is not supported. (reason: unmatched browser)"),s));case 15:if(navigator.gpu){r.next=17;break}return r.abrupt("return",s);case 17:return r.next=19,navigator.gpu.requestAdapter();case 19:if(c=r.sent){r.next=22;break}return r.abrupt("return",(h.Ay.log("evaluateRendererType() WebGPU is not supported. (reason: no available adapter.)"),s));case 22:return r.next=24,c.requestDevice();case 24:if(r.sent){r.next=26;break}return r.abrupt("return",(h.Ay.log("evaluateRendererType() WebGPU is not supported. (reason: no available device.)"),s));case 26:if("function"!=typeof c.requestAdapterInfo){r.next=32;break}return r.next=29,c.requestAdapterInfo();case 29:d=r.sent,r.next=33;break;case 32:"info"in c&&(d=c.info);case 33:if(d){r.next=35;break}return r.abrupt("return",(h.Ay.log("evaluateRendererType() WebGPU is not supported. (reason: no available adapter info.)"),s));case 35:if(h.Ay.log("evaluateRendererType() GPUAdapterInfo: arch=".concat(d.architecture,", vendor=").concat(d.vendor)),console.log("evaluateRendererType() GPUAdapterInfo: arch=".concat(d.architecture,", vendor=").concat(d.vendor)),l=t.queryDeviceProfile(d),t.isGPUProfileOnWebGPUWhitelist(l,a)){r.next=39;break}return r.abrupt("return",s);case 39:if(!u){r.next=47;break}if(new OffscreenCanvas(1,1).getContext("webgpu")){r.next=42;break}return r.abrupt("return",(h.Ay.log("evaluateRendererType() WebGPU is not supported. (reason: no available GPUContext.)"),s));case 42:if(t.isOpFeatureEnabled(n)){r.next=44;break}return r.abrupt("return",(h.Ay.log("evaluateRendererType() WebGPU is not supported. (reason: WebGPU is not allowed for this account.)"),s));case 44:s=p.h3.WEBGPU,r.next=48;break;case 47:h.Ay.log("evaluateRendererType() OffscreenCanvas is not supported while checking WebGPU.");case 48:return r.abrupt("return",s);case 51:return r.prev=51,r.t0=r.catch(8),r.abrupt("return",(h.Ay.error("evaluateRendererType()",r.t0),s));case 54:return r.prev=54,r.finish(54);case 57:case"end":return r.stop()}}),r,null,[[8,51,54,57]])})))()},isOpFeatureEnabled:function(e){return 1&e},queryDeviceProfile:function(e){if(e){var t={};return t.architecture=e.architecture,t.vendor=e.vendor,t}return null},isGPUProfileOnWebGPUWhitelist:function(e,t){if(!e)return!1;var r=e.vendor,n=e.architecture;return-1==p.O$.indexOf(r)?(h.Ay.log("isGPUProfileOnWebGPUWhitelist() vendor:".concat(r," arch:").concat(n," is not on the vendor whitelist!")),!1):null===t||!this.isHitGPUBlacklist(r,n,t)},isHitGPUBlacklist:function(e,t,r){if(""===e||void 0===e||void 0===t||void 0===r)return!1;for(var n=0;n<r.length;n++){var i=r[n];if(e.includes(i.vendor)&&t.includes(i.generations))return!0}return!1},parseGPUBlacklist:function(e){var t=null;if(e)try{var r=JSON.parse(e);t=null==r?void 0:r.GPUBlacklist}catch(t){h.Ay.error("parseGPUBlacklist() failed to read mediaBlockConfig! val=".concat(e))}return t},getRendererTypeList:function(e,t){var r=this;return H(O().mark((function n(){var i,a,o,s,u,c,d,l,h,f;return O().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=r.parseGPUBlacklist(t),a=[{bitIndex:E.n.WEBGPU_RENDERER.index,readCount:1,defaultVal:E.n.WEBGPU_RENDERER.default},{bitIndex:E.n.WEBGL2_RENDERER.index,readCount:1,defaultVal:E.n.WEBGL2_RENDERER.default}],o=b.A.batchRead(e,a),s=!!o.get(E.n.WEBGPU_RENDERER.index),u=!!o.get(E.n.WEBGL2_RENDERER.index),n.next=7,r.isWebGPUSupported(s,i);case 7:return c=n.sent,d=r.isWebGL2Supported(u),l=K(),h=[],f=(0,w.B)().config,n.next=14,f.configDonePromise();case 14:return f.canUseSsrcStream()&&h.push({rendererType:p.h3.VIDEO_TAG,rendererName:"VideoTag"}),c&&h.push({rendererType:p.h3.WEBGPU,rendererName:"WebGPU"}),d&&h.push({rendererType:p.h3.WEBGL_2,rendererName:"WebGL2"}),l&&h.push({rendererType:p.h3.WEBGL,rendererName:"WebGL"}),n.abrupt("return",h);case 19:case"end":return n.stop()}}),n)})))()},evaluateWebRTCStrategy:function(e,t){var r,n,i,a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e!==p.BH.DISABLED&&e!==p.BH.ENABLED&&e!==p.BH.AUTO&&(h.Ay.error("evaluateWebRTCStrategy() invalid webrtcSelection(".concat(e,") from caller.")),e=p.BH.AUTO);var s={shouldUseWebRTC:!1,errNo:p.Qb.UNKNOWN,errMsg:""};if(!this.isWebRTCFeatureEnabled(t))return s.shouldUseWebRTC=!1,s.errNo=p.Qb.FEATURE_OPTION_DISABLED,s.errMsg="webrtc is disabled(feature option is disabled).",s;var u=this.getOSInfo(),c=(null==u||null===(r=u.browser)||void 0===r?void 0:r.name)||"",d=(null==u||null===(n=u.browser)||void 0===n?void 0:n.version)||"",l=(null==u||null===(i=u.engine)||void 0===i?void 0:i.name)||"",f=(null==u||null===(a=u.engine)||void 0===a?void 0:a.version)||"",v=B,g={os:null==u?void 0:u.os,osType:null==u?void 0:u.osType,browserName:c,browserVersion:d,engineName:l,engineVersion:f,vendor:v.vendor,renderInfo:v.renderInfo,isAstcSupported:v.isAstcSupported};if(e===p.BH.DISABLED)return h.Ay.log("evaluateWebRTCStrategy() WebRTC is disabled by caller."),s.shouldUseWebRTC=!1,s.errNo=p.Qb.SUCCEED,s.errMsg="webrtc is disabled(disabled by caller).",s;var m=null==o?void 0:o.VideoWhitelist,y=this.isSupportBrowserWebRTC();try{var _=S.A.isOnWebRTCWhitelist(m,g);if(_.isInWhitelist){var A=S.A.evalWebRTCStrategy(_.blacklist,g,y,e);s.errNo=A.errNo,s.errMsg=A.errMsg,A.stg==p.BH.ENABLED?s.shouldUseWebRTC=!0:A.stg==p.BH.DISABLED?s.shouldUseWebRTC=!1:A.stg==p.BH.AUTO?s.shouldUseWebRTC=this.isDefaultToUseWebRTC(t,g):(s.shouldUseWebRTC=!1,s.errNo=p.Qb.UNKNOWN_SELECTION,s.errMsg="webrtc is disabled(unknown selection type).",h.Ay.error("evaluateWebRTCStrategy() unknown WEBRTC_STG:".concat(A.stg)))}else s.shouldUseWebRTC=!1,s.errNo=p.Qb.DEVICE_NOT_ON_WHITELIST,s.errMsg="webrtc is disabled(not on the whitelist)."}catch(e){h.Ay.error("evaluateWebRTCStrategy() error:",e),s.shouldUseWebRTC=!1,s.errNo=p.Qb.OTHER_EX,s.errMsg="webrtc is disabled(unexpected error:".concat(e.errorMessage,").")}if(s.shouldUseWebRTC)try{var b,E,k=null===(b=RTCRtpReceiver.getCapabilities("video"))||void 0===b||null===(b=b.codecs)||void 0===b?void 0:b.some((function(e){var t=e.mimeType,r=e.sdpFmtpLine;return"video/H264"===t&&-1!==(null==r?void 0:r.indexOf("packetization-mode=1"))})),C=null===(E=RTCRtpSender.getCapabilities("video"))||void 0===E||null===(E=E.codecs)||void 0===E?void 0:E.some((function(e){return"video/H264"===e.mimeType}));k&&C||(s.shouldUseWebRTC=!1,s.errNo=p.Qb.BROWSER_NOT_SPT,s.errMsg="H.264 not supported: ".concat(k,"-").concat(C))}catch(e){h.Ay.error("evaluateWebRTCStrategy() failed to detect H.264 codec",e)}return h.Ay.directReport("evaluateWebRTCStrategy() stg=".concat(JSON.stringify(s),", isBrowserSupportWebRTC=").concat(y,", videoWhitelist=").concat(JSON.stringify(m),", selection=").concat(e)),s},isWebRTCFeatureEnabled:function(e){var t=b.A.read(e,E.n.ENABLE_WEBRTC_FEATURE.index,1,E.n.ENABLE_WEBRTC_FEATURE.default);return h.Ay.log("isWebRTCFeatureEnabled() optionVal:".concat(t)),!!t},getAnnotationCapability:function(e){var t=b.A.read(e,E.n.SUPPORT_ANNOTATION.index,1,E.n.SUPPORT_ANNOTATION.default),r=!!(t&E.n.SUPPORT_ANNOTATION.candidates.VIEWER),n=!!(t&E.n.SUPPORT_ANNOTATION.candidates.PRESENTER),i=r?n?2:1:0;return h.Ay.log("getAnnotationCapability() cap:".concat(i)),i},getWebRTCStrategyOptions:function(e){var t=b.A.read(e,E.n.WEBRTC_STG.index,1,E.n.WEBRTC_STG.default);h.Ay.log("getWebRTCStrategyOption() optionVal:".concat(t));var r=[];return Object.entries(p.BH).forEach((function(e){var n=v(e,2),i=n[0],a=n[1],o={key:i,value:a,isDefault:!1};t===a&&(o.isDefault=!0),r.push(o)})),r},isDefaultToUseWebRTC:function(e,t){var r=[{bitIndex:E.n.WEBRTC_SMART_AUTO_STG_1.index,readCount:1,defaultVal:E.n.WEBRTC_SMART_AUTO_STG_1.default},{bitIndex:E.n.WEBRTC_SMART_AUTO_STG_2.index,readCount:1,defaultVal:E.n.WEBRTC_SMART_AUTO_STG_2.default},{bitIndex:E.n.WEBRTC_SMART_AUTO_STG_3.index,readCount:1,defaultVal:E.n.WEBRTC_SMART_AUTO_STG_3.default},{bitIndex:E.n.WEBRTC_SMART_AUTO_STG_4.index,readCount:1,defaultVal:E.n.WEBRTC_SMART_AUTO_STG_4.default}],n=b.A.batchRead(e,r),i=n.get(E.n.WEBRTC_SMART_AUTO_STG_1.index),a=n.get(E.n.WEBRTC_SMART_AUTO_STG_2.index),o=n.get(E.n.WEBRTC_SMART_AUTO_STG_3.index),s=!!(i&E.n.WEBRTC_SMART_AUTO_STG_1.candidates.SAB_OFF_NO_OFFSCREENCANVAS_NO_GPU),u=!!(a&E.n.WEBRTC_SMART_AUTO_STG_2.candidates.DESKTOP_LOW_PERF_DEVICE);if(s){if(!this.isSupportSharedArrayBuffer())return h.Ay.log("isDefaultToUseWebRTC() force WebRTC. reason: SharedArrayBuffer not support"),!0;if(!this.isSupport2dOffscreenCanvas())return h.Ay.log("isDefaultToUseWebRTC() force WebRTC. reason: OffscreenCanvas not support"),!0;if(t.renderInfo&&t.renderInfo.toLowerCase().includes("swiftshader"))return h.Ay.log("isDefaultToUseWebRTC() force WebRTC. reason: swiftshader"),!0}if(u&&0==t.osType&&this.isLowPerformanceDevice())return h.Ay.log("isDefaultToUseWebRTC() force WebRTC. reason: desktop low performance device (cores <= 4)"),!0;if(o&E.n.WEBRTC_SMART_AUTO_STG_3.candidates.WEBCODEC_NOT_SUPPORT&&!this.isVideoEncoderPreconditionMatched()&&!this.isVideoDecoderPreconditionMatched())return h.Ay.log("isDefaultToUseWebRTC() force WebRTC. reason: webcodec not support"),!0;if(a&E.n.WEBRTC_SMART_AUTO_STG_2.candidates.VIDEO_ON_BROWSER_32BIT&&L)return h.Ay.log("isDefaultToUseWebRTC() force WebRTC. reason: 32-bit os/browser for video"),!0;var c=!!(i&E.n.WEBRTC_SMART_AUTO_STG_1.candidates.MOB_ANDROID)||!!(i&E.n.WEBRTC_SMART_AUTO_STG_1.candidates.MOB_IOS),d=!!(i&E.n.WEBRTC_SMART_AUTO_STG_1.candidates.DESKTOP);return!(!c&&!d||![{os:"android",flag:E.n.WEBRTC_SMART_AUTO_STG_1.candidates.MOB_ANDROID},{os:"ios",flag:E.n.WEBRTC_SMART_AUTO_STG_1.candidates.MOB_IOS},{os:"win",flag:E.n.WEBRTC_SMART_AUTO_STG_1.candidates.DESKTOP},{os:"mac",flag:E.n.WEBRTC_SMART_AUTO_STG_1.candidates.DESKTOP},{os:"chromium os",flag:E.n.WEBRTC_SMART_AUTO_STG_1.candidates.DESKTOP}].some((function(e){var r,n=e.os,a=e.flag;return i&a&&(null===(r=t.os)||void 0===r?void 0:r.toLowerCase().includes(n))}))||(h.Ay.log("isDefaultToUseWebRTC() force WebRTC. reason: force WebRTC on specific OS"),0))},isWebGL2Supported:function(e){return"function"==typeof OffscreenCanvas&&e&&W.isSupportWebgl2},isWebGL2SupportedWhenOpEnabled:function(){return W.isSupportWebgl2},isWebGPUSupported:function(e,t){var r=this;return H(O().mark((function n(){var i,a,o,s;return O().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return",!1);case 2:if(r.isSupportVideoFrame()){n.next=4;break}return n.abrupt("return",!1);case 4:if(r.isMac()||r.isWindows()||r.isChromeOS()||r.isLinux()){n.next=6;break}return n.abrupt("return",!1);case 6:if(r.browser.isChromeOrEdge&&r.isChromeVersionHigherThan(119)||r.isOpera()&&r.isOperaVersionHigherThan(108)||r.browser.isChromeOrEdge&&(r.isLinux()||r.isAndroidBrowser())&&r.isChromeVersionHigherThan(121)){n.next=8;break}return n.abrupt("return",!1);case 8:if(navigator.gpu){n.next=10;break}return n.abrupt("return",!1);case 10:return n.next=12,navigator.gpu.requestAdapter();case 12:if(i=n.sent){n.next=15;break}return n.abrupt("return",!1);case 15:return n.next=17,i.requestDevice();case 17:if(n.sent){n.next=19;break}return n.abrupt("return",!1);case 19:if("function"!=typeof i.requestAdapterInfo){n.next=25;break}return n.next=22,i.requestAdapterInfo();case 22:a=n.sent,n.next=26;break;case 25:"info"in i&&(a=i.info);case 26:if(a){n.next=28;break}return n.abrupt("return",!1);case 28:if(o=r.queryDeviceProfile(a),r.isGPUProfileOnWebGPUWhitelist(o,t)){n.next=31;break}return n.abrupt("return",(h.Ay.log("isWebGPUSupported() hit blacklist! profile=".concat(JSON.stringify(o),", blacklist=").concat(JSON.stringify(t))),!1));case 31:return s=new OffscreenCanvas(1,1),n.abrupt("return",s.getContext("webgpu")?(s=null,!0):(s=null,!1));case 33:case"end":return n.stop()}}),n)})))()},isRendererTypeSupported:function(e,t,r,n){var i=this;return H(O().mark((function a(){return O().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(a.t0=!(e<=p.h3.UNDEFINED||e>p.h3.VIDEO_TAG),!a.t0){a.next=20;break}if(e!==p.h3.WEBGL){a.next=6;break}a.t1=K(),a.next=19;break;case 6:if(e!==p.h3.WEBGL_2){a.next=10;break}a.t2=i.isWebGL2Supported(r),a.next=18;break;case 10:if(e!==p.h3.WEBGPU){a.next=16;break}return a.next=13,i.isWebGPUSupported(t,n);case 13:a.t3=a.sent,a.next=17;break;case 16:a.t3=e===p.h3.VIDEO_TAG&&(0,w.B)().config.canUseSsrcStream();case 17:a.t2=a.t3;case 18:a.t1=a.t2;case 19:a.t0=a.t1;case 20:return a.abrupt("return",a.t0);case 21:case"end":return a.stop()}}),a)})))()},videoToMediaStreamManager:function(){var e,t,r=document.createElement("canvas"),n=r.getContext("2d"),i=640,a=360,o=navigator.hardwareConcurrency&&navigator.hardwareConcurrency<4?10:24,s=1e3/("chrome"===N.browser||"edge"===N.browser?o:10),u=null,c=0,d=null;return{_draw:function(){if(e){this.drawCanvas(r,n,i,a);var t=performance.now();if(c){var o=t-c;o>s?this._setFasterTimer():o<.8*s&&this._clearFastTimer()}c=t}},_setFasterTimer:function(){var t=this;u||(u=setInterval((function(){e&&e.currentTime>0&&!e.paused&&!e.ended&&performance.now()-c>=s/2&&t.drawCanvas(r,n,i,a)}),s))},_clearFastTimer:function(){c=0,clearInterval(u),u=null},drawCanvas:function(t,r,n,i){t.width=n,t.height=i;var a=0,o=0;e.videoWidth/e.videoHeight>n/i?a=n/i*(o=e.videoHeight):o=i/n*(a=e.videoWidth),r.drawImage(e,(e.videoWidth-a)/2,(e.videoHeight-o)/2,a,o,0,0,n,i)},startCapture:function(n,s,u){return e=n,s&&u&&s/u==16/9&&(i=s,a=u),d&&e.removeEventListener("timeupdate",d),d=this._draw.bind(this),n.addEventListener("timeupdate",d),t=r.captureStream(o)},stopCapture:function(){d&&e.removeEventListener("timeupdate",d),this._clearFastTimer(),t&&(t.getVideoTracks().forEach((function(e){return e.stop()})),t=null),e=null},isSupported:function(){return"function"==typeof HTMLCanvasElement.prototype.captureStream}}}(),audioToMediaStreamMananger:function(){var e=null,t=null,r=null,n=null,i=null;return{startCapture:function(a){if(t||(t=Y("File")),i&&a===i)e=i;else{this.destroy(),i=e=a,n=t.createMediaElementSource(e);var o=t.createMediaStreamDestination();n.connect(o),r=o.stream}return"suspended"!==t.state&&"interrupted"!==t.state||t.resume().catch((function(e){h.Ay.error("File audio context resume error: ",e)})),r},stopCapture:function(){t&&t.suspend(),e=null},destroy:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];n&&n.disconnect(),r&&(r.getAudioTracks().forEach((function(e){return e.stop()})),r=null),i=null,n=null,!e&&t&&(t.close(),t=null)},isAudioFileStream:function(e){return e===r},isSupported:function(){return"undefined"!=typeof AudioContext&&"function"==typeof AudioContext.prototype.createMediaStreamDestination&&"function"==typeof AudioContext.prototype.createMediaElementSource}}}(),evaluateAudioStrategy:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,o=this.calcuateAudioStrategyGroup(e,t,r,i,a),s=o.preferredStrategy,u=b.A.read(e,E.n.ENABLE_FALLBACK_WEBRTC_AUDIO_STG.index,1,E.n.ENABLE_FALLBACK_WEBRTC_AUDIO_STG.default);return u&&0===o.preferredStrategy&&!0===n&&(-1!=o.availableStrategies.indexOf(3)?o.preferredStrategy=3:-1!=o.availableStrategies.indexOf(1)?o.preferredStrategy=1:h.Ay.error("evaluateAudioStrategy() no available WebRTC audio strategies to use!")),h.Ay.log("evaluateAudioStrategy() group:".concat(JSON.stringify(o),", originPreferredStrategy:").concat(s,", isFallbackWebRTCAudioStgEnabled:").concat(u,", enforceSelect:").concat(r,", enabledOnFT:").concat(i,", videoUseWebRTC:").concat(n)),o.preferredStrategy},calcuateAudioStrategyGroup:function(e,t,r,i,a){var o={preferredStrategy:-1,availableStrategies:[]};if(this.isEnforceWasmMachine())return a===n.WEBASSEMBLY&&!0!==i||console.log("calcuateAudioStrategyGroup() enforce WebAssembly audio even if abTestStrategy is ".concat(a," and enabledOnFT is ").concat(i)),o.preferredStrategy=0,o.availableStrategies.push(0),o;var s=0,u=s;if(!1!==i||a===n.WEBRTC_AUDIO_2?u=3:(u=1,a===n.WEBASSEMBLY&&(u=0)),this.isMTRWindows())return s=0,o.preferredStrategy=s,o.availableStrategies.push(0),o;var c=b.A.read(e,1,2),d=this.isWebRTCAudio2_0(e,t,!0,i,a);return this.isMTRAndroid()?(0===u?s=0:8&c?(s=d?3:1,o.availableStrategies.push(1),d&&o.availableStrategies.push(3)):s=0,o.preferredStrategy=s,o.availableStrategies.push(0),o):(0,k.bw)()||(0,k.GN)()||(0,k.HR)()||(0,k.n_)()?(s=d?3:1,o.preferredStrategy=s,o.availableStrategies.push(1),d&&o.availableStrategies.push(3),o):128&c||(d?ve:pe)?(s=!0===r?d?3:1:!1===r||0===u?0:this.isDefaultAudioBridgeMachine(e,c,r)?3===u&&d?3:1:0,o.preferredStrategy=s,o.availableStrategies.push(0),o.availableStrategies.push(1),d&&o.availableStrategies.push(3),o):(-1===o.preferredStrategy&&(h.Ay.error("calculateAudioStrategyGroup() preferredStrategy is unknown! fallback to wasm!"),o.preferredStrategy=0,o.availableStrategies.length=0,o.availableStrategies.push(0)),o)},isEnforceWasmMachine:function(){var e;if("undefined"==typeof RTCPeerConnection)return!0;var t=this.getOSInfo();return!(0,k.Xb)()&&((null==t||null===(e=t.browser)||void 0===e||null===(e=e.name)||void 0===e?void 0:e.toLowerCase().includes("firefox"))||this.browser.isFirefox)},isWebRTCAudio2_0:function(e,t,r,i,a){var o,s=!1!==i,u=a===n.WEBRTC_AUDIO_2||a===n.WEBRTC_AUDIO_1,c=s;c||u&&(c=a===n.WEBRTC_AUDIO_2);var d=b.A.read(e,63,1),l=null===(o=A.q.get(t))||void 0===o?void 0:o.hasSilkAudio,f=r&&c&&d&&!l;return h.Ay.directReport("enabledOnFT:".concat(i,", abTestStrategy:").concat(a,", isWebRTCAudio2_0: ").concat(d,", hasSilk: ").concat(l,", isWebRTCAudio: ").concat(r,", preferToUseWebRTCAudio2:").concat(c)),f},isDefaultAudioBridgeMachine:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(1===r)return!0;if(0===r)return!1;if(b.A.read(e,E.n.WEBRTC_SMART_AUTO_STG_2.index,1,E.n.WEBRTC_SMART_AUTO_STG_2.default)&E.n.WEBRTC_SMART_AUTO_STG_2.candidates.AUDIO_ON_BROWSER_32BIT&&L)return!0;var n=this.getOSInfo();return n&&n.os&&n.browser?1==n.osType||"Windows"!==n.os&&4==n.osType?32&t:this.isSupportSharedArrayBuffer()?"Windows"!==n.os&&"Mac OS"!==n.os&&"Chromium OS"!==n.os?32&t:("Chrome"===n.browser.name||"Safari"===n.browser.name||"Edge"===n.browser.name)&&navigator.hardwareConcurrency>4?64&t:32&t:32&t:(this.isLowPerformanceDevice()||!this.isSupportSharedArrayBuffer())&&32&t},requestScreenWakeLock:function(){return y.requestWakeLock()},releaseScreenWakeLock:function(){return y.release()},isSupportPeerConnection:function(){return"function"==typeof RTCPeerConnection},getBandWidth:function(){return new Promise((function(e,t){if(!(navigator&&navigator.managed&&navigator.managed.getManagedConfiguration))return e(null);navigator.managed.getManagedConfiguration(["BandwidthLimitUp","BandwidthLimitDown"]).then((function(t){var r={};if(!_.isNil(t)){var n=parseInt(t.BandwidthLimitUp,10),i=parseInt(t.BandwidthLimitDown,10);Number.isNaN(n)||(r.uplimit=n),Number.isNaN(i)||(r.downlimit=i)}return e(r)})).catch((function(e){return t(e)}))}))},isSupportVideoProcessor:function(e){var t=!!(b.A.read(e,E.n.ENABLE_MEDIA_PROCESSOR.index,1,E.n.ENABLE_MEDIA_PROCESSOR.default)&E.n.ENABLE_MEDIA_PROCESSOR.candidates.VIDEO_PROCESSOR);return this.isSupportOffscreenCanvas()&&this.isSupportVideoFrame()&&t},isSupportAudioProcessor:function(e){return!!(b.A.read(e,E.n.ENABLE_MEDIA_PROCESSOR.index,1,E.n.ENABLE_MEDIA_PROCESSOR.default)&E.n.ENABLE_MEDIA_PROCESSOR.candidates.AUDIO_PROCESSOR)&&"function"==typeof AudioWorklet},isVideoProcessorEnabled:function(e){return!!(e&E.n.ENABLE_MEDIA_PROCESSOR.candidates.VIDEO_PROCESSOR)},isMediaProcessorEnabled:function(e){return e>0},isSupportAudioHID:function(){return!(!window.navigator.hid||!window.navigator.hid.requestDevice||this.isChromeOS()||(0,k.UP)()&&!(0,k.D)("137.0.3296.16"))},isLowPerformanceDevice:function(){return navigator.hardwareConcurrency<=4},isMobileForceAutoChooseAudioDeviceEnable:function(){if(f.A.isDesktopMode)return!1;var e={},t=E.n.MOBILE_FORCE_AUTO_CHOOSE_AUDIO_DEVICE;return void 0!==f.A.mobileForceAutoChooseAudioDevice?(e.android=f.A.mobileForceAutoChooseAudioDevice&t.candidates.ANDROID,e.ios=f.A.mobileForceAutoChooseAudioDevice&t.candidates.IOS):(e.android=t.default&t.candidates.ANDROID,e.ios=t.default&t.candidates.IOS),!(!(0,k.n_)()||!e.ios)||!(!(0,k.GN)()||!e.android)},isAndroidForceEarpiceCaptureEnable:function(){if(f.A.isDesktopMode)return!1;var e,t=E.n.MOBILE_FORCE_AUTO_CHOOSE_AUDIO_DEVICE;return e=void 0!==f.A.mobileForceAutoChooseAudioDevice?f.A.mobileForceAutoChooseAudioDevice&t.candidates.ANDROID_EARPIECE:t.default&t.candidates.ANDROID_EARPIECE,(0,k.GN)()&&e}},Q=X;function J(){var e=this;this.promise=new Promise((function(t,r){e.reject=r,e.resolve=t}))}var $=D((function e(t,r){R(this,e),this.scriptURL=t,this.lateLoadedAssetsHash=r}),[{key:"getIntegrity",value:function(){var e=this.scriptURL.split("/").pop().split("?")[0].split("#")[0];return this.lateLoadedAssetsHash[e]||null}}]);function Z(e){if("suspended"===e.state){var t=document.body,r=["touchstart","touchend","mousedown","mouseup","keyup","keydown"];r.forEach((function(e){return t.addEventListener(e,n,!1)}))}function n(){e.resume().then(i).catch(i)}function i(){r.forEach((function(e){return t.removeEventListener(e,n)}))}}function ee(e,t){if(e===t)return!0;if(n(e)&&n(t)){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e)if(!ee(e[r],t[r]))return!1;return!0}function n(e){return"object"==j(e)&&null!=e}}function te(){return r.e(557).then(r.bind(r,90))}function re(){return r.e(208).then(r.bind(r,7531))}function ne(e){var t=document.body,r=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];function n(){e()}return r.forEach((function(e){return t.addEventListener(e,n,!1)})),function(){r.forEach((function(e){return t.removeEventListener(e,n)}))}}function ie(e){var t=null==e?void 0:e.getVideoTracks();return!(null==t||!t.length||t[0].muted)}function ae(e){try{var t,r=v((null===(t=e.srcObject)||void 0===t?void 0:t.getVideoTracks())||[],1)[0],n="VDom:".concat(e.ended,":").concat(e.paused,":").concat(e.readyState,",VTrack:").concat(null==r?void 0:r.muted,":").concat(null==r?void 0:r.readyState);g.A.add_monitor(n)}catch(e){h.Ay.error("RecordVideoState error",e)}}function oe(e,t){(e<0||t<0||e>3e3||t>3e3)&&h.Ay.directReport("CANVASSIZE:".concat(e,"x").concat(t))}function se(e){if(!e)return!1;if("string"==typeof e)return!1;if(e.ownerDocument===window.document)return e instanceof HTMLElement;var t,r=null===(t=e.ownerDocument)||void 0===t||null===(t=t.defaultView)||void 0===t?void 0:t.HTMLElement;return!!r&&e instanceof r||e instanceof HTMLElement}function ue(e){var t={dom:null,id:""};if(e)if("string"==typeof e)t.dom=document.getElementById(e),t.id=e;else if(se(e)){var r;t.dom=e,t.id=null===(r=e.getAttribute)||void 0===r?void 0:r.call(e,"id")}else"transferControlToOffscreen"in e&&"function"==typeof e.transferControlToOffscreen&&(t.dom=e,t.id=e.id);return t}function ce(){try{var e={safari:"15.0",firefox:"89",chrome:"91",edge:"91",opera:"77"},t={safari:"16.4",firefox:"105",chrome:"102",edge:"102",opera:"88"},r=Object.assign({name:"",version:""},(0,C.PF)().browser);if(-1==Object.keys(e).findIndex((function(e){if(r.name.toLowerCase().includes(e))return r.name=e,!0})))return console.error("!!!!! For a better experience, please use Chrome (version >= 102) or Safari (version >= 16.4) browser "),void h.Ay.error("unkown browser info");(0,k.D$)(r.version,e[r.name])||(console.error("!!!! For a better experience,  \n       Chrome (version > ".concat(e.chrome," ,performance version > ").concat(t.chrome,") \n       Safari (version > ").concat(e.safari," , performance version > ").concat(t.safari,") \n       Firefox (version > ").concat(e.firefox," , performance version > ").concat(t.firefox,") \n       Edge (version > ").concat(e.edge," , performance version > ").concat(t.edge," ) \n       Opera (version > ").concat(e.opera," , performance version > ").concat(t.opera,") \n")),h.Ay.error("less than min version "))}catch(e){h.Ay.error("check browser version error",e)}}function de(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"|";return e?c()(t=e.toString()).call(t,/[,]/g,r):""}function le(){try{var e=document.createElement("canvas");return!(!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}function he(e){var t=self.ZoomTPModule;return new(t&&t.ZoomTPWebSocket?t.ZoomTPWebSocket:WebSocket)(e)}function fe(){P=arguments.length>0&&void 0!==arguments[0]&&arguments[0]}var pe=!0,ve=!0;function ge(){try{pe=(new A.Y).getAudioBridgeConnectivityInfo().getWebRTCConnectivityResult().result,ve=(new A.Y).getWMSCConnectivityInfo().getWebRTCConnectivityResult().result}catch(e){h.Ay.error("updateAudioProbResult error",e),pe=!0,ve=!0}}function me(){try{return!!X.isAppleBrowserVersionHigherThan("15")||!!X.isChromiumVersionHigherThan(131)}catch(e){return!1}}function ye(){return X.isSupportMultiViewAPI()||f.A.enableMultiDecodeVideoWithoutSAB?26:1}function _e(){return M}function Se(e){var t;return e&&(e.includes("web")?t="web":e.includes("window")?t="window":e.includes("screen")&&(t="screen")),t||"UNKNOWN"}ge()})),3903:function(e,t,r){r.d(t,{CV:function(){return c},Nd:function(){return u},fw:function(){return s},tK:function(){return o},vJ:function(){return d}});var n=r(7857),i=r(9407),a=r(9693);function o(e){l.instance||(l.instance=new l),l.instance.start(e)}function s(){var e;null===(e=l.instance)||void 0===e||e.close()}function u(e){l.instance&&l.instance.setTimeoutCallback(e)}function c(e,t){l.instance&&l.instance.registerWorker(t,e)}function d(e){l.instance&&l.instance.unRegisterWorker(e)}var l=function(){function e(){R(this,e),this._interval=-1,this.monitorworkers={},this.timeoutcallbackfn=function(e,t){}}return D(e,[{key:"setTimeoutCallback",value:function(e){this.timeoutcallbackfn=e}},{key:"registerWorker",value:function(e,t){if(e in this.monitorworkers){var r=this.monitorworkers[e];r.worker.removeEventListener("message",r.listener),delete this.monitorworkers[e]}var n={id:e,worker:t},i=this._recvheartbeat.bind(this,n);n.listener=i,n.lastedtimestamp=Date.now(),n.timeoutcount=0,n.worker.addEventListener("message",n.listener),this.monitorworkers[e]=n}},{key:"unRegisterWorker",value:function(e){if(e in this.monitorworkers){var t=this.monitorworkers[e];delete this.monitorworkers[e],t.worker.removeEventListener("message",t.listener)}}},{key:"_recvheartbeat",value:function(e,t){var r=t.data;r.cmd===i.QT&&(e.lastedtimestamp=r.timestamp,e.timeoutcount=0)}},{key:"start",value:function(t){var r=this,n="undefined"!=typeof DedicatedWorkerGlobalScope&&t&&t instanceof DedicatedWorkerGlobalScope;if(-1==this._interval)if(n)this._interval=setInterval((function(){t.postMessage({cmd:i.QT,timestamp:Date.now()})}),e.INTREVAL_TIME_MS);else{var o=function(){r._interval=setTimeout((function(){o();var t=e.instance,r=Object.keys(t.monitorworkers),n=Date.now();r.forEach((function(r){var i=t.monitorworkers[r];i.timeoutcount>5?n-i.lastedtimestamp>e.HEART_TIMEOUT_MS&&(t.timeoutcallbackfn(i.id,n-i.lastedtimestamp),i.lastedtimestamp=n):(i.timeoutcount++,i.worker.postMessage({command:a.QT}))}))}),e.INTREVAL_TIME_MS)};o()}}},{key:"close",value:function(){var e=this;try{this._interval&&clearTimeout(this._interval),this._interval=-1,Object.keys(this.monitorworkers).forEach((function(t){var r=e.monitorworkers[t];delete e.monitorworkers[t],r.worker.removeEventListener("message",r.listener)}))}catch(e){}}}])}();(0,n.A)(l,"INTREVAL_TIME_MS",3e3),(0,n.A)(l,"HEART_TIMEOUT_MS",15e3),(0,n.A)(l,"MAX_HEART_TIMEOUT_MS",3e4),(0,n.A)(l,"instance",null)},4497:function(e,t,r){var n=r(7300).A;e.exports=n},242:function(e,t,r){r.d(t,{A:function(){return k}});var n=r(129),i=r.n(n),a=r(1265),o=r.n(a),s=["headset","pods","buds","opencomm","arctis","mpow","hyperx cloud","zone wired","aeropex by aftershokz","plt focus","xiberia","pxc 550","tk-hs001","lifechat lx","cisco 56"],u=[["wh-","wf-","wi-"],["1000x","ch","xb","sp","h9","c2","c5","c6","c1","h8","c4","c3"]],c={jabra:["evolve","pro 900","pro 920","pro 93","pro 94","talk","biz","engage","elite","uc voice","link 180","link 2","link 860","link 850","link 400","blueparrott"],plantronics:["savi","blackwire","c5","c3","c4","c6","c7","bt","audio","da","encorepro","hw111n","gamecom","apu","voyager"],logitech:["h570","h820","h650","pro x"],sennheiser:["sc","mb","pc","sd","dect","g4me1","audio"],sony:["wh","wf","mdr"],bose:["qc","quiet","soundlink","soundsport","on-ear","nc"],beats:["fit","flex","power","solo","studio","mivi"],razer:["kraken","blackshark","barracuda","nari","hammerhead","opus"],yealink:["uh","wh","yh","cp"],soundcore:["life","liberty","spirit","strike"],addasound:["sr","epic"],jbl:["tune","quantum","live","wave","t450bt","c200","everest","c310"],epos:["impact","pc 8 usb","h3","adapt"],jlab:["go","bt","epic","studio"]},d=function(e){if("string"!=typeof e)return!1;for(var t=e.toLowerCase(),r=0;r<s.length;r++){var n=s[r];if(t.includes(n))return!0}for(var i=Object.keys(c),a=0;a<i.length;a++){var o=i[a];if(t.includes(o))for(var d=c[o],l=0;l<d.length;l++)if(t.includes(d[l]))return!0}for(var h=u[0],f=u[1],p=!1,v=0;v<h.length;v++)if(t.includes(h[v])){p=!0;break}if(p)for(var g=0;g<f.length;g++)if(t.includes(f[g]))return!0;return!1},l=r(1461),h=r(2737),f=r(9109),p=r(5738),v=r(5408),g=r(2543),m=r(7080),y=r(8935),_=r(9470),S=/\(\w+:\w+\)|,/gi;function A(e,t){return e.kind===t.kind?e.deviceId===t.deviceId?0:e.deviceId>t.deviceId?1:-1:e.kind>t.kind?1:-1}function b(){this._deviceList=null,this._deviceDetectTimer=null,this._lastEnumDeviceTS=null,this.enumDevices=this.enumDevices.bind(this),this.addChangeListener(),this.enumDevices()}b.prototype.init=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.micId=null,this.micLabel=null,this.speakerId=null,this.speakerLabel=null,this.cameraId=null,this.cameraLabel=null,this.startTime=Date.now(),this.userId=0,this.videoWidth=0,this.videoHeight=0,this._wmscAudio=!1,this.isUpdatingDevice=!1,this.denoiseSwitch=!1,this._onChangeCB=e.onChangeHandler,this.mediaOPConfig=null,this.isPreviewMode=!1},b.prototype.isSupportDeviceChange=function(){return!(h.Ay.isAndroidBrowser()&&!h.Ay.browser.isFirefox)},b.prototype.addChangeListener=function(){var e,t,r,n;this.isSupportDeviceChange()?(null===(e=navigator.mediaDevices)||void 0===e||null===(t=e.removeEventListener)||void 0===t||t.call(e,"devicechange",this.enumDevices),null===(r=navigator.mediaDevices)||void 0===r||null===(n=r.addEventListener)||void 0===n||n.call(r,"devicechange",this.enumDevices)):this.enableSelfDeviceDetect()},b.prototype.enableSelfDeviceDetect=function(){this.disableSelfDeviceDetect(),this._deviceDetectTimer=setInterval(this.enumDevices.bind(this),3e3)},b.prototype.disableSelfDeviceDetect=function(){this._deviceDetectTimer&&clearInterval(this._deviceDetectTimer)},b.prototype.isDeviceChanged=function(e,t){if(null===(e=e.slice()))return!0;if((t=t.slice()).length!=e.length)return!0;i()(e).call(e,A),i()(t).call(t,A);for(var r=0,n=0;!(r>=t.length||n>=e.length);){if(e[n].deviceId!=t[r].deviceId)return!0;r++,n++}return!1},b.prototype.enumDevices=H(O().mark((function e(){var t,r,n,i=this,a=arguments;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>0&&void 0!==a[0]?a[0]:null,e.abrupt("return",null===(t=navigator)||void 0===t||null===(t=t.mediaDevices)||void 0===t||null===(r=t.enumerateDevices)||void 0===r?void 0:r.call(t).then(function(){var e=H(O().mark((function e(t){var r,a;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.filterValidDevices(t);case 2:return t=e.sent,r=!1,i.isSupportDeviceChange()&&n?(r=!0,i.reportAllDevicesMonitorLogs(t)):null==i._deviceList?i.reportAllDevicesMonitorLogs(t):!i.isSupportDeviceChange()&&i.isDeviceChanged(i._deviceList,t)&&(r=!0,i.reportAllDevicesMonitorLogs(t)),a=i._deviceList,e.abrupt("return",(i._deviceList=t,i._lastEnumDeviceTS=Date.now(),r&&i.onDeviceChange(a,t),i._deviceList));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){v.GW.error("MediaSDK catched error while enumerateDevice: ",e)})));case 2:case"end":return e.stop()}}),e)}))),b.prototype.onDeviceChange=function(e,t){(0,g.isFunction)(this._onChangeCB)&&this._onChangeCB(e,t)},b.prototype.filterValidDevices=function(){var e=H(O().mark((function e(t){var r,n,i,a;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=0,n=0,e.next=3,this.hasPermission("microphone");case 3:return i=e.sent,a=t.filter((function(e){var t=e.label,i=e.deviceId;return"audioinput"===e.kind?(r++,!("communications"===i||/ZoomAudioDevice/i.test(t)||/Zoom-\S*/.test(t)||/CubebAggregateDevice\S*/.test(t)||/Microsoft Teams Audio/i.test(t))):"audiooutput"!==e.kind||(n++,!h.Ay.isSafariVersionHigherThan(18.4)&&"communications"!==i&&!/ZoomAudioDevice/i.test(t)&&!/Microsoft Teams Audio/i.test(t))})),e.abrupt("return",(i&&(r||m.A.add_monitor("NoAudioInput"),!n&&((0,_.b2)(18.4)||(0,_.i$)(116)||(0,y._J)()||(0,y.UP)())&&m.A.add_monitor("NoAudioOutput")),a));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),b.prototype.getDeviceListAsync=H(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumDevices();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),b.prototype.getDeviceListFromCache=function(){return this._deviceList},b.prototype.reportAllDevicesMonitorLogs=function(e){var t=this;e&&e.forEach((function(e){var r;if("audioinput"==e.kind)t.sendDeviceInfo(-1,1,t.getIndex(e.label),e.deviceId,null===(r=e.label)||void 0===r||null===(r=r.replace(S,""))||void 0===r?void 0:o()(r).call(r),!0);else if("audiooutput"==e.kind){var n;t.sendDeviceInfo(-1,0,t.getIndex(e.label),e.deviceId,null===(n=e.label)||void 0===n||null===(n=n.replace(S,""))||void 0===n?void 0:o()(n).call(n),!0)}else"videoinput"===e.kind&&t.sendCameraInfo(-1,0,0,e)}))},b.prototype.notifyDenoiseSetting=function(){if(h.Ay.isSupportAudioDenoise(this.mediaOPConfig,!!this._wmscAudio)&&this.micId){if(this._wmscAudio)this._wmscAudio.changeDenoiseSwitch(this.denoiseSwitch,E.isHeadSet());else{var e={command:"audio_denoise_switch",switch:this.denoiseSwitch,isHeadSet:E.isHeadSet()};p.Notify_Audio_Encode_Thread(e)}m.A.add_monitor("DENOISE:".concat(this.denoiseSwitch?1:0,"-").concat(this.isHeadSet()?1:0))}},b.prototype.hasValidOutputDevice=function(){var e=H(O().mark((function e(t){var r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==t){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,this.getDeviceListAsync();case 4:return r=e.sent.filter((function(e){return"audiooutput"===e.kind})),e.abrupt("return",0!==r.length&&r.filter((function(e){return e.deviceId===t})).length);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),b.prototype.onlyHasBInDeviceOnAndroid=function(){if(h.Ay.isAndroidBrowser()){var e=new Set(["Headset earpiece","Speakerphone"]);return this._deviceList.every((function(t){return"audioinput"!=t.kind||"default"===t.deviceId||e.has(t.label)}))}},b.prototype.changeDenoiseSwitch=function(e){this.denoiseSwitch=e,this.notifyDenoiseSetting()},b.prototype.setWebRTCAudio=function(e){this._wmscAudio=e},b.prototype.hasPermission=function(){var e=H(O().mark((function e(t){var r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.permissions.query({name:t});case 3:return e.t0=e.sent.state,e.abrupt("return","granted"===e.t0);case 7:if(e.prev=7,e.t1=e.catch(0),r=null,"microphone"!==t){e.next=14;break}r="audioinput",e.next=17;break;case 14:if("camera"===t){e.next=16;break}return e.abrupt("return",!1);case 16:r="videoinput";case 17:return e.next=19,navigator.mediaDevices.enumerateDevices();case 19:return e.sent.forEach((function(e){if(e.kind===r&&""===e.label)return!1})),e.abrupt("return",!0);case 21:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),b.prototype.setUserId=function(e){if("number"==typeof e&&!Number.isNaN(e)){var t=this.userId>>10<<10==e>>10<<10;this.userId=e,t||this.reportAllDevicesMonitorLogs(this._deviceList)}},b.prototype.updateSelectedMicDevices=function(e,t,r,n){var i;t=null===(i=t)||void 0===i||null===(i=i.replace(S,""))||void 0===i?void 0:o()(i).call(i),n&&(this.micId=e,this.micLabel=t),this.notifyDenoiseSetting(),this.reportUsingMicDevice(e,t,r,n)},b.prototype.reportUsingMicDevice=function(e,t,r,n){this.sendDeviceInfo(r,1,this.getIndex(t),e,t,n,d(t))},b.prototype.updateShareAudioDevices=function(e,t){this.sendDeviceInfo(0,2,0,e,t,!0,!1)},b.prototype.updateSelectedSpeakerDevices=function(){var e=H(O().mark((function e(t,r,n){var i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||"default",i="default",e.next=4,this.getDeviceListAsync();case 4:e.sent.forEach((function(e){var r;"audiooutput"===e.kind&&e.deviceId===t&&(i=null===(r=e.label)||void 0===r||null===(r=r.replace(S,""))||void 0===r?void 0:o()(r).call(r))})),n&&(this.speakerId=t,this.speakerLabel=i),this.sendDeviceInfo(r,0,this.getIndex(this.speakerLabel),t,i,n,this.isHeadSet(!1));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),b.prototype.updateSelectedCameraDevices=function(e,t,r,n,i,a,s){var u;this.cameraId=e,this.cameraLabel=null==t||null===(u=t.replace(S,""))||void 0===u?void 0:o()(u).call(u),this.videoWidth=r,this.videoHeight=n,this.videoFrameRate=i,this.sendCameraInfo(a,s,i)},b.prototype.isHeadSet=function(){var e;return e=arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?this.speakerLabel:this.micLabel,d(e)},b.prototype.getIndex=function(e){return"default"==e?-1:"communications"==e?h.Ay.isMac()?0:-2:0},b.prototype.sendDeviceInfo=function(e,t,r,n,i,a,o){if(this.userId){var s,u=Date.now()-this.startTime;s=-1==e?"WCL_AUDIOD-ALL,"+this.userId+","+t+","+r+","+i+","+n+","+a+","+e+",7,"+u+",1":"WCL_AUDIOD,"+this.userId+","+t+","+r+","+i+","+n+","+a+","+e+",7,"+u+",1,"+(a?1:0)+","+o,f.A.sendMessageToRwg(l.yGo,{evt:l.UFw,seq:1,body:{data:s}})}},b.prototype.sendCameraInfo=function(e,t,r){var n,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.userId&&!this.isUpdatingDevice&&(n=-1===e?"WCL_CAMERA-ALL,"+this.userId+",0,"+i.label+","+t+","+e+",-1,0,0,-1,"+r+",-1,"+i.deviceId:"WCL_CAMERA,"+this.userId+",0,"+this.cameraLabel+","+t+","+e+",-1,"+this.videoWidth+","+this.videoHeight+",-1,"+r+","+-1,f.A.sendMessageToRwg(l.yGo,{evt:l.UFw,seq:1,body:{data:n}}))},b.prototype.getMicId=function(){return this.micId},b.prototype.getMicLabel=function(){return this.micLabel},b.prototype.getSpeakerId=function(){return this.speakerId},b.prototype.setMediaOPConfig=function(e){this.mediaOPConfig=e},b.prototype.setPreviewMode=function(e){this.isPreviewMode=e},b.prototype.getMicDeviceIdByLabel=function(e){var t;return null===(t=this._deviceList.find((function(t){return"audioinput"===t.kind&&t.label==e})))||void 0===t?void 0:t.deviceId};var E=new b,k=E},5169:function(e,t,r){r.d(t,{$8:function(){return s},a6:function(){return h},cI:function(){return c},n:function(){return f},nf:function(){return u}});var n=r(456);function i(){this.ssrcQueueMap=new Map,i.prototype.AddQueue=function(e){var t=new n.A;return this.ssrcQueueMap.set(e,t),t},i.prototype.DeleteQueue=function(e){this.ssrcQueueMap.delete(e)},i.prototype.GetQueue=function(e){return this.ssrcQueueMap.get(e)},i.prototype.GetQueueData=function(e){return this.ssrcQueueMap.get(e).dequeue()},i.prototype.PutQueueData=function(e,t){this.ssrcQueueMap.get(e).enqueue(t)},i.prototype.GetQueueLength=function(e){var t=this.ssrcQueueMap.get(e);return null!==t?t.getLength():0}}var a=function(){this.frames=0,this.ntp=new n.A};a.prototype={UpdateVideoInfo:function(e){this.frames++,this.ntp.getLength()>30&&this.ntp.dequeue(),this.ntp.enqueue(e)},GetVideoFpsInfo:function(){var e=this.ntp.getLength();if(!(e<5)){for(var t=0,r=0,n=0,i=0,a=0;a<e;a++){var o=this.ntp.dequeue();0==o&&0==n?r++:0!=o?(i=0,0==n&&(n=o),t=o):0!=n&&t!=n&&0==o&&i++}return 0==t||t==n?0:e-r-i-1!=0?(t-n)/(e-r-i-1):0}}};var o=function(){this.ssrcInfoMap=new Map};function s(){this.ssrcQueueMap=new Map,this.ssrcInfo=new o,s.prototype.AddQueue=function(e){var t=new n.A;return this.ssrcQueueMap.set(e,t),t},s.prototype.DeleteQueue=function(e){this.ssrcQueueMap.delete(e)},s.prototype.GetQueue=function(e){return this.ssrcQueueMap.get(e)},s.prototype.ClearQueue=function(){this.ssrcQueueMap.clear()},s.prototype.GetQueueData=function(e){return this.ssrcQueueMap.get(e).dequeue()},s.prototype.PutQueueData=function(e,t){this.ssrcQueueMap.get(e).enqueue(t)},s.prototype.GetQueueLength=function(e){var t=this.ssrcQueueMap.get(e);return t?t.getLength():0},s.prototype.UpdateInfo=function(e,t){this.ssrcInfo.UpdateSSRCInfo(e,t)},s.prototype.GetFpsInfo=function(e){return this.ssrcInfo.GetSSRCFpsInfo(e)}}o.prototype={UpdateSSRCInfo:function(e,t){var r=this.ssrcInfoMap.get(e);r||(r=new a,this.ssrcInfoMap.set(e,r)),r.UpdateVideoInfo(t)},GetSSRCFpsInfo:function(e){var t=this.ssrcInfoMap.get(e);return t?t.GetVideoFpsInfo():0}};var u=function(){function e(e){var t=e.sessionid;this.map=new Map,this.AudioQueueMGR=new i,this.timemap=new Map,this.sessionid=t||0}return e.prototype.Add=function(e,t){this.map.set(e,t),this.AudioQueueMGR.AddQueue(e)},e.prototype.Clear=function(){this.map.clear()},e.prototype.Keys=function(){return this.map.keys()},e.prototype.UpdateSSRCTimeMap=function(e){this.timemap=e},e.prototype.GetSSRCTimeMap=function(e){return this.timemap?this.timemap.get(e):null},e}();function c(e){var t=e.sessionid;this.sessionid=t||0,this.map=new Map,this.VideoQueueMGR=new s}c.prototype.Add=function(e,t){this.map.set(e,t)},c.prototype.Clear=function(){this.map.clear()},c.prototype.Keys=function(){return this.map.keys()};var d=function(){this.frames=0,this.ntp=new n.A};d.prototype={UpdateSharingInfo:function(e){this.frames++,this.ntp.getLength()>30&&this.ntp.dequeue(),this.ntp.enqueue(e)},GetSharingFpsInfo:function(){var e=this.ntp.getLength();if(!(e<5)){for(var t=0,r=0,n=0,i=0,a=0;a<e;a++){var o=this.ntp.dequeue();0==o&&0==n?r++:0!=o?(i=0,0==n&&(n=o),t=o):0!=n&&t!=n&&0==o&&i++}return 0==t||t==n?0:e-r-i-1!=0?(t-n)/(e-r-i-1):0}}};var l=function(){this.ssrcInfoMap=new Map};function h(){this.ssrcQueueMap=new Map,this.ssrcInfo=new l,h.prototype.AddQueue=function(e){var t=new n.A;return this.ssrcQueueMap.set(e,t),t},h.prototype.DeleteQueue=function(e){this.ssrcQueueMap.delete(e)},h.prototype.GetQueue=function(e){return this.ssrcQueueMap.get(e)},h.prototype.ClearQueue=function(){this.ssrcQueueMap.clear()},h.prototype.GetQueueData=function(e){return this.ssrcQueueMap.get(e).dequeue()},h.prototype.PutQueueData=function(e,t){this.ssrcQueueMap.get(e).enqueue(t)},h.prototype.GetQueueLength=function(e){var t=this.ssrcQueueMap.get(e);return t?t.getLength():0},h.prototype.UpdateInfo=function(e,t){this.ssrcInfo.UpdateSSRCInfo(e,t)},h.prototype.GetFpsInfo=function(e){return this.ssrcInfo.GetSSRCFpsInfo(e)}}function f(e){var t=e.sessionid;this.map=new Map,this.sQueue=new n.A,this.SharingQueueMGR=new h,this.sessionid=t||0}l.prototype={UpdateSSRCInfo:function(e,t){var r=this.ssrcInfoMap.get(e);r||(r=new d,this.ssrcInfoMap.set(e,r)),r.UpdateSharingInfo(t)},GetSSRCFpsInfo:function(e){var t=this.ssrcInfoMap.get(e);return t?t.GetSharingFpsInfo():0}},f.prototype.Clear=function(){this.map.clear()},f.prototype.Keys=function(){return this.map.keys()},f.prototype.Add=function(e,t){this.map.set(e,t)},f.prototype.Get=function(e){return this.map.get(e)},f.prototype.PutData=function(e){e&&this.sQueue&&this.sQueue.enqueue(e)},f.prototype.GetData=function(){if(this.sQueue)return this.sQueue.dequeue()},f.prototype.ClearBuffer=function(){this.sQueue&&(this.sQueue=new n.A)}},9109:function(e,t,r){r.d(t,{A:function(){return y}});var n=r(456),i=r(5408),a=r(2737),o=r(8353),s=(0,o.A)("sdk.init"),u=D((function e(){var t=this;R(this,e);var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.name=r,this.handler=null,this.wasm=null,this.socket=null,this.defered=new a.cY,this.initSuccessPromise=this.defered.promise,this.wasmDefered=new a.cY,this.wasmSuccessPromise=this.wasmDefered.promise,this.handlerDefered=new a.cY,this.handlerSuccessPromise=this.handlerDefered.promise,this.socketDefered=new a.cY,this.socketSuccessPromise=this.socketDefered.promise,Promise.all([this.wasmSuccessPromise,this.handlerSuccessPromise,this.socketSuccessPromise]).then((function(e){var r=e.every((function(e){return!0===e}));t.defered.resolve(r),r||s.error(t.name,{handler:t.handler,wasm:t.wasm,socket:t.socket})}))}),[{key:"setHanderSuccess",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.handler=e,this.handlerDefered.resolve(e)}},{key:"setWasmSuccess",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.wasm=e,this.wasmDefered.resolve(e)}},{key:"setSocketSuccess",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.socket=e,this.socketDefered.resolve(e)}},{key:"checkInitSuccess",value:function(){return this.handler&&this.wasm&&this.socket}},{key:"isSocketInitSuccess",value:function(){return this.socket}},{key:"waitforInitSuccess",value:function(){return this.initSuccessPromise}},{key:"resetHandleDeferred",value:function(){this.setHanderSuccess(!0),this.handlerDefered=new a.cY,this.handlerSuccessPromise=this.handlerDefered.promise}}]),d=function(e){function t(e){return R(this,t),c(this,t,[e])}return f(t,e),D(t)}(u),l=function(e){function t(e){return R(this,t),c(this,t,[e])}return f(t,e),D(t)}(u),h=function(e){function t(e){return R(this,t),c(this,t,[e])}return f(t,e),D(t)}(u),p=r(9482),v=r(7080),g=(0,o.A)("sdk.variables");function m(){this.crashCount=0,this.crashLastTime=0,this.AEW=null,this.ADW=null,this.AEWF=null,this.ADWF=null,this.VE=null,this.VD=null,this.SE=null,this.SD=null,this.VEMTimes=0,this.VDMTimes=0,this.SEMTimes=0,this.SDMTimes=0,this.extVBPort=null,this.frameSent=0,this.frameReceived=0,this.webrtcAudioFailoverCount=0,this.browserFeaturedefer=new a.cY,this.browserFeature=null,this.timeOrigin=0}m.prototype.initDB=function(){var e,t={},r=this;t.init=function(n){if(this.db_name=n.db_name,this.db_version=n.db_version,this.db_store_name=n.db_store_name,indexedDB){try{e=indexedDB.open(this.db_name,this.db_version)}catch(e){return i.Ay.error("Error opening IndexedDB",e),void(r.indexDbObject=null)}e.onerror=function(e){r.indexDbObject=null},e.onupgradeneeded=function(e){this.db=e.target.result,this.db.createObjectStore(t.db_store_name)},e.onsuccess=function(e){t.db=e.target.result,r.openIndexFlag=!0,r.indexDbObject.select("delay")}}else r.indexDbObject=null},t.put=function(e,r){try{var n=t.db.transaction(t.db_store_name,"readwrite").objectStore(t.db_store_name).put(e,r);n.onsuccess=function(){},n.onerror=function(e){i.Ay.error("Set Delay failed!",e)}}catch(e){i.Ay.error("IndexDb put Failed!",e)}},t.delete=function(r){(e=t.db.transaction(t.db_store_name,"readwrite").objectStore(t.db_store_name).delete(r)).onsuccess=function(){g("Delete the key:"+r)}},t.select=function(e){try{var n,a=t.db.transaction(t.db_store_name,"readwrite").objectStore(t.db_store_name);(n=e?a.get(e):a.getAll()).onsuccess=function(){r.audioDelay=n.result},n.onerror=function(){r.audioDelay=0}}catch(e){i.Ay.error("IndexDb Select Failed",e)}},t.clear=function(){t.db.transaction(t.db_store_name,"readwrite").objectStore(t.db_store_name).clear().onsuccess=function(){g("Clear the IndexDb Successfully")}},t.close=function(){t.db&&t.db.close()},this.indexDbObject=t,this.indexDbObject.init({db_name:"AEC",db_version:1,db_store_name:"delay"})},m.prototype.Notify_APPUI_SAFE=function(e){for(var t=this,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];if("number"==typeof e||"string"==typeof e)n=arguments;else if(e!==this.instance)return;this._Notify_APPUI&&(g("Notify_APPUI_SAFE",n),this._Notify_APPUI.apply(this,n),this._callbackList.forEach((function(e){return e.apply(t,n)})))},m.prototype.Notify_APPUI=m.prototype.Notify_APPUI_SAFE,m.prototype.queueMessageToRwg=function(e,t){this.rwgMessageList.push({jsEvent:e,message:t})},m.prototype.clearMessageToRwg=function(){var e=this;v.A.startSend(),this.rwgConnectSuccess=!0,this.rwgMessageList.length>0&&(this.rwgAgent||this._Notify_APPUI)&&(this.rwgMessageList.forEach((function(t){var r=t.jsEvent,n=t.message;e.sendMessageToRwg(r,n,!1,!1)})),this.rwgMessageList=[])},m.prototype.destroyQueueMessageToRwg=function(){this.rwgConnectSuccess=!1,this.rwgMessageList=[]},m.prototype.sendMessageToRwg=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(this.rwgConnectSuccess&&(this.rwgAgent||this._Notify_APPUI)||!r){this.rwgConnectSuccess&&n&&this.clearMessageToRwg();try{this.rwgAgent?this.rwgAgent.sendMessageToRwg(t):this.Notify_APPUI_SAFE(e,t)}catch(e){i.Ay.error("Error sending message to RWG",e)}}else this.queueMessageToRwg(e,t)},m.prototype.reinit=function(e){this.instance=e,this.SPECIAL_ID=0,this._callbackList=[],this._Notify_APPUI=null,this.localAudioDecMGR=null,this.localVideoDecMGR=null,this.localAudioEncMGR=null,this.localVideoEncMGR=null,this.localSharingDecMGR=null,this.localMouseDecMGR=null,this.localSharingEncMGR=null,this.localAudioPara=null,this.localVideoPara={},this.localSharingPara=null,this.Audio_WebSocket_Ip_Address=null,this.Audio_Web_Transport_Ip_Address=null,this.Video_WebSocket_Ip_Address=null,this.Video_Web_Transport_Ip_Address=null,this.Sharing_WebSocket_Ip_Address=null,this.mediaSDKHandle=null,this.audio_pcm_queue=new n.A,this.int16Array=null,this.isInitialFailed=!1,this.isAudioEncodeWASMOK=!1,this.isAudioDecodeWASMOK=!1,this.isVideoEncodeWASMOK=!1,this.isVideoDecodeWASMOK=!1,this.isSharingDecodeWASMOK=!1,this.isSharingEncodeWASMOK=!1,this.audioEncWorkerPath="",this.audioDecWorkerPath="",this.videoDecWorkerPath="",this.videoEncWorkerPath="",this.sharingDecWorkerPath="",this.sharingEncWorkerPath="",this.audioEncodeSession=null,this.audioDecodeSession=null,this.videoDecodeSession=null,this.videoEncodeSession=null,this.sharingDecodeSession=null,this.sharingEncodeSession=null,this.isAudioEncodeThreadStart=!1,this.isAudioDecodeThreadStart=!1,this.isVideoDecodeThreadStart=!1,this.isSharingDecodeThreadStart=!1,this.isVideoEncodeThreadStart=!1,this.isSharingEncodeThreadStart=!1,this.isAudioPlayWork=!1,this.isVideoPlayWork=!1,this.isSharingPlayWork=!1,this.shareBufferSampleNumb=30,this.audioWasmInfo=null,this.initialSuccessNumb=0,this.TotalWaitEvent=0,this.audioPostInterval=null,this.sharedBuffer=null,this.decoderinworklet=null,this.decoderinworkletOP=null,this.shareSystemAudio=!1,this.indexDbObject=null,this.audioDelay=0,this.openIndexFlag=!1,this.audioBufferSize=a.Ay.browser.isFirefox?30:15,this.monitorIntervalHandle=null,this.e2eencrypt=!1,this.AudioNode=null,this.SharingAudioNode=null,this.CurrentSSRC=0,this.CurrentSSRCTime=0,this.audioPlayTime=0,this.videoDecResponseText=null,this.videoEncResponseText=null,this.sharingDecodeResponse=null,this.sharingEncodeResponse=null,this.sharingDecInitInstance=new d(p._c.SHARING_DECODE),this.sharingEncInitInstance=new d(p._c.SHARING_ENCODE),this.videoDecInitInstance=new l(p._c.VIDEO_DECODE),this.videoInitInstance=new l(p._c.VIDEO_ENCODE),this.audioDecInitInstance=new h(p._c.AUDIO_DECODE),this.audioEncodeInitInstance=new h(p._c.AUDIO_ENCODE),this.audioDecodeResponse=null,this.audioEncodeResponse=null,this.ivObj={},this.userNodeList=[],this.rwgAgent=null,this.ComputerAudioStatus=p.BX.ComputerAudio_Null,this.DesktopAudioStatus=p.BX.DesktopAudio_Null,this.initDB(),this.resourceManager=null,this.vbarraybuffer=null,this.vbbin=null,this.vbjson=null,this.tfjsurl=null,this.afnbin=null,this.afnjson=null,this.basebin=null,this.basejson=null,this.workletMessageQueue=new n.A,this.workletWasmInitSuccess=!1,this.videoEncodeInitSuccess=null,this.vbPreloadSuccess=null,this.enableAduioBridge=!1,this.audioMode=-1,this.enableEchoDetection=0,this.enableHADecOpt=0,this.enableSafariHWCodec=0,this.enable360pHWDec=0,this.enable360pHWEnc=0,this.enableAndroidHWDec=0,this.enableAndroidHWEnc=0,this.disableHWCodec=0,this.enableOptCopyFrame=0,this.enableTransferDataChannel=0,this.hwEncAdditionalConfig={bitrateMode:"constant",scalabilityMode:"L1T2"},this.hwEncAddConIdx=0,this.HWEncEnableL1T1=0,this.enableCanvasAlphaChannel=!0,this.enableWebrtcTurnServer=!1,this.enablemesh=0,this.mesh_node=0,this.supportAVSimultaneousFallback=!1,this.VEMTimes=0,this.VDMTimes=0,this.SEMTimes=0,this.SDMTimes=0,this.isPreviewMode={audioEncode:!1,audioDecode:!1,videoEncode:!1,videoDecode:!1},this.rwgConnectSuccess=!1,this.rwgMessageList=[],this.localSsrc=0,this.frameSent=0,this.frameReceived=0,this.shouldKeepAVWhenFailover={waitingRoom:!1}};var y=new m},3578:function(e,t,r){r.d(t,{A:function(){return n}});var n=D((function e(){R(this,e)}),[{key:"_drawWatermarkWithShadow",value:function(e){var t=e.ctx,r=e.textPos,n=e.opacity,i=e.name;t.fillStyle="rgba(0, 0, 0, ".concat(n,")"),t.fillText(i,r.x,r.y),t.fillStyle="rgba(255, 255, 255, ".concat(n,")"),t.fillText(i,r.x+1,r.y+1)}},{key:"_getTransformInfo",value:function(e){var t,r=e.canvas,n=e.position;if(1===n)t={x:r.width/2,y:0,rateRadio:0,maxWidth:r.width};else if(2===n)t={x:r.width/2,y:r.height,rateRadio:0,maxWidth:r.width};else if(4===n)t={x:0,y:r.height/2,rateRadio:Math.PI/2,maxWidth:r.height};else if(8===n)t={x:r.width,y:r.height/2,rateRadio:-Math.PI/2,maxWidth:r.height};else{var i=-21*Math.PI/180;t={x:r.width/2,y:r.height/2,rateRadio:i,maxWidth:Math.min(r.width/Math.cos(i),-r.height/Math.sin(i))}}return t.maxWidth>100&&(t.maxWidth-=50),t}},{key:"_calcTextPos",value:function(e){var t=e.position,r=e.ctx,n=e.name,i=e.textWidth,a=this._getPaddingWidth({ctx:r,position:t,name:n});return 1===t?{x:-i.width/2,y:a}:2===t||4===t||8===t?{x:-i.width/2,y:-a}:{x:-i.width/2,y:r.measureText(n[0]).width/2}}},{key:"_getPaddingWidth",value:function(e){var t=e.ctx,r=e.position,n=e.name;return[1,2,4,8].includes(r)?32:t.measureText(n[0]).width}},{key:"_setBaseLine",value:function(e){var t=e.ctx,r=e.position;t.textBaseline=1===r?"top":2===r||4===r||8===r?"bottom":"middle"}},{key:"Get_WaterMarkRGBA",value:function(e){var t=e.canvas,r=e.name,n=e.width,i=e.height,a=e.opacity,o=void 0===a?.15:a,s=e.position,u=e.convertToDataUrl,c=void 0!==u&&u,d=e.transferToImage,l=void 0!==d&&d;if(r&&n&&i){o=o||.15,n*=1,i*=1,t.width=n,t.height=i;var h,f=this._getTransformInfo({canvas:t,position:s}),p=t.getContext("2d");if(p.clearRect(0,0,t.width,t.height),p.translate(f.x,f.y),p.rotate(f.rateRadio),this._setBaseLine({ctx:p,position:s}),p.lineWidth=1,p.imageSmoothingEnabled=!0,1==r.length){var v=f.maxWidth/r.length;p.font=v+"px  'Segoe UI'",h=p.measureText(r)}else{var g=16;for(p.font=g+"px  'Segoe UI'",h=p.measureText(r);h.width<f.maxWidth-2*this._getPaddingWidth({ctx:p,position:s,name:r});)g+=1,p.font=g+"px  'Segoe UI'",h=p.measureText(r);if(h.width>f.maxWidth-2*this._getPaddingWidth({ctx:p,position:s,name:r}))if(g>16)g-=1,p.font=g+"px  'Segoe UI'",h=p.measureText(r);else{for(var m=r;r.length>5&&h.width>f.maxWidth-2*this._getPaddingWidth({ctx:p,position:s,name:r+"..."});)r=r.slice(0,r.length-1),h=p.measureText(r+"...");m!==r&&(r+="...")}}var y,_=this._calcTextPos({position:s,ctx:p,name:r,textWidth:h});if(this._drawWatermarkWithShadow({ctx:p,name:r,opacity:o,textPos:_}),c)y=t.toDataURL();else if(l)y=t.transferToImageBitmap();else{var S=p.getImageData(0,0,p.canvas.width,p.canvas.height);y=new Uint8Array(S.data.buffer)}return p.rotate(-f.rateRadio),p.translate(-f.x,-f.y),y}}},{key:"Get_Repeated_WaterMarkRGBA",value:function(e){var t=e.canvas,r=e.name,n=e.width,i=e.height,a=e.opacity,o=void 0===a?.15:a,s=(e.position,e.convertToDataUrl),u=void 0!==s&&s,c=e.transferToImage,d=void 0!==c&&c;if(r&&n&&i){o=o||.15,n*=1,i*=1,t.width=n,t.height=i;var l=t.getContext("2d");l.clearRect(0,0,t.width,t.height),l.translate(n/2,i/2),l.rotate(-21*Math.PI/180),l.imageSmoothingEnabled=!0,l.font="".concat(32,"px 'Segoe UI'"),l.textBaseline="top";var h,f=l.measureText(r),p=.37*f.width,v=0,g=-i;do{var m=v%2==0?p-n:-n;do{l.fillStyle="rgba(0, 0, 0, ".concat(o,")"),l.fillText(r,m,g),l.fillStyle="rgba(255, 255, 255, ".concat(o,")"),l.fillText(r,m+1,g+1),m+=f.width+p}while(m<n);g+=32+p,v++}while(g<i);if(u)h=t.toDataURL();else if(d)h=t.transferToImageBitmap();else{var y=l.getImageData(0,0,l.canvas.width,l.canvas.height);h=new Uint8Array(y.data.buffer)}return l.rotate(21*Math.PI/180),l.translate(-n/2,-i/2),h}}}])},7080:function(e,t,r){r.d(t,{A:function(){return u}});var n=r(1461),i=r(9109),a=r(5408),o={AEWF:"Audio encode WASM failed to download/compile",ADWF:"Audio decode WASM failed to download/compile",VDWF:"Video decode WASM failed to download/compile",VEWF:"Video encode WASM failed to download/compile",SEWF:"Sharing encode WASM failed to download/compile",SDWF:"Sharing decode WASM failed to download/compile",MWCGLF:"WebGL context failed to be restored",VCFF:"Captured video format is not supported",SHHF:"Initialization of sharing decode WASM failed",SDSF:"Sharing decode WebSocket failed to connect after 10 attempts",SEHF:"Initialization of sharing encode WASM failed",SESF:"Sharing encode WebSocket failed to connect after 10 attempts",ADHF:"Initialization of audio decode WASM failed",ADSF:"Audio decode WebSocket failed to connect after 10 attempts",AEHF:"Initialization of audio encode WASM failed",AESF:"Audio encode WebSocket failed to connect after 10 attempts",VDHF:"Initialization of video decode WASM failed",VDSF:"Video decode WebSocket failed to connect after 10 attempts",VEHF:"Initialization of video encode WASM failed",VESF:"Video encode WebSocket failed to connect after 10 attempts",INITVDCERR:"An error occurred when initializing video WebRTC DataChannel",INITADCERR:"An error occurred when initializing audio WebRTC DataChannel"},s=["VCAPTURE","VFCLOSE","VDCS","CPC","VDCR","ADCS","ADCR","VCFOK","VCTN","ABRTT"],u=function(){function e(){this.base_time=null,this.monitor="",this.last_get_monitor_time=0,this.checkIsNecessaryLogMap=new Map,this.highfrequencyerror=new Map,this.startSendLog=!1}return e.prototype={init:function(){this.base_time||(this.base_time=(new Date).getTime(),this.checkIsNecessaryLogMap=new Map,this.add_monitor("STARTMONITOR"+this.base_time))},need_to_flush_log:function(e){return e&&("F"==e[e.length-1]||"f"==e[e.length-1])&&this.startSendLog},append_to_monitor:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e)try{this.monitor&&this.monitor.length+e.length>2e3&&this.send_instant_monitor(),this.monitor?this.monitor+=e:this.monitor=e,t&&this.send_instant_monitor()}catch(e){a.Ay.error("Error when adding data to the monitor log",e)}},add_monitor:function(e,t){if(this.base_time||this.init(),e&&this.checkLogValidity(e))try{if(o[e]){var r=o[e];t&&(r="".concat(r,". Additional information: ").concat(t)),a.Ay.error(r)}var n=(new Date).getTime()-this.base_time,i=e+"("+Math.ceil(n)+")",s=this.need_to_flush_log(e);this.append_to_monitor(i,s)}catch(e){a.Ay.error("Error when adding data to the monitor log",e)}},get_monitor:function(){var e=this.monitor,t=(new Date).getTime();return null!=e&&(e.length>80||t-this.last_get_monitor_time>180)?(this.last_get_monitor_time=t,this.monitor=null,"WCL_M, "+e):""},get_instant_monitor:function(){var e=this.monitor;return this.monitor=null,e?"WCL_M, "+e:null},send_instant_monitor:function(){var e=this.get_instant_monitor();e&&i.A.sendMessageToRwg(n.yGo,{evt:n.UFw,seq:1,body:{data:e}})},send_monitor_directly:function(e){e&&this.checkLogValidity(e)&&i.A.sendMessageToRwg(n.yGo,{evt:n.UFw,seq:1,body:{data:e}})},add_monitor2:function(e){if(this.base_time||this.init(),e&&this.checkLogValidity(e)){var t=e+"("+((new Date).getTime()-this.base_time)+")";this.append_to_monitor(t)}},add_monitor3:function(e){this.base_time||this.init(),e&&this.checkLogValidity(e)&&(this.highfrequencyerror[e]?this.highfrequencyerror[e]+=1:this.highfrequencyerror[e]=1,(0,a.ZN)(this.highfrequencyerror[e])&&this.add_monitor(e,"Occurred ".concat(this.highfrequencyerror[e]," times")))},checkIsNecessaryExceptionLogAndReturnRepeatTimes:function(e){var t=this,r=!0,n=0;try{return this.checkIsNecessaryLogMap.get(e)&&this.checkIsNecessaryLogMap.get(e)%100!=0&&(r=!1),{isNecessary:r,repeatNumber:void 0===(n=this.checkIsNecessaryLogMap.get(e))?0:n}}catch(e){return{isNecessary:!0,repeatNumber:0}}finally{var i=this.checkIsNecessaryLogMap.get(e)||0;if(this.checkIsNecessaryLogMap.set(e,i+1),this.checkIsNecessaryLogMap.size>200){var a=Array.from(this.checkIsNecessaryLogMap.keys()).slice(0,20);console.log("delete log cache keys",a),a.forEach((function(e){return t.checkIsNecessaryLogMap.delete(e)}))}}},reset:function(){this.base_time=null,this.last_get_monitor_time=0,this.monitor="",this.highfrequencyerror.clear()},startSend:function(){this.startSendLog=!0},checkLogValidity:function(e){return!!this.startSendLog||!s.some((function(t){return-1!==e.indexOf(t)}))}},new e}()},8516:function(e,t,r){r.d(t,{X:function(){return i}});var n=r(7857),i=function(){function e(){R(this,e)}return D(e,null,[{key:"addRenderCanvas",value:function(t,r){e.canvasMap.get(t)==r&&null!=r||e.canvasMap.set(t,r)}},{key:"getCanvas",value:function(t){return e.canvasMap.get(t)}},{key:"rmCanvas",value:function(t){e.canvasMap.delete(t)}}])}();(0,n.A)(i,"canvasMap",new Map)},7355:function(e,t,r){r.d(t,{Ek:function(){return u}});var n=r(7857),i=D((function e(){R(this,e),this.rotation=0,this.mirror=!1,this.fillmode=!1,this.context=null,this.canvas=null}),[{key:"initRender",value:function(e){this.canvas=e.canvas,this.context=this.canvas.getContext("2d",{alpha:!1}),this.canvas.width=e.width||1,this.canvas.height=e.height||1}},{key:"drawFromCanvas",value:function(e,t){var r=this.context,n=this.canvas.height,i=this.canvas.width,a=t.x,o=t.y,s=t.width,u=t.height;r.drawImage(e,a,o,s,u,0,0,i,n)}},{key:"draw",value:function(e,t){var r=this.context,n=this.canvas.height,i=this.canvas.width,a=0,o=0,s=t.width,u=t.height;if(1==this.rotation||3==this.rotation){var c=n;n=i,i=c}var d=i,l=n;this.fillmode?s*n>i*u?a=i-(d=Math.floor(n*s/u))>>1:s*n<i*u&&(o=n-(l=Math.floor(i*u/s))>>1):s*n>i*u?(d=i,o=n-(l=Math.floor(d*u/s))>>1):s*n<i*u&&(l=n,a=i-(d=Math.floor(l*s/u))>>1),r.drawImage(e,a,o,d,l)}},{key:"setRotation",value:function(e){this.rotation!=e&&(this.rotation=e,this._transform())}},{key:"setMirror",value:function(e){var t=!!e;this.mirror!=t&&(this.mirror=t,this._transform())}},{key:"setFillModel",value:function(e){var t=!!e;this.fillmode!=t&&(this.fillmode=t,this._transform())}},{key:"setCanvasSize",value:function(e,t){this.canvas.width==e&&this.canvas.height==t||(this.canvas.width=e,this.canvas.height=t,this._transform())}},{key:"_transform",value:function(){var e=this.context,t=this.canvas.width,r=this.canvas.height;switch(this.rotation){case 0:this.mirror?(e.setTransform(-1,0,0,1,0,0),e.translate(-t,0)):(e.setTransform(1,0,0,1,0,0),e.translate(0,0));break;case 1:this.mirror?e.setTransform(0,1,1,0,0,0):(e.setTransform(0,1,-1,0,0,0),e.translate(0,-t));break;case 2:this.mirror?(e.setTransform(1,0,0,-1,0,0),e.translate(0,-r)):(e.setTransform(-1,0,0,-1,0,0),e.translate(-t,-r));break;case 3:this.mirror?(e.setTransform(0,-1,-1,0,0,0),e.translate(-r,-t)):(e.setTransform(0,-1,1,0,0,0),e.translate(-r,0))}}}]),a=r(8516),o=D((function e(t,r){R(this,e),this.id="screenshot_canvas_".concat(Date.now()),this.isoffscreencanvas=r,this.view=new i,this.view.initRender({canvas:t,width:1,height:1}),this.canvas=t,this.screenshottask=[]}),[{key:"_buildPNG",value:function(){var e=this;return this.isoffscreencanvas?this.canvas.convertToBlob({type:"image/png"}):new Promise((function(t,r){try{e.canvas.toBlob((function(e){t(e)}))}catch(e){r(e)}}))}},{key:"destroy",value:function(){this.view=null,this.canvas=null,this.screenshottask.forEach((function(e){e.cancel()})),this.screenshottask.clear()}},{key:"captureFromVideoTag",value:function(){var e=H(O().mark((function e(t,r){var n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.width,i=r.height,this.view.setMirror(r.mirror),this.view.setRotation(0),this.view.setCanvasSize(n,i),this.view.draw(t,r),e.next=7,this._buildPNG();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"captureFromCanvas",value:function(){var e=H(O().mark((function e(t,r){var n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.displayWidth,i=r.displayHeight,this.view.setCanvasSize(n,i),this.view.setMirror(r.mirror),this.view.setRotation(r.rotation),this.view.drawFromCanvas(t,r),e.next=7,this._buildPNG();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"createTask",value:function(e){var t=new s(this);return this.screenshottask.push(t),t.run(e),t}},{key:"setTaskResult",value:function(){var e=H(O().mark((function e(t){var r,n,i,o,s,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!=(r=this.screenshottask.findIndex((function(e){return e.id==t.id})))){e.next=3;break}return e.abrupt("return");case 3:if(n=this.screenshottask.splice(r,1),i=v(n,1),o=i[0],e.prev=4,t.success){e.next=7;break}return e.abrupt("return",void o.error("capture failed"));case 7:return s=a.X.getCanvas(t.data.canvasId),e.next=10,this.captureFromCanvas(s,t.data.options);case 10:u=e.sent,o.setResult(u),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),o.error(e.t0);case 17:case"end":return e.stop()}}),e,this,[[4,14]])})));return function(t){return e.apply(this,arguments)}}()}]);(0,n.A)(o,"target",null);var s=D((function e(){R(this,e),this.resolve=null,this.reject=null,this.promise=null,this.id=Date.now(),this.ended=!1}),[{key:"error",value:function(e){this.ended||(this.ended=!0,this.reject(e))}},{key:"cancel",value:function(){this.ended||(this.ended=!0,this.reject("cancel"))}},{key:"setResult",value:function(e){this.ended||(this.ended=!0,this.resolve(e))}},{key:"get",value:function(){return this.promise}},{key:"run",value:function(e){var t=this;this.promise=new Promise((function(r,n){t.resolve=r,t.reject=n,e.call(null,t.id)}))}}]);function u(){if(!o.target){var e,t="function"==typeof OffscreenCanvas;e=t?new OffscreenCanvas(1,1):document.createElement("canvas"),o.target=new o(e,t)}return o.target}},4666:function(e,t,r){r.r(t),r.d(t,{default:function(){return L}});var n,i,a,o=r(2737),s=r(5408),u=r(9109),c=r(1461),d=r(5740),l=r(7080),h=r(5738),f=r(3323),p=r(2710),g=r(5999),m=r(9338),_=r(242),S=r(3472),b=r(9482),E=r(9373),k=r(701),C=r(5723),w=!1,T=w,I=function(e,t){T===w&&l.A.add_monitor("AB"+e)},M=(n=[],i={},a=Date.now(),function(e){if(e.onlyAudioLevel)i[e.key]||(i[e.key]=[]),i[e.key].push(e.audioLevel);else if(Object.keys(i).forEach((function(t){e.ssrcMap[t]&&(e.ssrcMap[t].zoomAudioLevel=i[t])})),i={},n.push(e),Date.now()-a>14e3){var t=n.reduce((function(e,t,r){var i=t.rtt,a=t.ssrcMap,o="";return Object.keys(a).forEach((function(e,t,s){var u=a[e],c=u.aveAudioLevel,d=u.audioLevel,l=u.jitter,h=u.zoomAudioLevel,p=u.jitterBufferMinimumDelay,v=u.concealedSamples,g=u.concealmentEvents,m=u.insertedSamplesForDeceleration_in_5s,y=u.removedSamplesForAcceleration,_=u.silentConcealedSamples,S=u.audioPlayerStatus,A=u.totalAudioEnergy,b=u.aveJitterBufferDelay_ms,E=u.aveJitterBuffeTargetrDelay_ms,k=u.avePacketsReceived_in_s,C=u.aveBytesReceived_in_s,w=u.totalProcessingDelay_in_5s,T=u.packetsDiscarded_in_5s,R=u.packetsLost_in_5s;o+="".concat(void 0===i?"":i,"|{[SSRCLOG]}|{").concat(e,"}|").concat(S,"|").concat(A.toFixed(4),"|").concat(h.join(""),"|").concat(f.ey(Number(d)),"|").concat(f.ey(Number(c)),"|").concat(1e3*l,"|").concat(b,"|").concat(E,"|").concat(R,"|").concat(k,"|").concat(C,"|").concat(p,"|").concat(T,"|").concat(v,"|").concat(g,"|").concat(m,"|").concat(y,"|").concat(_,"|").concat(w),r===n.length-1&&t===s.length-1||(o+="#")})),e+o}),"WCL_AB,{[DOWNLINK]},");a=Date.now(),t+=",{[END]}",u.A.sendMessageToRwg(c.yGo,{evt:c.UFw,seq:1,body:{data:t}}),i={},n=[]}}),x=function(){var e=[],t=Date.now();return function(r){if(e.push(r),Date.now()-t>14e3){var n="",i="",a=e.reduce((function(t,r,a){var o="";return Object.keys(r).forEach((function(e,t,a){var s=r[e],u=s.rtt,c=void 0===u?"":u,d=s.bytesSentPerSecond,l=s.packetsSent,h=s.audioLevelR16Str,f=void 0===h?"":h,p=s.audioLevelR16DenoiseStr,v=void 0===p?"":p,g=s.targetBitrate,m=void 0===g?"":g,y=s.nackCount,_=void 0===y?"":y,S=s.retransmittedBytesSent,A=void 0===S?"":S,b=s.retransmittedPacketsSent,E=void 0===b?"":b,k=s.audioLevel,C=void 0===k?"":k,w=s.echoReturnLoss,T=void 0===w?"":w,R=s.echoReturnLossEnhancement,I=void 0===R?"":R,D=s.totalAudioEnergy,M=void 0===D?"":D,O=s.totalSamplesDuration,x=void 0===O?"":O;n+=f,i+=v||f,o+="{".concat(e,"}").concat(c,"|").concat(d,"|").concat(l,"|").concat(m,"|").concat(_,"|").concat(A,"|").concat(E,"|").concat(C,"|").concat(T,"|").concat(I,"|").concat(M,"|").concat(x)})),a===e.length-1?o+=",{[SPEECH_R16]},".concat(n,",").concat(i,",{[END]}"):o+="#",t+o}),"WCL_AB,{[UPLINK]},");t=Date.now(),u.A.sendMessageToRwg(c.yGo,{evt:c.UFw,seq:1,body:{data:a}}),e=[]}}}(),P={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",iceServers:[],iceTransportPolicy:"all"},L=D((function e(t,r,n,i,a,o,s,u){var c=this;R(this,e),this.callback=s,this.probe=u,T=!!u||w,this.publisherCandidate=[],this.subscriberCandidate=[],this.retry=0,this.retryPublish=0,this.cid=t,this.wsUrl=r,this.audioPlayerMap=new Map,this.isRetrying=!1,this.recvOnly=!!n,this.audioStream=null,this.audioStreamCloning=null,this.shareAudioStream=null,this.monitorTimer=null,this.audioReportCount=0,this.monitorTimerDuration=1e3,this.monitorInfo={subscriber:{},publisher:{}},this.bitrateInfo={subscriber:{},publisher:{}},this.muted=!1,this.audioMuteStatus=new Map,this.ssrcUserIdMap=new Map,this.published=!1,this.joinAudioAfterConnect=!1,this.audioMode=p.DY,this.codecDoAVSync=!!i,this.normalAudioMap=new Map,this.shareAudioMap=new Map,this.audioProfile=p.yu,this.syncTimer=null,o&&!this.probe&&(this.webRTCWorkletManager=new m.v(this.setNormalAudioStream.bind(this),o)),this.hasPaused=!1,this.recoverAfter1s=null,this.useWebRTCOnDesktop=a,this.receiveAudioStatus=new Map,document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&c.playAllRemoteAudioPlayer(p.vr.VISIBILITY_CHANGE)})),this.isMutedBySystem=!1,this.leaveTime=0,this.noPacketsCount=0,this.lastSentPackets=0,this.useIceServers=!1,this.iceServers=[],this.isAudioSentBytesZero=!1,this.healthCheckFailed=!1,this.audioSpeakerSetErrorCnt=0,this.publishPCPromise=new C.cY,this.subscribPCPromise=new C.cY,this.iceRestartTask=null,this.iceRestartTimeList=[],this.stopIncomingAudioFlag=!1}),[{key:"setIceServers",value:function(e){this.iceServers=e||[]}},{key:"setUseIceServers",value:function(e){this.useIceServers=e}},{key:"playAllRemoteAudioPlayer",value:function(e){var t=this;if(!this.isMutedBySystem&&this.hasPaused&&this.audioMode){var r=Array.from(this.audioPlayerMap.values()).map((function(e){if(e.isPaused())return e.play()}));Promise.all(r).then((function(){t.hasPaused=!1})).catch((function(r){t.hasPaused=!0,I("REA:"),t.notifyUIMessage(c.uoF),s.Ay.error("Error when playAllRemoteAudioPlayer-".concat(e,": "),r)}))}}},{key:"reconnect",value:function(){var e=H(O().mark((function e(t){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isRetrying||this.isDestroyed){e.next=14;break}if(this.stopAVSyncTimer(),this.stopAudioQualityMonitorTimer(),this.destroySocketAndWebRtcConnect(!0),!(this.retry>=3)){e.next=3;break}return e.abrupt("return",(this.isRetrying=!1,s.Ay.error("Audio Bridge failed to reconnect",t),void this.notifyUIMessage(c.ScD)));case 3:return this.isRetrying=!0,e.next=6,o.Ay.sleep(1e3);case 6:if(e.t0=this.isDestroyed,e.t0){e.next=14;break}return I("JOIN"+this.retry),this.retry++,this.notifyUIMessage(c.JoO),e.next=13,this.join(!0);case 13:this.isRetrying=!1;case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"join",value:function(){var e=H(O().mark((function e(t,r){var n,i,a,d,l,f,v,m=this,y=arguments;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=y.length>2&&void 0!==y[2]?y[2]:p.DY)===p.qR)try{this.cleanUserEventListener||(this.cleanUserEventListener=(0,o.zV)((function(){m.playAllRemoteAudioPlayer(p.vr.USER_CLICK)}))),null===(i=this.webRTCWorkletManager)||void 0===i||i.createWebRTCWorklet(),null===(a=this.webRTCWorkletManager)||void 0===a||a.changeAudioStatus(!1,!1),null===(d=this.webRTCWorkletManager)||void 0===d||d.startCheckProcess()}catch(e){s.Ay.error("Error when creating webRTCWorklet",e)}if(this.audioMode=this.audioMode|n,!this.signal){e.next=4;break}return e.abrupt("return",(n!=p.DY&&(this.startAVSyncTimer(),this.startAudioQualityMonitorTimer(),(null===(l=this.signal.socket)||void 0===l?void 0:l.readyState)===WebSocket.OPEN&&this.signal.notify("audiostatus",{status:this.audioMode})),void(n===p.qR&&this.unmuteAllRemoteAudio())));case 4:if(t||!this.isRetrying){e.next=6;break}return e.abrupt("return",void this.destroySocketAndWebRtcConnect(t));case 6:if(this.destroySocketAndWebRtcConnect(t),this.signal=new V,this.audioMode&&this.startAVSyncTimer(),e.prev=7,!r){e.next=12;break}f=r,e.next=18;break;case 12:return I("RTK"),u.A.sendMessageToRwg(c.NPX,{evt:c.rt8},!1),e.next=16,this.waitForTokenFromRWG(c.gh2.AUDIO_BRIDGE_WS_TOKEN);case 16:f=e.sent,I("TK");case 18:this.signal.init("".concat(this.wsUrl,"&token=").concat(f,"&").concat(this.probe?"prob=1":"prob=0")),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(7),this.reconnect(e.t0);case 24:this.signal.onopen(function(){var e=H(O().mark((function e(t){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.audioMode&&(m.signal.notify("audiostatus",{status:m.audioMode}),m.startAudioQualityMonitorTimer()),m.isOpen=!0,m.retryPublish=0,m.clearAudioPlayerMap(),e.next=6,m.publish();case 6:m.retry=0,m.audioMode&&m.notifyUIMessage(c.ETO);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.signal.onclose((function(e){!m.audioMode&&Date.now()-m.leaveTime>=15e3?(m.signal.destroy(),m.signal=null,m.reconnect(e)):(s.Ay.error("socket close, notify UI failover: "+p.dv),m.notifyUIMessage(c.oQY))})),this.signal.onerror((function(e){m.isOpen||s.Ay.error("Audio Bridge WebSocket open error"),!m.audioMode&&Date.now()-m.leaveTime>=15e3?(m.signal.destroy(),m.signal=null,m.reconnect(e)):(s.Ay.error("socket error, notify UI failover: "+p.BY),m.notifyUIMessage(c.oQY))})),this.signal.onmessage((function(e){if("closing"===e.method){var t=e.params.reason;if(t===p.c7?t="0"+(m.publisher.firstConnected?"1":"0"):t===p.y&&(t="1"+(m.subscriber.firstConnected?"1":"0")),("00"===t||"10"===t)&&m.iceServers.length&&!m.useIceServers)return m.setUseIceServers(!0),m.reconnect(t),!0;s.Ay.error("received closing from audioBridge, notify UI failover: "+t);var r="00"===t||"10"===t||m.isIceRestartOutofLimit();return m.notifyUIMessage(c.oQY,{audio:r?p.nm:0,video:0}),("00"==t||"10"==t)&&m.callback("updateConnectionResult",!1),m.callback("destroy"),!0}if("qos"===e.method){var n=e.params;return n.encoding=n.encoding===parseInt(b._c.AUDIO_ENCODE),n.sample_rate=48,n.rate=n.encoding?m.bitrateInfo.publisher.bitrate:m.bitrateInfo.subscriber.bitrate,m.notifyUIMessage(c.iQY,n),!0}return!1})),this.signal.notifyUImessage(this.notifyUIMessage.bind(this)),this.signal.on_notify("command",(function(e){var t=(e||{}).data;if(t)try{var r,n=JSON.parse(t)||{},i=n.evt,a=n.body,o=a.reason,s=void 0===o?0:o,d=a.subReason,l=void 0===d?0:d;i===c.zag&&((null===(r=u.A.shouldKeepAVWhenFailover)||void 0===r?void 0:r.waitingRoom)&&5===s&&1===l||m.destroy(!1))}catch(e){}})),this.signal.UpdateNTP=function(e,t,r,n){if(m.useWebRTCOnDesktop&&m.codecDoAVSync){var i=new ArrayBuffer(16),a=e.toString(2),o=parseInt(a.substring(0,a.length-32),2),s=parseInt(a.substring(a.length-32,a.length),2),u=new DataView(i);u.setUint32(0,r,!0),u.setUint32(4,s,!0),u.setUint32(8,o,!0),u.setUint32(12,Date.now(),!0);var c=new Uint8Array(i);(0,h.Notify_Video_Decode_Thread)({command:"audioDecodeTime",status:1,data:c})}else 512&r?m.shareAudioMap.set(r>>10,{ntptime:e,rtptime:t,abssrc:n}):m.normalAudioMap.set(r>>10,{ntptime:e,rtptime:t,abssrc:n})},this.publisher&&this.removeAudioSender(),v=Object.assign({},P),this.useIceServers&&(s.Ay.directReport("AB_USE_TURN"),v.iceServers=this.iceServers),this.publisher=new RTCPeerConnection(v),this.subscriber=new RTCPeerConnection(v),this.normalAudioSender=null,this.shareAudioSender=null,this.publisher.addTransceiver("audio",{direction:"sendrecv"}),this.publisher.addTransceiver("audio",{direction:"sendrecv"}),this.signal.onOffer=function(){var e=H(O().mark((function e(t){var r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I("RERSDP"),m.updateSsrcUserIdMap(t),e.next=4,m.subscriber.setRemoteDescription(t);case 4:return m.subscriberCandidate.forEach((function(e){return m.subscriber.addIceCandidate(e)})),m.subscriberCandidate=[],e.next=8,m.subscriber.createAnswer();case 8:return(r=e.sent).sdp=m.updateSdpCodecParameters(r.sdp,"opus",new Map([["stereo",1]])),e.next=12,m.subscriber.setLocalDescription(r);case 12:return I("RELSDP"),e.next=15,m.rpc("answer",{desc:r});case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.signal.onTrickle=function(){var e=H(O().mark((function e(t,r){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:0==r?null!=m.subscriber.remoteDescription?(I("RERICE"),m.subscriber.addIceCandidate(t)):(I("RERICEF"),m.subscriberCandidate.push(t)):1==r?null!=m.publisher.remoteDescription?(I("SERICE"),m.publisher.addIceCandidate(t)):(I("SERICEF"),m.publisherCandidate.push(t)):s.Ay.error("Audio Bridge onTrickle error: role: ".concat(r,", candidate: ").concat(t));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),this.publisher.onicecandidate=function(e){var t=e.candidate;I("SELICE"),m.signal.notify("trickle",{candidate:t,role:1})},this.publisher.onconnectionstatechange=H(O().mark((function e(){var t,r,n,i,a;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(I("PCSC:"+m.publisher.connectionState),!m.publisher){e.next=13;break}if("disconnected"!==(r=null===(t=m.publisher)||void 0===t?void 0:t.connectionState)&&"failed"!==r){e.next=6;break}m.iceRestartTask||(m.iceRestartTask=setTimeout(H(O().mark((function e(){var t,r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0="disconnected"!==(null===(t=m.publisher)||void 0===t?void 0:t.connectionState)&&"failed"!==(null===(r=m.publisher)||void 0===r?void 0:r.connectionState),e.t0){e.next=5;break}return(0,k.iK)(c.ZSj,{mediaType:"audio"}),e.next=5,m.publish(!0);case 5:m.iceRestartTask=null;case 6:case"end":return e.stop()}}),e)}))),5e3)),e.next=13;break;case 6:if("connected"!==m.publisher.connectionState||(m.publishPCPromise.resolve(),m.changeSDPAfterConnect&&(m.changeSDPAfterConnect=!1,m.resetOfferandAnswer()),m.notifyUIMessage(c.LYk,{mediaType:"audio"}),m.publisher.firstConnected)){e.next=13;break}return m.publisher.firstConnected=!0,m.callback("updateConnectionResult",!0),e.next=10,null===(n=m.publisher)||void 0===n?void 0:n.getStats();case 10:i=e.sent,a=m.monitorInfo.publisher,null==i||i.forEach((function(e){S.Ay.networkInfoStatisticsParse(i,e,a,"publisher")}));case 13:case"end":return e.stop()}}),e)}))),this.subscriber.onicecandidate=function(e){var t=e.candidate;I("RELICE"),m.signal.notify("trickle",{candidate:t,role:0})},this.subscriber.ontrack=function(e){I("REVT");var t=e.streams[0],r=decodeURIComponent(t.id);e.track.onunmute=function(){m.hasPaused=!0;var e=m.audioPlayerMap.get(r);e?e.setStream(t):(e=new E.A({mediaStream:t,speakerId:_.A.speakerId,mediaType:g.zu.MainAudio,mid:0,nodeId:0,pauseCallback:function(){m.hasPaused=!0,"visible"===document.visibilityState&&null===m.recoverAfter1s&&(m.recoverAfter1s=setTimeout((function(){m.recoverAfter1s=null,m.playAllRemoteAudioPlayer(p.vr.PLAYER_ON_PAUSE)}),1e3))}}),m.audioPlayerMap.set(r,e)),"visible"===document.visibilityState&&null===m.recoverAfter1s&&(m.recoverAfter1s=setTimeout((function(){m.recoverAfter1s=null,m.playAllRemoteAudioPlayer(p.vr.NEW_STREAM)}),1e3)),m.receiveAudioStatus.forEach((function(e,t){m.setShareVolumeLevel(t/10,e.volume,e.isFromMainSession,!1)})),(m.isDestroyed||m.stopIncomingAudioFlag)&&e.mute(),I("REVTP")},e.track.onmute=function(){I("REVTM");var e=m.audioPlayerMap.get(r);e&&e.destroy(),m.audioPlayerMap.delete(r)}},this.subscriber.onconnectionstatechange=H(O().mark((function e(){var t,r,n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(I("SCSC:"+m.subscriber.connectionState),"connected"!==(null===(t=m.subscriber)||void 0===t?void 0:t.connectionState)||(m.subscribPCPromise.resolve(),m.notifyUIMessage(c.LYk,{mediaType:"audio"}),m.subscriber.firstConnected)){e.next=7;break}return m.subscriber.firstConnected=!0,m.callback("updateConnectionResult",!0),e.next=4,null===(r=m.subscriber)||void 0===r?void 0:r.getStats();case 4:n=e.sent,i=m.monitorInfo.subscriber,null==n||n.forEach((function(e){S.Ay.networkInfoStatisticsParse(n,e,i,"subscriber")}));case 7:case"end":return e.stop()}}),e)})));case 27:case"end":return e.stop()}}),e,this,[[7,21]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"notifyUIMessage",value:function(e,t){if(!this.probe&&u.A.Notify_APPUI){if(e===c.oQY){var r;if(u.A.webrtcAudioFailoverCount++,u.A.webrtcAudioFailoverCount<5)s.Ay.error("audioBridge failover times: ".concat(u.A.webrtcAudioFailoverCount));else if(5==u.A.webrtcAudioFailoverCount)s.Ay.error("audioBridge failover 5 times, change to wasm audio"),t={audio:p.nm,video:0};else if(u.A.webrtcAudioFailoverCount>5)return s.Ay.error("audioBridge failover more than 5 times, don't failover again, failover count: ".concat(u.A.webrtcAudioFailoverCount)),void u.A.Notify_APPUI(c.ScD);u.A.supportAVSimultaneousFallback&&null!==(r=t)&&void 0!==r&&r.audio&&(s.Ay.directReport("both audio and video fallback to wasm"),t.video=1)}u.A.Notify_APPUI(e,t)}}},{key:"enableShareToBO",value:function(){var e=H(O().mark((function e(t){var r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,e.prev=1,e.next=4,this.rpc("Enable_Share_To_BO",{enable:t});case 4:r=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),s.Ay.error("Error when enable share to BO",e.t0);case 10:r&&2==r.length?this.notifyUIMessage(c.CcD,{enable:r[1].enable}):this.notifyUIMessage(c.zds,{enable:t});case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"enableBroadCastToBO",value:function(){var e=H(O().mark((function e(t){var r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,e.prev=1,e.next=4,this.rpc("Enable_Broadcast_To_BO",{enable:t});case 4:r=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),s.Ay.error("Error when enable broadcast to bo",e.t0);case 10:r&&2==r.length?this.notifyUIMessage(c.g9q,{enable:r[1].enable}):this.notifyUIMessage(c.LL7,{enable:t});case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"leaveAudioWithoutDisconnect",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p.DY;this.audioMode=this.audioMode&~r,this.signal&&this.signal.notify("audiostatus",{status:this.audioMode}),r===p.qR?(this.setNormalAudioStream(null),this.stopIncomingAudioFlag=!1,this.muteAllRemoteAudio(),this.cleanUserEventListener&&(this.cleanUserEventListener(),this.cleanUserEventListener=null),this.muted=!1,null===(e=this.webRTCWorkletManager)||void 0===e||e.changeAudioStatus(!1,!0),null===(t=this.webRTCWorkletManager)||void 0===t||t.stopCheckProcess()):r===p.$t&&this.setShareAudioStream(null),this.audioMode===p.DY&&(this.leaveTime=Date.now(),this.stopAudioQualityMonitorTimer(),this.stopAVSyncTimer())}},{key:"rpc",value:function(){var e=H(O().mark((function e(t){var r,n=arguments;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.length>1&&void 0!==n[1]?n[1]:[],!this.isDestroyed){e.next=3;break}return e.abrupt("return",(s.Ay.error("audioBridge instance is destroyed, method ".concat(t)),""));case 3:return e.prev=3,e.abrupt("return",this.signal?this.signal.call(t,r):(s.Ay.error("Audio Bridge RPC error: signal is not available,method: ".concat(t)),""));case 7:return e.prev=7,e.t0=e.catch(3),e.abrupt("return",(s.Ay.error("Audio Bridge RPC error: method: ".concat(t,", params: ").concat(r),e.t0),""));case 10:case"end":return e.stop()}}),e,this,[[3,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"publish",value:function(){var e=H(O().mark((function e(t){var r,n,i,a,o,u=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.publisher&&this.isOpen){e.next=2;break}return e.abrupt("return");case 2:if(!t){e.next=7;break}if(r=performance.now(),this.updateIceRestartTime(r),!this.isIceRestartOutofLimit()){e.next=6;break}return e.abrupt("return",void s.Ay.error("ice restart times out of limit"));case 6:this.retryPublish++;case 7:if(t){e.next=11;break}if(!this.published){e.next=10;break}return e.abrupt("return");case 10:this.published=!0;case 11:return e.next=13,this.publisher.createOffer({iceRestart:!!t});case 13:return(n=e.sent).sdp=this.changeOfferSDP(n.sdp),e.next=17,this.publisher.setLocalDescription(n);case 17:return this.uid||t||(this.uid=N()),I("SELSDP"),e.next=21,t?this.rpc("offer",{desc:this.publisher.localDescription}):this.rpc("join",{uid:this.uid,offer:this.publisher.localDescription});case 21:if(!(i=e.sent)||2!==i.length){e.next=32;break}if("answer"!==(a=i[1]).type){e.next=32;break}return I("SERSDP"),a.sdp=this.changeOfferSDP(a.sdp),this.publisherAnswer=a,e.next=30,this.publisher.setRemoteDescription(a);case 30:1===(o=this.publisher.getTransceivers()).length?this.normalAudioSender=o[0].sender:2==o.length&&(o[0].mid<o[1].mid?(this.normalAudioSender=o[0].sender,this.shareAudioSender=o[1].sender):(this.normalAudioSender=o[1].sender,this.shareAudioSender=o[0].sender)),this.setNormalAudioStream(this.audioStream),this.setShareAudioStream(this.shareAudioStream),this.publisherCandidate.forEach((function(e){u.publisher.addIceCandidate(e),I("SERICE")})),this.publisherCandidate=[];case 32:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"resetOfferandAnswer",value:function(){var e=H(O().mark((function e(){var t;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.publisher.createOffer();case 2:if((t=e.sent).sdp=this.changeOfferSDP(t.sdp),!this.publisherAnswer){e.next=10;break}return e.next=6,this.publisher.setLocalDescription(t);case 6:return this.publisherAnswer.sdp=this.changeOfferSDP(this.publisherAnswer.sdp),e.next=9,this.publisher.setRemoteDescription(this.publisherAnswer);case 9:return e.abrupt("return",void this.rpc("Set_AudioProfile",{audioProfile:this.audioProfile}));case 10:s.Ay.log("publisher answer is null when reset offer and answer");case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"waitForTokenFromRWG",value:function(e){return new Promise((function(t,r){d.A.on(e,(function(e,r){t(r)}))}))}},{key:"updateSdpCodecParameters",value:function(e,t,r){try{for(var n=[],i=e.split("\r\n"),a=new RegExp("^a=rtpmap:([0-9]+) ".concat(t,"/")),o=0;o<i.length;o++){var u=i[o].match(a);u&&n.push(u[1])}if(n.length)for(var c=function(e){var t=n.reduce((function(t,r){return i[e].match(new RegExp("^a=fmtp:".concat(r," (.*)")))||t}),null);if(t){var a=new Map(t[1].split(";").map((function(e){return e.split("=")})));r.forEach((function(e,t){e&&a.set(t,e)}));var o,s=i[e].match(/a=fmtp:(\d+)/)[0]+" ",u=A(a);try{for(u.s();!(o=u.n()).done;){var c=v(o.value,2),d=c[0],l=c[1];s+="".concat(d,"=").concat(l,";")}}catch(e){u.e(e)}finally{u.f()}s=s.slice(0,s.length-1),i[e]=s}},d=0;d<i.length;d++)c(d);return i.join("\r\n")}catch(t){return s.Ay.error("Error when updateSdpCodecParameters",t),e}}},{key:"changeOfferSDP",value:function(e){try{for(var t=e.split("m="),r=0,n=[],i=1;i<t.length;i++){if(0===t[i].indexOf("audio")){r++;var a=t[i].match(/a=mid:(\d+)/);a&&n.push(a[1])}t[i]="m="+t[i]}if(1===r)return this.updateSdpCodecParameters(e,"opus",p.gC[this.audioProfile]);if(2!==r||2!=n.length)return s.Ay.error("Audio line invalid: "+r),s.Ay.error("mid line length invalid: "+n.length),e;for(var o="",u=0;u<t.length;u++){if(t[u].startsWith("m=audio"))if(-1!=t[u].indexOf("mid:"+Math.min(n[0],n[1]))){if(t[u]=this.updateSdpCodecParameters(t[u],"opus",p.gC[this.audioProfile]),-1===t[u].indexOf("cname:Normal")){t[u]=t[u].replace(/a=ssrc:(.+) cname:/,"a=ssrc:$1 cname:Normal+");var c=t[u].match(/a=ssrc:(.+) cname:/);c&&c[1]&&(this.normalAudioSSRC=c[1])}}else t[u].indexOf("mid:"+Math.min(n[0],n[1]))&&(t[u]=this.updateSdpCodecParameters(t[u],"opus",p.gC[p.x_]),-1===t[u].indexOf("cname:Share")&&(t[u]=t[u].replace(/a=ssrc:(.+) cname:/,"a=ssrc:$1 cname:Share+")));o+=t[u]}return o}catch(t){return s.Ay.error("Error when changeOfferSDP",t),e}}},{key:"setRecvOnly",value:function(e,t){this.recvOnly=!!e,this.recvOnly?this.setNormalAudioStream(null):t&&this.setNormalAudioStream(t)}},{key:"setCodecDoAVSync",value:function(e){this.codecDoAVSync=e}},{key:"getFinalSentAudioStream",value:function(){return this.webRTCWorkletManager&&this.webRTCWorkletManager.doingDenoise&&this.webRTCWorkletManager.getAudioStream()||this.audioStream}},{key:"setNormalAudioStream",value:function(e){var t;arguments.length>1&&void 0!==arguments[1]&&arguments[1]||(this.recvOnly?this.audioStream=null:this.audioStream=e),this.resetAudioTrackState(this.audioStream),this.setAudioStreamCloning(this.audioStream),this.webRTCWorkletManager&&(this.webRTCWorkletManager.doingDenoise?this.webRTCWorkletManager.setAudioStream(this.audioStream):this.webRTCWorkletManager.setAudioStream(this.audioStreamCloning||this.audioStream)),(t=this.getFinalSentAudioStream())&&(this.muted?this.mute():this.unmute()),this.publishAudioStream(t,this.normalAudioSender,"PAT")}},{key:"setShareAudioStream",value:function(e){this.shareAudioStream=e,this.publishAudioStream(this.shareAudioStream,this.shareAudioSender,"PAST")}},{key:"publishAudioStream",value:function(e,t,r){this.isDestroyed||(t?e?e.getAudioTracks().forEach((function(e){s.Ay.log("publish track label: "+e.label),I("".concat(r,"-").concat(e.id)),t.replaceTrack(e).catch((function(t){I("".concat(r,"-Failed-").concat(e.id)),s.Ay.error("error publishing audio stream",t)}))})):(t.replaceTrack(null),I("".concat(r,"-null"))):I(r+"SE "))}},{key:"mute",value:function(){this.muted=!0;var e,t=this.getFinalSentAudioStream();t&&(I("SEVTP"),t.getAudioTracks().forEach((function(e){e.enabled=!1})),null===(e=this.webRTCWorkletManager)||void 0===e||e.changeAudioStatus(!0,!1))}},{key:"unmute",value:function(){this.muted=!1;var e,t=this.getFinalSentAudioStream();t&&(I("SEVTM"),t.getAudioTracks().forEach((function(e){e.enabled=!0})),null===(e=this.webRTCWorkletManager)||void 0===e||e.changeAudioStatus(!1,!1))}},{key:"stopIncomingAudio",value:function(e){this.stopIncomingAudioFlag=!!e,e?this.muteAllRemoteAudio():this.unmuteAllRemoteAudio()}},{key:"muteAllRemoteAudio",value:function(){var e,t=A(this.audioPlayerMap);try{for(t.s();!(e=t.n()).done;){var r=v(e.value,2);r[0],r[1].mute()}}catch(e){t.e(e)}finally{t.f()}}},{key:"unmuteAllRemoteAudio",value:function(){var e,t=A(this.audioPlayerMap);try{for(t.s();!(e=t.n()).done;){var r=v(e.value,2);r[0],r[1].unmute()}}catch(e){t.e(e)}finally{t.f()}this.playAllRemoteAudioPlayer(p.vr.UNMUTE_ALL)}},{key:"setAudioStreamCloning",value:function(e){this.destroyAudioStream(this.audioStreamCloning),this.audioStreamCloning=null;try{if(!e)return;if(!this.webRTCWorkletManager.doingDenoise){this.audioStreamCloning=e.clone();var t=this.audioStreamCloning.getAudioTracks()[0];t&&(I("CATRS:"+t.readyState+":"+t.id),I("CATMS:"+t.muted+":"+t.id),I("CATES:"+t.enabled+":"+t.id))}}catch(e){s.Ay.error("Error when cloning audio stream, ",e)}}},{key:"destroyAudioStream",value:function(e){e&&e.getTracks().forEach((function(e){e.stop()}))}},{key:"setSpeechVolumeLevel",value:function(e,t){var r,n=A(this.audioPlayerMap);try{for(n.s();!(r=n.n()).done;){var i=v(r.value,2),a=i[0],o=i[1];if(-1===a.indexOf("OS")){var s=Number(a.split("+")[0]||"0"),u=Number.isNaN(s)||!s?null:s>>10<<10;if(u&&u===e>>10<<10){o.setVolume(t);break}}}}catch(e){n.e(e)}finally{n.f()}}},{key:"changeSpeaker",value:function(){var e=H(O().mark((function e(t){var r,n,i,a,o,u,d,l,h,f,p,g;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,i="",a=k.Lg.BROWSER_ERROR,o=Date.now(),u=[],d=A(this.audioPlayerMap),e.prev=2,d.s();case 4:if((l=d.n()).done){e.next=13;break}if((h=v(l.value,2))[0],!1!==(f=h[1]).isSupportSetSpeakerDevice()){e.next=9;break}return n=!1,a=k.Lg.UNSUPPORTED_BROWSER,i="audioplayer.setSinkId is not supported on your device.",e.abrupt("break",13);case 9:p=f.setSpeakerDevicePromise(t),u.push(p);case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),d.e(e.t0);case 18:return e.prev=18,d.f(),e.finish(18);case 21:return e.prev=21,e.next=24,Promise.all(u);case 24:e.next=29;break;case 26:e.prev=26,e.t1=e.catch(21),n=!1,r=e.t1,i="Error when setting sink of audio player: "+e.t1.message;case 29:n?(this.audioSpeakerSetErrorCnt=0,this.notifyUIMessage(c.a6z,t||"default")):(this.audioSpeakerSetErrorCnt++,g=_.A.getSpeakerId(),s.Ay.error("setSinkId failed ".concat(this.audioSpeakerSetErrorCnt," times, current speaker ").concat(g,", errorMessgae = ").concat(i)),this.audioSpeakerSetErrorCnt<=3&&this.notifyUIMessage(c.dsK,{errorMessgae:i,currentSink:g,error:r,errorCode:a})),_.A.updateSelectedSpeakerDevices(t,Date.now()-o,n);case 31:case"end":return e.stop()}}),e,this,[[2,15,18,21],[21,26]])})));return function(t){return e.apply(this,arguments)}}()},{key:"setShareVolumeLevel",value:function(e,t,r){(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])&&this.receiveAudioStatus.set(10*e+(r?1:0),{volume:t,isFromMainSession:r});var n,i=r?/(\d+)\+OS/:/(\d+)\+CS/,a=A(this.audioPlayerMap);try{for(a.s();!(n=a.n()).done;){var o=v(n.value,2),s=o[0],u=o[1],c=s.match(i);c&&c.length>=2&&c[1]>>10===e&&512&c[1]&&(t?u.unmute():u.mute())}}catch(e){a.e(e)}finally{a.f()}}},{key:"set_CC_lang",value:function(){var e=H(O().mark((function e(t){var r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,e.prev=1,e.next=4,this.rpc("set_CC_lang",{lang:t});case 4:r=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),s.Ay.error("error when setting language",e.t0);case 10:r&&2===r.length?this.notifyUIMessage(c.V5N,r[1].lang):this.notifyUIMessage(c.i3D,t);case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"updateSsrcUserIdMap",value:function(e){var t=this;if(e){var r=e.sdp,n=(void 0===r?"":r).match(/a=ssrc:(.+) cname:(.+)/g);n&&n.forEach((function(e){var r=e.match(/a=ssrc:(.+) cname:(.+)/);if(r&&r[1]&&r[2]){var n=Number(r[2].split("+")[0]||"0"),i=Number.isNaN(n)||!n?null:n>>10<<10,a=Number(r[1]);t.ssrcUserIdMap.set(a,i)}}))}}},{key:"updateUserMuteUnmuteStatus",value:function(e){var t=this,r=e.update,n=e.remove;r&&r.length>0&&r.forEach((function(e){var r=e.userId,n=e.muted;r&&t.audioMuteStatus.set(r>>10<<10,!!n)})),n&&n.length>0&&n.forEach((function(e){var r=e.userId;r&&t.audioMuteStatus.set(r>>10<<10,!0)}))}},{key:"isUserMuted",value:function(e){var t=this.ssrcUserIdMap.get(e);if(!t)return!1;var r=this.audioMuteStatus.get(t);return void 0!==r&&!!r}},{key:"setAudioProfile",value:function(){var e=H(O().mark((function e(t){var r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.audioMode===p.qR||this.audioMode==p.$2){e.next=2;break}return e.abrupt("return");case 2:if(r=this.audioProfile,"backgroundNoiseSuppression"===t.currentSelect?(t.highBitrate?this.audioProfile=p.$A:this.audioProfile=p.yu,_.A.changeDenoiseSwitch("Zoom"===t.backgroundNoiseSuppression)):(_.A.changeDenoiseSwitch(!1),t.originalSound.highfidelity&&t.originalSound.stereo?this.audioProfile=p.IA:t.originalSound.highfidelity?this.audioProfile=p.hc:t.originalSound.stereo?this.audioProfile=p.Hc:this.audioProfile=p.ej),e.t0=r!==this.audioProfile,!e.t0){e.next=12;break}if(!this.publisher||"connected"!==this.publisher.connectionState){e.next=11;break}return e.next=9,this.resetOfferandAnswer();case 9:e.next=12;break;case 11:this.changeSDPAfterConnect=!0;case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"resetAudioTrackState",value:function(e){e&&e.getAudioTracks().forEach((function(e){e.enabled=!0}))}},{key:"clearAudioPlayerMap",value:function(){this.muteAllRemoteAudio();var e,t=A(this.audioPlayerMap);try{for(t.s();!(e=t.n()).done;){var r=v(e.value,2);r[0],r[1].destroy()}}catch(e){t.e(e)}finally{t.f()}this.audioPlayerMap.clear(),this.audioMuteStatus.clear()}},{key:"getAudioPlayer",value:function(e){var t=(2+(parseInt(e)>>10<<10)).toString();if(t){var r,n=A(this.audioPlayerMap);try{for(n.s();!(r=n.n()).done;){var i=v(r.value,2),a=i[0];if(i[1],a.includes(t))return this.audioPlayerMap.get(a)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"updateIceRestartTime",value:function(e){if(this.iceRestartTimeList.length<=3)this.iceRestartTimeList.push(e);else{var t=Math.min.apply(Math,y(this.iceRestartTimeList)),r=this.iceRestartTimeList.indexOf(t);this.iceRestartTimeList[r]=e}}},{key:"isIceRestartOutofLimit",value:function(){return this.iceRestartTimeList.length>=4&&Math.max.apply(Math,y(this.iceRestartTimeList))-Math.min.apply(Math,y(this.iceRestartTimeList))<9e4}},{key:"removeAudioSender",value:function(){this.normalAudioSender&&(this.publisher.removeTrack(this.normalAudioSender),this.normalAudioSender=null),this.shareAudioSender&&(this.publisher.removeTrack(this.shareAudioSender),this.shareAudioSender=null)}},{key:"destroySocketAndWebRtcConnect",value:function(e){this.published=!1;try{this.removeAudioSender()}catch(e){}this.iceRestartTask&&(clearTimeout(this.iceRestartTask),this.iceRestartTask=null),this.iceRestartTimeList=[],this.publisher&&(this.publisher.close(),this.publisher=null),this.subscriber&&(this.subscriber.close(),this.subscriber=null),this.isOpen=!1,e||(this.retry=0),this.retryPublish=0,this.signal&&(this.signal.destroy(),this.signal=null),this.ssrcUserIdMap.clear()}},{key:"destroy",value:function(){I("DS"),this.isDestroyed=!0,this.cleanUserEventListener&&(this.cleanUserEventListener(),this.cleanUserEventListener=null),this.stopAudioQualityMonitorTimer(),this.stopAVSyncTimer(),this.webRTCWorkletManager&&(this.webRTCWorkletManager.destroy(),this.webRTCWorkletManager=null),this.setNormalAudioStream(null),this.setShareAudioStream(null),this.clearAudioPlayerMap(),this.destroySocketAndWebRtcConnect(),this.recvOnly=!1}},{key:"startAudioQualityMonitorTimer",value:function(){var e=this;this.audioReportCount=0,this.stopAudioQualityMonitorTimer(),this.monitorTimer=setInterval((function(){e._publisherStatsParse(e.audioReportCount),e._subscriberStatsParse(e.audioReportCount),e.audioReportCount++}),this.monitorTimerDuration)}},{key:"stopAudioQualityMonitorTimer",value:function(){var e,t,r,n,i,a;this.monitorTimer&&(clearInterval(this.monitorTimer),this.monitorTimer=null,this.audioReportCount=0,this.monitorInfo={subscriber:{port:null===(e=this.monitorInfo)||void 0===e||null===(e=e.subscriber)||void 0===e?void 0:e.port,protocol:null===(t=this.monitorInfo)||void 0===t||null===(t=t.subscriber)||void 0===t?void 0:t.protocol,candidateType:null===(r=this.monitorInfo)||void 0===r||null===(r=r.subscriber)||void 0===r?void 0:r.candidateType},publisher:{port:null===(n=this.monitorInfo)||void 0===n||null===(n=n.publisher)||void 0===n?void 0:n.port,protocol:null===(i=this.monitorInfo)||void 0===i||null===(i=i.publisher)||void 0===i?void 0:i.protocol,candidateType:null===(a=this.monitorInfo)||void 0===a||null===(a=a.publisher)||void 0===a?void 0:a.candidateType}},this.bitrateInfo={publisher:{},subscriber:{}})}},{key:"setStreamAsync",value:function(){var e=H(O().mark((function e(t){var r=this,n=arguments;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n.length>1&&void 0!==n[1]&&n[1]?this.setShareAudioStream(t):this.setNormalAudioStream(t),new Promise((function(e,t){r.published?e(!0):r.publish().then((function(){e(!1)}))}))));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopAVSyncTimer",value:function(){this.syncTimer&&(clearInterval(this.syncTimer),this.syncTimer=null)}},{key:"syncSingleView",value:function(e,t){var r=0;if(t){var n=parseInt(t).toString(2),i=n.substring(0,n.length-32),a=n.substring(n.length-32,n.length);r=1e3*(i=parseInt(i,2))+232.8*(a=parseInt(a,2))/1e9}0==u.A.mediaSDKHandle.RenderInMain?e?(0,h.Notify_Sharing_Decode_Thread)({command:"audioTimestamp",data:r}):(0,h.Notify_Video_Decode_Thread)({command:"audioDecodeTime",status:0,data:r}):e?u.A.mediaSDKHandle.SharingRenderObj&&u.A.mediaSDKHandle.SharingRenderObj.SetcATimeStamp(r):u.A.CurrentSSRCTime!=r&&(u.A.CurrentSSRCTime=r,u.A.audioPlayTime=Date.now())}},{key:"startAVSyncTimer",value:function(){var e=this;this.stopAVSyncTimer(),this.syncTimer=setInterval((function(){if(e.subscriber){var t=0;e.subscriber.getReceivers().forEach((function(r){r.getSynchronizationSources().forEach((function(r){t++;var n=e.ssrcUserIdMap.get(r.source),i=null,a=!1;if((i=e.shareAudioMap.get(n>>10))&&i.abssrc===r.source?a=!0:i=e.normalAudioMap.get(n>>10),i){var o=i.ntptime,s=i.rtptime,c=o+(r.rtpTimestamp-s)*Math.pow(2,32)/48e3;e.codecDoAVSync||n>>10!=u.A.CurrentSSRC>>10&&!a||r.source===i.abssrc&&e.syncSingleView(a,c)}}))})),0===t&&(e.syncSingleView(!1,0),e.syncSingleView(!0,0))}}),500)}},{key:"_publisherStatsParse",value:function(){var e=H(O().mark((function e(t){var r,n,i,a,o,s,u,c,d,l,h=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(t%5),a=this.showQos&&!(t%1),this.publisher){e.next=3;break}return e.abrupt("return");case 3:if(i||a){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,this.publisher.getStats();case 7:if(o=e.sent){e.next=10;break}return e.abrupt("return");case 10:if(a&&S.Ay.outboundBitrateQosParse(o,this.bitrateInfo.publisher),i){e.next=12;break}return e.abrupt("return");case 12:s={},u=this.monitorInfo.publisher,o.forEach((function(e){if("remote-inbound-rtp"===e.type)S.Ay.remoteInboundRTPStatisticParse(g.zu.MainAudio,e,h.audioMode,s,u);else if("outbound-rtp"===e.type)S.Ay.outboundRTPStatisticsParse(h.getUplinkMid2MediaType(e.ssrc),e,h.audioMode,s,u);else if("media-source"===e.type){var t=h.getFinalSentAudioStream();S.Ay.mediaSourceStatisticsParse(t,e,h.audioMode,s,u)}})),this.handleNetworkQuality(0,null===(r=s[g.zu.MainAudio])||void 0===r?void 0:r.rtt),this.handleNoAudioPackets(null===(n=s[g.zu.MainAudio])||void 0===n?void 0:n.packetsSent),this.webRTCWorkletManager&&s[g.zu.MainAudio]&&(c=this.webRTCWorkletManager.getLevelR16Log(),d=c.resLevelR16Log,l=c.resLevelR16LogDenoise,s[g.zu.MainAudio].audioLevelR16Str=d,s[g.zu.MainAudio].audioLevelR16DenoiseStr=l),x(s);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_subscriberStatsParse",value:function(){var e=H(O().mark((function e(t){var r,n,i,a,o,s,u,c,d=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.subscriber){e.next=2;break}return e.abrupt("return");case 2:return n=!(t%5),i=!(t%1),a=this.showQos&&!(t%1),e.next=7,this.subscriber.getStats();case 7:if(o=e.sent){e.next=10;break}return e.abrupt("return");case 10:s={ssrcMap:{}},a&&S.Ay.inboundBitrateQosParse(o,null===(r=this.bitrateInfo)||void 0===r?void 0:r.subscriber),u=!1,c=this.monitorInfo.subscriber,o.forEach((function(e){n&&(d._subscriberCandidatePairParse(e,s),u=!0),u=d._subscriberInboundRTPParse(e,s,c,i&&!n)||u})),n&&this.handleNetworkQuality(1,s.rtt),u&&M(s);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_subscriberCandidatePairParse",value:function(e,t){var r=this.monitorInfo.subscriber,n=e.totalRoundTripTime,i=e.responsesReceived,a=e.type,o=e.state,s=e.nominated;if("candidate-pair"===a&&"succeeded"===o&&s){r.prevStatInfo||(r.prevStatInfo={responsesReceived:i,totalRoundTripTime:n},r.ssrcMap={});var u=r.prevStatInfo;Object.assign(t,{rtt:Math.floor(1e3*(i===u.responsesReceived?0:(n-u.totalRoundTripTime)/(i-u.responsesReceived)))}),Object.assign(r.prevStatInfo,{totalRoundTripTime:n,responsesReceived:i})}}},{key:"_subscriberInboundRTPParse",value:function(e,t,r,n){var i;if("inbound-rtp"===e.type){var a=e.totalAudioEnergy,o=e.timestamp,s=e.jitterBufferDelay,u=e.jitterBufferEmittedCount,c=e.jitterBufferMinimumDelay,d=e.jitterBufferTargetDelay,l=e.ssrc,h=e.jitter,p=e.audioLevel,v=e.packetsLost,g=e.packetsDiscarded,m=e.packetsReceived,y=e.bytesReceived,_=e.concealedSamples,S=e.concealmentEvents,A=e.insertedSamplesForDeceleration,b=e.removedSamplesForAcceleration,E=e.silentConcealedSamples,k=e.totalProcessingDelay,C=this.ssrcUserIdMap.get(l);if(M({key:"".concat(l,"-").concat(C),audioLevel:f.ey(p),onlyAudioLevel:!0}),n)return!1;r.ssrcMap||(r.ssrcMap={});var w=r.ssrcMap[l];if(w){if(C){var T;i=!0;var R=Math.sqrt((a-w.totalAudioEnergy)/(o-w.timestamp)).toFixed(4),I=-1;"number"==typeof p&&(I=p.toFixed(4));var D=this.calculateRate(w.jitterBufferDelay,w.jitterBufferEmittedCount,s,u,1),O=this.calculateRate(w.jitterBufferTargetDelay,w.jitterBufferEmittedCount,d,u,1),x=this.calculateRate(w.packetsReceived,w.timestamp,m,o),P=this.calculateRate(w.bytesReceived,w.timestamp,y,o),L=this.calculateRate(w.totalProcessingDelay,0,k,1,1),N=this.calculateRate(w.packetsDiscarded,0,g,1,1),V=this.calculateRate(w.insertedSamplesForDeceleration,0,A,1,1),U=this.calculateRate(w.packetsLost,0,v,1,1);t.ssrcMap["".concat(l,"-").concat(C)]=Object.assign(t.ssrcMap["".concat(l,"-").concat(C)]||{},{aveAudioLevel:R<1e-4?0:R,audioLevel:I<1e-4?0:I,jitter:h,jitterBufferMinimumDelay:c,concealedSamples:_,concealmentEvents:S,insertedSamplesForDeceleration_in_5s:V,removedSamplesForAcceleration:b,silentConcealedSamples:E,audioPlayerStatus:null!==(T=this.getAudioPlayer(C))&&void 0!==T&&T.isPaused()?0:1,totalAudioEnergy:a,aveJitterBufferDelay_ms:D,aveJitterBuffeTargetrDelay_ms:O,avePacketsReceived_in_s:x,aveBytesReceived_in_s:P,totalProcessingDelay_in_5s:L,packetsDiscarded_in_5s:N,packetsLost_in_5s:U})}}else w=r.ssrcMap[l]={},i=!1;this.isUserMuted(l)||!this.ssrcUserIdMap.has(l)?r.ssrcMap[l]=null:Object.assign(w,{totalAudioEnergy:a,timestamp:o,jitterBufferDelay:s,jitterBufferEmittedCount:u,packetsLost:v,packetsReceived:m,bytesReceived:y,jitterBufferTargetDelay:d,totalProcessingDelay:k,insertedSamplesForDeceleration:A,packetsDiscarded:g})}return i}},{key:"getHealthCheckFailedAndReset",value:function(){return!!this.healthCheckFailed&&(this.healthCheckFailed=!1,!0)}},{key:"handleNoAudioPackets",value:function(e){this.audioMode!=p.qR||!this.audioStream||this.muted||(e||0)-this.lastSentPackets!=0||this.isMutedBySystem?(this.audioMode==p.qR&&this.audioStream&&1==this.isAudioSentBytesZero&&(e||0)-this.lastSentPackets>0&&(I("HEALTH_CHECK_RESTORED"),u.A.Notify_APPUI_SAFE(c.FjO)),this.isAudioSentBytesZero=!1,this.noPacketsCount=0,this.lastSentPackets=e||0):(this.noPacketsCount++,2===this.noPacketsCount&&0==this.isAudioSentBytesZero&&(I("HEALTH_CHECK_FAILED"),(0,k.iK)(c.$qV,p.Mm),this.healthCheckFailed=!0,this.isAudioSentBytesZero=!0,this.noPacketsCount=0))}},{key:"handleNetworkQuality",value:function(e,t){this.audioMode==p.qR&&this.audioStream&&t&&(t>5e3?u.A.Notify_APPUI_SAFE(c.Joy,{isUplink:0===e,networkLevel:p.tT.NET_QUALITY_VERY_BAD,bwLevel:p.LA.NET_BW_LEVEL_VERY_LOW}):t>2e3&&u.A.Notify_APPUI_SAFE(c.Joy,{isUplink:0===e,networkLevel:p.tT.NET_QUALITY_BAD,bwLevel:p.LA.NET_BW_LEVEL_LOW}))}},{key:"calculateRate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e3;return e===r||t===n?0:Math.floor(i*(r-e)/(n-t))}},{key:"changeDenoiseSwitch",value:function(e,t){var r;this.denoiseSwitch=e,this.isHeadSet=t,null===(r=this.webRTCWorkletManager)||void 0===r||r.changeDenoiseSwitch(e,t)}},{key:"updateQos",value:function(e){this.showQos=e.enable,this.signal&&this.signal.notify("qos",{enable:e.enable,encoding:parseInt(e.workerType),pollingInterval:e.pollingInterval})}},{key:"getConnectionId",value:function(){return this.cid}},{key:"getUplinkMid2MediaType",value:function(e){return e.toString()===this.normalAudioSSRC?g.zu.MainAudio:g.zu.ShareAudio}},{key:"getAudioPromise",value:function(e){return e===b._c.AUDIO_DECODE?this.subscribPCPromise.promise:e===b._c.AUDIO_ENCODE?this.publishPCPromise.promise:void 0}}]);function N(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function V(){var e=this;this.onOffer,this.isDestroyed=!1,this.heartBeatDetection=null,this.onopen=function(e){this._onopen=e},this.onclose=function(e){this._onclose=e},this.onerror=function(e){this._onerror=e},this.onmessage=function(e){this._onmessage=e},this.notifyUImessage=function(e){this.notifyUIMessage=e},this.init=function(e){var t=this;I("INIT: ".concat(e)),this.socket=window.audioBridgeSignal=(0,o.Gj)(e),this._notifyhandlers={},this.socket.addEventListener("open",(function(){I("WSO"),t.lastMessageTimeStamp=performance.now(),t.socket.isRlb||(t.ping(),t.heartBeatDetection&&(clearTimeout(t.heartBeatDetection),t.heartBeatDetection=null),t.heartBeatDetection=setTimeout(function e(){var t;if(!this.isDestroyed&&1===(null===(t=this.socket)||void 0===t?void 0:t.readyState)){var r=performance.now()-this.lastMessageTimeStamp;r>32e3?(I("WST"),s.Ay.error("didn't reveive message from websocket in the last 30s, notify UI failover, duration:  "+r),(0,k.iK)(c.oQY)):this.heartBeatDetection=setTimeout(e.bind(this),2e3)}}.bind(t),2e3)),t._onopen&&t._onopen()})),this.socket.addEventListener("error",(function(e){t.isDestroyed||(s.Ay.directReport("Audio Bridge WebSocket received error"),I("WSE"),t._onerror&&t._onerror(e||!0))})),this.socket.addEventListener("close",(function(e){t.isDestroyed||(s.Ay.directReport("Audio Bridge WebSocket close"),I("WSC"),t._onclose&&t._onclose(e||!0))})),this.socket.addEventListener("message",function(){var e=H(O().mark((function e(r){var n,i,a,o;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.lastMessageTimeStamp=performance.now(),n=JSON.parse(r.data),i=!1,t._onmessage&&(i=t._onmessage(n)),i||("offer"===n.method?t.onOffer&&t.onOffer(n.params):"trickle"===n.method?t.onTrickle&&t.onTrickle(n.params.candidate,n.params.role):"rtcpsr"===n.method?t.UpdateNTP(n.params.ntptime,n.params.rtptime,n.params.ssrc,n.params.abssrc):"pong"===n.result?(a=parseInt(performance.now())-n.id,I("RTT: "+a)):(o=t._notifyhandlers[n.method])&&o(n.params));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},this.on_notify=function(e,t){this._notifyhandlers[e]=t},this.notify=function(e,t,r){var n;this.isDestroyed?s.Ay.error("audioBridge instance is destroyed, method ".concat(e)):this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(JSON.stringify({method:e,params:t,id:r})):s.Ay.error("Websocket is not open: ".concat(this.socket.readyState,", ").concat(null===(n=this.socket)||void 0===n?void 0:n.url))},this.call=function(){var e=H(O().mark((function e(t,r){var n,i,a=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=N(),!this.socket||this.socket.readyState!==WebSocket.OPEN){e.next=3;break}return e.abrupt("return",(this.socket.send(JSON.stringify({method:t,params:r,id:n})),new Promise((function(e,t){var r=function(t){var i=JSON.parse(t.data);i.id===n&&(i.error?e(i):e(i.result),a.socket.removeEventListener("message",r))};a.socket.addEventListener("message",r)}))));case 3:s.Ay.error("Websocket is not open: ".concat(this.socket.readyState,", ").concat(null===(i=this.socket)||void 0===i?void 0:i.url));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),this.ping=function(){e.notify("ping",{},parseInt(performance.now())),e.pingTimeout&&clearTimeout(e.pingTimeout),e.pingTimeout=setTimeout((function(){e.ping()}),1e4)},this.destroy=function(){e.isDestroyed=!0,e.pingTimeout&&(clearTimeout(e.pingTimeout),e.pingTimeout=null),e.heartBeatDetection&&(clearTimeout(e.heartBeatDetection),e.heartBeatDetection=null),e.socket&&e.socket.close&&e.socket.close(3456,"close socket when destroy signal")}}},3472:function(e,t,r){r.d(t,{Ay:function(){return f},PV:function(){return l},U1:function(){return c},Yo:function(){return u},lo:function(){return s},py:function(){return d}});var n=r(5408),i=r(2710),a=r(7080),o=r(5999),s=function(e,t){return a.A.add_monitor("AB"+e)},u=function(e,t){return a.A.add_monitor("AB"+e)},c=function(){},d=function(e,t){return n.Ay.error("[WMSC_Audio] ".concat(e),t)},l=function(e){return n.Ay.log("[WMSC_Audio] ".concat(e))};function h(e,t){return"number"!=typeof e?0:parseFloat(e.toFixed(t)).toString()}var f=D((function e(){R(this,e)}),null,[{key:"getReportKeyFromSSRC",value:function(e,t){if(e)return t.ssrc.toString()===e?o.zu.MainAudio:o.zu.ShareAudio}},{key:"isAudioSharing",value:function(e){return e&i.$t}},{key:"isAudioStat",value:function(e){return"audio"===e.kind}},{key:"remoteInboundRTPStatisticParse",value:function(e,t,r,n,i){e&&(e!=o.zu.ShareAudio||this.isAudioSharing(r))&&void 0!==t.roundTripTime&&(n[e]||(n[e]={}),n[e].rtt=Math.floor(1e3*t.roundTripTime))}},{key:"outboundRTPStatisticsParse",value:function(e,t,r,n,i){if(e&&(e!=o.zu.ShareAudio||this.isAudioSharing(r))){n[e]||(n[e]={});var a=t.timestamp,s=t.bytesSent,u=t.packetsSent,c=t.nackCount,d=t.retransmittedBytesSent,l=t.retransmittedPacketsSent,h=t.targetBitrate;t.totalPacketSendDelay,i[e]||(i[e]={lastBytesSent:s,lastTimeStamp:a});var f=i[e],p=f.lastTimeStamp,v=f.lastBytesSent;n[e].bytesSentPerSecond=Math.floor(a-p?1e3*(s-v)/(a-p):0),n[e].packetsSent=u,n[e].nackCount=c,n[e].retransmittedBytesSent=d,n[e].retransmittedPacketsSent=l,n[e].targetBitrate=h/1e3+"k",Object.assign(i[e],{lastBytesSent:s,lastTimeStamp:a})}}},{key:"outboundBitrateQosParse",value:function(e,t){var r=this,n=0;e.forEach((function(e){if(r.isAudioStat(e)&&"outbound-rtp"===e.type){var i=e.bytesSent,a=e.timestamp,o=t[e.ssrc]||{},s=o.lastBytesSent,u=o.lastTimestamp;i&&a&&s&&u&&(n+=r.calculateBitrates(s,u,i,a)),t[e.ssrc]={lastBytesSent:i,lastTimestamp:a}}})),t.bitrate=n.toFixed(1)}},{key:"inboundBitrateQosParse",value:function(e,t){var r=this,n=0;e.forEach((function(e){if(r.isAudioStat(e)&&"inbound-rtp"===e.type){var i=e.bytesReceived,a=e.timestamp,o=t[e.ssrc]||{},s=o.lastBytesReceived,u=o.lastTimestamp;i&&a&&s&&u&&(n+=r.calculateBitrates(s,u,i,a)),t[e.ssrc]={lastBytesReceived:i,lastTimestamp:a}}})),t.bitrate=n.toFixed(1)}},{key:"calculateBitrates",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return e===r||parseInt(t)===parseInt(n)?0:8e3*(r-e)/(n-t)}},{key:"mediaSourceStatisticsParse",value:function(e,t,r,n,i){var a,s=t.trackIdentifier==(null==e||null===(a=e.getAudioTracks()[0])||void 0===a?void 0:a.id)?o.zu.MainAudio:o.zu.ShareAudio;if(s&&(s!=o.zu.ShareAudio||this.isAudioSharing(r))){n[s]||(n[s]={});var u=t.audioLevel,c=t.echoReturnLoss,d=t.echoReturnLossEnhancement,l=t.totalAudioEnergy,f=t.totalSamplesDuration;n[s].audioLevel=h(u,2),n[s].echoReturnLoss=c,n[s].echoReturnLossEnhancement=h(d,2),n[s].totalAudioEnergy=h(l,8),n[s].totalSamplesDuration=h(f,1)}}},{key:"networkInfoStatisticsParse",value:function(e,t,r,i){var a=0,o=null,s=null;if("candidate-pair"===t.type){var u=e.get(t.remoteCandidateId);t.selected&&u&&(a=u.port,o=u.protocol);var c=e.get(t.localCandidateId);t.selected&&c&&(s=c.candidateType)}else if("transport"===t.type&&t.selectedCandidatePairId){var d=e.get(t.selectedCandidatePairId),l=e.get(d.remoteCandidateId);l&&(a=l.port,o=l.protocol);var h=e.get(d.localCandidateId);h&&(s=h.candidateType)}a&&o&&(a!==r.port||o!=r.protocol||s!=r.candidateType)&&(r.port=a,r.protocol=o,r.candidateType=s,n.Ay.directReport("".concat(i," port:").concat(a,", ").concat(i," protocol:").concat(o,", ").concat(i," localcandidateType:").concat(s)))}}])},9373:function(e,t,r){r.d(t,{A:function(){return c}});var n=r(5408),i=r(701),a=r(1461),o=r(3472),s=r(2710),u=r(8935),c=D((function e(){R(this,e);var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.mediaStream,n=t.speakerId,i=t.pauseCallback,a=t.mediaType,o=t.nodeId,s=t.mid,u=t.mute,c=t.volume,d=t.isCurrentSession;this._mediaType=a,this._mid=s,this._nodeId=o,this._isCurrentSession=null==d||d,this.initInterpretationParams(),this.audioTag=this._createAudioTag(r),this.pauseCB=i,this._listenHandlePlaying=this._listenHandlePlaying.bind(this),this._listenHandlePause=this._listenHandlePause.bind(this),this._listenHandleCanPlay=this._listenHandleCanPlay.bind(this),this._listenHandleError=this._listenHandleError.bind(this),this._addListener(),document.documentElement.appendChild(this.audioTag),u&&this.mute(),null!=c&&this.setVolume(c),this.setSpeakerDevicePromise(n).catch((function(e){}))}),[{key:"initInterpretationParams",value:function(){this._isInterpreter=!1,this._interpreterSpeakingCount=0,this._interpreterSpeakingStatus=s.g3}},{key:"destroy",value:function(){this._removeListener(),this.pause(),this.setStream(null),this.audioTag&&(this.audioTag.remove(),this.audioTag=null)}},{key:"onAssignedNodeId",value:function(e,t,r){this._nodeId>0||(this._mediaType=e,this._nodeId=t,this._isCurrentSession=r)}},{key:"getMediaType",value:function(){return this._mediaType}},{key:"getNodeId",value:function(){return this._nodeId}},{key:"setLang",value:function(e){void 0===e&&(e=s.jw),this._lang=e}},{key:"setInterpreter",value:function(e){this._isInterpreter=!!e,this.clearInterpreterSpeakingCount()}},{key:"getLang",value:function(){return this._lang}},{key:"isInterpreter",value:function(){return this._isInterpreter}},{key:"getVADStatistics",value:function(){return{totalAudioEnergy:this._totalAudioEnergy||0,totalSamplesDuration:this._totalSamplesDuration||0}}},{key:"setVADStatistics",value:function(e){var t=e.totalAudioEnergy,r=e.totalSamplesDuration;this._totalAudioEnergy=t,this._totalSamplesDuration=r}},{key:"increaseInterpreterSpeakingCount",value:function(){this._interpreterSpeakingCount++,this._interpreterSpeakingCount>3&&(this._interpreterSpeakingCount=3)}},{key:"decreaseInterpreterSpeakingCount",value:function(){this._interpreterSpeakingCount--,this._interpreterSpeakingCount<0&&(this._interpreterSpeakingCount=0)}},{key:"clearInterpreterSpeakingCount",value:function(){this._interpreterSpeakingCount=0}},{key:"isInterpreterSpeaking",value:function(){return this._interpreterSpeakingCount>=3?this._interpreterSpeakingStatus=s.sr:this._interpreterSpeakingCount<=0&&(this._interpreterSpeakingStatus=s.g3),!!this._interpreterSpeakingStatus}},{key:"changeVolumeByInterpreter",value:function(e){(0,u.nr)()&&e<100?this.setVolume(0):this.setVolume(e)}},{key:"_createAudioTag",value:function(e){var t=document.createElement("audio");return t.id=this._mediaType+"-"+this._mid+"-"+e.id,t.srcObject=e,t.autoplay=!0,t.controls=!1,t.muted=!1,t}},{key:"_addListener",value:function(){this.audioTag&&(this.audioTag.addEventListener("playing",this._listenHandlePlaying),this.audioTag.addEventListener("pause",this._listenHandlePause),this.audioTag.addEventListener("canplay",this._listenHandleCanPlay),this.audioTag.addEventListener("error",this._listenHandleError))}},{key:"_removeListener",value:function(){this.audioTag&&(this.audioTag.removeEventListener("playing",this._listenHandlePlaying),this.audioTag.removeEventListener("pause",this._listenHandlePause),this.audioTag.removeEventListener("canplay",this._listenHandleCanPlay),this.audioTag.removeEventListener("error",this._listenHandleError))}},{key:"_listenHandlePlaying",value:function(){var e;(0,o.lo)("ASP:".concat(this._mediaType,"-").concat(this._mid,"-").concat(null!==(e=this._nodeId)&&void 0!==e?e:0,"-").concat(this._isCurrentSession))}},{key:"_listenHandlePause",value:function(){var e;(0,o.lo)("APP:".concat(this._mediaType,"-").concat(this._mid,"-").concat(null!==(e=this._nodeId)&&void 0!==e?e:0,"-").concat(this._isCurrentSession,"-").concat(document.visibilityState)),"function"==typeof this.pauseCB&&this.pauseCB.call()}},{key:"_listenHandleCanPlay",value:function(){(0,o.lo)("ACP:".concat(this._mediaType,"-").concat(this._mid))}},{key:"_listenHandleError",value:function(e){var t;(0,i.iK)(a.BJf),n.Ay.error("RTCAudioPlayer tag error, ".concat(this._mediaType," mid=").concat(this._mid,", nodeId=").concat(null!==(t=this._nodeId)&&void 0!==t?t:0,":").concat(null==e?void 0:e.code,",").concat(null==e?void 0:e.message))}},{key:"isPaused",value:function(){return this.audioTag?this.audioTag.paused:void 0}},{key:"isMuted",value:function(){return this.audioTag?this.audioTag.muted:void 0}},{key:"isSupportSetSpeakerDevice",value:function(){var e;return!(null===(e=this.audioTag)||void 0===e||!e.setSinkId)}},{key:"setStream",value:function(e){this.audioTag&&this.audioTag.srcObject!=e&&(this.audioTag.srcObject=e)}},{key:"play",value:function(){return this.audioTag&&this.audioTag.play()}},{key:"pause",value:function(){return this.audioTag&&this.audioTag.pause()}},{key:"mute",value:function(){this.audioTag&&(this.audioTag.muted=!0)}},{key:"unmute",value:function(){this.audioTag&&(this.audioTag.muted=!1)}},{key:"setVolume",value:function(e){0===e?this.mute():this.unmute();var t=Math.min(Math.max(0,e),100)/100;this.audioTag&&(this.audioTag.volume=t)}},{key:"getVolume",value:function(){return this.isMuted()?0:this.audioTag.volume}},{key:"setSpeakerDevicePromise",value:function(e){var t=this;return new Promise((function(r,i){return t.audioTag&&t.isSupportSetSpeakerDevice()&&e?t.audioTag.sinkId==e?r():void t.audioTag.setSinkId(e).then(r).catch((function(e){n.Ay.error("Error when setting sink of audio player",e),i(e)})):r()}))}}])},9338:function(e,t,r){r.d(t,{v:function(){return f}});var n=r(2737),i=r(5738),a=r(9558),o=r(5408),s=r(7080),u=r(9109),c=r(1461),d=r(2710),l=r(3472),h=D((function e(){R(this,e),this.historySpeech=[],this.speechCntInMute=0}),[{key:"reset",value:function(){this.historySpeech=[],this.speechCntInMute=0}},{key:"webRtcVadAnalyze",value:function(e){if(++this.speechCntInMute<50)return!1;var t=this.historySpeech.length>0?this.historySpeech[0]:0;if(this.historySpeech.length>9&&this.historySpeech.splice(-1,1),t?this.historySpeech.splice(0,0,e>0):this.historySpeech.splice(0,0,e>1),this.historySpeech[0]){var r=0,n=0,i=0;if(this.historySpeech.forEach((function(e){r+=e,e?n++:(n>i&&(i=n),n=0)})),n>i&&(i=n),r>3&&i>1)return this.historySpeech.splice(0,this.historySpeech.length),this.speechCntInMute=0,!0}return!1}},{key:"destroy",value:function(){this.historySpeech=[],this.speechCntInMute=0}}]),f=D((function e(t,r){R(this,e),this.workletPath=r||{},this.audioStream=null,this.audioCtx=null,this.webRTCWorkletNode=null,this.inputNode=null,this.outputNode=null,this.isDestroyed=!1,this.initAudioContext(),this.isCreatingWorklet=!1,this.setAudioStreamCallback=t,this.doingDenoise=!1,this.checkProcessInterval=null,this.audioStatus=-1,this.levelR16Log=[],this.levelR16LogDenoise=[],this.voiceDetection=new h,this.enableVAD=!1}),[{key:"initAudioContext",value:function(){var e=this;if(!this.audioCtx){var t=n.Ay.getAudioContextConfigure();if(this.audioCtx=(0,n.gd)("WebRTCInput",t),!this.audioCtx)return;this.audioCtx.onstatechange=function(){var t,r;if(o.Ay.log("WebRTCInput AudioContext state changed to ".concat(null===(t=e.audioCtx)||void 0===t?void 0:t.state)),s.A.add_monitor("ACSC:WebRTCInput:".concat(null===(r=e.audioCtx)||void 0===r?void 0:r.state)),e.audioStream){1!==e.audioStatus&&2!==e.audioStatus||e.setAudioStreamCallback(null,!0);var n=e.audioStream.getAudioTracks()[0];if(n){var i,a=n.muted;"running"===(null===(i=e.audioCtx)||void 0===i?void 0:i.state)&&a&&((0,l.Yo)("ACRM"),o.Ay.error("Audio context running when track muted"))}}},this.outputNode=this.audioCtx.createMediaStreamDestination(),this.resumeAudioCtx()}}},{key:"createWebRTCWorklet",value:function(){var e=H(O().mark((function e(){var t,r,i,c,d,l,h=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!n.Ay.isIphoneOrIpadBrowser()||n.Ay.isSafariVersionHigherThan("17.0"),r=this.workletPath,i=r.jsPath,c=r.wasmPath,!(this.audioCtx&&i&&t)||this.isCreatingWorklet){e.next=21;break}if(this.isCreatingWorklet=!0,this.webRTCWorkletNode){e.next=20;break}return e.prev=3,e.next=6,this.audioCtx.audioWorklet.addModule(i);case 6:e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(3),e.abrupt("return",(o.Ay.error("Error when add webRTC worklet module",e.t0),void(this.isCreatingWorklet=!1)));case 11:if(e.t1=c,!e.t1){e.next=16;break}return e.next=15,n.Ay.downloadAndCompileWebAssembly(c,"AudioWorklet",s.A,!n.Ay.browser.isSafari&&u.A.enableStreamingInstantiate);case 15:d=e.sent;case 16:if(!this.isDestroyed){e.next=18;break}return e.abrupt("return",(o.Ay.log("webrtc manager has been destroyed before create audio worklet node"),void this.destroy()));case 18:l=n.Ay.isBrowserSupportStereo()?2:1,this.webRTCWorkletNode=new a.A(this.audioCtx,"webRTCWorklet",{processorOptions:{userAgent:navigator.userAgent,wasmModule:d,inputAudioChannel:l},numberOfOutputs:1,outputChannelCount:[2]}),this.webRTCWorkletNode.onprocessorerror=function(e){o.Ay.error("Exception thrown in WebRTC AudioWorkletProcessor",e)},this.webRTCWorkletNode.postCMD("audiowasm"),this.webRTCWorkletNode.port.addEventListener("message",(function(e){h.handleMessage(e)})),this.audioStream&&!this.inputNode&&(this.inputNode=this.audioCtx.createMediaStreamSource(this.audioStream),this.inputNode.connect(this.webRTCWorkletNode)),this.webRTCWorkletNode.connect(this.outputNode),"running"===this.audioCtx.state&&this.startCheckProcess(),o.Ay.log("create worklet successfully");case 20:this.isCreatingWorklet=!1,this.webRTCWorkletNode.postCMD("clearBuffer"),this.resumeAudioCtx();case 21:case"end":return e.stop()}}),e,this,[[3,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"handleMessage",value:function(e){var t=e.data;switch(t.status){case"AUDIO_LEVEL_R16":if(1!=this.audioStatus&&2!=this.audioStatus)break;var r=t.level.toString(16);this.addAudioLevelLog(this.levelR16Log,r),this.levelR16Log.length>30&&this.levelR16Log.shift();break;case"AUDIO_LEVEL_R16_DENOISE":if(1!=this.audioStatus&&2!=this.audioStatus)break;var n=t.level.toString(16);this.addAudioLevelLog(this.levelR16LogDenoise,n),this.levelR16LogDenoise.length>30&&this.levelR16LogDenoise.shift();break;case"WASM_INIT_SUCCESS":this.changeDenoiseSwitch(this.denoiseSwitch,this.isHeadSet);break;case"audio_process_changed":o.Ay.log("denoise switch changed"+t.data),this.doingDenoise=t.data,this.setAudioStreamCallback(null,!0);break;case c._9I:var a;null!=t.data&&(u.A.Notify_APPUI_SAFE(c._9I,{value:t.data}),this.enableVAD)&&!0===(null===(a=this.voiceDetection)||void 0===a?void 0:a.webRtcVadAnalyze(t.data))&&(null===u.A||void 0===u.A||u.A.Notify_APPUI_SAFE(c.AV$),this.enableVAD=!1,(0,l.Yo)("SPEAKING_WHEN_MUTE"));break;case"SPEECH_LOG":i.addAudioMonitorLog.push({log:t.data.log,logSource:d.Qm})}}},{key:"setAudioStream",value:function(e){this.audioStream=e,this.webRTCWorkletNode&&(this.inputNode&&(this.inputNode.disconnect(),this.inputNode=null),e&&(this.inputNode=this.audioCtx.createMediaStreamSource(this.audioStream),this.inputNode.connect(this.webRTCWorkletNode)))}},{key:"getAudioStream",value:function(){var e;return this.outputNode&&this.webRTCWorkletNode&&this.doingDenoise&&"running"===(null===(e=this.audioCtx)||void 0===e?void 0:e.state)?this.outputNode.stream:null}},{key:"changeDenoiseSwitch",value:function(e,t){this.denoiseSwitch=!!e,this.isHeadSet=!!t,this.webRTCWorkletNode&&this.webRTCWorkletNode.postCMD("audio_denoise_switch",{enable:this.denoiseSwitch,isHeadSet:this.isHeadSet})}},{key:"getLevelR16Log",value:function(){var e=this.levelR16Log.join(""),t=this.levelR16LogDenoise.join("");return this.levelR16Log=[],this.levelR16LogDenoise=[],{resLevelR16Log:e,resLevelR16LogDenoise:t}}},{key:"addAudioLevelLog",value:function(e,t){2==this.audioStatus?null==e||e.push("x"):null==e||e.push(t)}},{key:"resumeAudioCtx",value:function(){var e,t;1!==this.audioStatus&&2!==this.audioStatus||"running"===(null===(e=this.audioCtx)||void 0===e?void 0:e.state)||"closed"===(null===(t=this.audioCtx)||void 0===t?void 0:t.state)||this.isCreatingWorklet||(this.startCheckProcess(),this.audioCtx.resume().catch((function(e){o.Ay.error("webRTC audioContext resume fail",e)})))}},{key:"suspendAudioCtx",value:function(){var e;"suspended"===(null===(e=this.audioCtx)||void 0===e?void 0:e.state)||this.isCreatingWorklet||(this.stopCheckProcess(),this.audioCtx.suspend().catch((function(e){o.Ay.error("Error when suspend audio context",e)})))}},{key:"changeAudioStatus",value:function(e,t){var r,n;t?(this.audioStatus=3,this.enableVAD=!1,null===(r=this.voiceDetection)||void 0===r||r.reset(),this.suspendAudioCtx()):(2!==this.audioStatus&&e?this.enableVAD=!0:e||(this.enableVAD=!1),null===(n=this.voiceDetection)||void 0===n||n.reset(),this.audioStatus=e?2:1,this.resumeAudioCtx())}},{key:"startCheckProcess",value:function(){var e=this;this.stopCheckProcess(),this.webRTCWorkletNode&&(this.webRTCWorkletNode.postCMD("clearProcess",null),this.checkProcessInterval=setInterval((function(){e.webRTCWorkletNode&&e.webRTCWorkletNode.postCMD("checkProcess",null)}),1e4))}},{key:"stopCheckProcess",value:function(){this.checkProcessInterval&&(clearInterval(this.checkProcessInterval),this.checkProcessInterval=null)}},{key:"destroy",value:function(){var e=this;try{this.isDestroyed=!0,this.webRTCWorkletNode&&(this.webRTCWorkletNode.disconnect(),this.webRTCWorkletNode.postCMD("stopWorklet",!0),this.webRTCWorkletNode=null),this.inputNode&&(this.inputNode.disconnect(this.audioLevelNode),this.inputNode=null),this.outputNode&&(this.outputNode.disconnect(),this.outputNode=null),this.audioCtx&&"closed"!==this.audioCtx.state&&this.audioCtx.suspend().finally((function(){e.audioCtx.close(),e.audioCtx=null})),this.audioStream=null,this.audioStatus=-1,this.levelR16Log=[],this.levelR16LogDenoise=[],this.voiceDetection.destroy(),this.voiceDetection=null,this.enableVAD=!1,this.wasmModule=null,this.isCreatingWorklet=!1,(0,l.Yo)("DSALOK")}catch(e){(0,l.Yo)("DSALERR"),o.Ay.error("Error when destroy webRTC manager",e)}}}])},5738:function(e,t,r){r.r(t),r.d(t,{Add_Audio_Decode_Thread:function(){return Ze},Add_Video_Decode_Thread:function(){return Je},AllocateWasmSharedMemory:function(){return Ie},AssertMediaSdkNotDestory:function(){return se},Clear_Decoded_Sharing_Frame:function(){return Qe},CloseMediaNetSessionToRwg:function(){return oe},CreateThreadWorker:function(){return hr},GetMediaSession:function(){return pr},GetWorkerTypeThread:function(){return fr},Get_SSRC_Latest_Time:function(){return tt},Get_Video_SSRC_Latest_Time:function(){return rt},JsAudioEngine_UnInit:function(){return je},JsSharingEngine_UnInit:function(){return ze},JsVideoEngine_UnInit:function(){return Ke},MEDIA_INIT_SUCCESS_CALLBACK_METADATA:function(){return ur},Meeting_Fail_Over:function(){return nt},MirrorSendVideo:function(){return or},Modify_Audio_SampleRate:function(){return it},Notify_Audio_Decode_Thread:function(){return Et},Notify_Audio_Encode_Thread:function(){return bt},Notify_Audio_Thread_AEC_Status:function(){return ot},Notify_Audio_Thread_CC_Set_Lang:function(){return Ct},Notify_Audio_Thread_CurrentSSRC:function(){return At},Notify_Audio_Thread_Interpretation_Enable:function(){return kt},Notify_Audio_Thread_Interpretation_Mute:function(){return Tt},Notify_Audio_Thread_Interpretation_Set_Interpreter:function(){return Rt},Notify_Audio_Thread_Interpretation_Set_Lang:function(){return wt},Notify_Audio_Thread_Msg_Channel:function(){return st},Notify_Audio_Thread_Msg_Channel2:function(){return dt},Notify_Audio_Thread_Msg_Channel3:function(){return lt},Notify_Audio_Thread_Status:function(){return at},Notify_Audio_Video_Thread_Msg_Channel:function(){return ht},Notify_Sharing_Decode_Thread:function(){return St},Notify_Sharing_Encode_Thread:function(){return Bt},Notify_Sharing_Encode_Thread_Transferable_Data:function(){return yt},Notify_Sharing_Video_Decode_Thread:function(){return _t},Notify_Sharing_Video_Encode_Thread:function(){return Ft},Notify_Sharing_Video_Encode_Thread_Transferable_Data:function(){return mt},Notify_Video_Decode_Thread:function(){return gt},Notify_Video_Encode_Thread:function(){return ft},Notify_Video_Encode_Thread_Transferable_Data:function(){return pt},Notify_Video_Sharing_Msg_Channel:function(){return ct},Notify_Video_Thread_Msg_Channel:function(){return ut},Put_Video_Frame_Buffer:function(){return Xe},Reset_Aec:function(){return It},Send_Render_Monitor_Log:function(){return xt},Set_Audio_WebSocket_Ip_Address:function(){return Be},Set_Audio_Web_Transport_Ip_Address:function(){return We},Set_Video_WebSocket_Ip_Address:function(){return Ge},Set_Video_Web_Transport_Ip_Address:function(){return He},Sharing_Decode_Post_message:function(){return Ae},Sharing_Encode_Frame:function(){return Ye},Sharing_Encode_Post_message:function(){return Ee},Start_Monitor:function(){return Ot},Stop_Monitor:function(){return Pt},TransferCmdMsgToWorker:function(){return lr},TransoferDataToVideoEncodeThread:function(){return vt},UpdateAudioPlayStatus:function(){return Q},UpdateSharingPlayStatus:function(){return Z},UpdateVideoPlayStatus:function(){return J},Update_Audio_Encrpt:function(){return Wt},Update_Sharing_Encode_Status:function(){return Ut},Update_Sharing_Encrpt:function(){return Nt},Update_Sharing_Video_Encode_Status:function(){return Vt},Update_Video_Encrpt:function(){return Lt},Video_Encode_Frame:function(){return qe},addAudioMonitorLog:function(){return Oe},clearWorkerListener:function(){return jt},closeAllMedia:function(){return Kt},closeAllPromiseObject:function(){return Ht},destroyAllWorkers:function(){return qt},disableSocketReconnect:function(){return Gt},downloadWASMAndPostToWorker:function(){return Me},initAudioDecode:function(){return fe},initAudioEncode:function(){return le},initAudioSharedBuffer:function(){return Le},initResourceManager:function(){return er},initSharingDecode:function(){return ve},initSharingEncode:function(){return me},initVideoDecode:function(){return ce},initVideoEncode:function(){return ne},isSharingNotClearChromeVersion:function(){return sr},isVideoEncodeHandleReady:function(){return $t},prepareVBfile:function(){return rr},preserveMessageController:function(){return te},previewController:function(){return re},pushMessageToWorker:function(){return Qt},saveBrowserInfo:function(){return Mt},setAudioEngineInitProperties:function(){return Ue},setCachedUserNodeListToWorker:function(){return q},setMediaSessionHold:function(){return cr},setSharingEngineInitProperties:function(){return Ve},setUserNodeListToWorker:function(){return Y},setVideoEngineInitProperties:function(){return Fe},transportBgImageBitMap:function(){return nr},transportMaskImageBitMap:function(){return ar},transportSettingCanvas:function(){return Zt},transportVBBgImageBitMap:function(){return ir},updateCook:function(){return X}});var n=r(7857),i=r(7026),a=r(6984),o=r.n(a),s=r(1461),u=r(2710),c=r(9407),d=r(5169),l=r(2737),h=r(8353),f=r(5408),p=r(5740),g=r(7080),m=r(9482),_=r(9109),S=r(3485),A=r(879),b=r(4895),E=r(9693),k=r(2614),C=r(701),T=r(3903),R=r(7355),I=r(5723),D=r(14),M=r(9102),x=["name","messageParams","direction"];function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){(0,n.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var N=(0,h.A)("sdk.engine"),V=s.HjG;function U(e,t){return F.apply(this,arguments)}function F(){return(F=H(O().mark((function e(t,r){var n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===m._c.VIDEO_ENCODE?3:e.t0===m._c.VIDEO_DECODE?5:e.t0===m._c.AUDIO_ENCODE?7:e.t0===m._c.AUDIO_DECODE?9:e.t0===m._c.SHARING_DECODE?11:e.t0===m._c.SHARING_ENCODE?13:14;break;case 3:return n=_.A.videoEncResponseText,e.abrupt("break",14);case 5:return n=_.A.videoDecResponseText,e.abrupt("break",14);case 7:return n=_.A.audioEncodeResponse,e.abrupt("break",14);case 9:return n=_.A.audioDecodeResponse,e.abrupt("break",14);case 11:return n=_.A.sharingDecodeResponse,e.abrupt("break",14);case 13:n=_.A.sharingEncodeResponse;case 14:if(e.t1=n,e.t1){e.next=19;break}return e.next=18,B(r.workerJsFileUrl,r.integrityHelper);case 18:n=e.sent;case 19:return i="wasmUrl = '"+r.workerWasmFileUrl+"';",e.abrupt("return",n.replace(/self\.__wasmCodeDataEndFlag\s*=\s*1[;|,]/,i+"self.__wasmCodeDataEndFlag = 1;"));case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e,t){var r=null;return t&&(r=t.getIntegrity()),l.Ay.download(e,r)}function W(e,t,r,n,i){var a=this;return new Promise((function(u,c){var d;(d=H(O().mark((function e(t,r,n,i,a){var u,c,d;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a||!a.isDestroy){e.next=2;break}return e.abrupt("return",(g.A.add_monitor("ZIDX",i),N("WorkerType:".concat(i,";The relative SDK instance is destroy, don't start relative worker, avoid multiple same workers. "))));case 2:if(c={},m.d[i]&&Object.assign(c,{name:m.d[i]}),i==m._c.AUDIO_ENCODE?_.A.AEW&&(u=_.A.AEW):i==m._c.AUDIO_DECODE&&_.A.ADW&&(u=_.A.ADW),!u){e.next=7;break}i==m._c.AUDIO_ENCODE?_.A.AEWF=!0:i==m._c.AUDIO_DECODE&&(_.A.ADWF=!0),e.next=16;break;case 7:return e.t0=o(),e.t1=Blob,e.next=11,U(i,t);case 11:e.t2=e.sent,e.t3=[e.t2],e.t4=new e.t1(e.t3),d=e.t0.createObjectURL.call(e.t0,e.t4),(u=new Worker(d,c)).addEventListener("error",(function(e){if(e.message){if(e.message.includes("RuntimeError:")){var t=performance.now();t-_.A.crashLastTime>3e4&&(_.A.crashCount++,_.A.crashLastTime=t,(0,C.iK)(s.oQY),K("NOTIFY_UI_FAILOVER  ".concat(_.A.crashCount)))}}else f.Ay.error("Error from ".concat(i)+(null==e?void 0:e.message))})),i===m._c.VIDEO_ENCODE&&u.postMessage({command:"WORKER_BOLB_URL",blobUrl:d}),_.A.mediaSDKHandle.is32bitbrowser&&(i==m._c.AUDIO_ENCODE?_.A.AEW=u:i==m._c.AUDIO_DECODE&&(_.A.ADW=u));case 16:u&&u.postMessage({command:E.eG,workerType:i}),r&&r.call(n,u);case 17:case"end":return e.stop()}}),e)}))),function(e,t,r,n,i){return d.apply(this,arguments)})(e,(function(e){var i=_.A.SPECIAL_ID;t&&(g.A.add_monitor("WAM"+n),t.Add(i,e)),e.onmessage=function(e){r(e)},u()}),a,n,i)}))}function G(e,t){var r=t.data;r.status!==c.Os?r.status!=c.wo?[j,z].forEach((function(t){try{t.call(null,e,r)}catch(e){f.Ay.error("Error from allWorkersListener",e)}})):function(e){if(!_.A.browserFeature){var t=new I.rm(e);_.A.browserFeature=t,_.A.browserFeaturedefer.resolve(t);var r=(0,l.uF)();!t.isSupportOffScreenCanvasWebgl()&&r&&f.Ay.directReport("disable webgl in worker")}}(r.data):(0,R.Ek)().setTaskResult(r)}function j(e,t){-1!==[m._c.AUDIO_ENCODE,m._c.VIDEO_ENCODE,m._c.SHARING_ENCODE].indexOf(e)&&t.status===c._Q&&(N("allWorkersListener_AES_IV",e,t),_.A.Notify_APPUI_SAFE(s.Ewj,{workerType:e,iv:l.Ay.buffer2stringSplitByComma(t.data)}))}function K(e){var t=l.Ay.getMachineCapability();t.errorMessage=e,f.Ay.severityerror(t,["MEDIASDK_ERROR"])}function z(e,t){if(t.status===c.AC)if("low"==t.level)f.Ay.directReport("".concat(t.errorMessage));else{var r="Error from ".concat(e," worker: ").concat(t.errorMessage);-1!=r.indexOf("E:H")?K(r):f.Ay.error(r,t.errorEvent)}}function q(e){try{var t;null!==(t=_.A.userNodeList)&&void 0!==t&&t.length&&Qt(e,{userNodeList:_.A.userNodeList},E.V0,!1,!1)}catch(t){f.Ay.error("Error when sending cached user node list to worker workerType "+e,t)}}function Y(e){var t=_.A.userNodeList||[],r=e.concat(t);_.A.userNodeList=l.Ay.removeDuplicates(r,(function(e,t){return e.userid!==t.userid})),[m._c.AUDIO_ENCODE,m._c.AUDIO_DECODE,m._c.VIDEO_ENCODE,m._c.VIDEO_DECODE,m._c.SHARING_ENCODE,m._c.SHARING_DECODE].forEach(function(){var e=H(O().mark((function e(t){var r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===m._c.AUDIO_ENCODE?3:e.t0===m._c.AUDIO_DECODE?5:e.t0===m._c.VIDEO_ENCODE?7:e.t0===m._c.VIDEO_DECODE?9:e.t0===m._c.SHARING_ENCODE?11:e.t0===m._c.SHARING_DECODE?13:14;break;case 3:return r=_.A.audioEncodeInitInstance,e.abrupt("break",14);case 5:return r=_.A.audioDecInitInstance,e.abrupt("break",14);case 7:return r=_.A.videoInitInstance,e.abrupt("break",14);case 9:return r=_.A.videoDecInitInstance,e.abrupt("break",14);case 11:return r=_.A.sharingEncInitInstance,e.abrupt("break",14);case 13:r=_.A.sharingDecInitInstance;case 14:return e.prev=14,e.next=17,r.waitforInitSuccess();case 17:N("setUserNodeListToWorker init success",t),Qt(t,{userNodeList:_.A.userNodeList},E.V0,!1,!0),e.next=24;break;case 21:e.prev=21,e.t1=e.catch(14),f.Ay.error("Error when sending user node list to worker",e.t1);case 24:case"end":return e.stop()}}),e,null,[[14,21]])})));return function(t){return e.apply(this,arguments)}}())}function X(e){var t=new Uint8Array(e.length+12);t[0]=102,t[4]=2,t[8]=e.length,t.set(e,12,e.length),[m._c.AUDIO_ENCODE,m._c.AUDIO_DECODE,m._c.VIDEO_ENCODE,m._c.VIDEO_DECODE].forEach(function(){var e=H(O().mark((function e(r){var n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=r,e.next=e.t0===m._c.AUDIO_DECODE?3:e.t0===m._c.VIDEO_DECODE?5:6;break;case 3:return n=_.A.audioDecInitInstance,e.abrupt("break",6);case 5:n=_.A.videoDecInitInstance;case 6:return e.prev=6,e.next=9,n.waitforInitSuccess();case 9:N("setUserNodeListToWorker init success",r),Qt(r,t,E._w,!1,!0),e.next=16;break;case 13:e.prev=13,e.t1=e.catch(6),N(e.t1);case 16:case"end":return e.stop()}}),e,null,[[6,13]])})));return function(t){return e.apply(this,arguments)}}())}function Q(e){_.A.isAudioPlayWork=e}function J(e){return $.apply(this,arguments)}function $(){return($=H(O().mark((function e(t){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _.A.isVideoPlayWork=t,e.next=3,Qt(m._c.VIDEO_DECODE,{isVideoPlayWork:t},"VideoPlayStatus",!1,!0);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){_.A.isSharingPlayWork=e}var ee,te=(ee={SDK_TO_WORKER:"SDK_TO_WORKER",SDK_TO_WORKER_WAIT_OK:"SDK_TO_WORKER_WAIT_OK",SDK_TO_APP:"SDK_TO_APP",SDK_TO_SDK:"SDK_TO_SDK"},{nameMap:{INIT_VIDEO_ENCODE_SUCCESS:"INIT_VIDEO_ENCODE_SUCCESS",INIT_VIDEO_DECODE_SUCCESS:"INIT_VIDEO_DECODE_SUCCESS",CREATE_VIDEO_ENCODE_HANDLE_SUCCESS:"CREATE_VIDEO_ENCODE_HANDLE_SUCCESS",CREATE_VIDEO_DECODE_HANDLE_SUCCESS:"CREATE_VIDEO_DECODE_HANDLE_SUCCESS",CREATE_AUDIO_ENCODE_HANDLE_SUCCESS:"CREATE_AUDIO_ENCODE_HANDLE_SUCCESS",CREATE_AUDIO_DECODE_HANDLE_SUCCESS:"CREATE_AUDIO_DECODE_HANDLE_SUCCESS"},map:new Map,direction:ee,clear:function(){this.map.clear()},subscribeMessage:function(e){var t=this.map.get(e);t&&(t.forEach((function(e){var t,r=e.direction,n=e.messageParams,i=e.handler;if(r===ee.SDK_TO_APP)(t=_.A).Notify_APPUI.apply(t,y(n));else if(r===ee.SDK_TO_WORKER_WAIT_OK)Qt.apply(void 0,y(n));else if(r===ee.SDK_TO_WORKER){var a=v(n,2),o=a[0],s=a[1],u=Xt(o);u&&u.postMessage(s)}else r===ee.SDK_TO_SDK&&i&&i(n)})),this.map.delete(e))},enqueueMessage:function(e){var t=e.name,r=e.messageParams,n=e.direction,a=(0,i.A)(e,x);this.map.has(t)||this.map.set(t,[]),this.map.get(t).push(L({direction:n,messageParams:r||[]},a))}}),re={resetAudioEncode:function(e){!e&&_.A.isPreviewMode.audioEncode&&(_.A.audioEncodeSession=null),_.A.isPreviewMode.audioEncode=!!e},resetAudioDecode:function(e){!e&&_.A.isPreviewMode.audioDecode&&(_.A.audioDecodeSession=null),_.A.isPreviewMode.audioDecode=!!e},resetVideoEncode:function(e){!e&&_.A.isPreviewMode.videoEncode&&(_.A.videoEncodeSession=null),_.A.isPreviewMode.videoEncode=!!e},resetVideoDecode:function(e){!e&&_.A.isPreviewMode.videoDecode&&(_.A.videoDecodeSession=null),_.A.isPreviewMode.videoDecode=!!e}};function ne(e,t){return ie.apply(this,arguments)}function ie(){return ie=H(O().mark((function e(t,r){var n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _.A.localVideoEncMGR||(_.A.localVideoEncMGR=new d.cI({sessionid:r._id})),ae(m._c.VIDEO_DECODE,_.A.localVideoEncMGR.sessionid,r._id),_.A.videoEncWorkerPath=t.workerJsFileUrl,e.next=3,B(t.workerJsFileUrl,t.integrityHelper);case 3:if(n=e.sent,_.A.videoEncResponseText=n,se(r)){e.next=6;break}return e.abrupt("return",!1);case 6:return e.next=8,function(){var e=H(O().mark((function e(t,r,n,i){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=_.A.localVideoEncMGR,!e.t0){e.next=7;break}if(e.t1=_.A.isVideoEncodeThreadStart,e.t1){e.next=7;break}return _.A.isVideoEncodeThreadStart=!0,e.next=7,W(i,_.A.localVideoEncMGR,Re,m._c.VIDEO_ENCODE,n);case 7:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}()(0,0,r,t);case 8:if(se(r,"Add_Video_Encode_Thread")){e.next=10;break}return e.abrupt("return",(f.Ay.error("Add_Video_Encode_Thread Worker Not Controled"),!1));case 10:return i=fr(m._c.VIDEO_ENCODE),(0,k.Eg)(i,m._c.VIDEO_ENCODE),(0,T.CV)(i,m._c.VIDEO_ENCODE),te.subscribeMessage(te.nameMap.CREATE_VIDEO_ENCODE_HANDLE_SUCCESS),e.next=16,function(){var e=H(O().mark((function e(t){var r,n,i,a,o,s,u,c,d;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_.A.localVideoEncMGR){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,_.A.videoInitInstance.wasmSuccessPromise;case 4:if(se(t)){e.next=6;break}return e.abrupt("return");case 6:if(r=_.A.localVideoEncMGR.map.get(_.A.SPECIAL_ID),n=_.A.localVideoPara.confId||0,ue(_.A.videoEncodeSession,n)&&(_.A.videoEncodeSession=null),!r||_.A.videoEncodeSession){e.next=26;break}return _.A.videoEncodeSession={type:m._c.VIDEO_ENCODE,userId:n},i="firefox"===l.Ay.browserType.browser?1080:1070,_.A.mediaSDKHandle.mtu_size=i,a=null,e.next=14,A.f.analyzedPromise();case 14:return e.next=16,Se(_.A.localVideoPara.rendererType);case 16:if(o=e.sent,e.t0=b.X.isUseSsrcStream(),!e.t0){e.next=23;break}return s=M.e.exposeService().accquirePort(),e.next=22,_e("wasm_ssrc_stream_service_dynmod");case 22:u=e.sent;case 23:c=s?[s]:[],d=L(L({command:E.sV,_id:t._id,websocket_ip_address:_.A.Video_WebSocket_Ip_Address?_.A.Video_WebSocket_Ip_Address+"&mode=2":void 0,confId:_.A.localVideoPara.confId,confKey:"",logon:_.A.localVideoPara.logon,sendvideo:!0,isChromeOrEdge:l.Ay.browser.isChromeOrEdge,isArmSafari:l.Ay.browserEngine.isWebkit&&("iOS"===l.Ay.getOSInfo().os||l.Ay.isMac())&&!l.Ay.isMacIntelSafari(),isFirefox:_.A.localVideoPara.isFirefox,mtu_size:i,meetingid:_.A.localVideoPara.meetingid,meetingnumb:_.A.localVideoPara.meetingnumb,videoencodethreadnumb:_.A.localVideoPara.videoencodethreadnumb,iv:a,videodecodethreadnumb:_.A.localVideoPara.videodecodethreadnumb,isSupportMultiThread:_.A.localVideoPara.isSupportMultiThread,isSupportVirtualBackground:_.A.localVideoPara.isSupportVirtualBackground,uplimit:_.A.uplimit,isSupportWebCodecEnocde:_.A.localVideoPara.isSupportWebCodecEnocde,initWebCodecFlag:_.A.localVideoPara.initWebCodecFlag,is360penablehwenc:_.A.enable360pHWEnc,is360penablehwdec:_.A.enable360pHWDec,enable720p:_.A.localVideoPara.enable720p,enableOptCopyFrame:_.A.enableOptCopyFrame,isPreviewMode:_.A.isPreviewMode.videoEncode},_.A.Video_Web_Transport_Ip_Address?{webtransportURL:_.A.Video_Web_Transport_Ip_Address+"&mode=2"}:{}),{},{platformType:_.A.localVideoPara.platformType,rendererType:_.A.localVideoPara.rendererType,rendererDynModBlob:o,graphicalname:l.Ay.graphicName,vendorname:l.Ay.graphicvendorname,enableMultiDecodeVideoWithoutSAB:!!_.A.enableMultiDecodeVideoWithoutSAB,IsRenderInWorker:_.A.localVideoPara.IsRenderInWorker,enableVBWasmBackend:t.enableVBWasmBackend,webrtcvideo:_.A.localVideoPara.webrtcvideo,isEnableCanvasAlphaChannel:_.A.enableCanvasAlphaChannel,renderUserAgentInfo:S.l.info(),renderCapabilitiesDesc:A.f.desc(),renderConfigDesc:b.X.desc(),MaskFlag:_.A.localVideoPara.MaskFlag,isSafari:!!_.A.localVideoPara.isSafari,isVDIWebview:_.A.isVDIWebview,currentTime:_.A.timeOrigin+performance.now(),registryServicePort:s,wasmSsrcStreamServiceDynmodBlob:u,hwEncAdditionalConfig:_.A.hwEncAdditionalConfig,hwEncAddConIdx:_.A.hwEncAddConIdx}),r.postMessage(d,c),_.A.tfjsurl&&r.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:_.A.tfjsurl,type:"js"}),_.A.vbbin&&_.A.vbjson&&r.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:_.A.vbbin,json:_.A.vbjson},index:0}),_.A.afnbin&&_.A.afnjson&&(r.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:_.A.afnbin,json:_.A.afnjson},index:1}),_.A.basebin&&_.A.basejson&&r.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:_.A.basebin,json:_.A.basejson},index:2}));case 26:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(r);case 16:case"end":return e.stop()}}),e)}))),ie.apply(this,arguments)}function ae(e,t,r){var n=t==r;return n||f.Ay.error("mediasdkInstance id ".concat(r," not equal  media type ").concat(e," id ").concat(t)),n}function oe(e,t){_.A.sendMessageToRwg(s.yJV,{evt:s.ahr,body:{flag:t,type:e}},!1)}function se(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.isDestroy&&f.Ay.log("mediasdkInstance id ".concat(e._id," is Destoryed from ").concat(t)),!e.isDestroy}function ue(e,t){return!(!e||e.userId>>10==t>>10||(e.userId&&f.Ay.error("mediasdk user changed media type ".concat(e.type," pre id  ").concat(e.userId," now id ").concat(t)),0))}function ce(e,t){return de.apply(this,arguments)}function de(){return de=H(O().mark((function e(t,r){var n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _.A.localVideoDecMGR||(_.A.localVideoDecMGR=new d.cI({sessionid:r._id})),ae(m._c.VIDEO_DECODE,_.A.localVideoDecMGR.sessionid,r._id),_.A.videoDecWorkerPath=t.workerJsFileUrl,e.next=3,B(t.workerJsFileUrl,t.integrityHelper);case 3:if(n=e.sent,se(r)){e.next=6;break}return e.abrupt("return",!1);case 6:return _.A.videoDecResponseText=n,e.next=9,Je(0,0,r,t);case 9:if(se(r,"Add_Video_Decode_Thread")){e.next=11;break}return e.abrupt("return",(f.Ay.error("Add_Video_Decode_Thread Worker Not Controled"),!1));case 11:return i=fr(m._c.VIDEO_DECODE),(0,k.Eg)(i,m._c.VIDEO_DECODE),(0,T.CV)(i,m._c.VIDEO_DECODE),te.subscribeMessage(te.nameMap.CREATE_VIDEO_DECODE_HANDLE_SUCCESS),e.next=17,function(){var e=H(O().mark((function e(t){var r,n,i,a,o,s,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!_.A.isPreviewMode.videoDecode){e.next=2;break}return e.abrupt("return");case 2:if(_.A.localVideoDecMGR){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,_.A.videoDecInitInstance.wasmSuccessPromise;case 6:if(se(t)){e.next=8;break}return e.abrupt("return",!1);case 8:if(r=_.A.localVideoDecMGR.map.get(_.A.SPECIAL_ID),n=_.A.localVideoPara.confId||0,ue(_.A.videoDecodeSession,n)&&(_.A.videoDecodeSession=null),!r||_.A.videoDecodeSession){e.next=26;break}return _.A.videoDecodeSession={type:m._c.VIDEO_DECODE,userId:n},e.next=14,A.f.analyzedPromise();case 14:return e.next=16,Se(_.A.localVideoPara.rendererType);case 16:if(i=e.sent,e.t0=b.X.isUseSsrcStream(),!e.t0){e.next=23;break}return a=M.e.exposeService().accquirePort(),e.next=22,_e("wasm_ssrc_stream_service_dynmod");case 22:o=e.sent;case 23:s=a?[a]:[],u=L(L({command:E.sV,_id:t._id,websocket_ip_address:_.A.Video_WebSocket_Ip_Address?_.A.Video_WebSocket_Ip_Address+"&mode=5":void 0,confId:_.A.localVideoPara.confId,confKey:"",logon:_.A.localVideoPara.logon,mtu_size:0,meetingid:_.A.localVideoPara.meetingid,meetingnumb:_.A.localVideoPara.meetingnumb,videoencodethreadnumb:1,videodecodethreadnumb:_.A.localVideoPara.videodecodethreadnumb,isFirefox:_.A.localVideoPara.isFirefox,isSupportMultiThread:_.A.localVideoPara.isSupportMultiThread,isSupportOffscreenCanvas:_.A.localVideoPara.isSupportOffscreenCanvas,isenablehw:_.A.localVideoPara.isenablehw,isEnableVideoDecodeHardWareThread:_.A.localVideoPara.isEnableVideoDecodeHardWareThread,isEnableHardWareThread:_.A.localVideoPara.isEnableHardWareThread,isTeslaMode:_.A.localVideoPara.isTeslaMode,enableMultiDecodeVideoWithoutSAB:!!_.A.enableMultiDecodeVideoWithoutSAB,logHost:_.A.localVideoPara.logHost,hasLog:_.A.localVideoPara.hasLog,enableTCP:_.A.localVideoPara.enableTCP,isLSSPlayer:_.A.localVideoPara.isLSSPlayer},_.A.Video_Web_Transport_Ip_Address?{webtransportURL:_.A.Video_Web_Transport_Ip_Address+"&mode=1"}:{}),{},{graphicalname:l.Ay.graphicName,vendorname:l.Ay.graphicvendorname,platformType:_.A.localVideoPara.platformType,rendererType:_.A.localVideoPara.rendererType,rendererDynModBlob:i,isWebCodecDecoderOnWhitelist:_.A.localVideoPara.isWebCodecDecoderOnWhitelist,decHAOption:_.A.enableHADecOpt?"no-preference":void 0,is360penablehwenc:_.A.enable360pHWEnc,is360penablehwdec:_.A.enable360pHWDec,webrtcvideo:_.A.localVideoPara.webrtcvideo,isEnableCanvasAlphaChannel:_.A.enableCanvasAlphaChannel,renderUserAgentInfo:S.l.info(),renderCapabilitiesDesc:A.f.desc(),renderConfigDesc:b.X.desc(),isVDIWebview:_.A.isVDIWebview,registryServicePort:a,wasmSsrcStreamServiceDynmodBlob:o}),r.postMessage(u,s);case 26:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(r);case 17:case"end":return e.stop()}}),e)}))),de.apply(this,arguments)}function le(e,t){return he.apply(this,arguments)}function he(){return he=H(O().mark((function e(t,r){var n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le(r.isPlayStereoAudioSupported,r.audioCtx.sampleRate);case 2:return _.A.localAudioEncMGR||(_.A.localAudioEncMGR=new d.nf({sessionid:r._id})),ae(m._c.AUDIO_ENCODE,_.A.localAudioEncMGR.sessionid,r._id),_.A.audioEncWorkerPath=t.workerJsFileUrl,e.next=7,B(t.workerJsFileUrl,t.integrityHelper);case 7:if(_.A.audioEncodeResponse=e.sent,se(r)){e.next=10;break}return e.abrupt("return",!1);case 10:return e.next=12,function(){var e=H(O().mark((function e(t,r,n){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=_.A.isAudioEncodeThreadStart,e.t0){e.next=5;break}return _.A.isAudioEncodeThreadStart=!0,e.next=5,W(n,_.A.localAudioEncMGR,Pe,m._c.AUDIO_ENCODE,r);case 5:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()(0,r,t);case 12:if(se(r,"Add_Audio_Encode_Thread")){e.next=14;break}return e.abrupt("return",(f.Ay.error("Add_Audio_Encode_Thread Worker Not Controled"),!1));case 14:return n=fr(m._c.AUDIO_ENCODE),(0,k.Eg)(n,m._c.AUDIO_ENCODE),(0,T.CV)(n,m._c.AUDIO_ENCODE),te.subscribeMessage(te.nameMap.CREATE_AUDIO_ENCODE_HANDLE_SUCCESS),e.next=20,function(){var e=H(O().mark((function e(t){var r,n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_.A.localAudioEncMGR){e.next=2;break}return e.abrupt("return",void f.Ay.error("jsMediaEngineVariables.localAudioEncMGR is null when call Audio_Encode_Post_message"));case 2:return r=_.A.localAudioEncMGR.map.get(_.A.SPECIAL_ID),_.A.AEWF&&r.postMessage({command:"RIWM"}),e.next=6,_.A.audioEncodeInitInstance.wasmSuccessPromise;case 6:if(se(t)){e.next=8;break}return e.abrupt("return",!1);case 8:if(n=_.A.localAudioPara.userId||0,ue(_.A.audioEncodeSession,n)&&(_.A.audioEncodeSession=null),r&&!_.A.audioEncodeSession&&(_.A.audioEncodeSession={type:m._c.AUDIO_ENCODE,userId:n},i=L(L({command:E.sV,_id:t._id,websocket_ip_address:_.A.Audio_WebSocket_Ip_Address?_.A.Audio_WebSocket_Ip_Address+"&mode=2":void 0,sampleRate:_.A.localAudioPara.sampleRate,userid:_.A.localAudioPara.userId,encode:1,meetingid:_.A.localAudioPara.meetingId,meetingnumb:_.A.localAudioPara.meetingNumber,iv:null,shouldNotChangeSampleRate:l.Ay.browser.isFirefox||l.Ay.browser.isSafari,isSafari:l.Ay.browser.isSafari,isPreviewMode:_.A.isPreviewMode.audioEncode,audioEncodeChannelsNum:l.Ay.isBrowserSupportStereo()?2:1,audioDecodeChannelsNum:t.isPlayStereoAudioSupported?2:1},_.A.Audio_Web_Transport_Ip_Address?{webtransportURL:_.A.Audio_Web_Transport_Ip_Address+"&mode=2"}:{}),{},{currentTime:_.A.timeOrigin+performance.now()}),r.postMessage(i),_.A.sharedBuffer)){N("post audioEnc sab");try{r.postMessage({command:"sharedBuffer",data:_.A.sharedBuffer})}catch(e){r.postMessage({command:"sharedBuffer",data:_.A.sharedBuffer},[_.A.sharedBuffer])}}case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(r);case 20:case"end":return e.stop()}}),e)}))),he.apply(this,arguments)}function fe(e,t){return pe.apply(this,arguments)}function pe(){return pe=H(O().mark((function e(t,r){var n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le(r.isPlayStereoAudioSupported,null===(n=r.audioCtx)||void 0===n?void 0:n.sampleRate);case 2:return _.A.localAudioDecMGR||(_.A.localAudioDecMGR=new d.nf({sessionid:r._id})),ae(m._c.AUDIO_DECODE,_.A.localAudioDecMGR.sessionid,r._id),_.A.audioDecWorkerPath=t.workerJsFileUrl,e.next=7,B(t.workerJsFileUrl,t.integrityHelper);case 7:if(_.A.audioDecodeResponse=e.sent,"string"==typeof _.A.audioDecodeResponse?g.A.add_monitor("DAFL"+_.A.audioDecodeResponse.length):g.A.add_monitor("DAFF"),se(r)){e.next=11;break}return e.abrupt("return",!1);case 11:return e.next=13,Ze(0,0,r,t);case 13:if(se(r,"Add_Audio_Decode_Thread")){e.next=15;break}return e.abrupt("return",(f.Ay.error("Add_Audio_Decode_Thread Worker Not Controled"),!1));case 15:return i=fr(m._c.AUDIO_DECODE),(0,k.Eg)(i,m._c.AUDIO_DECODE),(0,T.CV)(i,m._c.AUDIO_DECODE),te.subscribeMessage(te.nameMap.CREATE_AUDIO_DECODE_HANDLE_SUCCESS),g.A.add_monitor("ADTS"),e.next=22,function(){var e=H(O().mark((function e(t){var r,n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!_.A.isPreviewMode.audioDecode){e.next=2;break}return e.abrupt("return",void g.A.add_monitor("ZISA"));case 2:if(_.A.localAudioDecMGR){e.next=4;break}return e.abrupt("return",void f.Ay.warn("jsMediaEngineVariables.localAudioDecMGR is null when call Audio_Decode_Post_message"));case 4:return r=_.A.localAudioDecMGR.map.get(_.A.SPECIAL_ID),_.A.ADWF&&r.postMessage({command:"RIWM"}),e.next=8,_.A.audioDecInitInstance.wasmSuccessPromise;case 8:if(se(t)){e.next=10;break}return e.abrupt("return",!0);case 10:if(n=_.A.localAudioPara.userId||0,ue(_.A.audioDecodeSession,n)&&(_.A.audioDecodeSession=null),r&&!_.A.audioDecodeSession){if(_.A.audioDecodeSession={type:m._c.AUDIO_DECODE,userId:n},i=L({command:E.sV,_id:t._id,websocket_ip_address:_.A.Audio_WebSocket_Ip_Address?_.A.Audio_WebSocket_Ip_Address+"&mode=5":void 0,sampleRate:_.A.localAudioPara.sampleRate,userid:_.A.localAudioPara.userId,decode:1,meetingid:_.A.localAudioPara.meetingId,meetingnumb:_.A.localAudioPara.meetingNumber,isSafari:l.Ay.browser.isSafari,isSupportMultiThread:_.A.localAudioPara.isSupportMultiThread,decoderInWorklet:_.A.decoderinworklet,audioDecodeChannelsNum:t.isPlayStereoAudioSupported?2:1,logHost:_.A.localAudioPara.logHost,hasLog:_.A.localAudioPara.hasLog,enableTCP:_.A.localAudioPara.enableTCP,isLSSPlayer:_.A.localAudioPara.isLSSPlayer,shouldNotChangeSampleRate:l.Ay.browser.isFirefox||l.Ay.browser.isSafari},_.A.Audio_Web_Transport_Ip_Address?{webtransportURL:_.A.Audio_Web_Transport_Ip_Address+"&mode=1"}:{}),g.A.add_monitor("ADSM"),r.postMessage(i),_.A.sharedBuffer){N("post audioDec sab");try{r.postMessage({command:"sharedBuffer",data:_.A.sharedBuffer})}catch(e){r.postMessage({command:"sharedBuffer",data:_.A.sharedBuffer},[_.A.sharedBuffer])}}}else g.A.add_monitor("ADSME"+!!r+!!_.A.audioDecodeSession);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(r);case 22:case"end":return e.stop()}}),e)}))),pe.apply(this,arguments)}function ve(e,t){return ge.apply(this,arguments)}function ge(){return ge=H(O().mark((function e(t,r){var n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _.A.localSharingDecMGR||(_.A.localSharingDecMGR=new d.n({sessionid:r._id})),_.A.localMouseDecMGR||(_.A.localMouseDecMGR=new d.n({sessionid:r._id})),ae(m._c.SHARING_DECODE,_.A.localSharingDecMGR.sessionid,r._id),_.A.sharingDecWorkerPath=t.workerJsFileUrl,e.next=6,B(t.workerJsFileUrl,t.integrityHelper);case 6:if(_.A.sharingDecodeResponse=e.sent,se(r)){e.next=9;break}return e.abrupt("return",!1);case 9:return e.next=11,function(){var e=H(O().mark((function e(t,r){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=_.A.isSharingDecodeThreadStart,e.t0){e.next=5;break}return _.A.isSharingDecodeThreadStart=!0,e.next=5,W(r,_.A.localSharingDecMGR,Ce,m._c.SHARING_DECODE,t);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()(r,t);case 11:if(se(r,"Add_Sharing_Decode_Thread")){e.next=13;break}return e.abrupt("return",(f.Ay.error("Add_Sharing_Decode_Thread Worker Not Controled"),!1));case 13:return n=fr(m._c.SHARING_DECODE),(0,k.Eg)(n,m._c.SHARING_DECODE),(0,T.CV)(n,m._c.SHARING_DECODE),e.next=18,Ae(r);case 18:case"end":return e.stop()}}),e)}))),ge.apply(this,arguments)}function me(e,t){return ye.apply(this,arguments)}function ye(){return ye=H(O().mark((function e(t,r){var n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _.A.localSharingEncMGR||(_.A.localSharingEncMGR=new d.n({sessionid:r._id})),ae(m._c.SHARING_ENCODE,_.A.localSharingEncMGR.sessionid,r._id),_.A.sharingEncWorkerPath=t.workerJsFileUrl,e.next=5,B(t.workerJsFileUrl,t.integrityHelper);case 5:if(_.A.sharingEncodeResponse=e.sent,se(r)){e.next=8;break}return e.abrupt("return",!1);case 8:return e.next=10,function(){var e=H(O().mark((function e(t,r){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!t.isDestroy){e.next=2;break}return e.abrupt("return",N("WorkerType:sharingEnc;The relative SDK instance is destroy, don't start relative worker, avoid multiple same workers. "));case 2:if(e.t0=_.A.isSharingEncodeThreadStart,e.t0){e.next=7;break}return _.A.isSharingEncodeThreadStart=!0,e.next=7,W(r,_.A.localSharingEncMGR,we,m._c.SHARING_ENCODE,t);case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()(r,t);case 10:if(se(r,"Add_Sharing_Encode_Thread")){e.next=12;break}return e.abrupt("return",(f.Ay.error("Add_Sharing_Encode_Thread Worker Not Controled"),!1));case 12:return n=fr(m._c.SHARING_ENCODE),(0,T.CV)(n,m._c.SHARING_ENCODE),e.next=16,Ee(r);case 16:case"end":return e.stop()}}),e)}))),ye.apply(this,arguments)}var _e=function(){var e=H(O().mark((function e(t){var r,n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(t,".min.js"),r="".concat(b.X.getBaseScriptUrl(),"/").concat(r),e.next=4,fetch(r);case 4:return n=e.sent,e.next=7,n.arrayBuffer();case 7:return i=e.sent,e.abrupt("return",new Blob([i],{type:"application/javascript"}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Se=function(){var e=H(O().mark((function e(t){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==D.h3.WEBGPU){e.next=2;break}return e.abrupt("return",_e("webgpu_renderer_dynmod"));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function Ae(e){return be.apply(this,arguments)}function be(){return be=H(O().mark((function e(t){var r,n,i,a,o,s;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.A.sharingDecInitInstance.wasmSuccessPromise;case 2:if(se(t)){e.next=4;break}return e.abrupt("return",!1);case 4:if(r=_.A.localSharingDecMGR.Get(_.A.SPECIAL_ID),n=_.A.localSharingPara.userid||0,ue(_.A.sharingDecodeSession,n)&&(_.A.sharingDecodeSession=null),!r||_.A.sharingDecodeSession){e.next=21;break}return _.A.sharingDecodeSession={type:m._c.SHARING_DECODE,userId:n},e.next=10,A.f.analyzedPromise();case 10:return e.next=12,Se(_.A.localSharingPara.rendererType);case 12:if(i=e.sent,e.t0=b.X.isUseSsrcStream(),!e.t0){e.next=19;break}return a=M.e.exposeService().accquirePort(),e.next=18,_e("wasm_ssrc_stream_service_dynmod");case 18:o=e.sent;case 19:s=a?[a]:[],r.postMessage({command:E.sV,_id:t._id,websocket_ip_address:_.A.Sharing_WebSocket_Ip_Address,confId:_.A.localSharingPara.userid,confKey:"",logon:_.A.localSharingPara.logon,meetingid:_.A.localSharingPara.meetingid,meetingnumb:_.A.localSharingPara.meetingnumb,multiThreadNum:1,isSafari:l.Ay.browser.isSafari,graphicalname:l.Ay.graphicName,vendorname:l.Ay.graphicvendorname,rendererType:_.A.localSharingPara.rendererType,rendererDynModBlob:i,isWebCodecDecoderOnWhitelist:_.A.localSharingPara.isWebCodecDecoderOnWhitelist,isEnableCanvasAlphaChannel:_.A.enableCanvasAlphaChannel,renderUserAgentInfo:S.l.info(),renderCapabilitiesDesc:A.f.desc(),renderConfigDesc:b.X.desc(),registryServicePort:a,wasmSsrcStreamServiceDynmodBlob:o},s);case 21:case"end":return e.stop()}}),e)}))),be.apply(this,arguments)}function Ee(e){return ke.apply(this,arguments)}function ke(){return ke=H(O().mark((function e(t){var r,n,i,a,o,s,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.A.sharingEncInitInstance.wasmSuccessPromise;case 2:if(se(t)){e.next=4;break}return e.abrupt("return",!1);case 4:if(r=_.A.localSharingEncMGR.Get(_.A.SPECIAL_ID),n=_.A.localSharingPara.userid||0,ue(_.A.sharingEncodeSession,n)&&(_.A.sharingEncodeSession=null),!r||_.A.sharingEncodeSession){e.next=24;break}return g.A.add_monitor2("STN1"),i=null,_.A.sharingEncodeSession={type:m._c.SHARING_ENCODE,userId:n},e.next=13,A.f.analyzedPromise();case 13:return e.next=15,Se(_.A.localSharingPara.rendererType);case 15:if(a=e.sent,e.t0=b.X.isUseSsrcStream(),!e.t0){e.next=22;break}return o=M.e.exposeService().accquirePort(),e.next=21,_e("wasm_ssrc_stream_service_dynmod");case 21:s=e.sent;case 22:u=o?[o]:[],r.postMessage({command:E.sV,_id:t._id,encode:!0,websocket_ip_address:_.A.Sharing_WebSocket_Ip_Address,confId:_.A.localSharingPara.userid,confKey:"",logon:_.A.localSharingPara.logon,isChromeOrEdge:l.Ay.browser.isChromeOrEdge,meetingid:_.A.localSharingPara.meetingid,meetingnumb:_.A.localSharingPara.meetingnumb,multiThreadNum:1,isSafari:l.Ay.browser.isSafari,iv:i,uplimit:_.A.uplimit,graphicalname:l.Ay.graphicName,vendorname:l.Ay.graphicvendorname,rendererType:_.A.localSharingPara.rendererType,rendererDynModBlob:a,isEnableCanvasAlphaChannel:_.A.enableCanvasAlphaChannel,renderUserAgentInfo:S.l.info(),renderCapabilitiesDesc:A.f.desc(),renderConfigDesc:b.X.desc(),currentTime:_.A.timeOrigin+performance.now(),registryServicePort:o,wasmSsrcStreamServiceDynmodBlob:s},u);case 24:case"end":return e.stop()}}),e)}))),ke.apply(this,arguments)}function Ce(e){var t=e.data;try{if(t.status===c.Rm)p.A.publish(s.vjv,{body:{width:t.logicWidth,height:t.logicHeight,logicWidth:t.logicWidth,logicHeight:t.logicHeight}}),_.A.Notify_APPUI(s.cYb,{body:{width:t.logicWidth,height:t.logicHeight,logicWidth:t.logicWidth,logicHeight:t.logicHeight}});else if(t.status===c.Vd)_.A.Notify_APPUI(s.jhI,t.ssrc);else if(t.status===c.SG)g.A.add_monitor2(t.data);else if(t.status===c.xD)g.A.add_monitor("FSF"),_.A.Notify_APPUI(s.vd4,{ssrc:t.ssrc});else if(t.status===c.Wr)!function(e,t,r,n,i,a,o,s,u,c,d,l,h){if(_.A.isSharingPlayWork){var f={yuvdata:t,ntptime:r,ssrc:e,width:n,height:i,r_x:a,r_y:o,r_w:s,r_h:u,logic_w:c,logic_h:d,yuv_limited:l,isFromMainSession:h};_.A.mediaSDKHandle.SharingRenderObj.Put_Sharing_Data_From_Queue(f,15)}}(t.sharing_ssrc,t.data,t.sharing_timestamp,t.sharing_width,t.sharing_height,t.rendering_x,t.rendering_y,t.rendering_w,t.rendering_h,t.logic_w,t.logic_h,t.yuv_limited,t.isFromMainSession);else if(t.status===c.Bm)!function(e,t,r,n,i,a,o,s,u,c){if(_.A.isSharingPlayWork){var d={buffer:t,ntptime:r,ssrc:e,width:n,height:i,r_x:a,r_y:o,mLogic_w:s,mLogic_h:u,sync_id:c};_.A.mediaSDKHandle.SharingRenderObj.Put_Mouse_Data_Into_Queue(d)}}(t.mouse_ssrc,t.data,t.mouse_timestamp,t.mouse_width,t.mouse_height,t.mouse_x,t.mouse_y,t.mLogic_w,t.mLogic_h,t.sync_id);else if(t.status===c.av)_.A.Notify_APPUI(s.zj1,{ssrc:t.ssrc,size:t.size,fps:t.size});else if(t.status===s.oUP){var r=L({encoding:!1},t.data);_.A.Notify_APPUI_SAFE(s.oUP,r)}else if(t.status===c.I)g.A.add_monitor("SDWS"),_.A.isSharingDecodeWASMOK=!0,_.A.sharingDecInitInstance.setWasmSuccess();else if(t.status===c.bC)g.A.add_monitor("SDWF",t.data),K("SDWF"),_.A.sharingDecInitInstance.setWasmSuccess(!1);else if(t.status===c.Ji||t.status===c.x8)g.A.add_monitor("SDHS"),_.A.sharingDecInitInstance.setHanderSuccess();else if(t.status===c.pJ)g.A.add_monitor("SHHF"),_.A.sharingDecInitInstance.setHanderSuccess(!1);else if(t.status===c.zS)g.A.add_monitor("SDSS"),_.A.sharingDecInitInstance.setSocketSuccess();else if(t.status===c.KE)g.A.add_monitor("SDSF"),_.A.sharingDecInitInstance.isSocketInitSuccess()&&(0,C.iK)(s.oDm,null),_.A.sharingDecInitInstance.setSocketSuccess(!1);else{if(t.status==c.vr)return void g.A.send_monitor_directly(t.data);if(t.status===c.wQ){var n=_.A.localSharingDecMGR.map.get(_.A.SPECIAL_ID);Me(t.url,n,m._c.SHARING_DECODE)}else t.status==c.ef?(_.A.monitorSharingDecodeAPPInfo=t,g.A.send_monitor_directly(_.A.monitorSharingDecodeAPPInfo.data),_.A.monitorSharingDecodeAPPInfo=null):t.status==c.Bi?g.A.add_monitor("SD"+t.data):t.status==c.aY?(g.A.add_monitor("MWGLF"),_.A.Notify_APPUI(s.BgG,{canvasId:t.canvasId,replaceCanvas:!!t.replaceCanvas})):t.status==c.Tf?g.A.add_monitor("MWGRF"):"WFMO"==t.status?De(m._c.SHARING_DECODE):t.status==c.jA?_.A.SDMTimes++<2&&(K(m._c.SHARING_DECODE+" Memory Allocate Failed"),g.A.add_monitor("SDMAF"),(0,C.iK)(s.a1o)):t.status==c.uL?_.A.mediaSDKHandle.onAnnotationPdu(t.data):t.status==c.V_?(0,C.iK)(s.AoB,t.where):G(m._c.SHARING_DECODE,e)}}catch(e){f.Ay.error("Error in SharingDec_Listener",e)}}function we(e){var t=e.data;try{if(t.status===c.I)g.A.add_monitor("SEWS"),_.A.isSharingEncodeWASMOK=!0,_.A.sharingEncInitInstance.setWasmSuccess();else if(t.status===c.bC)g.A.add_monitor("SEWF",t.data),K("SEWF"),_.A.sharingEncInitInstance.setWasmSuccess(!1);else if(t.status===c.Ji||t.status===c.x8)g.A.add_monitor("SEHS"),_.A.sharingEncInitInstance.setHanderSuccess();else if(t.status===c.pJ)g.A.add_monitor("SEHF"),_.A.sharingEncInitInstance.setHanderSuccess(!1);else if(t.status===c.zS)g.A.add_monitor("SESS"),_.A.sharingEncInitInstance.setSocketSuccess();else if(t.status===c.KE)g.A.add_monitor("SESF",t.data),_.A.sharingEncInitInstance.isSocketInitSuccess()&&(0,C.iK)(s.oDm,null),_.A.sharingEncInitInstance.setSocketSuccess(!1);else if(t.status==c.f9)g.A.add_monitor2("SCFOK");else if(t.status==c.Xk)g.A.add_monitor("SCFF"+t.format);else if(t.status==c.bq)_.A.mediaSDKHandle.Process_Sharing();else if(t.status==c.hA)_.A.mediaSDKHandle.Process_Sharing();else if(t.status===c.HL){var r;null===(r=_.A.mediaSDKHandle)||void 0===r||r.onSharingSizeChange(t),_.A.Notify_APPUI(s.HL3,{width:t.width,height:t.height})}else{if(t.status==c.vr)return void g.A.send_monitor_directly(t.data);if(t.status==c.wQ){var n=_.A.localSharingEncMGR.map.get(_.A.SPECIAL_ID);Me(t.url,n)}else if(t.status===s.oUP){var i=L({encoding:!0},t.data);_.A.Notify_APPUI_SAFE(s.oUP,i)}else t.status==c.ef?g.A.send_monitor_directly(t.data):t.status==c.Bi?g.A.add_monitor("SE"+t.data):t.status==c.aY?_.A.Notify_APPUI(s.BgG,{canvasId:t.canvasId,replaceCanvas:!!t.replaceCanvas}):t.status==c.D1?_.A.Notify_APPUI(s.ekh,{data:t.data}):"WFMO"==t.status?De(m._c.SHARING_ENCODE):t.status==c.hd?((0,C.iK)(s.bes,c.hd),f.Ay.error("Health Check Failed: ".concat(c.hd,", ").concat(t.videoType,",").concat(t.subforme,",").concat(t.hasRTPPackets))):t.status==c.jA?_.A.SEMTimes++<2&&(K(m._c.SHARING_ENCODE+" Memory Allocate Failed"),g.A.add_monitor("SEMAF"),(0,C.iK)(s.a1o)):t.status==c.uL?_.A.mediaSDKHandle.onAnnotationPdu(t.data):t.status==c.V_?(0,C.iK)(s.AoB,t.where):G(m._c.SHARING_ENCODE,e)}}catch(e){f.Ay.error("Error in SharingEnc_Listener",e)}}function Te(e){var t,r=e.data,n=!0;try{if("NewActiveSpeakerFirstframeCallback"===r.status)_.A.Notify_APPUI(s.N6$,{ssrc:r.ssrc});else if(r.status===c.Rk)_.A.Notify_APPUI(s.XDu,{width:r.width,height:r.height});else if(r.status===c.LG){var i=_.A.mediaSDKHandle.videoDecodeFrameBackSABRingBufferConsumer;i&&i.consumeAll(_.A.mediaSDKHandle.bVideoDecodeFrameBackSABRingBufferConsumeCopyData)}else if(r.status===c.Zc)g.A.add_monitor2(r.data);else if(r.status==c.aY)g.A.add_monitor("MWGLF"),_.A.Notify_APPUI(s.BgG,{canvasId:r.canvasId,replaceCanvas:!!r.replaceCanvas});else if(r.status==c.Tf)g.A.add_monitor("MWGRF");else if(r.status==c.V_)g.A.add_monitor("MWCGLF"),(0,C.iK)(s.AoB,r.where);else if(0===r.status)Xe(r.video_ssrc,r.data,r.video_timestamp,r.video_width,r.video_height,r.rendering_x,r.rendering_y,r.rendering_w,r.rendering_h,r.rotation,r.yuv_limited);else if(r.status===c.lN)g.A.add_monitor("VDWS"),_.A.isVideoDecodeWASMOK=!0,_.A.videoDecInitInstance.setWasmSuccess(),_.A.isPreviewMode.videoDecode&&_.A.Notify_APPUI_SAFE(s.rje);else if(r.status===c.Fb){var a=r.size;_.A.Notify_APPUI(s.Ya9,{ssrc:r.ssrc,size:a}),g.A.add_monitor("VDMS:"+a)}else if(r.status===c.Gg)g.A.add_monitor("VDWF",r.data),K("VDWF"),_.A.videoDecInitInstance.setWasmSuccess(!1);else if(r.status===c.iU)g.A.add_monitor("VDHS"),_.A.videoDecInitInstance.setHanderSuccess();else if(r.status===c.oU)g.A.add_monitor("VDHF"),_.A.videoDecInitInstance.setHanderSuccess(!1);else if(r.status===c.s6)_.A.videoDecInitInstance.setSocketSuccess(),g.A.add_monitor("VDSS");else if(r.status===c.HX)g.A.add_monitor("VDSF"),_.A.videoDecInitInstance.isSocketInitSuccess()&&(0,C.iK)(s.oDm,null),_.A.videoDecInitInstance.setSocketSuccess(!1);else if(r.status===c.Ub)g.A.add_monitor("VDWPS");else if(r.status===c.Y)g.A.add_monitor("VDWPCLOSE"),oe(m.wd.ZOOM_CONNECTION_VIDEO,m.oB.NET_WEBTRANSPORT);else if(r.status===c.UG)g.A.add_monitor("VDWSCLOSE");else if(r.status===c.xQ)g.A.add_monitor("VDTTP:"+r.type);else if(r.status==c.vr)g.A.send_monitor_directly(r.data),n=!1;else if(r.status==c.ef)n=!1,_.A.sendMessageToRwg(s.yGo,{evt:s.UFw,seq:1,body:{data:r.data}});else if(r.status==c.wQ){var o=_.A.localVideoDecMGR.map.get(_.A.SPECIAL_ID);Me(r.url,o,m._c.VIDEO_DECODE),n=!1}else if(r.status==c.Bi)n=!1,g.A.add_monitor("VD"+r.data);else if(r.status===c.T)_.A.Notify_APPUI_SAFE(s.TaW,r.data);else if(r.status===c.$x)_.A.Notify_APPUI_SAFE(s.$xb,r.data);else if(r.status===s.PgM){var u=L({encoding:!1},r.data);_.A.Notify_APPUI_SAFE(s.PgM,u)}else if("FIRST_VIDEO_FRAME"===r.status)_.A.Notify_APPUI_SAFE(s.Vtx),g.A.add_monitor("FVF");else if(r.status===c.Ah)_.A.Notify_APPUI_SAFE(s.Ah8,{isUplink:r.isUplink,networkLevel:r.networkLevel,bwLevel:r.bwLevel});else if(r.status===c.yC)_.A.Notify_APPUI_SAFE(s.Tbw,r.data);else if(r.status===c._0){var d=r.data,l=d[7]<<24|d[6]<<16|d[5]<<8|d[4];l=(l>>>=0)>>10<<10,_.A.Notify_APPUI_SAFE(s.A7G,{ssrc:l,data:r.data})}else"FIRST_FRAME"===r.status?_.A.Notify_APPUI_SAFE(s.vIC,{ssrc:r.ssrc,params:r.params}):"WFMO"==r.status?(n=!1,De(m._c.VIDEO_DECODE)):r.status==c.x8?n=!0:r.status==c.jA?(n=!1,_.A.VDMTimes++<2&&(K(m._c.VIDEO_DECODE+" Memory Allocate Failed"),g.A.add_monitor("VDMAF"),(0,C.iK)(s.a1o))):r.status==c.H4?dr(r.data):(r.status==c.AC&&(n=!1),G(m._c.VIDEO_DECODE,e))}catch(e){f.Ay.error("Error in VideoDec_Listener",e)}n&&null!==(t=_.A.mediaSDKHandle)&&void 0!==t&&t.isSupportVideoShare&&Ce(e)}function Re(e){var t,r=e.data,n=!0;if(r!==c.$E){try{if("VBPredictDone"===r.status)g.A.add_monitor("VBPOK"+r.predictCostTime),_.A.isPreviewMode.videoEncode&&te.enqueueMessage({name:te.nameMap.INIT_VIDEO_ENCODE_SUCCESS,messageParams:[s.UsF,null],direction:te.direction.SDK_TO_APP}),_.A.Notify_APPUI(s.UsF,null);else if("VBPredictAbout3s"===r.status)g.A.add_monitor("VBP3S"),_.A.Notify_APPUI(s.eJx,null);else if("VBPredictAbout10s"===r.status)g.A.add_monitor("VBP10S"),_.A.Notify_APPUI(s.IkA,null);else if("vbInitializeFailed"===r.status)f.Ay.error("VB tensorflow backend initialize failed"),g.A.add_monitor("VBBEF"),_.A.Notify_APPUI(s.KqK,V.FAIL);else if(0===r.status);else if(r.status===c.dh||r.status===c.lN)g.A.add_monitor("VEWS"),_.A.isVideoEncodeWASMOK=!0,_.A.videoInitInstance.setWasmSuccess();else if(r.status===c.Ke)g.A.add_monitor("VEWF",r.data),K("VEWF"),_.A.videoInitInstance.setWasmSuccess(!1);else if(r.status===c.l6||c.iU===r.status)g.A.add_monitor("VEHS"),_.A.videoInitInstance.setHanderSuccess();else if(r.status===c.uP||c.oU===r.status)g.A.add_monitor("VEHF"),_.A.videoInitInstance.setHanderSuccess(!1);else if(c.s6===r.status)g.A.add_monitor("VESS"),_.A.videoInitInstance.setSocketSuccess();else if(r.status===c.HX)g.A.add_monitor("VESF"),_.A.videoInitInstance.isSocketInitSuccess()&&(0,C.iK)(s.oDm,null),_.A.videoInitInstance.setSocketSuccess(!1);else if(r.status===c.Ub)g.A.add_monitor("VEWPS");else if(r.status===c.Y)g.A.add_monitor("VEWPCLOSE");else if(r.status===c.UG)g.A.add_monitor("VEWSCLOSE");else if(r.status===c.xQ)g.A.add_monitor("VETTP:"+r.type);else if(r.status===c.Cm)g.A.add_monitor("VEHORS:"+r.type);else if(r.status===c.bq)_.A.mediaSDKHandle.Process_Video();else if(r.status===c.Sh)_.A.Notify_APPUI(s.Shw,{width:r.width,height:r.height});else if(r.status===c.vP)g.A.add_monitor("VCRC"+r.width),_.A.mediaSDKHandle.Change_Video_Capture_Resolution(r.width,r.height);else if(r.status==c.sY)g.A.add_monitor2("VCFOK");else if(r.status==c.YS)g.A.add_monitor("VCFF","format: ".concat(r.format));else{if(r.status==c.vr)return n=!1,void g.A.send_monitor_directly(r.data);if(r.status==c.ef)n=!1,g.A.send_monitor_directly(r.data);else if(r.status===c.wQ){var i=_.A.localVideoEncMGR.map.get(_.A.SPECIAL_ID);Me(r.url,i,m._c.VIDEO_ENCODE),n=!1}else if(r.status==c.Bi)n=!1,g.A.add_monitor("VE"+r.data);else if(r.status==c.ty){var a=_.A.SPECIAL_ID;if(_.A.localVideoDecMGR){var o=_.A.localVideoDecMGR.map.get(a);o&&o.postMessage({command:"encodedimagebitmapwasmptr",data:r.data,wasmMemory:r.wasmMemory})}else _.A.isPreviewMode.videoEncode&&te.enqueueMessage({name:te.nameMap.INIT_VIDEO_DECODE_SUCCESS,messageParams:[m._c.VIDEO_DECODE,{command:"encodedimagebitmapwasmptr",data:r.data,wasmMemory:r.wasmMemory}],direction:te.direction.SDK_TO_WORKER})}else if(r.status===s.PgM){var u=L({encoding:!0},r.data);_.A.Notify_APPUI_SAFE(s.PgM,u)}else if(r.status===s.oUP){var d=L({encoding:!0},r.data);_.A.Notify_APPUI_SAFE(s.oUP,d)}else if(r.status==c.aY)g.A.add_monitor("MWGLF"),_.A.Notify_APPUI(s.BgG,{canvasId:r.canvasId,replaceCanvas:!!r.replaceCanvas});else if(r.status==c.Tf)g.A.add_monitor("MWGRF");else if(r.status===c.Xg)_.A.mediaSDKHandle.init_Notify_APPUI(!0,m._c.VIDEO_ENCODE);else if(r.status===c.Ah)_.A.Notify_APPUI_SAFE(s.Ah8,{isUplink:r.isUplink,networkLevel:r.networkLevel,bwLevel:r.bwLevel});else if("WFMO"==r.status)n=!1,De(m._c.VIDEO_ENCODE);else if(r.status==c.AP)r.vberror?(0,C.iK)(s.Azg):(0,C.iK)(s.bes,c.AP),f.Ay.error("Health Check Failed: ".concat(c.AP,", ").concat(r.videoType,",").concat(r.subforme,",").concat(r.hasRTPPackets,",").concat(r.vberror));else if(r.status===s.msu){var l=r.frame,h=_.A,p=h.frameSent,v=h.frameReceived;_.A.extVBPort&&p===v?(_.A.extVBPort.postMessage({type:s.Abc,frame:l}),_.A.frameSent++):g.A.add_monitor("EVBOF-".concat(p-v)),l.close()}else r.status==c.x8?n=!0:r.status==c.jA?(n=!1,_.A.VEMTimes++<2&&(K(m._c.VIDEO_ENCODE+" Memory Allocate Failed"),g.A.add_monitor("VEMAF"),(0,C.iK)(s.a1o))):r.status==c.H4?dr(r.data):r.status==c.V_?(0,C.iK)(s.AoB,r.where):(r.status==c.AC&&(n=!1),G(m._c.VIDEO_ENCODE,e))}}catch(e){f.Ay.error("Error in VideoEnc_Listener",e)}n&&null!==(t=_.A.mediaSDKHandle)&&void 0!==t&&t.isSupportVideoShare&&we(e)}}function Ie(e,t){var r;try{r=new WebAssembly.Memory({initial:e,maximum:t,shared:!0})}catch(e){f.Ay.error("E:H Allocate WasmMemory Failed",e),(0,C.iK)(s.a1o)}return r}function De(e){var t,r,n,i=!1,a=l.Ay.isIphoneOrIpadBrowser()||l.Ay.isIpadOS()||l.Ay.isGoogleMeetAndroid()?4096:8192,o=_.A.mediaSDKHandle.is32bitbrowser||!l.Ay.isChromeVersionHigherThan(90)||l.Ay.isChromeOS();if(e==m._c.VIDEO_ENCODE)r=_.A.localVideoEncMGR.map.get(0),_.A.VE?(i=!0,t=_.A.VE):(null!==(n=_.A.mediaSDKHandle)&&void 0!==n&&n.isSupportVideoShare&&!l.Ay.isAndroidIntegrationWithSAB()&&(a=32e3),t=Ie(1024,a),o&&(_.A.VE=t)),_.A.localVideoPara&&(_.A.localVideoPara.VE=t);else if(e==m._c.VIDEO_DECODE){var s;r=_.A.localVideoDecMGR.map.get(0),_.A.VD?(i=!0,t=_.A.VD):(null!==(s=_.A.mediaSDKHandle)&&void 0!==s&&s.isSupportVideoShare&&!l.Ay.isAndroidIntegrationWithSAB()&&(a=16384),t=Ie(1024,a),o&&(_.A.VD=t)),_.A.localVideoPara&&(_.A.localVideoPara.VD=t)}else e==m._c.SHARING_ENCODE?(r=_.A.localSharingEncMGR.map.get(0),_.A.SE?(i=!0,t=_.A.SE):(t=Ie(1024,a),o&&(_.A.SE=t)),_.A.localVideoPara&&(_.A.localVideoPara.SE=t)):e==m._c.SHARING_DECODE&&(r=_.A.localSharingDecMGR.map.get(0),_.A.SD?(i=!0,t=_.A.SD):(t=Ie(1024,a),o&&(_.A.SD=t)),_.A.localVideoPara&&(_.A.localVideoPara.SD=t));i&&new Uint8Array(t.buffer).fill(0),r.postMessage({command:"wasmMemory",data:t})}function Me(e,t,r){l.Ay.downloadAndCompileWebAssembly(e,r,g.A,!l.Ay.browser.isSafari&&_.A.enableStreamingInstantiate).then((function(e){t.postMessage({command:"DOWNLOAD_WASM_FROM_MAIN_THREAD_OK",data:e})})).catch((function(e){t.postMessage({command:"DOWNLOAD_WASM_FROM_MAIN_THREAD_FAILED"})}))}var Oe=function(){var e={send:null,recv:null,decrpt:null},t=null,r=/(WCL_MCM_AUDIO.*?)(\{\[SPEECHINPUT_R16\]\}),(.*?),(.*?),(.*?),(.*?),(\{\[SEND\]\}.*?)(\{\[DENOISE\]\}.*?)\{\[CAPTURE\]\},(.*?),(\{\[AEC\]\},.*?),(\{\[END\]\})/,n=/(WCL_MCM_AUDIO.*?)(\{\[SPEECHOUTPUT_R16\]\},)(.*?),(\{\[NETWORK\]\}.*?)(\{\[RECEIVE\]\}.*?)\{\[RENDER\]\},(.*?),(.*?)(\{\[END\]\})/,i=/WCL_MCM_AUDIO_RECEIVE,(.*?)$/;return{push:function(r){var n=r.log,i=r.logSource;if(n&&this._isLogValid(n)){if(this._checkNeedReportImmediate(n,i))return i===u.Qm?this._sendWebRTCLog(n):this._report(n);if(i===u.js)e.send=n;else if(i===u.RP){if(n.includes("WCL_MCM_AUDIO_RECEIVE"))return void(e.decrpt=n);e.recv=n}else e.recv=n;this._clearTImer(),t=setTimeout(this._checkNeedReport.bind(this),2e3)}},_isLogValid:function(e){return!!(e.match("WCL_MCM_AUDIO")||e.match("JITTER")||e.match("DEVICE")||e.match("ORIGINAL_SOUND")||e.match("AUDIO_CODEC_EVENT")||e.match("AUDIOEVENT")||e.match("AUDIO_DEVICE_VOLUME"))},_checkNeedReportImmediate:function(e,t){return t===u.Qm||!(e.match("SPEECHOUTPUT_R16")||e.match("SPEECHINPUT_R16")||e.match("WCL_MCM_AUDIO_RECEIVE"))},_checkNeedReport:function(){var e=this._generateLog();e&&this._report(e)},_sendWebRTCLog:function(e){var t=this._parseSend(e),r=t.denoise,n=t.captureCounter;this._report("WCL_AB,"+r+"{[CAPTURTE]},"+n+",{[END]}")},_generateLog:function(){if(!e.send&&!e.recv)return null;var t=this._parseSend(e.send),r=t.inputputPrefix,n=t.speechInStr,i=t.speechInOutStr,a=t.denoiseInStr,o=t.denoiseOutStr,s=t.send,u=t.denoise,c=t.captureCounter,d=t.aec,l=this._parseRecv(e.recv),h=l.outputPrefix,f=l.speechOutStr,p=l.network,v=l.renderCounter,g=l.others,m=this._parseDecrpt(e.decrpt);this.recordEchoLog(d);var y=r||h,_="{[SPEECH_R16]},".concat(n,",").concat(i,",").concat(f,",").concat(a,",").concat(o,",").concat(d,",").concat(p,"{[RECEIVE]}").concat(m,",").concat(g,"{[PROCESS]},").concat(c,",").concat(v,",").concat(s).concat(u,"{[END]}");return"".concat(y).concat(_)},recordEchoLog:function(e){var t=e.match(/-?\d+/g);t&&(parseInt(t[0])||parseInt(t[1]))&&f.Ay.directReport("echo captured: "+t[0]+": "+t[1])},_parseSend:function(e){var t=r.exec(e||"")||[];return{inputputPrefix:t[1]||"",speechInStr:t[3]||"",speechInOutStr:t[4]||"",denoiseInStr:t[5]||"",denoiseOutStr:t[6]||"",send:t[7]||"",denoise:t[8]||"",captureCounter:t[9]||"",aec:t[10]||""}},_parseRecv:function(e){var t=n.exec(e||"")||[];return{outputPrefix:t[1]||"",speechOutStr:t[3]||"",network:t[4]||"",receive:t[5]||"",renderCounter:t[6]||"",others:t[7]||""}},_parseDecrpt:function(e){return(i.exec(e||"")||[])[1]||""},_report:function(e){e&&_.A.sendMessageToRwg(s.yGo,{evt:s.UFw,seq:1,body:{data:e}})},_clearTImer:function(){clearTimeout(t),t=null},clear:function(){e={send:null,recv:null},this._clearTImer()}}}();function xe(e){var t=e.data;try{if(0===t.status)t.time?_.A.AudioNode&&_.A.AudioNode.postData("data",{ssrc:_.A.CurrentSSRC,data:t.data,time:t.time}):_.A.AudioNode&&_.A.AudioNode.postData("data",{ssrc:_.A.CurrentSSRC,data:t.data,time:null});else if(t.status===c.c||t.status===c.ex)g.A.add_monitor("ADWS"),_.A.isAudioDecodeWASMOK=!0,_.A.audioDecInitInstance.setWasmSuccess(),_.A.isPreviewMode.audioDecode&&_.A.Notify_APPUI_SAFE(s.CXV);else if(t.status===c.v7)g.A.add_monitor("ADWF",t.data),K("ADWF"),_.A.audioDecInitInstance.setWasmSuccess(!1);else if(t.status===c.my)g.A.add_monitor("ADHS"),_.A.audioDecInitInstance.setHanderSuccess();else if(t.status===c.Jj)g.A.add_monitor("ADHF"),_.A.audioDecInitInstance.setHanderSuccess(!1);else if(t.status===c.Jw)g.A.add_monitor("ADSS"),_.A.audioDecInitInstance.setSocketSuccess();else if(t.status===c.s8)g.A.add_monitor("ADSF"),_.A.audioDecInitInstance.isSocketInitSuccess()&&(0,C.iK)(s.bo2,null),_.A.audioDecInitInstance.setSocketSuccess(!1);else if(t.status===c.Ub)g.A.add_monitor("ADWPS");else if(t.status===c.Y)g.A.add_monitor("ADWPCLOSE"),oe(m.wd.ZOOM_CONNECTION_AUDIO,m.oB.NET_WEBTRANSPORT);else if(t.status===c.UG)g.A.add_monitor("ADWSCLOSE");else if(t.status===c.xQ)g.A.add_monitor("ADTTP:"+t.type);else if(t.status==c.vr)g.A.send_monitor_directly(t.data);else if(t.status===c.wQ){var r=_.A.localAudioDecMGR.map.get(_.A.SPECIAL_ID);Me(t.url,r,m._c.AUDIO_DECODE)}else if(t.status==c.Bi)g.A.add_monitor("AD"+t.data);else if(t.status==c.uf)t.at&&_.A.CurrentSSRCTime!==t.at&&(_.A.CurrentSSRCTime=t.at,_.A.audioPlayTime=Date.now()),t.st&&_.A.mediaSDKHandle.SharingRenderObj&&_.A.mediaSDKHandle.SharingRenderObj.SetcATimeStamp(t.st);else if("multiCurrentTime"==t.status){if(_.A.localVideoDecMGR){var n=_.A.localVideoDecMGR.map.get(_.A.SPECIAL_ID);n&&n.postMessage({command:"audioDecodeTime",data:t.data,status:1})}}else if(t.status==c.Xd);else if(t.status===c.b5)Oe.push({log:t.data,logSource:u.RP});else if(t.status===s.iQY){var i=L({encoding:!1},t.data);_.A.Notify_APPUI_SAFE(s.iQY,i)}else t.status===c.yC?_.A.Notify_APPUI_SAFE(s.Tbw,t.data):t.status===c.Jo?_.A.Notify_APPUI_SAFE(s.Joy,{isUplink:t.isUplink,networkLevel:t.networkLevel,bwLevel:t.bwLevel}):G(m._c.AUDIO_DECODE,e)}catch(e){f.Ay.error("Error in AudioDecodeListener",e)}}function Pe(e){if(_.A.localAudioDecMGR||_.A.isPreviewMode.audioEncode)try{var t=e.data;if(t.status===c.sv);else if(0==t.status){var r=_.A.SPECIAL_ID,n=_.A.localAudioDecMGR.map.get(r);n&&n.postMessage({command:"EncodedAudioFrame",data:t.data},[t.data.buffer])}else if(t.status==c.Xd);else if(t.status===c.c||t.status===c.ex)g.A.add_monitor("AEWS"),_.A.isAudioEncodeWASMOK=!0,_.A.audioEncodeInitInstance.setWasmSuccess();else if(t.status===c.Pp||t.status===c.v7)g.A.add_monitor("AEWF",t.data),K("AEWF"),_.A.audioEncodeInitInstance.setWasmSuccess(!1);else if(t.status===c.my)g.A.add_monitor("AEHS"),_.A.audioEncodeInitInstance.setHanderSuccess();else if(t.status===c.Jw)g.A.add_monitor("AESS"),_.A.audioEncodeInitInstance.setSocketSuccess();else if(t.status===c.s8)g.A.add_monitor("AESF"),_.A.audioEncodeInitInstance.isSocketInitSuccess()&&(0,C.iK)(s.bo2,null),_.A.audioEncodeInitInstance.setSocketSuccess(!1);else if(t.status===c.Jj)g.A.add_monitor("AEHF"),_.A.audioEncodeInitInstance.setHanderSuccess(!1);else if(t.status===c.TK)_.A.Notify_APPUI_SAFE(c.TK,null);else if(t.status===c.Ub)g.A.add_monitor("AEWPS");else if(t.status===c.Y)g.A.add_monitor("AEWPCLOSE");else if(t.status===c.UG)g.A.add_monitor("AEWSCLOSE");else if(t.status===c.xQ)g.A.add_monitor("AETTP:"+t.type);else if(t.status===c.Rw)_.A.indexDbObject.put(t.delay,"delay"),_.A.openIndexFlag&&_.A.indexDbObject.select("delay");else if(t.status===c.wQ){var i=_.A.localAudioEncMGR.map.get(_.A.SPECIAL_ID);Me(t.url,i,m._c.AUDIO_ENCODE)}else if(t.status==c.Bi)g.A.add_monitor("AE"+t.data);else if(t.status==c.M9);else if(t.status===c.b5)Oe.push({log:t.data,logSource:u.js});else if(t.status===s.iQY){var a=L({encoding:!0},t.data);_.A.Notify_APPUI_SAFE(s.iQY,a)}else t.status===c.YQ?_.A.mediaSDKHandle.init_Notify_APPUI(!0,m._c.AUDIO_ENCODE):t.status===s.AV$?_.A.Notify_APPUI_SAFE(s.AV$):t.status===s._9I?_.A.Notify_APPUI_SAFE(s._9I,{value:t.value}):t.status===c.Jo?_.A.Notify_APPUI_SAFE(s.Joy,{isUplink:t.isUplink,networkLevel:t.networkLevel,bwLevel:t.bwLevel}):t.status==c.NO?((0,C.iK)(s.bes,c.NO),f.Ay.error("Health Check Failed: ".concat(c.NO,", ").concat(t.videoType,",").concat(t.subforme,",").concat(t.hasRTPPackets))):G(m._c.AUDIO_ENCODE,e)}catch(e){f.Ay.error("Error in AudioEnc_Listener",e)}}function Le(e){return Ne.apply(this,arguments)}function Ne(){return Ne=H(O().mark((function e(t){var r,n,i,a,o,s,u,c=arguments;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=c.length>1&&void 0!==c[1]?c[1]:48e3,n=l.Ay.browser.isSafari&&l.Ay.getMacSafariMajorVersion()<16,_.A.sharedBuffer||!l.Ay.isSupportSharedArrayBuffer()||n||(N("LP2PSP"),i=1,(l.Ay.browser.isFirefox||48e3===l.Ay.getAudioContextConfigure().sampleRate)&&(i=48),a=l.Ay.isChromeVersionHigherThan(74)?960:r/100*2,o=l.Ay.isBrowserSupportStereo()?2:1,s=t?2:1,u=l.Ay.isSupportSharingStereo()?2:1,_.A.sharedBuffer={inputState:new SharedArrayBuffer(24),inputBuffer:new SharedArrayBuffer(i*a*4*4*o),sharingInputState:new SharedArrayBuffer(24),sharingInputBuffer:new SharedArrayBuffer(i*a*4*4*u),outputState:new SharedArrayBuffer(24),outputBuffer:new SharedArrayBuffer(i*a*4*4*2),rtpBuffer:new SharedArrayBuffer(120008),echoState:_.A.enableEchoDetection?new SharedArrayBuffer(24):void 0,echoBuffer:_.A.enableEchoDetection?new SharedArrayBuffer(i*a*4*4*s):void 0}),g.A.add_monitor("INITSAB"+!!_.A.sharedBuffer),_.A.decoderinworklet=_.A.decoderinworkletOP&&!!_.A.sharedBuffer;case 4:case"end":return e.stop()}}),e)}))),Ne.apply(this,arguments)}function Ve(e,t){var r;_.A.localSharingPara?Object.assign(_.A.localSharingPara,t):_.A.localSharingPara=t,r=e,_.A.Sharing_WebSocket_Ip_Address=r}function Ue(e,t){_.A.localAudioPara?Object.assign(_.A.localAudioPara,t):_.A.localAudioPara=t,Be(e)}function Fe(e,t){_.A.localVideoPara?Object.assign(_.A.localVideoPara,t):_.A.localVideoPara=t,Ge(e)}function Be(e){_.A.Audio_WebSocket_Ip_Address=e}function We(e){_.A.Audio_Web_Transport_Ip_Address=e}function Ge(e){_.A.Video_WebSocket_Ip_Address=e}function He(e){_.A.Video_Web_Transport_Ip_Address=e}function je(){!function(e){if(e=_.A.SPECIAL_ID,_.A.localAudioEncMGR){var t=_.A.localAudioEncMGR.map.get(e);t&&(t.postMessage({command:E.KU}),_.A.localAudioEncMGR.map.delete(e)),_.A.audioEncodeSession=null}}(_.A.SPECIAL_ID),function(e){if(e=_.A.SPECIAL_ID,_.A.localAudioDecMGR){var t=_.A.localAudioDecMGR.map.get(_.A.SPECIAL_ID);t&&(t.postMessage({command:E.KU}),_.A.localAudioDecMGR.map.delete(e)),_.A.audioDecodeSession=null}}(_.A.SPECIAL_ID),_.A.localAudioDecMGR=null,_.A.localAudioEncMGR=null}function Ke(){!function(e){if(e=_.A.SPECIAL_ID,_.A.localVideoDecMGR){var t=_.A.localVideoDecMGR.map.get(e);t&&(t.postMessage({command:E.KU}),_.A.localVideoDecMGR.map.delete(e)),_.A.videoDecodeSession=null}}(_.A.SPECIAL_ID),_.A.localVideoDecMGR=null,_.A.localVideoEncMGR=null}function ze(){!function(){var e=_.A.SPECIAL_ID;if(_.A.localSharingDecMGR){var t=_.A.localSharingDecMGR.Get(e);t&&(t.postMessage({command:E.KU}),_.A.localSharingDecMGR=null),_.A.isSharingDecodeThreadStart=!1}}()}function qe(e,t,r,n,i,a,o){if(_.A.localVideoEncMGR){var s=_.A.localVideoEncMGR.map.get(e);if(s){var u={command:"encodeVideoFrame",data:t,stride:r,x:n,y:i,frame_width:a,frame_height:o};s.postMessage(u,[u.data.buffer])}}}function Ye(e,t,r,n,i,a){var o,s,u;(s=null!==(o=_.A.mediaSDKHandle)&&void 0!==o&&o.isSupportVideoShare?_.A.localVideoEncMGR.map.get(e):_.A.localSharingEncMGR.map.get(e))&&(t?(u={command:"encodeSharingFrame",data:t,width:i,height:a},s.postMessage(u,[u.data.buffer])):(u={command:"encodeSharingFrame"},s.postMessage(u)))}function Xe(e,t,r,n,i,a,o,s,u,c,d){if(_.A.isVideoPlayWork){var l={yuvdata:t,ntptime:r,ssrc:e,width:n,height:i,r_x:a,r_y:o,r_w:s,r_h:u,rotation:c,yuv_limited:d};l.ssrc=l.ssrc>>10<<10,_.A.mediaSDKHandle.VideoRenderObj.Put_Video_Data_Queue(l,15)}}function Qe(){return _.A.localSharingDecMGR?_.A.localSharingDecMGR.SharingQueueMGR.ClearQueue():_.A.localMouseDecMGR?_.A.localMouseDecMGR.SharingQueueMGR.ClearQueue():0}function Je(e,t,r,n){return $e.apply(this,arguments)}function $e(){return($e=H(O().mark((function e(t,r,n,i){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=_.A.isVideoDecodeThreadStart,e.t0){e.next=5;break}return _.A.isVideoDecodeThreadStart=!0,e.next=5,W(i,_.A.localVideoDecMGR,Te,m._c.VIDEO_DECODE,n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ze(e,t,r,n){return et.apply(this,arguments)}function et(){return(et=H(O().mark((function e(t,r,n,i){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g.A.add_monitor("AADT"),!n||!n.isDestroy){e.next=2;break}return e.abrupt("return",(g.A.add_monitor("ZID"),N("WorkerType:audioDec;The relative SDK instance is destroy, don't start relative worker, avoid multiple same workers. ")));case 2:if(e.t0=_.A.isAudioDecodeThreadStart,e.t0){e.next=7;break}return _.A.isAudioDecodeThreadStart=!0,e.next=7,W(i,_.A.localAudioDecMGR,xe,m._c.AUDIO_DECODE,n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tt(e){if(e>>=10,_.A.localAudioDecMGR){var t=_.A.localAudioDecMGR.GetSSRCTimeMap(e);return null===t?0:t}}function rt(e){return{currentSSRCTime:_.A.CurrentSSRCTime,audioPlayTime:_.A.audioPlayTime}}function nt(e,t){var r=_.A.SPECIAL_ID,n=_.A.localVideoDecMGR.map.get(r);n.postMessage({command:"failover",websocket_ip_address:t}),(n=_.A.localAudioDecMGR.map.get(r)).postMessage({command:"failover",websocket_ip_address:e})}function it(e){for(var t,r=_.A.SPECIAL_ID,n=_.A.audio_pcm_queue.dequeue();n;)n=_.A.audio_pcm_queue.dequeue();_.A.localAudioEncMGR&&(t=_.A.localAudioEncMGR.map.get(r))&&_.A.audioEncodeSession&&t.postMessage({command:"modifySampleRate",sampleRate:e}),_.A.localAudioDecMGR&&(t=_.A.localAudioDecMGR.map.get(r))&&_.A.audioDecodeSession&&t.postMessage({command:"modifySampleRate",sampleRate:e})}function at(e,t,r){if(e=_.A.SPECIAL_ID,_.A.localAudioDecMGR){var n=_.A.localAudioDecMGR.map.get(e);n&&n.postMessage({command:"mute",bOn:t,fakeLeave:r})}if(_.A.localAudioEncMGR){var i=_.A.localAudioEncMGR.map.get(e);i&&i.postMessage({command:"mute",bOn:t,fakeLeave:r})}}function ot(e,t){if(e=_.A.SPECIAL_ID,_.A.localAudioDecMGR){var r=_.A.localAudioDecMGR.map.get(e);r&&r.postMessage({command:"AecFlag",flag:t})}if(_.A.localAudioEncMGR){var n=_.A.localAudioEncMGR.map.get(e);n&&n.postMessage({command:"AecFlag",flag:t})}}function st(e,t,r,n){var i=_.A.SPECIAL_ID;if(_.A.localAudioDecMGR){var a=_.A.localAudioDecMGR.map.get(i);a&&a.postMessage({command:r},[e.port2])}if(_.A.localAudioEncMGR){var o=_.A.localAudioEncMGR.map.get(i);o&&o.postMessage({command:n},[t.port1])}}function ut(e,t){var r=_.A.SPECIAL_ID;if(_.A.localVideoDecMGR){var n=_.A.localVideoDecMGR.map.get(r);n&&n.postMessage({command:"decodeVideoPort"},[e.port1])}if(_.A.localVideoEncMGR){var i=_.A.localVideoEncMGR.map.get(r);i&&i.postMessage({command:"encodeVideoPort"},[t.port2])}}function ct(e,t){var r=_.A.SPECIAL_ID;if(_.A.localVideoDecMGR){var n=_.A.localVideoDecMGR.map.get(r);n&&n.postMessage({command:"vsport"},[e.port1])}if(_.A.localSharingDecMGR){var i=_.A.localSharingDecMGR.map.get(r);i&&i.postMessage({command:"vsport"},[t.port2])}}function dt(e){var t=_.A.SPECIAL_ID;if(_.A.localAudioDecMGR){var r=_.A.localAudioDecMGR.map.get(t);r&&r.postMessage({command:"decodeAudioPort2"},[e.port2])}}function lt(e){var t=_.A.SPECIAL_ID;if(_.A.localAudioEncMGR){var r=_.A.localAudioEncMGR.map.get(t);r&&r.postMessage({command:"shareAudioDecodeAudioPort2"},[e.port2])}}function ht(e){var t=_.A.SPECIAL_ID;if(_.A.localVideoDecMGR){var r=_.A.localVideoDecMGR.map.get(t);r&&r.postMessage({command:"decodeVideoPortWithAudio",port:e.port1},[e.port1])}}function ft(e){var t=_.A.SPECIAL_ID;if(_.A.localVideoEncMGR){var r=_.A.localVideoEncMGR.map.get(t);r&&r.postMessage(e)}}function pt(e,t){vt({command:e,data:t},[t])}function vt(e,t){var r=_.A.SPECIAL_ID;if(!_.A.localVideoEncMGR)return!1;var n=_.A.localVideoEncMGR.map.get(r);return!!n&&(n.postMessage(e,t),!0)}function gt(e){var t=_.A.SPECIAL_ID;if(_.A.localVideoDecMGR){var r=_.A.localVideoDecMGR.map.get(t);r&&r.postMessage(e)}}function mt(e,t){var r=_.A.SPECIAL_ID;if(_.A.localVideoEncMGR){var n=_.A.localVideoEncMGR.map.get(r);n&&n.postMessage({command:e,data:t},[t])}}function yt(e,t){var r=_.A.SPECIAL_ID;if(_.A.localSharingEncMGR){var n=_.A.localSharingEncMGR.map.get(r);n&&n.postMessage({command:e,data:t},[t])}}function _t(e){if(_.A.localVideoDecMGR){var t=_.A.localVideoDecMGR.map.get(_.A.SPECIAL_ID);t&&t.postMessage(e)}}function St(e){var t=_.A.SPECIAL_ID;if(_.A.localSharingDecMGR){var r=_.A.localSharingDecMGR.map.get(t);r&&r.postMessage(e)}}function At(e){var t=_.A.SPECIAL_ID;if(_.A.localAudioDecMGR){var r=_.A.localAudioDecMGR.map.get(t);r&&r.postMessage({command:"updateCurrentSSRC",SSRC:e})}}function bt(e){var t=_.A.SPECIAL_ID;if(_.A.localAudioEncMGR){var r=_.A.localAudioEncMGR.map.get(t);r&&r.postMessage(e)}}function Et(e){var t=_.A.SPECIAL_ID;if(_.A.localAudioDecMGR){var r=_.A.localAudioDecMGR.map.get(t);r&&r.postMessage(e)}}function kt(e){var t={command:"interpretation_enable",enable:e};bt(t),_.A.decoderinworklet?_.A.workletWasmInitSuccess&&_.A.AudioNode?_.A.AudioNode.postCMD("interpretation_enable",t):_.A.workletMessageQueue.enqueue(t):Et(t)}function Ct(e){bt({command:"cc_set_lang",lang:e})}function wt(e){var t={command:"interpretation_set_lang",lang:e};bt(t),_.A.decoderinworklet?_.A.workletWasmInitSuccess&&_.A.AudioNode?_.A.AudioNode.postCMD("interpretation_set_lang",t):_.A.workletMessageQueue.enqueue(t):Et(t)}function Tt(e){var t={command:"interpretation_mute_origin",mute:e};bt(t),_.A.decoderinworklet?_.A.workletWasmInitSuccess&&_.A.AudioNode?_.A.AudioNode.postCMD("interpretation_mute_origin",t):_.A.workletMessageQueue.enqueue(t):Et(t)}function Rt(e){var t={command:"interpretation_set_interpreter",interpreterList:e};bt(t),_.A.decoderinworklet?_.A.workletWasmInitSuccess&&_.A.AudioNode?_.A.AudioNode.postCMD("interpretation_set_interpreter",t):_.A.workletMessageQueue.enqueue(t):Et(t)}function It(){var e=_.A.SPECIAL_ID;if(_.A.localAudioEncMGR){var t=_.A.localAudioEncMGR.map.get(e);t&&t.postMessage({command:"resetAec"})}}function Dt(e){try{if(g.A&&e){var t=["ERR:",e.message,"f"].join(""),r=g.A.checkIsNecessaryExceptionLogAndReturnRepeatTimes(t);r.isNecessary?(N("error repeat ".concat(r.repeatNumber),t),g.A.add_monitor(t+"(repeat:".concat(r.repeatNumber,")"))):N("error but ignore",e.message)}}catch(e){N("_listenWindowErrorEvent error",e)}}function Mt(){try{var e,t;g.A.add_monitor(["BSAGT:",navigator.userAgent].join("")),g.A.add_monitor("BSLITEND:"+(l.Ay.isLittleEndian()?1:0)),window.navigator.hardwareConcurrency&&g.A.add_monitor("OSCPUS:"+window.navigator.hardwareConcurrency);var r=l.Ay.getOSInfo();g.A.add_monitor("deviceType:".concat(r.osType,"|os_name:").concat(r.os,"|os_version:").concat(r.osVersion)),g.A.add_monitor("browser_name:".concat(null==r||null===(e=r.browser)||void 0===e?void 0:e.name,"|browser_version:").concat(null==r||null===(t=r.browser)||void 0===t?void 0:t.version)),(0,l.jo)()}catch(e){console.error("<<<<",e)}}function Ot(e){g.A.init(),window.addEventListener("error",Dt),_.A.monitorIntervalHandle=setInterval((function(){if(g.A.startSendLog){var e=g.A.get_monitor();e&&g.A.send_monitor_directly(e)}}),1e4)}function xt(e){g.A.add_monitor2(e)}function Pt(e){window.removeEventListener("error",Dt),clearInterval(_.A.monitorIntervalHandle),g.A.send_instant_monitor()}function Lt(e){var t=_.A.SPECIAL_ID;if(_.A.localVideoEncMGR){var r=_.A.localVideoEncMGR.map.get(t);r&&r.postMessage({command:"ENCRYPT",encrypt:e})}}function Nt(e){var t=_.A.SPECIAL_ID;if(_.A.localSharingEncMGR){var r=_.A.localSharingEncMGR.Get(t);r&&r.postMessage({command:"ENCRYPT",encrypt:e})}}function Vt(e){if(_.A.localVideoEncMGR){var t=_.A.localVideoEncMGR.map.get(_.A.SPECIAL_ID);t&&t.postMessage(e)}}function Ut(e){if(_.A.localSharingEncMGR){var t=_.A.localSharingEncMGR.map.get(_.A.SPECIAL_ID);t&&t.postMessage(e)}}function Ft(e){if(_.A.localVideoEncMGR){var t=_.A.localVideoEncMGR.map.get(_.A.SPECIAL_ID);t&&t.postMessage(e)}}function Bt(e){if(_.A.localSharingEncMGR){var t=_.A.localSharingEncMGR.map.get(_.A.SPECIAL_ID);t&&t.postMessage(e)}}function Wt(e){var t=_.A.SPECIAL_ID;if(_.A.localAudioEncMGR){var r=_.A.localAudioEncMGR.map.get(t);r&&r.postMessage({command:"ENCRYPT",encrypt:e})}}function Gt(){var e=_.A.SPECIAL_ID;[_.A.localAudioDecMGR,_.A.localAudioEncMGR,_.A.localVideoDecMGR,_.A.localVideoEncMGR,_.A.localSharingDecMGR,_.A.localSharingEncMGR].forEach((function(t){t&&t.map.get(e)&&t.map.get(e).postMessage({command:"SOCKET_RECONNECT",disable:!0})}))}function Ht(e){e.forEach((function(e){e&&(e.setHanderSuccess(!1),e.setSocketSuccess(!1),e.setWasmSuccess(!1))}))}function jt(e,t){var r=_.A.SPECIAL_ID;e&&e.forEach((function(e){e&&e.map.get(r)&&(e.map.get(r).onmessage=null)})),t&&t.forEach((function(e){e&&e.map.get(r)&&(e.map.get(r).onmessage=null)}))}function Kt(e,t,r){return zt.apply(this,arguments)}function zt(){return zt=H(O().mark((function e(t,r,n){var i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=_.A.SPECIAL_ID,r.forEach((function(e){e&&e.map.get(i)&&e.map.get(i).postMessage({command:E.KU,_id:t._id})})),n.forEach((function(e){e&&e.map.get(i)&&e.map.get(i).postMessage({command:E.KU,_id:t._id})})),e.next=6,l.Ay.sleep(1e3);case 6:case"end":return e.stop()}}),e)}))),zt.apply(this,arguments)}function qt(e,t){return Yt.apply(this,arguments)}function Yt(){return Yt=H(O().mark((function e(t,r){var n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=_.A.SPECIAL_ID,(i=t).forEach((function(e){e&&e.map.get(n)&&e.map.get(n).terminate()})),i=r,e.next=5,l.Ay.is32bitChrome();case 5:if(e.t0=e.sent,e.t0){e.next=8;break}i.forEach((function(e){e&&e.map.get(n)&&e.map.get(n).terminate()}));case 8:case"end":return e.stop()}}),e)}))),Yt.apply(this,arguments)}function Xt(e){var t;switch(e){case m._c.AUDIO_DECODE:t=_.A.localAudioDecMGR;break;case m._c.AUDIO_ENCODE:t=_.A.localAudioEncMGR;break;case m._c.VIDEO_DECODE:t=_.A.localVideoDecMGR;break;case m._c.VIDEO_ENCODE:t=_.A.localVideoEncMGR;break;case m._c.SHARING_DECODE:t=_.A.localSharingDecMGR;break;case m._c.SHARING_ENCODE:t=_.A.localSharingEncMGR}var r=_.A.SPECIAL_ID;return t&&t.map.get(r)?t.map.get(r):null}function Qt(e,t){return Jt.apply(this,arguments)}function Jt(){return Jt=H(O().mark((function e(t,r){var n,i,a,o,s=arguments;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>2&&void 0!==s[2]?s[2]:E.Dv,i=s.length>3&&void 0!==s[3]&&s[3],a=s.length>4&&void 0!==s[4]&&s[4],e.t0=a,!e.t0){e.next=5;break}return e.next=5,function(){var e=H(O().mark((function e(t){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===m._c.VIDEO_ENCODE?3:e.t0===m._c.VIDEO_DECODE?6:e.t0===m._c.AUDIO_ENCODE?9:e.t0===m._c.AUDIO_DECODE?12:e.t0===m._c.SHARING_ENCODE?15:e.t0===m._c.SHARING_DECODE?18:21;break;case 3:return e.next=5,_.A.videoInitInstance.initSuccessPromise;case 5:return e.abrupt("break",22);case 6:return e.next=8,_.A.videoDecInitInstance.initSuccessPromise;case 8:return e.abrupt("break",22);case 9:return e.next=11,_.A.audioEncodeInitInstance.initSuccessPromise;case 11:return e.abrupt("break",22);case 12:return e.next=14,_.A.audioDecInitInstance.initSuccessPromise;case 14:return e.abrupt("break",22);case 15:return e.next=17,_.A.sharingEncInitInstance.initSuccessPromise;case 17:return e.abrupt("break",22);case 18:return e.next=20,_.A.sharingDecInitInstance.initSuccessPromise;case 20:return e.abrupt("break",22);case 21:f.Ay.error("No matched worker type: ".concat(t));case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(t);case 5:if(o=Xt(t)){e.next=11;break}if(a){e.next=9;break}return e.abrupt("return",(N("worker handle not ready, drop!",t,r,n),!1));case 9:if(N.warn("worker handle not ready, waiting!",t,r,n),o=Xt(t)){e.next=11;break}return e.abrupt("return");case 11:return e.abrupt("return",(i?o.postMessage({command:n,data:r},[r]):o.postMessage({command:n,data:r}),!0));case 12:case"end":return e.stop()}}),e)}))),Jt.apply(this,arguments)}function $t(){return null!==Xt(m._c.VIDEO_ENCODE)}function Zt(e,t,r){var n=_.A.SPECIAL_ID;if(_.A.localVideoEncMGR){var i=_.A.localVideoEncMGR.map.get(n);i&&(e?i.postMessage({command:t,canvas:e,rendercanvasID:r},[e]):i.postMessage({command:t,canvas:e,rendercanvasID:r}))}}function er(e){var t;return t=new e({storeOptions:{nameSpaceId:"vbFile"}}),new Promise((function(e,r){t.on("ready",(function(){e(t)}))}))}function tr(e,t,r){return window.crypto.subtle.decrypt({name:"AES-GCM",iv:r},t,e)}function rr(e){for(var t,r,n=function(n){"js"==e[n].type?(g.A.add_monitor("VDTF"),_.A.tfjsurl=e[n].path,t=_.A.SPECIAL_ID,_.A.localVideoEncMGR&&(r=_.A.localVideoEncMGR.map.get(t))&&r.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:_.A.tfjsurl,type:"js"})):"bin"==e[n].type&&fetch(e[n].path).then((function(e){if(!e.ok)throw new Error("network issue");return e.arrayBuffer()})).then((function(t){g.A.add_monitor("VDBIN"),_.A.vbarraybuffer=t;try{e[n].path.indexOf("dual")>=0&&function(e){var t=new Uint8Array(e,0,12),r=new Uint8Array(e,12,32);window.crypto.subtle.importKey("raw",r,"AES-GCM",!0,["encrypt","decrypt"]).then((function(n){var i=t.length+r.length,a=new Uint32Array(e.slice(i,i+4))[0];i+=4;var o=e.slice(i,i+a);i+=a,a=new Uint32Array(e.slice(i,i+4))[0],i+=4;var s=new Uint8Array(e,i,a);i+=a,a=new Uint32Array(e.slice(i,i+4))[0],i+=4;var u=e.slice(i,i+a);i+=a,a=new Uint32Array(e.slice(i,i+4))[0],i+=4;var c=new Uint8Array(e,i,a);_.A.basebin=o,_.A.afnbin=u,tr(c,n,t).then((function(e){_.A.afnjson=(new TextDecoder).decode(e);var t=_.A.SPECIAL_ID;if(_.A.localVideoEncMGR){var r=_.A.localVideoEncMGR.map.get(t);r&&_.A.afnbin&&_.A.afnjson&&r.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:_.A.afnbin,json:_.A.afnjson},index:1})}})),tr(s,n,t).then((function(e){_.A.basejson=(new TextDecoder).decode(e);var t=_.A.SPECIAL_ID;if(_.A.localVideoEncMGR){var r=_.A.localVideoEncMGR.map.get(t);r&&_.A.basebin&&_.A.basejson&&r.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:_.A.basebin,json:_.A.basejson},index:2})}}))}))}(t)}catch(e){f.Ay.error("An error occurred when decrypting the virtual background file",e),g.A.add_monitor("VBDECRYPTF"),_.A.Notify_APPUI(s.KqK,V.FAIL)}})).catch((function(e){f.Ay.error("An error occurred when trying to obtain the virtual background file",e),g.A.add_monitor("VBFF"),_.A.Notify_APPUI(s.KqK,V.FAIL)}))},i=0;i<e.length;i++)n(i)}function nr(e,t){var r=_.A.SPECIAL_ID;if(_.A.localVideoEncMGR){var n=_.A.localVideoEncMGR.map.get(r);n&&(e?n.postMessage({command:"maskandbgimagebitmap",imagename:t,data:e},[e]):n.postMessage({command:"maskandbgimagebitmap",imagename:t,data:e}))}}function ir(e,t){var r=_.A.SPECIAL_ID;if(_.A.localVideoEncMGR){var n=_.A.localVideoEncMGR.map.get(r);n&&(e?n.postMessage({command:"vbbgimagebitmap",imagename:t,data:e},[e]):n.postMessage({command:"vbbgimagebitmap",imagename:t,data:e}))}}function ar(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=_.A.SPECIAL_ID;if(_.A.localVideoEncMGR){var o=_.A.localVideoEncMGR.map.get(a);o&&(e?o.postMessage({command:"maskandbgimagebitmap",imagename:t,data:e,maskCoordinate:r,width:n,height:i},[e]):o.postMessage({command:"maskandbgimagebitmap",imagename:t,data:e,maskCoordinate:r,width:n,height:i}))}}function or(e){var t=_.A.SPECIAL_ID;if(_.A.localVideoDecMGR){var r=_.A.localVideoDecMGR.map.get(t);r&&r.postMessage(e)}}function sr(){try{return l.Ay.browser.isChromeOrEdge&&-1!==["85","86"].indexOf(l.Ay.getBrowserVersion())}catch(e){return N(e),!1}}var ur=w(w(w(w(w(w({},m._c.VIDEO_ENCODE,{success:s.$MS,failed:s.rNn,callbackDataValue:m.Go.encode}),m._c.VIDEO_DECODE,{success:s.$MS,failed:s.rNn,callbackDataValue:m.Go.decode}),m._c.AUDIO_ENCODE,{success:s.epV,failed:s.uiQ,callbackDataValue:m.Go.encode}),m._c.AUDIO_DECODE,{success:s.epV,failed:s.uiQ,callbackDataValue:m.Go.decode}),m._c.SHARING_DECODE,{success:s.Y7X,failed:s.IQ_,callbackDataValue:m.Go.decode}),m._c.SHARING_ENCODE,{success:s.Y7X,failed:s.IQ_,callbackDataValue:m.Go.encode});function cr(e,t){var r=[m._c.AUDIO_ENCODE,m._c.AUDIO_DECODE,m._c.VIDEO_ENCODE,m._c.VIDEO_DECODE];e.isSupportVideoShare||r.push(m._c.SHARING_ENCODE,m._c.SHARING_DECODE),r.forEach(function(){var e=H(O().mark((function e(r){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Qt(r,t,E.o$,!1,!0);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}function dr(e){var t,r,n,i=l.Ay.getOSInfo();e.cpu=(null===(t=navigator)||void 0===t?void 0:t.hardwareConcurrency)||1,e.deviceType=i.osType,e.osType=i.os;var a=l.Ay.getGpuInfo();e.gpuInfo=null==a?void 0:a.renderInfo,f.Ay.directReport(JSON.stringify(e));var o=null===_.A||void 0===_.A||null===(r=_.A.instance)||void 0===r?void 0:r.persistenceInfo;if(o){var s=e.encode?o.getVideoEncoderInfo():o.getVideoDecoderInfo(),u={};u.osVersion=i.osVersion,u.browserVersion=null===(n=i.browser)||void 0===n?void 0:n.version,u.sdkVersion="11738",s.updateInfo(e,u)}}function lr(e,t){var r,n=[[],[[m._c.AUDIO_ENCODE],[m._c.AUDIO_DECODE],[m._c.AUDIO_ENCODE,m._c.AUDIO_DECODE]],[[m._c.VIDEO_ENCODE],[m._c.VIDEO_DECODE],[m._c.VIDEO_ENCODE,m._c.VIDEO_DECODE]],[],[[m._c.SHARING_ENCODE],[m._c.SHARING_DECODE],[m._c.SHARING_ENCODE,m._c.SHARING_DECODE]]],i=null===(r=t.body)||void 0===r?void 0:r.data;if(i){var a=i.type,o=i.mode;e.isSupportVideoShare&&4==a&&(a=2);var s=n[a][o];s&&0!=s.length&&s.forEach((function(e){Qt(e,i,E.lc,!1,!0)}))}}function hr(e,t){var r=null,n=null;return{create:function(){return r||(r=new Promise(function(){var i=H(O().mark((function i(a,s){var u,c,d,l;return O().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.t0=Blob,i.next=4,U(e,t);case 4:return i.t1=i.sent,i.t2=[i.t1],u=new i.t0(i.t2),i.next=9,u.arrayBuffer();case 9:if(c=i.sent,d=o().createObjectURL(new Blob([c])),l=new Worker(d,e?{name:e}:void 0),r){i.next=14;break}return i.abrupt("return",(l.terminate(),void a(null)));case 14:n=l,a(l),i.next=20;break;case 17:i.prev=17,i.t3=i.catch(0),a(null);case 20:case"end":return i.stop()}}),i,null,[[0,17]])})));return function(e,t){return i.apply(this,arguments)}}()),r)},destroy:function(){if(n||r){var e=r;r=null,n=null,e&&e.then((function(e){null==e||e.terminate()}))}}}}function fr(e){return Xt(e)}function pr(e){var t=null;switch(e){case m._c.AUDIO_DECODE:t=_.A.audioDecInitInstance;break;case m._c.AUDIO_ENCODE:t=_.A.audioEncodeInitInstance;break;case m._c.VIDEO_DECODE:t=_.A.videoDecInitInstance;break;case m._c.VIDEO_ENCODE:t=_.A.videoInitInstance;break;case m._c.SHARING_DECODE:t=_.A.sharingDecInitInstance;break;case m._c.SHARING_ENCODE:t=_.A.sharingEncInitInstance}return t}},7300:function(e,t,r){r.d(t,{A:function(){return Yn}});var n=r(7026),i=r(7857),a=r(6984),u=r.n(a),l=r(9558),h=r(2737),p=r(1461),g=r(9109),m=r(5408),_=r(5738),S=r(701),b=r(8353),E=r(5740),k=r(1882),C=r.n(k),T=r(7350),I=r.n(T),M=r(8023),x=r.n(M),P=r(31),L=r.n(P),N=r(9482);function V(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var U=(0,b.A)("sdk.remoteControl");function F(e){var t=this;this.dom=e.dom,this.socketURL=e.socketURL,this.meetingID=e.meetingID,this.condID=e.condID,this.blobSocket=null;var r=this._keyMouseEventHandler.bind(this);this.keyMouseEventHandler=function(e){t.keyMouseFilters(e).then((function(e){r(e)}))},this.keyMouseEventHandlerThrottle=I()((function(e){t.keyMouseEventHandler(e)}),1e3/24),this.pasteOnDocument=this._pasteOnDocument.bind(this),this.copyOnDocument=this._copyOnDocument.bind(this),this.cutOnDocument=this._cutOnDocument.bind(this),this.focus=this._focus.bind(this),this.PUBSUB_SHARING_PARAM_INFO_TOKEN=null,this.preventDefault=this._preventDefault.bind(this),this.browserBlurEventHandler=this._browserBlurEventHandler.bind(this),this.positionMap={canvas:{offsetX:0,offsetY:0},src:{x:0,y:0,w:0,h:0,scaleWidth:0,scaleHeight:0},dst:{x:0,y:0,w:0,h:0}},this.blockedKeyboardEventOfPaste=[],this.keydownupMergeRemoveMap={},this.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map={},this.PASTE_MAX_BYTE_LENGTH=64e3,this.currentMousePositionProps={clientX:0,clientY:0,x2video:0,y2video:0},this.isControllerNow=!0,this.remoteOS=N.Tl.UNKNOWN,this.localOS=this.getLocalOS(),this._blockedCopyKeyboardList=[],this.maxSleep=500}F.prototype={start:function(){var e=this;return new Promise(function(){var t=H(O().mark((function t(r,n){return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,U("remote control start"),e.modifyDom(),e.bindEvent(),e.subscribeSharingWidthOrHeightChange(),t.next=7,e.connectSocket();case 7:e.sendPostionPDU(),e.socketBlobMessageHandler(),r(!0),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),n(t.t0);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(e,r){return t.apply(this,arguments)}}())},destroy:function(){var e=this;return new Promise((function(t,r){try{U("destroy remote control"),e.unbindEvent(),e.uncheckAndClearKeydownupMergeRemoveMap(),e.destroySocket(),E.A.unsubscribe(e.PUBSUB_SHARING_PARAM_INFO_TOKEN),t(!0)}catch(e){U(e),t(!1)}}))},modifyDom:function(){try{this.dom.setAttribute("tabindex","0"),this.dom.focus()}catch(e){}},_focus:function(){this.dom.focus()},getLocalOS:function(){var e=r.g.navigator.platform;return/win/i.test(e)?N.Tl.WIN:/mac/i.test(e)?N.Tl.MAC:N.Tl.UNKNOWN},setIsControlerNow:function(e){this.isControllerNow=e},blobSocketCheckAndSend:function(e){this.isControllerNow&&this.blobSocket.send(e)},isKeyboardEvent:function(e){return!!e&&e.type&&-1!==["keydown","keyup"].indexOf(e.type.toLowerCase())},isThisKeyIgnoreCase:function(e,t){return e.key&&e.key.toLowerCase()==t.toLowerCase()},_copyOnDocument:function(e){var t=this;return H(O().mark((function r(){var n;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.isFocusNow()){r.next=2;break}return r.abrupt("return");case 2:"done"!=(n=t._blockedCopyKeyboardList)[n.length-1]&&(t._blockedCopyKeyboardList=[],t._blockedCopyKeyboardList.push("done"),U("copyOnDocument",e),t.processMonitorCtrlMetaWithKey("c"));case 4:case"end":return r.stop()}}),r)})))()},_cutOnDocument:function(e){var t=this;return H(O().mark((function r(){return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.isFocusNow()&&(U("_cutOnDocument",e),t.processMonitorCtrlMetaWithKey("x"));case 1:case"end":return r.stop()}}),r)})))()},processMonitorCtrlMetaWithKey:function(e){var t=this,r=this.remoteOS===N.Tl.MAC,n={t:"keydown",event_type:1,repeat:!1,alt:!1,shift:!1,capslock:!1,numlock:!0,pduType:85,ctrl:!r,super:r},i=Object.assign({},n,{charCode:0,keyCode:r?91:17,key:r?"Meta":"Control"}),a=Object.assign({},n,{charCode:e.charCodeAt(0),keyCode:e.toUpperCase().charCodeAt(0),key:e}),o=Object.assign({},i,{input_event_type:0}),s=(Object.assign({},i,{input_event_type:2}),Object.assign({},a,{input_event_type:0})),u=(Object.assign({},a,{input_event_type:2}),Object.assign({},i,{t:"keyup",ctrl:!1,super:!1,input_event_type:1})),c=Object.assign({},a,{t:"keyup",ctrl:!1,super:r,input_event_type:1});(r?[o,s,c,u]:[o,s,u,c]).forEach((function(e){t.processEvent(e)}))},isFocusNow:function(){return this.dom===document.activeElement},_pasteOnDocument:function(e){var t=this;return H(O().mark((function r(){var n,i,a,o,s,u,c,d,l,h,f;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.isFocusNow()){for(n=(e.clipboardData||window.clipboardData).getData("text"),U("_pasteOnDocument",n),i=[],a=0;a<n.length;a++)for(o=n[a],s=L().encode(o),u=0;u<s.length;u++)i.push(s.charCodeAt(u));for(c=new ArrayBuffer(8+i.length),d=new Uint8Array(c),l=new DataView(c,4,4),h=new Uint8Array(c,8),d[0]=87,l.setUint32(0,i.length,!0),f=0;f<i.length;f++)h[f]=i[f];i.length>t.PASTE_MAX_BYTE_LENGTH?(t.triggerPasteTextLengthOverflow(),t.dropAllEventFromBlockedKeyboardEventOfPaste()):(t.blobSocketCheckAndSend(c),t.processMonitorCtrlMetaWithKey("v"))}case 1:case"end":return r.stop()}}),r)})))()},onReturnCopiedText:function(e){!this._onReturnCopiedText_list&&(this._onReturnCopiedText_list=[]),this._onReturnCopiedText_list.push(e)},triggerReturnCopiedText:function(e){this._onReturnCopiedText_list&&this._onReturnCopiedText_list.forEach((function(t){return t(e)}))},onPasteTextLengthOverflow:function(e){!this._onPasteTextLengthOverflow_list&&(this._onPasteTextLengthOverflow_list=[]),this._onPasteTextLengthOverflow_list.push(e)},triggerPasteTextLengthOverflow:function(){this._onPasteTextLengthOverflow_list&&this._onPasteTextLengthOverflow_list.forEach((function(e){return e()}))},dropAllEventFromBlockedKeyboardEventOfPaste:function(){this.blockedKeyboardEventOfPaste=[]},createParamsFromKeyboardEvent:function(e){return{key:e.key,code:e.code,shiftKey:e.shiftKey,altKey:e.altKey,repeat:e.repeat,charCode:e.charCode,keyCode:e.keyCode,which:e.which,ctrlKey:e.ctrlKey,metaKey:e.metaKey}},sendAllEventFromBlockedKeyboardEventOfPaste:function(){for(U("blockedKeyboardEventOfPaste.length",this.blockedKeyboardEventOfPaste.length);this.blockedKeyboardEventOfPaste.length>0;){var e=this.blockedKeyboardEventOfPaste.shift();this._keyMouseEventHandler(e)}},_preventDefault:function(e){if(-1!==["keydown","keyup"].indexOf(e.type))for(var t=["v","c","x"],r=0;r<t.length;r++)if(e.ctrlKey^e.metaKey&&this.isThisKeyIgnoreCase(e,t[r]))return;e.preventDefault()},subscribeSharingWidthOrHeightChange:function(){var e=this;this.PUBSUB_SHARING_PARAM_INFO_TOKEN=E.A.on(p.vjv,(function(t,r){U("subscribeSharingWidthOrHeightChange",r.body),e.positionMap.dst.w=r.body.logicWidth,e.positionMap.dst.h=r.body.logicHeight,e.positionMap.src.w=r.body.logicWidth,e.positionMap.src.h=r.body.logicHeight,e.sendPostionPDU()}))},setDstWidthAndHeight:function(e,t){if(!e||!t)throw new Error("the value of destination sharing video width/height are not correct");this.positionMap.dst.w=e,this.positionMap.dst.h=t},setSrcWidthAndHeight:function(e,t){if(!e||!t)throw new Error("the value of source sharing video width/height are not correct");this.positionMap.src.w=e,this.positionMap.src.h=t},setSrcWidthAndHeightAndSendPDU:function(e,t){if(!e||!t)throw new Error("the value of source sharing video width/height are not correct");this.positionMap.src.w!==e&&this.positionMap.src.h!==t&&(this.setSrcWidthAndHeight(e,t),this.sendPostionPDU())},setSrcOffsetXYAndSendPDU:function(e,t){e=Math.floor(e),t=Math.floor(t),this.positionMap.canvas.offsetX===e&&this.positionMap.canvas.offsetY===t||(this.setSrcOffsetXY(e,t),this.sendPostionPDU())},setSrcScaleWidthAndHeight:function(e,t){if(!e||!t)throw new Error("the value of source sharing video scaleWidth/scaleHeight are not correct");this.positionMap.src.scaleWidth=e,this.positionMap.src.scaleHeight=t},setSrcOffsetXY:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=Math.floor(e),n=Math.floor(t);if(!x()(r)&&!x()(n))throw new Error("the value of source offset x or y is not correct");this.positionMap.canvas.offsetX=r,this.positionMap.canvas.offsetY=n},sendPostionPDU:function(){var e=new ArrayBuffer(36),t=new Uint8Array(e),r=new DataView(e,4),n=new DataView(e,20);t[0]=82,r.setInt32(0,this.positionMap.src.x,!0),r.setInt32(4,this.positionMap.src.y,!0),r.setInt32(8,this.positionMap.src.w,!0),r.setInt32(12,this.positionMap.src.h,!0),n.setInt32(0,this.positionMap.dst.x,!0),n.setInt32(4,this.positionMap.dst.y,!0),n.setInt32(8,this.positionMap.dst.w,!0),n.setInt32(12,this.positionMap.dst.h,!0),U("send position pdu");try{this.blobSocket.send(e)}catch(e){}},unbindEvent:function(){var e=this,t=this.dom;t.removeEventListener("click",e.focus),t.removeEventListener("keydown",e.keyMouseEventHandler),t.removeEventListener("keyup",e.keyMouseEventHandler),document.removeEventListener("paste",e.pasteOnDocument),document.removeEventListener("copy",e.copyOnDocument),document.removeEventListener("cut",e.cutOnDocument),t.removeEventListener("contextmenu",e.preventDefault),t.removeEventListener("wheel",e.preventDefault),t.removeEventListener("dblclick",e.preventDefault),t.removeEventListener("keydown",e.preventDefault),t.removeEventListener("keyup",e.preventDefault),t.removeEventListener("dblclick",e.keyMouseEventHandler),t.removeEventListener("mousedown",e.keyMouseEventHandler),t.removeEventListener("mouseup",e.keyMouseEventHandler),t.removeEventListener("mousemove",e.keyMouseEventHandlerThrottle),t.removeEventListener("wheel",e.keyMouseEventHandler),window.removeEventListener("blur",e.browserBlurEventHandler)},bindEvent:function(){var e=this,t=this.dom;U("dom",t),t.addEventListener("click",e.focus),t.addEventListener("keydown",e.keyMouseEventHandler),t.addEventListener("keyup",e.keyMouseEventHandler),document.addEventListener("paste",e.pasteOnDocument),document.addEventListener("copy",e.copyOnDocument),document.addEventListener("cut",e.cutOnDocument),t.addEventListener("contextmenu",e.preventDefault),t.addEventListener("wheel",e.preventDefault),t.addEventListener("dblclick",e.preventDefault),t.addEventListener("keydown",e.preventDefault),t.addEventListener("keyup",e.preventDefault),t.addEventListener("dblclick",e.keyMouseEventHandler),t.addEventListener("mousedown",e.keyMouseEventHandler),t.addEventListener("mouseup",e.keyMouseEventHandler),t.addEventListener("mousemove",e.keyMouseEventHandlerThrottle),t.addEventListener("wheel",e.keyMouseEventHandler),window.addEventListener("blur",e.browserBlurEventHandler)},recordCurrentMousePosition:function(e){try{var t=this.positionMap,r=e.clientX,n=e.clientY;Object.assign(this.currentMousePositionProps,{clientX:r,clientY:n,x2video:r-t.canvas.offsetX,y2video:n-t.canvas.offsetY})}catch(e){}},resolvePosition:function(e){var t=e.clientX,r=e.clientY,n=this.positionMap;return t-=n.canvas.offsetX,r-=n.canvas.offsetY,t*=n.dst.w/n.src.scaleWidth,r*=n.dst.h/n.src.scaleHeight,{x:t=Math.floor(t),y:r=Math.floor(r)}},generateBuffer:function(e){if(void 0!==e.key&&!/^[\x00-\x7F]*$/.test(e.key))throw new Error("params.key must only contain ascii character");var t=8;84===(e=Object.assign({v:0,x:0,y:0,dx:0,dy:0,repeat:0},e)).pduType&&(t+=4);var r=new ArrayBuffer(t),n=new Uint8Array(r),i=new DataView(r,4),a=new DataView(r,4);if(n[0]=e.pduType,n[1]=63&e.input_event_type,83===e.pduType)i.setUint16(0,e.x,!0),i.setUint16(2,e.y,!0);else if(84===e.pduType)a.setInt16(0,e.x,!0),a.setInt16(2,e.y,!0),a.setInt16(4,e.dx,!0),a.setInt16(6,e.dy,!0);else if(85===e.pduType){var o=new DataView(r,4),s=new DataView(r,6),u=new Uint8Array(r,2);o.setUint16(0,e.keyCode,!0),s.setUint16(0,e.charCode,!0);var c={shift:1,capslock:2,ctrl:4,alt:8,numlock:16,super:32},d=0;Object.keys(c).forEach((function(t){!0===e[t]&&(d+=c[t])})),u[0]=d,e.repeat&&(n[1]=32|n[1])}return r},processEvent:function(e){this.blobSocket&&this.blobSocketCheckAndSend(this.generateBuffer(e))},debug:function(e){var t={};(85===e.pduType?["t","keyCode","charCode","key"]:["t","x","y","dx","dy","input_event_type"]).forEach((function(r){t[r]=e[r]})),U("debug",JSON.stringify(t))},blockedPasteKeyboard:function(e){var t=this;return new Promise((function(r,n){t.isKeyboardEvent(e)&&t.isPasteEvent(e)?t.blockedKeyboardEventOfPaste.push(e):r(e)}))},isPasteEvent:function(e){var t=this.isThisKeyIgnoreCase(e,"v");return!!(e.ctrlKey^e.metaKey&&t)},isCopyEvent:function(e){var t=this.isThisKeyIgnoreCase(e,"c");return!!(e.ctrlKey^e.metaKey&&t)},isCutEvent:function(e){var t=this.isThisKeyIgnoreCase(e,"x");return!!(e.ctrlKey^e.metaKey&&t)},returnNewEventByTransformCtrlKeyOrCommandKey:function(e){var t=this.createParamsFromKeyboardEvent(e);switch(this.remoteOS){case N.Tl.WIN:Object.assign(t,{ctrlKey:!0,metaKey:!1});break;case N.Tl.MAC:Object.assign(t,{ctrlKey:!1,metaKey:!0});case N.Tl.UNKNOWN:}return new e.constructor(e.type,t)},transformCtrlCAndCommandC:function(e){var t=this,r=this;return new Promise((function(n,i){t.isKeyboardEvent(e)&&(e.ctrlKey||e.metaKey)&&r.isThisKeyIgnoreCase(e,"c")?(r.createParamsFromKeyboardEvent(e),n(r.returnNewEventByTransformCtrlKeyOrCommandKey(e))):n(e)}))},keyMouseEventHandlerFilter_MatainKeyDownUpMergeMap:function(e){var t=this;return new Promise((function(r,n){try{t.isKeyboardEvent(e)&&e.key&&("keydown"!==e.type||e.repeat||(t.keydownupMergeRemoveMap[e.key]={t:+new Date,e:e}),"keydown"===e.type&&e.repeat&&delete t.keydownupMergeRemoveMap[e.key],"keyup"===e.type&&delete t.keydownupMergeRemoveMap[e.key])}catch(e){U.error(e)}r(e)}))},_browserBlurEventHandler:function(){this._checkAndClearKeydownupMergeRemoveMap(this.maxSleep,!0)},checkAndClearKeydownupMergeRemoveMap:function(){var e=this,t=this;this.checkAndClearKeydownupMergeRemoveMapInterval=setInterval((function(){t._checkAndClearKeydownupMergeRemoveMap(e.maxSleep)}),100)},_checkAndClearKeydownupMergeRemoveMap:function(e,t){var r=this,n=this.keydownupMergeRemoveMap;Object.keys(n).forEach((function(i){var a=n[i];if(+new Date-a.t>=e||t){var o=new a.e.constructor("keyup",a.e);try{r._keyMouseEventHandler(o)}catch(e){}delete r.keydownupMergeRemoveMap[i]}}))},uncheckAndClearKeydownupMergeRemoveMap:function(){this._checkAndClearKeydownupMergeRemoveMap(0),clearInterval(this.checkAndClearKeydownupMergeRemoveMapInterval)},keyMouseFilters:function(e){var t=this;return new Promise((function(t,r){t(e)})).then((function(e){return t.blockedPasteKeyboard(e)})).then((function(e){return t.blockedCopyKeyboard(e)})).then((function(e){return t.blockedCutKeyboard(e)})).then((function(e){return t.keyMouseEventHandlerFilter_MatainKeyDownUpMergeMap(e)})).then((function(e){return t.blockedSomeKeyboardEventNotHaveKeydownBefore(e)})).then((function(e){return t.keyMouseEventHandlerFilter_EVERY_KEYUP_MUST_HAVE_KEYDOWN_BEFORE(e)}))},blockedSingleMetaKey:function(e){var t=this;return new Promise((function(r,n){t.isKeyboardEvent(e)&&e.key&&(/command/i.test(e.key)||/meta/i.test(e.key)||/control/i.test(e.key))&&!e.shiftKey&&!e.altKey&&e.ctrlKey^e.metaKey||r(e)}))},blockedCutKeyboard:function(e){var t=this;return new Promise((function(r,n){t.isKeyboardEvent(e)&&t.isCutEvent(e)||r(e)}))},blockedCopyKeyboard:function(e){var t=this;return new Promise((function(r,n){t.isKeyboardEvent(e)&&t.isCopyEvent(e)?t._blockedCopyKeyboardList.push(e):r(e)}))},blockedSomeKeyboardEventNotHaveKeydownBefore:function(e){var t=this;return new Promise((function(r,n){if(t.isKeyboardEvent(e)&&e.key){var i=!1;if(["x","c","v"].forEach((function(r){t.isThisKeyIgnoreCase(e,r)&&(i=!0)})),"keyup"===e.type&&i&&!t.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map[e.key])return}r(e)}))},keyMouseEventHandlerFilter_EVERY_KEYUP_MUST_HAVE_KEYDOWN_BEFORE:function(e){var t=this;return new Promise((function(r,n){try{if(t.isKeyboardEvent(e)&&e.key&&("keydown"===e.type&&(t.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map[e.key]=e),"keyup"===e.type)){var i=!!t.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map[e.key];delete t.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map[e.key];var a=!1;if(["meta"].forEach((function(r){t.isThisKeyIgnoreCase(e,r)&&(a=!0)})),!i&&!a){U.warn("keyup trigger, but no keydown before");var o=new e.constructor("keydown",e);t._keyMouseEventHandler(o)}}}catch(e){U.error(e)}r(e)}))},_keyMouseEventHandler:function(e){this.isKeyboardEvent(e)&&U("_keyMouseEventHandler keyboard",e);var t={},r={keydown:0,keyup:1,keychar:2},n={mousemove:0,mousedown:{left:1,right:4,middle:7},mouseup:{left:2,right:5,middle:8},mouseleftdbldown:3,mouserightdbldown:6,wheel:10},a=e.getModifierState?function(t){return e.getModifierState(t)}:function(e,t){return t},o=0,s=e.key&&1===e.key.length;if(-1!==["keydown","keyup"].indexOf(e.type))t.event_type=1,o=85,void 0!==r[e.type]&&(t.input_event_type=r[e.type]);else{if(-1===["mousedown","mouseup","mousemove","wheel","click","dblclick","contextmenu"].indexOf(e.type))return void U.warn("the event type cannot be handled");t.event_type=0,this.recordCurrentMousePosition(e);var u=this.resolvePosition(e);if(Object.assign(t,{x:u.x,y:u.y}),o="wheel"===e.type?84:83,void 0!==n[e.type]&&(t.input_event_type=n[e.type]),-1!==["mousedown","mouseup"].indexOf(e.type)){var c;switch(e.button){case 0:default:c="left";break;case 1:c="middle";break;case 2:c="right"}t.input_event_type=n[e.type][c]}-1!==["dblclick"].indexOf(e.type)&&(t.input_event_type=n.mouseleftdbldown)}if("wheel"===e.type){var d={deltaX:"dx",deltaY:"dy"};Object.keys(d).forEach((function(r){e[r]&&(t[d[r]]=e[r]>0?-100:100)}))}var l=this.ctrlMetaConvert({keyCode:e.keyCode,key:e.key,ctrlKey:e.ctrlKey,metaKey:e.metaKey});if(Object.assign(t,{t:e.type,pduType:o,keyCode:l.keyCode,charCode:s?e.key.charCodeAt(0):0,key:l.key,repeat:e.repeat,ctrl:l.ctrlKey,alt:e.altKey,super:l.metaKey,shift:e.shiftKey,capslock:a("CapsLock",!1),numlock:a("NumLock",!1)}),this.isKeyboardEvent(e)&&U("processEvent",JSON.stringify(t)),this.processEvent(t),t.input_event_type==n.mouseleftdbldown){var h=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?V(Object(r),!0).forEach((function(t){(0,i.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t);h.input_event_type=n.mouseup.left,this.processEvent(h)}},ctrlMetaConvert:function(e){var t=e.metaKey,r=e.ctrlKey;return(this.remoteOS===N.Tl.MAC&&this.localOS===N.Tl.WIN||this.remoteOS===N.Tl.WIN&&this.localOS===N.Tl.MAC)&&e.key&&(/Meta/i.test(e.key)?(e.ctrlKey=!0,e.keyCode=17,e.metaKey=r,e.key="Control"):/Control/i.test(e.key)&&(e.metaKey=!0,e.keyCode=91,e.ctrlKey=t,e.key="Meta")),e},isCapslock:function(e){var t=e.keyCode,r=e.key,n=e.shiftKey;return!!/[a-zA-Z]/.test(r)&&(r.charCodeAt(0)!==t?!n:n)},stop:function(){var e=this;return H(O().mark((function t(){return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.blobSocket&&e.blobSocket.close(),e.blobSocket=null;case 1:case"end":return t.stop()}}),t)})))()},connectSocket:function(){var e=this;return H(O().mark((function t(){var r;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.createBlobSocket("".concat(e.socketURL,"/wc/media/").concat(e.meetingID,"?type=r&mode=2&cid=").concat(e.condID));case 2:return r=t.sent,t.abrupt("return",(r.binaryType="blob",e.blobSocket=r,!0));case 4:case"end":return t.stop()}}),t)})))()},socketBlobMessageHandler:function(){if(this.blobSocket){var e=this;this.blobSocket.addEventListener("message",function(){var t=H(O().mark((function t(r){var n,i,a,o,s,u,c;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.data,t.next=3,h.Ay.readBlobAsBuffer(n,n.size);case 3:if(i=t.sent,a=new Int8Array(i),88!==(o=a[0])||!e.isControllerNow){t.next=13;break}return s=n.slice(8),t.next=10,h.Ay.readBlob(s);case 10:u=t.sent,c=a[4],U("COPY_TEXT_FROM_RWG",u,c),e.triggerReturnCopiedText({data:u,x:e.currentMousePositionProps.x2video,y:e.currentMousePositionProps.y2video});case 13:0===o&&e.blobSocket.send(i);case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},destroySocket:function(){try{this.blobSocket.close(),this.blobSocket=null}catch(e){U("destroySocket",e)}},createBlobSocket:function(e){return new Promise((function(t,r){var n=new WebSocket(e);n.addEventListener("open",(function(){})),n.addEventListener("message",(function(e){try{var r=JSON.parse(e.data);0===r.evt&&r.body&&t(n)}catch(e){}})),n.addEventListener("error",(function(e){r(e)})),n.addEventListener("close",(function(){r(new Error("socket close"))}))}))},setRemoteOS:function(e){void 0!==e&&(this.remoteOS=e)}};var B=F,W=r(3812),G=r.n(W),K=r(7080),z=r(2710),q=r(6687),Y=r(2614),X=r(9710),Q=r(3903),J=(0,b.A)("sdk.rtcUtil"),$=!1,Z=D((function e(t,r,n,a,o){var s=this;R(this,e),(0,i.A)(this,"reconnectRTCPeerConnectionLSS",(function(){s.enableTCP?s.reconnectCount<s.reconnectMax&&s.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen<s.reconnectMax&&(J("".concat(s.dataChannelLabel," reconnect reconnectTotalCount  : ").concat(s.reconnectCount,"; reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen : ").concat(s.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen,", reconnectMax : ").concat(s.reconnectMax)),s.reconnectCount+=1,s.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen+=1,s.isRecover||g.A.Notify_APPUI(p.Lmp,{dataChannelCanOpen:$,type:s.connectionType===N.Xt.AUDIO?"a":"v"}),s.isRecover=!0,setTimeout((function(){s.initConnection(s.connectionID,s.dataChannelLabel)}),1e3*Math.pow(2,s.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen))):s.reconnectCount<s.reconnectMax&&s.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen<s.retryCount?(J("".concat(s.dataChannelLabel," reconnect reconnectTotalCount  : ").concat(s.reconnectCount,"; reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen : ").concat(s.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen,", reconnectMax : ").concat(s.reconnectMax)),s.reconnectCount+=1,setTimeout((function(){s.initConnection(s.connectionID,s.dataChannelLabel)}),s.retryInterval),s.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen+=1):g.A.Notify_APPUI(p.Lmp,{dataChannelCanOpen:$,type:s.connectionType===N.Xt.AUDIO?"a":"v"})})),this.isLSSPlayer=n,this.isLSSPlayer&&(this.retryCount=a&&a.retryCount||2,this.retryTimeout=a&&a.retryTimeout||2e3,this.retryInterval=a&&a.retryInterval||0,this.enableTCP=o,this.isRecover=!1),this.rtcPeerConnection=null,this.dataChannel=null,this.id=Date.now()<<3|r,this.dataChannelLabel=null,this.datachannelcloselistener=null,this.datachannelopenlistener=null,this.rtcPeerConnectionCreatedListener=null,this.reconnectCount=0,this.reconnectMax=10,this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen=0,this.connectionID=null,this.pubSubTokenList=[],this.isForceClosed=!1,this.reconnectRTCPeerConnectionThrottle=I()((function(){s.reconnectRTCPeerConnection()}),2e3),this.timeoutThenCloseInterval=null,this.userid=null,this.connectionType=r,this.dataChannelStatus="",this.delaycloseTimeout=0,this.delaycloseid_=0,this.netmgr=t,this.supportTransferDatachanel=!0,this.port=0}),[{key:"setUserid",value:function(e){this.userid=e}},{key:"isSupportDataChannel",value:function(){return!!window.RTCDataChannel}},{key:"iceClosed",value:function(e){this.isForceClosed||(J("rtcPeerConnection.iceClosed",e),this._close(!0),this._clear())}},{key:"initConnection",value:function(){var e=H(O().mark((function e(t){var r,n=this,i=arguments;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:"ZoomWebclientVideoDataChannel",K.A.add_monitor("DCCONN"),!this.isSupportDataChannel()){e.next=18;break}return this.dataChannelLabel=r,this.connectionID=t,this.rtcPeerConnection=new RTCPeerConnection({iceCandidatePoolSize:1}),this.rtcPeerConnection.addEventListener("iceconnectionstatechange",(function(e){if(!n.isForceClosed){var t=n.rtcPeerConnection;if("failed"!==t.iceConnectionState&&"closed"!==t.iceConnectionState||(J("".concat(n.dataChannelLabel," iceconnectionstatechange"),t.iceConnectionState),K.A.add_monitor("ICECONNSTATECHANGE:"+n.dataChannelLabel),n.iceClosed(),n.delaycloseid_&&(clearTimeout(n.delaycloseid_),n.delaycloseid_=0)),"disconnected"===t.iceConnectionState&&!n.delaycloseid_){var r=n;n.delaycloseid_=setTimeout((function(){r.delaycloseid_=0,r.iceClosed()}),r.delaycloseTimeout)}"connected"===t.iceConnectionState&&(t.getStats().then((function(e){e.forEach((function(t){n.parserPCPort(e,t)}))})),n.delaycloseid_&&(clearTimeout(n.delaycloseid_),n.delaycloseid_=0))}})),e.next=9,this.netmgr.ready();case 9:if(!e.sent){e.next=15;break}return this._createDataChannel(this.netmgr),e.next=13,this.rtcPeerConnection.createOffer().then(function(){var e=H(O().mark((function e(r){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(J("original offer",JSON.stringify(r)),r.sdp=r.sdp.replace(/a=ice-ufrag:.+/g,"a=ice-ufrag:".concat(t)),J("modified offer",r),n.rtcPeerConnection.setLocalDescription(r)));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(){n.rtcPeerConnectionCreatedListener.call(null,n.rtcPeerConnection)}));case 13:e.next=16;break;case 15:Promise.reject("net thread init error");case 16:e.next=19;break;case 18:K.A.add_monitor("DCUNSUPPORT");case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_close",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];K.A.add_monitor("RTCPeerConnUtil.CLOSE");try{this._closeDataChannel(),this.rtcPeerConnection&&this.rtcPeerConnection.close()}catch(e){m.Ay.error("Error when closing RTCPeerConnection",e)}finally{this.dataChannel=null,this.rtcPeerConnection=null,e&&this.datachannelcloselistener&&this.datachannelcloselistener(null),this.sendDataChannelStatusMonitorLog(),this.reconnectRTCPeerConnectionThrottle()}}},{key:"forceClose",value:function(){K.A.add_monitor("DCFORCECLOSE:"+this.dataChannelLabel),J("forceClose : "+this.dataChannelLabel),this.isForceClosed=!0,this._close(!0),this._clear()}},{key:"resetDataChannelTransfered",value:function(e){this.netmgr=e,this._close(!0),this._clear()}},{key:"isDestroyed",value:function(){return this.isForceClosed}},{key:"_clear",value:function(){this.timeoutThenCloseInterval&&clearTimeout(this.timeoutThenCloseInterval),this.timeoutThenCloseInterval=0,this.datachannelcloselistener=null,this.datachannelopenlistener=null,this.pubSubTokenList.forEach((function(e){E.A.unsubscribe(e)})),this.pubSubTokenList=[]}},{key:"onConnectionCreated",value:function(e){this.rtcPeerConnectionCreatedListener=e}},{key:"reconnectRTCPeerConnection",value:function(){var e=this;this.isForceClosed||(this.isLSSPlayer?this.reconnectRTCPeerConnectionLSS():this.reconnectCount<this.reconnectMax&&this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen<this.reconnectMax&&(J("".concat(this.dataChannelLabel," reconnect reconnectTotalCount  : ").concat(this.reconnectCount,"; reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen : ").concat(this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen,", reconnectMax : ").concat(this.reconnectMax)),this.reconnectCount+=1,this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen+=1,setTimeout((function(){e.initConnection(e.connectionID,e.dataChannelLabel)}),1e3*Math.pow(2,this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen))))}},{key:"oneSingleLineLog",value:function(e){setTimeout((function(){K.A.send_instant_monitor(),K.A.add_monitor(e),K.A.send_instant_monitor()}),0)}},{key:"checkEmptyUserIdAndResendMonitor",value:function(e){e&&this.userid!=e&&(this.setUserid(e),this.sendDataChannelStatusMonitorLog())}},{key:"sendDataChannelStatusMonitorLog",value:function(){this.userid&&("OPEN"===this.dataChannelStatus?(K.A.add_monitor("DCOPEN:"+this.dataChannelLabel),this.oneSingleLineLog("".concat(z.fT,",").concat(this.userid,",").concat(this.connectionType,",DCOPEN,").concat(z.fT))):"CLOSED"===this.dataChannelStatus&&(K.A.add_monitor("DCCLOSE:"+this.dataChannelLabel),this.oneSingleLineLog("".concat(z.fT,",").concat(this.userid,",").concat(this.connectionType,",DCCLOSE,").concat(z.fT))))}},{key:"_closeDataChannel",value:function(){if(this.dataChannel)try{this.dataChannelStatus="CLOSED",this.dataChannel.close()}catch(e){m.Ay.error("Error when trying to close existing RTCDataChannel",e)}finally{this.dataChannel=null}}},{key:"_createDataChannel",value:function(e){var t=this;this._closeDataChannel();var r=this.rtcPeerConnection.createDataChannel(this.dataChannelLabel,{ordered:!1,reliable:!1,maxRetransmits:0}),n=e.isUseTransferRTC()?e.getWorker():null;r.binaryType="arraybuffer";var i="".concat(this.id,"-").concat(Math.floor(performance.now())),a=new q.h(i,this.connectionType,r,n,"",e);this.connectionType==N.Xt.VIDEO?a.transportlists=[X.vK.VIDEO_NETRTC]:a.transportlists=[X.vK.AUDIO_NETRTC],a.report_monitor_func=function(e,t){K.A.add_monitor("".concat(e,":").concat(t))},a.open(),a.onopen((function(e){(0,Y.uB)(a),t.datachannelopenlistener&&t.datachannelopenlistener(e),t.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen=0,clearTimeout(t.timeoutThenCloseInterval),t.dataChannelStatus="OPEN",t.sendDataChannelStatusMonitorLog(),t.isLSSPlayer&&($=!0,g.A.Notify_APPUI(p.hG),t.isRecover&&t.enableTCP&&(t.isRecover=!1,g.A.Notify_APPUI(p.BBN,{type:t.connectionType===N.Xt.AUDIO?"a":"v"})))})),a.onclose((function(e){(0,Y.np)(a),t._ondatachannelclosed(e)})),a.onerror((function(e){(0,Y.np)(a);var r=e.error||{};m.Ay.warn("WebRTC DataChannel ".concat(t.dataChannelLabel," received error with errorDetail: ").concat(r.errorDetail),r),clearTimeout(t.timeoutThenCloseInterval),K.A.add_monitor("DCERROR","".concat(t.dataChannelLabel,": ").concat(r.message,", error detail: ").concat(r.errorDetail)),J("dataChannel.onerror",e)})),this.dataChannel=a}},{key:"_ondatachannelclosed",value:function(e){"CLOSED"!=this.dataChannelStatus&&(clearTimeout(this.timeoutThenCloseInterval),J("dataChannel.onclose",e),this.dataChannelStatus="CLOSED",this.datachannelcloselistener&&this.datachannelcloselistener(e),this._close(),this._clear())}},{key:"onDataChannelClose",value:function(e){this.datachannelcloselistener=e}},{key:"onDataChannelOpen",value:function(e){this.datachannelopenlistener=e}},{key:"waitForAnswerFromRWG",value:function(e){var t=this,r=this;return new Promise((function(n,i){var a=E.A.on(e,(function(e,t){r.isDestroyed()&&i(),n(t)}));t.pubSubTokenList.push(a)}))}},{key:"setRemoteDescription",value:function(e){J("setRemoteDescription",e),this.rtcPeerConnection.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e.sdp}))}},{key:"closeIfTimeout",value:function(){var e=this;clearTimeout(this.timeoutThenCloseInterval),this.timeoutThenCloseInterval=setTimeout((function(){J("closeIfTimeout"),e._close()}),this.isLSSPlayer?this.retryTimeout:1e4)}},{key:"addIceCandidate",value:function(e){this.rtcPeerConnection.addIceCandidate(new RTCIceCandidate({candidate:e,sdpMLineIndex:0,sdpMid:"0"}))}},{key:"parserPCPort",value:function(e,t){var r=0;if("candidate-pair"===t.type){var n=e.get(t.remoteCandidateId);t.selected&&n&&(r=n.port)}else if("transport"===t.type&&t.selectedCandidatePairId){var i=e.get(t.selectedCandidatePairId),a=e.get(i.remoteCandidateId);a&&(r=a.port)}r&&r!=this.port&&(this.port=r,m.Ay.directReport("".concat(this.dataChannelLabel,"dataChannel port: ").concat(r)))}},{key:"resetRtc",value:function(e){this.supportTransferDatachanel=e,this._close(!0),this._clear()}}]),ee=r(14),te=r(9407),re=r(3578),ne=r(5169),ie=r(5723);function ae(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function oe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(r),!0).forEach((function(t){(0,i.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ae(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var se=function(e,t){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:16/9;if(!e||!t)return null;var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)||0,i=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)||0;if(e/t>r){var a=t*r;return{width:a,height:t,left:Math.round((e-a)/2)+n,top:0+i}}var o=e/r;return{width:e,height:o,left:0+n,top:Math.round((t-o)/2)+i}};function ue(e,t,r){function n(e,t){return Math.min("px"===e.unit?e.value/t:e.value/100,.5)}return{radius_lb_x:n(e.topLeft.x,t),radius_lb_y:n(e.topLeft.y,r),radius_lt_x:n(e.bottomLeft.x,t),radius_lt_y:n(e.bottomLeft.y,r),radius_rb_x:n(e.topRight.x,t),radius_rb_y:n(e.topRight.y,r),radius_rt_x:n(e.bottomRight.x,t),radius_rt_y:n(e.bottomRight.y,r)}}var ce={radius_lb_x:0,radius_lb_y:0,radius_lt_x:0,radius_lt_y:0,radius_rb_x:0,radius_rb_y:0,radius_rt_x:0,radius_rt_y:0};function de(e){this.Notify_APPUI=e.Notify_APPUI,this.isSupportOffscreenCanvas=e.isSupportOffscreenCanvas,this.jsMediaEngine=e.jsMediaEngine,this.threadNumbs=e.videodecodethreadnumb,this.globalTracingLogger=e.globalTracingLogger,this.monitorLoggerFn=e.monitorLoggerFn,this.renderManager=e.renderManager,this.isLSSPlayer=e.isLSSPlayer,this.waterMarkCanvas=null,this.videoRenderLevel=10,this.videoRenderLevelCount=1,this.renderPeriodTotal=100,this.renderPeriodCount=0,this.renderPeriodTotalFps=0,this.renderPeriodFpsCount=0,this.lastRenderAudioTimeStamp=0,this.videoBufEmptyCount=0,this.videoBufCount=0,this.videoRenderMaxLevel=15,this.timestamp=0,this.audioPlayTime=0,this.videoTimestamp=0,this.videoWaterMarkName="",this.isCreateVideoWaterMark=!1,this.isWaterMarkRepeatedEnable=!1,this.waterMarkOpacity=.15,this.currentactive=0,this.audioPlaySsrc=0,this.currentVideoHeight=0,this.currentVideoWidth=0,this.videoRenderArray=[],this.WaterMarkRGBA=new re.A,this.vMonitorCount=0,this.videoQueue=new ne.$8,this.timestart=0,this.rendingFlag=!0,this.rAFID=0,this.rAFIDBack=null,this.prevRequestAnimationTimestap=0,this.retryRequestAnimationStep=2,this.ssrcDisplayMap=new Map,this.ssrcHaddataMap=new Map,this.zoneLastRenderedMap=new Map,this.ssrcCurrentRenderingMap=new Map,this.pauseSet=new Set,this.canvasToLocalDisplay=new Map,this.canvasIdSet=new Set,this.selfvideossrc=0,this.localVideoPtr=0,this.sabBuffer=0,this.localvideossrc=0,this.encodedVideoSharedArrayBufferUint8Array=null,this.encodedVideoSharedArrayBufferUint16Array=null,this.encodedVideoSharedArrayWasmMemory=null,this.startCaptureVideo=!1,this.clearColor=new Uint8Array(4),this.videorendercanvas=null,this.keyrender=null,this.renderIndex=0,this.activeSpeakssrc=0,this.renderMode=0,this.intervalHandle,this.croppingParams={top:0,left:0,height:1,width:1},this.coordinate={x:0,y:0,width:640,height:360},this.bWebglContextLostProtectingMap=new Map,this.ismirror=!1,this.firstFrameMap=new Map,this.lfTimeStamp=0,this.activeFps=0,this.lastActiveSSRC=0,this.disableOriginalRatio=!1,this.onStopDrawCallback=e.onStopDrawCallback,this.onReStoreCallback=e.onReStoreCallback,this.videoRenderWGLFSTOP=!1}de.prototype.clearUseridRender=function(e,t,r,n){var i=e[0],a=i.display;if(a)if(!n&&a.setWatermarkFlag(0),this.renderMode)a.clearCanvas(t);else{var o=i.ssrc;if(!a||!t)return;this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.height=1,this.croppingParams.width=1,this.clearColor[0]=255*t.R,this.clearColor[1]=255*t.G,this.clearColor[2]=255*t.B,this.clearColor[3]=255*t.A;var s=this.renderManager.getRendererProvider().isWebGLRendererType(),u=this.renderManager.getRendererProvider().isWebGL2RendererType(),c=this.renderManager.getRendererProvider().isWebGPURendererType();if(s||u){var d=this.canvasToLocalDisplay.get(i.canvas);if(!d)return void console.log("no clearDisplay");d.setVideoMode(z.rK),d.colorRange=0,d.setFillMode(1,1),d.setRoundedCornerRadius(ce),d.updateSelfVideoTextures(1,1,this.clearColor,this.croppingParams,!0),void 0===r&&((r={}).x=i.x,r.y=i.y,r.width=i.width,r.height=i.height),d.drawSelfVideo(r,!0)}else if(c){if(!a)return void console.log("no clearDisplay");a.setVideoMode(z.rK),a.setColorRange(0),a.setFillMode(1,1),a.setRoundedCornerRadius(ce),a.updateSelfVideoTextures(1,1,this.clearColor,this.croppingParams,!0),void 0===r&&((r={}).x=i.x,r.y=i.y,r.width=i.width,r.height=i.height),a.drawSelfVideo(r,!0)}var l=this;this.ssrcDisplayMap.forEach((function(e,t){var r,n,i=this;l.selfvideossrc&&t==l.Get_Logical_SSrc(l.selfvideossrc)&&(r=!0),t==l.Get_Logical_SSrc(o)&&(n=!0),e.forEach((function(e){if(e.haddata&&!n){var t=e.display;l.coordinate.x=e.x,l.coordinate.y=e.y,l.coordinate.width=e.width,l.coordinate.height=e.height,t&&(!n||s&&u?t.getVideoMode()!=z.kh&&(-1==[z.rK,z.hd].indexOf(t.getVideoMode())&&r?t.drawSelfVideo(l.coordinate,!1,l.ismirror):r?t.drawRemoteVideo(l.coordinate,l.ismirror):t.drawRemoteVideo(l.coordinate)):(t.drawSelfVideo(l.coordinate,!0),i.isLSSPlayer&&l.firstFrameMap.get(e.ssrc)&&l.firstFrameMap.delete(e.ssrc)))}}))})),this.renderManager.renderFor(ee.gz.VIDEO)}},de.prototype.Set_Render_Array_rAF=function(e){if(this.videoRenderArray=e,this.ssrcDisplayMap.clear(),this.ssrcHaddataMap.clear(),this.videoRenderArray.length>0)for(var t=0;t<this.videoRenderArray.length;t++){var r=this.ssrcDisplayMap.get(this.Get_Logical_SSrc(this.videoRenderArray[t].ssrc));r?r.push(this.videoRenderArray[t]):((r=[]).push(this.videoRenderArray[t]),this.ssrcDisplayMap.set(this.Get_Logical_SSrc(this.videoRenderArray[t].ssrc),r),this.ssrcHaddataMap.set(this.Get_Logical_SSrc(this.videoRenderArray[t].ssrc),!1))}},de.prototype.Set_Render_Array=function(e,t){this.renderMode?this.Set_Render_Array_IntervalMode(e,t):this.Set_Render_Array_rAF(e)},de.prototype.ClearQueue=function(){this.videoQueue&&this.videoQueue.ClearQueue(),this.currentVideoHeight=0,this.currentVideoWidth=0},de.prototype.Put_Video_Into_Buffer=function(e){if(this.videoQueue){var t=this.videoQueue.GetQueue(e.ssrc);if(t||(t=this.videoQueue.AddQueue(e.ssrc)),t.enqueue(e),this.videoQueue&&this.videoQueue.ssrcInfo){var r=e.ssrc>>10;this.videoQueue.ssrcInfo.UpdateSSRCInfo(r,e.ntptime)}for(var n=this.videoQueue.GetQueueLength(e.ssrc)-10;n>=0;)n--}},de.prototype.Update_RemoteVideo_Texture=function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(this.Check_Request_Animation(),r)if(e&&n){var s=this.Get_Logical_SSrc(n),u=this.FindVideoRenderListFromMap(n);if(!u.length)return void this.renderManager.destroyUnusedVideoFrame(e);var c=this,d=o&&(1==i||3==i);this.ssrcHaddataMap.set(s,!0),a?(this.croppingParams.top=a.y,this.croppingParams.left=a.x,this.croppingParams.height=a.height,this.croppingParams.width=a.width):(this.croppingParams.top=e.visibleRect?0:e.cropTop,this.croppingParams.left=e.visibleRect?0:e.cropLeft,this.croppingParams.height=e.visibleRect?e.visibleRect.height:e.cropHeight,this.croppingParams.width=e.visibleRect?e.visibleRect.width:e.cropWidth);var l=e.visibleRect||{},h=l.width,f=l.height;if(h&&f||(f=this.croppingParams.height,h=this.croppingParams.width),d){var p=f;f=h,h=p,p=this.croppingParams.height,this.croppingParams.height=this.croppingParams.width,this.croppingParams.width=p}o&&(i=0),this.canvasIdSet.clear(),u&&u.forEach((function(r){r.haddata=!0;var n=r.display;c.coordinate.x=r.x,c.coordinate.y=r.y,c.coordinate.width=r.width,c.coordinate.height=r.height;var a=!(n&&n.reuse&&r.rendercanvasID&&t.canvasIdSet.has(r.rendercanvasID));n&&(n.setVideoMode(z.rK),c.Should_Update_Watermark(n,r.width,r.height,r.width,r.height)&&c.Update_Display_Watermark(n,r.width,r.height,r.width,r.height),e&&n.updateRemoteVideoTexturesImageBitmap(h,f,e,c.croppingParams,i,a),t.canvasIdSet.add(r.rendercanvasID))}))}else this.renderManager.destroyUnusedVideoFrame(e);else{if(e&&e.ssrc){var v=this.Get_Logical_SSrc(e.ssrc);if(this.isLSSPlayer&&this.pauseSet.has(v+" "+e.zone))return;var g,m=this.FindVideoRenderListFromMap(e.ssrc);if(!m.length)return e.yuvdataptr&&Module._free(e.yuvdataptr),void this.renderManager.destroyUnusedVideoFrame(e);var y=this;this.ssrcHaddataMap.set(v,!0);var _=e;this.croppingParams.top=_.r_y,this.croppingParams.left=_.r_x,this.croppingParams.height=_.r_h,this.croppingParams.width=_.r_w,(g=_).enableMultiDecodeVideoWithoutSAB?g.yuvdata=g.data:g.yuvdata=(0,ie.Wp)().subarray(g.yuvdataptr,g.yuvdataptr+g.yuvlength),!g.yuvdata.length||g.yuvdata.length!=g.width*g.height*3/2||this.croppingParams.top<0||this.croppingParams.left<0||this.croppingParams.left+this.croppingParams.width>g.width||this.croppingParams.top+this.croppingParams.height>g.height||m&&(this.canvasIdSet.clear(),m.forEach((function(e){e.haddata=!0;var r=e.display;y.coordinate.x=e.x,y.coordinate.y=e.y,y.coordinate.width=e.width,y.coordinate.height=e.height;var n=!(r&&r.reuse&&e.rendercanvasID&&t.canvasIdSet.has(e.rendercanvasID));r&&(r.setVideoMode(z.Wp),t.Should_Update_Watermark(r,e.width,e.height,e.width,e.height)&&t.Update_Display_Watermark(r,e.width,e.height,e.width,e.height),g&&(t.isLSSPlayer&&t.ssrcCurrentRenderingMap.set(v,g),r.updateRemoteVideoTextures(g.width,g.height,y.croppingParams,g.yuvdata,g.rotation,g.yuv_limited,y.coordinate,!1,n)),t.canvasIdSet.add(e.rendercanvasID))})))}else this.renderManager.destroyUnusedVideoFrame(e);e.yuvdataptr&&Module._free(e.yuvdataptr)}},de.prototype.Set_Cropping_Mode=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.disableOriginalRatio=!!e},de.prototype.Update_Cropping_Params=function(){if(this.disableOriginalRatio){var e=se(this.croppingParams.width,this.croppingParams.height,this.croppingParams.left,this.croppingParams.top);e&&(this.croppingParams=oe(oe({},this.croppingParams),e))}},de.prototype.Update_SelfVideo_Texture=function(e,t,r,n){var i=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:z.rK,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(o?(this.croppingParams.top=o.top,this.croppingParams.left=o.left,this.croppingParams.width=o.width,this.croppingParams.height=o.height):(this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.height=t,this.croppingParams.width=e),this.renderMode){var u=0;this.canvasIdSet.clear();for(var c=this.FindVideoRenderList(n);u<c.length;u++){this.coordinate.x=c[u].x,this.coordinate.y=c[u].y,this.coordinate.width=c[u].width,this.coordinate.height=c[u].height,this.Update_Cropping_Params(),c[u].display.setVideoMode(a);var d=c[u],l=d.display,h=d.width,f=d.height;this.Should_Update_Watermark(l,h,f,h,f)&&this.Update_Display_Watermark(l,h,f,h,f);var p=!(l&&l.reuse&&c[u].rendercanvasID&&this.canvasIdSet.has(c[u].rendercanvasID));-1!==[z.rK,z.hd].indexOf(a)?(c[u].display.updateSelfVideoTextures(e,t,r,this.croppingParams,p,s),c[u].enableMultiDecodeVideoWithoutSAB?c[u].firstFrame=!0:c[u].display.drawSelfVideo(this.coordinate,!1,this.ismirror)):(c[u].display.updateRemoteVideoTextures(e,t,this.croppingParams,r,s,0,this.coordinate,!1,p),c[u].enableMultiDecodeVideoWithoutSAB?c[u].firstFrame=!0:c[u].display.drawRemoteVideo(this.coordinate,this.ismirror)),this.canvasIdSet.add(c[u].rendercanvasID)}this.renderManager.renderFor(ee.gz.VIDEO)}else if(r&&n){var v=this.FindVideoRenderListFromMap(n);this.ssrcHaddataMap.set(n,!0);var g=this;v.length&&(this.canvasIdSet.clear(),v.forEach((function(n){n.haddata=!0,g.coordinate.x=n.x,g.coordinate.y=n.y,g.coordinate.width=n.width,g.coordinate.height=n.height,g.Update_Cropping_Params();var o=n.display,u=!(o&&o.reuse&&n.rendercanvasID&&i.canvasIdSet.has(n.rendercanvasID));o&&(o.setVideoMode(a),g.Should_Update_Watermark(o,n.width,n.height,n.width,n.height)&&g.Update_Display_Watermark(o,n.width,n.height,n.width,n.height),-1!==[z.rK,z.hd].indexOf(a)?o.updateSelfVideoTextures(e,t,r,g.croppingParams,u,s):o.updateRemoteVideoTextures(e,t,g.croppingParams,r,s,!0,g.coordinate,!1,u),i.canvasIdSet.add(n.rendercanvasID))})),this.renderManager.renderFor(ee.gz.VIDEO))}},de.prototype.Draw_Send_Video_Img=function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:z.rK,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.Update_SelfVideo_Texture(t,r,e,n,i,a)},de.prototype.setMirrorMyVideoOption=function(e){this.ismirror=e},de.prototype.Start_Draw=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return this.rendingFlag=!0,this.renderMode=e,e?t?(this.intervalHandle=setInterval(this.JsMediaSDK_VideoRender_interval.bind(this),t),this.intervalHandle):null:(this&&(he=this),this.Start_Request_Animation_Frame())},de.prototype.Stop_Draw=function(){this.rendingFlag=!1,this.renderMode?clearInterval(this.intervalHandle):this.Stop_Request_Animation_Frame()},de.prototype.contextLostCallback=function(e){var t=e.currentTarget.canvasId;fe&&(0,ie.O6)(t),e.preventDefault()},de.prototype.contextRestoredCallback=function(e){var t=e.currentTarget,r=t.canvasId,n=t.callback;this.Restored_From_Context_Lost(t,t,r,this.Log_Error.bind(this),n),this.onReStoreCallback&&this.onReStoreCallback(this),fe&&(0,ie.br)(r)},de.prototype.webGLContextLostProtect=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;t&&t!==e&&(t.contextLostHandler&&t.removeEventListener("webglcontextlost",t.contextLostHandler),t.contextRestoredHandler&&t.removeEventListener("webglcontextrestored",t.contextRestoredHandler)),e&&!this.bWebglContextLostProtectingMap.get(e)&&(e.canvasId=r,e.callback=n,this.renderMode||((t=this.bWebglContextLostProtectingMap.get(r))&&(t.removeEventListener("webglcontextlost",t.contextLostHandler),t.removeEventListener("webglcontextrestored",t.contextRestoredHandler)),this.bWebglContextLostProtectingMap.set(r,e),e.contextLostHandler=this.contextLostCallback.bind(this),e.contextRestoredHandler=this.contextRestoredCallback.bind(this),e.addEventListener("webglcontextlost",e.contextLostHandler,{capture:!1}),e.addEventListener("webglcontextrestored",e.contextRestoredHandler,{capture:!1})))},de.prototype._Replace_Video_Render_Array_From_Context_LOST=function(e){for(var t=e.canvas,r=e.oldCanvas,n=e.newDisplayMap,i=0;i<this.videoRenderArray.length;i++)if(this.videoRenderArray[i].canvas===r||this.videoRenderArray[i].canvas===t){r!==t&&(this.videoRenderArray[i].canvas=t);var a,o=this.videoRenderArray[i].display.getFillMode();this.videoRenderArray[i].display=n?n.get(this.videoRenderArray[i].display.getTextureIndex()):this._Create_WebGL_Canvas({videoRenderArrayIndex:i,canvas:t,canvasId:this.videoRenderArray[i].rendercanvasID}),o&&this.videoRenderArray[i].display&&this.videoRenderArray[i].display.setFillMode(o,this.videoRenderArray[i].display.getFillModeForResolution()),this.videoRenderArray[i].borderRadius&&(null===(a=this.videoRenderArray[i].display)||void 0===a||a.setRoundedCornerRadius(this.videoRenderArray[i].borderRadius))}},de.prototype.Restored_From_Context_Lost=function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(this.renderMode)this._Replace_Video_Render_Array_From_Context_LOST({canvas:e,oldCanvas:t});else{var a=this.renderManager.onRestoredFromContextLost(r,e,t,this.threadNumbs,n,this.canvasToLocalDisplay);a&&(this.ssrcDisplayMap.forEach((function(r,n){r.forEach((function(r){if(r.haddata=!1,r.canvas===t){t!==e&&(r.canvas=e);var n=r.display;r.display=a.get(n.getTextureIndex())}}))})),this._Replace_Video_Render_Array_From_Context_LOST({canvas:e,oldCanvas:t,newDisplayMap:a}),null==i||i({canvas:e,oldCanvas:t,newDisplayMap:a}),this.rendingFlag&&this.Start_Request_Animation_Frame())}},de.prototype.Replace_Canvas=function(e,t){var r=null;this.bWebglContextLostProtectingMap.forEach((function(e,n){n===t&&(r=e)})),r!=e&&(this.bWebglContextLostProtectingMap.delete(t),this.webGLContextLostProtect(e,r,t),this.Restored_From_Context_Lost(e,r,t,this.Log_Error.bind(this))),this.isSupportOffscreenCanvas&&(this.waterMarkCanvas||this.videorendercanvas)&&(this.waterMarkCanvas=this.videorendercanvas=new OffscreenCanvas(640,360))},de.prototype.Get_Display=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=this.renderManager.getRendererProvider().isWebGLRendererType(),a=this.renderManager.getRendererProvider().isWebGL2RendererType();return(i||a)&&this.webGLContextLostProtect(e,null,t,n),this.renderManager.getVideoRenderDisplay(e,t,this.threadNumbs,this.Log_Error.bind(this),this.canvasToLocalDisplay)},de.prototype.GiveBack_Display=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e[0];r&&r.display&&this.renderManager.recycleRenderDisplay(r.canvas,r.display,t)},de.prototype.Get_Logical_SSrc=function(e){return e?e>>10<<10:-1},de.prototype.Set_LocalVideo_Ptr=function(e){e&&(this.localVideoPtr=e)},de.prototype.Set_LocalVideo_Buffer=function(e){e&&(this.encodedVideoSharedArrayWasmMemory=e,this.sabBuffer=e.buffer,this.encodedVideoSharedArrayBufferUint8Array=new Uint8Array(this.sabBuffer),this.encodedVideoSharedArrayBufferUint16Array=new Uint16Array(this.sabBuffer))},de.prototype.Set_LocalVideo_SSRC=function(e){e&&(this.localvideossrc=e,this.selfvideossrc=e)},de.prototype.Draw_LocalVideo=function(){if(this.localVideoPtr&&this.sabBuffer&&this.localvideossrc){this.encodedVideoSharedArrayWasmMemory&&this.encodedVideoSharedArrayWasmMemory.buffer!=this.sabBuffer&&(this.encodedVideoSharedArrayBufferUint8Array=new Uint8Array(this.encodedVideoSharedArrayWasmMemory.buffer),this.encodedVideoSharedArrayBufferUint16Array=new Uint16Array(this.encodedVideoSharedArrayWasmMemory.buffer),this.sabBuffer=this.encodedVideoSharedArrayWasmMemory.buffer);var e=Atomics.load(this.encodedVideoSharedArrayBufferUint8Array,this.localVideoPtr),t=Atomics.load(this.encodedVideoSharedArrayBufferUint8Array,this.localVideoPtr+1),r=!0;if(e==t&&(r=!1),e-t==1&&(e=(e+1)%z.DG),r){var n,i=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(z.g$+4+8+2)*e)/2],a=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(z.g$+4+8+2)*e+2)/2],o=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(z.g$+4+8+2)*e+4)/2],s=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(z.g$+4+8+2)*e+6)/2],u=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(z.g$+4+8+2)*e+8)/2],c=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(z.g$+4+8+2)*e+10)/2],d=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(z.g$+4+8+2)*e+12)/2],l=255&d,h=d>>8&255;n=l&&l!==z.hd?i*a*3/2:i*a*4,this.croppingParams.top=o,this.croppingParams.left=s,this.croppingParams.height=c,this.croppingParams.width=u;var f=this.encodedVideoSharedArrayBufferUint8Array.subarray(this.localVideoPtr+4+(z.g$+4+8+2)*e+4+8+2,this.localVideoPtr+4+(z.g$+4+8+2)*e+4+8+2+n);this.Update_SelfVideo_Texture(i,a,f,this.Get_Logical_SSrc(this.localvideossrc),l,this.croppingParams,h),Atomics.store(this.encodedVideoSharedArrayBufferUint8Array,this.localVideoPtr,(e+1)%z.DG)}}},de.prototype.Update_LocalVideo=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.localvideossrc;if(this.renderMode){for(var i=0,a=!1,o=this.FindVideoRenderList(n),s=r&&(1==t||3==t);i<o.length;i++){a=!0;var u=e;this.croppingParams.top=u.visibleRect?0:u.cropTop,this.croppingParams.left=u.visibleRect?0:u.cropLeft,this.croppingParams.height=u.visibleRect?s?u.visibleRect.width:u.visibleRect.height:u.cropHeight,this.croppingParams.width=u.visibleRect?s?u.visibleRect.height:u.visibleRect.width:u.cropWidth,this.coordinate.x=o[i].x,this.coordinate.y=o[i].y,this.coordinate.width=o[i].width,this.coordinate.height=o[i].height,this.Update_Cropping_Params(),o[i].display.setVideoMode(0);var c=o[i],d=c.display,l=c.width,h=c.height;0!=l&&0!=h&&(this.Should_Update_Watermark(d,l,h,l,h)&&this.Update_Display_Watermark(d,l,h,l,h),-1!==[z.rK,z.hd].indexOf(0)&&(o[i].display.updateRemoteVideoTexturesImageBitmap(this.croppingParams.width,this.croppingParams.height,u,this.croppingParams,r?0:t),o[i].enableMultiDecodeVideoWithoutSAB?o[i].firstFrame=!0:o[i].display.drawSelfVideo(this.coordinate,!1,this.ismirror)))}a||this.renderManager.destroyUnusedVideoFrame(e)}else this.Update_RemoteVideo_Texture(e,!0,n,t,null,r)},de.prototype.Set_Capture_Video_Flag=function(e){this.startCaptureVideo=e},de.prototype.Get_Capture_Video_Flag=function(){return this.startCaptureVideo},de.prototype.FindVideoRender=function(e){if(!e)return null;for(var t=0;t<this.videoRenderArray.length;t++)if(this.videoRenderArray[t].ssrc&&this.videoRenderArray[t].ssrc>>10==e>>10)return this.videoRenderArray[t];return null},de.prototype.FindVideoRenderList=function(e){var t=this.isActiveSeakerSsrc(e),r=this.FindVideoRender(z.$K),n=[e>>10];t&&r&&n.push(z.$K>>10);for(var i=[],a=0;a<this.videoRenderArray.length;a++)this.videoRenderArray[a].ssrc&&n.includes(this.videoRenderArray[a].ssrc>>10)&&i.push(this.videoRenderArray[a]);return i},de.prototype.FindVideoRenderListFromMap=function(e){var t=this.isActiveSeakerSsrc(e),r=y(this.ssrcDisplayMap.get(this.Get_Logical_SSrc(e))||[]);if(t){var n=this.ssrcDisplayMap.get(this.Get_Logical_SSrc(z.$K))||[];r.push.apply(r,y(n))}return r},de.prototype.JsMediaSDK_VideoRender_interval=function(){var e=this;this.startCaptureVideo&&this.Draw_LocalVideo();var t=this.FindVideoRender(z.$K),r=this.FindVideoRender(this.activeSpeakssrc);if(0!=this.videoRenderArray.length){for(var n,i,a=function(){var i=e.videoRenderArray[o];if(e.isLSSPlayer&&e.pauseSet.has(i.ssrc+" "+i.zone))return{v:void 0};i.display;var a=i.canvas,s=i.enableMultiDecodeVideoWithoutSAB,u=i.ssrc,c=i.isMyself;if(n=null,i==t&&r)return 0;var d=u;i!=t||r||(d=e.activeSpeakssrc);var l=[i];if(i==r&&t&&l.push(t),e.isActiveSsrcVideo(d)){var h=Date.now();if(e.jsMediaEngine){var f=e.jsMediaEngine.Get_Video_SSRC_Latest_Time();e.timestamp=f.currentSSRCTime,e.audioPlayTime=f.audioPlayTime}e.calPacingTime(h),h-e.timestart<e.pacingTime&&h-e.timestart>0||(n=e.Get_Decoded_Video_Frame(e.Get_Logical_SSrc(d)),e.timestart=h)}else n=e.Get_Decoded_Video_Frame(e.Get_Logical_SSrc(d));if(n){var v;e.isActiveSsrcVideo(d)&&(e.videoTimestamp=n.ntptime),v=n.yuvdata instanceof ie.Tm?n.yuvdata.yuvdata:n.yuvdata,e.croppingParams.top=n.r_y,e.croppingParams.left=n.r_x,e.croppingParams.height=n.r_h,e.croppingParams.width=n.r_w;var g=n.width>n.height&&(1===n.rotation||3===n.rotation)||n.width<n.height&&1!==n.rotation&&3!==n.rotation,m=g?n.height:n.width,y=g?n.width:n.height,_=a.width,S=a.height;if(e.currentVideoHeight==e.croppingParams.height&&e.currentVideoWidth==e.croppingParams.width||(e.Notify_APPUI?e.Notify_APPUI(p.XDu,{width:e.croppingParams.width,height:e.croppingParams.height}):postMessage({status:te.Rk,width:e.croppingParams.width,height:e.croppingParams.height}),e.currentVideoHeight=e.croppingParams.height,e.currentVideoWidth=e.croppingParams.width),v.length==n.width*n.height*3/2&&n.r_x>=0&&n.r_y>=0&&n.r_x+n.r_w<=n.width&&n.r_y+n.r_h<=n.height){8400==e.vMonitorCount&&(e.jsMediaEngine?e.jsMediaEngine.Send_Render_Monitor_Log("VDGLM"):postMessage({status:te.Zc,data:"VDGLW"}),e.vMonitorCount=0),e.vMonitorCount++;var A=e;l.forEach((function(t){t.display&&(A.Should_Update_Watermark(t.display,m,y,_,S)&&A.Update_Display_Watermark(t.display,m,y,_,S),s?t.display&&(t.display.setVideoMode(z.Wp),e.isLSSPlayer&&e.ssrcCurrentRenderingMap.set(u,n),t.display.updateRemoteVideoTextures(n.width,n.height,A.croppingParams,v,n.rotation,n.yuv_limited),t.firstFrame=!0):(t.display.setVideoMode(z.Wp),e.isLSSPlayer&&e.ssrcCurrentRenderingMap.set(u,n),t.display.drawNextOutputPictureFrame(n.width,n.height,A.croppingParams,v,n.rotation,n.yuv_limited,t)))}))}else e.Log_Error("Invalid YUV data: ".concat(n.r_x," ").concat(n.r_y," ").concat(n.r_w," ").concat(n.r_h," ").concat(n.width," ").concat(n.height));n.yuvdata instanceof ie.Tm&&n.yuvdata.recycle()}s&&l.forEach((function(t){if(s&&t.firstFrame){var r={x:t.x,y:t.y,width:t.width,height:t.height};if(c)t.display.drawSelfVideo(r);else{if(e.isLSSPlayer){e.firstFrameMap.get(t.ssrc)||(e.firstFrameMap.set(t.ssrc,!0),e.Notify_APPUI?e.Notify_APPUI(p.vIC,{ssrc:t.ssrc,params:t.display.croppingParams}):postMessage({status:"FIRST_FRAME",ssrc:t.ssrc,params:t.display.croppingParams}));var n=e.ssrcCurrentRenderingMap.get(t.ssrc);t.display.drawRemoteVideo(r),n&&e.zoneLastRenderedMap.set(t.ssrc+" "+t.zone,n)}t.display.drawRemoteVideo(r)}}}))},o=0;o<this.videoRenderArray.length;o++)if(0!==(i=a())&&i)return i.v;this.renderManager.renderFor(ee.gz.VIDEO)}},de.prototype.Get_Decoded_Video_Frame=function(e){if(this.videoQueue){var t=this.videoQueue.GetQueue(e);return t?t.dequeue():null}},de.prototype.Set_SSRC_Latest_Time_Stamp=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.timestamp!==e&&"number"==typeof e&&e&&(this.timestamp=e,this.audioPlaySsrc=t,this.audioPlayTime=Date.now())},de.prototype.Get_Decoded_Video_Buffer_Length=function(e){return this.videoQueue?this.videoQueue.GetQueueLength(e):0},de.prototype.Get_SSRC_VIDEO_FPS=function(e){if(e>>=10,this.videoQueue&&this.videoQueue.ssrcInfo){var t=this.videoQueue.ssrcInfo.GetSSRCFpsInfo(e);if(t)return Math.round(t)}return 0},de.prototype.Change_Current_SSRC=function(e){this.currentactive=e,this.ClearQueue()},de.prototype.Set_Render_Array_IntervalMode=function(e,t){if(this.videoRenderArray=e,this.isLSSPlayer&&this.ssrcDisplayMap.clear(),this.renderMode&&this.videoRenderArray.length>0)for(var r=0;r<this.videoRenderArray.length;r++){var n,i=this.videoRenderArray[r];if(t){if(!i.display){if(i.enableMultiDecodeVideoWithoutSAB=t,i.display=this.Get_Display(i.canvas,i.canvas.id),i.display&&i.display.setFillMode(i.fillMode,i.fillModeForResolution),this.isLSSPlayer){var a=this.ssrcDisplayMap.get(this.Get_Logical_SSrc(i.ssrc));a||(a=[]),a.push(i),this.ssrcDisplayMap.set(this.Get_Logical_SSrc(i.ssrc),a)}var o;i.borderRadius&&(null===(o=i.display)||void 0===o||o.setRoundedCornerRadius(i.borderRadius))}}else this.renderManager.getRendererProvider().isWebGPURendererType()?i.display=this.Get_Display(i.canvas,i.rendercanvasID):i.display=this._Create_WebGL_Canvas({videoRenderArrayIndex:r,canvas:i.canvas,canvasId:i.rendercanvasID}),i.borderRadius&&(null===(n=i.display)||void 0===n||n.setRoundedCornerRadius(i.borderRadius)),this.webGLContextLostProtect(i.canvas,void 0,i.rendercanvasID)}},de.prototype._Create_WebGL_Canvas=function(e){var t=e.videoRenderArrayIndex,r=e.canvas,n=e.canvasId,i={forceNoGL:void 0,contextOptions:{webglcontextlostCallback:this.webglcontextlostCallback.bind(this),webglcontextrestoredCallback:this.webglcontextrestoredCallback.bind(this),params:{videoRenderArrayIndex:t,canvas:r,canvasId:n}},webGLResources:void 0,initMask:!1};return this.renderManager.createWebGLVideoRenderDisplay(r,n,0,i)},de.prototype.webglcontextlostCallback=function(e,t){e.preventDefault()},de.prototype.webglcontextrestoredCallback=function(e,t){var r,n,i,a=t.videoRenderArrayIndex,o=t.canvas,s=t.canvasId;(!this.videoRenderArray||a>=(null===(r=this.videoRenderArray)||void 0===r?void 0:r.length))&&this.Log_Error("videoRenderArray:".concat(this.videoRenderArray,", length:").concat(null===(i=this.videoRenderArray)||void 0===i?void 0:i.length)),this.renderMode&&a<(null===(n=this.videoRenderArray)||void 0===n?void 0:n.length)&&(this.videoRenderArray[a].display=this._Create_WebGL_Canvas({videoRenderArrayIndex:a,canvas:o,canvasId:s}),this.Set_Render_Array(this.videoRenderArray))},de.prototype.ClearQueue=function(){try{var e,t=A(this.videoQueue.ssrcQueueMap);try{for(t.s();!(e=t.n()).done;)for(var r=v(e.value,2),n=(r[0],r[1]);!n.isEmpty();){var i=n.dequeue();i.yuvdata&&i.yuvdata instanceof ie.Tm&&i.yuvdata.recycle()}}catch(e){t.e(e)}finally{t.f()}}catch(e){this.Log_Error("Exception during VideoRender.ClearQueue",e)}this.videoQueue&&this.videoQueue.ClearQueue(),this.currentVideoHeight=0,this.currentVideoWidth=0},de.prototype.Set_WaterMark_Info=function(e){var t=e.waterMarkCanvas,r=e.isCreateVideoWaterMark,n=e.videoWaterMarkName,i=e.watermarkOpacity,a=e.watermarkRepeated,o=e.watermarkPosition;this.waterMarkCanvas=t||this.videorendercanvas,this.isCreateVideoWaterMark=r,this.videoWaterMarkName=n,void 0!==a&&(this.isWaterMarkRepeatedEnable=!!a),void 0!==i&&(this.waterMarkOpacity=i),void 0!==o&&(this.watermarkPosition=o)},de.prototype.Set_WaterMark_Flag=function(e){if(this.videoRenderArray.length>0)for(var t=0;t<this.videoRenderArray.length;t++)this.videoRenderArray[t].display.setWatermarkFlag(e?1:0)},de.prototype.Should_Watermark_Repeated=function(e,t){return this.isWaterMarkRepeatedEnable&&e>306&&t>202};var le=function(e,t){if(e<640&&e){var r=640/e;e=640,t=Math.round(t*r)}return{width:e,height:t}};de.prototype.Update_Display_Watermark=function(e,t,r,n,i){var a=this.Should_Watermark_Repeated(n,i);this.waterMarkCanvas||this.videorendercanvas||(this.videorendercanvas=this.isSupportOffscreenCanvas?new OffscreenCanvas(640,360):null);var o=n<512||i<288?16:this.watermarkPosition,s=this.waterMarkCanvas||this.videorendercanvas;if(!("function"==typeof OffscreenCanvas&&s instanceof OffscreenCanvas&&OffscreenCanvasRenderingContext2D)||OffscreenCanvasRenderingContext2D.prototype.measureText){var u=le(t,r);t=u.width,r=u.height;var c=a?this.WaterMarkRGBA.Get_Repeated_WaterMarkRGBA({canvas:s,name:this.videoWaterMarkName,width:t,height:r,opacity:this.waterMarkOpacity,position:o}):this.WaterMarkRGBA.Get_WaterMarkRGBA({canvas:s,name:this.videoWaterMarkName,width:t,height:r,opacity:this.waterMarkOpacity,position:o});e.updateWatermark(t,r,c)}},de.prototype.Should_Update_Watermark=function(e,t,r,n,i){if(!this.isCreateVideoWaterMark)return!1;var a=!1,o=le(t,r);o.width===e.getWatermarkWidth()&&o.height===e.getWatermarkHeight()||(a=!0);var s=this.Should_Watermark_Repeated(n,i);e.isSetWatermark()||(a=!0),s!==e.isWatermarkRepeated()&&(a=!0,e.setWatermarkRepeated(s)),this.waterMarkOpacity&&this.waterMarkOpacity!==e.getWatermarkOpacity()&&(a=!0,e.setWatermarkOpacity(this.waterMarkOpacity));var u=t<512||r<288?16:this.watermarkPosition;return u!==e.getWatermarkPosition()&&(a=!0,e.setWatermarkPosition(u)),a},de.prototype.calCulateActiveFps=function(e){this.activeFps&&e>=this.lfTimeStamp?this.activeFps=500/(e-this.lfTimeStamp)+this.activeFps/2:this.lfTimeStamp&&(this.activeFps=1e3/(e-this.lfTimeStamp))},de.prototype.Put_Video_Data_Queue=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;if(this.videoQueue){var r=this.videoQueue.GetQueue(e.ssrc);if(r||(r=this.videoQueue.AddQueue(e.ssrc)),r.enqueue(e),(this.Get_Logical_SSrc(this.currentactive)==this.Get_Logical_SSrc(e.ssrc)||this.Get_Logical_SSrc(this.audioPlaySsrc)==this.Get_Logical_SSrc(e.ssrc))&&(this.lfTimeStamp&&this.calCulateActiveFps(e.ntptime),this.lfTimeStamp=e.ntptime),this.lastActiveSSRC!=e.ssrc&&(this.lfTimeStamp=0,this.activeFps=0),this.lastActiveSSRC=e.ssrc,this.videoQueue&&this.videoQueue.ssrcInfo){var n=e.ssrc>>10;this.videoQueue.ssrcInfo.UpdateSSRCInfo(n,e.ntptime)}for(var i=this.videoQueue.GetQueueLength(e.ssrc)-t;i>=0;){var a=this.Get_Decoded_Video_Frame(e.ssrc);a.yuvdata instanceof ie.Tm&&a.yuvdata.recycle(),i--}}else e.yuvdata&&e.yuvdata instanceof ie.Tm&&e.yuvdata.recycle()},de.prototype.Clear_OffScreenCanvas=function(e){e.contextLostHandler&&(e.removeEventListener("webglcontextlost",e.contextLostHandler),e.contextLostHandler=null),e.contextRestoredHandler&&(e.removeEventListener("webglcontextrestored",e.contextRestoredHandler),e.contextRestoredHandler=null),e.width=1,e.height=1},de.prototype.Zoom_Render=function(e){},de.prototype.Decode_Ssrc=function(e){return this.ssrcDisplayMap.has(this.Get_Logical_SSrc(e))||this.Get_Logical_SSrc(e)==this.Get_Logical_SSrc(this.selfvideossrc)};var he,fe="undefined"==typeof window;function pe(e){var t=Date.now(),r=he;if(t-ve<30&&t-ve>0)r.Start_Request_Animation_Frame(e);else if(ve=t,r.rendingFlag){try{r.startCaptureVideo&&r.localVideoPtr&&r.Draw_LocalVideo(),r.ssrcDisplayMap.forEach((function(e,n){if(n!=r.Get_Logical_SSrc(z.$K)||!r.ssrcDisplayMap.has(r.Get_Logical_SSrc(r.activeSpeakssrc)))if(n==r.Get_Logical_SSrc(z.$K)&&(n=r.activeSpeakssrc),r.isActiveSsrcVideo(n))if(r.calPacingTime(t),t-r.timestart<r.pacingTime);else{r.timestart=t;var i=r.Get_Decoded_Video_Frame(r.Get_Logical_SSrc(n));i&&(r.Update_RemoteVideo_Texture(i),r.videoTimestamp=i.ntptime)}else{var a=r.Get_Decoded_Video_Frame(r.Get_Logical_SSrc(n));a&&r.Update_RemoteVideo_Texture(a)}})),r._render()}catch(e){r.Log_Error("Exception while rendering video",e)}r.Start_Request_Animation_Frame(e)}else r.rAFID&&r.Stop_Request_Animation_Frame()}de.prototype.Check_Request_Animation=function(){fe&&this.rendingFlag&&this.prevRequestAnimationTimestap&&performance.now()-this.prevRequestAnimationTimestap>2e3&&!this.rAFIDBack&&(postMessage({status:te.vr,data:"WCL_M,RCIF"}),this.rAFID&&(cancelAnimationFrame(this.rAFID),this.rAFID=0),this.rAFIDBack=setInterval(pe.bind(null,!0),30))},de.prototype.Start_Request_Animation_Frame=function(e,t){if(!e&&this.rAFIDBack&&(console.log("Request_Animation_start"),this.Stop_Request_Animation_Frame_Backup()),!this.rAFIDBack)return t||(this.retryRequestAnimationStep=2),this.prevRequestAnimationTimestap=performance.now(),this.rAFID=requestAnimationFrame(pe),this.rAFID},de.prototype.Stop_Request_Animation_Frame_Backup=function(){this.rAFIDBack&&(clearInterval(this.rAFIDBack),this.rAFIDBack=null)},de.prototype.Stop_Request_Animation_Frame=function(){this.rAFID&&cancelAnimationFrame(this.rAFID),this.rAFID=0,this.prevRequestAnimationTimestap=0,this.retryRequestAnimationStep=2,this.Stop_Request_Animation_Frame_Backup()},de.prototype.Add_Pause=function(e){this.pauseSet.add(e.ssrc+" "+e.zone)},de.prototype.Remove_Pause=function(e){var t=e.ssrc+" "+e.zone;this.pauseSet.has(t)&&this.pauseSet.delete(t)},de.prototype.Zoom_Render_Paused=function(e){if(this.pauseSet.has(e.ssrc+" "+e.zone)&&this.zoneLastRenderedMap.get(e.ssrc+" "+e.zone)){var t=this.ssrcDisplayMap.get(this.Get_Logical_SSrc(e.ssrc));t[0].x=e.x,t[0].y=e.y,t[0].width=e.width,t[0].height=e.height}this.Draw_Last_Frame()},de.prototype.Draw_Last_Frame=function(){var e,t=A(this.pauseSet.values());try{for(t.s();!(e=t.n()).done;){var r=e.value,n=v(r.split(" "),1)[0],i=this.zoneLastRenderedMap.get(r);if(i){var a=this.ssrcDisplayMap.get(this.Get_Logical_SSrc(n)),o=a&&a[0]&&a[0].display||null;if(o){var s=a[0];o.setVideoMode(z.Wp),this.Should_Update_Watermark(o,s.width,s.height,s.width,s.height)&&this.Update_Display_Watermark(o,s.width,s.height,s.width,s.height),o.updateRemoteVideoTextures(i.width,i.height,{top:i.r_y,left:i.r_x,height:i.r_h,width:i.r_w},i.yuvdata,i.rotation,i.yuv_limited),o.drawRemoteVideo({x:a[0].x,y:a[0].y,width:a[0].width,height:a[0].height})}}}}catch(e){t.e(e)}finally{t.f()}},de.prototype.Log_Error=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.globalTracingLogger?this.globalTracingLogger.error(e,t):(0,ie.r1)(e,t)},de.prototype._render=function(){var e=this;e.ssrcDisplayMap.forEach((function(t,r){var n=e.isSelfVideo(r);t.forEach((function(t){var r,i=t.display;if(i&&(null!==(r=i.isAvaiable)&&void 0!==r&&r.call(i)||setTimeout((function(){var e;null===(e=i.restoreContext)||void 0===e||e.call(i)}),5),t.haddata&&i.getVideoMode()!=z.kh))if(e.coordinate.x=t.x,e.coordinate.y=t.y,e.coordinate.width=t.width,e.coordinate.height=t.height,n&&-1!==[z.rK,z.hd].indexOf(i.getVideoMode()))i.drawSelfVideo(e.coordinate,!1,e.ismirror);else if(n)i.drawRemoteVideo(e.coordinate,e.ismirror);else{if(e.isLSSPlayer){e.firstFrameMap.get(t.ssrc)||(e.firstFrameMap.set(t.ssrc,!0),e.Notify_APPUI?e.Notify_APPUI(p.vIC,{ssrc:t.ssrc,params:t.display.croppingParams}):postMessage({status:"FIRST_FRAME",ssrc:t.ssrc,params:t.display.croppingParams}));var a=e.ssrcCurrentRenderingMap.get(t.ssrc);a&&e.zoneLastRenderedMap.set(t.ssrc+" "+t.zone,a)}i.drawRemoteVideo(e.coordinate)}}))})),e.renderManager.renderFor(ee.gz.VIDEO)},de.prototype._singleRender=function(){var e=this;this.videoRenderArray.forEach((function(t){var r=t.x,n=t.y,i=t.width,a=t.ssrc,o=t.height,s=t.enableMultiDecodeVideoWithoutSAB,u=t.display,c=e.isSelfVideo(a),d={x:r,y:n,width:i,height:o};s?c?u.drawSelfVideo(d):u.drawRemoteVideo(d):u.drawNextOutputPictureFrame(u.getTextureWidth(),u.getTextureHeight(),u.getCroppingParams(),null,u.getRotation(),void 0,d,!1)}))},de.prototype.calPacingTime=function(e){if(this.pacingTime=30,this.activeFps>=1&&this.activeFps<=40&&(this.pacingTime=1e3/this.activeFps),this.timestamp&&this.videoTimestamp){var t=this.timestamp+e-this.audioPlayTime,r=this.videoTimestamp+this.pacingTime-t,n=this.currentactive?this.currentactive:this.audioPlaySsrc,i=this.videoQueue.GetQueueLength(this.Get_Logical_SSrc(n));r>65&&r<1e4&&i>=1&&(this.pacingTime=1.5*this.pacingTime),r<-65&&(this.pacingTime=1*this.pacingTime/2)}else this.timestamp||(this.pacingTime>150?this.pacingTime=1*this.pacingTime/2:this.pacingTime=this.pacingTime-10)},de.prototype.getRenderManager=function(){return this.renderManager},de.prototype.cleanup=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.renderManager.cleanup(e,t,r)},de.prototype.setActiveSpeakerSsrc=function(e){this.activeSpeakssrc=e},de.prototype.getActiveSpeakerSsrc=function(e){return this.activeSpeakssrc},de.prototype.isActiveSeakerSsrc=function(e){return this.activeSpeakssrc&&this.activeSpeakssrc>>10==e>>10},de.prototype.isActiveSsrcVideo=function(e){var t=e>>10;return t==this.currentactive>>10||t==this.audioPlaySsrc>>10},de.prototype.clearDraw=function(e){e&&(this.clearColor[0]=255*e.R,this.clearColor[1]=255*e.G,this.clearColor[2]=255*e.B,this.clearColor[3]=255*e.A)},de.prototype.isSelfVideo=function(e){return!!this.selfvideossrc&&(this.Get_Logical_SSrc(e)==this.Get_Logical_SSrc(this.selfvideossrc)||this.isActiveSeakerSsrc(this.selfvideossrc)&&e>>10==z.$K>>10)},de.prototype.reDraw=function(){this.renderMode?this._singleRender():this._render()},de.prototype.getUserIdVideo=function(e){for(var t=null,r=e==z.$K||this.isActiveSeakerSsrc(e),n=0;n<this.videoRenderArray.length;n++){var i=this.videoRenderArray[n];if(i.ssrc>>10==e>>10||r&&i.ssrc==z.$K){var a=i.width,o=i.height;(!t||a*o>t.width*t.height)&&(t=i)}}if(!t||!t.display)return null;var s=t.canvas,u=t.rendercanvasID,c=t.display.getTextureWidth(),d=t.display.getTextureHeight(),l=t.display.getRotation(),h=t.display.getViewPosition();if(1==l||3==l){var f=c;c=d,d=f}var p,v,g=t,m=g.x,y=g.y,_=g.width,S=g.height,A=Math.floor(_*h[1]),b=Math.floor(S*h[0]);p=_-2*A,v=S-2*b;var E=s.height-S-y+b,k=m+A;return d=Math.floor(Math.min(v,d)),{canvasId:u,canvas:s,options:{x:k,y:E,width:p,height:v,displayWidth:c=Math.floor(d*p/v),displayHeight:d}}};var ve=0,ge=de;function me(e){this.Notify_APPUI=e.Notify_APPUI,this.PubSub=e.PubSub,this.jsMediaEngine=e.jsMediaEngine,this.globalTracingLogger=e.globalTracingLogger,this.renderManager=e.renderManager,this.currentshareactive=0,this.isFromMainSession=0,this.sharingWidthAndHeightInfo={logicHeight:0,logicWidth:0},this.currentSharingHeight=0,this.currentSharingWidth=0,this.currentSharingLogicHeight=0,this.currentSharingLogicWidth=0,this.isCreateSharingWaterMark=!1,this.sharingWaterMarkName="",this.isWaterMarkRepeatedEnable=!1,this.waterMarkOpacity=.15,this.SharingCanvasSizeInfo=null,this.Cursorx=null,this.Cursory=null,this.CursorWidth=null,this.CursorHeight=null,this.xratio=1,this.yratio=1,this.sharingDisplay=null,this.mouseQueue=new ne.a6,this.sharingQueue=new ne.a6,this.WaterMarkRGBA=new re.A,this.sMonitorCount=0,this.mMonitorCount=0,this.firstFrameForIOS=!1,this.timestart=0,this.asTime=0,this.rAFID=0,this.requestAnimation=!1,this.requestF=this.No_Bindthis_RAF.bind(this),this.cATimeStamp=0,this.lRTimeStamp=0,this.pacingtime=1,this.sharingFps=0,this.lfTimeStamp=0,this.maxQueueLength=0,this.vaTimeDelta=0,this.renderMode=z.sm,this.SharingRenderInterval=0,this.RAFhealthCheckInterval=0,this.RAFLastTime=0,this.brefresh=!1,this.statisticObj=null}me.prototype.Start_Draw=function(){return this.requestAnimation=!0,this.Start_Request_Animation_Frame()},me.prototype.Stop_Draw=function(){return this.requestAnimation=!1,this.lRTimeStamp=0,this.cATimeStamp=0,this.Stop_Request_Animation_Frame()},me.prototype.Start_Request_Animation_Frame=function(){return this.rAFID=requestAnimationFrame(this.requestF),this.rAFID},me.prototype.Stop_Request_Animation_Frame=function(){this.rAFID&&(cancelAnimationFrame(this.rAFID),this.rAFID=0)},me.prototype.No_Bindthis_RAF=function(){var e=performance.now();this.RAFLastTime=e,this.requestAnimation?(this.calPacingTime(e),e-this.timestart>this.pacingtime&&(this.timestart=e,this.JsMediaSDK_SharingRender()),this.Start_Request_Animation_Frame()):this.Stop_Request_Animation_Frame()},me.prototype.No_Bindthis_Interval=function(){var e=performance.now();this.calPacingTime(e),e-this.timestart>this.pacingtime&&(this.timestart=e,this.JsMediaSDK_SharingRender())},me.prototype.calPacingTime=function(e){this.pacingtime=30,this.sharingFps&&this.sharingFps>0&&this.sharingFps<100&&(this.pacingtime=1e3/this.sharingFps);var t=this.Get_Current_QueueLength();if(this.cATimeStamp&&this.lRTimeStamp){var r=this.cATimeStamp+e-this.asTime;this.vaTimeDelta=this.lRTimeStamp+this.pacingtime-r,this.vaTimeDelta>65&&this.vaTimeDelta<1e4&&t>1&&(this.pacingtime=1.5*this.pacingtime),this.vaTimeDelta<-65&&(this.pacingtime=1*this.pacingtime/2)}else this.cATimeStamp||(this.pacingtime>150||t>20?this.pacingtime=1*this.pacingtime/2:this.pacingtime=this.pacingtime-10)},me.prototype.JsMediaSDK_SharingRender=function(){var e,t,r;if(this.sharingDisplay)if(!1!==(null===(e=(t=this.sharingDisplay).isAvaiable)||void 0===e?void 0:e.call(t))){null===(r=this.statisticObj)||void 0===r||r.sample();var n=this.Get_Decoded_Sharing_Frame(this.currentshareactive,this.isFromMainSession),i=this.Get_Decoded_Mouse_Frame(this.currentshareactive,this.isFromMainSession);if(n){var a,o;this.lRTimeStamp=n.ntptime,n.yuvdata instanceof ie.Tm?(a=n.yuvdata.yuvdata,o=n.yuvdata):(a=n.yuvdata,o=null),this.sharingWidthAndHeightInfo.logicWidth==n.logic_w&&this.sharingWidthAndHeightInfo.logicHeight==n.logic_h||(this.PubSub?PubSub.publish(p.vjv,{body:{width:n.logic_w,height:n.logic_h,logicWidth:n.logic_w,logicHeight:n.logic_h}}):(postMessage({status:te.Rm,logicWidth:n.logic_w,logicHeight:n.logic_h}),this.updateOffscreenCanvasSize(n.logic_w,n.logic_h)),this.sharingWidthAndHeightInfo.logicWidth=n.logic_w,this.sharingWidthAndHeightInfo.logicHeight=n.logic_h);var s=n.logic_h,u=n.logic_w,c=n.r_h,d=n.r_w;this.xratio=d/u,this.yratio=c/s;var l={top:n.r_x,left:n.r_y,height:n.r_h,width:n.r_w};this.currentSharingHeight==n.r_h&&this.currentSharingWidth==n.r_w&&this.currentSharingLogicHeight==n.logic_h&&this.currentSharingLogicWidth==n.logic_w||(this.Notify_APPUI?this.Notify_APPUI(p.cYb,{body:{height:n.logic_h,width:n.logic_w,logicHeight:n.logic_h,logicWidth:n.logic_w}}):(postMessage({status:te.Rm,logicWidth:n.logic_w,logicHeight:n.logic_h}),this.updateOffscreenCanvasSize(n.logic_w,n.logic_h)),this.currentSharingHeight=n.r_h,this.currentSharingWidth=n.r_w,this.currentSharingLogicHeight=n.logic_h,this.currentSharingLogicWidth=n.logic_w);var h=this.SharingCanvasSizeInfo?this.SharingCanvasSizeInfo.width:n.r_w,f=this.SharingCanvasSizeInfo?this.SharingCanvasSizeInfo.height:n.r_h;this.Should_Update_Watermark(this.sharingDisplay,h,f)&&this.Update_Display_Watermark(this.sharingDisplay,h,f),3e3==this.sMonitorCount&&(this.jsMediaEngine?this.jsMediaEngine.Send_Render_Monitor_Log("SDIMM"):postMessage({status:te.SG,data:"SDIMW"}),this.sMonitorCount=0),this.sMonitorCount++,this.sharingDisplay.drawNextOutputPictureFrame(n.width,n.height,l,a,null,n.yuv_limited),o&&o.recycle(),n.dataptr&&Module._free(n.dataptr)}else if(this.brefresh&&(this.brefresh=!1,0!=this.sharingDisplay.getTextureWidth()&&0!=this.sharingDisplay.getTextureHeight()&&0!==this.currentSharingWidth&&0!==this.currentSharingHeight)){var v=this.SharingCanvasSizeInfo?this.SharingCanvasSizeInfo.width:this.currentSharingWidth,g=this.SharingCanvasSizeInfo?this.SharingCanvasSizeInfo.height:this.currentSharingHeight;this.Should_Update_Watermark(this.sharingDisplay,v,g)&&this.Update_Display_Watermark(this.sharingDisplay,v,g),this.sharingDisplay.drawNextOutputPictureFrame(this.sharingDisplay.getTextureWidth(),this.sharingDisplay.getTextureHeight(),this.sharingDisplay.getCroppingParams(),null,this.picRotation,!0,null,!1),n=!0}i&&(this.Cursorx=i.r_x*this.xratio,this.Cursory=i.r_y*this.yratio,this.CursorWidth=i.width*this.xratio,this.CursorHeight=i.height*this.yratio,this.sharingDisplay.updateCursor(i.width,i.height,i.buffer),3e3==this.mMonitorCount&&(this.jsMediaEngine?this.jsMediaEngine.Send_Render_Monitor_Log("SDSBM"):postMessage({status:te.SG,data:"SDSBW"}),this.mMonitorCount=0),this.mMonitorCount++,this.sharingDisplay.drawCursor(1,this.Cursorx,this.Cursory,this.CursorWidth,this.CursorHeight)),n&&this.renderManager.renderFor(ee.gz.SHARE)}else{var m,y;null===(m=(y=this.sharingDisplay).restoreContext)||void 0===m||m.call(y)}else(0,ie.r1)("JsMediaSDK_SharingRender error, display is null")},me.prototype.setOnlyAcceptUISize=function(e){this.bOnlyAcceptUISize=e},me.prototype.updateOffscreenCanvasSize=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.bOnlyAcceptUISize&&!r)return console.log("drop logic w/h");try{var n=this.sharingDisplay.getAttachedCanvas();n&&n instanceof OffscreenCanvas?(n.width=e,n.height=t):this.sharingDisplay.resizeCanvasTo(e,t),this.brefresh=!0}catch(e){this.Log_Error("Error updating OffscreenCanvas size",e)}},me.prototype.Set_Render_Display=function(e){this.sharingDisplay=e},me.prototype.Change_Current_SSRC=function(e,t){this.currentshareactive=e,this.currentSharingHeight=0,this.currentSharingWidth=0,this.currentSharingLogicHeight=0,this.currentSharingLogicWidth=0,this.isFromMainSession=t,this.firstFrameForIOS=!1,this.ClearQueue()},me.prototype.Set_WaterMark_Info=function(e){var t=e.waterMarkCanvas,r=e.isCreateSharingWaterMark,n=e.sharingWaterMarkName,i=e.watermarkOpacity,a=e.watermarkRepeated,o=e.watermarkPosition;r||(this.SharingCanvasSizeInfo=null),this.Replace_WaterMark_Canvas(t),this.isCreateSharingWaterMark=r,this.sharingWaterMarkName=n,void 0!==a&&(this.isWaterMarkRepeatedEnable=!!a),void 0!==i&&(this.waterMarkOpacity=i),void 0!==o&&(this.watermarkPosition=o)},me.prototype.Replace_WaterMark_Canvas=function(e){this.waterMarkCanvas=e},me.prototype.Set_WaterMark_Flag=function(e){this.sharingDisplay.setWatermarkFlag(e?1:0)},me.prototype.Should_Watermark_Repeated=function(e,t){return this.isWaterMarkRepeatedEnable&&e>306&&t>202};var ye=function(e,t){if(e<640&&e){var r=640/e;e=640,t=Math.round(t*r)}return{width:e,height:t}};me.prototype.Update_Display_Watermark=function(e,t,r){if(!("function"==typeof OffscreenCanvas&&this.waterMarkCanvas instanceof OffscreenCanvas&&OffscreenCanvasRenderingContext2D)||OffscreenCanvasRenderingContext2D.prototype.measureText){var n=t<512||r<288?16:this.watermarkPosition,i=this.Should_Watermark_Repeated(t,r),a=ye(t,r);t=a.width,r=a.height;var o=i?this.WaterMarkRGBA.Get_Repeated_WaterMarkRGBA({canvas:this.waterMarkCanvas,name:this.sharingWaterMarkName,width:t,height:r,opacity:this.waterMarkOpacity,position:n}):this.WaterMarkRGBA.Get_WaterMarkRGBA({canvas:this.waterMarkCanvas,name:this.sharingWaterMarkName,width:t,height:r,opacity:this.waterMarkOpacity,position:n});e.updateWatermark(t,r,o)}},me.prototype.Should_Update_Watermark=function(e,t,r){if(!this.isCreateSharingWaterMark)return!1;var n=!1,i=ye(t,r);i.width===e.getWatermarkWidth()&&i.height===e.getWatermarkHeight()||(n=!0);var a=this.Should_Watermark_Repeated(t,r);e.isSetWatermark()||(n=!0),a!==e.isWatermarkRepeated()&&(n=!0,e.setWatermarkRepeated(a)),this.waterMarkOpacity&&this.waterMarkOpacity!==e.getWatermarkOpacity()&&(n=!0,e.setWatermarkOpacity(this.waterMarkOpacity));var o=t<512||r<288?16:this.watermarkPosition;return o!==e.getWatermarkPosition()&&(n=!0,e.setWatermarkPosition(o)),n},me.prototype.Update_Sharing_Canvas_Size=function(e){var t=e.width,r=e.height;this.SharingCanvasSizeInfo={width:Math.round(t),height:Math.round(r)}},me.prototype.ClearQueue=function(){try{var e,t=A(this.sharingQueue.ssrcQueueMap);try{for(t.s();!(e=t.n()).done;)for(var r=v(e.value,2),n=(r[0],r[1]);!n.isEmpty();){var i=n.dequeue();i.yuvdata&&i.yuvdata instanceof ie.Tm&&i.yuvdata.recycle(),i.dataptr&&Module._free(i.dataptr)}}catch(e){t.e(e)}finally{t.f()}}catch(e){this.Log_Error("Exception from SharingRender.ClearQueue",e)}this.sharingQueue&&this.sharingQueue.ClearQueue(),this.mouseQueue&&this.mouseQueue.ClearQueue(),this.currentSharingHeight=0,this.currentSharingWidth=0,this.currentSharingLogicHeight=0,this.currentSharingLogicWidth=0},me.prototype.Get_Decoded_Sharing_Frame=function(e,t){if(!this.sharingQueue)return null;var r=this.GetLogicalSSRCPart(e,t),n=this.sharingQueue.GetQueue(r);return n?n.dequeue():null},me.prototype.Get_Decoded_Mouse_Frame=function(e,t){if(this.mouseQueue){var r=this.GetLogicalSSRCPart(e,t),n=this.mouseQueue.GetQueue(r);return n?n.dequeue():null}},me.prototype.Put_Sharing_Data_From_Queue=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;if(this.sharingQueue){var r=this.GetLogicalSSRCPart(e.ssrc,e.isFromMainSession);this.firstFrameForIOS||r!=this.currentshareactive>>10||(this.firstFrameForIOS=!0,this.Notify_APPUI?this.Notify_APPUI(p.jhI,this.currentshareactive):postMessage({status:te.Vd,ssrc:this.currentshareactive}));var n=this.sharingQueue.GetQueue(r);n||(n=this.sharingQueue.AddQueue(r)),n.enqueue(e),this.lfTimeStamp&&(this.sharingFps?this.sharingFps=500/(e.ntptime-this.lfTimeStamp)+this.sharingFps/2:this.sharingFps=1e3/(e.ntptime-this.lfTimeStamp)),this.sharingFps!=1/0&&this.sharingFps||(this.sharingFps=20),this.lfTimeStamp=e.ntptime;var i=this.sharingQueue.GetQueueLength(r)-t;for(this.maxQueueLength=t;i>=0;){var a=this.Get_Decoded_Sharing_Frame(e.ssrc,e.isFromMainSession);a.yuvdata instanceof ie.Tm&&a.yuvdata.recycle(),a.dataptr&&Module._free(a.dataptr),i--}}},me.prototype.Get_Current_QueueLength=function(){if(this.sharingQueue){var e=this.currentshareactive,t=this.GetLogicalSSRCPart(e,this.isFromMainSession);return this.sharingQueue.GetQueueLength(t)}},me.prototype.Put_Mouse_Data_Into_Queue=function(e){if(this.mouseQueue){var t=this.GetLogicalSSRCPart(e.ssrc,e.isFromMainSession),r=this.mouseQueue.GetQueue(t);r||(r=this.mouseQueue.AddQueue(t)),r.enqueue(e);for(var n=this.mouseQueue.GetQueueLength(t)-10;n>=0;)this.Get_Decoded_Mouse_Frame(e.ssrc,e.isFromMainSession),n--}},me.prototype.GetLogicalSSRCPart=function(e,t){var r=e>>10;return t&&(r|=1<<23),r},me.prototype.SetcATimeStamp=function(e){this.cATimeStamp=e,this.asTime=performance.now()},me.prototype.Log_Error=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.globalTracingLogger?this.globalTracingLogger.error(e,t):(0,ie.r1)(e,t)},me.prototype.Log_DT=function(e){this.globalTracingLogger?this.globalTracingLogger.directReport(e):(0,ie.fn)(e)},me.prototype.setMode=function(e){this.Stop_Draw2(),this.renderMode=e},me.prototype.Start_Draw2=function(e){var t,r=this;null===(t=this.statisticObj)||void 0===t||t.start(),this.renderMode?(this.SharingRenderInterval&&(clearInterval(this.SharingRenderInterval),this.SharingRenderInterval=0),this.SharingRenderInterval=setInterval((function(){r.No_Bindthis_Interval()}),20)):(this.Start_Draw(),this.startRAFHealthCheck())},me.prototype.Stop_Draw2=function(e){var t;null===(t=this.statisticObj)||void 0===t||t.stop(),this.renderMode?this.SharingRenderInterval&&(clearInterval(this.SharingRenderInterval),this.SharingRenderInterval=0):(this.Stop_Draw(),this.stopRAFHealthCheck())},me.prototype.startRAFHealthCheck=function(){var e=this;this.RAFLastTime=performance.now(),this.RAFhealthCheckInterval=setInterval((function(){var t=performance.now();!e.renderMode&&t-e.RAFLastTime>2e3&&(e.Stop_Draw2(),e.setMode(z.hS),e.Start_Draw2(),e.Log_DT("Sharing RAF Failed"))}),2e3)},me.prototype.stopRAFHealthCheck=function(){this.RAFLastTime=0,this.RAFhealthCheckInterval&&clearInterval(this.RAFhealthCheckInterval)},me.prototype.reDraw=function(){this.brefresh=!0,this.JsMediaSDK_SharingRender()},me.prototype.getUserIdVideo=function(e,t){if(this.currentshareactive>>10!=e>>10||!this.sharingDisplay)return null;var r=this.sharingDisplay.getAttachedCanvas();if(!r)return null;var n=this.sharingDisplay.getCanvasId(),i=r.width,a=r.height;return{canvasId:n,canvas:r,options:{x:0,y:0,width:i,height:a,displayWidth:i,displayHeight:a}}};var _e=me;function Se(e,t){var r=Math.pow(10,t);return Math.floor(e*r)/r}function Ae(e,t){var r=Math.pow(10,t);return Math.ceil(e*r)/r}var be=r(9415);function Ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ke(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(r),!0).forEach((function(t){(0,i.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ee(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ce=new Map,we=[];function Te(e){e.preventDefault()}function Re(e,t,r,n,i,a,o){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.canvasElement=e,this.canvasID=t,this.contextOptions=i,this.textureindex=r||0,this.texturestride=this.textureindex?3:o?4:6,this.initmask=o||!1,this.reuse=!1,this.isEnableCanvasAlphaChannel=s,Re.prototype.ROTATION_CLOCK0=0,Re.prototype.ROTATION_CLOCK90=1,Re.prototype.ROTATION_CLOCK180=2,Re.prototype.ROTATION_CLOCK270=3,this.webGLResources=a,a||(this.initContextGL(),this.contextGL&&(this.webGLContextLostProtect(),this.contextGL.isContextLost()&&this.restoreContext())),this.reinit(a);var u=new ArrayBuffer(4);this.dummpyCursor=new Uint8Array(u),this.dummpyWaterMark=new Uint8Array(u),this.cursorWidth=0,this.cursorHeight=0,this.hasCursor=0,this.hasWaterMark=0,this.watermarkOpacity=.15,this.watermarkData=null,this.watermarkWidth=0,this.watermarkHeight=0,this.isMultiView=!1,this.hasWholeFrame=0,this.croppingParams={},this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.width=0,this.croppingParams.height=0,this.textureWidth=0,this.textureHeight=0,this.canvasWidth=0,this.canvasHeight=0,this.picRotation=-1,this.bgColor=[0,0,0],this.cx=0,this.cy=0,this.cw=0,this.ch=0,this.colorRange=-1,this.videoMode=z.kh,this.rotation=this.ROTATION_CLOCK0,this.fillMode=0,this.fillModeForResolution=0,this.viewPostion=null,this.enable_rounded_corner=0,this.radius_lt_x=0,this.radius_lt_y=0,this.radius_lb_x=0,this.radius_lb_y=0,this.radius_rt_x=0,this.radius_rt_y=0,this.radius_rb_x=0,this.radius_rb_y=0,this.aa_width=ee.ru,this.viewport_rect=null}Re.prototype.reinit=function(e){if(this.webGLResources=e,!this.contextGL||this.contextGL.isContextLost()||this.contextGL.glInitSucceed||this.webGLResources){if(this.webGLResources&&this.webGLResources.contextgl&&!this.webGLResources.contextgl.isContextLost()){this.contextGL=this.webGLResources.contextgl,this.shaderProgram=this.webGLResources.program,this.waterMarkTextureRef=this.webGLResources.waterMarkTextureRef,this.repeatedWaterMarkTextureRef=this.webGLResources.repeatedWaterMarkTextureRef,this.initTextures(!1),this.vertexPosBuffer=this.webGLResources.vBuffer,this.texturePosBuffer=this.webGLResources.tBuffer;var t=this.contextGL.getError();this.contextGL.glInitSucceed=t!=this.contextGL.NO_ERROR&&t!=this.contextGL.CONTEXT_LOST_WEBGL?0:1}}else{this.initProgram(),this.initmask?this.initTextures(!1):this.initTextures(!0),this.initBuffers();var r=this.contextGL.getError();this.contextGL.glInitSucceed=r!=this.contextGL.NO_ERROR&&r!=this.contextGL.CONTEXT_LOST_WEBGL?0:1}},Re.prototype.webGLContextLostSimulate=function(){var e="undefined"==typeof window?self:window;e.webGLEXTSimulate=e.webGLEXTSimulate||[],e.webGLEXTSimulate.push((0,ie.px)(this.contextGL,"WEBGL_lose_context"))},Re.prototype.restoreContext=function(){if(this.contextGL)try{var e,t;null!==(e=this.canvasElement)&&void 0!==e&&e.loseContextExtension&&!this.canvasElement.restoreTimeoutId&&this.contextGL.isContextLost()&&(this.canvasElement.restoreTimeoutId=setTimeout((function(){(0,ie.S_)("WebGLRestoreTimeout")}),1500),null===(t=this.canvasElement)||void 0===t||t.loseContextExtension.restoreContext())}catch(e){(0,ie.Yd)("webgl restoreContext exception",e)}},Re.prototype.webgGLContextLostCallback=function(e){(0,ie.fn)("webglcontextlost event: canvas listener size=".concat(we.length,",  canvas id: ").concat(this.canvasID,", , ids:").concat(we.join())),e.preventDefault(),this.contextGL.glInitSucceed=0,this.contextOptions&&this.contextOptions.webglcontextlostCallback&&this.contextOptions.webglcontextlostCallback(e,this.contextOptions.params)},Re.prototype.removeEventListener=function(e,t){if(e&&t){e.restoreTimeoutId&&(clearTimeout(e.restoreTimeoutId),e.restoreTimeoutId=void 0),e.removeEventListener("webglcontextlost",t.contextLostHandler),e.removeEventListener("webglcontextrestored",t.contextRestoredHandler);var r=we.indexOf(this.canvasID);we.splice(r,1),Ce.delete(e)}},Re.prototype.webGLContextRestoredCallback=function(e){(0,ie.fn)("webglcontextrestored event from canvas id: ".concat(this.canvasID)),this.canvasElement.restoreTimeoutId&&(clearTimeout(this.canvasElement.restoreTimeoutId),this.canvasElement.restoreTimeoutId=void 0),this.reinit(),this.contextOptions&&this.contextOptions.webglcontextrestoredCallback&&this.contextOptions.webglcontextrestoredCallback(e,this.contextOptions.params)},Re.prototype.webGLContextLostProtect=function(){this.canvasElement&&!this.canvasElement.loseContextExtension&&(this.canvasElement.loseContextExtension=(0,ie.px)(this.contextGL,"WEBGL_lose_context"));var e=this.canvasElement,t=Ce.get(e);t&&this.removeEventListener(e,t),Ce.set(e,this),this.contextLostHandler=this.webgGLContextLostCallback.bind(this),this.contextRestoredHandler=this.webGLContextRestoredCallback.bind(this),e.addEventListener("webglcontextlost",this.contextLostHandler,{capture:!1}),e.addEventListener("webglcontextrestored",this.contextRestoredHandler,{capture:!1}),-1===we.indexOf(this.canvasID)&&(we.push(this.canvasID),we.length>4&&(0,ie.fn)("webglcanvas listener size=".concat(we.length,", ids:").concat(we.join())))},Re.prototype.isWebGL=function(){return this.contextGL},Re.prototype.isAvaiable=function(){return this.contextGL&&!this.contextGL.isContextLost()&&this.contextGL.glInitSucceed},Re.prototype.initContextGL=function(){for(var e,t,r,n=this.canvasElement,i=null,a=["webgl","experimental-webgl","moz-webgl","webkit-3d"],o=0;!i&&o<a.length;){var s=a[o];try{if((0,be.B)().config.isEnableCanvasCtxOptionsOpt()){var u={depth:!1,stencil:!1,antialias:!1,alpha:this.isEnableCanvasAlphaChannel};if(this.contextOptions){var c=ke(ke({},this.contextOptions),u);i=n.getContext(s,c)}else i=n.getContext(s,u)}else i=this.contextOptions?n.getContext(s,this.contextOptions):n.getContext(s)}catch(e){i=null}i&&"function"==typeof i.getParameter||(i=null),++o}if(this.contextGL=i,!i||i.isContextLost())return(0,ie.Yd)("Failed when trying to get WebGLContext on canvas(".concat(null===(e=this.canvasElement)||void 0===e?void 0:e.width,",").concat(null===(t=this.canvasElement)||void 0===t?void 0:t.height,"), gl=").concat(i,", lost=").concat(null===(r=i)||void 0===r?void 0:r.isContextLost())),void(0,ie.S_)("InitWebGLFail");i.glInitSucceed=0},Re.prototype.initProgram=function(){var e=this.contextGL,t=e.createShader(e.VERTEX_SHADER);e.shaderSource(t,"\n    attribute vec4 vertexPos;\n    attribute vec4 texturePos;\n    attribute vec4 masktexturePos;\n    varying vec2 textureCoord;\n    varying vec2 masktextureCoord;\n\n    void main() {\n        gl_Position = vertexPos;\n        textureCoord = texturePos.xy;\n        masktextureCoord = masktexturePos.xy;\n    }\n  "),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||e.isContextLost()||(0,ie.fn)("webgl Vertex shader failed to compile: "+e.getShaderInfoLog(t));var r=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(r,"\n    precision highp float;\n    varying highp vec2 textureCoord;\n    varying highp vec2 masktextureCoord;\n    \n    uniform sampler2D ySampler;\n    uniform sampler2D uSampler;\n    uniform sampler2D vSampler;\n    uniform sampler2D cursorSampler;\n    uniform sampler2D waterMarkSampler;\n    uniform sampler2D previewVideoSampler;\n    uniform sampler2D maskSampler;\n    \n    uniform vec4 cursorInfo;\n    uniform int onlyRGBA;\n    uniform int bgraMode;\n    uniform int colorRange;\n    uniform int waterMarkFlag;\n    uniform int cursorFlag;\n    uniform int yuvmode;\n    \n    const int MAX_ELLIPSE_COUNT = 10;\n    uniform int maskFlag;                       // 0: mask disabled; 1: mask enabled;\n    uniform int maskMode;                       // 0: static mask; 1: dynamic mask;\n    uniform vec4 uEllipses[MAX_ELLIPSE_COUNT];  // each ellipse contains (cx, cy, rx, ry) 4-coords\n    uniform int uEllipseCount;                  // how many ellipses will draw\n\n    // rounded corner feature in gl shader\n    uniform float u_enable_rounded_corner;\n    uniform float u_radius_lt_x;\n    uniform float u_radius_lt_y;\n    uniform float u_radius_lb_x;\n    uniform float u_radius_lb_y;\n    uniform float u_radius_rt_x;\n    uniform float u_radius_rt_y;\n    uniform float u_radius_rb_x;\n    uniform float u_radius_rb_y;\n    uniform float u_aa_width;\n    uniform vec4 u_viewport_rect;\n\n    const mat4 YUV2RGB_L = mat4(\n      1.1643828125, 0, 1.59602734375, -0.87078515625,\n      1.1643828125, -0.39176171875, -0.81296875, 0.52959375,\n      1.1643828125, 2.017234375, 0, -1.081390625,\n      0, 0, 0, 1\n    );\n\n    const mat4 YUV2RGB_F = mat4(\n      1.0, 0, 1.402, -0.701,\n      1.0, -0.34413, -0.71414, 0.529135,\n      1.0, 1.772, 0, -0.886,\n      0, 0, 0, 1\n    );\n\n    void main(void) {\n      vec4 c;\n      if (waterMarkFlag != 1) {\n        if (onlyRGBA == 0) {\n          highp float y = texture2D(ySampler, textureCoord).r;\n          highp float u;\n          highp float v;\n\n          if (yuvmode == 1) {\n            u = texture2D(uSampler, textureCoord).r;\n            v = texture2D(vSampler, textureCoord).r;\n          } else {\n            u = texture2D(uSampler, textureCoord).r;\n            v = texture2D(uSampler, textureCoord).a;\n          }\n\n          if (colorRange == 0) {\n            c = vec4(y, u, v, 1) * YUV2RGB_L;\n          } else {\n            c = vec4(y, u, v, 1) * YUV2RGB_F;\n          }\n\n          if (cursorFlag == 1) {\n            if (cursorInfo.z > 0.0 && \n                textureCoord.x >= cursorInfo.x && \n                textureCoord.y >= cursorInfo.y && \n                textureCoord.x < cursorInfo.x + cursorInfo.z && \n                textureCoord.y < cursorInfo.y + cursorInfo.w) {\n              \n              vec2 cursorCoord = textureCoord - cursorInfo.xy;\n              cursorCoord /= cursorInfo.zw;\n              vec4 cursor = texture2D(cursorSampler, cursorCoord);\n              c = c * (1.0 - cursor.a) + cursor * cursor.a;\n            }\n          }\n        } else {\n          c = texture2D(previewVideoSampler, textureCoord);\n          if (bgraMode == 1) {\n            c = vec4(c.b, c.g, c.r, c.a);\n          }\n        }\n      } else {\n        c = texture2D(waterMarkSampler, textureCoord);\n        if (c.r == 0.0 && c.g == 0.0 && c.b == 0.0) {\n          c.a = 0.0;\n        }\n      }\n\n      if (maskFlag == 1 && waterMarkFlag != 1) {\n        vec4 mask = texture2D(maskSampler, masktextureCoord);\n        if (maskMode == 0) {\n          // -- handle static mask --\n          if (mask.r != 0.0 || mask.g != 0.0 || mask.b != 0.0) {\n            c = mask * mask.a + c * (1.0 - mask.a);\n          }\n        } else if (maskMode == 1) {\n          // -- handle dynamic mask -- \n          bool inEllipse = false; // variable for checking whether the pixel to be drawn hits ellipse\n          for (int i = 0; i < MAX_ELLIPSE_COUNT; i++) {\n            if (i > uEllipseCount) break;\n\n            vec2 ellipseCenter = uEllipses[i].xy;\n            vec2 ellipseRadii = uEllipses[i].zw;\n            vec2 ellipsePos = masktextureCoord - ellipseCenter;\n\n            float ellipseEq = (ellipsePos.x * ellipsePos.x) / (ellipseRadii.x * ellipseRadii.x) + \n                              (ellipsePos.y * ellipsePos.y) / (ellipseRadii.y * ellipseRadii.y);\n            if (ellipseEq <= 1.0) {\n              // the pixel in the ellipse range\n              inEllipse = true;\n              break;\n            }\n          }\n\n          if (inEllipse) {\n            c = mask * mask.a + c * (1.0 - mask.a);\n          }\n        }\n      }\n\n      if (waterMarkFlag != 1) {\n        c.a = 1.0;\n      }\n\n      if (u_enable_rounded_corner < 0.5) {\n        gl_FragColor = c;\n        return;\n      }\n\n      // step 1: viewport coordinate mapping\n      // convert the fragment coordinate(canvas coordinate) to the viewport coordinate\n      // for example, a viewport={x: 100, y: 100, w: 200, h: 160}, a fragCoord.xy={x:120, y: 120}\n      // we can get the pos={x: 20, y: 20}\n      vec2 pos = gl_FragCoord.xy - u_viewport_rect.xy;\n      vec2 viewportSize = u_viewport_rect.zw;\n\n      // convert the normalized radius to pixel value\n      float r_lt_x = u_radius_lt_x * viewportSize.x;\n      float r_lt_y = u_radius_lt_y * viewportSize.y;\n      float r_rt_x = u_radius_rt_x * viewportSize.x;\n      float r_rt_y = u_radius_rt_y * viewportSize.y;\n      float r_lb_x = u_radius_lb_x * viewportSize.x;\n      float r_lb_y = u_radius_lb_y * viewportSize.y;\n      float r_rb_x = u_radius_rb_x * viewportSize.x;\n      float r_rb_y = u_radius_rb_y * viewportSize.y;\n\n      // step 2: calculate the rounded corner mask (as alpha)\n      float alpha = 1.0;\n\n      // --- calculation of the left-top corner ---\n      // Condition: if (pos.x < r_lt_x && pos.y < r_lt_y)\n      float in_lt = (1.0 - step(r_lt_x, pos.x)) * (1.0 - step(r_lt_y, pos.y));\n      // the circle center of the left-top corner in pixel coordinate\n      vec2 center_lt = vec2(r_lt_x, r_lt_y);\n      // calculate and normalize the distance between the fragment and the center\n      vec2 diff_lt = (pos - center_lt) / vec2(r_lt_x, r_lt_y);\n      float normDist_lt = length(diff_lt);\n      // smoothstep function is used to calculate the alpha value\n      float mask_lt = 1.0 - smoothstep(1.0 - u_aa_width, 1.0, normDist_lt);\n      float final_lt = mix(1.0, mask_lt, in_lt);\n\n      // --- calculation of the right-top corner ---\n      float in_rt = (1.0 - step(r_rt_x, viewportSize.x - pos.x)) * (1.0 - step(r_rt_y, pos.y));\n      vec2 center_rt = vec2(viewportSize.x - r_rt_x, r_rt_y);\n      vec2 diff_rt = (pos - center_rt) / vec2(r_rt_x, r_rt_y);\n      float normDist_rt = length(diff_rt);\n      float mask_rt = 1.0 - smoothstep(1.0 - u_aa_width, 1.0, normDist_rt);\n      float final_rt = mix(1.0, mask_rt, in_rt);\n\n      // --- calculation of the left-bottom corner ---\n      float in_lb = (1.0 - step(r_lb_x, pos.x)) * (1.0 - step(r_lb_y, viewportSize.y - pos.y));\n      vec2 center_lb = vec2(r_lb_x, viewportSize.y - r_lb_y);\n      vec2 diff_lb = (pos - center_lb) / vec2(r_lb_x, r_lb_y);\n      float normDist_lb = length(diff_lb);\n      float mask_lb = 1.0 - smoothstep(1.0 - u_aa_width, 1.0, normDist_lb);\n      float final_lb = mix(1.0, mask_lb, in_lb);\n\n      // --- calculation of the right-bottom corner ---\n      float in_rb = (1.0 - step(r_rb_x, viewportSize.x - pos.x)) * (1.0 - step(r_rb_y, viewportSize.y - pos.y));\n      vec2 center_rb = vec2(viewportSize.x - r_rb_x, viewportSize.y - r_rb_y);\n      vec2 diff_rb = (pos - center_rb) / vec2(r_rb_x, r_rb_y);\n      float normDist_rb = length(diff_rb);\n      float mask_rb = 1.0 - smoothstep(1.0 - u_aa_width, 1.0, normDist_rb);\n      float final_rb = mix(1.0, mask_rb, in_rb);\n\n      // Get the minimum value from the four corners (to ensure that if any corner requires transparency it is applied)\n      float finalAlpha = min(min(final_lt, final_rt), min(final_lb, final_rb));\n\n      // Final output color\n      gl_FragColor = vec4(c.rgb, c.a * finalAlpha);\n    }\n"),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)||e.isContextLost()||(0,ie.fn)("webgl Fragment shader failed to compile: "+e.getShaderInfoLog(r));var n=e.createProgram();e.attachShader(n,t),e.attachShader(n,r),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)||e.isContextLost()||(0,ie.fn)("webgl Program failed to compile: "+e.getProgramInfoLog(n)),e.useProgram(n),this.shaderProgram=n},Re.prototype.initBuffers=function(){var e=this.contextGL,t=this.shaderProgram,r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1,1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var n=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),this.vertexPosBuffer=r;var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1,1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var a=e.getAttribLocation(t,"texturePos");if(e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),this.initmask&&!this.masktexturePosBuffer){var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var s=e.getAttribLocation(t,"masktexturePos");e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),this.masktexturePosBuffer=o}this.texturePosBuffer=i},Re.prototype.initTextures=function(e){var t=this.contextGL,r=this.shaderProgram;t.pixelStorei(t.UNPACK_ALIGNMENT,1);var n=this.initTexture();this.yTextureRef=n,this.oyTextureRef=n;var i=this.initTexture();this.uTextureRef=i,this.ouTextureRef=i;var a=this.initTexture();if(this.vTextureRef=a,this.ovTextureRef=a,e){this.BindTextures(z.Wp);var o=this.initTexture(),s=t.getUniformLocation(r,"cursorSampler");t.uniform1i(s,this.textureindex*this.texturestride+3),this.cursorTextureRef=o;var u=this.initTexture(),c=t.getUniformLocation(r,"waterMarkSampler");t.uniform1i(c,4),this.waterMarkTextureRef=u;var d=this.initTexture();this.repeatedWaterMarkTextureRef=d;var l=this.initTexture(),h=t.getUniformLocation(r,"previewVideoSampler");t.uniform1i(h,this.textureindex*this.texturestride+5),this.previewVideoTextureRef=l;var f=t.getUniformLocation(r,"cursorInfo");this.cursorInfoRef=f}if(this.initmask){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1);var p=this.initTexture(),v=t.getUniformLocation(r,"maskSampler");t.uniform1i(v,this.textureindex*this.texturestride+6),this.maskTextureRef=p}var g=t.getUniformLocation(r,"colorRange");this.colorRangeRef=g,this.onlyRGBARef=t.getUniformLocation(r,"onlyRGBA"),this.bgraModeRef=t.getUniformLocation(r,"bgraMode"),this.waterMarkFlagRef=t.getUniformLocation(r,"waterMarkFlag"),this.maskFlagRef=t.getUniformLocation(r,"maskFlag"),this.cursorFlagRef=t.getUniformLocation(r,"cursorFlag"),this.yuvmodeRef=t.getUniformLocation(r,"yuvmode"),this.ul_enable_rounded_corner=t.getUniformLocation(r,"u_enable_rounded_corner"),this.ul_radius_lt_x=t.getUniformLocation(r,"u_radius_lt_x"),this.ul_radius_lt_y=t.getUniformLocation(r,"u_radius_lt_y"),this.ul_radius_lb_x=t.getUniformLocation(r,"u_radius_lb_x"),this.ul_radius_lb_y=t.getUniformLocation(r,"u_radius_lb_y"),this.ul_radius_rt_x=t.getUniformLocation(r,"u_radius_rt_x"),this.ul_radius_rt_y=t.getUniformLocation(r,"u_radius_rt_y"),this.ul_radius_rb_x=t.getUniformLocation(r,"u_radius_rb_x"),this.ul_radius_rb_y=t.getUniformLocation(r,"u_radius_rb_y"),this.ul_aa_width=t.getUniformLocation(r,"u_aa_width"),this.ul_viewport_rect=t.getUniformLocation(r,"u_viewport_rect")},Re.prototype.BindTextures=function(e){var t=this.contextGL,r=this.shaderProgram;if(t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.activeTexture(t.TEXTURE0+0),t.bindTexture(t.TEXTURE_2D,this.yTextureRef),t.activeTexture(t.TEXTURE0+1),t.bindTexture(t.TEXTURE_2D,this.uTextureRef),t.activeTexture(t.TEXTURE0+2),t.bindTexture(t.TEXTURE_2D,this.vTextureRef),e==z.Wp){var n=t.getUniformLocation(r,"ySampler");t.uniform1i(n,0);var i=t.getUniformLocation(r,"uSampler");t.uniform1i(i,1);var a=t.getUniformLocation(r,"vSampler");t.uniform1i(a,2)}else if(this.isRGBAMode(e)){var o=t.getUniformLocation(r,"previewVideoSampler");t.uniform1i(o,0);var s=t.getUniformLocation(r,"ySampler");t.uniform1i(s,0);var u=t.getUniformLocation(r,"uSampler");t.uniform1i(u,0);var c=t.getUniformLocation(r,"vSampler");t.uniform1i(c,0)}else if(e==z.pn){var d=t.getUniformLocation(r,"ySampler");t.uniform1i(d,0);var l=t.getUniformLocation(r,"uSampler");t.uniform1i(l,1);var h=t.getUniformLocation(r,"vSampler");t.uniform1i(h,0)}var f=t.getUniformLocation(r,"previewVideoSampler");t.uniform1i(f,0);var p=t.getUniformLocation(r,"maskSampler");this.initmask?(t.activeTexture(t.TEXTURE0+6),t.bindTexture(t.TEXTURE_2D,this.maskTextureRef),t.uniform1i(p,6)):t.uniform1i(p,0);var v=t.getUniformLocation(r,"cursorSampler");t.uniform1i(v,0);var g=t.getUniformLocation(this.shaderProgram,"waterMarkSampler");t.uniform1i(g,0)},Re.prototype.initTexture=function(){var e=this.contextGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t},Re.prototype.clearDisplay=function(){var e=this.contextGL;e&&(e.enable(e.BLEND),e.blendFunc(e.ZERO,e.ZERO)),this.render()},Re.prototype.cleanup=function(){var e=this.canvasElement,t=Ce.get(e);if(t&&this.removeEventListener(e,t),e.defaultContextLostHandler||(e.defaultContextLostHandler=Te,e.addEventListener("webglcontextlost",Te,{capture:!1})),this.cleanupRoundedCornerRadius(),this.isAvaiable()){var r=this.contextGL;r.deleteProgram(this.program),r.activeTexture(r.TEXTURE0+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE1+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE2+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),this.textureindex||this.initmask||(r.activeTexture(r.TEXTURE3+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE4+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(this.getRepeatedWatermarkTextureValue(r)),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE5+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null)),r.bindBuffer(r.ARRAY_BUFFER,null),r.deleteTexture(this.yTextureRef),r.deleteTexture(this.uTextureRef),r.deleteTexture(this.vTextureRef),this.textureindex||this.initmask||(r.deleteTexture(this.cursorTextureRef),r.deleteTexture(this.waterMarkTextureRef),r.deleteTexture(this.repeatedWaterMarkTextureRef),r.deleteTexture(this.previewVideoTextureRef),r.deleteBuffer(this.vertexPosBuffer),r.deleteBuffer(this.texturePosBuffer)),this.maskTextureRef&&r.deleteTexture(this.maskTextureRef),this.masktexturePosBuffer&&r.deleteBuffer(this.masktexturePosBuffer),r.glInitSucceed=0}},Re.prototype.drawNextOutputPicture=function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.contextGL?this.drawNextOutputPictureFrame(e,t,r,n,i):this.drawNextOuptutPictureRGBA(e,t,r,n)},Re.prototype.updateVertexInfoForMultiView=function(e,t,r,n,i){var a,o,s,u,c=this.contextGL;if(this.isUseFillMode({width:r,height:n,rotation:i}))a=0,o=0,s=1,u=1;else{var d=i==this.ROTATION_CLOCK90||i==this.ROTATION_CLOCK270?n:r,l=i==this.ROTATION_CLOCK90||i==this.ROTATION_CLOCK270?r:n,h=d/l*t;h>e?(a=0,s=1,u=1-(o=(t-l/d*e)/2/t)):(o=0,u=1,s=1-(a=(e-h)/2/e))}a=2*a-1,s=2*s-1,o=1-2*o,u=1-2*u;var f=new Float32Array([s,o,a,o,s,u,a,u,1,1,-1,1,1,-1,-1,-1]);this.viewPostion=f,c.bindBuffer(c.ARRAY_BUFFER,this.vertexPosBuffer),c.bufferData(c.ARRAY_BUFFER,f,c.DYNAMIC_DRAW)},Re.prototype.getViewPosition=function(){var e=[0,0,1,1];if(!this.viewPostion)return e;var t=this.viewPostion[0],r=this.viewPostion[1],n=this.viewPostion[2],i=this.viewPostion[5];return e[0]=(1-r)/2,e[1]=(1+n)/2,e[2]=(1-i)/2,e[3]=(1+t)/2,e},Re.prototype.updateTextureInfo=function(e,t,r,n,i){var a=e.contextGL,o=n.top/r,s=n.left/t,u=o+(n.height-1)/r,c=s+n.width/t,d=[s,o,c,o,c,u,s,u];i==e.ROTATION_CLOCK90&&(d.unshift(d[6],d[7]),d=d.slice(0,8)),i==e.ROTATION_CLOCK180&&(d.unshift(d[4],d[5],d[6],d[7]),d=d.slice(0,8)),i==e.ROTATION_CLOCK270&&(d.push(d[0],d[1]),d=d.slice(2));var l=d[0],h=d[1];d[0]=d[2],d[1]=d[3],d[2]=l,d[3]=h;var f=new Float32Array([].concat(y(d),[1,0,0,0,1,1,0,1]));a.bindBuffer(a.ARRAY_BUFFER,e.texturePosBuffer),a.bufferData(a.ARRAY_BUFFER,f,a.DYNAMIC_DRAW)},Re.prototype.updateTextureInfoForMultiView=function(e,t,r,n,i,a,o){var s,u,c,d,l=this.contextGL;if(this.isUseFillMode({width:r.width,height:r.height,rotation:n})){var h=n==this.ROTATION_CLOCK90||n==this.ROTATION_CLOCK270?o/a:a/o,f=r.left||0,p=r.top||0;if(r.width/r.height>h){var v=r.height*h;s=p/t,u=(Math.round((r.width-v)/2)+f)/e,c=s+(r.height-1)/t,d=u+v/e}else{var g=r.width/h;c=(s=(Math.round((r.height-g)/2)+p)/t)+(g-1)/t,d=(u=f/e)+r.width/e}}else s=Ae(r.top/t,2),u=Ae(r.left/e,2),c=Se((r.top+r.height-1)/t,2),d=Se((r.width-1+r.left)/e,2);var m=[u,s,d,s,d,c,u,c];n==this.ROTATION_CLOCK90&&(m.unshift(m[6],m[7]),m=m.slice(0,8)),n==this.ROTATION_CLOCK180&&(m.unshift(m[4],m[5],m[6],m[7]),m=m.slice(0,8)),n==this.ROTATION_CLOCK270&&(m.push(m[0],m[1]),m=m.slice(2,10));var _=m[0],S=m[1];if(m[0]=m[2],m[1]=m[3],m[2]=_,m[3]=S,i)if(n==this.ROTATION_CLOCK90||n==this.ROTATION_CLOCK270){var A=m[1];m[1]=m[3],m[3]=A,A=m[5],m[5]=m[7],m[7]=A}else m[0]=1-m[0],m[2]=1-m[2],m[4]=1-m[4],m[6]=1-m[6];var b=new Float32Array([].concat(y(m),[1,0,0,0,1,1,0,1]));l.bindBuffer(l.ARRAY_BUFFER,this.texturePosBuffer),l.bufferData(l.ARRAY_BUFFER,b,l.DYNAMIC_DRAW)},Re.prototype.drawNextOutputPictureFrame=function(e,t,r,n,i){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];if(this.isAvaiable()){var u=this.contextGL,c=(this.texturePosBuffer,this.yTextureRef),d=this.uTextureRef,l=this.vTextureRef;u.enable(u.BLEND),u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA),i=i||this.ROTATION_CLOCK0;var h=(r=r||{top:0,left:0,width:e,height:t}).width!=this.croppingParams.width||r.height!=this.croppingParams.height,f=r.top!=this.croppingParams.top||r.left!=this.croppingParams.left,p=u.canvas.width!=this.canvasWidth||u.canvas.height!=this.canvasHeight,v=e!=this.textureWidth||t!=this.textureHeight,g=i!=this.picRotation;(h||p||g)&&function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=e.contextGL,o=a.canvas.width,s=a.canvas.height;i&&(o=i.width,s=i.height);var u,c,d,l,h=n==e.ROTATION_CLOCK90||n==e.ROTATION_CLOCK270?r:t,f=n==e.ROTATION_CLOCK90||n==e.ROTATION_CLOCK270?t:r,p=h/f*s;p>o?(u=0,d=1,l=1-(c=(s-f/h*o)/2/s)):(c=0,l=1,d=1-(u=(o-p)/2/o)),u=2*u-1,d=2*d-1,c=1-2*c,l=1-2*l;var v=new Float32Array([d,c,u,c,d,l,u,l,d,c,u,c,d,l,u,l]);a.bindBuffer(a.ARRAY_BUFFER,e.vertexPosBuffer),a.bufferData(a.ARRAY_BUFFER,v,a.DYNAMIC_DRAW)}(this,r.width,r.height,i,o),(h||f||v||g)&&this.updateTextureInfo(this,e,t,r,i);var m=a?0:1;m!=this.colorRange&&(u.uniform1i(this.colorRangeRef,m),this.colorRange=m),o?(u.viewport(o.x,o.y,o.width,o.height),this.viewport_rect||(this.viewport_rect=new Float32Array(4)),this.viewport_rect.set([o.x,o.y,o.width,o.height],0),u.uniform4fv(this.ul_viewport_rect,this.viewport_rect)):(u.viewport(0,0,u.canvas.width,u.canvas.height),this.viewport_rect||(this.viewport_rect=new Float32Array(4)),this.viewport_rect.set([0,0,u.canvas.width,u.canvas.height],0),u.uniform4fv(this.ul_viewport_rect,this.viewport_rect)),u.uniform1i(this.onlyRGBARef,0),u.uniform1i(this.yuvmodeRef,z.Wp),Object.assign(this.croppingParams,r),this.textureWidth=e,this.textureHeight=t,this.picRotation=i,this.canvasWidth=u.canvas.width,this.canvasHeight=u.canvas.height;var y=n,_=e*t;if(u.activeTexture(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,c),s){var S=y.subarray(0,_);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,e,t,0,u.LUMINANCE,u.UNSIGNED_BYTE,S)}var A=e/2*t/2;if(u.activeTexture(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,d),s){var b=y.subarray(_,_+A);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,e/2,t/2,0,u.LUMINANCE,u.UNSIGNED_BYTE,b)}var E=A;if(u.activeTexture(u.TEXTURE2),u.bindTexture(u.TEXTURE_2D,l),s){var k=y.subarray(_+A,_+A+E);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,e/2,t/2,0,u.LUMINANCE,u.UNSIGNED_BYTE,k)}u.activeTexture(u.TEXTURE3),u.bindTexture(u.TEXTURE_2D,this.cursorTextureRef),this.hasCursor?u.uniform1i(this.cursorFlagRef,1):s&&u.texImage2D(u.TEXTURE_2D,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,this.dummpyCursor),u.uniform4f(this.cursorInfoRef,this.cx,this.cy,this.cw,this.ch),u.activeTexture(u.TEXTURE5),u.bindTexture(u.TEXTURE_2D,this.previewVideoTextureRef),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,this.dummpyWaterMark);var C=u.getUniformLocation(this.shaderProgram,"maskSampler");u.uniform1i(C,5),this.render(),this.hasWholeFrame=1}},Re.prototype.updateTextureBlock=function(e,t,r,n,i){if(this.isAvaiable()){var a=this.contextGL,o=i;if(!(!this.hasWholeFrame||e<=0||t<=0||r<0||n<0||r+e>this.textureWidth||n+t>this.textureHeight)&&i&&i.length==e*t*3/2){var s=this.yTextureRef,u=this.uTextureRef,c=this.vTextureRef,d=e*t,l=o.subarray(0,d);a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,s),a.texSubImage2D(a.TEXTURE_2D,0,r,n,e,t,a.LUMINANCE,a.UNSIGNED_BYTE,l);var h=e/2*t/2,f=o.subarray(d,d+h);a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,u),a.texSubImage2D(a.TEXTURE_2D,0,r/2,n/2,e/2,t/2,a.LUMINANCE,a.UNSIGNED_BYTE,f);var p=h,v=o.subarray(d+h,d+h+p);a.activeTexture(a.TEXTURE2),a.bindTexture(a.TEXTURE_2D,c),a.texSubImage2D(a.TEXTURE_2D,0,r/2,n/2,e/2,t/2,a.LUMINANCE,a.UNSIGNED_BYTE,v)}}},Re.prototype.updateCursor=function(e,t,r){if(this.isAvaiable()){var n=this.contextGL;e<=0||t<=0||!r||r.length!=e*t*4||(n.activeTexture(n.TEXTURE3),n.bindTexture(n.TEXTURE_2D,this.cursorTextureRef),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,t,0,n.RGBA,n.UNSIGNED_BYTE,r),this.cursorWidth=e,this.cursorHeight=t,this.hasCursor=1)}},Re.prototype.updateWatermark=function(e,t,r){this.isAvaiable()&&(this.contextGL,e<=0||t<=0||!r||r.length!=e*t*4||(this.watermarkData=r,this.watermarkWidth=e,this.watermarkHeight=t,this.hasWaterMark=1))},Re.prototype.drawWatermark=function(){if(this.isAvaiable()){var e=this.contextGL;if(this.isSetWatermark()&&this.watermarkData&&this.watermarkWidth&&this.watermarkHeight){e.uniform1i(this.waterMarkFlagRef,1),this.isWatermarkRepeated()?(e.activeTexture(this.getRepeatedWatermarkTextureValue(e)),e.bindTexture(e.TEXTURE_2D,this.repeatedWaterMarkTextureRef)):(e.activeTexture(e.TEXTURE4),e.bindTexture(e.TEXTURE_2D,this.waterMarkTextureRef)),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.watermarkWidth,this.watermarkHeight,0,e.RGBA,e.UNSIGNED_BYTE,this.watermarkData);var t=e.getUniformLocation(this.shaderProgram,"waterMarkSampler");e.uniform1i(t,this.isWatermarkRepeated()?this.getRepeatedWatermarkUniformValue():4),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLE_STRIP,4,4)}}},Re.prototype.drawRoundedCorner=function(){if(this.isAvaiable()){var e=this.contextGL;e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.uniform1f(this.ul_enable_rounded_corner,this.enable_rounded_corner),e.uniform1f(this.ul_radius_lt_x,this.radius_lt_x),e.uniform1f(this.ul_radius_lt_y,this.radius_lt_y),e.uniform1f(this.ul_radius_lb_x,this.radius_lb_x),e.uniform1f(this.ul_radius_lb_y,this.radius_lb_y),e.uniform1f(this.ul_radius_rt_x,this.radius_rt_x),e.uniform1f(this.ul_radius_rt_y,this.radius_rt_y),e.uniform1f(this.ul_radius_rb_x,this.radius_rb_x),e.uniform1f(this.ul_radius_rb_y,this.radius_rb_y),e.uniform1f(this.ul_aa_width,this.aa_width)}},Re.prototype.cleanupRoundedCornerRadius=function(){this.enable_rounded_corner=0,this.radius_lt_x=0,this.radius_lt_y=0,this.radius_lb_x=0,this.radius_lb_y=0,this.radius_rt_x=0,this.radius_rt_y=0,this.radius_rb_x=0,this.radius_rb_y=0,this.aa_width=ee.ru,this.viewport_rect=null},Re.prototype.render=function(){if(this.isAvaiable()){var e=this.contextGL;this.drawRoundedCorner(),e.uniform1i(this.waterMarkFlagRef,0),e.drawArrays(e.TRIANGLE_STRIP,0,4),this.drawWatermark()}},Re.prototype.drawCursor=function(e,t,r,n,i){if(this.isAvaiable()){var a=this.contextGL;if(!(!this.hasWholeFrame||e&&(n<0||i<0))){a.viewport(0,0,a.canvas.width,a.canvas.height);var o=this.yTextureRef,s=this.uTextureRef,u=this.vTextureRef,c=this.cursorTextureRef;if(a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,o),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,s),a.activeTexture(a.TEXTURE2),a.bindTexture(a.TEXTURE_2D,u),a.activeTexture(a.TEXTURE3),a.bindTexture(a.TEXTURE_2D,c),e&&this.hasCursor){var d=t/this.croppingParams.width,l=r/this.croppingParams.height,h=n/this.croppingParams.width,f=i/this.croppingParams.height;this.cx=d,this.cy=l,this.cw=h,this.ch=f,a.uniform4f(this.cursorInfoRef,d,l,h,f)}else a.uniform4f(this.cursorInfoRef,0,0,0,0);this.render()}}},Re.prototype.clear=function(){this.hasWholeFrame=0,this.hasCursor=0,this.cleanupRoundedCornerRadius()},Re.prototype.clearCanvas=function(e){if(this.cleanupRoundedCornerRadius(),this.isAvaiable()){var t=this.contextGL;e?t.clearColor(e.R,e.G,e.B,e.A):t.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),t.clear(t.COLOR_BUFFER_BIT)}},Re.prototype.drawNextOuptutPictureRGBA=function(e,t,r,n){if(this.isAvaiable()){var i=n,a=this.canvasElement.getContext("2d"),o=a.getImageData(0,0,e,t);o.data.set(i),a.putImageData(o,0,0)}},Re.prototype.isRGBAMode=function(e){return-1!==[z.rK,z.hd].indexOf(e)},Re.prototype.updateRemoteVideoTextures=function(e,t,r,n,i){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if(this.isAvaiable()){var s=this.contextGL,u=this.yTextureRef,c=this.uTextureRef,d=this.vTextureRef;s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA);var l=this.isRGBAMode(this.videoMode);if(e<=0||t<=0||!n||!n.length||n.length!=e*t*3/2&&!l||r&&(r.top<0||r.left<0||r.left+r.width>e||r.top+r.height>t))return!1;var h=a?0:1;if(this.colorRange=h,this.rotation=i,Object.assign(this.croppingParams,r),this.textureWidth=e,this.textureHeight=t,this.canvasWidth=s.canvas.width,this.canvasHeight=s.canvas.height,o){if(s.bindTexture(s.TEXTURE_2D,u),!l){var f=n,p=e*t,v=f.subarray(0,p);s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e,t,0,s.LUMINANCE,s.UNSIGNED_BYTE,v);var g=0,m=0;this.videoMode==z.Wp?m=g=e/2*t/2:this.videoMode==z.pn&&(g=e*t/2,m=0);var y=f.subarray(p,p+g);if(s.bindTexture(s.TEXTURE_2D,c),m){s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e/2,t/2,0,s.LUMINANCE,s.UNSIGNED_BYTE,y);var _=f.subarray(p+g,p+g+m);s.bindTexture(s.TEXTURE_2D,d),s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e/2,t/2,0,s.LUMINANCE,s.UNSIGNED_BYTE,_)}else s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE_ALPHA,e/2,t/2,0,s.LUMINANCE_ALPHA,s.UNSIGNED_BYTE,y);return!0}s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,t,0,s.RGBA,s.UNSIGNED_BYTE,n)}}},Re.prototype.updateRemoteVideoTexturesImageBitmap=function(e,t,r,n,i){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(!(e<=0||t<=0)&&r&&this.isAvaiable()){var o=this.contextGL;if(this.textureWidth=e,this.textureHeight=t,Number.isNaN(i)||(this.rotation=i),Object.assign(this.croppingParams,n),a){o.bindTexture(o.TEXTURE_2D,this.yTextureRef);var s=o.RGBA,u=o.RGBA,c=o.UNSIGNED_BYTE;o.texImage2D(o.TEXTURE_2D,0,s,u,c,r)}}},Re.prototype.updateSelfMaskImage=function(e,t,r){if(!(e<=0||t<=0)&&r&&r.length==e*t*4&&this.isAvaiable()){var n=this.contextGL;n.bindTexture(n.TEXTURE_2D,this.maskTextureRef),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,t,0,n.RGBA,n.UNSIGNED_BYTE,r)}},Re.prototype.VideoFlip=function(){if(this.isAvaiable()){var e=this.contextGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1)}},Re.prototype.drawRemoteVideo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isAvaiable()){var r=this.contextGL,n=this.isRGBAMode(this.videoMode)?1:0;r.uniform1i(this.colorRangeRef,this.colorRange),this.setUniformFlag(n,this.hasCursor,this.videoMode),this.initmask&&r.uniform1i(this.maskFlagRef,1),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,t,e.width,e.height),r.viewport(e.x,e.y,e.width,e.height),this.viewport_rect||(this.viewport_rect=new Float32Array(4)),this.viewport_rect.set([e.x,e.y,e.width,e.height],0),r.uniform4fv(this.ul_viewport_rect,this.viewport_rect),this.updateVertexInfoForMultiView(e.width,e.height,this.croppingParams.width,this.croppingParams.height,this.rotation),this.BindTextures(this.videoMode),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),this.render()}},Re.prototype.readPixelsSyncRequest=function(e,t,r,n){if(this.isAvaiable()){var i,a=this.contextGL;return this.destination&&this.destination.length==r*n*4||(this.destination=new Uint8Array(r*n*4)),i=this.destination,a.flush(),a.readPixels(e,t,r,n,a.RGBA,a.UNSIGNED_BYTE,i),i}},Re.prototype.updateSelfVideoTextures=function(e,t,r,n){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(!(e<=0||t<=0)&&r&&r.length%4==0&&this.isAvaiable()){var o=this.contextGL;this.textureWidth=e,this.textureHeight=t,this.rotation=a,Object.assign(this.croppingParams,n),i&&(o.bindTexture(o.TEXTURE_2D,this.yTextureRef),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,e,t,0,o.RGBA,o.UNSIGNED_BYTE,r))}},Re.prototype.drawSelfVideo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.isAvaiable()){var n=this.contextGL;this.setUniformFlag(1,this.hasCursor,this.videoMode),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,r,e.width,e.height),n.viewport(e.x,e.y,e.width,e.height),this.viewport_rect||(this.viewport_rect=new Float32Array(4)),this.viewport_rect.set([e.x,e.y,e.width,e.height],0),n.uniform4fv(this.ul_viewport_rect,this.viewport_rect),t?(n.enable(n.BLEND),n.blendFunc(n.ZERO,n.ZERO),this.updateVertexInfoForMultiView(e.width,e.height,e.width,e.height,this.ROTATION_CLOCK0)):(n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.updateVertexInfoForMultiView(e.width,e.height,this.croppingParams.width,this.croppingParams.height,this.rotation)),this.BindTextures(z.rK),this.render()}},Re.prototype.isSetWatermark=function(){return this.hasWaterMark},Re.prototype.recoverTextures=function(){},Re.prototype.setWatermarkFlag=function(e){this.hasWaterMark=e,e||(this.setWatermarkRepeated(!1),this.setWatermarkOpacity(),this.setWatermarkPosition(16))},Re.prototype.setUniformFlag=function(e,t,r){if(this.isAvaiable()){var n=this.contextGL;n.uniform1i(this.onlyRGBARef,e),n.uniform1i(this.bgraModeRef,e&&r===z.hd?1:0),n.uniform1i(this.cursorFlagRef,t),e||n.uniform1i(this.yuvmodeRef,r)}},Re.prototype.setVideoMode=function(e){this.videoMode=e},Re.prototype.getVideoMode=function(e){return this.videoMode},Re.prototype.setWatermarkRepeated=function(e){this.watermarkRepeated=e},Re.prototype.isWatermarkRepeated=function(){return!!this.watermarkRepeated},Re.prototype.setWatermarkOpacity=function(e){this.watermarkOpacity=e||.15},Re.prototype.getWatermarkOpacity=function(){return this.watermarkOpacity},Re.prototype.setWatermarkPosition=function(e){this.watermarkPosition=e||16},Re.prototype.getWatermarkPosition=function(){return this.watermarkPosition},Re.prototype.setMultiView=function(e){return this.isMultiView=e},Re.prototype.getRepeatedWatermarkUniformValue=function(){return this.isMultiView?30:7},Re.prototype.getRepeatedWatermarkTextureValue=function(e){return this.isMultiView?e.TEXTURE30:e.TEXTURE7},Re.prototype.setFillMode=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.fillMode=e,this.fillModeForResolution=t},Re.prototype.getFillMode=function(){return this.fillMode},Re.prototype.getFillModeForResolution=function(){return this.fillModeForResolution},Re.prototype.getTextureIndex=function(){return this.textureindex},Re.prototype.getTextureWidth=function(){return this.textureWidth},Re.prototype.getTextureHeight=function(){return this.textureHeight},Re.prototype.getRotation=function(){return this.rotation},Re.prototype.getCroppingParams=function(){return this.croppingParams},Re.prototype.getIndex=function(){return this.textureindex},Re.prototype.getWatermarkWidth=function(){return this.watermarkWidth},Re.prototype.getWatermarkHeight=function(){return this.watermarkHeight},Re.prototype.getWatermarkOpacity=function(){return this.watermarkOpacity},Re.prototype.getAttachedCanvas=function(){return this.canvasElement},Re.prototype.getCanvasId=function(){return this.canvasID},Re.prototype.resizeCanvasTo=function(e,t){this.contextGL.canvas.width=e,this.contextGL.canvas.height=t},Re.prototype.isUseFillMode=function(e){var t=e.width,r=e.height,n=e.rotation;if(!this.fillMode)return!1;if(!this.fillModeForResolution)return!0;if(!t||!r)return!1;var i=n===this.ROTATION_CLOCK90||n==this.ROTATION_CLOCK270?r/t:t/r;return(Array.isArray(this.fillModeForResolution)?this.fillModeForResolution:[this.fillModeForResolution]).some((function(e){return Math.abs(i-e)<.01}))},Re.prototype.setRoundedCornerRadius=function(e){console.log("setRoundedCornerRadius() radiusSet:".concat(JSON.stringify(e))),e?(this.radius_lt_x=e.radius_lt_x,this.radius_lt_y=e.radius_lt_y,this.radius_lb_x=e.radius_lb_x,this.radius_lb_y=e.radius_lb_y,this.radius_rt_x=e.radius_rt_x,this.radius_rt_y=e.radius_rt_y,this.radius_rb_x=e.radius_rb_x,this.radius_rb_y=e.radius_rb_y,0===this.radius_lt_x&&0===this.radius_lt_y&&0===this.radius_lb_x&&0===this.radius_lb_y&&0===this.radius_rt_x&&0===this.radius_rt_y&&0===this.radius_rb_x&&0===this.radius_rb_y?this.enable_rounded_corner=0:this.enable_rounded_corner=1):this.enable_rounded_corner=0},Re.prototype.setAntialiasWidth=function(e){(e<=0||e>=1)&&(e=ee.ru),this.aa_width=e};var Ie=Re;function De(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?De(Object(r),!0).forEach((function(t){(0,i.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):De(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Oe=new Map,xe=[];function Pe(e){e.preventDefault()}function Le(e,t,r,n,i,a,o){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.canvasElement=e,this.canvasID=t,this.contextOptions=i,this.textureindex=r||0,this.texturestride=this.textureindex?3:o?4:6,this.initmask=o||!1,this.reuse=!1,this.isEnableCanvasAlphaChannel=s,Le.prototype.ROTATION_CLOCK0=0,Le.prototype.ROTATION_CLOCK90=1,Le.prototype.ROTATION_CLOCK180=2,Le.prototype.ROTATION_CLOCK270=3,this.webGLResources=a,a||(this.initContextGL(),this.contextGL&&(this.webGLContextLostProtect(),this.contextGL.isContextLost()&&this.restoreContext())),this.reinit(a);var u=new ArrayBuffer(4);this.dummpyCursor=new Uint8Array(u),this.dummpyWaterMark=new Uint8Array(u),this.cursorWidth=0,this.cursorHeight=0,this.hasCursor=0,this.hasWaterMark=0,this.watermarkOpacity=.15,this.watermarkData=null,this.watermarkWidth=0,this.watermarkHeight=0,this.isMultiView=!1,this.hasWholeFrame=0,this.croppingParams={},this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.width=0,this.croppingParams.height=0,this.textureWidth=0,this.textureHeight=0,this.canvasWidth=0,this.canvasHeight=0,this.picRotation=-1,this.bgColor=[0,0,0],this.cx=0,this.cy=0,this.cw=0,this.ch=0,this.colorRange=-1,this.videoMode=z.kh,this.rotation=this.ROTATION_CLOCK0,this.fillMode=0,this.fillModeForResolution=0,this.viewPostion=null,this.enable_rounded_corner=0,this.radius_lt_x=0,this.radius_lt_y=0,this.radius_lb_x=0,this.radius_lb_y=0,this.radius_rt_x=0,this.radius_rt_y=0,this.radius_rb_x=0,this.radius_rb_y=0,this.aa_width=ee.ru,this.uv_rect=null}Le.prototype.reinit=function(e){if(this.webGLResources=e,!this.contextGL||this.contextGL.isContextLost()||this.contextGL.glInitSucceed||this.webGLResources){if(this.webGLResources&&this.webGLResources.contextgl&&!this.webGLResources.contextgl.isContextLost()){this.contextGL=this.webGLResources.contextgl,this.shaderProgram=this.webGLResources.program,this.waterMarkTextureRef=this.webGLResources.waterMarkTextureRef,this.repeatedWaterMarkTextureRef=this.webGLResources.repeatedWaterMarkTextureRef,this.initTextures(!1),this.vertexPosBuffer=this.webGLResources.vBuffer,this.texturePosBuffer=this.webGLResources.tBuffer;var t=this.contextGL.getError();this.contextGL.glInitSucceed=t!=this.contextGL.NO_ERROR&&t!=this.contextGL.CONTEXT_LOST_WEBGL?0:1}}else{this.initProgram(),this.initmask?this.initTextures(!1):this.initTextures(!0),this.initBuffers();var r=this.contextGL.getError();this.contextGL.glInitSucceed=r!=this.contextGL.NO_ERROR&&r!=this.contextGL.CONTEXT_LOST_WEBGL?0:1}},Le.prototype.webGLContextLostSimulate=function(){var e="undefined"==typeof window?self:window;e.webGLEXTSimulate=e.webGLEXTSimulate||[],e.webGLEXTSimulate.push((0,ie.px)(this.contextGL,"WEBGL_lose_context"))},Le.prototype.restoreContext=function(){if(this.contextGL)try{var e;null!==(e=this.canvasElement)&&void 0!==e&&e.loseContextExtension&&!this.canvasElement.restoreTimeoutId&&this.contextGL.isContextLost()&&(this.canvasElement.restoreTimeoutId=setTimeout((function(){(0,ie.S_)("WebGL2RestoreTimeout")}),1500),this.canvasElement.loseContextExtension.restoreContext())}catch(e){(0,ie.Yd)("webgl restoreContext exception2",e)}},Le.prototype.webgGLContextLostCallback=function(e){(0,ie.fn)("webglcontextlost2 event: canvas listener size=".concat(xe.length,",  canvas id: ").concat(this.canvasID,", , ids:").concat(xe.join())),e.preventDefault(),this.contextGL.glInitSucceed=0,this.contextOptions&&this.contextOptions.webglcontextlostCallback&&this.contextOptions.webglcontextlostCallback(e,this.contextOptions.params)},Le.prototype.removeEventListener=function(e,t){if(e&&t){e.restoreTimeoutId&&(clearTimeout(e.restoreTimeoutId),e.restoreTimeoutId=void 0),e.removeEventListener("webglcontextlost",t.contextLostHandler),e.removeEventListener("webglcontextrestored",t.contextRestoredHandler);var r=xe.indexOf(this.canvasID);xe.splice(r,1),Oe.delete(e)}},Le.prototype.webGLContextRestoredCallback=function(e){(0,ie.fn)("webglcontextrestored2 event from canvas id: ".concat(this.canvasID)),this.canvasElement.restoreTimeoutId&&(clearTimeout(this.canvasElement.restoreTimeoutId),this.canvasElement.restoreTimeoutId=void 0),this.reinit(),this.contextOptions&&this.contextOptions.webglcontextrestoredCallback&&this.contextOptions.webglcontextrestoredCallback(e,this.contextOptions.params)},Le.prototype.webGLContextLostProtect=function(){this.canvasElement&&!this.canvasElement.loseContextExtension&&(this.canvasElement.loseContextExtension=(0,ie.px)(this.contextGL,"WEBGL_lose_context"));var e=this.canvasElement,t=Oe.get(e);t&&this.removeEventListener(e,t),Oe.set(e,this),this.contextLostHandler=this.webgGLContextLostCallback.bind(this),this.contextRestoredHandler=this.webGLContextRestoredCallback.bind(this),e.addEventListener("webglcontextlost",this.contextLostHandler,{capture:!1}),e.addEventListener("webglcontextrestored",this.contextRestoredHandler,{capture:!1}),-1===xe.indexOf(this.canvasID)&&(xe.push(this.canvasID),xe.length>4&&(0,ie.fn)("webgl2canvas listener size=".concat(xe.length,", ids:").concat(xe.join())))},Le.prototype.isWebGL2=function(){return this.contextGL},Le.prototype.isAvaiable=function(){return this.contextGL&&!this.contextGL.isContextLost()&&this.contextGL.glInitSucceed},Le.prototype.initContextGL=function(){for(var e,t,r,n=this.canvasElement,i=null,a=["webgl2"],o=0;!i&&o<a.length;){var s=a[o];try{if((0,be.B)().config.isEnableCanvasCtxOptionsOpt()){var u={depth:!1,stencil:!1,antialias:!1,alpha:this.isEnableCanvasAlphaChannel};if(this.contextOptions){var c=Me(Me({},this.contextOptions),u);i=n.getContext(s,c)}else i=n.getContext(s,u)}else i=this.contextOptions?n.getContext(s,this.contextOptions):n.getContext(s)}catch(e){i=null}i&&"function"==typeof i.getParameter||(i=null),++o}if(this.contextGL=i,!i||i.isContextLost())return(0,ie.Yd)("Failed when trying to get WebGLContext2 on canvas(".concat(null===(e=this.canvasElement)||void 0===e?void 0:e.width,",").concat(null===(t=this.canvasElement)||void 0===t?void 0:t.height,"), gl=").concat(i,", lost=").concat(null===(r=i)||void 0===r?void 0:r.isContextLost())),void(0,ie.S_)("initWebGL2Fail");i.glInitSucceed=0},Le.prototype.initProgram=function(){var e=this.contextGL,t=e.createShader(e.VERTEX_SHADER);e.shaderSource(t,"#version 300 es\n    in vec4 vertexPos;\n    in vec4 texturePos;\n    in vec4 masktexturePos;\n    out vec2 textureCoord;\n    out vec2 masktextureCoord;\n\n    void main() {\n      gl_Position = vertexPos;\n      textureCoord = texturePos.xy;\n      masktextureCoord = masktexturePos.xy;\n    }\n  "),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||e.isContextLost()||(0,ie.fn)("webgl2 Vertex shader failed to compile: "+e.getShaderInfoLog(t));var r=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(r,"#version 300 es\n    precision highp float;\n\n    in highp vec2 textureCoord;\n    in highp vec2 masktextureCoord;\n    uniform sampler2D ySampler;\n    uniform sampler2D uSampler;\n    uniform sampler2D vSampler;\n    uniform sampler2D cursorSampler;\n    uniform sampler2D waterMarkSampler;\n    uniform sampler2D previewVideoSampler;\n    uniform sampler2D maskSampler;\n    uniform vec4 cursorInfo;\n    uniform int onlyRGBA;\n    uniform int bgraMode;\n    uniform int colorRange;\n    uniform int waterMarkFlag;\n    uniform int cursorFlag;\n    uniform int maskFlag;\n    uniform int yuvmode;\n\n    // rounded corner feature in gl shader\n    uniform float u_enable_rounded_corner;\n    uniform float u_radius_lt_x;\n    uniform float u_radius_lt_y;\n    uniform float u_radius_lb_x;\n    uniform float u_radius_lb_y;\n    uniform float u_radius_rt_x;\n    uniform float u_radius_rt_y;\n    uniform float u_radius_rb_x;\n    uniform float u_radius_rb_y;\n    uniform float u_aa_width;\n    uniform vec4 u_viewport_rect;\n\n    const mat4 YUV2RGB_L = mat4(\n      1.1643828125, 0, 1.59602734375, -.87078515625,\n      1.1643828125, -.39176171875, -.81296875, .52959375,\n      1.1643828125, 2.017234375, 0, -1.081390625,\n      0, 0, 0, 1\n    );\n\n    const mat4 YUV2RGB_F = mat4(\n      1.0, 0, 1.402, -.701,\n      1.0, -.34413, -.71414, .529135,\n      1.0, 1.772, 0, -.886,\n      0, 0, 0, 1\n    );\n\n    out vec4 outputColor;\n\n    void main(void) {\n      vec4 c;\n      if (waterMarkFlag != 1) {\n        if (onlyRGBA == 0) {\n          highp float y = texture(ySampler, textureCoord).r;\n          highp float u;\n          highp float v;\n          if (yuvmode == 1) {\n            u = texture(uSampler, textureCoord).r;\n            v = texture(vSampler, textureCoord).r;\n          } else {\n            u = texture(uSampler, textureCoord).r;\n            v = texture(uSampler, textureCoord).a;\n          }\n\n          if (colorRange == 0) {\n            c = vec4(y, u, v, 1) * YUV2RGB_L;\n          } else {\n            c = vec4(y, u, v, 1) * YUV2RGB_F;\n          }\n\n          if (cursorFlag == 1) {\n            if (cursorInfo.z > 0.0 && textureCoord.x >= cursorInfo.x && textureCoord.y >= cursorInfo.y &&\n                textureCoord.x < cursorInfo.x+cursorInfo.z && textureCoord.y < cursorInfo.y+cursorInfo.w) {\n              vec2 cursorCoord = textureCoord - cursorInfo.xy;\n              cursorCoord /= cursorInfo.zw;\n              vec4 cursor = texture(cursorSampler, cursorCoord);\n              c = c*(1.0-cursor.a) + cursor*cursor.a;\n            }\n          }\n        } else {\n          c = texture(previewVideoSampler, textureCoord);\n          if (bgraMode == 1) {\n            c = vec4(c.b, c.g, c.r, c.a);\n          }\n        }\n      }\n\n      if (waterMarkFlag == 1) {\n        c = texture(waterMarkSampler, textureCoord);\n        if (c.r == 0.0 && c.g == 0.0 && c.b == 0.0) {\n          c.a = 0.0;\n        }\n      }\n\n      if (maskFlag == 1 && waterMarkFlag != 1) {\n        vec4 mask = texture(maskSampler, masktextureCoord);\n        if (mask.r != 0.0 || mask.g != 0.0 || mask.b != 0.0) {\n          c = mask * mask.a + c * (1.0 - mask.a);\n        }\n      }\n\n      if (waterMarkFlag != 1) {\n        c.a = 1.0;\n      }\n\n      if (u_enable_rounded_corner < 0.5) {\n        outputColor = c;\n        return;\n      }\n\n      // step 1: viewport coordinate mapping\n      // convert the fragment coordinate(canvas coordinate) to the viewport coordinate\n      // for example, a viewport={x: 100, y: 100, w: 200, h: 160}, a fragCoord.xy={x:120, y: 120}\n      // we can get the pos={x: 20, y: 20}\n      vec2 pos = gl_FragCoord.xy - u_viewport_rect.xy;\n      vec2 viewportSize = u_viewport_rect.zw;\n\n      // convert the normalized radius to pixel value\n      float r_lt_x = u_radius_lt_x * viewportSize.x;\n      float r_lt_y = u_radius_lt_y * viewportSize.y;\n      float r_rt_x = u_radius_rt_x * viewportSize.x;\n      float r_rt_y = u_radius_rt_y * viewportSize.y;\n      float r_lb_x = u_radius_lb_x * viewportSize.x;\n      float r_lb_y = u_radius_lb_y * viewportSize.y;\n      float r_rb_x = u_radius_rb_x * viewportSize.x;\n      float r_rb_y = u_radius_rb_y * viewportSize.y;\n\n      // step 2: calculate the rounded corner mask (as alpha)\n      float alpha = 1.0;\n\n      // --- calculation of the left-top corner ---\n      // Condition: if (pos.x < r_lt_x && pos.y < r_lt_y)\n      float in_lt = (1.0 - step(r_lt_x, pos.x)) * (1.0 - step(r_lt_y, pos.y));\n      // the circle center of the left-top corner in pixel coordinate\n      vec2 center_lt = vec2(r_lt_x, r_lt_y);\n      // calculate and normalize the distance between the fragment and the center\n      vec2 diff_lt = (pos - center_lt) / vec2(r_lt_x, r_lt_y);\n      float normDist_lt = length(diff_lt);\n      // smoothstep function is used to calculate the alpha value\n      float mask_lt = 1.0 - smoothstep(1.0 - u_aa_width, 1.0, normDist_lt);\n      float final_lt = mix(1.0, mask_lt, in_lt);\n\n      // --- calculation of the right-top corner ---\n      float in_rt = (1.0 - step(r_rt_x, viewportSize.x - pos.x)) * (1.0 - step(r_rt_y, pos.y));\n      vec2 center_rt = vec2(viewportSize.x - r_rt_x, r_rt_y);\n      vec2 diff_rt = (pos - center_rt) / vec2(r_rt_x, r_rt_y);\n      float normDist_rt = length(diff_rt);\n      float mask_rt = 1.0 - smoothstep(1.0 - u_aa_width, 1.0, normDist_rt);\n      float final_rt = mix(1.0, mask_rt, in_rt);\n\n      // --- calculation of the left-bottom corner ---\n      float in_lb = (1.0 - step(r_lb_x, pos.x)) * (1.0 - step(r_lb_y, viewportSize.y - pos.y));\n      vec2 center_lb = vec2(r_lb_x, viewportSize.y - r_lb_y);\n      vec2 diff_lb = (pos - center_lb) / vec2(r_lb_x, r_lb_y);\n      float normDist_lb = length(diff_lb);\n      float mask_lb = 1.0 - smoothstep(1.0 - u_aa_width, 1.0, normDist_lb);\n      float final_lb = mix(1.0, mask_lb, in_lb);\n\n      // --- calculation of the right-bottom corner ---\n      float in_rb = (1.0 - step(r_rb_x, viewportSize.x - pos.x)) * (1.0 - step(r_rb_y, viewportSize.y - pos.y));\n      vec2 center_rb = vec2(viewportSize.x - r_rb_x, viewportSize.y - r_rb_y);\n      vec2 diff_rb = (pos - center_rb) / vec2(r_rb_x, r_rb_y);\n      float normDist_rb = length(diff_rb);\n      float mask_rb = 1.0 - smoothstep(1.0 - u_aa_width, 1.0, normDist_rb);\n      float final_rb = mix(1.0, mask_rb, in_rb);\n\n      // step 3: Get the minimum value from the four corners (to ensure that if any corner requires transparency it is applied)\n      float finalAlpha = min(min(final_lt, final_rt), min(final_lb, final_rb));\n\n      // step 4: Final output color\n      outputColor = vec4(c.rgb, c.a * finalAlpha);\n    }\n  "),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)||e.isContextLost()||(0,ie.fn)("webgl2 Fragment shader failed to compile: "+e.getShaderInfoLog(r));var n=e.createProgram();e.attachShader(n,t),e.attachShader(n,r),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)||e.isContextLost()||(0,ie.fn)("webgl2 Program failed to compile: "+e.getProgramInfoLog(n)),e.useProgram(n),this.shaderProgram=n},Le.prototype.initBuffers=function(){var e=this.contextGL,t=this.shaderProgram,r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1,1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var n=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),this.vertexPosBuffer=r;var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1,1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var a=e.getAttribLocation(t,"texturePos");if(e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),this.initmask&&!this.masktexturePosBuffer){var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var s=e.getAttribLocation(t,"masktexturePos");e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),this.masktexturePosBuffer=o}this.texturePosBuffer=i},Le.prototype.initTextures=function(e){var t=this.contextGL,r=this.shaderProgram;t.pixelStorei(t.UNPACK_ALIGNMENT,1);var n=this.initTexture();this.yTextureRef=n,this.oyTextureRef=n;var i=this.initTexture();this.uTextureRef=i,this.ouTextureRef=i;var a=this.initTexture();if(this.vTextureRef=a,this.ovTextureRef=a,e){this.BindTextures(z.Wp);var o=this.initTexture(),s=t.getUniformLocation(r,"cursorSampler");t.uniform1i(s,this.textureindex*this.texturestride+3),this.cursorTextureRef=o;var u=this.initTexture(),c=t.getUniformLocation(r,"waterMarkSampler");t.uniform1i(c,4),this.waterMarkTextureRef=u;var d=this.initTexture();this.repeatedWaterMarkTextureRef=d;var l=this.initTexture(),h=t.getUniformLocation(r,"previewVideoSampler");t.uniform1i(h,this.textureindex*this.texturestride+5),this.previewVideoTextureRef=l;var f=t.getUniformLocation(r,"cursorInfo");this.cursorInfoRef=f}if(this.initmask){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1);var p=this.initTexture(),v=t.getUniformLocation(r,"maskSampler");t.uniform1i(v,this.textureindex*this.texturestride+6),this.maskTextureRef=p}var g=t.getUniformLocation(r,"colorRange");this.colorRangeRef=g,this.onlyRGBARef=t.getUniformLocation(r,"onlyRGBA"),this.bgraModeRef=t.getUniformLocation(r,"bgraMode"),this.waterMarkFlagRef=t.getUniformLocation(r,"waterMarkFlag"),this.maskFlagRef=t.getUniformLocation(r,"maskFlag"),this.cursorFlagRef=t.getUniformLocation(r,"cursorFlag"),this.yuvmodeRef=t.getUniformLocation(r,"yuvmode"),this.ul_enable_rounded_corner=t.getUniformLocation(r,"u_enable_rounded_corner"),this.ul_radius_lt_x=t.getUniformLocation(r,"u_radius_lt_x"),this.ul_radius_lt_y=t.getUniformLocation(r,"u_radius_lt_y"),this.ul_radius_lb_x=t.getUniformLocation(r,"u_radius_lb_x"),this.ul_radius_lb_y=t.getUniformLocation(r,"u_radius_lb_y"),this.ul_radius_rt_x=t.getUniformLocation(r,"u_radius_rt_x"),this.ul_radius_rt_y=t.getUniformLocation(r,"u_radius_rt_y"),this.ul_radius_rb_x=t.getUniformLocation(r,"u_radius_rb_x"),this.ul_radius_rb_y=t.getUniformLocation(r,"u_radius_rb_y"),this.ul_aa_width=t.getUniformLocation(r,"u_aa_width"),this.ul_viewport_rect=t.getUniformLocation(r,"u_viewport_rect")},Le.prototype.BindTextures=function(e){var t=this.contextGL,r=this.shaderProgram;if(t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.activeTexture(t.TEXTURE0+0),t.bindTexture(t.TEXTURE_2D,this.yTextureRef),t.activeTexture(t.TEXTURE0+1),t.bindTexture(t.TEXTURE_2D,this.uTextureRef),t.activeTexture(t.TEXTURE0+2),t.bindTexture(t.TEXTURE_2D,this.vTextureRef),e==z.Wp){var n=t.getUniformLocation(r,"ySampler");t.uniform1i(n,0);var i=t.getUniformLocation(r,"uSampler");t.uniform1i(i,1);var a=t.getUniformLocation(r,"vSampler");t.uniform1i(a,2)}else if(this.isRGBAMode(e)){var o=t.getUniformLocation(r,"previewVideoSampler");t.uniform1i(o,0);var s=t.getUniformLocation(r,"ySampler");t.uniform1i(s,0);var u=t.getUniformLocation(r,"uSampler");t.uniform1i(u,0);var c=t.getUniformLocation(r,"vSampler");t.uniform1i(c,0)}else if(e==z.pn){var d=t.getUniformLocation(r,"ySampler");t.uniform1i(d,0);var l=t.getUniformLocation(r,"uSampler");t.uniform1i(l,1);var h=t.getUniformLocation(r,"vSampler");t.uniform1i(h,0)}var f=t.getUniformLocation(r,"previewVideoSampler");t.uniform1i(f,0);var p=t.getUniformLocation(r,"maskSampler");this.initmask?(t.activeTexture(t.TEXTURE0+6),t.bindTexture(t.TEXTURE_2D,this.maskTextureRef),t.uniform1i(p,6)):t.uniform1i(p,0);var v=t.getUniformLocation(r,"cursorSampler");t.uniform1i(v,0);var g=t.getUniformLocation(this.shaderProgram,"waterMarkSampler");t.uniform1i(g,0)},Le.prototype.initTexture=function(){var e=this.contextGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t},Le.prototype.clearDisplay=function(){var e=this.contextGL;e&&(e.enable(e.BLEND),e.blendFunc(e.ZERO,e.ZERO)),this.render()},Le.prototype.cleanup=function(){var e=this.canvasElement,t=Oe.get(e);if(t&&this.removeEventListener(e,t),e.defaultContextLostHandler||(e.defaultContextLostHandler=Pe,e.addEventListener("webglcontextlost",Pe,{capture:!1})),this.cleanupRoundedCornerRadius(),this.isAvaiable()){var r=this.contextGL;r.deleteProgram(this.program),r.activeTexture(r.TEXTURE0+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE1+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE2+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),this.textureindex||this.initmask||(r.activeTexture(r.TEXTURE3+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE4+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(this.getRepeatedWatermarkTextureValue(r)),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE5+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null)),r.bindBuffer(r.ARRAY_BUFFER,null),r.deleteTexture(this.yTextureRef),r.deleteTexture(this.uTextureRef),r.deleteTexture(this.vTextureRef),this.textureindex||this.initmask||(r.deleteTexture(this.cursorTextureRef),r.deleteTexture(this.waterMarkTextureRef),r.deleteTexture(this.repeatedWaterMarkTextureRef),r.deleteTexture(this.previewVideoTextureRef),r.deleteBuffer(this.vertexPosBuffer),r.deleteBuffer(this.texturePosBuffer)),this.maskTextureRef&&r.deleteTexture(this.maskTextureRef),this.masktexturePosBuffer&&r.deleteBuffer(this.masktexturePosBuffer),r.glInitSucceed=0}},Le.prototype.drawNextOutputPicture=function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.contextGL?this.drawNextOutputPictureFrame(e,t,r,n,i):this.drawNextOuptutPictureRGBA(e,t,r,n)},Le.prototype.updateVertexInfo=function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=e.contextGL,o=a.canvas.width,s=a.canvas.height;i&&(o=i.width,s=i.height);var u,c,d,l,h=n==e.ROTATION_CLOCK90||n==e.ROTATION_CLOCK270?r:t,f=n==e.ROTATION_CLOCK90||n==e.ROTATION_CLOCK270?t:r,p=h/f*s;p>o?(u=0,d=1,l=1-(c=(s-f/h*o)/2/s)):(c=0,l=1,d=1-(u=(o-p)/2/o)),u=2*u-1,d=2*d-1,c=1-2*c,l=1-2*l;var v=new Float32Array([d,c,u,c,d,l,u,l,d,c,u,c,d,l,u,l]);a.bindBuffer(a.ARRAY_BUFFER,e.vertexPosBuffer),a.bufferData(a.ARRAY_BUFFER,v,a.DYNAMIC_DRAW)},Le.prototype.updateVertexInfoForMultiView=function(e,t,r,n,i){var a,o,s,u,c=this.contextGL;if(this.isUseFillMode({width:r,height:n,rotation:i}))a=0,o=0,s=1,u=1;else{var d=i==this.ROTATION_CLOCK90||i==this.ROTATION_CLOCK270?n:r,l=i==this.ROTATION_CLOCK90||i==this.ROTATION_CLOCK270?r:n,h=d/l*t;h>e?(a=0,s=1,u=1-(o=(t-l/d*e)/2/t)):(o=0,u=1,s=1-(a=(e-h)/2/e))}a=2*a-1,s=2*s-1,o=1-2*o,u=1-2*u;var f=new Float32Array([s,o,a,o,s,u,a,u,1,1,-1,1,1,-1,-1,-1]);this.viewPostion=f,c.bindBuffer(c.ARRAY_BUFFER,this.vertexPosBuffer),c.bufferData(c.ARRAY_BUFFER,f,c.DYNAMIC_DRAW)},Le.prototype.updateTextureInfo=function(e,t,r,n,i){var a=e.contextGL,o=n.top/r,s=n.left/t,u=o+(n.height-1)/r,c=s+n.width/t,d=[s,o,c,o,c,u,s,u];i==e.ROTATION_CLOCK90&&(d.unshift(d[6],d[7]),d=d.slice(0,8)),i==e.ROTATION_CLOCK180&&(d.unshift(d[4],d[5],d[6],d[7]),d=d.slice(0,8)),i==e.ROTATION_CLOCK270&&(d.push(d[0],d[1]),d=d.slice(2));var l=d[0],h=d[1];d[0]=d[2],d[1]=d[3],d[2]=l,d[3]=h;var f=new Float32Array([].concat(y(d),[1,0,0,0,1,1,0,1]));a.bindBuffer(a.ARRAY_BUFFER,e.texturePosBuffer),a.bufferData(a.ARRAY_BUFFER,f,a.DYNAMIC_DRAW)},Le.prototype.updateTextureInfoForMultiView=function(e,t,r,n,i,a,o){var s,u,c,d,l=this.contextGL;if(this.isUseFillMode({width:r.width,height:r.height,rotation:n})){var h=n==this.ROTATION_CLOCK90||n==this.ROTATION_CLOCK270?o/a:a/o,f=r.left||0,p=r.top||0;if(r.width/r.height>h){var v=r.height*h;s=p/t,u=(Math.round((r.width-v)/2)+f)/e,c=s+(r.height-1)/t,d=u+v/e}else{var g=r.width/h;c=(s=(Math.round((r.height-g)/2)+p)/t)+(g-1)/t,d=(u=f/e)+r.width/e}}else s=Ae(r.top/t,2),u=Ae(r.left/e,2),c=Se((r.top+r.height-1)/t,2),d=Se((r.width-1+r.left)/e,2);var m=[u,s,d,s,d,c,u,c];n==this.ROTATION_CLOCK90&&(m.unshift(m[6],m[7]),m=m.slice(0,8)),n==this.ROTATION_CLOCK180&&(m.unshift(m[4],m[5],m[6],m[7]),m=m.slice(0,8)),n==this.ROTATION_CLOCK270&&(m.push(m[0],m[1]),m=m.slice(2,10));var _=m[0],S=m[1];if(m[0]=m[2],m[1]=m[3],m[2]=_,m[3]=S,i)if(n==this.ROTATION_CLOCK90||n==this.ROTATION_CLOCK270){var A=m[1];m[1]=m[3],m[3]=A,A=m[5],m[5]=m[7],m[7]=A}else m[0]=1-m[0],m[2]=1-m[2],m[4]=1-m[4],m[6]=1-m[6];var b=new Float32Array([].concat(y(m),[1,0,0,0,1,1,0,1]));l.bindBuffer(l.ARRAY_BUFFER,this.texturePosBuffer),l.bufferData(l.ARRAY_BUFFER,b,l.DYNAMIC_DRAW)},Le.prototype.getViewPosition=function(){var e=[0,0,1,1];if(!this.viewPostion)return e;var t=this.viewPostion[0],r=this.viewPostion[1],n=this.viewPostion[2],i=this.viewPostion[5];return e[0]=(1-r)/2,e[1]=(1+n)/2,e[2]=(1-i)/2,e[3]=(1+t)/2,e},Le.prototype.drawNextOutputPictureFrame=function(e,t,r,n,i){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];if(this.isAvaiable()){var u=this.contextGL,c=(this.texturePosBuffer,this.yTextureRef),d=this.uTextureRef,l=this.vTextureRef;u.enable(u.BLEND),u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA),i=i||this.ROTATION_CLOCK0;var h=(r=r||{top:0,left:0,width:e,height:t}).width!=this.croppingParams.width||r.height!=this.croppingParams.height,f=r.top!=this.croppingParams.top||r.left!=this.croppingParams.left,p=u.canvas.width!=this.canvasWidth||u.canvas.height!=this.canvasHeight,v=e!=this.textureWidth||t!=this.textureHeight,g=i!=this.picRotation;(h||p||g)&&this.updateVertexInfo(this,r.width,r.height,i,o),(h||f||v||g)&&this.updateTextureInfo(this,e,t,r,i);var m=a?0:1;m!=this.colorRange&&(u.uniform1i(this.colorRangeRef,m),this.colorRange=m),o?(u.viewport(o.x,o.y,o.width,o.height),this.viewport_rect||(this.viewport_rect=new Float32Array(4)),this.viewport_rect.set([o.x,o.y,o.width,o.height],0),u.uniform4fv(this.ul_viewport_rect,this.viewport_rect)):(u.viewport(0,0,u.canvas.width,u.canvas.height),this.viewport_rect||(this.viewport_rect=new Float32Array(4)),this.viewport_rect.set([0,0,u.canvas.width,u.canvas.height],0),u.uniform4fv(this.ul_viewport_rect,this.viewport_rect)),u.uniform1i(this.onlyRGBARef,0),u.uniform1i(this.yuvmodeRef,z.Wp),Object.assign(this.croppingParams,r),this.textureWidth=e,this.textureHeight=t,this.picRotation=i,this.canvasWidth=u.canvas.width,this.canvasHeight=u.canvas.height;var y=n,_=e*t;if(u.activeTexture(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,c),s){var S=y.subarray(0,_);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,e,t,0,u.LUMINANCE,u.UNSIGNED_BYTE,S)}var A=e/2*t/2;if(u.activeTexture(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,d),s){var b=y.subarray(_,_+A);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,e/2,t/2,0,u.LUMINANCE,u.UNSIGNED_BYTE,b)}var E=A;if(u.activeTexture(u.TEXTURE2),u.bindTexture(u.TEXTURE_2D,l),s){var k=y.subarray(_+A,_+A+E);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,e/2,t/2,0,u.LUMINANCE,u.UNSIGNED_BYTE,k)}u.activeTexture(u.TEXTURE3),u.bindTexture(u.TEXTURE_2D,this.cursorTextureRef),this.hasCursor?u.uniform1i(this.cursorFlagRef,1):s&&u.texImage2D(u.TEXTURE_2D,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,this.dummpyCursor),u.uniform4f(this.cursorInfoRef,this.cx,this.cy,this.cw,this.ch),u.activeTexture(u.TEXTURE5),u.bindTexture(u.TEXTURE_2D,this.previewVideoTextureRef),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,this.dummpyWaterMark);var C=u.getUniformLocation(this.shaderProgram,"maskSampler");u.uniform1i(C,5),this.render(),this.hasWholeFrame=1}},Le.prototype.updateTextureBlock=function(e,t,r,n,i){if(this.isAvaiable()){var a=this.contextGL,o=i;if(!(!this.hasWholeFrame||e<=0||t<=0||r<0||n<0||r+e>this.textureWidth||n+t>this.textureHeight)&&i&&i.length==e*t*3/2){var s=this.yTextureRef,u=this.uTextureRef,c=this.vTextureRef,d=e*t,l=o.subarray(0,d);a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,s),a.texSubImage2D(a.TEXTURE_2D,0,r,n,e,t,a.LUMINANCE,a.UNSIGNED_BYTE,l);var h=e/2*t/2,f=o.subarray(d,d+h);a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,u),a.texSubImage2D(a.TEXTURE_2D,0,r/2,n/2,e/2,t/2,a.LUMINANCE,a.UNSIGNED_BYTE,f);var p=h,v=o.subarray(d+h,d+h+p);a.activeTexture(a.TEXTURE2),a.bindTexture(a.TEXTURE_2D,c),a.texSubImage2D(a.TEXTURE_2D,0,r/2,n/2,e/2,t/2,a.LUMINANCE,a.UNSIGNED_BYTE,v)}}},Le.prototype.updateCursor=function(e,t,r){if(this.isAvaiable()){var n=this.contextGL;e<=0||t<=0||!r||r.length!=e*t*4||(n.activeTexture(n.TEXTURE3),n.bindTexture(n.TEXTURE_2D,this.cursorTextureRef),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,t,0,n.RGBA,n.UNSIGNED_BYTE,r),this.cursorWidth=e,this.cursorHeight=t,this.hasCursor=1)}},Le.prototype.updateWatermark=function(e,t,r){this.isAvaiable()&&(this.contextGL,e<=0||t<=0||!r||r.length!=e*t*4||(this.watermarkData=r,this.watermarkWidth=e,this.watermarkHeight=t,this.hasWaterMark=1))},Le.prototype.drawWatermark=function(){if(this.isAvaiable()){var e=this.contextGL;if(this.isSetWatermark()&&this.watermarkData&&this.watermarkWidth&&this.watermarkHeight){e.uniform1i(this.waterMarkFlagRef,1),this.isWatermarkRepeated()?(e.activeTexture(this.getRepeatedWatermarkTextureValue(e)),e.bindTexture(e.TEXTURE_2D,this.repeatedWaterMarkTextureRef)):(e.activeTexture(e.TEXTURE4),e.bindTexture(e.TEXTURE_2D,this.waterMarkTextureRef)),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.watermarkWidth,this.watermarkHeight,0,e.RGBA,e.UNSIGNED_BYTE,this.watermarkData);var t=e.getUniformLocation(this.shaderProgram,"waterMarkSampler");e.uniform1i(t,this.isWatermarkRepeated()?this.getRepeatedWatermarkUniformValue():4),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLE_STRIP,4,4)}}},Le.prototype.drawRoundedCorner=function(){if(this.isAvaiable()){var e=this.contextGL;e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.uniform1f(this.ul_enable_rounded_corner,this.enable_rounded_corner),e.uniform1f(this.ul_radius_lt_x,this.radius_lt_x),e.uniform1f(this.ul_radius_lt_y,this.radius_lt_y),e.uniform1f(this.ul_radius_lb_x,this.radius_lb_x),e.uniform1f(this.ul_radius_lb_y,this.radius_lb_y),e.uniform1f(this.ul_radius_rt_x,this.radius_rt_x),e.uniform1f(this.ul_radius_rt_y,this.radius_rt_y),e.uniform1f(this.ul_radius_rb_x,this.radius_rb_x),e.uniform1f(this.ul_radius_rb_y,this.radius_rb_y),e.uniform1f(this.ul_aa_width,this.aa_width)}},Le.prototype.cleanupRoundedCornerRadius=function(){this.enable_rounded_corner=0,this.radius_lt_x=0,this.radius_lt_y=0,this.radius_lb_x=0,this.radius_lb_y=0,this.radius_rt_x=0,this.radius_rt_y=0,this.radius_rb_x=0,this.radius_rb_y=0,this.aa_width=ee.ru,this.viewport_rect=null},Le.prototype.render=function(){if(this.isAvaiable()){var e=this.contextGL;this.drawRoundedCorner(),e.uniform1i(this.waterMarkFlagRef,0),e.drawArrays(e.TRIANGLE_STRIP,0,4),this.drawWatermark()}},Le.prototype.drawCursor=function(e,t,r,n,i){if(this.isAvaiable()){var a=this.contextGL;if(!(!this.hasWholeFrame||e&&(n<0||i<0))){a.viewport(0,0,a.canvas.width,a.canvas.height);var o=this.yTextureRef,s=this.uTextureRef,u=this.vTextureRef,c=this.cursorTextureRef;if(a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,o),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,s),a.activeTexture(a.TEXTURE2),a.bindTexture(a.TEXTURE_2D,u),a.activeTexture(a.TEXTURE3),a.bindTexture(a.TEXTURE_2D,c),e&&this.hasCursor){var d=t/this.croppingParams.width,l=r/this.croppingParams.height,h=n/this.croppingParams.width,f=i/this.croppingParams.height;this.cx=d,this.cy=l,this.cw=h,this.ch=f,a.uniform4f(this.cursorInfoRef,d,l,h,f)}else a.uniform4f(this.cursorInfoRef,0,0,0,0);this.render()}}},Le.prototype.clear=function(){this.hasWholeFrame=0,this.hasCursor=0,this.cleanupRoundedCornerRadius()},Le.prototype.clearCanvas=function(e){if(this.cleanupRoundedCornerRadius(),this.isAvaiable()){var t=this.contextGL;e?t.clearColor(e.R,e.G,e.B,e.A):t.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),t.clear(t.COLOR_BUFFER_BIT)}},Le.prototype.drawNextOuptutPictureRGBA=function(e,t,r,n){if(this.isAvaiable()){var i=n,a=this.canvasElement.getContext("2d"),o=a.getImageData(0,0,e,t);o.data.set(i),a.putImageData(o,0,0)}},Le.prototype.isRGBAMode=function(e){return-1!==[z.rK,z.hd].indexOf(e)},Le.prototype.updateRemoteVideoTextures=function(e,t,r,n,i){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if(this.isAvaiable()){var s=this.contextGL,u=this.yTextureRef,c=this.uTextureRef,d=this.vTextureRef;s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA);var l=this.isRGBAMode(this.videoMode);if(e<=0||t<=0||!n||!n.length||n.length!=e*t*3/2&&!l||r&&(r.top<0||r.left<0||r.left+r.width>e||r.top+r.height>t))return!1;var h=a?0:1;if(this.colorRange=h,this.rotation=i,Object.assign(this.croppingParams,r),this.textureWidth=e,this.textureHeight=t,this.canvasWidth=s.canvas.width,this.canvasHeight=s.canvas.height,o){if(s.bindTexture(s.TEXTURE_2D,u),!l){var f=n,p=e*t,v=f.subarray(0,p);s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e,t,0,s.LUMINANCE,s.UNSIGNED_BYTE,v);var g=0,m=0;this.videoMode==z.Wp?m=g=e/2*t/2:this.videoMode==z.pn&&(g=e*t/2,m=0);var y=f.subarray(p,p+g);if(s.bindTexture(s.TEXTURE_2D,c),m){s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e/2,t/2,0,s.LUMINANCE,s.UNSIGNED_BYTE,y);var _=f.subarray(p+g,p+g+m);s.bindTexture(s.TEXTURE_2D,d),s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e/2,t/2,0,s.LUMINANCE,s.UNSIGNED_BYTE,_)}else s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE_ALPHA,e/2,t/2,0,s.LUMINANCE_ALPHA,s.UNSIGNED_BYTE,y);return!0}s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,t,0,s.RGBA,s.UNSIGNED_BYTE,n)}}},Le.prototype.updateRemoteVideoTexturesImageBitmap=function(e,t,r,n,i){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(!(e<=0||t<=0)&&r&&this.isAvaiable()){var o=this.contextGL;if(this.textureWidth=e,this.textureHeight=t,Number.isNaN(i)||(this.rotation=i),Object.assign(this.croppingParams,n),a){o.bindTexture(o.TEXTURE_2D,this.yTextureRef);var s=o.RGBA,u=o.RGBA,c=o.UNSIGNED_BYTE;o.texImage2D(o.TEXTURE_2D,0,s,u,c,r)}}},Le.prototype.updateSelfMaskImage=function(e,t,r){if(!(e<=0||t<=0)&&r&&r.length==e*t*4&&this.isAvaiable()){var n=this.contextGL;n.bindTexture(n.TEXTURE_2D,this.maskTextureRef),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,t,0,n.RGBA,n.UNSIGNED_BYTE,r)}},Le.prototype.VideoFlip=function(){if(this.isAvaiable()){var e=this.contextGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1)}},Le.prototype.drawRemoteVideo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isAvaiable()){var r=this.contextGL,n=this.isRGBAMode(this.videoMode)?1:0;r.uniform1i(this.colorRangeRef,this.colorRange),this.setUniformFlag(n,this.hasCursor,this.videoMode),this.initmask&&r.uniform1i(this.maskFlagRef,1),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,t,e.width,e.height),r.viewport(e.x,e.y,e.width,e.height),this.viewport_rect||(this.viewport_rect=new Float32Array(4)),this.viewport_rect.set([e.x,e.y,e.width,e.height],0),r.uniform4fv(this.ul_viewport_rect,this.viewport_rect),this.updateVertexInfoForMultiView(e.width,e.height,this.croppingParams.width,this.croppingParams.height,this.rotation),this.BindTextures(this.videoMode),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),this.render()}},Le.prototype.readPixelsSyncRequest=function(e,t,r,n){if(this.isAvaiable()){var i,a=this.contextGL;return this.destination&&this.destination.length==r*n*4||(this.destination=new Uint8Array(r*n*4)),i=this.destination,a.flush(),a.readPixels(e,t,r,n,a.RGBA,a.UNSIGNED_BYTE,i),i}},Le.prototype.updateSelfVideoTextures=function(e,t,r,n){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(!(e<=0||t<=0)&&r&&r.length%4==0&&this.isAvaiable()){var o=this.contextGL;this.textureWidth=e,this.textureHeight=t,this.rotation=a,Object.assign(this.croppingParams,n),i&&(o.bindTexture(o.TEXTURE_2D,this.yTextureRef),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,e,t,0,o.RGBA,o.UNSIGNED_BYTE,r))}},Le.prototype.drawSelfVideo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.isAvaiable()){var n=this.contextGL;this.setUniformFlag(1,this.hasCursor,this.videoMode),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,r,e.width,e.height),n.viewport(e.x,e.y,e.width,e.height),this.viewport_rect||(this.viewport_rect=new Float32Array(4)),this.viewport_rect.set([e.x,e.y,e.width,e.height],0),n.uniform4fv(this.ul_viewport_rect,this.viewport_rect),t?(n.enable(n.BLEND),n.blendFunc(n.ZERO,n.ZERO),this.updateVertexInfoForMultiView(e.width,e.height,e.width,e.height,this.ROTATION_CLOCK0)):(n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.updateVertexInfoForMultiView(e.width,e.height,this.croppingParams.width,this.croppingParams.height,this.rotation)),this.BindTextures(z.rK),this.render()}},Le.prototype.isSetWatermark=function(){return this.hasWaterMark},Le.prototype.recoverTextures=function(){},Le.prototype.setWatermarkFlag=function(e){this.hasWaterMark=e,e||(this.setWatermarkRepeated(!1),this.setWatermarkOpacity(),this.setWatermarkPosition(16))},Le.prototype.setUniformFlag=function(e,t,r){if(this.isAvaiable()){var n=this.contextGL;n.uniform1i(this.onlyRGBARef,e),n.uniform1i(this.bgraModeRef,e&&r===z.hd?1:0),n.uniform1i(this.cursorFlagRef,t),e||n.uniform1i(this.yuvmodeRef,r)}},Le.prototype.setVideoMode=function(e){this.videoMode=e},Le.prototype.getVideoMode=function(e){return this.videoMode},Le.prototype.setWatermarkRepeated=function(e){this.watermarkRepeated=e},Le.prototype.isWatermarkRepeated=function(){return!!this.watermarkRepeated},Le.prototype.setWatermarkOpacity=function(e){this.watermarkOpacity=e||.15},Le.prototype.getWatermarkOpacity=function(){return this.watermarkOpacity},Le.prototype.setWatermarkPosition=function(e){this.watermarkPosition=e||16},Le.prototype.getWatermarkPosition=function(){return this.watermarkPosition},Le.prototype.setMultiView=function(e){return this.isMultiView=e},Le.prototype.getRepeatedWatermarkUniformValue=function(){return this.isMultiView?30:7},Le.prototype.getRepeatedWatermarkTextureValue=function(e){return this.isMultiView?e.TEXTURE30:e.TEXTURE7},Le.prototype.setFillMode=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.fillMode=e,this.fillModeForResolution=t},Le.prototype.getFillMode=function(){return this.fillMode},Le.prototype.getFillModeForResolution=function(){return this.fillModeForResolution},Le.prototype.getTextureIndex=function(){return this.textureindex},Le.prototype.getIndex=function(){return this.textureindex},Le.prototype.getWatermarkWidth=function(){return this.watermarkWidth},Le.prototype.getWatermarkHeight=function(){return this.watermarkHeight},Le.prototype.getTextureWidth=function(){return this.textureWidth},Le.prototype.getTextureHeight=function(){return this.textureHeight},Le.prototype.getRotation=function(){return this.rotation},Le.prototype.getCroppingParams=function(){return this.croppingParams},Le.prototype.getWatermarkOpacity=function(){return this.watermarkOpacity},Le.prototype.getAttachedCanvas=function(){return this.canvasElement},Le.prototype.getCanvasId=function(){return this.canvasID},Le.prototype.resizeCanvasTo=function(e,t){this.contextGL.canvas.width=e,this.contextGL.canvas.height=t},Le.prototype.isUseFillMode=function(e){var t=e.width,r=e.height,n=e.rotation;if(!this.fillMode)return!1;if(!this.fillModeForResolution)return!0;if(!t||!r)return!1;var i=n===this.ROTATION_CLOCK90||n==this.ROTATION_CLOCK270?r/t:t/r;return(Array.isArray(this.fillModeForResolution)?this.fillModeForResolution:[this.fillModeForResolution]).some((function(e){return Math.abs(i-e)<.01}))},Le.prototype.setRoundedCornerRadius=function(e){console.log("setRoundedCornerRadius() radiusSet:".concat(JSON.stringify(e))),e?(this.radius_lt_x=e.radius_lt_x,this.radius_lt_y=e.radius_lt_y,this.radius_lb_x=e.radius_lb_x,this.radius_lb_y=e.radius_lb_y,this.radius_rt_x=e.radius_rt_x,this.radius_rt_y=e.radius_rt_y,this.radius_rb_x=e.radius_rb_x,this.radius_rb_y=e.radius_rb_y,0===this.radius_lt_x&&0===this.radius_lt_y&&0===this.radius_lb_x&&0===this.radius_lb_y&&0===this.radius_rt_x&&0===this.radius_rt_y&&0===this.radius_rb_x&&0===this.radius_rb_y?this.enable_rounded_corner=0:this.enable_rounded_corner=1):this.enable_rounded_corner=0},Le.prototype.setAntialiasWidth=function(e){(e<=0||e>=1)&&(e=ee.ru),this.aa_width=e};var Ne=Le,Ve=r(4895),Ue=r(3485),Fe=r(879),Be=r(2601),We=r.n(Be),Ge=r(5512),He=r.n(Ge);function je(){return He()('(()=>{var t={2601:(t,r,e)=>{t.exports=e(4444)},3565:(t,r,e)=>{"use strict";var n=e(1960);t.exports=n},2671:(t,r,e)=>{"use strict";e(2344),t.exports=e(5951)},4444:(t,r,e)=>{"use strict";t.exports=e(214)},214:(t,r,e)=>{"use strict";e(397);var n=e(3565);t.exports=n},2159:(t,r,e)=>{"use strict";var n=e(2250),o=e(4640),s=TypeError;t.exports=function(t){if(n(t))return t;throw new s(o(t)+" is not a function")}},6624:(t,r,e)=>{"use strict";var n=e(6285),o=String,s=TypeError;t.exports=function(t){if(n(t))return t;throw new s(o(t)+" is not an object")}},5807:(t,r,e)=>{"use strict";var n=e(1907),o=n({}.toString),s=n("".slice);t.exports=function(t){return s(o(t),8,-1)}},1626:(t,r,e)=>{"use strict";var n=e(9447),o=e(4284),s=e(5817);t.exports=n?function(t,r,e){return o.f(t,r,s(1,e))}:function(t,r,e){return t[r]=e,t}},5817:t=>{"use strict";t.exports=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}}},2532:(t,r,e)=>{"use strict";var n=e(5951),o=Object.defineProperty;t.exports=function(t,r){try{o(n,t,{value:r,configurable:!0,writable:!0})}catch(e){n[t]=r}return r}},9447:(t,r,e)=>{"use strict";var n=e(8828);t.exports=!n((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},9552:(t,r,e)=>{"use strict";var n=e(5951),o=e(6285),s=n.document,i=o(s)&&o(s.createElement);t.exports=function(t){return i?s.createElement(t):{}}},6794:(t,r,e)=>{"use strict";var n=e(5951).navigator,o=n&&n.userAgent;t.exports=o?String(o):""},798:(t,r,e)=>{"use strict";var n,o,s=e(5951),i=e(6794),u=s.process,c=s.Deno,a=u&&u.versions||c&&c.version,p=a&&a.v8;p&&(o=(n=p.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!o&&i&&(!(n=i.match(/Edge\\/(\\d+)/))||n[1]>=74)&&(n=i.match(/Chrome\\/(\\d+)/))&&(o=+n[1]),t.exports=o},1091:(t,r,e)=>{"use strict";var n=e(5951),o=e(6024),s=e(2361),i=e(2250),u=e(3846).f,c=e(7463),a=e(2046),p=e(8311),f=e(1626),l=e(9724);e(6128);var v=function(t){var r=function(e,n,s){if(this instanceof r){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,s)}return o(t,this,arguments)};return r.prototype=t.prototype,r};t.exports=function(t,r){var e,o,y,b,h,x,d,g,m,w=t.target,j=t.global,O=t.stat,S=t.proto,P=j?n:O?n[w]:n[w]&&n[w].prototype,T=j?a:a[w]||f(a,w,{})[w],k=T.prototype;for(b in r)o=!(e=c(j?b:w+(O?".":"#")+b,t.forced))&&P&&l(P,b),x=T[b],o&&(d=t.dontCallGetSet?(m=u(P,b))&&m.value:P[b]),h=o&&d?d:r[b],(e||S||typeof x!=typeof h)&&(g=t.bind&&o?p(h,n):t.wrap&&o?v(h):S&&i(h)?s(h):h,(t.sham||h&&h.sham||x&&x.sham)&&f(g,"sham",!0),f(T,b,g),S&&(l(a,y=w+"Prototype")||f(a,y,{}),f(a[y],b,h),t.real&&k&&(e||!k[b])&&f(k,b,h)))}},8828:t=>{"use strict";t.exports=function(t){try{return!!t()}catch(t){return!0}}},6024:(t,r,e)=>{"use strict";var n=e(1505),o=Function.prototype,s=o.apply,i=o.call;t.exports="object"==typeof Reflect&&Reflect.apply||(n?i.bind(s):function(){return i.apply(s,arguments)})},8311:(t,r,e)=>{"use strict";var n=e(2361),o=e(2159),s=e(1505),i=n(n.bind);t.exports=function(t,r){return o(t),void 0===r?t:s?i(t,r):function(){return t.apply(r,arguments)}}},1505:(t,r,e)=>{"use strict";var n=e(8828);t.exports=!n((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},3930:(t,r,e)=>{"use strict";var n=e(1505),o=Function.prototype.call;t.exports=n?o.bind(o):function(){return o.apply(o,arguments)}},2361:(t,r,e)=>{"use strict";var n=e(5807),o=e(1907);t.exports=function(t){if("Function"===n(t))return o(t)}},1907:(t,r,e)=>{"use strict";var n=e(1505),o=Function.prototype,s=o.call,i=n&&o.bind.bind(s,s);t.exports=n?i:function(t){return function(){return s.apply(t,arguments)}}},5582:(t,r,e)=>{"use strict";var n=e(2046),o=e(5951),s=e(2250),i=function(t){return s(t)?t:void 0};t.exports=function(t,r){return arguments.length<2?i(n[t])||i(o[t]):n[t]&&n[t][r]||o[t]&&o[t][r]}},9367:(t,r,e)=>{"use strict";var n=e(2159),o=e(7136);t.exports=function(t,r){var e=t[r];return o(e)?void 0:n(e)}},5951:function(t,r,e){"use strict";var n=function(t){return t&&t.Math===Math&&t};t.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof e.g&&e.g)||n("object"==typeof this&&this)||function(){return this}()||Function("return this")()},9724:(t,r,e)=>{"use strict";var n=e(1907),o=e(9298),s=n({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,r){return s(o(t),r)}},3648:(t,r,e)=>{"use strict";var n=e(9447),o=e(8828),s=e(9552);t.exports=!n&&!o((function(){return 7!==Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))},6946:(t,r,e)=>{"use strict";var n=e(1907),o=e(8828),s=e(5807),i=Object,u=n("".split);t.exports=o((function(){return!i("z").propertyIsEnumerable(0)}))?function(t){return"String"===s(t)?u(t,""):i(t)}:i},2250:t=>{"use strict";var r="object"==typeof document&&document.all;t.exports=void 0===r&&void 0!==r?function(t){return"function"==typeof t||t===r}:function(t){return"function"==typeof t}},7463:(t,r,e)=>{"use strict";var n=e(8828),o=e(2250),s=/#|\\.prototype\\./,i=function(t,r){var e=c[u(t)];return e===p||e!==a&&(o(r)?n(r):!!r)},u=i.normalize=function(t){return String(t).replace(s,".").toLowerCase()},c=i.data={},a=i.NATIVE="N",p=i.POLYFILL="P";t.exports=i},7136:t=>{"use strict";t.exports=function(t){return null==t}},6285:(t,r,e)=>{"use strict";var n=e(2250);t.exports=function(t){return"object"==typeof t?null!==t:n(t)}},7376:t=>{"use strict";t.exports=!0},5594:(t,r,e)=>{"use strict";var n=e(5582),o=e(2250),s=e(8280),i=e(1175),u=Object;t.exports=i?function(t){return"symbol"==typeof t}:function(t){var r=n("Symbol");return o(r)&&s(r.prototype,u(t))}},4284:(t,r,e)=>{"use strict";var n=e(9447),o=e(3648),s=e(8661),i=e(6624),u=e(470),c=TypeError,a=Object.defineProperty,p=Object.getOwnPropertyDescriptor,f="enumerable",l="configurable",v="writable";r.f=n?s?function(t,r,e){if(i(t),r=u(r),i(e),"function"==typeof t&&"prototype"===r&&"value"in e&&v in e&&!e[v]){var n=p(t,r);n&&n[v]&&(t[r]=e.value,e={configurable:l in e?e[l]:n[l],enumerable:f in e?e[f]:n[f],writable:!1})}return a(t,r,e)}:a:function(t,r,e){if(i(t),r=u(r),i(e),o)try{return a(t,r,e)}catch(t){}if("get"in e||"set"in e)throw new c("Accessors not supported");return"value"in e&&(t[r]=e.value),t}},3846:(t,r,e)=>{"use strict";var n=e(9447),o=e(3930),s=e(2574),i=e(5817),u=e(7374),c=e(470),a=e(9724),p=e(3648),f=Object.getOwnPropertyDescriptor;r.f=n?f:function(t,r){if(t=u(t),r=c(r),p)try{return f(t,r)}catch(t){}if(a(t,r))return i(!o(s.f,t,r),t[r])}},8280:(t,r,e)=>{"use strict";var n=e(1907);t.exports=n({}.isPrototypeOf)},2574:(t,r)=>{"use strict";var e={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,o=n&&!e.call({1:2},1);r.f=o?function(t){var r=n(this,t);return!!r&&r.enumerable}:e},581:(t,r,e)=>{"use strict";var n=e(3930),o=e(2250),s=e(6285),i=TypeError;t.exports=function(t,r){var e,u;if("string"===r&&o(e=t.toString)&&!s(u=n(e,t)))return u;if(o(e=t.valueOf)&&!s(u=n(e,t)))return u;if("string"!==r&&o(e=t.toString)&&!s(u=n(e,t)))return u;throw new i("Can\'t convert object to primitive value")}},2046:t=>{"use strict";t.exports={}},4239:(t,r,e)=>{"use strict";var n=e(7136),o=TypeError;t.exports=function(t){if(n(t))throw new o("Can\'t call method on "+t);return t}},6128:(t,r,e)=>{"use strict";var n=e(7376),o=e(5951),s=e(2532),i="__core-js_shared__",u=t.exports=o[i]||s(i,{});(u.versions||(u.versions=[])).push({version:"3.39.0",mode:n?"pure":"global",copyright:" 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"})},5816:(t,r,e)=>{"use strict";var n=e(6128);t.exports=function(t,r){return n[t]||(n[t]=r||{})}},9846:(t,r,e)=>{"use strict";var n=e(798),o=e(8828),s=e(5951).String;t.exports=!!Object.getOwnPropertySymbols&&!o((function(){var t=Symbol("symbol detection");return!s(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},7374:(t,r,e)=>{"use strict";var n=e(6946),o=e(4239);t.exports=function(t){return n(o(t))}},9298:(t,r,e)=>{"use strict";var n=e(4239),o=Object;t.exports=function(t){return o(n(t))}},6028:(t,r,e)=>{"use strict";var n=e(3930),o=e(6285),s=e(5594),i=e(9367),u=e(581),c=e(6264),a=TypeError,p=c("toPrimitive");t.exports=function(t,r){if(!o(t)||s(t))return t;var e,c=i(t,p);if(c){if(void 0===r&&(r="default"),e=n(c,t,r),!o(e)||s(e))return e;throw new a("Can\'t convert object to primitive value")}return void 0===r&&(r="number"),u(t,r)}},470:(t,r,e)=>{"use strict";var n=e(6028),o=e(5594);t.exports=function(t){var r=n(t,"string");return o(r)?r:r+""}},4640:t=>{"use strict";var r=String;t.exports=function(t){try{return r(t)}catch(t){return"Object"}}},6499:(t,r,e)=>{"use strict";var n=e(1907),o=0,s=Math.random(),i=n(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+i(++o+s,36)}},1175:(t,r,e)=>{"use strict";var n=e(9846);t.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},8661:(t,r,e)=>{"use strict";var n=e(9447),o=e(8828);t.exports=n&&o((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},6264:(t,r,e)=>{"use strict";var n=e(5951),o=e(5816),s=e(9724),i=e(6499),u=e(9846),c=e(1175),a=n.Symbol,p=o("wks"),f=c?a.for||a:a&&a.withoutSetter||i;t.exports=function(t){return s(p,t)||(p[t]=u&&s(a,t)?a[t]:f("Symbol."+t)),p[t]}},2344:(t,r,e)=>{"use strict";var n=e(1091),o=e(5951);n({global:!0,forced:o.globalThis!==o},{globalThis:o})},397:(t,r,e)=>{"use strict";e(2344)},1960:(t,r,e)=>{"use strict";var n=e(2671);t.exports=n}},r={};function e(n){var o=r[n];if(void 0!==o)return o.exports;var s=r[n]={exports:{}};return t[n].call(s.exports,s,s.exports,e),s.exports}e.n=t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},e.d=(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),e.o=(t,r)=>Object.prototype.hasOwnProperty.call(t,r),(()=>{"use strict";var t=e(2601),r=e.n(t);r().onmessage=async function(){try{const t=await async function(){let t={};return t.supportVideoFrameInWorker="function"==typeof r().VideoFrame,t.supportVideoTrackGeneratorInWorker="function"==typeof r().VideoTrackGenerator,t.supportOffscreenCanvasInWorker="function"==typeof r().OffscreenCanvas,t.supportImageBitmapRenderingInWorker="function"==typeof r().ImageBitmapRenderingContext,t.supportTransferableTrackAcrossWork=(()=>{if("function"!=typeof r().VideoTrackGenerator)return!1;try{const t=(new VideoTrackGenerator).track;return(new MessageChannel).port1.postMessage(t,[t]),!0}catch(t){return!1}})(),t.supportsRequestAnimationFrameInWork="function"==typeof requestAnimationFrame,t}();self.postMessage({result:t}),self.close()}catch(t){self.postMessage({error:t.message}),self.close()}}})()})();\n',"Worker",{name:"zoom-helper"},void 0)}var Ke=r(4865),ze=D((function e(){R(this,e)}),null,[{key:"init",value:function(){var e=H(O().mark((function e(t,r){var n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.navigator.hid&&window.navigator.hid.requestDevice){e.next=2;break}return e.abrupt("return",!1);case 2:return n=this.webHid=new qe((function(e){switch(e.eventName){case"ondevicehookswitch":g.A.Notify_APPUI_SAFE(p.$8e,"on"===e.hookStatus);break;case"ondevicemuteswitch":g.A.Notify_APPUI_SAFE(p.tjY,e.isMute)}})),e.next=5,n.open({label:t,muted:r,hookStatus:"off"});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"sendReport",value:function(e,t){switch(e){case"hookswitch":this.webHid.sendDeviceReport({command:t?"offHook":"onHook"});break;case"mute":this.webHid.sendDeviceReport({command:t?"muteOn":"muteOff"})}}},{key:"destroy",value:function(){var e=H(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.webHid.close();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),qe=D((function e(t){R(this,e),this.deviceUsage={mute:{usageId:524297,usageName:"Mute"},offHook:{usageId:524311,usageName:"Off Hook"},ring:{usageId:524312,usageName:"Ring"},hookSwitch:{usageId:720928,usageName:"Hook Switch"},phoneMute:{usageId:720943,usageName:"Phone Mute"}},this.deviceCommand={outputReport:{mute:{reportId:0,usageOffset:-1},offHook:{reportId:0,usageOffset:-1},ring:{reportId:0,itemIndex:-1}},inputReport:{hookSwitch:{reportId:0,usageOffset:-1,isAbsolute:!1},phoneMute:{reportId:0,usageOffset:-1,isAbsolute:!1}}},this.device=null,this.inputReportRetFunc=t}),[{key:"getHexByte",value:function(e){for(var t=Number(e).toString(16);t.length<2;)t="0"+t;return t}},{key:"getHexByteStr",value:function(e){for(var t="",r=0;r<e.byteLength;++r)t+=this.getHexByte(e.getUint8(r))+" ";return t}},{key:"parseDeviceDescriptors",value:function(){try{if(this.outputEventGenerators=new Map,!this.device||!this.device.collections)return;var e=this.device.collections.find((function(e){return 11===e.usagePage}));if(!e||0===Object.keys(e).length)return;if(e.inputReports&&!this.parseInputReports(e.inputReports))return!1;if(e.outputReports)return!!this.parseOutputReports(e.outputReports)}catch(e){console.error("parseDeviceDescriptors error:"+JSON.stringify(e,null,"    "))}}},{key:"parseInputReports",value:function(e){var t=this;return e.forEach((function(e){if(e.items.length&&void 0!==e.reportId){var r=0;e.items.forEach((function(n){void 0!==n.usages&&void 0!==n.reportSize&&void 0!==n.reportCount&&void 0!==n.isAbsolute&&(n.usages.forEach((function(i,a){switch(i){case t.deviceUsage.hookSwitch.usageId:t.deviceCommand.inputReport.hookSwitch={reportId:e.reportId,usageOffset:r+a*n.reportSize,isAbsolute:n.isAbsolute};break;case t.deviceUsage.phoneMute.usageId:t.deviceCommand.inputReport.phoneMute={reportId:e.reportId,usageOffset:r+a*n.reportSize,isAbsolute:n.isAbsolute}}})),r+=n.reportCount*n.reportSize)}))}})),0!==this.deviceCommand.inputReport.phoneMute.reportData&&0!==this.deviceCommand.inputReport.hookSwitch}},{key:"parseOutputReports",value:function(e){var t,r,n,i=this;for(var a in e.forEach((function(e){if(e.items.length&&void 0!==e.reportId){var t=0,r=new Map;e.items.forEach((function(n){void 0!==n.usages&&void 0!==n.reportSize&&void 0!==n.reportCount&&(n.usages.forEach((function(a,o){switch(a){case i.deviceUsage.mute.usageId:i.deviceCommand.outputReport.mute={reportId:e.reportId,usageOffset:t+o*n.reportSize},r.set(a,t+o*n.reportSize);break;case i.deviceUsage.offHook.usageId:i.deviceCommand.outputReport.offHook={reportId:e.reportId,usageOffset:t+o*n.reportSize},r.set(a,t+o*n.reportSize);break;case i.deviceUsage.ring.usageId:i.deviceCommand.outputReport.ring={reportId:e.reportId,usageOffset:t+o*n.reportSize},r.set(a,t+o*n.reportSize)}})),t+=n.reportCount*n.reportSize)}));var n,a=t,o=A(r);try{var s=function(){var e=v(n.value,2),t=e[0],r=e[1];i.outputEventGenerators[t]=function(e){var t=new Uint8Array(a/8);if(r>=0&&e){var n=Math.trunc(r/8),i=r%8;t[n]=1<<i}return t}};for(o.s();!(n=o.n()).done;)s()}catch(e){o.e(e)}finally{o.f()}}})),this.outputEventGenerators){var o=this.getHexByte(a);o="0x0"+o,this.deviceUsage.mute.usageId===Number(o)?t=this.outputEventGenerators[this.deviceUsage.mute.usageId]:this.deviceUsage.offHook.usageId===Number(o)?n=this.outputEventGenerators[this.deviceUsage.offHook.usageId]:this.deviceUsage.ring.usageId===Number(o)&&(r=this.outputEventGenerators[this.deviceUsage.ring.usageId])}return!!(t||r||n)}},{key:"open",value:function(){var e=H(O().mark((function e(t){var r,n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.hid.getDevices();case 2:if((r=e.sent).length&&(this.device=r.find((function(e){return t.label.includes(e.productName)}))),this.device){e.next=15;break}return n=[],e.prev=5,e.next=8,navigator.hid.requestDevice({filters:[{usagePage:11}]});case 8:n=e.sent,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(5),m.Ay.error("hid requestDevice error");case 14:n.length&&(this.device=n.find((function(e){return t.label.includes(e.productName)})));case 15:if(this.device){e.next=17;break}return e.abrupt("return",!1);case 17:if(e.prev=17,e.t1=this.device.opened,!e.t1){e.next=22;break}return e.next=22,this.device.close();case 22:return e.next=24,this.device.open();case 24:if(e.t2=!!this.parseDeviceDescriptors(),!e.t2){e.next=31;break}return e.next=28,this.handleInputReport.bind(this);case 28:this.device.oninputreport=e.sent,this.resetState({muted:t.muted,hookStatus:t.hookStatus}),e.t2=!0;case 31:return e.abrupt("return",e.t2);case 34:e.prev=34,e.t3=e.catch(17),console.error("error content:"+e.t3);case 37:case"end":return e.stop()}}),e,this,[[5,11],[17,34]])})));return function(t){return e.apply(this,arguments)}}()},{key:"close",value:function(){var e=H(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.resetState({muted:!1,hookStatus:"on"}),this.device){e.next=3;break}return e.abrupt("return");case 3:if(e.t0=this.device&&this.device.opened,!e.t0){e.next=7;break}return e.next=7,this.device.close();case 7:this.device.oninputreport=null,this.device=null,e.next=14;break;case 11:e.prev=11,e.t1=e.catch(0),console.error(e.t1);case 14:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"resetState",value:function(e){var t=e.muted,r=e.hookStatus;this.device&&this.device.opened&&(this.device.hookStatus=r,this.device.muted=t,this.device.ring=!1,this.sendDeviceReport({command:"off"===r?"offHook":"onHook"}),this.sendDeviceReport({command:t?"muteOn":"muteOff"}))}},{key:"sendDeviceReport",value:function(){var e=H(O().mark((function e(t){var r,n,i,a,o,s,u,c,d,l,h,f,p,g,m,y,_,S,b,E,k,C,w,T,R,I;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.command&&this.device&&this.device.opened){e.next=2;break}return e.abrupt("return");case 2:if("muteOn"!==t.command&&"muteOff"!==t.command){e.next=7;break}if(this.outputEventGenerators[this.deviceUsage.mute.usageId]){e.next=5;break}return e.abrupt("return");case 5:e.next=14;break;case 7:if("onHook"!==t.command&&"offHook"!==t.command){e.next=12;break}if(this.outputEventGenerators[this.deviceUsage.offHook.usageId]){e.next=10;break}return e.abrupt("return");case 10:e.next=14;break;case 12:if("onRing"!==t.command&&"offRing"!==t.command||this.outputEventGenerators[this.deviceUsage.ring.usageId]){e.next=14;break}return e.abrupt("return");case 14:l=0,h=null,e.t0=t.command,e.next="muteOn"===e.t0||"muteOff"===e.t0?18:"onHook"===e.t0||"offHook"===e.t0?20:"onRing"===e.t0||"offRing"===e.t0?22:24;break;case 18:return l=this.deviceCommand.outputReport.mute.reportId,e.abrupt("break",25);case 20:return l=this.deviceCommand.outputReport.offHook.reportId,e.abrupt("break",25);case 22:return l=this.deviceCommand.outputReport.ring.reportId,e.abrupt("break",25);case 24:return e.abrupt("return");case 25:if(0==l){e.next=68;break}if(n=this.device.muted,"off"!==this.device.hookStatus){e.next=30;break}r=!0,e.next=33;break;case 30:if("on"===this.device.hookStatus){e.next=32;break}return e.abrupt("return");case 32:r=!1;case 33:e.t1=(i=this.device.ring,t.command),e.next="muteOn"===e.t1?36:"muteOff"===e.t1?38:"onHook"===e.t1?40:"offHook"===e.t1?42:"onRing"===e.t1?44:"offRing"===e.t1?46:48;break;case 36:return o=!0,e.abrupt("break",49);case 38:return o=!1,e.abrupt("break",49);case 40:return a=!1,e.abrupt("break",49);case 42:return a=!0,e.abrupt("break",49);case 44:return s=!0,e.abrupt("break",49);case 46:return s=!1,e.abrupt("break",49);case 48:return e.abrupt("return");case 49:if(this.outputEventGenerators[this.deviceUsage.mute.usageId]&&(c=void 0===o?this.outputEventGenerators[this.deviceUsage.mute.usageId](n):this.outputEventGenerators[this.deviceUsage.mute.usageId](o)),this.outputEventGenerators[this.deviceUsage.offHook.usageId]&&(u=void 0===a?this.outputEventGenerators[this.deviceUsage.offHook.usageId](r):this.outputEventGenerators[this.deviceUsage.offHook.usageId](a)),this.outputEventGenerators[this.deviceUsage.ring.usageId]&&(d=void 0===s?this.outputEventGenerators[this.deviceUsage.ring.usageId](i):this.outputEventGenerators[this.deviceUsage.ring.usageId](s)),l===this.deviceCommand.outputReport.mute.reportId)if(null===h)h=new Uint8Array(c);else{f=A(c.entries());try{for(f.s();!(p=f.n()).done;)g=v(p.value,2),m=g[0],y=g[1],h[m]|=y}catch(e){f.e(e)}finally{f.f()}}if(l===this.deviceCommand.outputReport.offHook.reportId)if(null===h)h=new Uint8Array(u);else{_=A(u.entries());try{for(_.s();!(S=_.n()).done;)b=v(S.value,2),E=b[0],k=b[1],h[E]|=k}catch(e){_.e(e)}finally{_.f()}}if(l===this.deviceCommand.outputReport.ring.reportId)if(null===h)h=new Uint8Array(d);else{C=A(d.entries());try{for(C.s();!(w=C.n()).done;)T=v(w.value,2),R=T[0],I=T[1],h[R]|=I}catch(e){C.e(e)}finally{C.f()}}return e.next=54,this.device.sendReport(l,h);case 54:e.t2=t.command,e.next="muteOn"===e.t2?57:"muteOff"===e.t2?59:"onHook"===e.t2?61:"offHook"===e.t2?63:"onRing"===e.t2?65:"offRing"===e.t2?67:68;break;case 57:return this.device.muted=!0,e.abrupt("break",68);case 59:return this.device.muted=!1,e.abrupt("break",68);case 61:return this.device.hookStatus="on",e.abrupt("break",68);case 63:return this.device.hookStatus="off",e.abrupt("break",68);case 65:return this.device.ring=!0,e.abrupt("break",68);case 67:this.device.ring=!1;case 68:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendReplyReport",value:function(){var e=H(O().mark((function e(t,r,n){var i,a,o,s,u,c,d,l,h,f;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=0,this.deviceCommand.outputReport.offHook.reportId===this.deviceCommand.outputReport.mute.reportId||t===this.deviceCommand.inputReport.hookSwitch.reportId?u=this.deviceCommand.outputReport.offHook.reportId:t===this.deviceCommand.inputReport.phoneMute.reportId&&(u=this.deviceCommand.outputReport.mute.reportId),!this.device||!this.device.opened||0===u||void 0===r||void 0===n){e.next=5;break}if(this.deviceCommand.outputReport.offHook.reportId===this.deviceCommand.outputReport.mute.reportId){a=this.outputEventGenerators[this.deviceUsage.mute.usageId](n),o=this.outputEventGenerators[this.deviceUsage.offHook.usageId](r),i=new Uint8Array(o),c=A(a.entries());try{for(c.s();!(d=c.n()).done;)l=v(d.value,2),h=l[0],f=l[1],i[h]|=f}catch(e){c.e(e)}finally{c.f()}}else u===this.deviceCommand.outputReport.offHook.reportId?(o=this.outputEventGenerators[this.deviceUsage.offHook.usageId](r),i=new Uint8Array(o)):u===this.deviceCommand.outputReport.mute.reportId?(a=this.outputEventGenerators[this.deviceUsage.mute.usageId](n),i=new Uint8Array(a)):u===this.deviceCommand.outputReport.ring.reportId&&(s=this.outputEventGenerators[this.deviceUsage.mute.usageId](n),i=new Uint8Array(s));return e.next=5,this.device.sendReport(u,i);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"handleInputReport",value:function(e){var t=this;try{var r=e.data,n=e.device,i=e.reportId;if(0===i)return;var a=t.deviceCommand.inputReport;if(i!==a.hookSwitch.reportId&&i!==a.phoneMute.reportId)return;var o=!1,s=!1,u=new Uint8Array(r.buffer);if(i===a.hookSwitch.reportId){var c=a.hookSwitch,d=Math.trunc(c.usageOffset/8),l=c.usageOffset%8,h=!!(r.getUint8(d)&1<<l);a.hookSwitch.isAbsolute?"on"===t.device.hookStatus&&h?(t.device.hookStatus="off",o=!0):"off"!==t.device.hookStatus||h||(t.device.hookStatus="on",o=!0):h&&(t.device.hookStatus="off"===t.device.hookStatus?"on":"off",o=!0)}if(t.device.muted,i===a.phoneMute.reportId){var f=a.phoneMute,p=Math.trunc(f.usageOffset/8),v=f.usageOffset%8,g=!!(r.getUint8(p)&1<<v);a.phoneMute.isAbsolute?t.device.muted!=g&&(t.device.muted=g,s=!0):g&&(t.device.muted=!t.device.muted,s=!0)}var m={productName:n.productName,reportId:t.getHexByte(i),reportData:u};if(o&&(m.eventName="ondevicehookswitch",m.hookStatus=t.device.hookStatus),s&&(m.eventName="ondevicemuteswitch",m.isMute=t.device.muted),t.inputReportRetFunc&&t.inputReportRetFunc(m),o||s){var y;if("off"===this.device.hookStatus)y=!0;else{if("on"!==this.device.hookStatus)return;y=!1}t.sendReplyReport(i,y,t.device.muted)}}catch(e){console.error(e)}}}]),Ye=r(3323),Xe=r(6206),Qe=r.n(Xe),Je=w(w(w(w(w(w({},N._c.AUDIO_ENCODE,"audioEncodeInitInstance"),N._c.AUDIO_DECODE,"audioDecInitInstance"),N._c.VIDEO_ENCODE,"videoInitInstance"),N._c.VIDEO_DECODE,"videoDecInitInstance"),N._c.SHARING_ENCODE,"sharingEncInitInstance"),N._c.SHARING_DECODE,"sharingDecInitInstance"),$e=D((function e(){R(this,e),this.logWriterMap=window.logWriterMap=new Map,this.inited=!1}),[{key:"init",value:function(){var e=H(O().mark((function e(){var t=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.inited||(this.inited=!0,Object.values(N._c).forEach(function(){var e=H(O().mark((function e(r){var n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H(O().mark((function e(){var t;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Xe.FileWriter({maxDaysToKeepFile:1,fileSizeQuota:10485760}),e.abrupt("return",new Promise((function(e){t.on("initOK",(function(){e(t)}))})));case 2:case"end":return e.stop()}}),e)})))();case 2:return n=e.sent,t.logWriterMap.set(r,n),e.next=6,g.A[Je[r]].waitforInitSuccess();case 6:i=n.createMessagePort(),(0,_.pushMessageToWorker)(r,i,"local_log_port",!0,!0),n.startWriteNormalLogFile({filenamePrefix:N.is[r],filenameExtension:".log",timestamp:!1,newLine:!1}),n.on("startWriteNormalLogFileReady",(function(){(0,_.pushMessageToWorker)(r,null,"local_log_ready",!1,!0)}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"saveLogFileByWorkerType",value:function(e){var t=this.logWriterMap.get(e);t&&t.saveLog()}},{key:"saveAllLogFiles",value:function(){Qe().selectSaveDir().then((function(){Object.values(N._c).forEach((function(e){Qe().saveLog({filenamePrefix:N.is[e],filenameExtension:".log"})}))}))}}]),Ze=r(242),et=D((function e(){R(this,e),this.timeMap=new Map,this.baseTime=0,this.totalTime=0}),[{key:"flushTimeMap",value:function(){var e=performance.now(),t=this.timeMap.get(this.status)||0,r=e-this.baseTime;this.timeMap.set(this.status,t+r),this.baseTime=e,this.totalTime+=r}},{key:"start",value:function(e){this.status=e,this.baseTime=performance.now()}},{key:"update",value:function(e){e!==this.status&&(this.flushTimeMap(),this.status=e)}},{key:"end",value:function(){this.flushTimeMap();var e,t={},r=A(this.timeMap);try{for(r.s();!(e=r.n()).done;){var n=v(e.value,2),i=n[0],a=n[1];t[String(i)]=Number((a/this.totalTime*100).toFixed(2))}}catch(e){r.e(e)}finally{r.f()}return t}}]),tt=D((function e(){var t=this;R(this,e),this.pressureLevel={nominal:0,fair:1,serious:2,critical:3},this.pressureStatisticHelper=new et,this.observer=new PressureObserver((function(e){t.result=t.pressureLevel[e[0].state],K.A.add_monitor("CPC:"+t.result),t.pressureStatisticHelper.update(e[0].state)}))}),[{key:"init",value:function(){var e=this;this.initPromise=this.observer.observe("cpu").then((function(){e.pressureStatisticHelper.start("nominal")})).catch((function(e){(h.Ay.isWindows()||h.Ay.isMac()||h.Ay.isChromeOS())&&m.Ay.warn("ComputePressure observe error: ",e)})).finally((function(){e.initPromise=null}))}},{key:"destroy",value:function(){var e=this;if(this.initPromise)this.initPromise.then((function(){e.observer.unobserve("cpu");var t=e.pressureStatisticHelper.end();m.Ay.log("CPU pressure report: ".concat(JSON.stringify(t)))}));else{this.observer.unobserve("cpu");var t=this.pressureStatisticHelper.end();m.Ay.log("CPU pressure report: ".concat(JSON.stringify(t)))}}}]);(0,i.A)(tt,"isSupportComputePressure",(function(){return"function"==typeof PressureObserver}));var rt=r(2754),nt=r(5600),it={mgr:null,config:Ve.X,capabilities:Fe.f,userAgent:Ue.l,tracing:{add_monitor:function(e){(0,nt.r9)(e)},globaltracing_error:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,nt.r1)(e,t)},Log_Error:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,nt.Yd)(e,t)}},graphics:{create_webgl_context_failed_monitor:function(e){(0,nt.S_)(e)},calculateUVCoord:function(e,t,r,n){return function(e,t,r,n){if(!e||!t||!r)return null;var i=t.width/t.height,a=t.width,o=t.height;if(t.width>e.width||t.height>e.height){var s=e.width/t.width,u=e.height/t.height,c=Math.min(s,u);a*=c,o*=c}var d=0,l=0;e.width/e.height>i?(l=Math.floor(e.height/o)*o,(d=Math.floor(l*i/a)*a)>e.width&&(d=Math.floor(e.width/a)*a,l=Math.floor(d/i/o)*o)):(d=Math.floor(e.width/a)*a,(l=Math.floor(d/i/o)*o)>e.height&&(l=Math.floor(e.height/o)*o,d=Math.floor(l*i/a)*a));var h=0,f=0,p=0,v=0,g={x:f,y:h,w:p,h:v};n==ee.vL?(h=1-(h+(o-1)/e.height),f=t.left/e.width,v=1-t.top/e.height,p=f+a/e.width,g.x=f,g.y=1-v,g.w=p,g.h=1-h):n==ee.mN?(f=1-(h+(o-1)/e.height),p=1-t.top/e.height,h=t.left/e.width,v=f+a/e.width):n==ee.G7?(h=t.top/e.height,f=t.left/e.width,v=h+(o-1)/e.height,p=f+a/e.width):n==ee.Ur&&(f=t.top/e.height,p=h+(o-1)/e.height,h=t.left/e.width,v=f+a/e.width);for(var m=[],y=[{x:p,y:v},{x:p,y:h},{x:f,y:h},{x:p,y:v},{x:f,y:v},{x:f,y:h}],_=0;_<y.length;++_){var S={u:y[_].x,v:y[_].y};m.push(S)}for(var A=[],b=0;b<m.length;++b){var E=m[b];A.push(E.u),A.push(E.v)}return{uvCoords:A,uvRect:g}}(e,t,r,n)},calculateUVCoordsForMultiView:function(e,t,r,n,i,a){return function(e,t,r,n,i,a){var o=0,s=0,u=0,c=0,d={x:s,y:o,w:u,h:c};if(e){var l=i==ee.mN||i==ee.Ur?t.height/t.width:t.width/t.height,h=n.left||0,f=n.top||0;if(n.width/n.height>l){var p=n.height*l;o=f/r.height,s=(Math.round((n.width-p)/2)+h)/r.width,c=o+(n.height-1)/r.height,u=s+p/r.width}else{var v=n.width/l;o=(Math.round((n.height-v)/2)+f)/r.height,s=h/r.width,c=o+(v-1)/r.height,u=s+n.width/r.width}i==ee.vL?(o=1-(o+(n.height-1)/r.height),s=n.left/r.width,c=1-n.top/r.height,u=s+n.width/r.width):i==ee.mN?(s=1-(o+(n.height-1)/r.height),u=1-n.top/r.height,o=n.left/r.width,c=s+n.width/r.width):i==ee.G7?(o=n.top/r.height,s=n.left/r.width,c=o+(n.height-1)/r.height,u=s+n.width/r.width):i==ee.Ur&&(s=n.top/r.height,u=o+(n.height-1)/r.height,o=n.left/r.width,c=s+n.width/r.width)}else{var g=n.width/n.height,m=n.width,y=n.height;if(n.width>r.width||n.height>r.height){var _=r.width/n.width,S=r.height/n.height,A=Math.min(_,S);m*=A,y*=A}var b=0,E=0;r.width/r.height>g?(E=Math.floor(r.height/y)*y,(b=Math.floor(E*g/m)*m)>r.width&&(b=Math.floor(r.width/m)*m,E=Math.floor(b/g/y)*y)):(b=Math.floor(r.width/m)*m,(E=Math.floor(b/g/y)*y)>r.height&&(E=Math.floor(r.height/y)*y,b=Math.floor(E*g/m)*m)),i==ee.vL?(o=1-(o+(y-1)/r.height),s=n.left/r.width,c=1-n.top/r.height,u=s+m/r.width,d.x=s,d.y=1-c,d.w=u,d.h=1-o,n.height>n.width&&(s=Ae(s,2),u=Se(u,2))):i==ee.mN?(s=1-(o+(y-1)/r.height),u=1-n.top/r.height,o=n.left/r.width,c=s+m/r.width):i==ee.G7?(o=n.top/r.height,s=n.left/r.width,c=o+(y-1)/r.height,u=s+m/r.width):i==ee.Ur&&(s=n.top/r.height,u=o+(y-1)/r.height,o=n.left/r.width,c=s+m/r.width)}for(var k=[],C=[{x:u,y:c},{x:u,y:o},{x:s,y:o},{x:u,y:c},{x:s,y:c},{x:s,y:o}],w=0;w<C.length;++w){var T=null;if(a){var R=-1*Math.abs(C[w].x);C[w].x=R,T={u:C[w].x+1,v:C[w].y}}else T={u:C[w].x,v:C[w].y};k.push(T)}for(var I=[],D=0;D<k.length;++D){var M=k[D];I.push(M.u),I.push(M.v)}return{uvCoords:I,uvRect:d}}(e,t,r,n,i,a)},calculateRenderRect:function(e,t){return r=e,i=0,a=0,o=0,s=0,u=(n=t).width/n.height,r.width/r.height>u?(i=(a=r.height)*u,o=(r.width-i)/2,s=0):(a=(i=r.width)/u,o=0,s=(r.height-a)/2),i<=r.canvas.width&&(o=(r.canvas.width-i)/2),a<=r.canvas.height&&(s=(r.canvas.height-a)/2),{x:o,y:s,width:i,height:a};var r,n,i,a,o,s,u},evalCroppingRect:function(e,t){return function(e,t){if(!e||null==t)throw new Error("evalCroppingRect() invalid parameters!");return t===ee.mN||t===ee.Ur?{top:e.top,left:e.left,width:e.height,height:e.width}:e}(e,t)}},assertion:{assert:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";(0,rt.vA)(e,t)},assertWithFailed:function(e){(0,rt.Yu)(e)},abstractMethod:function(){(0,rt.KR)()},unreachable:function(){(0,rt.HB)()}}},at=new(D((function e(){R(this,e),this.moduleCache=new Map,We().__dyn_modules__={}}),[{key:"loadModuleFromBlob",value:function(e,t,r){if(this.moduleCache.has(e))return this.moduleCache.get(e);this.moduleCache.set(e,void 0);try{var n,i=u().createObjectURL(t);return(0,rt.vA)("function"==typeof importScripts),importScripts(i),(n=We().__dyn_modules__[e])&&"function"==typeof n.init&&(n.init(it,r),this.moduleCache.set(e,n)),n}catch(t){(0,nt.Yd)("[DynModuleMgr] loadModuleFromBlob Error: ".concat(e),t)}}},{key:"getModule",value:function(e){return this.moduleCache.get(e)||void 0}}]));function ot(e,t,r){st(e,t),t.set(e,r)}function st(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ut(e,t,r){return e.set(dt(e,t),r),r}function ct(e,t){return e.get(dt(e,t))}function dt(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var lt=new WeakMap,ht=new WeakMap,ft=new WeakMap,pt=new WeakMap,vt=new WeakSet;function gt(){return!0}function mt(){if(ct(ft,this)){var e={};return e.architecture=ct(ft,this).architecture,e.vendor=ct(ft,this).vendor,e}return null}function yt(){return _t.apply(this,arguments)}function _t(){return(_t=H(O().mark((function e(){var t;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.gpu){e.next=2;break}return e.abrupt("return",(ut(lt,this,ee.W5.NOT_SUPPORTED),!1));case 2:return e.next=4,navigator.gpu.requestAdapter();case 4:if(!(t=e.sent)){e.next=29;break}return e.next=8,t.requestDevice();case 8:if(!e.sent){e.next=25;break}if("function"!=typeof t.requestAdapterInfo){e.next=20;break}return e.t2=ut,e.t3=ft,e.t4=this,e.next=15,t.requestAdapterInfo();case 15:e.t5=e.sent,(0,e.t2)(e.t3,e.t4,e.t5),ct(ft,this)&&console.log("adapter info: ".concat(ct(ft,this).architecture,", ").concat(ct(ft,this).vendor)),e.next=21;break;case 20:"info"in t&&ut(ft,this,t.info);case 21:ut(lt,this,ee.W5.AVAILABLE),e.t1=!0,e.next=26;break;case 25:e.t1=(ut(lt,this,ee.W5.CANNOT_REQ_DEVICE),!1);case 26:e.t0=e.t1,e.next=30;break;case 29:e.t0=(ut(lt,this,ee.W5.CANNOT_REQ_ADAPTER),!1);case 30:return e.abrupt("return",e.t0);case 31:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function St(e){if(!e)return!1;var t=e.vendor;return-1!==ee.O$.indexOf(t)}function At(e,t,r){return bt.produce(e,t,r)}var bt=D((function e(){R(this,e)}),null,[{key:"produce",value:function(e,t,r){var n=null;return e===ee.h3.WEBGPU&&(n=at.getModule("webgpu_renderer_dynmod").exports.createWebGPURenderer(t,r)),n}}]),Et=D((function e(){var t;R(this,e),st(this,t=vt),t.add(this),ot(this,lt,ee.W5.AVAILABLE),ot(this,ht,ee.h3.WEBGL),ot(this,ft,null),ot(this,pt,new Map)}),[{key:"evaluate",value:function(){var e=H(O().mark((function e(t){var r,n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ut(ht,this,ee.h3.WEBGL),dt(vt,this,gt).call(this)){e.next=2;break}return e.abrupt("return",ct(ht,this));case 2:if(t.allowedOnTargetPlatforms){e.next=4;break}return e.abrupt("return",ct(ht,this));case 4:if(t.allowedOnTargetBrowsers){e.next=6;break}return e.abrupt("return",ct(ht,this));case 6:return e.next=8,dt(vt,this,yt).call(this);case 8:if(e.sent){e.next=10;break}return e.abrupt("return",ct(ht,this));case 10:if(r=dt(vt,this,mt).call(this),dt(vt,this,St).call(this,r)){e.next=13;break}return e.abrupt("return",ct(ht,this));case 13:return n=new OffscreenCanvas(1,1),e.abrupt("return",n.getContext("webgpu")?(n=null,ut(ht,this,ee.h3.WEBGPU),ct(ht,this)):(n=null,ct(ht,this)));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"acquireRenderer",value:function(e,t){var r=null;return arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&ct(pt,this).clear(),ct(pt,this).has(e)&&(r=ct(pt,this).get(e))&&(e&&(r.setCanvas(e),r.initialize(e)),t&&r.setDevice(t.acquireGPUDevice())),null==r&&(r=dt(vt,this,At).call(this,ct(ht,this),e,t))&&ct(pt,this).set(e,r),r}},{key:"rendererReinitialize",value:function(){if(ct(pt,this)){var e,t=A(ct(pt,this));try{for(t.s();!(e=t.n()).done;){var r=v(e.value,2),n=r[0],i=r[1];i&&i.initialize(n)}}catch(e){t.e(e)}finally{t.f()}}}},{key:"rendererUnconfigureGPUContext",value:function(){if(ct(pt,this)){var e,t=A(ct(pt,this));try{for(t.s();!(e=t.n()).done;){var r=v(e.value,2),n=(r[0],r[1]);n&&n.unconfigureGPUContext()}}catch(e){t.e(e)}finally{t.f()}}}},{key:"getRendererType",value:function(){return ct(ht,this)}},{key:"loadRenderModuleFromBlob",value:function(e,t){t&&(e===ee.h3.WEBGPU?at.loadModuleFromBlob("webgpu_renderer_dynmod",t):(0,rt.Yu)("Invalid render module for ".concat(e)))}},{key:"setRendererType",value:function(e){ut(ht,this,e)}},{key:"isWebGPURendererType",value:function(){return ct(ht,this)===ee.h3.WEBGPU}},{key:"isWebGLRendererType",value:function(){return ct(ht,this)===ee.h3.WEBGL}},{key:"isWebGL2RendererType",value:function(){return ct(ht,this)===ee.h3.WEBGL_2}},{key:"cleanup",value:function(){var e,t=A(ct(pt,this));try{for(t.s();!(e=t.n()).done;){var r=v(e.value,2),n=(r[0],r[1]);n&&n.cleanup()}}catch(e){t.e(e)}finally{t.f()}ct(pt,this).clear()}}]);function kt(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var Ct=new WeakSet;function wt(e){e.forEach((function(e){e.consumePendingGPUEvents()}))}function Tt(e){return!e||0==e.length||-1==e.findIndex((function(e){return!!e&&!!e.getTextureLayerByZIndex(ee.x0.VS_BASE)&&e.isRenderingStateReady()}))}var Rt=D((function e(){var t;R(this,e),function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(this,t=Ct),t.add(this)}),[{key:"render",value:function(e,t){return e?e.isGPUDeviceReady()?t&&0!=t.length?(kt(Ct,this,wt).call(this,t),void(kt(Ct,this,Tt).call(this,t)||e.render(t))):(console.warn("[RendererController] render displays are not available!"),void(0,ie.r9)("WGPU RendererController_render() displays are not available!")):(console.log("[RendererController] GPU device is not ready!"),void(0,ie.r9)("WGPU RendererController_render() GPU device is not ready!")):(console.warn("[RendererController] renderer is not attached!"),void(0,ie.r9)("WGPU RendererController_render() renderer is not attached!"))}}]),It=D((function e(){R(this,e)}),[{key:"getVideoRenderDisplay",value:function(e,t,r,n,i){throw new Error("getVideoRenderDisplay() should be implemented by subclass.")}},{key:"getSharingRenderDisplay",value:function(e,t,r){throw new Error("getSharingRenderDisplay() should be implemented by subclass.")}},{key:"createVideoRenderDisplay",value:function(e,t,r){throw new Error("createVideoRenderDisplay() should be implemented by subclass.")}}]);function Dt(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}function Mt(e,t){return e.get(xt(e,t))}function Ot(e,t,r){return e.set(xt(e,t),r),r}function xt(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var Pt=new WeakMap,Lt=new WeakMap,Nt=function(e){function t(){var e;R(this,t);var r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Dt(d(e=c(this,t)),Pt,new Map),Dt(d(e),Lt,!1),Ot(Lt,d(e),r),e}return f(t,e),D(t,[{key:"setCanvasAlphaChannelEnability",value:function(e){Ot(Lt,this,e)}},{key:"createVideoRenderDisplay",value:function(e,t,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=null,a=null,o=null,s=!1;return n&&(i=n.forceNoGL,a=n.contextOptions,o=n.webGLResources,s=n.initMask),new Ie(e,t,r,i,a,o,s,Mt(Lt,this))}},{key:"getVideoRenderDisplay",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=Mt(Pt,this).get(e);if(!a){var o=[];a=[o,[]],Mt(Pt,this).set(e,a);var s=new Ie(e,t,0,void 0,void 0,void 0,void 0,Mt(Lt,this));s.setMultiView(!0),i&&i.set(e,s);for(var u=1;u<=r;u++){var c=new Ie(e,t,u,void 0,void 0,{program:s.shaderProgram,contextgl:s.contextGL,vBuffer:s.vertexPosBuffer,tBuffer:s.texturePosBuffer,waterMarkTextureRef:s.waterMarkTextureRef,repeatedWaterMarkTextureRef:s.repeatedWaterMarkTextureRef},void 0,Mt(Lt,this));c.setMultiView(!0),o.push(c)}}var d,l=Mt(Pt,this).get(e),h=l[0],f=l[1];if(l&&h[0]&&(d=h.pop(),f.push(d)),!d){var p=l?"".concat(l.length):"undefined",v=h?"".concat(h.length):"undefined";n("No Display obtained from VideoRender.Get_Display. canvasRenderArray:".concat(p," unusedRenderArray:").concat(v))}return d}},{key:"getSharingRenderDisplay",value:function(e,t,r){return new Ie(e,t,0,void 0,r.contextOptions,void 0,void 0,Mt(Lt,this))}},{key:"recycleRenderDisplay",value:function(e,t,r){t.setWatermarkFlag(0),t.setVideoMode(z.kh),t.clear(r);var n=Mt(Pt,this).get(e);if(n){var i=n[0],a=n[1];a&&a.some((function(e,r){if(e===t)return a.splice(r,1),!0})),i.push(t)}}},{key:"onRestoredFromContextLost",value:function(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=Mt(Pt,this).get(r);(!o||o.length<2)&&i("canvasRenderArray:".concat(o,", length:").concat(null==o?void 0:o.length));var s=a.get(t);if(s){s.reinit();for(var u=0;u<(null==o?void 0:o.length);u++)o[u].forEach((function(e){null==e||e.reinit({program:s.shaderProgram,contextgl:s.contextGL,vBuffer:s.vertexPosBuffer,tBuffer:s.texturePosBuffer,waterMarkTextureRef:s.waterMarkTextureRef,repeatedWaterMarkTextureRef:s.repeatedWaterMarkTextureRef})}));return r!==t&&(Mt(Pt,this).delete(r),Mt(Pt,this).set(t,o),a&&(a.delete(r),a.set(t,s))),null}}},{key:"getRenderDisplayMap",value:function(){return Mt(Pt,this)}},{key:"cleanup",value:function(e,t){var r;null==t||null===(r=t.cleanup)||void 0===r||r.call(t,null);var n,i=A(Mt(Pt,this));try{for(i.s();!(n=i.n()).done;){var a,o=v(n.value,2),s=(o[0],o[1]),u=s[0],c=s[1],d=A(u);try{for(d.s();!(a=d.n()).done;)a.value.cleanup()}catch(e){d.e(e)}finally{d.f()}var l,h=A(c);try{for(h.s();!(l=h.n()).done;)l.value.cleanup()}catch(e){h.e(e)}finally{h.f()}}}catch(e){i.e(e)}finally{i.f()}Ot(Pt,this,new Map)}},{key:"cleanupByCanvas",value:function(e){if(Mt(Pt,this).get(e)){var t=Mt(Pt,this).get(e);if(t){var r=t[0],n=t[1];n.forEach((function(e){var t;null==e||null===(t=e.cleanup)||void 0===t||t.call(e)})),r.forEach((function(e){var t;null==e||null===(t=e.cleanup)||void 0===t||t.call(e)})),r=[],n=[],Mt(Pt,this).delete(e)}}else{var i,a;null===(i=e.display)||void 0===i||null===(a=i.cleanup)||void 0===a||a.call(i)}}}])}(It);function Vt(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}function Ut(e,t){return e.get(Bt(e,t))}function Ft(e,t,r){return e.set(Bt(e,t),r),r}function Bt(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var Wt=new WeakMap,Gt=new WeakMap,Ht=function(e){function t(){var e;R(this,t);var r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Vt(d(e=c(this,t)),Wt,new Map),Vt(d(e),Gt,!1),Ft(Gt,d(e),r),e}return f(t,e),D(t,[{key:"setCanvasAlphaChannelEnability",value:function(e){Ft(Gt,this,e)}},{key:"createVideoRenderDisplay",value:function(e,t,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=null,a=null,o=null,s=!1;return n&&(i=n.forceNoGL,a=n.contextOptions,o=n.webGLResources,s=n.initMask),new Ne(e,t,r,i,a,o,s,Ut(Gt,this))}},{key:"getVideoRenderDisplay",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=Ut(Wt,this).get(e);if(!a){var o=[];a=[o,[]],Ut(Wt,this).set(e,a);var s=new Ne(e,t,0,void 0,void 0,void 0,void 0,Ut(Gt,this));s.setMultiView(!0),i&&i.set(e,s);for(var u=1;u<=r;u++){var c=new Ne(e,t,u,void 0,void 0,{program:s.shaderProgram,contextgl:s.contextGL,vBuffer:s.vertexPosBuffer,tBuffer:s.texturePosBuffer,waterMarkTextureRef:s.waterMarkTextureRef,repeatedWaterMarkTextureRef:s.repeatedWaterMarkTextureRef},void 0,void 0,Ut(Gt,this));c.setMultiView(!0),o.push(c)}}var d,l=Ut(Wt,this).get(e),h=l[0],f=l[1];if(l&&h[0]&&(d=h.pop(),f.push(d)),!d){var p=l?"".concat(l.length):"undefined",v=h?"".concat(h.length):"undefined";n("No Display obtained from VideoRender.Get_Display. canvasRenderArray:".concat(p," unusedRenderArray:").concat(v))}return d}},{key:"getSharingRenderDisplay",value:function(e,t,r){return new Ne(e,t,0,void 0,r.contextOptions,void 0,void 0,Ut(Gt,this))}},{key:"recycleRenderDisplay",value:function(e,t,r){t.setWatermarkFlag(0),t.setVideoMode(z.kh),t.clear(r);var n=Ut(Wt,this).get(e);if(n){var i=n[0],a=n[1];a&&a.some((function(e,r){if(e===t)return a.splice(r,1),!0})),i.push(t)}}},{key:"onRestoredFromContextLost",value:function(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=Ut(Wt,this).get(r);(!o||o.length<2)&&i("canvasRenderArray:".concat(o,", length:").concat(null==o?void 0:o.length));var s=a.get(t);if(s){s.reinit();for(var u=0;u<(null==o?void 0:o.length);u++)o[u].forEach((function(e){null==e||e.reinit({program:s.shaderProgram,contextgl:s.contextGL,vBuffer:s.vertexPosBuffer,tBuffer:s.texturePosBuffer,waterMarkTextureRef:s.waterMarkTextureRef,repeatedWaterMarkTextureRef:s.repeatedWaterMarkTextureRef})}));return r!==t&&(Ut(Wt,this).delete(r),Ut(Wt,this).set(t,o),a&&(a.delete(r),a.set(t,s))),null}}},{key:"getRenderDisplayMap",value:function(){return Ut(Wt,this)}},{key:"cleanup",value:function(e,t){var r;null==t||null===(r=t.cleanup)||void 0===r||r.call(t);var n,i=A(Ut(Wt,this));try{for(i.s();!(n=i.n()).done;){var a,o=v(n.value,2),s=(o[0],o[1]),u=s[0],c=s[1],d=A(u);try{for(d.s();!(a=d.n()).done;)a.value.cleanup()}catch(e){d.e(e)}finally{d.f()}var l,h=A(c);try{for(h.s();!(l=h.n()).done;)l.value.cleanup()}catch(e){h.e(e)}finally{h.f()}}}catch(e){i.e(e)}finally{i.f()}Ft(Wt,this,new Map)}},{key:"cleanupByCanvas",value:function(e){if(Ut(Wt,this).get(e)){var t=Ut(Wt,this).get(e);if(t){var r=t[0],n=t[1];n.forEach((function(e){var t;null==e||null===(t=e.cleanup)||void 0===t||t.call(e)})),r.forEach((function(e){var t;null==e||null===(t=e.cleanup)||void 0===t||t.call(e)})),r=[],n=[],Ut(Wt,this).delete(e)}}else{var i,a;null===(i=e.display)||void 0===i||null===(a=i.cleanup)||void 0===a||a.call(i)}}}])}(It);function jt(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}function Kt(e,t){return e.get(qt(e,t))}function zt(e,t,r){return e.set(qt(e,t),r),r}function qt(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var Yt=new WeakMap,Xt=new WeakMap,Qt=new WeakMap,Jt=new WeakMap,$t=new WeakMap,Zt=D((function e(){R(this,e);var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];jt(this,Yt,null),jt(this,Xt,null),jt(this,Qt,null),jt(this,Jt,null),jt(this,$t,!1),zt($t,this,t)}),[{key:"setGPUResourceMgrGetter",value:function(e){zt(Jt,this,e)}},{key:"isEnableCanvasAlphaChannel",value:function(){return Kt($t,this)}},{key:"setCanvasAlphaChannelEnability",value:function(e){zt($t,this,e),Kt(Yt,this)&&Kt(Yt,this).setCanvasAlphaChannelEnability(e),Kt(Xt,this)&&Kt(Xt,this).setCanvasAlphaChannelEnability(e)}},{key:"getWebGLRenderDisplayMgr",value:function(){return Kt(Yt,this)||(zt(Yt,this,new Nt(Kt($t,this))),(0,ie.r9)("[Render] getWebGLRenderDisplayMgr")),Kt(Yt,this)}},{key:"getWebGL2RenderDisplayMgr",value:function(){return Kt(Xt,this)||zt(Xt,this,new Ht(Kt($t,this))),Kt(Xt,this)}},{key:"getWebGPURenderDisplayMgr",value:function(){if(!Kt(Qt,this)){var e=at.getModule("webgpu_renderer_dynmod");zt(Qt,this,e.exports.createWebGPURenderDisplayMgr()),Kt(Qt,this).setGPUResourceMgrGetter(Kt(Jt,this).call(this,ee.h3.WEBGPU))}return Kt(Qt,this)}},{key:"getRenderDisplayMgr",value:function(e){switch(e){case ee.h3.WEBGL:return this.getWebGLRenderDisplayMgr();case ee.h3.WEBGL_2:return this.getWebGL2RenderDisplayMgr();case ee.h3.WEBGPU:return this.getWebGPURenderDisplayMgr();case ee.h3.VIDEO_TAG:return(0,rt.Yu)("VIDEO_TAG has no RenderDisplayMgr!"),null;default:return null}}},{key:"getVideoRenderDisplay",value:function(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=this.getRenderDisplayMgr(e).getVideoRenderDisplay(t,r,n,i,o);return s&&e===ee.h3.WEBGPU&&(s.addRenderer(a),s.attachCanvas(t,r),s.setGPUResMgr(Kt(Jt,this).call(this,e))),s}},{key:"getSharingRenderDisplay",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=this.getRenderDisplayMgr(e).getSharingRenderDisplay(t,r,i);return a&&e===ee.h3.WEBGPU&&(a.addRenderer(n),a.attachCanvas(t,r),a.setGPUResMgr(Kt(Jt,this).call(this,e))),a}},{key:"createVideoRenderDisplay",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=this.getRenderDisplayMgr(e).createVideoRenderDisplay(t,r,n,i,a);return o&&e===ee.h3.WEBGPU&&(o.addRenderer(i),o.attachCanvas(t,r),o.setGPUResMgr(Kt(Jt,this).call(this,e))),o}},{key:"recycleRenderDisplay",value:function(e,t,r,n){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];switch(e){case ee.h3.WEBGPU:Kt(Qt,this)&&Kt(Qt,this).recycleRenderDisplay(r,n,i);break;case ee.h3.WEBGL:Kt(Yt,this)&&Kt(Yt,this).recycleRenderDisplay(t,r,i);break;case ee.h3.WEBGL_2:Kt(Xt,this)&&Kt(Xt,this).recycleRenderDisplay(t,r,i);break;case ee.h3.VIDEO_TAG:(0,rt.Yu)("VIDEO_TAG has no display")}}},{key:"collectInUseRenderDisplays",value:function(e,t){var r=null;return e===ee.h3.WEBGPU&&Kt(Qt,this)&&(r=Kt(Qt,this).collectInUseRenderDisplays(t)),r}},{key:"collectInUseRenderDisplaysByCanvas",value:function(e,t,r){var n=null;return e===ee.h3.WEBGPU&&Kt(Qt,this)&&(n=Kt(Qt,this).collectInUseRenderDisplaysByCanvas(t,r)),n}},{key:"getRenderDisplayMap",value:function(e,t){if(e===ee.h3.WEBGL){if(Kt(Yt,this))return Kt(Yt,this).getRenderDisplayMap()}else if(e===ee.h3.WEBGPU){if(Kt(Qt,this))return Kt(Qt,this).getRenderDisplayMap(t)}else if(e===ee.h3.WEBGL_2&&Kt(Xt,this))return Kt(Xt,this).getRenderDisplayMap(t);return null}},{key:"onRestoredFromContextLost",value:function(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return Kt(Yt,this)?Kt(Yt,this).onRestoredFromContextLost(e,t,r,n,i,a):Kt(Xt,this)?Kt(Xt,this).onRestoredFromContextLost(e,t,r,n,i,a):null}},{key:"cleanup",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];null!==Kt(Yt,this)&&Kt(Yt,this).cleanup(e,t),Kt(Xt,this)&&Kt(Xt,this).cleanup(e,t),null!==Kt(Qt,this)&&Kt(Qt,this).cleanup(t,r)}},{key:"cleanupByCanvas",value:function(e){null!==Kt(Yt,this)&&Kt(Yt,this).cleanupByCanvas(e),null!==Kt(Xt,this)&&Kt(Xt,this).cleanupByCanvas(e),null!==Kt(Qt,this)&&Kt(Qt,this).cleanupByCanvas(e)}}]);function er(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}function tr(e,t){return e.get(nr(e,t))}function rr(e,t,r){return e.set(nr(e,t),r),r}function nr(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var ir,ar,or=new WeakMap,sr=new WeakMap,ur=new WeakMap,cr=new WeakMap,dr=new WeakMap,lr=D((function e(t){var r=this;R(this,e),er(this,or,""),er(this,sr,new Et),er(this,ur,new Zt),er(this,cr,new Rt),er(this,dr,null),rr(or,this,t),tr(ur,this).setGPUResourceMgrGetter((function(){return r.getWebGPUResMgr()}))}),[{key:"isEnableCanvasAlphaChannel",value:function(){return tr(ur,this).isEnableCanvasAlphaChannel()}},{key:"setCanvasAlphaChannelEnability",value:function(e){tr(ur,this).setCanvasAlphaChannelEnability(e)}},{key:"evalRendererType",value:function(){var e=H(O().mark((function e(t){var r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tr(sr,this).evaluate(t);case 2:r=e.sent,console.log("[RenderManager] rendererType is ".concat(r));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getVideoRenderDisplay",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=tr(sr,this).getRendererType(),o=tr(sr,this).acquireRenderer(e,this.getWebGPUResMgr(a));return tr(ur,this).getVideoRenderDisplay(a,e,t,r,n,o,i)}},{key:"createWebGLVideoRenderDisplay",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return tr(sr,this).isWebGL2RendererType()?tr(ur,this).getWebGL2RenderDisplayMgr().createVideoRenderDisplay(e,t,r,null,n):tr(sr,this).isWebGLRendererType()?tr(ur,this).getWebGLRenderDisplayMgr().createVideoRenderDisplay(e,t,r,null,n):((0,rt.Yu)("Can not create webgl display!!"),null)}},{key:"createVideoRenderDisplay",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=tr(sr,this).getRendererType(),a=tr(sr,this).acquireRenderer(e,this.getWebGPUResMgr(i));return tr(ur,this).createVideoRenderDisplay(i,e,t,r,a,n)}},{key:"getSharingRenderDisplay",value:function(e,t,r){var n=tr(sr,this).getRendererType(),i=tr(sr,this).acquireRenderer(e,this.getWebGPUResMgr(n),!0);return r||(r={}),r.clearCache=!0,tr(ur,this).getSharingRenderDisplay(n,e,t,i,r)}},{key:"recycleRenderDisplay",value:function(e,t,r){var n=tr(sr,this).getRendererType();tr(ur,this).recycleRenderDisplay(n,e,t,this.getWebGPUResMgr(n),r)}},{key:"renderFor",value:function(e){var t=this;if(tr(sr,this).isWebGPURendererType()){var r=tr(sr,this).getRendererType(),n=tr(ur,this).collectInUseRenderDisplays(r,e);n&&n.forEach((function(e){var n=tr(sr,t).acquireRenderer(e.canvas,t.getWebGPUResMgr(r));tr(cr,t).render(n,e.renderDisplays)}))}}},{key:"renderWith",value:function(e){if(tr(sr,this).isWebGPURendererType()){var t=e.getAttachedCanvas();if(t){var r=tr(sr,this).getRendererType(),n=tr(sr,this).acquireRenderer(t,this.getWebGPUResMgr(r)),i=[];i.push(e),tr(cr,this).render(n,i)}}}},{key:"getRenderDisplayMap",value:function(e){var t=tr(sr,this).getRendererType();return tr(ur,this).getRenderDisplayMap(t,e)}},{key:"onRestoredFromContextLost",value:function(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return tr(sr,this).isWebGLRendererType()||tr(sr,this).isWebGL2RendererType()?tr(ur,this).onRestoredFromContextLost(e,t,r,n,i,a):null}},{key:"destroyUnusedVideoFrame",value:function(e){"undefined"!=typeof VideoFrame&&e instanceof VideoFrame&&tr(sr,this).isWebGPURendererType()&&e.close()}},{key:"getRendererProvider",value:function(){return tr(sr,this)}},{key:"getRenderDisplayManager",value:function(){return tr(ur,this)}},{key:"getWebGPUResMgr",value:function(e){if(tr(dr,this))return tr(dr,this);if(e===ee.h3.WEBGPU){var t=at.getModule("webgpu_renderer_dynmod");rr(dr,this,t.exports.createWebGPUResManager()),tr(dr,this).addRendererProviderModule(tr(sr,this)),tr(dr,this).setLabel(tr(or,this))}return tr(dr,this)}},{key:"cleanup",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];tr(sr,this)&&tr(sr,this).cleanup(),tr(ur,this)&&tr(ur,this).cleanup(e,t,r),r||tr(dr,this)&&tr(dr,this).cleanup()}},{key:"clearOffscreenCanvas",value:function(e){tr(ur,this)&&tr(ur,this).cleanupByCanvas(e)}}]),hr=r(9693),fr=r(5090),pr=r(5830),vr=r(2484);(ar=ir||(ir={})).VB_INIT_SUCCESS="VB_INIT_SUCCESS",ar.VB_INIT_FAILED="VB_INIT_FAILED",ar.VB_GENERATED_FRAME="VB_GENERATED_FRAME",ar.VB_SEND_FRAME="VB_SEND_FRAME",ar.VB_UPDATE_BG="VB_UPDATE_BG",ar.VB_PREDICT_DONE="VB_PREDICT_DONE",ar.VB_MODEL_READY="VB_MODEL_READY",ar.VB_FREE_MEMORY="VB_FREE_MEMORY",ar.VB_VIDEO_FORMAT_UNSUPPORTED="VB_VIDEO_FORMAT_UNSUPPORTED",ar.VB_WORKER_INIT="VB_WORKER_INIT",ar.VB_WORKER_ERROR="VB_WORKER_ERROR",ar.VB_RENDER_CANVAS="VB_RENDER_CANVAS",ar.VB_RENDER_FRAME="VB_RENDER_FRAME",ar.VB_START="VB_START",ar.VB_REQUEST_FRAME="VB_REQUEST_FRAME",ar.VB_TOGGLE_VB="VB_TOGGLE_VB",ar.VB_STOP="VB_STOP",ar.VB_MIRROR="VB_MIRROR",ar.VB_GENERATE_STREAM="VB_GENERATE_STREAM",ar.VB_STOP_STREAM="VB_STOP_STREAM",ar.VB_CHANGE_STREAM_CANVAS_SIZE="VB_CHANGE_STREAM_CANVAS_SIZE",ar.VB_GENERATE_FIRST_FRAME="VB_GENERATE_FIRST_FRAME",ar.VB_UPDATE_STATS="VB_UPDATE_STATS",ar.VB_UPDATE_NEED_FRAME="VB_UPDATE_NEED_FRAME",ar.VB_UPDATE_FRAME_RATE="VB_UPDATE_FRAME_RATE",ar.VB_RESOLUTION_CHANGE="VB_RESOLUTION_CHANGE";var gr=r(7243),mr=D((function e(t,r){R(this,e),this.isMirror=!1,this.display=new Ie(t,r,0,void 0,{preserveDrawingBuffer:!1},void 0,!1,!1)}),[{key:"renderFrame",value:function(e,t,r,n){if(this.display){var i={x:0,y:0,width:this.display.canvasElement.width,height:this.display.canvasElement.height};this.display.updateRemoteVideoTextures(e,t,n,r,0,!0,i,!1),this.display.drawRemoteVideo(i,this.isMirror)}}},{key:"render",value:function(e){return t=this,n=O().mark((function t(){var r,n,i,a,o,s,u,c,d,l,h,f,p,v,g,m,y,_;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=z.rK,!("data_ptr"in e)){t.next=7;break}n=e.data,i=e.format_width,a=e.format_height,o=e.valid_x,s=e.valid_y,u=e.valid_width,c=e.valid_height,d={top:s,left:o,width:u,height:c},this.display.setVideoMode(z.Wp),this.renderFrame(i,a,n,d),t.next=35;break;case 7:if(!(self.VideoFrame&&e instanceof VideoFrame)){t.next=34;break}if(l=e.format,h=e.visibleRect,!l||!h){t.next=32;break}if("I420"!==l&&"I420A"!==l){t.next=14;break}r=z.Wp,t.next=21;break;case 14:if("NV12"!==l){t.next=18;break}r=z.pn,t.next=21;break;case 18:if("BGRA"===l){t.next=20;break}return t.abrupt("return",void(this.onUnsupportedFrame&&this.onUnsupportedFrame(l)));case 20:r=z.hd;case 21:return f=h.width,p=h.height,v=new Uint8Array(e.allocationSize()),g={top:0,left:0,width:f,height:p},this.display.setVideoMode(r),t.prev=23,t.next=26,e.copyTo(v);case 26:this.renderFrame(f,p,v,g),t.next=31;break;case 29:t.prev=29,t.t0=t.catch(23);case 31:e.close();case 32:t.next=35;break;case 34:e instanceof ImageData&&(m=e.width,y=e.height,_={top:0,left:0,width:m,height:y},this.display.setVideoMode(z.rK),this.renderFrame(m,y,e.data,_));case 35:case"end":return t.stop()}}),t,this,[[23,29]])})),new((r=void 0)||(r=Promise))((function(e,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,o)}s((n=n.apply(t,[])).next())}));var t,r,n}},{key:"updateSize",value:function(e,t){this.display.canvasElement.width=e,this.display.canvasElement.height=t}},{key:"setMirror",value:function(e){this.isMirror=e}}]),yr=D((function e(){R(this,e),this.timer3s=null,this.timer10s=null,this.isVBPredictDone=!1,this.inited=!1}),[{key:"start",value:function(){var e=this;this.inited=!0,this.clear(),this.timer3s=setTimeout((function(){e.isVBPredictDone||e.ontimeout3s()}),3e3),this.timer10s=setTimeout((function(){e.isVBPredictDone||e.ontimeout10s()}),1e4)}},{key:"clear",value:function(){clearTimeout(this.timer3s),clearTimeout(this.timer10s),this.timer3s=null,this.timer10s=null}}]),_r=function(e,t,r,n){return new(r||(r=Promise))((function(t,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,o)}s((n=n.apply(e,[])).next())}))},Sr=function(){function e(t){R(this,e),this.isVBReady=!1,this.videoStream=null,this.isVBInitializing=!1,this.receiveTimer=null,this.msgChannel=null,this.isEnabled=!0,this.trackProcessor=null,this.isVBRunning=!1,this.frameRate=24,this.isStreamEnabled=!1,this.destoryed=!1,this._needFrame=!1,this._backend="",this.isMetadataLoaded=!1,this.isCapturing=!1,this.isReportVideoFrameError=!1,this.shouldStopCapture=!1;var r=t.canvas,n=(t.canvasID,t.bgImage),i=t.cdnPath,a=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(t,["canvas","canvasID","bgImage","cdnPath"]);if(this.cdnPath=i||e.cdnPath,!this.cdnPath)throw new Error("VB module: cdnPath is not provided");this.vbWorkerUrl="".concat(this.cdnPath,"/vb_worker.min.js"),this.initParam=a,this._needFrame=a.needFrame,r&&(this.cvsEle="string"==typeof r?document.querySelector("#".concat(r)):r),n&&(this.bgImage=n),this.handle_message_from_vb_worker=this.handle_message_from_vb_worker.bind(this);var o=navigator.userAgent.toLocaleLowerCase();this.isSafari=o.includes("safari")&&!o.includes("chrome")&&!o.includes("chromium"),this.vbLoadingTimer=new yr,this.handleLoadMetadata=this.handleLoadMetadata.bind(this),this.stats={fps:0,receivingFps:0,receivedFrames:0,generatedFrames:0,width:0,height:0}}return D(e,[{key:"needFrame",get:function(){return this._needFrame},set:function(e){this._needFrame=e,this.postMessage({cmd:ir.VB_UPDATE_NEED_FRAME,payload:e})}},{key:"backend",get:function(){return this._backend}},{key:"ontimeout3s",set:function(e){this.vbLoadingTimer.ontimeout3s=e}},{key:"ontimeout10s",set:function(e){this.vbLoadingTimer.ontimeout10s=e}},{key:"sendCanvas",value:function(){if(this.cvsEle){var e=this.cvsEle.transferControlToOffscreen();this.postMessage({cmd:ir.VB_RENDER_CANVAS,payload:e},[e])}}},{key:"generateVBStream",value:function(){if(this.vbTrackGenerator){var t=this.vbTrackGenerator.writable;this.postMessage({cmd:ir.VB_GENERATE_STREAM,payload:t},[t])}else if(this.streamCanvas)if(this.isSafari){var r=this.streamCanvas.transferControlToOffscreen();this.postMessage({cmd:ir.VB_GENERATE_STREAM,payload:r},[r])}else this.streamRender=new mr(this.streamCanvas,e.VB_STREAM_CANVAS),this.postMessage({cmd:ir.VB_GENERATE_STREAM})}},{key:"initialize",value:function(){var t=this;return this.isVBReady?Promise.resolve():(this.isVBInitializing||(this.isVBInitializing=!0,this.vbLoadingTimer.isVBPredictDone=!1,this.initPromise=new Promise((function(r,n){return _r(t,0,void 0,O().mark((function t(){var i,a,o,s,c;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.initReject=n,this.initResolve=r,t.prev=1,t.next=4,fetch(this.vbWorkerUrl);case 4:if(!(i=t.sent).ok){t.next=15;break}return t.next=8,i.arrayBuffer();case 8:if(a=t.sent,!this.destoryed){t.next=11;break}return t.abrupt("return");case 11:o=u().createObjectURL(new Blob([a])),this.worker=new Worker(o,{name:e.VB_WORKER_NAME}),this.worker.addEventListener("message",this.handle_message_from_vb_worker),this.postMessage({cmd:ir.VB_WORKER_INIT,payload:Object.assign(Object.assign({renderUserAgentInfo:(0,be.B)().userAgent.info(),renderCapabilitiesDesc:(0,be.B)().capabilities.desc(),renderConfigDesc:(0,be.B)().config.desc()},this.initParam),{cdnPath:this.cdnPath})}),this.sendCanvas(),u().revokeObjectURL(o),t.next=17;break;case 15:s=i.url,c=i.status,this.isVBInitializing=!1,n("Fetch worker file failed. url: ".concat(s,", status: ").concat(c));case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(1),this.isVBInitializing=!1,n(t.t0);case 22:case"end":return t.stop()}}),t,this,[[1,19]])})))}))),this.initPromise)}},{key:"send_frame",value:function(e){this.isVBReady&&("format"in e?this.postMessage({cmd:ir.VB_SEND_FRAME,payload:e},[e]):this.postMessage({cmd:ir.VB_SEND_FRAME,payload:e},[e.data.buffer]))}},{key:"Crop_Mask_Bg_16V9",value:function(){var e,t,r,n=0,i=16/9,a=this.bgImage.width,o=this.bgImage.height;return i*o>=a?(r=a,e=0,t=(o-(n=a/i))/2):(n=o,e=(a-(r=o*i))/2,t=0),{sx:e,sy:t,sw:r,sh:n}}},{key:"set_background_image",value:function(e){if(this.bgImage=e,!this.isVBReady)return!1;var t,r,n,i,a,o,s=this.Crop_Mask_Bg_16V9();t=s.sx,r=s.sy,n=s.sw,i=s.sh,n>1920?(a=1920,o=1080):(a=n,o=i),this.bgConvertCanvas||(this.bgConvertCanvas=new OffscreenCanvas(a,o)),this.bgConvertCanvas.width=a,this.bgConvertCanvas.height=o;var u=null;try{u=this.bgConvertCanvas.getContext("2d",{willReadFrequently:!0})}catch(e){}finally{u||(u=this.bgConvertCanvas.getContext("2d"))}if(!u)return!1;u.drawImage(e,t,r,n,i,0,0,this.bgConvertCanvas.width,this.bgConvertCanvas.height);var c=u.getImageData(0,0,this.bgConvertCanvas.width,this.bgConvertCanvas.height);return this.postMessage({cmd:ir.VB_UPDATE_BG,payload:c}),"close"in e&&e.close(),!0}},{key:"set_background_blur",value:function(){this.isVBReady&&this.postMessage({cmd:ir.VB_UPDATE_BG,payload:"blur"})}},{key:"handle_message_from_vb_worker",value:function(t){var r=t.data.cmd;switch(e.EXTERNAL_EVENTS.has(r)&&(r!==ir.VB_GENERATED_FRAME||this._needFrame)&&this.callback&&this.callback(t.data),r){case ir.VB_MODEL_READY:this.vbLoadingTimer.start();break;case ir.VB_PREDICT_DONE:var n=t.data.payload;this.vbLoadingTimer.isVBPredictDone=!0,this.vbLoadingTimer.clear(),this._backend=n;break;case ir.VB_INIT_FAILED:var i=t.data.payload;this.isVBInitializing=!1,this.initReject(i);break;case ir.VB_INIT_SUCCESS:this.isVBReady=!0,this.isVBInitializing=!1,this.bgImage&&this.set_background_image(this.bgImage),this.generateVBStream(),this.initResolve();break;case ir.VB_REQUEST_FRAME:if(this.updateConstraints(),this.captureVideoEle&&this.isVideoPlaying(this.captureVideoEle))if(window.VideoFrame){if(this.isMetadataLoaded)try{var a=new VideoFrame(this.captureVideoEle,{timestamp:1e3*performance.now()});this.send_frame(a),a.close()}catch(e){this.callback&&!this.isReportVideoFrameError&&(this.callback({cmd:ir.VB_WORKER_ERROR,payload:e}),this.isReportVideoFrameError=!0)}}else if(this.captureCtx){this.captureCtx.drawImage(this.captureVideoEle,0,0);var o=this.captureCtx.getImageData(0,0,this.captureVideoEle.videoWidth,this.captureVideoEle.videoHeight);this.streamRender&&this.isStreamEnabled&&!this.isEnabled&&this.streamRender.render(o),this.send_frame(o)}break;case ir.VB_GENERATED_FRAME:var s=t.data.payload,u=s.data_ptr;this.streamRender&&this.isStreamEnabled&&this.streamRender.render(s),u&&this.freeMemory(u);break;case ir.VB_UPDATE_STATS:this.stats=t.data.payload;break;case ir.VB_RESOLUTION_CHANGE:var c=t.data.payload,d=c.width,l=c.height;this.stats.width=d,this.stats.height=l}}},{key:"onMessage",value:function(e){this.callback=e}},{key:"createCaptureEle",value:function(){window.MediaStreamTrackProcessor||(this.captureVideoEle=document.querySelector("#".concat(e.VB_CAPTURE_VIDEO)),this.captureVideoEle||(this.captureVideoEle=document.createElement("video"),this.captureVideoEle.autoplay=!0,this.captureVideoEle.playsInline=!0,this.captureVideoEle.id=e.VB_CAPTURE_VIDEO,this.captureVideoEle.style.position="fixed",this.captureVideoEle.style.width="1px",this.captureVideoEle.style.height="1px",this.captureVideoEle.style.bottom="0px",this.captureVideoEle.style.right="0px",this.captureVideoEle.muted=!0,document.body.appendChild(this.captureVideoEle)),this.captureCanvas||window.VideoFrame||(this.captureCanvas=document.createElement("canvas"),this.captureCtx=this.captureCanvas.getContext("2d")))}},{key:"isVideoPlaying",value:function(e){return(e.paused||e.ended)&&e.play(),e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2}},{key:"postMessage",value:function(e,t){var r,n;t?null===(r=this.worker)||void 0===r||r.postMessage(e,t):null===(n=this.worker)||void 0===n||n.postMessage(e)}},{key:"updateStreamCanvasSize",value:function(e,t){this.streamCanvas&&(this.isSafari?this.postMessage({cmd:ir.VB_CHANGE_STREAM_CANVAS_SIZE,payload:{width:e,height:t}}):(this.streamCanvas.width=e,this.streamCanvas.height=t))}},{key:"updateConstraints",value:function(){var e=this.videoStream.getVideoTracks()[0].getSettings(),t=e.width,r=e.height,n=e.frameRate;t&&r&&(!this.streamCanvas||t===this.streamCanvas.width&&r===this.streamCanvas.height||this.updateStreamCanvasSize(t,r),this.captureCanvas&&(t!==this.captureCanvas.width&&(this.captureCanvas.width=t),r!==this.captureCanvas.height&&(this.captureCanvas.height=r))),n&&this.frameRate!=Math.min(n,24)&&(this.frameRate=Math.min(n,24),this.postMessage({cmd:ir.VB_UPDATE_FRAME_RATE,payload:this.frameRate}))}},{key:"captureVideo",value:function(e){return _r(this,0,void 0,O().mark((function t(){var r,n,i,a,o,s,u,c,d,l;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.shouldStopCapture=!1,!this.isVBReady&&!this.isVBInitializing){t.next=8;break}if(t.t0=this.isVBInitializing,!t.t0){t.next=6;break}return t.next=6,this.initPromise;case 6:t.next=10;break;case 8:return t.next=10,this.initialize();case 10:if(!this.shouldStopCapture){t.next=12;break}return t.abrupt("return",(this.shouldStopCapture=!1,Promise.reject("The capture was stopped")));case 12:if(!this.isCapturing){t.next=14;break}return t.abrupt("return",Promise.reject("Capture is already started"));case 14:if(r=!0,!("id"in e)){t.next=21;break}if(e.active){t.next=18;break}return t.abrupt("return",Promise.reject("stream is not active"));case 18:this.videoStream&&this.videoStream.id===e.id?r=!1:(this.videoStream&&this.stopCapture(),this.videoStream=e),t.next=37;break;case 21:if(!this.videoStream||this.captureConf!==e){t.next=25;break}r=!1,t.next=37;break;case 25:return this.videoStream&&this.stopCapture(),this.isCapturing=!0,t.prev=26,t.next=29,navigator.mediaDevices.getUserMedia(Object.assign(Object.assign({},e),{audio:!1}));case 29:this.videoStream=t.sent,this.captureConf=e,this.isCapturing=!1,t.next=37;break;case 34:return t.prev=34,t.t1=t.catch(26),t.abrupt("return",(this.isCapturing=!1,Promise.reject(t.t1)));case 37:if(this.createCaptureEle(),!r){t.next=44;break}if(n=this.videoStream.getVideoTracks()[0]){t.next=40;break}return t.abrupt("return",Promise.reject("No video track in stream"));case 40:i=n.getSettings(),a=i.width,o=void 0===a?0:a,s=i.height,u=void 0===s?0:s,c=i.frameRate,d=void 0===c?24:c,this.updateStreamCanvasSize(o,u),this.frameRate=Math.min(d,24),window.MediaStreamTrackProcessor?(this.trackProcessor=new window.MediaStreamTrackProcessor({track:n}),l=this.trackProcessor.readable,this.postMessage({cmd:ir.VB_START,payload:{videoStream:l,frameRate:this.frameRate}},[l])):this.captureVideoEle&&(this.isMetadataLoaded=!1,this.captureVideoEle.addEventListener("loadedmetadata",this.handleLoadMetadata),this.captureVideoEle.srcObject=this.videoStream,this.captureVideoEle.play(),this.captureCanvas&&(this.captureCanvas.width=o,this.captureCanvas.height=u),this.postMessage({cmd:ir.VB_START,payload:{frameRate:this.frameRate}})),t.next=47;break;case 44:if(!this.isVBRunning){t.next=46;break}return t.abrupt("return");case 46:this.videoStream.getVideoTracks()[0].enabled=!0,this.captureVideoEle&&this.captureVideoEle.play(),this.postMessage({cmd:ir.VB_START});case 47:return t.abrupt("return",(this.isVBRunning=!0,this.shouldStopCapture?(this.stopCapture(),this.shouldStopCapture=!1,Promise.reject("The capture was stopped")):void 0));case 48:case"end":return t.stop()}}),t,this,[[26,34]])})))}},{key:"stopCapture",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.videoStream?(this.postMessage({cmd:ir.VB_STOP,payload:e}),this.captureVideoEle&&this.captureVideoEle.pause(),this.videoStream&&e&&(this.videoStream.getTracks().forEach((function(e){e.stop()})),this.videoStream=null),this.isVBRunning=!1):this.shouldStopCapture=!0}},{key:"setMirror",value:function(e){this.postMessage({cmd:ir.VB_MIRROR,payload:e})}},{key:"freeMemory",value:function(e){this.isVBReady&&this.postMessage({cmd:ir.VB_FREE_MEMORY,payload:e})}},{key:"startReceiveMode",value:function(e){var t=this;return e&&(this.captureConf=e),this.msgChannel||(this.msgChannel=new MessageChannel,this.msgChannel.port1.onmessage=function(e){var r,n=e.data,i=n.type,a=n.frame;t.receiveTimer&&clearTimeout(t.receiveTimer),i===p.Abc&&a?(null===(r=t.msgChannel)||void 0===r||r.port1.postMessage({type:p.wb7}),t.isEnabled?(t.isVBRunning&&t.stopCapture(),t.renderFrame(a)):a.close(),t.isSafari||(t.receiveTimer=setTimeout((function(){t.captureConf&&!t.isVBRunning&&t.captureVideo(t.captureConf)}),1e3))):i!==p.L_m&&i!==p.lLs||(t.captureConf&&!t.isVBRunning&&t.captureVideo(t.captureConf),i===p.lLs&&t.msgChannel&&(t.msgChannel.port1.onmessage=null,t.msgChannel=null))}),this.msgChannel.port2}},{key:"enable",value:function(){this.postMessage({cmd:ir.VB_TOGGLE_VB,payload:!0}),this.isEnabled=!0}},{key:"disable",value:function(){this.postMessage({cmd:ir.VB_TOGGLE_VB,payload:!1}),this.isEnabled=!1,!this.isVBRunning&&this.msgChannel&&this.captureConf&&(this.captureVideo(this.captureConf).catch((function(e){})),clearTimeout(this.receiveTimer))}},{key:"renderFrame",value:function(e){return _r(this,0,void 0,O().mark((function t(){return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.postMessage({cmd:ir.VB_RENDER_FRAME,payload:e}),"close"in e&&e.close();case 1:case"end":return t.stop()}}),t,this)})))}},{key:"destory",value:function(){this.destoryed=!0,this.stopCapture(),this.vbLoadingTimer.clear(),this.msgChannel&&(this.msgChannel.port2.onmessage=null),this.captureVideoEle&&document.body.removeChild(this.captureVideoEle),this.worker&&(this.worker.removeEventListener("message",this.handle_message_from_vb_worker),this.worker.terminate())}},{key:"createStream",value:function(){var e=this;if(this.isStreamEnabled=!0,this.vbStream)return this.postMessage({cmd:ir.VB_GENERATE_STREAM}),this.vbStream;if(window.MediaStreamTrackGenerator)this.vbTrackGenerator=new MediaStreamTrackGenerator({kind:"video"}),this.vbStream=new MediaStream([this.vbTrackGenerator]);else{if(this.streamCanvas=document.createElement("canvas"),this.videoStream){var t=this.videoStream.getVideoTracks()[0];if(t){var r=t.getSettings(),n=r.width,i=void 0===n?0:n,a=r.height,o=void 0===a?0:a;this.streamCanvas.width=i,this.streamCanvas.height=o}}this.vbStream=this.streamCanvas.captureStream(24)}var s=this.vbStream.getVideoTracks()[0];return s&&(s.getStats=function(){return e.stats}),this.isVBReady&&this.generateVBStream(),this.vbStream}},{key:"stopStream",value:function(){this.vbStream&&(this.isStreamEnabled=!1,this.postMessage({cmd:ir.VB_STOP_STREAM}))}},{key:"handleLoadMetadata",value:function(){this.isMetadataLoaded=!0,this.captureVideoEle.removeEventListener("loadedmetadata",this.handleLoadMetadata)}}],[{key:"isSupportVB",value:function(){return _r(this,0,void 0,O().mark((function e(){var t;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,gr.A.simd();case 3:return t=e.sent,e.abrupt("return",navigator.hardwareConcurrency&&navigator.hardwareConcurrency>2&&t&&"function"==typeof OffscreenCanvas);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))}}])}();Sr.VB_WORKER_NAME="vb_worker",Sr.VB_CAPTURE_VIDEO="VB_CAPTURE_VIDEO",Sr.VB_STREAM_CANVAS="VB_STREAM_CANVAS",Sr.EXTERNAL_EVENTS=new Set([ir.VB_GENERATED_FRAME,ir.VB_INIT_FAILED,ir.VB_INIT_SUCCESS,ir.VB_MODEL_READY,ir.VB_PREDICT_DONE,ir.VB_VIDEO_FORMAT_UNSUPPORTED,ir.VB_WORKER_ERROR,ir.VB_GENERATE_FIRST_FRAME,ir.VB_RESOLUTION_CHANGE]);var Ar=Sr;if(document){var br=document.currentScript;if(br){var Er=br.src;if(Er){var kr=Er.indexOf("/vb.min.js");-1!==kr&&(Sr.cdnPath=Er.substring(0,kr))}}}var Cr,wr,Tr,Rr,Ir,Dr,Mr=r(3404);!function(e){e.ADD_VIDEO_PORT="add_video_port",e.ADD_SHADOW_PORT="add_shadow_port",e.ADD_VIDEO_PROCESSOR="add_video_processor",e.PROCESSOR_READY="processor_ready",e.PROCESSOR_ERROR="processor_error"}(Cr||(Cr={})),function(e){e.INIT_PROCESSOR="init_processor",e.UNINIT_PROCESSOR="uninit_processor",e.INIT_OUTPUT_CANVAS="init_output_canvas",e.OUTPUT_WRITABLE_STREAM="output_writable_stream",e.INPUT_READABLE_STREAM="input_readable_stream",e.FRAME_DATA="frame_data",e.START_REQUEST_FRAME="start_request_frame",e.STOP_REQUEST_FRAME="stop_request_frame",e.REQUEST_FRAME="request_frame",e.FRAME_CALLBACK="frame_callback",e.RESOLUTION_CHANGE="RESOLUTION_CHANGE",e.PROCESSOR_WORKER_ERROR="PROCESSOR_WORKER_ERROR"}(wr||(wr={}));var Or=D((function e(t,r,n){R(this,e),this.port=t,this.name=r,this.VideoFrameNeeded=n}),[{key:"setStream",value:function(e){var t=e.getVideoTracks()[0],r=t.getSettings().frameRate,n=void 0===r?24:r;this.trackProcessor=new MediaStreamTrackProcessor({track:t});var i=this.trackProcessor.readable;this.port.postMessage({cmd:wr.INPUT_READABLE_STREAM,frameRate:Math.min(n,24),readableStream:i,processorName:this.name},[i]),this.port.postMessage({cmd:wr.START_REQUEST_FRAME,frameRate:n,processorName:this.name,VideoFrameNeeded:this.VideoFrameNeeded})}},{key:"removeStream",value:function(){this.port.postMessage({cmd:wr.STOP_REQUEST_FRAME,processorName:this.name})}}]),xr=D((function e(t,r){var n=this;R(this,e);var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.port=t,this.name=r,this.isIOSDevice=i,this.VideoFrameNeeded=a,this.onMessage=function(e){if(e.data.cmd===wr.REQUEST_FRAME&&n.captureVideoEleLoaded){var t=n.captureVideoEle.videoWidth,r=n.captureVideoEle.videoHeight;if(t<=0||r<=0)return;n.isIOSDevice&&(n.captureCanvasEle.width=t,n.captureCanvasEle.height=r,n.captureCanvasEleCtx.drawImage(n.captureVideoEle,0,0,t,r));var i=new VideoFrame(n.isIOSDevice?n.captureCanvasEle:n.captureVideoEle,{timestamp:1e3*performance.now()});n.port.postMessage({cmd:wr.FRAME_DATA,frame:i,processorName:n.name}),i.close()}},this.port.addEventListener("message",this.onMessage)}),[{key:"createCaptureVideoElement",value:function(e){var t=this;this.captureVideoEle=document.querySelector("#video-processor-video"),this.captureVideoEle||(this.captureVideoEle=document.createElement("video"),this.captureVideoEle.autoplay=!0,this.captureVideoEle.playsInline=!0,this.captureVideoEle.id="video-processor-video",this.captureVideoEle.style.position="fixed",this.captureVideoEle.style.width="1px",this.captureVideoEle.style.height="1px",this.captureVideoEle.style.bottom="0px",this.captureVideoEle.style.right="0px",this.captureVideoEle.muted=!0,document.body.appendChild(this.captureVideoEle)),this.isIOSDevice&&!this.captureCanvasEle&&(this.captureCanvasEle=document.createElement("canvas"),this.captureCanvasEleCtx=this.captureCanvasEle.getContext("2d")),this.captureVideoEle.srcObject=e,this.captureVideoEle.addEventListener("loadedmetadata",(function(){t.captureVideoEleLoaded=!0})),this.captureVideoEle.play()}},{key:"setStream",value:function(e){var t=e.getVideoTracks()[0].getSettings().frameRate,r=void 0===t?24:t;this.createCaptureVideoElement(e),this.port.postMessage({cmd:wr.START_REQUEST_FRAME,frameRate:Math.min(r,24),processorName:this.name,VideoFrameNeeded:this.VideoFrameNeeded})}},{key:"removeStream",value:function(){this.port.postMessage({cmd:wr.STOP_REQUEST_FRAME,processorName:this.name})}},{key:"destroy",value:function(){this.port.removeEventListener("message",this.onMessage)}}]),Pr=D((function e(t,r){R(this,e),this.trackGenerator=new MediaStreamTrackGenerator({kind:"video"});var n=this.trackGenerator.writable;t.postMessage({cmd:wr.OUTPUT_WRITABLE_STREAM,writableStream:n,processorName:r},[n]),this.stream=new MediaStream([this.trackGenerator])}),[{key:"getStream",value:function(){return this.stream}}]),Lr=D((function e(t,r){R(this,e),this.canvas=document.createElement("canvas"),this.canvas.width=1,this.canvas.height=1,this.offScreenCanvas=this.canvas.transferControlToOffscreen(),this.stream=this.canvas.captureStream(24)}),[{key:"getOutputCanvas",value:function(){return this.offScreenCanvas}},{key:"getStream",value:function(){return this.stream}}]),Nr=D((function e(t,r){var n=this;R(this,e);var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.processorName=t,this.port=r,this.isIOSDevice=i,this.VideoFrameNeeded=a,this.frameCallback=null,this.callback=null,this.onMessage=function(e){var t,r;e.data.cmd===wr.FRAME_CALLBACK?null===(t=n.frameCallback)||void 0===t||t.call(n,e.data.frame):null===(r=n.callback)||void 0===r||r.call(n,e.data.cmd,e.data.data)},this.port.start(),this.port.addEventListener("message",this.onMessage);var o=this.getOutPutCanvas();o?this.port.postMessage({cmd:wr.INIT_OUTPUT_CANVAS,canvas:o,processorName:t},[o]):this.port.postMessage({cmd:wr.INIT_OUTPUT_CANVAS,processorName:t})}),[{key:"init",value:function(){this.port.postMessage({cmd:wr.INIT_PROCESSOR,processorName:this.processorName})}},{key:"addCallback",value:function(e){this.callback=e}},{key:"removeCallback",value:function(){this.callback=null}},{key:"uninit",value:function(){this.port.postMessage({cmd:wr.UNINIT_PROCESSOR,processorName:this.processorName}),this.port.removeEventListener("message",this.onMessage)}},{key:"getOutPutCanvas",value:function(){return null}},{key:"getStream",value:function(){throw new Error("Method not implemented.")}},{key:"setStream",value:function(e){throw new Error("Method not implemented.")}},{key:"removeStream",value:function(){}},{key:"onFrame",value:function(e){throw new Error("Method not implemented.")}},{key:"addFrameCallback",value:function(e){throw new Error("Method not implemented.")}},{key:"removeFrameCallback",value:function(){}}]),Vr=function(e){function t(e,r){var n;return R(this,t),(n=c(this,t,[e,r])).processorName=e,n.port=r,n}return f(t,e),D(t,[{key:"onFrame",value:function(e){this.port.postMessage({cmd:wr.FRAME_DATA,frame:e,processorName:this.processorName})}},{key:"addFrameCallback",value:function(e){this.frameCallback=e}},{key:"removeFrameCallback",value:function(){this.frameCallback=null}}])}(Nr),Ur=function(e){function t(e,r){var n;return R(this,t),(n=c(this,t,[e,r])).processorName=e,n.port=r,n}return f(t,e),D(t,[{key:"onFrame",value:function(e){}}])}(Vr),Fr=function(e){function t(e,r,n,i){var a;return R(this,t),(a=c(this,t,[e,r,n,i])).processorName=e,a.port=r,a.isIOSDevice=n,a.VideoFrameNeeded=i,a.initGenerator(),a}return f(t,e),D(t,[{key:"initGenerator",value:function(){this.originGenerator||(this.originGenerator="function"==typeof MediaStreamTrackProcessor?new Or(this.port,this.processorName,this.VideoFrameNeeded):new xr(this.port,this.processorName,this.isIOSDevice,this.VideoFrameNeeded)),this.targetGenerator||(this.targetGenerator="function"==typeof MediaStreamTrackGenerator?new Pr(this.port,this.processorName):new Lr(this.port,this.processorName))}},{key:"uninit",value:function(){var e,r,n,i;null===(r=null===(e=this.originGenerator)||void 0===e?void 0:e.destroy)||void 0===r||r.call(e),null===(i=null===(n=this.targetGenerator)||void 0===n?void 0:n.destroy)||void 0===i||i.call(n),s(t,"uninit",this)([])}},{key:"getOutPutCanvas",value:function(){var e,t;return this.initGenerator(),null===(t=(e=this.targetGenerator).getOutputCanvas)||void 0===t?void 0:t.call(e)}},{key:"getStream",value:function(){return this.targetGenerator.getStream()}},{key:"setStream",value:function(e){this.originGenerator.setStream(e)}},{key:"removeStream",value:function(){this.originGenerator.removeStream()}},{key:"addFrameCallback",value:function(e){this.frameCallback=e}}])}(Nr),Br=D((function e(){R(this,e)}),null,[{key:"hasProcessor",value:function(){return this.videoProcessorAgentMap.size>0}},{key:"hasMediaStreamFrameProcessor",value:function(){return y(this.videoProcessorAgentMap.values()).some((function(e){return e instanceof Fr}))}},{key:"addFrameCallback",value:function(e,t){this.frameCallbackMap.set(e,t),this.getProcessor(e)&&this.getProcessor(e).addFrameCallback(t)}},{key:"addCallback",value:function(e,t){this.callbackMap.set(e,t),this.getProcessor(e)&&this.getProcessor(e).addCallback(t)}},{key:"onFrame",value:function(e){var t,r=A(this.videoProcessorAgentMap.values());try{for(r.s();!(t=r.n()).done;)t.value.onFrame(e)}catch(e){r.e(e)}finally{r.f()}}},{key:"getStream",value:function(){return y(this.videoProcessorAgentMap.values()).pop().getStream()}},{key:"setStream",value:function(e){var t,r=A(this.videoProcessorAgentMap.values());try{for(r.s();!(t=r.n()).done;)t.value.setStream(e)}catch(e){r.e(e)}finally{r.f()}}},{key:"removeStream",value:function(){var e,t=A(this.videoProcessorAgentMap.values());try{for(t.s();!(e=t.n()).done;)e.value.removeStream()}catch(e){t.e(e)}finally{t.f()}}},{key:"getProcessor",value:function(e){return this.videoProcessorAgentMap.get(e)}},{key:"startProcessor",value:function(e,t){t.init();var r=this.frameCallbackMap.get(e);r&&t.addFrameCallback(r);var n=this.callbackMap.get(e);n&&t.addCallback(n),this.videoProcessorAgentMap.set(e,t)}},{key:"stopProcessor",value:function(e){var t=this.getProcessor(e);t&&(t.removeFrameCallback(),t.removeCallback(),this.frameCallbackMap.delete(e),this.callbackMap.delete(e),t.removeStream(),t.uninit()),this.videoProcessorAgentMap.delete(e)}},{key:"resetProcessorManager",value:function(){var e,t=A(this.videoProcessorAgentMap.keys());try{for(t.s();!(e=t.n()).done;){var r=e.value;this.stopProcessor(r)}}catch(e){t.e(e)}finally{t.f()}}}]);Br.videoProcessorAgentMap=new Map,Br.frameCallbackMap=new Map,Br.callbackMap=new Map,function(e){e[e.Unknow=0]="Unknow",e[e.MediaCommand=1]="MediaCommand",e[e.P2PControl=2]="P2PControl",e[e.MeshControl=3]="MeshControl"}(Tr||(Tr={})),function(e){e[e.normal=0]="normal",e[e.child=1]="child",e[e.parent=2]="parent",e[e.invalid=31]="invalid"}(Rr||(Rr={})),function(e){e[e.bridge=0]="bridge",e[e.setRole=1]="setRole",e[e.connectTestParams=2]="connectTestParams",e[e.reportConnectedSet=3]="reportConnectedSet",e[e.notifyChildParentLeave=4]="notifyChildParentLeave",e[e.notifyParentChildLeave=5]="notifyParentChildLeave",e[e.availableParents=6]="availableParents",e[e.updateNodeStatus=7]="updateNodeStatus",e[e.joinSuccess=8]="joinSuccess",e[e.kickChild=9]="kickChild",e[e.leaveParent=10]="leaveParent",e[e.subscriptionMap=11]="subscriptionMap",e[e.channelopt=12]="channelopt",e[e.joinSuccessConfirm=13]="joinSuccessConfirm",e[e.registerMeshNode=14]="registerMeshNode",e[e.meshAllowTalk=15]="meshAllowTalk",e[e.statInfo=16]="statInfo",e[e.adapt=17]="adapt",e[e.refershConnectParams=18]="refershConnectParams",e[e.joinConnectedSetConfirm=19]="joinConnectedSetConfirm",e[e.registerMeshNodeResult=20]="registerMeshNodeResult",e[e.meshSigType=21]="meshSigType",e[e.meshSigKey=22]="meshSigKey",e[e.unknown=1e3]="unknown"}(Ir||(Ir={})),function(e){e[e.Unknow=0]="Unknow",e[e.Offer=1]="Offer",e[e.Answer=2]="Answer"}(Dr||(Dr={}));var Wr=r(129),Gr=r.n(Wr),Hr=function(e,t,r,n){return new(r||(r=Promise))((function(t,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,o)}s((n=n.apply(e,[])).next())}))},jr={iceServers:[{urls:"stun:vdic157.zoomdev.us:3478"}]},Kr=function(){function e(t,r){R(this,e),this.remoteices=[],this.localices=[],this.peerId=t,this.label=r,this._readystatus=e.CONNECTING}return D(e,[{key:"ready",get:function(){return this._ready}},{key:"readystatus",get:function(){return this._readystatus}},{key:"onopen",get:function(){return this._onopen},set:function(e){this._onopen=e}},{key:"onclose",get:function(){return this._onclose},set:function(e){this._onclose=e}},{key:"_p2pchannelclose",value:function(){var t,r,n,i,a,o=this._readystatus;this._readystatus!=e.OPEN&&this._readystatus!=e.CLOSED&&this.resolveObj(!1),this._readystatus=e.CLOSED,o!=e.CLOSED&&(null===(t=this._onclose)||void 0===t||t.call(this,null));try{null===(r=this.channel)||void 0===r||r.onopen((function(){})),null===(n=this.channel)||void 0===n||n.onclose((function(){})),null===(i=this.channel)||void 0===i||i.close(),this.channel=null}catch(e){}try{this.pc.onicecandidate=null,this.pc.ondatachannel=null,this.pc.onconnectionstatechange=null,this.pc.oniceconnectionstatechange=null,null===(a=this.pc)||void 0===a||a.close(),this.pc=null}catch(e){}this._onclose=null,this._onopen=null}},{key:"_p2pchannelopen",value:function(){var t,r=this._readystatus;this._readystatus!=e.OPEN&&this._readystatus!=e.CLOSED&&(this._readystatus=e.OPEN,this.resolveObj(!0)),r!=e.OPEN&&(null===(t=this._onopen)||void 0===t||t.call(this,null))}},{key:"init",value:function(t){var r=this,n=t.runthread,i=t.signal,a=t.timeout,o=t.offer,s=this.peerId,u=this.label,c=Object.assign({},jr);c.iceServers=t.stunServers||[];var d=new RTCPeerConnection(c);this.pc=d,this._ready=new Promise((function(t,a){return Hr(r,0,void 0,O().mark((function r(){var a,c,l,h,f,p,v,g=this;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.resolveObj=t,a=(null==n?void 0:n.isUseTransferRTC())?n.getWorker():null,c=function(e){g.channel=new q.h(s,N.Xt.MESH,e.channel,a,"MESH",n),g.channel.transportlists=[X.vK.MESH_NETRTC],g.channel.onopen(g._p2pchannelopen.bind(g)),g.channel.onclose(g._p2pchannelclose.bind(g)),g.channel.open()},r.prev=3,d.onicecandidate=function(t){var r={type:"candidate",candidate:null,peerId:s,label:u};if(t.candidate){var n=t.candidate,a=n.candidate,o=n.sdpMid,c=n.sdpMLineIndex;r.candidate={candidate:a,sdpMid:o,sdpMLineIndex:c},g.localices.push(t.candidate.type)}g._readystatus!=e.CLOSED&&i(s,r)},l={peerId:s,label:u},!o){r.next=14;break}return d.ondatachannel=c,d.setRemoteDescription(o),r.next=10,d.createAnswer();case 10:h=r.sent,d.setLocalDescription(h),Object.assign(l,{answer:h,type:"answer"}),r.next=21;break;case 14:return f={ordered:!0,maxRetransmits:3},(p=d.createDataChannel(u,f)).binaryType="arraybuffer",c({channel:p}),r.next=19,d.createOffer();case 19:v=r.sent,d.setLocalDescription(v),Object.assign(l,{offer:v,type:"offer"});case 21:this._readystatus!=e.CLOSED&&i(s,l),r.next=27;break;case 24:r.prev=24,r.t0=r.catch(3),this._p2pchannelclose();case 27:case"end":return r.stop()}}),r,this,[[3,24]])})))}));var l=void 0!==d.connectionState,h=this,f=["closed","failed"],p=function(){var t=d.connectionState||d.iceConnectionState,r="connected"==t;h._readystatus!=e.OPEN||r||(f.includes(t)?h._p2pchannelclose():setTimeout((function(){p()}),5e3))};l?d.onconnectionstatechange=p:d.oniceconnectionstatechange=p,a&&setTimeout((function(){r._readystatus==e.CONNECTING&&r._p2pchannelclose()}),a)}},{key:"signalMsg",value:function(t){if(this._readystatus==e.CONNECTING){var r=t.type;if("answer"==r&&this.pc.setRemoteDescription(t.answer),"candidate"==r&&(this.pc.addIceCandidate(t.candidate),t.candidate)){var n=new RTCIceCandidate(t.candidate);this.remoteices.push(n.type)}}}},{key:"close",value:function(){this._p2pchannelclose()}},{key:"getStatus",value:function(){return Hr(this,0,void 0,O().mark((function t(){var r,n;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r="error",this._readystatus!=e.OPEN){t.next=6;break}return t.next=4,this.pc.getStats();case 4:(n=t.sent).forEach((function(e){if("transport"===e.type&&e.selectedCandidatePairId){var t=n.get(e.selectedCandidatePairId),i=n.get(t.remoteCandidateId),a=n.get(t.localCandidateId);r="".concat(i.candidateType,"|").concat(a.candidateType)}}));case 6:return t.abrupt("return","".concat(r,"-").concat(this.localices.join("|"),"-").concat(this.remoteices.join("|")));case 7:case"end":return t.stop()}}),t,this)})))}}],[{key:"create",value:function(t){var r=new e(t.peerId,t.label);return r.init(t),r}}])}();Kr.OPEN=1,Kr.CONNECTING=2,Kr.CLOSED=3;var zr=function(e,t,r,n){return new(r||(r=Promise))((function(t,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,o)}s((n=n.apply(e,[])).next())}))},qr=1e4,Yr=D((function e(t){R(this,e),this.timeoutid=-1,this.defered=new h.cY,this.id=performance.now(),this.worker=t}),[{key:"setResult",value:function(e){this.defered.resolve(e)}},{key:"start",value:function(){return zr(this,0,void 0,O().mark((function e(){var t,r,n=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return-1==this.timeoutid&&(this.timeoutid=window.setTimeout((function(){n.defered.resolve(-1)}),5e3)),r={command:hr.BB,id:this.id},null===(t=this.worker)||void 0===t||t.postMessage(r),e.next=5,this.defered.promise;case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})))}}]),Xr=D((function e(t,r,n,i,a){var o=this;R(this,e),this.cid=t,this.nodeid=r,this.role=n,this.initrole=i,this.stunServers=a,this.meshThread=null,this.workers={},this.testsidfaillist=[],this.parentbadlist=[],this.childconnectedlasted=0,this.maxconnectedcount=3,this.connectdcount=0,this.isdestory=!1,this.sid=null,this.monitorLog=function(){},this.signatureInfo=null,this.pcMap=new Map,this.cid=t,this.nodeid=r,this.role=n,this.preRole=n,this.initrole=i,this._ready=new Promise((function(e,t){o.ready_resolve=e}))}),[{key:"isDestory",value:function(){return this.isdestory}},{key:"setMonitorLog",value:function(e){this.monitorLog=e}},{key:"ready",get:function(){return this._ready}},{key:"sendMeshBypassMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};g.A.sendMessageToRwg(p.yJV,{evt:4366,seq:1,body:{type:Tr.MeshControl,data:Object.assign({cmdType:e},t)}})}},{key:"onMessage",value:function(e,t){if(!this.isDestory()){switch(e){case Ir.bridge:var r=t.srcID,n=t.dstID,i=t.bridgeData;if(n!==this.cid)return;var a=i.peerId,o=i.type;if("answer"==o){var s=this.pcMap.get(a);s&&s.signalMsg(i)}else if("offer"==o)this.onRemoteP2PChannel(r,i);else if("candidate"==o){var u=this.pcMap.get(a);u&&u.signalMsg(i)}break;case Ir.connectTestParams:this.connectTest(t.params);break;case Ir.setRole:this.changeRole(t.role);break;case Ir.joinConnectedSetConfirm:t.sid,t.confirm||(this.monitorLog("JOINSIDF"),this.sid="",this.sendMeshBypassMessage(Ir.refershConnectParams,{}))}this._onMessage(e,t)}}},{key:"sendBridgeMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.sendMeshBypassMessage(Ir.bridge,{srcID:this.cid,dstID:e,bridgeData:t})}},{key:"connectTest",value:function(e){return zr(this,0,void 0,O().mark((function t(){var r,n,i,a,o,s,u,c=this;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=0,i=A(e),t.prev=3,o=O().mark((function e(){var t,i,o,u,d,l,h,f,p,v;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.value,i=t.sid,o=t.cid,!c.testsidfaillist.includes(i)){e.next=3;break}return e.abrupt("return",0);case 3:return u="test",d="".concat(null===(r=c.cid)||void 0===r?void 0:r.slice(0,7),"-").concat(u,"-").concat(Date.now()),l=function(e,t){c.sendBridgeMessage(o,t)},h=c.stunServers,f={peerId:d,label:u,signal:l,timeout:qr,stunServers:h},n++,s=Kr.create(f),c.pcMap.set(d,s),s.onclose=function(){c.pcMap.delete(d)},e.next=9,s.ready;case 9:return p=e.sent,e.next=12,s.getStatus();case 12:if(v=e.sent,c.monitorLog("MESHCANDIDATE:".concat(v)),!p){e.next=16;break}return c.sendMeshBypassMessage(Ir.reportConnectedSet,{sid:i}),c.sid=i,setTimeout((function(){s.close()}),3e3),e.abrupt("return",1);case 16:c.testsidfaillist.push(i);case 17:case"end":return e.stop()}}),e)})),i.s();case 6:if((a=i.n()).done){t.next=15;break}return t.delegateYield(o(),"t0",8);case 8:if(0!==(u=t.t0)){t.next=11;break}return t.abrupt("continue",13);case 11:if(1!==u){t.next=13;break}return t.abrupt("break",15);case 13:t.next=6;break;case 15:t.next=20;break;case 17:t.prev=17,t.t1=t.catch(3),i.e(t.t1);case 20:return t.prev=20,i.f(),t.finish(20);case 23:this.monitorLog("MESHSIDTEST:".concat(n,":").concat(!!this.sid)),this.sid||this.sendMeshBypassMessage(Ir.reportConnectedSet,{sid:""});case 24:case"end":return t.stop()}}),t,this,[[3,17,20,23]])})))}},{key:"onRemoteP2PChannel",value:function(e,t){var r=this,n=t.peerId,i=t.label,a=t.offer;this.monitorLog("MESHREMOTE:".concat(n,":").concat(i));var o="mesh"==i,s=this.workers.mesh,u=o?s:null,c=this.stunServers,d={peerId:n,label:i,signal:function(t,n){r.sendBridgeMessage(e,n)},timeout:qr,stunServers:c,runthread:u,offer:a},l=Kr.create(d);this.pcMap.set(n,l);var h=t.nodeid;l.onopen=function(){r.pcMap.has(n)?(o&&r.role==Rr.parent&&r._onChildConnect(e,h,n),o&&r.role!=Rr.parent&&(r.monitorLog("MESHDOWNGRADE"),l.close())):l.close()},l.onclose=function(){r.pcMap.delete(n),o&&r._onChildDisConnect(e,n)}}}]),Qr=function(e){function t(e){var r;R(this,t);var n=e.cid,i=e.nodeid,a=e.role,o=e.initrole,s=e.stunServers;return(r=c(this,t,[n,i,a,o,s])).childCIdList=[],r.points=0,r.maxLoad=10,r.audioWorker=null,r.videoWorker=null,r.parentCid=null,r.preParentCiud=null,r.netThread=null,r.rttProde=null,r.badNetChild=0,r.reportLoad=0,r.enableAllowTalk=!1,r.selfAllowTalk=!1,r.signatureInfo=e.signatureInfo,r.points=e.initpoints,r.maxLoad=e.initnodes,r.enableAllowTalk=e.enableAllowTalk,setInterval((function(){r.updateDevicePoints()}),1e4),r}return f(t,e),D(t,[{key:"_resolvePromise",value:function(e){this.ready_resolve&&this.ready_resolve(e),this.ready_resolve=null}},{key:"_onMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(e){case Ir.notifyParentChildLeave:this.onChildLeave(t.cid);break;case Ir.subscriptionMap:this._MeshControlleOptInfo("subInfo",t.info);break;case Ir.channelopt:this._MeshControlleOptInfo("channelOpt",t.info);break;case Ir.notifyChildParentLeave:this.onParentLeave();break;case Ir.availableParents:this.connect(t.params);break;case Ir.meshAllowTalk:this.allowTalk(t);break;case Ir.joinSuccessConfirm:this.joinSuccessConfirm(t);break;case Ir.meshSigKey:this.signatureInfo.mmrsigkey=t.recipe,this.setSignature();break;case Ir.meshSigType:this.signatureInfo.type=t.type,this.signatureInfo.meetinguuid=t.confID,this.setSignature()}}},{key:"_onNetThread",value:function(e){var t;switch(e.data.status){case te.KA:var r=e.data,n=r.id,i=r.value;n==this.rttProde.id&&this.rttProde.setResult(i);break;case te.qi:var a=e.data.data;a.oldRole=this.preRole,a.udid=this.cid;var o=h.Ay.getOSInfo();a.os=null===(t=null==o?void 0:o.browser)||void 0===t?void 0:t.name,this.preRole=a.newRole,a.newRole==Rr.child?a.parentUdid=this.parentCid||this.preParentCiud:a.newRole==Rr.parent&&(a.childNode=this.childCIdList.length,a.childNodesUdid=this.childCIdList.map((function(e){return e.cid}))),this.parentCid||a.newRole!=Rr.child||(a.newRole=Rr.normal),this.sendMeshBypassMessage(Ir.statInfo,{info:a})}}},{key:"_onMeshThread",value:function(e){var t,r=this;switch(e.data.status){case te.$U:var n=e.data,i=n.cid,a=n.nodeid,o=n.session_type,s=n.sub_mode_limit;this.monitorLog("MESHADAPT_LIMIT:".concat(a,":").concat(s)),this.sendMeshBypassMessage(Ir.adapt,{childCid:i,session_type:o,sub_mode_limit:s});break;case te.U2:var u=e.data,c=u.cid,d=u.nodeid,l=u.peerId;this.monitorLog("MESHKICK_CHILD:".concat(d)),this.badNetChild++,setTimeout((function(){r.badNetChild--}),3e4*this.badNetChild),this.kickChild(c);var f=this.pcMap.get(l);null==f||f.close();break;case te.qi:var p=e.data.data;p.oldRole=this.preRole,p.udid=this.cid;var v=h.Ay.getOSInfo();p.os=null===(t=null==v?void 0:v.browser)||void 0===t?void 0:t.name,this.preRole=p.newRole,p.newRole==Rr.parent&&(p.childNode=this.childCIdList.length,p.childNodesUdid=this.childCIdList.map((function(e){return e.cid}))),p.childNode||(p.newRole,Rr.normal),this.sendMeshBypassMessage(Ir.statInfo,{info:p})}}},{key:"_MeshControlleOptInfo",value:function(e,t){var r,n,i=(0,ie.CH)(t),a={command:hr.pV,type:e,info:i},o=null===(r=this.netThread)||void 0===r?void 0:r.getWorker(),s=null===(n=this.meshThread)||void 0===n?void 0:n.getWorker();null==o||o.postMessage(a),null==s||s.postMessage(a)}},{key:"updateDevicePoints",value:function(){var e=this.maxLoad-this.childCIdList.length-this.badNetChild;if(this.enableAllowTalk||!this.selfAllowTalk||(e=-1),e!=this.reportLoad){this.reportLoad=e;var t=this.enableAllowTalk||!this.selfAllowTalk;this.sendMeshBypassMessage(Ir.updateNodeStatus,{points:t?this.points:0,curLoad:this.childCIdList.length,freeLoad:e})}}},{key:"kickChild",value:function(e){this.sendMeshBypassMessage(Ir.kickChild,{childCid:e})}},{key:"onChildLeave",value:function(e){this.monitorLog("MESHCHILDLEAVE"),this.updateDevicePoints();var t=this.childCIdList.findIndex((function(t){return t.cid==e}));if(-1!=t){var r=this.childCIdList[t],n=r.cid,i=r.peerId,a=this.pcMap.get(i);null==a||a.close(),a&&this._onChildDisConnect(n,i)}}},{key:"onDestroy",value:function(){var e=this;this.monitorLog("MESHDESTORY"),this.netThread=null,this.isdestory=!0,this.role==Rr.child&&this.sendMeshBypassMessage(Ir.leaveParent),this._resolvePromise(!1);try{Array.from(this.pcMap.keys()).forEach((function(t){var r=e.pcMap.get(t);r.onopen=function(){},r.onclose=function(){},null==r||r.close(),e.pcMap.delete(t)}))}catch(e){m.Ay.error("mesh destory error",e)}}},{key:"closeMeshPc",value:function(){var e=this;try{this.parentCid=null,Array.from(this.pcMap.keys()).forEach((function(t){var r=e.pcMap.get(t);"mesh"==r.label&&(e.pcMap.delete(t),r.onopen=function(){},r.onclose=function(){},null==r||r.close())}))}catch(e){m.Ay.error("mesh destory error",e)}}},{key:"testExitChild",value:function(){var e=this;this.notifyDecodeRoleChange(Rr.normal);var t=this.pcMap.keys();Array.from(t).forEach((function(t){var r=e.pcMap.get(t);null==r||r.close(),e.pcMap.delete(t)}))}},{key:"setWorkerThread",value:function(e){return zr(this,0,void 0,O().mark((function t(){var r,n,i,a,o;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.workers=e,t.prev=1,r=this.workers||{},n=r.net,i=r.mesh,a=r.audio,o=r.video,t.t0=n,!t.t0){t.next=8;break}return t.next=7,n.ready();case 7:this.netThread=n;case 8:if(this.audioWorker=a,this.videoWorker=o,!i||this.meshThread||this.initrole!=Rr.parent){t.next=18;break}return t.next=13,i.init();case 13:return t.next=15,i.ready();case 15:if(i.getWorker()){t.next=17;break}return t.abrupt("return",void this._resolvePromise(!1));case 17:this.meshThread=i;case 18:if(!this.isDestory()){t.next=20;break}return t.abrupt("return");case 20:this.changeRole(this.role),i.onmessage=this._onMeshThread.bind(this),n.onmessage=this._onNetThread.bind(this),this._resolvePromise(!0),t.next=26;break;case 23:t.prev=23,t.t1=t.catch(1),this._resolvePromise(!1),m.Ay.error("mesh init error",t.t1);case 26:case"end":return t.stop()}}),t,this,[[1,23]])})))}},{key:"changeRole",value:function(e){return zr(this,0,void 0,O().mark((function t(){var r,n,i,a;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.monitorLog("SETMESHROLE:".concat(e)),n=this.role==Rr.normal||this.role==Rr.invalid,this.role==e||n||(this.notifyDecodeRoleChange(Rr.normal),this.closeMeshPc()),this.role=e,t.next=6,this.ready;case 6:i={command:hr.g,data:e},null==(a=null===(r=this.meshThread)||void 0===r?void 0:r.getWorker())||a.postMessage(i);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"allowTalk",value:function(e){var t,r,n=e.allow,i=e.isSelf;this.monitorLog("ALLOWTALK:".concat(n,",").concat(i)),i&&(this.selfAllowTalk=n);var a={command:hr.j$,allow:n,isSelf:i},o=(this.workers||{}).net;null===(t=null==o?void 0:o.getWorker())||void 0===t||t.postMessage(a),null===(r=this.audioWorker)||void 0===r||r.postMessage(a),this.setSignature(!0,!1,!1),this.selfAllowTalk&&!this.enableAllowTalk&&(this.notifyDecodeRoleChange(Rr.normal),this.closeMeshPc())}},{key:"connect",value:function(e){return zr(this,0,void 0,O().mark((function t(){var r,n,i,a=this;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.enableAllowTalk||!this.selfAllowTalk){t.next=2;break}return t.abrupt("return");case 2:if(r=e.filter((function(e){var t=e.cid,r=e.freeLoad;return!a.parentbadlist.includes(t)&&r>0})),Gr()(r).call(r,(function(e,t){return t.match===e.match?t.freeLoad-e.freeLoad:t.match-e.match})),n=r.slice(0,3).map((function(e){return e.cid})),!(this.parentCid||0==n.length||this.parentbadlist.length>=5)){t.next=7;break}return t.abrupt("return");case 7:this.preParentCiud=this.parentCid,this.parentCid=n[0],i=this.parentCid,setTimeout((function(){return zr(a,0,void 0,O().mark((function e(){var t,r,n=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._connect(i);case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:return this.connectdcount++,t.onopen=function(e){return zr(n,0,void 0,O().mark((function e(){var r,n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.childconnectedlasted=performance.now(),(0,Y.uB)(t.channel),r=!0,e.next=4,this.prodeRTT();case 4:if(r=e.sent,n=this.pcMap.has(t.peerId),this.monitorLog("MESHJOIN:".concat(r&&n)),r&&n){e.next=8;break}return e.abrupt("return",(setTimeout((function(){t.close()}),0),void this.monitorLog("MESHCLOSE:".concat(r,"|").concat(n))));case 8:this.sendMeshBypassMessage(Ir.joinSuccess,{parentCid:i});case 9:case"end":return e.stop()}}),e,this)})))},t.onclose=function(e){n.pcMap.delete(t.peerId),n.monitorLog("MESHLEAVE"),n.notifyDecodeRoleChange(Rr.normal),n.sendMeshBypassMessage(Ir.leaveParent,{parentCid:i}),n.parentCid=null,(0,Y.np)(t.channel);var r=performance.now();r<=n.childconnectedlasted+15e3?n.parentbadlist.push(i):r-n.childconnectedlasted>18e4?n.connectdcount=0:n.connectdcount=1},e.next=10,t.ready;case 10:if(e.t0=e.sent,e.t0){e.next=13;break}this.parentbadlist.push(i);case 13:return e.next=15,t.getStatus();case 15:r=e.sent,this.monitorLog("MESHCANDIDATE:".concat(r));case 17:case"end":return e.stop()}}),e,this)})))}),5e3*this.connectdcount);case 10:case"end":return t.stop()}}),t,this)})))}},{key:"_connect",value:function(e){return zr(this,0,void 0,O().mark((function t(){var r,n,i,a,o,s,u=this;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ready;case 2:if(t.t0=!t.sent,t.t0){t.next=5;break}t.t0=this.isDestory();case 5:if(!t.t0){t.next=7;break}return t.abrupt("return",null);case 7:return n="".concat(null===(r=this.cid)||void 0===r?void 0:r.slice(0,7),"-mesh-").concat(Date.now()),i=this.workers.net,a=this.stunServers,o={peerId:n,label:"mesh",signal:function(t,r){r.nodeid=u.nodeid,u.sendBridgeMessage(e,r)},timeout:qr,stunServers:a,runthread:i},s=Kr.create(o),t.abrupt("return",(this.pcMap.set(n,s),s));case 9:case"end":return t.stop()}}),t,this)})))}},{key:"onParentLeave",value:function(){this.monitorLog("MESHPARENLEAVE"),this.role==Rr.child&&this.notifyDecodeRoleChange(Rr.normal)}},{key:"_onChildConnect",value:function(e,t,r){var n,i={command:hr.L2,opt:"add",cid:e,nodeid:t,peerId:r},a=null===(n=this.meshThread)||void 0===n?void 0:n.getWorker();null==a||a.postMessage(i),this.childCIdList.push({cid:e,peerId:r})}},{key:"_onChildDisConnect",value:function(e,t){var r,n=this.childCIdList.findIndex((function(t){return t.cid==e}));if(-1!=n){this.childCIdList.splice(n,1);var i={command:hr.L2,opt:"remove",cid:e,nodeid:1,peerId:t},a=null===(r=this.meshThread)||void 0===r?void 0:r.getWorker();null==a||a.postMessage(i),0==this.childCIdList.length&&this.notifyDecodeRoleChange(Rr.normal),this.kickChild(e)}}},{key:"notifyDecodeRoleChange",value:function(e){var t,r,n,i={command:hr.g,data:e},a=null===(t=this.netThread)||void 0===t?void 0:t.getWorker();null==a||a.postMessage(i),null===(r=this.audioWorker)||void 0===r||r.postMessage(i),null===(n=this.videoWorker)||void 0===n||n.postMessage(i),e==Rr.child&&this.setSignature()}},{key:"joinSuccessConfirm",value:function(e){var t=e.confirm,r=e.childCid,n=e.parentCid;if(this.monitorLog("MESHJOINCOMFIRM:".concat(t)),t)if(this.role!=Rr.child||n!=this.parentCid){var i=this.childCIdList.findIndex((function(e){return e.cid==r}));this.role==Rr.parent&&-1!=i&&this.notifyDecodeRoleChange(Rr.parent)}else this.notifyDecodeRoleChange(this.role)}},{key:"prodeRTT",value:function(){return zr(this,0,void 0,O().mark((function e(){var t,r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.workers.net,this.rttProde=new Yr(t.getWorker()),e.next=4,this.rttProde.start();case 4:return r=e.sent,e.abrupt("return",-1!=r&&r<=100);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"setSignature",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.signatureInfo,i=n.type,a=n.meetinguuid,o=n.mmrsigkey,s=this.workers,u=s.video,c=s.audio,d=s.share;if(this.role==Rr.child&&(0==i||a)&&(2!=i||o)){this.monitorLog("MESHSIGNINFO:".concat(i,":").concat(null==o?void 0:o.length,":").concat(null==a?void 0:a.length));var l=Object.assign({command:hr.BM},this.signatureInfo);t&&(null==u||u.postMessage(Object.assign({appid:3},l))),r&&(null==d||d.postMessage(Object.assign({appid:2},l))),e&&(null==c||c.postMessage(Object.assign({appid:1},l)))}}}])}(Xr),Jr={type:0,meetinguuid:null,mmrsigkey:null},$r=function(){function e(){R(this,e)}return D(e,null,[{key:"createAgent",value:function(t,r,n,i){var a={cid:r,nodeid:n,role:t,initrole:e.role,initpoints:e.initpoints,stunServers:(null==i?void 0:i.map((function(e){return{urls:e}})))||[],signatureInfo:this.signatureInfo,initnodes:this.initnodes,enableAllowTalk:this.enableAllowTalk};this.meshAgent=new Qr(a)}},{key:"setInitRole",value:function(t,r,n,i,a){e.role=t,e.initpoints=r,e.sdkId=n,e.initnodes=i,e.enableAllowTalk=a}},{key:"reportInitPoints",value:function(){var t=e.role,r=e.initpoints;g.A.sendMessageToRwg(p.yJV,{evt:4366,seq:1,body:{type:Tr.MeshControl,data:{cmdType:Ir.updateNodeStatus,points:r,curLoad:0,freeLoad:t==Rr.parent?3:0}}})}},{key:"registerMeshNote",value:function(){g.A.sendMessageToRwg(p.yJV,{evt:4366,seq:1,body:{type:Tr.MeshControl,data:{cmdType:Ir.registerMeshNode}}})}},{key:"getAgent",value:function(){return this.meshAgent}},{key:"destroy",value:function(){this.role=Rr.invalid,this.signatureInfo=Object.assign({},Jr),this.meshAgent&&this.meshAgent.onDestroy(),this.meshAgent=null}}])}();$r.role=Rr.invalid,$r.initpoints=0,$r.initnodes=0,$r.sdkId=0,$r.enableAllowTalk=!1,$r.haslicense=!0,$r.signatureInfo=Object.assign({},Jr);var Zr,en=r(7355),tn=r(8516),rn=r(1265),nn=r.n(rn);function an(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function on(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?an(Object(r),!0).forEach((function(t){(0,i.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):an(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var sn=function(){function e(){R(this,e)}return D(e,null,[{key:"checkCaptureNeedDeviceFallback",value:function(e,t){return!(!h.Ay.isMobileForceAutoChooseAudioDeviceEnable()||!e||!e.audioSource||"NotAllowedError"!=t.name||"No AVAudioSessionCaptureDevice device"!=t.message||(e.audioSource=null,0))}},{key:"draftAudioConstraints",value:function(e){var t,r,n,i=e.audioCapture?{audioSource:e.audioCapture?e.audioCapture.AudioSelectValue:null,enableOriginalSound:"originalSound"===(null===(t=e.audioCapture)||void 0===t||null===(t=t.audioProfile)||void 0===t?void 0:t.currentSelect),enableStereo:"originalSound"===(null===(r=e.audioCapture)||void 0===r||null===(r=r.audioProfile)||void 0===r?void 0:r.currentSelect)&&(null===(n=e.audioCapture)||void 0===n||null===(n=n.audioProfile)||void 0===n||null===(n=n.originalSound)||void 0===n?void 0:n.stereo),isSupportBrowserAec:e.isSupportBrowserAec,disableAudioAGC:e.disableAudioAGC,disableNoiseSuppression:e.disableNoiseSuppression,retry:e.audioCapture.retry}:null,a=this.checkForceChangeMicDeviceIdRequired();return a&&(i||(i={}),i.audioSource=a.deviceId),i}},{key:"checkForceChangeMicDeviceIdRequired",value:function(){if(!h.Ay.isMobileForceAutoChooseAudioDeviceEnable())return null;if(h.Ay.isIphoneOrIpadBrowser()){var e=Ze.A.getDeviceListFromCache().filter((function(e){return"audioinput"==e.kind}));return e.length>1?{deviceId:e.filter((function(e){return!e.label.match(/iPhone/)})).pop().deviceId}:{deviceId:void 0}}if(h.Ay.isAndroidBrowser()){var t=Ze.A.getMicDeviceIdByLabel("Wired headset"),r=Ze.A.getMicDeviceIdByLabel("USB audio"),n=Ze.A.getMicDeviceIdByLabel("Bluetooth headset");return t?{deviceId:t}:r?{deviceId:r}:n?{deviceId:n}:{deviceId:void 0}}return null}},{key:"isMobileNeedRecaptureAfterDeviceChange",value:function(e,t,r){if(h.Ay.isMobileForceAutoChooseAudioDeviceEnable()){if(h.Ay.isAndroidBrowser()&&Ze.A.isDeviceChanged(t.filter((function(e){return"audioinput"==e.kind})),r.filter((function(e){return"audioinput"==e.kind}))))return{result:!0,reason:"android recapture"};if(h.Ay.isIphoneOrIpadBrowser()){if(!this.isCaptureHealthy(e.getMediaStreamController()))return{result:!0,reason:"capture not healthy"};if(t.filter((function(e){return"audioinput"==e.kind&&""==e.label})).length)return{result:!0,reason:"permission grant"};if(t.filter((function(e){return"audioinput"==e.kind})).length>r.filter((function(e){return"audioinput"==e.kind})).length)return{result:!0,reason:"device disconnect"}}}return{result:!1}}},{key:"isCaptureHealthy",value:function(e){var t=e.getAudioStream();if(t){var r=t.getAudioTracks();if(r.length&&"live"==r[0].readyState&&0==r[0].muted)return!0}return!1}},{key:"isSelectedDeviceExistAsync",value:function(){var e=H(O().mark((function e(){var t;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!1,e.next=3,Ze.A.getDeviceListAsync();case 3:return e.sent.forEach((function(e){var r;"audioinput"==e.kind&&(null===(r=e.label)||void 0===r||null===(r=r.replace(/\(\w+:\w+\)|,/gi,""))||void 0===r?void 0:nn()(r).call(r))==Ze.A.getMicLabel()&&e.deviceId==Ze.A.getMicId()&&(t=!0)})),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"captureFromEarpiece",value:function(){var e=H(O().mark((function e(t){var r,n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(h.Ay.isMobileForceAutoChooseAudioDeviceEnable()&&h.Ay.isAndroidForceEarpiceCaptureEnable()&&h.Ay.isAndroidBrowser()&&h.Ay.browser.isChromeOrEdge)||Ze.A.isPreviewMode){e.next=8;break}if(!(r=Ze.A.getMicDeviceIdByLabel("Headset earpiece"))||null===Ze.A||void 0===Ze.A||!Ze.A.onlyHasBInDeviceOnAndroid()){e.next=8;break}return m.Ay.directReport("force capture audio from headset earpiece on Android"),e.next=6,navigator.mediaDevices.getUserMedia(on(on({},t),{},{audio:on(on({},t.audio),{},{deviceId:r})}));case 6:i=e.sent,null===(n=i)||void 0===n||n.getAudioTracks().forEach((function(e){e.stop()})),i=null;case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"captureAudioStreamWithRetry",value:function(){var t=H(O().mark((function t(r,n){var i,a,o,s=arguments;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=s.length>2&&void 0!==s[2]&&s[2],t.prev=1,t.next=4,e.captureFromEarpiece(r);case 4:return t.next=6,navigator.mediaDevices.getUserMedia(r);case 6:return t.abrupt("return",t.sent);case 9:if(t.prev=9,t.t0=t.catch(1),"OverconstrainedError"===t.t0.name&&i){t.next=13;break}return t.abrupt("return",Promise.reject(t.t0));case 13:return t.prev=13,t.next=16,navigator.mediaDevices.getUserMedia(on(on({},r),{},{audio:{deviceId:r.audio.deviceId}}));case 16:return a=t.sent,t.abrupt("return",(m.Ay.directReport("capture audio stream successfully after remove 3A constraints"),a));case 20:if(t.prev=20,t.t1=t.catch(13),"OverconstrainedError"===t.t1.name&&!n){t.next=24;break}return t.abrupt("return",Promise.reject(t.t1));case 24:return t.prev=24,t.next=27,navigator.mediaDevices.getUserMedia(on(on({},r),{},{audio:!0}));case 27:return o=t.sent,t.abrupt("return",(m.Ay.directReport("capture audio stream successfully after remove all audio constraints"),o));case 31:return t.prev=31,t.t2=t.catch(24),t.abrupt("return",Promise.reject(t.t2));case 34:case"end":return t.stop()}}),t,null,[[1,9],[13,20],[24,31]])})));return function(e,r){return t.apply(this,arguments)}}()}])}();function un(e,t){return cn.apply(this,arguments)}function cn(){return cn=H(O().mark((function e(t,r){var n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t).audioCapture&&r){!function(){var e=H(O().mark((function e(t,r,n){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.enableHID,!e.t0){e.next=12;break}if(e.t1=t.hidAvalible,!e.t1){e.next=7;break}return e.next=6,ze.destroy();case 6:t.hidAvalible=!1;case 7:if(e.t2=r,!e.t2){e.next=12;break}return e.next=11,ze.init(r,n);case 11:t.hidAvalible=e.sent;case 12:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()(n,r.microphoneLabel,r.defaultMuted),n.getMediaStreamController().destoryAudioMediaStream(),_.Notify_Audio_Encode_Thread({command:hr.dt,value:!1});try{n.isCaputureNodeConnect=!1,g.A.ComputerAudioStatus=N.BX.ComputerAudio_Connecting,r.audioProfile=n.audioCapture.audioProfile,n.audioCapture=r,n.audioCtx&&n.audioCtx.sampleRate!=n.sampleRate&&(n.sampleRate=n.audioCtx.sampleRate,_.Modify_Audio_SampleRate(n.sampleRate)),n.Start_Audio_Capture(),_.Reset_Aec(),n.audioMicSetErrorCnt=0}catch(e){n.notifyUISetMicError({currentMic:Ze.A.getMicId(),reason:"".concat(e.message)}),n.JsMediaSDK_Log(e)}}case 2:case"end":return e.stop()}}),e)}))),cn.apply(this,arguments)}function dn(e,t){m.Ay.log("[Audio] iOS/iPadOS track label change detected old:"+e+", new: "+t);var r=Ze.A.getMicDeviceIdByLabel(t);Ze.A.reportUsingMicDevice(r,t,0,!0),g.A.Notify_APPUI(p.Ubu,{microphoneDeviceId:r,isPassive:!0})}!function(e){e.INIT_PROCESSOR="__init_zoom_audio_processor__",e.UNINIT_PROCESSOR="__uninit_zoom_audio_processor__"}(Zr||(Zr={}));var ln=function(){function e(){R(this,e)}return D(e,null,[{key:"audioProcessorCtx",get:function(){return this._audioProcessorCtx||(this._audioProcessorCtx=new AudioContext),this._audioProcessorCtx}},{key:"resumeCtx",value:function(){"suspended"===e.audioProcessorCtx.state&&e.audioProcessorCtx.resume().catch((function(e){m.Ay.error("audioProcessorCtx resume fail",e)}))}},{key:"hasProcessor",value:function(){return this.activeProcessorList.length>0}},{key:"getStream",value:function(){return this.processedStream}},{key:"setStream",value:function(e){this.stream=e,this.audioWorkletNodeMap.size>0&&this.updateProcessedStream()}},{key:"removeStream",value:function(){this.stream=null,this.processedStream=null}},{key:"cleanNodes",value:function(){var e=this;this.newInputNode&&(this.newInputNode.disconnect(),this.newInputNode=null),this.newDestNode&&(this.newDestNode.disconnect(),this.newDestNode=null),this.activeProcessorList.forEach((function(t){var r=e.audioWorkletNodeMap.get(t);r&&r.disconnect()}))}},{key:"updateProcessedStream",value:function(){var e=this;this.stream?(this.cleanNodes(),this.resumeCtx(),this.newInputNode=this.audioProcessorCtx.createMediaStreamSource(this.stream),this.newDestNode=this.audioProcessorCtx.createMediaStreamDestination(),this.activeProcessorList.reduce((function(t,r){var n=e.audioWorkletNodeMap.get(r);return n?t.connect(n):t}),this.newInputNode).connect(this.newDestNode),this.processedStream=this.newDestNode.stream):(this.cleanNodes(),this.processedStream=null,this.audioProcessorCtx.suspend())}},{key:"addProcessor",value:function(e,t){t.port.start(),this.audioWorkletNodeMap.set(e,t)}},{key:"startProcessor",value:function(e){var t;null===(t=this.audioWorkletNodeMap.get(e))||void 0===t||t.port.postMessage({cmd:Zr.INIT_PROCESSOR,processorName:e}),this.activeProcessorList.push(e),this.updateProcessedStream()}},{key:"stopProcessor",value:function(e){var t;null===(t=this.audioWorkletNodeMap.get(e))||void 0===t||t.port.postMessage({cmd:Zr.UNINIT_PROCESSOR,processorName:e}),this.activeProcessorList=this.activeProcessorList.filter((function(t){return t!==e})),this.updateProcessedStream()}},{key:"resetProcessorManager",value:function(){var e,t=A(this.audioWorkletNodeMap.entries());try{for(t.s();!(e=t.n()).done;){var r=v(e.value,2),n=r[0],i=r[1];this.activeProcessorList.includes(n)&&this.stopProcessor(n),i&&(i.disconnect(),i.port.close())}}catch(e){t.e(e)}finally{t.f()}this.removeStream(),this.activeProcessorList=[]}}])}();ln._audioProcessorCtx=null,ln.stream=null,ln.processedStream=null,ln.audioWorkletNodeMap=new Map,ln.activeProcessorList=[];var hn,fn=r(4666),pn=D((function e(t){R(this,e);var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;if(!t)throw new Error("audioTrack is required");this.track=t,this.interval=r,this._callback=null,this._lastLabel=t.label,this._timer=null,this._stopped=!1,this.track.addEventListener("ended",this._handleTrackEnded.bind(this)),this.start()}),[{key:"onChange",value:function(e){this._callback=e}},{key:"start",value:function(){this._timer||this._stopped||this._tick()}},{key:"stop",value:function(){this._timer&&(clearTimeout(this._timer),this._timer=null)}},{key:"destroy",value:function(){this.stop(),this.track&&this.track.removeEventListener("ended",this._handleTrackEnded.bind(this)),this.track=null,this._callback=null,this._lastLabel="",this._stopped=!0}},{key:"_tick",value:function(){var e=this;if(!this._stopped&&this.track){var t=this.track.label;t!==this._lastLabel&&("function"==typeof this._callback&&this._callback(this._lastLabel,t),this._lastLabel=t),this._timer=setTimeout((function(){return e._tick()}),this.interval)}}},{key:"_handleTrackEnded",value:function(){this.destroy()}}]),vn=D((function e(t,r,n,i){var a=this;R(this,e),this.resolvefn=function(){},this.name=t,this.promise=new Promise((function(e,t){a.resolvefn=e})),this.isSafar=r,this.listenerfn=this._listener.bind(this),this.workerErrListener=this._workerError.bind(this),this.supportTransferRTC=!1,this.worker=null,this.useTransferRTC=!0,this.channels=[],this.wasmUrl=i,this.pathUrl=n,this.monitorFunc=function(){},this.onmessage=function(e){}}),[{key:"_workerError",value:function(e){var t;if(null!==(t=e.message)&&void 0!==t&&t.includes("RuntimeError:")){var r=e.target;this.monitorFunc("".concat(this.name,"WORKERERR")),m.Ay.error("worker error",e),r==this.worker&&this._reinit()}}},{key:"_listener",value:function(e){var t=e.data,r=e.data,n=r.status,i=r.data;switch(r.cmd,n){case te.Yx:this.supportTransferRTC=i;break;case te.wQ:(0,_.downloadWASMAndPostToWorker)(t.url,this.worker,this.name);break;case te.hz:this.monitorFunc("".concat(this.name,"READY")),this.resolvefn&&this.resolvefn(!0),this.resolvefn=null;var a=this.useTransferRTC;this.worker.postMessage({command:hr.eG,useTransferRTC:a,isSafar:this.isSafar}),(0,Y.Eg)(this.worker,this.name),(0,Q.CV)(this.worker,this.name);break;case te.Gg:this.resolvefn&&this.resolvefn(!1),this.resolvefn=null,this.monitorFunc("".concat(this.name,"FAILED"));break;case te.ef:case te.Bi:this.monitorFunc(i)}this.channels.forEach((function(t){t.mesagelistener(e)})),this.onmessage(e)}},{key:"_reinit",value:function(){var e=this;this.close(),this.promise=new Promise((function(t,r){e.resolvefn=t})),this.init()}},{key:"setMonitorLog",value:function(e){this.monitorFunc=e}},{key:"setPathAnsWasm",value:function(e,t){this.pathUrl=e,this.wasmUrl=t}},{key:"init",value:function(){var e=H(O().mark((function e(){var t;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.thread&&this.resolvefn){e.next=2;break}return e.abrupt("return",!1);case 2:return t={workerJsFileUrl:this.pathUrl,workerWasmFileUrl:this.wasmUrl},this.thread=(0,_.CreateThreadWorker)(this.name,t),e.next=6,this.thread.create();case 6:this.worker=e.sent,this.worker&&null!=this.resolvefn&&(this.worker.addEventListener("message",this.listenerfn),this.worker.addEventListener("error",this.workerErrListener));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setUseTransferRTC",value:function(e){this.useTransferRTC=e;var t=this.useTransferRTC,r=this.isSafar,n={command:hr.eG,useTransferRTC:t,isSafar:r};this.worker&&null==this.resolvefn&&this.worker.postMessage(n)}},{key:"isSupportTransferRTC",value:function(){return this.supportTransferRTC}},{key:"close",value:function(){(0,Y.L)(this.name),(0,Q.vJ)(this.name),this.resolvefn&&this.resolvefn(!1),this.resolvefn=null;var e=this.thread;this.thread=null;var t=this.worker;this.worker=null;var r=this.channels;this.channels=[],t&&(t.removeEventListener("message",this.listenerfn),t.removeEventListener("error",this.workerErrListener));try{r.forEach((function(e){e.close()}))}catch(e){console.error("close channel error",e)}null==e||e.destroy()}},{key:"getWorker",value:function(){return this.worker}},{key:"isUseTransferRTC",value:function(){return this.useTransferRTC&&this.supportTransferRTC}},{key:"ready",value:function(){var e=H(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=!!this.promise,!e.t0){e.next=5;break}return e.next=4,this.promise;case 4:e.t0=e.sent;case 5:return e.abrupt("return",e.t0);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addRTCChannel",value:function(e){-1==this.channels.indexOf(e)&&this.channels.push(e)}},{key:"removeRTCChannel",value:function(e){var t=this.channels.indexOf(e);-1!=t&&this.channels.splice(t,1)}}]),gn=D((function e(){R(this,e),this._handlers={}}),[{key:"on",value:function(e,t){this._handlers[e]||(this._handlers[e]=new Set),this._handlers[e].add(t)}},{key:"once",value:function(e,t){var r=this,n=function(){return r.off(e,n),t.apply(void 0,arguments)};this.on(e,n)}},{key:"off",value:function(e,t){var r;null===(r=this._handlers[e])||void 0===r||r.delete(t)}},{key:"emit",value:function(e){var t=this._handlers[e];if(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var a,o=A(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;try{s.apply(void 0,n)}catch(e){}}}catch(e){o.e(e)}finally{o.f()}}}}]),mn=new(function(e){function t(){var e;return R(this,t),(e=c(this,t,arguments))._consumedSsrcs=new Map,e._localVideoSsrc=-1,e._activeSpeakerSsrc=-1,e}return f(t,e),D(t,[{key:"getSsrcKind",value:function(e,t){if(e===z.$K)return"active-speaker";switch(t){case"vb":return"local";case"sharing":return"sharing";case"normal":return mn.isLocalVideoSsrc(e)?"local":"remote";default:(0,rt.Yu)("Invalid render mode")}}},{key:"getLogicalSSrc",value:function(e){return e===z.$K?z.$K:e>>10<<10}},{key:"consumeSsrc",value:function(e){if(!(e<0)){e=this.getLogicalSSrc(e);var t=this._consumedSsrcs.get(e);t?(t+=1,this._consumedSsrcs.set(e,t)):this._consumedSsrcs.set(e,1)}}},{key:"unconsumeSsrc",value:function(e){if(!(e<0)&&(e=this.getLogicalSSrc(e),this._consumedSsrcs.has(e))){var t=this._consumedSsrcs.get(e);if(t&&t>1)return t-=1,void this._consumedSsrcs.set(e,t);this._consumedSsrcs.delete(e)}}},{key:"ssrcEquals",value:function(e,t){return this.getLogicalSSrc(e)===this.getLogicalSSrc(t)}},{key:"_inConsumedSsrcs",value:function(e){return this._consumedSsrcs.has(this.getLogicalSSrc(e))}},{key:"isConsumedSsrc",value:function(e){return!(e<0)&&(!!this._inConsumedSsrcs(e)||!(!this.isActiveSeakerSsrc(e)||!this._inConsumedSsrcs(z.$K))||this.isLocalVideoSsrc(e))}},{key:"getActiveSpeakerSsrc",value:function(){return this._activeSpeakerSsrc}},{key:"setActiveSpeakerSsrc",value:function(e){e!==this._activeSpeakerSsrc&&this.emit("activeSpeakerSsrcChange",e),this._activeSpeakerSsrc=e}},{key:"isActiveSeakerSsrc",value:function(e){return!(e<0||this._activeSpeakerSsrc<0)&&(e===z.$K||this.ssrcEquals(e,this._activeSpeakerSsrc))}},{key:"getLocalVideoSsrc",value:function(){return this._localVideoSsrc}},{key:"setLocalVideoSsrc",value:function(e){this._localVideoSsrc=e}},{key:"isLocalVideoSsrc",value:function(e){return!(e<0||this._localVideoSsrc<0)&&(e===z.$K&&(e=this._activeSpeakerSsrc),this.ssrcEquals(e,this._localVideoSsrc))}},{key:"hasRemoteSsrc",value:function(){return 0!=this._consumedSsrcs.size&&(1!=this._consumedSsrcs.size||!(this._inConsumedSsrcs(0)||this._inConsumedSsrcs(this._localVideoSsrc)||this._inConsumedSsrcs(z.$K)&&this.isActiveSeakerSsrc(this._localVideoSsrc)))}}])}(gn)),yn=r(3021),_n=function(e){function t(){var e;return R(this,t),(e=c(this,t,arguments))._enabled=!0,e}return f(t,e),D(t,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}}])}(gn),Sn=function(e){function t(e){var r;return R(this,t),(r=c(this,t))._renderTarget=null,r._setCursorCanvas=e,r}return f(t,e),D(t,[{key:"renderTarget",get:function(){return this._renderTarget},set:function(e){this._renderTarget=e,e?this._setCursorCanvas(this._renderTarget.transferControlToOffscreen()):this._setCursorCanvas(null)}},{key:"updateCursorPosition",value:function(e){this.enabled&&this.emit("cursorMove",e)}}])}(_n),An=function(e){function t(){return R(this,t),c(this,t,arguments)}return f(t,e),D(t,[{key:"updateVideoRotation",value:function(e){this.enabled&&this.emit("videoRotationChange",e)}},{key:"updateVideoMirrorState",value:function(e){this.enabled&&this.emit("videoMirrorChange",e)}},{key:"updateVideoSize",value:function(e,t){this.enabled&&this.emit("videoSizeChange",e,t)}}])}(_n),bn=D((function e(t,r){var n=this;R(this,e),this._lastProcessor=null,this._streamMode=(0,be.B)().config.getAVStreamMode(),this._kind=t,this._source=r,this._lastProcessor=null,this._pipeResult=new Promise((function(e,t){n._resolvePipeResult=e,n._rejectPipeResult=t}))}),[{key:"close",value:function(){this._source.remotePeerProxy.close()}},{key:"_createTrackGenerator",value:function(){return"video"===this._kind?new MediaStreamTrackGenerator({kind:"video"}):"audio"===this._kind?new MediaStreamTrackGenerator({kind:"audio"}):void(0,rt.Yu)()}},{key:"_linkTo",value:function(e){var t=this;if("writable-stream"===this._streamMode){var r=this._lastProcessor?this._lastProcessor:this._source,n=this._createTrackGenerator(),i=new MediaStreamTrackProcessor({track:n}).readable,a=n.writable;r.remotePeerProxy.provideOutputStream(r.transfer(a)).then((function(e){t._rejectPipeResult(e)})),e.remotePeerProxy.provideInputStream(e.transfer(i)).then((function(e){t._rejectPipeResult(e)}))}else(this._lastProcessor?this._lastProcessor:this._source).remotePeerProxy.accquireOutputTrack().then((function(t){e.remotePeerProxy.provideInputTrack(e.transfer(t))})).catch((function(e){t._rejectPipeResult(e)}))}},{key:"pipeThough",value:function(e){return this._linkTo(e),this._lastProcessor=e,this}},{key:"pipeTo",value:function(e){return this._linkTo(e),this._pipeResult}},{key:"pipeToMediaStream",value:function(e){var t=this,r=this._lastProcessor?this._lastProcessor:this._source;if("writable-stream"===this._streamMode){var n=this._createTrackGenerator();e.addTrack(n);var i=new MediaStreamTrackEvent("addtrackEx",{track:n});e.dispatchEvent(i),n.addEventListener("ended",(function(){e.removeTrack(n),t._resolvePipeResult()})),r.remotePeerProxy.provideOutputStream(r.transfer(n.writable)).catch((function(e){t._rejectPipeResult(e)}))}else r.remotePeerProxy.accquireOutputTrack().then((function(r){e.addTrack(r);var n=new MediaStreamTrackEvent("addtrackEx",{track:r});e.dispatchEvent(n),r.addEventListener("ended",(function(){e.removeTrack(r),t._resolvePipeResult()}))})).catch((function(e){t._rejectPipeResult(e)}));return this._pipeResult}}]),En=function(e,t,r,n){return new(r||(r=Promise))((function(t,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,o)}s((n=n.apply(e,[])).next())}))},kn=function(){function e(t){var r;return R(this,e),(r=c(this,e,[t])).name="SsrcStreamError",r}return f(e,o(Error)),D(e)}(),Cn=new Set,wn=function(e){function t(e,r,n,i){var a,o,s;return R(this,t),(a=c(this,t)).mediaStream=new MediaStream,a.metaTrack=new An,a._cursorTrack=null,a._status="idle",a._playPromise=null,a.ssrc=e,a.ssrcKind=r,a._desiredSize=n,a._readyPromise=new Promise((function(e,t){o=e,s=t})),a._impl=new In({stream:d(a),setCursorTrack:function(e){(0,rt.vA)(null===a._cursorTrack),a._cursorTrack=e,a.emit("addCursorTrack",e)},onStreamStart:function(){a.status="streaming",o()},onStreamError:function(e){a.status="error",s()}}),Cn.add(a._impl),i&&i.autoPlay&&a.play(),a}return f(t,e),D(t,[{key:"desiredSize",get:function(){return this._desiredSize}},{key:"status",get:function(){return this._status},set:function(e){var t=this._status;this._status=e,this.emit("statusChange",t,this._status)}},{key:"ready",get:function(){return this._readyPromise}},{key:"cursorTrack",get:function(){return this._cursorTrack}},{key:"play",value:function(){switch(this._status){case"idle":return this.status="preparing",this._playPromise=this._impl.play(),this._readyPromise;case"preparing":case"streaming":return this._readyPromise;case"stopped":throw new kn("Stopped stream can not restart!");default:throw new kn("Errored stream can not restart!")}}},{key:"_rejectStopped",value:function(){var e=Promise.reject("Stream has been stopped!");return e.catch((function(){})),e}},{key:"stop",value:function(){var e=this;switch(this.metaTrack.enabled=!1,this.cursorTrack&&(this.cursorTrack.enabled=!1),this._status){case"idle":Promise.resolve().then((function(){e.status="stopped",e._readyPromise=e._rejectStopped()}));break;case"preparing":case"streaming":Cn.delete(this._impl),this._playPromise.finally((function(){e._impl.stop().then((function(){e.status="stopped",e._readyPromise=e._rejectStopped()})).catch((function(t){e.status="error"}))}))}}},{key:"updateDesiredSize",value:function(e){this._desiredSize=e,this._impl.updateDesiredSize(e)}}])}(gn),Tn=new(D((function e(){R(this,e)}),[{key:"changeVideoWatermarkInfo",value:function(e){var t,r=A(Cn);try{for(r.s();!(t=r.n()).done;){var n=t.value;"sharing"!==n.stream.ssrcKind&&n.updateWatermarkInfo(e)}}catch(e){r.e(e)}finally{r.f()}}},{key:"changeSharingWatermarkInfo",value:function(e){var t,r=A(Cn);try{for(r.s();!(t=r.n()).done;){var n=t.value;"sharing"===n.stream.ssrcKind&&n.updateWatermarkInfo(e)}}catch(e){r.e(e)}finally{r.f()}}}])),Rn=D((function e(t){R(this,e),this._context=t}),[{key:"stream",get:function(){return this._context.stream}}]),In=function(e){function t(){var e;return R(this,t),(e=c(this,t,arguments))._localPipe=null,e._remotePipe=null,e._sharingPipe=null,e._cursorTrack=null,e._handleActiveSpeakerSsrcChange=null,e._started=!1,e._stopped=!1,e}return f(t,e),D(t,[{key:"_selectService",value:function(e,t){if(0!==e.length){var r=e.filter((function(e){return e.constraints.includes(t)})).map((function(e){return e.serviceId}));return r.length>0?((0,rt.vA)(1===r.length),r[0]):(r=e.filter((function(e){return e.constraints.includes("default")})).map((function(e){return e.serviceId})),(0,rt.vA)(1===r.length),r[0])}(0,rt.Yu)("No ssrc stream service")}},{key:"_shouldAddWatermark",value:function(){var e=(0,be.B)().config;return"sharing"===this._context.stream.ssrcKind?e.isSharingHasWaterMark():e.isVideoHasWaterMark()}},{key:"_createStreamServicePipe",value:function(e,t,r){return En(this,0,void 0,O().mark((function n(){var i,a,o,s,u,c,d,l=this;return O().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=this._context.stream,n.next=3,yn.D.acquireService("builtin/WasmSsrcStreamService",{serviceParams:{ssrc:e,ssrcKind:t,desiredSize:i.desiredSize},selectService:function(e){return l._selectService(e,t)}});case 3:if(a=n.sent,o=new bn("video",a),s=null,!this._shouldAddWatermark()){n.next=12;break}return u=(0,be.B)().config,c="sharing"!==i.ssrcKind?u.getVideoWatermarkInfo():u.getSharingWatermarkInfo(),n.next=10,yn.D.acquireService("graphics/VideoRasterService",{serviceParams:{displaySize:i.desiredSize,options:{waterMarkInfo:c}}});case 10:s=n.sent,o.pipeThough(s);case 12:return d={streamingConnection:a,rasterConnection:s,avStreamPipe:o},n.abrupt("return",(a.on("cursorMove",(function(e){null===l._cursorTrack&&(l._cursorTrack=new Sn((function(e){var t=e?a.transfer(e):null;a.remotePeerProxy.setCursorCanvas(t)})),l._context.setCursorTrack(l._cursorTrack)),l._cursorTrack.updateCursorPosition(e)})),a.on("videoRotationChange",(function(e){d.lastRotationState=e,s?s.remotePeerProxy.updateVideoRotation(e):r.choosed&&i.metaTrack.updateVideoRotation(e)})),a.on("videoMirrorChange",(function(e){d.lastMirrorState=e,s?s.remotePeerProxy.updateVideoMirrorState(e):r.choosed&&i.metaTrack.updateVideoMirrorState(e)})),s?s.on("displaySizeChange",(function(e,t){d.lastVideoSize={width:e,height:t},r.choosed&&i.metaTrack.updateVideoSize(e,t)})):a.on("videoSizeChange",(function(e,t){d.lastVideoSize={width:e,height:t},r.choosed&&i.metaTrack.updateVideoSize(e,t)})),a.on("streamStart",(function(){l._started||(l._context.onStreamStart(),l._started=!0)})),d));case 14:case"end":return n.stop()}}),n,this)})))}},{key:"_getPipeTrack",value:function(e){var t,r,n=new Promise((function(e,n){t=e,r=n})),i=new MediaStream;return i.addEventListener("addtrackEx",(function(e){t(e.track)})),e.pipeToMediaStream(i).catch((function(e){r(e)})),n}},{key:"play",value:function(){return En(this,0,void 0,O().mark((function e(){var t,r,n,i,a,o,s,u,c,d,l,h,f,p,g,m,y,_;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,rt.vA)(!this._stopped,"Can not play stopped ssrc stream!"),(t=this._context.stream).ssrc===z.$K){e.next=18;break}return e.next=5,this._createStreamServicePipe(t.ssrc,t.ssrcKind,{choosed:!0});case 5:r=e.sent,e.t0=(r.avStreamPipe.pipeToMediaStream(this._context.stream.mediaStream).catch((function(){})),t.ssrcKind),e.next="local"===e.t0?9:"remote"===e.t0?11:"sharing"===e.t0?13:15;break;case 9:return this._localPipe=r,e.abrupt("break",16);case 11:return this._remotePipe=r,e.abrupt("break",16);case 13:return this._sharingPipe=r,e.abrupt("break",16);case 15:(0,rt.Yu)();case 16:e.next=39;break;case 18:return n={choosed:!1},i=this._createStreamServicePipe(z.$K,"local",n),a={choosed:!1},o=this._createStreamServicePipe(z.$K,"remote",a),e.next=24,Promise.all([i,o]);case 24:return s=e.sent,u=v(s,2),c=u[0],d=u[1],l=this._getPipeTrack(c.avStreamPipe),h=this._getPipeTrack(d.avStreamPipe),e.next=32,Promise.all([l,h]);case 32:f=e.sent,p=v(f,2),g=p[0],m=p[1],this._localPipe=c,this._remotePipe=d,(_=function(e){var r;mn.isLocalVideoSsrc(e)?"local"!==y&&(t.mediaStream.removeTrack(m),t.mediaStream.addTrack(g),y="local",a.choosed=!1,n.choosed=!0,r=c):"remote"!==y&&(t.mediaStream.removeTrack(g),t.mediaStream.addTrack(m),y="remote",n.choosed=!1,a.choosed=!0,r=d),r&&(void 0!==r.lastMirrorState&&t.metaTrack.updateVideoMirrorState(r.lastMirrorState),void 0!==r.lastRotationState&&t.metaTrack.updateVideoRotation(r.lastRotationState),void 0!==r.lastVideoSize&&t.metaTrack.updateVideoSize(r.lastVideoSize.width,r.lastVideoSize.height))})(mn.getActiveSpeakerSsrc()),this._handleActiveSpeakerSsrcChange=_,mn.on("activeSpeakerSsrcChange",this._handleActiveSpeakerSsrcChange);case 39:case"end":return e.stop()}}),e,this)})))}},{key:"_destroyStreamServicePipe",value:function(e){e.avStreamPipe.close(),e.streamingConnection.close(),e.rasterConnection&&e.rasterConnection.close()}},{key:"stop",value:function(){return En(this,0,void 0,O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._stopped=!0,this._localPipe&&(this._destroyStreamServicePipe(this._localPipe),this._localPipe=null),this._remotePipe&&(this._destroyStreamServicePipe(this._remotePipe),this._remotePipe=null),this._sharingPipe&&(this._destroyStreamServicePipe(this._sharingPipe),this._sharingPipe=null),this._cursorTrack=null,this._handleActiveSpeakerSsrcChange&&(mn.off("activeSpeakerSsrcChange",this._handleActiveSpeakerSsrcChange),this._handleActiveSpeakerSsrcChange=null);case 1:case"end":return e.stop()}}),e,this)})))}},{key:"_updatePipeDesiredSize",value:function(e,t){e.streamingConnection.remotePeerProxy.updateDesiredSize(t),e.rasterConnection&&e.rasterConnection.remotePeerProxy.updateDisplaySize(t)}},{key:"updateDesiredSize",value:function(e){this._localPipe&&this._updatePipeDesiredSize(this._localPipe,e),this._remotePipe&&this._updatePipeDesiredSize(this._remotePipe,e),this._sharingPipe&&this._updatePipeDesiredSize(this._sharingPipe,e)}},{key:"updateWatermarkInfo",value:function(e){this._localPipe&&this._localPipe.rasterConnection&&this._localPipe.rasterConnection.remotePeerProxy.updateWatermarkInfo(e),this._remotePipe&&this._remotePipe.rasterConnection&&this._remotePipe.rasterConnection.remotePeerProxy.updateWatermarkInfo(e),this._sharingPipe&&this._sharingPipe.rasterConnection&&this._sharingPipe.rasterConnection.remotePeerProxy.updateWatermarkInfo(e)}}])}(Rn),Dn=r(9470),Mn=r(9102),On=["video","VideoSelectValue"],xn=["cmdType"];function Pn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ln(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Pn(Object(r),!0).forEach((function(t){(0,i.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Nn=null===(hn=document.currentScript)||void 0===hn?void 0:hn.src,Vn=new(D((function e(){R(this,e),this._isReuseStreamEnabled=!1,this._isStreamInReuseMap=new Map,this.presetedConstraints={audioConstraints:null,videoConstraints:null,audioTimer:null,videoTimer:null},this._deprecatedStream={audio:[],video:[]},this._captureVideoDeferred=null,this._iOSAudioDeviceLabelMonitor=null,this.audioConstraints=null,this._audioStream=null,this.isCaptureAudioInProgress=!1,this.audioCaptureElapsedTime=0,this.videoConstraints=null,this.videoStream=null,this.videoStreamTrack=null,this.captureVideoTimer=null,this.checkVideoStreamActiveTimer=null,this.isCaptureVideoInProgress=!1,this.isCapturingAudioFromDefault=!1,this.cachedUpgradeVideoConstraints={width:0,height:0,frameRate:0,aspectRatio:void 0},this._streamProcessAbility=void 0,this.mediaStreamTrackProcessor=null,this.reableStream=null,this.isAppleGraphic=!1,this.isSupportFullHD=!1,this.facingMode=z.HE,this.VBMFlag=!1,this.webrtcAudio=null,this.webrtcFlag=!1,this.vbStream=null,this.vb=null,this.isVBEnabled=!1,this.updateVideoStream=null,this.isCaptureAudioFromFile=!1,this.blockUpgradeCapture={},this.videoCaptureSuccessHandler=null,this.videoCaptureFailedHandler=null,this.receivedVideoConstraints=null,this.onVBResolutionChange=null}),[{key:"audioStream",get:function(){return this._audioStream},set:function(e){ln.setStream(e),this._audioStream=e}},{key:"streamProcessAbility",get:function(){return void 0===this._streamProcessAbility&&(this._streamProcessAbility={isSupportMediaStreamTrackProcessor:h.Ay.isSupportMediaStreamTrackProcessor()}),this._streamProcessAbility}},{key:"enableReuseStream",value:function(e){this._isReuseStreamEnabled=!!e}},{key:"_updateStreamInReuse",value:function(e,t){t?this._isStreamInReuseMap.set(e,!0):this._isStreamInReuseMap.delete(e)}},{key:"_isStreamInReuse",value:function(e){return!!this._isStreamInReuseMap.get(e)}},{key:"presetConstraints",value:function(e){var t=e.audioConstraints,r=e.videoConstraints;t&&(this.presetedConstraints.audioConstraints=this._getAudioConstraints(t)),r&&(this.presetedConstraints.videoConstraints=this._getVideoConstraints(r))}},{key:"_clearPresetConstraints",value:function(){this.presetedConstraints.audioConstraints=null,this.presetedConstraints.videoConstraints=null}},{key:"_getPresetAudioConstraints",value:function(){var e=this.presetedConstraints.audioConstraints;return this._clearPresetConstraints(),!(!e||this.audioStream||this.isCaptureAudioInProgress)&&e}},{key:"_getPresetVideoConstraints",value:function(){var e=this.presetedConstraints.videoConstraints;return this._clearPresetConstraints(),!(!e||this.videoStream||this.isCaptureVideoInProgress)&&e}},{key:"_pushDeprecatedStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.audioStream,r=e.videoStream;t&&this._deprecatedStream.audio.push(t),r&&this._deprecatedStream.video.push(r)}},{key:"_destoryDeprecatedStream",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.audio,n=t.video;r&&(this._deprecatedStream.audio.forEach((function(t){try{e._destoryStream(t)}catch(e){m.Ay.error("Error when destroying deprecated audio stream",e)}})),this._deprecatedStream.audio=[]),n&&(this._deprecatedStream.video.forEach((function(t){try{e._destoryStream(t)}catch(e){m.Ay.error("Error when destroying deprecated video stream",e)}})),this._deprecatedStream.video=[])}},{key:"setStreamProcessAbility",value:function(e){var t=e.isSupportMediaStreamTrackProcessor;this._streamProcessAbility=Ln(Ln({},this._streamProcessAbility),void 0!==t?{isSupportMediaStreamTrackProcessor:t}:{})}},{key:"_isFileInputAudioSource",value:function(e){return e&&(e.audio instanceof HTMLVideoElement||e.audio instanceof HTMLAudioElement)}},{key:"_getAudioConstraints",value:function(e){var t=e.audioSource,r=e.isSupportBrowserAec,n=e.disableAudioAGC,i=e.disableNoiseSuppression,a=e.enableOriginalSound,o=e.enableStereo;return t instanceof HTMLVideoElement||t instanceof HTMLAudioElement?{audio:t}:(h.Ay.getOSInfo(),r?{deviceId:t?{exact:t}:h.Ay.isSupportDefaultDeviceId()?{exact:"default"}:void 0,autoGainControl:!n&&!a,noiseSuppression:!i&&!a,latency:0,echoCancellation:!o,channelCount:2,sampleRate:48e3}:{deviceId:t?{exact:t}:h.Ay.isSupportDefaultDeviceId()?{exact:"default"}:void 0,autoGainControl:!n&&!a,noiseSuppression:!i&&!a,latency:0,echoCancellation:r&&!o,channelCount:2,sampleRate:48e3})}},{key:"_isSameAudioConstraintsAsPrev",value:function(e){return!(this._isFileInputAudioSource(e)||!this.audioConstraints||!(0,h.bD)(this.audioConstraints,e)||!this.audioStream||!this._isStreamHasAudio(this.audioStream))}},{key:"_destoryStream",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.audioOnly,n=t.videoOnly;e&&!h.Ay.audioToMediaStreamMananger.isAudioFileStream(e)&&(r?e.getAudioTracks():n?e.getVideoTracks():e.getTracks()).forEach((function(e){e.stop()}))}},{key:"_isStreamHasAudio",value:function(e){var t=e.getAudioTracks();return t&&t.length>0}},{key:"_isStreamHasVideo",value:function(e){var t=e.getVideoTracks();return t&&t.length>0}},{key:"destoryAudioMediaStream",value:function(){this.audioStream?(this._isFileInputAudioSource(this.audioConstraints)&&h.Ay.audioToMediaStreamMananger.stopCapture(),this._isReuseStreamEnabled?this._updateStreamInReuse(this.audioStream,!0):(this._updateStreamInReuse(this.audioStream,!1),this._destoryStream(this.audioStream),this._destroyIOSAudioDeviceMonitor(),this.audioStream=null,this.audioConstraints=null,this.audioCaptureElapsedTime=0,this._destoryDeprecatedStream({audio:!0}))):this._destoryDeprecatedStream({audio:!0}),this.enableReuseStream(!1)}},{key:"shouldCaptureAudio",value:function(){return!this.audioStream||this._isStreamInReuse(this.audioStream)}},{key:"muteUnmuteAudioMediaStream",value:function(e){this.audioStream&&(this.audioStream.getAudioTracks()||[]).forEach((function(t){t.enabled=!e}))}},{key:"_storeAudioStream",value:function(e,t,r){e&&(Un("audio stream is ok"),this.destoryAudioMediaStream(),this.audioStream=e,this.audioConstraints=t,r&&this._setPresetAudioStreamAutoStopTimer())}},{key:"_setPresetAudioStreamAutoStopTimer",value:function(){var e=this;this._clearPresetAudioStreamAutoStopTimer(),this.presetedConstraints.audioTimer=setTimeout((function(){e.destoryAudioMediaStream()}),1e4)}},{key:"_clearPresetAudioStreamAutoStopTimer",value:function(){this.presetedConstraints.audioTimer&&(clearTimeout(this.presetedConstraints.audioTimer),this.presetedConstraints.audioTimer=null)}},{key:"addAudioTrackSettingsMonitor",value:function(e,t){var r=null==e?void 0:e.getSettings();K.A.add_monitor(t+":"+(null==r?void 0:r.channelCount)+":"+(null==r?void 0:r.echoCancellation)+":"+(null==r?void 0:r.autoGainControl)+":"+(null==r?void 0:r.noiseSuppression))}},{key:"_addIOSAudioDeviceMonitor",value:function(e){h.Ay.isIphoneOrIpadSafari()&&(this._destroyIOSAudioDeviceMonitor(),this._iOSAudioDeviceLabelMonitor=new pn(e),this._iOSAudioDeviceLabelMonitor.onChange(dn))}},{key:"_destroyIOSAudioDeviceMonitor",value:function(){this._iOSAudioDeviceLabelMonitor&&(this._iOSAudioDeviceLabelMonitor.destroy(),this._iOSAudioDeviceLabelMonitor=null)}},{key:"_handleAudioCaptureSuccess",value:function(e,t,r,n){var i=this;this._clearPresetAudioStreamAutoStopTimer(),n||this._storeAudioStream(e,t),this._updateStreamInReuse(e,!1);var a=e.getAudioTracks()[0];a?(K.A.add_monitor("ATRS:"+a.readyState+":"+a.id),K.A.add_monitor("ATMS:"+a.muted+":"+a.id),this.addAudioTrackSettingsMonitor(a,"NormalAudioCapture"),a.onended=H(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ze.A.hasPermission("microphone");case 2:if(e.sent){e.next=4;break}return e.abrupt("return",(K.A.add_monitor("ATRS:"+a.readyState+":"+a.id+":-R"),void(0,S.iK)(p.UyE,S.pg.PERMISSION_RESET)));case 4:return e.next=6,sn.isSelectedDeviceExistAsync();case 6:if(!e.sent){e.next=10;break}(0,S.iK)(p.UyE,S.pg.EXCEPTION),K.A.add_monitor("ATRS:"+a.readyState+":"+a.id+":-L"),e.next=11;break;case 10:K.A.add_monitor("ATRS:"+a.readyState+":"+a.id+":-I");case 11:case"end":return e.stop()}}),e)}))),a.muted?(g.A.Notify_APPUI_SAFE(p.qRr,z.ON),this.webrtcAudio&&(this.webrtcAudio.isMutedBySystem=!0)):(g.A.Notify_APPUI_SAFE(p.FjO),this.webrtcAudio&&(this.webrtcAudio.isMutedBySystem=!1)),a.onmute=function(){K.A.add_monitor("ATMS:"+a.muted+":"+a.id);var e=i.audioStream.getAudioTracks()[0];e&&e.id===a.id&&(i.webrtcAudio&&(i.webrtcAudio.isMutedBySystem=!0),g.A.Notify_APPUI_SAFE(p.qRr,z.Mm))},a.onunmute=function(){K.A.add_monitor("ATMS:"+a.muted+":"+a.id);var e=i.audioStream.getAudioTracks()[0];e&&e.id===a.id&&(i.webrtcAudio&&(i.webrtcAudio.muted||i.webrtcAudio.unmute(),i.webrtcAudio.isMutedBySystem=!1),g.A.Notify_APPUI_SAFE(p.FjO))},this._addIOSAudioDeviceMonitor(a)):K.A.add_monitor("TN"),r(e)}},{key:"_genAudioStream",value:function(e){try{var t=e.getAudioTracks();return 0===t.length?null:new MediaStream(t)}catch(t){return m.Ay.warn("_genAudioStream",t),this._destoryStream(e,{videoOnly:!0}),e}}},{key:"_genVideoStream",value:function(e){try{var t=e.getVideoTracks();return 0===t.length?null:new MediaStream(t)}catch(t){return m.Ay.warn("_genVideoStream",t),this._destoryStream(e,{audioOnly:!0}),e}}},{key:"_splitAudioStream",value:function(e,t,r,n){var i=t.audio,a=t.video;if(a&&this._isStreamHasVideo(e)){var o=this._genAudioStream(e),s=this._genVideoStream(e);return o?this._handleAudioCaptureSuccess(o,i,r):n(new Error("audio stream do not contains audio track ")),void(s&&(this.videoStream?this._pushDeprecatedStream({videoStream:s}):(this._updateStreamInReuse(s,!0),this._storeVideoStream(s,a,!0))))}this._handleAudioCaptureSuccess(e,i,r)}},{key:"_captureFileInputAudioStream",value:function(){var e=H(O().mark((function e(t){var r,n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.audio,e.prev=1,e.next=4,new Promise((function(e,t){r.currentTime>0&&!r.paused&&!r.ended&&e(!0);var n=function(){e(!0),r.removeEventListener("timeupdate",n)};r.addEventListener("timeupdate",n),setTimeout((function(){return t(!1)}),1e4)}));case 4:if(e.sent){e.next=6;break}throw new Error("audio file playing failed");case 6:return e.abrupt("return",h.Ay.audioToMediaStreamMananger.startCapture(r));case 9:throw e.prev=9,e.t0=e.catch(1),console.error(e.t0),(n=new Error("capture stream from file input souce failed")).name="FileInputSouceError",n;case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"startCaptureAudio",value:function(){var e=H(O().mark((function e(t){var r,n,i,a,o,s,u,c,d,l,f,p=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.audioConstraints,a=t.successHandler,o=t.errorHandler,this.enableReuseStream(!1),s=!!i&&this._getAudioConstraints(i),u=this._isFileInputAudioSource(s),this.isCaptureAudioFromFile=u,c=this._isSameAudioConstraintsAsPrev(s),d=this._getPresetVideoConstraints(),this._clearPresetAudioStreamAutoStopTimer(),!c){e.next=7;break}return e.abrupt("return",(this.audioCaptureElapsedTime=-2,void this._handleAudioCaptureSuccess(this.audioStream,s,a,!0)));case 7:if(l={audio:s,video:u?null:d},this.isCaptureAudioInProgress=!0,f=Date.now(),e.t0=h.Ay.isIphoneOrIpadSafari(),!e.t0){e.next=17;break}if(e.t1=this._captureVideoDeferred,!e.t1){e.next=16;break}return e.next=16,this._captureVideoDeferred.promise;case 16:this._captureVideoDeferred=new h.cY;case 17:this.destoryAudioMediaStream(),K.A.add_monitor("RGUMA"),document.removeEventListener("visibilitychange",Fn),this.isCapturingAudioFromDefault="default"===(null==l||null===(r=l.audio)||void 0===r?void 0:r.deviceId)||!(null!=l&&null!==(n=l.audio)&&void 0!==n&&n.deviceId),(u?this._captureFileInputAudioStream(s):sn.captureAudioStreamWithRetry(l,this.isCapturingAudioFromDefault,i.retry)).then((function(e){if(g.A.ComputerAudioStatus===N.BX.ComputerAudio_Null)return m.Ay.log("getUserMedia successfully but UI has called leave audio"),void e.getAudioTracks().forEach((function(e){e.stop()}));p.audioCaptureElapsedTime=Date.now()-f,p._splitAudioStream(e,l,a,o)})).catch((function(e){g.A.ComputerAudioStatus!==N.BX.ComputerAudio_Null?(u||Ze.A.updateSelectedMicDevices(s.deviceId&&s.deviceId.exact||"default","getUsermedia failed",Date.now()-f,!1),o(e)):m.Ay.log("getUserMedia failed but UI has called leave audio")})).finally((function(){var e;p.isCaptureAudioInProgress=!1,p._captureVideoDeferred&&p._captureVideoDeferred.resolve(),null===(e=p.webrtcAudio)||void 0===e||e.playAllRemoteAudioPlayer(z.vr.CAPTURE_AUDIO)}));case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isFileInputVideoSource",value:function(e){return e&&e.video instanceof HTMLVideoElement}},{key:"isUsingFileInputVideoSource",value:function(){return this._isFileInputVideoSource(this.videoConstraints)}},{key:"_getFileInputSourceSize",value:function(e,t){var r=[90,180,360,720];return t||(t=360),t>720&&(t=720),t<90&&(t=90),-1===r.indexOf(t)&&r.some((function(e,n){return e>t&&(t=(e+r[n-1])/2<t?e:r[n-1],!0)})),{width:16/9*t,height:t}}},{key:"_getVideoConstraints",value:function(e){var t=e.videoSource,r=e.usingFacingMode,n=e.width,i=e.height,a=e.pan,o=e.tilt,s=e.zoom,u=e.fps;if(t instanceof HTMLVideoElement)return Ln({video:t},n&&i?this._getFileInputSourceSize(n,i):{});var c={},d=this.cachedUpgradeVideoConstraints,l=d.width,f=d.height,p=d.frameRate,v=d.aspectRatio,g=l>0&&f>0&&p>0,m=z.Fw;u>=z.UW&&u<=z.O8&&(m=u);var y={max:z.Fw,ideal:g?p:m},_=g?l:n||640,S=g?f:i||(r?480:360);(_>=1920&&!h.Ay.get1080pcapacity()||this.webrtcFlag&&_>=1280)&&(_=1280,S=720);var A={max:_,ideal:_},b={max:S,ideal:S},E=g?v:void 0;return r?["user","environment","left","right"].includes(t)?c={width:A,height:b,frameRate:y,aspectRatio:E,facingMode:{exact:t}}:t&&(c={width:A,height:b,frameRate:y,aspectRatio:E,deviceId:{exact:t}}):c={width:A,height:b,deviceId:t?{exact:t}:void 0,frameRate:y,aspectRatio:E,pan:a,tilt:o,zoom:s},c}},{key:"_getVideoIdealWidthHeight",value:function(e){var t=e.videoSource,r=e.usingFacingMode,n=e.width;if(e.height,t instanceof HTMLVideoElement)return!0;if(r)return!0;var i,a=this.cachedUpgradeVideoConstraints,o=a.width,s=a.height,u=0!=o&&0!=s?o:n||640,c=[[1280,720],[640,360],[320,180]].find((function(e){return 320==e[0]||e[0]<u}));return u=c[0],i=c[1],{width:{ideal:u},height:{ideal:i}}}},{key:"_updateVideoConstraints",value:function(e){var t=this;return this.videoStreamTrack?this.videoStreamTrack.applyConstraints(e).catch((function(r){var n=t.videoStreamTrack.readyState;if(m.Ay.error("Applying video constraints failed "+n+JSON.stringify(e),r),"ended"===n){var i=t.cachedUpgradeVideoConstraints,a=i.width,o=i.height,s=t.videoStreamTrack.getSettings().deviceId;t.blockUpgradeCapture[s]=!0,t.destoryVideoMediaStream();var u=Ln({},t.receivedVideoConstraints);a&&(u.width=a),o&&(u.height=o),t.startCaptureVideo({videoConstraints:u,timeout:null}).catch((function(e){m.Ay.error("Recapture video failed: ",e),K.A.add_monitor("RECPF")}))}return Promise.reject(r)})):Promise.reject(new Error("video stream not exist! update video constraints failed"))}},{key:"changeVideoResolution",value:function(e,t,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.isUsingFileInputVideoSource())return Promise.reject(new Error("Reject upgrade caputre, reason: using file input video source"));if(this.videoStreamTrack){if(e>=1920&&!this.isSupportFullHD&&(e=1280,t=720),this.videoStreamTrack.getSettings){var a=this.videoStreamTrack.getSettings();if(Math.abs(a.width-e)<50)return Promise.reject(new Error("Reject upgrade caputre, reason: width change less than 50"));if((e>a.width||t>a.height||r>a.frameRate)&&this.blockUpgradeCapture[a.deviceId])return Promise.reject(new Error("Reject upgrade caputre, reason: block upgrade capture"))}K.A.add_monitor("CCWidth"+e);var o={max:z.Fw,ideal:r},s={width:{max:e,ideal:e},height:{max:t,ideal:t},frameRate:o,aspectRatio:i?{ideal:16/9}:void 0};return K.A.add_monitor("UVCP:".concat((0,h.iD)(JSON.stringify(s)))),this._updateVideoConstraints(s).then((function(){if(n.cachedUpgradeVideoConstraints={width:e,height:t,frameRate:s.frameRate.ideal,aspectRatio:s.aspectRatio},n.webrtcFlag&&n.isVideoStreamProcessed()){var r=n.videoStream.getVideoTracks()[0];if(r){var i=r.getSettings(),a=i.width,o=i.height;return new Promise((function(e,t){var r=setTimeout((function(){n.onVBResolutionChange=null,t(new Error("wmsc vb module upgrade resolution failed in 150ms"))}),150);n.onVBResolutionChange=function(t){t.width===a&&t.height===o&&(clearTimeout(r),n.onVBResolutionChange=null,e())}}))}return Promise.reject(new Error("upgrade video success but not video track"))}}))}return Promise.reject(new Error("video stream not exist! change video resolution failed"))}},{key:"_isSameVideoConstraintsAsPrev",value:function(e){return!(this._isFileInputVideoSource(e)||!this.videoConstraints||!(0,h.bD)(this.videoConstraints,e)||!this.videoStream||!this._isStreamHasVideo(this.videoStream))}},{key:"_clearCaptureVideoTimer",value:function(){this.captureVideoTimer&&(clearTimeout(this.captureVideoTimer),this.captureVideoTimer=null)}},{key:"destoryVideoMediaStream",value:function(){this.videoStream?(this._isFileInputVideoSource(this.videoConstraints)&&h.Ay.videoToMediaStreamManager.stopCapture(),this.vbStream&&this.stopVBStream(),this.processedStream=null,this._isReuseStreamEnabled?this._updateStreamInReuse(this.videoStream,!0):(this._updateStreamInReuse(this.videoStream,!1),this._destoryStream(this.videoStream),this.videoStream=null,this.videoStreamTrack=null,this.videoConstraints=null,this._destoryDeprecatedStream({video:!0}))):this._destoryDeprecatedStream({video:!0}),this._isReuseStreamEnabled||this._clearCaptureVideoTimer(),this.enableReuseStream(!1),this.destoryVideoProcessor(),this._clearCheckVideoStreamActiveTimer()}},{key:"shouldCaptureVideo",value:function(){return!this.videoStream||this._isStreamInReuse(this.videoStream)}},{key:"_clearCheckVideoStreamActiveTimer",value:function(){this.checkVideoStreamActiveTimer&&(clearTimeout(this.checkVideoStreamActiveTimer),this.checkVideoStreamActiveTimer=null)}},{key:"checkVideoStreamActive",value:function(){var e=this;return new Promise((function(t,r){e._clearCheckVideoStreamActiveTimer(),e.checkVideoStreamActiveTimer=setTimeout((function(){e.videoStream?!1===e.videoStream.active?r(new S.iG("VideoMediaStram.active equals false")):t(!0):r(!1)}),1e3)}))}},{key:"destoryVideoProcessor",value:function(){if(this.mediaStreamTrackProcessor){if(this.mediaStreamTrackProcessor=null,_.Notify_Video_Encode_Thread({command:"releaseStream"}),this.reableStream&&this.reableStream.close)try{this.reableStream.close()}catch(e){m.Ay.error("Error when destroying mediaStreamTrackProcessor",e)}this.reableStream=null}}},{key:"_createVideoProcessor",value:function(){this.videoStreamTrack?this.streamProcessAbility.isSupportMediaStreamTrackProcessor&&(this.mediaStreamTrackProcessor=new MediaStreamTrackProcessor(this.videoStreamTrack),this.reableStream=this.mediaStreamTrackProcessor.readable,_.Notify_Video_Encode_Thread({command:"releaseStream"}),_.Notify_Video_Encode_Thread_Transferable_Data("frameStream",this.reableStream),K.A.add_monitor("VCTP")):m.Ay.error("Video stream track does not exist - cannot create video processor")}},{key:"_storeVideoStream",value:function(e,t,r){e&&(Un("video stream is ok"),this.destoryVideoMediaStream(),this.videoStream=e,this.videoStreamTrack=this.videoStream.getVideoTracks()[0],this.videoConstraints=t,r&&this._setPresetVideoStreamAutoStopTimer())}},{key:"_setPresetVideoStreamAutoStopTimer",value:function(){var e=this;this._clearPresetVideoStreamAutoStopTimer(),this.presetedConstraints.videoTimer=setTimeout((function(){e.destoryVideoMediaStream()}),1e4)}},{key:"_clearPresetVideoStreamAutoStopTimer",value:function(){this.presetedConstraints.videoTimer&&(clearTimeout(this.presetedConstraints.videoTimer),this.presetedConstraints.videoTimer=null)}},{key:"_handleVideoCaptureSuccess",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._clearPresetVideoStreamAutoStopTimer(),i||this._storeVideoStream(e,t),this.webrtcFlag||this._createVideoProcessor(),this._updateStreamInReuse(e,!1),this.isVBEnabled?this.startVBStream().then((function(){r(e)})).catch((function(e){n(e)})):r(e)}},{key:"getVideoCapabilities",value:function(){if(this.videoStream&&(this.videoStreamTrack||(this.videoStreamTrack=this.videoStream.getVideoTracks()[0]),this.videoStreamTrack)){if(this.videoStreamTrack.getCapabilities)return this.videoStreamTrack.getCapabilities()||{};if(this.videoStreamTrack.getSettings)return this.videoStreamTrack.getSettings()||{}}return{}}},{key:"getAudioCapabilities",value:function(){var e=null,t=null;if(this.audioStream){var r=this.audioStream.getAudioTracks()[0];r&&(e=r.getSettings().deviceId,t=r.label)}return{deviceId:e,elapsed_time:this.audioCaptureElapsedTime,deviceLabel:t}}},{key:"getAudioDeviceId",value:function(){return this.isCapturingAudioFromDefault?null:this.getAudioCapabilities().deviceId}},{key:"_splitVideoStream",value:function(e,t,r,n){var i=t.audio,a=t.video;if(i&&this._isStreamHasAudio(e)){var o=this._genVideoStream(e),s=this._genAudioStream(e);return o?this._handleVideoCaptureSuccess(o,a,r,n):n(new Error("video stream do not contains video track ")),void(s&&(this.audioStream?this._pushDeprecatedStream({audioStream:s}):(this._updateStreamInReuse(s,!0),this._storeAudioStream(s,i,!0))))}this._handleVideoCaptureSuccess(e,a,r,n)}},{key:"_captureFileInputVideoStream",value:function(){var e=H(O().mark((function e(t){var r,n,i,a,o;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.video,e.prev=1,e.next=4,new Promise((function(e,t){r.currentTime>0&&!r.paused&&!r.ended&&e(!0);var n=function(){e(!0),r.removeEventListener("timeupdate",n)};r.addEventListener("timeupdate",n),setTimeout((function(){return t(!1)}),1e4)}));case 4:if(e.sent){e.next=6;break}throw new Error("video file playing failed");case 6:return t.width&&t.height||(n=_getFileInputSourceSize(r.videoWidth,r.videoHeight),i=n.width,a=n.height,t.width=i,t.height=a),e.abrupt("return",h.Ay.videoToMediaStreamManager.startCapture(r,t.width,t.height));case 10:throw e.prev=10,e.t0=e.catch(1),console.error(e.t0),(o=new Error("capture stream from file input souce failed")).name="FileInputSouceError",o;case 15:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"startCaptureVideo",value:function(){var e=H(O().mark((function e(t){var r,n,i,a,o,s,u,c,d,l,f,v,g,m,y,_,A,b,E,k,C,w,T,R,I,D,M,x;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.videoConstraints,n=t.timeout,i=t.successHandler,a=void 0===i?this.videoCaptureSuccessHandler:i,o=t.errorHandler,s=void 0===o?this.videoCaptureFailedHandler:o,this.videoCaptureSuccessHandler=a,this.videoCaptureFailedHandler=s,this.receivedVideoConstraints=r,e.t0=this._captureVideoDeferred,!e.t0){e.next=8;break}return e.next=8,this._captureVideoDeferred.promise;case 8:if(this.enableReuseStream(!1),u=!!r&&this._getVideoConstraints(r),c=this._isFileInputVideoSource(u),d=this._isSameVideoConstraintsAsPrev(u),l=this._getPresetAudioConstraints(),this._clearPresetVideoStreamAutoStopTimer(),K.A.add_monitor("STARTVIDEOCAPTURE:".concat(!!this._captureVideoDeferred,":").concat(d)),!d){e.next=12;break}return e.abrupt("return",void this._handleVideoCaptureSuccess(this.videoStream,u,a,s,!0));case 12:if(this.destoryVideoMediaStream(),Un("try to getusermedia",f={audio:c?null:l,video:u}),K.A.add_monitor("VCFC: ".concat((0,h.iD)(JSON.stringify(f)),"|isFileInputVideoSource:").concat(c)),e.prev=15,this.isCaptureVideoInProgress=!0,g=!1,this._clearCaptureVideoTimer(),(m=n||3e4)&&(this.captureVideoTimer=setTimeout(H(O().mark((function e(){var t,r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v){e.next=5;break}return e.next=3,Ze.A.hasPermission("camera");case 3:(t=e.sent)&&(K.A.add_monitor("CAMERANORES"),(0,S.iK)(p.x3x,S.pg.EXCEPTION)),(n||t)&&(g=!0,r=new Error("GetUserMedia timeout"),s(r));case 5:case"end":return e.stop()}}),e)}))),m)),y=Date.now(),!c){e.next=28;break}return e.next=25,this._captureFileInputVideoStream(u);case 25:v=e.sent,e.next=54;break;case 28:return e.prev=28,e.next=31,navigator.mediaDevices.getUserMedia(f);case 31:v=e.sent,e.next=54;break;case 34:if(e.prev=34,e.t1=e.catch(28),_=!0,"OverconstrainedError"!=(null==e.t1?void 0:e.t1.name)){e.next=53;break}return(_=this._getVideoIdealWidthHeight(r))instanceof Object&&(_=Object.assign({},f.video,_)),e.prev=39,f=Object.assign({},f,{video:_}),K.A.add_monitor("CVCFC: ".concat((0,h.iD)(JSON.stringify(f)))),e.next=44,navigator.mediaDevices.getUserMedia(f);case 44:v=e.sent,s(e.t1,!0),e.next=51;break;case 48:e.prev=48,e.t2=e.catch(39),s(e.t2);case 51:e.next=54;break;case 53:s(e.t1);case 54:if(this._clearCaptureVideoTimer(),v){e.next=56;break}return e.abrupt("return",void s(new Error("capture error and return"),!0));case 56:if((A=v.getVideoTracks()[0])&&A.getCapabilities&&(null==(E=A.getCapabilities())||null===(b=E.width)||void 0===b?void 0:b.max)>=1920&&(this.isSupportFullHD=!0),k=A.getSettings(),w=(C=k||{}).width,T=C.height,R=C.frameRate,I=C.facingMode,D=C.deviceId,this.facingMode="user"===I?z.MJ:"environment"===I?z.uu:z.HE,M={width:w,height:T,frameRate:R,facingMode:I},K.A.add_monitor("CapturedVT: ".concat((0,h.iD)(JSON.stringify(M)))),x=A.label,!g){e.next=66;break}return e.abrupt("return",(this._destoryStream(v),void Ze.A.updateSelectedCameraDevices(D,x,w,T,R,Date.now()-y,!1)));case 66:Ze.A.updateSelectedCameraDevices(D,x,w,T,R,Date.now()-y,!0),this._splitVideoStream(v,f,a,s),e.next=73;break;case 70:e.prev=70,e.t3=e.catch(15),s(e.t3);case 73:return e.prev=73,this.isCaptureVideoInProgress=!1,e.finish(73);case 76:case"end":return e.stop()}}),e,this,[[15,70,73,76],[28,34],[39,48]])})));return function(t){return e.apply(this,arguments)}}()},{key:"playVideoStream",value:function(e){if(e){e.setAttribute("muted",""),e.setAttribute("playsinline","");try{e.srcObject=this.getProcessedVideoStream()}catch(t){e.src=u().createObjectURL(this.getProcessedVideoStream())}var t=e.play();return t?t.then((function(){})).catch((function(e){if(!e.message.includes("The play() request was interrupted")&&!e.message.includes("The fetching process for the media resource was aborted"))throw m.Ay.warn("Video element playback failed",e),e})):Promise.resolve(void 0)}return Promise.reject(new Error("video dom node not provided!"))}},{key:"removeVideoStream",value:function(e){e&&(!e.paused&&e.pause(),e.srcObject&&(e.srcObject=null),e.src&&(e.src=null))}},{key:"destoryReuseStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.audio,r=e.video;this.enableReuseStream(!1),t&&this.destoryAudioMediaStream(),r&&this.destoryVideoMediaStream()}},{key:"initVB",value:function(){var e=H(O().mark((function e(t){var r,n,i,a=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.vb||(r=Nn.substring(0,Nn.lastIndexOf("/")),this.vb=new Ar({cdnPath:r}),this.vb.ontimeout3s=function(){K.A.add_monitor("VBP3S"),g.A.Notify_APPUI(p.eJx,null)},this.vb.ontimeout10s=function(){K.A.add_monitor("VBP10S"),g.A.Notify_APPUI(p.IkA,null)},this.vb.onMessage((function(e){var t=e.cmd,r=e.payload;if(t===ir.VB_MODEL_READY)n=performance.now();else if(t===ir.VB_PREDICT_DONE){var i=performance.now()-n;K.A.add_monitor("VBPOK"+i),K.A.add_monitor("TFBE-"+e.payload)}else t===ir.VB_GENERATE_FIRST_FRAME&&a.isVBEnabled&&a.updateVideoStream?a.updateVideoStream(a.vbStream):t===ir.VB_WORKER_ERROR?("VB_VIDEOFRAME_COPYTO_ERROR"===r.message&&(0,S.iK)(p.sCw),m.Ay.error("VB module error: ",r)):t===ir.VB_RESOLUTION_CHANGE&&a.onVBResolutionChange&&a.onVBResolutionChange(r)})),K.A.add_monitor("CWMSCVB")),this.updateVideoStream=t,e.prev=2,e.next=5,this.vb.initialize();case 5:g.A.Notify_APPUI(p.UsF,null),e.next=13;break;case 8:e.prev=8,e.t0=e.catch(2),m.Ay.error("VB initialize failed",e.t0),K.A.add_monitor("VBBEF"),i=p.HjG,g.A.Notify_APPUI(p.KqK,i.FAIL);case 13:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"changeVBImage",value:function(){var e=H(O().mark((function e(t){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isVBEnabled=!0,"blur"===t?this.vb.set_background_blur():this.vb.set_background_image(t)||m.Ay.error("WebRTC change VB background failed"),this.vbStream||!this.videoStream){e.next=9;break}return e.prev=1,e.next=4,this.startVBStream();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),m.Ay.error("WebRTC startVBStream failed",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(t){return e.apply(this,arguments)}}()},{key:"startVBStream",value:function(){return this.videoStream.getVideoTracks()[0]?(this.vbStream=this.vb.createStream(),this.vb.captureVideo(this.videoStream)):Promise.reject("start vb stream fail")}},{key:"stopVBStream",value:function(){this.vbStream=null,this.vb.stopCapture(!1)}},{key:"disableVB",value:function(){this.isVBEnabled=!1,this.updateVideoStream&&this.updateVideoStream(this.videoStream),this.stopVBStream()}},{key:"getVideoStream",value:function(){return this.videoStream}},{key:"getProcessedVideoStream",value:function(){return this.processedStream?this.processedStream:this.isVBEnabled?this.vbStream:this.videoStream}},{key:"isVideoStreamProcessed",value:function(){return this.getProcessedVideoStream()!=this.videoStream}},{key:"getAudioStream",value:function(){return this.audioStream}},{key:"isAudioCaptureProgressing",value:function(){return this.isCaptureAudioInProgress}},{key:"adjustShareResUnder2K",value:function(){var e=H(O().mark((function e(t){var r,n,i,a,o,s,u,c;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.getSettings(),n=r.height,i=r.width,!((a=Math.sqrt(n*i/3686400))<=1)){e.next=3;break}return e.abrupt("return");case 3:return m.Ay.directReport("Adjust Share Res original size: ".concat(i,"x").concat(n)),o=Math.floor(n/a),s=Math.floor(i/a),(u=t.getConstraints()).height=o,u.width=s,e.prev=6,e.next=9,t.applyConstraints(u);case 9:c=t.getSettings(),m.Ay.directReport("Adjust Share Res new size: ".concat(c.width,"x").concat(c.height)),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),m.Ay.error("applyConstraints for share track failed",e.t0),K.A.add_monitor("SVSTACF: ".concat(t.readyState));case 16:case"end":return e.stop()}}),e,null,[[6,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getScaledResolution",value:function(e,t){if(e>t&&e>2560){var r=e/2560,n=t/1440;return r>n?{w:2560,h:Math.floor(t/r)}:{w:Math.floor(e/n),h:1440}}return{w:e,h:t}}}])),Un=(0,b.A)("sdk");function Fn(){document.hidden||(K.A.add_monitor("RE-CAPTURE"),g.A.Notify_APPUI_SAFE(p.hd7),document.removeEventListener("visibilitychange",Fn))}var Bn=!1;try{Bn=!1}catch(ar){}var Wn=0,Gn=function(e){switch(window.orientation){case 0:Wn=1;break;case 90:Wn=2;break;case 180:Wn=3;break;default:Wn=0}},Hn=function(){if(null==window.orientation)return 0;var e=Wn;return Vn.isUsingFileInputVideoSource()&&(e=0),Vn.facingMode==z.uu&&(2==Wn?e=0:0==Wn&&(e=2)),e};function jn(e){var t=p.sfr.UNKNOWN_REASON,r="Unknown reason";return"NotAllowedError"===(null==e?void 0:e.name)?"Permission denied by system"===(null==e?void 0:e.message)?(t=p.sfr.SYSTEM_DENIED,r="Permission denied by system"):"Permission denied"===(null==e?void 0:e.message)||null!=e&&e.message.includes("The request is not allowed by the user agent or the platform in the current context")?(t=p.sfr.USER_DENIED,r="Permission denied by user"):"Permission dismissed"===e.message?(t=p.sfr.USER_DISMISS,r="Permission dismissed by user"):"No AVAudioSessionCaptureDevice device"===e.message&&(t=p.sfr.SYSTEM_DENIED,r="Device access denied by system or browser"):"NotFoundError"===(null==e?void 0:e.name)?"The object can not be found here."===e.message?(t=p.sfr.SYSTEM_DENIED,r="Permission denied by system"):"Requested device not found"===e.message&&(t=p.sfr.NO_DEVICE,r="No device found"):"NotReadableError"!==(null==e?void 0:e.name)&&"TrackStartError"!==(null==e?void 0:e.name)||"Device in use"!==(null==e?void 0:e.message)?"OverconstrainedError"===(null==e?void 0:e.name)&&(t=p.sfr.OVERCONSTRAINED,r="Constraint violation"):(t=p.sfr.DEVICE_IN_USE,r="Device in use"),{errorCode:t,errorMessage:r,error:e}}!function(){try{var e,t;null===(e=window)||void 0===e||e.removeEventListener("orientationchange",Gn),null===(t=window)||void 0===t||t.addEventListener("orientationchange",Gn),Gn()}catch(e){}}(),document.addEventListener("visibilitychange",(function(){var e=h.Ay.getMachineCapability();K.A.add_monitor("page_visibility:".concat(document.visibilityState)),document.hidden?(e.unvisibilitycount++,e.visibility=!1):e.visibility=!0})),(0,Y.qK)();var Kn=[{bitIndex:vr.n.HW_ENCODER_FOR_360P.index,readCount:1,defaultVal:vr.n.HW_ENCODER_FOR_360P.default},{bitIndex:vr.n.WEBGPU_RENDERER.index,readCount:1,defaultVal:vr.n.WEBGPU_RENDERER.default},{bitIndex:vr.n.VB_ON_SAFARI_17.index,readCount:1,defaultVal:vr.n.VB_ON_SAFARI_17.default},{bitIndex:vr.n.WEBGL2_RENDERER.index,readCount:1,defaultVal:vr.n.WEBGL2_RENDERER.default},{bitIndex:vr.n.AUDIO_ECHO_DETECT.index,readCount:1,defaultVal:vr.n.AUDIO_ECHO_DETECT.default},{bitIndex:vr.n.WEBCODEC_DECODE_OPTION.index,readCount:1,defaultVal:vr.n.WEBCODEC_DECODE_OPTION.default},{bitIndex:vr.n.HW_WEBCODEC_ON_SAFARI.index,readCount:1,defaultVal:vr.n.HW_WEBCODEC_ON_SAFARI.default},{bitIndex:vr.n.HW_DECODE_FOR_360P.index,readCount:1,defaultVal:vr.n.HW_DECODE_FOR_360P.default},{bitIndex:vr.n.WEBCODEC_ON_ANDROID_CHROME.index,readCount:1,defaultVal:vr.n.WEBCODEC_ON_ANDROID_CHROME.default},{bitIndex:vr.n.WEBCODEC_ENCODE_OPT_1ON1.index,readCount:1,defaultVal:vr.n.WEBCODEC_ENCODE_OPT_1ON1.default},{bitIndex:vr.n.CAP_WEBCODEC_SUPPORT.index,readCount:1,defaultVal:vr.n.CAP_WEBCODEC_SUPPORT.default},{bitIndex:vr.n.WEBGL_CANVAS_OPTION_OPT.index,readCount:1,defaultVal:vr.n.WEBGL_CANVAS_OPTION_OPT.default},{bitIndex:vr.n.DEFAULT_RENDERER.index,readCount:1,defaultVal:vr.n.DEFAULT_RENDERER.default},{bitIndex:vr.n.WEB_TRANSPORT_CONTROL.index,readCount:1,defaultVal:vr.n.WEB_TRANSPORT_CONTROL.default},{bitIndex:vr.n.ENABLE_TP_RLB_WEBSOCKET.index,readCount:1,defaultVal:vr.n.ENABLE_TP_RLB_WEBSOCKET.default},{bitIndex:vr.n.ENABLE_TRANSFERABLE_RTC_DATACHANNEL.index,readCount:1,defaultVal:vr.n.ENABLE_TRANSFERABLE_RTC_DATACHANNEL.default},{bitIndex:vr.n.ENABLE_WEBRTC_TURN_SERVERS.index,readCount:1,defaultVal:vr.n.ENABLE_WEBRTC_TURN_SERVERS.default},{bitIndex:vr.n.EXTRA_DEVICE_INTERVAL_ENUMERATE.index,readCount:1,defaultVal:vr.n.EXTRA_DEVICE_INTERVAL_ENUMERATE.default},{bitIndex:vr.n.ENABLE_MEDIA_PROCESSOR.index,readCount:1,defaultVal:vr.n.ENABLE_MEDIA_PROCESSOR.default},{bitIndex:vr.n.MOBILE_FORCE_AUTO_CHOOSE_AUDIO_DEVICE.index,readCount:1,defaultVal:vr.n.MOBILE_FORCE_AUTO_CHOOSE_AUDIO_DEVICE.default},{bitIndex:vr.n.SUPPORT_ANNOTATION.index,readCount:1,defaultVal:vr.n.SUPPORT_ANNOTATION.default},{bitIndex:vr.n.WASM_MOBILE_30FPS.index,readCount:1,defaultVal:vr.n.WASM_MOBILE_30FPS.default},{bitIndex:vr.n.ENABLE_WASM_TAG_RENDERER.index,readCount:1,defaultVal:vr.n.ENABLE_WASM_TAG_RENDERER.default},{bitIndex:vr.n.ENABLE_FALLBACK_TO_TAG_RENDERER.index,readCount:1,defaultVal:vr.n.ENABLE_FALLBACK_TO_TAG_RENDERER.default},{bitIndex:vr.n.ENABLE_WEBRTC_AUDIO_2_0.index,readCount:1,defaultVal:vr.n.ENABLE_WEBRTC_AUDIO_2_0.default},{bitIndex:vr.n.ENABLE_MESH.index,readCount:1,defaultVal:vr.n.ENABLE_MESH.default},{bitIndex:vr.n.MESH_NODE.index,readCount:1,defaultVal:vr.n.MESH_NODE.default},{bitIndex:vr.n.SUPPORT_AV_SIMULTANEOUS_FALLBACK.index,readCount:1,defaultVal:vr.n.SUPPORT_AV_SIMULTANEOUS_FALLBACK.default},{bitIndex:vr.n.ANDROID_WEBCODEC_CAP.index,readCount:1,defaultVal:vr.n.ANDROID_WEBCODEC_CAP.default},{bitIndex:vr.n.HW_ENC_ENABLE_L1T1.index,readCount:1,defaultVal:vr.n.HW_ENC_ENABLE_L1T1.default}];(0,be.d)(it);var zn=new(D((function e(){R(this,e),(0,i.A)(this,"_remoteCapabilitiesDescPromise",null)}),[{key:"_testSupportTransferableStream",value:function(){try{var e=(new TransformStream).writable;return(new MessageChannel).port1.postMessage(e,[e]),!0}catch(e){return!1}}},{key:"_testSupportDrawWatermark",value:function(){try{if("function"==typeof OffscreenCanvas&&OffscreenCanvasRenderingContext2D&&!OffscreenCanvasRenderingContext2D.prototype.measureText)return!0}catch(e){return!1}}},{key:"analyzeMainCapabilites",value:function(){var e={};try{e.supportGraphicsAcceleration=!h.Ay.getGpuInfo().isWebGLContextInvalid&&!h.Ay.isUsingSwiftShader()}catch(e){}return e.supportVideoFrame="function"==typeof We().VideoFrame,e.supportMediaStreamTrackGenerator="function"==typeof We().MediaStreamTrackGenerator,e.supportTransferableStream=this._testSupportTransferableStream(),e.supportDrawWatermark=this._testSupportDrawWatermark(),e}},{key:"_analyzeInWorker",value:function(){return new Promise((function(e,t){var r=new je;r.onmessage=function(r){var n=r.data,i=n.result,a=n.error;a?t(new Error(a)):e(i)},r.onerror=function(e){t(e)},r.postMessage({})}))}},{key:"analyzeRemoteCapabilities",value:function(){var e=this;return this._remoteCapabilitiesDescPromise||(this._remoteCapabilitiesDescPromise=new Promise((function(t,r){e._analyzeInWorker().then((function(e){t(e)})).catch((function(e){r(e)}))}))),this._remoteCapabilitiesDescPromise}}]));Fe.f.analyze(zn);var qn=function(){var e,t,n,i,a,o=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(g.A.timeOrigin||(g.A.timeOrigin=performance.timeOrigin),K.A.reset(),Mn.e.reset(),Vn.webrtcFlag=!1,this._id=(new Date).getTime()+Math.floor(performance.now()),window._sdk=this,this.publicRootPath="",s.parentPath){var u=s.parentPath.endsWith("/")?s.parentPath:s.parentPath+"/";r.p=u,this.publicRootPath=u}else{var c=null==Nn?void 0:Nn.indexOf("js_media.min.js");if(c){var d=null==Nn?void 0:Nn.substring(0,c);r.p=d,this.publicRootPath=d}else Un("could not locate parentPath")}if(this.lateLoadedAssetsHash={},s.globalTracingLogger&&(m.Ay.setInstance(s.globalTracingLogger,qn.fixVersion),m.Ay.flushCacheLog()),m.Ay.clearHighFrequencyLogs(),Math.abs(g.A.timeOrigin+performance.now()-Date.now())>=500&&m.Ay.error("timeOrigin: ".concat(g.A.timeOrigin,", performance.now: ").concat(performance.now(),", Date.now: ").concat(Date.now())),this.isSupportThread="object"==("undefined"==typeof WebAssembly?"undefined":j(WebAssembly))&&"function"==typeof Worker,!this.isSupportThread)throw new Error("Webassemly or worker is not supported on this browser");var l=g.A.sharedBuffer;g.A.reinit(this),l&&(g.A.sharedBuffer=l),this.localLog=null,Bn&&(this.localLog=new $e,this.localLog.init()),Ze.A.init({onChangeHandler:this.deviceChangeHandler.bind(this)}),this.isLSSPlayer=null==s||null===(e=s.platformMode)||void 0===e?void 0:e.isLSSPlayer,this.cid="",this.userId="",this.selfPreviewVideotagList=[],this.sharingCanvasList=[],this.mainSharingCanvas=null,this.annoCanvas=null,this.annoPresenterCanvas=null,this.localShareCanvas=null,this.localShareVideoTag=null,this.localShareCanvasExt=null,this.audioCtx=null,this.sharePreviewVideo=null,this.sharePreviewCanvas=null,this.localShareCanvasWaiting=!1,this.sharingAudioCtx=null,this.webrtcAudioNode=null,this.sharingWebrtcAudioNode=null,this.videoRenderArray=[],this.videoCaptureValue=null,this.audioRenderArray=[],this.audioCapture=null,this.deviceInfo=new Map,this.display=[],this.sampleRate=null===(t=this.audioCtx)||void 0===t?void 0:t.sampleRate,this.videoRenderIntervalHandle=null,this.audioDomNode=null,this.audioSpeakerValue=null,this.audioSpeakerSetErrorCnt=0,this.audioMicSetErrorCnt=0,this.audionoderecordbuffersize=2048,this.lastresidual=null,this.currentactive=0,this.audioPlay=!1,this.sharingInterval=null,this.sharingIntervalTime=100,this.sharingDisplay=null,this.currentshareactive=0,this.activeSpeakerSsrc=0,this.videorenderinterval=30,this.waterMarkCanvas=null,this.videoCaptureHiddenCanvas=null,this.videoCaptureHiddenCanvasCtx=null,this.isSetCursor=!1,this.logon=!1,this.canvas=null,this.firstSetDelay=!0,this.isSelfViewWithVideo=!1,this.isSupportOffscreenCanvas=h.Ay.isSupportOffscreenCanvas(),this.isSupportVideoShare=h.Ay.isSupportVideoShareReceive()&&h.Ay.isSupportVideoShareSend(),this._isSupportMediaStreamTrackProcessor=void 0,this._isSupportVideoFrameOrBitmapCapture=void 0,this.isMultipleCanvasForMultipleView=0,this.isCaputureNodeConnect=!1,this.isSharingCaptureNodeConnect=!1,this.audioWorkletJsPath=null,this.isSupport2DCanvasDrawFrame=h.Ay.isSupport2DCanvasDrawFrame(),this.MaskImage=null,this.BgImage=null,this.bgCanvas=null,this.bgCanvasctx=null,this.isCurrentInMaskStatus=!1,this.isCurrentInNoVBPreviewStatus=!1,this.videoNoVBPreviewCanvas=null,this.videoNoVBPreviewCanvasctx=null,this.isVideoNoVBPreviewCanvasScaled=!1,this.maskCoordinate={dx:0,dy:0,dWidth:0,dHeight:0},this.VideoMaskSettingCanvas=null,this.VideoMaskSettingCanvasctx=null,this.PrevVideoMaskSettingCanvas=null,this.VideoMaskCanvasFillMode=0,this.isMaskSettingOn=!1,this.isMaskSettingStarted=!1,this.MaskData=null,this.MaskSettingVideo=null,this.ReadyCapureWidth=640,this.ReadyCapureHeight=360,this.bgImageCroppingParams={sx:0,sy:0,sw:0,sh:0},this.VideoVBSettingCanvas=null,this.isVBSettingOn=!1,this.sMonitorCaptureFrameCount=0,this.vMonitorCaptureFrameCount=0,this.isStartVideoCapture=!1,this.videoCaptureWidth=0,this.videoCaptureHeight=0,this.videoCaptureContext=null,this.isCreateVideoWaterMark=!1,this.videoWaterMarkName="",this.sharingWaterMarkName="",this.isCreateSharingWaterMark=!1,this.videoWaterMarkParams={},this.sharingWaterMarkParams={},this.isStartDesktopSharing=!1,this.desktopSharingValue=null,this.desktopCaptureContext=null,this.desktopSharingMediaStream=null,this.desktopSharingMediaStreamRaw=null,this.desktopSharingCaptureWidth=0,this.desktopSharingCaptureHeight=0,this.sharingCodecInfo={width:0,height:0},this.desktopSharingSend=!1,this.isdesktopCaptureLoadedmetadata=!1,this.captureVideoOutputCanvasDomList=[],this.captureVideoOutPutVideoDom=null,this.shareTrack=null,this.drawLocalShareInterval=200,this.drawLocalShareIntervalId=null,this.isVideoCaptureLoadedmetadata=!1,this.videoloadmetadataListener=null,this.videoloadedmetadatamonitor=null,this.loadedmetadatamtimeoutcount=0,this.mountoadedmetadatatime=0,this.VALUE_CACHE_FOR_START_CAPTURE_VIDEO={},this.vMonitorCount=0,this.sMonitorCount=0,this.mMonitorCount=0,this.sharingMediaStreamTrackProcessor,this.sharingFrameStream,this.isSendVideoOfflineCanvas=!1,g.A.mediaSDKHandle=this,this._preloadMeetingParam=null,this.is32bitbrowser=!1,this.flipSend=!0,this.mtu_size=0,this.sharingImageCapture=null,this.sharingRenderCanvas=null,this.VideoRenderObj=null,this.SharingRenderObj=null,this.rtcConnectionA=null,this.rtcConnectionB=null,this.isLocalP2PSupportedPromise=this.isLSSPlayer?Promise.resolve(!0):h.Ay.checkLocalP2PConnection(),this.isSupportBrowserAec=!0,this.sharingWidthAndHeightInfo={ctiveNodeID:0,height:0,logicHeight:0,logicWidth:0,width:0},this.remoteControl=null,this.isMirrorMyVideo=!1,this.isCanvasScaled=!1,this.isDestroy=!1,this.destoryPromise=null,this.rwgAgentMessageListenerWrapper=this.rwgAgentMessageListener.bind(this),this.bVideoDecodeUsingSAB=h.Ay.isSupportSharedArrayBuffer(),this.bVideoEncodeUsingSAB=h.Ay.isSupportSharedArrayBuffer(),this.bAudioEncodeUsingSAB=h.Ay.isSupportSharedArrayBuffer(),this.bAudioDecodeUsingSAB=h.Ay.isSupportSharedArrayBuffer(),this.videoDecodeRingBuffer=null,this.videoEncodeRingBuffer=null,this.audioDecodeRingBuffer=null,this.audioEncodeRingBuffer=null,this.bVideoEncodeMainThreadConsumerIntervalEnable=h.Ay.isIphoneOrIpadSafari(),this.isSupportOffscreenCanvasForVideoDecode=h.Ay.isSupportOffscreenCanvas(),this.isMultiView=!1,this.checkWorkletInterval=null,this.persistenceInfo=new Mr.Y,this.lastRealRect={left:0,top:0,width:0,height:0},this.videodecodehardwareflag=null,this.videoencodehardwareflag=null,this.isEnableVideoDecodeHardWareThread=!1,this.hardwareflag=null,this.isEnableHardWareThread=!1,this.isTeslaMode=!1,this.useWebRTCAudio=!1,this.webrtcAudio=null,this.replaceCanvasMap={},this.hidAvalible=!1,this.enableHID=!1,this.audioInputLevel=null,this.captureAudioMuted=!1,this.setvideokk=!1,this.isStartWhiteboardSharing=!1,this.ZoomMonitor=K.A.add_monitor.bind(K.A),this.isLandScape=!1,this.captureSize=null,this.platformType=z.u7.DESKTOP,(0,S.Xe)(this.ZoomMonitor),this.wmscManager=null,this.webrtcConfig={userId:null,webrtcflag:!1,subscribeQosParamsData:{},currentReloadTimes:0,maxReloadTimes:6},this.allpromises=[],this.RenderInMain=z.p$,this.vcFlag=!1,this.waitingVcChannelReady=!1,tt.isSupportComputePressure()&&(this.computePressureManager=new tt),this.renderManager=new lr("JsMediaSDK"),this.rendererType=-1,this.defaultRendererType=0,this.isWebGPUFeatureEnabled=!1,this.enableVBWasmBackend=0,this.isWebGL2FeatureEnabled=!1,this.isWebTransportAllowed=!0,this.mGPUBlacklist=null,this.mWebCodecConfig=null,this.webrtcVideoCodecConfig=null,this.isWebCodecEncoderOnWhitelist=!1,this.isWebCodecDecoderOnWhitelist=!1,this.mediaProcessorConfig=0,this.mediaFeatureOptions="",this.isAnnotationEnabled=!1,this.isAnnotationPMEnabled=!1,this.shareAnnotationInited=!1,this.isWebRTCAudio2Enabled=!1,this.isVideoHD=!1,this.vbResource=null,this.vbSettingDomMap={},this.annotationModule=null,this.annotationMgr=null,this.localAnnoStarted=!1,this.fileAudioPlaybackTag=null,this.initVEPara=null,this.resolveVEwebrtcpromise=null,this.webrtcpromise=new Promise((function(e,t){o.resolveVEwebrtcpromise=e})),this.initVDPara=null,this.resolveVDwebrtcpromise=null,this.webrtcVDpromise=new Promise((function(e,t){o.resolveVDwebrtcpromise=e})),this.hadsetpropsbeforeinit=!1,this.networkerpath=null,this.dataChannelController=new Y.xm,this.dataTransportController=new Y.G1,this.dataChannelController.register(),this.dataTransportController.register(),(0,Q.tK)(this),(0,Q.Nd)(this.workrtHealthCheckReport.bind(this)),this.netThreadMgr=new vn("net",h.Ay.browser.isSafari),this.netThreadMgr.setMonitorLog(this.ZoomMonitor),this.netThreadMgr.setUseTransferRTC((0,h.Yu)()),this.meshThread=null,this.processorMessagePort=null,this.shadowProcessorMessagePort=null,this.JsMediaSDK_PreLoad(s),null!=s&&s.rwgAgent&&this.setRWGAgent(s.rwgAgent),this.isVideoTagFrameAccessible=h.Ay.isSupportVideoFrame()&&((null===(n=h.Ay.browser)||void 0===n?void 0:n.isSafari)||(null===(i=h.Ay.browser)||void 0===i?void 0:i.isFirefox)||(null===(a=h.Ay.browser)||void 0===a?void 0:a.isChromeOrEdge))};qn.buildNumber="11738",qn.version="15.0.11738",qn.util=h.Ay,qn.util.getDeviceListAsync=Ze.A.getDeviceListAsync.bind(Ze.A),qn.fixVersion="Web-Media-EP-6.5.0",qn.prototype={JsMediaSDK_Log:function(e){m.Ay.error("Error in JsMediaSDK",e)},JsMediaSDK_PreLoad:function(e){var t,r,n,i,a,o;Ue.l.init({browser:{brand:h.Ay.browserType.browser,version:h.Ay.browserType.version,isBlink:h.Ay.browserEngine.isBlink,isWebkit:h.Ay.browserEngine.isWebkit},sysinfo:h.Ay.getOSInfo(),browserVersionInfo:(0,Dn.H0)().browser});var s=e||{},u=s.enableMultiDecodeVideoWithoutSAB,c=s.enableVirtualBackgroundWithoutSAB,d=s.disableStreamingInstantiate,l=s.isVDIWebview,f=s.shouldKeepAVWhenFailover;this.globalTracingLogger=e.globalTracingLogger,this.mid=e.mid,this.meetingNumber=e.meetingNumber,this.isSessionBranding=e.isSessionBranding,this.mediaSDKConfig=e.mediaSDKConfig,this.vbResource=[{type:"bin",path:"".concat(null===(t=this.mediaSDKConfig)||void 0===t?void 0:t.mediaSDKCDNPath,"/vb-resource/dualModel.bin")},{type:"js",path:"".concat(null===(r=this.mediaSDKConfig)||void 0===r?void 0:r.mediaSDKCDNPath,"/vb-resource/tf.min.js")}],this.platformMode=e.platformMode,this.isLSSPlayer&&(g.A.isLSSPlayer=this.isLSSPlayer,this.isSupportVideoShare=!1,this.audioCtx=(0,h.Bw)(),this.gainNode=this.audioCtx.createGain(),(0,h.SE)(this.audioCtx));var p,v=this.mediaSDKConfig.mediaSDKCDNPath,m=e.callback;g.A.decoderinworkletOP=!0,g.A.isDesktopMode=this.platformMode.isDesktopMode,g.A.enableStreamingInstantiate=!d,g.A.enableMultiDecodeVideoWithoutSAB=u,g.A.enableVirtualBackgroundWithoutSAB=c,this.isTeslaMode=!!this.platformMode.isTeslaMode,g.A.isGoogleMeetMode=this.platformMode.isGoogleMeetMode,g.A.isVDIWebview=l,g.A.shouldKeepAVWhenFailover=f,l&&(this.isSupportVideoShare=!1),v?(Ve.X.setBaseScriptUrl(v),this.getFilePath=this.makFilePath(v)):null!==(p=this.publicRootPath)&&void 0!==p&&p.endsWith("/")?this.getFilePath=this.makFilePath(this.publicRootPath.slice(0,-1)):this.getFilePath=this.makFilePath(this.publicRootPath);var y={audioWorkletPath:(v=(null===(n=this.getFilePath)||void 0===n?void 0:n.call(this))||v).audioWorkletPath,audioWorkletSIMDPath:v.audioWorkletSIMDPath,audioWorkletProcessPath:v.audioWorkletProcessPath,sharingAudioWorkletPath:v.sharingAudioWorkletPath,audioLevelWorkletPath:v.audioLevelWorkletPath,audioWasm:v.audioWasm,audioSIMDWasm:v.audioSIMDWasm};this.networkerpath=null===(i=v)||void 0===i?void 0:i.netThreadPath,this.setProps({callback:m,audioWorkletPath:y,fromPreload:!0}),this._preloadMeetingParam=v,_.Start_Monitor(this),this.handleUnloadEvent(),K.A.add_monitor("JSPLD"),this.computePressureManager&&this.computePressureManager.init(),this.mediasdkConfig=null,this.iceServers=[],this.stunservers=[];var S=null===(a=v)||void 0===a?void 0:a.netThreadPath,A=null===(o=v)||void 0===o?void 0:o.netWasm;this.netThreadMgr&&S&&A&&(this.netThreadMgr.setPathAnsWasm(S,A),this.netThreadMgr.init())},getWebRTCFlag:function(){return this.webrtcConfig&&this.webrtcConfig.webrtcflag},getWasmRenderingMethod:function(){switch(this.rendererType){case ee.h3.WEBGL:return"webgl";case ee.h3.WEBGPU:return"webgpu";case ee.h3.WEBGL_2:return"webgl2";case ee.h3.VIDEO_TAG:return"video-tag";default:return""}},createSsrcStreamWithRenderMode:function(e,t,r){var n=mn.getSsrcKind(e,t);return new wn(e,n,r,{autoPlay:!0})},get base(){return it},get isSupportMediaStreamTrackProcessor(){return void 0===this._isSupportMediaStreamTrackProcessor&&(this._isSupportMediaStreamTrackProcessor=h.Ay.isSupportMediaStreamTrackProcessor()),this._isSupportMediaStreamTrackProcessor},get isSupportVideoFrameOrBitmapCapture(){return void 0===this._isSupportVideoFrameOrBitmapCapture&&(this._isSupportVideoFrameOrBitmapCapture=h.Ay.isSupportVideoFrameOrBitmapCapture()),this._isSupportVideoFrameOrBitmapCapture},makFilePath:function(e){var t=e;return function(){return t?{audioWorkerPath:"".concat(t,"/js_audio_process.min.js"),audioWorkletPath:"".concat(t,"/js_audio_worklet.min.js"),audioWorkletSIMDPath:"".concat(t,"/js_audio_worklet_simd.min.js"),audioWorkletProcessPath:"".concat(t,"/js_audio_worklet_process.min.js"),audioWasm:"".concat(t,"/audio.encode.wasm"),mediaWorkerPath:"".concat(t,"/media.worker.js"),videoWorkerPath:"".concat(t,"/video_s.min.js"),videoMtWorkerPath:"".concat(t,"/video_m.min.js"),videoWasm:"".concat(t,"/video.decode.wasm"),videoMtWasm:"".concat(t,"/video.mt.wasm"),sharingWorkerPath:"".concat(t,"/sharing_s.min.js"),sharingMtWorkerPath:"".concat(t,"/sharing_m.min.js"),videoSIMDWorkerPath:"".concat(t,"/video_simd.min.js"),videoSIMDWasm:"".concat(t,"/video.simd.wasm"),sharingSIMDWorkerPath:"".concat(t,"/sharing_simd.min.js"),videoMSIMDWasm:"".concat(t,"/video.mtsimd.wasm"),sharingMSIMDWorkerPath:"".concat(t,"/sharing_mtsimd.min.js"),videoMSIMDWorkerPath:"".concat(t,"/video_mtsimd.min.js"),audioSIMDWorkletPath:"".concat(t,"/audio_simd.min.js"),audioSIMDWasm:"".concat(t,"/audio.simd.wasm"),vsmiworkerpath:"".concat(t,"/video_share_mtsimd.min.js"),sharingAudioWorkletPath:"".concat(t,"/js_sharing_audio_worklet.min.js"),audioLevelWorkletPath:"".concat(t,"/js_audio_level_worklet_process.min.js"),netThreadPath:"".concat(t,"/net_thread.min.js"),meshTread:"".concat(t,"/mesh_thread.min.js"),netWasm:"".concat(t,"/net.wasm")}:void 0}},isPreviewVideotag:function(e){return this.userId&&this.userId>>10==e>>10&&h.Ay.isSelfPreviewRenderWithVideo()},isSharePreviewVideotag:function(e){return this.userId&&this.userId>>10==e>>10},isSelfUser:function(e){return this.userId==e},recordSharingParamInfo:function(){var e=this;E.A.on(p.vjv,(function(t,r){var n;Object.assign(e.sharingWidthAndHeightInfo,r.body),null===(n=e.annotationMgr)||void 0===n||n.updateRemoteSizeInfo(r.body)}))},setCallback:function(e){if(!C()(e))throw new Error("callback must be function");g.A._Notify_APPUI=e,(0,S._G)(g.A.Notify_APPUI_SAFE.bind(g.A))},addCallback:function(e){if(!C()(e))throw new Error("callback must be function");g.A._callbackList.push(e)},removeCallback:function(e){var t=g.A._callbackList.indexOf(e);-1!==t&&g.A._callbackList.splice(t,1)},doRenderConfig:function(e,t){if(t){var r=pr.A.batchRead(t,Kn),n=r.get(vr.n.DEFAULT_RENDERER.index);Ve.X.setDefaultRendererType(n);var i=r.get(vr.n.WEBGL_CANVAS_OPTION_OPT.index);Ve.X.setIsEnableCanvasCtxOptionsOpt(i);var a=r.get(vr.n.ENABLE_WASM_TAG_RENDERER.index);Ve.X.setWasmTagRendererFlags(a);var o=r.get(vr.n.ENABLE_FALLBACK_TO_TAG_RENDERER.index);Ve.X.setFallbackToTagRenderFlags(o)}if(h.Ay.getGpuInfo(),e&&e.webMediaBlockConfig)try{var s,u,c=JSON.parse(e.webMediaBlockConfig),d=null==c||null===(s=c.RenderConfig)||void 0===s?void 0:s.safariYuvPaddingFixVer;d&&Ve.X.setSafariYuvPaddingFixVer(d);var l=null==c||null===(u=c.RenderConfig)||void 0===u?void 0:u.chromeYuvLeftTopPaddingFixVer;l&&Ve.X.setChromeYuvLeftTopPaddingFixVer(l)}catch(e){}Ve.X.markConfigDone()},setProps:function(e){var t,r,n,i,a,o,s,u,c,d,l,f,v=this;this.hadsetpropsbeforeinit|=!e.fromPreload;var y=null==this||null===(t=this.mediaSDKConfig)||void 0===t?void 0:t.mediaFeatureOptions;this.mediaParams=e.mediaParams;var _=h.Ay.getOSInfo();if(e.meetingParams&&(this.meetingParams=e.meetingParams,this.meetingParams.isPreviewMode=e.isPreviewMode,this.meetingParams.meetingNumber=this.meetingParams.meetingNumber||this.meetingNumber,this.meetingParams.meetingId=this.meetingParams.confId),this.doRenderConfig(e,y),this.webrtcAudio2EnabledOnFT=null==this||null===(r=this.meetingParams)||void 0===r?void 0:r.webrtcAudio2EnabledOnFT,this.audioABTestStrategy=null==this||null===(n=this.meetingParams)||void 0===n?void 0:n.audioABTestStrategy,this.mediaFeatureOptions=y,this.isChromeWideAECSupported=h.Ay.isSupportChromeWideAEC(this.mediaFeatureOptions),this.isPlayStereoAudioSupported=h.Ay.isSupportPlayStereo(this.mediaFeatureOptions),Ze.A.setMediaOPConfig(this.mediaFeatureOptions),Ze.A.setPreviewMode(null===(i=this.meetingParams)||void 0===i?void 0:i.isPreviewMode),y){var S=pr.A.batchRead(y,Kn);this.isWebGPUFeatureEnabled=!!S.get(vr.n.WEBGPU_RENDERER.index),this.enableVBWasmBackend=S.get(vr.n.VB_ON_SAFARI_17.index),this.isWebGL2FeatureEnabled=!!S.get(vr.n.WEBGL2_RENDERER.index),this.defaultRendererType=S.get(vr.n.DEFAULT_RENDERER.index),this.isWebTransportAllowed=!!S.get(vr.n.WEB_TRANSPORT_CONTROL.index);var A=S.get(vr.n.SUPPORT_ANNOTATION.index);this.isAnnotationEnabled=!!(A&vr.n.SUPPORT_ANNOTATION.candidates.VIEWER),this.isAnnotationPMEnabled=!!(this.isAnnotationEnabled&&A&vr.n.SUPPORT_ANNOTATION.candidates.PRESENTER),g.A.enable360pHWEnc=S.get(vr.n.HW_ENCODER_FOR_360P.index),g.A.enableEchoDetection=S.get(vr.n.AUDIO_ECHO_DETECT.index),g.A.enableHADecOpt=S.get(vr.n.WEBCODEC_DECODE_OPTION.index),g.A.enableSafariHWCodec=S.get(vr.n.HW_WEBCODEC_ON_SAFARI.index),g.A.enable360pHWDec=S.get(vr.n.HW_DECODE_FOR_360P.index),g.A.enableOptCopyFrame=S.get(vr.n.WEBCODEC_ENCODE_OPT_1ON1.index),g.A.disableHWCodec=S.get(vr.n.CAP_WEBCODEC_SUPPORT.index),S.get(vr.n.WEBGL_CANVAS_OPTION_OPT.index),g.A.enableTransferDataChannel=S.get(vr.n.ENABLE_TRANSFERABLE_RTC_DATACHANNEL.index);var b=g.A.enableTransferDataChannel&&(0,h.Yu)();this.netThreadMgr.setUseTransferRTC(b),g.A.enableWebrtcTurnServer=S.get(vr.n.ENABLE_WEBRTC_TURN_SERVERS.index),g.A.mobileForceAutoChooseAudioDevice=S.get(vr.n.MOBILE_FORCE_AUTO_CHOOSE_AUDIO_DEVICE.index),g.A.enablemesh=S.get(vr.n.ENABLE_MESH.index),g.A.mesh_node=S.get(vr.n.MESH_NODE.index),this.mediaProcessorConfig=S.get(vr.n.ENABLE_MEDIA_PROCESSOR.index),this.isWebRTCAudio2Enabled=!!S.get(vr.n.ENABLE_WEBRTC_AUDIO_2_0.index),g.A.supportAVSimultaneousFallback=S.get(vr.n.SUPPORT_AV_SIMULTANEOUS_FALLBACK.index);var E=S.get(vr.n.ANDROID_WEBCODEC_CAP.index);g.A.enableAndroidHWDec=!(E&vr.n.ANDROID_WEBCODEC_CAP.candidates.DISABLE_DECODER),g.A.enableAndroidHWEnc=!(E&vr.n.ANDROID_WEBCODEC_CAP.candidates.DISABLE_ENCODER);var k=S.get(vr.n.HW_ENC_ENABLE_L1T1.index);g.A.HWEncEnableL1T1=k,h.Ay.isAndroidBrowser()&&(g.A.enable360pHWDec=g.A.enableAndroidHWDec),m.Ay.directReport("setPropsBeforeInit, os:".concat(_.os,", version:").concat(_.osVersion,", enableSafariHWCodec:").concat(g.A.enableSafariHWCodec,", enable360pHWDec:").concat(g.A.enable360pHWDec,", enable360pHWEnc:").concat(g.A.enable360pHWEnc,", enableAndroidHWDec:").concat(g.A.enableAndroidHWDec,",enableAndroidHWEnc:").concat(g.A.enableAndroidHWEnc,", HWEncEnableL1T1:").concat(g.A.HWEncEnableL1T1,", enableOptCopyFrame:").concat(g.A.enableOptCopyFrame))}var C=h.Ay.getGpuInfo();if(null!=this&&null!==(a=this.mediaSDKConfig)&&void 0!==a&&a.webMediaBlockConfig)try{var w,T=JSON.parse(this.mediaSDKConfig.webMediaBlockConfig);this.mGPUBlacklist=null==T?void 0:T.GPUBlacklist,this.mWebCodecConfig=null==T?void 0:T.WebCodecConfig,this.webrtcVideoCodecConfig=fr.A.readWebRTCVideoCodecConfig(null==T||null===(w=T.WebRTCConfig)||void 0===w?void 0:w.VideoCodecConfig,_),this.mWebCodecConfig?(this.isWebCodecEncoderOnWhitelist=fr.A.isGPUProfileOnWebCodecWhitelist("encoder",this.mWebCodecConfig,C,_),this.isWebCodecDecoderOnWhitelist=fr.A.isGPUProfileOnWebCodecWhitelist("decoder",this.mWebCodecConfig,C,_)):(this.isWebCodecEncoderOnWhitelist=0===h.Ay.AdapterWhiteListCheckForEncoder(),this.isWebCodecDecoderOnWhitelist=fr.A.isGPUProfileOnWebCodecWhitelist("decoder",void 0,C,_))}catch(e){var R;this.isWebCodecEncoderOnWhitelist=0===h.Ay.AdapterWhiteListCheckForEncoder(),this.isWebCodecDecoderOnWhitelist=fr.A.isGPUProfileOnWebCodecWhitelist("decoder",void 0,C,_),""===this.mediaSDKConfig.webMediaBlockConfig?m.Ay.log("cannot read empty props.webMediaBlockConfig. encoder:".concat(this.isWebCodecEncoderOnWhitelist," decoder:").concat(this.isWebCodecDecoderOnWhitelist)):m.Ay.error("failed to read props.webMediaBlockConfig! config=".concat(null==this||null===(R=this.mediaSDKConfig)||void 0===R?void 0:R.webMediaBlockConfig," encoder:").concat(this.isWebCodecEncoderOnWhitelist," decoder:").concat(this.isWebCodecDecoderOnWhitelist))}else this.isWebCodecEncoderOnWhitelist=0===h.Ay.AdapterWhiteListCheckForEncoder(),this.isWebCodecDecoderOnWhitelist=fr.A.isGPUProfileOnWebCodecWhitelist("decoder",void 0,C,_);void 0!==(null==this||null===(o=this.mediaParams)||void 0===o?void 0:o.rendererType)&&(this.rendererType=this.mediaParams.rendererType,this.handleRendererTypeInProps(this.rendererType,this.defaultRendererType,this.mGPUBlacklist).then((function(e){g.A.Notify_APPUI(p.zFT,e),v.renderManager.getRendererProvider().setRendererType(e.rendererType),e.rendererType===ee.h3.VIDEO_TAG?Ve.X.setIsUseSsrcStream(!0):Ve.X.setIsUseSsrcStream(!1),v.rendererType=e.rendererType,m.Ay.log("handleRendererTypeInProps() final rendererType=".concat(e.rendererType," gpuBlacklist=").concat(JSON.stringify(v.mGPUBlacklist))),console.log("handleRendererTypeInProps() final rendererType=".concat(e.rendererType," gpuBlacklist=").concat(JSON.stringify(v.mGPUBlacklist)))}))),K.A.add_monitor("props:".concat(y,":").concat(this.isWebGPUFeatureEnabled,":").concat(this.enableVBWasmBackend,":").concat(this.isWebGL2FeatureEnabled,":").concat(this.rendererType,":").concat(g.A.enableEchoDetection)),e.callback&&this.setCallback(e.callback),e.audioWorkletPath&&(this.audioWorkletJsPath=e.audioWorkletPath),null!=this&&null!==(s=this.meetingParams)&&void 0!==s&&s.e2eEncrypt?g.A.e2eencrypt=!0:g.A.e2eencrypt=!1;var I=null==this||null===(u=this.meetingParams)||void 0===u?void 0:u.enableWebtransport;this.isWebTransportAllowed||(I=!1),this._setWebtransportEnable({enable:I,webtransportPort:null==this||null===(c=this.meetingParams)||void 0===c?void 0:c.webtransportPort});var D,M,O,x,P=(0,h.Az)();if(P?P.uplimit>=800?g.A.uplimit=1e3*(P.uplimit-120):g.A.uplimit=0:g.A.uplimit||(g.A.uplimit=0),(null==e||null===(d=e.meetingParams)||void 0===d?void 0:d.webrtcMode)&z.Q9){var L=!0;Vn.webrtcFlag=L,this.webrtcConfig.webrtcflag=L,(0,h.h)(L),K.A.add_monitor("WMSC_webrtcMode:".concat(e.meetingParams.webrtcMode))}if(!e.fromPreload&&this.vbResource&&this.webrtcConfig.webrtcflag&&(h.I4.setIsSupportVirtualBackground(!(this.isTeslaMode||h.Ay.isAndroidBrowser()||h.Ay.isIphoneOrIpadBrowser()||this.platformMode.isMSTF)),h.I4.getIsSupportVirtualBackground()&&Vn.initVB(this.updateWebRTCVideoStream.bind(this))),!1===this.isSessionBranding&&(g.A.enableCanvasAlphaChannel=!1),this.renderManager.setCanvasAlphaChannelEnability(g.A.enableCanvasAlphaChannel),null!=this&&null!==(l=this.meetingParams)&&void 0!==l&&l.rwgToMediaSDKConfig&&g.A.enableWebrtcTurnServer&&(this.iceServers=(null==this||null===(D=this.meetingParams)||void 0===D||null===(D=D.rwgToMediaSDKConfig)||void 0===D?void 0:D.iceServers)||[],null===(M=this.webrtcAudio)||void 0===M||null===(O=M.setIceServers)||void 0===O||O.call(M,this.iceServers)),null!=this&&null!==(f=this.meetingParams)&&void 0!==f&&f.rwgToMediaSDKConfig&&1&g.A.enablemesh&&(this.stunServers=(null==this||null===(x=this.meetingParams)||void 0===x||null===(x=x.rwgToMediaSDKConfig)||void 0===x?void 0:x.stunServers)||[]),this.meetingParams&&y){var N=!0,V=!0;this.meetingParams.webrtcMode&z.h&&(h.Ay.isWebRTCAudio2_0(y,this.meetingParams.mid,!0,this.webrtcAudio2EnabledOnFT,this.audioABTestStrategy)?V=!1:N=!1),this.meetingParams.webrtcMode&z.Q9&&(V=!1),N&&this.persistenceInfo.getAudioBridgeConnectivityInfo().checkWebRTCConnectivity(this.meetingParams,this.iceServers),V&&this.persistenceInfo.getWMSCConnectivityInfo().checkWebRTCConnectivity(this.meetingParams,this.iceServers)}},onRendererTypeSelected:function(){var e=this;return H(O().mark((function t(){var r;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.handleRendererTypeInProps(e.rendererType,e.defaultRendererType,e.mGPUBlacklist);case 2:r=t.sent,g.A.Notify_APPUI(p.zFT,r),e.renderManager.getRendererProvider().setRendererType(r.rendererType),e.renderManager.getRendererProvider().setRendererType(r.rendererType),e.rendererType=r.rendererType,r.rendererType===ee.h3.VIDEO_TAG?Ve.X.setIsUseSsrcStream(!0):Ve.X.setIsUseSsrcStream(!1);case 4:case"end":return t.stop()}}),t)})))()},handleRendererTypeInProps:function(e,t){var r=arguments,n=this;return H(O().mark((function i(){var a,o,s;return O().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=r.length>2&&void 0!==r[2]?r[2]:null,e!==ee.h3.AUTO&&e!==ee.h3.UNDEFINED&&e!==ee.h3.WEBGL&&e!==ee.h3.WEBGL_2&&e!==ee.h3.WEBGPU&&e!==ee.h3.VIDEO_TAG&&(e=ee.h3.AUTO),o=e,s=0,e!==ee.h3.AUTO&&e!==ee.h3.UNDEFINED||(o=Ve.X.canUseSsrcStream()&&h.Ay.isUsingSwiftShader()?ee.h3.VIDEO_TAG:t),i.next=6,h.Ay.isRendererTypeSupported(o,n.isWebGPUFeatureEnabled,n.isWebGL2FeatureEnabled,a);case 6:if(i.t0=i.sent,i.t0){i.next=12;break}return s=1,i.next=11,h.Ay.evaluateRendererType(n.isWebGPUFeatureEnabled,n.isWebGL2FeatureEnabled,a);case 11:o=i.sent;case 12:return i.abrupt("return",{errNo:s,rendererType:o});case 13:case"end":return i.stop()}}),i)})))()},setRWGAgent:function(e){g.A.rwgAgent=e,this.addEventListenerForRWGAgent(e)},updateQosSubscription:function(e,t,r){var n;if(!this.useWebRTCAudio||t!==N._c.AUDIO_DECODE&&t!==N._c.AUDIO_ENCODE){var i=t===N._c.VIDEO_ENCODE||t===N._c.VIDEO_DECODE;if(this.webrtcConfig.webrtcflag&&i){var a;this.wmscManager&&null!==(a=this.wmscManager)&&void 0!==a&&a.isJoinRWGSuccess?this.wmscManager.updateQosSubscription(e,t,r):this.webrtcConfig.subscribeQosParamsData[t]=[e,t,r]}else{var o=!0;this.isSupportVideoShare&&(t==N._c.SHARING_DECODE&&(t=N._c.VIDEO_DECODE,o=!1),t==N._c.SHARING_ENCODE&&(t=N._c.VIDEO_ENCODE,o=!1));var s={enable:e,workerType:t,pollingInterval:r,isVideo:o};_.pushMessageToWorker(t,s,hr.xC,!1,this.isLSSPlayer)}}else null===(n=this.webrtcAudio)||void 0===n||n.updateQos({enable:e,workerType:t,pollingInterval:r})},addEventListenerForRWGAgent:function(e){e.on("message",this.rwgAgentMessageListenerWrapper)},rwgAgentMessageListener:function(e){if("string"==typeof e.data){var t=JSON.parse(e.data);this.isDestroy||t.evt!==p.Bse||this.setRTCPeerConnectionDatachannelAnswer(t)}},setRTCPeerConnectionDatachannelAnswer:function(e){if(e.evt===p.kqY||e.evt===p.FQb){if(Un("rwg answer",e),!e.answer)return;switch(e.answer.type){case N.wd.ZOOM_CONNECTION_VIDEO:E.A.trigger(p.gh2.ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT,e);break;case N.wd.ZOOM_CONNECTION_AUDIO:E.A.trigger(p.gh2.ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT,e)}}},initVideoDataChannel:function(e,t,r){var n=this;return H(O().mark((function r(){var i,a,o;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if((null===(i=n.videoDataChannel)||void 0===i?void 0:i.connectionID)!=e){r.next=2;break}return r.abrupt("return",void(t&&n.videoDataChannel.checkEmptyUserIdAndResendMonitor(t)));case 2:n.isInitVideoDataChannel=!1,n.videoDataChannel&&(n.videoDataChannel.forceClose(),m.Ay.error("video datachannel cid changed")),n.videoDataChannel=null,K.A.add_monitor("INITVDC"),Un("initVideoDataChannel",e),a=new Z(n.netThreadMgr,N.Xt.VIDEO,n.isLSSPlayer,n.mediaParams.udpPolicy,n.mediaParams.enableTCP),h.Ay.browser.isFirefox?a.delaycloseTimeout=15e3:a.delaycloseTimeout=5e3,a.setUserid(t),Un("rtc",a),o=n,a.onConnectionCreated(function(){var e=H(O().mark((function e(t){var r,n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.localDescription,Un("localDesc",r),!o.isDestroy){e.next=3;break}return e.abrupt("return");case 3:return g.A.sendMessageToRwg(p.yJV,{evt:p.qw$,offer:{sdp:r.sdp,type:N.wd.ZOOM_CONNECTION_VIDEO}},!1),e.next=6,a.waitForAnswerFromRWG(p.gh2.ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT);case 6:if(n=e.sent,Un("jsEvent.PUBSUB_EVT.ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT",n),t==a.rtcPeerConnection&&!a.isDestroyed()){e.next=9;break}return e.abrupt("return");case 9:a.setRemoteDescription(n.answer),a.closeIfTimeout(),i=n.answer.sdp.match(/a=candidate:.+/)[0],Un("received candidate",i),i=i.replace(/^a=/,""),a.addIceCandidate(i),a.onDataChannelOpen((function(){})),a.onDataChannelClose((function(){_.CloseMediaNetSessionToRwg(N.wd.ZOOM_CONNECTION_VIDEO,N.oB.NET_DATACHANNEL)}));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.initConnection(e).catch((function(e){Un.warn("initConnection",e),K.A.add_monitor("INITVDCERR",e.message)})),n.videoDataChannel=a;case 7:case"end":return r.stop()}}),r)})))()},initAudioDataChannel:function(e,t){var r=this;return H(O().mark((function n(){var i,a,o,s;return O().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((null===(i=r.audioDataChannel)||void 0===i?void 0:i.connectionID)!=e){n.next=2;break}return n.abrupt("return",void(t&&r.audioDataChannel.checkEmptyUserIdAndResendMonitor(t)));case 2:r.isInitAudioDataChannel=!1,r.audioDataChannel&&(null===(a=r.audioDataChannel)||void 0===a||a.forceClose(),m.Ay.error("audio datachannel cid changed")),r.audioDataChannel=null,K.A.add_monitor("INITADC"),Un("initAudioDataChannel",e),o=new Z(r.netThreadMgr,N.Xt.AUDIO,r.isLSSPlayer,r.mediaParams.udpPolicy,r.mediaParams.enableTCP),h.Ay.browser.isFirefox?o.delaycloseTimeout=15e3:o.delaycloseTimeout=5e3,o.setUserid(t),Un("rtc",o),s=r,o.onConnectionCreated(function(){var e=H(O().mark((function e(t){var r,n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.localDescription,!s.isDestroy){e.next=3;break}return e.abrupt("return");case 3:return Un("localDesc",r),g.A.sendMessageToRwg(p.yJV,{evt:p.qw$,offer:{sdp:r.sdp,type:N.wd.ZOOM_CONNECTION_AUDIO}},!1),e.next=6,o.waitForAnswerFromRWG(p.gh2.ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT);case 6:if(n=e.sent,Un("answer",n),t==o.rtcPeerConnection&&!o.isDestroyed()){e.next=9;break}return e.abrupt("return");case 9:o.setRemoteDescription(n.answer),o.closeIfTimeout(),i=n.answer.sdp.match(/a=candidate:.+/)[0],Un("received candidate",i),i=i.replace(/^a=/,""),o.addIceCandidate(i),o.onDataChannelOpen((function(){})),o.onDataChannelClose((function(){_.CloseMediaNetSessionToRwg(N.wd.ZOOM_CONNECTION_AUDIO,N.oB.NET_DATACHANNEL)}));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o.initConnection(e,"ZoomWebclientAudioDataChannel").catch((function(e){Un.warn("initConnection",e),K.A.add_monitor("INITADCERR",e.message)})),r.audioDataChannel=o;case 7:case"end":return n.stop()}}),n)})))()},init_Notify_APPUI:function(e,t){var r=_.MEDIA_INIT_SUCCESS_CALLBACK_METADATA[t],n=e?r.success:r.fail;g.A.Notify_APPUI(n,r.callbackDataValue)},_setWebtransportEnable:function(e){var t=e.enable,r=e.webtransportPort;t?(h.I4.setIsSupportWebtransport(!0),g.A.webtransportPort=r||8802):h.I4.setIsSupportWebtransport(!1)},_previewInitWebtransport:function(e){var t=this,r=e.conId,n=e.meetingNumber,i=e.rwgHost,a=e.webtransportPort,o=e.workType;if(this._setWebtransportEnable({enable:!0,webtransportPort:a}),h.I4.getIsSupportWebtransport()){var s=o===N._c.AUDIO_ENCODE,u=o===N._c.AUDIO_DECODE,c=o===N._c.VIDEO_ENCODE,d=o===N._c.VIDEO_DECODE,l=s||u,f=l?"a":"v",p=s||c?2:1,v="https://".concat(i,":").concat(g.A.webtransportPort,"/wc/media/").concat(n,"?type=").concat(f,"&cid=").concat(r),m="".concat(v,"&mode=").concat(p);l?_.Set_Audio_Web_Transport_Ip_Address(v):_.Set_Video_Web_Transport_Ip_Address(v);var y=g.A.SPECIAL_ID,S="",A=null;s?(S="localAudioEncMGR",A=_.preserveMessageController.nameMap.CREATE_AUDIO_ENCODE_HANDLE_SUCCESS):u?(S="localAudioDecMGR",A=_.preserveMessageController.nameMap.CREATE_AUDIO_DECODE_HANDLE_SUCCESS):c?(S="localVideoEncMGR",A=_.preserveMessageController.nameMap.CREATE_VIDEO_ENCODE_HANDLE_SUCCESS):d&&(S="localVideoDecMGR",A=_.preserveMessageController.nameMap.CREATE_VIDEO_DECODE_HANDLE_SUCCESS);var b=g.A[S]&&g.A[S].map.get(y);b?b.postMessage({command:hr.vv,webtransportURL:m,_id:this._id}):_.preserveMessageController.enqueueMessage({name:A,handler:function(){(b=g.A[S].map.get(y)).postMessage({command:hr.vv,webtransportURL:m,_id:t._id})},direction:_.preserveMessageController.direction.SDK_TO_SDK})}},_previewInitMediaWebsocket:function(e){var t=e.websocketUrl,r=e.workType,n=g.A.SPECIAL_ID,i=r===N._c.AUDIO_ENCODE,a=r===N._c.AUDIO_DECODE,o=r===N._c.VIDEO_ENCODE,s=r===N._c.VIDEO_DECODE;i||a?_.Set_Audio_WebSocket_Ip_Address(t):_.Set_Video_WebSocket_Ip_Address(t);var u="",c=null,d=0;i?(d=2,u="localAudioEncMGR",c=_.preserveMessageController.nameMap.CREATE_AUDIO_ENCODE_HANDLE_SUCCESS):a?(d=5,u="localAudioDecMGR",c=_.preserveMessageController.nameMap.CREATE_AUDIO_DECODE_HANDLE_SUCCESS):o?(d=2,u="localVideoEncMGR",c=_.preserveMessageController.nameMap.CREATE_VIDEO_ENCODE_HANDLE_SUCCESS):s&&(d=5,u="localVideoDecMGR",c=_.preserveMessageController.nameMap.CREATE_VIDEO_DECODE_HANDLE_SUCCESS);var l=g.A[u]&&g.A[u].map.get(n);l?l.postMessage({command:hr.$x,websocket_ip_address:"".concat(t,"&mode=").concat(d)}):_.preserveMessageController.enqueueMessage({name:c,handler:function(){(l=g.A[u].map.get(n)).postMessage({command:hr.$x,websocket_ip_address:"".concat(t,"&mode=").concat(d)})},direction:_.preserveMessageController.direction.SDK_TO_SDK})},previewInit:function(e){var t=this;return H(O().mark((function r(){var n,i,a,o,s,u,c,d,l;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.meetingParams&&t.meetingParams.cid==e.cid||(2&e.webrtcMode||(n=i={websocketUrl:"wss://".concat(e.rwgHost,"/wc/media/").concat(e.meetingNumber,"?type=v&cid=").concat(e.cid)}),1&e.webrtcMode||(a=o={websocketUrl:"wss://".concat(e.rwgHost,"/wc/media/").concat(e.meetingNumber,"?type=a&cid=").concat(e.cid)}),t.meetingParams&&(t.meetingParams.cid=e.cid,t.meetingParams.rwgHost=e.rwgHost)),(s=!(2&e.webrtcMode||!(2&e.videoInitMode)))&&(l={conId:e.cid}),(u=!(1&e.webrtcMode||!(2&e.audioInitMode)))&&(d={conId:e.cid}),c=e.webtransportPort,t.setupLocalPreview({videoEncodeMediaWss:n,videoDecodeMediaWss:i,audioDecodeMediaWss:a,audioEncodeMediaWss:o,videoDecode:s,audioDecode:u,webtransportPort:c,audioDataChannel:d,videoDataChannel:l});case 1:case"end":return r.stop()}}),r)})))()},setupLocalPreview:function(e){var t=arguments,r=this;return H(O().mark((function n(){var i,a,o,s,u,c,d,l,f,p,v,g,y,S,A,b,E,k,C,w,T,R,I,D,M,x,P,L,V,U,F,B;return O().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=e.videoDecode,a=e.videoDataChannel,o=e.videoEncodeMediaWss,s=e.videoDecodeMediaWss,u=e.audioDecode,c=e.audioDataChannel,d=e.audioBridge,l=e.audioEncodeMediaWss,f=e.audioDecodeMediaWss,p=e.webtransportPort,v=t.length>1&&void 0!==t[1]&&t[1],_.AssertMediaSdkNotDestory(r)){n.next=3;break}return n.abrupt("return",!1);case 3:if(!i){n.next=17;break}return y=(i||{}).urlParameters,y=(null===(g=r.getFilePath)||void 0===g?void 0:g.call(r))||y,n.next=8,h.Ay.isSDKSupportMultiThread();case 8:return S=n.sent,n.next=11,h.Ay.isSDKSupportSIMD();case 11:return A=n.sent,b=A&&S,n.next=15,r.onRendererTypeSelected();case 15:(E={}).rendererType=r.rendererType,r.isSupportVideoShare&=b,r.isSupportVideoShare?(E.workerJsFileUrl=y.vsmiworkerpath,E.workerWasmFileUrl=y.videoMSIMDWasm):b?(E.workerJsFileUrl=y.videoMSIMDWorkerPath,E.workerWasmFileUrl=y.videoMSIMDWasm):S?(E.workerJsFileUrl=y.videoMtWorkerPath,E.workerWasmFileUrl=y.videoMtWasm):A?(E.workerJsFileUrl=y.videoSIMDWorkerPath,E.workerWasmFileUrl=y.videoSIMDWasm):(E.workerJsFileUrl=y.videoWorkerPath,E.workerWasmFileUrl=y.videoWasm),E.integrityHelper=new h.gP(E.workerJsFileUrl,r.lateLoadedAssetsHash),_.previewController.resetVideoDecode(!0),_.initVideoDecode(E,r);case 17:if(a&&(v||r.hadsetpropsbeforeinit)&&(k=a.conId,C=a.userid,r.initVideoDataChannel(k,C)),o&&(w=o.websocketUrl,r._previewInitMediaWebsocket({websocketUrl:w,workType:N._c.VIDEO_ENCODE})),s&&(T=s.websocketUrl,r._previewInitMediaWebsocket({websocketUrl:T,workType:N._c.VIDEO_DECODE})),p&&(R=r.meetingParams,I=R.meetingNumber,D=R.rwgHost,M=R.cid,r._previewInitWebtransport({cid:M,meetingNumber:I,rwgHost:D,webtransportPort:p,workType:N._c.VIDEO_ENCODE}),r._previewInitWebtransport({cid:M,meetingNumber:I,rwgHost:D,webtransportPort:p,workType:N._c.VIDEO_DECODE}),r._previewInitWebtransport({cid:M,meetingNumber:I,rwgHost:D,webtransportPort:p,workType:N._c.AUDIO_ENCODE}),r._previewInitWebtransport({cid:M,meetingNumber:I,rwgHost:D,webtransportPort:p,workType:N._c.AUDIO_DECODE})),!u){n.next=35;break}return P=(u||{}).urlParameters,P=(null===(x=r.getFilePath)||void 0===x?void 0:x.call(r))||P,L={},n.next=27,h.Ay.isSDKSupportSIMD();case 27:if(!n.sent){n.next=31;break}L.workerJsFileUrl=P.audioSIMDWorkletPath,L.workerWasmFileUrl=P.audioSIMDWasm,n.next=32;break;case 31:L.workerJsFileUrl=P.audioWorkerPath,L.workerWasmFileUrl=P.audioWasm;case 32:L.integrityHelper=new h.gP(L.workerJsFileUrl,r.lateLoadedAssetsHash),_.previewController.resetAudioDecode(!0),_.initAudioDecode(L,r);case 35:if(c&&(v||r.hadsetpropsbeforeinit)&&(V=c.conId,U=c.userid,r.initAudioDataChannel(V,U)),!d){n.next=42;break}if(r.useWebRTCAudio=!0,h.Ay.isSupportPeerConnection()){n.next=39;break}return n.abrupt("return",void m.Ay.error("no support peer connection"));case 39:return n.next=41,r.initWebRTCAudioInstance(Ln({},d));case 41:Vn.webrtcAudio=r.webrtcAudio;case 42:l&&(F=l.websocketUrl,r._previewInitMediaWebsocket({websocketUrl:F,workType:N._c.AUDIO_ENCODE})),f&&(B=f.websocketUrl,r._previewInitMediaWebsocket({websocketUrl:B,workType:N._c.AUDIO_DECODE})),v||r.hadsetpropsbeforeinit||m.Ay.directReport("previewinit before setprops");case 45:case"end":return n.stop()}}),n)})))()},previewUnInitRtcConnection:function(){var e=this;K.A.add_monitor("REINITRTC");try{var t,r;null===(t=this.videoDataChannel)||void 0===t||t.forceClose(),null===(r=this.audioDataChannel)||void 0===r||r.forceClose()}catch(e){Un.error("clear rtcPeerConnectionList err",e)}this.webrtcAudio&&(this.webrtcAudio.destroy(!1),this.webrtcAudio=null,Vn.webrtcAudio=null);var n=g.A.SPECIAL_ID;[g.A.localVideoEncMGR&&g.A.localVideoEncMGR.map.get(n),g.A.localVideoDecMGR&&g.A.localVideoDecMGR.map.get(n),g.A.localAudioEncMGR&&g.A.localAudioEncMGR.map.get(n),g.A.localAudioDecMGR&&g.A.localAudioDecMGR.map.get(n)].forEach((function(t){t&&(t.postMessage({command:hr.HG}),t.postMessage({command:hr.$G,_id:e._id}))}))},doesSafariSupportWebcodec:function(){return!h.Ay.isMacIntelSafari()&&h.Ay.isAppleBrowserVersionHigherThan("17.5")&&g.A.enableSafariHWCodec},_enableHardWareDecode:function(){return!(g.A.disableHWCodec&z.ww)&&(h.Ay.isAndroidBrowser()?h.Ay.isChromeVersionHigherThan(111)&&g.A.enableAndroidHWDec:h.Ay.isChromiumVersionHigherThan(95)||this.doesSafariSupportWebcodec())},_checkHardwareEncode:function(){return H(O().mark((function e(){var t,r,n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g.A.HWEncEnableL1T1&vr.n.HW_ENC_ENABLE_L1T1.candidates.ALL||h.Ay.isAndroidBrowser()&&g.A.HWEncEnableL1T1&vr.n.HW_ENC_ENABLE_L1T1.candidates.ANDROID||h.Ay.isChromeOS()&&g.A.HWEncEnableL1T1&vr.n.HW_ENC_ENABLE_L1T1.candidates.CHROMEOS){e.next=5;break}return e.next=3,h.Ay.IsSupportVideoEncodeHardwareAcceleration(z.gg[0]);case 3:return t=e.sent,e.abrupt("return",(h.Ay.canReportHWEncConfig()&&(g.A.hwEncAddConIdx=0,m.Ay.directReport("_checkHardwareEncode: config=0, support="+t),h.Ay.didReportHWEncConfig()),t));case 5:r=0;case 6:if(!(r<z.gg.length)){e.next=15;break}return e.next=9,h.Ay.IsSupportVideoEncodeHardwareAcceleration(z.gg[r]);case 9:if(!(n=e.sent)){e.next=12;break}return e.abrupt("return",(g.A.hwEncAddConIdx=r,g.A.hwEncAdditionalConfig=z.gg[r],h.Ay.canReportHWEncConfig()&&(m.Ay.directReport("_checkHardwareEncode: config="+r+", support="+n),h.Ay.didReportHWEncConfig()),!0));case 12:r++,e.next=6;break;case 15:return e.abrupt("return",(h.Ay.canReportHWEncConfig()&&(m.Ay.directReport("_checkHardwareEncode: config="+g.A.hwEncAddConIdx+", support="+!1),h.Ay.didReportHWEncConfig()),!1));case 16:case"end":return e.stop()}}),e)})))()},initVideoEncode:function(){var e=arguments,t=this;return H(O().mark((function r(){var n,i,a,o,s,c,d,l,f,p,v,m,y,S,A,b,E,k,C,w,T,R,I,D,M,x,P,L,V,U,F,B,W,G,H,j,q,Y;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=e.length>0&&void 0!==e[0]?e[0]:{},o="",s=t.mediaParams.videoDecodeThreadNum,c=t.platformMode.isMSTF,d=t.mediaParams.isEnableHD,l=t.mediaParams.isEnableHW,f=a.wasmFlag,p=g.A.enable360pHWEnc,v=t.meetingParams,m=v.isPreviewMode,y=v.meetingNumber,S=v.rwgHost,A=v.userId,b=v.cid,E=v.webrtcMode,k="wss://".concat(S,"/wc/media/").concat(y,"?type=v&cid=").concat(b),(h.Ay.isAndroidBrowser()&&!h.Ay.isMTRAndroid()&&!h.Ay.isGoogleMeetAndroid()||h.Ay.isIphoneOrIpadBrowser())&&(p=!0,void 0===l&&(l=!0)),h.Ay.isAndroidBrowser()&&!h.Ay.isAndroidIntegrationWithSAB()?t.platformType=z.u7.ANDROID:h.Ay.isIphoneOrIpadBrowser()&&(t.platformType=z.u7.IPHONE),s=(0,h.OC)(),t.userId=A,_.AssertMediaSdkNotDestory(t)){r.next=4;break}return r.abrupt("return",!1);case 4:if(K.A.add_monitor("INITVE-".concat(m)),!t.webrtcConfig.webrtcflag||f){r.next=6;break}return r.abrupt("return",(t.initVEPara=a,t.resolveVEwebrtcpromise(!0),K.A.add_monitor("WMSC_INITVE"),t._initWMSC({rwgHost:S,cid:b,meetingNumber:y,workerType:N._c.VIDEO_ENCODE,userId:A,webrtcMode:E}).catch((function(){}))));case 6:return t.setMultiView(s,g.A.enableMultiDecodeVideoWithoutSAB),Un("initVideoEncode"),Ze.A.setUserId(A),_.previewController.resetVideoEncode(m),r.next=12,h.Ay.is32bitChrome();case 12:return t.is32bitbrowser=r.sent,r.next=15,h.Ay.isSDKSupportMultiThread();case 15:return C=r.sent,h.I4.setIsSupportVirtualBackground(!t.isTeslaMode&&!h.Ay.isAndroidBrowser()&&!h.Ay.isIphoneOrIpadBrowser()&&!c&&(C||g.A.enableVirtualBackgroundWithoutSAB)),(w=h.I4.getIsSupportVirtualBackground()&&!t.webrtcConfig.webrtcflag)&&t.vbResource&&_.prepareVBfile(t.vbResource),r.next=21,h.Ay.isSDKSupportSIMD();case 21:if(T=r.sent,R=T&&C,I={},D=!1,M=h.Ay.graphicName,x=!!M&&M.includes("amd"),t.isAppleGraphic=!!M&&(M.includes("apple m1")||M.includes("apple m2")),r.t1=h.Ay.isIphoneOrIpadBrowser()||h.Ay.isIpadOS()||navigator.hardwareConcurrency&&navigator.hardwareConcurrency>7,r.t1){r.next=42;break}return r.next=32,h.Ay.VP9MachineDetect();case 32:if(r.t4=r.sent,!r.t4){r.next=35;break}r.t4=x;case 35:if(r.t3=r.t4,!r.t3){r.next=38;break}r.t3=navigator.hardwareConcurrency;case 38:if(r.t2=r.t3,!r.t2){r.next=41;break}r.t2=navigator.hardwareConcurrency>=4;case 41:r.t1=r.t2;case 42:if(r.t0=r.t1,!r.t0){r.next=45;break}r.t0=d;case 45:if(r.t5=r.t0,!r.t5){r.next=48;break}D=!0;case 48:if((h.Ay.isIphoneOrIpadSafari()&&!h.Ay.isSupportVideoFrame()||h.Ay.isAndroidBrowser()&&(h.Ay.isAndroidVersionLessEqual(10)||h.Ay.isAndroidIntegrationWithSAB()))&&(D=!1),t.isSupportVideoShare&=R,K.A.add_monitor("isMT: "+C),K.A.add_monitor("isenbaleHD: "+d),K.A.add_monitor("ENABLE720:"+D),K.A.add_monitor("ISVSV:"+t.isSupportVideoShare),K.A.add_monitor("graphicname: "+M),t.is32bitbrowser&&K.A.add_monitor("is32chrome: "+t.is32bitbrowser),P=!(g.A.disableHWCodec&z.mV),L=P&&l,!(C&&(d||p)&&(t.isSupportMediaStreamTrackProcessor&&h.Ay.isChromiumVersionHigherThan(95)&&(!h.Ay.isAndroidBrowser()||g.A.enableAndroidHWEnc)||t.doesSafariSupportWebcodec())&&t.isWebCodecEncoderOnWhitelist)){r.next=67;break}if(r.t6=P,!r.t6){r.next=63;break}return r.next=62,t._checkHardwareEncode();case 62:r.t6=r.sent;case 63:t.videoencodehardwareflag=r.t6,l=t.videoencodehardwareflag,r.next=68;break;case 67:t.videoencodehardwareflag=!1,l=!1;case 68:if(K.A.add_monitor("EOWL:"+t.isWebCodecEncoderOnWhitelist),K.A.add_monitor("VIHD:"+t.videoencodehardwareflag),K.A.add_monitor("enableHW: "+l),K.A.add_monitor("L1T2: "+g.A.hwEncAddConIdx),o=(null===(n=t.getFilePath)||void 0===n?void 0:n.call(t))||o,t.isSupportVideoShare?(I.workerJsFileUrl=o.vsmiworkerpath,I.workerWasmFileUrl=o.videoMSIMDWasm):R?(I.workerJsFileUrl=o.videoMSIMDWorkerPath,I.workerWasmFileUrl=o.videoMSIMDWasm):C?(I.workerJsFileUrl=o.videoMtWorkerPath,I.workerWasmFileUrl=o.videoMtWasm):T?(I.workerJsFileUrl=o.videoSIMDWorkerPath,I.workerWasmFileUrl=o.videoSIMDWasm):(I.workerJsFileUrl=o.videoWorkerPath,I.workerWasmFileUrl=o.videoWasm),I.integrityHelper=new h.gP(I.workerJsFileUrl,t.lateLoadedAssetsHash),m){r.next=78;break}V=t.cid=new(u())(k).searchParams.get("cid"),U=new(u())(k).host,h.I4.getIsSupportWebtransport()&&_.Set_Video_Web_Transport_Ip_Address("https://".concat(U,":").concat(g.A.webtransportPort,"/wc/media/").concat(y,"?type=v&cid=").concat(V)),t.setupLocalPreview({videoDataChannel:{conId:V,userid:A}},!0);case 78:return F=1,B=!1,W=!1,(G=w&&C)&&l?(F=3,B=!0,W=!!L):G||l?(F=2,l&&(B=!0,W=!!L)):(t.isSupportVideoShare||C)&&(F=2),H=B&&W&&D,h.Ay.set720pcapacity(H),K.A.add_monitor("CAPTURE720:"+H),K.A.add_monitor("VETNum:"+F),W=W&&(!t.isAppleGraphic||h.Ay.isChromiumVersionHigherThan(111)&&(!h.Ay.isAndroidBrowser()||g.A.enableAndroidHWEnc)||t.doesSafariSupportWebcodec()),r.next=88,t.onRendererTypeSelected();case 88:return K.A.add_monitor("SupportWebCodecEncode: "+W),j={log:!1,confId:A,meetingid:"",meetingnumb:y,videodecodethreadnumb:s,isSupportMultiThread:C,videoencodethreadnumb:F,isSupportVirtualBackground:w,isSupportWebCodecEnocde:B,initWebCodecFlag:W,is360penablehwenc:p,enable720p:D,platformType:t.platformType,rendererType:t.rendererType,IsRenderInWorker:t.checkIsRenderInWorker()&&!h.I4.getIsRenderSelfVideoInEncodeWorker(!0),webrtcvideo:t.webrtcConfig.webrtcflag,MaskFlag:!!g.A.rwgAgent,isSafari:null===(i=h.Ay.browser)||void 0===i?void 0:i.isSafari},r.t7=console,r.next=93,h.Ay.VP9MachineDetect();case 93:if(r.t8=r.sent,r.t9=h.Ay.isAMDGraphic(),r.t10=h.Ay.isGraphicShouldUseHardwareAccelerationDecode(),r.t11="isenbaleHD:"+d+" enable720p?:",r.t12=D,r.t13=H,r.t7.log.call(r.t7,"VP9?:",r.t8,"AMD?:",r.t9,"AMDdecodecheck:",r.t10,r.t11,r.t12,"capacityfor720:",r.t13),_.setVideoEngineInitProperties(k,j),_.AssertMediaSdkNotDestory(t)){r.next=103;break}return r.abrupt("return",!1);case 103:return r.next=105,_.initVideoEncode(I,t);case 105:if(g.A.extVBPort&&t.addVbReceiver(g.A.extVBPort),!m&&!t.isDestroy){r.next=108;break}return r.abrupt("return");case 108:return q=t,t.allpromises.push(g.A.videoInitInstance.initSuccessPromise),Y=null,t.bVideoDecodeUsingSAB&&!t.videoEncodeRingBuffer&&(C?(Y=!0,t.videoEncodeRingBuffer=!0):(Y=Ke.N6.getStorageForCapacity(),t.videoEncodeRingBuffer=Y)),r.next=114,g.A.videoInitInstance.initSuccessPromise.then((function(e){return!!_.AssertMediaSdkNotDestory(q)&&(e&&t.bVideoEncodeUsingSAB&&Y&&_.pushMessageToWorker(N._c.VIDEO_ENCODE,{interval:t.bVideoEncodeMainThreadConsumerIntervalEnable,data:C?null:{buffer:Y,offset:0,length:Y.byteLength}},"VIDEO_ENCODE_SAB",!1,!0),e)})).then((function(e){return K.A.add_monitor("INITVERET-".concat(q._id,"-").concat(e&&!q.isDestroy)),!!_.AssertMediaSdkNotDestory(q)&&(f||t.init_Notify_APPUI(e,N._c.VIDEO_ENCODE),_.preserveMessageController.subscribeMessage(_.preserveMessageController.nameMap.INIT_VIDEO_ENCODE_SUCCESS),_.setCachedUserNodeListToWorker(N._c.VIDEO_ENCODE),q.waitingVcChannelReady&&q.addChannelForVideo(),e)}));case 114:return r.abrupt("return",r.sent);case 115:case"end":return r.stop()}}),r)})))()},_initWMSC:function(e){var t=this;return H(O().mark((function r(){var n;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=new Date,r.abrupt("return",(0,h.DR)().then(function(){var r=H(O().mark((function r(i){var a,o,s,u,c,d,l,f,p,v,g,S,A,b,E,k;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=i.WMSCManager,t.webrtcConfig.currentReloadTimes=0,o=e.rwgHost,s=e.cid,u=e.meetingNumber,c=e.workerType,d=e.userId,l=e.webrtcMode,s&&u&&!t.isDestroy){r.next=6;break}return f="WMSC_Stop_Init: ".concat(!!s,"|").concat(!!u,"|").concat(t.isDestroy),r.abrupt("return",(K.A.add_monitor(f),Promise.reject(f)));case 6:if(p=function(){var e=H(O().mark((function e(){var r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c){e.next=2;break}return e.abrupt("return");case 2:if(c!==N._c.AUDIO_DECODE&&c!==N._c.AUDIO_ENCODE){e.next=6;break}return e.next=5,t.wmscManager.waitInitAudioSuccess();case 5:return e.abrupt("return",void t.init_Notify_APPUI(!0,c));case 6:r=w(w({},N._c.VIDEO_ENCODE,_.preserveMessageController.nameMap.INIT_VIDEO_ENCODE_SUCCESS),N._c.VIDEO_DECODE,_.preserveMessageController.nameMap.INIT_VIDEO_DECODE_SUCCESS),t.init_Notify_APPUI(!0,c),_.preserveMessageController.subscribeMessage(r[c]),K.A.add_monitor("WMSC_".concat(r[c]));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),!t.isDestroy){r.next=11;break}return null===(v=t.wmscManager)||void 0===v||v.destroy(),g="WMSC_Destory_Init: ".concat(t.isDestroy),r.abrupt("return",(K.A.add_monitor(g),Promise.reject(g)));case 11:if(!t.wmscManager||t.wmscManager.isDestroyed()||t.wmscManager.getConnectionId()!==s?(t.wmscManager&&t.wmscManager.getConnectionId()!==s&&(m.Ay.error("WMSC_CID_Change: ".concat(t.wmscManager.getConnectionId(),"|").concat(s)),t.wmscManager.destroy()),S=new Date,K.A.add_monitor("WMSC_Load_Time: ".concat(S-n)),A=h.Ay.isWebRTCAudio2_0(t.mediaFeatureOptions,t.mid,!0,t.webrtcAudio2EnabledOnFT,t.audioABTestStrategy),b=l&(A?3:2),E="wss://".concat(o,"/wc/media/").concat(u,"?type=v&cid=").concat(s,"&mode=16"),k="WMSC_WSS_Init_Para: rwgHost:".concat(o,"|cid: ").concat(s,"|webrtcMode:").concat(l,"|useWebRTCAudio2_0:").concat(A,"|newMode:").concat(b),K.A.add_monitor(k),t.wmscManager=new a({webRTCWebSocketUrl:E,confId:s,nodeId:d,hdVideoEnabled:t.isVideoHD,mediaStreamController:Vn,iceServers:t.iceServers,videoCodecConfig:t.webrtcVideoCodecConfig,webrtcMode:b,requestHandler:t.wmscRequestHandler.bind(t)})):t.wmscManager.setNodeId(d),t.wmscManager.isJoinRWGSuccess){r.next=14;break}return r.abrupt("return",t.wmscManager.waitJoinRWGSuccess().then(H(O().mark((function e(){var r,n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p();case 2:if("{}"===JSON.stringify(t.webrtcConfig.subscribeQosParamsData)){e.next=6;break}for(r in K.A.add_monitor("WMSC_Update_Qos_Subscription_Async"),t.webrtcConfig.subscribeQosParamsData)i=t.webrtcConfig.subscribeQosParamsData[r],(n=t.wmscManager).updateQosSubscription.apply(n,y(i));t.webrtcConfig.subscribeQosParamsData={};case 6:t.wmscManager.onActiveSpeakerChange(t.activeSpeakerSsrc);case 7:case"end":return e.stop()}}),e)})))));case 14:return r.next=16,p();case 16:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()).catch((function(r){if(m.Ay.error("WebRTC _initWMSC error:",r),"ChunkLoadError"===(null==r?void 0:r.name)){var n=t.webrtcConfig;if(n.currentReloadTimes>=n.maxReloadTimes){var i="WMSC_JS_LOAD_FAIL_FAILOVER";return m.Ay.error(i),g.A.Notify_APPUI(p.oQY),Promise.reject(i)}setTimeout((function(){return m.Ay.error("WMSCf_IMPORT_FAIL ".concat(t.webrtcConfig.currentReloadTimes),r),t.webrtcConfig.currentReloadTimes+=1,t._initWMSC(e)}),1e3)}return Promise.reject(r)})));case 2:case"end":return r.stop()}}),r)})))()},initVideoDecode:function(){var e=arguments,t=this;return H(O().mark((function r(){var n,i,a,o,s,u,c,d,l,f,p,v,y,S,A,b,E,k,C,w,T,R,I;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=e.length>0&&void 0!==e[0]?e[0]:{},a="",o=t.mediaParams.videoDecodeThreadNum,s=t.mediaParams.isEnableHW,u=i.wasmFlag,c=t.meetingParams,d=c.meetingNumber,l=c.rwgHost,f=c.userId,p=c.cid,v=c.webrtcMode,y="wss://".concat(l,"/wc/media/").concat(d,"?type=v&cid=").concat(p),(h.Ay.isAndroidBrowser()&&!h.Ay.isMTRAndroid()&&!h.Ay.isGoogleMeetAndroid()||h.Ay.isIphoneOrIpadBrowser())&&void 0===s&&(s=!0),t.userId=f,o=(0,h.OC)(),_.AssertMediaSdkNotDestory(t)){r.next=4;break}return r.abrupt("return",!1);case 4:if(S=t.platformType,h.Ay.isAndroidBrowser()&&!h.Ay.isAndroidIntegrationWithSAB()?S=z.u7.ANDROID:h.Ay.isIphoneOrIpadBrowser()&&(S=z.u7.IPHONE),A=!1,!t.webrtcConfig.webrtcflag||u){r.next=9;break}return r.abrupt("return",(K.A.add_monitor("WMSC_INITVD"),t.initVDPara=i,t.resolveVDwebrtcpromise(!0),t._initWMSC({rwgHost:l,cid:p,meetingNumber:d,workerType:N._c.VIDEO_DECODE,userId:f,webrtcMode:v}).then((function(){g.A.webrtcVideoInited=!0})).catch((function(){}))));case 9:if(t.webrtcConfig.webrtcflag||u||!g.A.webrtcVideoInited||(g.A.webrtcVideoInited=!1,A=!0),K.A.add_monitor("INITVD-".concat(t.meetingParams.isPreviewMode)),!t.meetingParams.isPreviewMode){r.next=11;break}return r.abrupt("return",void t.setupLocalPreview({videoDecode:{},videoDataChannel:{conId:p},videoDecodeMediaWss:{websocketUrl:y}}));case 11:return _.previewController.resetVideoDecode(!1),Un("initVideoDecode"),K.A.add_monitor("DOWL:"+t.isWebCodecDecoderOnWhitelist),t.setMultiView(o,g.A.enableMultiDecodeVideoWithoutSAB),o>1&&!g.A.enableMultiDecodeVideoWithoutSAB&&((0,h.uF)()||h.Ay.isWebGL2Supported(t.isWebGL2FeatureEnabled)||Ve.X.isUseSsrcStream())?t.codecDoAVSync=!0:t.codecDoAVSync=!1,r.next=18,h.Ay.is32bitChrome();case 18:return t.is32bitbrowser=r.sent,r.next=21,h.Ay.isSDKSupportMultiThread();case 21:return b=r.sent,r.next=24,h.Ay.isSDKSupportSIMD();case 24:if(E=r.sent,k=E&&b,C={},t.isEnableVideoDecodeHardWareThread=b&&t._enableHardWareDecode(),!s||!t.isEnableVideoDecodeHardWareThread){r.next=35;break}return r.next=31,h.Ay.IsSupportVideoDecodeHardwareAcceleration(g.A.enableHADecOpt);case 31:t.videodecodehardwareflag=r.sent,s=t.videodecodehardwareflag,r.next=36;break;case 35:s=!1;case 36:return t.isSupportVideoShare&=k,K.A.add_monitor("isMT:"+b),K.A.add_monitor("SIMD:"+E),K.A.add_monitor("VDHT:"+t.isEnableVideoDecodeHardWareThread),K.A.add_monitor("VDHW:"+t.videodecodehardwareflag),K.A.add_monitor("SupportWebCodecDecode:".concat(s)),a=(null===(n=t.getFilePath)||void 0===n?void 0:n.call(t))||a,t.isSupportVideoShare?(C.workerJsFileUrl=a.vsmiworkerpath,C.workerWasmFileUrl=a.videoMSIMDWasm):k?(C.workerJsFileUrl=a.videoMSIMDWorkerPath,C.workerWasmFileUrl=a.videoMSIMDWasm):b?(C.workerJsFileUrl=a.videoMtWorkerPath,C.workerWasmFileUrl=a.videoMtWasm):E?(C.workerJsFileUrl=a.videoSIMDWorkerPath,C.workerWasmFileUrl=a.videoSIMDWasm):(C.workerJsFileUrl=a.videoWorkerPath,C.workerWasmFileUrl=a.videoWasm),C.integrityHelper=new h.gP(C.workerJsFileUrl,t.lateLoadedAssetsHash),h.I4.getIsSupportWebtransport()&&_.Set_Video_Web_Transport_Ip_Address("https://".concat(l,":").concat(g.A.webtransportPort,"/wc/media/").concat(d,"?type=v&cid=").concat(p)),t.setupLocalPreview({videoDataChannel:{conId:p,userid:f}},!0),w=s&&t.isEnableVideoDecodeHardWareThread&&o>1&&navigator.hardwareConcurrency&&navigator.hardwareConcurrency>=4,h.Ay.setsub1080pcapacity(w),r.next=51,t.onRendererTypeSelected();case 51:if(T={log:!1,confId:f,meetingid:"",meetingnumb:d,videodecodethreadnumb:o,isFirefox:h.Ay.browser.isFirefox,isSupportMultiThread:b,isSupportOffscreenCanvas:t.isSupportOffscreenCanvas,isenablehw:s,isEnableVideoDecodeHardWareThread:t.isEnableVideoDecodeHardWareThread,isEnableHardWareThread:t.isEnableHardWareThread,isTeslaMode:t.isTeslaMode,logHost:t.mediaParams.logHost,hasLog:t.mediaParams.hasLog,enableTCP:t.mediaParams.enableTCP,platformType:S,rendererType:t.rendererType,isWebCodecDecoderOnWhitelist:t.isWebCodecDecoderOnWhitelist,webrtcvideo:t.webrtcConfig.webrtcflag,isLSSPlayer:t.isLSSPlayer},_.setVideoEngineInitProperties(y,T),_.AssertMediaSdkNotDestory(t)){r.next=54;break}return r.abrupt("return",!1);case 54:return r.next=56,_.initVideoDecode(C,t);case 56:if(_.AssertMediaSdkNotDestory(t)){r.next=58;break}return r.abrupt("return",!1);case 58:return R=t,t.allpromises.push(g.A.videoDecInitInstance.initSuccessPromise),I=null,t.bVideoDecodeUsingSAB&&!t.videoDecodeRingBuffer&&(b?(I=!0,t.videoDecodeRingBuffer=!0):(I=Ke.N6.getStorageForCapacity(),t.videoDecodeRingBuffer=I)),r.next=64,g.A.videoDecInitInstance.initSuccessPromise.then(function(){var e=H(O().mark((function e(r){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!!_.AssertMediaSdkNotDestory(R)&&(r&&t.bVideoDecodeUsingSAB&&I&&_.pushMessageToWorker(N._c.VIDEO_DECODE,b?null:{buffer:I,offset:0,length:I.byteLength},"VIDEO_DECODE_SAB_FROM_DATACHANNEL",!1,!0),r));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){return K.A.add_monitor("INITVDRET-".concat(R._id,"-").concat(e&&!R.isDestroy)),!!_.AssertMediaSdkNotDestory(R)&&(u||t.init_Notify_APPUI(e,N._c.VIDEO_DECODE),_.preserveMessageController.subscribeMessage(_.preserveMessageController.nameMap.INIT_VIDEO_DECODE_SUCCESS),_.setCachedUserNodeListToWorker(N._c.VIDEO_DECODE),R.waitingVcChannelReady&&R.addChannelForVideo(),e&&A&&m.Ay.directReport("video fallback to wasm successfully"),R.registerMeshNote(),e)}));case 64:return r.abrupt("return",r.sent);case 65:case"end":return r.stop()}}),r)})))()},initAudioEncode:function(){var e=this;return H(O().mark((function t(){var r,n,i,a,o,s,u,c,d,l,f,p,v,m,y,S,A;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.meetingParams,i=n.isPreviewMode,a=n.meetingNumber,o=n.rwgHost,s=n.userId,u=n.cid,c=n.webrtcMode,d=n.meetingId,l=n.abToken,!(c&z.h)){t.next=3;break}return t.abrupt("return",void e.setupLocalPreview({audioBridge:{abToken:l,rwgHost:o,meetingNumber:a,userId:s,cid:u,webrtcMode:c,workerType:N._c.AUDIO_ENCODE}}));case 3:if(f="wss://".concat(o,"/wc/media/").concat(a,"?type=a&cid=").concat(u),e.userId=s,Un("initAudioEncode"),_.AssertMediaSdkNotDestory(e)){t.next=6;break}return t.abrupt("return",!1);case 6:return K.A.add_monitor("INITAE"),Ze.A.setUserId(s),_.previewController.resetAudioEncode(i),t.next=11,h.Ay.is32bitChrome();case 11:return e.is32bitbrowser=t.sent,p={},t.next=15,h.Ay.isSDKSupportSIMD();case 15:if(v=t.sent,m=null===(r=e.getFilePath)||void 0===r?void 0:r.call(e),v?(p.workerJsFileUrl=m.audioSIMDWorkletPath,p.workerWasmFileUrl=m.audioSIMDWasm):(p.workerJsFileUrl=m.audioWorkerPath,p.workerWasmFileUrl=m.audioWasm),p.integrityHelper=new h.gP(p.workerJsFileUrl,e.lateLoadedAssetsHash),i||(h.I4.getIsSupportWebtransport()&&_.Set_Audio_Web_Transport_Ip_Address("https://".concat(o,":").concat(g.A.webtransportPort,"/wc/media/").concat(a,"?type=a&cid=").concat(u)),e.setupLocalPreview({audioDataChannel:{conId:u,userid:s}},!0)),e.audioCtx||(e.audioCtx=(0,h.Bw)()),y={sampleRate:e.audioCtx.sampleRate,userId:s,meetingId:d,meetingNumber:a},_.setAudioEngineInitProperties(f,y),_.AssertMediaSdkNotDestory(e)){t.next=21;break}return t.abrupt("return",!1);case 21:return t.next=23,_.initAudioEncode(p,e);case 23:if(!i&&!e.isDestroy){t.next=25;break}return t.abrupt("return");case 25:return S=e,e.allpromises.push(g.A.audioEncodeInitInstance.initSuccessPromise),A=null,e.bAudioDecodeUsingSAB&&!e.audioEncodeRingBuffer&&(A=Ke.N6.getStorageForCapacity(100),e.audioEncodeRingBuffer=A),t.next=31,g.A.audioEncodeInitInstance.initSuccessPromise.then((function(t){return!S.isDestroy&&(t&&e.bAudioEncodeUsingSAB&&A&&_.pushMessageToWorker(N._c.AUDIO_ENCODE,{buffer:A,offset:0,length:A.byteLength,bAudioEncodeMainThreadConsumerIntervalEnable:!1},"audioEncodeSAB",!1,!0),t)})).then((function(t){return K.A.add_monitor("INITAERET-".concat(S._id,"-").concat(t&&!S.isDestroy)),!!_.AssertMediaSdkNotDestory(S)&&(e.init_Notify_APPUI(t,N._c.AUDIO_ENCODE),_.setCachedUserNodeListToWorker(N._c.AUDIO_ENCODE),t)}));case 31:return t.abrupt("return",t.sent);case 32:case"end":return t.stop()}}),t)})))()},initAudioDecode:function(){var e=this;return H(O().mark((function t(){var r,n,i,a,o,s,u,c,d,l,f,p,v,y,S,A,b,E;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.meetingParams,i=n.meetingNumber,a=n.rwgHost,o=n.userId,s=n.cid,u=n.webrtcMode,c=n.meetingId,d=n.isPreviewMode,l=n.abToken,!(u&z.h)){t.next=3;break}return t.abrupt("return",void e.setupLocalPreview({audioBridge:{abToken:l,rwgHost:a,meetingNumber:i,userId:o,cid:s,webrtcMode:u,workerType:N._c.AUDIO_DECODE}}));case 3:if(f="wss://".concat(a,"/wc/media/").concat(i,"?type=a&cid=").concat(s),e.userId=o,_.AssertMediaSdkNotDestory(e)){t.next=6;break}return t.abrupt("return",!1);case 6:if(K.A.add_monitor("INITAD-".concat(d)),!d){t.next=8;break}return t.abrupt("return",void e.setupLocalPreview({audioDecode:{},audioDataChannel:{conId:s},audioDecodeMediaWss:{websocketUrl:f}}));case 8:return _.previewController.resetAudioDecode(!1),Un("initAudioDecode"),Ze.A.setUserId(o),p=!1,"WEBRTC 1.0"!==g.A.audioSolution&&"WEBRTC 2.0"!==g.A.audioSolution||(p=!0),g.A.audioSolution="WASM",t.next=14,h.Ay.is32bitChrome();case 14:return e.is32bitbrowser=t.sent,v={},y=null===(r=e.getFilePath)||void 0===r?void 0:r.call(e),v.workerJsFileUrl=y.audioWorkerPath,v.workerWasmFileUrl=y.audioWasm,h.I4.getIsSupportWebtransport()&&_.Set_Audio_Web_Transport_Ip_Address("https://".concat(a,":").concat(g.A.webtransportPort,"/wc/media/").concat(i,"?type=a&cid=").concat(s)),e.setupLocalPreview({audioDataChannel:{conId:s,userid:o}},!0),t.next=20,h.Ay.isSDKSupportMultiThread();case 20:return S=t.sent,t.next=23,h.Ay.isSDKSupportSIMD();case 23:if(!t.sent){t.next=27;break}v.workerJsFileUrl=y.audioSIMDWorkletPath,v.workerWasmFileUrl=y.audioSIMDWasm,t.next=28;break;case 27:v.workerJsFileUrl=y.audioWorkerPath,v.workerWasmFileUrl=y.audioWasm;case 28:if(v.integrityHelper=new h.gP(v.workerJsFileUrl,e.lateLoadedAssetsHash),e.audioCtx||(e.audioCtx=(0,h.Bw)(),e.isLSSPlayer&&(e.gainNode=e.audioCtx.createGain())),A={sampleRate:e.audioCtx.sampleRate,userId:o,meetingId:c,meetingNumber:i,isSupportMultiThread:S,logHost:e.mediaParams.logHost,hasLog:e.mediaParams.hasLog,enableTCP:e.mediaParams.enableTCP,isLSSPlayer:e.isLSSPlayer},_.setAudioEngineInitProperties(f,A),_.AssertMediaSdkNotDestory(e)){t.next=33;break}return t.abrupt("return",!1);case 33:return t.next=35,_.initAudioDecode(v,e);case 35:if(_.AssertMediaSdkNotDestory(e)){t.next=37;break}return t.abrupt("return",!1);case 37:return b=e,e.allpromises.push(g.A.audioDecInitInstance.initSuccessPromise),E=null,e.bAudioDecodeUsingSAB&&!e.audioDecodeRingBuffer&&(E=Ke.N6.getStorageForCapacity(100),e.audioDecodeRingBuffer=E),t.next=43,g.A.audioDecInitInstance.initSuccessPromise.then(function(){var t=H(O().mark((function t(r){return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=!b.isDestroy,!t.t0){t.next=8;break}if(K.A.add_monitor("ADIP"+!!r),t.t1=r&&e.bAudioDecodeUsingSAB&&E,!t.t1){t.next=7;break}return t.next=7,_.pushMessageToWorker(N._c.AUDIO_DECODE,{buffer:E,offset:0,length:E.byteLength},"audioDecodeSAB",!1,!0);case 7:t.t0=r;case 8:return t.abrupt("return",t.t0);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).then((function(t){return K.A.add_monitor("INITADRET-".concat(b._id,"-").concat(t&&!b.isDestroy)),!!_.AssertMediaSdkNotDestory(b)&&(t&&p&&m.Ay.directReport("fallback to wasm solution successfully"),e.init_Notify_APPUI(t,N._c.AUDIO_DECODE),_.setCachedUserNodeListToWorker(N._c.AUDIO_DECODE),e.registerMeshNote(),t)}));case 43:return t.abrupt("return",t.sent);case 44:case"end":return t.stop()}}),t)})))()},initSharingDecode:function(){var e=this;return H(O().mark((function t(){var r,n,i,a,o,s,u,c,d,l,f,p,v,m,y;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n="",i=e.meetingParams,a=i.meetingNumber,o=i.rwgHost,s=i.userId,u=i.cid,c="wss://".concat(o,"/wc/media/").concat(a,"?type=s&cid=").concat(u),_.AssertMediaSdkNotDestory(e)){t.next=4;break}return t.abrupt("return",!1);case 4:return K.A.add_monitor("INITSD"),t.next=7,h.Ay.isSDKSupportSIMD();case 7:return d=t.sent,t.next=10,h.Ay.isSDKSupportMultiThread();case 10:if(l=t.sent,f=d&&l,e.isSupportVideoShare&=f,!e.isSupportVideoShare||!e.webrtcConfig.webrtcflag){t.next=24;break}return t.prev=13,t.next=16,e.webrtcVDpromise;case 16:return e.initVDPara.wasmFlag=!0,t.next=19,e.initVideoDecode(e.initVDPara);case 19:t.next=24;break;case 21:t.prev=21,t.t0=t.catch(13),K.A.add_monitor("INITVDSDF");case 24:if(e.userId=s,e.recordSharingParamInfo(),!e.isSupportVideoShare){t.next=32;break}return e.allpromises.push(g.A.sharingDecInitInstance.socketSuccessPromise),p=e,t.next=29,g.A.sharingDecInitInstance.handlerSuccessPromise;case 29:return t.next=31,g.A.sharingDecInitInstance.socketSuccessPromise.then((function(t){return K.A.add_monitor("INITSDRET-".concat(p._id,"-").concat(t&&!p.isDestroy)),!!_.AssertMediaSdkNotDestory(p)&&(e.init_Notify_APPUI(t,N._c.SHARING_DECODE),_.setCachedUserNodeListToWorker(N._c.SHARING_DECODE),e.registerMeshNote(),t)}));case 31:return t.abrupt("return",t.sent);case 32:return t.next=34,h.Ay.is32bitChrome();case 34:return e.is32bitbrowser=t.sent,t.next=37,e.onRendererTypeSelected();case 37:if(n=(null===(r=e.getFilePath)||void 0===r?void 0:r.call(e))||n,v={},f?(v.workerJsFileUrl=n.sharingMSIMDWorkerPath,v.workerWasmFileUrl=n.videoMSIMDWasm):l?(v.workerJsFileUrl=n.sharingMtWorkerPath,v.workerWasmFileUrl=n.videoMtWasm):d?(v.workerJsFileUrl=n.sharingSIMDWorkerPath,v.workerWasmFileUrl=n.videoSIMDWasm):(v.workerJsFileUrl=n.sharingWorkerPath,v.workerWasmFileUrl=n.videoWasm),v.integrityHelper=new h.gP(v.workerJsFileUrl,e.lateLoadedAssetsHash),m={log:!1,userid:s,meetingid:"",meetingnumb:a,isSupportMultiThread:l,rendererType:e.rendererType,isWebCodecDecoderOnWhitelist:e.isWebCodecDecoderOnWhitelist},_.setSharingEngineInitProperties(c,m),_.AssertMediaSdkNotDestory(e)){t.next=43;break}return t.abrupt("return",!1);case 43:return t.next=45,_.initSharingDecode(v,e);case 45:if(_.AssertMediaSdkNotDestory(e)){t.next=47;break}return t.abrupt("return",!1);case 47:return e.allpromises.push(g.A.sharingDecInitInstance.initSuccessPromise),y=e,t.next=51,g.A.sharingDecInitInstance.initSuccessPromise.then((function(t){return K.A.add_monitor("INITSDRET-".concat(y._id,"-").concat(t&&!y.isDestroy)),!!_.AssertMediaSdkNotDestory(y)&&(e.init_Notify_APPUI(t,N._c.SHARING_DECODE),_.setCachedUserNodeListToWorker(N._c.SHARING_DECODE),e.registerMeshNote(),t)}));case 51:return t.abrupt("return",t.sent);case 52:case"end":return t.stop()}}),t,null,[[13,21]])})))()},initSharingEncode:function(){var e=this;return H(O().mark((function t(){var r,n,i,a,o,s,u,c,d,l,f,v,m,y,A;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="",i=e.meetingParams,a=i.rwgHost,o=i.meetingNumber,s=i.userId,u=i.cid,c="wss://".concat(a,"/wc/media/").concat(o,"?type=s&cid=").concat(u),K.A.add_monitor("INITSE"),t.next=5,h.Ay.isSDKSupportSIMD();case 5:return d=t.sent,t.next=8,h.Ay.isSDKSupportMultiThread();case 8:if(l=t.sent,f=d&&l,e.isSupportVideoShare&=f,!e.isSupportVideoShare||!e.webrtcConfig.webrtcflag){t.next=22;break}return t.prev=11,t.next=14,e.webrtcpromise;case 14:return e.initVEPara.wasmFlag=!0,t.next=17,e.initVideoEncode(e.initVEPara);case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(11),K.A.add_monitor("INITVESEF");case 22:if(e.userId=s,_.AssertMediaSdkNotDestory(e)){t.next=24;break}return t.abrupt("return",!1);case 24:if(!e.isSupportVideoShare){t.next=32;break}return e.allpromises.push(g.A.sharingEncInitInstance.socketSuccessPromise),v=e,t.next=29,g.A.sharingEncInitInstance.handlerSuccessPromise;case 29:return t.next=31,g.A.sharingEncInitInstance.socketSuccessPromise.then((function(t){return K.A.add_monitor("INITSERET-".concat(v._id,"-").concat(t&&!v.isDestroy)),!!_.AssertMediaSdkNotDestory(v)&&(e.init_Notify_APPUI(t,N._c.SHARING_ENCODE),_.setCachedUserNodeListToWorker(N._c.SHARING_ENCODE),h.Ay.getGpuInfo().isWebGLContextInvalid&&!Ve.X.isUseSsrcStream()&&(0,S.iK)(p.AoB,{reason:"WebGLContextInvalid"}),t)}));case 31:return t.abrupt("return",t.sent);case 32:return n=(null===(r=e.getFilePath)||void 0===r?void 0:r.call(e))||n,t.next=35,h.Ay.is32bitChrome();case 35:return e.is32bitbrowser=t.sent,t.next=38,e.onRendererTypeSelected();case 38:if(m={},f?(m.workerJsFileUrl=n.sharingMSIMDWorkerPath,m.workerWasmFileUrl=n.videoMSIMDWasm):l?(m.workerJsFileUrl=n.sharingMtWorkerPath,m.workerWasmFileUrl=n.videoMtWasm):d?(m.workerJsFileUrl=n.sharingSIMDWorkerPath,m.workerWasmFileUrl=n.videoSIMDWasm):(m.workerJsFileUrl=n.sharingWorkerPath,m.workerWasmFileUrl=n.videoWasm),m.integrityHelper=new h.gP(m.workerJsFileUrl,e.lateLoadedAssetsHash),y={log:!1,userid:s,meetingid:"",meetingnumb:o,isSupportMultiThread:l,rendererType:e.rendererType},_.setSharingEngineInitProperties(c,y),_.AssertMediaSdkNotDestory(e)){t.next=43;break}return t.abrupt("return",!1);case 43:return t.next=45,_.initSharingEncode(m,e);case 45:if(_.AssertMediaSdkNotDestory(e)){t.next=47;break}return t.abrupt("return",!1);case 47:return A=e,e.allpromises.push(g.A.sharingEncInitInstance.initSuccessPromise),t.next=51,g.A.sharingEncInitInstance.initSuccessPromise.then((function(t){return K.A.add_monitor("INITSERET-".concat(A._id,"-").concat(t&&!A.isDestroy)),!!_.AssertMediaSdkNotDestory(A)&&(e.init_Notify_APPUI(t,N._c.SHARING_ENCODE),_.setCachedUserNodeListToWorker(N._c.SHARING_ENCODE),t)}));case 51:return t.abrupt("return",t.sent);case 52:case"end":return t.stop()}}),t,null,[[11,19]])})))()},JsMediaSDK_UnInit:function(){_.Stop_Monitor(this),this.videoRenderArray.length&&this.videoRenderArray.forEach((function(e){e.display&&(e.display.cleanup(),e.display=null)})),g.A._callbackList=[],g.A._Notify_APPUI=null,(0,S._G)(null)},StartAudioMediaCapture:function(){var e=this,t=sn.draftAudioConstraints(this);Vn.startCaptureAudio({audioConstraints:t,successHandler:this.handleAudioCapture.bind(this),errorHandler:function(r){sn.checkCaptureNeedDeviceFallback(t,r)?(m.Ay.error("[Audio] checkCaptureNeedDeviceFallback, retrying..."),Vn.startCaptureAudio({audioConstraints:t,successHandler:e.handleAudioCapture.bind(e),errorHandler:e.handleAudioError.bind(e)})):e.handleAudioError(r)}})},StartDesktopMediaCapture:function(){var e=H(O().mark((function e(){var t,r,n,i,a,o,s,u,c,d,l,f,p,v,g,m,y;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.desktopSharingValue.audioOnly){e.next=12;break}return e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({audio:{deviceId:this.desktopSharingValue.deviceId?{exact:this.desktopSharingValue.deviceId}:h.Ay.browser.isChromeOrEdge?{exact:"default"}:void 0,echoCancellation:this.desktopSharingValue.echoCancellation,noiseSuppression:this.desktopSharingValue.noiseSuppression,autoGainControl:this.desktopSharingValue.autoGainControl,sampleRate:this.desktopSharingValue.sampleRate||48e3}});case 4:t=e.sent,this.handleDesktopCapture(t,!0),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.handleCaptureError(e.t0);case 11:return e.abrupt("return");case 12:if(!this.desktopSharingValue.sourceId){e.next=25;break}return r=this.desktopSharingValue.sourceId,e.prev=14,e.next=17,navigator.mediaDevices.getUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r}}});case 17:n=e.sent,this.handleDesktopCapture(n),e.next=24;break;case 21:e.prev=21,e.t1=e.catch(14),this.handleCaptureError(e.t1);case 24:return e.abrupt("return");case 25:if(i=this.handleDesktopCapture.bind(this),a=this.handleCaptureError.bind(this),!this.desktopSharingValue.share2ndCamera){e.next=32;break}return o=this.desktopSharingValue.share2ndCameraParams||{},s=o.VideoSelectValue?{exact:o.VideoSelectValue}:void 0,u=o.frameRate?{ideal:o.frameRate}:void 0,c={deviceId:s,width:o.width||640,height:o.height||360,frameRate:u},d=!1,o.AudioSelectValue&&(d={noiseSuppression:null==o?void 0:o.noiseSuppression,autoGainControl:null==o?void 0:o.autoGainControl,echoCancellation:null==o?void 0:o.echoCancellation,sampleRate:o.sampleRate||48e3,deviceId:{exact:o.AudioSelectValue}}),l={video:c,audio:d},e.abrupt("return",void navigator.mediaDevices.getUserMedia(l).then(i,a));case 32:f=this.desktopSharingValue.videoParams,p=navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints(),v=p&&!!p.displaySurface&&f&&f.displaySurface,navigator.mediaDevices.getDisplayMedia&&(g=!(!h.Ay.isSupportSharedArrayBuffer()&&!this.webrtcAudio||!this.desktopSharingValue.showShareAudioOption)&&{autoGainControl:!1,noiseSuppression:!1,echoCancellation:!h.Ay.isSupportSharingStereo()},m=this.desktopSharingValue.videoParams||!0,v&&("object"==j(m)?m.displaySurface=f.displaySurface:"boolean"==typeof m&&(m={displaySurface:f.displaySurface})),y=Ln({video:m,audio:g},this.desktopSharingValue.otherParams),navigator.mediaDevices.getDisplayMedia(y).then(i,a));case 34:case"end":return e.stop()}}),e,this,[[1,8],[14,21]])})));return function(){return e.apply(this,arguments)}}(),StartVideoMediaCapture:function(){var e=H(O().mark((function e(){var t,r,n,i,a=this,o=arguments;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this,r=o.length>0&&void 0!==o[0]&&o[0],n=this.videoCaptureValue,i={encode:this.isStartVideoCapture,preview:this.isMaskSettingOn||this.isVBSettingOn},K.A.add_monitor("STARTVIDEOMEDIA:".concat(i.encode,":").concat(i.preview)),Vn.startCaptureVideo({videoConstraints:this.videoCaptureValue?{videoSource:this.videoCaptureValue.VideoSelectValue,usingFacingMode:this.videoCaptureValue.usingFacingMode,width:this.videoCaptureValue.width,height:this.videoCaptureValue.height,pan:this.videoCaptureValue.pan,tilt:this.videoCaptureValue.tilt,zoom:this.videoCaptureValue.zoom,fps:this.videoCaptureValue.fps}:null,timeout:this.videoCaptureValue?this.videoCaptureValue.timeout:null,successHandler:function(){var e=H(O().mark((function e(t){var o,s,u,c,d,l,h,f,v,y,A;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Br.hasMediaStreamFrameProcessor()&&(Br.removeStream(),Br.setStream(t),s=Br.getStream(),Vn.processedStream=s),_.AssertMediaSdkNotDestory(a,"videocapture")){e.next=3;break}return e.abrupt("return",(Vn.enableReuseStream(!1),Vn.destoryVideoMediaStream(),m.Ay.error("VideoCaptureException successed sdkinstance has destroyed"),void K.A.add_monitor("CVSBSDKD")));case 3:if((null===(o=a.videoCaptureValue)||void 0===o?void 0:o.videoCtrl)===(null==n?void 0:n.videoCtrl)&&(a.videoCaptureValue=n),Vn.videoConstraints&&(u=Vn.videoConstraints,c=u.width,d=u.height,c&&d&&(a.videoCaptureWidth=c instanceof Object?c.ideal:c,a.videoCaptureHeight=d instanceof Object?d.ideal:d)),l=!1,e.prev=5,f=t.getVideoTracks()[0]||{},K.A.add_monitor("WMSC_Stream_Capture_Success: ".concat(null==f?void 0:f.muted,"|").concat(null==f?void 0:f.readyState,"|").concat(t.active,"|").concat(!(null===(h=a.videoCaptureValue)||void 0===h||!h.videoCtrl))),f.onended=H(O().mark((function e(){var t,r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ze.A.hasPermission("camera");case 2:if(e.sent){e.next=4;break}return e.abrupt("return",(K.A.add_monitor("VTRS:"+f.readyState+"R"),void(0,S.iK)(p.x3x,S.pg.PERMISSION_RESET)));case 4:return e.next=6,Ze.A.getDeviceListAsync();case 6:t=e.sent,r=!1,t.forEach((function(e){"videoinput"===e.kind&&e.deviceId===f.getSettings().deviceId&&(r=!0)})),r?(K.A.add_monitor("VTRS:"+f.readyState+"I"),(0,S.iK)(p.x3x,S.pg.EXCEPTION)):K.A.add_monitor("VTRS:"+f.readyState+"L"),_.Notify_Video_Encode_Thread({command:"healthCheck",op:z.FC.STOP,type:z.HX.VIDEO}),m.Ay.error("video media track ended");case 9:case"end":return e.stop()}}),e)}))),f.addEventListener("mute",H(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return K.A.add_monitor("VTMS:"+f.muted),m.Ay.directReport("NotifyUIError,event=".concat(p.tMo,",data=").concat(!!a.videoCaptureValue)),a.videoCaptureValue&&(a.videoMuteTimeoutId=setTimeout((function(){g.A.Notify_APPUI_SAFE(p.tMo),a.videoMuteTimeoutId=0}),3e3),_.Notify_Video_Encode_Thread({command:"healthCheck",op:z.FC.PAUSE,type:z.HX.VIDEO})),e.next=5,Ze.A.hasPermission("camera");case 5:if(e.t0=e.sent,e.t0){e.next=8;break}(0,S.iK)(p.ONI,S.pg.LOST_ACCESS);case 8:case"end":return e.stop()}}),e)})))),f.addEventListener("unmute",(function(){K.A.add_monitor("VTMS:"+f.muted),m.Ay.directReport("NotifyUIError,event=".concat(p.IV3)),a.webrtcConfig.webrtcflag&&a.wmscManager&&a.wmscManager.playAllVideoTag("videoTrackUnmute"),a.videoMuteTimeoutId?(clearTimeout(a.videoMuteTimeoutId),a.videoMuteTimeoutId=0):g.A.Notify_APPUI_SAFE(p.IV3),_.Notify_Video_Encode_Thread({command:"healthCheck",op:z.FC.RESUME,type:z.HX.VIDEO})})),!a.webrtcConfig.webrtcflag){e.next=23;break}if(!a.wmscManager){e.next=19;break}return r&&g.A.Notify_APPUI(p.ssE,a.userId),y=Vn.getProcessedVideoStream(),null!==(v=a.wmscManager)&&void 0!==v&&v.vbSettingVideoDom&&(a.wmscManager.vbSettingVideoDom.srcObject=y),e.next=14,a.handleWebRTCVideoStream("streamCaptureSuccess",y);case 14:return e.next=16,a.handleWebrtcVideoCapture(y);case 16:l=!0,e.next=21;break;case 19:A="WMSC_Capture_Success_Handle_Fail:".concat(!!a.wmscManager,"|").concat(a.isStartVideoCapture,"|streamCaptureSuccess"),K.A.add_monitor(A),m.Ay.error(A);case 21:e.next=26;break;case 23:return e.next=25,a.handleWasmVideoCapture(t,i);case 25:l=!0;case 26:K.A.add_monitor("STARTVIDEORET:".concat(l,"|").concat(null==f?void 0:f.muted,"|").concat(t.active)),l&&(K.A.add_monitor("VCMS"),f.muted?(K.A.add_monitor("VTMS:"+f.muted),g.A.Notify_APPUI_SAFE(p.tMo)):(K.A.add_monitor("VTMS:"+f.muted),g.A.Notify_APPUI_SAFE(p.IV3))),e.next=32;break;case 29:e.prev=29,e.t0=e.catch(5),a.handleVideoError(e.t0);case 32:case"end":return e.stop()}}),e,null,[[5,29]])})));return function(t){return e.apply(this,arguments)}}(),errorHandler:function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.handleVideoError(e,r)}});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),Start_Audio_Play:function(){this.audioPlay=!0,g.A.AudioNode&&g.A.AudioNode.postCMD("startPlayAudio",null),_.UpdateAudioPlayStatus(!0)},Stop_Audio_Play:function(){_.UpdateAudioPlayStatus(!1),g.A.AudioNode&&g.A.AudioNode.postCMD("stopPlayAudio",null)},Remove_Audio_Play:function(){_.UpdateAudioPlayStatus(!1),this.audioPlay=!1,g.A.AudioNode&&g.A.AudioNode.postCMD("stopPlayAudio",null)},Meeting_Fail_Over:function(e,t){_.Meeting_Fail_Over(e,t)},Start_Desktop_Audio_Capture:function(){var e=this.desktopSharingMediaStreamRaw||this.desktopSharingMediaStream;if(this.useWebRTCAudio){var t;null===(t=this.webrtcAudio)||void 0===t||t.setStreamAsync(e,!0)}else{var r=e.getAudioTracks();if(e&&r){var n=this.sharingAudioCtx.createMediaStreamSource(e);this.sharingWebrtcAudioNode=n,this.isSharingCaptureNodeConnect||(this.sharingWebrtcAudioNode.connect(g.A.SharingAudioNode),g.A.SharingAudioNode.postCMD("StartCaptureAudio",null),this.isSharingCaptureNodeConnect=!0)}}this.screenShareAudioPreviewElement&&this.screenShareAudioPreviewElement.play().catch((function(e){m.Ay.error("Screenshare audio preview play failed",e)}))},Start_Audio_Capture:function(){if(Vn.shouldCaptureAudio())this.StartAudioMediaCapture();else{if(Vn.getAudioCapabilities().deviceId,this.audioInputLevel)return this.audioInputLevel.setAudioStream(Vn.audioStream),this.captureAudioMuted||this.audioInputLevel.start(),void(g.A.ComputerAudioStatus===N.BX.ComputerAudio_Connecting&&(g.A.ComputerAudioStatus=N.BX.ComputerAudio_Connected,g.A.Notify_APPUI(p.Ubu,{microphoneDeviceId:Vn.getAudioDeviceId()})));ln.hasProcessor()&&ln.resumeCtx();var e,t=ln.hasProcessor()?ln.getStream():Vn.audioStream;if(this.useWebRTCAudio)return void(null===(e=this.webrtcAudio)||void 0===e||e.setStreamAsync(t).then((function(e){g.A.ComputerAudioStatus===N.BX.ComputerAudio_Connecting&&(g.A.ComputerAudioStatus=N.BX.ComputerAudio_Connected,g.A.Notify_APPUI(p.Ubu,{microphoneDeviceId:Vn.getAudioDeviceId()}))})));if(g.A.AudioNode){this.webrtcAudioNode&&(this.webrtcAudioNode.disconnect(g.A.AudioNode),this.webrtcAudioNode=null);var r=this.audioCtx.createMediaStreamSource(t);this.webrtcAudioNode=r,this.webrtcAudioNode.connect(g.A.AudioNode),g.A.AudioNode.postCMD("StartCaptureAudio",null),_.Notify_Audio_Encode_Thread({command:hr.dt,value:!0}),this.isCaputureNodeConnect=!0}g.A.ComputerAudioStatus===N.BX.ComputerAudio_Connecting&&(g.A.ComputerAudioStatus=N.BX.ComputerAudio_Connected,g.A.Notify_APPUI(p.Ubu,{microphoneDeviceId:Vn.getAudioDeviceId()}))}},Stop_Audio_Capture:function(){_.Notify_Audio_Thread_Status(g.A.SPECIAL_ID,p.A_T)},_startVideoLoadedmetadataMonitor:function(e,t){var r,n=this;null!==(r=this.videoloadedmetadatamonitor)&&void 0!==r&&r.stop&&this.videoloadedmetadatamonitor.stop();var i=Math.min(z.Bb+5e3*this.loadedmetadatamtimeoutcount,3e4),a=setTimeout((function(){var r;(null===(r=n.videoloadedmetadatamonitor)||void 0===r?void 0:r.id)!=t||n.isDestroy||((0,h.SI)(e),n.loadedmetadatamtimeoutcount++,n.videoloadedmetadatamonitor=null,e.readyState>=2?(n._videoloadedmetadata(t,{}),m.Ay.directReport("video is ready state no loadedmetadata callback")):(K.A.add_monitor("loadmetadatamtimeout:".concat(n.loadedmetadatamtimeoutcount)),n.handleVideoError(new Error("Video loadedmetadata timeout ".concat(n.loadedmetadatamtimeoutcount)))))}),i);this.videoloadedmetadatamonitor={id:t,stop:function(){clearTimeout(a)}}},_addVideoLoadedmetadataListener:function(e){var t;if(e){this.mountoadedmetadatatime=performance.now(),null!==(t=this.videoloadmetadataListener)&&void 0!==t&&t.remove&&(this.videoloadmetadataListener.remove(),this.videoloadmetadataListener=null);var r=Date.now(),n=this._videoloadedmetadata.bind(this,r);e.addEventListener("loadedmetadata",n),this.videoloadmetadataListener={id:r,remove:function(){e.removeEventListener("loadedmetadata",n)}},this._startVideoLoadedmetadataMonitor(e,r)}else m.Ay.error("videodom is null")},_videoloadedmetadata:function(e,t){var r,n,i,a;if(this.videoloadmetadataListener){if(this.videoloadmetadataListener.id!=e)return;var o;null===(o=this.videoloadmetadataListener)||void 0===o||o.remove(),this.videoloadmetadataListener=null}null!==(r=this.videoloadedmetadatamonitor)&&void 0!==r&&r.stop&&(this.videoloadedmetadatamonitor.stop(),this.videoloadedmetadatamonitor=null);var s,u=this,c=null;if(t?(c=t.target||u.videoCaptureValue.videoCtrl,K.A.add_monitor("VIDEOLOADEDMETADATA:".concat(c==u.videoCaptureValue.videoCtrl))):K.A.add_monitor("VIDEOLOADEDMETADATA:".concat(!0)),!_.AssertMediaSdkNotDestory(u,"loadedmetadata"))return m.Ay.error("VideoCaptureException loadedmetadata JsMediaSDK instance destroyed"),Vn.enableReuseStream(!1),void Vn.destoryVideoMediaStream();u.isVideoCaptureLoadedmetadata&&m.Ay.warn("Video capture isVideoCaptureLoadedmetadata is true"),u.isVideoCaptureLoadedmetadata=!0,u.isSupportVideoFrameOrBitmapCapture?(i=u.videoCaptureWidth,a=u.videoCaptureHeight):(i=u.videoCaptureValue.videoCtrl.videoWidth,a=u.videoCaptureValue.videoCtrl.videoHeight,u.videoCaptureWidth=i,u.videoCaptureHeight=a,null===(s=u.captureVideoOutputCanvasDomList)||void 0===s||s.forEach((function(e){e.width=i,e.height=a}))),t&&this.startVideoCaptureSuccess(),null===(n=u.VideoRenderObj)||void 0===n||n.Set_LocalVideo_SSRC(u.videoCaptureValue.ssid),mn.setLocalVideoSsrc(u.videoCaptureValue.ssid),u.webrtcConfig.webrtcflag||(_.Notify_Video_Encode_Thread({command:"startVideoEncode",width:u.videoCaptureWidth,height:u.videoCaptureHeight,fps:u.videoCaptureValue.fps,ssid:u.videoCaptureValue.ssid,mtu_size:u.mtu_size,isSupportMediaStreamTrackProcessor:u.isSupportMediaStreamTrackProcessor,isSupportVideoFrame:this.isVideoTagFrameAccessible,isSupport2DCanvasDrawFrame:u.isSupport2DCanvasDrawFrame,disableOriginalRatio:!!u.videoCaptureValue.disableOriginalRatio}),_.Notify_Video_Decode_Thread({command:"startVideoEncode",ssid:u.videoCaptureValue.ssid,disableOriginalRatio:!!u.videoCaptureValue.disableOriginalRatio}),u.isSupportVideoShare||_.Notify_Sharing_Encode_Thread({command:"startVideoEncode"}),_.Notify_Video_Encode_Thread({command:"updateVideoPara",width:u.videoCaptureWidth,height:u.videoCaptureHeight,fps:u.GetVideoCaptureFps()})),u.lastRealRect.left=0,u.lastRealRect.top=0,u.lastRealRect.width=u.videoCaptureWidth,u.lastRealRect.height=u.videoCaptureHeight,g.A.Notify_APPUI(p.Shw,{width:i,height:a})},startVideoCaptureSuccess:function(){var e=Vn.getVideoCapabilities(),t=e.deviceId,r=e.pan,n=void 0===r?null:r,i=e.tilt,a=void 0===i?null:i,o=e.zoom,s=void 0===o?null:o,u=e.facingMode,c=void 0===u?null:u,d={currentDeviceID:t,PTZRange:{pan:n,tilt:a,zoom:s}},l=this.VALUE_CACHE_FOR_START_CAPTURE_VIDEO.usingFacingMode;void 0!==l&&l&&(null==c?void 0:c.length)>0&&(d.usingFacingMode=!0,d.VideoSelectValue=c),K.A.add_monitor("START_VIDEO_CAPTURE_SUCCESS_Response:".concat((0,h.iD)(JSON.stringify(d)))),g.A.Notify_APPUI(p.EUC,d)},handleWebRTCVideoStream:function(){var e=H(O().mark((function e(t,r){var n,i,a,o,s,u,c,d=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.webrtcConfig.webrtcflag){e.next=2;break}return e.abrupt("return",void K.A.add_monitor("WMSC_WebRTC_Flag_Error:".concat(t)));case 2:if(n=r||Vn.getProcessedVideoStream(),this.videoCaptureValue&&this.videoCaptureValue.videoCtrl&&(this.videoCaptureValue.videoCtrl.srcObject=n,Vn.playVideoStream(this.videoCaptureValue.videoCtrl)),!this.wmscManager||!n){e.next=10;break}if(this.wmscManager.selfVideoDomMap.size>0&&this.wmscManager.selfVideoDomMap.forEach((function(e){e.srcObject=n,d.wmscManager.playSelfVideo(t,e)})),K.A.add_monitor("WMSC_Prepare_Send_streams:".concat(t,"|").concat(this.isStartVideoCapture)),!this.isStartVideoCapture){e.next=8;break}return a=Vn.videoConstraints,o=a.width,s=a.height,u=a.frameRate,c={width:o.max||o.ideal,height:s.max||s.ideal,frameRate:u.max||u.ideal},e.next=8,this.wmscManager.publishVideoStream(c);case 8:e.next=11;break;case 10:K.A.add_monitor("WMSC_Send_Stream_Fail:".concat(!!this.wmscManager,"|").concat(!!n,"|").concat(!(null===(i=this.videoCaptureValue)||void 0===i||!i.videoCtrl),"|").concat(t));case 11:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),render_self_video_wasm:function(){try{this.videoCaptureValue&&this.videoCaptureValue.videoCtrl&&!this.webrtcConfig.webrtcflag&&Vn.playVideoStream(this.videoCaptureValue.videoCtrl),this.selfPreviewVideotagList&&this.selfPreviewVideotagList.length>0&&this.selfPreviewVideotagList.forEach((function(e){e&&Vn.playVideoStream(e)}))}catch(e){m.Ay.error("Error trying to set srcObject of video tag",e)}},Start_Video_Capture:function(){var e=this;if(!Vn.shouldCaptureVideo()){var t=this;return new Promise((function(r,n){if(t.isSupportVideoFrameOrBitmapCapture?(t._videoloadedmetadata(null),t.render_self_video_wasm(),h.Ay.isSelfPreviewRenderWithVideo()&&h.Ay.isSupportVideoFrameOrBitmapCapture()&&t.videoCaptureValue.videoCtrl&&!e.webrtcConfig.webrtcflag&&Vn.playVideoStream(t.videoCaptureValue.videoCtrl),r(!0)):(t.isVideoCaptureLoadedmetadata&&(m.Ay.error("Video capture isVideoCaptureLoadedmetadata is true"),t.isVideoCaptureLoadedmetadata=!1),e._addVideoLoadedmetadataListener(t.videoCaptureValue.videoCtrl),Vn.checkVideoStreamActive().then(r).catch(n),t.videoCaptureValue.videoCtrl&&!e.webrtcConfig.webrtcflag&&Vn.playVideoStream(t.videoCaptureValue.videoCtrl)),e.webrtcConfig.webrtcflag)if(K.A.add_monitor("WMSC_Start_CAPTURE_REUSE_STREAM"),e.wmscManager)e.handleWebRTCVideoStream("reuseCaptureStream");else{var i="WMSC_Resuse_Stream_Fail:".concat(!!e.wmscManager,"|").concat(e.isStartVideoCapture,"|reuseCaptureStream");K.A.add_monitor(i),m.Ay.error(i)}K.A.add_monitor("STARTVIDEOSUCCESS"),(t.isSupportVideoFrameOrBitmapCapture||!t.isSupportedVideoFrameOrBitmapCapture&&e.webrtcConfig.webrtcflag)&&e.startVideoCaptureSuccess()}))}this.StartVideoMediaCapture()},video_capture_for_webrtc:function(){var e=this;if(!Vn.shouldCaptureVideo())return new Promise((function(t){e.startVideoCaptureSuccess(),t(!0)}))},Stop_Video_Capture:function(){this.webrtcConfig.webrtcflag?(K.A.add_monitor("WMSC_Stop_Video_CAPTURE"),this.Stop_Video_Capture_for_webrtc()):this.Stop_Video_Capture_for_wasm(),this.isStartVideoCapture=!1,this.isVideoCaptureLoadedmetadata=!1,Vn._clearCheckVideoStreamActiveTimer(),this.isMaskSettingOn||this.isVBSettingOn||this.isStartVideoCapture||(Vn.destoryVideoMediaStream(),this.videoCaptureValue=null)},Stop_Video_Capture_for_wasm:function(){var e=this;if(_.Notify_Video_Encode_Thread({command:"stopVideoEncode"}),_.Notify_Video_Decode_Thread({command:"stopVideoEncode"}),_.Notify_Sharing_Encode_Thread({command:"stopVideoEncode"}),this.videoCaptureValue&&this.videoCaptureValue.videoCtrl&&!this.isMaskSettingOn&&!this.isVBSettingOn){var t,r,n=!1;if(this.videoloadmetadataListener&&(0,h.SI)(this.videoCaptureValue.videoCtrl),this.selfPreviewVideotagList.length&&this.selfPreviewVideotagList.forEach((function(t){t===e.videoCaptureValue.videoCtrl&&(n=!0),Vn.removeVideoStream(t)})),n||Vn.removeVideoStream(this.videoCaptureValue.videoCtrl),null!==(t=this.videoloadedmetadatamonitor)&&void 0!==t&&t.stop&&(this.videoloadedmetadatamonitor.stop(),this.videoloadedmetadatamonitor=null),null!==(r=this.videoloadmetadataListener)&&void 0!==r&&r.remove){this.videoloadmetadataListener.remove(),this.videoloadmetadataListener=null;var i=performance.now();i-this.mountoadedmetadatatime>5e3&&m.Ay.error("stop video capture but loadedmetadata not callback after ".concat(Math.round(i-this.mountoadedmetadatatime)," ms"))}}},Stop_Video_Capture_for_webrtc:function(){var e=H(O().mark((function e(){var t,r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!==(t=this.videoCaptureValue)&&void 0!==t&&t.videoCtrl&&Vn.removeVideoStream(this.videoCaptureValue.videoCtrl),this.wmscManager&&(this.wmscManager.captureFramerate=void 0),e.next=4,null===(r=this.wmscManager)||void 0===r?void 0:r.unpublishVideoStream();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),Remove_Video_Capture:function(){Vn.destoryVideoMediaStream(),this.videoCaptureValue=null,this.videoCaptureValue.videoCtrl&&this.videoCaptureValue.videoCtrl.pause()},Change_Video_Capture_Resolution:function(e,t){var r,n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.platformType===z.u7.DESKTOP,o=null===g.A||void 0===g.A||null===(r=g.A.localVideoPara)||void 0===r?void 0:r.isSupportWebCodecEnocde;if(!h.Ay.isIpadOS()||o){var s=!1;if(!(h.Ay.isIphoneOrIpadBrowser()||h.Ay.isIpadOS()||h.Ay.isAndroidBrowser()&&!h.Ay.isAndroidIntegrationWithSAB())||(s=!0,i||(this.captureSize={width:e,height:t}),this.isLandScape||o||i))if(e>=1920&&!a)K.A.add_monitor("UVFR: 3");else{var u=this.GetVideoCaptureFps();Vn.changeVideoResolution(e,t,u,a).then((function(){s||(n.ReadyCapureWidth=e,n.ReadyCapureHeight=t,n.videoCaptureWidth=e,n.videoCaptureHeight=t,g.A.Notify_APPUI(p.Shw,{width:e,height:t}),_.Notify_Video_Encode_Thread({command:"updateVideoPara",width:e,height:t,fps:n.GetVideoCaptureFps()}))})).catch((function(e){m.Ay.warn("change video resoltuion info:",e),K.A.add_monitor("UVFER:".concat(null==e?void 0:e.name,"-").concat(null==e?void 0:e.message))})),!Vn.videoStreamTrack||this.isSupportMediaStreamTrackProcessor||this.isVideoTagFrameAccessible||this.webrtcConfig.webrtcflag||this.Process_Video()}else K.A.add_monitor("UVFR: 2")}else K.A.add_monitor("UVFR: 1")},Start_Whiteboard_Sharing:function(){var e=H(O().mark((function e(){var t,r,n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.desktopSharingValue.canvas,this.whiteboardCanvas=n,this.isdesktopCaptureLoadedmetadata=!0,t=n.width,r=n.height,this.desktopSharingCaptureWidth=t,this.desktopSharingCaptureHeight=r,this.desktopCaptureContext=n.getContext("2d"),i={command:"startSharingEncode",width:t,height:r,fps:8,ssid:this.desktopSharingValue.ssid,isSupportMediaStreamTrackProcessor:!1,isWhiteboardSharing:!0},_.Notify_Video_Encode_Thread(i),this.isSupportVideoShare||_.Notify_Sharing_Encode_Thread(i);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),Change_Sharing_Capture_Resolution:function(e){var t;this.shareTrack&&(console.log("change sharing capture resolution to",e),t=1==e?{video:!0,frameRate:5}:{width:1280,height:720,frameRate:24},this.shareTrack.applyConstraints(t))},Start_Desktop_Sharing:function(){if(this.desktopSharingMediaStream){var e=this;return new Promise((function(t,r){var n=function(){var t=H(O().mark((function t(r){var i,a,o;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.desktopSharingMediaStream.getVideoTracks()[0],t.next=3,Vn.adjustShareResUnder2K(o);case 3:e.isSupportMediaStreamTrackProcessor?(e.sharingMediaStreamTrackProcessor=new MediaStreamTrackProcessor(o),e.sharingFrameStream=e.sharingMediaStreamTrackProcessor.readable,e.isSupportVideoShare?_.Notify_Sharing_Video_Encode_Thread_Transferable_Data("sharingframeStream",e.sharingFrameStream):_.Notify_Sharing_Encode_Thread_Transferable_Data("frameStream",e.sharingFrameStream),K.A.add_monitor("SCTP"),e.desktopSharingValue.video&&(i=e.desktopSharingValue.video.videoWidth,a=e.desktopSharingValue.video.videoHeight,e.desktopSharingCaptureWidth=i,e.desktopSharingCaptureHeight=a,e.desktopSharingValue.video.removeEventListener("loadedmetadata",n))):(e.isdesktopCaptureLoadedmetadata=!0,i=e.desktopSharingValue.video.videoWidth,a=e.desktopSharingValue.video.videoHeight,e.desktopSharingValue.canvas.width=i,e.desktopSharingValue.canvas.height=a,e.desktopSharingCaptureWidth=i,e.desktopSharingCaptureHeight=a,e.desktopCaptureContext=e.desktopSharingValue.canvas.getContext("2d"),e.desktopSharingValue.video.removeEventListener("loadedmetadata",n)),e.isSupportVideoShare?_.Notify_Sharing_Video_Encode_Thread({command:"startSharingEncode",width:i,height:a,fps:8,ssid:e.desktopSharingValue.ssid,isSupportMediaStreamTrackProcessor:e.isSupportMediaStreamTrackProcessor}):_.Notify_Sharing_Encode_Thread({command:"startSharingEncode",width:i,height:a,fps:8,ssid:e.desktopSharingValue.ssid,isSupportMediaStreamTrackProcessor:e.isSupportMediaStreamTrackProcessor}),g.A.Notify_APPUI(p.HL3,{width:i,height:a}),_.Notify_Video_Encode_Thread({command:"startsharingencode"});case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();if(e.isSupportMediaStreamTrackProcessor?e.desktopSharingValue.video.addEventListener("loadedmetadata",n):(e.desktopSharingValue.video.addEventListener("loadedmetadata",n),e.desktopSharingValue.video.setAttribute("playsinline",""),e.desktopSharingValue.video.muted=!0),e.desktopSharingValue.video){try{e.desktopSharingValue.video.srcObject=e.desktopSharingMediaStream,e.desktopSharingValue.video.muted=!0}catch(t){e.desktopSharingValue.video.src=u().createObjectURL(e.desktopSharingMediaStream)}e.desktopSharingValue.video.play().catch((function(e){m.Ay.error("Screenshare video preview play failed",e)}))}g.A.isGoogleMeetMode&&e.desktopSharingMediaStream.getAudioTracks().length>0&&(e.screenShareAudioPreviewElement=new Audio,e.screenShareAudioPreviewElement.srcObject=e.desktopSharingMediaStream,e.screenShareAudioPreviewElement.setSinkId&&e.screenShareAudioPreviewElement.setSinkId(e.audioCtx.sinkId),e.screenShareAudioPreviewElement.play().catch((function(e){m.Ay.error("Screenshare audio preview play failed",e)}))),t(!0)}))}this.StartDesktopMediaCapture()},Process_Sharing:function(){var e=H(O().mark((function e(){var t,r,n,i,a,o,s,u,c;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.desktopSharingValue&&this.desktopSharingSend){e.next=2;break}return e.abrupt("return");case 2:a=!(!this.localAnnoStarted||!this.localShareCanvas),this.isStartWhiteboardSharing?(n=this.whiteboardCanvas,t=n.width,r=n.height):(n=this.desktopSharingValue.video,a?(i=null===(o=this.localShareCanvas)||void 0===o?void 0:o.getContext("2d"),t=this.localShareCanvas.width,r=this.localShareCanvas.height):(t=n.videoWidth,r=n.videoHeight)),s=Vn.getScaledResolution(t,r),t=s.w,r=s.h,!a||this.localShareCanvas.width===t&&this.localShareCanvas.height===r||(this.localShareCanvas.width=t,this.localShareCanvas.height=r,this.annotationMgr.updateRemoteSizeInfo({width:t,height:r})),t==this.desktopSharingCaptureWidth&&r==this.desktopSharingCaptureHeight||(g.A.Notify_APPUI(p.HL3,{width:t,height:r}),this.desktopSharingCaptureWidth=t,this.desktopSharingCaptureHeight=r);try{this.isdesktopCaptureLoadedmetadata&&n&&(this.isStartWhiteboardSharing||(this.desktopSharingValue.canvas.width=t,this.desktopSharingValue.canvas.height=r),c=this.desktopCaptureContext,!this.is32bitbrowser||this.flipSend?(this.isStartWhiteboardSharing||c.drawImage(n,0,0,t,r),u=i?i.getImageData(0,0,t,r):c.getImageData(0,0,t,r),1e3==this.sMonitorCaptureFrameCount&&(K.A.add_monitor2("SCFOK"),this.sMonitorCaptureFrameCount=0),this.sMonitorCaptureFrameCount++,_.Sharing_Encode_Frame(g.A.SPECIAL_ID,u.data,u.data.length,0,t,r),this.flipSend=!1):(this.flipSend=!0,_.Sharing_Encode_Frame(g.A.SPECIAL_ID,null,0,0,0,0)))}catch(e){m.Ay.error("An error occurred when trying to encode a sharing frame",e),K.A.add_monitor3("GIDF"),setTimeout((function(){_.Sharing_Encode_Frame(g.A.SPECIAL_ID,null,0,0,0,0)}),1e3)}case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),Update_Mask_Texture:function(e,t,r){if(this.VideoMaskSettingCanvas){try{"object"==j(t)&&t.ideal&&(t=t.ideal),"object"==j(r)&&r.ideal&&(r=r.ideal),this.bgCanvas&&this.bgCanvasctx||(this.bgCanvas=document.createElement("canvas"),this.bgCanvasctx=this.bgCanvas.getContext("2d")),this.bgCanvas.width==t&&this.bgCanvas.height==r||(this.bgCanvas.width=t,this.bgCanvas.height=r)}catch(e){globaltracing_error("Update_Mask_Texture, width=$".concat(JSON.stringify(t),", height=").concat(JSON.stringify(r),". "),e),t=this.bgCanvas.width,r=this.bgCanvas.height}if(this.bgCanvasctx.clearRect(0,0,t,r),this.MaskImage&&this.BgImage&&"blur"!==this.BgImage){if(e.dWidth>0&&e.dHeight>0&&this.VideoMaskSettingCanvas.width>0&&this.VideoMaskSettingCanvas.height>0&&t>0&&r>0){var n=e.dx/(this.VideoMaskSettingCanvas.width/t),i=e.dy/(this.VideoMaskSettingCanvas.height/r),a=e.dWidth/(this.VideoMaskSettingCanvas.width/t),o=e.dHeight/(this.VideoMaskSettingCanvas.height/r);this.bgCanvasctx.drawImage(this.MaskImage,n,i,a,o)}var s,u,c,d;this.bgCanvasctx.globalCompositeOperation="source-out",this.Crop_Mask_Bg_16V9(),s=this.bgImageCroppingParams.sx,u=this.bgImageCroppingParams.sy,c=this.bgImageCroppingParams.sw,d=this.bgImageCroppingParams.sh,this.bgCanvasctx.drawImage(this.BgImage,s,u,c,d,0,0,t,r)}}},Crop_Mask_Bg_16V9:function(){var e,t,r,n=0,i=16/9,a=this.BgImage.naturalWidth,o=this.BgImage.naturalHeight;i*o>=a?(r=a,e=0,t=(o-(n=a/i))/2):(n=o,e=(a-(r=o*i))/2,t=0),this.bgImageCroppingParams.sx=e,this.bgImageCroppingParams.sy=t,this.bgImageCroppingParams.sw=r,this.bgImageCroppingParams.sh=n},Draw_Mask_Frame:function(){var e,t;if(this.VideoMaskSettingCanvas){this.VideoMaskSettingCanvasctx||(this.VideoMaskSettingCanvasctx=this.VideoMaskSettingCanvas.getContext("2d"));var r=this.VideoMaskCanvasFillMode?se(this.videoCaptureHiddenCanvas.width,this.videoCaptureHiddenCanvas.height,void 0,void 0,this.VideoMaskSettingCanvas.width/this.VideoMaskSettingCanvas.height):this.videoCaptureValue&&this.videoCaptureValue.disableOriginalRatio?se(this.videoCaptureHiddenCanvas.width,this.videoCaptureHiddenCanvas.height):null;this.isMirrorMyVideo?(this.isCanvasScaled||(this.VideoMaskSettingCanvasctx.scale(-1,1),this.isCanvasScaled=!0),this.VideoMaskSettingCanvasctx.clearRect(0-this.VideoMaskSettingCanvas.width,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height),(e=this.VideoMaskSettingCanvasctx).drawImage.apply(e,[this.videoCaptureHiddenCanvas].concat(y(r?[r.left,r.top,r.width,r.height]:[]),[0-this.VideoMaskSettingCanvas.width,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height]))):(this.isCanvasScaled&&(this.VideoMaskSettingCanvasctx.setTransform(1,0,0,1,0,0),this.isCanvasScaled=!1),this.VideoMaskSettingCanvasctx.clearRect(0,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height),(t=this.VideoMaskSettingCanvasctx).drawImage.apply(t,[this.videoCaptureHiddenCanvas].concat(y(r?[r.left,r.top,r.width,r.height]:[]),[0,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height])))}},Draw_No_VB_Preview_Frame:function(){if(this.videoNoVBPreviewCanvas){this.videoNoVBPreviewCanvasctx||(this.videoNoVBPreviewCanvasctx=this.videoNoVBPreviewCanvas.getContext("2d"));var e,t,r,n=this.videoCaptureHiddenCanvas,i=this.videoNoVBPreviewCanvas.width,a=this.videoNoVBPreviewCanvas.height,o=n.width,s=n.height;o/s>i/a?(t=0,r=(a-s*(e=i/o))/2):(t=(i-o*(e=a/s))/2,r=0),this.isMirrorMyVideo?(this.isVideoNoVBPreviewCanvasScaled||(this.videoNoVBPreviewCanvasctx.scale(-1,1),this.isVideoNoVBPreviewCanvasScaled=!0),this.videoNoVBPreviewCanvasctx.clearRect(0-this.videoNoVBPreviewCanvas.width,0,this.videoNoVBPreviewCanvas.width,this.videoNoVBPreviewCanvas.height),this.videoNoVBPreviewCanvasctx.drawImage(n,0,0,o,s,-t-o*e,r,o*e,s*e)):(this.isVideoNoVBPreviewCanvasScaled&&(this.videoNoVBPreviewCanvasctx.setTransform(1,0,0,1,0,0),this.isVideoNoVBPreviewCanvasScaled=!1),this.videoNoVBPreviewCanvasctx.clearRect(0,0,this.videoNoVBPreviewCanvas.width,this.videoNoVBPreviewCanvas.height),this.videoNoVBPreviewCanvasctx.drawImage(n,0,0,o,s,t,r,o*e,s*e))}},DrawNoVBPreviewFromVideo:function(e){if(this.videoNoVBPreviewCanvas){this.videoNoVBPreviewCanvasctx||(this.videoNoVBPreviewCanvasctx=this.videoNoVBPreviewCanvas.getContext("2d"));var t,r,n,i=e.videoWidth?e.videoWidth:640,a=e.videoHeight?e.videoHeight:360,o=this.videoNoVBPreviewCanvas.width,s=this.videoNoVBPreviewCanvas.height;i/a>o/s?(r=0,n=(s-a*(t=o/i))/2):(r=(o-i*(t=s/a))/2,n=0),this.isMirrorMyVideo?(this.isVideoNoVBPreviewCanvasScaled||(this.videoNoVBPreviewCanvasctx.scale(-1,1),this.isVideoNoVBPreviewCanvasScaled=!0),this.videoNoVBPreviewCanvasctx.clearRect(0-this.videoNoVBPreviewCanvas.width,0,this.videoNoVBPreviewCanvas.width,this.videoNoVBPreviewCanvas.height),this.videoNoVBPreviewCanvasctx.drawImage(e,0,0,i,a,-r-i*t,n,i*t,a*t)):(this.isVideoNoVBPreviewCanvasScaled&&(this.videoNoVBPreviewCanvasctx.setTransform(1,0,0,1,0,0),this.isVideoNoVBPreviewCanvasScaled=!1),this.videoNoVBPreviewCanvasctx.clearRect(0,0,this.videoNoVBPreviewCanvas.width,this.videoNoVBPreviewCanvas.height),this.videoNoVBPreviewCanvasctx.drawImage(e,0,0,i,a,r,n,i*t,a*t))}},GetVideoCaptureFps:function(){return this.videoCaptureValue&&this.videoCaptureValue.fps?this.videoCaptureValue.fps:z.Fw},Process_Video:function(){var e=H(O().mark((function e(){var t,r,n,i,a,o,s,u,c,d,l,f,v,y,S,A,b,E,k,C;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isSupportMediaStreamTrackProcessor){e.next=2;break}return e.abrupt("return");case 2:if(this.videoCaptureValue&&this.isStartVideoCapture||this.isMaskSettingOn||this.isVBSettingOn){e.next=4;break}return e.abrupt("return");case 4:if(o=this,n=this.videoCaptureWidth,i=this.videoCaptureHeight,s=Vn.isUsingFileInputVideoSource(),this.isStartVideoCapture?a=this.videoCaptureValue.videoCtrl:(this.isMaskSettingOn||this.isVBSettingOn)&&(a=this.MaskSettingVideo),!(0,h.qs)(a.srcObject)){e.next=23;break}if(!((this.isVideoCaptureLoadedmetadata||this.isMaskSettingOn||this.isVBSettingOn)&&a&&a.readyState>=2)){e.next=20;break}if((a.paused||a.ended)&&a.play().catch((function(e){m.Ay.error("Video capture video tag play failed",e)})),!this.isSelfViewWithVideo||this.platformType!=z.u7.IPHONE){e.next=12;break}return u=Hn(),c=new VideoFrame(a,{timestamp:1e3*performance.now()}),e.abrupt("return",void(_.TransoferDataToVideoEncodeThread({command:"yuvVideoFrame",data:c,rotation:u},[c])||c.close()));case 12:if(o.isCurrentInMaskStatus||!o.isVideoTagFrameAccessible){e.next=15;break}return d=new VideoFrame(a,{timestamp:1e3*performance.now()}),l=Hn(),f={command:"yuvVideoFrame",data:d,rotation:l},e.abrupt("return",(o.videoCaptureValue&&o.VideoRenderObj?(Br.hasProcessor()||o.VideoRenderObj.Update_LocalVideo(d,l,!0),_.Notify_Video_Encode_Thread(f),d.close()):_.TransoferDataToVideoEncodeThread(f,[d])||d.close(),void(o.isVBSettingOn&&o.isCurrentInNoVBPreviewStatus&&o.DrawNoVBPreviewFromVideo(a))));case 15:t=a.videoWidth?a.videoWidth:640,r=a.videoHeight?a.videoHeight:360,t&&r&&(t!==n||r!==i)&&(Un("video width/height changed old => begin",n,i,t,r),g.A.Notify_APPUI(p.Shw,{width:t,height:r}),this.videoCaptureWidth=t,this.videoCaptureHeight=r,_.Notify_Video_Encode_Thread({command:"updateVideoPara",width:t,height:r,fps:o.GetVideoCaptureFps()})),(!(!o.isMaskSettingOn||o.videoCaptureValue&&o.videoCaptureValue.disableOriginalRatio)||o.MaskImage&&o.BgImage)&&o.isCurrentInMaskStatus&&o.isCurrentInNoVBPreviewStatus?(b=t/r*o.ReadyCapureHeight,E=r/t*o.ReadyCapureWidth,b>o.ReadyCapureWidth?(v=0,y=(o.ReadyCapureHeight-E)/2):(v=(o.ReadyCapureWidth-b)/2,y=0),S=o.ReadyCapureWidth-2*v,A=o.ReadyCapureHeight-2*y,o.videoCaptureHiddenCanvas.width=o.ReadyCapureWidth,o.videoCaptureHiddenCanvas.height=o.ReadyCapureHeight):(S=t,A=r,v=0,y=0,o.videoCaptureHiddenCanvas.width=t,o.videoCaptureHiddenCanvas.height=r),s?h.Ay.videoToMediaStreamManager.drawCanvas(o.videoCaptureHiddenCanvas,o.videoCaptureHiddenCanvasCtx,o.videoCaptureHiddenCanvas.width,o.videoCaptureHiddenCanvas.height):o.videoCaptureHiddenCanvasCtx.drawImage(a,0,0,t,r,v,y,S,A),o.isCurrentInMaskStatus&&(o.bgCanvas?o.videoCaptureHiddenCanvasCtx.drawImage(o.bgCanvas,0,0,o.videoCaptureHiddenCanvas.width,o.videoCaptureHiddenCanvas.height):o.Update_Mask_Texture(this.maskCoordinate,o.videoCaptureHiddenCanvas.width,o.videoCaptureHiddenCanvas.height),o.VideoMaskSettingCanvas&&o.Draw_Mask_Frame()),o.isCurrentInNoVBPreviewStatus&&o.videoNoVBPreviewCanvas&&o.Draw_No_VB_Preview_Frame(),(o.isStartVideoCapture||o.isVBSettingOn)&&(k=o.videoCaptureHiddenCanvasCtx.getImageData(0,0,o.videoCaptureHiddenCanvas.width,o.videoCaptureHiddenCanvas.height),C=k.data,o.lastRealRect.width==o.videoCaptureHiddenCanvas.width&&o.lastRealRect.height==o.videoCaptureHiddenCanvas.height||(o.lastRealRect.left=0,o.lastRealRect.top=0,o.lastRealRect.width=o.videoCaptureHiddenCanvas.width,o.lastRealRect.height=o.videoCaptureHiddenCanvas.height,_.Notify_Video_Encode_Thread({command:"updateVideoPara",width:o.lastRealRect.width,height:o.lastRealRect.height,fps:o.GetVideoCaptureFps()})),o.videoCaptureValue&&o.VideoRenderObj&&!o.isMultiView&&(k.data instanceof Uint8ClampedArray&&(C=new Uint8Array(k.data.buffer)),o.videoCaptureValue&&void 0!==o.videoCaptureValue.disableOriginalRatio&&o.VideoRenderObj.Set_Cropping_Mode(!!o.videoCaptureValue.disableOriginalRatio),o.VideoRenderObj.Draw_Send_Video_Img(C,o.videoCaptureHiddenCanvas.width,o.videoCaptureHiddenCanvas.height,o.videoCaptureValue.ssid,z.rK,o.lastRealRect)),3e3==o.vMonitorCaptureFrameCount&&(K.A.add_monitor2("VCFOK"),o.vMonitorCaptureFrameCount=0),o.vMonitorCaptureFrameCount++,_.Video_Encode_Frame(g.A.SPECIAL_ID,C,o.videoCaptureHiddenCanvas.width,o.lastRealRect.left,o.lastRealRect.top,k.width,k.height)),o.videoCaptureHiddenCanvasCtx.clearRect(0,0,o.videoCaptureHiddenCanvas.width,o.videoCaptureHiddenCanvas.height),e.next=21;break;case 20:_.TransoferDataToVideoEncodeThread({command:"yuvVideoFrame"});case 21:e.next=24;break;case 23:_.TransoferDataToVideoEncodeThread({command:"yuvVideoFrame"});case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),Remove_Sharing_Audio_Capture:function(){var e;if(this.useWebRTCAudio)null===(e=this.webrtcAudio)||void 0===e||e.setStreamAsync(null,!0);else if(_.Notify_Audio_Encode_Thread({command:"changeAudioShare",isStart:!1}),g.A.ComputerAudioStatus==N.BX.ComputerAudio_Null&&_.addAudioMonitorLog.clear(),this.sharingWebrtcAudioNode&&g.A.SharingAudioNode){try{this.sharingWebrtcAudioNode.disconnect(g.A.SharingAudioNode)}catch(e){this.JsMediaSDK_Log(e)}this.sharingWebrtcAudioNode=null}},Remove_Audio_Capture:function(e){if(_.Notify_Audio_Thread_Status(g.A.SPECIAL_ID,p.YG0,e),g.A.DesktopAudioStatus==N.BX.DesktopAudio_Null&&_.addAudioMonitorLog.clear(),this.firstSetDelay=!0,this.webrtcAudioNode&&g.A.AudioNode){try{this.webrtcAudioNode.disconnect(g.A.AudioNode)}catch(e){this.JsMediaSDK_Log(e)}this.webrtcAudioNode=null}},Start_Video_Play:function(){this.videoRenderIntervalHandle||(this.videoRenderIntervalHandle=this.JsMediaSDK_VideoRenderInterval(this.videorenderinterval))},Stop_Video_Play:function(){this.UpdateVideoPlayStatus(!1),this.VideoRenderObj&&(this.VideoRenderObj.ClearQueue(),this.VideoRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName})),this.videoRenderIntervalHandle&&(this.VideoRenderObj.Stop_Draw.bind(this.VideoRenderObj)(),this.videoRenderIntervalHandle=null)},Remove_Video_Play:function(){this.UpdateVideoPlayStatus(!1),this.videoRenderIntervalHandle&&(clearInterval(this.videoRenderIntervalHandle),this.videoRenderIntervalHandle=null),_.Notify_Video_Decode_Thread({command:"removeVideoPlay"})},UpdateVideoPlayStatus:function(e){_.UpdateVideoPlayStatus(e)},EndMedia:function(){try{g.A.rwgAgent&&g.A.rwgAgent.off("message",this.rwgAgentMessageListenerWrapper)}catch(e){m.Ay.error("rwgAgent.off error",e)}try{var e,t;null===(e=this.videoDataChannel)||void 0===e||e.forceClose(),null===(t=this.audioDataChannel)||void 0===t||t.forceClose()}catch(e){m.Ay.error("clear rtcPeerConnectionList err",e)}try{Vn.enableReuseStream(!1),Vn.destoryAudioMediaStream(),this.Remove_Audio_Play(),this.Remove_Audio_Capture(),this.Remove_Sharing_Audio_Capture(),this.checkWorkletInterval&&(clearInterval(this.checkWorkletInterval),this.checkWorkletInterval=null),this.Remove_Video_Play(),this.audioCtx&&(this.audioCtx.onstatechange=null,this.audioCtx.close(),this.audioCtx.onerror&&(this.audioCtx.onerror=null),this.audioCtx=null),this.sharingAudioCtx&&(this.sharingAudioCtx.close(),this.sharingAudioCtx=null),this.audioDomNode&&(this.audioDomNode=null)}catch(e){m.Ay.error("endMedia",e)}try{Vn.enableReuseStream(!1),Vn.destoryVideoMediaStream(),this.EndSharingMediaStream(),this.CloseBoringPeerConnection(),h.Ay.audioToMediaStreamMananger.destroy(!1)}catch(e){m.Ay.error("endMedia",e)}try{_.disableSocketReconnect()}catch(e){m.Ay.error("endMedia",e)}try{this.remoteControl&&this.remoteControl.destroy()}catch(e){m.Ay.error("endMedia",e)}},EndDesktopAudioMediaStream:function(){var e=this.desktopSharingMediaStreamRaw||this.desktopSharingMediaStream;if(e){var t,r,n=e.getAudioTracks();n.length&&n.forEach((function(e){e.stop()})),!this.desktopSharingValue.audioOnly||null!==(t=this.desktopSharingMediaStream)&&void 0!==t&&t.getVideoTracks().length||(this.desktopSharingMediaStream=null),!this.desktopSharingValue.audioOnly||null!==(r=this.desktopSharingMediaStreamRaw)&&void 0!==r&&r.getVideoTracks().length||(this.desktopSharingMediaStreamRaw=null)}this.isStartDesktopSharing||(this.desktopSharingValue=null)},EndSharingMediaStream:function(){this.desktopSharingMediaStream&&(this.desktopSharingMediaStream.getTracks().forEach((function(e){e.stop()})),this.desktopSharingMediaStream=null,window.WebQrscanner&&WebQrscanner.qrScanner.stop()),this.desktopSharingMediaStreamRaw&&(this.desktopSharingMediaStreamRaw.getTracks().forEach((function(e){e.stop()})),this.desktopSharingMediaStreamRaw=null)},StopSharingCapture:function(){clearInterval(this.drawLocalShareIntervalId),this.EndSharingMediaStream(),this.desktopSharingSend=!1,this.isStartDesktopSharing&&_.Notify_Video_Encode_Thread({command:"stopsharingencode"}),this.isStartDesktopSharing=!1,this.desktopSharingMediaStream=null,window.WebQrscanner&&WebQrscanner.qrScanner.stop(),this.desktopSharingValue=null},CloseBoringPeerConnection:function(){try{this.rtcConnectionB&&(this.rtcConnectionB.close(),this.rtcConnectionB=null),this.rtcConnectionA&&(this.rtcConnectionA.close(),this.rtcConnectionA=null)}catch(e){Un(e)}},UnMuteAudio:function(){_.Notify_Audio_Thread_Status(g.A.SPECIAL_ID,p.Eym),this.enableHID&&this.hidAvalible&&ze.sendReport("mute",!1)},MuteAudio:function(){this.Stop_Audio_Capture(),this.enableHID&&this.hidAvalible&&ze.sendReport("mute",!0)},selectComputerAudioSpeaker:function(e,t){var r=this;return H(O().mark((function n(){var i,a,o,s,u,c,d,l,h;return O().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a="default"==e?"":e,o=null,r.isChromeWideAECSupported&&!r.audioDomNode?r.audioCtx&&(o=r.audioCtx):r.audioDomNode&&(o=r.audioDomNode),n.next=4,Ze.A.hasValidOutputDevice(a);case 4:if(!n.sent){n.next=8;break}n.t0=(null!==(i=r.fileAudioPlaybackTag)&&void 0!==i&&i.setSinkId&&r.fileAudioPlaybackTag.setSinkId(a).catch((function(e){m.Ay.error("set audio tag setSinkId error",e)})),r.useWebRTCAudio?void(null===(h=r.webrtcAudio)||void 0===h||h.changeSpeaker(e)):o?o.setSinkId?void o.setSinkId(a).then((function(){var e,n;Ze.A.updateSelectedSpeakerDevices((null===(e=o)||void 0===e?void 0:e.sinkId)||"default",Date.now()-t,!0),"suspended"===o.state&&(K.A.add_monitor("AUDIOCONTEXT:RESUME"),o.resume().catch((function(e){m.Ay.error("resume audio context failed when setSinkId",e)}))),g.A.Notify_APPUI(p.a6z,(null===(n=o)||void 0===n?void 0:n.sinkId)||"default"),r.audioSpeakerSetErrorCnt=0})).catch((function(e){var n;m.Ay.error("An error occurred when trying to set the audio output device",e),K.A.add_monitor("AODF"),Ze.A.updateSelectedSpeakerDevices(a,Date.now()-t,!1),r.notifyUISetSpeakerError({currentSink:(null===(n=o)||void 0===n?void 0:n.sinkId)||"default",error:error,errorCode:S.Lg.BROWSER_ERROR,errorMessgae:"SetSinkId failed, error = ".concat(e.message)})})):(m.Ay.error("setSinkId is not supported"),void r.notifyUISetSpeakerError({currentSink:(null===(l=o)||void 0===l?void 0:l.sinkId)||"default",errorCode:S.Lg.UNSUPPORTED_BROWSER,errorMessgae:"SetSinkId is not supported."})):(K.A.add_monitor("NoAudioPlayer"),void r.notifyUISetSpeakerError({currentSink:(null===(d=o)||void 0===d?void 0:d.sinkId)||"default",errorCode:S.Lg.INTERNAL_ERROR,errorMessgae:"AudioPlayer does not exists."}))),n.next=9;break;case 8:n.t0=(Ze.A.updateSelectedSpeakerDevices(a,0,!1),m.Ay.error("Selected output device ID is not available: ".concat(a)),void r.notifyUISetSpeakerError({currentSink:(null===(s=o)||void 0===s?void 0:s.sinkId)||"default",errorCode:null!==(u=o)&&void 0!==u&&u.setSinkId?S.Lg.PARAMATER_INVALID:S.Lg.UNSUPPORTED_BROWSER,errorMessgae:null!==(c=o)&&void 0!==c&&c.setSinkId?"Speaker device is not valid or exists.":"SetSinkId is not supported."}));case 9:return n.abrupt("return",n.t0);case 10:case"end":return n.stop()}}),n)})))()},handleDesktopCapture:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.desktopSharingMediaStream=e,this.sharingCodecInfo={width:0,height:0};var n=this.desktopSharingMediaStream.getAudioTracks()[0];if(n?(Vn.addAudioTrackSettingsMonitor(n,"DesktopAudioCapture"),r||"Tab audio"===n.label||n.label.includes("HDMI")||(g.A.shareSystemAudio=!0),Ze.A.updateShareAudioDevices(n.id,n.label),g.A.Notify_APPUI(p.npe,r),n.onended=function(){K.A.add_monitor("ATRS:"+n.readyState+":"+n.id+":-S")},n.onmute=function(){K.A.add_monitor("ATMS:"+n.muted+":"+n.id+":-S")},n.onunmute=function(){K.A.add_monitor("ATMS:"+n.muted+":"+n.id+":-S")}):g.A.Notify_APPUI(p.pvo,null),K.A.add_monitor("STYPE-".concat((0,h.B0)(null===(t=this.desktopSharingMediaStream)||void 0===t||null===(t=t.getVideoTracks()[0])||void 0===t?void 0:t.label))),!this.localShareCanvasWaiting)if(this.shareTrack=this.desktopSharingMediaStream.getVideoTracks()[0],this.shareTrack){K.A.add_monitor("OSTS"),this.shareTrack.onended=this.onShareStreamEnded.bind(this),this.Start_Desktop_Sharing();var i=this.shareTrack.getSettings(),a=i.width,o=i.height,s=i.displaySurface;g.A.Notify_APPUI(p.p8Y,{width:a,height:o,displaySurface:s})}else m.Ay.error("shareTrack is null when share screen")},handleCaptureError:function(e){this.isDestroy||(this.handleGetDisplayMediaError("An error occurred when trying to capture sharing",e),this.StopSharingCapture(),K.A.add_monitor("SCCF"),"Permission denied by system"===e.message?g.A.Notify_APPUI(p.bjn,null):g.A.Notify_APPUI(p.BSK,null))},handleAudioCapture:function(){if(!this.isDestroy){var e=Vn.getAudioCapabilities(),t=e.deviceId,r=e.elapsed_time,n=e.deviceLabel;if(t&&r&&n&&Ze.A.updateSelectedMicDevices(t,n,r,!0),this.updateFileAudioPlaybackStream(Vn.audioStream),this.useWebRTCAudio&&!this.audioInputLevel){var i,a=ln.hasProcessor()?ln.getStream():Vn.audioStream;return null===(i=this.webrtcAudio)||void 0===i||i.setStreamAsync(a).then((function(e){g.A.ComputerAudioStatus===N.BX.ComputerAudio_Connecting&&(g.A.ComputerAudioStatus=N.BX.ComputerAudio_Connected,g.A.Notify_APPUI(p.Ubu,{microphoneDeviceId:Vn.getAudioDeviceId()}))})),m.Ay.log("user grante audio capture"),void g.A.Notify_APPUI(p.h73,t)}if(!this.audioCtx&&!this.audioInputLevel)return m.Ay.log("no audio context when join computer audio"),g.A.ComputerAudioStatus=N.BX.ComputerAudio_Null,g.A.Notify_APPUI(p.Ubu,null),g.A.Notify_APPUI(p.pHx,null),void Vn.destoryAudioMediaStream();m.Ay.log("user grante audio capture"),g.A.Notify_APPUI(p.h73,t),this.Start_Audio_Capture()}},handleWasmVideoCapture:function(e,t){var r=this;return new Promise(function(){var n=H(O().mark((function n(i,a){var o,s;return O().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return",a(new Error("no stream")));case 2:if(null!==(o=r.videoCaptureWidth)&&void 0!==o||(r.videoCaptureWidth=640),null!==(s=r.videoCaptureHeight)&&void 0!==s||(r.videoCaptureHeight=360),!t.encode||!r.isStartVideoCapture){n.next=17;break}return n.prev=3,n.t0=i,n.next=7,r.Start_Video_Capture();case 7:n.t1=n.sent,(0,n.t0)(n.t1),n.next=14;break;case 11:n.prev=11,n.t2=n.catch(3),m.Ay.error("media stream is ok, but start video capture fail",n.t2),a(new Error("media stream is ok, but start video capture fail"));case 14:r.isMaskSettingOn&&r.MaskSettingVideo&&Vn.playVideoStream(r.MaskSettingVideo),n.next=32;break;case 17:if(!t.preview||!r.isMaskSettingOn&&!r.isVBSettingOn){n.next=31;break}return n.prev=18,n.t3=i,n.next=22,r.startMaskOrVBSettingVideoCapture(e);case 22:n.t4=n.sent,(0,n.t3)(n.t4),n.next=29;break;case 26:n.prev=26,n.t5=n.catch(18),Un("startMaskOrVBSettingVideoCapture",n.t5),a(new Error("media stream is ok, but start setting video capture fail"));case 29:n.next=32;break;case 31:r.isStartVideoCapture||Vn.destoryVideoMediaStream();case 32:case"end":return n.stop()}}),n,null,[[3,11],[18,26]])})));return function(e,t){return n.apply(this,arguments)}}())},handleWebrtcVideoCapture:function(e){var t=this;return new Promise(function(){var r=H(O().mark((function r(n,i){return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e){r.next=2;break}return r.abrupt("return",i(new Error("no stream")));case 2:if(!t.isStartVideoCapture){r.next=16;break}return r.prev=3,r.t0=n,r.next=7,t.video_capture_for_webrtc();case 7:r.t1=r.sent,(0,r.t0)(r.t1),r.next=14;break;case 11:r.prev=11,r.t2=r.catch(3),i(new Error("media stream is ok, but start video capture fail"));case 14:r.next=31;break;case 16:if(!t.isMaskSettingOn&&!t.isVBSettingOn){r.next=30;break}return r.prev=17,r.t3=n,r.next=21,t.startMaskOrVBSettingVideoCapture(e);case 21:r.t4=r.sent,(0,r.t3)(r.t4),r.next=28;break;case 25:r.prev=25,r.t5=r.catch(17),Un("startMaskOrVBSettingVideoCapture",r.t5),i(new Error("media stream is ok, but start setting video capture fail"));case 28:r.next=31;break;case 30:Vn.destoryVideoMediaStream();case 31:case"end":return r.stop()}}),r,null,[[3,11],[17,25]])})));return function(e,t){return r.apply(this,arguments)}}())},startMaskOrVBSettingVideoCapture:function(e){var t=this;return new Promise((function(e,r){try{if(t.isVBSettingOn)if(t.MaskSettingVideo){var n=Vn.playVideoStream(t.MaskSettingVideo);n&&n.then((function(){g.A.Notify_APPUI(p.AjI,null)})).catch((function(e){r(new Error("media stream is ok, but video.play() fail")),m.Ay.error("An error occurred when trying to play video in Background Setting tab",e),K.A.add_monitor("VBVPF")}))}else g.A.Notify_APPUI(p.AjI,null);else if(t.isMaskSettingOn)if(t.MaskSettingVideo){var i=Vn.playVideoStream(t.MaskSettingVideo);i&&i.then((function(){g.A.Notify_APPUI(p.i8,null)})).catch((function(e){r(new Error("media stream is ok, but video.play() fail")),m.Ay.error("An error occurred when trying to play video in Background Setting tab",e),K.A.add_monitor("MVPF")}))}else g.A.Notify_APPUI(p.i8,null);t.webrtcConfig.webrtcflag||(t.addChannelForVideo(),_.Notify_Video_Encode_Thread({command:"startvideointerval",width:t.videoCaptureValue.width,height:t.videoCaptureValue.height,ssid:t.videoCaptureValue.ssid,mtu_size:t.mtu_size,fps:t.GetVideoCaptureFps(),isSupportMediaStreamTrackProcessor:t.isSupportMediaStreamTrackProcessor,isSupport2DCanvasDrawFrame:t.isSupport2DCanvasDrawFrame,isVBSettingOn:t.isVBSettingOn,isMaskSettingOn:t.isMaskSettingOn,isSupportVideoFrame:t.isVideoTagFrameAccessible})),e(!0)}catch(e){m.Ay.error("Starting mask or virtual background failed",e),r(e)}}))},handleGetDisplayMediaError:function(e,t){var r={AbortError:"error",InvalidStateError:"error",NotAllowedError:"warn",NotFoundError:"warn",NotReadableError:"warn",OverconstrainedError:"warn",TypeError:"error"}[t.name]||"error";m.Ay[r](e,t)},handleGetUserMediaError:function(e,t){var r={NotAllowedError:"warn",NotFoundError:"warn",NotReadableError:"warn",OverconstrainedError:"warn",SecurityError:"warn",SourceUnavailableError:"warn",PermissionDeniedError:"warn",AbortError:"error",TypeError:"error"}[t.name]||"error";m.Ay[r](e,t)},analyserCaptureReason:function(e){var t=jn(e);"NotAllowedError"===(null==e?void 0:e.name)&&"hidden"===document.visibilityState&&(document.removeEventListener("visibilitychange",Fn),document.addEventListener("visibilitychange",Fn)),K.A.add_monitor("HADF: "+(null==e?void 0:e.name)+"-"+(null==t?void 0:t.errorCode)),g.A.Notify_APPUI(p.qUx,t)},handleAudioError:function(e){this.handleGetUserMediaError("Error occurred when trying to capture audio",e),this.analyserCaptureReason(e),g.A.ComputerAudioStatus===N.BX.ComputerAudio_Connecting&&(g.A.ComputerAudioStatus=N.BX.ComputerAudio_Null,g.A.Notify_APPUI(p.Ubu,null),g.A.Notify_APPUI(p.pHx,null))},handleVideoError:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(_.AssertMediaSdkNotDestory(this,"videocaptureerror")){if(t)return K.A.add_monitor("GUMF"),void this.handleGetUserMediaError("Error occurred when trying to capture video with normal constraints",e);this.isMaskSettingStarted=!1,this.isCurrentInMaskStatus=!1,this.isCurrentInNoVBPreviewStatus=!1,Un("handleVideoError",e);var r=(null==e?void 0:e.name)||"other error",n="Error ".concat((null==e?void 0:e.message)||"");K.A.add_monitor("STARTVIDEOERR:".concat(r,"-").concat(n)),e instanceof S.iG||e.name&&-1!==["NotReadableError","SourceUnavailableError"].indexOf(e.name)?(K.A.add_monitor("COCPEF"),g.A.Notify_APPUI(p.EWx,e)):(K.A.add_monitor("HVDF"),g.A.Notify_APPUI(p.nEg,e)),this.handleGetUserMediaError("Error occurred when trying to capture video",e),this.Stop_Video_Capture()}else m.Ay.error("VideoCaptureException VideoError, JsMediaSDK instance destroyed",e)},chromeAecWorkAround:function(){var e=H(O().mark((function e(t){var r,n,i,a,o,s,u,c,d;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(K.A.add_monitor("ASCAEC"),!this.rtcConnectionA&&!this.rtcConnectionB){e.next=2;break}return e.abrupt("return",!1);case 2:return i=null,a=null,o=new MediaStream,i=new RTCPeerConnection,a=new RTCPeerConnection,i.onicecandidate=function(e){return e.candidate&&a.addIceCandidate(new RTCIceCandidate(e.candidate))},a.onicecandidate=function(e){return e.candidate&&i.addIceCandidate(new RTCIceCandidate(e.candidate))},a.ontrack=function(e){e.streams[0].getTracks().forEach((function(e){o.addTrack(e)}))},i.addStream(t),e.next=11,i.createOffer({offerVideo:!0,offerAudio:!0,offerToReceiveAudio:!1,offerToReceiveVideo:!1});case 11:return r=e.sent,s=!1,u=null,c=null,d=h.Ay.getBrowserVersion(),e.prev=13,c=r.sdp,u=d>=104?(u=r.sdp.replace("SAVPF 111","SAVPF 100 111")).replace("a=rtpmap:111 opus/48000/2","a=rtpmap:100 L16/48000\na=rtpmap:111 opus/48000/2"):(u=r.sdp.replace("SAVPF 111","SAVPF 10 111")).replace("a=rtpmap:111 opus/48000/2","a=rtpmap:10 L16/48000\na=rtpmap:111 opus/48000/2"),r.sdp=u,e.next=19,i.setLocalDescription(r);case 19:return e.next=21,a.setRemoteDescription(r);case 21:e.next=31;break;case 23:return e.prev=23,e.t0=e.catch(13),s=!0,r.sdp=c,e.next=29,i.setLocalDescription(r);case 29:return e.next=31,a.setRemoteDescription(r);case 31:return e.next=33,a.createAnswer();case 33:return n=e.sent,s||(d>=104?(n.sdp=n.sdp.replace("SAVPF 111","SAVPF 100 111"),n.sdp=n.sdp.replace("a=rtpmap:111 opus/48000/2","a=rtpmap:100 L16/48000\na=rtpmap:111 opus/48000/2")):(n.sdp=n.sdp.replace("SAVPF 111","SAVPF 10 111"),n.sdp=n.sdp.replace("a=rtpmap:111 opus/48000/2","a=rtpmap:10 L16/48000\na=rtpmap:111 opus/48000/2"))),e.next=37,a.setLocalDescription(n);case 37:return e.next=39,i.setRemoteDescription(n);case 39:return this.rtcConnectionA=i,this.rtcConnectionB=a,e.abrupt("return",o);case 42:case"end":return e.stop()}}),e,this,[[13,23]])})));return function(t){return e.apply(this,arguments)}}(),switchCanvasForVideoCapture:function(e){var t=[].concat(e),r=t[0];if(this.captureVideoOutputCanvasDomList=t,this.videoCaptureValue.canvasCtrl=r,!this.isSupportVideoFrameOrBitmapCapture){var n=this.videoCaptureValue.videoCtrl.videoWidth,i=this.videoCaptureValue.videoCtrl.videoHeight;t.forEach((function(e){e.width=n,e.height=i})),this.videoCaptureValue.canvasCtrl.width=n,this.videoCaptureValue.canvasCtrl.height=i,this.videoCaptureContext=r.getContext("2d")}},switchVideoTagForVideoCapture:function(e){var t;if(this.videoCaptureValue&&e!==this.videoCaptureValue.videoCtrl){null!==(t=this.videoloadmetadataListener)&&void 0!==t&&t.remove&&(this.videoloadmetadataListener.remove(),this.videoloadmetadataListener=null);var r=this.videoCaptureValue.videoCtrl;r&&!this.selfPreviewVideotagList.includes(r)&&Vn.removeVideoStream(r),this.videoCaptureValue.videoCtrl=e,this.captureVideoOutPutVideoDom=e,this.isVideoCaptureLoadedmetadata||(m.Ay.warn("isVideoCaptureLoadedmetadata is false ,need to reloaded"),this._addVideoLoadedmetadataListener(e)),Vn.playVideoStream(e)}},videoDecodeFrameBackSABRingBufferConsumeCallback:function(e){var t=new Ke.nC;t.setBuffer(e);var r=t.buffer2Obj();_.Put_Video_Frame_Buffer(r.video_ssrc,r.data,r.video_timestamp,r.video_width,r.video_height,r.rendering_x,r.rendering_y,r.rendering_w,r.rendering_h,r.rotation,r.yuv_limited),this.VideoRenderObj.JsMediaSDK_VideoRender.bind(this.VideoRenderObj)()},CheckCurrentActiveSSRC:function(e){this.currentactive!=e&&(this.currentactive=e,g.A.CurrentSSRC=this.currentactive,g.A.decoderinworklet?g.A.AudioNode&&g.A.AudioNode.postCMD("currentSSRC",g.A.CurrentSSRC):_.Notify_Audio_Thread_CurrentSSRC(g.A.CurrentSSRC))},createVideoElement:function(){this.MaskSettingVideo||(this.videoCaptureValue&&this.videoCaptureValue.videoCtrl?this.MaskSettingVideo=this.videoCaptureValue.videoCtrl:(this.MaskSettingVideo=function(){var e=document.createElement("video");return e.setAttribute("muted",""),e.setAttribute("playsinline",""),e}(),h.Ay.browser.isSafari&&(this.MaskSettingVideo.setAttribute("style","position:fixed;top:-10000px;left:-10000px;"),document.body.appendChild(this.MaskSettingVideo))))},changeVideoRenderActiveSsrc:function(e){if(!this.webrtcConfig.webrtcflag)if(this.RenderInMain==z.u){var t=g.A.SPECIAL_ID;if(g.A.localVideoDecMGR){var r=g.A.localVideoDecMGR.map.get(t);if(r){var n={command:"CHANGE_CURRENT_ACTIVE_SSRC",ssrc:e};r.postMessage(n)}}}else this.RenderInMain==z.tD&&this.VideoRenderObj.Change_Current_SSRC(e)},addChannelForVideo:function(){var e,t;if(!this.vcFlag){this.waitingVcChannelReady=!0;var r=g.A.SPECIAL_ID;if(null!==(e=g.A.localVideoDecMGR)&&void 0!==e&&e.map.get(r)&&null!==(t=g.A.localVideoEncMGR)&&void 0!==t&&t.map.get(r)){this.waitingVcChannelReady=!1,this.vcFlag=!0;var n=new MessageChannel;_.Notify_Video_Thread_Msg_Channel(n,n)}}},checkIsRenderInWorker:function(){return this.isMultiView||this.isSupportVideoFrameOrBitmapCapture||g.A.enableVirtualBackgroundWithoutSAB||(0,h.uF)()&&"undefined"!=typeof SharedArrayBuffer&&h.Ay.isSafariVersionHigherThan("17.5")||Ve.X.isUseSsrcStream()},setMultiView:function(e,t){var r=e>1,n=(0,h.uF)(),i=!!h.Ay.isWebGL2Supported(this.isWebGL2FeatureEnabled),a="function"==typeof OffscreenCanvas;this.isMultiView=r&&(n||i||Ve.X.isUseSsrcStream()),m.Ay.directReport("JsMediaSDK-SetMultiView() isMultiView:".concat(this.isMultiView||t,",\n      docodeThreadNumber:").concat(e,",\n      isWebGLSupported:").concat(n,",\n      isWebGL2Supported:").concat(i,",\n      isUseSsrcStream:").concat(Ve.X.isUseSsrcStream(),",\n      isOffscreenCanvasSupported:").concat(a,",\n      enableMultiDecodeVideoWithoutSAB:").concat(t))},start_capture_video_wasm:function(e){if(_.Update_Video_Encrpt(g.A.e2eencrypt),this.addChannelForVideo(),this.videoCaptureHiddenCanvas||this.isSupportVideoFrameOrBitmapCapture||(this.videoCaptureHiddenCanvas=h.Ay.isSupport2dOffscreenCanvas()?new OffscreenCanvas(640,360):document.createElement("canvas"),this.videoCaptureHiddenCanvasCtx=this.videoCaptureHiddenCanvas.getContext("2d")),!_.isVideoEncodeHandleReady())return Un.warn("not isVideoEncodeHandleReady so return"),void K.A.add_monitor("not isVideoEncodeHandleReady so return");K.A.add_monitor("STARTVIDEO:".concat(this.isStartVideoCapture)),this.isStartVideoCapture?m.Ay.warn("video capture is already started, do not call again."):(this.VALUE_CACHE_FOR_START_CAPTURE_VIDEO=Object.assign({},e),this.isStartVideoCapture=!0,this.isSupportMediaStreamTrackProcessor?(e.canvas instanceof Array?e.canvas[0]:e.canvas,h.Ay.isSelfPreviewRenderWithVideo()&&h.Ay.isSupportVideoFrameOrBitmapCapture()?(e.video?e.videoCtrl=(0,h.e5)(e.video).dom:this.selfPreviewVideotagList.length&&(e.videoCtrl=this.selfPreviewVideotagList[this.selfPreviewVideotagList.length-1]),this.isSelfViewWithVideo=!0):(this.MaskSettingVideo||this.createVideoElement(),e.videoCtrl=this.MaskSettingVideo)):(e.canvasCtrlList=[],e.canvasCtrl=this.videoCaptureHiddenCanvas,h.Ay.isSelfPreviewRenderWithVideo()&&(e.video||this.selfPreviewVideotagList.length)?(e.video?e.videoCtrl=(0,h.e5)(e.video).dom:this.selfPreviewVideotagList.length&&(e.videoCtrl=this.selfPreviewVideotagList[this.selfPreviewVideotagList.length-1]),this.isSelfViewWithVideo=!0):(h.Ay.browser.isSafari,this.MaskSettingVideo||this.createVideoElement(),e.videoCtrl=this.MaskSettingVideo)),this.ReadyCapureWidth=e.width?e.width:640,this.ReadyCapureHeight=e.width?e.height:360,this.captureVideoOutPutVideoDom=e.videoCtrl,this.videoCaptureValue=e,this.videoCaptureValue.ssid&&(g.A.localSsrc=this.videoCaptureValue.ssid),this.Start_Video_Capture())},start_capture_video_webrtc:function(e){K.A.add_monitor("STARTVIDEO:".concat(this.isStartVideoCapture)),this.isStartVideoCapture?m.Ay.warn("video capture is already started, do not call again."):(this.VALUE_CACHE_FOR_START_CAPTURE_VIDEO=Object.assign({},e),this.isStartVideoCapture=!0,e.videoCtrl=e.video?(0,h.e5)(e.video).dom:null,this.captureVideoOutPutVideoDom=e.videoCtrl,this.videoCaptureValue=e,this.videoCaptureValue.ssid&&(g.A.localSsrc=this.videoCaptureValue.ssid),this.wmscManager&&(this.wmscManager.captureFramerate=this.videoCaptureValue.fps,this.wmscManager.sendMessageToWMSC({type:"UPDATE_WMSC_PARAMS",data:{maxEncodingFramerate:this.videoCaptureValue.fps}})),this.Start_Video_Capture())},add_render_video_wasm:function(){var e=H(O().mark((function e(t){var r,n,i,a,o,s,u,c,d,l,f,p,v,y,S,A,b,E,k,C=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=0,Object.assign(t,this.videoWaterMarkParams),void 0===t.isMyself&&(t.isMyself=this.userId&&this.userId>>10==t.userId>>10),!(h.Ay.isSelfPreviewRenderWithVideo()&&this.videoCaptureValue&&(0,h.XF)(parseInt(t.userId))==(0,h.XF)(this.videoCaptureValue.ssid)&&t.videodom)){e.next=3;break}return e.abrupt("return",(Vn.playVideoStream(t.videodom),this.selfPreviewVideotagList.includes(t.videodom)||this.selfPreviewVideotagList.push(t.videodom),void(this.isSupportMediaStreamTrackProcessor&&!h.Ay.isSupportVideoFrameOrBitmapCapture()||(this.videoCaptureValue.videoCtrl=t.videodom,this.isSelfViewWithVideo=!0))));case 3:if(t.ssrc=t.userId,t.canvas=(0,h.e5)(t.canvas).dom,t.canvas){e.next=5;break}return e.abrupt("return",void m.Ay.error("ADDRENDERERR :".concat(t.userId,", canvas:").concat(t.canvas)));case 5:if(!(n=g.A.browserFeature)){e.next=32;break}if(tn.X.addRenderCanvas(t.canvas.id,t.canvas),t.x=Math.floor(t.x),t.y=Math.floor(t.y),t.width=Math.floor(t.width),t.height=Math.floor(t.height),this.isCreateVideoWaterMark=t.enableWaterMark,this.videoWaterMarkName=this.isCreateVideoWaterMark?t.waterMarkText:"",this.isMultiView||t.isMyself||this.CheckCurrentActiveSSRC(t.ssrc),this.isLSSPlayer&&this.VideoRenderObj&&this.VideoRenderObj.Remove_Pause(t),!this.checkIsRenderInWorker()||!n.isSupportOffScreenCanvasWebgl()&&!Ve.X.isUseSsrcStream()){e.next=14;break}a=h.I4.getIsRenderSelfVideoInEncodeWorker(g.A.localSsrc&&(0,h.XF)(t.ssrc)===(0,h.XF)(g.A.localSsrc)),o=a?g.A.localVideoEncMGR:g.A.localVideoDecMGR,s=g.A.SPECIAL_ID,u=null===(i=t.canvas)||void 0===i?void 0:i.id,this.replaceCanvasMap.videoDecodeCanvasIds||(this.replaceCanvasMap.videoDecodeCanvasIds=[]),this.replaceCanvasMap.videoEncodeCanvasIds||(this.replaceCanvasMap.videoEncodeCanvasIds=[]),a?-1===this.replaceCanvasMap.videoEncodeCanvasIds.indexOf(u)&&this.replaceCanvasMap.videoEncodeCanvasIds.push(u):-1===this.replaceCanvasMap.videoDecodeCanvasIds.indexOf(u)&&this.replaceCanvasMap.videoDecodeCanvasIds.push(u);try{o&&(c=o.map.get(s))&&(d=t.canvas.transferControlToOffscreen(),l={command:"renderOfflineCanvas",ssrc:t.ssrc,rendercanvasID:u,canvas:d,isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName,waterMarkText:t.waterMarkText,watermarkOpacity:t.watermarkOpacity,watermarkRepeated:t.watermarkRepeated,watermarkPosition:t.watermarkPosition,x:t.x,y:t.y,width:t.width,height:t.height,zone:t.zone,fillMode:t.fillMode,fillModeForResolution:t.fillModeForResolution,borderRadius:t.borderRadius},c.postMessage(l,[d]))}catch(e){o&&(f=o.map.get(s))&&(p={command:"renderOfflineCanvas",rendercanvasID:u,ssrc:t.ssrc,videoWaterMarkName:this.videoWaterMarkName,isCreateVideoWaterMark:this.isCreateVideoWaterMark,waterMarkText:t.waterMarkText,watermarkOpacity:t.watermarkOpacity,watermarkRepeated:t.watermarkRepeated,watermarkPosition:t.watermarkPosition,x:t.x,y:t.y,width:t.width,height:t.height,zone:t.zone,fillMode:t.fillMode,fillModeForResolution:t.fillModeForResolution,borderRadius:t.borderRadius},f.postMessage(p))}this.RenderInMain===z.p$&&(this.RenderInMain=z.u),this.currentactive&&this.changeVideoRenderActiveSsrc(this.currentactive),e.next=28;break;case 14:if(t.isMyself||_.Notify_Video_Decode_Thread({command:"RenderInMain"}),y=null===(v=t.canvas)||void 0===v?void 0:v.id,!this.videoRenderArray.length){e.next=24;break}r=0;case 18:if(!(r<this.videoRenderArray.length)){e.next=24;break}if(this.videoRenderArray[r].ssrc!=t.ssrc||this.videoRenderArray[r].zone!=t.zone){e.next=21;break}return e.abrupt("return");case 21:r++,e.next=18;break;case 24:t.rendercanvasID=y,t.borderRadius&&(A=ue(t.borderRadius,t.width,t.height),t.borderRadius=A,null===(S=t.display)||void 0===S||S.setRoundedCornerRadius(A)),this.videoRenderArray.push(t),this.VideoRenderObj||(this.VideoRenderObj=new ge(Object.assign({},Ln(Ln({Notify_APPUI:g.A.Notify_APPUI.bind(g.A),isSupportOffscreenCanvas:!1,jsMediaEngine:_},g.A.enableMultiDecodeVideoWithoutSAB?{videodecodethreadnumb:z.yC}:{videodecodethreadnumb:(0,h.OC)()}),{},{globalTracingLogger:m.Ay,monitorLoggerFn:K.A.add_monitor,renderManager:this.renderManager,isLSSPlayer:this.isLSSPlayer}))),null!=this&&null!==(b=this.videoCaptureValue)&&void 0!==b&&b.ssid&&(null===(E=this.VideoRenderObj)||void 0===E||E.Set_LocalVideo_SSRC(this.videoCaptureValue.ssid),mn.setLocalVideoSsrc(this.videoCaptureValue.ssid))),this.activeSpeakerSsrc&&(this.VideoRenderObj.setActiveSpeakerSsrc(this.activeSpeakerSsrc),mn.setActiveSpeakerSsrc(this.activeSpeakerSsrc)),t.canvasList&&t.canvasList.forEach((function(e){C.videoRenderArray.push(Object.assign({},t,{canvas:e}))})),Un("Start_Video_Play"),this.Start_Video_Play(),k=g.A.enableMultiDecodeVideoWithoutSAB||h.Ay.isSupportMultiViewAPI(),this.VideoRenderObj.Set_Render_Array(this.videoRenderArray,k),this.isCreateVideoWaterMark&&!this.waterMarkCanvas&&(this.waterMarkCanvas=document.createElement("canvas")),this.VideoRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName,watermarkOpacity:t.watermarkOpacity,watermarkRepeated:t.watermarkRepeated,watermarkPosition:t.watermarkPosition}),this.RenderInMain===z.p$&&(this.RenderInMain=z.tD),this.currentactive&&this.changeVideoRenderActiveSsrc(this.currentactive);case 28:return e.next=30,_.UpdateVideoPlayStatus(!0);case 30:e.next=33;break;case 32:m.Ay.error("video decode init not completed");case 33:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),add_render_video_webrtc:function(){var e=H(O().mark((function e(t){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.wmscManager&&this.wmscManager.sendMessageToWMSC({type:"NOTIFY_WMSC_VIDEO_TAG_MAPPING",data:Ln(Ln({},t),{},{action:"add"})});case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),stop_render_video_wasm:function(){var e=H(O().mark((function e(t){var r,n,i,a,o,s;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h.Ay.isSelfPreviewRenderWithVideo()&&t.videodom&&(r=this.selfPreviewVideotagList.indexOf(t.videodom))>=0&&(this.selfPreviewVideotagList.splice(r,1),this.videoCaptureValue&&this.videoCaptureValue.videoCtrl===t.videodom&&this.selfPreviewVideotagList.length?this.switchVideoTagForVideoCapture(this.selfPreviewVideotagList[this.selfPreviewVideotagList.length-1]):this.isStartVideoCapture||Vn.removeVideoStream(t.videodom)),"string"!=typeof t.canvas&&(t.canvas=null===(n=t.canvas)||void 0===n?void 0:n.id),this.videoWaterMarkName="",this.isCreateVideoWaterMark=!1,t.ssrc=t.userId,i=g.A.browserFeature){if(this.checkIsRenderInWorker()&&i.isSupportOffScreenCanvasWebgl()&&(h.I4.getIsRenderSelfVideoInEncodeWorker(g.A.localSsrc&&(0,h.XF)(t.ssrc)===(0,h.XF)(g.A.localSsrc))?_.Notify_Video_Encode_Thread:_.Notify_Video_Decode_Thread)({command:"stopVideoRender",ssrc:t.ssrc,canvas:t.canvas,RGBA:t.RGBA,doNotClean:t.doNotClean,x:t.x,y:t.y,zone:t.zone}),this.videoRenderArray.length)for(a=0;a<this.videoRenderArray.length;a++)this.videoRenderArray[a].ssrc==t.ssrc&&this.videoRenderArray[a].zone==t.zone&&(this.isLSSPlayer?t.doNotClean?(this.VideoRenderObj.Add_Pause(t),this.VideoRenderObj.Draw_Last_Frame()):(o=this.videoRenderArray.splice(a,1),this.VideoRenderObj.clearUseridRender(o,t.RGBA),this.VideoRenderObj.Set_Render_Array(this.videoRenderArray,g.A.enableMultiDecodeVideoWithoutSAB),g.A.enableMultiDecodeVideoWithoutSAB&&this.VideoRenderObj.GiveBack_Display(o)):(s=this.videoRenderArray.splice(a,1),this.StopUserVideoRender(this.VideoRenderObj,s,t.RGBA,!t.doNotClean)))}else m.Ay.error("video decode init not completed");case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),stop_render_video_webrtc:function(e){this.wmscManager&&this.wmscManager.sendMessageToWMSC({type:"NOTIFY_WMSC_VIDEO_TAG_MAPPING",data:Ln(Ln({},e),{},{action:"remove"})})},getAudioNode:function(){return this.isLSSPlayer&&this.gainNode?g.A.AudioNode.connect(this.gainNode):g.A.AudioNode},Notify_MeidaSDK:function(){var e=H(O().mark((function e(t,r){var i,a,o,s,u,c,d,f,v,y,A,b,k,C,w,T,R,I,D,M,P,L,V,U,F,W,j,q,Y,X,Q,J,$,Z,ee,te,re,ne,ie,ae,oe,se,ce,de,le,he,fe,pe,ve,me,ye,Se,Ae,be,Ee,ke,Ce,we,Te,Re,De,Me,Oe,xe,Pe,Le,Ue,Fe,Be,We,Ge,He,je,Ke,qe,Xe,Qe,Je,$e,et,tt,rt,nt,it,at,ot,st,ut,ct,dt,lt,ht,ft,pt,vt,gt,mt,yt,_t,St,At,bt,Et,kt,Ct,wt,Tt,Rt,It,Dt,Mt,Ot,xt,Pt,Lt,Nt,Vt,Ut,Ft,Bt,Wt,Gt,Ht,jt,Kt,zt,qt,Yt,Xt,Qt,Jt,$t,Zt,er,tr,rr,nr,ir,ar,or,sr,ur,cr,dr,lr,fr,pr,vr,gr,mr,yr,_r,Sr,Ar,br,Er,kr,Cr,wr,Rr,Ir,Dr,Or,xr,Pr,Lr,Nr,Vr,Ur,Fr,Wr,Gr,Hr,jr,Kr,zr,qr,Yr,Xr,Qr,Jr,$r,Zr,en,rn,nn,an,on,cn,dn,ln,hn,fn,pn,vn,gn,yn,_n,Sn,An,bn,En,kn,Cn,wn,Tn,Rn,In,Dn,Mn,xn,Pn,Nn,Bn,Wn,Gn,Hn,jn,Kn,zn,qn,Yn,Xn,Qn,Jn,$n,Zn,ei,ti,ri,ni=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Un(t,r),i=0,e.t0=(K.A.add_monitor2("B"+t),t),e.next=e.t0===p.RJ8?5:e.t0===p.ziT?40:e.t0===p.hcn?53:e.t0===p.rpL?56:e.t0===p.a$m?59:e.t0===p._Nl?62:e.t0===p.O06?95:e.t0===p.aYB?98:e.t0===p.GtU?121:e.t0===p.g$j?148:e.t0===p.XHL?152:e.t0===p.wIu?154:e.t0===p.K3m?156:e.t0===p.tm0?158:e.t0===p.EYN?160:e.t0===p.BqC?164:e.t0===p.r2c?175:e.t0===p.PSY?182:e.t0===p.QoY?190:e.t0===p.CpQ?200:e.t0===p.X0s?208:e.t0===p.Ikw?214:e.t0===p.CQt?218:e.t0===p._Gi?220:e.t0===p.HKK?222:e.t0===p.lyw?224:e.t0===p.wk9?227:e.t0===p.pOT?229:e.t0===p.n7n?231:e.t0===p.tN9?233:e.t0===p.MP_?235:e.t0===p.HVQ?237:e.t0===p.A3p?239:e.t0===p.m1Q?241:e.t0===p.cJy?246:e.t0===p.exH||e.t0===p.uiF?260:e.t0===p.g8Z?261:e.t0===p.i9k?268:e.t0===p.Aew?270:e.t0===p.XE6?305:e.t0===p.K9M?309:e.t0===p.QQs?313:e.t0===p.Qc?315:e.t0===p.RmE?317:e.t0===p._Zs?319:e.t0===p.I8$?321:e.t0===p.hs?323:e.t0===p.eEQ?325:e.t0===p.Mhb?327:e.t0===p.tav?329:e.t0===p.UGN?351:e.t0===p.rSS?502:e.t0===p.u1v?542:e.t0===p.Sed?548:e.t0===p.YD4?551:e.t0===p.j4N?552:e.t0===p.rcl?554:e.t0===p.gle?556:e.t0===p.kQe?559:e.t0===p.bSz?561:e.t0===p.X10?567:e.t0===p.XbU?571:e.t0===p.s8N?575:e.t0===p.iDK?579:e.t0===p.m7W?583:e.t0===p.M5B?589:e.t0===p.bKC?593:e.t0===p.uxR?596:e.t0===p.X1W?609:e.t0===p.YTV?611:e.t0===p.ovL?616:e.t0===p.KYx?618:e.t0===p.wYI?620:e.t0===p.qnv?622:e.t0===p.VxP?624:e.t0===p.DCT?638:"update_videohd_value"===e.t0?646:"update_videofullhd_value"===e.t0?648:e.t0===p.fAR?650:e.t0===p.P79?652:e.t0===p.AmQ?654:e.t0===p.yHE?656:e.t0===p.pn7?658:e.t0===p.i0n?660:e.t0===p.i9w?662:e.t0===p.aE$?665:e.t0===p._7f?667:e.t0===p.qmK?669:e.t0===p.zby?671:e.t0===p.rME?673:e.t0===p.SUv?675:e.t0===p.jCp?677:e.t0===p.PcV?684:e.t0===p.TB5?705:e.t0===p.PMP?707:e.t0===p.f8O?709:e.t0===p.U_k?711:e.t0===p.ZIm?713:e.t0===p.rwH?715:e.t0===p.QyH?717:e.t0===p.WP5?719:e.t0===p.fxd?721:e.t0===p.V36?723:e.t0===p.lOl?726:e.t0===p.TSA?728:e.t0===p.l8t?732:e.t0===p.sCk?734:e.t0===p.ee7?736:e.t0===p.oFc?739:e.t0===p.t4x?741:e.t0===p.kPo?743:e.t0===p.TRD?745:e.t0===p.xlY?747:e.t0===p.naM?749:e.t0===p.cjy?759:762;break;case 5:if(r.id&&this.vbSettingDomMap[r.id]&&Object.assign(r,this.vbSettingDomMap[r.id]),(c=this).isVBSettingOn=!0,c.isCurrentInMaskStatus=!1,d=null!==(a=r.width)&&void 0!==a?a:640,f=null!==(o=r.height)&&void 0!==o?o:360,null!==(s=c.videoCaptureWidth)&&void 0!==s||(c.videoCaptureWidth=d),null!==(u=c.videoCaptureHeight)&&void 0!==u||(c.videoCaptureHeight=f),this.webrtcConfig.webrtcflag?r.videodom&&this.wmscManager&&(this.wmscManager.vbSettingVideoDom=r.videodom):_.Notify_Video_Encode_Thread({command:"StartVBSetting"}),K.A.add_monitor(r.bgdom?"VBON":"VBOFF"),!r.bgdom){e.next=18;break}if(this.VBMFlag||(this.VBMFlag=!0,K.A.send_monitor_directly(z.QU)),"blur"!=r.bgdom){e.next=12;break}this.webrtcConfig.webrtcflag?Vn.changeVBImage("blur"):_.Notify_Video_Encode_Thread({command:"vbbgimagebitmap",data:r.bgdom}),e.next=16;break;case 12:if((v=(0,h.e5)(r.bgdom).dom)&&v.naturalWidth&&v.naturalHeight){e.next=15;break}return e.abrupt("return",(K.A.add_monitor("VBGF"),void g.A.Notify_APPUI(p.KqK,2)));case 15:c.BgImage=v,createImageBitmap(v).then((function(e){ni.webrtcConfig.webrtcflag?Vn.changeVBImage(e):_.transportVBBgImageBitMap(e,"BgImage")})).catch((function(e){K.A.add_monitor("VBCF"),g.A.Notify_APPUI(p.KqK,2)}));case 16:e.next=19;break;case 18:this.webrtcConfig.webrtcflag?Vn.isVBEnabled&&Vn.disableVB():_.transportVBBgImageBitMap(null,"BgImage");case 19:if(!r.canvas){e.next=32;break}if(y=(0,h.e5)(r.canvas),A=y.id,b=y.dom,!this.webrtcConfig.webrtcflag){e.next=25;break}this.wmscManager&&(this.wmscManager.vbSettingVideoDom=b),e.next=32;break;case 25:if(h.Ay.isSupportOffscreenCanvas()&&(!h.Ay.browser.isSafari||h.Ay.isIphoneOrIpadBrowser()||h.Ay.isSafariVersionHigherThan("17.4"))){e.next=29;break}c.isCurrentInNoVBPreviewStatus=!0,c.videoNoVBPreviewCanvas=b,e.next=32;break;case 29:if(c.VideoVBSettingCanvas=b,!(!c.VideoVBSettingCanvas||c.VideoVBSettingCanvas.width<=0||c.VideoVBSettingCanvas.height<=0)){e.next=31;break}return e.abrupt("return",(K.A.add_monitor("VBCAF"),void g.A.Notify_APPUI(p.KqK,3)));case 31:try{k=c.VideoVBSettingCanvas.transferControlToOffscreen(),_.transportSettingCanvas(k,"VBOfflineCanvas",A)}catch(e){_.transportSettingCanvas(null,"VBOfflineCanvas",A)}case 32:if(c.isSupportVideoFrameOrBitmapCapture||(c.createVideoElement(),c.videoCaptureHiddenCanvas||(c.videoCaptureHiddenCanvas=h.Ay.isSupport2dOffscreenCanvas()?new OffscreenCanvas(640,360):document.createElement("canvas"),c.videoCaptureHiddenCanvasCtx=c.videoCaptureHiddenCanvas.getContext("2d"))),!Vn.shouldCaptureVideo()){e.next=38;break}if(_.isVideoEncodeHandleReady()||this.webrtcConfig.webrtcflag){e.next=35;break}return e.abrupt("return",(Un.warn("not isVideoEncodeHandleReady so return"),void K.A.add_monitor("not isVideoEncodeHandleReady so return")));case 35:null!=r&&r.fps||null!==(C=c.videoCaptureValue)&&void 0!==C&&C.fps||(r.fps=z.Fw),c.videoCaptureValue?c.videoCaptureValue=Object.assign(c.videoCaptureValue,r):c.videoCaptureValue=r,this.wmscManager&&(this.wmscManager.captureFramerate=c.videoCaptureValue.fps),c.videoCaptureValue.ssid&&(g.A.localSsrc=c.videoCaptureValue.ssid),c.StartVideoMediaCapture(),e.next=39;break;case 38:c.MaskSettingVideo&&Vn.playVideoStream(c.MaskSettingVideo);case 39:return e.abrupt("break",763);case 40:if(K.A.add_monitor(r.bgdom?"VBON":"VBOFF"),!r.bgdom){e.next=51;break}if(this.VBMFlag||(this.VBMFlag=!0,K.A.send_monitor_directly(z.QU)),"blur"!=r.bgdom){e.next=45;break}this.webrtcConfig.webrtcflag?Vn.changeVBImage("blur"):_.Notify_Video_Encode_Thread({command:"vbbgimagebitmap",data:r.bgdom}),e.next=49;break;case 45:if((w=(0,h.e5)(r.bgdom).dom)&&w.width&&w.height){e.next=48;break}return e.abrupt("return",(K.A.add_monitor("VBGF"),void g.A.Notify_APPUI(p.KqK,2)));case 48:this.BgImage=w,createImageBitmap(w).then((function(e){ni.webrtcConfig.webrtcflag?Vn.changeVBImage(e):_.transportVBBgImageBitMap(e,"BgImage")})).catch((function(e){K.A.add_monitor("VBCF"),g.A.Notify_APPUI(p.KqK,2)}));case 49:e.next=52;break;case 51:this.BgImage=null,this.webrtcConfig.webrtcflag?Vn.isVBEnabled&&Vn.disableVB():_.transportVBBgImageBitMap(null,"BgImage");case 52:return e.abrupt("break",763);case 53:return(!h.Ay.isSupportOffscreenCanvas()||h.Ay.browser.isSafari&&!h.Ay.isSafariVersionHigherThan("17.4"))&&(this.isCurrentInNoVBPreviewStatus=!1,this.videoNoVBPreviewCanvas&&(this.videoNoVBPreviewCanvasctx&&(this.videoNoVBPreviewCanvasctx.setTransform(1,0,0,1,0,0),this.videoNoVBPreviewCanvasctx.clearRect(0,0,this.videoNoVBPreviewCanvas.width,this.videoNoVBPreviewCanvas.height),this.videoNoVBPreviewCanvasctx=null),this.videoNoVBPreviewCanvas=null),this.isVideoNoVBPreviewCanvasScaled=!1),this.isVBSettingOn=!1,r.isSwitch&&(this.isMaskSettingOn=!0,this.webrtcConfig.webrtcflag||_.Notify_Video_Encode_Thread({command:"StartMaskSetting",isSwitch:r.isSwitch,enabled:this.isSupportVideoFrameOrBitmapCapture})),this.webrtcConfig.webrtcflag?this.wmscManager&&((this.wmscManager.vbSettingVideoDom||{}).isConnected&&(this.wmscManager.vbSettingVideoDom.srcObject=null),this.wmscManager.vbSettingVideoDom=null):_.Notify_Video_Encode_Thread({command:"finishVBSetting"}),this.isStartVideoCapture||this.isMaskSettingOn||this.Stop_Video_Capture(),this.MaskSettingVideo&&this.MaskSettingVideo.pause(),e.abrupt("break",763);case 56:return T=r.id,R=r.canvas,I=r.videodom,this.vbSettingDomMap[T]={canvas:R,videodom:I},e.abrupt("break",763);case 59:return D=r.id,r.canvas,r.videodom,delete this.vbSettingDomMap[D],e.abrupt("break",763);case 62:if(!this.webrtcConfig.webrtcflag){e.next=64;break}return e.abrupt("return");case 64:if(!this.isMaskSettingStarted){e.next=66;break}return e.abrupt("return");case 66:if(this.isMaskSettingStarted=!0,(L=this).isCurrentInMaskStatus=!0,L.isMaskSettingOn=!0,V=r.width?r.width:640,U=r.height?r.height:360,L.ReadyCapureWidth=V,L.ReadyCapureHeight=U,null!==(M=L.videoCaptureWidth)&&void 0!==M||(L.videoCaptureWidth=V),null!==(P=L.videoCaptureHeight)&&void 0!==P||(L.videoCaptureHeight=U),F=0,W=0,!r.canvas){e.next=75;break}if(j=(0,h.e5)(r.canvas),q=j.dom,Y=j.id,L.VideoMaskSettingCanvas=q,L.PrevVideoMaskSettingCanvas=L.VideoMaskSettingCanvas,L.replaceCanvasMap.videoMaskSettingCanvasId=Y,!(!L.VideoMaskSettingCanvas||L.VideoMaskSettingCanvas.width<=0||L.VideoMaskSettingCanvas.height<=0)){e.next=74;break}return e.abrupt("return",void g.A.Notify_APPUI(p.qqH,3));case 74:F=r.originWidth||L.VideoMaskSettingCanvas.width,W=r.originHeight||L.VideoMaskSettingCanvas.height;case 75:if(!r.maskdom){e.next=81;break}if((X=(0,h.e5)(r.maskdom).dom)&&X.width&&X.height){e.next=79;break}return e.abrupt("return",void g.A.Notify_APPUI(p.qqH,1));case 79:Q=1,0==F||0==W||F==L.VideoMaskSettingCanvas.width&&W==L.VideoMaskSettingCanvas.height||(Q=Math.min(1*L.VideoMaskSettingCanvas.width/F,1*L.VideoMaskSettingCanvas.height/W)),L.MaskImage=X,L.maskCoordinate.dx=r.dx?Math.round(r.dx*Q):L.maskCoordinate.dx,L.maskCoordinate.dy=r.dy?Math.round(r.dy*Q):L.maskCoordinate.dy,L.maskCoordinate.dWidth=r.dWidth?Math.round(r.dWidth*Q):L.maskCoordinate.dWidth,L.maskCoordinate.dHeight=r.dHeight?Math.round(r.dHeight*Q):L.maskCoordinate.dHeight,L.isSupportVideoFrameOrBitmapCapture&&createImageBitmap(X).then((function(e){_.transportMaskImageBitMap(e,"MaskImage",L.maskCoordinate,L.videoCaptureWidth,L.videoCaptureHeight)})).catch((function(e){g.A.Notify_APPUI(p.qqH,1)}));case 81:if(!r.bgdom){e.next=86;break}if((J=(0,h.e5)(r.bgdom).dom)&&J.naturalWidth&&J.naturalHeight){e.next=85;break}return e.abrupt("return",(K.A.add_monitor("VMGF"),void g.A.Notify_APPUI(p.qqH,2)));case 85:L.BgImage=J,L.isSupportVideoFrameOrBitmapCapture&&createImageBitmap(J).then((function(e){_.transportBgImageBitMap(e,"BgImage")})).catch((function(e){K.A.add_monitor("VMCF"),g.A.Notify_APPUI(p.qqH,2)}));case 86:if(L.isSupportVideoFrameOrBitmapCapture||L.createVideoElement(),this.VideoMaskCanvasFillMode=r.fillMode?1:0,_.Notify_Video_Encode_Thread({command:"StartMaskSetting",fillMode:this.VideoMaskCanvasFillMode,enabled:this.isSupportVideoFrameOrBitmapCapture}),!Vn.shouldCaptureVideo()){e.next=92;break}if(L.videoCaptureHiddenCanvas||L.isSupportVideoFrameOrBitmapCapture||(L.videoCaptureHiddenCanvas=h.Ay.isSupport2dOffscreenCanvas()?new OffscreenCanvas(640,360):document.createElement("canvas"),L.videoCaptureHiddenCanvasCtx=L.videoCaptureHiddenCanvas.getContext("2d")),_.isVideoEncodeHandleReady()){e.next=89;break}return e.abrupt("return",(Un.warn("not isVideoEncodeHandleReady so return"),void K.A.add_monitor("not isVideoEncodeHandleReady so return")));case 89:L.videoCaptureValue?L.videoCaptureValue=Object.assign(L.videoCaptureValue,r):L.videoCaptureValue=r,L.videoCaptureValue.ssid&&(g.A.localSsrc=L.videoCaptureValue.ssid),L.StartVideoMediaCapture(),e.next=93;break;case 92:L.MaskSettingVideo&&Vn.playVideoStream(L.MaskSettingVideo),L.isMaskSettingOn&&g.A.Notify_APPUI(p.i8,null);case 93:if(L.isSupportVideoFrameOrBitmapCapture||h.Ay.isSupportVideoFrameOrBitmapCapture()&&h.Ay.isSelfPreviewRenderWithVideo())try{$=L.VideoMaskSettingCanvas.transferControlToOffscreen(),_.transportSettingCanvas($,"MaskOfflineCanvas",L.replaceCanvasMap.videoMaskSettingCanvasId)}catch(e){_.transportSettingCanvas(null,"MaskOfflineCanvas",L.replaceCanvasMap.videoMaskSettingCanvasId)}else L.Update_Mask_Texture(L.maskCoordinate,L.videoCaptureWidth,L.videoCaptureHeight);return e.abrupt("break",763);case 95:return Z=(0,h.e5)(r.canvas),ee=Z.id,te=Z.dom,this.isSupportVideoFrameOrBitmapCapture||h.Ay.isSupportVideoFrameOrBitmapCapture()&&h.Ay.isSelfPreviewRenderWithVideo()||this.VideoVBSettingCanvas?(re=g.A.SPECIAL_ID,g.A.localVideoEncMGR&&(ne=g.A.localVideoEncMGR.map.get(re))&&(ie={command:"update_setting_canvas_size",rendercanvasID:ee,width:r.width,height:r.height},ne.postMessage(ie))):(r.canvas=te,r.canvas&&(r.canvas.width=r.width,r.canvas.height=r.height)),e.abrupt("break",763);case 98:if(!this.webrtcConfig.webrtcflag){e.next=100;break}return e.abrupt("return");case 100:if(!this.isSupportVideoFrameOrBitmapCapture){e.next=111;break}if(!r.bgdom){e.next=108;break}if((ae=(0,h.e5)(r.bgdom).dom)&&ae.width&&ae.height){e.next=105;break}return e.abrupt("return",void g.A.Notify_APPUI(p.qqH,2));case 105:this.BgImage=ae,createImageBitmap(ae).then((function(e){_.transportBgImageBitMap(e,"BgImage")})).catch((function(e){g.A.Notify_APPUI(p.qqH,2)})),e.next=109;break;case 108:this.BgImage=null,_.transportBgImageBitMap(null,"BgImage");case 109:e.next=120;break;case 111:if(!r.bgdom){e.next=118;break}if((oe=(0,h.e5)(r.bgdom).dom)&&oe.width&&oe.height){e.next=115;break}return e.abrupt("return",void g.A.Notify_APPUI(p.qqH,2));case 115:this.BgImage=oe,e.next=119;break;case 118:this.BgImage=null;case 119:this.Update_Mask_Texture(this.maskCoordinate,this.videoCaptureWidth,this.videoCaptureHeight);case 120:return e.abrupt("break",763);case 121:if(!this.webrtcConfig.webrtcflag){e.next=123;break}return e.abrupt("return");case 123:if(this.maskCoordinate.dx=r.dx,this.maskCoordinate.dy=r.dy,this.maskCoordinate.dWidth=r.dWidth,this.maskCoordinate.dHeight=r.dHeight,!this.isSupportVideoFrameOrBitmapCapture){e.next=138;break}if(!r.maskdom){e.next=133;break}if((se=(0,h.e5)(r.maskdom).dom)&&se.width&&se.height){e.next=128;break}return e.abrupt("return",void g.A.Notify_APPUI(p.qqH,1));case 128:this.MaskImage=se,ce=this.maskCoordinate,de=this.videoCaptureWidth,le=this.videoCaptureHeight,createImageBitmap(se).then((function(e){_.transportMaskImageBitMap(e,"MaskImage",ce,de,le)})).catch((function(e){g.A.Notify_APPUI(p.qqH,1)})),e.next=136;break;case 133:this.MaskImage=null,he=this.maskCoordinate,fe=this.videoCaptureWidth,pe=this.videoCaptureHeight,_.transportMaskImageBitMap(null,"MaskImage",he,fe,pe);case 136:e.next=147;break;case 138:if(!r.maskdom){e.next=145;break}if((ve=(0,h.e5)(r.maskdom).dom)&&ve.width&&ve.height){e.next=142;break}return e.abrupt("return",void g.A.Notify_APPUI(p.qqH,1));case 142:this.MaskImage=ve,e.next=146;break;case 145:this.MaskImage=null;case 146:this.Update_Mask_Texture(this.maskCoordinate,this.videoCaptureWidth,this.videoCaptureHeight);case 147:return e.abrupt("break",763);case 148:if(!this.webrtcConfig.webrtcflag){e.next=150;break}return e.abrupt("return");case 150:return this.isMaskSettingStarted=!1,this.isMaskSettingOn=!1,this.BgImage||(this.isCurrentInMaskStatus=!1),r.isSwitch&&(this.isVBSettingOn=!0,_.Notify_Video_Encode_Thread({command:"StartVBSetting",isSwitch:r.isSwitch})),this.MaskSettingVideo&&this.MaskSettingVideo.pause(),this.VideoMaskSettingCanvas&&(this.VideoMaskSettingCanvasctx&&(this.VideoMaskSettingCanvasctx.setTransform(1,0,0,1,0,0),this.VideoMaskSettingCanvasctx.clearRect(0,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height),this.VideoMaskSettingCanvasctx=null),this.VideoMaskSettingCanvas=null),this.isCanvasScaled=!1,_.Notify_Video_Encode_Thread({command:"finishMaskSetting"}),this.isStartVideoCapture||this.isVBSettingOn||this.Stop_Video_Capture(),e.abrupt("break",763);case 152:return this.isMirrorMyVideo=r.isMirrorMyVideo,this.webrtcConfig.webrtcflag?this.wmscManager&&this.wmscManager.mirrorSelfVideo(this.isMirrorMyVideo):(_.Notify_Video_Encode_Thread({command:"mirrorMyVideo",isMirrorMyVideo:this.isMirrorMyVideo}),this.isSupportOffscreenCanvas?(this.VideoRenderObj&&this.VideoRenderObj.setMirrorMyVideoOption(this.isMirrorMyVideo),_.Notify_Video_Decode_Thread({command:"mirrorMyVideo",isMirrorMyVideo:this.isMirrorMyVideo,isSupportOffscreenCanvas:this.isSupportOffscreenCanvas})):(this.VideoRenderObj||(this.VideoRenderObj=new ge(Object.assign({},Ln(Ln({Notify_APPUI:g.A.Notify_APPUI.bind(g.A),isSupportOffscreenCanvas:!1,jsMediaEngine:_,globalTracingLogger:m.Ay,monitorLoggerFn:K.A.add_monitor},g.A.enableMultiDecodeVideoWithoutSAB?{videodecodethreadnumb:z.yC}:{}),{},{renderManager:this.renderManager,isLSSPlayer:this.isLSSPlayer}))),this.activeSpeakerSsrc&&(this.VideoRenderObj.setActiveSpeakerSsrc(this.activeSpeakerSsrc),mn.setActiveSpeakerSsrc(this.activeSpeakerSsrc))),this.VideoRenderObj.setMirrorMyVideoOption(this.isMirrorMyVideo))),e.abrupt("break",763);case 154:return this.activeSpeakerSsrc=r.ssrc,this.webrtcConfig.webrtcflag?null===(me=this.wmscManager)||void 0===me||me.onActiveSpeakerChange(r.ssrc):(K.A.add_monitor("ACTIVESSRC:".concat(r.ssrc)),_.pushMessageToWorker(N._c.VIDEO_DECODE,{ssrc:r.ssrc},"newActiveSpeakerSsrc",!1,!0),_.pushMessageToWorker(N._c.VIDEO_ENCODE,{ssrc:r.ssrc},"newActiveSpeakerSsrc",!1,!0),this.RenderInMain==z.tD&&(null===(ye=this.VideoRenderObj)||void 0===ye||ye.setActiveSpeakerSsrc(r.ssrc)),mn.setActiveSpeakerSsrc(r.ssrc)),e.abrupt("break",763);case 156:return K.A.add_monitor("CANCELACTIVE:".concat(r.ssrc)),_.Notify_Video_Decode_Thread({command:"cancelNewActiveSpeakerSsrcBefreCallback",ssrc:r.ssrc,haddata:r.haddata}),this.activeSpeakerSsrc=0,e.abrupt("break",763);case 158:return K.A.add_monitor(r.message),e.abrupt("break",763);case 160:if(g.A.rwgAgent){e.next=162;break}return e.abrupt("break",763);case 162:return this.userId!=r.userId&&g.A.sendMessageToRwg(p.fmn,{evt:12303,seq:1,body:{subInfoList:[{id:Number(r.userId),size:Number(r.videoQuality),bOn:!1}]}}),e.abrupt("break",763);case 164:if(K.A.add_monitor("ADDRENDER:".concat(r.userId)),!this.webrtcConfig.webrtcflag){e.next=172;break}if(Ae=parseInt(r.userId),be=null===(Se=this.wmscManager)||void 0===Se?void 0:Se.isSelfVideo(Ae),1===Ae&&this.wmscManager&&this.wmscManager.setActiveSpeakerVideoDom(r.videodom),!this.videoCaptureValue||!be){e.next=168;break}return e.abrupt("return",(Br.hasMediaStreamFrameProcessor()&&Vn.processedStream?r.videodom.srcObject=Vn.processedStream:Vn.isVBEnabled?r.videodom.srcObject=Vn.vbStream:r.videodom.srcObject=Vn.videoStream,this.wmscManager?(this.wmscManager.selfVideoDomMap.set(r.zone,r.videodom),this.wmscManager.mirrorVideoEle(r.videodom,this.wmscManager.isMirror),this.wmscManager.playSelfVideo("addRenderVideo",r.videodom)):(m.Ay.error("WMSC_Self_Add_Render, ".concat(r.userId)),r.videodom.play().catch((function(){m.Ay.error("WMSC_SV_ARP_F: ".concat(r.userId))}))),void(this.webrtcConfig.userId=parseInt(r.userId))));case 168:return e.next=170,this.add_render_video_webrtc(r);case 170:e.next=174;break;case 172:return e.next=174,this.add_render_video_wasm(r);case 174:return e.abrupt("break",763);case 175:if(Ee=(0,h.e5)(r.canvas),ke=Ee.id,Ce=Ee.dom,we=g.A.browserFeature){e.next=179;break}return m.Ay.error("video decode init not completed"),e.abrupt("break",763);case 179:return(0,h.i1)(r.width,r.height),this.checkIsRenderInWorker()&&we.isSupportOffScreenCanvasWebgl()?(Te=g.A.SPECIAL_ID,Re=null,g.A.localVideoEncMGR&&g.A.enableVirtualBackgroundWithoutSAB&&(Re=g.A.localVideoEncMGR.map.get(Te)),g.A.localVideoDecMGR&&(De=g.A.localVideoDecMGR.map.get(Te))&&(Me={command:"update_canvas_size",rendercanvasID:ke,width:r.width,height:r.height},De.postMessage(Me),Re&&Re.postMessage(Me))):(r.canvas=Ce,r.canvas&&(r.canvas.width=r.width,r.canvas.height=r.height)),this.UpdateVideoPlayStatus(!0),e.abrupt("break",763);case 182:if(K.A.add_monitor("ZOOMRENDER:".concat(r.userId)),"string"!=typeof r.canvas&&(r.canvas=r.canvas.id),Oe=g.A.browserFeature){e.next=187;break}return m.Ay.error("video decode init not completed"),e.abrupt("break",763);case 187:if(this.checkIsRenderInWorker()&&Oe.isSupportOffScreenCanvasWebgl()&&(xe=h.I4.getIsRenderSelfVideoInEncodeWorker(g.A.localSsrc&&(0,h.XF)(r.userId)===(0,h.XF)(g.A.localSsrc)),Pe=g.A.SPECIAL_ID,Le=null,xe&&g.A.localVideoEncMGR?Le=g.A.localVideoEncMGR.map.get(Pe):g.A.localVideoDecMGR&&(Le=g.A.localVideoDecMGR.map.get(Pe)),Le&&(Ue={command:"zoomrender",ssrc:r.userId,x:r.x,y:r.y,width:r.width,height:r.height,canvas:r.canvas,zone:r.zone,RGBA:r.RGBA,isPaused:r.isPaused,borderRadius:r.borderRadius},Le.postMessage(Ue))),r.isPaused&&this.VideoRenderObj&&(r.ssrc=r.userId,this.VideoRenderObj.Zoom_Render_Paused(r)),this.videoRenderArray.length)for(i=0;i<this.videoRenderArray.length;i++)this.videoRenderArray[i].ssrc==r.userId&&this.videoRenderArray[i].zone==r.zone&&(this.isLSSPlayer&&(Fe=[this.videoRenderArray[i]],this.VideoRenderObj&&this.VideoRenderObj.clearUseridRender(Fe,r.RGBA,void 0,r.isPaused)),this.videoRenderArray[i].x=r.x,this.videoRenderArray[i].y=r.y,this.videoRenderArray[i].width=r.width,this.videoRenderArray[i].height=r.height,r.borderRadius&&(We=ue(r.data,r.width,r.height),this.videoRenderArray[i].borderRadius=We,null===(Be=this.videoRenderArray[i].display)||void 0===Be||Be.setRoundedCornerRadius(We)));return e.abrupt("break",763);case 190:if(K.A.add_monitor("RMRENDER:".concat(r.userId)),!this.webrtcConfig.webrtcflag){e.next=197;break}if(He=parseInt(r.userId),je=null===(Ge=this.wmscManager)||void 0===Ge?void 0:Ge.isSelfVideo(He),1===He&&this.wmscManager&&(this.wmscManager.activeSpeakerVideoDom=null),!je){e.next=194;break}return e.abrupt("return",void(this.wmscManager&&this.wmscManager.selfVideoDomMap.has(r.zone)&&this.wmscManager.selfVideoDomMap.delete(r.zone)));case 194:this.stop_render_video_webrtc(r),e.next=199;break;case 197:return e.next=199,this.stop_render_video_wasm(r);case 199:return e.abrupt("break",763);case 200:if(console.log("update border radius",r),K.A.add_monitor("UPDATE_BORDER_RADIUS:".concat(r.userId)),Ke=g.A.browserFeature){e.next=205;break}return m.Ay.error("video decode init not completed"),e.abrupt("break",763);case 205:if(this.checkIsRenderInWorker()&&Ke.isSupportOffScreenCanvasWebgl()&&(qe=h.I4.getIsRenderSelfVideoInEncodeWorker(g.A.localSsrc&&(0,h.XF)(r.userId)===(0,h.XF)(g.A.localSsrc)),Xe=g.A.SPECIAL_ID,Qe=null,qe&&g.A.localVideoEncMGR?Qe=g.A.localVideoEncMGR.map.get(Xe):g.A.localVideoDecMGR&&(Qe=g.A.localVideoDecMGR.map.get(Xe)),Qe&&(Je={command:"update_border_radius",ssrc:r.userId,zone:r.zone,borderRadius:r.data},Qe.postMessage(Je))),this.videoRenderArray.length)for(i=0;i<this.videoRenderArray.length;i++)this.videoRenderArray[i].ssrc==r.userId&&this.videoRenderArray[i].zone==r.zone&&(et=ue(r.data,this.videoRenderArray[i].width,this.videoRenderArray[i].height),this.videoRenderArray[i].borderRadius=et,null===($e=this.videoRenderArray[i].display)||void 0===$e||$e.setRoundedCornerRadius(et));return e.abrupt("break",763);case 208:if(tt=null,h.Ay.isSelfPreviewRenderWithVideo()&&(rt=r instanceof Array?r[0]:r,tt=rt instanceof HTMLVideoElement?rt:(0,h.e5)(rt).dom),this.videoCaptureValue){e.next=212;break}return e.abrupt("break",763);case 212:return h.Ay.isSelfPreviewRenderWithVideo()&&tt&&tt instanceof HTMLVideoElement?this.switchVideoTagForVideoCapture(tt):(nt=[],r instanceof Array?nt=r:nt.push(r),it=this.videoCaptureValue.canvasCtrlList.filter((function(e){return-1!==nt.indexOf(e.k)})).map((function(e){return e.dom})),this.switchCanvasForVideoCapture(it)),e.abrupt("break",763);case 214:return at=r.video,ot=void 0===at?null:at,st=r.VideoSelectValue,ut=void 0===st?"":st,ct=(0,n.A)(r,On),dt=!1,(0,h.uE)(ut)&&(dt=!0),K.A.add_monitor("SCVP: ".concat((0,h.iD)(JSON.stringify(ct)),"|").concat(dt?!!dt:ut,"|").concat(!!ot)),null!=r&&r.fps||(r.fps=z.Fw),this.webrtcConfig.webrtcflag?this.start_capture_video_webrtc(r):this.start_capture_video_wasm(r),e.abrupt("break",763);case 218:return lt=this,e.abrupt("return",new Promise((function(e,t){try{if(Vn.isCaptureVideoInProgress)return g.A.Notify_APPUI(p.gFh,null),t(new Error("Too many calls : the device is opening camera now, cannot stop video capture"));lt.isStartVideoCapture&&lt.Stop_Video_Capture(),g.A.Notify_APPUI(p.Wcg,null),e(!0)}catch(e){g.A.Notify_APPUI(p.gFh,null),t(e)}g.A.extVBPort&&g.A.extVBPort.postMessage({type:p.L_m})})));case 220:return 0==this.audioRenderArray.length&&(this.audioRenderArray.push(r),this.Start_Audio_Play()),e.abrupt("break",763);case 222:if(this.audioRenderArray.length>0)for(this.Stop_Audio_Play(),i=0;i<this.audioRenderArray.length;i++)this.audioRenderArray[i].ssrc==r.ssrc&&this.audioRenderArray.splice(i,1);return e.abrupt("break",763);case 224:return e.next=226,_.pushMessageToWorker(N._c.AUDIO_DECODE,{bPause:r.bPause},"PAUSE_OR_RESUME_AUDIO_DECODE",!1,!0);case 226:return e.abrupt("break",763);case 227:return this.captureAudioMuted=!1,this.audioInputLevel&&this.audioInputLevel.start(),this.useWebRTCAudio&&(null===(ht=this.webrtcAudio)||void 0===ht||ht.unmute()),this.UnMuteAudio(),e.abrupt("break",763);case 229:return this.captureAudioMuted=!0,this.audioInputLevel&&this.audioInputLevel.stop(),this.useWebRTCAudio&&(null===(ft=this.webrtcAudio)||void 0===ft||ft.mute()),this.MuteAudio(),e.abrupt("break",763);case 231:return this.startAnnotation(r,!0),m.Ay.directReport("Start Annotation with session: ".concat(r.presenterId)),e.abrupt("break",763);case 233:return this.stopAnnotation(r),e.abrupt("break",763);case 235:return null===(pt=this.annotationMgr)||void 0===pt||pt.onAnnotationActions(r),e.abrupt("break",763);case 237:return this.shareSessionId=r.shareSessionId,this.userName=r.userName,this.initAnnotatinPresenterSession(),e.abrupt("break",763);case 239:if(this.loadAnnotationModule(),r.canvas&&!this.sharingCanvasList.includes(r.canvas.id)&&this.sharingCanvasList.push(r.canvas.id),this.mainSharingCanvas=r.canvas,this.annoCanvas=r.annoCanvas,this.annoPresenterCanvas=r.annoPresenterCanvas||this.annoPresenterCanvas,this.localShareCanvas=r.localShareCanvas||this.localShareCanvas,null===(vt=this.annotationMgr)||void 0===vt||vt.updateCanvas({sharingMainCanvas:this.mainSharingCanvas,annoCanvas:this.annoCanvas}),Object.assign(r,this.sharingWaterMarkParams),this.isSupportVideoShare?_.Notify_Sharing_Video_Decode_Thread({command:"startSharingRender"}):_.Notify_Sharing_Decode_Thread({command:"startSharingRender"}),this.currentshareactive=r.ssrc,null==this.currentshareactive&&K.A.add_monitor2("SSRC"),this.isCreateSharingWaterMark=r.enableWaterMark,this.sharingWaterMarkName=this.isCreateSharingWaterMark?r.waterMarkText:"",r.canvas)if(tn.X.addRenderCanvas(r.canvas.id,r.canvas),this.isSupportOffscreenCanvas||Ve.X.isUseSsrcStream()){this.RenderInMain===z.p$&&(this.RenderInMain=z.u);try{gt=g.A.SPECIAL_ID,this.replaceCanvasMap.sharingMainCanvasId=r.canvas.id,mt=null,this.isSupportVideoShare?g.A.localVideoDecMGR&&(mt=g.A.localVideoDecMGR.map.get(gt)):g.A.localSharingDecMGR&&(mt=g.A.localSharingDecMGR.map.get(gt)),mt&&(this.sharingRenderCanvas=r.canvas.transferControlToOffscreen(),(0,h.i1)(r.canvas.width,r.canvas.height),yt={command:"sharingRenderCanvas",canvas:this.sharingRenderCanvas,rendercanvasID:this.replaceCanvasMap.sharingMainCanvasId,ssrc:this.currentshareactive,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:r.watermarkOpacity,watermarkRepeated:r.watermarkRepeated,isFromMainSession:r.isFromMainSession,watermarkPosition:r.watermarkPosition},mt.postMessage(yt,[yt.canvas]))}catch(e){_t=g.A.SPECIAL_ID,St=null,this.isSupportVideoShare?g.A.localVideoDecMGR&&(St=g.A.localVideoDecMGR.map.get(_t)):g.A.localSharingDecMGR&&(St=g.A.localSharingDecMGR.map.get(_t)),St&&(At={command:"sharingRenderCanvas",rendercanvasID:this.replaceCanvasMap.sharingMainCanvasId,ssrc:this.currentshareactive,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:r.watermarkOpacity,watermarkRepeated:r.watermarkRepeated,isFromMainSession:r.isFromMainSession,watermarkPosition:r.watermarkPosition},St.postMessage(At))}}else this.RenderInMain===z.p$&&(this.RenderInMain=z.tD),this.SharingRenderObj||(this.SharingRenderObj=new _e(Object.assign({},{Notify_APPUI:g.A.Notify_APPUI.bind(g.A),PubSub:E.A,jsMediaEngine:_,globalTracingLogger:m.Ay,renderManager:this.renderManager}))),this.renderManager.getRendererProvider().isWebGLRendererType()?this.sharingDisplay=new Ie(r.canvas,r.canvas.id,0,void 0,{preserveDrawingBuffer:!1},void 0,void 0,g.A.enableCanvasAlphaChannel):this.renderManager.getRendererProvider().isWebGL2RendererType()&&(this.sharingDisplay=new Ne(r.canvas,r.canvas.id,0,void 0,{preserveDrawingBuffer:!1},void 0,void 0,g.A.enableCanvasAlphaChannel)),this.SharingRenderObj.Set_Render_Display(this.sharingDisplay),this.SharingRenderObj.Change_Current_SSRC(this.currentshareactive,r.isFromMainSession),this.isCreateSharingWaterMark&&!this.waterMarkCanvas&&(this.waterMarkCanvas=document.createElement("canvas")),this.SharingRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:r.watermarkOpacity,watermarkRepeated:r.watermarkRepeated,watermarkPosition:r.watermarkPosition}),this.sharingInterval||(this.sharingInterval=this.JsMediaSDK_SharingRenderInterval(this.sharingIntervalTime,r.isVideoShare)),_.UpdateSharingPlayStatus(!0);return e.abrupt("break",763);case 241:if(r.canvas?-1!==(bt=this.sharingCanvasList.indexOf(r.canvas.id))&&this.sharingCanvasList.splice(bt,1):this.sharingCanvasList=[],0===this.sharingCanvasList.length){e.next=244;break}return e.abrupt("return");case 244:return this.mainSharingCanvas=null,this.annoCanvas=null,_.UpdateSharingPlayStatus(!1),this.isSupportVideoShare?_.Notify_Sharing_Video_Decode_Thread({command:"stopSharingRender"}):_.Notify_Sharing_Decode_Thread({command:"stopSharingRender"}),this.isCreateSharingWaterMark=!1,this.sharingWaterMarkName="",this.sharingInterval&&(clearInterval(this.sharingInterval),this.sharingInterval=0),this.sharingDisplay&&(this.sharingDisplay.clear(),this.sharingDisplay.cleanup(),this.sharingDisplay=null),this.SharingRenderObj&&(this.SharingRenderObj.ClearQueue(),this.SharingRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName})),e.abrupt("break",763);case 246:if(kt=r.width,Ct=r.height,!(wt=r.canvas)||!wt.id||this.sharingCanvasList.includes(wt.id)||this.mainSharingCanvas===wt){e.next=249;break}return e.abrupt("return");case 249:if(Un("UPDATE_SHARING_DECODE_PARAM",r),this.SharingRenderObj?this.SharingRenderObj.Update_Sharing_Canvas_Size({width:kt,height:Ct}):this.isSupportVideoShare?_.Notify_Sharing_Video_Decode_Thread({command:"UPDATE_SHARING_CANVAS_SIZE",width:kt,height:Ct}):_.Notify_Sharing_Decode_Thread({command:"UPDATE_SHARING_CANVAS_SIZE",width:kt,height:Ct}),!_.isSharingNotClearChromeVersion()){e.next=251;break}return e.abrupt("return",((0,h.i1)(kt,Ct),Un("isSharingNotClearChromeVersion",_.isSharingNotClearChromeVersion())));case 251:if(null===(Et=this.annotationMgr)||void 0===Et||Et.updateAnnoCanvasSize({width:kt,height:Ct}),g.A.rwgAgent){e.next=253;break}return e.abrupt("break",763);case 253:if(!this.isSupportVideoShare){e.next=257;break}_.Notify_Sharing_Video_Decode_Thread({command:"SET_OFFSCREENCANVAS_WIDTH_HEIGHT",data:{width:kt,height:Ct}}),e.next=259;break;case 257:return e.next=259,_.pushMessageToWorker(N._c.SHARING_DECODE,{width:kt,height:Ct},"SET_OFFSCREENCANVAS_WIDTH_HEIGHT",!1,!0);case 259:case 260:return e.abrupt("break",763);case 261:if(r.AudioSelectValue){e.next=263;break}return e.abrupt("return",void g.A.Notify_APPUI(p.G9o,p.g8Z));case 263:if(Tt=Date.now(),!this.useWebRTCAudio){e.next=266;break}return e.abrupt("return",void(null===(Rt=this.webrtcAudio)||void 0===Rt||Rt.changeSpeaker(r.AudioSelectValue)));case 266:return this.selectComputerAudioSpeaker(r.AudioSelectValue,Tt),e.abrupt("break",763);case 268:return Ze.A.changeDenoiseSwitch(r.switch),e.abrupt("break",763);case 270:if(Dt=null===(It=this.audioCapture)||void 0===It?void 0:It.audioProfile){e.next=273;break}return e.abrupt("break",763);case 273:if(this.audioCapture.audioProfile=r,"backgroundNoiseSuppression"!==r.currentSelect){e.next=296;break}if("backgroundNoiseSuppression"===Dt.currentSelect){e.next=284;break}if(Mt={command:"original_sound_switch",enable:!1,highfidelity:!1,stereo:!1},!this.useWebRTCAudio){e.next=281;break}return e.next=279,null===(Ot=this.webrtcAudio)||void 0===Ot?void 0:Ot.setAudioProfile(r);case 279:e.next=282;break;case 281:_.Notify_Audio_Encode_Thread(Mt);case 282:Vn.destoryAudioMediaStream(),this.Start_Audio_Capture();case 284:if(e.t1=Dt.highBitrate!==r.highBitrate,!e.t1){e.next=292;break}if(!this.useWebRTCAudio){e.next=291;break}return e.next=289,null===(xt=this.webrtcAudio)||void 0===xt?void 0:xt.setAudioProfile(r);case 289:e.next=292;break;case 291:_.Notify_Audio_Encode_Thread({command:"highBitrate",highBitrate:r.highBitrate?1:0});case 292:Pt="Zoom"===r.backgroundNoiseSuppression,Ze.A.changeDenoiseSwitch(Pt),e.next=304;break;case 296:if(Nt={command:"original_sound_switch",enable:!0,highfidelity:r.originalSound.highfidelity,stereo:r.originalSound.stereo},!this.useWebRTCAudio){e.next=302;break}return e.next=300,null===(Vt=this.webrtcAudio)||void 0===Vt?void 0:Vt.setAudioProfile(r);case 300:e.next=303;break;case 302:_.Notify_Audio_Encode_Thread(Nt);case 303:"originalSound"===Dt.currentSelect&&(null===(Lt=Dt.originalSound)||void 0===Lt?void 0:Lt.stereo)===r.originalSound.stereo||(Vn.destoryAudioMediaStream(),this.Start_Audio_Capture());case 304:return e.abrupt("break",763);case 305:if(Ft=Object.assign({},this.VALUE_CACHE_FOR_START_CAPTURE_VIDEO,r),!this.isSupportMediaStreamTrackProcessor){if(Ft.canvasCtrlList=[],Ft.canvas instanceof Array)for(Bt=0;Bt<Ft.canvas.length;Bt++)Ft.canvasCtrlList.push({k:Ft.canvas[Bt],dom:(0,h.e5)(Ft.canvas[Bt]).dom});else Ft.canvasCtrlList.push({k:Ft.canvas,dom:(0,h.e5)(Ft.canvas).dom});Ft.canvasCtrl=Ft.canvasCtrlList[0].dom}return Ft.videoCtrl=this.captureVideoOutPutVideoDom,null!==(Ut=this.videoloadmetadataListener)&&void 0!==Ut&&Ut.remove&&(this.videoloadmetadataListener.remove(),this.videoloadmetadataListener=null),this.isVideoCaptureLoadedmetadata=!1,Vn.destoryVideoMediaStream(),this.videoCaptureValue=Ft,Vn.removeVideoStream(this.videoCaptureValue.videoCtrl),this.StartVideoMediaCapture(),e.abrupt("break",763);case 309:return r.canvas&&(r.rendercanvasID=r.canvas),Wt=Object.assign({},this.desktopSharingValue,r),this.EndSharingMediaStream(),this.desktopSharingValue=Wt,this.StartDesktopMediaCapture(),e.abrupt("break",763);case 313:return this.EndSharingMediaStream(),this.desktopSharingValue=r,this.StartDesktopMediaCapture(),e.abrupt("break",763);case 315:return this.currentactive!=r.ssrc&&(this.currentactive=r.ssrc,g.A.CurrentSSRC=this.currentactive,this.changeVideoRenderActiveSsrc(this.currentactive)),_.Notify_Audio_Thread_CurrentSSRC(g.A.CurrentSSRC),e.abrupt("break",763);case 317:return this.currentshareactive!=r.ssrc&&(this.currentshareactive=r.ssrc),this.isSupportOffscreenCanvas?this.isSupportVideoShare?_.Notify_Sharing_Video_Decode_Thread({command:"CHANGE_CURRENT_SHARING_ACTIVE_SSRC",ssrc:r.ssrc,isFromMainSession:r.isFromMainSession}):(Gt=g.A.SPECIAL_ID,g.A.localSharingDecMGR&&(Ht=g.A.localSharingDecMGR.map.get(Gt))&&(jt={command:"CHANGE_CURRENT_SHARING_ACTIVE_SSRC",ssrc:r.ssrc,isFromMainSession:r.isFromMainSession},Ht.postMessage(jt))):(this.SharingRenderObj||(this.SharingRenderObj=new _e(Object.assign({},{Notify_APPUI:g.A.Notify_APPUI.bind(g.A),PubSub:E.A,jsMediaEngine:_,globalTracingLogger:m.Ay,renderManager:this.renderManager}))),this.SharingRenderObj.Change_Current_SSRC(this.currentshareactive,r.isFromMainSession)),e.abrupt("break",763);case 319:return this.Stop_Audio_Play(),e.abrupt("break",763);case 321:return this.Meeting_Fail_Over(r.audio_websocket_address,r.video_websocket_address),e.abrupt("break",763);case 323:return Un("jsEvent.END_MEDIA"),E.A.trigger(p.gh2.END_MEDIA),this.removeVbReceiver(),this.destroy().catch((function(e){return Un.error(e)})),e.abrupt("break",763);case 325:return function(){var e=H(O().mark((function e(t,r,n){var i,a,o;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=r,e.next=e.t0===p.eEQ?3:12;break;case 3:if(i=function(e){if(h.Ay.isMobileForceAutoChooseAudioDeviceEnable()){var t;if(e.getMediaStreamController().isAudioCaptureProgressing())return{result:!0,reason:"capture processing"};if(null!=e&&null!==(t=e.webrtcAudio)&&void 0!==t&&t.getHealthCheckFailedAndReset())return{result:!1,reason:"health check failed"};if(sn.isCaptureHealthy(e.getMediaStreamController()))return{result:!0,reason:"capture healthy"}}return{result:!1}}(t),a=i.result,(o=i.reason)&&m.Ay.log("[Audio] CHANGE_AUDIO_MIC ignored result=".concat(a,",").concat(o)),!a){e.next=6;break}return e.abrupt("break",12);case 6:if(n){e.next=9;break}return g.A.Notify_APPUI(p.G9o,p.eEQ),e.abrupt("break",12);case 9:return e.next=11,un(t,n);case 11:return e.abrupt("break",12);case 12:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()(this,t,r),e.abrupt("break",763);case 327:return r&&(_.Notify_Audio_Thread_Status(g.A.SPECIAL_ID,p.Eym),Vn.destoryAudioMediaStream(),this.Remove_Audio_Capture(),this.audioCapture=r,this.Start_Audio_Capture(),_.Reset_Aec()),e.abrupt("break",763);case 329:if(Vn.destoryAudioMediaStream(),document.removeEventListener("visibilitychange",Fn),this.setFileAudioPlaybackSwitch(!1),_.Notify_Audio_Encode_Thread({command:hr.dt,value:!1}),this.audioCapture=null,this.captureAudioMuted=!1,e.t2=this.hidAvalible,!e.t2){e.next=340;break}return e.next=339,ze.destroy();case 339:this.hidAvalible=!1;case 340:if(g.A.ComputerAudioStatus=N.BX.ComputerAudio_Null,!this.audioInputLevel){e.next=343;break}return e.abrupt("return",(this.audioInputLevel.destroy(),this.audioInputLevel=null,void g.A.Notify_APPUI(p.DjR,null)));case 343:if(!this.useWebRTCAudio){e.next=345;break}return e.abrupt("return",(this.webrtcAudio&&(this.webrtcAudio.isMutedBySystem=!1,this.webrtcAudio.enableBroadCastToBO(!1),this.webrtcAudio.leaveAudioWithoutDisconnect(z.qR)),void g.A.Notify_APPUI(p.DjR,null)));case 345:if(g.A.ComputerAudioStatus!==N.BX.ComputerAudio_Connecting){e.next=347;break}return e.abrupt("return",void g.A.Notify_APPUI(p.DjR,null));case 347:this.Remove_Audio_Capture(),this.Remove_Audio_Play(),this.CloseBoringPeerConnection(),this.checkWorkletInterval&&(clearInterval(this.checkWorkletInterval),this.checkWorkletInterval=null);try{g.A.AudioNode&&(g.A.AudioNode.disconnect(),g.A.AudioNode.postCMD("stopWorklet",!0),g.A.AudioNode.port=null)}catch(e){Un("AudioNode.port",e)}return g.A.AudioNode=null,g.A.workletWasmInitSuccess=!1,this.audioCtx&&(this.audioCtx.onstatechange=null,this.audioCtx.onerror&&(this.audioCtx.onerror=null),this.audioCtx.close(),this.isCaputureNodeConnect=!1),this.audioCtx=null,this.audioPlay=!1,this.audioDomNode=null,g.A.Notify_APPUI(p.DjR,null),e.abrupt("break",763);case 351:if(K.A.add_monitor("JCAA:"+r.checkAutoplay),this.enableHID=r.CaptureAudioInfo.enableHID,!this.enableHID||!r.CaptureAudioInfo.microphoneLabel){e.next=361;break}return e.prev=352,e.next=355,ze.init(r.CaptureAudioInfo.microphoneLabel,r.CaptureAudioInfo.defaultMuted);case 355:this.hidAvalible=e.sent,e.next=361;break;case 358:e.prev=358,e.t3=e.catch(352),m.Ay.log("auto connect hid fail"),g.A.Notify_APPUI(p.dUL,e.t3);case 361:if(g.A.ComputerAudioStatus=N.BX.ComputerAudio_Connecting,e.prev=362,e.t4=r.checkAutoplay,!e.t4){e.next=367;break}return e.next=367,h.Ay.checkAudioAutoPlay();case 367:e.next=372;break;case 369:return e.prev=369,e.t5=e.catch(362),e.abrupt("return",(Un.error("audio auto play",e.t5),m.Ay.error("check auto play fail",e.t5),g.A.ComputerAudioStatus=N.BX.ComputerAudio_Null,g.A.Notify_APPUI(p.Ubu,null),g.A.Notify_APPUI(p.yEo,e.t5)));case 372:if(this.audioInputLevel&&(this.audioInputLevel.destroy(),this.audioInputLevel=null),!r.isPreviewMode){e.next=374;break}return e.abrupt("return",void(r.CaptureAudio?(this.audioCapture=r.CaptureAudioInfo,this.audioInputLevel=new Ye.bQ({analyserCallback:function(e){g.A.Notify_APPUI_SAFE(p._9I,{value:e})}}),Vn.shouldCaptureAudio()||g.A.Notify_APPUI(p.h73,null),this.Start_Audio_Capture()):(g.A.ComputerAudioStatus=N.BX.ComputerAudio_Connected,g.A.Notify_APPUI(p.Ubu,null))));case 374:if(!this.isSupportVideoShare&&this.isSupportOffscreenCanvas&&(Kt=new MessageChannel,_.Notify_Video_Sharing_Msg_Channel(Kt,Kt)),this.useWebRTCAudio=!!r.audioBridge,!this.useWebRTCAudio){e.next=385;break}return Ze.A.setUserId(r.CaptureAudioInfo.ssrc),zt=this.meetingParams,qt=zt.meetingNumber,Yt=zt.rwgHost,Xt=zt.userId,Qt=zt.cid,Jt=zt.webrtcMode,$t=zt.abToken,e.next=380,this.setupLocalPreview({audioBridge:{abToken:$t,rwgHost:Yt,meetingNumber:qt,userId:Xt,cid:Qt,webrtcMode:Jt,isCapturingAudio:r.CaptureAudio,audioMode:z.qR,workerType:null}});case 380:if(this.webrtcAudio){e.next=383;break}return this.isDestroy||m.Ay.error("webrtc audio instance is null after initialization"),e.abrupt("break",763);case 383:return Ze.A.setWebRTCAudio(this.webrtcAudio),r.CaptureAudio?(this.audioCapture=r.CaptureAudioInfo,null!==(Zt=r.CaptureAudioInfo)&&void 0!==Zt&&Zt.audioProfile&&this.webrtcAudio.setAudioProfile(r.CaptureAudioInfo.audioProfile),this.Start_Audio_Capture()):(g.A.ComputerAudioStatus=N.BX.ComputerAudio_Connected,g.A.Notify_APPUI(p.Ubu,null)),h.Ay.isAndroidBrowser()||h.Ay.isQuestBrowser()||!h.Ay.browser.isChromeOrEdge&&!h.Ay.isFirefoxVersionHigherThan(116)?Ze.A.updateSelectedSpeakerDevices("default",0,!0):(rr=null!==(er=r.speakerInfo)&&void 0!==er&&er.defaultDeviceId?null===(tr=r.speakerInfo)||void 0===tr?void 0:tr.defaultDeviceId:"",this.selectComputerAudioSpeaker(rr,Date.now())),e.abrupt("return");case 385:if(e.prev=385,this.Remove_Audio_Play(),this.Remove_Audio_Capture(),this.CloseBoringPeerConnection(),_.Notify_Audio_Thread_Status(g.A.SPECIAL_ID,p.Eym),this.isLSSPlayer||(this.audioCtx&&(this.audioCtx.close(),this.audioCtx.onerror&&(this.audioCtx.onerror=null),this.audioCtx=null,this.isCaputureNodeConnect=!1),this.audioCtx=(0,h.Bw)()),h.Ay.isChromiumVersionHigherThan(129)&&!this.audioCtx.onerror&&(this.audioCtx.onerror=function(){K.A.add_monitor("AUDIOCONTEXT:ERROR")}),this.audioCtx.sampleRate!=this.sampleRate&&(this.sampleRate=this.audioCtx.sampleRate,_.Modify_Audio_SampleRate(this.sampleRate)),this.disableAudioAGC=r.disableAudioAGC,this.disableNoiseSuppression=r.disableNoiseSuppression,this.disableBrowserAec=r.disableBrowserAec,this.bAudioDecodeUsingSAB&&K.A.add_monitor("ASSAB"),"suspended"===this.audioCtx.state&&this.audioCtx.resume().catch((function(e){m.Ay.error("audioContext resume fail",e)})),nr=this,ir=null,ar=null,!g.A.decoderinworklet){e.next=398;break}return e.next=391,h.Ay.isSDKSupportSIMD();case 391:if(!e.sent){e.next=395;break}ir=this.audioWorkletJsPath.audioWorkletSIMDPath,ar=this.audioWorkletJsPath.audioSIMDWasm,e.next=396;break;case 395:ir=this.audioWorkletJsPath.audioWorkletProcessPath,ar=this.audioWorkletJsPath.audioWasm;case 396:e.next=399;break;case 398:ir=this.audioWorkletJsPath.audioWorkletPath;case 399:if(!this.isDestroy){e.next=401;break}return e.abrupt("return");case 401:if(or=null,e.t6=ar,!e.t6){e.next=407;break}return e.next=406,h.Ay.downloadAndCompileWebAssembly(ar,"AudioWorklet",K.A,!h.Ay.browser.isSafari&&g.A.enableStreamingInstantiate);case 406:or=e.sent;case 407:return e.next=409,this.audioCtx.audioWorklet.addModule(ir);case 409:if(g.A.AudioNode=new l.A(nr.audioCtx,"zoomAudioWorklet",{processorOptions:{sharedBuffer:h.Ay.browser.isSafari&&g.A.sharedBuffer?g.A.sharedBuffer:null,userAgent:navigator.userAgent,audioDecodeChannelsNum:this.isPlayStereoAudioSupported?2:1,audioEncodeChannelsNum:h.Ay.isBrowserSupportStereo()?2:1,wasmModule:or},numberOfOutputs:1,outputChannelCount:[2]}),g.A.AudioNode.onprocessorerror=function(e){K.A.add_monitor("CWFIP"),m.Ay.error("Exception thrown in AudioWorkletProcessor",e)},h.Ay.browser.isSafari&&!g.A.sharedBuffer&&g.A.AudioNode.postCMD("diableSharedArrayBuffer"),g.A.decoderinworklet||g.A.AudioNode.postCMD("disableDecoderinworklet"),g.A.decoderinworklet&&(this.codecDoAVSync?g.A.AudioNode.postCMD("codecDoAVSync",!0):g.A.CurrentSSRC&&g.A.AudioNode.postCMD("currentSSRC",g.A.CurrentSSRC),g.A.AudioNode.postCMD("initData",{userid:r.CaptureAudioInfo.ssrc,meetingnumb:g.A.localAudioPara.meetingNumber,meetingid:g.A.localAudioPara.meetingId}),g.A.AudioNode.postCMD("audiowasm")),nr.checkWorkletInterval&&(clearInterval(nr.checkWorkletInterval),nr.checkWorkletInterval=null),nr.checkWorkletInterval=setInterval((function(){g.A.AudioNode&&g.A.AudioNode.postCMD("checkProcess",null)}),1e4),sr=this.isChromeWideAECSupported&&!g.A.shareSystemAudio,h.Ay.browser.isChromeOrEdge&&!h.Ay.isAndroidBrowser()&&!h.Ay.isQuestBrowser()){e.next=446;break}if(g.A.sharedBuffer&&g.A.AudioNode.postCMD("sharedBuffer",h.Ay.browser.isSafari?null:g.A.sharedBuffer),!h.Ay.isAndroidBrowser()&&!h.Ay.isQuestBrowser()){e.next=443;break}if(ur=nr.audioCtx.createMediaStreamDestination(),nr.getAudioNode().connect(ur),!this.disableBrowserAec){e.next=425;break}this.isSupportBrowserAec=!1,e.next=428;break;case 425:return e.next=427,this.isLocalP2PSupportedPromise;case 427:this.isSupportBrowserAec=e.sent;case 428:if(cr=ur.stream,e.t7=this.disableBrowserAec,e.t7){e.next=438;break}if(!this.isSupportBrowserAec){e.next=437;break}return e.next=434,nr.chromeAecWorkAround(ur.stream);case 434:cr=e.sent,e.next=438;break;case 437:_.Notify_Audio_Thread_AEC_Status(g.A.SPECIAL_ID,!1);case 438:nr.audioDomNode||(nr.audioDomNode=new Audio),nr.audioDomNode.srcObject=cr,nr.audioDomNode.play().catch((function(e){m.Ay.error("Audio play failed",e)})),e.next=444;break;case 443:h.Ay.browser.isFirefox&&h.Ay.isFirefoxVersionHigherThan(116)?(dr=nr.audioCtx.createMediaStreamDestination(),nr.getAudioNode().connect(dr),lr=dr.stream,nr.audioDomNode||(nr.audioDomNode=new Audio),nr.audioDomNode.srcObject=lr,pr=Date.now(),fr=r.speakerInfo&&r.speakerInfo.defaultDeviceId?r.speakerInfo.defaultDeviceId:"",this.selectComputerAudioSpeaker(fr,pr),nr.audioDomNode.play().catch((function(e){m.Ay.error("Audio play failed",e)}))):(nr.getAudioNode().connect(nr.audioCtx.destination),Ze.A.updateSelectedSpeakerDevices("default",0,!0));case 444:e.next=473;break;case 446:if(!this.disableBrowserAec){e.next=450;break}this.isSupportBrowserAec=!1,e.next=456;break;case 450:if(e.t8=sr,e.t8){e.next=455;break}return e.next=454,this.isLocalP2PSupportedPromise;case 454:e.t8=e.sent;case 455:this.isSupportBrowserAec=e.t8;case 456:if(g.A.sharedBuffer&&g.A.AudioNode.postCMD("sharedBuffer",g.A.sharedBuffer),this.disableBrowserAec){e.next=469;break}if(!this.isSupportBrowserAec){e.next=468;break}if(sr){e.next=466;break}return gr=nr.audioCtx.createMediaStreamDestination(),nr.getAudioNode().connect(gr),vr=gr.stream,e.next=465,nr.chromeAecWorkAround(gr.stream);case 465:vr=e.sent;case 466:e.next=469;break;case 468:_.Notify_Audio_Thread_AEC_Status(g.A.SPECIAL_ID,!1);case 469:mr=r.speakerInfo&&r.speakerInfo.defaultDeviceId?r.speakerInfo.defaultDeviceId:"",yr=Date.now(),vr?(nr.audioDomNode||(nr.audioDomNode=new Audio),nr.audioDomNode.srcObject=vr,nr.audioDomNode.play().catch((function(e){m.Ay.error("Audio play failed",e)}))):nr.getAudioNode().connect(nr.audioCtx.destination),nr.selectComputerAudioSpeaker(mr,yr);case 473:if(_.Notify_Audio_Decode_Thread({command:"stop_audio_incoming",stopPlayAudio:!1}),_.Notify_Audio_Encode_Thread({command:"startAudioEncode",ssid:r.CaptureAudioInfo.ssrc,audioMode:g.A.audioMode}),_.Update_Audio_Encrpt(g.A.e2eencrypt),_r=new MessageChannel,Sr=new MessageChannel,Ar=new MessageChannel,g.A.AudioNode.port.postMessage({status:"encodeAudioPort"},[Sr.port2]),g.A.AudioNode.port.postMessage({status:"decodeAudioPort"},[_r.port1]),g.A.AudioNode.port.postMessage({status:"sampleRate",data:nr.audioCtx.sampleRate}),_.Notify_Audio_Thread_Msg_Channel(_r,Sr,"decodeAudioPort","encodeAudioPort"),g.A.enableEchoDetection&&!g.A.sharedBuffer&&_.Notify_Audio_Thread_Msg_Channel(Ar,Ar,"audioWorkerPort","audioWorkerPort"),nr.Start_Audio_Play(),this.isSupportOffscreenCanvasForVideoDecode&&(br=new MessageChannel,_.Notify_Audio_Video_Thread_Msg_Channel(br),g.A.decoderinworklet?g.A.AudioNode.port.postMessage({status:"decodeVideoPort"},[br.port2]):_.Notify_Audio_Thread_Msg_Channel2(br)),!r.CaptureAudio){e.next=495;break}if(nr.audioCapture=r.CaptureAudioInfo,!(Er=r.CaptureAudioInfo.audioProfile)){e.next=492;break}if("backgroundNoiseSuppression"!==Er.currentSelect){e.next=485;break}kr="Zoom"===Er.backgroundNoiseSuppression,Ze.A.changeDenoiseSwitch(kr),_.Notify_Audio_Encode_Thread({command:"highBitrate",highBitrate:Er.highBitrate?1:0}),e.next=492;break;case 485:if(Rr={command:"original_sound_switch",enable:!0,highfidelity:null===(Cr=Er.originalSound)||void 0===Cr?void 0:Cr.highfidelity,stereo:null===(wr=Er.originalSound)||void 0===wr?void 0:wr.stereo},!this.useWebRTCAudio){e.next=491;break}return e.next=489,null===(Ir=this.webrtcAudio)||void 0===Ir?void 0:Ir.setAudioProfile(Er);case 489:e.next=492;break;case 491:_.Notify_Audio_Encode_Thread(Rr);case 492:nr.Start_Audio_Capture(),this.firstSetDelay&&(this.firstSetDelay=!1,_.Reset_Aec()),e.next=496;break;case 495:g.A.ComputerAudioStatus=N.BX.ComputerAudio_Connected,g.A.Notify_APPUI(p.Ubu,null);case 496:e.next=501;break;case 498:e.prev=498,e.t9=e.catch(385),m.Ay.error("join audio failed",e.t9),g.A.ComputerAudioStatus=N.BX.ComputerAudio_Null,g.A.Notify_APPUI(p.Ubu,null),g.A.Notify_APPUI(p.pHx,null),Un.error(e.t9),this.JsMediaSDK_Log(e.t9);case 501:return e.abrupt("break",763);case 502:if(g.A.DesktopAudioStatus===N.BX.DesktopAudio_Null){e.next=504;break}return e.abrupt("return",void g.A.Notify_APPUI(p.bW9,null));case 504:if(g.A.DesktopAudioStatus=N.BX.DesktopAudio_Connecting,this.useWebRTCAudio=!!r.audioBridge,!this.useWebRTCAudio){e.next=507;break}return Ze.A.setUserId(r.CaptureAudioInfo.ssrc),this.webrtcAudio&&(Dr=this.meetingParams,Or=Dr.meetingNumber,xr=Dr.rwgHost,Pr=Dr.userId,Lr=Dr.cid,Nr=Dr.webrtcMode,Vr=Dr.abToken,this.setupLocalPreview({audioBridge:{abToken:Vr,rwgHost:xr,meetingNumber:Or,userId:Pr,cid:Lr,webrtcMode:Nr,isCapturingAudio:r.CaptureAudio,audioMode:z.$t}})),e.abrupt("return",(Ze.A.setWebRTCAudio(this.webrtcAudio),this.Start_Desktop_Audio_Capture(),g.A.DesktopAudioStatus=N.BX.DesktopAudio_Connected,void g.A.Notify_APPUI(p.bW9,null)));case 507:if(e.t10=this.isChromeWideAECSupported&&g.A.ComputerAudioStatus!=N.BX.ComputerAudio_Null&&!this.audioDomNode&&g.A.shareSystemAudio,!e.t10){e.next=512;break}return e.next=511,this.isLocalP2PSupportedPromise;case 511:e.t10=e.sent;case 512:if(!e.t10){e.next=524;break}return g.A.AudioNode.disconnect(),Ur=this.audioCtx.createMediaStreamDestination(),this.getAudioNode().connect(Ur),Fr=Ur.stream,e.next=519,this.chromeAecWorkAround(Ur.stream);case 519:Fr=e.sent,this.audioDomNode||(this.audioDomNode=new Audio),this.audioDomNode.srcObject=Fr,Wr=Ze.A.speakerId,Gr=Date.now(),this.selectComputerAudioSpeaker(Wr,Gr),this.audioDomNode.play().catch((function(e){m.Ay.error("Audio play failed",e)}));case 524:return e.prev=524,_.Notify_Audio_Encode_Thread({command:"mute",bOn:p.Eym,sharing:!0}),this.sharingAudioCtx&&(this.sharingAudioCtx.close(),this.isSharingCaptureNodeConnect=!1),Hr=h.Ay.getAudioContextConfigure(),this.sharingAudioCtx=(0,h.gd)("MainSharing",Hr),jr=this,Kr=this.audioWorkletJsPath.sharingAudioWorkletPath,e.next=531,this.sharingAudioCtx.audioWorklet.addModule(Kr);case 531:g.A.SharingAudioNode=new l.A(jr.sharingAudioCtx,"zoomSharingAudioWorklet",{processorOptions:{sharingEncodeChannelsNum:h.Ay.isSupportSharingStereo()?2:1}}),g.A.sharedBuffer&&g.A.SharingAudioNode.postCMD("sharedBuffer",g.A.sharedBuffer),zr=new MessageChannel,g.A.SharingAudioNode.port.postMessage({status:"encodeAudioPort"},[zr.port1]),_.Notify_Audio_Thread_Msg_Channel3(zr),_.Notify_Audio_Encode_Thread({command:"startAudioEncode",ssid:r.CaptureAudioInfo.ssrc,samplerate:this.sharingAudioCtx.sampleRate,isSharing:!0,audioMode:g.A.audioMode,sharingEncodeChannelsNum:h.Ay.isSupportSharingStereo()?2:1}),_.Update_Audio_Encrpt(g.A.e2eencrypt),jr.Start_Desktop_Audio_Capture(),e.next=540;break;case 537:e.prev=537,e.t11=e.catch(524),Un.error(e.t11),this.JsMediaSDK_Log(e.t11);case 540:return g.A.DesktopAudioStatus=N.BX.DesktopAudio_Connected,g.A.Notify_APPUI(p.bW9,null),e.abrupt("break",763);case 542:if(g.A.DesktopAudioStatus===N.BX.DesktopAudio_Connected){e.next=544;break}return e.abrupt("return",void g.A.Notify_APPUI(p.CIY,null));case 544:if(Yr=!1,r&&r.isPause&&(Yr=!0),Yr||this.EndDesktopAudioMediaStream(),this.Remove_Sharing_Audio_Capture(),this.useWebRTCAudio)null===(Xr=this.webrtcAudio)||void 0===Xr||Xr.leaveAudioWithoutDisconnect(z.$t);else{this.isChromeWideAECSupported&&this.audioDomNode&&(g.A.AudioNode.disconnect(),this.CloseBoringPeerConnection(),this.audioDomNode=null,Qr="default"==Ze.A.speakerId?"":Ze.A.speakerId,this.getAudioNode().connect(this.audioCtx.destination),Jr=Date.now(),this.selectComputerAudioSpeaker(Qr,Jr));try{g.A.SharingAudioNode&&(g.A.SharingAudioNode.postCMD("stopWorklet",!0),g.A.SharingAudioNode.port=null,g.A.SharingAudioNode.disconnect(),g.A.SharingAudioNode=null)}catch(e){Un("SharingAudioNode.port",e)}this.sharingAudioCtx&&(this.sharingAudioCtx.close(),this.isSharingCaptureNodeConnect=!1),this.sharingAudioCtx=null}return null===(qr=this.screenShareAudioPreviewElement)||void 0===qr||qr.pause(),g.A.DesktopAudioStatus=N.BX.DesktopAudio_Null,g.A.Notify_APPUI(p.CIY,null),e.abrupt("break",763);case 548:return Un("sdk start remote control 1"),$r=this.sharingWidthAndHeightInfo,Zr=new B(Object.assign({dom:document},r)),e.abrupt("return",(this.remoteControl=Zr,Un("sharingInfo",$r),Zr.setDstWidthAndHeight($r.logicWidth,$r.logicHeight),Zr.setSrcWidthAndHeight($r.logicWidth,$r.logicHeight),Zr.setSrcScaleWidthAndHeight(r.scaleWidth,r.scaleHeight),Zr.setSrcOffsetXY(r.srcOffsetX,r.srcOffsetY),Zr.setRemoteOS(r.os),Zr.start().then((function(e){return g.A.Notify_APPUI(e?p.cBD:p.aKW),e&&(Zr.onPasteTextLengthOverflow((function(){g.A.Notify_APPUI(p.lA5)})),Zr.onReturnCopiedText((function(e){Un(e),g.A.Notify_APPUI(p.CY1,e)}))),e})).catch((function(e){return Un(e),g.A.Notify_APPUI(p.aKW),m.Ay.error("An error occurred when trying to start remote control",e),K.A.add_monitor("RMCTF"),Promise.reject(e)}))));case 551:return e.abrupt("return",this.remoteControl.destroy().then((function(e){return g.A.Notify_APPUI(e?p.AL$:p.M9W),e})));case 552:return this.remoteControl&&(r.scaleWidth&&r.scaleHeight&&this.remoteControl.setSrcScaleWidthAndHeight(r.scaleWidth,r.scaleHeight),(x()(r.srcOffsetX)||x()(r.srcOffsetY))&&this.remoteControl.setSrcOffsetXYAndSendPDU(r.srcOffsetX,r.srcOffsetY),G()(r.isControllerNow)&&this.remoteControl.setIsControlerNow(r.isControllerNow),x()(r.os)&&this.remoteControl.setRemoteOS(r.os)),e.abrupt("break",763);case 554:return this.remoteControl&&this.remoteControl.sendPostionPDU(),e.abrupt("break",763);case 556:return this.mainSharingCanvas=r.canvas||this.mainSharingCanvas,this.annoCanvas=r.annoCanvas||this.annoCanvas,this.annoPresenterCanvas=r.annoPresenterCanvas,this.localShareCanvasExt=r.localShareCanvas,this.localShareCanvasWaiting&&(this.isSupportSharingTrackReader||this.isSupportMediaStreamTrackProcessor?(this.sharePreviewVideo&&(this.desktopSharingValue.canvas=this.sharePreviewVideo),this.sharePreviewVideo&&(this.desktopSharingValue.video=this.sharePreviewVideo)):(this.sharePreviewCanvas&&(this.desktopSharingValue.canvas=this.sharePreviewCanvas),this.sharePreviewVideo&&(this.desktopSharingValue.video=this.sharePreviewVideo)),this.shareTrack=this.desktopSharingMediaStream.getVideoTracks()[0],this.shareTrack?(this.shareTrack.onended=this.onShareStreamEnded.bind(this),this.Start_Desktop_Sharing(),en=this.shareTrack.getSettings(),rn=en.width,nn=en.height,an=en.displaySurface,g.A.Notify_APPUI(p.p8Y,{width:rn,height:nn,displaySurface:an})):m.Ay.error("shareTrack is null when share screen"),this.localShareCanvasWaiting=!1),this.shareAnnotationInited?this.localAnnoStarted&&(this.annoPresenterCanvas.style.visibility="hidden",this.annoPresenterCanvas.width=this.localShareCanvas.width,this.annoPresenterCanvas.height=this.localShareCanvas.height,this.switchAnnoCanvasZIndex(this.annoCanvas,this.annoPresenterCanvas),null===(on=this.annotationMgr)||void 0===on||on.updateCanvas({sharingMainCanvas:this.localShareCanvas,annoCanvas:this.annoPresenterCanvas})):this.initShareAnnotation()&&this.startAnnotation({presenterId:this.shareSessionId,shareSessionId:this.shareSessionId}),e.abrupt("break",763);case 559:return this.sharePreviewVideo=null,this.sharePreviewCanvas=null,e.abrupt("break",763);case 561:if(this.loadAnnotationModule(),this.isSupportSharingTrackReader||this.isSupportMediaStreamTrackProcessor?(this.sharePreviewVideo&&(r.canvas=this.sharePreviewVideo),this.sharePreviewVideo&&(r.video=this.sharePreviewVideo)):(this.sharePreviewCanvas&&(r.canvas=this.sharePreviewCanvas),this.sharePreviewVideo&&(r.video=this.sharePreviewVideo)),this.localShareCanvasWaiting=!!r.hasPreview,this.flipSend=!0,!this.isStartDesktopSharing){e.next=563;break}return e.abrupt("return");case 563:return _.Update_Sharing_Encrpt(g.A.e2eencrypt),this.isStartDesktopSharing=!0,this.desktopSharingSend=!0,cn=(0,h.e5)(r.canvas),dn=cn.dom,ln=cn.id,r.canvas&&(r.rendercanvasID=ln),this.isSupportMediaStreamTrackProcessor?r.video=dn:(r.video=(0,h.e5)(r.video).dom,r.canvas=dn),this.desktopSharingValue=r,this.Start_Desktop_Sharing(),e.abrupt("break",763);case 567:if(this.localShareCanvasWaiting=!1,this.flipSend=!0,g.A.shareSystemAudio=!1,this.isStartDesktopSharing){e.next=569;break}return e.abrupt("return");case 569:return this.desktopSharingSend=!1,this.StopSharingCapture(),this.stopAnnotation({presenterId:this.shareSessionId}),this.isSupportVideoShare?_.Update_Sharing_Video_Encode_Status({command:"stopsharing"}):_.Update_Sharing_Encode_Status({command:"stopsharing"}),e.abrupt("break",763);case 571:if(this.flipSend=!0,this.isStartDesktopSharing){e.next=573;break}return e.abrupt("return");case 573:return this.desktopSharingSend=!1,this.isSupportVideoShare?_.Update_Sharing_Video_Encode_Status({command:"pause"}):_.Update_Sharing_Encode_Status({command:"pause"}),e.abrupt("break",763);case 575:if(this.flipSend=!0,this.isStartDesktopSharing){e.next=577;break}return e.abrupt("return");case 577:return this.desktopSharingSend=!0,this.isSupportMediaStreamTrackProcessor||this.Process_Sharing(),this.isSupportVideoShare?_.Update_Sharing_Video_Encode_Status({command:"resume"}):_.Update_Sharing_Encode_Status({command:"resume"}),e.abrupt("break",763);case 579:if(window.WebQrscanner){e.next=581;break}return e.abrupt("return",void console.error("qrScanner not loaded"));case 581:return K.A.add_monitor("QRSCAN:".concat(r.enable)),r.enable&&this.desktopSharingMediaStream?WebQrscanner.qrScanner.start(this.desktopSharingValue.video,(function(e){g.A.Notify_APPUI_SAFE(p.GT7,e)}),(function(){K.A.add_monitor("QRSCANTIMEOUT")})):WebQrscanner.qrScanner.stop(),e.abrupt("break",763);case 583:if(this.isStartWhiteboardSharing=!0,hn=(0,h.e5)(r.canvas),fn=hn.dom,pn=hn.id,r.canvas&&(r.rendercanvasID=pn),!this.isStartDesktopSharing){e.next=587;break}return e.abrupt("return");case 587:return _.Update_Sharing_Encrpt(g.A.e2eencrypt),r.video=r.canvas=fn,this.isStartDesktopSharing=!0,this.desktopSharingSend=!0,this.desktopSharingValue=r,this.Start_Whiteboard_Sharing(),e.abrupt("break",763);case 589:if(this.isStartWhiteboardSharing=!1,this.isStartDesktopSharing){e.next=591;break}return e.abrupt("return");case 591:return this.desktopSharingSend=!1,this.isStartDesktopSharing=!1,_.Update_Sharing_Encode_Status({command:"stopsharing"}),e.abrupt("break",763);case 593:return(vn=document.createElement("img")).src="chrome-extension://kgjfgplpablkjnlkjmjdecgdpfankdle/images/trash.png",vn.onload=function(){g.A.Notify_APPUI(p.px,!0)},vn.onerror=function(){g.A.Notify_APPUI(p.px,!1)},e.abrupt("break",763);case 596:if(r.evt!==p.kqY&&r.evt!==p.FQb){e.next=607;break}if(Un("rwg answer from ui",r),r.answer){e.next=599;break}return e.abrupt("return");case 599:e.t12=r.answer.type,e.next=e.t12===N.wd.ZOOM_CONNECTION_VIDEO?602:e.t12===N.wd.ZOOM_CONNECTION_AUDIO?604:605;break;case 602:return E.A.trigger(p.gh2.ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT,r),e.abrupt("break",605);case 604:E.A.trigger(p.gh2.ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT,r);case 605:e.next=608;break;case 607:r.evt===p.r4R&&r.body&&r.body.token&&E.A.trigger(p.gh2.AUDIO_BRIDGE_WS_TOKEN,r.body.token);case 608:return e.abrupt("break",763);case 609:return _.updateCook(r.cook),e.abrupt("break",763);case 611:if(!this.isLSSPlayer){e.next=614;break}return _.setUserNodeListToWorker(r),e.abrupt("break",763);case 614:return _.setUserNodeListToWorker(r.userList),!this.setvideokk&&r.encryptKey&&(this.setvideokk=!0,_.pushMessageToWorker(N._c.VIDEO_DECODE,{KK:r.encryptKey},"MAIN_KK",!1,!0),_.pushMessageToWorker(N._c.VIDEO_ENCODE,{KK:r.encryptKey},"MAIN_KK",!1,!0)),e.abrupt("break",763);case 616:return K.A.add_monitor("AUIOD_INTERPRETATION_MUTE: ".concat(r.mute)),this.webrtcAudio?null===(gn=(yn=this.webrtcAudio).interpretation_set_mute)||void 0===gn||gn.call(yn,r.mute):_.Notify_Audio_Thread_Interpretation_Mute(r.mute),e.abrupt("break",763);case 618:return K.A.add_monitor("AUDIO_INTERPRETATION_SELECT_LANGUAGE: ".concat(r.lang)),this.webrtcAudio?null===(_n=(Sn=this.webrtcAudio).interpretation_set_lang)||void 0===_n||_n.call(Sn,r.lang):_.Notify_Audio_Thread_Interpretation_Set_Lang(r.lang),e.abrupt("break",763);case 620:return K.A.add_monitor("AUDIO_INTERPRETATION_LIST_INFO: ".concat(JSON.stringify(r.interpreterList))),this.webrtcAudio?null===(An=(bn=this.webrtcAudio).interpretation_set_list)||void 0===An||An.call(bn,r.interpreterList):_.Notify_Audio_Thread_Interpretation_Set_Interpreter(r.interpreterList),e.abrupt("break",763);case 622:return K.A.add_monitor("AUDIO_INTERPRETATION_ENABLE: ".concat(r.enable)),this.webrtcAudio?null===(En=(kn=this.webrtcAudio).interpretation_set_enable)||void 0===En||En.call(kn,r.enable):_.Notify_Audio_Thread_Interpretation_Enable(r.enable),e.abrupt("break",763);case 624:if(!this.webrtcConfig.webrtcflag){e.next=628;break}this.wmscManager.sendMessageToWMSC({type:"UPDATE_WMSC_PARAMS",data:{preferSoftwareCodec:{recv:!r.enable}}}),e.next=637;break;case 628:if(e.t13=r.enable&&this.isEnableVideoDecodeHardWareThread,!e.t13){e.next=636;break}if(e.t14=null!==this.videodecodehardwareflag,e.t14){e.next=635;break}return e.next=634,h.Ay.IsSupportVideoDecodeHardwareAcceleration(g.A.enableHADecOpt);case 634:this.videodecodehardwareflag=e.sent;case 635:r.enable=this.videodecodehardwareflag;case 636:_.Notify_Video_Decode_Thread({command:"hwstatus",enable:r.enable});case 637:return e.abrupt("break",763);case 638:if(!this.webrtcConfig.webrtcflag){e.next=642;break}this.wmscManager.sendMessageToWMSC({type:"UPDATE_WMSC_PARAMS",data:{preferSoftwareCodec:{send:!r.enable}}}),e.next=645;break;case 642:if(!(g.A.disableHWCodec&z.mV)){e.next=644;break}return e.abrupt("break",763);case 644:r.enable&&this.videoencodehardwareflag&&(!this.isAppleGraphic||h.Ay.isChromiumVersionHigherThan(111)||this.doesSafariSupportWebcodec())?r.enable=!0:r.enable=!1,_.Notify_Video_Encode_Thread({command:"hwstatus",enable:r.enable});case 645:return e.abrupt("break",763);case 646:return this.isVideoHD=!(null==r||!r.videohd),this.webrtcConfig.webrtcflag?this.wmscManager&&this.wmscManager.sendMessageToWMSC({type:"UPDATE_WMSC_PARAMS",data:{hdVideoEnabled:this.isVideoHD}}):(K.A.add_monitor("NoVideoHD:".concat(!this.isVideoHD)),!r.videohd&&this.videoencodehardwareflag&&(h.Ay.set720pcapacity(!1),K.A.add_monitor("CAPTURE720:"+!1),_.Notify_Video_Encode_Thread({command:"videohd",videohd:r.videohd}))),e.abrupt("break",763);case 648:return K.A.add_monitor("UVFHD"+r.videofullhd),h.Ay.set1080pcapacity(r.videofullhd),_.Notify_Video_Encode_Thread({command:"videofullhd",videofullhd:r.videofullhd}),e.abrupt("break",763);case 650:return this.useWebRTCAudio?null===(Cn=this.webrtcAudio)||void 0===Cn||Cn.setShareVolumeLevel(r.userid,r.shareVolume,r.isFromMainSession):_.Notify_Audio_Decode_Thread({command:"setShareVolumeLevel",userid:r.userid,shareVolume:r.shareVolume,isFromMainSession:r.isFromMainSession,isSecondAudio:!!r.isSecondAudio}),e.abrupt("break",763);case 652:return r.mediaActionType==p.EcQ.SHARING_DECODE&&(this.isSupportVideoShare?_.pushMessageToWorker(N._c.VIDEO_DECODE,r,hr.P7,!1,!0):_.pushMessageToWorker(N._c.SHARING_DECODE,r,hr.P7,!1,!0)),r.mediaActionType==p.EcQ.SHARING_ENCODE&&(this.isSupportVideoShare?_.pushMessageToWorker(N._c.VIDEO_ENCODE,r,hr.P7,!1,!0):_.pushMessageToWorker(N._c.SHARING_ENCODE,r,hr.P7,!1,!0)),r.mediaActionType==p.EcQ.AUDIO_DECODE&&_.pushMessageToWorker(N._c.AUDIO_DECODE,r,hr.P7,!1,!0),e.abrupt("break",763);case 654:return r.mediaActionType==p.EcQ.SHARING_DECODE&&(this.isSupportVideoShare?_.pushMessageToWorker(N._c.VIDEO_DECODE,r,hr.Am,!1,!0):_.pushMessageToWorker(N._c.SHARING_DECODE,r,hr.Am,!1,!0)),r.mediaActionType==p.EcQ.SHARING_ENCODE&&(this.isSupportVideoShare?_.pushMessageToWorker(N._c.VIDEO_ENCODE,r,hr.Am,!1,!0):_.pushMessageToWorker(N._c.SHARING_ENCODE,r,hr.Am,!1,!0)),r.mediaActionType==p.EcQ.AUDIO_DECODE&&_.pushMessageToWorker(N._c.AUDIO_DECODE,r,hr.Am,!1,!0),e.abrupt("break",763);case 656:return this.isSupportVideoShare?_.pushMessageToWorker(N._c.VIDEO_DECODE,r,"SHARING_ADD_REV_CHANNEL_TYPE",!1,!0):_.pushMessageToWorker(N._c.SHARING_DECODE,r,"SHARING_ADD_REV_CHANNEL_TYPE",!1,!0),e.abrupt("break",763);case 658:return this.isSupportVideoShare?_.Notify_Sharing_Video_Decode_Thread({command:"SHARING_REMOVE_REV_CHANNEL_TYPE",data:r}):_.Notify_Sharing_Decode_Thread({command:"SHARING_REMOVE_REV_CHANNEL_TYPE",data:r}),e.abrupt("break",763);case 660:return this.isSupportVideoShare?_.Notify_Sharing_Video_Decode_Thread({command:"BUILD_MS_CHANNEL_IN_BO",data:r}):_.Notify_Sharing_Decode_Thread({command:"BUILD_MS_CHANNEL_IN_BO",data:r}),e.abrupt("break",763);case 662:return(wn=r.type)?wn===N.Xt.VIDEO?this.SWITCH_VIDEO_WATER_MARK(r):wn===N.Xt.SHARING&&this.SWITCH_SHARING_WATER_MARK(r):(this.SWITCH_VIDEO_WATER_MARK(r),this.SWITCH_SHARING_WATER_MARK(r)),e.abrupt("break",763);case 665:return this.useWebRTCAudio?null===(Tn=this.webrtcAudio)||void 0===Tn||Tn.set_CC_lang(r.lang):_.Notify_Audio_Thread_CC_Set_Lang(r.lang),e.abrupt("break",763);case 667:return _.Notify_Audio_Decode_Thread({command:"BUILD_MA_CHANNEL_IN_BO",data:r}),e.abrupt("break",763);case 669:return K.A.add_monitor("ESTB:"+r.enable),this.useWebRTCAudio?null===(Rn=this.webrtcAudio)||void 0===Rn||Rn.enableShareToBO(r.enable):_.Notify_Audio_Encode_Thread({command:"ENABLE_SHARE_TO_BO",data:r.enable}),e.abrupt("break",763);case 671:return r.data[0]==z.nV&&_.pushMessageToWorker(N._c.VIDEO_DECODE,r.data.buffer,void 0,!0,!0),r.data[0]==z.FW&&_.pushMessageToWorker(N._c.AUDIO_DECODE,r.data.buffer,void 0,!0,!0),e.abrupt("break",763);case 673:return this.gainNode.gain.value=Number(r),e.abrupt("break",763);case 675:return K.A.add_monitor("EBTB:"+r.enable),this.useWebRTCAudio?null===(In=this.webrtcAudio)||void 0===In||In.enableBroadCastToBO(r.enable):_.Notify_Audio_Encode_Thread({command:"ENABLE_BROADCAST_TO_BO",data:r.enable}),e.abrupt("break",763);case 677:if(Dn=(0,h.e5)(r.canvasId).dom,r.canvas&&(Dn=r.canvas),Dn){e.next=680;break}return e.abrupt("return");case 680:if(Mn=null,xn=this.replaceCanvasMap.videoDecodeCanvasIds&&-1!==this.replaceCanvasMap.videoDecodeCanvasIds.indexOf(r.canvasId),Pn=this.replaceCanvasMap.videoEncodeCanvasIds&&-1!==this.replaceCanvasMap.videoEncodeCanvasIds.indexOf(r.canvasId),r.canvasId===this.replaceCanvasMap.videoMaskSettingCanvasId?Mn=g.A.localVideoEncMGR:r.canvasId===this.replaceCanvasMap.sharingMainCanvasId?Mn=this.isSupportVideoShare?g.A.localVideoDecMGR:g.A.localSharingDecMGR:r.canvasId===this.replaceCanvasMap.sharingPreviewCanvasId?Mn=g.A.localSharingEncMGR:(Pn||xn)&&(Mn=Pn?g.A.localVideoEncMGR:g.A.localVideoDecMGR,this.lazyReplaceEncodeCanvasTimer&&(clearTimeout(this.lazyReplaceEncodeCanvasTimer),this.lazyReplaceEncodeCanvasTimer=null),this.lazyReplaceEncodeCanvasTimer=setTimeout((function(){var e=g.A.localVideoEncMGR;if(e){var t=e.map.get(g.A.SPECIAL_ID);t&&t.postMessage({command:"WEBGL_LOST_REPLACE_CANVAS"})}var r=g.A.localSharingEncMGR;if(r){var n=r.map.get(g.A.SPECIAL_ID);n&&n.postMessage({command:"WEBGL_LOST_REPLACE_CANVAS"})}if(ni.videoCaptureHiddenCanvas){var i=ni.videoCaptureHiddenCanvas,a=i.width,o=i.height;h.Ay.isSupport2dOffscreenCanvas()?ni.videoCaptureHiddenCanvas=new OffscreenCanvas(a,o):(ni.videoCaptureHiddenCanvas=document.createElement("canvas"),ni.videoCaptureHiddenCanvas.width=a,ni.videoCaptureHiddenCanvas.height=o),ni.videoCaptureHiddenCanvasCtx=ni.videoCaptureHiddenCanvas.getContext("2d")}if(ni.bgCanvas){var s=ni.bgCanvas,u=s.width,c=s.height;ni.bgCanvas=document.createElement("canvas"),ni.bgCanvas.width=u,ni.bgCanvas.height=c,ni.bgCanvasctx=ni.bgCanvas.getContext("2d"),!ni.VideoMaskSettingCanvas&&ni.PrevVideoMaskSettingCanvas?(ni.VideoMaskSettingCanvas=ni.PrevVideoMaskSettingCanvas,ni.Update_Mask_Texture(ni.maskCoordinate,ni.videoCaptureHiddenCanvas.width,ni.videoCaptureHiddenCanvas.height),ni.VideoMaskSettingCanvas=null):ni.Update_Mask_Texture(ni.maskCoordinate,ni.videoCaptureHiddenCanvas.width,ni.videoCaptureHiddenCanvas.height)}}),500)),Mn)try{Nn=Dn.transferControlToOffscreen(),(Bn=Mn.map.get(g.A.SPECIAL_ID))&&Bn.postMessage({command:"WEBGL_LOST_REPLACE_CANVAS",data:{canvasId:r.canvasId,canvas:Nn}},[Nn])}catch(e){}return e.abrupt("break",763);case 684:if(K.A.add_monitor("CHIDE:"+r.enable),this.enableHID=r.enable,!r.enable){e.next=699;break}if(e.t15=this.hidAvalible,!e.t15){e.next=692;break}return e.next=691,ze.destroy();case 691:this.hidAvalible=!1;case 692:if(e.t16=r.microphoneLabel,!e.t16){e.next=697;break}return e.next=696,ze.init(r.microphoneLabel,r.defaultMuted);case 696:this.hidAvalible=e.sent;case 697:e.next=704;break;case 699:if(e.t17=this.hidAvalible,!e.t17){e.next=704;break}return e.next=703,ze.destroy();case 703:this.hidAvalible=!1;case 704:return e.abrupt("break",763);case 705:return _.Notify_Video_Decode_Thread({command:"ENABLE_VIDEO_OBSERVER",data:r.enable,enablefps:!r.fpsdisbale}),e.abrupt("break",763);case 707:return this.isAnnotationPMEnabled&&(this.drawLocalShareInterval=1===r.mode?200:70,clearInterval(this.drawLocalShareIntervalId),this.localAnnoStarted&&(this.drawLocalShareIntervalId=setInterval((function(){ni.drawLocalAnnotationContent()}),this.drawLocalShareInterval))),_.Notify_Video_Encode_Thread({command:"SWITCH_SHARING_TYPE",data:r.mode}),e.abrupt("break",763);case 709:return this.useWebRTCAudio&&(null===(Wn=this.webrtcAudio)||void 0===Wn||Wn.setSpeechVolumeLevel(r.userId,r.volume)),g.A.decoderinworklet?g.A.AudioNode&&g.A.AudioNode.postCMD("setSpeechVolumeLevel",{userid:r.userId>>10,volume:r.volume}):_.Notify_Audio_Decode_Thread({command:"setSpeechVolumeLevel",userid:r.userId>>10,volume:r.volume}),e.abrupt("break",763);case 711:return this.useWebRTCAudio&&(null===(Gn=this.webrtcAudio)||void 0===Gn||Gn.updateUserMuteUnmuteStatus(r)),e.abrupt("break",763);case 713:return Vn._updateVideoConstraints({advanced:[r]}),e.abrupt("break",763);case 715:return this._SaveSystemInfo(),g.A.clearMessageToRwg(),e.abrupt("break",763);case 717:return Vn.enableReuseStream(r.enable),e.abrupt("break",763);case 719:return Vn.presetConstraints(r||{}),e.abrupt("break",763);case 721:return Vn.destoryReuseStream({audio:r&&r.audio,video:r&&r.video}),e.abrupt("break",763);case 723:return Hn={command:"WHITEBOARD_JOIN_MESSAGE",data:r.message,nodeId:r.nodeId,encryptKey:r.encryptKey,sn:r.sn,dcsId:r.dcsId,EncodedSn:r.EncodedSn},this.isSupportVideoShare?_.Notify_Sharing_Video_Encode_Thread(Hn):_.Notify_Sharing_Encode_Thread(Hn),e.abrupt("break",763);case 726:return K.A.add_monitor("STOP_INCOMING_AUDIO: ".concat(r)),this.useWebRTCAudio?null===(jn=this.webrtcAudio)||void 0===jn||jn.stopIncomingAudio(r):g.A.decoderinworklet?_.Notify_Audio_Decode_Thread({command:"stop_audio_incoming",stopPlayAudio:r}):g.A.AudioNode&&g.A.AudioNode.postCMD("stop_audio_incoming",r),e.abrupt("break",763);case 728:if(this.isLandScape=r.isLandScape,Vn.videoStreamTrack){e.next=730;break}return e.abrupt("return");case 730:return this.isLandScape&&this.captureSize&&this.Change_Video_Capture_Resolution(this.captureSize.width,this.captureSize.height),e.abrupt("break",763);case 732:return this.localLog&&this.localLog.saveAllLogFiles(),e.abrupt("break",763);case 734:return Vn&&Vn.audioStream&&(Kn=Vn.audioStream.getAudioTracks()[0])&&(Kn.muted||"live"!==Kn.readyState)&&(0,S.iK)(p.UyE,S.pg.EXCEPTION),e.abrupt("break",763);case 736:return zn=[g.A.localVideoDecMGR,g.A.localVideoEncMGR],qn=g.A.SPECIAL_ID,zn.forEach((function(e){if(e){var t=e.map.get(qn);if(t){var n={command:"removeExpiredCanvas",rendercanvasID:r.canvasId};t.postMessage(n)}}})),tn.X.rmCanvas(r.canvasId),e.abrupt("break",763);case 739:return this.webrtcConfig.webrtcflag?(K.A.add_monitor("WMSC_UI_S_V: ".concat((0,h.iD)(JSON.stringify(r)))),this.wmscManager&&Array.isArray(r)&&r.length>0&&this.wmscManager.sendMessageToWMSC({type:"NOTIFY_SDK_SUBSCRIBE_VIDEO",data:r})):g.A.sendMessageToRwg(p.yJV,{evt:p.xQc,body:{subInfoList:r}}),e.abrupt("break",763);case 741:return Array.isArray(r)&&r.length>0&&(this.webrtcConfig.webrtcflag&&this.wmscManager?(K.A.add_monitor("WMSC_UI_UNS_V: ".concat((0,h.iD)(JSON.stringify(r)))),this.wmscManager.sendMessageToWMSC({type:"NOTIFY_SDK_UNSUBSCRIBE_VIDEO",data:r})):g.A.sendMessageToRwg(p.yJV,{evt:p.WCu,body:{subIDList:r}})),e.abrupt("break",763);case 743:return K.A.add_monitor("HOLD:".concat(null==r?void 0:r.hold,":").concat(null==r?void 0:r.userid,":").concat(null==r?void 0:r.reinit)),!r.hold&&this.isSupportVideoShare&&(null===(Yn=g.A.sharingDecInitInstance)||void 0===Yn||Yn.resetHandleDeferred(),null===(Xn=g.A.sharingEncInitInstance)||void 0===Xn||Xn.resetHandleDeferred()),r&&!r.userid&&(r.userid=this.userId),_.setMediaSessionHold(this,r),!r.hold&&r.userid&&(this.userId=r.userid),r.hold&&this.SessionHold(),g.A.videoEncodeSession=null,g.A.videoDecodeSession=null,g.A.sharingDecodeSession=null,g.A.sharingEncodeSession=null,g.A.audioDecodeSession=null,g.A.audioEncodeSession=null,e.abrupt("break",763);case 745:return g.A.decoderinworklet?g.A.workletWasmInitSuccess&&g.A.AudioNode?g.A.AudioNode.postCMD(hr.TR,{volume:r}):g.A.workletMessageQueue.enqueue({command:hr.TR,volume:r}):_.Notify_Audio_Decode_Thread({command:hr.TR,volume:r}),e.abrupt("break",763);case 747:return K.A.add_monitor("ENABLE_FILE_AUDIO_PLAYBACK_LOCALLY: ".concat(r)),this.setFileAudioPlaybackSwitch(r),e.abrupt("break",763);case 749:if((null===(Qn=r.body.data)||void 0===Qn?void 0:Qn.evt)!==p.Y9c){e.next=755;break}Mr.q.set(this.mid,{hasSilkAudio:!0}),$n=5*Math.random(),setTimeout((function(){m.Ay.directReport("silk meeting ,failover to AB"),g.A.Notify_APPUI(p.oQY,{audio:z.mz})}),$n),e.next=758;break;case 755:if((null==r||null===(Jn=r.body)||void 0===Jn?void 0:Jn.type)!==Tr.MeshControl){e.next=757;break}return e.abrupt("return",void this.meshMessage(r.body));case 757:r.body.type===p.mrR?(ei=r.body.data,ti=ei.ssrc,ri=ei.lang_id,null===(Zn=this.webrtcAudio)||void 0===Zn||Zn.updateUserLang(ti,ri)):_.TransferCmdMsgToWorker(this,r);case 758:return e.abrupt("break",763);case 759:return e.next=761,this.handlePermissionRequest();case 761:return e.abrupt("break",763);case 762:Un("CAN NOT HANDLE THE EVENT!");case 763:case"end":return e.stop()}}),e,this,[[352,358],[362,369],[385,498],[524,537]])})));return function(t,r){return e.apply(this,arguments)}}(),deviceChangeHandler:function(e,t){var r=sn.isMobileNeedRecaptureAfterDeviceChange(this,e,t),n=r.result,i=r.reason;n&&(m.Ay.log("[deviceChangeHandler] isMobileNeedRecaptureAfterDeviceChange: ".concat(n,", ").concat(i)),K.A.add_monitor("MOBILE_AUDIO_RECAPTURE:".concat(n,",").concat(i)),un(this,this.audioCapture)),g.A.Notify_APPUI_SAFE(p.baF,t)},requestPermissionCallback:function(e){g.A.Notify_APPUI_SAFE(p.M5F,e)},setFileAudioPlaybackSwitch:function(e){e?(this.fileAudioPlaybackTag||(this.fileAudioPlaybackTag=new Audio),this.updateFileAudioPlaybackStream(Vn.audioStream)):this.fileAudioPlaybackTag&&(this.fileAudioPlaybackTag.pause(),this.fileAudioPlaybackTag=null)},updateFileAudioPlaybackStream:function(e){var t;if(Vn.isCaptureAudioFromFile){if(e&&this.fileAudioPlaybackTag){this.fileAudioPlaybackTag.srcObject!==e&&(this.fileAudioPlaybackTag.srcObject=e);var r="default"===Ze.A.speakerId||null===Ze.A.speakerId?"":Ze.A.speakerId;this.fileAudioPlaybackTag.setSinkId&&this.fileAudioPlaybackTag.sinkId!==r&&this.fileAudioPlaybackTag.setSinkId(r).catch((function(e){m.Ay.error("fileAudioPlaybackTag setSinkId error when update stream")})),this.fileAudioPlaybackTag.play().catch((function(e){m.Ay.error("self audio playback failed",e)}))}}else null===(t=this.fileAudioPlaybackTag)||void 0===t||t.pause()},SWITCH_VIDEO_WATER_MARK:function(e){this.videoWaterMarkParams=e;var t=e.enableWaterMark,r=e.waterMarkText,n=void 0===r?"":r,i=e.watermarkOpacity,a=e.watermarkRepeated,o=e.watermarkPosition,s={name:n,opacity:i,repeated:a,position:o};Ve.X.setIsVideoHasWaterMark(!!t),Ve.X.setVideoWatermarkInfo(s),Tn.changeVideoWatermarkInfo(s),this.isCreateVideoWaterMark=!!t,this.videoWaterMarkName=this.isCreateVideoWaterMark?n:"",this.VideoRenderObj?(t?this.isCreateVideoWaterMark&&!this.waterMarkCanvas&&(this.waterMarkCanvas=document.createElement("canvas")):this.VideoRenderObj.Set_WaterMark_Flag(t),this.VideoRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName,watermarkOpacity:i,watermarkRepeated:a,watermarkPosition:o})):_.Notify_Video_Decode_Thread({command:"SWITCH_WATER_MARK_FLAG",isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName,watermarkOpacity:i,watermarkRepeated:a,watermarkPosition:o}),h.Ay.watermark.updateWaterMarkInfo(e)},SWITCH_SHARING_WATER_MARK:function(e){this.sharingWaterMarkParams=e;var t=e.enableWaterMark,r=e.waterMarkText,n=void 0===r?"":r,i=e.watermarkOpacity,a=e.watermarkRepeated,o=e.watermarkPosition,s={name:n,opacity:i,repeated:a,position:o};Ve.X.setIsSharingHasWaterMark(!!t),Ve.X.setSharingWatermarkInfo(s),Tn.changeSharingWatermarkInfo(s),this.isCreateSharingWaterMark=!!t,this.sharingWaterMarkName=this.isCreateSharingWaterMark?n:"",this.SharingRenderObj?(t?this.isCreateSharingWaterMark&&!this.waterMarkCanvas&&(this.waterMarkCanvas=document.createElement("canvas")):this.SharingRenderObj.Set_WaterMark_Flag(t),this.SharingRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:i,watermarkRepeated:a,watermarkPosition:o})):this.isSupportVideoShare?_.Notify_Sharing_Video_Decode_Thread({command:"SWITCH_SHARING_WATER_MARK_FLAG",isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:i,watermarkRepeated:a,watermarkPosition:o}):_.Notify_Sharing_Decode_Thread({command:"SWITCH_WATER_MARK_FLAG",isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:i,watermarkRepeated:a,watermarkPosition:o})},JsMediaSDK_VideoRenderInterval:function(e){return this.VideoRenderObj.Start_Draw.bind(this.VideoRenderObj)(z.hS,e)},JsMediaSDK_SharingRenderInterval:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.SharingRenderObj.No_Bindthis_Interval.bind(this.SharingRenderObj);return setInterval(r,t?20:e)},getShareStreamInfo:function(){if(!this.desktopSharingMediaStream)return null;var e=this.desktopSharingMediaStream.getVideoTracks();if(!e.length)return null;if(e[0].getSettings){var t=e[0].getSettings()||null;return t&&this.sharingCodecInfo.width&&this.sharingCodecInfo.height&&(t.width=this.sharingCodecInfo.width,t.height=this.sharingCodecInfo.height),t}return null},onUnload:function(e){var t=this.rendererType==ee.h3.WEBGPU;m.Ay.log("window.onunload:".concat(this._id,", webGPU:").concat(t)),K.A.add_monitor("window.onunload:".concat(this._id,", webGPU:").concat(t)),t&&this.destroy().catch((function(e){}))},handleUnloadEvent:function(){this.unloadHandler=this.onUnload.bind(this),window.addEventListener("unload",this.unloadHandler)},destroy:function(){var e=this;return H(O().mark((function t(){var r;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Un("destroy"),window.removeEventListener("unload",e.unloadHandler),e.destoryPromise||(g.A.extVBPort&&g.A.extVBPort.postMessage({type:p.L_m}),(0,Q.fw)(),(0,Q.Nd)((function(){})),(0,h.Sq)(),$r.destroy(),e.netThreadMgr.close(),null===(r=e.meshThread)||void 0===r||r.close(),document.removeEventListener("visibilitychange",Fn),e.isDestroy=!0,e.destoryPromise=new Promise(function(){var t=H(O().mark((function t(r,n){var i,a,o,s,u;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,m.Ay.log("DelInstance:".concat(e._id)),g.A._callbackList=[],g.A.localVideoPara.VE=null,g.A.localVideoPara.VD=null,K.A.add_monitor("DelInstance:".concat(e._id)),(0,S._G)(null),e.wmscManager&&(e.wmscManager.destroy(),e.wmscManager=null),null===(i=e.annotationMgr)||void 0===i||i.destroy(),e.annotationMgr=null,e.StopSharingCapture(),clearInterval(e.drawLocalShareIntervalId),a=e,_.Stop_Monitor(e),E.A.clearAllSubscriptions(),_.preserveMessageController.clear(),g.A.destroyQueueMessageToRwg(),e.audioInputLevel&&(e.audioInputLevel.destroy(),e.audioInputLevel=null),e.webrtcAudio&&(e.webrtcAudio.destroy(!1),e.webrtcAudio=null,Vn.webrtcAudio=null),e.EndMedia(),(0,Y.tH)(),e.dataChannelController.unRegister(),e.dataTransportController.unRegister(),e.computePressureManager&&e.computePressureManager.destroy(),o=[g.A.localVideoDecMGR,g.A.localVideoEncMGR,g.A.localSharingDecMGR,g.A.localSharingEncMGR],s=[g.A.localAudioDecMGR,g.A.localAudioEncMGR],u=[g.A.sharingDecInitInstance,g.A.sharingEncInitInstance,g.A.videoDecInitInstance,g.A.videoInitInstance,g.A.audioDecInitInstance,g.A.audioEncodeInitInstance],_.closeAllPromiseObject(u),_.clearWorkerListener(o,s),g.A._Notify_APPUI=null,t.prev=6,t.next=9,new Promise((function(e,t){var r=setTimeout((function(){return e()}),1e3);Promise.all(a.allpromises).finally((function(){clearTimeout(r),e()}))}));case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(6),console.error(t.t0);case 14:return _.CloseMediaNetSessionToRwg(N.wd.ZOOM_CONNECTION_AUDIO,N.oB.NET_WEBTRANSPORT),_.CloseMediaNetSessionToRwg(N.wd.ZOOM_CONNECTION_VIDEO,N.oB.NET_WEBTRANSPORT),t.next=18,_.closeAllMedia(e,o,s);case 18:if(t.t1=e.hidAvalible,!t.t1){t.next=22;break}return t.next=22,ze.destroy();case 22:return Br.resetProcessorManager(),e.processorWorker&&(e.processorWorker.onmessage=null,e.processorWorker.terminate(),e.processorWorker=null),ln.resetProcessorManager(),t.next=27,_.destroyAllWorkers(o,s);case 27:t.next=32;break;case 29:t.prev=29,t.t2=t.catch(0),m.Ay.error("destroy instance ".concat(e._id," error"),t.t2);case 32:m.Ay.flushCacheLog(),r();case 33:case"end":return t.stop()}}),t,null,[[0,29],[6,11]])})));return function(e,r){return t.apply(this,arguments)}}())),t.next=5,e.destoryPromise;case 5:case"end":return t.stop()}}),t)})))()},isWebGPURendererType:function(){var e=this;return H(O().mark((function t(){return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.Ay.evaluateRendererType(e.isWebGPUFeatureEnabled,e.isWebGL2FeatureEnabled);case 2:return t.t0=t.sent,t.t1=ee.h3.WEBGPU,t.abrupt("return",t.t0==t.t1);case 5:case"end":return t.stop()}}),t)})))()},addVbReceiver:function(e){_.Notify_Video_Encode_Thread({command:"addExtVbReceiver"}),g.A.extVBPort&&(g.A.extVBPort.onmessage=null),g.A.extVBPort=e,g.A.frameReceived=0,g.A.frameSent=0,e.onmessage=function(e){e.data.type===p.wb7&&g.A.frameReceived++},K.A.add_monitor("EVBA")},removeVbReceiver:function(){_.Notify_Video_Encode_Thread({command:"removeExtVbReceiver"}),g.A.extVBPort&&(g.A.extVBPort.postMessage({type:p.lLs}),g.A.extVBPort.onmessage=null,g.A.extVBPort=null),K.A.add_monitor("EVBR")},SessionHold:function(){if(this.VideoRenderObj)for(var e=this.VideoRenderObj.clearColor.map((function(e){return e/255}));this.videoRenderArray.length>0;){var t=this.videoRenderArray.shift();this.StopUserVideoRender(this.VideoRenderObj,[t],e,!0)}},StopUserVideoRender:function(e,t,r,n){if(e){n&&e.clearUseridRender(t,r);var i=g.A.enableMultiDecodeVideoWithoutSAB||h.Ay.isSupportMultiViewAPI();i&&e.GiveBack_Display(t),e.Set_Render_Array(this.videoRenderArray,i),0==this.videoRenderArray.length&&(_.Notify_Video_Decode_Thread({command:"stopVideoRender",MFlag:!0}),this.Stop_Video_Play())}},_SaveSystemInfo:function(){try{K.A.add_monitor("JSBN:".concat(qn.buildNumber,",").concat(qn.fixVersion)),K.A.add_monitor("NewInstance:".concat(this._id)),m.Ay.directReport("MediaSDK Version:".concat(qn.fixVersion)),_.saveBrowserInfo()}catch(e){Un(e)}},_isUsingWebRTCAudio:function(){return this.wmscManager&&this.wmscManager.getWMSCAudio()},updateWebRTCVideoStream:function(e){var t=this;return H(O().mark((function r(){var n;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:null!==(n=t.wmscManager)&&void 0!==n&&n.vbSettingVideoDom&&(t.wmscManager.vbSettingVideoDom.srcObject=e),t.isStartVideoCapture&&t.wmscManager.streamId!==e.id&&t.handleWebRTCVideoStream("fromVBModule",e);case 1:case"end":return r.stop()}}),r)})))()},clearCanvas:function(e){e&&e.getContext("2d").clearRect(0,0,e.width,e.height)},loadAnnotationModule:function(){var e=this;this.isAnnotationEnabled&&!this.annotationModule&&(0,h.kA)().then((function(t){var r=t.AnnotationMgr;e.annotationModule=r})).catch((function(e){m.Ay.error("Failed to load AnnotationMgr",e)}))},onShareStreamEnded:function(){K.A.add_monitor("SSBB"),g.A.Notify_APPUI(p.Fxk,null),this.StopSharingCapture()},initShareAnnotation:function(){if(!this.isAnnotationPMEnabled||this.shareAnnotationInited)return!1;var e=document.createElement("div");return this.localShareCanvas=document.createElement("canvas"),this.localShareCanvas.style.visibility="hidden",e.appendChild(this.localShareCanvas),this.annoPresenterCanvas||(this.annoPresenterCanvas=document.createElement("canvas"),this.annoPresenterCanvas.style.visibility="hidden",e.appendChild(this.annoPresenterCanvas)),this.shareAnnotationInited=!0,!0},switchShareStreamForAnnotation:function(){var e=H(O().mark((function e(){var t,r,n,i,a,o,s,c,d=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.desktopSharingMediaStream,this.localShareVideoTag=document.createElement("video"),(n=r.getVideoTracks()[0]).onended=this.onShareStreamEnded.bind(this),e.next=6,Vn.adjustShareResUnder2K(n);case 6:i=n.getSettings(),a=i.width,o=i.height,this.localShareVideoTag.width=a,this.localShareVideoTag.height=o,this.localShareCanvas.width=a,this.localShareCanvas.height=o,this.annoPresenterCanvas.width=a,this.annoPresenterCanvas.height=o,this.annoPresenterCanvas.style.pointerEvents="auto",this.localShareVideoTag.setAttribute("autoplay","true"),(s=new MediaStream).addTrack(n),this.localShareVideoTag.srcObject=s,this.drawLocalShareIntervalId=setInterval((function(){d.drawLocalAnnotationContent()}),this.drawLocalShareInterval),this.annoPresenterCanvas.style.visibility="hidden",null===(t=this.annotationMgr)||void 0===t||t.updateRemoteSizeInfo({width:a,height:o}),this.desktopSharingMediaStreamRaw=this.desktopSharingMediaStream,this.desktopSharingMediaStream=this.localShareCanvas.captureStream(15),c=this.desktopSharingMediaStream.getVideoTracks()[0],this.localShareCanvasExt instanceof HTMLVideoElement&&(this.localShareCanvasExt.setAttribute("autoplay","true"),this.localShareCanvasExt.srcObject=this.desktopSharingMediaStream,this.localShareCanvasExt.play()),setTimeout((function(){if(d.isSupportMediaStreamTrackProcessor&&d.isSupportMediaStreamTrackProcessor&&(d.sharingMediaStreamTrackProcessor=new MediaStreamTrackProcessor(c),d.sharingFrameStream=d.sharingMediaStreamTrackProcessor.readable,d.isSupportVideoShare?_.Notify_Sharing_Video_Encode_Thread_Transferable_Data("sharingframeStream",d.sharingFrameStream):_.Notify_Sharing_Encode_Thread_Transferable_Data("frameStream",d.sharingFrameStream),K.A.add_monitor("SCTP")),d.desktopSharingValue.video){d.desktopSharingValue.video.setAttribute("playsinline",""),d.desktopSharingValue.video.muted=!0;try{d.desktopSharingValue.video.srcObject=d.desktopSharingMediaStream,d.desktopSharingValue.video.muted=!0}catch(e){d.desktopSharingValue.video.src=u().createObjectURL(d.desktopSharingMediaStream)}d.desktopSharingValue.video.play().catch((function(e){m.Ay.error("Screenshare video preview play failed",e)}))}}),1e3),this.localShareVideoTag.onresize=function(e){var t,r=n.getSettings(),i=r.width,a=r.height;d.localShareVideoTag.width=i,d.localShareVideoTag.height=a,d.localShareCanvas.width=i,d.localShareCanvas.height=a,d.annoPresenterCanvas.width=i,d.annoPresenterCanvas.height=a,null===(t=d.annotationMgr)||void 0===t||t.updateRemoteSizeInfo({width:i,height:a}),g.A.Notify_APPUI(p.p8Y,{width:i,height:a})};case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),initAnnotatinPresenterSession:function(){this.isAnnotationPMEnabled&&this.initShareAnnotation()&&this.startAnnotation({presenterId:this.shareSessionId,shareSessionId:this.shareSessionId})},startAnnotation:function(e,t){var r=this;if(!this.isAnnotationEnabled)return g.A.Notify_APPUI(p.ZFN,"Annotation feature is not enabled"),void m.Ay.error("Start Annotation but Annotation feature is disabled");var n=Object.prototype.hasOwnProperty.call(e,"isPresenter")?e.isPresenter:e.shareSessionId===e.presenterId;if(n&&!this.isAnnotationPMEnabled)return g.A.Notify_APPUI(p.ZFN,"Annotation feature is not enabled for presenter"),void m.Ay.error("Start Annotation as presenter but Annotation presenter feature is disabled");this.shareSessionId=e.shareSessionId||this.shareSessionId,this.userName=e.userName||this.userName,n&&!this.shareAnnotationInited&&this.initShareAnnotation(),this.mainSharingCanvas=e.canvas||this.mainSharingCanvas,this.annoCanvas=e.annoCanvas||this.annoCanvas,this.annoPresenterCanvas=e.annoPresenterCanvas||this.annoPresenterCanvas,this.localShareCanvasExt=e.localShareCanvas||this.localShareCanvasExt;var i=!0;if(n||this.mainSharingCanvas&&this.annoCanvas||(i=!1),n&&!this.annoPresenterCanvas&&(i=!1),i){if(n&&t&&!this.localAnnoStarted&&(this.switchShareStreamForAnnotation(),this.localAnnoStarted=!0),n?this.switchAnnoCanvasZIndex(this.annoCanvas,this.annoPresenterCanvas):this.switchAnnoCanvasZIndex(this.annoPresenterCanvas,this.annoCanvas),this.annotationMgr&&this.annotationMgr.getAppId()!==e.shareSessionId&&(this.annotationMgr.destroy(),this.annotationMgr=null),!this.annotationMgr){var a={appId:this.shareSessionId,userName:this.userName,presenterId:e.presenterId,isBOSession:e.isBOSession||!1,sharingMainCanvas:n?this.localShareCanvas:this.mainSharingCanvas,annoCanvas:n?this.annoPresenterCanvas:this.annoCanvas,remoteSizeInfo:this.getAnnoRemoteSizeInfo(n)};if(!this.annotationModule)return g.A.Notify_APPUI(p.ZFN,"Failed to load annotation module"),void m.Ay.error("AnnotationMgr module was not loaded");this.annotationMgr=new this.annotationModule(a),t&&K.A.add_monitor("ANNO_INIT")}this.annotationMgr.startAnnotation(e.presenterId),this.annotationMgr.updateCanvas({sharingMainCanvas:n?this.localShareCanvas:this.mainSharingCanvas,annoCanvas:n?this.annoPresenterCanvas:this.annoCanvas}),setTimeout((function(){r.annotationMgr.updateRemoteSizeInfo(r.getAnnoRemoteSizeInfo(n))}),1e3),t&&g.A.Notify_APPUI(p.bVv)}else n&&t||(g.A.Notify_APPUI(p.ZFN,"Canvas is incorrect"),m.Ay.error("Start Annotation failed due to incorrect canvas"))},stopAnnotation:function(e){var t;this.isAnnotationEnabled&&(this.shareSessionId===e.presenterId&&(this.clearCanvas(this.localShareCanvas),this.clearCanvas(this.annoPresenterCanvas),this.localShareCanvas&&(this.localShareCanvas.zIndex="1"),this.localAnnoStarted=!1,this.shareAnnotationInited=!1,this.annoPresenterCanvas=null,this.localShareCanvas=null,this.localShareVideoTag&&(this.localShareVideoTag.srcObject=null)),null===(t=this.annotationMgr)||void 0===t||t.stopAnnotation(e),m.Ay.directReport("Stop Annotation for session: ".concat(e.presenterId)))},onAnnotationPdu:function(e){this.annotationMgr&&this.annotationMgr.onRWGMessage(e)},sendAnnotationPdu:function(e,t){this.isSupportVideoShare?t?_.Notify_Sharing_Video_Encode_Thread(e):_.Notify_Sharing_Video_Decode_Thread(e):t?_.Notify_Sharing_Encode_Thread(e):_.Notify_Sharing_Decode_Thread(e)},drawLocalAnnotationContent:function(){var e;if(!this.localShareCanvas.width||!this.localShareCanvas.height){var t=this.desktopSharingMediaStreamRaw.getVideoTracks()[0].getSettings(),r=t.width,n=t.height;this.localShareCanvas.width=r,this.localShareCanvas.height=n}this.localShareVideoTag.paused&&this.localShareVideoTag.play().then((function(){})).catch((function(e){Un.error("Failed to play local share video tag",e)}));var i=null===(e=this.localShareCanvas)||void 0===e?void 0:e.getContext("2d");try{var a;null==i||i.drawImage(this.localShareVideoTag,0,0,this.localShareCanvas.width,this.localShareCanvas.height),null==i||i.drawImage(this.annoPresenterCanvas,0,0,this.localShareCanvas.width,this.localShareCanvas.height);var o=null===(a=this.desktopSharingValue)||void 0===a||null===(a=a.canvas)||void 0===a?void 0:a.id;this.localShareCanvasExt&&"function"==typeof this.localShareCanvasExt.getContext&&this.localShareCanvasExt.id!==o&&this.localShareCanvasExt.getContext("2d").drawImage(this.localShareCanvas,0,0,this.localShareCanvasExt.width,this.localShareCanvasExt.height)}catch(e){Un.error("Failed to draw local annotation content",e)}},onAnnoRenderRequired:function(){this.annoPresenterCanvas.width&&this.annoPresenterCanvas.height&&this.localAnnoStarted&&this.drawLocalAnnotationContent()},getAnnoRemoteSizeInfo:function(e){var t,r;if(e){var n=(this.desktopSharingMediaStreamRaw||this.desktopSharingMediaStream).getVideoTracks()[0],i=null==n?void 0:n.getSettings();t=(null==i?void 0:i.width)||0,r=(null==i?void 0:i.height)||0}else t=this.sharingWidthAndHeightInfo.width,r=this.sharingWidthAndHeightInfo.height;return{width:t,height:r}},switchAnnoCanvasZIndex:function(e,t){t.style.zIndex="3",t.style.pointerEvents="auto",e&&(e.style.zIndex="2")},beforeReportToGlobalTracing:function(){this.wmscManager&&this.wmscManager.reportWMSCPeerConnectionRawStats()},workrtHealthCheckReport:function(e,t){var r=_.GetMediaSession(e),n=null==r?void 0:r.checkInitSuccess(),i="WORKERZOMBIE:".concat(e,":").concat(n,":").concat(t,":").concat(document.hidden);K.A.add_monitor(i),m.Ay.directReport(i)},onSharingSizeChange:function(e){this.sharingCodecInfo.width=e.width,this.sharingCodecInfo.height=e.height},isEnableAutoJoinAudio:function(){return!(h.Ay.isMac()&&h.Ay.browser.isSafari&&!this.webrtcAudio&&!h.Ay.isSafariVersionHigherThan("18.0"))},notifyUISetSpeakerError:function(e){this.audioSpeakerSetErrorCnt++,m.Ay.error("setSinkId failed ".concat(this.audioSpeakerSetErrorCnt," times, current speaker ").concat(e.currentSink,", reason = ").concat(e.reason)),this.audioSpeakerSetErrorCnt<=3&&g.A.Notify_APPUI(p.dsK,e)},notifyUISetMicError:function(e){this.audioMicSetErrorCnt++,m.Ay.error("setSinkId failed ".concat(this.audioMicSetErrorCnt," times, current mic ").concat(e.currentMic,", reason = ").concat(e.reason)),this.audioMicSetErrorCnt<=3&&g.A.Notify_APPUI(p.HOE,e)},initVideoProcessorWorker:function(){var e=this;return H(O().mark((function t(){var r,n,i,a,o,s,c,d,l;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.processorWorker){t.next=12;break}return r=Nn.substring(0,Nn.lastIndexOf("/"))+"/video_processor.min.js",t.next=4,fetch(r);case 4:return n=t.sent,t.next=7,n.arrayBuffer();case 7:i=t.sent,a=u().createObjectURL(new Blob([i],{type:"text/javascript"})),e.processorWorker=new Worker(a,{name:"video-processor"}),u().revokeObjectURL(a),e.processorWorker.addEventListener("message",(function(e){var t=e.data;t.cmd==wr.PROCESSOR_WORKER_ERROR&&K.A.add_monitor("PCWE"+t.data)})),o=new MessageChannel,e.processorWorker.postMessage({command:Cr.ADD_VIDEO_PORT,data:o.port1},[o.port1]),e.webrtcConfig.webrtcflag||h.Ay.isSelfPreviewRenderWithVideo()?e.processorMessagePort=o.port2:(null===(s=g.A.localVideoEncMGR)||void 0===s||null===(s=s.map)||void 0===s||null===(c=s.get)||void 0===c||null===(c=c.call(s,g.A.SPECIAL_ID))||void 0===c||null===(d=c.postMessage)||void 0===d||d.call(c,{command:"processor_message_port",data:o.port2},[o.port2]),(!e.checkIsRenderInWorker()||h.I4.getIsRenderSelfVideoInEncodeWorker(!0))&&(l=new MessageChannel,e.processorWorker.postMessage({command:Cr.ADD_SHADOW_PORT,data:l.port1},[l.port1]),e.shadowProcessorMessagePort=l.port2));case 12:case"end":return t.stop()}}),t)})))()},processorInited:function(e,t){return new Promise((function(r){var n=function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(i){i.data.name===e&&(i.data.cmd===Cr.PROCESSOR_READY?(r(!0),t.removeEventListener("message",n)):i.data.cmd===Cr.PROCESSOR_ERROR&&(r(!1),t.removeEventListener("message",n)))}));try{t.addEventListener("message",n)}catch(e){console.error(e)}}))},addProcessor:function(e){var t=this;return H(O().mark((function r(){var n,i,a,o,s,c,d,l,f,p,v;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.url,i=e.name,a=e.type,o=void 0===a?"video":a,s=e.options,"video"!==o||!h.Ay.isSupportVideoProcessor(t.mediaFeatureOptions)){r.next=13;break}return r.next=4,t.initVideoProcessorWorker();case 4:return(c=new MessageChannel).port1.start(),t.processorWorker.postMessage({url:n,name:i,command:Cr.ADD_VIDEO_PROCESSOR,port:c.port2,options:s},[c.port2]),r.next=9,t.processorInited(i,t.processorWorker);case 9:if(!r.sent){r.next=11;break}return r.abrupt("return",{name:i,type:o,port:c.port1});case 11:r.next=32;break;case 13:if("audio"!==o||!h.Ay.isSupportAudioProcessor(t.mediaFeatureOptions)){r.next=32;break}return d=Nn.substring(0,Nn.lastIndexOf("/"))+"/js_audio_processor_worklet.min.js",r.next=17,fetch(d);case 17:return r.next=19,r.sent.text();case 19:return l=r.sent,r.next=22,fetch(n);case 22:return r.next=24,r.sent.text();case 24:if(f=r.sent,p=u().createObjectURL(new Blob([l.replace("zoom-audio-processor-worklet",i)+"\n"+f],{type:"application/javascript"})),!ln.audioProcessorCtx){r.next=32;break}return r.next=29,ln.audioProcessorCtx.audioWorklet.addModule(p);case 29:return u().revokeObjectURL(p),v=new AudioWorkletNode(ln.audioProcessorCtx,i,s),r.abrupt("return",(ln.addProcessor(i,v),{name:i,type:o,port:v.port}));case 32:return r.abrupt("return",null);case 33:case"end":return r.stop()}}),r)})))()},startProcessor:function(e){var t=this,r=e.name,n=e.type;if("video"===n&&h.Ay.isSupportVideoProcessor(this.mediaFeatureOptions))if(K.A.add_monitor("SPMV"),this.webrtcConfig.webrtcflag||h.Ay.isSelfPreviewRenderWithVideo()){var i,a,o;if(Br.addCallback(r,(function(e,t){e==wr.RESOLUTION_CHANGE&&Vn.onVBResolutionChange&&Vn.onVBResolutionChange(t)})),Br.addFrameCallback(r,(function(e){_.TransoferDataToVideoEncodeThread({command:"yuvVideoFrame",data:e,rotation:0},[e]),e.close()})),Br.startProcessor(r,new Fr(r,this.processorMessagePort,this.platformType==z.u7.IPHONE,!this.webrtcConfig.webrtcflag)),Vn.videoStream){Br.removeStream(),Br.setStream(Vn.videoStream);var s=Br.getStream();Vn.processedStream=s,this.webrtcConfig.webrtcflag?this.updateWebRTCVideoStream(s):this.render_self_video_wasm()}null===(i=g.A.localVideoEncMGR)||void 0===i||null===(i=i.map)||void 0===i||null===(a=i.get)||void 0===a||null===(a=a.call(i,g.A.SPECIAL_ID))||void 0===a||null===(o=a.postMessage)||void 0===o||o.call(a,{command:hr.e,flag:!0})}else{var u,c,d;null===(u=g.A.localVideoEncMGR)||void 0===u||null===(u=u.map)||void 0===u||null===(c=u.get)||void 0===c||null===(c=c.call(u,g.A.SPECIAL_ID))||void 0===c||null===(d=c.postMessage)||void 0===d||d.call(c,{command:"start_processor",name:r}),this.checkIsRenderInWorker()&&!h.I4.getIsRenderSelfVideoInEncodeWorker(!0)||(Br.addFrameCallback(r,(function(e){var r,n=Hn();null===(r=t.VideoRenderObj)||void 0===r||r.Update_LocalVideo(e,n,!0),e.close()})),Br.startProcessor(r,new Ur(r,this.shadowProcessorMessagePort)))}else if("audio"===n&&h.Ay.isSupportAudioProcessor(this.mediaFeatureOptions)){K.A.add_monitor("SPMA"),ln.startProcessor(r);var l,f=ln.hasProcessor()?ln.getStream():Vn.audioStream;this.useWebRTCAudio?null===(l=this.webrtcAudio)||void 0===l||l.setStreamAsync(f).then((function(e){g.A.ComputerAudioStatus===N.BX.ComputerAudio_Connecting&&(g.A.ComputerAudioStatus=N.BX.ComputerAudio_Connected,g.A.Notify_APPUI(p.Ubu,{microphoneDeviceId:Vn.getAudioDeviceId()}))})):g.A.AudioNode&&(this.webrtcAudioNode&&(this.webrtcAudioNode.disconnect(g.A.AudioNode),this.webrtcAudioNode=null),this.webrtcAudioNode=this.audioCtx.createMediaStreamSource(f),this.webrtcAudioNode.connect(g.A.AudioNode))}},stopProcessor:function(e){var t,r,n,i,a,o,s=e.name,u=e.type;if("video"===u&&h.Ay.isSupportVideoProcessor(this.mediaFeatureOptions))K.A.add_monitor("EPMV"),this.webrtcConfig.webrtcflag||null===(i=g.A.localVideoEncMGR)||void 0===i||null===(i=i.map)||void 0===i||null===(a=i.get)||void 0===a||null===(a=a.call(i,g.A.SPECIAL_ID))||void 0===a||null===(o=a.postMessage)||void 0===o||o.call(a,{command:"stop_processor",name:s}),Br.stopProcessor(s),!Br.hasProcessor()&&Vn.videoStream&&(Vn.processedStream=null,this.webrtcConfig.webrtcflag?this.updateWebRTCVideoStream(Vn.videoStream):this.render_self_video_wasm()),null===(t=g.A.localVideoEncMGR)||void 0===t||null===(t=t.map)||void 0===t||null===(r=t.get)||void 0===r||null===(r=r.call(t,g.A.SPECIAL_ID))||void 0===r||null===(n=r.postMessage)||void 0===n||n.call(r,{command:hr.e,flag:!1});else if("audio"===u&&h.Ay.isSupportAudioProcessor(this.mediaFeatureOptions)){K.A.add_monitor("EPMA"),ln.stopProcessor(s);var c,d=ln.hasProcessor()?ln.getStream():Vn.audioStream;this.useWebRTCAudio?null===(c=this.webrtcAudio)||void 0===c||c.setStreamAsync(d).then((function(e){g.A.ComputerAudioStatus===N.BX.ComputerAudio_Connecting&&(g.A.ComputerAudioStatus=N.BX.ComputerAudio_Connected,g.A.Notify_APPUI(p.Ubu,{microphoneDeviceId:Vn.getAudioDeviceId()}))})):g.A.AudioNode&&(this.webrtcAudioNode&&(this.webrtcAudioNode.disconnect(g.A.AudioNode),this.webrtcAudioNode=null),this.webrtcAudioNode=this.audioCtx.createMediaStreamSource(d),this.webrtcAudioNode.connect(g.A.AudioNode))}},ScreenShot:function(e,t,r){var n=this;return new Promise(function(){var r=H(O().mark((function r(i,a){var o,s,u,c,d,l,f,p,v,m,y,_,S,A,b,E,k,C,w;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(K.A.add_monitor("SCREENSHOT:".concat(e,":").concat(t)),"video"==t||"sharing"==t){r.next=2;break}return r.abrupt("return",void a("not support ".concat(t," type")));case 2:if(s="video"==t,u=e>>10==n.userId>>10,c=(0,en.Ek)(),d=e>>10<<10,l=n.webrtcConfig.webrtcflag,f=n.isStartVideoCapture,p=(null===(o=n.selfPreviewVideotagList)||void 0===o?void 0:o.length)||0,v=u&&n.isSelfViewWithVideo,r.prev=3,!l&&!v||!s){r.next=18;break}if(m=null,l?m=null===(y=n.wmscManager)||void 0===y||null===(y=y.getUserIdVideo(e))||void 0===y?void 0:y[0]:(!(m=f&&n.videoCaptureValue.videoCtrl)&&f&&p&&(m=n.selfPreviewVideotagList[p-1]),m||!n.isMaskSettingOn&&!n.isVBSettingOn||(m=n.MaskSettingVideo)),_={x:0,y:0,width:m.videoWidth,height:m.videoHeight},!m){r.next=16;break}return r.t1=i,r.next=12,c.captureFromVideoTag(m,_);case 12:r.t2=r.sent,r.t0=(0,r.t1)(r.t2),r.next=17;break;case 16:r.t0=a("not found userid ".concat(e));case 17:return r.abrupt("return",void r.t0);case 18:if(S=g.A.browserFeature,("video"!=t||n.checkIsRenderInWorker())&&("sharing"!=t||n.isSupportOffscreenCanvas)&&S.isSupportOffScreenCanvasWebgl()){r.next=35;break}if(A=s?n.VideoRenderObj:n.SharingRenderObj){r.next=23;break}return r.abrupt("return",void a("not ".concat(t," render")));case 23:if(b=A.getUserIdVideo(d),E=b.canvas,k=b.options,!E){r.next=33;break}return A.reDraw(),r.t4=i,r.next=29,c.captureFromCanvas(E,k);case 29:r.t5=r.sent,r.t3=void(0,r.t4)(r.t5),r.next=34;break;case 33:r.t3=void a("not found userid ".concat(e," render"));case 34:return r.abrupt("return",r.t3);case 35:return C=h.I4.getIsRenderSelfVideoInEncodeWorker(u),w=c.createTask((function(e){var r={command:hr.d4,ssrc:d,id:e,type:t},i=null;if(s){var o=C?g.A.localVideoEncMGR:g.A.localVideoDecMGR;i=null==o?void 0:o.map.get(0)}else{var u=n.isSupportVideoShare?g.A.localVideoDecMGR:g.A.localSharingDecMGR;i=null==u?void 0:u.map.get(0)}i?i.postMessage(r):a("no render")})),r.t6=i,r.next=39,w.get();case 39:r.t7=r.sent,(0,r.t6)(r.t7),r.next=46;break;case 43:r.prev=43,r.t8=r.catch(3),a(r.t8);case 46:case"end":return r.stop()}}),r,null,[[3,43]])})));return function(e,t){return r.apply(this,arguments)}}())},getMediaStreamController:function(){return Vn},handlePermissionRequest:function(){var e=this;return H(O().mark((function t(){var r,n,i,a,o;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ze.A.hasPermission("microphone");case 2:return r=t.sent,t.next=5,Ze.A.hasPermission("camera");case 5:if(n=t.sent,!r||!n){t.next=8;break}return t.abrupt("return",void e.requestPermissionCallback(p.xzH.GRANTED_AUDIO_VIDEO));case 8:return i=setTimeout((function(){g.A.Notify_APPUI_SAFE(p.Q$T),clearTimeout(i),i=null}),500),t.prev=9,t.next=12,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 12:t.sent.getTracks().forEach((function(e){return e.stop()})),i&&(clearTimeout(i),i=null),e.requestPermissionCallback(p.xzH.GRANTED_AUDIO_VIDEO),t.next=30;break;case 16:return t.prev=16,t.t0=t.catch(9),t.prev=18,t.next=21,navigator.mediaDevices.getUserMedia({audio:!0});case 21:t.sent.getTracks().forEach((function(e){return e.stop()})),i&&(clearTimeout(i),i=null),e.requestPermissionCallback(p.xzH.GRANTED_AUDIO),t.next=30;break;case 25:t.prev=25,t.t1=t.catch(18),i&&(clearTimeout(i),i=null),a=jn(t.t1),(o=a.errorCode)===p.sfr.USER_DENIED?e.requestPermissionCallback(p.xzH.DENIED):o===p.sfr.USER_DISMISS?e.requestPermissionCallback(p.xzH.DISMISS):e.requestPermissionCallback(p.xzH.EXCEPTION_FAILS);case 30:case"end":return t.stop()}}),t,null,[[9,16],[18,25]])})))()},initWebRTCAudioInstance:function(e){var t=this;return H(O().mark((function r(){var n,i,a,o,s,u,c,d,l,f,p,v,y,_,S,A,b,E,k,C;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.rwgHost,i=e.cid,a=e.meetingNumber,o=e.userId,s=e.isCapturingAudio,u=e.webrtcMode,c=e.workerType,d=e.audioMode,l=e.abToken,f={jsPath:t.audioWorkletJsPath.audioLevelWorkletPath,wasmPath:h.Ay.isSupportAudioDenoise(t.mediaFeatureOptions,!0)?t.audioWorkletJsPath.audioSIMDWasm:void 0},!h.Ay.isWebRTCAudio2_0(t.mediaFeatureOptions,t.mid,!0,t.webrtcAudio2EnabledOnFT,t.audioABTestStrategy)){r.next=20;break}return g.A.audioSolution="WEBRTC 2.0",r.prev=4,r.next=7,t._initWMSC({rwgHost:n,cid:i,meetingNumber:a,workerType:c,userId:o,webrtcMode:u});case 7:return t.webrtcAudio=null===(p=t.wmscManager)||void 0===p?void 0:p.getWMSCAudio(),null===(v=t.webrtcAudio)||void 0===v||v.initconfig({recvOnly:!s,codecDoAVSync:t.codecDoAVSync,useWebRTCOnDesktop:g.A.isDesktopMode,workletPath:f}),s&&(null===(S=t.webrtcAudio)||void 0===S||S.setRecvOnly(!1,Vn.audioStream)),null===(y=t.webrtcAudio)||void 0===y||y.setCodecDoAVSync(t.codecDoAVSync),r.next=13,null===(_=t.webrtcAudio)||void 0===_?void 0:_.join(!1,null,d);case 13:r.next=18;break;case 15:r.prev=15,r.t0=r.catch(4),m.Ay.error("Init WMSC audio failed, due to: ",r.t0);case 18:r.next=34;break;case 20:if(E="wss://".concat(n,"/ab/signal?rwg=").concat(n,"&cid=").concat(i),t.webrtcAudio&&t.webrtcAudio.getConnectionId()!=i)try{t.webrtcAudio.destroy(!1),t.webrtcAudio=null,Vn.webrtcAudio=null}catch(e){m.Ay.error("destory webrtc audio error",e)}return t.webrtcAudio||(t.webrtcAudio=new fn.default(i,E,!s,t.codecDoAVSync,g.A.isDesktopMode,f,(function(e,r){var n;switch(e){case"destroy":null===(n=t.webrtcAudio)||void 0===n||n.destroy(),t.webrtcAudio=null;break;case"updateConnectionResult":var i,a=null===(i=t.persistenceInfo)||void 0===i?void 0:i.getAudioBridgeConnectivityInfo();null==a||a.updateWebRTCConnectivityResult(r)}})),t.webrtcAudio.setIceServers(t.iceServers)),s&&(null===(k=t.webrtcAudio)||void 0===k||k.setRecvOnly(!1,Vn.audioStream)),null===(A=t.webrtcAudio)||void 0===A||A.setCodecDoAVSync(t.codecDoAVSync),r.next=27,null===(b=t.webrtcAudio)||void 0===b?void 0:b.join(!1,l,d);case 27:if(r.t1=c,!r.t1){r.next=32;break}return r.next=31,null===(C=t.webrtcAudio)||void 0===C?void 0:C.getAudioPromise(c);case 31:t.init_Notify_APPUI(!0,c);case 32:"WEBRTC 2.0"==g.A.audioSolution&&m.Ay.directReport("audio fallback from webrtc 2.0 to 1.0 successfully"),g.A.audioSolution="WEBRTC 1.0";case 34:case"end":return r.stop()}}),r,null,[[4,15]])})))()},wmscRequestHandler:function(e,t){switch(e){case"negotiationResult":var r,n=null===(r=this.persistenceInfo)||void 0===r?void 0:r.getWMSCConnectivityInfo();null==n||n.updateWebRTCConnectivityResult(t);break;case"audioRecapture":un(this,this.audioCapture)}},registerMeshNote:function(){var e=this;return H(O().mark((function t(){var r,n,i,a,o,s,u,c,d,l,f,p,v,m,y,S,A,b,E,k;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=2&g.A.enablemesh){t.next=3;break}return t.abrupt("return");case 3:if(a=_.GetMediaSession(N._c.VIDEO_DECODE),o=null==a?void 0:a.checkInitSuccess(),s=_.GetMediaSession(N._c.AUDIO_DECODE),u=null==s?void 0:s.checkInitSuccess(),c=_.GetMediaSession(N._c.SHARING_DECODE),d=e.isSupportVideoShare?c.isSocketInitSuccess():c.checkInitSuccess(),o&&u&&d){t.next=7;break}return t.abrupt("return");case 7:return t.next=9,null===(r=e.netThreadMgr)||void 0===r?void 0:r.ready();case 9:if(l=t.sent,($r.role==Rr.invalid||$r.sdkId!=e._id)&&l){t.next=12;break}return t.abrupt("return");case 12:return f=4&i,p=e.netThreadMgr.isSupportTransferRTC(),v=navigator.hardwareConcurrency,m=null===(n=h.Ay.browser)||void 0===n?void 0:n.isChrome,t.next=18,h.Ay.is32bitChrome();case 18:return y=t.sent,t.next=21,h.Ay.isSDKSupportMultiThread();case 21:if(S=t.sent,A=h.Ay.getOSInfo(),b=Rr.normal,!y&&A&&0==A.osType){t.next=26;break}return t.abrupt("return");case 26:b=!p||v<8||!S?Rr.child:Rr.parent,E=8,v>8&&(E+=1),m&&(E+=1),k=b==Rr.parent?E:0,$r.registerMeshNote(),$r.setInitRole(b,k,e._id,g.A.mesh_node,f),$r.haslicense&&$r.reportInitPoints();case 31:case"end":return t.stop()}}),t)})))()},meshMessage:function(e){var t=this;return H(O().mark((function r(){var i,a,o,s,u,c,d,l,f,p,v,g,m,y,S,A,b;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=null!==(i=null==e?void 0:e.data)&&void 0!==i?i:{},o=a.cmdType,s=(0,n.A)(a,xn),![Ir.meshSigKey,Ir.meshSigType].includes(o)||$r.getAgent()){r.next=3;break}return r.abrupt("return",(o==Ir.meshSigType&&($r.signatureInfo.type=s.type,$r.signatureInfo.meetinguuid=s.confID),void(o==Ir.meshSigKey&&($r.signatureInfo.mmrsigkey=s.recipe))));case 3:if(!$r.haslicense&&o!=Ir.registerMeshNodeResult){r.next=15;break}if(o!=Ir.registerMeshNodeResult){r.next=6;break}return r.abrupt("return",($r.haslicense=s.success,void($r.haslicense&&$r.reportInitPoints())));case 6:if($r.getAgent()||(l=s.role||Rr.normal,f=t.userId>>10<<10,$r.createAgent(l,t.cid,f,t.stunServers),$r.getAgent().setMonitorLog(t.ZoomMonitor),p=_.GetWorkerTypeThread(N._c.AUDIO_DECODE),v=_.GetWorkerTypeThread(N._c.VIDEO_DECODE),g=t.isSupportVideoShare?v:_.GetWorkerTypeThread(N._c.SHARING_DECODE),m=t.netThreadMgr,y=null===(u=t.getFilePath)||void 0===u||null===(u=u.call(t))||void 0===u?void 0:u.meshTread,S=null===(c=t.getFilePath)||void 0===c||null===(c=c.call(t))||void 0===c?void 0:c.netWasm,null===(d=t.meshThread)||void 0===d||d.close(),A=new vn("mesh",h.Ay.browser.isSafari,y,S),t.meshThread=A,A.setMonitorLog(t.ZoomMonitor),b={audio:p,video:v,net:m,mesh:A,share:g},$r.getAgent().setWorkerThread(b)),r.t0=$r.getAgent(),!r.t0){r.next=12;break}return r.next=11,$r.getAgent().ready;case 11:r.t0=r.sent;case 12:if(r.t1=r.t0,!r.t1){r.next=15;break}$r.getAgent().onMessage(o,s);case 15:case"end":return r.stop()}}),r)})))()}};var Yn=qn},9558:function(e,t,r){r.d(t,{A:function(){return g}});var n=r(5738),i=r(9109),a=r(7080),s=r(5408),u=r(9407),l=r(2710),h=r(701),p=r(1461),v=null;"function"==typeof AudioWorklet&&(v=function(){function e(t,r,n){var i;return R(this,e),(i=c(this,e,[t,r,n])).port.onmessage=i.handleMessage.bind(d(i)),i}return f(e,o(AudioWorkletNode)),D(e,[{key:"handleMessage",value:function(e){var t=e.data;switch(t.status){case"delay":if(i.A.localAudioDecMGR){var r=i.A.localAudioDecMGR.map.get(0);r&&r.postMessage({command:"delay"})}break;case u.uf:t.at&&(i.A.CurrentSSRCTime=t.at,i.A.audioPlayTime=Date.now()),t.st&&i.A.mediaSDKHandle.SharingRenderObj&&i.A.mediaSDKHandle.SharingRenderObj.SetcATimeStamp(t.st);break;case u.b5:n.addAudioMonitorLog.push({log:t.data,logSource:l.JT});break;case"MONITOR_LOG":a.A.add_monitor(t.data);break;case"UPDATE_MULTIVIEW_TIME":if(i.A.localVideoDecMGR){var o=i.A.localVideoDecMGR.map.get(0);o&&o.postMessage({command:"audioDecodeTime",data:t.data,status:1})}break;case"WASM_INIT_SUCCESS":for(a.A.add_monitor("DIWL"+t.data.audio_handle),i.A.workletWasmInitSuccess=!0;!i.A.workletMessageQueue.isEmpty();){var c=i.A.workletMessageQueue.dequeue();this.postCMD(c.command,c)}break;case"workletMessage":"error"===t.data.level&&s.Ay.error(t.data.message,t.data.data);break;case"WASM_INIT_FAILED":a.A.add_monitor("AWMAF"),(0,h.iK)(p.a1o);break;case"PROCESS_EXCEPTIONS":(0,h.iK)(p.mxj,t.data)}}},{key:"postData",value:function(e,t){this.port.postMessage({status:e,data:t},[t.data.buffer])}},{key:"postCMD",value:function(e,t){this.port.postMessage({status:e,data:t})}}])}());var g=v},879:function(e,t,r){r.d(t,{f:function(){return a}});var n=r(7857),i=r(2754),a=new(D((function e(){var t=this;R(this,e),(0,n.A)(this,"_platformDesc",{supportGraphicsAcceleration:!1,supportVideoFrame:!1,supportMediaStreamTrackGenerator:!1,supportTransferableStream:!1,supportDrawWatermark:!1,supportVideoFrameInWorker:!1,supportVideoTrackGeneratorInWorker:!1,supportOffscreenCanvasInWorker:!1,supportImageBitmapRenderingInWorker:!1,supportTransferableTrackAcrossWork:!1,supportsRequestAnimationFrameInWork:!1}),(0,n.A)(this,"_inferedDesc",{supportVideoTagRenderer:!1}),(0,n.A)(this,"_analyzing_promise",null),(0,n.A)(this,"_main_analyzed",!1),(0,n.A)(this,"_remote_analyzed",!1),(0,n.A)(this,"_analyzedPromise",void 0),(0,n.A)(this,"_resolveAnalyzedPromise",void 0),this._analyzedPromise=new Promise((function(e,r){t._resolveAnalyzedPromise=e}))}),[{key:"init",value:function(e){this._platformDesc=e.platform,this._inferedDesc=e.infered,this._main_analyzed=!0,this._remote_analyzed=!0,this._resolveAnalyzedPromise(this._remote_analyzed)}},{key:"desc",value:function(){return{platform:this._platformDesc,infered:this._inferedDesc}}},{key:"analyzed",value:function(){return this._remote_analyzed}},{key:"analyzedPromise",value:function(){return this._analyzedPromise}},{key:"_analyzeInferredCapabilites",value:function(){this._inferedDesc.supportVideoTagRenderer=this._platformDesc.supportVideoFrame&&this._platformDesc.supportVideoFrameInWorker&&(!0===this._platformDesc.supportMediaStreamTrackGenerator&&!0===this._platformDesc.supportTransferableStream||!0===this._platformDesc.supportVideoTrackGeneratorInWorker)}},{key:"analyze",value:function(e){var t=this;if(this._analyzing_promise)return this._analyzing_promise;var r=e.analyzeMainCapabilites();return Object.assign(this._platformDesc,r),this._main_analyzed=!0,this._analyzing_promise=new Promise((function(r,n){e.analyzeRemoteCapabilities().then((function(e){Object.assign(t._platformDesc,e),t._analyzeInferredCapabilites(),t._remote_analyzed=!0,t._resolveAnalyzedPromise(t._remote_analyzed),r(!0)})).catch((function(e){t._resolveAnalyzedPromise(t._remote_analyzed),r(!1)}))})),this._analyzing_promise}},{key:"supportGraphicsAcceleration",value:function(){return(0,i.vA)(this._main_analyzed),this._platformDesc.supportGraphicsAcceleration}},{key:"supportTransferableStream",value:function(){return(0,i.vA)(this._main_analyzed),this._platformDesc.supportTransferableStream}},{key:"supportDrawWatermark",value:function(){return(0,i.vA)(this._main_analyzed),this._platformDesc.supportDrawWatermark}},{key:"supportVideoTagRenderer",value:function(){return!!this._remote_analyzed&&this._inferedDesc.supportVideoTagRenderer}},{key:"supportMediaStreamTrackGenerator",value:function(){return(0,i.vA)(this._main_analyzed),this._platformDesc.supportMediaStreamTrackGenerator}},{key:"supportVideoTrackGeneratorInWorker",value:function(){return!!this._remote_analyzed&&this._platformDesc.supportVideoTrackGeneratorInWorker}},{key:"supportTransferableTrackAcrossWork",value:function(){return!!this._remote_analyzed&&this._platformDesc.supportTransferableTrackAcrossWork}},{key:"supportsRequestAnimationFrameInWork",value:function(){return!!this._remote_analyzed&&this._platformDesc.supportsRequestAnimationFrameInWork}}]))},4895:function(e,t,r){r.d(t,{X:function(){return c}});var n=r(7857),i=r(2484),a=r(879),o=r(3485),s=r(2754),u=r(14),c=new(D((function e(){var t=this;R(this,e),(0,n.A)(this,"_desc",{defaultRendererType:u.h3.WEBGL,isEnableCanvasCtxOptionsOpt:!1,isEnableFallbackToTagRender:!1,isEnableWasmTagRenderer:!1,safariYuvPaddingFixVer:void 0,chromeYuvLeftTopPaddingFixVer:void 0,isVideoHasWaterMark:!1,isSharingHasWaterMark:!1,canVideoUseTagRenderer:void 0,canSharingUseTagRenderer:void 0,canUseSsrcStream:void 0,isUseSsrcStream:!1,shouldCropWasmFrameOnPosMismatch:void 0,shouldCropWasmFrameOnSizeMismatchOnly:void 0,baseScriptUrl:"",videoWatermarkInfo:void 0,sharingWatermarkInfo:void 0,avStreamMode:void 0}),(0,n.A)(this,"_configDone",!1),(0,n.A)(this,"_configDonePromise",void 0),(0,n.A)(this,"_resolveConfigDonePromise",void 0),this._configDonePromise=new Promise((function(e,r){t._resolveConfigDonePromise=e}))}),[{key:"_tryResetDerivedConfigIfNeeded",value:function(){this._configDone&&(this._desc.canVideoUseTagRenderer=void 0,this._desc.canSharingUseTagRenderer=void 0,this._desc.canUseSsrcStream=void 0,this._desc.shouldCropWasmFrameOnPosMismatch=void 0,this._desc.shouldCropWasmFrameOnSizeMismatchOnly=void 0)}},{key:"init",value:function(e){this._desc=e,this._configDone=!0}},{key:"configDone",value:function(){return this._configDone}},{key:"configDonePromise",value:function(){return this._configDonePromise}},{key:"markConfigDone",value:function(){this._configDone=!0,this._resolveConfigDonePromise(!0)}},{key:"desc",value:function(){return this._desc}},{key:"defaultRendererType",value:function(){return this._desc.defaultRendererType}},{key:"setDefaultRendererType",value:function(e){this._desc.defaultRendererType=e,this._tryResetDerivedConfigIfNeeded()}},{key:"isEnableCanvasCtxOptionsOpt",value:function(){return this._desc.isEnableCanvasCtxOptionsOpt}},{key:"setIsEnableCanvasCtxOptionsOpt",value:function(e){this._desc.isEnableCanvasCtxOptionsOpt=e,this._tryResetDerivedConfigIfNeeded()}},{key:"isEnableWasmTagRenderer",value:function(){return this._desc.isEnableWasmTagRenderer}},{key:"setWasmTagRendererFlags",value:function(e){var t=!1;o.l.isBlink()?t=e&i.n.ENABLE_WASM_TAG_RENDERER.candidates.TAG_RENDERER_ON_CHROME:o.l.isWebkit()?t=e&i.n.ENABLE_WASM_TAG_RENDERER.candidates.TAG_RENDERER_ON_SAFARI:"firefox"===o.l.browserName()&&(t=e&i.n.ENABLE_WASM_TAG_RENDERER.candidates.TAG_RENDERER_ON_FIREFOX),this._desc.isEnableWasmTagRenderer=t,this._tryResetDerivedConfigIfNeeded()}},{key:"isEnableFallbackToTagRender",value:function(){return this._desc.isEnableFallbackToTagRender}},{key:"setFallbackToTagRenderFlags",value:function(e){var t=!1;o.l.isBlink()?t=e&i.n.ENABLE_FALLBACK_TO_TAG_RENDERER.candidates.FALLBACK_TO_TAG_RENDERER_ON_CHROME:o.l.isWebkit()?t=e&i.n.ENABLE_FALLBACK_TO_TAG_RENDERER.candidates.FALLBACK_TO_TAG_RENDERER_ON_SAFARI:"firefox"===o.l.browserName()&&(t=e&i.n.ENABLE_FALLBACK_TO_TAG_RENDERER.candidates.FALLBACK_TO_TAG_RENDERER_ON_FIREFOX),this._desc.isEnableFallbackToTagRender=t,this._tryResetDerivedConfigIfNeeded()}},{key:"isVideoHasWaterMark",value:function(){return this._desc.isVideoHasWaterMark}},{key:"setIsVideoHasWaterMark",value:function(e){this._desc.isVideoHasWaterMark=e,this._tryResetDerivedConfigIfNeeded()}},{key:"getVideoWatermarkInfo",value:function(){return this._desc.videoWatermarkInfo}},{key:"setVideoWatermarkInfo",value:function(e){this._desc.videoWatermarkInfo=e}},{key:"isSharingHasWaterMark",value:function(){return this._desc.isSharingHasWaterMark}},{key:"setIsSharingHasWaterMark",value:function(e){this._desc.isSharingHasWaterMark=e,this._tryResetDerivedConfigIfNeeded()}},{key:"getSharingWatermarkInfo",value:function(){return this._desc.sharingWatermarkInfo}},{key:"setSharingWatermarkInfo",value:function(e){this._desc.sharingWatermarkInfo=e}},{key:"canVideoUseTagRenderer",value:function(){return!!this._configDone&&(void 0!==this._desc.canVideoUseTagRenderer?this._desc.canVideoUseTagRenderer:a.f.supportVideoTagRenderer()?!a.f.supportGraphicsAcceleration()&&this.isEnableFallbackToTagRender()?(this._desc.canVideoUseTagRenderer=!0,this._desc.canVideoUseTagRenderer):this.isEnableWasmTagRenderer()?(this._desc.canVideoUseTagRenderer=!this.isVideoHasWaterMark(),this._desc.canVideoUseTagRenderer):(this._desc.canVideoUseTagRenderer=!1,!1):(this._desc.canVideoUseTagRenderer=!1,!1))}},{key:"canSharingUseTagRenderer",value:function(){return!!this._configDone&&(void 0!==this._desc.canSharingUseTagRenderer?this._desc.canSharingUseTagRenderer:a.f.supportVideoTagRenderer()?!a.f.supportGraphicsAcceleration()&&this.isEnableFallbackToTagRender()?(this._desc.canSharingUseTagRenderer=!0,this._desc.canSharingUseTagRenderer):this.isEnableWasmTagRenderer()?(this._desc.canSharingUseTagRenderer=!this.isSharingHasWaterMark(),this._desc.canSharingUseTagRenderer):(this._desc.canSharingUseTagRenderer=!1,!1):(this._desc.canSharingUseTagRenderer=!1,!1))}},{key:"canUseSsrcStream",value:function(){if(!this._configDone)return!1;if(void 0!==this._desc.canUseSsrcStream)return this._desc.canUseSsrcStream;var e=this.canVideoUseTagRenderer(),t=this.canSharingUseTagRenderer();return(0,s.vA)(e==t),this._desc.canUseSsrcStream=e&&t,this._desc.canUseSsrcStream}},{key:"isUseSsrcStream",value:function(){return this._desc.isUseSsrcStream}},{key:"setIsUseSsrcStream",value:function(e){this._desc.isUseSsrcStream=e}},{key:"setSafariYuvPaddingFixVer",value:function(e){"[object String]"===Object.prototype.toString.call(e)&&(this._desc.safariYuvPaddingFixVer=e,this._tryResetDerivedConfigIfNeeded())}},{key:"setChromeYuvLeftTopPaddingFixVer",value:function(e){"[object String]"===Object.prototype.toString.call(e)&&(this._desc.chromeYuvLeftTopPaddingFixVer=e,this._tryResetDerivedConfigIfNeeded())}},{key:"_versionGreaterThan",value:function(e,t){for(var r=t.toString().split("."),n=e.toString().split("."),i=r.length,a=n.length,o=Math.min(i,a),s=0;s<o;s++){var u=parseInt(r[s],10),c=parseInt(n[s],10);if(u!==c)return c>u}return a>=i}},{key:"shouldCropWasmFrameOnPosMismatch",value:function(){return!!this._configDone&&(void 0!==this._desc.shouldCropWasmFrameOnPosMismatch?this._desc.shouldCropWasmFrameOnPosMismatch:this.canVideoUseTagRenderer()||this.canSharingUseTagRenderer()?(this._desc.shouldCropWasmFrameOnPosMismatch=!0,o.l.isChrome()?this._desc.chromeYuvLeftTopPaddingFixVer&&this._versionGreaterThan(o.l.browserVersionInfo().chrome,this._desc.chromeYuvLeftTopPaddingFixVer)&&(this._desc.shouldCropWasmFrameOnPosMismatch=!1):o.l.isSafari()&&this._desc.safariYuvPaddingFixVer&&this._versionGreaterThan(o.l.browserVersionInfo().safari,this._desc.safariYuvPaddingFixVer)&&(this._desc.shouldCropWasmFrameOnPosMismatch=!1),this._desc.shouldCropWasmFrameOnPosMismatch):(this._desc.shouldCropWasmFrameOnPosMismatch=!1,!1))}},{key:"shouldCropWasmFrameOnSizeMismatchOnly",value:function(){return!!this._configDone&&(void 0!==this._desc.shouldCropWasmFrameOnSizeMismatchOnly?this._desc.shouldCropWasmFrameOnSizeMismatchOnly:(this.canVideoUseTagRenderer()||this.canSharingUseTagRenderer())&&o.l.isWebkit()?(o.l.isSafari()&&this._desc.safariYuvPaddingFixVer&&this._versionGreaterThan(o.l.browserVersionInfo().safari,this._desc.safariYuvPaddingFixVer)?this._desc.shouldCropWasmFrameOnSizeMismatchOnly=!1:this._desc.shouldCropWasmFrameOnSizeMismatchOnly=!0,this._desc.shouldCropWasmFrameOnSizeMismatchOnly):(this._desc.shouldCropWasmFrameOnSizeMismatchOnly=!1,!1))}},{key:"shouldCropWasmFrame",value:function(e,t,r){return!!this._configDone&&(e!=r.width||t!=r.height)&&(c.shouldCropWasmFrameOnSizeMismatchOnly()||c.shouldCropWasmFrameOnPosMismatch()&&(0!=r.x||0!=r.y))}},{key:"getBaseScriptUrl",value:function(){return this._desc.baseScriptUrl}},{key:"setBaseScriptUrl",value:function(e){this._desc.baseScriptUrl=e}},{key:"getAVStreamMode",value:function(){return this._configDone?(void 0!==this._desc.avStreamMode||(a.f.supportTransferableStream()?this._desc.avStreamMode="writable-stream":a.f.supportTransferableTrackAcrossWork()?this._desc.avStreamMode="track":this._desc.avStreamMode="none"),this._desc.avStreamMode):"none"}}]))},14:function(e,t,r){r.d(t,{BH:function(){return a},G7:function(){return d},O$:function(){return f},Qb:function(){return o},Ur:function(){return l},W5:function(){return n},gz:function(){return s},h3:function(){return i},mN:function(){return c},ru:function(){return p},vL:function(){return u},x0:function(){return h}});var n={AVAILABLE:0,NOT_SUPPORTED:1,CANNOT_REQ_ADAPTER:2,CANNOT_REQ_DEVICE:3},i={AUTO:-1,UNDEFINED:0,WEBGL:1,WEBGPU:2,WEBGL_2:3,VIDEO_TAG:4},a={DISABLED:0,ENABLED:1,AUTO:2},o={SUCCEED:0,UNKNOWN:-1,INVALID_ARG:-2,BROWSER_NOT_SPT:-3,DEVICE_ON_BLACKLIST:-4,INVALID_DEVICE_INFO:-5,UNKNOWN_SELECTION:-6,OTHER_EX:-7,DEVICE_NOT_ON_WHITELIST:-8,FEATURE_OPTION_DISABLED:-9,FORCE_SAME_AV_STRATEGY:-10},s={AVAILABLE:0,VIDEO:1,SHARE:2},u=0,c=1,d=2,l=3,h={VS_BASE:0,CURSOR:1,WATERMARK:2,MASK:3,END:4},f=["intel","nvidia","apple","amd","qualcomm","arm"],p=.005},3485:function(e,t,r){r.d(t,{l:function(){return i}});var n=r(7857),i=new(D((function e(){R(this,e),(0,n.A)(this,"_info",void 0),this._info={browser:{brand:"",version:"",isBlink:!1,isWebkit:!1},sysinfo:{osType:"",os:"",osVersion:""},browserVersionInfo:{ie:"",edge:"",firefox:"",opera:"",chrome:"",safari:""}}}),[{key:"init",value:function(e){this._info=e}},{key:"info",value:function(){return this._info}},{key:"browserInfo",value:function(){return this._info.browser}},{key:"browserVersionInfo",value:function(){return this._info.browserVersionInfo}},{key:"browserName",value:function(){var e;return null===(e=this._info.browser.brand)||void 0===e?void 0:e.toLocaleLowerCase()}},{key:"isChrome",value:function(){var e;return"chrome"===(null===(e=this._info.browser.brand)||void 0===e?void 0:e.toLocaleLowerCase())}},{key:"isSafari",value:function(){var e;return"safari"===(null===(e=this._info.browser.brand)||void 0===e?void 0:e.toLocaleLowerCase())}},{key:"isFirefox",value:function(){var e;return"firefox"===(null===(e=this._info.browser.brand)||void 0===e?void 0:e.toLocaleLowerCase())}},{key:"isBlink",value:function(){return this._info.browser.isBlink}},{key:"isWebkit",value:function(){return this._info.browser.isWebkit}}]))},9549:function(e,t,r){function n(e){return e[0]<<24|e[1]<<16|e[2]<<8|e[3]}r.d(t,{J0:function(){return i},V_:function(){return a}});var i={IsQosReport:function(e){return 21==e[4]&&0==e[13]},GetQOSSeq:function(e){var t;(t=e.slice(17,19))[0],t[1]},GetQOSTime:function(e){return 104==e[0]||16!=e[4]&&1!=e[5]?n(e.slice(19,23)):n(e.slice(15,19))},IsVideoPkg:function(e){return 103==e[0]}},a=D((function e(t){R(this,e);var r=t||{};this.last_report_time=0,this.timeout_count=0,this.interval_report_time=r.interval||3e3,this.tag=r.tag||"monitor",this.max_timeout=0,this.min_timeout=2147483647,this.reportcallback=r.reportcallback,this._timeoutid=0}),[{key:"_report",value:function(){this.reportcallback&&this.reportcallback(this.tag,Math.ceil(this.max_timeout),Math.ceil(this.min_timeout),this.timeout_count),this.timeout_count=0,this.max_timeout=0,this.min_timeout=2147483647}},{key:"timeoutReport",value:function(e,t){if(this.timeout_count++,e>this.max_timeout&&(this.max_timeout=e),e<this.min_timeout&&(this.min_timeout=e),!this._timeoutid){var r=this;this._timeoutid=setTimeout((function(){r._report(),r._timeoutid=0}),this.interval_report_time)}}}])},9693:function(e,t,r){r.d(t,{$G:function(){return o},$x:function(){return s},Am:function(){return d},BB:function(){return R},BM:function(){return I},Dv:function(){return c},F:function(){return y},HG:function(){return a},KU:function(){return i},L2:function(){return k},P7:function(){return l},QT:function(){return b},TR:function(){return v},V0:function(){return f},_w:function(){return D},d4:function(){return E},dt:function(){return g},e:function(){return A},eG:function(){return S},g:function(){return w},j$:function(){return T},lc:function(){return m},o$:function(){return p},pV:function(){return C},sV:function(){return n},vC:function(){return _},vv:function(){return u},xC:function(){return h}});var n=1,i=2,a=3,o=4,s=5,u=6,c=7,d=9,l=10,h=11,f=129,p=130,v=131,g=132,m=133,y=134,_=135,S=136,A=137,b=138,E=139,k=140,C=143,w=144,T=145,R=146,I=147,D=1147},5723:function(e,t,r){r.d(t,{CH:function(){return f},O6:function(){return s},S_:function(){return i.S_},Tm:function(){return d},Wp:function(){return a},Yd:function(){return i.Yd},br:function(){return u},cY:function(){return c},fn:function(){return o},px:function(){return h},r1:function(){return i.r1},r9:function(){return i.r9},rm:function(){return p}});var n=r(9407),i=r(5600);function a(){return self.GROWABLE_HEAP_U8?self.GROWABLE_HEAP_U8():Module.HEAPU8}function o(e){postMessage({status:n.AC,errorMessage:e,level:"low"})}function s(e){postMessage({status:n.aY,canvasId:e,replaceCanvas:!1})}function u(e){postMessage({status:n.Tf,canvasId:e})}function c(){var e=this;this.promise=new Promise((function(t,r){e.reject=r,e.resolve=t}))}var d=D((function e(t){R(this,e),this.sharedBufferList=t}),[{key:"storeFlexible",value:function(e,t){var r=e.byteLength-this.sharedBufferList.bytesPerElement;if(r>0){var n=Math.floor(.1*this.sharedBufferList.bytesPerElement),i=r>n?r:n;if(i+this.sharedBufferList.bytesPerElement>t)return Promise.reject("too big, more than maxBytesPerElement");this.sharedBufferList.increaseBufferSize(i)}return this.store(e)}},{key:"store",value:function(e){var t=this;return this.sharedBufferList.get().then((function(r){try{return t.obj=r,r.uint8s.set(e,0),t.yuvdata=new Uint8Array(r.uint8s.buffer,0,e.byteLength),!0}finally{t.autoRecycle()}}))}},{key:"storeSync",value:function(e){var t=this.sharedBufferList.getSync();return null!==t&&(this.obj=t,t.uint8s.set(e,0),this.yuvdata=new Uint8Array(t.uint8s.buffer,0,e.byteLength),!0)}},{key:"autoRecycle",value:function(){var e=this;this.autoRecycleInterval=setTimeout((function(){console.log("autoRecycle",e.obj.index),e.recycle()}),5e3)}},{key:"recycle",value:function(){try{this.autoRecycleInterval&&clearInterval(this.autoRecycleInterval),this.sharedBufferList.recycle(this.obj.index)}catch(e){(0,i.r1)("Error in YuvWrap.recycle: ".concat(e))}}}]),l=["","MOZ_","OP_","WEBKIT_"];function h(e,t){for(var r=0;r<l.length;++r){var n=l[r]+t,i=e.getExtension(n);if(i)return i}}function f(e){return e&&"undefined"!=typeof atob?Uint8Array.from(atob(e),(function(e){return e.charCodeAt(0)})):null}var p=D((function e(t){R(this,e),this.featurebit=t}),[{key:"isSupportOffScreenCanvas",value:function(){return 1&this.featurebit}},{key:"isSupportOffScreenCanvasWebgl",value:function(){return 2&this.featurebit}}])},2710:function(e,t,r){r.d(t,{$2:function(){return T},$A:function(){return F},$K:function(){return I},$t:function(){return C},BY:function(){return H},Bb:function(){return J},DG:function(){return y},DY:function(){return E},FC:function(){return re},FP:function(){return Z},FW:function(){return n},Fw:function(){return g},HE:function(){return D},HX:function(){return te},Hc:function(){return L},IA:function(){return V},JT:function(){return Y},LA:function(){return oe},MJ:function(){return M},Mm:function(){return ie},O8:function(){return p},ON:function(){return ne},Q9:function(){return ue},QU:function(){return K},Qm:function(){return X},RP:function(){return q},UW:function(){return v},Wp:function(){return c},c7:function(){return W},dv:function(){return j},ej:function(){return P},fT:function(){return Q},fo:function(){return B},g$:function(){return m},g3:function(){return fe},gC:function(){return $},gg:function(){return ve},h:function(){return se},hS:function(){return o},hc:function(){return N},hd:function(){return l},js:function(){return z},jw:function(){return pe},kh:function(){return s},mV:function(){return h},mz:function(){return de},nV:function(){return i},nm:function(){return ce},p$:function(){return S},pn:function(){return d},qR:function(){return k},rK:function(){return u},sm:function(){return a},sr:function(){return he},tD:function(){return b},tT:function(){return ae},u:function(){return A},u7:function(){return _},uu:function(){return O},vm:function(){return ee},vr:function(){return le},ww:function(){return f},x_:function(){return U},y:function(){return G},yC:function(){return R},yu:function(){return x}});var n=108,i=104,a=0,o=1,s=-1,u=0,c=1,d=2,l=3,h=1,f=2,p=30,v=1,g=30,m=8294400,y=5,_={DESKTOP:0,MOBILE:1,ANDROID:2,IPHONE:3},S=-1,A=0,b=1,E=0,k=1,C=2,T=k+C,R=25,I=1,D=-1,M=0,O=1,x=0,P=1,L=2|P,N=4|P,V=L|N,U=8,F=16,B=32,W=3,G=107,H="101",j="102",K="WCL_M,isWebEnabled:1, isLocalEnabled:1, isSmartBkgnd:1, bkgType:2",z=0,q=1,Y=2,X=3,Q="{[WLCCONT]}",J=1e4,$=w(w(w(w(w(w(w(w({},x,new Map([["useinbandfec",1],["maxaveragebitrate",48e3],["maxplaybackrate",24e3],["sprop-maxcapturerate",24e3],["sprop-stereo",null],["stereo",null]])),P,new Map([["useinbandfec",null],["maxaveragebitrate",96e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3],["sprop-stereo",1],["stereo",1]])),L,new Map([["useinbandfec",null],["maxaveragebitrate",96e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3],["sprop-stereo",1],["stereo",1]])),N,new Map([["useinbandfec",null],["maxaveragebitrate",128e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3],["sprop-stereo",1],["stereo",1]])),V,new Map([["useinbandfec",null],["maxaveragebitrate",128e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3],["sprop-stereo",1],["stereo",1]])),U,new Map([["useinbandfec",null],["maxaveragebitrate",96e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3]])),F,new Map([["useinbandfec",1],["maxaveragebitrate",64e3],["maxplaybackrate",24e3],["sprop-maxcapturerate",24e3],["sprop-stereo",null],["stereo",null]])),B,new Map([["stereo",1]])),Z="SHARE",ee="NORMAL",te={VIDEO:0,SHARE:1},re={PAUSE:0,RESUME:1,STOP:2},ne=!0,ie=!1,ae={NET_QUALITY_UNKNOWN:-1,NET_QUALITY_VERY_BAD:0,NET_QUALITY_BAD:1,NET_QUALITY_NOT_GOOD:2,NET_QUALITY_NORMAL:3,NET_QUALITY_GOOD:4,NET_QUALITY_EXCELLENT:5},oe={NET_BW_LEVEL_UNKNOWN:-1,NET_BW_LEVEL_VERY_LOW:0,NET_BW_LEVEL_LOW:1,NET_BW_LEVEL_NORMAL:2},se=1,ue=2,ce=1,de=2,le={NEW_STREAM:0,PLAYER_ON_PAUSE:1,VISIBILITY_CHANGE:2,USER_CLICK:3,UNMUTE_ALL:4,ASSIGNED_NODE_ID:5,CAPTURE_AUDIO:6},he=1,fe=0,pe=10,ve=[{bitrateMode:"constant",scalabilityMode:"L1T2"},{bitrateMode:"constant"},{}]},5580:function(e,t,r){var n=r(6110)(r(9325),"DataView");e.exports=n},8223:function(e,t,r){var n=r(6110)(r(9325),"Map");e.exports=n},2804:function(e,t,r){var n=r(6110)(r(9325),"Promise");e.exports=n},6545:function(e,t,r){var n=r(6110)(r(9325),"Set");e.exports=n},1873:function(e,t,r){var n=r(9325).Symbol;e.exports=n},8303:function(e,t,r){var n=r(6110)(r(9325),"WeakMap");e.exports=n},2552:function(e,t,r){var n=r(1873),i=r(659),a=r(9350),o=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":o&&o in Object(e)?i(e):a(e)}},7534:function(e,t,r){var n=r(2552),i=r(346);e.exports=function(e){return i(e)&&"[object Arguments]"==n(e)}},5083:function(e,t,r){var n=r(1882),i=r(7296),a=r(3805),o=r(7473),s=/^\[object .+?Constructor\]$/,u=Function.prototype,c=Object.prototype,d=u.toString,l=c.hasOwnProperty,h=RegExp("^"+d.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!a(e)||i(e))&&(n(e)?h:s).test(o(e))}},4901:function(e,t,r){var n=r(2552),i=r(294),a=r(346),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,e.exports=function(e){return a(e)&&i(e.length)&&!!o[n(e)]}},8984:function(e,t,r){var n=r(5527),i=r(3650),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return i(e);var t=[];for(var r in Object(e))a.call(e,r)&&"constructor"!=r&&t.push(r);return t}},4128:function(e,t,r){var n=r(1800),i=/^\s+/;e.exports=function(e){return e?e.slice(0,n(e)+1).replace(i,""):e}},7301:function(e){e.exports=function(e){return function(t){return e(t)}}},5481:function(e,t,r){var n=r(9325)["__core-js_shared__"];e.exports=n},2459:function(e,t,r){var n="object"==j(r.g)&&r.g&&r.g.Object===Object&&r.g;e.exports=n},6110:function(e,t,r){var n=r(5083),i=r(392);e.exports=function(e,t){var r=i(e,t);return n(r)?r:void 0}},659:function(e,t,r){var n=r(1873),i=Object.prototype,a=i.hasOwnProperty,o=i.toString,s=n?n.toStringTag:void 0;e.exports=function(e){var t=a.call(e,s),r=e[s];try{e[s]=void 0;var n=!0}catch(e){}var i=o.call(e);return n&&(t?e[s]=r:delete e[s]),i}},5861:function(e,t,r){var n=r(5580),i=r(8223),a=r(2804),o=r(6545),s=r(8303),u=r(2552),c=r(7473),d="[object Map]",l="[object Promise]",h="[object Set]",f="[object WeakMap]",p="[object DataView]",v=c(n),g=c(i),m=c(a),y=c(o),_=c(s),S=u;(n&&S(new n(new ArrayBuffer(1)))!=p||i&&S(new i)!=d||a&&S(a.resolve())!=l||o&&S(new o)!=h||s&&S(new s)!=f)&&(S=function(e){var t=u(e),r="[object Object]"==t?e.constructor:void 0,n=r?c(r):"";if(n)switch(n){case v:return p;case g:return d;case m:return l;case y:return h;case _:return f}return t}),e.exports=S},392:function(e){e.exports=function(e,t){return null==e?void 0:e[t]}},7296:function(e,t,r){var n,i=r(5481),a=(n=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";e.exports=function(e){return!!a&&a in e}},5527:function(e){var t=Object.prototype;e.exports=function(e){var r=e&&e.constructor;return e===("function"==typeof r&&r.prototype||t)}},3650:function(e,t,r){var n=r(4335)(Object.keys,Object);e.exports=n},6009:function(e,t,r){e=r.nmd(e);var n=r(2459),i=t&&!t.nodeType&&t,a=i&&e&&!e.nodeType&&e,o=a&&a.exports===i&&n.process,s=function(){try{return a&&a.require&&a.require("util").types||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=s},9350:function(e){var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},4335:function(e){e.exports=function(e,t){return function(r){return e(t(r))}}},9325:function(e,t,r){var n=r(2459),i="object"==("undefined"==typeof self?"undefined":j(self))&&self&&self.Object===Object&&self,a=n||i||Function("return this")();e.exports=a},7473:function(e){var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},1800:function(e){var t=/\s/;e.exports=function(e){for(var r=e.length;r--&&t.test(e.charAt(r)););return r}},8221:function(e,t,r){var n=r(3805),i=r(124),a=r(9374),o=Math.max,s=Math.min;e.exports=function(e,t,r){var u,c,d,l,h,f,p=0,v=!1,g=!1,m=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function y(t){var r=u,n=c;return u=c=void 0,p=t,l=e.apply(n,r)}function _(e){var r=e-f;return void 0===f||r>=t||r<0||g&&e-p>=d}function S(){var e,r,n=i();if(_(n))return A(n);h=setTimeout(S,(r=t-((e=n)-f),g?s(r,d-(e-p)):r))}function A(e){return h=void 0,m&&u?y(e):(u=c=void 0,l)}function b(){var e,r=i(),n=_(r);if(u=arguments,c=this,f=r,n){if(void 0===h)return p=e=f,h=setTimeout(S,t),v?y(e):l;if(g)return clearTimeout(h),h=setTimeout(S,t),y(f)}return void 0===h&&(h=setTimeout(S,t)),l}return t=a(t)||0,n(r)&&(v=!!r.leading,d=(g="maxWait"in r)?o(a(r.maxWait)||0,t):d,m="trailing"in r?!!r.trailing:m),b.cancel=function(){void 0!==h&&clearTimeout(h),p=0,u=f=c=h=void 0},b.flush=function(){return void 0===h?l:A(i())},b}},2428:function(e,t,r){var n=r(7534),i=r(346),a=Object.prototype,o=a.hasOwnProperty,s=a.propertyIsEnumerable,u=n(function(){return arguments}())?n:function(e){return i(e)&&o.call(e,"callee")&&!s.call(e,"callee")};e.exports=u},6449:function(e){var t=Array.isArray;e.exports=t},4894:function(e,t,r){var n=r(1882),i=r(294);e.exports=function(e){return null!=e&&i(e.length)&&!n(e)}},3812:function(e,t,r){var n=r(2552),i=r(346);e.exports=function(e){return!0===e||!1===e||i(e)&&"[object Boolean]"==n(e)}},3656:function(e,t,r){e=r.nmd(e);var n=r(9325),i=r(9935),a=t&&!t.nodeType&&t,o=a&&e&&!e.nodeType&&e,s=o&&o.exports===a?n.Buffer:void 0,u=(s?s.isBuffer:void 0)||i;e.exports=u},2193:function(e,t,r){var n=r(8984),i=r(5861),a=r(2428),o=r(6449),s=r(4894),u=r(3656),c=r(5527),d=r(7167),l=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(s(e)&&(o(e)||"string"==typeof e||"function"==typeof e.splice||u(e)||d(e)||a(e)))return!e.length;var t=i(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(c(e))return!n(e).length;for(var r in e)if(l.call(e,r))return!1;return!0}},1882:function(e,t,r){var n=r(2552),i=r(3805);e.exports=function(e){if(!i(e))return!1;var t=n(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},294:function(e){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},8023:function(e,t,r){var n=r(2552),i=r(346);e.exports=function(e){return"number"==typeof e||i(e)&&"[object Number]"==n(e)}},3805:function(e){e.exports=function(e){var t=j(e);return null!=e&&("object"==t||"function"==t)}},346:function(e){e.exports=function(e){return null!=e&&"object"==j(e)}},4394:function(e,t,r){var n=r(2552),i=r(346);e.exports=function(e){return"symbol"==j(e)||i(e)&&"[object Symbol]"==n(e)}},7167:function(e,t,r){var n=r(4901),i=r(7301),a=r(6009),o=a&&a.isTypedArray,s=o?i(o):n;e.exports=s},2543:function(e,t,r){var n;e=r.nmd(e),function(){var i,a="Expected a function",o="__lodash_hash_undefined__",s="__lodash_placeholder__",u=32,c=128,d=1/0,l=9007199254740991,h=NaN,f=4294967295,p=[["ary",c],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",u],["partialRight",64],["rearg",256]],v="[object Arguments]",g="[object Array]",m="[object Boolean]",y="[object Date]",_="[object Error]",S="[object Function]",A="[object GeneratorFunction]",b="[object Map]",E="[object Number]",k="[object Object]",C="[object Promise]",w="[object RegExp]",T="[object Set]",R="[object String]",I="[object Symbol]",D="[object WeakMap]",M="[object ArrayBuffer]",O="[object DataView]",x="[object Float32Array]",P="[object Float64Array]",L="[object Int8Array]",N="[object Int16Array]",V="[object Int32Array]",U="[object Uint8Array]",F="[object Uint8ClampedArray]",B="[object Uint16Array]",W="[object Uint32Array]",G=/\b__p \+= '';/g,H=/\b(__p \+=) '' \+/g,K=/(__e\(.*?\)|\b__t\)) \+\n'';/g,z=/&(?:amp|lt|gt|quot|#39);/g,q=/[&<>"']/g,Y=RegExp(z.source),X=RegExp(q.source),Q=/<%-([\s\S]+?)%>/g,J=/<%([\s\S]+?)%>/g,$=/<%=([\s\S]+?)%>/g,Z=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ee=/^\w*$/,te=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,re=/[\\^$.*+?()[\]{}|]/g,ne=RegExp(re.source),ie=/^\s+/,ae=/\s/,oe=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,se=/\{\n\/\* \[wrapped with (.+)\] \*/,ue=/,? & /,ce=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,de=/[()=,{}\[\]\/\s]/,le=/\\(\\)?/g,he=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,fe=/\w*$/,pe=/^[-+]0x[0-9a-f]+$/i,ve=/^0b[01]+$/i,ge=/^\[object .+?Constructor\]$/,me=/^0o[0-7]+$/i,ye=/^(?:0|[1-9]\d*)$/,_e=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Se=/($^)/,Ae=/['\n\r\u2028\u2029\\]/g,be="\\ud800-\\udfff",Ee="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",ke="\\u2700-\\u27bf",Ce="a-z\\xdf-\\xf6\\xf8-\\xff",we="A-Z\\xc0-\\xd6\\xd8-\\xde",Te="\\ufe0e\\ufe0f",Re="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ie="["+be+"]",De="["+Re+"]",Me="["+Ee+"]",Oe="\\d+",xe="["+ke+"]",Pe="["+Ce+"]",Le="[^"+be+Re+Oe+ke+Ce+we+"]",Ne="\\ud83c[\\udffb-\\udfff]",Ve="[^"+be+"]",Ue="(?:\\ud83c[\\udde6-\\uddff]){2}",Fe="[\\ud800-\\udbff][\\udc00-\\udfff]",Be="["+we+"]",We="\\u200d",Ge="(?:"+Pe+"|"+Le+")",He="(?:"+Be+"|"+Le+")",je="(?:['](?:d|ll|m|re|s|t|ve))?",Ke="(?:['](?:D|LL|M|RE|S|T|VE))?",ze="(?:"+Me+"|"+Ne+")?",qe="["+Te+"]?",Ye=qe+ze+"(?:"+We+"(?:"+[Ve,Ue,Fe].join("|")+")"+qe+ze+")*",Xe="(?:"+[xe,Ue,Fe].join("|")+")"+Ye,Qe="(?:"+[Ve+Me+"?",Me,Ue,Fe,Ie].join("|")+")",Je=RegExp("[']","g"),$e=RegExp(Me,"g"),Ze=RegExp(Ne+"(?="+Ne+")|"+Qe+Ye,"g"),et=RegExp([Be+"?"+Pe+"+"+je+"(?="+[De,Be,"$"].join("|")+")",He+"+"+Ke+"(?="+[De,Be+Ge,"$"].join("|")+")",Be+"?"+Ge+"+"+je,Be+"+"+Ke,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Oe,Xe].join("|"),"g"),tt=RegExp("["+We+be+Ee+Te+"]"),rt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,nt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],it=-1,at={};at[x]=at[P]=at[L]=at[N]=at[V]=at[U]=at[F]=at[B]=at[W]=!0,at[v]=at[g]=at[M]=at[m]=at[O]=at[y]=at[_]=at[S]=at[b]=at[E]=at[k]=at[w]=at[T]=at[R]=at[D]=!1;var ot={};ot[v]=ot[g]=ot[M]=ot[O]=ot[m]=ot[y]=ot[x]=ot[P]=ot[L]=ot[N]=ot[V]=ot[b]=ot[E]=ot[k]=ot[w]=ot[T]=ot[R]=ot[I]=ot[U]=ot[F]=ot[B]=ot[W]=!0,ot[_]=ot[S]=ot[D]=!1;var st={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ut=parseFloat,ct=parseInt,dt="object"==j(r.g)&&r.g&&r.g.Object===Object&&r.g,lt="object"==("undefined"==typeof self?"undefined":j(self))&&self&&self.Object===Object&&self,ht=dt||lt||Function("return this")(),ft=t&&!t.nodeType&&t,pt=ft&&e&&!e.nodeType&&e,vt=pt&&pt.exports===ft,gt=vt&&dt.process,mt=function(){try{return pt&&pt.require&&pt.require("util").types||gt&&gt.binding&&gt.binding("util")}catch(e){}}(),yt=mt&&mt.isArrayBuffer,_t=mt&&mt.isDate,St=mt&&mt.isMap,At=mt&&mt.isRegExp,bt=mt&&mt.isSet,Et=mt&&mt.isTypedArray;function kt(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function Ct(e,t,r,n){for(var i=-1,a=null==e?0:e.length;++i<a;){var o=e[i];t(n,o,r(o),e)}return n}function wt(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}function Tt(e,t){for(var r=null==e?0:e.length;r--&&!1!==t(e[r],r,e););return e}function Rt(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function It(e,t){for(var r=-1,n=null==e?0:e.length,i=0,a=[];++r<n;){var o=e[r];t(o,r,e)&&(a[i++]=o)}return a}function Dt(e,t){return!(null==e||!e.length)&&Bt(e,t,0)>-1}function Mt(e,t,r){for(var n=-1,i=null==e?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1}function Ot(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}function xt(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}function Pt(e,t,r,n){var i=-1,a=null==e?0:e.length;for(n&&a&&(r=e[++i]);++i<a;)r=t(r,e[i],i,e);return r}function Lt(e,t,r,n){var i=null==e?0:e.length;for(n&&i&&(r=e[--i]);i--;)r=t(r,e[i],i,e);return r}function Nt(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var Vt=jt("length");function Ut(e,t,r){var n;return r(e,(function(e,r,i){if(t(e,r,i))return n=r,!1})),n}function Ft(e,t,r,n){for(var i=e.length,a=r+(n?1:-1);n?a--:++a<i;)if(t(e[a],a,e))return a;return-1}function Bt(e,t,r){return t==t?function(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}(e,t,r):Ft(e,Gt,r)}function Wt(e,t,r,n){for(var i=r-1,a=e.length;++i<a;)if(n(e[i],t))return i;return-1}function Gt(e){return e!=e}function Ht(e,t){var r=null==e?0:e.length;return r?qt(e,t)/r:h}function jt(e){return function(t){return null==t?i:t[e]}}function Kt(e){return function(t){return null==e?i:e[t]}}function zt(e,t,r,n,i){return i(e,(function(e,i,a){r=n?(n=!1,e):t(r,e,i,a)})),r}function qt(e,t){for(var r,n=-1,a=e.length;++n<a;){var o=t(e[n]);o!==i&&(r=r===i?o:r+o)}return r}function Yt(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function Xt(e){return e?e.slice(0,lr(e)+1).replace(ie,""):e}function Qt(e){return function(t){return e(t)}}function Jt(e,t){return Ot(t,(function(t){return e[t]}))}function $t(e,t){return e.has(t)}function Zt(e,t){for(var r=-1,n=e.length;++r<n&&Bt(t,e[r],0)>-1;);return r}function er(e,t){for(var r=e.length;r--&&Bt(t,e[r],0)>-1;);return r}var tr=Kt({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"}),rr=Kt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function nr(e){return"\\"+st[e]}function ir(e){return tt.test(e)}function ar(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function or(e,t){return function(r){return e(t(r))}}function sr(e,t){for(var r=-1,n=e.length,i=0,a=[];++r<n;){var o=e[r];o!==t&&o!==s||(e[r]=s,a[i++]=r)}return a}function ur(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}function cr(e){return ir(e)?function(e){for(var t=Ze.lastIndex=0;Ze.test(e);)++t;return t}(e):Vt(e)}function dr(e){return ir(e)?e.match(Ze)||[]:function(e){return e.split("")}(e)}function lr(e){for(var t=e.length;t--&&ae.test(e.charAt(t)););return t}var hr=Kt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),fr=function e(t){var r,n=(t=null==t?ht:fr.defaults(ht.Object(),t,fr.pick(ht,nt))).Array,ae=t.Date,be=t.Error,Ee=t.Function,ke=t.Math,Ce=t.Object,we=t.RegExp,Te=t.String,Re=t.TypeError,Ie=n.prototype,De=Ee.prototype,Me=Ce.prototype,Oe=t["__core-js_shared__"],xe=De.toString,Pe=Me.hasOwnProperty,Le=0,Ne=(r=/[^.]+$/.exec(Oe&&Oe.keys&&Oe.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",Ve=Me.toString,Ue=xe.call(Ce),Fe=ht._,Be=we("^"+xe.call(Pe).replace(re,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),We=vt?t.Buffer:i,Ge=t.Symbol,He=t.Uint8Array,je=We?We.allocUnsafe:i,Ke=or(Ce.getPrototypeOf,Ce),ze=Ce.create,qe=Me.propertyIsEnumerable,Ye=Ie.splice,Xe=Ge?Ge.isConcatSpreadable:i,Qe=Ge?Ge.iterator:i,Ze=Ge?Ge.toStringTag:i,tt=function(){try{var e=ua(Ce,"defineProperty");return e({},"",{}),e}catch(e){}}(),st=t.clearTimeout!==ht.clearTimeout&&t.clearTimeout,dt=ae&&ae.now!==ht.Date.now&&ae.now,lt=t.setTimeout!==ht.setTimeout&&t.setTimeout,ft=ke.ceil,pt=ke.floor,gt=Ce.getOwnPropertySymbols,mt=We?We.isBuffer:i,Vt=t.isFinite,Kt=Ie.join,pr=or(Ce.keys,Ce),vr=ke.max,gr=ke.min,mr=ae.now,yr=t.parseInt,_r=ke.random,Sr=Ie.reverse,Ar=ua(t,"DataView"),br=ua(t,"Map"),Er=ua(t,"Promise"),kr=ua(t,"Set"),Cr=ua(t,"WeakMap"),wr=ua(Ce,"create"),Tr=Cr&&new Cr,Rr={},Ir=Na(Ar),Dr=Na(br),Mr=Na(Er),Or=Na(kr),xr=Na(Cr),Pr=Ge?Ge.prototype:i,Lr=Pr?Pr.valueOf:i,Nr=Pr?Pr.toString:i;function Vr(e){if(es(e)&&!Ho(e)&&!(e instanceof Wr)){if(e instanceof Br)return e;if(Pe.call(e,"__wrapped__"))return Va(e)}return new Br(e)}var Ur=function(){function e(){}return function(t){if(!Zo(t))return{};if(ze)return ze(t);e.prototype=t;var r=new e;return e.prototype=i,r}}();function Fr(){}function Br(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}function Wr(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=f,this.__views__=[]}function Gr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Hr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function jr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Kr(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new jr;++t<r;)this.add(e[t])}function zr(e){var t=this.__data__=new Hr(e);this.size=t.size}function qr(e,t){var r=Ho(e),n=!r&&Go(e),i=!r&&!n&&qo(e),a=!r&&!n&&!i&&us(e),o=r||n||i||a,s=o?Yt(e.length,Te):[],u=s.length;for(var c in e)!t&&!Pe.call(e,c)||o&&("length"==c||i&&("offset"==c||"parent"==c)||a&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||va(c,u))||s.push(c);return s}function Yr(e){var t=e.length;return t?e[Kn(0,t-1)]:i}function Xr(e,t){return Ma(wi(e),an(t,0,e.length))}function Qr(e){return Ma(wi(e))}function Jr(e,t,r){(r!==i&&!Fo(e[t],r)||r===i&&!(t in e))&&rn(e,t,r)}function $r(e,t,r){var n=e[t];Pe.call(e,t)&&Fo(n,r)&&(r!==i||t in e)||rn(e,t,r)}function Zr(e,t){for(var r=e.length;r--;)if(Fo(e[r][0],t))return r;return-1}function en(e,t,r,n){return dn(e,(function(e,i,a){t(n,e,r(e),a)})),n}function tn(e,t){return e&&Ti(t,Ds(t),e)}function rn(e,t,r){"__proto__"==t&&tt?tt(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function nn(e,t){for(var r=-1,a=t.length,o=n(a),s=null==e;++r<a;)o[r]=s?i:Cs(e,t[r]);return o}function an(e,t,r){return e==e&&(r!==i&&(e=e<=r?e:r),t!==i&&(e=e>=t?e:t)),e}function on(e,t,r,n,a,o){var s,u=1&t,c=2&t,d=4&t;if(r&&(s=a?r(e,n,a,o):r(e)),s!==i)return s;if(!Zo(e))return e;var l,h,f,p=Ho(e);if(p){if(h=(l=e).length,f=new l.constructor(h),h&&"string"==typeof l[0]&&Pe.call(l,"index")&&(f.index=l.index,f.input=l.input),s=f,!u)return wi(e,s)}else{var g=la(e),_=g==S||g==A;if(qo(e))return Si(e,u);if(g==k||g==v||_&&!a){if(s=c||_?{}:fa(e),!u)return c?function(e,t){return Ti(e,da(e),t)}(e,function(e,t){return e&&Ti(t,Ms(t),e)}(s,e)):function(e,t){return Ti(e,ca(e),t)}(e,tn(s,e))}else{if(!ot[g])return a?e:{};s=function(e,t,r){var n,i,a,o=e.constructor;switch(t){case M:return Ai(e);case m:case y:return new o(+e);case O:return i=e,a=r?Ai(i.buffer):i.buffer,new i.constructor(a,i.byteOffset,i.byteLength);case x:case P:case L:case N:case V:case U:case F:case B:case W:return bi(e,r);case b:return new o;case E:case R:return new o(e);case w:return function(e){var t=new e.constructor(e.source,fe.exec(e));return t.lastIndex=e.lastIndex,t}(e);case T:return new o;case I:return n=e,Lr?Ce(Lr.call(n)):{}}}(e,g,u)}}o||(o=new zr);var C=o.get(e);if(C)return C;o.set(e,s),as(e)?e.forEach((function(n){s.add(on(n,t,r,n,e,o))})):ts(e)&&e.forEach((function(n,i){s.set(i,on(n,t,r,i,e,o))}));var D=p?i:(d?c?ta:ea:c?Ms:Ds)(e);return wt(D||e,(function(n,i){D&&(n=e[i=n]),$r(s,i,on(n,t,r,i,e,o))})),s}function sn(e,t,r){var n=r.length;if(null==e)return!n;for(e=Ce(e);n--;){var a=r[n],o=t[a],s=e[a];if(s===i&&!(a in e)||!o(s))return!1}return!0}function un(e,t,r){if("function"!=typeof e)throw new Re(a);return Ta((function(){e.apply(i,r)}),t)}function cn(e,t,r,n){var i=-1,a=Dt,o=!0,s=e.length,u=[],c=t.length;if(!s)return u;r&&(t=Ot(t,Qt(r))),n?(a=Mt,o=!1):t.length>=200&&(a=$t,o=!1,t=new Kr(t));e:for(;++i<s;){var d=e[i],l=null==r?d:r(d);if(d=n||0!==d?d:0,o&&l==l){for(var h=c;h--;)if(t[h]===l)continue e;u.push(d)}else a(t,l,n)||u.push(d)}return u}Vr.templateSettings={escape:Q,evaluate:J,interpolate:$,variable:"",imports:{_:Vr}},Vr.prototype=Fr.prototype,Vr.prototype.constructor=Vr,Br.prototype=Ur(Fr.prototype),Br.prototype.constructor=Br,Wr.prototype=Ur(Fr.prototype),Wr.prototype.constructor=Wr,Gr.prototype.clear=function(){this.__data__=wr?wr(null):{},this.size=0},Gr.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Gr.prototype.get=function(e){var t=this.__data__;if(wr){var r=t[e];return r===o?i:r}return Pe.call(t,e)?t[e]:i},Gr.prototype.has=function(e){var t=this.__data__;return wr?t[e]!==i:Pe.call(t,e)},Gr.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=wr&&t===i?o:t,this},Hr.prototype.clear=function(){this.__data__=[],this.size=0},Hr.prototype.delete=function(e){var t=this.__data__,r=Zr(t,e);return!(r<0||(r==t.length-1?t.pop():Ye.call(t,r,1),--this.size,0))},Hr.prototype.get=function(e){var t=this.__data__,r=Zr(t,e);return r<0?i:t[r][1]},Hr.prototype.has=function(e){return Zr(this.__data__,e)>-1},Hr.prototype.set=function(e,t){var r=this.__data__,n=Zr(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this},jr.prototype.clear=function(){this.size=0,this.__data__={hash:new Gr,map:new(br||Hr),string:new Gr}},jr.prototype.delete=function(e){var t=oa(this,e).delete(e);return this.size-=t?1:0,t},jr.prototype.get=function(e){return oa(this,e).get(e)},jr.prototype.has=function(e){return oa(this,e).has(e)},jr.prototype.set=function(e,t){var r=oa(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},Kr.prototype.add=Kr.prototype.push=function(e){return this.__data__.set(e,o),this},Kr.prototype.has=function(e){return this.__data__.has(e)},zr.prototype.clear=function(){this.__data__=new Hr,this.size=0},zr.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},zr.prototype.get=function(e){return this.__data__.get(e)},zr.prototype.has=function(e){return this.__data__.has(e)},zr.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Hr){var n=r.__data__;if(!br||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new jr(n)}return r.set(e,t),this.size=r.size,this};var dn=Di(yn),ln=Di(_n,!0);function hn(e,t){var r=!0;return dn(e,(function(e,n,i){return r=!!t(e,n,i)})),r}function fn(e,t,r){for(var n=-1,a=e.length;++n<a;){var o=e[n],s=t(o);if(null!=s&&(u===i?s==s&&!ss(s):r(s,u)))var u=s,c=o}return c}function pn(e,t){var r=[];return dn(e,(function(e,n,i){t(e,n,i)&&r.push(e)})),r}function vn(e,t,r,n,i){var a=-1,o=e.length;for(r||(r=pa),i||(i=[]);++a<o;){var s=e[a];t>0&&r(s)?t>1?vn(s,t-1,r,n,i):xt(i,s):n||(i[i.length]=s)}return i}var gn=Mi(),mn=Mi(!0);function yn(e,t){return e&&gn(e,t,Ds)}function _n(e,t){return e&&mn(e,t,Ds)}function Sn(e,t){return It(t,(function(t){return Qo(e[t])}))}function An(e,t){for(var r=0,n=(t=gi(t,e)).length;null!=e&&r<n;)e=e[La(t[r++])];return r&&r==n?e:i}function bn(e,t,r){var n=t(e);return Ho(e)?n:xt(n,r(e))}function En(e){return null==e?e===i?"[object Undefined]":"[object Null]":Ze&&Ze in Ce(e)?function(e){var t=Pe.call(e,Ze),r=e[Ze];try{e[Ze]=i;var n=!0}catch(e){}var a=Ve.call(e);return n&&(t?e[Ze]=r:delete e[Ze]),a}(e):(t=e,Ve.call(t));var t}function kn(e,t){return e>t}function Cn(e,t){return null!=e&&Pe.call(e,t)}function wn(e,t){return null!=e&&t in Ce(e)}function Tn(e,t,r){for(var a=r?Mt:Dt,o=e[0].length,s=e.length,u=s,c=n(s),d=1/0,l=[];u--;){var h=e[u];u&&t&&(h=Ot(h,Qt(t))),d=gr(h.length,d),c[u]=!r&&(t||o>=120&&h.length>=120)?new Kr(u&&h):i}h=e[0];var f=-1,p=c[0];e:for(;++f<o&&l.length<d;){var v=h[f],g=t?t(v):v;if(v=r||0!==v?v:0,!(p?$t(p,g):a(l,g,r))){for(u=s;--u;){var m=c[u];if(!(m?$t(m,g):a(e[u],g,r)))continue e}p&&p.push(g),l.push(v)}}return l}function Rn(e,t,r){var n=null==(e=ka(e,t=gi(t,e)))?e:e[La(Ya(t))];return null==n?i:kt(n,e,r)}function In(e){return es(e)&&En(e)==v}function Dn(e,t,r,n,a){return e===t||(null==e||null==t||!es(e)&&!es(t)?e!=e&&t!=t:function(e,t,r,n,a,o){var s=Ho(e),u=Ho(t),c=s?g:la(e),d=u?g:la(t),l=(c=c==v?k:c)==k,h=(d=d==v?k:d)==k,f=c==d;if(f&&qo(e)){if(!qo(t))return!1;s=!0,l=!1}if(f&&!l)return o||(o=new zr),s||us(e)?$i(e,t,r,n,a,o):function(e,t,r,n,i,a,o){switch(r){case O:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case M:return!(e.byteLength!=t.byteLength||!a(new He(e),new He(t)));case m:case y:case E:return Fo(+e,+t);case _:return e.name==t.name&&e.message==t.message;case w:case R:return e==t+"";case b:var s=ar;case T:var u=1&n;if(s||(s=ur),e.size!=t.size&&!u)return!1;var c=o.get(e);if(c)return c==t;n|=2,o.set(e,t);var d=$i(s(e),s(t),n,i,a,o);return o.delete(e),d;case I:if(Lr)return Lr.call(e)==Lr.call(t)}return!1}(e,t,c,r,n,a,o);if(!(1&r)){var p=l&&Pe.call(e,"__wrapped__"),S=h&&Pe.call(t,"__wrapped__");if(p||S){var A=p?e.value():e,C=S?t.value():t;return o||(o=new zr),a(A,C,r,n,o)}}return!!f&&(o||(o=new zr),function(e,t,r,n,a,o){var s=1&r,u=ea(e),c=u.length;if(c!=ea(t).length&&!s)return!1;for(var d=c;d--;){var l=u[d];if(!(s?l in t:Pe.call(t,l)))return!1}var h=o.get(e),f=o.get(t);if(h&&f)return h==t&&f==e;var p=!0;o.set(e,t),o.set(t,e);for(var v=s;++d<c;){var g=e[l=u[d]],m=t[l];if(n)var y=s?n(m,g,l,t,e,o):n(g,m,l,e,t,o);if(!(y===i?g===m||a(g,m,r,n,o):y)){p=!1;break}v||(v="constructor"==l)}if(p&&!v){var _=e.constructor,S=t.constructor;_==S||!("constructor"in e)||!("constructor"in t)||"function"==typeof _&&_ instanceof _&&"function"==typeof S&&S instanceof S||(p=!1)}return o.delete(e),o.delete(t),p}(e,t,r,n,a,o))}(e,t,r,n,Dn,a))}function Mn(e,t,r,n){var a=r.length,o=a,s=!n;if(null==e)return!o;for(e=Ce(e);a--;){var u=r[a];if(s&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++a<o;){var c=(u=r[a])[0],d=e[c],l=u[1];if(s&&u[2]){if(d===i&&!(c in e))return!1}else{var h=new zr;if(n)var f=n(d,l,c,e,t,h);if(!(f===i?Dn(l,d,3,n,h):f))return!1}}return!0}function On(e){return!(!Zo(e)||(t=e,Ne&&Ne in t))&&(Qo(e)?Be:ge).test(Na(e));var t}function xn(e){return"function"==typeof e?e:null==e?ru:"object"==j(e)?Ho(e)?Un(e[0],e[1]):Vn(e):lu(e)}function Pn(e){if(!Sa(e))return pr(e);var t=[];for(var r in Ce(e))Pe.call(e,r)&&"constructor"!=r&&t.push(r);return t}function Ln(e,t){return e<t}function Nn(e,t){var r=-1,i=Ko(e)?n(e.length):[];return dn(e,(function(e,n,a){i[++r]=t(e,n,a)})),i}function Vn(e){var t=sa(e);return 1==t.length&&t[0][2]?ba(t[0][0],t[0][1]):function(r){return r===e||Mn(r,e,t)}}function Un(e,t){return ma(e)&&Aa(t)?ba(La(e),t):function(r){var n=Cs(r,e);return n===i&&n===t?ws(r,e):Dn(t,n,3)}}function Fn(e,t,r,n,a){e!==t&&gn(t,(function(o,s){if(a||(a=new zr),Zo(o))!function(e,t,r,n,a,o,s){var u=Ca(e,r),c=Ca(t,r),d=s.get(c);if(d)Jr(e,r,d);else{var l=o?o(u,c,r+"",e,t,s):i,h=l===i;if(h){var f=Ho(c),p=!f&&qo(c),v=!f&&!p&&us(c);l=c,f||p||v?Ho(u)?l=u:zo(u)?l=wi(u):p?(h=!1,l=Si(c,!0)):v?(h=!1,l=bi(c,!0)):l=[]:ns(c)||Go(c)?(l=u,Go(u)?l=gs(u):Zo(u)&&!Qo(u)||(l=fa(c))):h=!1}h&&(s.set(c,l),a(l,c,n,o,s),s.delete(c)),Jr(e,r,l)}}(e,t,s,r,Fn,n,a);else{var u=n?n(Ca(e,s),o,s+"",e,t,a):i;u===i&&(u=o),Jr(e,s,u)}}),Ms)}function Bn(e,t){var r=e.length;if(r)return va(t+=t<0?r:0,r)?e[t]:i}function Wn(e,t,r){t=t.length?Ot(t,(function(e){return Ho(e)?function(t){return An(t,1===e.length?e[0]:e)}:e})):[ru];var n=-1;return t=Ot(t,Qt(aa())),function(e){var t=e.length;for(e.sort((function(e,t){return function(e,t,r){for(var n=-1,i=e.criteria,a=t.criteria,o=i.length,s=r.length;++n<o;){var u=Ei(i[n],a[n]);if(u)return n>=s?u:u*("desc"==r[n]?-1:1)}return e.index-t.index}(e,t,r)}));t--;)e[t]=e[t].value;return e}(Nn(e,(function(e,r,i){return{criteria:Ot(t,(function(t){return t(e)})),index:++n,value:e}})))}function Gn(e,t,r){for(var n=-1,i=t.length,a={};++n<i;){var o=t[n],s=An(e,o);r(s,o)&&Qn(a,gi(o,e),s)}return a}function Hn(e,t,r,n){var i=n?Wt:Bt,a=-1,o=t.length,s=e;for(e===t&&(t=wi(t)),r&&(s=Ot(e,Qt(r)));++a<o;)for(var u=0,c=t[a],d=r?r(c):c;(u=i(s,d,u,n))>-1;)s!==e&&Ye.call(s,u,1),Ye.call(e,u,1);return e}function jn(e,t){for(var r=e?t.length:0,n=r-1;r--;){var i=t[r];if(r==n||i!==a){var a=i;va(i)?Ye.call(e,i,1):ui(e,i)}}return e}function Kn(e,t){return e+pt(_r()*(t-e+1))}function zn(e,t){var r="";if(!e||t<1||t>l)return r;do{t%2&&(r+=e),(t=pt(t/2))&&(e+=e)}while(t);return r}function qn(e,t){return Ra(Ea(e,t,ru),e+"")}function Yn(e){return Yr(Fs(e))}function Xn(e,t){var r=Fs(e);return Ma(r,an(t,0,r.length))}function Qn(e,t,r,n){if(!Zo(e))return e;for(var a=-1,o=(t=gi(t,e)).length,s=o-1,u=e;null!=u&&++a<o;){var c=La(t[a]),d=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(a!=s){var l=u[c];(d=n?n(l,c,u):i)===i&&(d=Zo(l)?l:va(t[a+1])?[]:{})}$r(u,c,d),u=u[c]}return e}var Jn=Tr?function(e,t){return Tr.set(e,t),e}:ru,$n=tt?function(e,t){return tt(e,"toString",{configurable:!0,enumerable:!1,value:Zs(t),writable:!0})}:ru;function Zn(e){return Ma(Fs(e))}function ei(e,t,r){var i=-1,a=e.length;t<0&&(t=-t>a?0:a+t),(r=r>a?a:r)<0&&(r+=a),a=t>r?0:r-t>>>0,t>>>=0;for(var o=n(a);++i<a;)o[i]=e[i+t];return o}function ti(e,t){var r;return dn(e,(function(e,n,i){return!(r=t(e,n,i))})),!!r}function ri(e,t,r){var n=0,i=null==e?n:e.length;if("number"==typeof t&&t==t&&i<=2147483647){for(;n<i;){var a=n+i>>>1,o=e[a];null!==o&&!ss(o)&&(r?o<=t:o<t)?n=a+1:i=a}return i}return ni(e,t,ru,r)}function ni(e,t,r,n){var a=0,o=null==e?0:e.length;if(0===o)return 0;for(var s=(t=r(t))!=t,u=null===t,c=ss(t),d=t===i;a<o;){var l=pt((a+o)/2),h=r(e[l]),f=h!==i,p=null===h,v=h==h,g=ss(h);if(s)var m=n||v;else m=d?v&&(n||f):u?v&&f&&(n||!p):c?v&&f&&!p&&(n||!g):!p&&!g&&(n?h<=t:h<t);m?a=l+1:o=l}return gr(o,4294967294)}function ii(e,t){for(var r=-1,n=e.length,i=0,a=[];++r<n;){var o=e[r],s=t?t(o):o;if(!r||!Fo(s,u)){var u=s;a[i++]=0===o?0:o}}return a}function ai(e){return"number"==typeof e?e:ss(e)?h:+e}function oi(e){if("string"==typeof e)return e;if(Ho(e))return Ot(e,oi)+"";if(ss(e))return Nr?Nr.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function si(e,t,r){var n=-1,i=Dt,a=e.length,o=!0,s=[],u=s;if(r)o=!1,i=Mt;else if(a>=200){var c=t?null:zi(e);if(c)return ur(c);o=!1,i=$t,u=new Kr}else u=t?[]:s;e:for(;++n<a;){var d=e[n],l=t?t(d):d;if(d=r||0!==d?d:0,o&&l==l){for(var h=u.length;h--;)if(u[h]===l)continue e;t&&u.push(l),s.push(d)}else i(u,l,r)||(u!==s&&u.push(l),s.push(d))}return s}function ui(e,t){return null==(e=ka(e,t=gi(t,e)))||delete e[La(Ya(t))]}function ci(e,t,r,n){return Qn(e,t,r(An(e,t)),n)}function di(e,t,r,n){for(var i=e.length,a=n?i:-1;(n?a--:++a<i)&&t(e[a],a,e););return r?ei(e,n?0:a,n?a+1:i):ei(e,n?a+1:0,n?i:a)}function li(e,t){var r=e;return r instanceof Wr&&(r=r.value()),Pt(t,(function(e,t){return t.func.apply(t.thisArg,xt([e],t.args))}),r)}function hi(e,t,r){var i=e.length;if(i<2)return i?si(e[0]):[];for(var a=-1,o=n(i);++a<i;)for(var s=e[a],u=-1;++u<i;)u!=a&&(o[a]=cn(o[a]||s,e[u],t,r));return si(vn(o,1),t,r)}function fi(e,t,r){for(var n=-1,a=e.length,o=t.length,s={};++n<a;){var u=n<o?t[n]:i;r(s,e[n],u)}return s}function pi(e){return zo(e)?e:[]}function vi(e){return"function"==typeof e?e:ru}function gi(e,t){return Ho(e)?e:ma(e,t)?[e]:Pa(ms(e))}var mi=qn;function yi(e,t,r){var n=e.length;return r=r===i?n:r,!t&&r>=n?e:ei(e,t,r)}var _i=st||function(e){return ht.clearTimeout(e)};function Si(e,t){if(t)return e.slice();var r=e.length,n=je?je(r):new e.constructor(r);return e.copy(n),n}function Ai(e){var t=new e.constructor(e.byteLength);return new He(t).set(new He(e)),t}function bi(e,t){var r=t?Ai(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function Ei(e,t){if(e!==t){var r=e!==i,n=null===e,a=e==e,o=ss(e),s=t!==i,u=null===t,c=t==t,d=ss(t);if(!u&&!d&&!o&&e>t||o&&s&&c&&!u&&!d||n&&s&&c||!r&&c||!a)return 1;if(!n&&!o&&!d&&e<t||d&&r&&a&&!n&&!o||u&&r&&a||!s&&a||!c)return-1}return 0}function ki(e,t,r,i){for(var a=-1,o=e.length,s=r.length,u=-1,c=t.length,d=vr(o-s,0),l=n(c+d),h=!i;++u<c;)l[u]=t[u];for(;++a<s;)(h||a<o)&&(l[r[a]]=e[a]);for(;d--;)l[u++]=e[a++];return l}function Ci(e,t,r,i){for(var a=-1,o=e.length,s=-1,u=r.length,c=-1,d=t.length,l=vr(o-u,0),h=n(l+d),f=!i;++a<l;)h[a]=e[a];for(var p=a;++c<d;)h[p+c]=t[c];for(;++s<u;)(f||a<o)&&(h[p+r[s]]=e[a++]);return h}function wi(e,t){var r=-1,i=e.length;for(t||(t=n(i));++r<i;)t[r]=e[r];return t}function Ti(e,t,r,n){var a=!r;r||(r={});for(var o=-1,s=t.length;++o<s;){var u=t[o],c=n?n(r[u],e[u],u,r,e):i;c===i&&(c=e[u]),a?rn(r,u,c):$r(r,u,c)}return r}function Ri(e,t){return function(r,n){var i=Ho(r)?Ct:en,a=t?t():{};return i(r,e,aa(n,2),a)}}function Ii(e){return qn((function(t,r){var n=-1,a=r.length,o=a>1?r[a-1]:i,s=a>2?r[2]:i;for(o=e.length>3&&"function"==typeof o?(a--,o):i,s&&ga(r[0],r[1],s)&&(o=a<3?i:o,a=1),t=Ce(t);++n<a;){var u=r[n];u&&e(t,u,n,o)}return t}))}function Di(e,t){return function(r,n){if(null==r)return r;if(!Ko(r))return e(r,n);for(var i=r.length,a=t?i:-1,o=Ce(r);(t?a--:++a<i)&&!1!==n(o[a],a,o););return r}}function Mi(e){return function(t,r,n){for(var i=-1,a=Ce(t),o=n(t),s=o.length;s--;){var u=o[e?s:++i];if(!1===r(a[u],u,a))break}return t}}function Oi(e){return function(t){var r=ir(t=ms(t))?dr(t):i,n=r?r[0]:t.charAt(0),a=r?yi(r,1).join(""):t.slice(1);return n[e]()+a}}function xi(e){return function(t){return Pt(Qs(Gs(t).replace(Je,"")),e,"")}}function Pi(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=Ur(e.prototype),n=e.apply(r,t);return Zo(n)?n:r}}function Li(e){return function(t,r,n){var a=Ce(t);if(!Ko(t)){var o=aa(r,3);t=Ds(t),r=function(e){return o(a[e],e,a)}}var s=e(t,r,n);return s>-1?a[o?t[s]:s]:i}}function Ni(e){return Zi((function(t){var r=t.length,n=r,o=Br.prototype.thru;for(e&&t.reverse();n--;){var s=t[n];if("function"!=typeof s)throw new Re(a);if(o&&!u&&"wrapper"==na(s))var u=new Br([],!0)}for(n=u?n:r;++n<r;){var c=na(s=t[n]),d="wrapper"==c?ra(s):i;u=d&&ya(d[0])&&424==d[1]&&!d[4].length&&1==d[9]?u[na(d[0])].apply(u,d[3]):1==s.length&&ya(s)?u[c]():u.thru(s)}return function(){var e=arguments,n=e[0];if(u&&1==e.length&&Ho(n))return u.plant(n).value();for(var i=0,a=r?t[i].apply(this,e):n;++i<r;)a=t[i].call(this,a);return a}}))}function Vi(e,t,r,a,o,s,u,d,l,h){var f=t&c,p=1&t,v=2&t,g=24&t,m=512&t,y=v?i:Pi(e);return function c(){for(var _=arguments.length,S=n(_),A=_;A--;)S[A]=arguments[A];if(g)var b=ia(c),E=function(e,t){for(var r=e.length,n=0;r--;)e[r]===t&&++n;return n}(S,b);if(a&&(S=ki(S,a,o,g)),s&&(S=Ci(S,s,u,g)),_-=E,g&&_<h){var k=sr(S,b);return ji(e,t,Vi,c.placeholder,r,S,k,d,l,h-_)}var C=p?r:this,w=v?C[e]:e;return _=S.length,d?S=function(e,t){for(var r=e.length,n=gr(t.length,r),a=wi(e);n--;){var o=t[n];e[n]=va(o,r)?a[o]:i}return e}(S,d):m&&_>1&&S.reverse(),f&&l<_&&(S.length=l),this&&this!==ht&&this instanceof c&&(w=y||Pi(w)),w.apply(C,S)}}function Ui(e,t){return function(r,n){return i=r,a=e,o=t(n),s={},yn(i,(function(e,t,r){a(s,o(e),t,r)})),s;var i,a,o,s}}function Fi(e,t){return function(r,n){var a;if(r===i&&n===i)return t;if(r!==i&&(a=r),n!==i){if(a===i)return n;"string"==typeof r||"string"==typeof n?(r=oi(r),n=oi(n)):(r=ai(r),n=ai(n)),a=e(r,n)}return a}}function Bi(e){return Zi((function(t){return t=Ot(t,Qt(aa())),qn((function(r){var n=this;return e(t,(function(e){return kt(e,n,r)}))}))}))}function Wi(e,t){var r=(t=t===i?" ":oi(t)).length;if(r<2)return r?zn(t,e):t;var n=zn(t,ft(e/cr(t)));return ir(t)?yi(dr(n),0,e).join(""):n.slice(0,e)}function Gi(e){return function(t,r,a){return a&&"number"!=typeof a&&ga(t,r,a)&&(r=a=i),t=hs(t),r===i?(r=t,t=0):r=hs(r),function(e,t,r,i){for(var a=-1,o=vr(ft((t-e)/(r||1)),0),s=n(o);o--;)s[i?o:++a]=e,e+=r;return s}(t,r,a=a===i?t<r?1:-1:hs(a),e)}}function Hi(e){return function(t,r){return"string"==typeof t&&"string"==typeof r||(t=vs(t),r=vs(r)),e(t,r)}}function ji(e,t,r,n,a,o,s,c,d,l){var h=8&t;t|=h?u:64,4&(t&=~(h?64:u))||(t&=-4);var f=[e,t,a,h?o:i,h?s:i,h?i:o,h?i:s,c,d,l],p=r.apply(i,f);return ya(e)&&wa(p,f),p.placeholder=n,Ia(p,e,t)}function Ki(e){var t=ke[e];return function(e,r){if(e=vs(e),(r=null==r?0:gr(fs(r),292))&&Vt(e)){var n=(ms(e)+"e").split("e");return+((n=(ms(t(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}var zi=kr&&1/ur(new kr([,-0]))[1]==d?function(e){return new kr(e)}:su;function qi(e){return function(t){var r,n=la(t);return n==b?ar(t):n==T?function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=[e,e]})),r}(t):(r=t,Ot(e(t),(function(e){return[e,r[e]]})))}}function Yi(e,t,r,o,d,l,h,f){var p=2&t;if(!p&&"function"!=typeof e)throw new Re(a);var v=o?o.length:0;if(v||(t&=-97,o=d=i),h=h===i?h:vr(fs(h),0),f=f===i?f:fs(f),v-=d?d.length:0,64&t){var g=o,m=d;o=d=i}var y,_,S,A,b=p?i:ra(e),E=[e,t,r,o,d,g,m,l,h,f];if(b&&function(e,t){var r=e[1],n=t[1],i=r|n,a=i<131,o=n==c&&8==r||n==c&&256==r&&e[7].length<=t[8]||384==n&&t[7].length<=t[8]&&8==r;if(!a&&!o)return e;1&n&&(e[2]=t[2],i|=1&r?0:4);var u=t[3];if(u){var d=e[3];e[3]=d?ki(d,u,t[4]):u,e[4]=d?sr(e[3],s):t[4]}(u=t[5])&&(d=e[5],e[5]=d?Ci(d,u,t[6]):u,e[6]=d?sr(e[5],s):t[6]),(u=t[7])&&(e[7]=u),n&c&&(e[8]=null==e[8]?t[8]:gr(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i}(E,b),e=E[0],t=E[1],r=E[2],o=E[3],d=E[4],!(f=E[9]=E[9]===i?p?0:e.length:vr(E[9]-v,0))&&24&t&&(t&=-25),t&&1!=t)k=8==t||16==t?(_=t,S=f,A=Pi(y=e),function e(){for(var t=arguments.length,r=n(t),a=t,o=ia(e);a--;)r[a]=arguments[a];var s=t<3&&r[0]!==o&&r[t-1]!==o?[]:sr(r,o);return(t-=s.length)<S?ji(y,_,Vi,e.placeholder,i,r,s,i,i,S-t):kt(this&&this!==ht&&this instanceof e?A:y,this,r)}):t!=u&&33!=t||d.length?Vi.apply(i,E):function(e,t,r,i){var a=1&t,o=Pi(e);return function t(){for(var s=-1,u=arguments.length,c=-1,d=i.length,l=n(d+u),h=this&&this!==ht&&this instanceof t?o:e;++c<d;)l[c]=i[c];for(;u--;)l[c++]=arguments[++s];return kt(h,a?r:this,l)}}(e,t,r,o);else var k=function(e,t,r){var n=1&t,i=Pi(e);return function t(){return(this&&this!==ht&&this instanceof t?i:e).apply(n?r:this,arguments)}}(e,t,r);return Ia((b?Jn:wa)(k,E),e,t)}function Xi(e,t,r,n){return e===i||Fo(e,Me[r])&&!Pe.call(n,r)?t:e}function Qi(e,t,r,n,a,o){return Zo(e)&&Zo(t)&&(o.set(t,e),Fn(e,t,i,Qi,o),o.delete(t)),e}function Ji(e){return ns(e)?i:e}function $i(e,t,r,n,a,o){var s=1&r,u=e.length,c=t.length;if(u!=c&&!(s&&c>u))return!1;var d=o.get(e),l=o.get(t);if(d&&l)return d==t&&l==e;var h=-1,f=!0,p=2&r?new Kr:i;for(o.set(e,t),o.set(t,e);++h<u;){var v=e[h],g=t[h];if(n)var m=s?n(g,v,h,t,e,o):n(v,g,h,e,t,o);if(m!==i){if(m)continue;f=!1;break}if(p){if(!Nt(t,(function(e,t){if(!$t(p,t)&&(v===e||a(v,e,r,n,o)))return p.push(t)}))){f=!1;break}}else if(v!==g&&!a(v,g,r,n,o)){f=!1;break}}return o.delete(e),o.delete(t),f}function Zi(e){return Ra(Ea(e,i,Ha),e+"")}function ea(e){return bn(e,Ds,ca)}function ta(e){return bn(e,Ms,da)}var ra=Tr?function(e){return Tr.get(e)}:su;function na(e){for(var t=e.name+"",r=Rr[t],n=Pe.call(Rr,t)?r.length:0;n--;){var i=r[n],a=i.func;if(null==a||a==e)return i.name}return t}function ia(e){return(Pe.call(Vr,"placeholder")?Vr:e).placeholder}function aa(){var e=Vr.iteratee||nu;return e=e===nu?xn:e,arguments.length?e(arguments[0],arguments[1]):e}function oa(e,t){var r,n,i=e.__data__;return("string"==(n=j(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof t?"string":"hash"]:i.map}function sa(e){for(var t=Ds(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,Aa(i)]}return t}function ua(e,t){var r,n=null==(r=e)?i:r[t];return On(n)?n:i}var ca=gt?function(e){return null==e?[]:(e=Ce(e),It(gt(e),(function(t){return qe.call(e,t)})))}:pu,da=gt?function(e){for(var t=[];e;)xt(t,ca(e)),e=Ke(e);return t}:pu,la=En;function ha(e,t,r){for(var n=-1,i=(t=gi(t,e)).length,a=!1;++n<i;){var o=La(t[n]);if(!(a=null!=e&&r(e,o)))break;e=e[o]}return a||++n!=i?a:!!(i=null==e?0:e.length)&&$o(i)&&va(o,i)&&(Ho(e)||Go(e))}function fa(e){return"function"!=typeof e.constructor||Sa(e)?{}:Ur(Ke(e))}function pa(e){return Ho(e)||Go(e)||!!(Xe&&e&&e[Xe])}function va(e,t){var r=j(e);return!!(t=null==t?l:t)&&("number"==r||"symbol"!=r&&ye.test(e))&&e>-1&&e%1==0&&e<t}function ga(e,t,r){if(!Zo(r))return!1;var n=j(t);return!!("number"==n?Ko(r)&&va(t,r.length):"string"==n&&t in r)&&Fo(r[t],e)}function ma(e,t){if(Ho(e))return!1;var r=j(e);return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!ss(e))||ee.test(e)||!Z.test(e)||null!=t&&e in Ce(t)}function ya(e){var t=na(e),r=Vr[t];if("function"!=typeof r||!(t in Wr.prototype))return!1;if(e===r)return!0;var n=ra(r);return!!n&&e===n[0]}(Ar&&la(new Ar(new ArrayBuffer(1)))!=O||br&&la(new br)!=b||Er&&la(Er.resolve())!=C||kr&&la(new kr)!=T||Cr&&la(new Cr)!=D)&&(la=function(e){var t=En(e),r=t==k?e.constructor:i,n=r?Na(r):"";if(n)switch(n){case Ir:return O;case Dr:return b;case Mr:return C;case Or:return T;case xr:return D}return t});var _a=Oe?Qo:vu;function Sa(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Me)}function Aa(e){return e==e&&!Zo(e)}function ba(e,t){return function(r){return null!=r&&r[e]===t&&(t!==i||e in Ce(r))}}function Ea(e,t,r){return t=vr(t===i?e.length-1:t,0),function(){for(var i=arguments,a=-1,o=vr(i.length-t,0),s=n(o);++a<o;)s[a]=i[t+a];a=-1;for(var u=n(t+1);++a<t;)u[a]=i[a];return u[t]=r(s),kt(e,this,u)}}function ka(e,t){return t.length<2?e:An(e,ei(t,0,-1))}function Ca(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var wa=Da(Jn),Ta=lt||function(e,t){return ht.setTimeout(e,t)},Ra=Da($n);function Ia(e,t,r){var n,i=t+"";return Ra(e,function(e,t){var r=t.length;if(!r)return e;var n=r-1;return t[n]=(r>1?"& ":"")+t[n],t=t.join(r>2?", ":" "),e.replace(oe,"{\n/* [wrapped with "+t+"] */\n")}(i,function(e,t){return wt(p,(function(r){var n="_."+r[0];t&r[1]&&!Dt(e,n)&&e.push(n)})),e.sort()}((n=i.match(se))?n[1].split(ue):[],r)))}function Da(e){var t=0,r=0;return function(){var n=mr(),a=16-(n-r);if(r=n,a>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(i,arguments)}}function Ma(e,t){var r=-1,n=e.length,a=n-1;for(t=t===i?n:t;++r<t;){var o=Kn(r,a),s=e[o];e[o]=e[r],e[r]=s}return e.length=t,e}var Oa,xa,Pa=(Oa=xo((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(te,(function(e,r,n,i){t.push(n?i.replace(le,"$1"):r||e)})),t}),(function(e){return 500===xa.size&&xa.clear(),e})),xa=Oa.cache,Oa);function La(e){if("string"==typeof e||ss(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Na(e){if(null!=e){try{return xe.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Va(e){if(e instanceof Wr)return e.clone();var t=new Br(e.__wrapped__,e.__chain__);return t.__actions__=wi(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Ua=qn((function(e,t){return zo(e)?cn(e,vn(t,1,zo,!0)):[]})),Fa=qn((function(e,t){var r=Ya(t);return zo(r)&&(r=i),zo(e)?cn(e,vn(t,1,zo,!0),aa(r,2)):[]})),Ba=qn((function(e,t){var r=Ya(t);return zo(r)&&(r=i),zo(e)?cn(e,vn(t,1,zo,!0),i,r):[]}));function Wa(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=null==r?0:fs(r);return i<0&&(i=vr(n+i,0)),Ft(e,aa(t,3),i)}function Ga(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var a=n-1;return r!==i&&(a=fs(r),a=r<0?vr(n+a,0):gr(a,n-1)),Ft(e,aa(t,3),a,!0)}function Ha(e){return null!=e&&e.length?vn(e,1):[]}function ja(e){return e&&e.length?e[0]:i}var Ka=qn((function(e){var t=Ot(e,pi);return t.length&&t[0]===e[0]?Tn(t):[]})),za=qn((function(e){var t=Ya(e),r=Ot(e,pi);return t===Ya(r)?t=i:r.pop(),r.length&&r[0]===e[0]?Tn(r,aa(t,2)):[]})),qa=qn((function(e){var t=Ya(e),r=Ot(e,pi);return(t="function"==typeof t?t:i)&&r.pop(),r.length&&r[0]===e[0]?Tn(r,i,t):[]}));function Ya(e){var t=null==e?0:e.length;return t?e[t-1]:i}var Xa=qn(Qa);function Qa(e,t){return e&&e.length&&t&&t.length?Hn(e,t):e}var Ja=Zi((function(e,t){var r=null==e?0:e.length,n=nn(e,t);return jn(e,Ot(t,(function(e){return va(e,r)?+e:e})).sort(Ei)),n}));function $a(e){return null==e?e:Sr.call(e)}var Za=qn((function(e){return si(vn(e,1,zo,!0))})),eo=qn((function(e){var t=Ya(e);return zo(t)&&(t=i),si(vn(e,1,zo,!0),aa(t,2))})),to=qn((function(e){var t=Ya(e);return t="function"==typeof t?t:i,si(vn(e,1,zo,!0),i,t)}));function ro(e){if(!e||!e.length)return[];var t=0;return e=It(e,(function(e){if(zo(e))return t=vr(e.length,t),!0})),Yt(t,(function(t){return Ot(e,jt(t))}))}function no(e,t){if(!e||!e.length)return[];var r=ro(e);return null==t?r:Ot(r,(function(e){return kt(t,i,e)}))}var io=qn((function(e,t){return zo(e)?cn(e,t):[]})),ao=qn((function(e){return hi(It(e,zo))})),oo=qn((function(e){var t=Ya(e);return zo(t)&&(t=i),hi(It(e,zo),aa(t,2))})),so=qn((function(e){var t=Ya(e);return t="function"==typeof t?t:i,hi(It(e,zo),i,t)})),uo=qn(ro),co=qn((function(e){var t=e.length,r=t>1?e[t-1]:i;return r="function"==typeof r?(e.pop(),r):i,no(e,r)}));function lo(e){var t=Vr(e);return t.__chain__=!0,t}function ho(e,t){return t(e)}var fo=Zi((function(e){var t=e.length,r=t?e[0]:0,n=this.__wrapped__,a=function(t){return nn(t,e)};return!(t>1||this.__actions__.length)&&n instanceof Wr&&va(r)?((n=n.slice(r,+r+(t?1:0))).__actions__.push({func:ho,args:[a],thisArg:i}),new Br(n,this.__chain__).thru((function(e){return t&&!e.length&&e.push(i),e}))):this.thru(a)})),po=Ri((function(e,t,r){Pe.call(e,r)?++e[r]:rn(e,r,1)})),vo=Li(Wa),go=Li(Ga);function mo(e,t){return(Ho(e)?wt:dn)(e,aa(t,3))}function yo(e,t){return(Ho(e)?Tt:ln)(e,aa(t,3))}var _o=Ri((function(e,t,r){Pe.call(e,r)?e[r].push(t):rn(e,r,[t])})),So=qn((function(e,t,r){var i=-1,a="function"==typeof t,o=Ko(e)?n(e.length):[];return dn(e,(function(e){o[++i]=a?kt(t,e,r):Rn(e,t,r)})),o})),Ao=Ri((function(e,t,r){rn(e,r,t)}));function bo(e,t){return(Ho(e)?Ot:Nn)(e,aa(t,3))}var Eo=Ri((function(e,t,r){e[r?0:1].push(t)}),(function(){return[[],[]]})),ko=qn((function(e,t){if(null==e)return[];var r=t.length;return r>1&&ga(e,t[0],t[1])?t=[]:r>2&&ga(t[0],t[1],t[2])&&(t=[t[0]]),Wn(e,vn(t,1),[])})),Co=dt||function(){return ht.Date.now()};function wo(e,t,r){return t=r?i:t,t=e&&null==t?e.length:t,Yi(e,c,i,i,i,i,t)}function To(e,t){var r;if("function"!=typeof t)throw new Re(a);return e=fs(e),function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=i),r}}var Ro=qn((function(e,t,r){var n=1;if(r.length){var i=sr(r,ia(Ro));n|=u}return Yi(e,n,t,r,i)})),Io=qn((function(e,t,r){var n=3;if(r.length){var i=sr(r,ia(Io));n|=u}return Yi(t,n,e,r,i)}));function Do(e,t,r){var n,o,s,u,c,d,l=0,h=!1,f=!1,p=!0;if("function"!=typeof e)throw new Re(a);function v(t){var r=n,a=o;return n=o=i,l=t,u=e.apply(a,r)}function g(e){var r=e-d;return d===i||r>=t||r<0||f&&e-l>=s}function m(){var e,r,n=Co();if(g(n))return y(n);c=Ta(m,(r=t-((e=n)-d),f?gr(r,s-(e-l)):r))}function y(e){return c=i,p&&n?v(e):(n=o=i,u)}function _(){var e,r=Co(),a=g(r);if(n=arguments,o=this,d=r,a){if(c===i)return l=e=d,c=Ta(m,t),h?v(e):u;if(f)return _i(c),c=Ta(m,t),v(d)}return c===i&&(c=Ta(m,t)),u}return t=vs(t)||0,Zo(r)&&(h=!!r.leading,s=(f="maxWait"in r)?vr(vs(r.maxWait)||0,t):s,p="trailing"in r?!!r.trailing:p),_.cancel=function(){c!==i&&_i(c),l=0,n=d=o=c=i},_.flush=function(){return c===i?u:y(Co())},_}var Mo=qn((function(e,t){return un(e,1,t)})),Oo=qn((function(e,t,r){return un(e,vs(t)||0,r)}));function xo(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new Re(a);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],a=r.cache;if(a.has(i))return a.get(i);var o=e.apply(this,n);return r.cache=a.set(i,o)||a,o};return r.cache=new(xo.Cache||jr),r}function Po(e){if("function"!=typeof e)throw new Re(a);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}xo.Cache=jr;var Lo=mi((function(e,t){var r=(t=1==t.length&&Ho(t[0])?Ot(t[0],Qt(aa())):Ot(vn(t,1),Qt(aa()))).length;return qn((function(n){for(var i=-1,a=gr(n.length,r);++i<a;)n[i]=t[i].call(this,n[i]);return kt(e,this,n)}))})),No=qn((function(e,t){var r=sr(t,ia(No));return Yi(e,u,i,t,r)})),Vo=qn((function(e,t){var r=sr(t,ia(Vo));return Yi(e,64,i,t,r)})),Uo=Zi((function(e,t){return Yi(e,256,i,i,i,t)}));function Fo(e,t){return e===t||e!=e&&t!=t}var Bo=Hi(kn),Wo=Hi((function(e,t){return e>=t})),Go=In(function(){return arguments}())?In:function(e){return es(e)&&Pe.call(e,"callee")&&!qe.call(e,"callee")},Ho=n.isArray,jo=yt?Qt(yt):function(e){return es(e)&&En(e)==M};function Ko(e){return null!=e&&$o(e.length)&&!Qo(e)}function zo(e){return es(e)&&Ko(e)}var qo=mt||vu,Yo=_t?Qt(_t):function(e){return es(e)&&En(e)==y};function Xo(e){if(!es(e))return!1;var t=En(e);return t==_||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!ns(e)}function Qo(e){if(!Zo(e))return!1;var t=En(e);return t==S||t==A||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Jo(e){return"number"==typeof e&&e==fs(e)}function $o(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=l}function Zo(e){var t=j(e);return null!=e&&("object"==t||"function"==t)}function es(e){return null!=e&&"object"==j(e)}var ts=St?Qt(St):function(e){return es(e)&&la(e)==b};function rs(e){return"number"==typeof e||es(e)&&En(e)==E}function ns(e){if(!es(e)||En(e)!=k)return!1;var t=Ke(e);if(null===t)return!0;var r=Pe.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&xe.call(r)==Ue}var is=At?Qt(At):function(e){return es(e)&&En(e)==w},as=bt?Qt(bt):function(e){return es(e)&&la(e)==T};function os(e){return"string"==typeof e||!Ho(e)&&es(e)&&En(e)==R}function ss(e){return"symbol"==j(e)||es(e)&&En(e)==I}var us=Et?Qt(Et):function(e){return es(e)&&$o(e.length)&&!!at[En(e)]},cs=Hi(Ln),ds=Hi((function(e,t){return e<=t}));function ls(e){if(!e)return[];if(Ko(e))return os(e)?dr(e):wi(e);if(Qe&&e[Qe])return function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}(e[Qe]());var t=la(e);return(t==b?ar:t==T?ur:Fs)(e)}function hs(e){return e?(e=vs(e))===d||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function fs(e){var t=hs(e),r=t%1;return t==t?r?t-r:t:0}function ps(e){return e?an(fs(e),0,f):0}function vs(e){if("number"==typeof e)return e;if(ss(e))return h;if(Zo(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Zo(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Xt(e);var r=ve.test(e);return r||me.test(e)?ct(e.slice(2),r?2:8):pe.test(e)?h:+e}function gs(e){return Ti(e,Ms(e))}function ms(e){return null==e?"":oi(e)}var ys=Ii((function(e,t){if(Sa(t)||Ko(t))Ti(t,Ds(t),e);else for(var r in t)Pe.call(t,r)&&$r(e,r,t[r])})),_s=Ii((function(e,t){Ti(t,Ms(t),e)})),Ss=Ii((function(e,t,r,n){Ti(t,Ms(t),e,n)})),As=Ii((function(e,t,r,n){Ti(t,Ds(t),e,n)})),bs=Zi(nn),Es=qn((function(e,t){e=Ce(e);var r=-1,n=t.length,a=n>2?t[2]:i;for(a&&ga(t[0],t[1],a)&&(n=1);++r<n;)for(var o=t[r],s=Ms(o),u=-1,c=s.length;++u<c;){var d=s[u],l=e[d];(l===i||Fo(l,Me[d])&&!Pe.call(e,d))&&(e[d]=o[d])}return e})),ks=qn((function(e){return e.push(i,Qi),kt(xs,i,e)}));function Cs(e,t,r){var n=null==e?i:An(e,t);return n===i?r:n}function ws(e,t){return null!=e&&ha(e,t,wn)}var Ts=Ui((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Ve.call(t)),e[t]=r}),Zs(ru)),Rs=Ui((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Ve.call(t)),Pe.call(e,t)?e[t].push(r):e[t]=[r]}),aa),Is=qn(Rn);function Ds(e){return Ko(e)?qr(e):Pn(e)}function Ms(e){return Ko(e)?qr(e,!0):function(e){if(!Zo(e))return function(e){var t=[];if(null!=e)for(var r in Ce(e))t.push(r);return t}(e);var t=Sa(e),r=[];for(var n in e)("constructor"!=n||!t&&Pe.call(e,n))&&r.push(n);return r}(e)}var Os=Ii((function(e,t,r){Fn(e,t,r)})),xs=Ii((function(e,t,r,n){Fn(e,t,r,n)})),Ps=Zi((function(e,t){var r={};if(null==e)return r;var n=!1;t=Ot(t,(function(t){return t=gi(t,e),n||(n=t.length>1),t})),Ti(e,ta(e),r),n&&(r=on(r,7,Ji));for(var i=t.length;i--;)ui(r,t[i]);return r})),Ls=Zi((function(e,t){return null==e?{}:Gn(r=e,t,(function(e,t){return ws(r,t)}));var r}));function Ns(e,t){if(null==e)return{};var r=Ot(ta(e),(function(e){return[e]}));return t=aa(t),Gn(e,r,(function(e,r){return t(e,r[0])}))}var Vs=qi(Ds),Us=qi(Ms);function Fs(e){return null==e?[]:Jt(e,Ds(e))}var Bs=xi((function(e,t,r){return t=t.toLowerCase(),e+(r?Ws(t):t)}));function Ws(e){return Xs(ms(e).toLowerCase())}function Gs(e){return(e=ms(e))&&e.replace(_e,tr).replace($e,"")}var Hs=xi((function(e,t,r){return e+(r?"-":"")+t.toLowerCase()})),js=xi((function(e,t,r){return e+(r?" ":"")+t.toLowerCase()})),Ks=Oi("toLowerCase"),zs=xi((function(e,t,r){return e+(r?"_":"")+t.toLowerCase()})),qs=xi((function(e,t,r){return e+(r?" ":"")+Xs(t)})),Ys=xi((function(e,t,r){return e+(r?" ":"")+t.toUpperCase()})),Xs=Oi("toUpperCase");function Qs(e,t,r){return e=ms(e),(t=r?i:t)===i?(n=e,rt.test(n)?function(e){return e.match(et)||[]}(e):function(e){return e.match(ce)||[]}(e)):e.match(t)||[];var n}var Js=qn((function(e,t){try{return kt(e,i,t)}catch(e){return Xo(e)?e:new be(e)}})),$s=Zi((function(e,t){return wt(t,(function(t){t=La(t),rn(e,t,Ro(e[t],e))})),e}));function Zs(e){return function(){return e}}var eu=Ni(),tu=Ni(!0);function ru(e){return e}function nu(e){return xn("function"==typeof e?e:on(e,1))}var iu=qn((function(e,t){return function(r){return Rn(r,e,t)}})),au=qn((function(e,t){return function(r){return Rn(e,r,t)}}));function ou(e,t,r){var n=Ds(t),i=Sn(t,n);null!=r||Zo(t)&&(i.length||!n.length)||(r=t,t=e,e=this,i=Sn(t,Ds(t)));var a=!(Zo(r)&&"chain"in r&&!r.chain),o=Qo(e);return wt(i,(function(r){var n=t[r];e[r]=n,o&&(e.prototype[r]=function(){var t=this.__chain__;if(a||t){var r=e(this.__wrapped__);return(r.__actions__=wi(this.__actions__)).push({func:n,args:arguments,thisArg:e}),r.__chain__=t,r}return n.apply(e,xt([this.value()],arguments))})})),e}function su(){}var uu=Bi(Ot),cu=Bi(Rt),du=Bi(Nt);function lu(e){return ma(e)?jt(La(e)):(t=e,function(e){return An(e,t)});var t}var hu=Gi(),fu=Gi(!0);function pu(){return[]}function vu(){return!1}var gu,mu=Fi((function(e,t){return e+t}),0),yu=Ki("ceil"),_u=Fi((function(e,t){return e/t}),1),Su=Ki("floor"),Au=Fi((function(e,t){return e*t}),1),bu=Ki("round"),Eu=Fi((function(e,t){return e-t}),0);return Vr.after=function(e,t){if("function"!=typeof t)throw new Re(a);return e=fs(e),function(){if(--e<1)return t.apply(this,arguments)}},Vr.ary=wo,Vr.assign=ys,Vr.assignIn=_s,Vr.assignInWith=Ss,Vr.assignWith=As,Vr.at=bs,Vr.before=To,Vr.bind=Ro,Vr.bindAll=$s,Vr.bindKey=Io,Vr.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Ho(e)?e:[e]},Vr.chain=lo,Vr.chunk=function(e,t,r){t=(r?ga(e,t,r):t===i)?1:vr(fs(t),0);var a=null==e?0:e.length;if(!a||t<1)return[];for(var o=0,s=0,u=n(ft(a/t));o<a;)u[s++]=ei(e,o,o+=t);return u},Vr.compact=function(e){for(var t=-1,r=null==e?0:e.length,n=0,i=[];++t<r;){var a=e[t];a&&(i[n++]=a)}return i},Vr.concat=function(){var e=arguments.length;if(!e)return[];for(var t=n(e-1),r=arguments[0],i=e;i--;)t[i-1]=arguments[i];return xt(Ho(r)?wi(r):[r],vn(t,1))},Vr.cond=function(e){var t=null==e?0:e.length,r=aa();return e=t?Ot(e,(function(e){if("function"!=typeof e[1])throw new Re(a);return[r(e[0]),e[1]]})):[],qn((function(r){for(var n=-1;++n<t;){var i=e[n];if(kt(i[0],this,r))return kt(i[1],this,r)}}))},Vr.conforms=function(e){return t=on(e,1),r=Ds(t),function(e){return sn(e,t,r)};var t,r},Vr.constant=Zs,Vr.countBy=po,Vr.create=function(e,t){var r=Ur(e);return null==t?r:tn(r,t)},Vr.curry=function e(t,r,n){var a=Yi(t,8,i,i,i,i,i,r=n?i:r);return a.placeholder=e.placeholder,a},Vr.curryRight=function e(t,r,n){var a=Yi(t,16,i,i,i,i,i,r=n?i:r);return a.placeholder=e.placeholder,a},Vr.debounce=Do,Vr.defaults=Es,Vr.defaultsDeep=ks,Vr.defer=Mo,Vr.delay=Oo,Vr.difference=Ua,Vr.differenceBy=Fa,Vr.differenceWith=Ba,Vr.drop=function(e,t,r){var n=null==e?0:e.length;return n?ei(e,(t=r||t===i?1:fs(t))<0?0:t,n):[]},Vr.dropRight=function(e,t,r){var n=null==e?0:e.length;return n?ei(e,0,(t=n-(t=r||t===i?1:fs(t)))<0?0:t):[]},Vr.dropRightWhile=function(e,t){return e&&e.length?di(e,aa(t,3),!0,!0):[]},Vr.dropWhile=function(e,t){return e&&e.length?di(e,aa(t,3),!0):[]},Vr.fill=function(e,t,r,n){var a=null==e?0:e.length;return a?(r&&"number"!=typeof r&&ga(e,t,r)&&(r=0,n=a),function(e,t,r,n){var a=e.length;for((r=fs(r))<0&&(r=-r>a?0:a+r),(n=n===i||n>a?a:fs(n))<0&&(n+=a),n=r>n?0:ps(n);r<n;)e[r++]=t;return e}(e,t,r,n)):[]},Vr.filter=function(e,t){return(Ho(e)?It:pn)(e,aa(t,3))},Vr.flatMap=function(e,t){return vn(bo(e,t),1)},Vr.flatMapDeep=function(e,t){return vn(bo(e,t),d)},Vr.flatMapDepth=function(e,t,r){return r=r===i?1:fs(r),vn(bo(e,t),r)},Vr.flatten=Ha,Vr.flattenDeep=function(e){return null!=e&&e.length?vn(e,d):[]},Vr.flattenDepth=function(e,t){return null!=e&&e.length?vn(e,t=t===i?1:fs(t)):[]},Vr.flip=function(e){return Yi(e,512)},Vr.flow=eu,Vr.flowRight=tu,Vr.fromPairs=function(e){for(var t=-1,r=null==e?0:e.length,n={};++t<r;){var i=e[t];n[i[0]]=i[1]}return n},Vr.functions=function(e){return null==e?[]:Sn(e,Ds(e))},Vr.functionsIn=function(e){return null==e?[]:Sn(e,Ms(e))},Vr.groupBy=_o,Vr.initial=function(e){return null!=e&&e.length?ei(e,0,-1):[]},Vr.intersection=Ka,Vr.intersectionBy=za,Vr.intersectionWith=qa,Vr.invert=Ts,Vr.invertBy=Rs,Vr.invokeMap=So,Vr.iteratee=nu,Vr.keyBy=Ao,Vr.keys=Ds,Vr.keysIn=Ms,Vr.map=bo,Vr.mapKeys=function(e,t){var r={};return t=aa(t,3),yn(e,(function(e,n,i){rn(r,t(e,n,i),e)})),r},Vr.mapValues=function(e,t){var r={};return t=aa(t,3),yn(e,(function(e,n,i){rn(r,n,t(e,n,i))})),r},Vr.matches=function(e){return Vn(on(e,1))},Vr.matchesProperty=function(e,t){return Un(e,on(t,1))},Vr.memoize=xo,Vr.merge=Os,Vr.mergeWith=xs,Vr.method=iu,Vr.methodOf=au,Vr.mixin=ou,Vr.negate=Po,Vr.nthArg=function(e){return e=fs(e),qn((function(t){return Bn(t,e)}))},Vr.omit=Ps,Vr.omitBy=function(e,t){return Ns(e,Po(aa(t)))},Vr.once=function(e){return To(2,e)},Vr.orderBy=function(e,t,r,n){return null==e?[]:(Ho(t)||(t=null==t?[]:[t]),Ho(r=n?i:r)||(r=null==r?[]:[r]),Wn(e,t,r))},Vr.over=uu,Vr.overArgs=Lo,Vr.overEvery=cu,Vr.overSome=du,Vr.partial=No,Vr.partialRight=Vo,Vr.partition=Eo,Vr.pick=Ls,Vr.pickBy=Ns,Vr.property=lu,Vr.propertyOf=function(e){return function(t){return null==e?i:An(e,t)}},Vr.pull=Xa,Vr.pullAll=Qa,Vr.pullAllBy=function(e,t,r){return e&&e.length&&t&&t.length?Hn(e,t,aa(r,2)):e},Vr.pullAllWith=function(e,t,r){return e&&e.length&&t&&t.length?Hn(e,t,i,r):e},Vr.pullAt=Ja,Vr.range=hu,Vr.rangeRight=fu,Vr.rearg=Uo,Vr.reject=function(e,t){return(Ho(e)?It:pn)(e,Po(aa(t,3)))},Vr.remove=function(e,t){var r=[];if(!e||!e.length)return r;var n=-1,i=[],a=e.length;for(t=aa(t,3);++n<a;){var o=e[n];t(o,n,e)&&(r.push(o),i.push(n))}return jn(e,i),r},Vr.rest=function(e,t){if("function"!=typeof e)throw new Re(a);return qn(e,t=t===i?t:fs(t))},Vr.reverse=$a,Vr.sampleSize=function(e,t,r){return t=(r?ga(e,t,r):t===i)?1:fs(t),(Ho(e)?Xr:Xn)(e,t)},Vr.set=function(e,t,r){return null==e?e:Qn(e,t,r)},Vr.setWith=function(e,t,r,n){return n="function"==typeof n?n:i,null==e?e:Qn(e,t,r,n)},Vr.shuffle=function(e){return(Ho(e)?Qr:Zn)(e)},Vr.slice=function(e,t,r){var n=null==e?0:e.length;return n?(r&&"number"!=typeof r&&ga(e,t,r)?(t=0,r=n):(t=null==t?0:fs(t),r=r===i?n:fs(r)),ei(e,t,r)):[]},Vr.sortBy=ko,Vr.sortedUniq=function(e){return e&&e.length?ii(e):[]},Vr.sortedUniqBy=function(e,t){return e&&e.length?ii(e,aa(t,2)):[]},Vr.split=function(e,t,r){return r&&"number"!=typeof r&&ga(e,t,r)&&(t=r=i),(r=r===i?f:r>>>0)?(e=ms(e))&&("string"==typeof t||null!=t&&!is(t))&&!(t=oi(t))&&ir(e)?yi(dr(e),0,r):e.split(t,r):[]},Vr.spread=function(e,t){if("function"!=typeof e)throw new Re(a);return t=null==t?0:vr(fs(t),0),qn((function(r){var n=r[t],i=yi(r,0,t);return n&&xt(i,n),kt(e,this,i)}))},Vr.tail=function(e){var t=null==e?0:e.length;return t?ei(e,1,t):[]},Vr.take=function(e,t,r){return e&&e.length?ei(e,0,(t=r||t===i?1:fs(t))<0?0:t):[]},Vr.takeRight=function(e,t,r){var n=null==e?0:e.length;return n?ei(e,(t=n-(t=r||t===i?1:fs(t)))<0?0:t,n):[]},Vr.takeRightWhile=function(e,t){return e&&e.length?di(e,aa(t,3),!1,!0):[]},Vr.takeWhile=function(e,t){return e&&e.length?di(e,aa(t,3)):[]},Vr.tap=function(e,t){return t(e),e},Vr.throttle=function(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new Re(a);return Zo(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),Do(e,t,{leading:n,maxWait:t,trailing:i})},Vr.thru=ho,Vr.toArray=ls,Vr.toPairs=Vs,Vr.toPairsIn=Us,Vr.toPath=function(e){return Ho(e)?Ot(e,La):ss(e)?[e]:wi(Pa(ms(e)))},Vr.toPlainObject=gs,Vr.transform=function(e,t,r){var n=Ho(e),i=n||qo(e)||us(e);if(t=aa(t,4),null==r){var a=e&&e.constructor;r=i?n?new a:[]:Zo(e)&&Qo(a)?Ur(Ke(e)):{}}return(i?wt:yn)(e,(function(e,n,i){return t(r,e,n,i)})),r},Vr.unary=function(e){return wo(e,1)},Vr.union=Za,Vr.unionBy=eo,Vr.unionWith=to,Vr.uniq=function(e){return e&&e.length?si(e):[]},Vr.uniqBy=function(e,t){return e&&e.length?si(e,aa(t,2)):[]},Vr.uniqWith=function(e,t){return t="function"==typeof t?t:i,e&&e.length?si(e,i,t):[]},Vr.unset=function(e,t){return null==e||ui(e,t)},Vr.unzip=ro,Vr.unzipWith=no,Vr.update=function(e,t,r){return null==e?e:ci(e,t,vi(r))},Vr.updateWith=function(e,t,r,n){return n="function"==typeof n?n:i,null==e?e:ci(e,t,vi(r),n)},Vr.values=Fs,Vr.valuesIn=function(e){return null==e?[]:Jt(e,Ms(e))},Vr.without=io,Vr.words=Qs,Vr.wrap=function(e,t){return No(vi(t),e)},Vr.xor=ao,Vr.xorBy=oo,Vr.xorWith=so,Vr.zip=uo,Vr.zipObject=function(e,t){return fi(e||[],t||[],$r)},Vr.zipObjectDeep=function(e,t){return fi(e||[],t||[],Qn)},Vr.zipWith=co,Vr.entries=Vs,Vr.entriesIn=Us,Vr.extend=_s,Vr.extendWith=Ss,ou(Vr,Vr),Vr.add=mu,Vr.attempt=Js,Vr.camelCase=Bs,Vr.capitalize=Ws,Vr.ceil=yu,Vr.clamp=function(e,t,r){return r===i&&(r=t,t=i),r!==i&&(r=(r=vs(r))==r?r:0),t!==i&&(t=(t=vs(t))==t?t:0),an(vs(e),t,r)},Vr.clone=function(e){return on(e,4)},Vr.cloneDeep=function(e){return on(e,5)},Vr.cloneDeepWith=function(e,t){return on(e,5,t="function"==typeof t?t:i)},Vr.cloneWith=function(e,t){return on(e,4,t="function"==typeof t?t:i)},Vr.conformsTo=function(e,t){return null==t||sn(e,t,Ds(t))},Vr.deburr=Gs,Vr.defaultTo=function(e,t){return null==e||e!=e?t:e},Vr.divide=_u,Vr.endsWith=function(e,t,r){e=ms(e),t=oi(t);var n=e.length,a=r=r===i?n:an(fs(r),0,n);return(r-=t.length)>=0&&e.slice(r,a)==t},Vr.eq=Fo,Vr.escape=function(e){return(e=ms(e))&&X.test(e)?e.replace(q,rr):e},Vr.escapeRegExp=function(e){return(e=ms(e))&&ne.test(e)?e.replace(re,"\\$&"):e},Vr.every=function(e,t,r){var n=Ho(e)?Rt:hn;return r&&ga(e,t,r)&&(t=i),n(e,aa(t,3))},Vr.find=vo,Vr.findIndex=Wa,Vr.findKey=function(e,t){return Ut(e,aa(t,3),yn)},Vr.findLast=go,Vr.findLastIndex=Ga,Vr.findLastKey=function(e,t){return Ut(e,aa(t,3),_n)},Vr.floor=Su,Vr.forEach=mo,Vr.forEachRight=yo,Vr.forIn=function(e,t){return null==e?e:gn(e,aa(t,3),Ms)},Vr.forInRight=function(e,t){return null==e?e:mn(e,aa(t,3),Ms)},Vr.forOwn=function(e,t){return e&&yn(e,aa(t,3))},Vr.forOwnRight=function(e,t){return e&&_n(e,aa(t,3))},Vr.get=Cs,Vr.gt=Bo,Vr.gte=Wo,Vr.has=function(e,t){return null!=e&&ha(e,t,Cn)},Vr.hasIn=ws,Vr.head=ja,Vr.identity=ru,Vr.includes=function(e,t,r,n){e=Ko(e)?e:Fs(e),r=r&&!n?fs(r):0;var i=e.length;return r<0&&(r=vr(i+r,0)),os(e)?r<=i&&e.indexOf(t,r)>-1:!!i&&Bt(e,t,r)>-1},Vr.indexOf=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=null==r?0:fs(r);return i<0&&(i=vr(n+i,0)),Bt(e,t,i)},Vr.inRange=function(e,t,r){return t=hs(t),r===i?(r=t,t=0):r=hs(r),(n=e=vs(e))>=gr(a=t,o=r)&&n<vr(a,o);var n,a,o},Vr.invoke=Is,Vr.isArguments=Go,Vr.isArray=Ho,Vr.isArrayBuffer=jo,Vr.isArrayLike=Ko,Vr.isArrayLikeObject=zo,Vr.isBoolean=function(e){return!0===e||!1===e||es(e)&&En(e)==m},Vr.isBuffer=qo,Vr.isDate=Yo,Vr.isElement=function(e){return es(e)&&1===e.nodeType&&!ns(e)},Vr.isEmpty=function(e){if(null==e)return!0;if(Ko(e)&&(Ho(e)||"string"==typeof e||"function"==typeof e.splice||qo(e)||us(e)||Go(e)))return!e.length;var t=la(e);if(t==b||t==T)return!e.size;if(Sa(e))return!Pn(e).length;for(var r in e)if(Pe.call(e,r))return!1;return!0},Vr.isEqual=function(e,t){return Dn(e,t)},Vr.isEqualWith=function(e,t,r){var n=(r="function"==typeof r?r:i)?r(e,t):i;return n===i?Dn(e,t,i,r):!!n},Vr.isError=Xo,Vr.isFinite=function(e){return"number"==typeof e&&Vt(e)},Vr.isFunction=Qo,Vr.isInteger=Jo,Vr.isLength=$o,Vr.isMap=ts,Vr.isMatch=function(e,t){return e===t||Mn(e,t,sa(t))},Vr.isMatchWith=function(e,t,r){return r="function"==typeof r?r:i,Mn(e,t,sa(t),r)},Vr.isNaN=function(e){return rs(e)&&e!=+e},Vr.isNative=function(e){if(_a(e))throw new be("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return On(e)},Vr.isNil=function(e){return null==e},Vr.isNull=function(e){return null===e},Vr.isNumber=rs,Vr.isObject=Zo,Vr.isObjectLike=es,Vr.isPlainObject=ns,Vr.isRegExp=is,Vr.isSafeInteger=function(e){return Jo(e)&&e>=-9007199254740991&&e<=l},Vr.isSet=as,Vr.isString=os,Vr.isSymbol=ss,Vr.isTypedArray=us,Vr.isUndefined=function(e){return e===i},Vr.isWeakMap=function(e){return es(e)&&la(e)==D},Vr.isWeakSet=function(e){return es(e)&&"[object WeakSet]"==En(e)},Vr.join=function(e,t){return null==e?"":Kt.call(e,t)},Vr.kebabCase=Hs,Vr.last=Ya,Vr.lastIndexOf=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var a=n;return r!==i&&(a=(a=fs(r))<0?vr(n+a,0):gr(a,n-1)),t==t?function(e,t,r){for(var n=r+1;n--;)if(e[n]===t)return n;return n}(e,t,a):Ft(e,Gt,a,!0)},Vr.lowerCase=js,Vr.lowerFirst=Ks,Vr.lt=cs,Vr.lte=ds,Vr.max=function(e){return e&&e.length?fn(e,ru,kn):i},Vr.maxBy=function(e,t){return e&&e.length?fn(e,aa(t,2),kn):i},Vr.mean=function(e){return Ht(e,ru)},Vr.meanBy=function(e,t){return Ht(e,aa(t,2))},Vr.min=function(e){return e&&e.length?fn(e,ru,Ln):i},Vr.minBy=function(e,t){return e&&e.length?fn(e,aa(t,2),Ln):i},Vr.stubArray=pu,Vr.stubFalse=vu,Vr.stubObject=function(){return{}},Vr.stubString=function(){return""},Vr.stubTrue=function(){return!0},Vr.multiply=Au,Vr.nth=function(e,t){return e&&e.length?Bn(e,fs(t)):i},Vr.noConflict=function(){return ht._===this&&(ht._=Fe),this},Vr.noop=su,Vr.now=Co,Vr.pad=function(e,t,r){e=ms(e);var n=(t=fs(t))?cr(e):0;if(!t||n>=t)return e;var i=(t-n)/2;return Wi(pt(i),r)+e+Wi(ft(i),r)},Vr.padEnd=function(e,t,r){e=ms(e);var n=(t=fs(t))?cr(e):0;return t&&n<t?e+Wi(t-n,r):e},Vr.padStart=function(e,t,r){e=ms(e);var n=(t=fs(t))?cr(e):0;return t&&n<t?Wi(t-n,r)+e:e},Vr.parseInt=function(e,t,r){return r||null==t?t=0:t&&(t=+t),yr(ms(e).replace(ie,""),t||0)},Vr.random=function(e,t,r){if(r&&"boolean"!=typeof r&&ga(e,t,r)&&(t=r=i),r===i&&("boolean"==typeof t?(r=t,t=i):"boolean"==typeof e&&(r=e,e=i)),e===i&&t===i?(e=0,t=1):(e=hs(e),t===i?(t=e,e=0):t=hs(t)),e>t){var n=e;e=t,t=n}if(r||e%1||t%1){var a=_r();return gr(e+a*(t-e+ut("1e-"+((a+"").length-1))),t)}return Kn(e,t)},Vr.reduce=function(e,t,r){var n=Ho(e)?Pt:zt,i=arguments.length<3;return n(e,aa(t,4),r,i,dn)},Vr.reduceRight=function(e,t,r){var n=Ho(e)?Lt:zt,i=arguments.length<3;return n(e,aa(t,4),r,i,ln)},Vr.repeat=function(e,t,r){return t=(r?ga(e,t,r):t===i)?1:fs(t),zn(ms(e),t)},Vr.replace=function(){var e=arguments,t=ms(e[0]);return e.length<3?t:t.replace(e[1],e[2])},Vr.result=function(e,t,r){var n=-1,a=(t=gi(t,e)).length;for(a||(a=1,e=i);++n<a;){var o=null==e?i:e[La(t[n])];o===i&&(n=a,o=r),e=Qo(o)?o.call(e):o}return e},Vr.round=bu,Vr.runInContext=e,Vr.sample=function(e){return(Ho(e)?Yr:Yn)(e)},Vr.size=function(e){if(null==e)return 0;if(Ko(e))return os(e)?cr(e):e.length;var t=la(e);return t==b||t==T?e.size:Pn(e).length},Vr.snakeCase=zs,Vr.some=function(e,t,r){var n=Ho(e)?Nt:ti;return r&&ga(e,t,r)&&(t=i),n(e,aa(t,3))},Vr.sortedIndex=function(e,t){return ri(e,t)},Vr.sortedIndexBy=function(e,t,r){return ni(e,t,aa(r,2))},Vr.sortedIndexOf=function(e,t){var r=null==e?0:e.length;if(r){var n=ri(e,t);if(n<r&&Fo(e[n],t))return n}return-1},Vr.sortedLastIndex=function(e,t){return ri(e,t,!0)},Vr.sortedLastIndexBy=function(e,t,r){return ni(e,t,aa(r,2),!0)},Vr.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var r=ri(e,t,!0)-1;if(Fo(e[r],t))return r}return-1},Vr.startCase=qs,Vr.startsWith=function(e,t,r){return e=ms(e),r=null==r?0:an(fs(r),0,e.length),t=oi(t),e.slice(r,r+t.length)==t},Vr.subtract=Eu,Vr.sum=function(e){return e&&e.length?qt(e,ru):0},Vr.sumBy=function(e,t){return e&&e.length?qt(e,aa(t,2)):0},Vr.template=function(e,t,r){var n=Vr.templateSettings;r&&ga(e,t,r)&&(t=i),e=ms(e),t=Ss({},t,n,Xi);var a,o,s=Ss({},t.imports,n.imports,Xi),u=Ds(s),c=Jt(s,u),d=0,l=t.interpolate||Se,h="__p += '",f=we((t.escape||Se).source+"|"+l.source+"|"+(l===$?he:Se).source+"|"+(t.evaluate||Se).source+"|$","g"),p="//# sourceURL="+(Pe.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++it+"]")+"\n";e.replace(f,(function(t,r,n,i,s,u){return n||(n=i),h+=e.slice(d,u).replace(Ae,nr),r&&(a=!0,h+="' +\n__e("+r+") +\n'"),s&&(o=!0,h+="';\n"+s+";\n__p += '"),n&&(h+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),d=u+t.length,t})),h+="';\n";var v=Pe.call(t,"variable")&&t.variable;if(v){if(de.test(v))throw new be("Invalid `variable` option passed into `_.template`")}else h="with (obj) {\n"+h+"\n}\n";h=(o?h.replace(G,""):h).replace(H,"$1").replace(K,"$1;"),h="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(a?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var g=Js((function(){return Ee(u,p+"return "+h).apply(i,c)}));if(g.source=h,Xo(g))throw g;return g},Vr.times=function(e,t){if((e=fs(e))<1||e>l)return[];var r=f,n=gr(e,f);t=aa(t),e-=f;for(var i=Yt(n,t);++r<e;)t(r);return i},Vr.toFinite=hs,Vr.toInteger=fs,Vr.toLength=ps,Vr.toLower=function(e){return ms(e).toLowerCase()},Vr.toNumber=vs,Vr.toSafeInteger=function(e){return e?an(fs(e),-9007199254740991,l):0===e?e:0},Vr.toString=ms,Vr.toUpper=function(e){return ms(e).toUpperCase()},Vr.trim=function(e,t,r){if((e=ms(e))&&(r||t===i))return Xt(e);if(!e||!(t=oi(t)))return e;var n=dr(e),a=dr(t);return yi(n,Zt(n,a),er(n,a)+1).join("")},Vr.trimEnd=function(e,t,r){if((e=ms(e))&&(r||t===i))return e.slice(0,lr(e)+1);if(!e||!(t=oi(t)))return e;var n=dr(e);return yi(n,0,er(n,dr(t))+1).join("")},Vr.trimStart=function(e,t,r){if((e=ms(e))&&(r||t===i))return e.replace(ie,"");if(!e||!(t=oi(t)))return e;var n=dr(e);return yi(n,Zt(n,dr(t))).join("")},Vr.truncate=function(e,t){var r=30,n="...";if(Zo(t)){var a="separator"in t?t.separator:a;r="length"in t?fs(t.length):r,n="omission"in t?oi(t.omission):n}var o=(e=ms(e)).length;if(ir(e)){var s=dr(e);o=s.length}if(r>=o)return e;var u=r-cr(n);if(u<1)return n;var c=s?yi(s,0,u).join(""):e.slice(0,u);if(a===i)return c+n;if(s&&(u+=c.length-u),is(a)){if(e.slice(u).search(a)){var d,l=c;for(a.global||(a=we(a.source,ms(fe.exec(a))+"g")),a.lastIndex=0;d=a.exec(l);)var h=d.index;c=c.slice(0,h===i?u:h)}}else if(e.indexOf(oi(a),u)!=u){var f=c.lastIndexOf(a);f>-1&&(c=c.slice(0,f))}return c+n},Vr.unescape=function(e){return(e=ms(e))&&Y.test(e)?e.replace(z,hr):e},Vr.uniqueId=function(e){var t=++Le;return ms(e)+t},Vr.upperCase=Ys,Vr.upperFirst=Xs,Vr.each=mo,Vr.eachRight=yo,Vr.first=ja,ou(Vr,(gu={},yn(Vr,(function(e,t){Pe.call(Vr.prototype,t)||(gu[t]=e)})),gu),{chain:!1}),Vr.VERSION="4.17.21",wt(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){Vr[e].placeholder=Vr})),wt(["drop","take"],(function(e,t){Wr.prototype[e]=function(r){r=r===i?1:vr(fs(r),0);var n=this.__filtered__&&!t?new Wr(this):this.clone();return n.__filtered__?n.__takeCount__=gr(r,n.__takeCount__):n.__views__.push({size:gr(r,f),type:e+(n.__dir__<0?"Right":"")}),n},Wr.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),wt(["filter","map","takeWhile"],(function(e,t){var r=t+1,n=1==r||3==r;Wr.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:aa(e,3),type:r}),t.__filtered__=t.__filtered__||n,t}})),wt(["head","last"],(function(e,t){var r="take"+(t?"Right":"");Wr.prototype[e]=function(){return this[r](1).value()[0]}})),wt(["initial","tail"],(function(e,t){var r="drop"+(t?"":"Right");Wr.prototype[e]=function(){return this.__filtered__?new Wr(this):this[r](1)}})),Wr.prototype.compact=function(){return this.filter(ru)},Wr.prototype.find=function(e){return this.filter(e).head()},Wr.prototype.findLast=function(e){return this.reverse().find(e)},Wr.prototype.invokeMap=qn((function(e,t){return"function"==typeof e?new Wr(this):this.map((function(r){return Rn(r,e,t)}))})),Wr.prototype.reject=function(e){return this.filter(Po(aa(e)))},Wr.prototype.slice=function(e,t){e=fs(e);var r=this;return r.__filtered__&&(e>0||t<0)?new Wr(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),t!==i&&(r=(t=fs(t))<0?r.dropRight(-t):r.take(t-e)),r)},Wr.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Wr.prototype.toArray=function(){return this.take(f)},yn(Wr.prototype,(function(e,t){var r=/^(?:filter|find|map|reject)|While$/.test(t),n=/^(?:head|last)$/.test(t),a=Vr[n?"take"+("last"==t?"Right":""):t],o=n||/^find/.test(t);a&&(Vr.prototype[t]=function(){var t=this.__wrapped__,s=n?[1]:arguments,u=t instanceof Wr,c=s[0],d=u||Ho(t),l=function(e){var t=a.apply(Vr,xt([e],s));return n&&h?t[0]:t};d&&r&&"function"==typeof c&&1!=c.length&&(u=d=!1);var h=this.__chain__,f=!!this.__actions__.length,p=o&&!h,v=u&&!f;if(!o&&d){t=v?t:new Wr(this);var g=e.apply(t,s);return g.__actions__.push({func:ho,args:[l],thisArg:i}),new Br(g,h)}return p&&v?e.apply(this,s):(g=this.thru(l),p?n?g.value()[0]:g.value():g)})})),wt(["pop","push","shift","sort","splice","unshift"],(function(e){var t=Ie[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:pop|shift)$/.test(e);Vr.prototype[e]=function(){var e=arguments;if(n&&!this.__chain__){var i=this.value();return t.apply(Ho(i)?i:[],e)}return this[r]((function(r){return t.apply(Ho(r)?r:[],e)}))}})),yn(Wr.prototype,(function(e,t){var r=Vr[t];if(r){var n=r.name+"";Pe.call(Rr,n)||(Rr[n]=[]),Rr[n].push({name:t,func:r})}})),Rr[Vi(i,2).name]=[{name:"wrapper",func:i}],Wr.prototype.clone=function(){var e=new Wr(this.__wrapped__);return e.__actions__=wi(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=wi(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=wi(this.__views__),e},Wr.prototype.reverse=function(){if(this.__filtered__){var e=new Wr(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Wr.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,r=Ho(e),n=t<0,i=r?e.length:0,a=function(e,t,r){for(var n=-1,i=r.length;++n<i;){var a=r[n],o=a.size;switch(a.type){case"drop":e+=o;break;case"dropRight":t-=o;break;case"take":t=gr(t,e+o);break;case"takeRight":e=vr(e,t-o)}}return{start:e,end:t}}(0,i,this.__views__),o=a.start,s=a.end,u=s-o,c=n?s:o-1,d=this.__iteratees__,l=d.length,h=0,f=gr(u,this.__takeCount__);if(!r||!n&&i==u&&f==u)return li(e,this.__actions__);var p=[];e:for(;u--&&h<f;){for(var v=-1,g=e[c+=t];++v<l;){var m=d[v],y=m.iteratee,_=m.type,S=y(g);if(2==_)g=S;else if(!S){if(1==_)continue e;break e}}p[h++]=g}return p},Vr.prototype.at=fo,Vr.prototype.chain=function(){return lo(this)},Vr.prototype.commit=function(){return new Br(this.value(),this.__chain__)},Vr.prototype.next=function(){this.__values__===i&&(this.__values__=ls(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?i:this.__values__[this.__index__++]}},Vr.prototype.plant=function(e){for(var t,r=this;r instanceof Fr;){var n=Va(r);n.__index__=0,n.__values__=i,t?a.__wrapped__=n:t=n;var a=n;r=r.__wrapped__}return a.__wrapped__=e,t},Vr.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Wr){var t=e;return this.__actions__.length&&(t=new Wr(this)),(t=t.reverse()).__actions__.push({func:ho,args:[$a],thisArg:i}),new Br(t,this.__chain__)}return this.thru($a)},Vr.prototype.toJSON=Vr.prototype.valueOf=Vr.prototype.value=function(){return li(this.__wrapped__,this.__actions__)},Vr.prototype.first=Vr.prototype.head,Qe&&(Vr.prototype[Qe]=function(){return this}),Vr}();ht._=fr,(n=function(){return fr}.call(t,r,t,e))===i||(e.exports=n)}.call(this)},124:function(e,t,r){var n=r(9325);e.exports=function(){return n.Date.now()}},9935:function(e){e.exports=function(){return!1}},7350:function(e,t,r){var n=r(8221),i=r(3805);e.exports=function(e,t,r){var a=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return i(r)&&(a="leading"in r?!!r.leading:a,o="trailing"in r?!!r.trailing:o),n(e,t,{leading:a,maxWait:t,trailing:o})}},9374:function(e,t,r){var n=r(4128),i=r(3805),a=r(4394),o=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,u=/^0o[0-7]+$/i,c=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(a(e))return NaN;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=n(e);var r=s.test(e);return r||u.test(e)?c(e.slice(2),r?2:8):o.test(e)?NaN:+e}},3224:function(e,t,r){var n,i;e=r.nmd(e),i={},(n="object"==("undefined"==typeof window?"undefined":j(window))&&window||this||r.g).PubSub?(i=n.PubSub,console.warn("PubSub already loaded, using existing version")):(n.PubSub=i,function(e){var t={},r=-1;function n(e,t,r){try{e(t,r)}catch(e){setTimeout((n=e,function(){throw n}),0)}var n}function i(e,t,r){e(t,r)}function a(e,r,a,o){var s,u=t[r],c=o?i:n;if(Object.prototype.hasOwnProperty.call(t,r))for(s in u)Object.prototype.hasOwnProperty.call(u,s)&&c(u[s],e,a)}function o(e){var r=String(e);return Boolean(Object.prototype.hasOwnProperty.call(t,r)&&function(e){var t;for(t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!0;return!1}(t[r]))}function s(e,t,r,n){var i,s,u,c=(i=e="symbol"==j(e)?e.toString():e,s=t,u=n,function(){var e=String(i),t=e.lastIndexOf(".");for(a(i,i,s,u);-1!==t;)t=(e=e.substr(0,t)).lastIndexOf("."),a(i,e,s,u);a(i,"*",s,u)});return!!function(e){for(var t=String(e),r=o(t)||o("*"),n=t.lastIndexOf(".");!r&&-1!==n;)n=(t=t.substr(0,n)).lastIndexOf("."),r=o(t);return r}(e)&&(!0===r?c():setTimeout(c,0),!0)}e.publish=function(t,r){return s(t,r,!1,e.immediateExceptions)},e.publishSync=function(t,r){return s(t,r,!0,e.immediateExceptions)},e.subscribe=function(e,n){if("function"!=typeof n)return!1;e="symbol"==j(e)?e.toString():e,Object.prototype.hasOwnProperty.call(t,e)||(t[e]={});var i="uid_"+String(++r);return t[e][i]=n,i},e.subscribeAll=function(t){return e.subscribe("*",t)},e.subscribeOnce=function(t,r){var n=e.subscribe(t,(function(){e.unsubscribe(n),r.apply(this,arguments)}));return e},e.clearAllSubscriptions=function(){t={}},e.clearSubscriptions=function(e){var r;for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&0===r.indexOf(e)&&delete t[r]},e.countSubscriptions=function(e){var r,n,i=0;for(r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&0===r.indexOf(e)){for(n in t[r])i++;break}return i},e.getSubscriptions=function(e){var r,n=[];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&0===r.indexOf(e)&&n.push(r);return n},e.unsubscribe=function(r){var n,i,a,o="string"==typeof r&&(Object.prototype.hasOwnProperty.call(t,r)||function(e){var r;for(r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&0===r.indexOf(e))return!0;return!1}(r)),s=!o&&"string"==typeof r,u="function"==typeof r,c=!1;if(!o){for(n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(i=t[n],s&&i[r]){delete i[r],c=r;break}if(u)for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&i[a]===r&&(delete i[a],c=!0)}return c}e.clearSubscriptions(r)}}(i)),void 0!==e&&e.exports&&(t=e.exports=i),t.PubSub=i,e.exports=t=i},31:function(e,t){!function(e){var t,r,n,i=String.fromCharCode;function a(e){for(var t,r,n=[],i=0,a=e.length;i<a;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<a?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function o(e){if(e>=55296&&e<=57343)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function s(e,t){return i(e>>t&63|128)}function u(e){if(!(4294967168&e))return i(e);var t="";return 4294965248&e?4294901760&e?4292870144&e||(t=i(e>>18&7|240),t+=s(e,12),t+=s(e,6)):(o(e),t=i(e>>12&15|224),t+=s(e,6)):t=i(e>>6&31|192),t+i(63&e|128)}function c(){if(n>=r)throw Error("Invalid byte index");var e=255&t[n];if(n++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function d(){var e,i;if(n>r)throw Error("Invalid byte index");if(n==r)return!1;if(e=255&t[n],n++,!(128&e))return e;if(192==(224&e)){if((i=(31&e)<<6|c())>=128)return i;throw Error("Invalid continuation byte")}if(224==(240&e)){if((i=(15&e)<<12|c()<<6|c())>=2048)return o(i),i;throw Error("Invalid continuation byte")}if(240==(248&e)&&(i=(7&e)<<18|c()<<12|c()<<6|c())>=65536&&i<=1114111)return i;throw Error("Invalid UTF-8 detected")}e.version="3.0.0",e.encode=function(e){for(var t=a(e),r=t.length,n=-1,i="";++n<r;)i+=u(t[n]);return i},e.decode=function(e){t=a(e),r=t.length,n=0;for(var o,s=[];!1!==(o=d());)s.push(o);return function(e){for(var t,r=e.length,n=-1,a="";++n<r;)(t=e[n])>65535&&(a+=i((t-=65536)>>>10&1023|55296),t=56320|1023&t),a+=i(t);return a}(s)}}(t)},5512:function(e){e.exports=function(e,t,r,n){var i=self||window;try{try{var a;try{a=new i.Blob([e])}catch(t){(a=new(i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder)).append(e),a=a.getBlob()}var o=i.URL||i.webkitURL,s=o.createObjectURL(a),u=new i[t](s,r);return o.revokeObjectURL(s),u}catch(n){return new i[t]("data:application/javascript,".concat(encodeURIComponent(e)),r)}}catch(e){if(!n)throw Error("Inline worker is not supported");return new i[t](n,r)}}},6206:function(e){e.exports=h},7855:function(e,t,r){e.exports=r(4106)},129:function(e,t,r){e.exports=r(1086)},1265:function(e,t,r){e.exports=r(4598)},6984:function(e,t,r){e.exports=r(9792)},2601:function(e,t,r){e.exports=r(4444)},7201:function(e,t,r){e.exports=r(3042)},3565:function(e,t,r){var n=r(1960);e.exports=n},7358:function(e,t,r){var n=r(6343);e.exports=n},1829:function(e,t,r){var n=r(2222);e.exports=n},6040:function(e,t,r){var n=r(8251);e.exports=n},7382:function(e,t,r){var n=r(9563);e.exports=n},7264:function(e,t,r){var n=r(4139);r(768),r(8549),r(7152),r(1372),e.exports=n},9692:function(e,t,r){var n=r(7045);e.exports=n},5663:function(e,t,r){var n=r(70);e.exports=n},1362:function(e,t,r){r(9748);var n=r(1747);e.exports=n("Array","includes")},6429:function(e,t,r){r(8559);var n=r(1747);e.exports=n("Array","reverse")},1263:function(e,t,r){r(6737);var n=r(1747);e.exports=n("Array","sort")},2671:function(e,t,r){r(2344),e.exports=r(5951)},6880:function(e,t,r){var n=r(8280),i=r(1362),a=r(4378),o=Array.prototype,s=String.prototype;e.exports=function(e){var t=e.includes;return e===o||n(o,e)&&t===o.includes?i:"string"==typeof e||e===s||n(s,e)&&t===s.includes?a:t}},6823:function(e,t,r){var n=r(8280),i=r(2017),a=String.prototype;e.exports=function(e){var t=e.replaceAll;return"string"==typeof e||e===a||n(a,e)&&t===a.replaceAll?i:t}},8059:function(e,t,r){var n=r(8280),i=r(6429),a=Array.prototype;e.exports=function(e){var t=e.reverse;return e===a||n(a,e)&&t===a.reverse?i:t}},2757:function(e,t,r){var n=r(8280),i=r(1263),a=Array.prototype;e.exports=function(e){var t=e.sort;return e===a||n(a,e)&&t===a.sort?i:t}},1042:function(e,t,r){var n=r(8280),i=r(7511),a=String.prototype;e.exports=function(e){var t=e.trim;return"string"==typeof e||e===a||n(a,e)&&t===a.trim?i:t}},1926:function(e,t,r){r(6750);var n=r(2046).Object,i=e.exports=function(e,t,r){return n.defineProperty(e,t,r)};n.defineProperty.sham&&(i.sham=!0)},4776:function(e,t,r){r(4452);var n=r(2046);e.exports=n.Object.getOwnPropertySymbols},4378:function(e,t,r){r(9770);var n=r(1747);e.exports=n("String","includes")},2017:function(e,t,r){r(1398),r(1995),r(929);var n=r(1747);e.exports=n("String","replaceAll")},7511:function(e,t,r){r(727);var n=r(1747);e.exports=n("String","trim")},3842:function(e,t,r){r(8545),r(3643),r(4452),r(3997),r(5084),r(2596),r(5721),r(4954),r(4123),r(3377),r(2230),r(5344),r(1660),r(4610),r(3669),r(4810),r(3325),r(7024),r(8172),r(5205);var n=r(2046);e.exports=n.Symbol},1730:function(e,t,r){r(9363),r(3643),r(7057),r(4954);var n=r(560);e.exports=n.f("iterator")},1661:function(e,t,r){r(8537),r(3669);var n=r(560);e.exports=n.f("toPrimitive")},4444:function(e,t,r){e.exports=r(214)},3042:function(e,t,r){e.exports=r(9604)},214:function(e,t,r){r(397);var n=r(3565);e.exports=n},3901:function(e,t,r){var n=r(7358);e.exports=n},9604:function(e,t,r){r(6038);var n=r(1829);e.exports=n},4997:function(e,t,r){var n=r(6040);e.exports=n},913:function(e,t,r){var n=r(7382);e.exports=n},2321:function(e,t,r){var n=r(7264);r(3939),r(1785),r(1697),r(4664),r(3422),r(36),r(8703),r(6878),r(9671),r(359),e.exports=n},2231:function(e,t,r){var n=r(9692);e.exports=n},9280:function(e,t,r){var n=r(5663);e.exports=n},2159:function(e,t,r){var n=r(2250),i=r(4640),a=TypeError;e.exports=function(e){if(n(e))return e;throw new a(i(e)+" is not a function")}},43:function(e,t,r){var n=r(4018),i=String,a=TypeError;e.exports=function(e){if(n(e))return e;throw new a("Can't set "+i(e)+" as a prototype")}},2156:function(e){e.exports=function(){}},9596:function(e,t,r){var n=r(8280),i=TypeError;e.exports=function(e,t){if(n(t,e))return e;throw new i("Incorrect invocation")}},6624:function(e,t,r){var n=r(6285),i=String,a=TypeError;e.exports=function(e){if(n(e))return e;throw new a(i(e)+" is not an object")}},1229:function(e,t,r){var n=r(8311),i=r(3930),a=r(9298),o=r(6818),s=r(7812),u=r(5468),c=r(575),d=r(5543),l=r(300),h=r(3448),f=Array;e.exports=function(e){var t=a(e),r=u(this),p=arguments.length,v=p>1?arguments[1]:void 0,g=void 0!==v;g&&(v=n(v,p>2?arguments[2]:void 0));var m,y,_,S,A,b,E=h(t),k=0;if(!E||this===f&&s(E))for(m=c(t),y=r?new this(m):f(m);m>k;k++)b=g?v(t[k],k):t[k],d(y,k,b);else for(y=r?new this:[],A=(S=l(t,E)).next;!(_=i(A,S)).done;k++)b=g?o(S,v,[_.value,k],!0):_.value,d(y,k,b);return y.length=k,y}},4436:function(e,t,r){var n=r(7374),i=r(4849),a=r(575),o=function(e){return function(t,r,o){var s=n(t),u=a(s);if(0===u)return!e&&-1;var c,d=i(o,u);if(e&&r!=r){for(;u>d;)if((c=s[d++])!=c)return!0}else for(;u>d;d++)if((e||d in s)&&s[d]===r)return e||d||0;return!e&&-1}};e.exports={includes:o(!0),indexOf:o(!1)}},726:function(e,t,r){var n=r(8311),i=r(1907),a=r(6946),o=r(9298),s=r(575),u=r(6968),c=i([].push),d=function(e){var t=1===e,r=2===e,i=3===e,d=4===e,l=6===e,h=7===e,f=5===e||l;return function(p,v,g,m){for(var y,_,S=o(p),A=a(S),b=s(A),E=n(v,g),k=0,C=m||u,w=t?C(p,b):r||h?C(p,0):void 0;b>k;k++)if((f||k in A)&&(_=E(y=A[k],k,S),e))if(t)w[k]=_;else if(_)switch(e){case 3:return!0;case 5:return y;case 6:return k;case 2:c(w,y)}else switch(e){case 4:return!1;case 7:c(w,y)}return l?-1:i||d?d:w}};e.exports={forEach:d(0),map:d(1),filter:d(2),some:d(3),every:d(4),find:d(5),findIndex:d(6),filterReject:d(7)}},7171:function(e,t,r){var n=r(8828),i=r(6264),a=r(798),o=i("species");e.exports=function(e){return a>=51||!n((function(){var t=[];return(t.constructor={})[o]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},7623:function(e,t,r){var n=r(8828);e.exports=function(e,t){var r=[][e];return!!r&&n((function(){r.call(null,t||function(){return 1},1)}))}},3427:function(e,t,r){var n=r(1907);e.exports=n([].slice)},4321:function(e,t,r){var n=r(3427),i=Math.floor,a=function(e,t){var r=e.length;if(r<8)for(var o,s,u=1;u<r;){for(s=u,o=e[u];s&&t(e[s-1],o)>0;)e[s]=e[--s];s!==u++&&(e[s]=o)}else for(var c=i(r/2),d=a(n(e,0,c),t),l=a(n(e,c),t),h=d.length,f=l.length,p=0,v=0;p<h||v<f;)e[p+v]=p<h&&v<f?t(d[p],l[v])<=0?d[p++]:l[v++]:p<h?d[p++]:l[v++];return e};e.exports=a},4010:function(e,t,r){var n=r(1793),i=r(5468),a=r(6285),o=r(6264)("species"),s=Array;e.exports=function(e){var t;return n(e)&&(t=e.constructor,(i(t)&&(t===s||n(t.prototype))||a(t)&&null===(t=t[o]))&&(t=void 0)),void 0===t?s:t}},6968:function(e,t,r){var n=r(4010);e.exports=function(e,t){return new(n(e))(0===t?0:t)}},6818:function(e,t,r){var n=r(6624),i=r(154);e.exports=function(e,t,r,a){try{return a?t(n(r)[0],r[1]):t(r)}catch(t){i(e,"throw",t)}}},5807:function(e,t,r){var n=r(1907),i=n({}.toString),a=n("".slice);e.exports=function(e){return a(i(e),8,-1)}},3948:function(e,t,r){var n=r(2623),i=r(2250),a=r(5807),o=r(6264)("toStringTag"),s=Object,u="Arguments"===a(function(){return arguments}());e.exports=n?a:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=s(e),o))?r:u?a(t):"Object"===(n=a(t))&&i(t.callee)?"Arguments":n}},5735:function(e,t,r){var n=r(6264)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,"/./"[e](t)}catch(e){}}return!1}},5001:function(e,t,r){var n=r(8828);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},9550:function(e){e.exports=function(e,t){return{value:e,done:t}}},1626:function(e,t,r){var n=r(9447),i=r(4284),a=r(5817);e.exports=n?function(e,t,r){return i.f(e,t,a(1,r))}:function(e,t,r){return e[t]=r,e}},5817:function(e){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},5543:function(e,t,r){var n=r(9447),i=r(4284),a=r(5817);e.exports=function(e,t,r){n?i.f(e,t,a(0,r)):e[t]=r}},9251:function(e,t,r){var n=r(4284);e.exports=function(e,t,r){return n.f(e,t,r)}},8055:function(e,t,r){var n=r(1626);e.exports=function(e,t,r,i){return i&&i.enumerable?e[t]=r:n(e,t,r),e}},2802:function(e,t,r){var n=r(8055);e.exports=function(e,t,r){for(var i in t)r&&r.unsafe&&e[i]?e[i]=t[i]:n(e,i,t[i],r);return e}},2532:function(e,t,r){var n=r(5951),i=Object.defineProperty;e.exports=function(e,t){try{i(n,e,{value:t,configurable:!0,writable:!0})}catch(r){n[e]=t}return t}},4535:function(e,t,r){var n=r(4640),i=TypeError;e.exports=function(e,t){if(!delete e[t])throw new i("Cannot delete property "+n(t)+" of "+n(e))}},9447:function(e,t,r){var n=r(8828);e.exports=!n((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},9552:function(e,t,r){var n=r(5951),i=r(6285),a=n.document,o=i(a)&&i(a.createElement);e.exports=function(e){return o?a.createElement(e):{}}},8024:function(e){var t=TypeError;e.exports=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}},9287:function(e){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},376:function(e){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},3440:function(e,t,r){var n=r(6794).match(/firefox\/(\d+)/i);e.exports=!!n&&+n[1]},4328:function(e,t,r){var n=r(6794);e.exports=/MSIE|Trident/.test(n)},6794:function(e,t,r){var n=r(5951).navigator,i=n&&n.userAgent;e.exports=i?String(i):""},798:function(e,t,r){var n,i,a=r(5951),o=r(6794),s=a.process,u=a.Deno,c=s&&s.versions||u&&u.version,d=c&&c.v8;d&&(i=(n=d.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!i&&o&&(!(n=o.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=o.match(/Chrome\/(\d+)/))&&(i=+n[1]),e.exports=i},3786:function(e,t,r){var n=r(6794).match(/AppleWebKit\/(\d+)\./);e.exports=!!n&&+n[1]},1091:function(e,t,r){var n=r(5951),i=r(6024),a=r(2361),o=r(2250),s=r(3846).f,u=r(7463),c=r(2046),d=r(8311),l=r(1626),h=r(9724);r(6128);var f=function(e){var t=function(r,n,a){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,n)}return new e(r,n,a)}return i(e,this,arguments)};return t.prototype=e.prototype,t};e.exports=function(e,t){var r,i,p,v,g,m,y,_,S,A=e.target,b=e.global,E=e.stat,k=e.proto,C=b?n:E?n[A]:n[A]&&n[A].prototype,w=b?c:c[A]||l(c,A,{})[A],T=w.prototype;for(v in t)i=!(r=u(b?v:A+(E?".":"#")+v,e.forced))&&C&&h(C,v),m=w[v],i&&(y=e.dontCallGetSet?(S=s(C,v))&&S.value:C[v]),g=i&&y?y:t[v],(r||k||j(m)!=j(g))&&(_=e.bind&&i?d(g,n):e.wrap&&i?f(g):k&&o(g)?a(g):g,(e.sham||g&&g.sham||m&&m.sham)&&l(_,"sham",!0),l(w,v,_),k&&(h(c,p=A+"Prototype")||l(c,p,{}),l(c[p],v,g),e.real&&T&&(r||!T[v])&&l(T,v,g)))}},8828:function(e){e.exports=function(e){try{return!!e()}catch(e){return!0}}},6024:function(e,t,r){var n=r(1505),i=Function.prototype,a=i.apply,o=i.call;e.exports="object"==("undefined"==typeof Reflect?"undefined":j(Reflect))&&Reflect.apply||(n?o.bind(a):function(){return o.apply(a,arguments)})},8311:function(e,t,r){var n=r(2361),i=r(2159),a=r(1505),o=n(n.bind);e.exports=function(e,t){return i(e),void 0===t?e:a?o(e,t):function(){return e.apply(t,arguments)}}},1505:function(e,t,r){var n=r(8828);e.exports=!n((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},3930:function(e,t,r){var n=r(1505),i=Function.prototype.call;e.exports=n?i.bind(i):function(){return i.apply(i,arguments)}},6833:function(e,t,r){var n=r(9447),i=r(9724),a=Function.prototype,o=n&&Object.getOwnPropertyDescriptor,s=i(a,"name"),u=s&&"something"===function(){}.name,c=s&&(!n||n&&o(a,"name").configurable);e.exports={EXISTS:s,PROPER:u,CONFIGURABLE:c}},1871:function(e,t,r){var n=r(1907),i=r(2159);e.exports=function(e,t,r){try{return n(i(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(e){}}},2361:function(e,t,r){var n=r(5807),i=r(1907);e.exports=function(e){if("Function"===n(e))return i(e)}},1907:function(e,t,r){var n=r(1505),i=Function.prototype,a=i.call,o=n&&i.bind.bind(a,a);e.exports=n?o:function(e){return function(){return a.apply(e,arguments)}}},1747:function(e,t,r){var n=r(5951),i=r(2046);e.exports=function(e,t){var r=i[e+"Prototype"],a=r&&r[t];if(a)return a;var o=n[e],s=o&&o.prototype;return s&&s[t]}},5582:function(e,t,r){var n=r(2046),i=r(5951),a=r(2250),o=function(e){return a(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?o(n[e])||o(i[e]):n[e]&&n[e][t]||i[e]&&i[e][t]}},3448:function(e,t,r){var n=r(3948),i=r(9367),a=r(7136),o=r(3742),s=r(6264)("iterator");e.exports=function(e){if(!a(e))return i(e,s)||i(e,"@@iterator")||o[n(e)]}},300:function(e,t,r){var n=r(3930),i=r(2159),a=r(6624),o=r(4640),s=r(3448),u=TypeError;e.exports=function(e,t){var r=arguments.length<2?s(e):t;if(i(r))return a(n(r,e));throw new u(o(e)+" is not iterable")}},6656:function(e,t,r){var n=r(1907),i=r(1793),a=r(2250),o=r(5807),s=r(160),u=n([].push);e.exports=function(e){if(a(e))return e;if(i(e)){for(var t=e.length,r=[],n=0;n<t;n++){var c=e[n];"string"==typeof c?u(r,c):"number"!=typeof c&&"Number"!==o(c)&&"String"!==o(c)||u(r,s(c))}var d=r.length,l=!0;return function(e,t){if(l)return l=!1,t;if(i(this))return t;for(var n=0;n<d;n++)if(r[n]===e)return t}}}},9367:function(e,t,r){var n=r(2159),i=r(7136);e.exports=function(e,t){var r=e[t];return i(r)?void 0:n(r)}},7703:function(e,t,r){var n=r(1907),i=r(9298),a=Math.floor,o=n("".charAt),s=n("".replace),u=n("".slice),c=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,d=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,r,n,l,h){var f=r+e.length,p=n.length,v=d;return void 0!==l&&(l=i(l),v=c),s(h,v,(function(i,s){var c;switch(o(s,0)){case"$":return"$";case"&":return e;case"`":return u(t,0,r);case"'":return u(t,f);case"<":c=l[u(s,1,-1)];break;default:var d=+s;if(0===d)return i;if(d>p){var h=a(d/10);return 0===h?i:h<=p?void 0===n[h-1]?o(s,1):n[h-1]+o(s,1):i}c=n[d-1]}return void 0===c?"":c}))}},5951:function(e,t,r){var n=function(e){return e&&e.Math===Math&&e};e.exports=n("object"==("undefined"==typeof globalThis?"undefined":j(globalThis))&&globalThis)||n("object"==("undefined"==typeof window?"undefined":j(window))&&window)||n("object"==("undefined"==typeof self?"undefined":j(self))&&self)||n("object"==j(r.g)&&r.g)||n("object"==j(this)&&this)||function(){return this}()||Function("return this")()},9724:function(e,t,r){var n=r(1907),i=r(9298),a=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return a(i(e),t)}},8530:function(e){e.exports={}},2416:function(e,t,r){var n=r(5582);e.exports=n("document","documentElement")},3648:function(e,t,r){var n=r(9447),i=r(8828),a=r(9552);e.exports=!n&&!i((function(){return 7!==Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}))},6946:function(e,t,r){var n=r(1907),i=r(8828),a=r(5807),o=Object,s=n("".split);e.exports=i((function(){return!o("z").propertyIsEnumerable(0)}))?function(e){return"String"===a(e)?s(e,""):o(e)}:o},2647:function(e,t,r){var n=r(1907),i=r(2250),a=r(6128),o=n(Function.toString);i(a.inspectSource)||(a.inspectSource=function(e){return o(e)}),e.exports=a.inspectSource},4932:function(e,t,r){var n,i,a,o=r(551),s=r(5951),u=r(6285),c=r(1626),d=r(9724),l=r(6128),h=r(2522),f=r(8530),p="Object already initialized",v=s.TypeError,g=s.WeakMap;if(o||l.state){var m=l.state||(l.state=new g);m.get=m.get,m.has=m.has,m.set=m.set,n=function(e,t){if(m.has(e))throw new v(p);return t.facade=e,m.set(e,t),t},i=function(e){return m.get(e)||{}},a=function(e){return m.has(e)}}else{var y=h("state");f[y]=!0,n=function(e,t){if(d(e,y))throw new v(p);return t.facade=e,c(e,y,t),t},i=function(e){return d(e,y)?e[y]:{}},a=function(e){return d(e,y)}}e.exports={set:n,get:i,has:a,enforce:function(e){return a(e)?i(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!u(t)||(r=i(t)).type!==e)throw new v("Incompatible receiver, "+e+" required");return r}}}},7812:function(e,t,r){var n=r(6264),i=r(3742),a=n("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||o[a]===e)}},1793:function(e,t,r){var n=r(5807);e.exports=Array.isArray||function(e){return"Array"===n(e)}},2250:function(e){var t="object"==("undefined"==typeof document?"undefined":j(document))&&document.all;e.exports=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},5468:function(e,t,r){var n=r(1907),i=r(8828),a=r(2250),o=r(3948),s=r(5582),u=r(2647),c=function(){},d=s("Reflect","construct"),l=/^\s*(?:class|function)\b/,h=n(l.exec),f=!l.test(c),p=function(e){if(!a(e))return!1;try{return d(c,[],e),!0}catch(e){return!1}},v=function(e){if(!a(e))return!1;switch(o(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return f||!!h(l,u(e))}catch(e){return!0}};v.sham=!0,e.exports=!d||i((function(){var e;return p(p.call)||!p(Object)||!p((function(){e=!0}))||e}))?v:p},7463:function(e,t,r){var n=r(8828),i=r(2250),a=/#|\.prototype\./,o=function(e,t){var r=u[s(e)];return r===d||r!==c&&(i(t)?n(t):!!t)},s=o.normalize=function(e){return String(e).replace(a,".").toLowerCase()},u=o.data={},c=o.NATIVE="N",d=o.POLYFILL="P";e.exports=o},7136:function(e){e.exports=function(e){return null==e}},6285:function(e,t,r){var n=r(2250);e.exports=function(e){return"object"==j(e)?null!==e:n(e)}},4018:function(e,t,r){var n=r(6285);e.exports=function(e){return n(e)||null===e}},7376:function(e){e.exports=!0},2087:function(e,t,r){var n=r(6285),i=r(5807),a=r(6264)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[a])?!!t:"RegExp"===i(e))}},5594:function(e,t,r){var n=r(5582),i=r(2250),a=r(8280),o=r(1175),s=Object;e.exports=o?function(e){return"symbol"==j(e)}:function(e){var t=n("Symbol");return i(t)&&a(t.prototype,s(e))}},154:function(e,t,r){var n=r(3930),i=r(6624),a=r(9367);e.exports=function(e,t,r){var o,s;i(e);try{if(!(o=a(e,"return"))){if("throw"===t)throw r;return r}o=n(o,e)}catch(e){s=!0,o=e}if("throw"===t)throw r;if(s)throw o;return i(o),r}},7181:function(e,t,r){var n=r(5116).IteratorPrototype,i=r(8075),a=r(5817),o=r(4840),s=r(3742),u=function(){return this};e.exports=function(e,t,r,c){var d=t+" Iterator";return e.prototype=i(n,{next:a(+!c,r)}),o(e,d,!1,!0),s[d]=u,e}},183:function(e,t,r){var n=r(1091),i=r(3930),a=r(7376),o=r(6833),s=r(2250),u=r(7181),c=r(5972),d=r(9192),l=r(4840),h=r(1626),f=r(8055),p=r(6264),v=r(3742),g=r(5116),m=o.PROPER,y=o.CONFIGURABLE,_=g.IteratorPrototype,S=g.BUGGY_SAFARI_ITERATORS,A=p("iterator"),b="keys",E="values",k="entries",C=function(){return this};e.exports=function(e,t,r,o,p,g,w){u(r,t,o);var T,R,I,D=function(e){if(e===p&&L)return L;if(!S&&e&&e in x)return x[e];switch(e){case b:case E:case k:return function(){return new r(this,e)}}return function(){return new r(this)}},M=t+" Iterator",O=!1,x=e.prototype,P=x[A]||x["@@iterator"]||p&&x[p],L=!S&&P||D(p),N="Array"===t&&x.entries||P;if(N&&(T=c(N.call(new e)))!==Object.prototype&&T.next&&(a||c(T)===_||(d?d(T,_):s(T[A])||f(T,A,C)),l(T,M,!0,!0),a&&(v[M]=C)),m&&p===E&&P&&P.name!==E&&(!a&&y?h(x,"name",E):(O=!0,L=function(){return i(P,this)})),p)if(R={values:D(E),keys:g?L:D(b),entries:D(k)},w)for(I in R)(S||O||!(I in x))&&f(x,I,R[I]);else n({target:t,proto:!0,forced:S||O},R);return a&&!w||x[A]===L||f(x,A,L,{name:p}),v[t]=L,R}},5116:function(e,t,r){var n,i,a,o=r(8828),s=r(2250),u=r(6285),c=r(8075),d=r(5972),l=r(8055),h=r(6264),f=r(7376),p=h("iterator"),v=!1;[].keys&&("next"in(a=[].keys())?(i=d(d(a)))!==Object.prototype&&(n=i):v=!0),!u(n)||o((function(){var e={};return n[p].call(e)!==e}))?n={}:f&&(n=c(n)),s(n[p])||l(n,p,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:v}},3742:function(e){e.exports={}},575:function(e,t,r){var n=r(3121);e.exports=function(e){return n(e.length)}},1176:function(e){var t=Math.ceil,r=Math.floor;e.exports=Math.trunc||function(e){var n=+e;return(n>0?r:t)(n)}},2074:function(e,t,r){var n=r(2087),i=TypeError;e.exports=function(e){if(n(e))throw new i("The method doesn't accept regular expressions");return e}},9538:function(e,t,r){var n=r(9447),i=r(1907),a=r(3930),o=r(8828),s=r(2875),u=r(7170),c=r(2574),d=r(9298),l=r(6946),h=Object.assign,f=Object.defineProperty,p=i([].concat);e.exports=!h||o((function(){if(n&&1!==h({b:1},h(f({},"a",{enumerable:!0,get:function(){f(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol("assign detection"),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach((function(e){t[e]=e})),7!==h({},e)[r]||s(h({},t)).join("")!==i}))?function(e,t){for(var r=d(e),i=arguments.length,o=1,h=u.f,f=c.f;i>o;)for(var v,g=l(arguments[o++]),m=h?p(s(g),h(g)):s(g),y=m.length,_=0;y>_;)v=m[_++],n&&!a(f,g,v)||(r[v]=g[v]);return r}:h},8075:function(e,t,r){var n,i=r(6624),a=r(2220),o=r(376),s=r(8530),u=r(2416),c=r(9552),d=r(2522),l="prototype",h="script",f=d("IE_PROTO"),p=function(){},v=function(e){return"<"+h+">"+e+"</"+h+">"},g=function(e){e.write(v("")),e.close();var t=e.parentWindow.Object;return e=null,t},m=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}var e,t,r;m="undefined"!=typeof document?document.domain&&n?g(n):(t=c("iframe"),r="java"+h+":",t.style.display="none",u.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(v("document.F=Object")),e.close(),e.F):g(n);for(var i=o.length;i--;)delete m[l][o[i]];return m()};s[f]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(p[l]=i(e),r=new p,p[l]=null,r[f]=e):r=m(),void 0===t?r:a.f(r,t)}},2220:function(e,t,r){var n=r(9447),i=r(8661),a=r(4284),o=r(6624),s=r(7374),u=r(2875);t.f=n&&!i?Object.defineProperties:function(e,t){o(e);for(var r,n=s(t),i=u(t),c=i.length,d=0;c>d;)a.f(e,r=i[d++],n[r]);return e}},4284:function(e,t,r){var n=r(9447),i=r(3648),a=r(8661),o=r(6624),s=r(470),u=TypeError,c=Object.defineProperty,d=Object.getOwnPropertyDescriptor,l="enumerable",h="configurable",f="writable";t.f=n?a?function(e,t,r){if(o(e),t=s(t),o(r),"function"==typeof e&&"prototype"===t&&"value"in r&&f in r&&!r[f]){var n=d(e,t);n&&n[f]&&(e[t]=r.value,r={configurable:h in r?r[h]:n[h],enumerable:l in r?r[l]:n[l],writable:!1})}return c(e,t,r)}:c:function(e,t,r){if(o(e),t=s(t),o(r),i)try{return c(e,t,r)}catch(e){}if("get"in r||"set"in r)throw new u("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},3846:function(e,t,r){var n=r(9447),i=r(3930),a=r(2574),o=r(5817),s=r(7374),u=r(470),c=r(9724),d=r(3648),l=Object.getOwnPropertyDescriptor;t.f=n?l:function(e,t){if(e=s(e),t=u(t),d)try{return l(e,t)}catch(e){}if(c(e,t))return o(!i(a.f,e,t),e[t])}},5407:function(e,t,r){var n=r(5807),i=r(7374),a=r(4443).f,o=r(3427),s="object"==("undefined"==typeof window?"undefined":j(window))&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return s&&"Window"===n(e)?function(e){try{return a(e)}catch(e){return o(s)}}(e):a(i(e))}},4443:function(e,t,r){var n=r(3045),i=r(376).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},7170:function(e,t){t.f=Object.getOwnPropertySymbols},5972:function(e,t,r){var n=r(9724),i=r(2250),a=r(9298),o=r(2522),s=r(5001),u=o("IE_PROTO"),c=Object,d=c.prototype;e.exports=s?c.getPrototypeOf:function(e){var t=a(e);if(n(t,u))return t[u];var r=t.constructor;return i(r)&&t instanceof r?r.prototype:t instanceof c?d:null}},8280:function(e,t,r){var n=r(1907);e.exports=n({}.isPrototypeOf)},3045:function(e,t,r){var n=r(1907),i=r(9724),a=r(7374),o=r(4436).indexOf,s=r(8530),u=n([].push);e.exports=function(e,t){var r,n=a(e),c=0,d=[];for(r in n)!i(s,r)&&i(n,r)&&u(d,r);for(;t.length>c;)i(n,r=t[c++])&&(~o(d,r)||u(d,r));return d}},2875:function(e,t,r){var n=r(3045),i=r(376);e.exports=Object.keys||function(e){return n(e,i)}},2574:function(e,t){var r={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,i=n&&!r.call({1:2},1);t.f=i?function(e){var t=n(this,e);return!!t&&t.enumerable}:r},9192:function(e,t,r){var n=r(1871),i=r(6285),a=r(4239),o=r(43);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=n(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return a(r),o(n),i(r)?(t?e(r,n):r.__proto__=n,r):r}}():void 0)},4878:function(e,t,r){var n=r(2623),i=r(3948);e.exports=n?{}.toString:function(){return"[object "+i(this)+"]"}},581:function(e,t,r){var n=r(3930),i=r(2250),a=r(6285),o=TypeError;e.exports=function(e,t){var r,s;if("string"===t&&i(r=e.toString)&&!a(s=n(r,e)))return s;if(i(r=e.valueOf)&&!a(s=n(r,e)))return s;if("string"!==t&&i(r=e.toString)&&!a(s=n(r,e)))return s;throw new o("Can't convert object to primitive value")}},2046:function(e){e.exports={}},5606:function(e,t,r){var n=r(6624);e.exports=function(){var e=n(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},663:function(e,t,r){var n=r(3930),i=r(9724),a=r(8280),o=r(5606),s=RegExp.prototype;e.exports=function(e){var t=e.flags;return void 0!==t||"flags"in s||i(e,"flags")||!a(s,e)?t:n(o,e)}},4239:function(e,t,r){var n=r(7136),i=TypeError;e.exports=function(e){if(n(e))throw new i("Can't call method on "+e);return e}},2098:function(e,t,r){var n=r(5951),i=r(9447),a=Object.getOwnPropertyDescriptor;e.exports=function(e){if(!i)return n[e];var t=a(n,e);return t&&t.value}},4840:function(e,t,r){var n=r(2623),i=r(4284).f,a=r(1626),o=r(9724),s=r(4878),u=r(6264)("toStringTag");e.exports=function(e,t,r,c){var d=r?e:e&&e.prototype;d&&(o(d,u)||i(d,u,{configurable:!0,value:t}),c&&!n&&a(d,"toString",s))}},2522:function(e,t,r){var n=r(5816),i=r(6499),a=n("keys");e.exports=function(e){return a[e]||(a[e]=i(e))}},6128:function(e,t,r){var n=r(7376),i=r(5951),a=r(2532),o="__core-js_shared__",s=e.exports=i[o]||a(o,{});(s.versions||(s.versions=[])).push({version:"3.39.0",mode:n?"pure":"global",copyright:" 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"})},5816:function(e,t,r){var n=r(6128);e.exports=function(e,t){return n[e]||(n[e]=t||{})}},1470:function(e,t,r){var n=r(1907),i=r(5482),a=r(160),o=r(4239),s=n("".charAt),u=n("".charCodeAt),c=n("".slice),d=function(e){return function(t,r){var n,d,l=a(o(t)),h=i(r),f=l.length;return h<0||h>=f?e?"":void 0:(n=u(l,h))<55296||n>56319||h+1===f||(d=u(l,h+1))<56320||d>57343?e?s(l,h):n:e?c(l,h,h+2):d-56320+(n-55296<<10)+65536}};e.exports={codeAt:d(!1),charAt:d(!0)}},9156:function(e,t,r){var n=r(1907),i=2147483647,a=/[^\0-\u007E]/,o=/[.\u3002\uFF0E\uFF61]/g,s="Overflow: input needs wider integers to process",u=RangeError,c=n(o.exec),d=Math.floor,l=String.fromCharCode,h=n("".charCodeAt),f=n([].join),p=n([].push),v=n("".replace),g=n("".split),m=n("".toLowerCase),y=function(e){return e+22+75*(e<26)},_=function(e,t,r){var n=0;for(e=r?d(e/700):e>>1,e+=d(e/t);e>455;)e=d(e/35),n+=36;return d(n+36*e/(e+38))},S=function(e){var t,r,n=[],a=(e=function(e){for(var t=[],r=0,n=e.length;r<n;){var i=h(e,r++);if(i>=55296&&i<=56319&&r<n){var a=h(e,r++);56320==(64512&a)?p(t,((1023&i)<<10)+(1023&a)+65536):(p(t,i),r--)}else p(t,i)}return t}(e)).length,o=128,c=0,v=72;for(t=0;t<e.length;t++)(r=e[t])<128&&p(n,l(r));var g=n.length,m=g;for(g&&p(n,"-");m<a;){var S=i;for(t=0;t<e.length;t++)(r=e[t])>=o&&r<S&&(S=r);var A=m+1;if(S-o>d((i-c)/A))throw new u(s);for(c+=(S-o)*A,o=S,t=0;t<e.length;t++){if((r=e[t])<o&&++c>i)throw new u(s);if(r===o){for(var b=c,E=36;;){var k=E<=v?1:E>=v+26?26:E-v;if(b<k)break;var C=b-k,w=36-k;p(n,l(y(k+C%w))),b=d(C/w),E+=36}p(n,l(y(b))),v=_(c,A,m===g),c=0,m++}}c++,o++}return f(n,"")};e.exports=function(e){var t,r,n=[],i=g(v(m(e),o,"."),".");for(t=0;t<i.length;t++)r=i[t],p(n,c(a,r)?"xn--"+S(r):r);return f(n,".")}},5819:function(e,t,r){var n=r(6833).PROPER,i=r(8828),a=r(6395);e.exports=function(e){return i((function(){return!!a[e]()||""!==""[e]()||n&&a[e].name!==e}))}},5993:function(e,t,r){var n=r(1907),i=r(4239),a=r(160),o=r(6395),s=n("".replace),u=RegExp("^["+o+"]+"),c=RegExp("(^|[^"+o+"])["+o+"]+$"),d=function(e){return function(t){var r=a(i(t));return 1&e&&(r=s(r,u,"")),2&e&&(r=s(r,c,"$1")),r}};e.exports={start:d(1),end:d(2),trim:d(3)}},9846:function(e,t,r){var n=r(798),i=r(8828),a=r(5951).String;e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol("symbol detection");return!a(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},3467:function(e,t,r){var n=r(3930),i=r(5582),a=r(6264),o=r(8055);e.exports=function(){var e=i("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,s=a("toPrimitive");t&&!t[s]&&o(t,s,(function(e){return n(r,this)}),{arity:1})}},2595:function(e,t,r){var n=r(5582),i=r(1907),a=n("Symbol"),o=a.keyFor,s=i(a.prototype.valueOf);e.exports=a.isRegisteredSymbol||function(e){try{return void 0!==o(s(e))}catch(e){return!1}}},9197:function(e,t,r){for(var n=r(5816),i=r(5582),a=r(1907),o=r(5594),s=r(6264),u=i("Symbol"),c=u.isWellKnownSymbol,d=i("Object","getOwnPropertyNames"),l=a(u.prototype.valueOf),h=n("wks"),f=0,p=d(u),v=p.length;f<v;f++)try{var g=p[f];o(u[g])&&s(g)}catch(e){}e.exports=function(e){if(c&&c(e))return!0;try{for(var t=l(e),r=0,n=d(h),i=n.length;r<i;r++)if(h[n[r]]==t)return!0}catch(e){}return!1}},4411:function(e,t,r){var n=r(9846);e.exports=n&&!!Symbol.for&&!!Symbol.keyFor},4849:function(e,t,r){var n=r(5482),i=Math.max,a=Math.min;e.exports=function(e,t){var r=n(e);return r<0?i(r+t,0):a(r,t)}},7374:function(e,t,r){var n=r(6946),i=r(4239);e.exports=function(e){return n(i(e))}},5482:function(e,t,r){var n=r(1176);e.exports=function(e){var t=+e;return t!=t||0===t?0:n(t)}},3121:function(e,t,r){var n=r(5482),i=Math.min;e.exports=function(e){var t=n(e);return t>0?i(t,9007199254740991):0}},9298:function(e,t,r){var n=r(4239),i=Object;e.exports=function(e){return i(n(e))}},6028:function(e,t,r){var n=r(3930),i=r(6285),a=r(5594),o=r(9367),s=r(581),u=r(6264),c=TypeError,d=u("toPrimitive");e.exports=function(e,t){if(!i(e)||a(e))return e;var r,u=o(e,d);if(u){if(void 0===t&&(t="default"),r=n(u,e,t),!i(r)||a(r))return r;throw new c("Can't convert object to primitive value")}return void 0===t&&(t="number"),s(e,t)}},470:function(e,t,r){var n=r(6028),i=r(5594);e.exports=function(e){var t=n(e,"string");return i(t)?t:t+""}},2623:function(e,t,r){var n={};n[r(6264)("toStringTag")]="z",e.exports="[object z]"===String(n)},160:function(e,t,r){var n=r(3948),i=String;e.exports=function(e){if("Symbol"===n(e))throw new TypeError("Cannot convert a Symbol value to a string");return i(e)}},4640:function(e){var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},6499:function(e,t,r){var n=r(1907),i=0,a=Math.random(),o=n(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+o(++i+a,36)}},4791:function(e,t,r){var n=r(8828),i=r(6264),a=r(9447),o=r(7376),s=i("iterator");e.exports=!n((function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2&b=3"),n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),r.delete("a",2),r.delete("b",void 0),o&&(!e.toJSON||!r.has("a",1)||r.has("a",2)||!r.has("a",void 0)||r.has("b"))||!t.size&&(o||!a)||!t.sort||"https://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[s]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://").host||"#%D0%B1"!==new URL("https://a#").hash||"a1c3"!==n||"x"!==new URL("https://x",void 0).host}))},1175:function(e,t,r){var n=r(9846);e.exports=n&&!Symbol.sham&&"symbol"==j(Symbol.iterator)},8661:function(e,t,r){var n=r(9447),i=r(8828);e.exports=n&&i((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},4787:function(e){var t=TypeError;e.exports=function(e,r){if(e<r)throw new t("Not enough arguments");return e}},551:function(e,t,r){var n=r(5951),i=r(2250),a=n.WeakMap;e.exports=i(a)&&/native code/.test(String(a))},366:function(e,t,r){var n=r(2046),i=r(9724),a=r(560),o=r(4284).f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});i(t,e)||o(t,e,{value:a.f(e)})}},560:function(e,t,r){var n=r(6264);t.f=n},6264:function(e,t,r){var n=r(5951),i=r(5816),a=r(9724),o=r(6499),s=r(9846),u=r(1175),c=n.Symbol,d=i("wks"),l=u?c.for||c:c&&c.withoutSetter||o;e.exports=function(e){return a(d,e)||(d[e]=s&&a(c,e)?c[e]:l("Symbol."+e)),d[e]}},6395:function(e){e.exports="\t\n\v\f\r \u2028\u2029\ufeff"},8545:function(e,t,r){var n=r(1091),i=r(8828),a=r(1793),o=r(6285),s=r(9298),u=r(575),c=r(8024),d=r(5543),l=r(6968),h=r(7171),f=r(6264),p=r(798),v=f("isConcatSpreadable"),g=p>=51||!i((function(){var e=[];return e[v]=!1,e.concat()[0]!==e})),m=function(e){if(!o(e))return!1;var t=e[v];return void 0!==t?!!t:a(e)};n({target:"Array",proto:!0,arity:1,forced:!g||!h("concat")},{concat:function(e){var t,r,n,i,a,o=s(this),h=l(o,0),f=0;for(t=-1,n=arguments.length;t<n;t++)if(m(a=-1===t?o:arguments[t]))for(i=u(a),c(f+i),r=0;r<i;r++,f++)r in a&&d(h,f,a[r]);else c(f+1),d(h,f++,a);return h.length=f,h}})},9748:function(e,t,r){var n=r(1091),i=r(4436).includes,a=r(8828),o=r(2156);n({target:"Array",proto:!0,forced:a((function(){return!Array(1).includes()}))},{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("includes")},9363:function(e,t,r){var n=r(7374),i=r(2156),a=r(3742),o=r(4932),s=r(4284).f,u=r(183),c=r(9550),d=r(7376),l=r(9447),h="Array Iterator",f=o.set,p=o.getterFor(h);e.exports=u(Array,"Array",(function(e,t){f(this,{type:h,target:n(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,c(void 0,!0);switch(e.kind){case"keys":return c(r,!1);case"values":return c(t[r],!1)}return c([r,t[r]],!1)}),"values");var v=a.Arguments=a.Array;if(i("keys"),i("values"),i("entries"),!d&&l&&"values"!==v.name)try{s(v,"name",{value:"values"})}catch(e){}},8559:function(e,t,r){var n=r(1091),i=r(1907),a=r(1793),o=i([].reverse),s=[1,2];n({target:"Array",proto:!0,forced:String(s)===String(s.reverse())},{reverse:function(){return a(this)&&(this.length=this.length),o(this)}})},6737:function(e,t,r){var n=r(1091),i=r(1907),a=r(2159),o=r(9298),s=r(575),u=r(4535),c=r(160),d=r(8828),l=r(4321),h=r(7623),f=r(3440),p=r(4328),v=r(798),g=r(3786),m=[],y=i(m.sort),_=i(m.push),S=d((function(){m.sort(void 0)})),A=d((function(){m.sort(null)})),b=h("sort"),E=!d((function(){if(v)return v<70;if(!(f&&f>3)){if(p)return!0;if(g)return g<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)m.push({k:t+n,v:r})}for(m.sort((function(e,t){return t.v-e.v})),n=0;n<m.length;n++)t=m[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));n({target:"Array",proto:!0,forced:S||!A||!b||!E},{sort:function(e){void 0!==e&&a(e);var t=o(this);if(E)return void 0===e?y(t):y(t,e);var r,n,i=[],d=s(t);for(n=0;n<d;n++)n in t&&_(i,t[n]);for(l(i,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:c(t)>c(r)?1:-1}}(e)),r=s(i),n=0;n<r;)t[n]=i[n++];for(;n<d;)u(t,n++);return t}})},8537:function(){},2344:function(e,t,r){var n=r(1091),i=r(5951);n({global:!0,forced:i.globalThis!==i},{globalThis:i})},9721:function(e,t,r){var n=r(1091),i=r(5582),a=r(6024),o=r(3930),s=r(1907),u=r(8828),c=r(2250),d=r(5594),l=r(3427),h=r(6656),f=r(9846),p=String,v=i("JSON","stringify"),g=s(/./.exec),m=s("".charAt),y=s("".charCodeAt),_=s("".replace),S=s(1..toString),A=/[\uD800-\uDFFF]/g,b=/^[\uD800-\uDBFF]$/,E=/^[\uDC00-\uDFFF]$/,k=!f||u((function(){var e=i("Symbol")("stringify detection");return"[null]"!==v([e])||"{}"!==v({a:e})||"{}"!==v(Object(e))})),C=u((function(){return'"\\udf06\\ud834"'!==v("\udf06\ud834")||'"\\udead"'!==v("\udead")})),w=function(e,t){var r=l(arguments),n=h(t);if(c(n)||void 0!==e&&!d(e))return r[1]=function(e,t){if(c(n)&&(t=o(n,this,p(e),t)),!d(t))return t},a(v,null,r)},T=function(e,t,r){var n=m(r,t-1),i=m(r,t+1);return g(b,e)&&!g(E,i)||g(E,e)&&!g(b,n)?"\\u"+S(y(e,0),16):e};v&&n({target:"JSON",stat:!0,arity:3,forced:k||C},{stringify:function(e,t,r){var n=l(arguments),i=a(k?w:v,null,n);return C&&"string"==typeof i?_(i,A,T):i}})},7024:function(e,t,r){var n=r(5951);r(4840)(n.JSON,"JSON",!0)},8172:function(){},6750:function(e,t,r){var n=r(1091),i=r(9447),a=r(4284).f;n({target:"Object",stat:!0,forced:Object.defineProperty!==a,sham:!i},{defineProperty:a})},5264:function(e,t,r){var n=r(1091),i=r(9846),a=r(8828),o=r(7170),s=r(9298);n({target:"Object",stat:!0,forced:!i||a((function(){o.f(1)}))},{getOwnPropertySymbols:function(e){var t=o.f;return t?t(s(e)):[]}})},3643:function(){},5205:function(){},1398:function(){},1074:function(e,t,r){var n=r(1091),i=r(1907),a=r(4849),o=RangeError,s=String.fromCharCode,u=String.fromCodePoint,c=i([].join);n({target:"String",stat:!0,arity:1,forced:!!u&&1!==u.length},{fromCodePoint:function(e){for(var t,r=[],n=arguments.length,i=0;n>i;){if(t=+arguments[i++],a(t,1114111)!==t)throw new o(t+" is not a valid code point");r[i]=t<65536?s(t):s(55296+((t-=65536)>>10),t%1024+56320)}return c(r,"")}})},9770:function(e,t,r){var n=r(1091),i=r(1907),a=r(2074),o=r(4239),s=r(160),u=r(5735),c=i("".indexOf);n({target:"String",proto:!0,forced:!u("includes")},{includes:function(e){return!!~c(s(o(this)),s(a(e)),arguments.length>1?arguments[1]:void 0)}})},7057:function(e,t,r){var n=r(1470).charAt,i=r(160),a=r(4932),o=r(183),s=r(9550),u="String Iterator",c=a.set,d=a.getterFor(u);o(String,"String",(function(e){c(this,{type:u,string:i(e),index:0})}),(function(){var e,t=d(this),r=t.string,i=t.index;return i>=r.length?s(void 0,!0):(e=n(r,i),t.index+=e.length,s(e,!1))}))},929:function(e,t,r){var n=r(1091),i=r(3930),a=r(1907),o=r(4239),s=r(2250),u=r(7136),c=r(2087),d=r(160),l=r(9367),h=r(663),f=r(7703),p=r(6264),v=r(7376),g=p("replace"),m=TypeError,y=a("".indexOf),_=a("".replace),S=a("".slice),A=Math.max;n({target:"String",proto:!0},{replaceAll:function(e,t){var r,n,a,p,b,E,k,C,w,T,R=o(this),I=0,D="";if(!u(e)){if((r=c(e))&&(n=d(o(h(e))),!~y(n,"g")))throw new m("`.replaceAll` does not allow non-global regexes");if(a=l(e,g))return i(a,e,R,t);if(v&&r)return _(d(R),e,t)}for(p=d(R),b=d(e),(E=s(t))||(t=d(t)),k=b.length,C=A(1,k),w=y(p,b);-1!==w;)T=E?d(t(b,w,p)):f(b,p,w,[],void 0,t),D+=S(p,I,w)+T,I=w+k,w=w+C>p.length?-1:y(p,b,w+C);return I<p.length&&(D+=S(p,I)),D}})},1995:function(){},727:function(e,t,r){var n=r(1091),i=r(5993).trim;n({target:"String",proto:!0,forced:r(5819)("trim")},{trim:function(){return i(this)}})},3997:function(e,t,r){r(366)("asyncIterator")},3674:function(e,t,r){var n=r(1091),i=r(5951),a=r(3930),o=r(1907),s=r(7376),u=r(9447),c=r(9846),d=r(8828),l=r(9724),h=r(8280),f=r(6624),p=r(7374),v=r(470),g=r(160),m=r(5817),y=r(8075),_=r(2875),S=r(4443),A=r(5407),b=r(7170),E=r(3846),k=r(4284),C=r(2220),w=r(2574),T=r(8055),R=r(9251),I=r(5816),D=r(2522),M=r(8530),O=r(6499),x=r(6264),P=r(560),L=r(366),N=r(3467),V=r(4840),U=r(4932),F=r(726).forEach,B=D("hidden"),W="Symbol",G="prototype",H=U.set,j=U.getterFor(W),K=Object[G],z=i.Symbol,q=z&&z[G],Y=i.RangeError,X=i.TypeError,Q=i.QObject,J=E.f,$=k.f,Z=A.f,ee=w.f,te=o([].push),re=I("symbols"),ne=I("op-symbols"),ie=I("wks"),ae=!Q||!Q[G]||!Q[G].findChild,oe=function(e,t,r){var n=J(K,t);n&&delete K[t],$(e,t,r),n&&e!==K&&$(K,t,n)},se=u&&d((function(){return 7!==y($({},"a",{get:function(){return $(this,"a",{value:7}).a}})).a}))?oe:$,ue=function(e,t){var r=re[e]=y(q);return H(r,{type:W,tag:e,description:t}),u||(r.description=t),r},ce=function(e,t,r){e===K&&ce(ne,t,r),f(e);var n=v(t);return f(r),l(re,n)?(r.enumerable?(l(e,B)&&e[B][n]&&(e[B][n]=!1),r=y(r,{enumerable:m(0,!1)})):(l(e,B)||$(e,B,m(1,y(null))),e[B][n]=!0),se(e,n,r)):$(e,n,r)},de=function(e,t){f(e);var r=p(t),n=_(r).concat(pe(r));return F(n,(function(t){u&&!a(le,r,t)||ce(e,t,r[t])})),e},le=function(e){var t=v(e),r=a(ee,this,t);return!(this===K&&l(re,t)&&!l(ne,t))&&(!(r||!l(this,t)||!l(re,t)||l(this,B)&&this[B][t])||r)},he=function(e,t){var r=p(e),n=v(t);if(r!==K||!l(re,n)||l(ne,n)){var i=J(r,n);return!i||!l(re,n)||l(r,B)&&r[B][n]||(i.enumerable=!0),i}},fe=function(e){var t=Z(p(e)),r=[];return F(t,(function(e){l(re,e)||l(M,e)||te(r,e)})),r},pe=function(e){var t=e===K,r=Z(t?ne:p(e)),n=[];return F(r,(function(e){!l(re,e)||t&&!l(K,e)||te(n,re[e])})),n};c||(T(q=(z=function(){if(h(q,this))throw new X("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?g(arguments[0]):void 0,t=O(e),r=function(e){var n=void 0===this?i:this;n===K&&a(r,ne,e),l(n,B)&&l(n[B],t)&&(n[B][t]=!1);var o=m(1,e);try{se(n,t,o)}catch(e){if(!(e instanceof Y))throw e;oe(n,t,o)}};return u&&ae&&se(K,t,{configurable:!0,set:r}),ue(t,e)})[G],"toString",(function(){return j(this).tag})),T(z,"withoutSetter",(function(e){return ue(O(e),e)})),w.f=le,k.f=ce,C.f=de,E.f=he,S.f=A.f=fe,b.f=pe,P.f=function(e){return ue(x(e),e)},u&&(R(q,"description",{configurable:!0,get:function(){return j(this).description}}),s||T(K,"propertyIsEnumerable",le,{unsafe:!0}))),n({global:!0,constructor:!0,wrap:!0,forced:!c,sham:!c},{Symbol:z}),F(_(ie),(function(e){L(e)})),n({target:W,stat:!0,forced:!c},{useSetter:function(){ae=!0},useSimple:function(){ae=!1}}),n({target:"Object",stat:!0,forced:!c,sham:!u},{create:function(e,t){return void 0===t?y(e):de(y(e),t)},defineProperty:ce,defineProperties:de,getOwnPropertyDescriptor:he}),n({target:"Object",stat:!0,forced:!c},{getOwnPropertyNames:fe}),N(),V(z,W),M[B]=!0},5084:function(){},3313:function(e,t,r){var n=r(1091),i=r(5582),a=r(9724),o=r(160),s=r(5816),u=r(4411),c=s("string-to-symbol-registry"),d=s("symbol-to-string-registry");n({target:"Symbol",stat:!0,forced:!u},{for:function(e){var t=o(e);if(a(c,t))return c[t];var r=i("Symbol")(t);return c[t]=r,d[r]=t,r}})},2596:function(e,t,r){r(366)("hasInstance")},5721:function(e,t,r){r(366)("isConcatSpreadable")},4954:function(e,t,r){r(366)("iterator")},4452:function(e,t,r){r(3674),r(3313),r(751),r(9721),r(5264)},751:function(e,t,r){var n=r(1091),i=r(9724),a=r(5594),o=r(4640),s=r(5816),u=r(4411),c=s("symbol-to-string-registry");n({target:"Symbol",stat:!0,forced:!u},{keyFor:function(e){if(!a(e))throw new TypeError(o(e)+" is not a symbol");if(i(c,e))return c[e]}})},3377:function(e,t,r){r(366)("matchAll")},4123:function(e,t,r){r(366)("match")},2230:function(e,t,r){r(366)("replace")},5344:function(e,t,r){r(366)("search")},1660:function(e,t,r){r(366)("species")},4610:function(e,t,r){r(366)("split")},3669:function(e,t,r){var n=r(366),i=r(3467);n("toPrimitive"),i()},4810:function(e,t,r){var n=r(5582),i=r(366),a=r(4840);i("toStringTag"),a(n("Symbol"),"Symbol")},3325:function(e,t,r){r(366)("unscopables")},768:function(e,t,r){var n=r(6264),i=r(4284).f,a=n("metadata"),o=Function.prototype;void 0===o[a]&&i(o,a,{value:null})},397:function(e,t,r){r(2344)},6038:function(e,t,r){r(929)},8549:function(e,t,r){r(366)("asyncDispose")},1697:function(e,t,r){r(366)("customMatcher")},7152:function(e,t,r){r(366)("dispose")},3939:function(e,t,r){r(1091)({target:"Symbol",stat:!0},{isRegisteredSymbol:r(2595)})},3422:function(e,t,r){r(1091)({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:r(2595)})},1785:function(e,t,r){r(1091)({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:r(9197)})},36:function(e,t,r){r(1091)({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:r(9197)})},8703:function(e,t,r){r(366)("matcher")},6878:function(e,t,r){r(366)("metadataKey")},1372:function(e,t,r){r(366)("metadata")},4664:function(e,t,r){r(366)("observable")},9671:function(e,t,r){r(366)("patternMatch")},359:function(e,t,r){r(366)("replaceAll")},2560:function(e,t,r){r(9363);var n=r(9287),i=r(5951),a=r(4840),o=r(3742);for(var s in n)a(i[s],s),o[s]=o.Array},7105:function(e,t,r){r(9363),r(1074);var n=r(1091),i=r(5951),a=r(2098),o=r(5582),s=r(3930),u=r(1907),c=r(9447),d=r(4791),l=r(8055),h=r(9251),f=r(2802),p=r(4840),v=r(7181),g=r(4932),m=r(9596),y=r(2250),_=r(9724),S=r(8311),A=r(3948),b=r(6624),E=r(6285),k=r(160),C=r(8075),w=r(5817),T=r(300),R=r(3448),I=r(9550),D=r(4787),M=r(6264),O=r(4321),x=M("iterator"),P="URLSearchParams",L=P+"Iterator",N=g.set,V=g.getterFor(P),U=g.getterFor(L),F=a("fetch"),B=a("Request"),W=a("Headers"),G=B&&B.prototype,H=W&&W.prototype,j=i.TypeError,K=i.encodeURIComponent,z=String.fromCharCode,q=o("String","fromCodePoint"),Y=parseInt,X=u("".charAt),Q=u([].join),J=u([].push),$=u("".replace),Z=u([].shift),ee=u([].splice),te=u("".split),re=u("".slice),ne=u(/./.exec),ie=/\+/g,ae=/^[0-9a-f]+$/i,oe=function(e,t){var r=re(e,t,t+2);return ne(ae,r)?Y(r,16):NaN},se=function(e){for(var t=0,r=128;r>0&&e&r;r>>=1)t++;return t},ue=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},ce=function(e){for(var t=(e=$(e,ie," ")).length,r="",n=0;n<t;){var i=X(e,n);if("%"===i){if("%"===X(e,n+1)||n+3>t){r+="%",n++;continue}var a=oe(e,n+1);if(a!=a){r+=i,n++;continue}n+=2;var o=se(a);if(0===o)i=z(a);else{if(1===o||o>4){r+="",n++;continue}for(var s=[a],u=1;u<o&&!(3+ ++n>t||"%"!==X(e,n));){var c=oe(e,n+1);if(c!=c){n+=3;break}if(c>191||c<128)break;J(s,c),n+=2,u++}if(s.length!==o){r+="";continue}var d=ue(s);null===d?r+="":i=q(d)}}r+=i,n++}return r},de=/[!'()~]|%20/g,le={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},he=function(e){return le[e]},fe=function(e){return $(K(e),de,he)},pe=v((function(e,t){N(this,{type:L,target:V(e).entries,index:0,kind:t})}),P,(function(){var e=U(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,I(void 0,!0);var n=t[r];switch(e.kind){case"keys":return I(n.key,!1);case"values":return I(n.value,!1)}return I([n.key,n.value],!1)}),!0),ve=function(e){this.entries=[],this.url=null,void 0!==e&&(E(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===X(e,0)?re(e,1):e:k(e)))};ve.prototype={type:P,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,n,i,a,o,u,c=this.entries,d=R(e);if(d)for(r=(t=T(e,d)).next;!(n=s(r,t)).done;){if(a=(i=T(b(n.value))).next,(o=s(a,i)).done||(u=s(a,i)).done||!s(a,i).done)throw new j("Expected sequence with length 2");J(c,{key:k(o.value),value:k(u.value)})}else for(var l in e)_(e,l)&&J(c,{key:l,value:k(e[l])})},parseQuery:function(e){if(e)for(var t,r,n=this.entries,i=te(e,"&"),a=0;a<i.length;)(t=i[a++]).length&&(r=te(t,"="),J(n,{key:ce(Z(r)),value:ce(Q(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],n=0;n<t.length;)e=t[n++],J(r,fe(e.key)+"="+fe(e.value));return Q(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ge=function(){m(this,me);var e=N(this,new ve(arguments.length>0?arguments[0]:void 0));c||(this.size=e.entries.length)},me=ge.prototype;if(f(me,{append:function(e,t){var r=V(this);D(arguments.length,2),J(r.entries,{key:k(e),value:k(t)}),c||this.length++,r.updateURL()},delete:function(e){for(var t=V(this),r=D(arguments.length,1),n=t.entries,i=k(e),a=r<2?void 0:arguments[1],o=void 0===a?a:k(a),s=0;s<n.length;){var u=n[s];if(u.key!==i||void 0!==o&&u.value!==o)s++;else if(ee(n,s,1),void 0!==o)break}c||(this.size=n.length),t.updateURL()},get:function(e){var t=V(this).entries;D(arguments.length,1);for(var r=k(e),n=0;n<t.length;n++)if(t[n].key===r)return t[n].value;return null},getAll:function(e){var t=V(this).entries;D(arguments.length,1);for(var r=k(e),n=[],i=0;i<t.length;i++)t[i].key===r&&J(n,t[i].value);return n},has:function(e){for(var t=V(this).entries,r=D(arguments.length,1),n=k(e),i=r<2?void 0:arguments[1],a=void 0===i?i:k(i),o=0;o<t.length;){var s=t[o++];if(s.key===n&&(void 0===a||s.value===a))return!0}return!1},set:function(e,t){var r=V(this);D(arguments.length,1);for(var n,i=r.entries,a=!1,o=k(e),s=k(t),u=0;u<i.length;u++)(n=i[u]).key===o&&(a?ee(i,u--,1):(a=!0,n.value=s));a||J(i,{key:o,value:s}),c||(this.size=i.length),r.updateURL()},sort:function(){var e=V(this);O(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,r=V(this).entries,n=S(e,arguments.length>1?arguments[1]:void 0),i=0;i<r.length;)n((t=r[i++]).value,t.key,this)},keys:function(){return new pe(this,"keys")},values:function(){return new pe(this,"values")},entries:function(){return new pe(this,"entries")}},{enumerable:!0}),l(me,x,me.entries,{name:"entries"}),l(me,"toString",(function(){return V(this).serialize()}),{enumerable:!0}),c&&h(me,"size",{get:function(){return V(this).entries.length},configurable:!0,enumerable:!0}),p(ge,P),n({global:!0,constructor:!0,forced:!d},{URLSearchParams:ge}),!d&&y(W)){var ye=u(H.has),_e=u(H.set),Se=function(e){if(E(e)){var t,r=e.body;if(A(r)===P)return t=e.headers?new W(e.headers):new W,ye(t,"content-type")||_e(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),C(e,{body:w(0,k(r)),headers:w(0,t)})}return e};if(y(F)&&n({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return F(e,arguments.length>1?Se(arguments[1]):{})}}),y(B)){var Ae=function(e){return m(this,G),new B(e,arguments.length>1?Se(arguments[1]):{})};G.constructor=Ae,Ae.prototype=G,n({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:Ae})}}e.exports={URLSearchParams:ge,getState:V}},5042:function(){},7649:function(){},6299:function(e,t,r){r(7105)},3604:function(){},8669:function(e,t,r){var n=r(1091),i=r(5582),a=r(8828),o=r(4787),s=r(160),u=r(4791),c=i("URL"),d=u&&a((function(){c.canParse()})),l=a((function(){return 1!==c.canParse.length}));n({target:"URL",stat:!0,forced:!d||l},{canParse:function(e){var t=o(arguments.length,1),r=s(e),n=t<2||void 0===arguments[1]?void 0:s(arguments[1]);try{return!!new c(r,n)}catch(e){return!1}}})},6909:function(e,t,r){r(7057);var n,i=r(1091),a=r(9447),o=r(4791),s=r(5951),u=r(8311),c=r(1907),d=r(8055),l=r(9251),h=r(9596),f=r(9724),p=r(9538),v=r(1229),g=r(3427),m=r(1470).codeAt,y=r(9156),_=r(160),S=r(4840),A=r(4787),b=r(7105),E=r(4932),k=E.set,C=E.getterFor("URL"),w=b.URLSearchParams,T=b.getState,R=s.URL,I=s.TypeError,D=s.parseInt,M=Math.floor,O=Math.pow,x=c("".charAt),P=c(/./.exec),L=c([].join),N=c(1..toString),V=c([].pop),U=c([].push),F=c("".replace),B=c([].shift),W=c("".split),G=c("".slice),H=c("".toLowerCase),K=c([].unshift),z="Invalid scheme",q="Invalid host",Y="Invalid port",X=/[a-z]/i,Q=/[\d+-.a-z]/i,J=/\d/,$=/^0x/i,Z=/^[0-7]+$/,ee=/^\d+$/,te=/^[\da-f]+$/i,re=/[\0\t\n\r #%/:<>?@[\\\]^|]/,ne=/[\0\t\n\r #/:<>?@[\\\]^|]/,ie=/^[\u0000-\u0020]+/,ae=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,oe=/[\t\n\r]/g,se=function(e){var t,r,n,i;if("number"==typeof e){for(t=[],r=0;r<4;r++)K(t,e%256),e=M(e/256);return L(t,".")}if("object"==j(e)){for(t="",n=function(e){for(var t=null,r=1,n=null,i=0,a=0;a<8;a++)0!==e[a]?(i>r&&(t=n,r=i),n=null,i=0):(null===n&&(n=a),++i);return i>r?n:t}(e),r=0;r<8;r++)i&&0===e[r]||(i&&(i=!1),n===r?(t+=r?":":"::",i=!0):(t+=N(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},ue={},ce=p({},ue,{" ":1,'"':1,"<":1,">":1,"`":1}),de=p({},ce,{"#":1,"?":1,"{":1,"}":1}),le=p({},de,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),he=function(e,t){var r=m(e,0);return r>32&&r<127&&!f(t,e)?e:encodeURIComponent(e)},fe={ftp:21,file:null,http:80,https:443,ws:80,wss:443},pe=function(e,t){var r;return 2===e.length&&P(X,x(e,0))&&(":"===(r=x(e,1))||!t&&"|"===r)},ve=function(e){var t;return e.length>1&&pe(G(e,0,2))&&(2===e.length||"/"===(t=x(e,2))||"\\"===t||"?"===t||"#"===t)},ge=function(e){return"."===e||"%2e"===H(e)},me={},ye={},_e={},Se={},Ae={},be={},Ee={},ke={},Ce={},we={},Te={},Re={},Ie={},De={},Me={},Oe={},xe={},Pe={},Le={},Ne={},Ve={},Ue=function(e,t,r){var n,i,a,o=_(e);if(t){if(i=this.parse(o))throw new I(i);this.searchParams=null}else{if(void 0!==r&&(n=new Ue(r,!0)),i=this.parse(o,null,n))throw new I(i);(a=T(new w)).bindURL(this),this.searchParams=a}};Ue.prototype={type:"URL",parse:function(e,t,r){var i,a,o,s,u,c=this,d=t||me,l=0,h="",p=!1,m=!1,y=!1;for(e=_(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=F(e,ie,""),e=F(e,ae,"$1")),e=F(e,oe,""),i=v(e);l<=i.length;){switch(a=i[l],d){case me:if(!a||!P(X,a)){if(t)return z;d=_e;continue}h+=H(a),d=ye;break;case ye:if(a&&(P(Q,a)||"+"===a||"-"===a||"."===a))h+=H(a);else{if(":"!==a){if(t)return z;h="",d=_e,l=0;continue}if(t&&(c.isSpecial()!==f(fe,h)||"file"===h&&(c.includesCredentials()||null!==c.port)||"file"===c.scheme&&!c.host))return;if(c.scheme=h,t)return void(c.isSpecial()&&fe[c.scheme]===c.port&&(c.port=null));h="","file"===c.scheme?d=De:c.isSpecial()&&r&&r.scheme===c.scheme?d=Se:c.isSpecial()?d=ke:"/"===i[l+1]?(d=Ae,l++):(c.cannotBeABaseURL=!0,U(c.path,""),d=Le)}break;case _e:if(!r||r.cannotBeABaseURL&&"#"!==a)return z;if(r.cannotBeABaseURL&&"#"===a){c.scheme=r.scheme,c.path=g(r.path),c.query=r.query,c.fragment="",c.cannotBeABaseURL=!0,d=Ve;break}d="file"===r.scheme?De:be;continue;case Se:if("/"!==a||"/"!==i[l+1]){d=be;continue}d=Ce,l++;break;case Ae:if("/"===a){d=we;break}d=Pe;continue;case be:if(c.scheme=r.scheme,a===n)c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=g(r.path),c.query=r.query;else if("/"===a||"\\"===a&&c.isSpecial())d=Ee;else if("?"===a)c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=g(r.path),c.query="",d=Ne;else{if("#"!==a){c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=g(r.path),c.path.length--,d=Pe;continue}c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=g(r.path),c.query=r.query,c.fragment="",d=Ve}break;case Ee:if(!c.isSpecial()||"/"!==a&&"\\"!==a){if("/"!==a){c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,d=Pe;continue}d=we}else d=Ce;break;case ke:if(d=Ce,"/"!==a||"/"!==x(h,l+1))continue;l++;break;case Ce:if("/"!==a&&"\\"!==a){d=we;continue}break;case we:if("@"===a){p&&(h="%40"+h),p=!0,o=v(h);for(var S=0;S<o.length;S++){var A=o[S];if(":"!==A||y){var b=he(A,le);y?c.password+=b:c.username+=b}else y=!0}h=""}else if(a===n||"/"===a||"?"===a||"#"===a||"\\"===a&&c.isSpecial()){if(p&&""===h)return"Invalid authority";l-=v(h).length+1,h="",d=Te}else h+=a;break;case Te:case Re:if(t&&"file"===c.scheme){d=Oe;continue}if(":"!==a||m){if(a===n||"/"===a||"?"===a||"#"===a||"\\"===a&&c.isSpecial()){if(c.isSpecial()&&""===h)return q;if(t&&""===h&&(c.includesCredentials()||null!==c.port))return;if(s=c.parseHost(h))return s;if(h="",d=xe,t)return;continue}"["===a?m=!0:"]"===a&&(m=!1),h+=a}else{if(""===h)return q;if(s=c.parseHost(h))return s;if(h="",d=Ie,t===Re)return}break;case Ie:if(!P(J,a)){if(a===n||"/"===a||"?"===a||"#"===a||"\\"===a&&c.isSpecial()||t){if(""!==h){var E=D(h,10);if(E>65535)return Y;c.port=c.isSpecial()&&E===fe[c.scheme]?null:E,h=""}if(t)return;d=xe;continue}return Y}h+=a;break;case De:if(c.scheme="file","/"===a||"\\"===a)d=Me;else{if(!r||"file"!==r.scheme){d=Pe;continue}switch(a){case n:c.host=r.host,c.path=g(r.path),c.query=r.query;break;case"?":c.host=r.host,c.path=g(r.path),c.query="",d=Ne;break;case"#":c.host=r.host,c.path=g(r.path),c.query=r.query,c.fragment="",d=Ve;break;default:ve(L(g(i,l),""))||(c.host=r.host,c.path=g(r.path),c.shortenPath()),d=Pe;continue}}break;case Me:if("/"===a||"\\"===a){d=Oe;break}r&&"file"===r.scheme&&!ve(L(g(i,l),""))&&(pe(r.path[0],!0)?U(c.path,r.path[0]):c.host=r.host),d=Pe;continue;case Oe:if(a===n||"/"===a||"\\"===a||"?"===a||"#"===a){if(!t&&pe(h))d=Pe;else if(""===h){if(c.host="",t)return;d=xe}else{if(s=c.parseHost(h))return s;if("localhost"===c.host&&(c.host=""),t)return;h="",d=xe}continue}h+=a;break;case xe:if(c.isSpecial()){if(d=Pe,"/"!==a&&"\\"!==a)continue}else if(t||"?"!==a)if(t||"#"!==a){if(a!==n&&(d=Pe,"/"!==a))continue}else c.fragment="",d=Ve;else c.query="",d=Ne;break;case Pe:if(a===n||"/"===a||"\\"===a&&c.isSpecial()||!t&&("?"===a||"#"===a)){if(".."===(u=H(u=h))||"%2e."===u||".%2e"===u||"%2e%2e"===u?(c.shortenPath(),"/"===a||"\\"===a&&c.isSpecial()||U(c.path,"")):ge(h)?"/"===a||"\\"===a&&c.isSpecial()||U(c.path,""):("file"===c.scheme&&!c.path.length&&pe(h)&&(c.host&&(c.host=""),h=x(h,0)+":"),U(c.path,h)),h="","file"===c.scheme&&(a===n||"?"===a||"#"===a))for(;c.path.length>1&&""===c.path[0];)B(c.path);"?"===a?(c.query="",d=Ne):"#"===a&&(c.fragment="",d=Ve)}else h+=he(a,de);break;case Le:"?"===a?(c.query="",d=Ne):"#"===a?(c.fragment="",d=Ve):a!==n&&(c.path[0]+=he(a,ue));break;case Ne:t||"#"!==a?a!==n&&("'"===a&&c.isSpecial()?c.query+="%27":c.query+="#"===a?"%23":he(a,ue)):(c.fragment="",d=Ve);break;case Ve:a!==n&&(c.fragment+=he(a,ce))}l++}},parseHost:function(e){var t,r,n;if("["===x(e,0)){if("]"!==x(e,e.length-1))return q;if(!(t=function(e){var t,r,n,i,a,o,s,u=[0,0,0,0,0,0,0,0],c=0,d=null,l=0,h=function(){return x(e,l)};if(":"===h()){if(":"!==x(e,1))return;l+=2,d=++c}for(;h();){if(8===c)return;if(":"!==h()){for(t=r=0;r<4&&P(te,h());)t=16*t+D(h(),16),l++,r++;if("."===h()){if(0===r)return;if(l-=r,c>6)return;for(n=0;h();){if(i=null,n>0){if(!("."===h()&&n<4))return;l++}if(!P(J,h()))return;for(;P(J,h());){if(a=D(h(),10),null===i)i=a;else{if(0===i)return;i=10*i+a}if(i>255)return;l++}u[c]=256*u[c]+i,2!=++n&&4!==n||c++}if(4!==n)return;break}if(":"===h()){if(l++,!h())return}else if(h())return;u[c++]=t}else{if(null!==d)return;l++,d=++c}}if(null!==d)for(o=c-d,c=7;0!==c&&o>0;)s=u[c],u[c--]=u[d+o-1],u[d+--o]=s;else if(8!==c)return;return u}(G(e,1,-1))))return q;this.host=t}else if(this.isSpecial()){if(e=y(e),P(re,e))return q;if(null===(t=function(e){var t,r,n,i,a,o,s,u=W(e,".");if(u.length&&""===u[u.length-1]&&u.length--,(t=u.length)>4)return e;for(r=[],n=0;n<t;n++){if(""===(i=u[n]))return e;if(a=10,i.length>1&&"0"===x(i,0)&&(a=P($,i)?16:8,i=G(i,8===a?1:2)),""===i)o=0;else{if(!P(10===a?ee:8===a?Z:te,i))return e;o=D(i,a)}U(r,o)}for(n=0;n<t;n++)if(o=r[n],n===t-1){if(o>=O(256,5-t))return null}else if(o>255)return null;for(s=V(r),n=0;n<r.length;n++)s+=r[n]*O(256,3-n);return s}(e)))return q;this.host=t}else{if(P(ne,e))return q;for(t="",r=v(e),n=0;n<r.length;n++)t+=he(r[n],ue);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return f(fe,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"===this.scheme&&1===t&&pe(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,n=e.password,i=e.host,a=e.port,o=e.path,s=e.query,u=e.fragment,c=t+":";return null!==i?(c+="//",e.includesCredentials()&&(c+=r+(n?":"+n:"")+"@"),c+=se(i),null!==a&&(c+=":"+a)):"file"===t&&(c+="//"),c+=e.cannotBeABaseURL?o[0]:o.length?"/"+L(o,"/"):"",null!==s&&(c+="?"+s),null!==u&&(c+="#"+u),c},setHref:function(e){var t=this.parse(e);if(t)throw new I(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"===e)try{return new Fe(e.path[0]).origin}catch(e){return"null"}return"file"!==e&&this.isSpecial()?e+"://"+se(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(_(e)+":",me)},getUsername:function(){return this.username},setUsername:function(e){var t=v(_(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=he(t[r],le)}},getPassword:function(){return this.password},setPassword:function(e){var t=v(_(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=he(t[r],le)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?se(e):se(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Te)},getHostname:function(){var e=this.host;return null===e?"":se(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Re)},getPort:function(){var e=this.port;return null===e?"":_(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""===(e=_(e))?this.port=null:this.parse(e,Ie))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+L(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,xe))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""===(e=_(e))?this.query=null:("?"===x(e,0)&&(e=G(e,1)),this.query="",this.parse(e,Ne)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!==(e=_(e))?("#"===x(e,0)&&(e=G(e,1)),this.fragment="",this.parse(e,Ve)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Fe=function(e){var t=h(this,Be),r=A(arguments.length,1)>1?arguments[1]:void 0,n=k(t,new Ue(e,!1,r));a||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},Be=Fe.prototype,We=function(e,t){return{get:function(){return C(this)[e]()},set:t&&function(e){return C(this)[t](e)},configurable:!0,enumerable:!0}};if(a&&(l(Be,"href",We("serialize","setHref")),l(Be,"origin",We("getOrigin")),l(Be,"protocol",We("getProtocol","setProtocol")),l(Be,"username",We("getUsername","setUsername")),l(Be,"password",We("getPassword","setPassword")),l(Be,"host",We("getHost","setHost")),l(Be,"hostname",We("getHostname","setHostname")),l(Be,"port",We("getPort","setPort")),l(Be,"pathname",We("getPathname","setPathname")),l(Be,"search",We("getSearch","setSearch")),l(Be,"searchParams",We("getSearchParams")),l(Be,"hash",We("getHash","setHash"))),d(Be,"toJSON",(function(){return C(this).serialize()}),{enumerable:!0}),d(Be,"toString",(function(){return C(this).serialize()}),{enumerable:!0}),R){var Ge=R.createObjectURL,He=R.revokeObjectURL;Ge&&d(Fe,"createObjectURL",u(Ge,R)),He&&d(Fe,"revokeObjectURL",u(He,R))}S(Fe,"URL"),i({global:!0,constructor:!0,forced:!o,sham:!a},{URL:Fe})},3487:function(e,t,r){r(6909)},8670:function(e,t,r){var n=r(1091),i=r(5582),a=r(4787),o=r(160),s=r(4791),u=i("URL");n({target:"URL",stat:!0,forced:!s},{parse:function(e){var t=a(arguments.length,1),r=o(e),n=t<2||void 0===arguments[1]?void 0:o(arguments[1]);try{return new u(r,n)}catch(e){return null}}})},4783:function(){},1960:function(e,t,r){var n=r(2671);e.exports=n},6343:function(e,t,r){var n=r(6880);e.exports=n},2222:function(e,t,r){var n=r(6823);e.exports=n},4106:function(e,t,r){var n=r(8059);e.exports=n},1086:function(e,t,r){var n=r(2757);e.exports=n},4598:function(e,t,r){var n=r(1042);e.exports=n},8251:function(e,t,r){var n=r(1926);e.exports=n},9563:function(e,t,r){var n=r(4776);e.exports=n},4139:function(e,t,r){var n=r(3842);r(2560),e.exports=n},7045:function(e,t,r){var n=r(1730);r(2560),e.exports=n},70:function(e,t,r){var n=r(1661);e.exports=n},9792:function(e,t,r){var n=r(6908);e.exports=n},9076:function(e,t,r){r(6299),r(5042),r(7649),r(3604);var n=r(2046);e.exports=n.URLSearchParams},6908:function(e,t,r){r(9076),r(3487),r(8669),r(8670),r(4783);var n=r(2046);e.exports=n.URL},7857:function(e,t,r){r.d(t,{A:function(){return u}});var n=r(4997),i=r(2321),a=r(2231);function o(e){return(o="function"==typeof i&&"symbol"==j(a)?function(e){return j(e)}:function(e){return e&&"function"==typeof i&&e.constructor===i&&e!==i.prototype?"symbol":j(e)})(e)}var s=r(9280);function u(e,t,r){return i=function(e){if("object"!=o(e)||!e)return e;var t=e[s];if(void 0!==t){var r=t.call(e,"string");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t),(t="symbol"==o(i)?i:i+"")in e?n(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e;var i}},7026:function(e,t,r){r.d(t,{A:function(){return a}});var n=r(913),i=r(3901);function a(e,t){if(null==e)return{};var r,a,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(i(t).call(t,n))continue;r[n]=e[n]}return r}(e,t);if(n){var s=n(e);for(a=0;a<s.length;a++)r=s[a],i(t).call(t,r)||{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}}},n={};function a(e){var t=n[e];if(void 0!==t)return t.exports;var i=n[e]={id:e,loaded:!1,exports:{}};return r[e].call(i.exports,i,i.exports,a),i.loaded=!0,i.exports}return a.m=r,a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},a.d=function(e,t){for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,r){return a.f[r](e,t),t}),[]))},a.u=function(e){return{208:"annoter",404:"pako",557:"wmsc"}[e]+".min.js"},a.g=function(){if("object"==("undefined"==typeof globalThis?"undefined":j(globalThis)))return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==("undefined"==typeof window?"undefined":j(window)))return window}}(),a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e={},t="JsMediaSDK_Instance:",a.l=function(r,n,i,o){if(e[r])e[r].push(n);else{var s,u;if(void 0!==i)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var l=c[d];if(l.getAttribute("src")==r||l.getAttribute("data-webpack")==t+i){s=l;break}}s||(u=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.setAttribute("data-webpack",t+i),s.src=r),e[r]=[n];var h=function(t,n){s.onerror=s.onload=null,clearTimeout(f);var i=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((function(e){return e(n)})),t)return t(n)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),u&&document.head.appendChild(s)}},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},function(){var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=r[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e}(),function(){var e={827:0};a.f.j=function(t,r){var n=a.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var i=new Promise((function(r,i){return n=e[t]=[r,i]}));r.push(n[2]=i);var o=a.p+a.u(t),s=new Error;a.l(o,(function(r){if(a.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var i=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",s.name="ChunkLoadError",s.type=i,s.request=o,n[1](s)}}),"chunk-"+t,t)}};var t=function(t,r){var n,i,o=r[0],s=r[1],u=r[2],c=0;if(o.some((function(t){return 0!==e[t]}))){for(n in s)a.o(s,n)&&(a.m[n]=s[n]);u&&u(a)}for(t&&t(r);c<o.length;c++)i=o[c],a.o(e,i)&&e[i]&&e[i][0](),e[i]=0},r=self.webpackChunkJsMediaSDK_Instance=self.webpackChunkJsMediaSDK_Instance||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}(),a(4497)}());var M=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(I.exports),x=function(e){return e[e.Audio=1]="Audio",e[e.Video=2]="Video",e[e.LTT=3]="LTT",e[e.BulletScreen=4]="BulletScreen",e[e.NoCompressedBulletScreen=5]="NoCompressedBulletScreen",e[e.Rewind=6]="Rewind",e}(x||{}),P=function(e){return e[e.PingFail=0]="PingFail",e[e.WebSocketBroken=1]="WebSocketBroken",e[e.UDPClosed=2]="UDPClosed",e[e.BadQuality=3]="BadQuality",e[e.SubscribeTimeout=4]="SubscribeTimeout",e[e.TooManyFailover=5]="TooManyFailover",e[e.UDPBlock=6]="UDPBlock",e[e.TCPMediaError=7]="TCPMediaError",e}(P||{}),L=function(e){return e.PingFail="ping zc fail",e.WebSocketBroken="connect to lss fail",e.UDPClosed="data channel closed",e.BadQuality="cannot play smoothly",e.SubscribeTimeout="wait for subscribe timeout",e.TooManyFailover="failover too many times",e.UDPBlock="datachannel udp unavailable",e.TCPMediaError="media tcp ws error",e}(L||{}),N=function(e){return e[e.Green=0]="Green",e[e.Yellow=1]="Yellow",e[e.Red=2]="Red",e}(N||{}),V=function(e){return e[e.Unknown=0]="Unknown",e[e.LongLoading=1]="LongLoading",e[e.LowResolution=2]="LowResolution",e[e.LongLatency=3]="LongLatency",e[e.AVNotSync=4]="AVNotSync",e[e.QoSReport=5]="QoSReport",e[e.LowFPS=6]="LowFPS",e}(V||{}),F="live-player-canvas",B=function(e){return e[e.DEFAULT=0]="DEFAULT",e[e.TOP=1]="TOP",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=4]="LEFT",e[e.MIDDLE=16]="MIDDLE",e[e.RIGHT=8]="RIGHT",e}(B||{}),W=function(e){var t=0,r=0;return e.max_loss>=500?t+=2:e.max_loss>=200&&(t+=1),e.avg_loss>=400?r+=2:e.avg_loss>=150&&(r+=1),["normal","warning","error"][Math.max(t,r)]};function G(e,t){var r=e.getBoundingClientRect(),n=r.left,i=r.top,a=r.bottom,o=r.right,s=r.width,u=r.height,c=t.getBoundingClientRect();return{left:n-c.left,top:i-c.top,bottom:c.bottom-a,right:c.right-o,width:s,height:u}}function z(e){var t=0,r=0,n=0,i=0;if("r"===e[0])if("a"===e[3]){var a=e.slice(5,-1).split(",").map((function(e){return parseInt(e.trim(),10)}));t=a[0],r=a[1],n=a[2],i=a[3]}else{var o=e.slice(4,-1).split(",").map((function(e){return parseInt(e.trim(),10)}));t=o[0],r=o[1],n=o[2]}else if("#"===e[0]){var s=e.slice(1);3===s.length&&(s=s.split("").map((function(e){return e.repeat(2)})).join(""));var u=parseInt(s,16);t=u>>16&255,r=u>>8&255,n=255&u}return{R:t/255,G:r/255,B:n/255,A:i}}function X(e){for(var t=window.atob(e),r=t.length,n=new Uint8Array(r),i=0;i<r;i++)n[i]=t.charCodeAt(i);return n}function J(e){for(var t="",r=e.byteLength,n=0;n<r;n++)t+=String.fromCharCode(e[n]);return window.btoa(t)}function $(){if("function"==typeof OffscreenCanvas&&"function"==typeof requestAnimationFrame&&"function"==typeof SharedArrayBuffer)return!0}function Z(e){var t=new Date(e);return t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()+":"+t.getMilliseconds()}function ee(){var e=(new Date).getTime(),t=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(r){var n=16*Math.random();return e>0?(n=(e+n)%16|0,e=Math.floor(e/16)):(n=(t+n)%16|0,t=Math.floor(t/16)),("x"===r?n:3&n|8).toString(16)}))}function te(){return"prod"!=={}.BUILD_ENV}var re=D((function e(){var t=this;R(this,e),this.resolve=null,this.reject=null,this.promise=new Promise((function(e,r){t.resolve=e,t.reject=r}))}));function ne(e,t){return new Promise((function(r,n){var i=setTimeout((function(){n("timeout")}),e);t.then((function(e){clearTimeout(i),r(e)}),(function(e){clearTimeout(i),n(e)}))}))}function ie(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""}function ae(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""}var oe=[{test:function(e){var t=e.match(/OpenHarmony (\d+\.?\d*)/);return(null==t?void 0:t.length)&&Number(t[1])>=5},describe:function(e){return["HarmonyOS",ie(/OpenHarmony (\d+\.?\d*)/i,e)]}},{test:[/windows /i],describe:function(e){return["Windows",ie(/Windows ((NT|XP)( \d\d?.\d)?)/i,e)]}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){return["iOS",ae(/(Version\/)(\d[\d.]+)/,e)]}},{test:[/macintosh/i],describe:function(e){return["macOS",ie(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,".")]}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){return["iOS",ie(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".")]}},{test:function(e){return!/like android/i.test(e)&&/android/i.test(e)},describe:function(e){return["Android",ie(/android[\s/-](\d+(\.\d+)*)/i,e)]}},{test:[/linux/i],describe:function(){return["Linux"]}},{test:[/CrOS/],describe:function(){return["ChromeOS"]}}];function se(e){var t=oe.find((function(t){return"function"==typeof t.test?t.test(e):t.test.some((function(t){return t.test(e)}))}));return t?t.describe(e)[0]:"unknown"}function ue(e){return{top:B.TOP,bottom:B.BOTTOM,left:B.LEFT,middle:B.MIDDLE,right:B.RIGHT}[e]||B.DEFAULT}var ce=function(e,t){return(ce=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function de(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}ce(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function le(e,t){var r,n,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}function he(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function fe(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)o.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return o}function pe(e,t,r){if(2===arguments.length)for(var n,i=0,a=t.length;i<a;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}function ve(e){return this instanceof ve?(this.v=e,this):new ve(e)}function ge(e){return"function"==typeof e}function me(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var ye=me((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function _e(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var Se=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,r,n,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var o=he(a),s=o.next();!s.done;s=o.next())s.value.remove(this)}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else a.remove(this);var u=this.initialTeardown;if(ge(u))try{u()}catch(e){i=e instanceof ye?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var d=he(c),l=d.next();!l.done;l=d.next()){var h=l.value;try{Ee(h)}catch(e){i=null!=i?i:[],e instanceof ye?i=pe(pe([],fe(i)),fe(e.errors)):i.push(e)}}}catch(e){r={error:e}}finally{try{l&&!l.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}}if(i)throw new ye(i)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)Ee(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&_e(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&_e(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),Ae=Se.EMPTY;function be(e){return e instanceof Se||e&&"closed"in e&&ge(e.remove)&&ge(e.add)&&ge(e.unsubscribe)}function Ee(e){ge(e)?e():e.unsubscribe()}var ke={setTimeout:function(e){function t(t,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=ke.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,pe([e,t],fe(r))):setTimeout.apply(void 0,pe([e,t],fe(r)))})),clearTimeout:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t=ke.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)})),delegate:void 0};function Ce(e){ke.setTimeout((function(){throw e}))}function we(){}function Te(e){e()}var Re=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,be(t)&&t.add(r)):r.destination=Oe,r}return de(t,e),t.create=function(e,t,r){return new De(e,t,r)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Se),Ie=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Me(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Me(e)}else Me(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Me(e)}},e}(),De=function(e){function t(t,r,n){var i,a=e.call(this)||this;return i=ge(t)||!t?{next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:t,a.destination=new Ie(i),a}return de(t,e),t}(Re);function Me(e){Ce(e)}var Oe={closed:!0,next:we,error:function(e){throw e},complete:we},xe="function"==typeof Symbol&&Symbol.observable||"@@observable";function Pe(e){return e}var Le=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n,i=this,a=(n=e)&&n instanceof Re||function(e){return e&&ge(e.next)&&ge(e.error)&&ge(e.complete)}(n)&&be(n)?e:new De(e,t,r);return Te((function(){var e=i,t=e.operator,r=e.source;a.add(t?t.call(a,r):r?i._subscribe(a):i._trySubscribe(a))})),a},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=Ne(t))((function(t,n){var i=new De({next:function(t){try{e(t)}catch(e){n(e),i.unsubscribe()}},error:n,complete:t});r.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[xe]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(e){return 0===e.length?Pe:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Ne(e))((function(e,r){var n;t.subscribe((function(e){return n=e}),(function(e){return r(e)}),(function(){return e(n)}))}))},e.create=function(t){return new e(t)},e}();function Ne(e){var t;return null!==(t=null!=e?e:void 0)&&void 0!==t?t:Promise}function Ve(e){return function(t){if(function(e){return ge(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function Ue(e,t,r,n,i){return new Fe(e,t,r,n,i)}var Fe=function(e){function t(t,r,n,i,a,o){var s=e.call(this,t)||this;return s.onFinalize=a,s.shouldUnsubscribe=o,s._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return de(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Re),Be=me((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),We=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return de(t,e),t.prototype.lift=function(e){var t=new Ge(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new Be},t.prototype.next=function(e){var t=this;Te((function(){var r,n;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=he(t.currentObservers),a=i.next();!a.done;a=i.next())a.value.next(e)}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}}}))},t.prototype.error=function(e){var t=this;Te((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var r=t.observers;r.length;)r.shift().error(e)}}))},t.prototype.complete=function(){var e=this;Te((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,r=this,n=r.hasError,i=r.isStopped,a=r.observers;return n||i?Ae:(this.currentObservers=null,a.push(e),new Se((function(){t.currentObservers=null,_e(a,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,r=t.hasError,n=t.thrownError,i=t.isStopped;r?e.error(n):i&&e.complete()},t.prototype.asObservable=function(){var e=new Le;return e.source=this,e},t.create=function(e,t){return new Ge(e,t)},t}(Le),Ge=function(e){function t(t,r){var n=e.call(this)||this;return n.destination=t,n.source=r,n}return de(t,e),t.prototype.next=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,e)},t.prototype.error=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==r?r:Ae},t}(We),He=function(e){function t(t){var r=e.call(this)||this;return r._value=t,r}return de(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},t.prototype.getValue=function(){var e=this,t=e.hasError,r=e.thrownError,n=e._value;if(t)throw r;return this._throwIfClosed(),n},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(We),je=function(){return Date.now()},Ke=function(e){function t(t,r){return e.call(this)||this}return de(t,e),t.prototype.schedule=function(e,t){return this},t}(Se),ze={setInterval:function(e){function t(t,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=ze.delegate;return(null==i?void 0:i.setInterval)?i.setInterval.apply(i,pe([e,t],fe(r))):setInterval.apply(void 0,pe([e,t],fe(r)))})),clearInterval:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t=ze.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)})),delegate:void 0},qe=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.scheduler=t,n.work=r,n.pending=!1,n}return de(t,e),t.prototype.schedule=function(e,t){var r;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,t)),this.pending=!0,this.delay=t,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,r){return void 0===r&&(r=0),ze.setInterval(e.flush.bind(e,this),r)},t.prototype.recycleAsyncId=function(e,t,r){if(void 0===r&&(r=0),null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&ze.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var r,n=!1;try{this.work(e)}catch(e){n=!0,r=e||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),r},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,r=this.scheduler,n=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,_e(n,this),null!=t&&(this.id=this.recycleAsyncId(r,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(Ke),Ye=function(){function e(t,r){void 0===r&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(e,t,r){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},e.now=je,e}(),Xe=new(function(e){function t(t,r){void 0===r&&(r=Ye.now);var n=e.call(this,t,r)||this;return n.actions=[],n._active=!1,n}return de(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var r;this._active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}},t}(Ye))(qe);new Le((function(e){return e.complete()}));function Qe(e){return e[e.length-1]}function Je(e){return(t=Qe(e))&&ge(t.schedule)?e.pop():void 0;var t}var $e=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Ze(e){return ge(null==e?void 0:e.then)}function et(e){return ge(e[xe])}function tt(e){return Symbol.asyncIterator&&ge(null==e?void 0:e[Symbol.asyncIterator])}function rt(e){return new TypeError("You provided "+(null!==e&&"object"===j(e)?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var nt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function it(e){return ge(null==e?void 0:e[nt])}function at(e){return function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),a=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",(function(e){return function(t){return Promise.resolve(t).then(e,c)}})),n[Symbol.asyncIterator]=function(){return this},n;function o(e,t){i[e]&&(n[e]=function(t){return new Promise((function(r,n){a.push([e,t,r,n])>1||s(e,t)}))},t&&(n[e]=t(n[e])))}function s(e,t){try{(r=i[e](t)).value instanceof ve?Promise.resolve(r.value.v).then(u,c):d(a[0][2],r)}catch(e){d(a[0][3],e)}var r}function u(e){s("next",e)}function c(e){s("throw",e)}function d(e,t){e(t),a.shift(),a.length&&s(a[0][0],a[0][1])}}(this,arguments,(function(){var t,r,n;return le(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,ve(t.read())];case 3:return r=i.sent(),n=r.value,r.done?[4,ve(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,ve(n)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function ot(e){return ge(null==e?void 0:e.getReader)}function st(e){if(e instanceof Le)return e;if(null!=e){if(et(e))return i=e,new Le((function(e){var t=i[xe]();if(ge(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if($e(e))return n=e,new Le((function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()}));if(Ze(e))return r=e,new Le((function(e){r.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,Ce)}));if(tt(e))return ut(e);if(it(e))return t=e,new Le((function(e){var r,n;try{for(var i=he(t),a=i.next();!a.done;a=i.next()){var o=a.value;if(e.next(o),e.closed)return}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}e.complete()}));if(ot(e))return ut(at(e))}var t,r,n,i;throw rt(e)}function ut(e){return new Le((function(t){(function(e,t){var r,n,i,a;return function(e,t,r,n){return new(r||(r=Promise))((function(t,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,o)}s((n=n.apply(e,[])).next())}))}(this,0,void 0,(function(){var o,s;return le(this,(function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),r=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=he(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){!function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}(n,i,(t=e[r](t)).done,t.value)}))}}}(e),u.label=1;case 1:return[4,r.next()];case 2:if((n=u.sent()).done)return[3,4];if(o=n.value,t.next(o),t.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=u.sent(),i={error:s},[3,11];case 6:return u.trys.push([6,,9,10]),n&&!n.done&&(a=r.return)?[4,a.call(r)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function ct(e,t,r,n,i){void 0===n&&(n=0),void 0===i&&(i=!1);var a=t.schedule((function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()}),n);if(e.add(a),!i)return a}function dt(e,t){return void 0===t&&(t=0),Ve((function(r,n){r.subscribe(Ue(n,(function(r){return ct(n,e,(function(){return n.next(r)}),t)}),(function(){return ct(n,e,(function(){return n.complete()}),t)}),(function(r){return ct(n,e,(function(){return n.error(r)}),t)})))}))}function lt(e,t){return void 0===t&&(t=0),Ve((function(r,n){n.add(e.schedule((function(){return r.subscribe(n)}),t))}))}function ht(e,t){if(!e)throw new Error("Iterable cannot be null");return new Le((function(r){ct(r,t,(function(){var n=e[Symbol.asyncIterator]();ct(r,t,(function(){n.next().then((function(e){e.done?r.complete():r.next(e.value)}))}),0,!0)}))}))}function ft(e,t){return t?function(e,t){if(null!=e){if(et(e))return function(e,t){return st(e).pipe(lt(t),dt(t))}(e,t);if($e(e))return function(e,t){return new Le((function(r){var n=0;return t.schedule((function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())}))}))}(e,t);if(Ze(e))return function(e,t){return st(e).pipe(lt(t),dt(t))}(e,t);if(tt(e))return ht(e,t);if(it(e))return function(e,t){return new Le((function(r){var n;return ct(r,t,(function(){n=e[nt](),ct(r,t,(function(){var e,t,i;try{t=(e=n.next()).value,i=e.done}catch(e){return void r.error(e)}i?r.complete():r.next(t)}),0,!0)})),function(){return ge(null==n?void 0:n.return)&&n.return()}}))}(e,t);if(ot(e))return function(e,t){return ht(at(e),t)}(e,t)}throw rt(e)}(e,t):st(e)}var pt=me((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}})),vt=me((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}}));function gt(e){throw new vt(e)}var mt=Array.isArray,yt=Array.isArray,_t=Object.getPrototypeOf,St=Object.prototype,At=Object.keys;function bt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Je(e),n=function(e){return ge(Qe(e))?e.pop():void 0}(e),i=function(e){if(1===e.length){var t=e[0];if(yt(t))return{args:t,keys:null};if((n=t)&&"object"===j(n)&&_t(n)===St){var r=At(t);return{args:r.map((function(e){return t[e]})),keys:r}}}var n;return{args:e,keys:null}}(e),a=i.args,o=i.keys;if(0===a.length)return ft([],r);var s=new Le(function(e,t,r){return void 0===r&&(r=Pe),function(n){Et(t,(function(){for(var i=e.length,a=new Array(i),o=i,s=i,u=function(i){Et(t,(function(){var u=ft(e[i],t),c=!1;u.subscribe(Ue(n,(function(e){a[i]=e,c||(c=!0,s--),s||n.next(r(a.slice()))}),(function(){--o||n.complete()})))}),n)},c=0;c<i;c++)u(c)}),n)}}(a,r,o?function(e){return function(e,t){return e.reduce((function(e,r,n){return e[r]=t[n],e}),{})}(o,e)}:Pe));return n?s.pipe(function(e){return t=function(t){return function(e,t){return mt(t)?e.apply(void 0,pe([],fe(t))):e(t)}(e,t)},Ve((function(e,r){var n=0;e.subscribe(Ue(r,(function(e){r.next(t.call(void 0,e,n++))})))}));var t}(n)):s}function Et(e,t,r){e?ct(r,e,t):t()}function kt(e,t){return Ve((function(r,n){var i=0;r.subscribe(Ue(n,(function(r){return e.call(t,r,i++)&&n.next(r)})))}))}function Ct(e){return Ve((function(t,r){var n,i=null,a=!1;i=t.subscribe(Ue(r,void 0,void 0,(function(o){n=st(e(o,Ct(e)(t))),i?(i.unsubscribe(),i=null,n.subscribe(r)):a=!0}))),a&&(i.unsubscribe(),i=null,n.subscribe(r))}))}function wt(){return new pt}function Tt(e,t){var r=arguments.length>=2;return function(e){return e.pipe(Pe,Ve((function(e,t){var r=0;e.subscribe(Ue(t,(function(e){++r<=1&&(t.next(e),1<=r&&t.complete())})))})),r?function(e){return Ve((function(t,r){var n=!1;t.subscribe(Ue(r,(function(e){n=!0,r.next(e)}),(function(){n||r.next(e),r.complete()})))}))}(t):function(e){return void 0===e&&(e=wt),Ve((function(t,r){var n=!1;t.subscribe(Ue(r,(function(e){n=!0,r.next(e)}),(function(){return n?r.complete():r.error(e())})))}))}((function(){return new pt})))}}function Rt(e){return Ve((function(t,r){st(e).subscribe(Ue(r,(function(){return r.complete()}),we)),!r.closed&&t.subscribe(r)}))}var It=D((function e(t){R(this,e),this.livePlayer=t,this.destroy$=new We}),[{key:"init",value:function(e){this.initSubscription()}},{key:"destroy",value:function(){this.destroy$.next(),this.destroy$.complete()}}]),Dt=D((function e(){R(this,e)}),null,[{key:"get",value:function(e,t){var r=this.map.get(e),n=r.get(t);return n||(n=new He(null),r.set(t,n)),n}},{key:"on",value:function(e,t,r){return r?this.get(e,t).pipe(kt((function(e,t){return 1<=t})),kt((function(e){return null!==e}))):this.get(e,t).pipe(kt((function(e){return null!==e})))}},{key:"dispatch",value:function(e,t,r){this.get(e,t).next(r)}},{key:"ofKey",value:function(e){var t=this;return{getVal:function(r){return t.get(e,r).value},on:function(r){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t.on(e,r,n)},dispatch:function(r,n){return t.dispatch(e,r,n)}}}},{key:"reset",value:function(){this.map=new Map([[0,new Map],[1,new Map],[2,new Map]])}}]);Dt.map=new Map([[0,new Map],[1,new Map],[2,new Map]]);var Mt=Dt.ofKey(0),Ot=Dt.ofKey(1),xt=Dt.ofKey(2),Pt=function(e){return e[e.AudioDecodeInit=0]="AudioDecodeInit",e[e.VideoDecodeInit=1]="VideoDecodeInit",e[e.SignalAvaliable=2]="SignalAvaliable",e[e.UserJoined=3]="UserJoined",e[e.AudioCanPlay=4]="AudioCanPlay",e[e.PingResult=5]="PingResult",e[e.Failover=6]="Failover",e[e.FirstFrame=7]="FirstFrame",e[e.BlockMonitor=8]="BlockMonitor",e[e.BindEvent=9]="BindEvent",e[e.Resolution=10]="Resolution",e[e.FPS=11]="FPS",e[e.UpdateWatermark=12]="UpdateWatermark",e[e.UpdateActiveAudio=13]="UpdateActiveAudio",e}(Pt||{}),Lt=function(e){return e[e.KeepAlive=0]="KeepAlive",e[e.Subscribe=12303]="Subscribe",e[e.Unsubscribe=12305]="Unsubscribe",e[e.DataChannelOffer=24321]="DataChannelOffer",e[e.QosReceiverCmd=4107]="QosReceiverCmd",e[e.IDRRequest=12307]="IDRRequest",e[e.MonitorLog=4111]="MonitorLog",e[e.WorkerReady=4113]="WorkerReady",e[e.SendBulletScreen=4197]="SendBulletScreen",e[e.RemoveUDPConn=24323]="RemoveUDPConn",e[e.SendTiming=4200]="SendTiming",e[e.SendReaction=4201]="SendReaction",e[e.SendQA=4206]="SendQA",e[e.RewindTokenRefresh=4211]="RewindTokenRefresh",e}(Lt||{}),Nt=function(e){return e[e.SubscribeResponse=12304]="SubscribeResponse",e[e.UnsubscribeResponse=12306]="UnsubscribeResponse",e[e.DataChannelAnswer=24322]="DataChannelAnswer",e[e.LiveSessionStatus=12312]="LiveSessionStatus",e[e.QosSenderReport=4106]="QosSenderReport",e[e.LTTData=4108]="LTTData",e[e.JoinResult=4098]="JoinResult",e[e.ServiceNumber=4112]="ServiceNumber",e[e.BulletScreen=4198]="BulletScreen",e[e.MultiCompressedBulletScreen=4199]="MultiCompressedBulletScreen",e[e.ReactionStatistics=4202]="ReactionStatistics",e[e.MultiBulletScreen=4203]="MultiBulletScreen",e[e.Billboard=4204]="Billboard",e[e.ChatSettings=4205]="ChatSettings",e[e.QA=4207]="QA",e[e.RewindResources=4210]="RewindResources",e}(Nt||{}),Vt=function(e){function t(e,r,n){var i;R(this,t),(i=c(this,t,[e])).workerBase=r,i.audioJoined=!1,i.currentQosValue=null,i.enableTCP=!1,i.isEnableQOSMonitor=!1,i.isDestroyed=!1;var a={globalTracingLogger:n,isSessionBranding:!0,callback:Mt.dispatch,mediaSDKConfig:{mediaSDKCDNPath:i.workerBase,mediaFeatureOptions:""},platformMode:{isLSSPlayer:!0},enableMultiDecodeVideoWithoutSAB:!("function"==typeof SharedArrayBuffer)};return i.mediaSdkInstance=new M(a),i}return f(t,e),D(t,[{key:"init",value:function(e){var r=this,n=e.url,i=e.cid,a=e.udpPolicy,o=e.lobbyId,u=e.enableTCP,c=e.enableWebtransport,d=e.webtransportPort;if(!this.isDestroyed){var l;s(t,"init",this)([]);var h=!0;te()&&(l=new URL(window.location).searchParams.get("log_addr"),h=!!new URL(window.location).searchParams.get("log")),this.mediaSdkInstance.setProps({meetingParams:{confId:"0",userId:i,meetingNumber:o,cid:i,rwgHost:new URL(n).host,enableWebtransport:c,webtransportPort:d},mediaParams:{videoDecodeThreadNum:$()?25:1,isEnableHW:!0,logHost:l?"".concat(l,"/lss_video_").concat(i,".log"):void 0,hasLog:h,udpPolicy:a,enableTCP:u}});var f=new re,v=new re;return this.enableTCP=u,this.mediaSdkInstance.initVideoDecode().then((function(e){var t;null===(t=f.resolve)||void 0===t||t.call(f,e),r.isDestroyed||(r.livePlayer.sendToMedia(p.ENABLE_VIDEO_OBSERVER,{enable:!0}),xt.dispatch(Pt.VideoDecodeInit,!0),r.livePlayer.sendToSignal(Lt.WorkerReady,{type:x.Video}))})).catch((function(){var e;return null===(e=f.resolve)||void 0===e?void 0:e.call(f,!1)})),this.mediaSdkInstance.initAudioDecode().then((function(e){var t;null===(t=v.resolve)||void 0===t||t.call(v,e),r.isDestroyed||(xt.dispatch(Pt.AudioDecodeInit,!0),r.livePlayer.sendToSignal(Lt.WorkerReady,{type:x.Audio}))})).catch((function(){var e;return null===(e=v.resolve)||void 0===e?void 0:e.call(v,!1)})),Promise.all([f.promise,v.promise])}}},{key:"initSubscription",value:function(){var e=this;Mt.on(E.DATA_CHANNEL_OFFER).pipe(Rt(this.destroy$)).subscribe((function(t){t&&t.offer&&e.livePlayer.sendToSignal(Lt.DataChannelOffer,{offer:t.offer})})),Ot.on(Nt.DataChannelAnswer).pipe(Rt(this.destroy$)).subscribe((function(t){e.livePlayer.sendToMedia(p.COMMAND_SOCKET_MESSAGE_NOTIFY,C({evt:Nt.DataChannelAnswer},t))})),Ot.on(Nt.QosSenderReport).pipe(Rt(this.destroy$)).subscribe((function(t){e.livePlayer.sendToMedia(p.QOS_SENDER_REPORT,{data:X(t.report)})})),Mt.on(E.QOS_RECEIVER_CMD).pipe(Rt(this.destroy$)).subscribe((function(t){t&&e.livePlayer.sendToSignal(Lt.QosReceiverCmd,{cmd:J(t)})})),Mt.on(k).pipe(Rt(this.destroy$)).subscribe((function(t){t&&("error"===W(t)&&e.livePlayer.emit("bad-quality","video"),e.calculateVideoChange(t),e.livePlayer.emit("video-analytics",t))})),bt([Mt.on(E.FIRST_FRAME),Mt.on(k).pipe(kt((function(e){return!!e})))]).pipe(Tt(),Rt(this.destroy$)).subscribe((function(t){var r=v(t,2)[1];e.livePlayer.emit("render-success",C(C({},r),{},{networkType:e.livePlayer.networkType}))})),Mt.on("AUDIO_QOS_DATA").pipe(Rt(this.destroy$)).subscribe((function(t){t&&("error"===W(t)&&e.livePlayer.emit("bad-quality","audio"),e.livePlayer.emit("audio-analytics",t))})),Mt.on(E.MONITOR_LOG).pipe(Rt(this.destroy$)).subscribe((function(t){t&&e.livePlayer.sendToSignal(Lt.MonitorLog,{mlog:t.body.data})})),Mt.on(E.DATACHANNEL_RECOVER).pipe(Rt(this.destroy$)).subscribe((function(t){var r=t.type;e.livePlayer.networkType="DataChannel-UDP",e.livePlayer.emit("network-type-change",{networkType:e.livePlayer.networkType,msg:"WebSocket-TCP changes to DataChannel-UDP",type:"a"===r?"audio":"video"})})),Mt.on(E.SEND_MESSAGE_TO_RWG).pipe(Rt(this.destroy$)).subscribe((function(t){var r;24323===(null==t?void 0:t.evt)&&2===(null==t||null===(r=t.body)||void 0===r?void 0:r.flag)&&(e.livePlayer.sendToSignal(Lt.RemoveUDPConn,t.body),e.livePlayer.networkType="WebSocket-TCP",e.livePlayer.emit("network-type-change",{networkType:e.livePlayer.networkType,msg:"WebTransport-UDP changes to WebSocket-TCP",type:t.body.type===x.Audio?"audio":"video"}))})),Mt.on(E.DATACHANNEL_CLOSE).pipe(Rt(this.destroy$)).subscribe((function(t){var r=t.dataChannelCanOpen,n=t.type;e.enableTCP?(e.livePlayer.sendToSignal(Lt.RemoveUDPConn,{type:"a"===n?x.Audio:x.Video,flag:1}),e.livePlayer.networkType="WebSocket-TCP",e.livePlayer.emit("network-type-change",{networkType:e.livePlayer.networkType,msg:"DataChannel-UDP changes to WebSocket-TCP",type:"a"===n?"audio":"video"})):r?e.livePlayer.emit("player-error",{code:P.UDPClosed,reason:L.UDPClosed}):e.livePlayer.emit("player-error",{code:P.UDPBlock,reason:L.UDPBlock})})),Ot.on(Nt.ServiceNumber).pipe(Tt(),Rt(this.destroy$)).subscribe((function(t){t&&t.cook&&e.livePlayer.sendToMedia(p.UPDATE_COOK,{cook:X(t.cook)})})),bt([Mt.on(E.AUDIO_WEBSOCKET_BROKEN),Mt.on(E.VIDEO_WEBSOCKET_BROKEN)]).pipe(Tt(),Rt(this.destroy$)).subscribe((function(){"WebSocket-TCP"===e.livePlayer.networkType&&e.livePlayer.emit("player-error",{code:P.TCPMediaError,reason:L.TCPMediaError})}))}},{key:"toggleQosMonitor",value:function(e){e!==this.isEnableQOSMonitor&&(this.mediaSdkInstance.updateQosSubscription(e,"1",1e3),this.mediaSdkInstance.updateQosSubscription(e,"3",1e3),this.isEnableQOSMonitor=e)}},{key:"calculateVideoChange",value:function(e){if(e){if(this.currentQosValue){var t=this.currentQosValue.height,r=e.height;t!==r&&this.livePlayer.emit("resolution-change",{oldVal:t,newVal:r})}this.currentQosValue=e}}},{key:"playAudio",value:function(){this.audioJoined||(this.sendToMedia(p.JOIN_COMPUTER_AUDIO,{checkAutoplay:!0,CaptureAudioInfo:{ssrc:""},speakerInfo:{defaultDeviceId:"default"},disableBrowserAec:!0}),this.audioJoined=!0)}},{key:"stopAudio",value:function(){this.audioJoined&&(this.sendToMedia(p.LEAVE_COMPUTER_AUDIO,{}),this.audioJoined=!1)}},{key:"enableHardwareDecode",value:function(e){this.sendToMedia(p.VIDEO_ENABLE_DECODE_HW,{enable:e})}},{key:"changeAudioVolume",value:function(e){this.sendToMedia(p.CHANGE_AUDIO_VOLUME,e)}},{key:"setWatermark",value:function(e){this.sendToMedia(p.SWITCH_WATER_MARK_FLAG,e),M.util.watermark.updateWaterMarkInfo(e)}},{key:"getWatermarkData",value:function(e){return M.util.watermark.getWaterMarkData(e)}},{key:"destroy",value:(r=H(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(t,"destroy",this)([]),this.currentQosValue=null,e.next=4,this.mediaSdkInstance.JsMediaSDK_UnInit();case 4:return e.next=6,this.mediaSdkInstance.destroy();case 6:this.isDestroyed=!0;case 7:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"sendToMedia",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.mediaSdkInstance.Notify_MeidaSDK(e,t)}}],[{key:"preload",value:function(e){new M({mediaSDKConfig:{mediaSDKCDNPath:e,mediaFeatureOptions:"101110000010110100110100100110101101110110110105"},platformMode:{isLSSPlayer:!0}}).setupLocalPreview({videoDecode:{},audioDecode:{}})}}]);var r}(It),Ut=D((function e(){R(this,e)}),null,[{key:"setAgent",value:function(e){this.agent=e}},{key:"init",value:function(e){this.tags=e}},{key:"log",value:function(e){var t,r;null===(t=this.agent)||void 0===t||null===(r=t.log)||void 0===r||r.call(t,e,this.tags)}},{key:"warn",value:function(e){var t,r;null===(t=this.agent)||void 0===t||null===(r=t.warn)||void 0===r||r.call(t,e,this.tags)}},{key:"info",value:function(e){var t,r;null===(t=this.agent)||void 0===t||null===(r=t.info)||void 0===r||r.call(t,e,this.tags)}},{key:"error",value:function(e){var t,r;null===(t=this.agent)||void 0===t||null===(r=t.error)||void 0===r||r.call(t,e,this.tags)}},{key:"directReport",value:function(e){var t,r;null===(t=this.agent)||void 0===t||null===(r=t.directReport)||void 0===r||r.call(t,e,this.tags)}}]),Ft=D((function e(){R(this,e)}),null,[{key:"init",value:function(e,t){var r=this;this.cid=e,this.sdk=t,this.interval=window.setInterval((function(){r.send()}),6e4)}},{key:"add",value:function(e){Ut.log(e),this.cache.push(e)}},{key:"send",value:function(){if(this.sdk&&this.cache.length){var e=this.cache.join(", ");this.sdk.sendToSignal(Lt.MonitorLog,{mlog:e})&&this.clear()}}},{key:"clear",value:function(){this.cache=[]}},{key:"destroy",value:function(){this.send(),window.clearInterval(this.interval),this.interval=0}}]);Ft.cid="",Ft.sdk=null,Ft.cache=[],Ft.interval=0;var Bt=function(){function e(t,r,n,i,a){return R(this,e),this.node=document.createElement(t),r&&(this.node.id=r),e.attachCSS(this.node,n),i&&e.attachCSS(this.node,{width:"".concat(i,"px")}),a&&e.attachCSS(this.node,{height:"".concat(a,"px")}),this}return D(e,[{key:"element",get:function(){return this.node}},{key:"class",value:function(e){return this.node&&!this.node.classList.contains(e)&&this.node.classList.add(e),this}},{key:"width",value:function(t){this.node&&e.attachCSS(this.node,{width:"".concat(t,"px")});try{this.node instanceof HTMLCanvasElement&&(this.node.width=t*(window.devicePixelRatio||1))}catch(e){}return this}},{key:"height",value:function(t){this.node&&e.attachCSS(this.node,{height:"".concat(t,"px")});try{this.node instanceof HTMLCanvasElement&&(this.node.height=t*(window.devicePixelRatio||1))}catch(e){}return this}},{key:"commit",value:function(e){return e.appendChild(this.node),this}},{key:"remove",value:function(){this.element.remove()}}],[{key:"attachCSS",value:function(e,t){for(var r in t)t[r]&&(e.style[r]=t[r])}}])}();function Wt(){}function Gt(){Gt.init.call(this)}function Ht(e){return void 0===e._maxListeners?Gt.defaultMaxListeners:e._maxListeners}function jt(e,t,r,n){var i,a,o;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),o=a[t]):(a=e._events=new Wt,e._eventsCount=0),o){if("function"==typeof o?o=a[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),!o.warned&&(i=Ht(e))&&i>0&&o.length>i){o.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=o.length,function(e){"function"==typeof console.warn?console.warn(e):console.log(e)}(s)}}else o=a[t]=r,++e._eventsCount;return e}function Kt(e,t,r){var n=!1;function i(){e.removeListener(t,i),n||(n=!0,r.apply(e,arguments))}return i.listener=r,i}function zt(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function qt(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}Wt.prototype=Object.create(null),Gt.EventEmitter=Gt,Gt.usingDomains=!1,Gt.prototype.domain=void 0,Gt.prototype._events=void 0,Gt.prototype._maxListeners=void 0,Gt.defaultMaxListeners=10,Gt.init=function(){this.domain=null,Gt.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Wt,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Gt.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},Gt.prototype.getMaxListeners=function(){return Ht(this)},Gt.prototype.emit=function(e){var t,r,n,i,a,o,s,u="error"===e;if(o=this._events)u=u&&null==o.error;else if(!u)return!1;if(s=this.domain,u){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(r=o[e]))return!1;var d="function"==typeof r;switch(n=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var n=e.length,i=qt(e,n),a=0;a<n;++a)i[a].call(r)}(r,d,this);break;case 2:!function(e,t,r,n){if(t)e.call(r,n);else for(var i=e.length,a=qt(e,i),o=0;o<i;++o)a[o].call(r,n)}(r,d,this,arguments[1]);break;case 3:!function(e,t,r,n,i){if(t)e.call(r,n,i);else for(var a=e.length,o=qt(e,a),s=0;s<a;++s)o[s].call(r,n,i)}(r,d,this,arguments[1],arguments[2]);break;case 4:!function(e,t,r,n,i,a){if(t)e.call(r,n,i,a);else for(var o=e.length,s=qt(e,o),u=0;u<o;++u)s[u].call(r,n,i,a)}(r,d,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),a=1;a<n;a++)i[a-1]=arguments[a];!function(e,t,r,n){if(t)e.apply(r,n);else for(var i=e.length,a=qt(e,i),o=0;o<i;++o)a[o].apply(r,n)}(r,d,this,i)}return!0},Gt.prototype.addListener=function(e,t){return jt(this,e,t,!1)},Gt.prototype.on=Gt.prototype.addListener,Gt.prototype.prependListener=function(e,t){return jt(this,e,t,!0)},Gt.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,Kt(this,e,t)),this},Gt.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Kt(this,e,t)),this},Gt.prototype.removeListener=function(e,t){var r,n,i,a,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener&&r.listener===t)0==--this._eventsCount?this._events=new Wt:(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,a=r.length;a-- >0;)if(r[a]===t||r[a].listener&&r[a].listener===t){o=r[a].listener,i=a;break}if(i<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new Wt,this;delete n[e]}else!function(e,t){for(var r=t,n=r+1,i=e.length;n<i;r+=1,n+=1)e[r]=e[n];e.pop()}(r,i);n.removeListener&&this.emit("removeListener",e,o||t)}return this},Gt.prototype.removeAllListeners=function(e){var t,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new Wt,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new Wt:delete r[e]),this;if(0===arguments.length){for(var n,i=Object.keys(r),a=0;a<i.length;++a)"removeListener"!==(n=i[a])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new Wt,this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},Gt.prototype.listeners=function(e){var t,r=this._events;return r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):[]},Gt.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):zt.call(e,t)},Gt.prototype.listenerCount=zt,Gt.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};for(var Yt=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{loadingLimit:5e3,latencyLimit:2e3,fpsLimitMap:{1:5,2:8,3:10,4:10},sampleFrequency:5};return R(this,t),(e=c(this,t)).hintParams=r,e.level=N.Green,e.reason=V.Unknown,e.currentStatus={},e.wipStatus={},e.interval=0,e.loadingTimeout=0,e.isPaused=!1,e}return f(t,e),D(t,[{key:"updateLevel",value:function(e,t){this.level=e,this.reason=t}},{key:"init",value:function(){var e=this;this.interval=window.setInterval((function(){e.currentStatus=e.wipStatus,e.level=N.Green,e.reason=V.Unknown,e.isPaused||(e.handleLoadingTimeout(),e.handleResolution(),e.handleLatency(),e.handleAVSync(),e.handleQoSStatus(),e.handleLowFPS()),e.emit("change",{level:e.level,reason:e.reason})}),1e3*this.hintParams.sampleFrequency)}},{key:"destroy",value:function(){this.level=N.Green,this.reason=V.Unknown,this.currentStatus={},this.wipStatus={},this.interval&&(clearInterval(this.interval),this.interval=0),this.loadingTimeout&&(clearTimeout(this.loadingTimeout),this.loadingTimeout=0)}},{key:"pause",value:function(e){this.isPaused=e}},{key:"loadingStart",value:function(){var e=this;this.loadingTimeout=window.setTimeout((function(){e.wipStatus.loadingTimeout=!0}),this.hintParams.loadingLimit)}},{key:"loadingEnd",value:function(){window.clearTimeout(this.loadingTimeout),this.wipStatus.loadingTimeout=!0}},{key:"updateStatus",value:function(e){this.wipStatus=C(C({},this.wipStatus),e)}},{key:"handleLoadingTimeout",value:function(){this.currentStatus.loadingTimeout&&this.updateLevel(N.Yellow,V.LongLoading)}},{key:"handleResolution",value:function(){void 0!==this.currentStatus.subInfo&&{0:90,1:180,2:360,3:720,4:1080}[this.currentStatus.subInfo]!==this.currentStatus.resolution&&this.updateLevel(N.Yellow,V.LowResolution)}},{key:"handleLatency",value:function(){void 0!==this.currentStatus.latency&&this.currentStatus.latency>this.hintParams.latencyLimit&&this.updateLevel(N.Yellow,V.LongLatency)}},{key:"handleAVSync",value:function(){this.currentStatus.noSync&&this.updateLevel(N.Yellow,V.AVNotSync)}},{key:"handleQoSStatus",value:function(){this.currentStatus.qosInfo&&this.currentStatus.qosInfo.level&&(2===this.currentStatus.qosInfo.level?this.updateLevel(N.Yellow,V.QoSReport):3===this.currentStatus.qosInfo.level&&this.updateLevel(N.Red,V.QoSReport))}},{key:"handleLowFPS",value:function(){if(this.currentStatus.subInfo){var e=this.hintParams.fpsLimitMap[this.currentStatus.subInfo];void 0!==this.currentStatus.fps&&this.currentStatus.fps<e&&this.updateLevel(N.Red,V.LowFPS)}}}])}(Gt),Xt=[],Qt=0;Qt<=1;Qt+=.01)Xt.push(Qt);var Jt=document.createElement("template");Jt.innerHTML='\n  <style>\n    .media-controls-button-panel-wrapper {\n      position: absolute;\n      bottom: 0;\n      width: 100%;\n      height: 72px;\n      background-color: rgba(27, 27, 27, 0.5);\n      cursor: pointer;\n      display: block;\n    }\n    .live-video-div-wrapper:hover .media-controls-button-panel-wrapper {\n      display: block;\n    }\n    .media-controls-button-panel {\n      align-items: center;\n      justify-content: space-between;\n      display: flex;\n    }\n    .media-controls-button {\n      width: 48px;\n      height: 48px;\n      min-width: 48px;\n      background-size: 20px;\n      cursor: pointer;\n      background-repeat: no-repeat;\n      background-position: center center;\n      padding: 0px;\n      border-width: 0px;\n      background-color: transparent;\n    }\n    .media-controls-play-button {\n      background-image: url(data:image/svg+xml;base64,PHN2ZyBmaWxsPSJXaW5kb3ciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgPHBhdGggZD0iTTYgMTloNFY1SDZ2MTR6bTgtMTR2MTRoNFY1aC00eiIvPgogICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPgo8L3N2Zz4K);\n    }\n    .media-controls-play-button-pause {\n      background-image: url(data:image/svg+xml;base64,PHN2ZyBmaWxsPSJXaW5kb3ciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgPHBhdGggZD0iTTggNXYxNGwxMS03eiIvPgogICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPgo8L3N2Zz4K);\n    }\n    .media-controls-control-container {\n      height: 48px;\n      box-sizing: border-box;\n      display: flex;\n      align-items: center;\n    }\n    .media-controls-volume-slider {\n      height: 4px;\n      width: 80px;\n      padding: 22px 0;\n    }\n    .media-controls-mute-button {\n      background-image: url(data:image/svg+xml;base64,PHN2ZyBmaWxsPSJXaW5kb3ciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgPHBhdGggZD0iTTMgOXY2aDRsNSA1VjRMNyA5SDN6bTEzLjUgM2MwLTEuNzctMS4wMi0zLjI5LTIuNS00LjAzdjguMDVjMS40OC0uNzMgMi41LTIuMjUgMi41LTQuMDJ6TTE0IDMuMjN2Mi4wNmMyLjg5Ljg2IDUgMy41NCA1IDYuNzFzLTIuMTEgNS44NS01IDYuNzF2Mi4wNmM0LjAxLS45MSA3LTQuNDkgNy04Ljc3cy0yLjk5LTcuODYtNy04Ljc3eiIvPgogICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPgo8L3N2Zz4K);\n    }\n    .media-controls-mute-button-muted {\n      background-image: url(data:image/svg+xml;base64,PHN2ZyBmaWxsPSJXaW5kb3ciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgPHBhdGggZD0iTTE2LjUgMTJjMC0xLjc3LTEuMDItMy4yOS0yLjUtNC4wM3YyLjIxbDIuNDUgMi40NWMuMDMtLjIuMDUtLjQxLjA1LS42M3ptMi41IDBjMCAuOTQtLjIgMS44Mi0uNTQgMi42NGwxLjUxIDEuNTFDMjAuNjMgMTQuOTEgMjEgMTMuNSAyMSAxMmMwLTQuMjgtMi45OS03Ljg2LTctOC43N3YyLjA2YzIuODkuODYgNSAzLjU0IDUgNi43MXpNNC4yNyAzTDMgNC4yNyA3LjczIDlIM3Y2aDRsNSA1di02LjczbDQuMjUgNC4yNWMtLjY3LjUyLTEuNDIuOTMtMi4yNSAxLjE4djIuMDZjMS4zOC0uMzEgMi42My0uOTUgMy42OS0xLjgxTDE5LjczIDIxIDIxIDE5LjczbC05LTlMNC4yNyAzek0xMiA0TDkuOTEgNi4wOSAxMiA4LjE4VjR6Ii8+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+Cjwvc3ZnPgo=);\n    }\n    .media-controls-resolution, .media-controls-speed {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      color: #fff;\n      position: relative;\n      margin: 0 4px;\n    }\n    .media-controls-speed-hide {\n      display: none;\n    }\n    .media-controls-resolution-select-container, .media-controls-speed-select-container {\n      position: absolute;\n      bottom: 48px;\n      display: none;\n    }\n    .media-controls-speed-show-select .media-controls-speed-select-container {\n      display: block;\n    }\n    .media-controls-resolution-show-select .media-controls-resolution-select-container {\n      display: block;\n    }\n    .media-controls-resolution-select-item, .media-controls-speed-select-item {\n      background-color: rgba(27, 27, 27, 0.5);\n      height: 24px;\n      padding: 2px 4px;\n      border-bottom: 1px solid rgb(27, 27, 0.5);\n    }\n    .media-controls-toggle-closed-captions-button {\n      background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2ZmZmZmZiI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+CiAgICA8cGF0aCBkPSJNMjAgNEg0Yy0xLjEgMC0yIC45LTIgMnYxMmMwIDEuMS45IDIgMiAyaDE2YzEuMSAwIDItLjkgMi0yVjZjMC0xLjEtLjktMi0yLTJ6TTQgMTJoNHYySDR2LTJ6bTEwIDZINHYtMmgxMHYyem02IDBoLTR2LTJoNHYyem0wLTRIMTB2LTJoMTB2MnoiLz4KPC9zdmc+Cg==);\n      position:relative;\n      box-sizing:border-box;\n    }\n    .media-controls-toggle-closed-captions-button-closed::before {\n      content:"";\n      position:absolute;\n      left: 0;\n      top: -24px;\n      width: 100%;\n      height: 48px;\n      box-sizing: border-box;\n      border-bottom: 4px solid white;\n      transform-origin: bottom center;\n      transform:rotateZ(45deg) scale(.5);\n    }\n    .media-controls-timeline-wrapper {\n      height: 24px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      padding: 0 10px;\n    }\n    .media-controls-timeline {\n      flex: 1;\n      opacity: 1;\n      appearance: -internal-media-control;\n      height: 4px;\n      cursor: pointer;\n      -webkit-tap-highlight-color: transparent;\n      box-sizing: unset !important;\n      z-index: 0;\n      transition: opacity 0.5s cubic-bezier(0.25, 0.1, 0.25, 1);\n      margin: 0px;\n      background: transparent;\n    }\n    .media-controls-live-item {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      color: #fff;\n      cursor: default;\n      position: relative;\n    }\n    .media-controls-live-item::before {\n      position: absolute;\n      top: 50%;\n      left: 6px;\n      width: 6px;\n      height: 6px;\n      background-color: red;\n      border-radius: 50%;\n      transform: translate(-50%, -50%);\n      content: "";\n    }\n    .media-controls-live-rewind {\n      cursor: pointer;\n    }\n    .media-controls-live-rewind::before {\n      background-color: #ccc;\n    }\n  </style>\n  <div class="media-controls-button-panel-wrapper">\n    <div class="media-controls-button-panel">\n      <input\n        type="button"\n        class="media-controls-button media-controls-play-button"\n        aria-label="play"\n        style=""\n      />\n      <div class="media-controls-control-container">\n        <input\n          type="range"\n          step="0.01"\n          min="0"\n          max="1"\n          value="0"\n          aria-label="volume"\n          class="media-controls-volume-slider closed"\n          style=""\n        />\n        <input\n          type="button"\n          class="media-controls-button media-controls-mute-button media-controls-mute-button-muted"\n          aria-label="volume"\n          style=""\n        />\n        <div class="media-controls-button media-controls-resolution">\n          <span data-size="4">1080p</span>\n          <div class="media-controls-resolution-select-container">\n            <div class="media-controls-resolution-select-item" data-size="4">1080p</div>\n            <div class="media-controls-resolution-select-item" data-size="3">720p</div>\n            <div class="media-controls-resolution-select-item" data-size="2">360p</div>\n            <div class="media-controls-resolution-select-item" data-size="1">180p</div>\n            <div class="media-controls-resolution-select-item" data-size="0">90p</div>\n          </div>\n        </div>\n        <div class="media-controls-button media-controls-speed media-controls-speed-hide">\n          <span data-size="1">Normal</span>\n          <div class="media-controls-speed-select-container">\n            <div class="media-controls-speed-select-item" data-size="0.5">x0.5</div>\n            <div class="media-controls-speed-select-item" data-size="0.75">x0.75</div>\n            <div class="media-controls-speed-select-item" data-size="1">Normal</div>\n            <div class="media-controls-speed-select-item" data-size="1.25">x1.25</div>\n            <div class="media-controls-speed-select-item" data-size="1.5">x1.5</div>\n            <div class="media-controls-speed-select-item" data-size="1.75">x1.75</div>\n            <div class="media-controls-speed-select-item" data-size="2">x2</div>\n          </div>\n        </div>\n        <div\n          class="media-controls-button media-controls-toggle-closed-captions-button"\n          aria-label="closed-captions"\n          disabled=""\n          style=""\n        ></div>\n        <div\n          class="media-controls-button media-controls-live-item"\n          aria-label=""\n          disabled=""\n          style=""\n        >\n          live\n        </div>\n      </div>\n    </div>\n    <div class="media-controls-timeline-wrapper">\n      <input type="range" class="media-controls-timeline" step="1" min="0" max="100" value="100" />\n    </div>\n  </div>\n';var $t=0,Zt=0;function er(){return 0===$t?0:Zt/$t*100}var tr=document.createElement("template");tr.innerHTML='\n  <style>\n    .live-video-div-wrapper-loading .loading-container {\n      display: flex;\n    }\n    .live-video-div-wrapper-loading-transparent .loading-container {\n      display: flex;\n      background: transparent;\n    }\n    .loading-container {\n      width: 100%;\n      height: 100%;\n      pointer-events: none;\n      background: #000;\n      display: none;\n      justify-content: center;\n      align-items: center;\n      position: absolute;\n    }\n    .loading-spinner {\n      animation: rotator 1.4s linear infinite;\n    }\n    @keyframes rotator {\n      0% {\n        transform: rotate(0deg);\n      }\n      100% {\n        transform: rotate(270deg);\n      }\n    }\n    .path {\n      stroke-dasharray: 187;\n      stroke-dashoffset: 0;\n      transform-origin: center;\n      stroke: #ffffff;\n      animation: dash 1.4s ease-in-out infinite;\n    }\n    @keyframes dash {\n      0% {\n        stroke-dashoffset: 187;\n      }\n      50% {\n        stroke-dashoffset: 46.75;\n        transform: rotate(135deg);\n      }\n      100% {\n        stroke-dashoffset: 187;\n        transform: rotate(450deg);\n      }\n    }\n  </style>\n  <div class="loading-container">\n    <svg class="loading-spinner" width="65px" height="65px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">\n      <circle class="path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle>\n    </svg>\n  </div>\n';var rr="live-session-id",nr="muted",ir="size",ar="track",or="track-slot",sr="lang",ur="controls",cr="volume",dr="loading",lr="loading-size",hr="chat",fr="chat-render",pr="paused",vr="reaction",gr="qa",mr="rewind",yr=function(){function e(){var t;R(this,e),(t=c(this,e)).trackContainer=null,t.removePositionObserve=null,t.videostatus={subscribe:!1,subscribeParam:null,play:!1},t.audioStatus={subscribe:!1,play:!1},t.controlsEventSubscription=null,t.controlsNode=null,t.isFirstRendered=!1,t.controlsEvent=new We,t.playerState=new He({}),t.subState=new He({}),t.rewindState=new He({}),t.currentShadow=null,t.trackDisabled="true"!==t.getAttribute(ar),t.sessionStatusObserve=null,t.loadingObserve=null,t.blockObserve=null,t.eventObserve=null,t.watermarkObserve=null,t.destroy$=new We,t.loadingEl=null,t.firstFrame=!1,t.status="playing",t.ended=!1,t.ccTimeout=0,t.oldLangList=[],t.langList=[],t.closedCaptionStatus=null,t.networkHint=null,t.rewindVideo=null,t.rewindWatermark=null,t.rewindWatermarkSize=null,t.sizeObserver=null,t.rewindCurrentTime=0,t.rewindPlaybackRate=1,t.container=null,t.lastBgColor=null,t.colorObserver=null,t.handleNetworkStatusChange=function(e){t.dispatchEvent(new CustomEvent("network-status",{detail:{status:e.level,code:e.reason}}))};var r=t.innerHTML,n=t.div=document.createElement("div");if(n.style.width="100%",n.style.height="100%",n.style.position="relative",n.classList.add("live-video-div-wrapper"),t.viewId="live-div-"+Math.random().toString(36).slice(-6),0===yr.elements.size){var i=document.getElementById(F);i&&(i.style.visibility="visible")}return yr.elements.set(t.viewId,{el:t}),t.defineCustomAttributes(),t.innerHTML="",n.innerHTML=r,t.attachShadow?(t.currentShadow=t.attachShadow({mode:"open"})).appendChild(n):t.appendChild(n),t.backgroundColor=z(getComputedStyle(t).getPropertyValue("background-color")),t}return f(e,o(HTMLElement)),D(e,[{key:"initAttrs",value:function(){for(var e=0;e<this.attributes.length;e++){var t=this.attributes[e],r=t.nodeName,n=t.nodeValue;"id"===r&&(yr.elements.get(this.viewId)[r]=n)}}},{key:"defineCustomAttributes",value:function(){var e=this;Object.defineProperties(this,yr.customAttributes.reduce((function(t,r){t[r]={get:function(){return e.getAttribute(r)},set:function(t){t?e.setAttribute(r,t):e.removeAttribute(r)}};var n=r.replace(/-([a-z])/g,(function(e,t){return t.toUpperCase()}));return n!==r&&(t[n]=t[r]),t}),{}))}},{key:"initDefaultValues",value:function(){var e=this;Object.entries(yr.defaultValues).forEach((function(t){var r=v(t,2),n=r[0],i=r[1];null===e.getAttribute(n)&&e.setAttribute(n,i)}))}},{key:"getContainer",value:function(){if(this.container||(this.container=this.closest(yr.containerTagName)),!this.container&&yr.useContainer)throw new Error("The ".concat(yr.tagName," must have a ").concat(yr.containerTagName," as its ancestor element."));return this.container}},{key:"initTrackDom",value:function(){if(this.trackContainer=this.div.querySelector('[slot="track"]'),!this.trackContainer){var e=new Bt("div","",{position:"absolute",bottom:"0",width:"100%",textAlign:"center",zIndex:this.sdk.zIndex?String(this.sdk.zIndex+1):"1"}),t=new Bt("span","",{backgroundColor:"rgba(0, 0, 0, 0.8)",color:"#fff",maxWidth:"80%"}).commit(e.element);return this.trackContainer=t.element,this.sdk.zIndex&&(e.element.style.zIndex=String(this.sdk.zIndex+1)),e.element}}},{key:"initInteractive",value:function(){var e=this;this.sdk.on("billboard",(function(t){var r=t.overwrite,n=t.data;String(n.streamId)===e.streamId&&e.dispatchEvent(new CustomEvent("billboard",{detail:{overwrite:r,data:n}}))})),this.sdk.on("reaction",(function(t){var r=t.id,n=t.data;String(r)===e.streamId&&e.dispatchEvent(new CustomEvent("reaction",{detail:n}))})),this.sdk.on("qa",(function(t){var r=t.id,n=t.data;String(r)===e.streamId&&e.dispatchEvent(new CustomEvent("qa",{detail:n}))})),this.sdk.on("chat-settings",(function(t){var r=t.id,n=t.data;String(r)===e.streamId&&e.dispatchEvent(new CustomEvent("chat-settings",{detail:n}))}))}},{key:"initTrack",value:function(){var e=this;this.sdk.on("chat",(function(t){var r=t.id,n=t.data;String(r)===e.streamId&&"false"!==e.getAttribute(hr)&&e.dispatchEvent(new CustomEvent("chat",{detail:n}))})),this.sdk.on("closedCaption",(function(t){var r=t.id,n=t.data;String(r)===e.streamId&&"pause"!==e.status&&("false"!==e.getAttribute(ar)?(e.ccTimeout&&(window.clearTimeout(e.ccTimeout),e.ccTimeout=0),e.ccTimeout=window.setTimeout((function(){e.trackContainer&&(e.trackContainer.innerText=""),e.dispatchEvent(new CustomEvent("closed-caption",{detail:""}))}),1e4),e.trackDisabled=!1,e.trackContainer&&(e.trackContainer.innerText=n),e.dispatchEvent(new CustomEvent("closed-caption",{detail:n}))):e.trackDisabled||(e.trackContainer&&(e.trackContainer.innerText=""),e.trackDisabled=!0))}))}},{key:"initControls",value:function(){var e=this;this.controlsNode=function(e,t,r,n,i,a,o){var s=!0,u=Jt.content.cloneNode(!0),c=y(u.childNodes);e.appendChild(u);var d=e.querySelector(".media-controls-button-panel-wrapper");i&&(d.style.zIndex=String(i+20));var l=e.querySelector(".media-controls-play-button"),h=e.querySelector(".media-controls-volume-slider"),f=e.querySelector(".media-controls-mute-button"),p=e.querySelector(".media-controls-timeline"),v=e.querySelector(".media-controls-live-item"),g=e.querySelector(".media-controls-speed"),m=e.querySelector(".media-controls-speed-select-container"),_=e.querySelector(".media-controls-speed span");r.subscribe((function(e){"false"===e.muted&&(null==f||f.classList.remove("media-controls-mute-button-muted"),"0"===h.value&&(h.value="1"))}));var S=e.querySelector(".media-controls-toggle-closed-captions-button"),A=e.querySelector(".media-controls-resolution"),b=e.querySelector(".media-controls-resolution-select-container"),E=e.querySelector(".media-controls-resolution span");a&&a.subscribe((function(e){E.innerText={4:"1080p",3:"720p",2:"360p",1:"180p",0:"90p"}[e]})),e.addEventListener("click",(function(){null!=A&&A.classList.contains("media-controls-resolution-show-select")&&(null==A||A.classList.remove("media-controls-resolution-show-select")),null!=g&&g.classList.contains("media-controls-speed-show-select")&&(null==g||g.classList.remove("media-controls-speed-show-select"))})),null==l||l.addEventListener("click",(function(){l.classList.contains("media-controls-play-button-pause")?(null==l||l.classList.remove("media-controls-play-button-pause"),t.next({type:"play",data:!0})):(null==l||l.classList.add("media-controls-play-button-pause"),t.next({type:"play",data:!1}))})),null==h||h.addEventListener("input",(function(){"0"===h.value?null==f||f.classList.add("media-controls-mute-button-muted"):(t.next({type:"mute",data:!1}),null==f||f.classList.remove("media-controls-mute-button-muted")),t.next({type:"volume",data:h.value})})),null==f||f.addEventListener("click",(function(){f.classList.contains("media-controls-mute-button-muted")?(t.next({type:"mute",data:!1}),f.classList.remove("media-controls-mute-button-muted"),h.value="1",t.next({type:"volume",data:h.value})):(t.next({type:"mute",data:!0}),null==f||f.classList.add("media-controls-mute-button-muted"),h.value="0",t.next({type:"volume",data:0}))})),null==A||A.addEventListener("click",(function(e){e.stopPropagation(),null!=A&&A.classList.contains("media-controls-resolution-show-select")?null==A||A.classList.remove("media-controls-resolution-show-select"):null==A||A.classList.add("media-controls-resolution-show-select")})),null==b||b.addEventListener("click",(function(e){var r=e.target,n=r.dataset.size;E.innerText=r.innerText,t.next({type:"resolution",data:n})})),null==g||g.addEventListener("click",(function(e){e.stopPropagation(),null!=g&&g.classList.contains("media-controls-speed-show-select")?null==g||g.classList.remove("media-controls-speed-show-select"):null==g||g.classList.add("media-controls-speed-show-select")})),null==m||m.addEventListener("click",(function(e){var r=e.target,n=r.dataset.size;_&&(_.innerText=r.innerText),t.next({type:"speed",data:Number(n)})})),null==S||S.addEventListener("click",(function(){S.classList.contains("media-controls-toggle-closed-captions-button-closed")?(S.classList.remove("media-controls-toggle-closed-captions-button-closed"),t.next({type:"closed-caption",data:!0})):(S.classList.add("media-controls-toggle-closed-captions-button-closed"),t.next({type:"closed-caption",data:!1}))}));var k=100;function C(){null==l||l.classList.remove("media-controls-play-button-pause"),null==v||v.classList.remove("media-controls-live-rewind"),null==g||g.classList.add("media-controls-speed-hide"),s=!0,p.value="100"}return null==p||p.addEventListener("input",(function(){"100"===p.value?t.next({type:"live",data:0}):($t?(Zt=$t*(Number(p.value)/100)||1,n.currentTime=$t*(Number(p.value)/100)||1):k=Number(p.value),t.next({type:"rewind",data:0}))})),n.addEventListener("rewind-total-time",(function(e){$t=e.detail,k?(s||(p.value=k.toString()),Zt=$t*(k/100)||1,n.currentTime=Zt,k=0):s||(p.value=er().toString())})),n.addEventListener("timeupdate",(function(e){$t&&!k&&(Zt=e.detail,s||(p.value=er().toString()))})),null==o||o.subscribe((function(e){var t=e.status,r=e.speed;"true"===t?(null==v||v.classList.add("media-controls-live-rewind"),null==g||g.classList.remove("media-controls-speed-hide"),_&&(_.innerText=1===r?"Normal":"x".concat(r)),s=!1):C()})),null==v||v.addEventListener("click",(function(){100!==Number(p.value)&&(C(),t.next({type:"live",data:0}))})),c}(this.div,this.controlsEvent,this.playerState,this,this.sdk.zIndex,this.subState,this.rewindState),this.destroy$||(this.destroy$=new We),this.controlsEventSubscription=this.controlsEvent.pipe(Rt(this.destroy$)).subscribe((function(t){var r=t.type,n=t.data;switch(r){case"play":n?e.play():e.pause();break;case"mute":e.setAttribute(nr,n?"true":"false");break;case"volume":e.setAttribute(cr,n);break;case"closed-caption":e.setAttribute(ar,n?"true":"false");break;case"resolution":e.setAttribute(ir,n);break;case"rewind":"true"!==e.getAttribute(mr)&&e.setAttribute(mr,"true");break;case"speed":e.playbackRate=n,e.rewindVideo&&(e.rewindVideo.playbackRate=n);break;case"live":"false"!==e.getAttribute(mr)&&e.setAttribute(mr,"false")}}))}},{key:"removeControls",value:function(){this.controlsNode&&this.controlsNode.length&&this.controlsNode.forEach((function(e){e.remove()})),this.controlsEventSubscription&&(this.controlsEventSubscription.unsubscribe(),this.controlsEventSubscription=null)}},{key:"initNetworkHint",value:function(){var e,t,r=this;null===(e=this.networkHint)||void 0===e||e.init(),null===(t=this.networkHint)||void 0===t||t.on("change",this.handleNetworkStatusChange),Mt.on(k).pipe(Rt(this.destroy$)).subscribe((function(e){var t;e&&(null===(t=r.networkHint)||void 0===t||t.updateStatus({latency:e.rtt}))})),xt.on(Pt.Resolution).pipe(Rt(this.destroy$)).subscribe((function(e){var t;e&&e.streamId===r.streamId&&(null===(t=r.networkHint)||void 0===t||t.updateStatus({subInfo:r.getAttribute(ir),resolution:e.height}))})),xt.on(Pt.FPS).pipe(Rt(this.destroy$)).subscribe((function(e){var t;e&&e.streamId===r.streamId&&(null===(t=r.networkHint)||void 0===t||t.updateStatus({fps:e.fps}))}))}},{key:"connectedCallback",value:function(){var e=this;if(this.style.display||(this.style.display="block"),this.destroy$||(this.destroy$=new We),this.colorObserver=new MutationObserver((function(){var t=getComputedStyle(e).backgroundColor;e.lastBgColor!==t&&(e.lastBgColor=t,e.backgroundColor=z(t),e.streamId&&(e.sdk.stopVideo([{id:e.streamId,viewId:e.viewId,getCanvas:function(){var t;return null===(t=e.getContainer())||void 0===t?void 0:t.getCanvas()},color:e.backgroundColor}]),e.sdk.playVideo([{id:e.streamId,dom:e.div,viewId:e.viewId,getCanvas:function(){var t;return null===(t=e.getContainer())||void 0===t?void 0:t.getCanvas()},color:e.backgroundColor}])))})),this.colorObserver.observe(this,{attributes:!0,attributeFilter:["style"]}),this.initAttrs(),this.removePositionObserve=function(e,t){var r,n,i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).wrapper,a=void 0===i?document.documentElement:i,o=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.9999999,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r&&(r.disconnect(),r=null);var s=G(e,a),u=s.top,c=s.left,d=s.width,l=s.height,h=s.right,f=s.bottom;if(d&&l){var p=function(e,t,r,n){return e<0||t<0||r<0||n<0}(u,f,c,h),g=function(e,t,r,n,i,a){return e<=0&&e+a<=0||t<=0&&t+a<=0||r<=0&&r+i<=0||n<=0&&n+i<=0}(u,f,c,h,d,l),m={root:a,threshold:p?Xt:n};p||(m.rootMargin="".concat(-u,"px ").concat(-h,"px ").concat(-f,"px ").concat(-c,"px"));var y=!0,_=!0;i&&(_=!1),t({hide:g,cross:p,top:u,left:c,width:d,height:l,bottom:f,right:h}),(r=new IntersectionObserver((function(e){var t=v(e,1)[0];if(0===t.intersectionRatio)return _?o(.9999999,!0):void 0;if(n!==t.intersectionRatio){if(!y)return o();o(0===t.intersectionRatio?1e-7:t.intersectionRatio)}1===t.intersectionRatio&&p&&o(),y=!1}),m)).observe(e)}else t({hide:!0,cross:!1,width:0,height:0,top:0,left:0,bottom:0,right:0})};return o(),(n=new ResizeObserver((function(){return o()}))).observe(e),function(){var e,t;null===(e=r)||void 0===e||e.disconnect(),r=null,null===(t=n)||void 0===t||t.disconnect(),n=null}}(this.div,(function(t){if(e.streamId)if(t.hide)e.videostatus.play&&(e.sdk.stopRenderVideo([{id:e.streamId,viewId:e.viewId,color:e.backgroundColor}]),e.videostatus.play=!1);else if(e.videostatus.play)e.sdk.updateVideoPosition([{id:e.streamId,rect:t,viewId:e.viewId,isPaused:"pause"===e.status,getCanvas:function(){var t;return null===(t=e.getContainer())||void 0===t?void 0:t.getCanvas()},color:e.backgroundColor}]);else{var r,n,i,a,o;e.videostatus.subscribe?e.sdk.startRenderVideo([{id:e.streamId,dom:e.div,viewId:e.viewId,getCanvas:function(){var t;return null===(t=e.getContainer())||void 0===t?void 0:t.getCanvas()},color:e.backgroundColor}]):"pause"!==e.status&&(e.sdk.playVideo([{id:e.streamId,dom:e.div,viewId:e.viewId,getCanvas:function(){var t;return null===(t=e.getContainer())||void 0===t?void 0:t.getCanvas()},color:e.backgroundColor}]),e.isFirstRendered=!0,e.streamId&&e.sdk.initRewind(e.streamId).then((function(){"true"===e.getAttribute(mr)&&e.startRewind(e.streamId)}))),"pause"!==e.status&&(e.videostatus.subscribe=!0,e.videostatus.play=!0),e.videostatus.subscribe=!0,e.videostatus.play=!0;var s=null!==(r=e.getAttribute(nr))&&void 0!==r?r:"";e.audioStatus.play="false"!==s,e.setAttribute(nr,yr.defaultValues.muted),e.setAttribute(nr,s);var u=null!==(n=e.getAttribute(ar))&&void 0!==n?n:"";e.setAttribute(ar,yr.defaultValues.track),e.setAttribute(ar,u);var c=null!==(i=e.getAttribute(hr))&&void 0!==i?i:"";e.setAttribute(hr,yr.defaultValues.chat),e.setAttribute(hr,c);var d=null!==(a=e.getAttribute(vr))&&void 0!==a?a:"";e.setAttribute(vr,yr.defaultValues.reaction),e.setAttribute(vr,d);var l=null!==(o=e.getAttribute(gr))&&void 0!==o?o:"";e.setAttribute(gr,yr.defaultValues.qa),e.setAttribute(gr,l)}}),{wrapper:this.getContainer()||yr.container}),this.sessionStatusObserve=Ot.on(Nt.LiveSessionStatus,!0).pipe(Rt(this.destroy$)).subscribe((function(t){t&&(2===t.status?String(t.id)===e.streamId&&(e.sdk.sessionSetDelete(e.streamId),e.dispatchEvent(new CustomEvent("ended")),e.ended=!0,e.cancleLoading()):String(t.id)===e.streamId&&e.sdk.sessionSetAdd(e.streamId),String(t.id)===e.streamId&&(e.closedCaptionStatus&&t.LttEnable===e.closedCaptionStatus.enableClosedCaption&&t.ManualLttOn===e.closedCaptionStatus.enableManualCaption||(e.closedCaptionStatus={enableClosedCaption:t.LttEnable,enableManualCaption:t.ManualLttOn},e.dispatchEvent(new CustomEvent("cc-status-change",{detail:e.closedCaptionStatus})))))})),this.loadingObserve=xt.on(Pt.FirstFrame).pipe(Rt(this.destroy$)).subscribe((function(t){t===e.streamId&&(e.firstFrame=!0,e.cancleLoading(),"true"===e.getAttribute(pr)?e.pause():e.play())})),this.blockObserve=xt.on(Pt.BlockMonitor).pipe(Rt(this.destroy$)).subscribe((function(t){var r=t.event;e.firstFrame&&!e.ended&&"true"!==e.getAttribute(mr)&&("block"===r?t.streamId===e.streamId&&e.startLoading():"resume"===r?t.streamId===e.streamId&&e.cancleLoading():"error"===r&&t.streamId===e.streamId&&e.sdk.emit("player-error",{code:P.BadQuality,reason:L.BadQuality}))})),this.eventObserve=xt.on(Pt.BindEvent).pipe(Rt(this.destroy$)).subscribe((function(t){t.streamId===e.streamId&&e.dispatchEvent(new CustomEvent(t.event,{detail:t.params}))})),this.watermarkObserve=xt.on(Pt.UpdateWatermark).pipe(Rt(this.destroy$)).subscribe((function(){if(e.rewindWatermarkSize){var t=e.sdk.getWatermarkData({width:e.rewindWatermarkSize.width,height:e.rewindWatermarkSize.height});e.rewindWatermark&&(t?(e.rewindWatermark.src=t,e.rewindWatermark.style.display="block"):e.rewindWatermark.style.display="none")}})),this.initDefaultValues(),"false"!==this.getAttribute(or)){var t=this.initTrackDom();t&&this.div.appendChild(t)}"false"!==this.getAttribute(dr)&&(this.loadingEl=function(e,t){var r=tr.content.cloneNode(!0);e.appendChild(r);var n=e.querySelector(".loading-container");return t&&(n.style.zIndex=t),e.querySelector(".loading-spinner")}(this.div,this.sdk.zIndex?String(this.sdk.zIndex+2):"2")),this.initTrack(),this.initInteractive()}},{key:"disconnectedCallback",value:function(){var e,t,r,n,i,a,o=this;if(this.destroy$&&(this.destroy$.next(),this.destroy$.complete(),this.destroy$=null),this.colorObserver&&this.colorObserver.disconnect(),this.sizeObserver&&this.sizeObserver.unsubscribe(),yr.elements.get(this.viewId)&&(yr.elements.delete(this.viewId),0===yr.elements.size)){var s=document.getElementById(F);s&&(s.style.visibility="hidden")}this.ccTimeout&&window.clearTimeout(this.ccTimeout),null===(e=this.removePositionObserve)||void 0===e||e.call(this),null===(t=this.sessionStatusObserve)||void 0===t||t.unsubscribe(),null===(r=this.loadingObserve)||void 0===r||r.unsubscribe(),null===(n=this.blockObserve)||void 0===n||n.unsubscribe(),null===(i=this.eventObserve)||void 0===i||i.unsubscribe(),null===(a=this.watermarkObserve)||void 0===a||a.unsubscribe(),this.closedCaptionStatus=null,this.streamId&&(this.sdk.stopVideo([{id:this.streamId,viewId:this.viewId,getCanvas:function(){var e;return null===(e=o.getContainer())||void 0===e?void 0:e.getCanvas()},color:this.backgroundColor}]),this.sdk.stopAudio([this.streamId]),this.sdk.unSubscribeLTT(this.langList.map((function(e){return{id:o.streamId,code:e}})))),this.langList=[],this.ended=!1}},{key:"attributeChangedCallback",value:function(e,t,r){var n=this;yr.elements.get(this.viewId)[e]=r;var i=Number(this.getAttribute(ir)||"0"),a=this.videostatus.subscribeParam;switch(e){case rr:if(this.ended&&(this.ended=!1),this.closedCaptionStatus=null,this.networkHint||(this.networkHint=new Yt(this.sdk.getNetworkHint())),this.networkHint&&(this.networkHint.removeAllListeners(),this.networkHint.destroy(),this.initNetworkHint()),!t&&r){if(this.sdk.getStreamId(r)){this.startLoading(),this.sdk.playVideo([{id:this.sdk.getStreamId(r),dom:this.div,size:i,viewId:this.viewId,getCanvas:function(){var e;return null===(e=n.getContainer())||void 0===e?void 0:e.getCanvas()},color:this.backgroundColor}]),this.videostatus={subscribe:!0,subscribeParam:{id:this.sdk.getStreamId(r),size:i},play:!0},this.isFirstRendered=!0;var o=this.sdk.getStreamId(r);o&&this.sdk.initRewind(o).then((function(e){"true"===n.getAttribute(mr)&&n.startRewind(o)}))}}else if(t&&r){if(this.sdk.getStreamId(t)&&this.sdk.getStreamId(r)){this.firstFrame=!1,this.startLoading(),this.sdk.stopVideo([{id:this.sdk.getStreamId(t),viewId:this.viewId,getCanvas:function(){var e;return null===(e=n.getContainer())||void 0===e?void 0:e.getCanvas()},color:this.backgroundColor}]),this.sdk.stopAudio([this.sdk.getStreamId(t)]),this.sdk.playVideo([{id:this.sdk.getStreamId(r),dom:this.div,size:i,viewId:this.viewId,getCanvas:function(){var e;return null===(e=n.getContainer())||void 0===e?void 0:e.getCanvas()},color:this.backgroundColor}]),this.videostatus.subscribeParam={id:this.sdk.getStreamId(r),size:i},"true"===this.getAttribute(mr)&&this.stopRewind(this.sdk.getStreamId(t)),this.sdk.stopRewind(this.sdk.getStreamId(t));var s=this.sdk.getStreamId(r);s&&this.sdk.initRewind(s).then((function(e){"true"===n.getAttribute(mr)&&n.startRewind(s)}))}}else t&&this.sdk.getStreamId(t)&&(this.sdk.stopVideo([{id:this.sdk.getStreamId(t),viewId:this.viewId,getCanvas:function(){var e;return null===(e=n.getContainer())||void 0===e?void 0:e.getCanvas()},color:this.backgroundColor}]),this.videostatus={subscribe:!1,subscribeParam:null,play:!1},"true"===this.getAttribute(mr)&&this.stopRewind(this.sdk.getStreamId(t)),this.sdk.stopRewind(this.sdk.getStreamId(t)));if(t&&this.sdk.getStreamId(t)&&(this.audioStatus.play&&this.sdk.stopAudio([this.sdk.getStreamId(t)]),this.sdk.unSubscribeLTT(this.oldLangList.map((function(e){return{id:n.sdk.getStreamId(t),code:e}}))),this.sdk.unSubscribeLTT(this.langList.map((function(e){return{id:n.sdk.getStreamId(t),code:e}})))),r){var u,c,d,l,h,f=null!==(u=this.getAttribute(nr))&&void 0!==u?u:"";this.audioStatus.play="false"===f,this.setAttribute(nr,yr.defaultValues.muted),this.setAttribute(nr,f);var p=null!==(c=this.getAttribute(ar))&&void 0!==c?c:"";this.setAttribute(ar,yr.defaultValues.track),this.setAttribute(ar,p);var v=null!==(d=this.getAttribute(hr))&&void 0!==d?d:"";this.setAttribute(hr,yr.defaultValues.chat),this.setAttribute(hr,v);var g=null!==(l=this.getAttribute(vr))&&void 0!==l?l:"";this.setAttribute(vr,yr.defaultValues.reaction),this.setAttribute(vr,g);var m=null!==(h=this.getAttribute(gr))&&void 0!==h?h:"";this.setAttribute(gr,yr.defaultValues.qa),this.setAttribute(gr,m)}break;case nr:this.playerState.next({muted:r}),"pause"!==this.status&&this.streamId&&("false"!==r?this.audioStatus.play&&(this.sdk.stopAudio([this.streamId]),this.audioStatus.play=!1):this.audioStatus.play||(this.sdk.playAudio([this.streamId]),this.audioStatus.play=!0));break;case ar:this.streamId&&("true"!==r?(this.sdk.unSubscribeLTT(this.langList.map((function(e){return{id:n.streamId,code:e}}))),this.trackContainer&&(this.trackContainer.innerText=""),this.trackDisabled=!0):this.videostatus.subscribe&&(this.sdk.subscribeLTT(this.langList.map((function(e){return{id:n.streamId,code:e}}))),this.trackDisabled=!1));break;case hr:this.streamId&&("true"!==r?this.sdk.unSubscribeBulletScreen([this.streamId]):this.videostatus.subscribe&&(this.sdk.subscribeBulletScreen([{id:this.streamId}]),"true"===this.getAttribute(fr)&&this.sdk.renderBulletScreen(this.streamId,this.div)));break;case ur:"true"!==r?this.removeControls():this.initControls();break;case ir:if(null!=r&&this.subState.next(r),"auto"===r);else if(this.streamId){if(!this.isFirstRendered)return;if(a&&a.size===i&&a.id===this.streamId)return;"pause"!==this.status&&(this.sdk.subscribeVideo([{id:this.streamId,size:Number(r)}]),this.videostatus.subscribe=!0,this.videostatus.subscribeParam={id:this.streamId,size:Number(r)}),this.sdk.changeResolution(this.streamId,Number(r))}break;case cr:this.sdk.changeAudioVolume(Number(r));break;case lr:if(this.loadingEl){var y=Number(r.replace("px",""));this.loadingEl.style.scale=y/65}break;case sr:if("true"===this.getAttribute(ar)){var _=r.split(",").filter((function(e){return!!e})),S=function(e,t){for(var r=[],n=0;n<=e.length;n++)for(var i=0;i<=t.length;i++)e[n]===t[i]&&r.push(e[n]);var a=t.filter((function(e){return!r.includes(e)})),o=e.filter((function(e){return!r.includes(e)}));return{add:a,keep:r,remove:o}}(this.langList,_),A=S.add,b=S.remove;this.oldLangList=this.langList,this.langList=_,this.streamId&&(this.sdk.unSubscribeLTT(b.map((function(e){return{id:n.streamId,code:e}}))),this.sdk.subscribeLTT(A.map((function(e){return{id:n.streamId,code:e}}))))}else{var E=r.split(",").filter((function(e){return!!e}));this.langList=E}break;case mr:this.rewindState.next({status:r,speed:this.playbackRate}),"true"===r?this.startRewind(this.streamId):this.stopRewind(this.streamId,!0)}}},{key:"startRewind",value:function(e){var t=this;if(!this.rewindVideo){var r=new Bt("video","",{top:"0",left:"0",width:"100%",height:"100%",position:"absolute",zIndex:this.sdk.zIndex?String(this.sdk.zIndex+10):"10"}).commit(this.div);r.element.muted=!0,r.element.playsInline=!0,r.element.setAttribute("playsinline","true"),this.rewindVideo=r.element}if(!this.rewindWatermark){var n=new Bt("img","",{top:"0",left:"0",width:"100%",height:"100%",position:"absolute",pointerEvents:"none",zIndex:this.sdk.zIndex?String(this.sdk.zIndex+11):"11"}).commit(this.div);this.rewindWatermark=n.element,this.sizeObserver=function(e){var t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;if("string"==typeof e){if(!(t=document.querySelector(e)))throw new Error("Element not found")}else t=e;var i=new ResizeObserver((function(e){var t=e[0],r=t.contentRect.width,i=t.contentRect.height;n({width:r,height:i})}));if(i.observe(t),r){var a=t.offsetWidth,o=t.offsetHeight;n({width:a,height:o})}return{unsubscribe:function(){i.disconnect()}}}(this.rewindWatermark,!0,(function(e){t.rewindWatermarkSize=e;var r=t.sdk.getWatermarkData({width:e.width,height:e.height});t.rewindWatermark&&(r?(t.rewindWatermark.src=r,t.rewindWatermark.style.display="block"):t.rewindWatermark.style.display="none")}))}if(this.rewindVideo.style.display="block",this.rewindWatermark.style.display=this.rewindWatermark.src?"block":"none",e){var i=document.getElementById(F);i&&(i.style.zIndex="-1"),this.sdk.attachRewindMedia(e,this.rewindVideo),this.sdk.stopVideo([{id:e,viewId:this.viewId,getCanvas:function(){var e;return null===(e=t.getContainer())||void 0===e?void 0:e.getCanvas()},color:this.backgroundColor}]),"false"===this.getAttribute(nr)&&this.sdk.playAudio([e])}this.rewindCurrentTime&&(this.rewindVideo.currentTime=this.rewindCurrentTime),1!==this.rewindPlaybackRate&&(this.rewindVideo.playbackRate=this.rewindPlaybackRate),this.cancleLoading()}},{key:"stopRewind",value:function(e,t){var r=this;if(this.rewindVideo&&(this.rewindVideo.style.display="none"),this.rewindWatermark&&(this.rewindWatermark.style.display="none"),e){var n=document.getElementById(F);n&&(n.style.zIndex=""),this.sdk.detachRewindMedia(e),t&&(this.sdk.playVideo([{id:e,dom:this.div,viewId:this.viewId,color:this.backgroundColor,getCanvas:function(){var e;return null===(e=r.getContainer())||void 0===e?void 0:e.getCanvas()}}]),"false"===this.getAttribute(nr)&&this.sdk.playAudio([e]))}}},{key:"adoptedCallback",value:function(){}},{key:"startLoading",value:function(){this.ended||"pause"!==this.status&&("false"!==this.getAttribute(dr)&&this.div.classList.add(this.firstFrame?"live-video-div-wrapper-loading-transparent":"live-video-div-wrapper-loading"),this.dispatchEvent(new CustomEvent("waiting")))}},{key:"cancleLoading",value:function(){"false"!==this.getAttribute(dr)&&(this.div.classList.remove("live-video-div-wrapper-loading"),this.div.classList.remove("live-video-div-wrapper-loading-transparent")),this.dispatchEvent(new CustomEvent("playing"))}},{key:"pause",value:function(){var e,t=this;(this.firstFrame||"true"===this.getAttribute(mr))&&this.streamId&&(null===(e=this.networkHint)||void 0===e||e.pause(!0),this.status="pause",this.sdk.pause([{id:this.streamId,viewId:this.viewId,getCanvas:function(){var e;return null===(e=t.getContainer())||void 0===e?void 0:e.getCanvas()},color:this.backgroundColor}],"false"===this.getAttribute(nr)))}},{key:"play",value:function(){var e,t=this;(this.firstFrame||"true"===this.getAttribute(mr))&&this.streamId&&(null===(e=this.networkHint)||void 0===e||e.pause(!1),this.status="playing",this.sdk.play([{id:this.streamId,viewId:this.viewId,dom:this.div,size:Number(this.getAttribute(ir)||"0"),getCanvas:function(){var e;return null===(e=t.getContainer())||void 0===e?void 0:e.getCanvas()},color:this.backgroundColor}],"false"===this.getAttribute(nr)))}},{key:"currentTime",get:function(){return this.rewindCurrentTime},set:function(e){this.rewindVideo&&(this.rewindVideo.currentTime=e),this.rewindCurrentTime=e}},{key:"playbackRate",get:function(){return this.rewindPlaybackRate},set:function(e){this.rewindVideo&&(this.rewindVideo.playbackRate=e),this.rewindPlaybackRate=e}},{key:"sendBulletScreen",value:function(e,t){this.streamId&&this.sdk.sendBulletScreen(this.streamId,e,t)}},{key:"sendChat",value:function(e,t){this.streamId&&this.sdk.sendBulletScreen(this.streamId,e,t)}},{key:"sendReaction",value:function(e){this.streamId&&this.sdk.sendReaction(this.streamId,e)}},{key:"sendQA",value:function(e){this.streamId&&this.sdk.sendQA(this.streamId,e)}},{key:"getCCStatus",value:function(){return this.closedCaptionStatus}},{key:"channelId",get:function(){return this.getAttribute(rr)}},{key:"streamId",get:function(){if(this.channelId)return this.sdk.getStreamId(this.channelId)}},{key:"sdk",get:function(){return yr.sdk}}],[{key:"observedAttributes",get:function(){return yr.customAttributes}},{key:"reloadElements",value:function(){var e,t=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=A(y(this.elements));try{var i=function(){var n,i,o,s,u=v(e.value,2)[1],c=u.el,d=T(u,a);c.div.innerHTML="",c.destroy$&&(c.destroy$.next(),c.destroy$.complete(),c.destroy$=null),null===(n=c.removePositionObserve)||void 0===n||n.call(c),null===(i=c.sessionStatusObserve)||void 0===i||i.unsubscribe(),null===(o=c.loadingObserve)||void 0===o||o.unsubscribe(),null===(s=c.blockObserve)||void 0===s||s.unsubscribe(),c.connectedCallback(),r&&Object.keys(d).forEach((function(e){c.attributeChangedCallback(e,d[e],t.defaultValues[e]),c.attributeChangedCallback(e,t.defaultValues[e],d[e])}))};for(n.s();!(e=n.n()).done;)i()}catch(e){n.e(e)}finally{n.f()}}}])}(),_r=yr;_r.elements=new Map,_r.customAttributes=[rr,nr,ir,ar,ur,or,sr,cr,dr,lr,hr,fr,pr,vr,gr,mr],_r.defaultValues=(w(w(w(w(w(w(w(w(w(w(t={},rr,""),nr,"true"),ir,"0"),ar,"false"),ur,"false"),or,"false"),sr,""),cr,"0"),dr,"false"),lr,"65px"),w(w(w(w(w(t,hr,"false"),fr,"false"),vr,"false"),gr,"false"),mr,"false"));var Sr=matchMedia("(resolution: ".concat(window.devicePixelRatio,"dppx)"));function Ar(e,t,r,n){Bt.attachCSS(e,{position:"relative"});var i=new Bt("canvas",t,{pointerEvents:"none",position:"absolute",left:"0px",top:"0px",zIndex:String(n)}).width(e.clientWidth).height(e.clientHeight).commit(e),a=function(){i.width(e.clientWidth).height(e.clientHeight),r(i.element,e.clientWidth*(window.devicePixelRatio||1),e.clientHeight*(window.devicePixelRatio||1))},o=new ResizeObserver(a);return Sr.addEventListener("change",a),o.observe(e),{canvas:i.element,cleanUp:function(){Sr.removeEventListener("change",a),o.disconnect(),e.removeChild(i.element)}}}matchMedia("(resolution: ".concat(window.devicePixelRatio,"dppx)"));var br,Er,kr=function(e){function t(e,r,n,i){var a;if(R(this,t),(a=c(this,t,[e])).streamSsrcMap=new Map,a.ssrcStreamMap=new Map,a.viewMap=new Map,a.waitSubjects=new Map,a.backgroundColor={R:0,G:0,B:0,A:0},a.videoBlockMap=new Map,a.blockTimeoutMap=new Map,a.pauseSet=new Set,a.removedSet=new Set,a.firstFrameSet=new Set,a.currentVideoMap=new Map,r){a.container=r,a.backgroundColor=z(n||getComputedStyle(r).getPropertyValue("background-color"));var o=Ar(r,F,(function(e,t,r){a.livePlayer.sendToMedia(p.UPDATE_CANVAS_SIZE,{width:t,height:r,canvas:e}),a.updateVideoPosition(y(a.viewMap.keys()).map((function(e){var t,r;return{viewId:e,id:a.viewMap.get(e).id,isPaused:null===(t=a.viewMap.get(e))||void 0===t?void 0:t.isPaused,color:(null===(r=a.viewMap.get(e))||void 0===r?void 0:r.color)||a.backgroundColor}})))}),i),s=o.canvas,u=o.cleanUp;s.style.visibility=0===_r.elements.size?"hidden":"visible",i&&(s.style.zIndex=i+""),a.cleanUp=u}return a}return f(t,e),D(t,[{key:"initSubscription",value:function(){var e=this;xt.on(Pt.UpdateActiveAudio).pipe(Rt(this.destroy$)).subscribe((function(t){null==t||t.forEach((function(t){var r=e.streamSsrcMap.get(t);r&&e.livePlayer.sendToMedia(p.CHANGE_CURRENT_ACTIVE_SSRC,{ssrc:r})}))})),Ot.on(Nt.LiveSessionStatus).pipe(Rt(this.destroy$)).subscribe((function(t){var r;if(t&&t.ssrc)if(Ft.add("LSSTATUS ".concat(t.status," ").concat(String(t.id)," ").concat(t.ssrc)),2!==t.status)String(t.id)&&(e.streamSsrcMap.set(String(t.id),t.ssrc>>10<<10),e.ssrcStreamMap.set(t.ssrc>>10<<10,String(t.id))),null===(r=e.waitSubjects.get(String(t.id)))||void 0===r||r.next("");else if(2===t.status){var n;null===(n=e.waitSubjects.get(String(t.id)))||void 0===n||n.next("end")}})),Ot.on(Nt.ServiceNumber).pipe(Rt(this.destroy$)).subscribe((function(t){if(t&&t.id&&t.sn){var r=e.streamSsrcMap.get(null==t?void 0:t.id);r&&e.livePlayer.sendToMedia(p.USER_NODE_LIST,[{sn:X(t.sn),userid:r>>10<<10}])}})),Mt.on(E.VIDEO_REQUEST_IDR).pipe(Rt(this.destroy$)).subscribe((function(t){t&&e.livePlayer.sendToSignal(Lt.IDRRequest,{id:e.ssrcStreamMap.get(t.ssrc),info:J(t.data)})})),Mt.on(E.FIRST_FRAME).pipe(Rt(this.destroy$)).subscribe((function(t){if(t&&e.ssrcStreamMap.get(t.ssrc>>10<<10)){var r=e.ssrcStreamMap.get(t.ssrc>>10<<10);e.firstFrameSet.has(t.ssrc)||(e.firstFrameSet.add(t.ssrc),xt.dispatch(Pt.BindEvent,{streamId:r,event:"render-success",params:C({networkType:e.livePlayer.networkType},t.params)}),Ft.add("FFRAME ".concat(t.ssrc)),xt.dispatch(Pt.FirstFrame,e.ssrcStreamMap.get(t.ssrc>>10<<10)))}})),Mt.on(66.5).pipe(kt((function(e){return!!e&&!!e.ssrc}))).subscribe((function(t){t&&t.ssrc&&(e.calculateVideoChange(t.ssrc,t),xt.dispatch(Pt.Resolution,{streamId:e.ssrcStreamMap.get(t.ssrc>>10<<10),width:t.width,height:t.height}))})),Mt.on(66.6).pipe(Rt(this.destroy$)).subscribe((function(t){if(t){xt.dispatch(Pt.FPS,{streamId:e.ssrcStreamMap.get(t.ssrc>>10<<10),fps:t.fps});var r=e.blockTimeoutMap.get(t.ssrc);if(r&&window.clearTimeout(r),e.pauseSet.has(t.ssrc)||e.removedSet.has(t.ssrc))return;var n=e.videoBlockMap.get(t.ssrc>>10<<10);if(n||(n=0),0===t.fps){n++;var i=window.setTimeout((function(){Mt.dispatch(66.6,{ssrc:t.ssrc,fps:0})}),1400);e.blockTimeoutMap.set(t.ssrc,i)}else r&&e.blockTimeoutMap.set(t.ssrc,0),n=0;e.videoBlockMap.set(t.ssrc>>10<<10,n);var a=e.ssrcStreamMap.get(t.ssrc>>10<<10);n>=1?n>10?xt.dispatch(Pt.BlockMonitor,{event:"error",streamId:a}):a&&xt.dispatch(Pt.BlockMonitor,{event:"block",streamId:a}):a&&xt.dispatch(Pt.BlockMonitor,{event:"resume",streamId:a})}}))}},{key:"destroy",value:function(){var e;s(t,"destroy",this)([]);var r,n=A(this.blockTimeoutMap.values());try{for(n.s();!(r=n.n()).done;){var i=r.value;i&&window.clearTimeout(i)}}catch(e){n.e(e)}finally{n.f()}null===(e=this.cleanUp)||void 0===e||e.call(this)}},{key:"calculateVideoChange",value:function(e,t){if(t){var r=this.currentVideoMap.get(e);if(r){var n=r.height,i=t.height;if(n!==i){var a=this.ssrcStreamMap.get(e>>10<<10);xt.dispatch(Pt.BindEvent,{streamId:a,event:"resolution-change",params:{oldVal:n,newVal:i}})}}this.currentVideoMap.set(e,t)}}},{key:"getCurrentPosition",value:function(e,t){return this.transformRectToPosition(G(e,this.container||t))}},{key:"transformRectToPosition",value:function(e){var t=e.left,r=e.width,n=e.height,i=e.bottom;return{x:Math.ceil(t*(window.devicePixelRatio||1)),y:Math.ceil(i*(window.devicePixelRatio||1)),width:Math.ceil(r*(window.devicePixelRatio||1)),height:Math.ceil(n*(window.devicePixelRatio||1))}}},{key:"tryToPlayVideo",value:function(e){var t=this,r=new Map,n=[];e.forEach((function(e){if(r.get(e.viewId)!==e.id)if(r.set(e.viewId,e.id),t.streamSsrcMap.get(e.id))n.push(e);else{var i=new We,a=t.waitSubjects.get(e.id);Ft.add("TPSUB ".concat(e.id," ").concat(!!a," ").concat(a?a.closed:"null")),a&&!a.closed&&a.next("expired"),t.waitSubjects.set(e.id,i),i.pipe(Tt(),function(e){var t=e instanceof Date&&!isNaN(3e4)?{first:e}:{each:e},r=t.first,n=t.each,i=t.with,a=void 0===i?gt:i,o=t.scheduler,s=void 0===o?Xe:o,u=t.meta,c=void 0===u?null:u;if(null==r&&null==n)throw new TypeError("No timeout provided.");return Ve((function(e,t){var i,o,u=null,d=0,l=function(e){o=ct(t,s,(function(){try{i.unsubscribe(),st(a({meta:c,lastValue:u,seen:d})).subscribe(t)}catch(e){t.error(e)}}),e)};i=e.subscribe(Ue(t,(function(e){null==o||o.unsubscribe(),d++,t.next(u=e),n>0&&l(n)}),void 0,void 0,(function(){(null==o?void 0:o.closed)||null==o||o.unsubscribe(),u=null}))),!d&&l(null!=r?"number"==typeof r?r:+r-s.now():n)}))}(3e4),Ct((function(){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ft(e,Je(e))}("err")})),Rt(t.destroy$)).subscribe((function(r){Ft.add("TPRES ".concat(e.id," ").concat(r)),r?"err"===r&&t.livePlayer.emit("player-error",{code:P.SubscribeTimeout,reason:L.SubscribeTimeout}):t.playVideo([e])}))}})),this.playVideo(n)}},{key:"playVideo",value:function(e){var t=this;e.forEach((function(e){e.hasAudio&&t.changeAudioStatus(t.streamSsrcMap.get(e.id)||1,!1);var r=e.dom;if(r){var n,i,a=t.getCurrentPosition(r,(null===(n=e.getCanvas)||void 0===n?void 0:n.call(e))||t.container);t.livePlayer.sendToMedia(p.ADD_RENDER_VIDEO,C(C({},a),{},{userId:t.streamSsrcMap.get(e.id)||1,canvas:(null===(i=e.getCanvas)||void 0===i?void 0:i.call(e))||F,zone:e.viewId})),t.viewMap.set(e.viewId,{dom:r,position:a,id:e.id,isPaused:!1,color:e.color}),t.pauseSet.has(t.streamSsrcMap.get(e.id)||1)&&t.pauseSet.delete(t.streamSsrcMap.get(e.id)||1),t.removedSet.has(t.streamSsrcMap.get(e.id)||1)&&t.removedSet.delete(t.streamSsrcMap.get(e.id)||1)}}))}},{key:"updateVideoPosition",value:function(e){var t=this;e.forEach((function(e){var r,n=null===(r=t.viewMap.get(e.viewId))||void 0===r?void 0:r.dom;if(n){var i,a,o=t.transformRectToPosition(e.rect||G(n,(null===(i=e.getCanvas)||void 0===i?void 0:i.call(e))||t.container));t.livePlayer.sendToMedia(p.ZOOM_RENDER,C(C({},o),{},{userId:t.streamSsrcMap.get(e.id)||1,canvas:(null===(a=e.getCanvas)||void 0===a?void 0:a.call(e))||F,RGBA:e.color||t.backgroundColor,zone:e.viewId,isPaused:e.isPaused})),t.viewMap.set(e.viewId,{dom:n,position:o,id:e.id,isPaused:e.isPaused,color:e.color})}}))}},{key:"stopVideo",value:function(e){var t=this;e.forEach((function(e){var r=e.id,n=e.viewId,i=e.hasAudio,a=e.getCanvas,o=e.color;if(n&&t.viewMap.get(n)){i&&t.changeAudioStatus(t.streamSsrcMap.get(r)||1,!0);var s=t.viewMap.get(n).position;s&&t.livePlayer.sendToMedia(p.STOP_RENDER_VIDEO,C(C({},s),{},{userId:t.streamSsrcMap.get(r)||1,canvas:(null==a?void 0:a())||F,doNotClean:!1,RGBA:o||t.backgroundColor,zone:n})),t.viewMap.delete(n),t.streamSsrcMap.get(r)&&t.firstFrameSet.delete(t.streamSsrcMap.get(r)),t.removedSet.add(t.streamSsrcMap.get(r)||1)}}))}},{key:"pauseVideo",value:function(e){var t=this;e.forEach((function(e){var r=e.id,n=e.viewId,i=e.hasAudio,a=e.getCanvas,o=e.color;if(n&&t.viewMap.get(n)){i&&t.changeAudioStatus(t.streamSsrcMap.get(r)||1,!0);var s=t.viewMap.get(n).position;s&&t.livePlayer.sendToMedia(p.STOP_RENDER_VIDEO,C(C({},s),{},{userId:t.streamSsrcMap.get(r)||1,canvas:(null==a?void 0:a())||F,doNotClean:!0,RGBA:o||t.backgroundColor,zone:n})),t.viewMap.get(n)&&(t.viewMap.get(n).isPaused=!0),t.pauseSet.add(t.streamSsrcMap.get(r)||1)}}))}},{key:"changeAudioStatus",value:function(e,t){this.livePlayer.sendToMedia(p.SET_OTHER_AUDIO_VOLUME_LEVEL,{volume:t?0:100,userId:e})}}])}(It),Cr=(br={},Er=D((function e(){R(this,e),this.seq=1,this.aliveChecked=!0}),[{key:"getSeq",value:function(){return this.seq}},{key:"incrementSeq",value:function(){return this.seq++,this}},{key:"reset",value:function(){return this.seq=1,this.aliveChecked=!0,this}}]),{get:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";return br[e]||(br[e]=new Er),br[e]}}),wr=function(){return D((function e(t,r){var n=this;R(this,e),this.url=t,this.options=r,this.ws=null,this.sendMessage=function(e){return!(!n.ws||1!==n.ws.readyState||(n.ws.send(JSON.stringify(e)),0))},this.closeWebSocket=function(){var e;null===(e=n.ws)||void 0===e||e.close()}}),[{key:"create",value:(e=H(O().mark((function e(){var t=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var r=t.options,n=t.url;window.commandSocket=t.ws=new WebSocket(n),t.ws.binaryType="arraybuffer",t.ws.onopen=function(){e(),r.handleOnOpen&&r.handleOnOpen.call(t)},r.handleOnClose&&(t.ws.onclose=r.handleOnClose.bind(t)),r.handleOnError&&(t.ws.onerror=r.handleOnError.bind(t)),r.handleOnMessage&&(t.ws.onmessage=r.handleOnMessage.bind(t))})));case 1:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})}]);var e}(),Tr=function(e){function t(e,r,n){var i;return R(this,t),(i=c(this,t,[e])).streamTokenMap=r,i.isVirtual=n,i.signalSocket=null,i.keepAliveInterval=0,i.heartbeatIns=Cr.get(),i.audioList=[],i.renderTiming=0,i.destroyed=!1,i.firstFrameRendered=!1,i}return f(t,e),D(t,[{key:"addPlaybackToken",value:function(e){var t=l(e.playbackToken[0]);this.streamTokenMap.set(t.streamId,this.isVirtual?e.playbackToken:e.playbackToken[0])}},{key:"init",value:(r=H(O().mark((function e(r){var n=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(t,"init",this)([]),this.signalSocket=new wr(r,{handleOnOpen:function(){n.heartbeatIns.reset(),n.keepAliveInterval=window.setInterval(n.sendKeepAlive.bind(n),6e4)},handleOnMessage:this.handleSignalSocketMessage.bind(this),handleOnClose:this.handleOnClose.bind(this)}),e.prev=2,e.next=5,this.signalSocket.create();case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(2),Ut.error("create signalSocket error: "+(null===e.t0||void 0===e.t0?void 0:e.t0.message)),this.livePlayer.emit("player-error",{code:P.WebSocketBroken,reason:L.WebSocketBroken});case 11:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(e){return r.apply(this,arguments)})},{key:"destroy",value:function(){var e;this.keepAliveInterval&&window.clearInterval(this.keepAliveInterval),this.destroyed=!0,null===(e=this.signalSocket)||void 0===e||e.closeWebSocket()}},{key:"sendKeepAlive",value:function(){this.heartbeatIns.aliveChecked&&(this.heartbeatIns.aliveChecked=!1,this.sendToSignal(Lt.KeepAlive))}},{key:"handleOnClose",value:function(){this.destroyed||xt.dispatch(Pt.Failover,!0)}},{key:"handleSignalSocketMessage",value:function(e){var t,r=e.data;if(r){var n,i,a,o={};try{o=JSON.parse(r)}catch(e){}this.heartbeatIns.aliveChecked=!0,o.evt===Nt.JoinResult&&!0===(null===(t=o.body)||void 0===t?void 0:t.result)&&(Sf.failoverTime=0,xt.dispatch(Pt.SignalAvaliable,{enableTCP:null===(n=o.body)||void 0===n?void 0:n.enableTCP,enableWebtransport:null===(i=o.body)||void 0===i?void 0:i.enableWebTransport,webtransportPort:null===(a=o.body)||void 0===a?void 0:a.WebTransportPort}),this.livePlayer.props.tid&&this.livePlayer.sendToSignal(Lt.MonitorLog,{mlog:",TICKET("+this.livePlayer.props.tid||"),"}),this.livePlayer.sendToMedia(p.NOTIFY_SDK_JOIN_RWG_SUCCESS,{})),Ot.dispatch(o.evt,o.body)}}},{key:"initSubscription",value:function(){var e=this;Mt.on(E.FIRST_FRAME).pipe(Rt(this.destroy$)).subscribe((function(){if(!e.firstFrameRendered){e.firstFrameRendered=!0,e.livePlayer.timing.videoRender();var t=(new Date).getTime();Ut.log("video render first frame: "+Z(t)),Ut.log("video render time: "+(t-e.renderTiming)),e.livePlayer.emit("first-frame-time",t-e.renderTiming)}}))}},{key:"subscribeMedia",value:function(e,t){var r=this;if(t.length){if(e===x.Video){this.livePlayer.timing.subscribe();var n=(new Date).getTime();Ut.log("video render start subscribe: "+Z(n)),this.renderTiming=n}var i;e===x.Audio&&((i=this.audioList).push.apply(i,y(t.map((function(e){return String(e.id)})))),xt.dispatch(Pt.UpdateActiveAudio,t.map((function(e){return e.id})))),Ft.add("SUB ".concat(e)),this.sendToSignal(Lt.Subscribe,{subInfoList:t.map((function(t){var n=t.id,i=t.size,a=t.code,o=r.streamTokenMap.get(String(n))||"1",s={id:String(n),type:e};return Array.isArray(o)?s.token_list=o:s.token=o,e===x.Video&&(s.size=null!=i?i:4),e===x.LTT&&(s.code=a),s}))})}}},{key:"unSubscribeMedia",value:function(e,t){var r=this;e===x.Audio?(t.forEach((function(t){var n=[];r.audioList.includes(t)&&n.push(t),n.length&&r.livePlayer.sendToSignal(Lt.Unsubscribe,{subIDList:n.map((function(t){return{id:t,type:e}}))})})),this.audioList=this.audioList.filter((function(e){return!t.includes(e)}))):e===x.LTT?this.livePlayer.sendToSignal(Lt.Unsubscribe,{subIDList:t.map((function(t){return C(C({},t),{},{type:e})}))}):this.livePlayer.sendToSignal(Lt.Unsubscribe,{subIDList:t.map((function(t){return{id:t,type:e}}))})}},{key:"sendQA",value:function(e,t){this.sendToSignal(Lt.SendQA,{id:e,data:t})}},{key:"sendReaction",value:function(e,t){this.sendToSignal(Lt.SendReaction,{id:e,index:t})}},{key:"sendBulletScreen",value:function(e,t,r,n){"string"==typeof r?this.sendToSignal(Lt.SendBulletScreen,{id:e,data:{operation:1,senderName:t,content:r,msgType:n||0}}):"object"===j(r)&&(!r.senderName&&t&&(r.senderName=t),this.sendToSignal(Lt.SendBulletScreen,{id:e,data:r}))}},{key:"sendToSignal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!!this.signalSocket&&this.signalSocket.sendMessage({evt:e,seq:this.heartbeatIns.incrementSeq().getSeq(),body:t})}}]);var r}(It),Rr=void 0!==U?U:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},Ir=[],Dr=[],Mr="undefined"!=typeof Uint8Array?Uint8Array:Array,Or=!1;function xr(){Or=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0;t<64;++t)Ir[t]=e[t],Dr[e.charCodeAt(t)]=t;Dr["-".charCodeAt(0)]=62,Dr["_".charCodeAt(0)]=63}function Pr(e,t,r){for(var n,i,a=[],o=t;o<r;o+=3)n=(e[o]<<16)+(e[o+1]<<8)+e[o+2],a.push(Ir[(i=n)>>18&63]+Ir[i>>12&63]+Ir[i>>6&63]+Ir[63&i]);return a.join("")}function Lr(e){var t;Or||xr();for(var r=e.length,n=r%3,i="",a=[],o=16383,s=0,u=r-n;s<u;s+=o)a.push(Pr(e,s,s+o>u?u:s+o));return 1===n?(t=e[r-1],i+=Ir[t>>2],i+=Ir[t<<4&63],i+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],i+=Ir[t>>10],i+=Ir[t>>4&63],i+=Ir[t<<2&63],i+="="),a.push(i),a.join("")}function Nr(e,t,r,n,i){var a,o,s=8*i-n-1,u=(1<<s)-1,c=u>>1,d=-7,l=r?i-1:0,h=r?-1:1,f=e[t+l];for(l+=h,a=f&(1<<-d)-1,f>>=-d,d+=s;d>0;a=256*a+e[t+l],l+=h,d-=8);for(o=a&(1<<-d)-1,a>>=-d,d+=n;d>0;o=256*o+e[t+l],l+=h,d-=8);if(0===a)a=1-c;else{if(a===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),a-=c}return(f?-1:1)*o*Math.pow(2,a-n)}function Vr(e,t,r,n,i,a){var o,s,u,c=8*a-i-1,d=(1<<c)-1,l=d>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,p=n?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=d):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+l>=1?h/u:h*Math.pow(2,1-l))*u>=2&&(o++,u/=2),o+l>=d?(s=0,o=d):o+l>=1?(s=(t*u-1)*Math.pow(2,i),o+=l):(s=t*Math.pow(2,l-1)*Math.pow(2,i),o=0));i>=8;e[r+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;e[r+f]=255&o,f+=p,o/=256,c-=8);e[r+f-p]|=128*v}var Ur={}.toString,Fr=Array.isArray||function(e){return"[object Array]"==Ur.call(e)};function Br(){return Gr.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Wr(e,t){if(Br()<t)throw new RangeError("Invalid typed array length");return Gr.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Gr.prototype:(null===e&&(e=new Gr(t)),e.length=t),e}function Gr(e,t,r){if(!(Gr.TYPED_ARRAY_SUPPORT||this instanceof Gr))return new Gr(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return Kr(this,e)}return Hr(this,e,t,r)}function Hr(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n),Gr.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Gr.prototype:e=zr(e,t),e}(e,t,r,n):"string"==typeof t?function(e,t,r){if("string"==typeof r&&""!==r||(r="utf8"),!Gr.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|Xr(t,r),i=(e=Wr(e,n)).write(t,r);return i!==n&&(e=e.slice(0,i)),e}(e,t,r):function(e,t){if(Yr(t)){var r=0|qr(t.length);return 0===(e=Wr(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?Wr(e,0):zr(e,t);if("Buffer"===t.type&&Fr(t.data))return zr(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function jr(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function Kr(e,t){if(jr(t),e=Wr(e,t<0?0:0|qr(t)),!Gr.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function zr(e,t){var r=t.length<0?0:0|qr(t.length);e=Wr(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function qr(e){if(e>=Br())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Br().toString(16)+" bytes");return 0|e}function Yr(e){return!(null==e||!e._isBuffer)}function Xr(e,t){if(Yr(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return En(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return kn(e).length;default:if(n)return En(e).length;t=(""+t).toLowerCase(),n=!0}}function Qr(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return hn(this,t,r);case"utf8":case"utf-8":return un(this,t,r);case"ascii":return dn(this,t,r);case"latin1":case"binary":return ln(this,t,r);case"base64":return sn(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return fn(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function Jr(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function $r(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=Gr.from(t,n)),Yr(t))return 0===t.length?-1:Zr(e,t,r,n,i);if("number"==typeof t)return t&=255,Gr.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):Zr(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function Zr(e,t,r,n,i){var a,o=1,s=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,s/=2,u/=2,r/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var d=-1;for(a=r;a<s;a++)if(c(e,a)===c(t,-1===d?0:a-d)){if(-1===d&&(d=a),a-d+1===u)return d*o}else-1!==d&&(a-=a-d),d=-1}else for(r+u>s&&(r=s-u),a=r;a>=0;a--){for(var l=!0,h=0;h<u;h++)if(c(e,a+h)!==c(t,h)){l=!1;break}if(l)return a}return-1}function en(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var o=0;o<n;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[r+o]=s}return o}function tn(e,t,r,n){return Cn(En(t,e.length-r),e,r,n)}function rn(e,t,r,n){return Cn(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function nn(e,t,r,n){return rn(e,t,r,n)}function an(e,t,r,n){return Cn(kn(t),e,r,n)}function on(e,t,r,n){return Cn(function(e,t){for(var r,n,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)n=(r=e.charCodeAt(o))>>8,i=r%256,a.push(i),a.push(n);return a}(t,e.length-r),e,r,n)}function sn(e,t,r){return 0===t&&r===e.length?Lr(e):Lr(e.slice(t,r))}function un(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,o,s,u,c=e[i],d=null,l=c>239?4:c>223?3:c>191?2:1;if(i+l<=r)switch(l){case 1:c<128&&(d=c);break;case 2:128==(192&(a=e[i+1]))&&(u=(31&c)<<6|63&a)>127&&(d=u);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(u=(15&c)<<12|(63&a)<<6|63&o)>2047&&(u<55296||u>57343)&&(d=u);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(u=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&u<1114112&&(d=u)}null===d?(d=65533,l=1):d>65535&&(d-=65536,n.push(d>>>10&1023|55296),d=56320|1023&d),n.push(d),i+=l}return function(e){var t=e.length;if(t<=cn)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=cn));return r}(n)}Gr.TYPED_ARRAY_SUPPORT=void 0===Rr.TYPED_ARRAY_SUPPORT||Rr.TYPED_ARRAY_SUPPORT,Br(),Gr.poolSize=8192,Gr._augment=function(e){return e.__proto__=Gr.prototype,e},Gr.from=function(e,t,r){return Hr(null,e,t,r)},Gr.TYPED_ARRAY_SUPPORT&&(Gr.prototype.__proto__=Uint8Array.prototype,Gr.__proto__=Uint8Array),Gr.alloc=function(e,t,r){return function(e,t,r,n){return jr(t),t<=0?Wr(e,t):void 0!==r?"string"==typeof n?Wr(e,t).fill(r,n):Wr(e,t).fill(r):Wr(e,t)}(null,e,t,r)},Gr.allocUnsafe=function(e){return Kr(null,e)},Gr.allocUnsafeSlow=function(e){return Kr(null,e)},Gr.isBuffer=function(e){return null!=e&&(!!e._isBuffer||wn(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&wn(e.slice(0,0))}(e))},Gr.compare=function(e,t){if(!Yr(e)||!Yr(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},Gr.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Gr.concat=function(e,t){if(!Fr(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Gr.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=Gr.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var a=e[r];if(!Yr(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,i),i+=a.length}return n},Gr.byteLength=Xr,Gr.prototype._isBuffer=!0,Gr.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Jr(this,t,t+1);return this},Gr.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Jr(this,t,t+3),Jr(this,t+1,t+2);return this},Gr.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Jr(this,t,t+7),Jr(this,t+1,t+6),Jr(this,t+2,t+5),Jr(this,t+3,t+4);return this},Gr.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?un(this,0,e):Qr.apply(this,arguments)},Gr.prototype.equals=function(e){if(!Yr(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Gr.compare(this,e)},Gr.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},Gr.prototype.compare=function(e,t,r,n,i){if(!Yr(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),s=Math.min(a,o),u=this.slice(n,i),c=e.slice(t,r),d=0;d<s;++d)if(u[d]!==c[d]){a=u[d],o=c[d];break}return a<o?-1:o<a?1:0},Gr.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},Gr.prototype.indexOf=function(e,t,r){return $r(this,e,t,r,!0)},Gr.prototype.lastIndexOf=function(e,t,r){return $r(this,e,t,r,!1)},Gr.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return en(this,e,t,r);case"utf8":case"utf-8":return tn(this,e,t,r);case"ascii":return rn(this,e,t,r);case"latin1":case"binary":return nn(this,e,t,r);case"base64":return an(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return on(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},Gr.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var cn=4096;function dn(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function ln(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function hn(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=t;a<r;++a)i+=bn(e[a]);return i}function fn(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function pn(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function vn(e,t,r,n,i,a){if(!Yr(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function gn(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-r,2);i<a;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function mn(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-r,4);i<a;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function yn(e,t,r,n,i,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function _n(e,t,r,n,i){return i||yn(e,0,r,4),Vr(e,t,r,n,23,4),r+4}function Sn(e,t,r,n,i){return i||yn(e,0,r,8),Vr(e,t,r,n,52,8),r+8}Gr.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),Gr.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=Gr.prototype;else{var i=t-e;r=new Gr(i,void 0);for(var a=0;a<i;++a)r[a]=this[a+e]}return r},Gr.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||pn(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},Gr.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||pn(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},Gr.prototype.readUInt8=function(e,t){return t||pn(e,1,this.length),this[e]},Gr.prototype.readUInt16LE=function(e,t){return t||pn(e,2,this.length),this[e]|this[e+1]<<8},Gr.prototype.readUInt16BE=function(e,t){return t||pn(e,2,this.length),this[e]<<8|this[e+1]},Gr.prototype.readUInt32LE=function(e,t){return t||pn(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Gr.prototype.readUInt32BE=function(e,t){return t||pn(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Gr.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||pn(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},Gr.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||pn(e,t,this.length);for(var n=t,i=1,a=this[e+--n];n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},Gr.prototype.readInt8=function(e,t){return t||pn(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Gr.prototype.readInt16LE=function(e,t){t||pn(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},Gr.prototype.readInt16BE=function(e,t){t||pn(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},Gr.prototype.readInt32LE=function(e,t){return t||pn(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Gr.prototype.readInt32BE=function(e,t){return t||pn(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Gr.prototype.readFloatLE=function(e,t){return t||pn(e,4,this.length),Nr(this,e,!0,23,4)},Gr.prototype.readFloatBE=function(e,t){return t||pn(e,4,this.length),Nr(this,e,!1,23,4)},Gr.prototype.readDoubleLE=function(e,t){return t||pn(e,8,this.length),Nr(this,e,!0,52,8)},Gr.prototype.readDoubleBE=function(e,t){return t||pn(e,8,this.length),Nr(this,e,!1,52,8)},Gr.prototype.writeUIntLE=function(e,t,r,n){e=+e,t|=0,r|=0,n||vn(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},Gr.prototype.writeUIntBE=function(e,t,r,n){e=+e,t|=0,r|=0,n||vn(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},Gr.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||vn(this,e,t,1,255,0),Gr.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Gr.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||vn(this,e,t,2,65535,0),Gr.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):gn(this,e,t,!0),t+2},Gr.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||vn(this,e,t,2,65535,0),Gr.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):gn(this,e,t,!1),t+2},Gr.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||vn(this,e,t,4,4294967295,0),Gr.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):mn(this,e,t,!0),t+4},Gr.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||vn(this,e,t,4,4294967295,0),Gr.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):mn(this,e,t,!1),t+4},Gr.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);vn(this,e,t,r,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<r&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o|0)-s&255;return t+r},Gr.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);vn(this,e,t,r,i-1,-i)}var a=r-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o|0)-s&255;return t+r},Gr.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||vn(this,e,t,1,127,-128),Gr.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Gr.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||vn(this,e,t,2,32767,-32768),Gr.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):gn(this,e,t,!0),t+2},Gr.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||vn(this,e,t,2,32767,-32768),Gr.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):gn(this,e,t,!1),t+2},Gr.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||vn(this,e,t,4,2147483647,-2147483648),Gr.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):mn(this,e,t,!0),t+4},Gr.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||vn(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Gr.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):mn(this,e,t,!1),t+4},Gr.prototype.writeFloatLE=function(e,t,r){return _n(this,e,t,!0,r)},Gr.prototype.writeFloatBE=function(e,t,r){return _n(this,e,t,!1,r)},Gr.prototype.writeDoubleLE=function(e,t,r){return Sn(this,e,t,!0,r)},Gr.prototype.writeDoubleBE=function(e,t,r){return Sn(this,e,t,!1,r)},Gr.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,a=n-r;if(this===e&&r<t&&t<n)for(i=a-1;i>=0;--i)e[i+t]=this[i+r];else if(a<1e3||!Gr.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},Gr.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Gr.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var o=Yr(e)?e:En(new Gr(e,n).toString()),s=o.length;for(a=0;a<r-t;++a)this[a+t]=o[a%s]}return this};var An=/[^+\/0-9A-Za-z-_]/g;function bn(e){return e<16?"0"+e.toString(16):e.toString(16)}function En(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function kn(e){return function(e){var t,r,n,i,a,o;Or||xr();var s=e.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");a="="===e[s-2]?2:"="===e[s-1]?1:0,o=new Mr(3*s/4-a),n=a>0?s-4:s;var u=0;for(t=0,r=0;t<n;t+=4,r+=3)i=Dr[e.charCodeAt(t)]<<18|Dr[e.charCodeAt(t+1)]<<12|Dr[e.charCodeAt(t+2)]<<6|Dr[e.charCodeAt(t+3)],o[u++]=i>>16&255,o[u++]=i>>8&255,o[u++]=255&i;return 2===a?(i=Dr[e.charCodeAt(t)]<<2|Dr[e.charCodeAt(t+1)]>>4,o[u++]=255&i):1===a&&(i=Dr[e.charCodeAt(t)]<<10|Dr[e.charCodeAt(t+1)]<<4|Dr[e.charCodeAt(t+2)]>>2,o[u++]=i>>8&255,o[u++]=255&i),o}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(An,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Cn(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function wn(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var Tn=16,Rn=function(e){function t(e){var r;return R(this,t),(r=c(this,t,[e])).prevMap=new Map,r}return f(t,e),D(t,[{key:"init",value:function(){s(t,"init",this)([])}},{key:"initSubscription",value:function(){var e=this;Ot.on(Nt.LTTData).pipe(Rt(this.destroy$)).subscribe((function(t){var r=t.data,n=t.id;e.parseNewLTT(n,r)}))}},{key:"parseNewLTT",value:function(e,t){try{if(0===t.errorCode){var r=this.utf8ArrayToStr(this.decodeBase64ToBuffer(t.text));this.livePlayer.emit("closedCaption",{id:e,data:r})}else 1===t.errorCode&&this.livePlayer.emit("closedCaption",{id:e,data:"Translation Not Supported"})}catch(e){}}},{key:"decodeBase64ToBuffer",value:function(e){return e=(e+=Array(5-e.length%4).join("=")).replace(/\-/g,"+").replace(/\_/g,"/"),Gr.from(e,"base64")}},{key:"readRealTimeClosedCaption",value:function(e,t){var r=e.changedContent,n=e.where,i=e.operation,a=e.count,o=this.utf8ArrayToStr(this.decodeBase64ToBuffer(r)),s=t;switch(i){case"add":s=o;break;case"replace":if((-1===a||a>this.getStringLength(s))&&""===o&&0===n){s="";break}if(n<0||a<-1)break;s=this.replaceStringByCodeLength(s,o,n,a)}return s}},{key:"getCharLength",value:function(e){var t=e.charCodeAt(0);return t<=parseInt("0x7F",Tn)?1:t<=parseInt("0x7FF",Tn)?2:t<=parseInt("0xFFFF",Tn)?3:t<=parseInt("0x1FFFFF",Tn)?4:t<=parseInt("0x3FFFFFF",Tn)?5:6}},{key:"getStringLength",value:function(e){if(""===e||void 0===e)return 0;for(var t=0,r=0;r<e.length;r++)e.charCodeAt(r)<=parseInt("0x7F",Tn)?t+=1:e.charCodeAt(r)<=parseInt("0x7FF",Tn)?t+=2:e.charCodeAt(r)<=parseInt("0xFFFF",Tn)?t+=3:e.charCodeAt(r)<=parseInt("0x1FFFFF",Tn)?t+=4:e.charCodeAt(r)<=parseInt("0x3FFFFFF",Tn)?t+=5:t+=6;return t}},{key:"replaceStringByCodeLength",value:function(e,t,r,n){var i=0,a="",o=n,s=r,u=this.getStringLength(e);if(""===e)return t;if(r>=u&&0===o)return e+t;if(0===s&&0===o)return t;(-1===n||r+n>u)&&(o=u-r),0===o&&r===u&&r>0&&(s=r-1);for(var c=0;c<e.length&&(i===s&&(a=e.slice(0,c)+t),i!==u-1);c++){if(i===s+o){a+=e.slice(c);break}i+=this.getCharLength(e[c])}return a}},{key:"utf8ArrayToStr",value:function(e){for(var t,r,n,i="",a=0,o=e.length;a<o;)switch((t=e[a++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:i+=String.fromCharCode(t);break;case 12:case 13:r=e[a++],i+=String.fromCharCode((31&t)<<6|63&r);break;case 14:r=e[a++],n=e[a++],i+=String.fromCharCode((15&t)<<12|(63&r)<<6|63&n)}return i}},{key:"destroy",value:function(){s(t,"destroy",this)([])}}])}(It),In={};function Dn(e,t){return function(){return e.apply(t,arguments)}}var Mn,On=Object.prototype.toString,xn=Object.getPrototypeOf,Pn=(Mn=Object.create(null),function(e){var t=On.call(e);return Mn[t]||(Mn[t]=t.slice(8,-1).toLowerCase())}),Ln=function(e){return e=e.toLowerCase(),function(t){return Pn(t)===e}},Nn=function(e){return function(t){return j(t)===e}},Vn=Array.isArray,Un=Nn("undefined"),Fn=Ln("ArrayBuffer"),Bn=Nn("string"),Wn=Nn("function"),Gn=Nn("number"),Hn=function(e){return null!==e&&"object"===j(e)},jn=function(e){if("object"!==Pn(e))return!1;var t=xn(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},Kn=Ln("Date"),zn=Ln("File"),qn=Ln("Blob"),Yn=Ln("FileList"),Xn=Ln("URLSearchParams"),Qn=v(["ReadableStream","Request","Response","Headers"].map(Ln),4),Jn=Qn[0],$n=Qn[1],Zn=Qn[2],ei=Qn[3];function ti(e,t){var r,n,i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).allOwnKeys,a=void 0!==i&&i;if(null!=e)if("object"!==j(e)&&(e=[e]),Vn(e))for(r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else{var o,s=a?Object.getOwnPropertyNames(e):Object.keys(e),u=s.length;for(r=0;r<u;r++)o=s[r],t.call(null,e[o],o,e)}}function ri(e,t){t=t.toLowerCase();for(var r,n=Object.keys(e),i=n.length;i-- >0;)if(t===(r=n[i]).toLowerCase())return r;return null}var ni,ii,ai,oi,si,ui,ci="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:Rr,di=function(e){return!Un(e)&&e!==ci},li=(ni="undefined"!=typeof Uint8Array&&xn(Uint8Array),function(e){return ni&&e instanceof ni}),hi=Ln("HTMLFormElement"),fi=(ii=Object.prototype.hasOwnProperty,function(e,t){return ii.call(e,t)}),pi=Ln("RegExp"),vi=function(e,t){var r=Object.getOwnPropertyDescriptors(e),n={};ti(r,(function(r,i){var a;!1!==(a=t(r,i,e))&&(n[i]=a||r)})),Object.defineProperties(e,n)},gi=Ln("AsyncFunction"),mi=(ai="function"==typeof setImmediate,oi=Wn(ci.postMessage),ai?setImmediate:oi?(si="axios@".concat(Math.random()),ui=[],ci.addEventListener("message",(function(e){var t=e.source,r=e.data;t===ci&&r===si&&ui.length&&ui.shift()()}),!1),function(e){ui.push(e),ci.postMessage(si,"*")}):function(e){return setTimeout(e)}),yi="undefined"!=typeof queueMicrotask?queueMicrotask.bind(ci):void 0!==In&&In.nextTick||mi,_i={isArray:Vn,isArrayBuffer:Fn,isBuffer:function(e){return null!==e&&!Un(e)&&null!==e.constructor&&!Un(e.constructor)&&Wn(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:function(e){var t;return e&&("function"==typeof FormData&&e instanceof FormData||Wn(e.append)&&("formdata"===(t=Pn(e))||"object"===t&&Wn(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Fn(e.buffer)},isString:Bn,isNumber:Gn,isBoolean:function(e){return!0===e||!1===e},isObject:Hn,isPlainObject:jn,isReadableStream:Jn,isRequest:$n,isResponse:Zn,isHeaders:ei,isUndefined:Un,isDate:Kn,isFile:zn,isBlob:qn,isRegExp:pi,isFunction:Wn,isStream:function(e){return Hn(e)&&Wn(e.pipe)},isURLSearchParams:Xn,isTypedArray:li,isFileList:Yn,forEach:ti,merge:function e(){for(var t=(di(this)&&this||{}).caseless,r={},n=function(n,i){var a=t&&ri(r,i)||i;jn(r[a])&&jn(n)?r[a]=e(r[a],n):jn(n)?r[a]=e({},n):Vn(n)?r[a]=n.slice():r[a]=n},i=0,a=arguments.length;i<a;i++)arguments[i]&&ti(arguments[i],n);return r},extend:function(e,t,r){return ti(t,(function(t,n){r&&Wn(t)?e[n]=Dn(t,r):e[n]=t}),{allOwnKeys:(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).allOwnKeys}),e},trim:function(e){return e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e},inherits:function(e,t,r,n){e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:function(e,t,r,n){var i,a,o,s={};if(t=t||{},null==e)return t;do{for(a=(i=Object.getOwnPropertyNames(e)).length;a-- >0;)o=i[a],n&&!n(o,e,t)||s[o]||(t[o]=e[o],s[o]=!0);e=!1!==r&&xn(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:Pn,kindOfTest:Ln,endsWith:function(e,t,r){e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;var n=e.indexOf(t,r);return-1!==n&&n===r},toArray:function(e){if(!e)return null;if(Vn(e))return e;var t=e.length;if(!Gn(t))return null;for(var r=new Array(t);t-- >0;)r[t]=e[t];return r},forEachEntry:function(e,t){for(var r,n=(e&&e[Symbol.iterator]).call(e);(r=n.next())&&!r.done;){var i=r.value;t.call(e,i[0],i[1])}},matchAll:function(e,t){for(var r,n=[];null!==(r=e.exec(t));)n.push(r);return n},isHTMLForm:hi,hasOwnProperty:fi,hasOwnProp:fi,reduceDescriptors:vi,freezeMethods:function(e){vi(e,(function(t,r){if(Wn(e)&&-1!==["arguments","caller","callee"].indexOf(r))return!1;var n=e[r];Wn(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=function(){throw Error("Can not rewrite read-only method '"+r+"'")}))}))},toObjectSet:function(e,t){var r={},n=function(e){e.forEach((function(e){r[e]=!0}))};return Vn(e)?n(e):n(String(e).split(t)),r},toCamelCase:function(e){return e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,r){return t.toUpperCase()+r}))},noop:function(){},toFiniteNumber:function(e,t){return null!=e&&Number.isFinite(e=+e)?e:t},findKey:ri,global:ci,isContextDefined:di,isSpecCompliantForm:function(e){return!!(e&&Wn(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:function(e){var t=new Array(10),r=function(e,n){if(Hn(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;var i=Vn(e)?[]:{};return ti(e,(function(e,t){var a=r(e,n+1);!Un(a)&&(i[t]=a)})),t[n]=void 0,i}}return e};return r(e,0)},isAsyncFn:gi,isThenable:function(e){return e&&(Hn(e)||Wn(e))&&Wn(e.then)&&Wn(e.catch)},setImmediate:mi,asap:yi};function Si(e,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}_i.inherits(Si,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:_i.toJSONObject(this.config),code:this.code,status:this.status}}});var Ai=Si.prototype,bi={};function Ei(e){return _i.isPlainObject(e)||_i.isArray(e)}function ki(e){return _i.endsWith(e,"[]")?e.slice(0,-2):e}function Ci(e,t,r){return e?e.concat(t).map((function(e,t){return e=ki(e),!r&&t?"["+e+"]":e})).join(r?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((function(e){bi[e]={value:e}})),Object.defineProperties(Si,bi),Object.defineProperty(Ai,"isAxiosError",{value:!0}),Si.from=function(e,t,r,n,i,a){var o=Object.create(Ai);return _i.toFlatObject(e,o,(function(e){return e!==Error.prototype}),(function(e){return"isAxiosError"!==e})),Si.call(o,e.message,t,r,n,i),o.cause=e,o.name=e.name,a&&Object.assign(o,a),o};var wi=_i.toFlatObject(_i,{},null,(function(e){return/^is[A-Z]/.test(e)}));function Ti(e,t,r){if(!_i.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;var n=(r=_i.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!_i.isUndefined(t[e])}))).metaTokens,i=r.visitor||c,a=r.dots,o=r.indexes,s=(r.Blob||"undefined"!=typeof Blob&&Blob)&&_i.isSpecCompliantForm(t);if(!_i.isFunction(i))throw new TypeError("visitor must be a function");function u(e){if(null===e)return"";if(_i.isDate(e))return e.toISOString();if(!s&&_i.isBlob(e))throw new Si("Blob is not supported. Use a Buffer instead.");return _i.isArrayBuffer(e)||_i.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Gr.from(e):e}function c(e,r,i){var s=e;if(e&&!i&&"object"===j(e))if(_i.endsWith(r,"{}"))r=n?r:r.slice(0,-2),e=JSON.stringify(e);else if(_i.isArray(e)&&function(e){return _i.isArray(e)&&!e.some(Ei)}(e)||(_i.isFileList(e)||_i.endsWith(r,"[]"))&&(s=_i.toArray(e)))return r=ki(r),s.forEach((function(e,n){!_i.isUndefined(e)&&null!==e&&t.append(!0===o?Ci([r],n,a):null===o?r:r+"[]",u(e))})),!1;return!!Ei(e)||(t.append(Ci(i,r,a),u(e)),!1)}var d=[],l=Object.assign(wi,{defaultVisitor:c,convertValue:u,isVisitable:Ei});if(!_i.isObject(e))throw new TypeError("data must be an object");return function e(r,n){if(!_i.isUndefined(r)){if(-1!==d.indexOf(r))throw Error("Circular reference detected in "+n.join("."));d.push(r),_i.forEach(r,(function(r,a){!0===(!(_i.isUndefined(r)||null===r)&&i.call(t,r,_i.isString(a)?a.trim():a,n,l))&&e(r,n?n.concat(a):[a])})),d.pop()}}(e),t}function Ri(e){var t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function Ii(e,t){this._pairs=[],e&&Ti(e,this,t)}var Di=Ii.prototype;function Mi(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Oi(e,t,r){if(!t)return e;var n=r&&r.encode||Mi;_i.isFunction(r)&&(r={serialize:r});var i,a=r&&r.serialize;if(i=a?a(t,r):_i.isURLSearchParams(t)?t.toString():new Ii(t,r).toString(n)){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}Di.append=function(e,t){this._pairs.push([e,t])},Di.toString=function(e){var t=e?function(t){return e.call(this,t,Ri)}:Ri;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var xi=D((function e(){R(this,e),this.handlers=[]}),[{key:"use",value:function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}},{key:"eject",value:function(e){this.handlers[e]&&(this.handlers[e]=null)}},{key:"clear",value:function(){this.handlers&&(this.handlers=[])}},{key:"forEach",value:function(e){_i.forEach(this.handlers,(function(t){null!==t&&e(t)}))}}]),Pi={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Li={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:Ii,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},Ni="undefined"!=typeof window&&"undefined"!=typeof document,Vi="object"===("undefined"==typeof navigator?"undefined":j(navigator))&&navigator||void 0,Ui=Ni&&(!Vi||["ReactNative","NativeScript","NS"].indexOf(Vi.product)<0),Fi="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,Bi=Ni&&window.location.href||"http://localhost",Wi=C(C({},Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ni,hasStandardBrowserWebWorkerEnv:Fi,hasStandardBrowserEnv:Ui,navigator:Vi,origin:Bi},Symbol.toStringTag,{value:"Module"}))),Li);function Gi(e){function t(e,r,n,i){var a=e[i++];if("__proto__"===a)return!0;var o=Number.isFinite(+a),s=i>=e.length;return a=!a&&_i.isArray(n)?n.length:a,s?(_i.hasOwnProp(n,a)?n[a]=[n[a],r]:n[a]=r,!o):(n[a]&&_i.isObject(n[a])||(n[a]=[]),t(e,r,n[a],i)&&_i.isArray(n[a])&&(n[a]=function(e){var t,r,n={},i=Object.keys(e),a=i.length;for(t=0;t<a;t++)n[r=i[t]]=e[r];return n}(n[a])),!o)}if(_i.isFormData(e)&&_i.isFunction(e.entries)){var r={};return _i.forEachEntry(e,(function(e,n){t(function(e){return _i.matchAll(/\w+|\[(\w*)]/g,e).map((function(e){return"[]"===e[0]?"":e[1]||e[0]}))}(e),n,r,0)})),r}return null}var Hi={transitional:Pi,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){var r,n=t.getContentType()||"",i=n.indexOf("application/json")>-1,a=_i.isObject(e);if(a&&_i.isHTMLForm(e)&&(e=new FormData(e)),_i.isFormData(e))return i?JSON.stringify(Gi(e)):e;if(_i.isArrayBuffer(e)||_i.isBuffer(e)||_i.isStream(e)||_i.isFile(e)||_i.isBlob(e)||_i.isReadableStream(e))return e;if(_i.isArrayBufferView(e))return e.buffer;if(_i.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();if(a){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Ti(e,new Wi.classes.URLSearchParams,Object.assign({visitor:function(e,t,r,n){return Wi.isNode&&_i.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((r=_i.isFileList(e))||n.indexOf("multipart/form-data")>-1){var o=this.env&&this.env.FormData;return Ti(r?{"files[]":e}:e,o&&new o,this.formSerializer)}}return a||i?(t.setContentType("application/json",!1),function(e){if(_i.isString(e))try{return(0,JSON.parse)(e),_i.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||Hi.transitional,r=t&&t.forcedJSONParsing,n="json"===this.responseType;if(_i.isResponse(e)||_i.isReadableStream(e))return e;if(e&&_i.isString(e)&&(r&&!this.responseType||n)){var i=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw Si.from(e,Si.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Wi.classes.FormData,Blob:Wi.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};_i.forEach(["delete","get","head","post","put","patch"],(function(e){Hi.headers[e]={}}));var ji=Hi,Ki=_i.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),zi=Symbol("internals");function qi(e){return e&&String(e).trim().toLowerCase()}function Yi(e){return!1===e||null==e?e:_i.isArray(e)?e.map(Yi):String(e)}function Xi(e,t,r,n,i){return _i.isFunction(n)?n.call(this,t,r):(i&&(t=r),_i.isString(t)?_i.isString(n)?-1!==t.indexOf(n):_i.isRegExp(n)?n.test(t):void 0:void 0)}var Qi=D((function e(t){R(this,e),t&&this.set(t)}),[{key:"set",value:function(e,t,r){var n=this;function i(e,t,r){var i=qi(t);if(!i)throw new Error("header name must be a non-empty string");var a=_i.findKey(n,i);(!a||void 0===n[a]||!0===r||void 0===r&&!1!==n[a])&&(n[a||t]=Yi(e))}var a=function(e,t){return _i.forEach(e,(function(e,r){return i(e,r,t)}))};if(_i.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(_i.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))a(function(e){var t,r,n,i={};return e&&e.split("\n").forEach((function(e){n=e.indexOf(":"),t=e.substring(0,n).trim().toLowerCase(),r=e.substring(n+1).trim(),!t||i[t]&&Ki[t]||("set-cookie"===t?i[t]?i[t].push(r):i[t]=[r]:i[t]=i[t]?i[t]+", "+r:r)})),i}(e),t);else if(_i.isHeaders(e)){var o,s=A(e.entries());try{for(s.s();!(o=s.n()).done;){var u=v(o.value,2),c=u[0];i(u[1],c,r)}}catch(e){s.e(e)}finally{s.f()}}else null!=e&&i(t,e,r);return this}},{key:"get",value:function(e,t){if(e=qi(e)){var r=_i.findKey(this,e);if(r){var n=this[r];if(!t)return n;if(!0===t)return function(e){for(var t,r=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;t=n.exec(e);)r[t[1]]=t[2];return r}(n);if(_i.isFunction(t))return t.call(this,n,r);if(_i.isRegExp(t))return t.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}},{key:"has",value:function(e,t){if(e=qi(e)){var r=_i.findKey(this,e);return!(!r||void 0===this[r]||t&&!Xi(0,this[r],r,t))}return!1}},{key:"delete",value:function(e,t){var r=this,n=!1;function i(e){if(e=qi(e)){var i=_i.findKey(r,e);!i||t&&!Xi(0,r[i],i,t)||(delete r[i],n=!0)}}return _i.isArray(e)?e.forEach(i):i(e),n}},{key:"clear",value:function(e){for(var t=Object.keys(this),r=t.length,n=!1;r--;){var i=t[r];e&&!Xi(0,this[i],i,e,!0)||(delete this[i],n=!0)}return n}},{key:"normalize",value:function(e){var t=this,r={};return _i.forEach(this,(function(n,i){var a=_i.findKey(r,i);if(a)return t[a]=Yi(n),void delete t[i];var o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(function(e,t,r){return t.toUpperCase()+r}))}(i):String(i).trim();o!==i&&delete t[i],t[o]=Yi(n),r[o]=!0})),this}},{key:"concat",value:function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=this.constructor).concat.apply(e,[this].concat(r))}},{key:"toJSON",value:function(e){var t=Object.create(null);return _i.forEach(this,(function(r,n){null!=r&&!1!==r&&(t[n]=e&&_i.isArray(r)?r.join(", "):r)})),t}},{key:Symbol.iterator,value:function(){return Object.entries(this.toJSON())[Symbol.iterator]()}},{key:"toString",value:function(){return Object.entries(this.toJSON()).map((function(e){var t=v(e,2);return t[0]+": "+t[1]})).join("\n")}},{key:Symbol.toStringTag,get:function(){return"AxiosHeaders"}}],[{key:"from",value:function(e){return e instanceof this?e:new this(e)}},{key:"concat",value:function(e){for(var t=new this(e),r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return n.forEach((function(e){return t.set(e)})),t}},{key:"accessor",value:function(e){var t=(this[zi]=this[zi]={accessors:{}}).accessors,r=this.prototype;function n(e){var n=qi(e);t[n]||(function(e,t){var r=_i.toCamelCase(" "+t);["get","set","has"].forEach((function(n){Object.defineProperty(e,n+r,{value:function(e,r,i){return this[n].call(this,t,e,r,i)},configurable:!0})}))}(r,e),t[n]=!0)}return _i.isArray(e)?e.forEach(n):n(e),this}}]);Qi.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),_i.reduceDescriptors(Qi.prototype,(function(e,t){var r=e.value,n=t[0].toUpperCase()+t.slice(1);return{get:function(){return r},set:function(e){this[n]=e}}})),_i.freezeMethods(Qi);var Ji=Qi;function $i(e,t){var r=this||ji,n=t||r,i=Ji.from(n.headers),a=n.data;return _i.forEach(e,(function(e){a=e.call(r,a,i.normalize(),t?t.status:void 0)})),i.normalize(),a}function Zi(e){return!(!e||!e.__CANCEL__)}function ea(e,t,r){Si.call(this,null==e?"canceled":e,Si.ERR_CANCELED,t,r),this.name="CanceledError"}function ta(e,t,r){var n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(new Si("Request failed with status code "+r.status,[Si.ERR_BAD_REQUEST,Si.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}_i.inherits(ea,Si,{__CANCEL__:!0});var ra,na,ia=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=0,i=function(e,t){e=e||10;var r,n=new Array(e),i=new Array(e),a=0,o=0;return t=void 0!==t?t:1e3,function(s){var u=Date.now(),c=i[o];r||(r=u),n[a]=s,i[a]=u;for(var d=o,l=0;d!==a;)l+=n[d++],d%=e;if((a=(a+1)%e)===o&&(o=(o+1)%e),!(u-r<t)){var h=c&&u-c;return h?Math.round(1e3*l/h):void 0}}}(50,250);return function(e,t){var r,n,i=0,a=1e3/t,o=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();i=a,r=null,n&&(clearTimeout(n),n=null),e.apply(null,t)};return[function(){for(var e=Date.now(),t=e-i,s=arguments.length,u=new Array(s),c=0;c<s;c++)u[c]=arguments[c];t>=a?o(u,e):(r=u,n||(n=setTimeout((function(){n=null,o(r)}),a-t)))},function(){return r&&o(r)}]}((function(r){var a=r.loaded,o=r.lengthComputable?r.total:void 0,s=a-n,u=i(s);n=a;var c=w({loaded:a,total:o,progress:o?a/o:void 0,bytes:s,rate:u||void 0,estimated:u&&o&&a<=o?(o-a)/u:void 0,event:r,lengthComputable:null!=o},t?"download":"upload",!0);e(c)}),r)},aa=function(e,t){var r=null!=e;return[function(n){return t[0]({lengthComputable:r,total:e,loaded:n})},t[1]]},oa=function(e){return function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return _i.asap((function(){return e.apply(void 0,r)}))}},sa=Wi.hasStandardBrowserEnv?(ra=new URL(Wi.origin),na=Wi.navigator&&/(msie|trident)/i.test(Wi.navigator.userAgent),function(e){return e=new URL(e,Wi.origin),ra.protocol===e.protocol&&ra.host===e.host&&(na||ra.port===e.port)}):function(){return!0},ua=Wi.hasStandardBrowserEnv?{write:function(e,t,r,n,i,a){var o=[e+"="+encodeURIComponent(t)];_i.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),_i.isString(n)&&o.push("path="+n),_i.isString(i)&&o.push("domain="+i),!0===a&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function ca(e,t,r){var n=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(n||0==r)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}var da=function(e){return e instanceof Ji?C({},e):e};function la(e,t){t=t||{};var r={};function n(e,t,r,n){return _i.isPlainObject(e)&&_i.isPlainObject(t)?_i.merge.call({caseless:n},e,t):_i.isPlainObject(t)?_i.merge({},t):_i.isArray(t)?t.slice():t}function i(e,t,r,i){return _i.isUndefined(t)?_i.isUndefined(e)?void 0:n(void 0,e,0,i):n(e,t,0,i)}function a(e,t){if(!_i.isUndefined(t))return n(void 0,t)}function o(e,t){return _i.isUndefined(t)?_i.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function s(r,i,a){return a in t?n(r,i):a in e?n(void 0,r):void 0}var u={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:function(e,t,r){return i(da(e),da(t),0,!0)}};return _i.forEach(Object.keys(Object.assign({},e,t)),(function(n){var a=u[n]||i,o=a(e[n],t[n],n);_i.isUndefined(o)&&a!==s||(r[n]=o)})),r}var ha,fa,pa=function(e){var t,r=la({},e),n=r.data,i=r.withXSRFToken,a=r.xsrfHeaderName,o=r.xsrfCookieName,s=r.headers,u=r.auth;if(r.headers=s=Ji.from(s),r.url=Oi(ca(r.baseURL,r.url,r.allowAbsoluteUrls),e.params,e.paramsSerializer),u&&s.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):""))),_i.isFormData(n))if(Wi.hasStandardBrowserEnv||Wi.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(!1!==(t=s.getContentType())){var c=t?t.split(";").map((function(e){return e.trim()})).filter(Boolean):[],d=function(e){return m(e)||S(e)||b(e)||g()}(c),l=d[0],h=d.slice(1);s.setContentType([l||"multipart/form-data"].concat(y(h)).join("; "))}if(Wi.hasStandardBrowserEnv&&(i&&_i.isFunction(i)&&(i=i(r)),i||!1!==i&&sa(r.url))){var f=a&&o&&ua.read(o);f&&s.set(a,f)}return r},va="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,r){var n,i,a,o,s,u=pa(e),c=u.data,d=Ji.from(u.headers).normalize(),l=u.responseType,h=u.onUploadProgress,f=u.onDownloadProgress;function p(){o&&o(),s&&s(),u.cancelToken&&u.cancelToken.unsubscribe(n),u.signal&&u.signal.removeEventListener("abort",n)}var g=new XMLHttpRequest;function m(){if(g){var n=Ji.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders());ta((function(e){t(e),p()}),(function(e){r(e),p()}),{data:l&&"text"!==l&&"json"!==l?g.response:g.responseText,status:g.status,statusText:g.statusText,headers:n,config:e,request:g}),g=null}}if(g.open(u.method.toUpperCase(),u.url,!0),g.timeout=u.timeout,"onloadend"in g?g.onloadend=m:g.onreadystatechange=function(){g&&4===g.readyState&&(0!==g.status||g.responseURL&&0===g.responseURL.indexOf("file:"))&&setTimeout(m)},g.onabort=function(){g&&(r(new Si("Request aborted",Si.ECONNABORTED,e,g)),g=null)},g.onerror=function(){r(new Si("Network Error",Si.ERR_NETWORK,e,g)),g=null},g.ontimeout=function(){var t=u.timeout?"timeout of "+u.timeout+"ms exceeded":"timeout exceeded",n=u.transitional||Pi;u.timeoutErrorMessage&&(t=u.timeoutErrorMessage),r(new Si(t,n.clarifyTimeoutError?Si.ETIMEDOUT:Si.ECONNABORTED,e,g)),g=null},void 0===c&&d.setContentType(null),"setRequestHeader"in g&&_i.forEach(d.toJSON(),(function(e,t){g.setRequestHeader(t,e)})),_i.isUndefined(u.withCredentials)||(g.withCredentials=!!u.withCredentials),l&&"json"!==l&&(g.responseType=u.responseType),f){var y=v(ia(f,!0),2);a=y[0],s=y[1],g.addEventListener("progress",a)}if(h&&g.upload){var _=v(ia(h),2);i=_[0],o=_[1],g.upload.addEventListener("progress",i),g.upload.addEventListener("loadend",o)}(u.cancelToken||u.signal)&&(n=function(t){g&&(r(!t||t.type?new ea(null,e,g):t),g.abort(),g=null)},u.cancelToken&&u.cancelToken.subscribe(n),u.signal&&(u.signal.aborted?n():u.signal.addEventListener("abort",n)));var S,A,b=(S=u.url,(A=/^([-+\w]{1,25})(:?\/\/|:)/.exec(S))&&A[1]||"");b&&-1===Wi.protocols.indexOf(b)?r(new Si("Unsupported protocol "+b+":",Si.ERR_BAD_REQUEST,e)):g.send(c||null)}))},ga=function(e,t){var r=(e=e?e.filter(Boolean):[]).length;if(t||r){var n,i=new AbortController,a=function(e){if(!n){n=!0,s();var t=e instanceof Error?e:this.reason;i.abort(t instanceof Si?t:new ea(t instanceof Error?t.message:t))}},o=t&&setTimeout((function(){o=null,a(new Si("timeout ".concat(t," of ms exceeded"),Si.ETIMEDOUT))}),t),s=function(){e&&(o&&clearTimeout(o),o=null,e.forEach((function(e){e.unsubscribe?e.unsubscribe(a):e.removeEventListener("abort",a)})),e=null)};e.forEach((function(e){return e.addEventListener("abort",a)}));var u=i.signal;return u.unsubscribe=function(){return _i.asap(s)},u}},ma=O().mark((function e(t,r){var n,i,a;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.byteLength,r&&!(n<r)){e.next=5;break}return e.next=4,t;case 4:return e.abrupt("return");case 5:i=0;case 6:if(!(i<n)){e.next=13;break}return a=i+r,e.next=10,t.slice(i,a);case 10:i=a,e.next=6;break;case 13:case"end":return e.stop()}}),e)})),ya=function(){var e=K(O().mark((function e(t,r){var n,i,a,o,s,u;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!1,i=!1,e.prev=2,o=Q(_a(t));case 4:return e.next=6,q(o.next());case 6:if(!(n=!(s=e.sent).done)){e.next=12;break}return u=s.value,e.delegateYield(Y(Q(ma(u,r))),"t0",9);case 9:n=!1,e.next=4;break;case 12:e.next=18;break;case 14:e.prev=14,e.t1=e.catch(2),i=!0,a=e.t1;case 18:if(e.prev=18,e.prev=19,!n||null==o.return){e.next=23;break}return e.next=23,q(o.return());case 23:if(e.prev=23,!i){e.next=26;break}throw a;case 26:return e.finish(23);case 27:return e.finish(18);case 28:case"end":return e.stop()}}),e,null,[[2,14,18,28],[19,,23,27]])})));return function(t,r){return e.apply(this,arguments)}}(),_a=function(){var e=K(O().mark((function e(t){var r,n,i,a;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t[Symbol.asyncIterator]){e.next=3;break}return e.delegateYield(Y(Q(t)),"t0",2);case 2:return e.abrupt("return");case 3:r=t.getReader(),e.prev=4;case 5:return e.next=7,q(r.read());case 7:if(n=e.sent,i=n.done,a=n.value,!i){e.next=12;break}return e.abrupt("break",16);case 12:return e.next=14,a;case 14:e.next=5;break;case 16:return e.prev=16,e.next=19,q(r.cancel());case 19:return e.finish(16);case 20:case"end":return e.stop()}}),e,null,[[4,,16,20]])})));return function(t){return e.apply(this,arguments)}}(),Sa=function(e,t,r,n){var i,a=ya(e,t),o=0,s=function(e){i||(i=!0,n&&n(e))};return new ReadableStream({pull:function(e){return H(O().mark((function t(){var n,i,u,c,d;return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,a.next();case 3:if(n=t.sent,i=n.done,u=n.value,!i){t.next=10;break}return s(),e.close(),t.abrupt("return");case 10:c=u.byteLength,r&&(d=o+=c,r(d)),e.enqueue(new Uint8Array(u)),t.next=19;break;case 15:throw t.prev=15,t.t0=t.catch(0),s(t.t0),t.t0;case 19:case"end":return t.stop()}}),t,null,[[0,15]])})))()},cancel:function(e){return s(e),a.return()}},{highWaterMark:2})},Aa="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,ba=Aa&&"function"==typeof ReadableStream,Ea=Aa&&("function"==typeof TextEncoder?(ha=new TextEncoder,function(e){return ha.encode(e)}):function(){var e=H(O().mark((function e(t){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Uint8Array,e.next=3,new Response(t).arrayBuffer();case 3:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),ka=function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return!!e.apply(void 0,r)}catch(e){return!1}},Ca=ba&&ka((function(){var e=!1,t=new Request(Wi.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),wa=ba&&ka((function(){return _i.isReadableStream(new Response("").body)})),Ta={stream:wa&&function(e){return e.body}};Aa&&(fa=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((function(e){!Ta[e]&&(Ta[e]=_i.isFunction(fa[e])?function(t){return t[e]()}:function(t,r){throw new Si("Response type '".concat(e,"' is not supported"),Si.ERR_NOT_SUPPORT,r)})})));var Ra=function(){var e=H(O().mark((function e(t){var r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return",0);case 2:if(!_i.isBlob(t)){e.next=4;break}return e.abrupt("return",t.size);case 4:if(!_i.isSpecCompliantForm(t)){e.next=9;break}return r=new Request(Wi.origin,{method:"POST",body:t}),e.next=8,r.arrayBuffer();case 8:case 15:return e.abrupt("return",e.sent.byteLength);case 9:if(!_i.isArrayBufferView(t)&&!_i.isArrayBuffer(t)){e.next=11;break}return e.abrupt("return",t.byteLength);case 11:if(_i.isURLSearchParams(t)&&(t+=""),!_i.isString(t)){e.next=16;break}return e.next=15,Ea(t);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ia=function(){var e=H(O().mark((function e(t,r){var n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=_i.toFiniteNumber(t.getContentLength()),e.abrupt("return",null==n?Ra(r):n);case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),Da=Aa&&function(){var e=H(O().mark((function e(t){var r,n,i,a,o,s,u,c,d,l,h,f,p,g,m,y,_,S,A,b,E,k,w,T,R,I,D,M,x,P,L,N,V,U;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=pa(t),n=r.url,i=r.method,a=r.data,o=r.signal,s=r.cancelToken,u=r.timeout,c=r.onDownloadProgress,d=r.onUploadProgress,l=r.responseType,h=r.headers,f=r.withCredentials,p=void 0===f?"same-origin":f,g=r.fetchOptions,l=l?(l+"").toLowerCase():"text",m=ga([o,s&&s.toAbortSignal()],u),_=m&&m.unsubscribe&&function(){m.unsubscribe()},e.prev=4,e.t0=d&&Ca&&"get"!==i&&"head"!==i,!e.t0){e.next=11;break}return e.next=9,Ia(h,a);case 9:e.t1=S=e.sent,e.t0=0!==e.t1;case 11:if(!e.t0){e.next=15;break}A=new Request(n,{method:"POST",body:a,duplex:"half"}),_i.isFormData(a)&&(b=A.headers.get("content-type"))&&h.setContentType(b),A.body&&(E=aa(S,ia(oa(d))),k=v(E,2),w=k[0],T=k[1],a=Sa(A.body,65536,w,T));case 15:return _i.isString(p)||(p=p?"include":"omit"),R="credentials"in Request.prototype,y=new Request(n,C(C({},g),{},{signal:m,method:i.toUpperCase(),headers:h.normalize().toJSON(),body:a,duplex:"half",credentials:R?p:void 0})),e.next=20,fetch(y);case 20:return I=e.sent,D=wa&&("stream"===l||"response"===l),wa&&(c||D&&_)&&(M={},["status","statusText","headers"].forEach((function(e){M[e]=I[e]})),x=_i.toFiniteNumber(I.headers.get("content-length")),P=c&&aa(x,ia(oa(c),!0))||[],L=v(P,2),N=L[0],V=L[1],I=new Response(Sa(I.body,65536,N,(function(){V&&V(),_&&_()})),M)),l=l||"text",e.next=26,Ta[_i.findKey(Ta,l)||"text"](I,t);case 26:return U=e.sent,!D&&_&&_(),e.next=30,new Promise((function(e,r){ta(e,r,{data:U,headers:Ji.from(I.headers),status:I.status,statusText:I.statusText,config:t,request:y})}));case 30:return e.abrupt("return",e.sent);case 33:if(e.prev=33,e.t2=e.catch(4),_&&_(),!e.t2||"TypeError"!==e.t2.name||!/fetch/i.test(e.t2.message)){e.next=38;break}throw Object.assign(new Si("Network Error",Si.ERR_NETWORK,t,y),{cause:e.t2.cause||e.t2});case 38:throw Si.from(e.t2,e.t2&&e.t2.code,t,y);case 39:case"end":return e.stop()}}),e,null,[[4,33]])})));return function(t){return e.apply(this,arguments)}}(),Ma={http:null,xhr:va,fetch:Da};_i.forEach(Ma,(function(e,t){if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));var Oa=function(e){return"- ".concat(e)},xa=function(e){return _i.isFunction(e)||null===e||!1===e},Pa=function(e){for(var t,r,n=(e=_i.isArray(e)?e:[e]).length,i={},a=0;a<n;a++){var o=void 0;if(r=t=e[a],!xa(t)&&void 0===(r=Ma[(o=String(t)).toLowerCase()]))throw new Si("Unknown adapter '".concat(o,"'"));if(r)break;i[o||"#"+a]=r}if(!r){var s=Object.entries(i).map((function(e){var t=v(e,2),r=t[0],n=t[1];return"adapter ".concat(r," ")+(!1===n?"is not supported by the environment":"is not available in the build")}));throw new Si("There is no suitable adapter to dispatch the request "+(n?s.length>1?"since :\n"+s.map(Oa).join("\n"):" "+Oa(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r};function La(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ea(null,e)}function Na(e){return La(e),e.headers=Ji.from(e.headers),e.data=$i.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Pa(e.adapter||ji.adapter)(e).then((function(t){return La(e),t.data=$i.call(e,e.transformResponse,t),t.headers=Ji.from(t.headers),t}),(function(t){return Zi(t)||(La(e),t&&t.response&&(t.response.data=$i.call(e,e.transformResponse,t.response),t.response.headers=Ji.from(t.response.headers))),Promise.reject(t)}))}var Va={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){Va[e]=function(r){return j(r)===e||"a"+(t<1?"n ":" ")+e}}));var Ua={};Va.transitional=function(e,t,r){function n(e,t){return"[Axios v1.8.4] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,i,a){if(!1===e)throw new Si(n(i," has been removed"+(t?" in "+t:"")),Si.ERR_DEPRECATED);return t&&!Ua[i]&&(Ua[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,i,a)}},Va.spelling=function(e){return function(t,r){return console.warn("".concat(r," is likely a misspelling of ").concat(e)),!0}};var Fa={assertOptions:function(e,t,r){if("object"!==j(e))throw new Si("options must be an object",Si.ERR_BAD_OPTION_VALUE);for(var n=Object.keys(e),i=n.length;i-- >0;){var a=n[i],o=t[a];if(o){var s=e[a],u=void 0===s||o(s,a,e);if(!0!==u)throw new Si("option "+a+" must be "+u,Si.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new Si("Unknown option "+a,Si.ERR_BAD_OPTION)}},validators:Va},Ba=Fa.validators,Wa=function(){return D((function e(t){R(this,e),this.defaults=t,this.interceptors={request:new xi,response:new xi}}),[{key:"request",value:(e=H(O().mark((function e(t,r){var n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._request(t,r);case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),e.t0 instanceof Error){n={},Error.captureStackTrace?Error.captureStackTrace(n):n=new Error,i=n.stack?n.stack.replace(/^.+\n/,""):"";try{e.t0.stack?i&&!String(e.t0.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(e.t0.stack+="\n"+i):e.t0.stack=i}catch(e){}}throw e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(t,r){return e.apply(this,arguments)})},{key:"_request",value:function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{};var r=t=la(this.defaults,t),n=r.transitional,i=r.paramsSerializer,a=r.headers;void 0!==n&&Fa.assertOptions(n,{silentJSONParsing:Ba.transitional(Ba.boolean),forcedJSONParsing:Ba.transitional(Ba.boolean),clarifyTimeoutError:Ba.transitional(Ba.boolean)},!1),null!=i&&(_i.isFunction(i)?t.paramsSerializer={serialize:i}:Fa.assertOptions(i,{encode:Ba.function,serialize:Ba.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Fa.assertOptions(t,{baseUrl:Ba.spelling("baseURL"),withXsrfToken:Ba.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();var o=a&&_i.merge(a.common,a[t.method]);a&&_i.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete a[e]})),t.headers=Ji.concat(o,a);var s=[],u=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(u=u&&e.synchronous,s.unshift(e.fulfilled,e.rejected))}));var c,d=[];this.interceptors.response.forEach((function(e){d.push(e.fulfilled,e.rejected)}));var l,h=0;if(!u){var f=[Na.bind(this),void 0];for(f.unshift.apply(f,s),f.push.apply(f,d),l=f.length,c=Promise.resolve(t);h<l;)c=c.then(f[h++],f[h++]);return c}l=s.length;var p=t;for(h=0;h<l;){var v=s[h++],g=s[h++];try{p=v(p)}catch(e){g.call(this,e);break}}try{c=Na.call(this,p)}catch(e){return Promise.reject(e)}for(h=0,l=d.length;h<l;)c=c.then(d[h++],d[h++]);return c}},{key:"getUri",value:function(e){return Oi(ca((e=la(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}]);var e}();_i.forEach(["delete","get","head","options"],(function(e){Wa.prototype[e]=function(t,r){return this.request(la(r||{},{method:e,url:t,data:(r||{}).data}))}})),_i.forEach(["post","put","patch"],(function(e){function t(t){return function(r,n,i){return this.request(la(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}Wa.prototype[e]=t(),Wa.prototype[e+"Form"]=t(!0)}));var Ga=Wa,Ha=function(){function e(t){if(R(this,e),"function"!=typeof t)throw new TypeError("executor must be a function.");var r;this.promise=new Promise((function(e){r=e}));var n=this;this.promise.then((function(e){if(n._listeners){for(var t=n._listeners.length;t-- >0;)n._listeners[t](e);n._listeners=null}})),this.promise.then=function(e){var t,r=new Promise((function(e){n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},t((function(e,t,i){n.reason||(n.reason=new ea(e,t,i),r(n.reason))}))}return D(e,[{key:"throwIfRequested",value:function(){if(this.reason)throw this.reason}},{key:"subscribe",value:function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}},{key:"unsubscribe",value:function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}}},{key:"toAbortSignal",value:function(){var e=this,t=new AbortController,r=function(e){t.abort(e)};return this.subscribe(r),t.signal.unsubscribe=function(){return e.unsubscribe(r)},t.signal}}],[{key:"source",value:function(){var t;return{token:new e((function(e){t=e})),cancel:t}}}])}(),ja=Ha,Ka={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ka).forEach((function(e){var t=v(e,2),r=t[0],n=t[1];Ka[n]=r}));var za=Ka,qa=function e(t){var r=new Ga(t),n=Dn(Ga.prototype.request,r);return _i.extend(n,Ga.prototype,r,{allOwnKeys:!0}),_i.extend(n,r,null,{allOwnKeys:!0}),n.create=function(r){return e(la(t,r))},n}(ji);qa.Axios=Ga,qa.CanceledError=ea,qa.CancelToken=ja,qa.isCancel=Zi,qa.VERSION="1.8.4",qa.toFormData=Ti,qa.AxiosError=Si,qa.Cancel=qa.CanceledError,qa.all=function(e){return Promise.all(e)},qa.spread=function(e){return function(t){return e.apply(null,t)}},qa.isAxiosError=function(e){return _i.isObject(e)&&!0===e.isAxiosError},qa.mergeConfig=la,qa.AxiosHeaders=Ji,qa.formToJSON=function(e){return Gi(_i.isHTMLForm(e)?new FormData(e):e)},qa.getAdapter=Pa,qa.HttpStatusCode=za,qa.default=qa;var Ya=qa;function Xa(e){var t=new Date,r="";return e&&(r+="".concat(t.getMonth()+1,"/").concat(t.getDate(),"/").concat(t.getFullYear()," ")),"".concat(r).concat(t.getHours(),":").concat(t.getMinutes(),":").concat(t.getSeconds(),"/").concat(t.getMilliseconds())}var Qa=Ya.CancelToken,Ja=[],$a=D((function e(t){R(this,e),this.group=t}),[{key:"execute",value:function(){return this.group.map((function(e){return new Promise((function(t,r){var n=Qa.source();Ja.push(n),Ya.get(e.url,{cancelToken:n.token,headers:C({},e.headers||{})}).then((function(r){var n=r.data;t({response:n,server:e})})).catch((function(e){r(e)}))}))}))}}]),Za=function(){function e(){R(this,e),this.serverList=[],this.delayTime=[],this.timers=[],this.excludedServer=[],this.tryTimes=0,this.failedGroupCount=0}return D(e,[{key:"init",value:function(){var e=this;this.delayTime=[];var t=-1;this.serverList.forEach((function(r){r.dl!==t&&e.delayTime.push(r.dl),t=r.dl})),this.timers=[],this.excludedServer=[],this.tryTimes=1,this.log=""}},{key:"ping",value:function(e){var t=this;return e&&(this.serverList=e,this.init()),this.log+="[".concat(Xa(!0),"]\nConnectService:Try Times--\x3e").concat(this.tryTimes,"\n"),this.log+="[".concat(Xa(),"]\nConnectService:server list--\x3e").concat(JSON.stringify(this.logInfo(this.serverList)),"\n"),this.failedGroupCount=0,new Promise((function(e,r){t.delayTime.forEach((function(n){t.timers.push(setTimeout((function(){var i,a=t.serverList.filter((function(e){return!e.exclude&&n===e.dl}));t.log+="[".concat(Xa(),"]\nConnectService:currentGroup:ping[dl=").concat(n,"]--\x3e").concat(JSON.stringify(t.logInfo(a)),"\n"),(i=new $a(a).execute(),new Promise((function(e,t){var r=(i=Array.isArray(i)?i:[]).length;if(0===r)return t(new Error("empty"));i.forEach((function(n){n.then((function(t){e(t)}),(function(e){0==(r-=1)&&t(new Error("All promises are failed"))}))}))}))).then((function(r){var n=r.response,i=r.server;t.log+="[".concat(Xa(),"]\nConnectService:currentGroup:one server resolved[dl=").concat(i.dl,"]--\x3erequest server:").concat(i.domain,",response:").concat(JSON.stringify(n),"\n"),t.lastServer=i,t.clear(),e({response:n,request:i,log:t.log})})).catch((function(){t.failedGroupCount+=1,t.log+="[".concat(Xa(),"]\nConnectService:currentGroup:all server rejected--\x3e").concat(JSON.stringify(t.logInfo(a)),"\n"),t.isEmpty()||5===t.tryTimes&&t.failedGroupCount===t.delayTime.length?r(t.log):t.tryTimes<5&&t.failedGroupCount===t.delayTime.length&&(t.tryTimes+=1,e(t.ping()))}))}),n))}))}))}},{key:"retry",value:function(){return this.tryTimes+=1,this.filter(),this.ping()}},{key:"filter",value:function(){var e=this,t="";if(this.serverList.forEach((function(r){var n;r.domain===(null===(n=e.lastServer)||void 0===n?void 0:n.domain)&&(r.exclude||(r.exclude=!0),e.excludedServer.forEach((function(r){var n;r.dc===(null===(n=e.lastServer)||void 0===n?void 0:n.dc)&&(t=r.dc)})),e.excludedServer.push(e.lastServer))})),t&&this.serverList.forEach((function(r){r.dc!==t||r.exclude||(r.exclude=!0,e.excludedServer.push(r))})),this.delayTime.length>1){var r=0,n=[];this.delayTime.forEach((function(t){e.serverList.filter((function(e){return e.dl===t})).every((function(e){return e.exclude}))?r+=1:n.push(t)})),this.delayTime.splice(this.delayTime.length-r),n.forEach((function(t,r){e.serverList.forEach((function(n){n.dl===t&&(n.dl=e.delayTime[r])}))}))}this.log+="[".concat(Xa(),"]\nConnectService:excludedServer--\x3e").concat(JSON.stringify(this.logInfo(this.excludedServer)),"\n")}},{key:"isEmpty",value:function(){return this.serverList.every((function(e){return e.exclude}))}},{key:"clear",value:function(){this.timers.forEach((function(e){clearTimeout(e)})),Ja.forEach((function(e){e.cancel()}))}},{key:"logInfo",value:function(e){return e.map((function(e){return{domain:e.domain,dl:e.dl,dc:e.dc}}))}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}().getInstance(),eo=function(e){function t(e,r){var n;return R(this,t),(n=c(this,t,[e])).pingData=r,n.edgeMap=new Map,n.cloudPingServer=[],n.hybirdPingServer=[],n.channelIdList=[],r.virtualZonePathTokenList&&r.virtualZonePathTokenList.length?(n.parseVirtual(r.virtualZonePathTokenList),n.parseCloud(r.cloudInfoList)):n.parseCloud(r.cloudInfoList),n}return f(t,e),D(t,[{key:"parseVirtual",value:function(e){var t=this;e.forEach((function(e){var r=e.token,n=l(r);t.channelIdList.push(n.channelId);var i=[];try{i=JSON.parse(n.virtualZoneAddr)}catch(e){i=[],Ft.add("PVZERR")}var a=[];try{a=JSON.parse(n.hybridLszcAddr)}catch(e){a=[],Ft.add("PHZCERR")}for(var o=0;o<i.length;o++)t.hybirdPingServer.push({url:i[o],domain:new URL(i[o]).hostname,dc:"",dl:0,token:r,lszcUrlList:a,id:n.compositeId||""})}))}},{key:"parseCloud",value:function(e){var t=this;e.forEach((function(e){var r=e.delayTime,n=e.playbackTokens,i=e.edgeToken;t.edgeMap.set(i,n);var a=l(i),o=null;try{o=JSON.parse(a.path)}catch(e){o=null,Ft.add("ETERR")}o&&o.nodes[0].addresses.forEach((function(e){var n,s;t.cloudPingServer.push({url:e.httpsUrl,domain:new URL(e.httpsUrl).hostname,dc:null!==(n=null===(s=o)||void 0===s?void 0:s.nodes[0].zoneUrn)&&void 0!==n?n:"",dl:r,token:i,id:a.compositeId,headers:{Authorization:i,"x-zm-trackingid":Sf.cid}})})),t.livePlayer.sendToSignal(Lt.MonitorLog,{mlog:"ZC_LIST,".concat(t.cloudPingServer.map((function(e){return e.url+","+e.dl})).join(","),",")})}))}},{key:"pingZC",value:(i=H(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hybirdPingServer.length){e.next=13;break}return e.prev=1,e.next=4,ne(1e4,this.pingVirtualZone());case 4:return e.abrupt("return",e.sent);case 7:return e.prev=7,e.t0=e.catch(1),Ut.log("fallback from hybird to cloud"),e.abrupt("return",this.pingZCList(this.cloudPingServer));case 11:e.next=14;break;case 13:return e.abrupt("return",this.pingZCList(this.cloudPingServer));case 14:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(){return i.apply(this,arguments)})},{key:"pingVirtualZone",value:(n=H(O().mark((function e(){var t,r,n,i,a,o,s,u=this,c=arguments;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:this.hybirdPingServer,e.next=3,Za.ping(t);case 3:return r=e.sent,n=r.request,i=n.lszcUrlList,a=n.token,e.next=8,this.pingZCList(i.map((function(e){return{url:e,domain:new URL(e).hostname,dc:"",dl:0,token:a,id:n.id,headers:{Authorization:a,"x-zm-trackingid":Sf.cid}}})),!0);case 8:if(o=e.sent,s={},this.channelIdList.forEach((function(e){u.pingData.cloudInfoList.forEach((function(t){t.playbackTokens.forEach((function(t){t.channelId===e&&(s[e]?s[e].push(t.playbackToken):s[e]=[t.playbackToken])}))}))})),!o){e.next=17;break}return o.isVirtual=!0,o.playbackTokenMap=s,e.abrupt("return",o);case 17:throw new Error("ping res is null");case 18:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"pingZCList",value:(r=H(O().mark((function e(t){var r,n,i,a,o,s,u,c,d=arguments;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=d.length>1&&void 0!==d[1]&&d[1],!te()||!localStorage.getItem("disable_ping_")){e.next=5;break}return n=new URL(window.location).searchParams.get("lss_addr"),i=new URL(window.location).searchParams.get("token"),e.abrupt("return",{url:"wss://".concat(n||"lssdev74.zoomdev.us","/lobby/79921332630?token=").concat(i||"mockToken","&swr=1"),host:n||"lssdev74.zoomdev.us",token:"",isVirtual:!1,playbackTokens:[],lobbyId:"79921332630"});case 5:return e.prev=5,e.next=8,ne(1e4,Za.ping(t));case 8:if(a=e.sent,o=a.response,s=a.request,!o){e.next=16;break}return u=o.lssAddr,c=o.toLssData,Ft.add("PZCSUCC"),this.livePlayer.sendToSignal(Lt.MonitorLog,{mlog:"ZC_PING_RESULT,".concat(s.url,",")}),e.abrupt("return",{url:"".concat(u,"/lobby/").concat(s.id,"?token=").concat(c||"","&swr=1"),host:u,token:s.token,isVirtual:!1,playbackTokens:this.edgeMap.get(s.token),lobbyId:s.id});case 16:return e.abrupt("return",null);case 19:throw e.prev=19,e.t0=e.catch(5),"timeout"===e.t0&&Ft.add("PZCTIMEOUT"),Ft.add("PZCERR"),r||this.livePlayer.emit("player-error",{code:P.PingFail,reason:L.PingFail+" zclist: "+t.map((function(e){return e.url})).join(" ")}),e.t0;case 25:case"end":return e.stop()}}),e,this,[[5,19]])}))),function(e){return r.apply(this,arguments)})},{key:"initSubscription",value:function(){}},{key:"destroy",value:function(){}}]);var r,n,i}(It),to=D((function e(t){R(this,e),this.livePlayer=t,this.timeMap={},this.costsMap={},this.isTimingSent=!1}),[{key:"duplicateError",value:function(e){this.livePlayer.sendToSignal(Lt.MonitorLog,{mlog:"SET_TIME_ERROR,".concat(e)})}},{key:"playerInit",value:function(){this.timeMap.t0?this.duplicateError("t0"):this.timeMap.t0=(new Date).getTime()}},{key:"startParsePing",value:function(){this.timeMap.tPP1?this.duplicateError("tpp1"):this.timeMap.tPP1=(new Date).getTime()}},{key:"endParsePing",value:function(){this.timeMap.tPP2?this.duplicateError("tpp2"):(this.timeMap.tPP2=(new Date).getTime(),this.costsMap.parsePing=this.timeMap.tPP2-this.timeMap.tPP1)}},{key:"startPingRequest",value:function(){this.timeMap.tPR1?this.duplicateError("tpr1"):this.timeMap.tPR1=(new Date).getTime()}},{key:"endPingRequest",value:function(){this.timeMap.tPR2?this.duplicateError("tpr2"):(this.timeMap.tPR2=(new Date).getTime(),this.costsMap.pingRequest=this.timeMap.tPR2-this.timeMap.tPR1)}},{key:"pingSuccess",value:function(){this.livePlayer.sendToSignal(Lt.MonitorLog,{mlog:"PING_TIME,parse_zc(".concat(this.costsMap.parsePing,"),call_ping(").concat(this.costsMap.pingRequest,"),")}),this.timeMap.t1?this.duplicateError("t1"):(this.timeMap.t1=(new Date).getTime(),this.costsMap.ping=this.timeMap.t1-this.timeMap.t0)}},{key:"wsSuccess",value:function(){this.timeMap.t2||(this.timeMap.t2=(new Date).getTime(),this.costsMap.ws=this.timeMap.t2-this.timeMap.t1)}},{key:"udpSuccess",value:function(){this.timeMap.t3||(this.timeMap.t3=(new Date).getTime(),this.costsMap.udp=this.timeMap.t3-this.timeMap.t2,this.livePlayer.sendToSignal(Lt.MonitorLog,{mlog:"CONNECT_TIME,ping(".concat(this.costsMap.ping,"),ws(").concat(this.costsMap.ws,"),udp(").concat(this.costsMap.udp,"),t0(").concat(this.timeMap.t0,")t1(").concat(this.timeMap.t1,")t2(").concat(this.timeMap.t2,")t3(").concat(this.timeMap.t3,")")}))}},{key:"subscribe",value:function(){this.timeMap.t4||(this.timeMap.t4=(new Date).getTime(),this.costsMap.subscribe=this.timeMap.t4-this.timeMap.t3)}},{key:"videoRender",value:function(){if(!this.timeMap.t5){this.timeMap.t5=(new Date).getTime(),this.costsMap.render=this.timeMap.t5-this.timeMap.t4;var e=this.costsMap.ping+this.costsMap.ws+this.costsMap.udp+this.costsMap.render;this.isTimingSent||(this.isTimingSent=!0,this.livePlayer.sendToSignal(Lt.SendTiming,{ping:this.costsMap.ping,wss:this.costsMap.ws,udp:this.costsMap.udp,subscribe_and_render:this.costsMap.render,total_time:e})),this.livePlayer.sendToSignal(Lt.MonitorLog,{mlog:"TOTAL_TIME,subscribe_and_render(".concat(this.costsMap.render,"),total_Time(").concat(e,"),t4(").concat(this.timeMap.t4,")t5(").concat(this.timeMap.t5,")")})}}}]),ro=20,no=function(e){function t(e,r){var n;return R(this,t),(n=c(this,t,[e])).options=r,n.animationId=0,n.render=!1,n.bulletMap=new Map,n.cacheMap=new Map,n.playBulletScreen=function(){var e=function(){var t,r=A(n.bulletMap);try{for(r.s();!(t=r.n()).done;){var i=v(t.value,2),a=i[0],o=i[1],s=n.cacheMap.get(a);if(s){var u,c=A(o);try{for(c.s();!(u=c.n()).done;){var d=v(u.value,2),l=d[0],h=d[1],f=0,p=[];if(h.length){for(var g=!1,m=0;m<h.length;m++)if(n.moveLeft(h[m]),0===m){var y=Number(h[m].style.left.slice(0,-2));y+h[m].clientWidth<=0?(g=!0,p.push(ro),f+=ro):(f+=y,p.push(y),p.push(h[m].clientWidth),p.push(ro),f+=h[m].clientWidth,f+=ro)}else p.push(h[m].clientWidth),p.push(ro),f+=h[m].clientWidth,f+=ro;if(g){var _=h.shift();_&&_.remove()}}if(l.clientWidth-f>ro){var S=s.shift();if(S){var b=n.addNewElement(l,S);h.push(b)}}}}catch(e){c.e(e)}finally{c.f()}}}}catch(e){r.e(e)}finally{r.f()}window.pauseBullet||(n.animationId=requestAnimationFrame(e))};n.animationId=requestAnimationFrame(e)},n.initSubscription=function(){Ot.on(Nt.BulletScreen).pipe(Rt(n.destroy$)).subscribe((function(e){var t;e&&(n.livePlayer.emit("chat",{id:e.id,data:e.data}),n.render&&(null===(t=n.cacheMap.get(e.id))||void 0===t||t.push(e.data.senderName+": "+e.data.content)))})),Ot.on(Nt.MultiCompressedBulletScreen).pipe(Rt(n.destroy$)).subscribe(function(){var e=H(O().mark((function e(t){var r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=16;break}return e.t0=n.livePlayer,e.t1=t.id,e.next=5,n.parseData(t.data);case 5:if(e.t2=e.sent,e.t3={id:e.t1,data:e.t2},e.t0.emit.call(e.t0,"chat",e.t3),!n.render){e.next=16;break}if(e.t4=null===(r=n.cacheMap.get(t.id))||void 0===r,e.t4){e.next=16;break}return e.t5=r,e.next=14,n.parseData(t.data);case 14:e.t6=e.sent,e.t5.push.call(e.t5,e.t6);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ot.on(Nt.ChatSettings).pipe(Rt(n.destroy$)).subscribe(function(){var e=H(O().mark((function e(t){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&n.livePlayer.emit("chat-settings",{id:t.id,data:t.settings});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},n}return f(t,e),D(t,[{key:"buildTrack",value:function(e,t){for(var r=new Map,n=0;n<e;n++){var i=new Bt("div","",{width:"100%",height:"20px",padding:"4px 0",position:"relative",overflow:"hidden"}).commit(t);r.set(i.element,[])}return r}},{key:"addRender",value:function(e,t){this.render||(this.render=!0,this.playBulletScreen(),this.cacheMap.set(e,[]),this.bulletMap.set(e,this.buildTrack(this.options.trackCount,t)))}},{key:"removeRender",value:function(){}},{key:"addNewElement",value:function(e,t){var r=new Bt("span","",{position:"absolute",left:"".concat(e.clientWidth,"px"),color:"#fff",zIndex:"1003",whiteSpace:"nowrap"}).commit(e);return r.element.innerText=t,r.element}},{key:"moveLeft",value:function(e){e.style.left=String(Number(e.style.left.slice(0,-2))-1)+"px"}},{key:"getCompressMode",value:function(e){return 0==e?"":1==e?"deflate":2==e?"deflate-raw":"gzip"}},{key:"parseData",value:(r=H(O().mark((function e(t){var r,n,i,a,o,s,u,c,d,l,h,f,p,v,g,m,y,_,S;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=atob(t),n=Uint8Array.from(r,(function(e){return e.charCodeAt(0)})),i=this.getCompressMode(n[1]),a=new DataView(n.buffer),o=a.getUint16(2,!0),s=n.subarray(12),u=new Blob([s]),c="",""===i){e.next=16;break}return d=new DecompressionStream(i),l=u.stream().pipeThrough(d),e.next=13,new Response(l).text();case 13:c=e.sent,e.next=17;break;case 16:c=t;case 17:for(h=Uint8Array.from(c,(function(e){return e.charCodeAt(0)})),f=0,p=2*o,v=new DataView(h.buffer),g=new TextDecoder("utf-8"),m="",y=1;y<=o;y++)_=v.getUint16(f,!0),f+=2,S=h.subarray(p,p+_),p+=_,m+=g.decode(S);return e.abrupt("return",m);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"destroy",value:function(){s(t,"destroy",this)([]),this.animationId&&cancelAnimationFrame(this.animationId)}}]);var r}(It),io=function(e){function t(e){var r;return R(this,t),(r=c(this,t,[e])).initSubscription=function(){Ot.on(Nt.QA).pipe(Rt(r.destroy$)).subscribe((function(e){e&&r.livePlayer.emit("qa",e)})),Ot.on(Nt.ReactionStatistics).pipe(Rt(r.destroy$)).subscribe((function(e){e&&r.livePlayer.emit("reaction",e)})),Ot.on(Nt.Billboard).pipe(Rt(r.destroy$)).subscribe((function(e){e&&r.livePlayer.emit("billboard",e)})),Ot.on(Nt.MultiCompressedBulletScreen).pipe(Rt(r.destroy$)).subscribe(function(){var e=H(O().mark((function e(t){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=11;break}return e.t0=r.livePlayer,e.t1=C,e.t2=C({},t),e.t3={},e.next=7,r.parseData(t.data);case 7:e.t4=e.sent,e.t5={data:e.t4},e.t6=(0,e.t1)(e.t2,e.t3,e.t5),e.t0.emit.call(e.t0,"compress",e.t6);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},r}return f(t,e),D(t,[{key:"getCompressMode",value:function(e){return 0==e?"":1==e?"deflate":2==e?"deflate-raw":"gzip"}},{key:"parseData",value:(r=H(O().mark((function e(t){var r,n,i,a,o,s,u,c,d,l,h,f,p,v,g,m,y,_,S;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=atob(t),n=Uint8Array.from(r,(function(e){return e.charCodeAt(0)})),i=this.getCompressMode(n[1]),a=new DataView(n.buffer),o=a.getUint16(2,!0),s=n.subarray(12),u=new Blob([s]),c="",""===i){e.next=16;break}return d=new DecompressionStream(i),l=u.stream().pipeThrough(d),e.next=13,new Response(l).text();case 13:c=e.sent,e.next=17;break;case 16:c=t;case 17:for(h=Uint8Array.from(c,(function(e){return e.charCodeAt(0)})),f=0,p=2*o,v=new DataView(h.buffer),g=new TextDecoder("utf-8"),m="",y=1;y<=o;y++)_=v.getUint16(f,!0),f+=2,S=h.subarray(p,p+_),p+=_,m+=g.decode(S);return e.abrupt("return",m);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"destroy",value:function(){s(t,"destroy",this)([])}}]);var r}(It),ao={exports:{}};!function(e){var t,r,n,i,a;t=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,i=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var i=a.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");return i.path=a.normalizePath(i.path),a.buildURLFromParts(i)}var o=a.parseURL(t);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return n.alwaysNormalize?(o.path=a.normalizePath(o.path),a.buildURLFromParts(o)):t;var s=a.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var u=r.exec(s.path);s.netLoc=u[1],s.path=u[2]}s.netLoc&&!s.path&&(s.path="/");var c={scheme:s.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(c.netLoc=s.netLoc,"/"!==o.path[0]))if(o.path){var d=s.path,l=d.substring(0,d.lastIndexOf("/")+1)+o.path;c.path=a.normalizePath(l)}else c.path=s.path,o.params||(c.params=s.params,o.query||(c.query=s.query));return null===c.path&&(c.path=n.alwaysNormalize?a.normalizePath(o.path):o.path),a.buildURLFromParts(c)},parseURL:function(e){var r=t.exec(e);return r?{scheme:r[1]||"",netLoc:r[2]||"",path:r[3]||"",params:r[4]||"",query:r[5]||"",fragment:r[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(n,"");e.length!==(e=e.replace(i,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=a}(ao);var oo=ao.exports;function so(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function uo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?so(Object(r),!0).forEach((function(t){co(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):so(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function co(e,t,r){return(t=function(e){var t=function(e){if("object"!=j(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=j(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==j(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lo(){return lo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lo.apply(this,arguments)}var ho=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},fo=Number.isSafeInteger||function(e){return"number"==typeof e&&Math.abs(e)<=po},po=Number.MAX_SAFE_INTEGER||9007199254740991,vo=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e}({}),go=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),mo=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown",e}({}),yo=function(){},_o={trace:yo,debug:yo,log:yo,warn:yo,info:yo,error:yo},So=_o;var Ao=So,bo=/^(\d+)x(\d+)$/,Eo=/(.+?)=(".*?"|.*?)(?:,|$)/g,ko=D((function e(t){R(this,e),"string"==typeof t&&(t=e.parseAttrList(t)),lo(this,t)}),[{key:"clientAttrs",get:function(){return Object.keys(this).filter((function(e){return"X-"===e.substring(0,2)}))}},{key:"decimalInteger",value:function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"hexadecimalInteger",value:function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)r[n]=parseInt(t.slice(2*n,2*n+2),16);return r}return null}},{key:"hexadecimalIntegerAsNumber",value:function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"optionalFloat",value:function(e,t){var r=this[e];return r?parseFloat(r):t}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"bool",value:function(e){return"YES"===this[e]}},{key:"decimalResolution",value:function(e){var t=bo.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}}],[{key:"parseAttrList",value:function(e){var t,r={};for(Eo.lastIndex=0;null!==(t=Eo.exec(e));){var n=t[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),r[t[1].trim()]=n}return r}}]);function Co(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e}var wo=D((function e(t,r){if(R(this,e),this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,r){var n=r.attr;for(var i in n)if(Object.prototype.hasOwnProperty.call(t,i)&&t[i]!==n[i]){Ao.warn('DATERANGE tag attribute: "'.concat(i,'" does not match for tags with ID: "').concat(t.ID,'"')),this._badValueForSameId=i;break}t=lo(new ko({}),n,t)}if(this.attr=t,this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){var a=new Date(this.attr["END-DATE"]);ho(a.getTime())&&(this._endDate=a)}}),[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var e=this.attr.decimalFloatingPoint("DURATION");if(ho(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&ho(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),To=D((function e(){R(this,e),this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}})),Ro="audio",Io="video",Do="audiovideo",Mo=D((function e(t){R(this,e),this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=w(w(w({},Ro,null),Io,null),Do,null),this.baseurl=t}),[{key:"setByteRange",value:function(e,t){var r,n=e.split("@",2);r=1===n.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(n[1]),this._byteRange=[r,parseInt(n[0])+r]}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=oo.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),Oo=function(e){function t(e,r){var n;return R(this,t),(n=c(this,t,[r]))._decryptdata=null,n.rawProgramDateTime=null,n.programDateTime=null,n.tagList=[],n.duration=0,n.sn=0,n.levelkeys=void 0,n.type=void 0,n.loader=null,n.keyLoader=null,n.level=-1,n.cc=0,n.startPTS=void 0,n.endPTS=void 0,n.startDTS=void 0,n.endDTS=void 0,n.start=0,n.deltaPTS=void 0,n.maxStartPTS=void 0,n.minEndPTS=void 0,n.stats=new To,n.data=void 0,n.bitrateTest=!1,n.title=null,n.initSegment=null,n.endList=void 0,n.gap=void 0,n.urlId=0,n.type=e,n}return f(t,e),D(t,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{var t=Object.keys(this.levelkeys);if(1===t.length)return this._decryptdata=this.levelkeys[t[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!ho(this.programDateTime))return null;var e=ho(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){var t=Object.keys(this.levelkeys),r=t.length;if(r>1||1===r&&this.levelkeys[t[0]].encrypted)return!0}return!1}},{key:"setKeyFormat",value:function(e){if(this.levelkeys){var t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}},{key:"abortRequests",value:function(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}},{key:"setElementaryStreamInfo",value:function(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=this.elementaryStreams,s=o[e];s?(s.startPTS=Math.min(s.startPTS,t),s.endPTS=Math.max(s.endPTS,r),s.startDTS=Math.min(s.startDTS,n),s.endDTS=Math.max(s.endDTS,i)):o[e]={startPTS:t,endPTS:r,startDTS:n,endDTS:i,partial:a}}},{key:"clearElementaryStreamInfo",value:function(){var e=this.elementaryStreams;e[Ro]=null,e[Io]=null,e[Do]=null}}])}(Mo),xo=function(e){function t(e,r,n,i,a){var o;R(this,t),(o=c(this,t,[n])).fragOffset=0,o.duration=0,o.gap=!1,o.independent=!1,o.relurl=void 0,o.fragment=void 0,o.index=void 0,o.stats=new To,o.duration=e.decimalFloatingPoint("DURATION"),o.gap=e.bool("GAP"),o.independent=e.bool("INDEPENDENT"),o.relurl=e.enumeratedString("URI"),o.fragment=r,o.index=i;var s=e.enumeratedString("BYTERANGE");return s&&o.setByteRange(s,a),a&&(o.fragOffset=a.fragOffset+a.duration),o}return f(t,e),D(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}])}(Mo),Po=D((function e(t){R(this,e),this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}),[{key:"reloaded",value:function(e){if(!e)return this.advanced=!0,void(this.updated=!0);var t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&r>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}},{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&ho(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]);function Lo(e){return Uint8Array.from(atob(e),(function(e){return e.charCodeAt(0)}))}function No(e){return Uint8Array.from(unescape(encodeURIComponent(e)),(function(e){return e.charCodeAt(0)}))}var Vo="undefined"!=typeof self?self:void 0,Uo={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Fo="org.w3.clearkey",Bo="com.apple.streamingkeydelivery",Wo="com.microsoft.playready",Go="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function Ho(e){switch(e){case Bo:return Uo.FAIRPLAY;case Wo:return Uo.PLAYREADY;case Go:return Uo.WIDEVINE;case Fo:return Uo.CLEARKEY}}var jo="edef8ba979d64acea3c827dcd51d21ed";function Ko(e){return e===jo?Uo.WIDEVINE:"9a04f07998404286ab92e65be0885f95"===e?Uo.PLAYREADY:"1077efecc0b24d02ace33c1e52e2fb4b"===e||"e2719d58a985b3c9781ab030af78d30e"===e?Uo.CLEARKEY:void 0}function zo(e){switch(e){case Uo.FAIRPLAY:return Bo;case Uo.PLAYREADY:return Wo;case Uo.WIDEVINE:return Go;case Uo.CLEARKEY:return Fo}}function qo(e){var t=e.drmSystems,r=e.widevineLicenseUrl,n=t?[Uo.FAIRPLAY,Uo.WIDEVINE,Uo.PLAYREADY,Uo.CLEARKEY].filter((function(e){return!!t[e]})):[];return!n[Uo.WIDEVINE]&&r&&n.push(Uo.WIDEVINE),n}var Yo,Xo=null!=Vo&&null!=(Yo=Vo.navigator)&&Yo.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function Qo(e,t,r){return Uint8Array.prototype.slice?e.slice(t,r):new Uint8Array(Array.prototype.slice.call(e,t,r))}var Jo,$o=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},Zo=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},es=function(e,t){for(var r=t,n=0;$o(e,t);)n+=10,n+=ts(e,t+6),Zo(e,t+10)&&(n+=10),t+=n;if(n>0)return e.subarray(r,r+n)},ts=function(e,t){var r=0;return r=(127&e[t])<<21,r|=(127&e[t+1])<<14,(r|=(127&e[t+2])<<7)|127&e[t+3]},rs=function(e,t){return $o(e,t)&&ts(e,t+6)+10<=e.length-t},ns=function(e){for(var t=os(e),r=0;r<t.length;r++){var n=t[r];if(is(n))return ls(n)}},is=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},as=function(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]),r=ts(e,4);return{type:t,size:r,data:e.subarray(10,10+r)}},os=function(e){for(var t=0,r=[];$o(e,t);){for(var n=ts(e,t+6),i=(t+=10)+n;t+8<i;){var a=as(e.subarray(t)),o=ss(a);o&&r.push(o),t+=a.size+10}Zo(e,t)&&(t+=10)}return r},ss=function(e){return"PRIV"===e.type?us(e):"W"===e.type[0]?ds(e):cs(e)},us=function(e){if(!(e.size<2)){var t=hs(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}}},cs=function(e){if(!(e.size<2)){if("TXXX"===e.type){var t=1,r=hs(e.data.subarray(t),!0);t+=r.length+1;var n=hs(e.data.subarray(t));return{key:e.type,info:r,data:n}}var i=hs(e.data.subarray(1));return{key:e.type,data:i}}},ds=function(e){if("WXXX"===e.type){if(e.size<2)return;var t=1,r=hs(e.data.subarray(t),!0);t+=r.length+1;var n=hs(e.data.subarray(t));return{key:e.type,info:r,data:n}}var i=hs(e.data);return{key:e.type,data:i}},ls=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),r=1&t[3],n=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return n/=45,r&&(n+=47721858.84),Math.round(n)}},hs=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=function(){if(!navigator.userAgent.includes("PlayStation 4"))return Jo||void 0===self.TextDecoder||(Jo=new self.TextDecoder("utf-8")),Jo}();if(r){var n=r.decode(e);if(t){var i=n.indexOf("\0");return-1!==i?n.substring(0,i):n}return n.replace(/\0/g,"")}for(var a,o,s,u=e.length,c="",d=0;d<u;){if(0===(a=e[d++])&&t)return c;if(0!==a&&3!==a)switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c+=String.fromCharCode(a);break;case 12:case 13:o=e[d++],c+=String.fromCharCode((31&a)<<6|63&o);break;case 14:o=e[d++],s=e[d++],c+=String.fromCharCode((15&a)<<12|(63&o)<<6|63&s)}}return c},fs=function(e){for(var t="",r=0;r<e.length;r++){var n=e[r].toString(16);n.length<2&&(n="0"+n),t+=n}return t},ps=Math.pow(2,32)-1,vs=[].push,gs={video:1,audio:2,id3:3,text:4};function ms(e){return String.fromCharCode.apply(null,e)}function ys(e,t){var r=e[t]<<8|e[t+1];return r<0?65536+r:r}function _s(e,t){var r=As(e,t);return r<0?4294967296+r:r}function Ss(e,t){var r=_s(e,t);return(r*=Math.pow(2,32))+_s(e,t+4)}function As(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function bs(e,t,r){e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r}function Es(e,t){var r=[];if(!t.length)return r;for(var n=e.byteLength,i=0;i<n;){var a=_s(e,i),o=a>1?i+a:n;if(ms(e.subarray(i+4,i+8))===t[0])if(1===t.length)r.push(e.subarray(i+8,o));else{var s=Es(e.subarray(i+8,o),t.slice(1));s.length&&vs.apply(r,s)}i=o}return r}function ks(e){var t=[],r=e[0],n=8,i=_s(e,n);n+=4;var a=0,o=0;0===r?(a=_s(e,n),o=_s(e,n+4),n+=8):(a=Ss(e,n),o=Ss(e,n+8),n+=16),n+=2;var s=e.length+o,u=ys(e,n);n+=2;for(var c=0;c<u;c++){var d=n,l=_s(e,d);d+=4;var h=2147483647&l;if(1==(2147483648&l)>>>31)return Ao.warn("SIDX has hierarchical references (not supported)"),null;var f=_s(e,d);d+=4,t.push({referenceSize:h,subsegmentDuration:f,info:{duration:f/i,start:s,end:s+h-1}}),s+=h,n=d+=4}return{earliestPresentationTime:a,timescale:i,version:r,referencesCount:u,references:t}}function Cs(e){for(var t=[],r=Es(e,["moov","trak"]),n=0;n<r.length;n++){var i=r[n],a=Es(i,["tkhd"])[0];if(a){var o=a[0],s=_s(a,0===o?12:20),u=Es(i,["mdia","mdhd"])[0];if(u){var c=_s(u,0===(o=u[0])?12:20),d=Es(i,["mdia","hdlr"])[0];if(d){var l=ms(d.subarray(8,12)),h={soun:Ro,vide:Io}[l];if(h){var f=ws(Es(i,["mdia","minf","stbl","stsd"])[0]);t[s]={timescale:c,type:h},t[h]=uo({timescale:c,id:s},f)}}}}}return Es(e,["moov","mvex","trex"]).forEach((function(e){var r=_s(e,4),n=t[r];n&&(n.default={duration:_s(e,12),flags:_s(e,20)})})),t}function ws(e){var t=e.subarray(8),r=t.subarray(86),n=ms(t.subarray(4,8)),i=n,a="enca"===n||"encv"===n;if(a){var o=Es(t,[n])[0];Es(o.subarray("enca"===n?28:78),["sinf"]).forEach((function(e){var t=Es(e,["schm"])[0];if(t){var r=ms(t.subarray(4,8));if("cbcs"===r||"cenc"===r){var n=Es(e,["frma"])[0];n&&(i=ms(n))}}}))}switch(i){case"avc1":case"avc2":case"avc3":case"avc4":var s=Es(r,["avcC"])[0];i+="."+Rs(s[1])+Rs(s[2])+Rs(s[3]);break;case"mp4a":var u=Es(t,[n])[0],c=Es(u.subarray(28),["esds"])[0];if(c&&c.length>12){var d=4;if(3!==c[d++])break;d=Ts(c,d),d+=2;var l=c[d++];if(128&l&&(d+=2),64&l&&(d+=c[d++]),4!==c[d++])break;d=Ts(c,d);var h=c[d++];if(64!==h)break;if(i+="."+Rs(h),d+=12,5!==c[d++])break;d=Ts(c,d);var f=c[d++],p=(248&f)>>3;31===p&&(p+=1+((7&f)<<3)+((224&c[d])>>5)),i+="."+p}break;case"hvc1":case"hev1":var v=Es(r,["hvcC"])[0],g=v[1],m=["","A","B","C"][g>>6],y=31&g,_=_s(v,2),S=(32&g)>>5?"H":"L",A=v[12],b=v.subarray(6,12);i+="."+m+y,i+="."+_.toString(16).toUpperCase(),i+="."+S+A;for(var E="",k=b.length;k--;){var C=b[k];(C||E)&&(E="."+C.toString(16).toUpperCase()+E)}i+=E;break;case"dvh1":case"dvhe":var w=Es(r,["dvcC"])[0],T=w[2]>>1&127,R=w[2]<<5&32|w[3]>>3&31;i+="."+Is(T)+"."+Is(R);break;case"vp09":var I=Es(r,["vpcC"])[0],D=I[4],M=I[5],O=I[6]>>4&15;i+="."+Is(D)+"."+Is(M)+"."+Is(O);break;case"av01":var x=Es(r,["av1C"])[0],P=x[1]>>>5,L=31&x[1],N=x[2]>>>7?"H":"M",V=(64&x[2])>>6,U=(32&x[2])>>5,F=2===P&&V?U?12:10:V?10:8,B=(16&x[2])>>4,W=(8&x[2])>>3,G=(4&x[2])>>2,H=3&x[2];i+="."+P+"."+Is(L)+N+"."+Is(F)+"."+B+"."+W+G+H+"."+Is(1)+"."+Is(1)+"."+Is(1)+".0"}return{codec:i,encrypted:a}}function Ts(e,t){for(var r=t+5;128&e[t++]&&t<r;);return t}function Rs(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function Is(e){return(e<10?"0":"")+e}function Ds(e){var t=Es(e,["schm"])[0];if(t){var r=ms(t.subarray(4,8));if("cbcs"===r||"cenc"===r)return Es(e,["schi","tenc"])[0]}return null}function Ms(e){var t=_s(e,0),r=8;1&t&&(r+=4),4&t&&(r+=4);for(var n=0,i=_s(e,4),a=0;a<i;a++)256&t&&(n+=_s(e,r),r+=4),512&t&&(r+=4),1024&t&&(r+=4),2048&t&&(r+=4);return n}function Os(e,t){var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function xs(e,t){var r=[],n=t.samples,i=t.timescale,a=t.id,o=!1;return Es(n,["moof"]).map((function(s){var u=s.byteOffset-8;Es(s,["traf"]).map((function(s){var c=Es(s,["tfdt"]).map((function(e){var t=e[0],r=_s(e,4);return 1===t&&(r*=Math.pow(2,32),r+=_s(e,8)),r/i}))[0];return void 0!==c&&(e=c),Es(s,["tfhd"]).map((function(c){var d=_s(c,4),l=16777215&_s(c,0),h=0,f=!!(16&l),p=0,v=!!(32&l),g=8;d===a&&(!!(1&l)&&(g+=8),!!(2&l)&&(g+=4),!!(8&l)&&(h=_s(c,g),g+=4),f&&(p=_s(c,g),g+=4),v&&(g+=4),"video"===t.type&&(o=function(e){if(!e)return!1;var t=e.indexOf("."),r=t<0?e:e.substring(0,t);return"hvc1"===r||"hev1"===r||"dvh1"===r||"dvhe"===r}(t.codec)),Es(s,["trun"]).map((function(a){var s=a[0],c=16777215&_s(a,0),d=!!(1&c),l=0,f=!!(4&c),v=!!(256&c),g=0,m=!!(512&c),y=0,_=!!(1024&c),S=!!(2048&c),A=0,b=_s(a,4),E=8;d&&(l=_s(a,E),E+=4),f&&(E+=4);for(var k=l+u,C=0;C<b;C++){if(v?(g=_s(a,E),E+=4):g=h,m?(y=_s(a,E),E+=4):y=p,_&&(E+=4),S&&(A=0===s?_s(a,E):As(a,E),E+=4),t.type===Io)for(var w=0;w<y;){var T=_s(n,k);Ps(o,n[k+=4])&&Ls(n.subarray(k,k+T),o?2:1,e+A/i,r),k+=T,w+=T+4}e+=g/i}})))}))}))})),r}function Ps(e,t){if(e){var r=t>>1&63;return 39===r||40===r}return 6==(31&t)}function Ls(e,t,r,n){var i=Ns(e),a=0;a+=t;for(var o=0,s=0,u=0;a<i.length;){o=0;do{if(a>=i.length)break;o+=u=i[a++]}while(255===u);s=0;do{if(a>=i.length)break;s+=u=i[a++]}while(255===u);var c=i.length-a,d=a;if(s<c)a+=s;else if(s>c){Ao.error("Malformed SEI payload. ".concat(s," is too small, only ").concat(c," bytes left to parse."));break}if(4===o){if(181===i[d++]){var l=ys(i,d);if(d+=2,49===l){var h=_s(i,d);if(d+=4,1195456820===h){var f=i[d++];if(3===f){var p=i[d++],v=64&p,g=v?2+3*(31&p):0,m=new Uint8Array(g);if(v){m[0]=p;for(var y=1;y<g;y++)m[y]=i[d++]}n.push({type:f,payloadType:o,pts:r,bytes:m})}}}}}else if(5===o&&s>16){for(var _=[],S=0;S<16;S++){var A=i[d++].toString(16);_.push(1==A.length?"0"+A:A),3!==S&&5!==S&&7!==S&&9!==S||_.push("-")}for(var b=s-16,E=new Uint8Array(b),k=0;k<b;k++)E[k]=i[d++];n.push({payloadType:o,pts:r,uuid:_.join(""),userData:hs(E),userDataBytes:E})}}}function Ns(e){for(var t=e.byteLength,r=[],n=1;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(0===r.length)return e;var i=t-r.length,a=new Uint8Array(i),o=0;for(n=0;n<i;o++,n++)o===r[0]&&(o++,r.shift()),a[n]=e[o];return a}function Vs(e){var t=e.getUint32(0),r=e.byteOffset,n=e.byteLength;if(n<t)return{offset:r,size:n};if(1886614376!==e.getUint32(4))return{offset:r,size:t};var i=e.getUint32(8)>>>24;if(0!==i&&1!==i)return{offset:r,size:t};var a=e.buffer,o=fs(new Uint8Array(a,r+12,16)),s=e.getUint32(28),u=null,c=null;if(0===i){if(t-32<s||s<22)return{offset:r,size:t};c=new Uint8Array(a,r+32,s)}else if(1===i){if(!s||n<r+32+16*s+16)return{offset:r,size:t};u=[];for(var d=0;d<s;d++)u.push(new Uint8Array(a,r+32+16*d,16))}return{version:i,systemId:o,kids:u,data:c,offset:r,size:t}}var Us={},Fs=function(){function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;R(this,e),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=r,this.keyFormat=n,this.keyFormatVersions=i,this.iv=a,this.encrypted=!!t&&"NONE"!==t,this.isCommonEncryption=this.encrypted&&"AES-128"!==t}return D(e,[{key:"isSupported",value:function(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case Bo:case Go:case Wo:case Fo:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}},{key:"getDecryptData",value:function(t){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof t&&("AES-128"!==this.method||this.iv||Ao.warn('missing IV for initialization segment with method="'.concat(this.method,'" - compliance issue')),t=0);var r=function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t}(t);return new e(this.method,this.uri,"identity",this.keyFormatVersions,r)}var n=function(e){var t,r,n=e.split(":"),i=null;if("data"===n[0]&&2===n.length){var a=n[1].split(";"),o=a[a.length-1].split(",");if(2===o.length){var s="base64"===o[0],u=o[1];s?(a.splice(-1,1),i=Lo(u)):(t=No(u).subarray(0,16),(r=new Uint8Array(16)).set(t,16-t.length),i=r)}}return i}(this.uri);if(n)switch(this.keyFormat){case Go:this.pssh=n,n.length>=22&&(this.keyId=n.subarray(n.length-22,n.length-6));break;case Wo:var i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=function(e,t,r){if(16!==e.byteLength)throw new RangeError("Invalid system id");var n,i;n=new Uint8Array,i=new Uint8Array;var a=new Uint8Array(4);return r&&r.byteLength>0&&new DataView(a.buffer).setUint32(0,r.byteLength,!1),function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var i=r.length,a=8,o=i;o--;)a+=r[o].byteLength;var s=new Uint8Array(a);for(s[0]=a>>24&255,s[1]=a>>16&255,s[2]=a>>8&255,s[3]=255&a,s.set(e,4),o=0,a=8;o<i;o++)s.set(r[o],a),a+=r[o].byteLength;return s}([112,115,115,104],new Uint8Array([0,0,0,0]),e,i,n,a,r||new Uint8Array)}(i,0,n);var a=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),o=String.fromCharCode.apply(null,Array.from(a)),s=o.substring(o.indexOf("<"),o.length),u=(new DOMParser).parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(u){var c=u.childNodes[0]?u.childNodes[0].nodeValue:u.getAttribute("VALUE");if(c){var d=Lo(c).subarray(0,16);!function(e){var t=function(e,t,r){var n=e[t];e[t]=e[r],e[r]=n};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}(d),this.keyId=d}}break;default:var l=n.subarray(0,16);if(16!==l.length){var h=new Uint8Array(16);h.set(l,16-l.length),l=h}this.keyId=l}if(!this.keyId||16!==this.keyId.byteLength){var f=Us[this.uri];if(!f){var p=Object.keys(Us).length%Number.MAX_SAFE_INTEGER;f=new Uint8Array(16),new DataView(f.buffer,12,4).setUint32(0,p),Us[this.uri]=f}this.keyId=f}return this}}],[{key:"clearKeyUriToKeyIdMap",value:function(){Us={}}}])}(),Bs=/\{\$([a-zA-Z0-9-_]+)\}/g;function Ws(e){return Bs.test(e)}function Gs(e,t,r){if(null!==e.variableList||e.hasVariableRefs)for(var n=r.length;n--;){var i=r[n],a=t[i];a&&(t[i]=Hs(e,a))}}function Hs(e,t){if(null!==e.variableList||e.hasVariableRefs){var r=e.variableList;return t.replace(Bs,(function(t){var n=t.substring(2,t.length-1),i=null==r?void 0:r[n];return void 0===i?(e.playlistParsingError||(e.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'.concat(n,'"'))),t):i}))}return t}function js(e,t,r){var n,i,a=e.variableList;if(a||(e.variableList=a={}),"QUERYPARAM"in t){n=t.QUERYPARAM;try{var o=new self.URL(r).searchParams;if(!o.has(n))throw new Error('"'.concat(n,'" does not match any query parameter in URI: "').concat(r,'"'));i=o.get(n)}catch(t){e.playlistParsingError||(e.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: ".concat(t.message)))}}else n=t.NAME,i=t.VALUE;n in a?e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'.concat(n,'"'))):a[n]=i||""}function Ks(e,t,r){var n=t.IMPORT;if(r&&n in r){var i=e.variableList;i||(e.variableList=i={}),i[n]=r[n]}else e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'.concat(n,'"')))}function zs(){if("undefined"!=typeof self)return(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}var qs={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Ys(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return!e.split(",").some((function(e){return!Xs(e,t,r)}))}function Xs(e,t){var r,n=zs(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]);return null!=(r=null==n?void 0:n.isTypeSupported(Qs(e,t)))&&r}function Qs(e,t){return"".concat(t,'/mp4;codecs="').concat(e,'"')}function Js(e){if(e){var t=e.substring(0,4);return qs.video[t]}return 2}function $s(e){return e.split(",").reduce((function(e,t){var r=qs.video[t];return r?(2*r+e)/(e?3:2):(qs.audio[t]+e)/(e?2:1)}),0)}var Zs={},eu=/flac|opus/i;function tu(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.replace(eu,(function(e){return function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Zs[e])return Zs[e];for(var r={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[e],n=0;n<r.length;n++)if(Xs(r[n],"audio",t))return Zs[e]=r[n],r[n];return e}(e.toLowerCase(),t)}))}function ru(e,t){return e&&"mp4a"!==e?e:t?t.split(",")[0]:t}var nu=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,iu=/#EXT-X-MEDIA:(.*)/g,au=/^#EXT(?:INF|-X-TARGETDURATION):/m,ou=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),su=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),uu=function(){function e(){R(this,e)}return D(e,null,[{key:"findGroup",value:function(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(n.id===t)return n}}},{key:"resolve",value:function(e,t){return oo.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}},{key:"isMediaPlaylist",value:function(e){return au.test(e)}},{key:"parseMasterPlaylist",value:function(t,r){var n,i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Ws(t)},a=[];for(nu.lastIndex=0;null!=(n=nu.exec(t));)if(n[1]){var o,s=new ko(n[1]);Gs(i,s,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);var u=Hs(i,n[2]),c={attrs:s,bitrate:s.decimalInteger("BANDWIDTH")||s.decimalInteger("AVERAGE-BANDWIDTH"),name:s.NAME,url:e.resolve(u,r)},d=s.decimalResolution("RESOLUTION");d&&(c.width=d.width,c.height=d.height),lu(s.CODECS,c),null!=(o=c.unknownCodecs)&&o.length||a.push(c),i.levels.push(c)}else if(n[3]){var l=n[3],h=n[4];switch(l){case"SESSION-DATA":var f=new ko(h);Gs(i,f,["DATA-ID","LANGUAGE","VALUE","URI"]);var p=f["DATA-ID"];p&&(null===i.sessionData&&(i.sessionData={}),i.sessionData[p]=f);break;case"SESSION-KEY":var v=cu(h,r,i);v.encrypted&&v.isSupported()?(null===i.sessionKeys&&(i.sessionKeys=[]),i.sessionKeys.push(v)):Ao.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'.concat(h,'"'));break;case"DEFINE":var g=new ko(h);Gs(i,g,["NAME","VALUE","QUERYPARAM"]),js(i,g,r);break;case"CONTENT-STEERING":var m=new ko(h);Gs(i,m,["SERVER-URI","PATHWAY-ID"]),i.contentSteering={uri:e.resolve(m["SERVER-URI"],r),pathwayId:m["PATHWAY-ID"]||"."};break;case"START":i.startTimeOffset=du(h)}}var y=a.length>0&&a.length<i.levels.length;return i.levels=y?a:i.levels,0===i.levels.length&&(i.playlistParsingError=new Error("no levels found in manifest")),i}},{key:"parseMasterPlaylistMedia",value:function(t,r,n){var i,a={},o=n.levels,s={AUDIO:o.map((function(e){return{id:e.attrs.AUDIO,audioCodec:e.audioCodec}})),SUBTITLES:o.map((function(e){return{id:e.attrs.SUBTITLES,textCodec:e.textCodec}})),"CLOSED-CAPTIONS":[]},u=0;for(iu.lastIndex=0;null!==(i=iu.exec(t));){var c=new ko(i[1]),d=c.TYPE;if(d){var l=s[d],h=a[d]||[];a[d]=h,Gs(n,c,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);var f=c.LANGUAGE,p=c["ASSOC-LANGUAGE"],v=c.CHANNELS,g=c.CHARACTERISTICS,m=c["INSTREAM-ID"],y={attrs:c,bitrate:0,id:u++,groupId:c["GROUP-ID"]||"",name:c.NAME||f||"",type:d,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:f,url:c.URI?e.resolve(c.URI,r):""};if(p&&(y.assocLang=p),v&&(y.channels=v),g&&(y.characteristics=g),m&&(y.instreamId=m),null!=l&&l.length){var _=e.findGroup(l,y.groupId)||l[0];hu(y,_,"audioCodec"),hu(y,_,"textCodec")}h.push(y)}}return a}},{key:"parseLevelPlaylist",value:function(e,t,r,n,i,a){var o,s,u,c=new Po(t),d=c.fragments,l=null,h=0,f=0,p=0,v=0,g=null,m=new Oo(n,t),y=-1,_=!1,S=null;for(ou.lastIndex=0,c.m3u8=e,c.hasVariableRefs=Ws(e);null!==(o=ou.exec(e));){_&&(_=!1,(m=new Oo(n,t)).start=p,m.sn=h,m.cc=v,m.level=r,l&&(m.initSegment=l,m.rawProgramDateTime=l.rawProgramDateTime,l.rawProgramDateTime=null,S&&(m.setByteRange(S),S=null)));var A=o[1];if(A){m.duration=parseFloat(A);var b=(" "+o[2]).slice(1);m.title=b||null,m.tagList.push(b?["INF",A,b]:["INF",A])}else if(o[3]){if(ho(m.duration)){m.start=p,u&&vu(m,u,c),m.sn=h,m.level=r,m.cc=v,d.push(m);var E=(" "+o[3]).slice(1);m.relurl=Hs(c,E),fu(m,g),g=m,p+=m.duration,h++,f=0,_=!0}}else if(o[4]){var k=(" "+o[4]).slice(1);g?m.setByteRange(k,g):m.setByteRange(k)}else if(o[5])m.rawProgramDateTime=(" "+o[5]).slice(1),m.tagList.push(["PROGRAM-DATE-TIME",m.rawProgramDateTime]),-1===y&&(y=d.length);else{if(!(o=o[0].match(su))){Ao.warn("No matches on slow regex match for level playlist!");continue}for(s=1;s<o.length&&void 0===o[s];s++);var C=(" "+o[s]).slice(1),w=(" "+o[s+1]).slice(1),T=o[s+2]?(" "+o[s+2]).slice(1):"";switch(C){case"PLAYLIST-TYPE":c.type=w.toUpperCase();break;case"MEDIA-SEQUENCE":h=c.startSN=parseInt(w);break;case"SKIP":var R=new ko(w);Gs(c,R,["RECENTLY-REMOVED-DATERANGES"]);var I=R.decimalInteger("SKIPPED-SEGMENTS");if(ho(I)){c.skippedSegments=I;for(var D=I;D--;)d.unshift(null);h+=I}var M=R.enumeratedString("RECENTLY-REMOVED-DATERANGES");M&&(c.recentlyRemovedDateranges=M.split("\t"));break;case"TARGETDURATION":c.targetduration=Math.max(parseInt(w),1);break;case"VERSION":c.version=parseInt(w);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":c.live=!1;break;case"#":(w||T)&&m.tagList.push(T?[w,T]:[w]);break;case"DISCONTINUITY":v++,m.tagList.push(["DIS"]);break;case"GAP":m.gap=!0,m.tagList.push([C]);break;case"BITRATE":m.tagList.push([C,w]);break;case"DATERANGE":var O=new ko(w);Gs(c,O,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),Gs(c,O,O.clientAttrs);var x=new wo(O,c.dateRanges[O.ID]);x.isValid||c.skippedSegments?c.dateRanges[x.id]=x:Ao.warn('Ignoring invalid DATERANGE tag: "'.concat(w,'"')),m.tagList.push(["EXT-X-DATERANGE",w]);break;case"DEFINE":var P=new ko(w);Gs(c,P,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in P?Ks(c,P,a):js(c,P,t);break;case"DISCONTINUITY-SEQUENCE":v=parseInt(w);break;case"KEY":var L=cu(w,t,c);if(L.isSupported()){if("NONE"===L.method){u=void 0;break}u||(u={}),u[L.keyFormat]&&(u=lo({},u)),u[L.keyFormat]=L}else Ao.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'.concat(w,'"'));break;case"START":c.startTimeOffset=du(w);break;case"MAP":var N=new ko(w);if(Gs(c,N,["BYTERANGE","URI"]),m.duration){var V=new Oo(n,t);pu(V,N,r,u),l=V,m.initSegment=l,l.rawProgramDateTime&&!m.rawProgramDateTime&&(m.rawProgramDateTime=l.rawProgramDateTime)}else{var U=m.byteRangeEndOffset;if(U){var F=m.byteRangeStartOffset;S="".concat(U-F,"@").concat(F)}else S=null;pu(m,N,r,u),l=m,_=!0}break;case"SERVER-CONTROL":var B=new ko(w);c.canBlockReload=B.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=B.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&B.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=B.optionalFloat("PART-HOLD-BACK",0),c.holdBack=B.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var W=new ko(w);c.partTarget=W.decimalFloatingPoint("PART-TARGET");break;case"PART":var G=c.partList;G||(G=c.partList=[]);var H=f>0?G[G.length-1]:void 0,j=f++,K=new ko(w);Gs(c,K,["BYTERANGE","URI"]);var z=new xo(K,m,t,j,H);G.push(z),m.duration+=z.duration;break;case"PRELOAD-HINT":var q=new ko(w);Gs(c,q,["URI"]),c.preloadHint=q;break;case"RENDITION-REPORT":var Y=new ko(w);Gs(c,Y,["URI"]),c.renditionReports=c.renditionReports||[],c.renditionReports.push(Y);break;default:Ao.warn("line parsed but not handled: ".concat(o))}}}g&&!g.relurl?(d.pop(),p-=g.duration,c.partList&&(c.fragmentHint=g)):c.partList&&(fu(m,g),m.cc=v,c.fragmentHint=m,u&&vu(m,u,c));var X=d.length,Q=d[0],J=d[X-1];if((p+=c.skippedSegments*c.targetduration)>0&&X&&J){c.averagetargetduration=p/X;var $=J.sn;c.endSN="initSegment"!==$?$:0,c.live||(J.endList=!0),Q&&(c.startCC=Q.cc)}else c.endSN=0,c.startCC=0;return c.fragmentHint&&(p+=c.fragmentHint.duration),c.totalduration=p,c.endCC=v,y>0&&function(e,t){for(var r=e[t],n=t;n--;){var i=e[n];if(!i)return;i.programDateTime=r.programDateTime-1e3*i.duration,r=i}}(d,y),c}}])}();function cu(e,t,r){var n,i,a=new ko(e);Gs(r,a,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);var o=null!=(n=a.METHOD)?n:"",s=a.URI,u=a.hexadecimalInteger("IV"),c=a.KEYFORMATVERSIONS,d=null!=(i=a.KEYFORMAT)?i:"identity";s&&a.IV&&!u&&Ao.error("Invalid IV: ".concat(a.IV));var l=s?uu.resolve(s,t):"",h=(c||"1").split("/").map(Number).filter(Number.isFinite);return new Fs(o,l,d,h,u)}function du(e){var t=new ko(e).decimalFloatingPoint("TIME-OFFSET");return ho(t)?t:null}function lu(e,t){var r=(e||"").split(/[ ,]+/).filter((function(e){return e}));["video","audio","text"].forEach((function(e){var n=r.filter((function(t){return function(e,t){var r=qs[t];return!!r&&!!r[e.slice(0,4)]}(t,e)}));n.length&&(t["".concat(e,"Codec")]=n.join(","),r=r.filter((function(e){return-1===n.indexOf(e)})))})),t.unknownCodecs=r}function hu(e,t,r){var n=t[r];n&&(e[r]=n)}function fu(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),ho(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function pu(e,t,r,n){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=r,e.sn="initSegment",n&&(e.levelkeys=n),e.initSegment=null}function vu(e,t,r){e.levelkeys=t;var n=r.encryptedFragments;n.length&&n[n.length-1].levelkeys===t||!Object.keys(t).some((function(e){return t[e].isCommonEncryption}))||n.push(e)}var gu="manifest",mu="level",yu="audioTrack",_u="subtitleTrack",Su="main",Au="audio",bu="subtitle";function Eu(e){switch(e.type){case yu:return Au;case _u:return bu;default:return Su}}function ku(e,t){var r=e.url;return void 0!==r&&0!==r.indexOf("data:")||(r=t.url),r}var Cu=D((function e(t){R(this,e),this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=t,this.registerListeners()}),[{key:"startLoad",value:function(e){}},{key:"stopLoad",value:function(){this.destroyInternalLoaders()}},{key:"registerListeners",value:function(){var e=this.hls;e.on(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.on(vo.LEVEL_LOADING,this.onLevelLoading,this),e.on(vo.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(vo.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.off(vo.LEVEL_LOADING,this.onLevelLoading,this),e.off(vo.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(vo.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}},{key:"createInternalLoader",value:function(e){var t=this.hls.config,r=t.pLoader,n=t.loader,i=new(r||n)(t);return this.loaders[e.type]=i,i}},{key:"getInternalLoader",value:function(e){return this.loaders[e.type]}},{key:"resetInternalLoader",value:function(e){this.loaders[e]&&delete this.loaders[e]}},{key:"destroyInternalLoaders",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}},{key:"destroy",value:function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}},{key:"onManifestLoading",value:function(e,t){var r=t.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:gu,url:r,deliveryDirectives:null})}},{key:"onLevelLoading",value:function(e,t){var r=t.id,n=t.level,i=t.pathwayId,a=t.url,o=t.deliveryDirectives;this.load({id:r,level:n,pathwayId:i,responseType:"text",type:mu,url:a,deliveryDirectives:o})}},{key:"onAudioTrackLoading",value:function(e,t){var r=t.id,n=t.groupId,i=t.url,a=t.deliveryDirectives;this.load({id:r,groupId:n,level:null,responseType:"text",type:yu,url:i,deliveryDirectives:a})}},{key:"onSubtitleTrackLoading",value:function(e,t){var r=t.id,n=t.groupId,i=t.url,a=t.deliveryDirectives;this.load({id:r,groupId:n,level:null,responseType:"text",type:_u,url:i,deliveryDirectives:a})}},{key:"load",value:function(e){var t,r,n,i=this,a=this.hls.config,o=this.getInternalLoader(e);if(o){var s=o.context;if(s&&s.url===e.url&&s.level===e.level)return void Ao.trace("[playlist-loader]: playlist request ongoing");Ao.log("[playlist-loader]: aborting previous loader for type: ".concat(e.type)),o.abort()}if(r=e.type===gu?a.manifestLoadPolicy.default:lo({},a.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),o=this.createInternalLoader(e),ho(null==(t=e.deliveryDirectives)?void 0:t.part)&&(e.type===mu&&null!==e.level?n=this.hls.levels[e.level].details:e.type===yu&&null!==e.id?n=this.hls.audioTracks[e.id].details:e.type===_u&&null!==e.id&&(n=this.hls.subtitleTracks[e.id].details),n)){var u=n.partTarget,c=n.targetduration;if(u&&c){var d=1e3*Math.max(3*u,.8*c);r=lo({},r,{maxTimeToFirstByteMs:Math.min(d,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(d,r.maxTimeToFirstByteMs)})}}var l=r.errorRetry||r.timeoutRetry||{},h={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},f={onSuccess:function(e,t,r,n){var a=i.getInternalLoader(r);i.resetInternalLoader(r.type);var o=e.data;0===o.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),uu.isMediaPlaylist(o)?i.handleTrackOrLevelPlaylist(e,t,r,n||null,a):i.handleMasterPlaylist(e,t,r,n)):i.handleManifestParsingError(e,r,new Error("no EXTM3U delimiter"),n||null,t)},onError:function(e,t,r,n){i.handleNetworkError(t,r,!1,e,n)},onTimeout:function(e,t,r){i.handleNetworkError(t,r,!0,void 0,e)}};o.load(e,h,f)}},{key:"handleMasterPlaylist",value:function(e,t,r,n){var i=this.hls,a=e.data,o=ku(e,r),s=uu.parseMasterPlaylist(a,o);if(s.playlistParsingError)this.handleManifestParsingError(e,r,s.playlistParsingError,n,t);else{var u=s.contentSteering,c=s.levels,d=s.sessionData,l=s.sessionKeys,h=s.startTimeOffset,f=s.variableList;this.variableList=f;var p=uu.parseMasterPlaylistMedia(a,o,s),v=p.AUDIO,g=void 0===v?[]:v,m=p.SUBTITLES,y=p["CLOSED-CAPTIONS"];g.length&&(g.some((function(e){return!e.url}))||!c[0].audioCodec||c[0].attrs.AUDIO||(Ao.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new ko({}),bitrate:0,url:""}))),i.trigger(vo.MANIFEST_LOADED,{levels:c,audioTracks:g,subtitles:m,captions:y,contentSteering:u,url:o,stats:t,networkDetails:n,sessionData:d,sessionKeys:l,startTimeOffset:h,variableList:f})}}},{key:"handleTrackOrLevelPlaylist",value:function(e,t,r,n,i){var a=this.hls,o=r.id,s=r.level,u=r.type,c=ku(e,r),d=ho(s)?s:ho(o)?o:0,l=Eu(r),h=uu.parseLevelPlaylist(e.data,c,d,l,0,this.variableList);if(u===gu){var f={attrs:new ko({}),bitrate:0,details:h,name:"",url:c};a.trigger(vo.MANIFEST_LOADED,{levels:[f],audioTracks:[],url:c,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=h,this.handlePlaylistLoaded(h,e,t,r,n,i)}},{key:"handleManifestParsingError",value:function(e,t,r,n,i){this.hls.trigger(vo.ERROR,{type:go.NETWORK_ERROR,details:mo.MANIFEST_PARSING_ERROR,fatal:t.type===gu,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:n,stats:i})}},{key:"handleNetworkError",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,a="A network ".concat(r?"timeout":"error"+(n?" (status "+n.code+")":"")," occurred while loading ").concat(e.type);e.type===mu?a+=": ".concat(e.level," id: ").concat(e.id):e.type!==yu&&e.type!==_u||(a+=" id: ".concat(e.id,' group-id: "').concat(e.groupId,'"'));var o=new Error(a);Ao.warn("[playlist-loader]: ".concat(a));var s=mo.UNKNOWN,u=!1,c=this.getInternalLoader(e);switch(e.type){case gu:s=r?mo.MANIFEST_LOAD_TIMEOUT:mo.MANIFEST_LOAD_ERROR,u=!0;break;case mu:s=r?mo.LEVEL_LOAD_TIMEOUT:mo.LEVEL_LOAD_ERROR,u=!1;break;case yu:s=r?mo.AUDIO_TRACK_LOAD_TIMEOUT:mo.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case _u:s=r?mo.SUBTITLE_TRACK_LOAD_TIMEOUT:mo.SUBTITLE_LOAD_ERROR,u=!1}c&&this.resetInternalLoader(e.type);var d={type:go.NETWORK_ERROR,details:s,fatal:u,url:e.url,loader:c,context:e,error:o,networkDetails:t,stats:i};if(n){var l=(null==t?void 0:t.url)||e.url;d.response=uo({url:l,data:void 0},n)}this.hls.trigger(vo.ERROR,d)}},{key:"handlePlaylistLoaded",value:function(e,t,r,n,i,a){var o=this.hls,s=n.type,u=n.level,c=n.id,d=n.groupId,l=n.deliveryDirectives,h=ku(t,n),f=Eu(n),p="number"==typeof n.level&&f===Su?u:void 0;if(e.fragments.length){e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));var v=e.playlistParsingError;if(v)o.trigger(vo.ERROR,{type:go.NETWORK_ERROR,details:mo.LEVEL_PARSING_ERROR,fatal:!1,url:h,error:v,reason:v.message,response:t,context:n,level:p,parent:f,networkDetails:i,stats:r});else switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),a.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),s){case gu:case mu:o.trigger(vo.LEVEL_LOADED,{details:e,level:p||0,id:c||0,stats:r,networkDetails:i,deliveryDirectives:l});break;case yu:o.trigger(vo.AUDIO_TRACK_LOADED,{details:e,id:c||0,groupId:d||"",stats:r,networkDetails:i,deliveryDirectives:l});break;case _u:o.trigger(vo.SUBTITLE_TRACK_LOADED,{details:e,id:c||0,groupId:d||"",stats:r,networkDetails:i,deliveryDirectives:l})}}else{var g=new Error("No Segments found in Playlist");o.trigger(vo.ERROR,{type:go.NETWORK_ERROR,details:mo.LEVEL_EMPTY_ERROR,fatal:!1,url:h,error:g,reason:g.message,response:t,context:n,level:p,parent:f,networkDetails:i,stats:r})}}}]);function wu(e,t){var r;try{r=new Event("addtrack")}catch(e){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function Tu(e,t){var r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: ".concat(t))}catch(r){Ao.debug("[texttrack-utils]: ".concat(r));try{var n=new self.TextTrackCue(t.startTime,t.endTime,t.text);n.id=t.id,e.addCue(n)}catch(e){Ao.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: ".concat(e))}}"disabled"===r&&(e.mode=r)}function Ru(e){var t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(var r=e.cues.length;r--;)e.removeCue(e.cues[r]);"disabled"===t&&(e.mode=t)}function Iu(e,t,r,n){var i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&e.cues.length>0)for(var a=function(e,t,r){var n=[],i=function(e,t){if(t<e[0].startTime)return 0;var r=e.length-1;if(t>e[r].endTime)return-1;for(var n=0,i=r;n<=i;){var a=Math.floor((i+n)/2);if(t<e[a].startTime)i=a-1;else{if(!(t>e[a].startTime&&n<r))return a;n=a+1}}return e[n].startTime-t<t-e[i].startTime?n:i}(e,t);if(i>-1)for(var a=i,o=e.length;a<o;a++){var s=e[a];if(s.startTime>=t&&s.endTime<=r)n.push(s);else if(s.startTime>r)return n}return n}(e.cues,t,r),o=0;o<a.length;o++)n&&!n(a[o])||e.removeCue(a[o]);"disabled"===i&&(e.mode=i)}function Du(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];"subtitles"!==n.kind&&"captions"!==n.kind||!n.label||t.push(e[r])}return t}var Mu="org.id3",Ou="https://aomedia.org/emsg/ID3";function xu(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function Pu(e,t,r,n,i){var a=new e(t,r,"");try{a.value=n,i&&(a.type=i)}catch(o){a=new e(t,r,JSON.stringify(i?uo({type:i},n):n))}return a}var Lu=function(){var e=xu();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function Nu(e,t){return e.getTime()/1e3-t}var Vu=D((function e(t){R(this,e),this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}),[{key:"destroy",value:function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}},{key:"_registerListeners",value:function(){var e=this.hls;e.on(vo.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(vo.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.on(vo.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(vo.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(vo.LEVEL_UPDATED,this.onLevelUpdated,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(vo.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(vo.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.off(vo.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(vo.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(vo.LEVEL_UPDATED,this.onLevelUpdated,this)}},{key:"onMediaAttached",value:function(e,t){this.media=t.media}},{key:"onMediaDetaching",value:function(){this.id3Track&&(Ru(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}},{key:"onManifestLoading",value:function(){this.dateRangeCuesAppended={}}},{key:"createTrack",value:function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t}},{key:"getID3Track",value:function(e){if(this.media){for(var t=0;t<e.length;t++){var r=e[t];if("metadata"===r.kind&&"id3"===r.label)return wu(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}},{key:"onFragParsingMetadata",value:function(e,t){if(this.media){var r=this.hls.config,n=r.enableEmsgMetadataCues,i=r.enableID3MetadataCues;if(n||i){var a=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));var o=xu();if(o)for(var s=0;s<a.length;s++){var u=a[s].type;if((u!==Ou||n)&&i){var c=os(a[s].data);if(c){var d=a[s].pts,l=d+a[s].duration;l>Lu&&(l=Lu),l-d<=0&&(l=d+.25);for(var h=0;h<c.length;h++){var f=c[h];if(!is(f)){this.updateId3CueEnds(d,u);var p=Pu(o,d,l,f,u);p&&this.id3Track.addCue(p)}}}}}}}}},{key:"updateId3CueEnds",value:function(e,t){var r,n=null==(r=this.id3Track)?void 0:r.cues;if(n)for(var i=n.length;i--;){var a=n[i];a.type===t&&a.startTime<e&&a.endTime===Lu&&(a.endTime=e)}}},{key:"onBufferFlushing",value:function(e,t){var r=t.startOffset,n=t.endOffset,i=t.type,a=this.id3Track,o=this.hls;if(o){var s=o.config,u=s.enableEmsgMetadataCues,c=s.enableID3MetadataCues;a&&(u||c)&&Iu(a,r,n,"audio"===i?function(e){return e.type===Mu&&c}:"video"===i?function(e){return e.type===Ou&&u}:function(e){return e.type===Mu&&c||e.type===Ou&&u})}}},{key:"onLevelUpdated",value:function(e,t){var r=this,n=t.details;if(this.media&&n.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var i=this.dateRangeCuesAppended,a=this.id3Track,o=n.dateRanges,s=Object.keys(o);if(a)for(var u=Object.keys(i).filter((function(e){return!s.includes(e)})),c=function(){var e=u[d];Object.keys(i[e].cues).forEach((function(t){a.removeCue(i[e].cues[t])})),delete i[e]},d=u.length;d--;)c();var l=n.fragments[n.fragments.length-1];if(0!==s.length&&ho(null==l?void 0:l.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var h=l.programDateTime/1e3-l.start,f=xu(),p=function(){var e=s[v],t=o[e],n=Nu(t.startDate,h),a=i[e],u=(null==a?void 0:a.cues)||{},c=(null==a?void 0:a.durationKnown)||!1,d=Lu,l=t.endDate;if(l)d=Nu(l,h),c=!0;else if(t.endOnNext&&!c){var p=s.reduce((function(e,r){if(r!==t.id){var n=o[r];if(n.class===t.class&&n.startDate>t.startDate&&(!e||t.startDate<e.startDate))return n}return e}),null);p&&(d=Nu(p.startDate,h),c=!0)}for(var g,m,y=Object.keys(t.attr),_=0;_<y.length;_++){var S=y[_];if("ID"!==(m=S)&&"CLASS"!==m&&"START-DATE"!==m&&"DURATION"!==m&&"END-DATE"!==m&&"END-ON-NEXT"!==m){var A=u[S];if(A)c&&!a.durationKnown&&(A.endTime=d);else if(f){var b=t.attr[S];Co(S)&&(g=b,b=Uint8Array.from(g.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer);var E=Pu(f,n,d,{key:S,data:b},"com.apple.quicktime.HLS");E&&(E.id=e,r.id3Track.addCue(E),u[S]=E)}}}i[e]={cues:u,dateRange:t,durationKnown:c}},v=0;v<s.length;v++)p()}}}}]),Uu=D((function e(t){var r=this;R(this,e),this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return r.timeupdate()},this.hls=t,this.config=t.config,this.registerListeners()}),[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config,t=this.levelDetails;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(null===e)return null;var t=e.holdBack,r=e.partHoldBack,n=e.targetduration,i=this.config,a=i.liveSyncDuration,o=i.liveSyncDurationCount,s=i.lowLatencyMode,u=this.hls.userConfig,c=s&&r||t;(u.liveSyncDuration||u.liveSyncDurationCount||0===c)&&(c=void 0!==a?a:o*n);var d=n;return c+Math.min(1*this.stallCount,d)}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(null===e||null===t||null===r)return null;var n=r.edge,i=e-t-this.edgeStalled,a=n-r.totalduration,o=n-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(a,i),o)}},{key:"drift",get:function(){var e=this.levelDetails;return null===e?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(null===e)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,t=this.levelDetails;if(!e||!t)return 0;var r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}},{key:"destroy",value:function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}},{key:"registerListeners",value:function(){this.hls.on(vo.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(vo.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(vo.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(vo.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(vo.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){this.hls.off(vo.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(vo.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(vo.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(vo.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(vo.ERROR,this.onError,this)}},{key:"onMediaAttached",value:function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}},{key:"onMediaDetaching",value:function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}},{key:"onManifestLoading",value:function(){this.levelDetails=null,this._latency=null,this.stallCount=0}},{key:"onLevelUpdated",value:function(e,t){var r=t.details;this.levelDetails=r,r.advanced&&this.timeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}},{key:"onError",value:function(e,t){var r;t.details===mo.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(r=this.levelDetails)&&r.live&&Ao.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}},{key:"timeupdate",value:function(){var e=this.media,t=this.levelDetails;if(e&&t){this.currentTime=e.currentTime;var r=this.computeLatency();if(null!==r){this._latency=r;var n=this.config,i=n.lowLatencyMode,a=n.maxLiveSyncPlaybackRate;if(i&&1!==a&&t.live){var o=this.targetLatency;if(null!==o){var s=r-o;if(s<Math.min(this.maxLatency,o+t.targetduration)&&s>.05&&this.forwardBufferLength>1){var u=Math.min(2,Math.max(1,a)),c=Math.round(2/(1+Math.exp(-.75*s-this.edgeStalled))*20)/20;e.playbackRate=Math.min(u,Math.max(1,c))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}}}}}},{key:"estimateLiveEdge",value:function(){var e=this.levelDetails;return null===e?null:e.edge+e.age}},{key:"computeLatency",value:function(){var e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}]),Fu=["NONE","TYPE-0","TYPE-1",null],Bu=["SDR","PQ","HLG"];function Wu(e){var t=e.canSkipUntil,r=e.canSkipDateRanges,n=e.age;return t&&n<t/2?r?"v2":"YES":""}var Gu=D((function e(t,r,n){R(this,e),this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=r,this.skip=n}),[{key:"addDirectives",value:function(e){var t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}]),Hu=D((function e(t){R(this,e),this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.frameRate=t.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=t.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.codecSet=[t.videoCodec,t.audioCodec].filter((function(e){return!!e})).map((function(e){return e.substring(0,4)})).join(","),this.addGroupId("audio",t.attrs.AUDIO),this.addGroupId("text",t.attrs.SUBTITLES)}),[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"averageBitrate",get:function(){return this._avgBitrate||this.realBitrate||this.bitrate}},{key:"attrs",get:function(){return this._attrs[0]}},{key:"codecs",get:function(){return this.attrs.CODECS||""}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"videoRange",get:function(){return this.attrs["VIDEO-RANGE"]||"SDR"}},{key:"score",get:function(){return this.attrs.optionalFloat("SCORE",0)}},{key:"uri",get:function(){return this.url[0]||""}},{key:"hasAudioGroup",value:function(e){return ju(this._audioGroups,e)}},{key:"hasSubtitleGroup",value:function(e){return ju(this._subtitleGroups,e)}},{key:"audioGroups",get:function(){return this._audioGroups}},{key:"subtitleGroups",get:function(){return this._subtitleGroups}},{key:"addGroupId",value:function(e,t){if(t)if("audio"===e){var r=this._audioGroups;r||(r=this._audioGroups=[]),-1===r.indexOf(t)&&r.push(t)}else if("text"===e){var n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),-1===n.indexOf(t)&&n.push(t)}}},{key:"urlId",get:function(){return 0},set:function(e){}},{key:"audioGroupIds",get:function(){return this.audioGroups?[this.audioGroupId]:void 0}},{key:"textGroupIds",get:function(){return this.subtitleGroups?[this.textGroupId]:void 0}},{key:"audioGroupId",get:function(){var e;return null==(e=this.audioGroups)?void 0:e[0]}},{key:"textGroupId",get:function(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}},{key:"addFallback",value:function(){}}]);function ju(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function Ku(e,t){var r=t.startPTS;if(ho(r)){var n,i=0;t.sn>e.sn?(i=r-e.start,n=e):(i=e.start-r,n=t),n.duration!==i&&(n.duration=i)}else t.sn>e.sn?e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration:t.start=Math.max(e.start-t.duration,0)}function zu(e,t,r,n,i,a){n-r<=0&&(Ao.warn("Fragment should have a positive duration",t),n=r+t.duration,a=i+t.duration);var o=r,s=n,u=t.startPTS,c=t.endPTS;if(ho(u)){var d=Math.abs(u-r);ho(t.deltaPTS)?t.deltaPTS=Math.max(d,t.deltaPTS):t.deltaPTS=d,o=Math.max(r,u),r=Math.min(r,u),i=Math.min(i,t.startDTS),s=Math.min(n,c),n=Math.max(n,c),a=Math.max(a,t.endDTS)}var l=r-t.start;0!==t.start&&(t.start=r),t.duration=n-t.start,t.startPTS=r,t.maxStartPTS=o,t.startDTS=i,t.endPTS=n,t.minEndPTS=s,t.endDTS=a;var h,f=t.sn;if(!e||f<e.startSN||f>e.endSN)return 0;var p=f-e.startSN,v=e.fragments;for(v[p]=t,h=p;h>0;h--)Ku(v[h],v[h-1]);for(h=p;h<v.length-1;h++)Ku(v[h],v[h+1]);return e.fragmentHint&&Ku(v[v.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,l}function qu(e,t){var r=t.startSN+t.skippedSegments-e.startSN,n=e.fragments;r<0||r>=n.length||Yu(t,n[r].start)}function Yu(e,t){if(t){for(var r=e.fragments,n=e.skippedSegments;n<r.length;n++)r[n].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function Xu(e,t,r){var n;return null!=e&&e.details?Qu(null==(n=e.details)?void 0:n.partList,t,r):null}function Qu(e,t,r){if(e)for(var n=e.length;n--;){var i=e[n];if(i.index===r&&i.fragment.sn===t)return i}return null}function Ju(e){e.forEach((function(e,t){var r=e.details;null!=r&&r.fragments&&r.fragments.forEach((function(e){e.level=t}))}))}function $u(e){switch(e.details){case mo.FRAG_LOAD_TIMEOUT:case mo.KEY_LOAD_TIMEOUT:case mo.LEVEL_LOAD_TIMEOUT:case mo.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Zu(e,t){var r=$u(t);return e.default["".concat(r?"timeout":"error","Retry")]}function ec(e,t){var r="linear"===e.backoff?1:Math.pow(2,t);return Math.min(r*e.retryDelayMs,e.maxRetryDelayMs)}function tc(e){return uo(uo({},e),{errorRetry:null,timeoutRetry:null})}function rc(e,t,r,n){if(!e)return!1;var i=null==n?void 0:n.code,a=t<e.maxNumRetry&&(function(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}(i)||!!r);return e.shouldRetry?e.shouldRetry(e,t,r,n,a):a}var nc=function(e,t){for(var r=0,n=e.length-1,i=null,a=null;r<=n;){var o=t(a=e[i=(r+n)/2|0]);if(o>0)r=i+1;else{if(!(o<0))return a;n=i-1}}return null};function ic(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.005,a=null;if(e){a=t[e.sn-t[0].sn+1]||null;var o=e.endDTS-r;o>0&&o<15e-7&&(r+=15e-7)}else 0===r&&0===t[0].start&&(a=t[0]);if(a&&((!e||e.level===a.level)&&0===ac(r,n,a)||function(e,t,r){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){var n=t.tagList.reduce((function(e,t){return"INF"===t[0]&&(e+=parseFloat(t[1])),e}),r);return e.start<=n}return!1}(a,e,Math.min(i,n))))return a;var s=nc(t,ac.bind(null,r,n));return!s||s===e&&a?a:s}function ac(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(r.start<=e&&r.start+r.duration>e)return 0;var n=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-n<=e?1:r.start-n>e&&r.start?-1:0}function oc(e,t,r){var n=1e3*Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return(r.endProgramDateTime||0)-n>e}var sc=D((function e(t){R(this,e),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=t,this.log=Ao.log.bind(Ao,"[info]:"),this.warn=Ao.warn.bind(Ao,"[warning]:"),this.error=Ao.error.bind(Ao,"[error]:"),this.registerListeners()}),[{key:"registerListeners",value:function(){var e=this.hls;e.on(vo.ERROR,this.onError,this),e.on(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.on(vo.LEVEL_UPDATED,this.onLevelUpdated,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e&&(e.off(vo.ERROR,this.onError,this),e.off(vo.ERROR,this.onErrorOut,this),e.off(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.off(vo.LEVEL_UPDATED,this.onLevelUpdated,this))}},{key:"destroy",value:function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}},{key:"startLoad",value:function(e){}},{key:"stopLoad",value:function(){this.playlistError=0}},{key:"getVariantLevelIndex",value:function(e){return(null==e?void 0:e.type)===Su?e.level:this.hls.loadLevel}},{key:"onManifestLoading",value:function(){this.playlistError=0,this.penalizedRenditions={}}},{key:"onLevelUpdated",value:function(){this.playlistError=0}},{key:"onError",value:function(e,t){var r,n;if(!t.fatal){var i=this.hls,a=t.context;switch(t.details){case mo.FRAG_LOAD_ERROR:case mo.FRAG_LOAD_TIMEOUT:case mo.KEY_LOAD_ERROR:case mo.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case mo.FRAG_PARSING_ERROR:if(null!=(r=t.frag)&&r.gap)return void(t.errorAction={action:0,flags:0});case mo.FRAG_GAP:case mo.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=2);case mo.LEVEL_EMPTY_ERROR:case mo.LEVEL_PARSING_ERROR:var o,s,u=t.parent===Su?t.level:i.loadLevel;return void(t.details===mo.LEVEL_EMPTY_ERROR&&null!=(o=t.context)&&null!=(s=o.levelDetails)&&s.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,u):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,u)));case mo.LEVEL_LOAD_ERROR:case mo.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==a?void 0:a.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.level)));case mo.AUDIO_TRACK_LOAD_ERROR:case mo.AUDIO_TRACK_LOAD_TIMEOUT:case mo.SUBTITLE_LOAD_ERROR:case mo.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){var c=i.levels[i.loadLevel];if(c&&(a.type===yu&&c.hasAudioGroup(a.groupId)||a.type===_u&&c.hasSubtitleGroup(a.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=2,void(t.errorAction.flags=1)}return;case mo.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var d=i.levels[i.loadLevel],l=null==d?void 0:d.attrs["HDCP-LEVEL"];return void(l?t.errorAction={action:2,flags:2,hdcpLevel:l}:this.keySystemError(t));case mo.BUFFER_ADD_CODEC_ERROR:case mo.REMUX_ALLOC_ERROR:case mo.BUFFER_APPEND_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null!=(n=t.level)?n:i.loadLevel));case mo.INTERNAL_EXCEPTION:case mo.BUFFER_APPENDING_ERROR:case mo.BUFFER_FULL_ERROR:case mo.LEVEL_SWITCH_ERROR:case mo.BUFFER_STALLED_ERROR:case mo.BUFFER_SEEK_OVER_HOLE:case mo.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:0,flags:0})}t.type===go.KEY_SYSTEM_ERROR&&this.keySystemError(t)}}},{key:"keySystemError",value:function(e){var t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}},{key:"getPlaylistRetryOrSwitchAction",value:function(e,t){var r=Zu(this.hls.config.playlistLoadPolicy,e),n=this.playlistError++;if(rc(r,n,$u(e),e.response))return{action:5,flags:0,retryConfig:r,retryCount:n};var i=this.getLevelSwitchAction(e,t);return r&&(i.retryConfig=r,i.retryCount=n),i}},{key:"getFragRetryOrSwitchAction",value:function(e){var t=this.hls,r=this.getVariantLevelIndex(e.frag),n=t.levels[r],i=t.config,a=i.fragLoadPolicy,o=i.keyLoadPolicy,s=Zu(e.details.startsWith("key")?o:a,e),u=t.levels.reduce((function(e,t){return e+t.fragmentError}),0);if(n&&(e.details!==mo.FRAG_GAP&&n.fragmentError++,rc(s,u,$u(e),e.response)))return{action:5,flags:0,retryConfig:s,retryCount:u};var c=this.getLevelSwitchAction(e,r);return s&&(c.retryConfig=s,c.retryCount=u),c}},{key:"getLevelSwitchAction",value:function(e,t){var r=this.hls;null==t&&(t=r.loadLevel);var n=this.hls.levels[t];if(n){var i,a,o=e.details;n.loadError++,o===mo.BUFFER_APPEND_ERROR&&n.fragmentError++;var s=-1,u=r.levels,c=r.loadLevel,d=r.minAutoLevel,l=r.maxAutoLevel;r.autoLevelEnabled||(r.loadLevel=-1);for(var h,f,p,v=null==(i=e.frag)?void 0:i.type,g=(v===Au&&o===mo.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(o===mo.BUFFER_ADD_CODEC_ERROR||o===mo.BUFFER_APPEND_ERROR))&&u.some((function(e){var t=e.audioCodec;return n.audioCodec!==t})),m="video"===e.sourceBufferName&&(o===mo.BUFFER_ADD_CODEC_ERROR||o===mo.BUFFER_APPEND_ERROR)&&u.some((function(e){var t=e.codecSet,r=e.audioCodec;return n.codecSet!==t&&n.audioCodec===r})),y=null!=(a=e.context)?a:{},_=y.type,S=y.groupId,A=function(){var t=(b+c)%u.length;if(t!==c&&t>=d&&t<=l&&0===u[t].loadError){var r=u[t];if(o===mo.FRAG_GAP&&v===Su&&e.frag){var i=u[t].details;if(i){var a=ic(e.frag,i.fragments,e.frag.start);if(null!=a&&a.gap)return 0}}else{if(_===yu&&r.hasAudioGroup(S)||_===_u&&r.hasSubtitleGroup(S))return 0;if(v===Au&&null!=(h=n.audioGroups)&&h.some((function(e){return r.hasAudioGroup(e)}))||v===bu&&null!=(f=n.subtitleGroups)&&f.some((function(e){return r.hasSubtitleGroup(e)}))||g&&n.audioCodec===r.audioCodec||!g&&n.audioCodec!==r.audioCodec||m&&n.codecSet===r.codecSet)return 0}return s=t,1}},b=u.length;b--&&(0===(p=A())||1!==p););if(s>-1&&r.loadLevel!==s)return e.levelRetry=!0,this.playlistError=0,{action:2,flags:0,nextAutoLevel:s}}return{action:2,flags:1}}},{key:"onErrorOut",value:function(e,t){var r;switch(null==(r=t.errorAction)?void 0:r.action){case 0:break;case 2:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===mo.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn('MediaSource ended after "'.concat(t.sourceBufferName,'" sourceBuffer append error. Attempting to recover from media error.')),this.hls.recoverMediaError()):t.fatal=!0}t.fatal&&this.hls.stopLoad()}},{key:"sendAlternateToPenaltyBox",value:function(e){var t=this.hls,r=e.errorAction;if(r){var n=r.flags,i=r.hdcpLevel,a=r.nextAutoLevel;switch(n){case 0:this.switchLevel(e,a);break;case 2:i&&(t.maxHdcpLevel=Fu[Fu.indexOf(i)-1],r.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'.concat(t.maxHdcpLevel,'" or lower'))}r.resolved||this.switchLevel(e,a)}}},{key:"switchLevel",value:function(e,t){void 0!==t&&e.errorAction&&(this.warn("switching to level ".concat(t," after ").concat(e.details)),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}}]),uc=D((function e(t,r){R(this,e),this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=Ao.log.bind(Ao,"".concat(r,":")),this.warn=Ao.warn.bind(Ao,"".concat(r,":")),this.hls=t}),[{key:"destroy",value:function(){this.clearTimer(),this.hls=this.log=this.warn=null}},{key:"clearTimer",value:function(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}},{key:"startLoad",value:function(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}},{key:"stopLoad",value:function(){this.canLoad=!1,this.clearTimer()}},{key:"switchParams",value:function(e,t,r){var n=null==t?void 0:t.renditionReports;if(n){for(var i=-1,a=0;a<n.length;a++){var o=n[a],s=void 0;try{s=new self.URL(o.URI,t.url).href}catch(e){Ao.warn("Could not construct new URL for Rendition Report: ".concat(e)),s=o.URI||""}if(s===e){i=a;break}s===e.substring(0,s.length)&&(i=a)}if(-1!==i){var u=n[i],c=parseInt(u["LAST-MSN"])||(null==t?void 0:t.lastPartSn),d=parseInt(u["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){var l=Math.min(t.age-t.partTarget,t.targetduration);d>=0&&l>t.partTarget&&(d+=1)}var h=r&&Wu(r);return new Gu(c,d>=0?d:void 0,h)}}}},{key:"loadPlaylist",value:function(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}},{key:"shouldLoadPlaylist",value:function(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}},{key:"shouldReloadPlaylist",value:function(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)}},{key:"playlistLoaded",value:function(e,t,r){var n=this,i=t.details,a=t.stats,o=self.performance.now(),s=a.loading.first?Math.max(0,o-a.loading.first):0;if(i.advancedDateTime=Date.now()-s,i.live||null!=r&&r.live){if(i.reloaded(r),r&&this.log("live playlist ".concat(e," ").concat(i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED")),r&&i.fragments.length>0&&function(e,t){for(var r=null,n=e.fragments,i=n.length-1;i>=0;i--){var a=n[i].initSegment;if(a){r=a;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;var o,s=0;if(function(e,t,r){for(var n=t.skippedSegments,i=Math.max(e.startSN,t.startSN)-t.startSN,a=(e.fragmentHint?1:0)+(n?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,o=t.startSN-e.startSN,s=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,c=i;c<=a;c++){var d=u[o+c],l=s[c];n&&!l&&c<n&&(l=t.fragments[c]=d),d&&l&&r(d,l)}}(e,t,(function(e,n){e.relurl&&(s=e.cc-n.cc),ho(e.startPTS)&&ho(e.endPTS)&&(n.start=n.startPTS=e.startPTS,n.startDTS=e.startDTS,n.maxStartPTS=e.maxStartPTS,n.endPTS=e.endPTS,n.endDTS=e.endDTS,n.minEndPTS=e.minEndPTS,n.duration=e.endPTS-e.startPTS,n.duration&&(o=n),t.PTSKnown=t.alignedSliding=!0),n.elementaryStreams=e.elementaryStreams,n.loader=e.loader,n.stats=e.stats,e.initSegment&&(n.initSegment=e.initSegment,r=e.initSegment)})),r&&(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach((function(e){var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=r)?void 0:t.relurl)||(e.initSegment=r)})),t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some((function(e){return!e})),t.deltaUpdateFailed){Ao.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var u=t.skippedSegments;u--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=function(e,t,r){var n=lo({},e);return r&&r.forEach((function(e){delete n[e]})),Object.keys(t).forEach((function(e){var r=new wo(t[e].attr,n[e]);r.isValid?n[e]=r:Ao.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'.concat(JSON.stringify(t[e].attr),'"'))})),n}(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));var c=t.fragments;if(s){Ao.warn("discontinuity sliding from playlist, take drift into account");for(var d=0;d<c.length;d++)c[d].cc+=s}t.skippedSegments&&(t.startCC=t.fragments[0].cc),function(e,t,r){if(e&&t)for(var n=0,i=0,a=e.length;i<=a;i++){var o=e[i],s=t[i+n];o&&s&&o.index===s.index&&o.fragment.sn===s.fragment.sn?r(o,s):n--}}(e.partList,t.partList,(function(e,t){t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),o?zu(t,o,o.startPTS,o.endPTS,o.startDTS,o.endDTS):qu(e,t),c.length&&(t.totalduration=t.edge-c[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;var l=t.advancedDateTime;if(t.advanced&&l){var h=t.edge;t.driftStart||(t.driftStartTime=l,t.driftStart=h),t.driftEndTime=l,t.driftEnd=h}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}(r,i),!this.canLoad||!i.live)return;var u,c=void 0,d=void 0;if(i.canBlockReload&&i.endSN&&i.advanced){var l=this.hls.config.lowLatencyMode,h=i.lastPartSn,f=i.endSN,p=i.lastPartIndex,v=h===f;-1!==p?(c=v?f+1:h,d=v?l?0:p:p+1):c=f+1;var g=i.age,m=g+i.ageHeader,y=Math.min(m-i.partTarget,1.5*i.targetduration);if(y>0){if(r&&y>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: ".concat(r.tuneInGoal," to: ").concat(y," with playlist age: ").concat(i.age)),y=0;else{var _=Math.floor(y/i.targetduration);c+=_,void 0!==d&&(d+=Math.round(y%i.targetduration/i.partTarget)),this.log("CDN Tune-in age: ".concat(i.ageHeader,"s last advanced ").concat(g.toFixed(2),"s goal: ").concat(y," skip sn ").concat(_," to part ").concat(d))}i.tuneInGoal=y}if(u=this.getDeliveryDirectives(i,t.deliveryDirectives,c,d),l||!v)return void this.loadPlaylist(u)}else(i.canBlockReload||i.canSkipUntil)&&(u=this.getDeliveryDirectives(i,t.deliveryDirectives,c,d));var S=this.hls.mainForwardBufferInfo,A=S?S.end-S.len:0,b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,r=1e3*e.targetduration;if(e.updated){var n=e.fragments;if(n.length&&4*r>t){var i=1e3*n[n.length-1].duration;i<r&&(r=i)}}else r/=2;return Math.round(r)}(i,1e3*(i.edge-A));i.updated&&o>this.requestScheduled+b&&(this.requestScheduled=a.loading.start),void 0!==c&&i.canBlockReload?this.requestScheduled=a.loading.first+b-(1e3*i.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+b<o?this.requestScheduled=o:this.requestScheduled-o<=0&&(this.requestScheduled+=b);var E=this.requestScheduled-o;E=Math.max(0,E),this.log("reload live playlist ".concat(e," in ").concat(Math.round(E)," ms")),this.timer=self.setTimeout((function(){return n.loadPlaylist(u)}),E)}else this.clearTimer()}},{key:"getDeliveryDirectives",value:function(e,t,r,n){var i=Wu(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,n=t.part,i=""),new Gu(r,n,i)}},{key:"checkRetry",value:function(e){var t=this,r=e.details,n=$u(e),i=e.errorAction,a=i||{},o=a.action,s=a.retryCount,u=void 0===s?0:s,c=a.retryConfig,d=!!i&&!!c&&(5===o||!i.resolved&&2===o);if(d){var l;if(this.requestScheduled=-1,u>=c.maxNumRetry)return!1;if(n&&null!=(l=e.context)&&l.deliveryDirectives)this.warn("Retrying playlist loading ".concat(u+1,"/").concat(c.maxNumRetry,' after "').concat(r,'" without delivery-directives')),this.loadPlaylist();else{var h=ec(c,u);this.timer=self.setTimeout((function(){return t.loadPlaylist()}),h),this.warn("Retrying playlist loading ".concat(u+1,"/").concat(c.maxNumRetry,' after "').concat(r,'" in ').concat(h,"ms"))}e.levelRetry=!0,i.resolved=!0}return d}}]),cc=D((function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;R(this,e),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=r,this.totalWeight_=n}),[{key:"sample",value:function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}]),dc=D((function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;R(this,e),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new cc(t),this.fast_=new cc(r),this.defaultTTFB_=i,this.ttfb_=new cc(t)}),[{key:"update",value:function(e,t){var r=this.slow_,n=this.fast_,i=this.ttfb_;r.halfLife!==e&&(this.slow_=new cc(e,r.getEstimate(),r.getTotalWeight())),n.halfLife!==t&&(this.fast_=new cc(t,n.getEstimate(),n.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new cc(e,i.getEstimate(),i.getTotalWeight()))}},{key:"sample",value:function(e,t){var r=(e=Math.max(e,this.minDelayMs_))/1e3,n=8*t/r;this.fast_.sample(r,n),this.slow_.sample(r,n)}},{key:"sampleTTFB",value:function(e){var t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}},{key:"canEstimate",value:function(){return this.fast_.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"getEstimateTTFB",value:function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}},{key:"destroy",value:function(){}}]),lc={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},hc={};function fc(e,t){Ao.log('[abr] start candidates with "'.concat(e,'" ignored because ').concat(t))}function pc(e,t,r){if("attrs"in e){var n=t.indexOf(e);if(-1!==n)return n}for(var i=0;i<t.length;i++)if(vc(e,t[i],r))return i;return-1}function vc(e,t,r){var n=e.groupId,i=e.name,a=e.lang,o=e.assocLang,s=e.characteristics,u=e.default,c=e.forced;return(void 0===n||t.groupId===n)&&(void 0===i||t.name===i)&&(void 0===a||t.lang===a)&&(void 0===a||t.assocLang===o)&&(void 0===u||t.default===u)&&(void 0===c||t.forced===c)&&(void 0===s||function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=e.split(","),n=t.split(",");return r.length===n.length&&!r.some((function(e){return-1===n.indexOf(e)}))}(s,t.characteristics))&&(void 0===r||r(e,t))}function gc(e,t){var r=e.audioCodec,n=e.channels;return!(void 0!==r&&(t.audioCodec||"").substring(0,4)!==r.substring(0,4)||void 0!==n&&n!==(t.channels||"2"))}function mc(e,t,r){for(var n=t;n>-1;n--)if(r(e[n]))return n;for(var i=t+1;i<e.length;i++)if(r(e[i]))return i;return-1}var yc=D((function e(t){var r=this;R(this,e),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=function(){var e=r.fragCurrent,t=r.partCurrent,n=r.hls,i=n.autoLevelEnabled,a=n.media;if(e&&a){var o=performance.now(),s=t?t.stats:e.stats,u=t?t.duration:e.duration,c=o-s.loading.start,d=n.minAutoLevel;if(s.aborted||s.loaded&&s.loaded===s.total||e.level<=d)return r.clearTimer(),void(r._nextAutoLevel=-1);if(i&&!a.paused&&a.playbackRate&&a.readyState){var l=n.mainForwardBufferInfo;if(null!==l){var h=r.bwEstimator.getEstimateTTFB(),f=Math.abs(a.playbackRate);if(!(c<=Math.max(h,u/(2*f)*1e3))){var p=l.len/f,v=s.loading.first?s.loading.first-s.loading.start:-1,g=s.loaded&&v>-1,m=r.getBwEstimate(),y=n.levels,_=y[e.level],S=s.total||Math.max(s.loaded,Math.round(u*_.averageBitrate/8)),A=g?c-v:c;A<1&&g&&(A=Math.min(c,8*s.loaded/m));var b=g?1e3*s.loaded/A:0,E=b?(S-s.loaded)/b:8*S/m+h/1e3;if(!(E<=p)){var k,C=b?8*b:m,w=Number.POSITIVE_INFINITY;for(k=e.level-1;k>d;k--){var T=y[k].maxBitrate;if((w=r.getTimeToLoadFrag(h/1e3,C,u*T,!y[k].details))<p)break}if(!(w>=E||w>10*u)){n.nextLoadLevel=n.nextAutoLevel=k,g?r.bwEstimator.sample(c-Math.min(h,v),s.loaded):r.bwEstimator.sampleTTFB(c);var R=y[k].maxBitrate;r.getBwEstimate()*r.hls.config.abrBandWidthUpFactor>R&&r.resetEstimator(R),r.clearTimer(),Ao.warn("[abr] Fragment ".concat(e.sn).concat(t?" part "+t.index:""," of level ").concat(e.level," is loading too slowly;\n      Time to underbuffer: ").concat(p.toFixed(3)," s\n      Estimated load time for current fragment: ").concat(E.toFixed(3)," s\n      Estimated load time for down switch fragment: ").concat(w.toFixed(3)," s\n      TTFB estimate: ").concat(0|v," ms\n      Current BW estimate: ").concat(ho(m)?0|m:"Unknown"," bps\n      New BW estimate: ").concat(0|r.getBwEstimate()," bps\n      Switching to level ").concat(k," @ ").concat(0|R," bps")),n.trigger(vo.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:s})}}}}}}},this.hls=t,this.bwEstimator=this.initEstimator(),this.registerListeners()}),[{key:"resetEstimator",value:function(e){e&&(Ao.log("setting initial bwe to ".concat(e)),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}},{key:"initEstimator",value:function(){var e=this.hls.config;return new dc(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}},{key:"registerListeners",value:function(){var e=this.hls;e.on(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.on(vo.FRAG_LOADING,this.onFragLoading,this),e.on(vo.FRAG_LOADED,this.onFragLoaded,this),e.on(vo.FRAG_BUFFERED,this.onFragBuffered,this),e.on(vo.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(vo.LEVEL_LOADED,this.onLevelLoaded,this),e.on(vo.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(vo.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(vo.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e&&(e.off(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.off(vo.FRAG_LOADING,this.onFragLoading,this),e.off(vo.FRAG_LOADED,this.onFragLoaded,this),e.off(vo.FRAG_BUFFERED,this.onFragBuffered,this),e.off(vo.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(vo.LEVEL_LOADED,this.onLevelLoaded,this),e.off(vo.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(vo.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(vo.ERROR,this.onError,this))}},{key:"destroy",value:function(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}},{key:"onManifestLoading",value:function(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}},{key:"onLevelsUpdated",value:function(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}},{key:"onMaxAutoLevelUpdated",value:function(){this.firstSelection=-1,this.nextAutoLevelKey=""}},{key:"onFragLoading",value:function(e,t){var r,n=t.frag;this.ignoreFragment(n)||(n.bitrateTest||(this.fragCurrent=n,this.partCurrent=null!=(r=t.part)?r:null),this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100))}},{key:"onLevelSwitching",value:function(e,t){this.clearTimer()}},{key:"onError",value:function(e,t){if(!t.fatal)switch(t.details){case mo.BUFFER_ADD_CODEC_ERROR:case mo.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case mo.FRAG_LOAD_TIMEOUT:var r=t.frag,n=this.fragCurrent,i=this.partCurrent;if(r&&n&&r.sn===n.sn&&r.level===n.level){var a=performance.now(),o=i?i.stats:r.stats,s=a-o.loading.start,u=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&u>-1){var c=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(s-Math.min(c,u),o.loaded)}else this.bwEstimator.sampleTTFB(s)}}}},{key:"getTimeToLoadFrag",value:function(e,t,r,n){return e+r/t+(n?this.lastLevelLoadSec:0)}},{key:"onLevelLoaded",value:function(e,t){var r=this.hls.config,n=t.stats.loading,i=n.end-n.start;ho(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)}},{key:"onFragLoaded",value:function(e,t){var r=t.frag,n=t.part,i=n?n.stats:r.stats;if(r.type===Su&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(r)){if(this.clearTimer(),r.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){var a=n?n.duration:r.duration,o=this.hls.levels[r.level],s=(o.loaded?o.loaded.bytes:0)+i.loaded,u=(o.loaded?o.loaded.duration:0)+a;o.loaded={bytes:s,duration:u},o.realBitrate=Math.round(8*s/u)}if(r.bitrateTest){var c={stats:i,frag:r,part:n,id:r.type};this.onFragBuffered(vo.FRAG_BUFFERED,c),r.bitrateTest=!1}else this.lastLoadedFragLevel=r.level}}},{key:"onFragBuffered",value:function(e,t){var r=t.frag,n=t.part,i=null!=n&&n.stats.loaded?n.stats:r.stats;if(!i.aborted&&!this.ignoreFragment(r)){var a=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,i.loaded),i.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}}},{key:"ignoreFragment",value:function(e){return e.type!==Su||"initSegment"===e.sn}},{key:"clearTimer",value:function(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}},{key:"firstAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,r=e.minAutoLevel,n=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,a=this.findBestLevel(n,r,t,0,i,1,1);if(a>-1)return a;var o=this.hls.firstLevel,s=Math.min(Math.max(o,r),t);return Ao.warn("[abr] Could not find best starting auto level. Defaulting to first in playlist ".concat(o," clamped to ").concat(s)),s}},{key:"forcedAutoLevel",get:function(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}},{key:"nextAutoLevel",get:function(){var e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(!(-1===e||t&&r&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return e;var n=t&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){var i=this.hls.levels;if(i.length>Math.max(e,n)&&i[e].loadError<=i[n].loadError)return e}return this._nextAutoLevel=n,this.nextAutoLevelKey=this.getAutoLevelKey(),n},set:function(e){var t=this.hls,r=t.maxAutoLevel,n=t.minAutoLevel,i=Math.min(Math.max(e,n),r);this._nextAutoLevel!==i&&(this.nextAutoLevelKey="",this._nextAutoLevel=i)}},{key:"getAutoLevelKey",value:function(){return"".concat(this.getBwEstimate(),"_").concat(this.getStarvationDelay().toFixed(2))}},{key:"getNextABRAutoLevel",value:function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,n=r.maxAutoLevel,i=r.config,a=r.minAutoLevel,o=t?t.duration:e?e.duration:0,s=this.getBwEstimate(),u=this.getStarvationDelay(),c=i.abrBandWidthFactor,d=i.abrBandWidthUpFactor;if(u){var l=this.findBestLevel(s,a,n,u,0,c,d);if(l>=0)return l}var h=o?Math.min(o,i.maxStarvationDelay):i.maxStarvationDelay;if(!u){var f=this.bitrateTestDelay;f&&(h=(o?Math.min(o,i.maxLoadingDelay):i.maxLoadingDelay)-f,Ao.info("[abr] bitrate test took ".concat(Math.round(1e3*f),"ms, set first fragment max fetchDuration to ").concat(Math.round(1e3*h)," ms")),c=d=1)}var p=this.findBestLevel(s,a,n,u,h,c,d);if(Ao.info("[abr] ".concat(u?"rebuffering expected":"buffer is empty",", optimal quality level ").concat(p)),p>-1)return p;var v=r.levels[a],g=r.levels[r.loadLevel];return(null==v?void 0:v.bitrate)<(null==g?void 0:g.bitrate)?a:r.loadLevel}},{key:"getStarvationDelay",value:function(){var e=this.hls,t=e.media;if(!t)return 1/0;var r=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,n=e.mainForwardBufferInfo;return(n?n.len:0)/r}},{key:"getBwEstimate",value:function(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}},{key:"findBestLevel",value:function(e,t,r,n,i,a,o){var s,u=this,c=n+i,d=this.lastLoadedFragLevel,l=-1===d?this.hls.firstLevel:d,h=this.fragCurrent,f=this.partCurrent,p=this.hls,v=p.levels,g=p.allAudioTracks,m=p.loadLevel,y=p.config;if(1===v.length)return 0;var _,S=v[l],A=!(null==S||null==(s=S.details)||!s.live),b=-1===m||-1===d,E="SDR",k=(null==S?void 0:S.frameRate)||0,C=y.audioPreference,w=y.videoPreference,T=this.audioTracksByGroup||(this.audioTracksByGroup=function(e){return e.reduce((function(e,t){var r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);var n=t.channels||"2";return r.channels[n]=(r.channels[n]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e}),{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}(g));if(b){if(-1!==this.firstSelection)return this.firstSelection;var R=this.codecTiers||(this.codecTiers=function(e,t,r,n){return e.slice(r,n+1).reduce((function(e,r){if(!r.codecSet)return e;var n=r.audioGroups,i=e[r.codecSet];i||(e[r.codecSet]=i={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!n,fragmentError:0}),i.minBitrate=Math.min(i.minBitrate,r.bitrate);var a=Math.min(r.height,r.width);return i.minHeight=Math.min(i.minHeight,a),i.minFramerate=Math.min(i.minFramerate,r.frameRate),i.maxScore=Math.max(i.maxScore,r.score),i.fragmentError+=r.fragmentError,i.videoRanges[r.videoRange]=(i.videoRanges[r.videoRange]||0)+1,n&&n.forEach((function(e){if(e){var r=t.groups[e];r&&(i.hasDefaultAudio=i.hasDefaultAudio||t.hasDefaultAudio?r.hasDefault:r.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(r.channels).forEach((function(e){i.channels[e]=(i.channels[e]||0)+r.channels[e]})))}})),e}),{})}(v,T,t,r)),I=function(e,t,r,n,i){for(var a=Object.keys(e),o=null==n?void 0:n.channels,s=null==n?void 0:n.audioCodec,u=o&&2===parseInt(o),c=!0,d=!1,l=1/0,h=1/0,f=1/0,p=0,v=[],g=function(e,t){var r=!1,n=[];return e&&(r="SDR"!==e,n=[e]),t&&(n=t.allowedVideoRanges||Bu.slice(0),n=(r=void 0!==t.preferHDR?t.preferHDR:function(){if("function"==typeof matchMedia){var e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}())?n.filter((function(e){return"SDR"!==e})):["SDR"]),{preferHDR:r,allowedVideoRanges:n}}(t,i),m=g.preferHDR,y=g.allowedVideoRanges,_=function(){var t=e[a[S]];c=t.channels[2]>0,l=Math.min(l,t.minHeight),h=Math.min(h,t.minFramerate),f=Math.min(f,t.minBitrate);var r=y.filter((function(e){return t.videoRanges[e]>0}));r.length>0&&(d=!0,v=r)},S=a.length;S--;)_();l=ho(l)?l:0,h=ho(h)?h:0;var A=Math.max(1080,l),b=Math.max(30,h);return f=ho(f)?f:r,r=Math.max(f,r),d||(t=void 0,v=[]),{codecSet:a.reduce((function(t,n){var i=e[n];if(n===t)return t;if(i.minBitrate>r)return fc(n,"min bitrate of ".concat(i.minBitrate," > current estimate of ").concat(r)),t;if(!i.hasDefaultAudio)return fc(n,"no renditions with default or auto-select sound found"),t;if(s&&n.indexOf(s.substring(0,4))%5!=0)return fc(n,'audio codec preference "'.concat(s,'" not found')),t;if(o&&!u){if(!i.channels[o])return fc(n,"no renditions with ".concat(o," channel sound found (channels options: ").concat(Object.keys(i.channels),")")),t}else if((!s||u)&&c&&0===i.channels[2])return fc(n,"no renditions with stereo sound found"),t;return i.minHeight>A?(fc(n,"min resolution of ".concat(i.minHeight," > maximum of ").concat(A)),t):i.minFramerate>b?(fc(n,"min framerate of ".concat(i.minFramerate," > maximum of ").concat(b)),t):v.some((function(e){return i.videoRanges[e]>0}))?i.maxScore<p?(fc(n,"max score of ".concat(i.maxScore," < selected max of ").concat(p)),t):t&&($s(n)>=$s(t)||i.fragmentError>e[t].fragmentError)?t:(p=i.maxScore,n):(fc(n,"no variants with VIDEO-RANGE of ".concat(JSON.stringify(v)," found")),t)}),void 0),videoRanges:v,preferHDR:m,minFramerate:h,minBitrate:f}}(R,E,e,C,w),D=I.codecSet,M=I.videoRanges,O=I.minFramerate,x=I.minBitrate,P=I.preferHDR;_=D,E=P?M[M.length-1]:M[0],k=O,e=Math.max(e,x),Ao.log("[abr] picked start tier ".concat(JSON.stringify(I)))}else _=null==S?void 0:S.codecSet,E=null==S?void 0:S.videoRange;for(var L,N,V=f?f.duration:h?h.duration:0,U=this.bwEstimator.getEstimateTTFB()/1e3,F=[],B=function(){var t=v[W],s=W>l;if(!t)return 0;if(y.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){var h=navigator.mediaCapabilities;"function"==typeof(null==h?void 0:h.decodingInfo)&&function(e,t,r,n,i,a){var o=e.audioCodec?e.audioGroups:null,s=null==a?void 0:a.audioCodec,u=null==a?void 0:a.channels,c=u?parseInt(u):s?1/0:2,d=null;if(null!=o&&o.length)try{d=1===o.length&&o[0]?t.groups[o[0]].channels:o.reduce((function(e,r){if(r){var n=t.groups[r];if(!n)throw new Error("Audio track group ".concat(r," not found"));Object.keys(n.channels).forEach((function(t){e[t]=(e[t]||0)+n.channels[t]}))}return e}),{2:0})}catch(e){return!0}return void 0!==e.videoCodec&&(e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(n,30)||"SDR"!==e.videoRange&&e.videoRange!==r||e.bitrate>Math.max(i,8e6))||!!d&&ho(c)&&Object.keys(d).some((function(e){return parseInt(e)>c}))}(t,T,E,k,e,C)?(t.supportedPromise=function(e,t,r){var n=e.videoCodec,i=e.audioCodec;if(!n||!i||!r)return Promise.resolve(lc);var a={width:e.width,height:e.height,bitrate:Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)),framerate:e.frameRate||30},o=e.videoRange;"SDR"!==o&&(a.transferFunction=o.toLowerCase());var s=n.split(",").map((function(e){return{type:"media-source",video:uo(uo({},a),{},{contentType:Qs(e,"video")})}}));return i&&e.audioGroups&&e.audioGroups.forEach((function(e){var r;e&&(null==(r=t.groups[e])||r.tracks.forEach((function(t){if(t.groupId===e){var r=t.channels||"",n=parseFloat(r);ho(n)&&n>2&&s.push.apply(s,i.split(",").map((function(e){return{type:"media-source",audio:{contentType:Qs(e,"audio"),channels:""+n}}})))}})))})),Promise.all(s.map((function(e){var t=function(e){var t=e.audio,r=e.video,n=r||t;if(n){var i=n.contentType.split('"')[1];if(r)return"r".concat(r.height,"x").concat(r.width,"f").concat(Math.ceil(r.framerate)).concat(r.transferFunction||"sd","_").concat(i,"_").concat(Math.ceil(r.bitrate/1e5));if(t)return"c".concat(t.channels).concat(t.spatialRendering?"s":"n","_").concat(i)}return""}(e);return hc[t]||(hc[t]=r.decodingInfo(e))}))).then((function(e){return{supported:!e.some((function(e){return!e.supported})),configurations:s,decodingInfoResults:e}})).catch((function(e){return{supported:!1,configurations:s,decodingInfoResults:[],error:e}}))}(t,T,h),t.supportedPromise.then((function(e){if(u.hls){t.supportedResult=e;var r=u.hls.levels,n=r.indexOf(t);e.error?Ao.warn('[abr] MediaCapabilities decodingInfo error: "'.concat(e.error,'" for level ').concat(n," ").concat(JSON.stringify(e))):e.supported||(Ao.warn("[abr] Unsupported MediaCapabilities decodingInfo result for level ".concat(n," ").concat(JSON.stringify(e))),n>-1&&r.length>1&&(Ao.log("[abr] Removing unsupported level ".concat(n)),u.hls.removeLevel(n)))}}))):t.supportedResult=lc}if(_&&t.codecSet!==_||E&&t.videoRange!==E||s&&k>t.frameRate||!s&&k>0&&k<t.frameRate||t.supportedResult&&(null==(L=t.supportedResult.decodingInfoResults)||!L[0].smooth))return F.push(W),0;var p,g=t.details,w=(f?null==g?void 0:g.partTarget:null==g?void 0:g.averagetargetduration)||V;p=s?o*e:a*e;var R=V&&n>=2*V&&0===i?v[W].averageBitrate:v[W].maxBitrate,I=u.getTimeToLoadFrag(U,p,R*w,void 0===g);if(p>=R&&(W===d||0===t.loadError&&0===t.fragmentError)&&(I<=U||!ho(I)||A&&!u.bitrateTestDelay||I<c)){var D=u.forcedAutoLevel;return W===m||-1!==D&&D===m||(F.length&&Ao.trace("[abr] Skipped level(s) ".concat(F.join(",")," of ").concat(r,' max with CODECS and VIDEO-RANGE:"').concat(v[F[0]].codecs,'" ').concat(v[F[0]].videoRange,'; not compatible with "').concat(S.codecs,'" ').concat(E)),Ao.info("[abr] switch candidate:".concat(l,"->").concat(W," adjustedbw(").concat(Math.round(p),")-bitrate=").concat(Math.round(p-R)," ttfb:").concat(U.toFixed(1)," avgDuration:").concat(w.toFixed(1)," maxFetchDuration:").concat(c.toFixed(1)," fetchDuration:").concat(I.toFixed(1)," firstSelection:").concat(b," codecSet:").concat(_," videoRange:").concat(E," hls.loadLevel:").concat(m))),b&&(u.firstSelection=W),{v:W}}},W=r;W>=t;W--)if(0!==(N=B())&&N)return N.v;return-1}}]),_c=D((function e(){R(this,e),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}),[{key:"destroy",value:function(){this.onHandlerDestroying(),this.onHandlerDestroyed()}},{key:"onHandlerDestroying",value:function(){this.clearNextTick(),this.clearInterval()}},{key:"onHandlerDestroyed",value:function(){}},{key:"hasInterval",value:function(){return!!this._tickInterval}},{key:"hasNextTick",value:function(){return!!this._tickTimer}},{key:"setInterval",value:function(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}},{key:"clearInterval",value:function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}},{key:"clearNextTick",value:function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}},{key:"tick",value:function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}},{key:"tickImmediate",value:function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}},{key:"doTick",value:function(){}}]),Sc="NOT_LOADED",Ac="APPENDING",bc="PARTIAL",Ec="OK",kc=D((function e(t){R(this,e),this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}),[{key:"_registerListeners",value:function(){var e=this.hls;e.on(vo.BUFFER_APPENDED,this.onBufferAppended,this),e.on(vo.FRAG_BUFFERED,this.onFragBuffered,this),e.on(vo.FRAG_LOADED,this.onFragLoaded,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(vo.BUFFER_APPENDED,this.onBufferAppended,this),e.off(vo.FRAG_BUFFERED,this.onFragBuffered,this),e.off(vo.FRAG_LOADED,this.onFragLoaded,this)}},{key:"destroy",value:function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}},{key:"getAppendedFrag",value:function(e,t){var r=this.activePartLists[t];if(r)for(var n=r.length;n--;){var i=r[n];if(!i)break;var a=i.end;if(i.start<=e&&null!==a&&e<=a)return i}return this.getBufferedFrag(e,t)}},{key:"getBufferedFrag",value:function(e,t){for(var r=this.fragments,n=Object.keys(r),i=n.length;i--;){var a=r[n[i]];if((null==a?void 0:a.body.type)===t&&a.buffered){var o=a.body;if(o.start<=e&&e<=o.end)return o}}return null}},{key:"detectEvictedFragments",value:function(e,t,r,n){var i=this;this.timeRanges&&(this.timeRanges[e]=t);var a=(null==n?void 0:n.fragment.sn)||-1;Object.keys(this.fragments).forEach((function(n){var o=i.fragments[n];if(o&&!(a>=o.body.sn))if(o.buffered||o.loaded){var s=o.range[e];s&&s.time.some((function(e){var r=!i.isTimeBuffered(e.startPTS,e.endPTS,t);return r&&i.removeFragment(o.body),r}))}else o.body.type===r&&i.removeFragment(o.body)}))}},{key:"detectPartialFragments",value:function(e){var t=this,r=this.timeRanges,n=e.frag,i=e.part;if(r&&"initSegment"!==n.sn){var a=wc(n),o=this.fragments[a];if(!(!o||o.buffered&&n.gap)){var s=!n.relurl;Object.keys(r).forEach((function(e){var a=n.elementaryStreams[e];if(a){var u=r[e],c=s||!0===a.partial;o.range[e]=t.getBufferedTimes(n,i,c,u)}})),o.loaded=null,Object.keys(o.range).length?(o.buffered=!0,(o.body.endList=n.endList||o.body.endList)&&(this.endListFragments[o.body.type]=o),Cc(o)||this.removeParts(n.sn-1,n.type)):this.removeFragment(o.body)}}}},{key:"removeParts",value:function(e,t){var r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter((function(t){return t.fragment.sn>=e})))}},{key:"fragBuffered",value:function(e,t){var r=wc(e),n=this.fragments[r];!n&&t&&(n=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,n.buffered=!0)}},{key:"getBufferedTimes",value:function(e,t,r,n){for(var i={time:[],partial:r},a=e.start,o=e.end,s=e.minEndPTS||o,u=e.maxStartPTS||a,c=0;c<n.length;c++){var d=n.start(c)-this.bufferPadding,l=n.end(c)+this.bufferPadding;if(u>=d&&s<=l){i.time.push({startPTS:Math.max(a,n.start(c)),endPTS:Math.min(o,n.end(c))});break}if(a<l&&o>d){var h=Math.max(a,n.start(c)),f=Math.min(o,n.end(c));f>h&&(i.partial=!0,i.time.push({startPTS:h,endPTS:f}))}else if(o<=d)break}return i}},{key:"getPartialFragment",value:function(e){var t,r,n,i=null,a=0,o=this.bufferPadding,s=this.fragments;return Object.keys(s).forEach((function(u){var c=s[u];c&&Cc(c)&&(r=c.body.start-o,n=c.body.end+o,e>=r&&e<=n&&(t=Math.min(e-r,n-e),a<=t&&(i=c.body,a=t)))})),i}},{key:"isEndListAppended",value:function(e){var t=this.endListFragments[e];return void 0!==t&&(t.buffered||Cc(t))}},{key:"getState",value:function(e){var t=wc(e),r=this.fragments[t];return r?r.buffered?Cc(r)?bc:Ec:Ac:Sc}},{key:"isTimeBuffered",value:function(e,t,r){for(var n,i,a=0;a<r.length;a++){if(n=r.start(a)-this.bufferPadding,i=r.end(a)+this.bufferPadding,e>=n&&t<=i)return!0;if(t<=n)return!1}return!1}},{key:"onFragLoaded",value:function(e,t){var r=t.frag,n=t.part;if("initSegment"!==r.sn&&!r.bitrateTest){var i=n?null:t,a=wc(r);this.fragments[a]={body:r,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}}},{key:"onBufferAppended",value:function(e,t){var r=this,n=t.frag,i=t.part,a=t.timeRanges;if("initSegment"!==n.sn){var o=n.type;if(i){var s=this.activePartLists[o];s||(this.activePartLists[o]=s=[]),s.push(i)}this.timeRanges=a,Object.keys(a).forEach((function(e){var t=a[e];r.detectEvictedFragments(e,t,o,i)}))}}},{key:"onFragBuffered",value:function(e,t){this.detectPartialFragments(t)}},{key:"hasFragment",value:function(e){var t=wc(e);return!!this.fragments[t]}},{key:"hasParts",value:function(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}},{key:"removeFragmentsInRange",value:function(e,t,r,n,i){var a=this;n&&!this.hasGaps||Object.keys(this.fragments).forEach((function(o){var s=a.fragments[o];if(s){var u=s.body;u.type!==r||n&&!u.gap||u.start<t&&u.end>e&&(s.buffered||i)&&a.removeFragment(u)}}))}},{key:"removeFragment",value:function(e){var t=wc(e);e.stats.loaded=0,e.clearElementaryStreamInfo();var r=this.activePartLists[e.type];if(r){var n=e.sn;this.activePartLists[e.type]=r.filter((function(e){return e.fragment.sn!==n}))}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}},{key:"removeAllFragments",value:function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}]);function Cc(e){var t,r,n;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(r=e.range.audio)?void 0:r.partial)||(null==(n=e.range.audiovideo)?void 0:n.partial))}function wc(e){return"".concat(e.type,"_").concat(e.level,"_").concat(e.sn)}var Tc={length:0,start:function(){return 0},end:function(){return 0}},Rc=function(){function e(){R(this,e)}return D(e,null,[{key:"isBuffered",value:function(t,r){try{if(t)for(var n=e.getBuffered(t),i=0;i<n.length;i++)if(r>=n.start(i)&&r<=n.end(i))return!0}catch(e){}return!1}},{key:"bufferInfo",value:function(t,r,n){try{if(t){var i,a=e.getBuffered(t),o=[];for(i=0;i<a.length;i++)o.push({start:a.start(i),end:a.end(i)});return this.bufferedInfo(o,r,n)}}catch(e){}return{len:0,start:r,end:r,nextStart:void 0}}},{key:"bufferedInfo",value:function(e,t,r){t=Math.max(0,t),e.sort((function(e,t){return e.start-t.start||t.end-e.end}));var n=[];if(r)for(var i=0;i<e.length;i++){var a=n.length;if(a){var o=n[a-1].end;e[i].start-o<r?e[i].end>o&&(n[a-1].end=e[i].end):n.push(e[i])}else n.push(e[i])}else n=e;for(var s,u=0,c=t,d=t,l=0;l<n.length;l++){var h=n[l].start,f=n[l].end;if(t+r>=h&&t<f)c=h,u=(d=f)-t;else if(t+r<h){s=h;break}}return{len:u,start:c||0,end:d||0,nextStart:s}}},{key:"getBuffered",value:function(e){try{return e.buffered}catch(e){return Ao.log("failed to get media.buffered",e),Tc}}}])}(),Ic=D((function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];R(this,e),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=t,this.sn=r,this.id=n,this.size=i,this.part=a,this.partial=o}));function Dc(e,t){for(var r=0,n=e.length;r<n;r++){var i;if((null==(i=e[r])?void 0:i.cc)===t)return e[r]}return null}function Mc(e,t){if(e){var r=e.start+t;e.start=e.startPTS=r,e.endPTS=r+e.duration}}function Oc(e,t){for(var r=t.fragments,n=0,i=r.length;n<i;n++)Mc(r[n],e);t.fragmentHint&&Mc(t.fragmentHint,e),t.alignedSliding=!0}function xc(e,t){if(e.hasProgramDateTime&&t.hasProgramDateTime){var r=e.fragments,n=t.fragments;if(r.length&&n.length){var i,a,o=Math.min(t.endCC,e.endCC);t.startCC<o&&e.startCC<o&&(i=Dc(n,o),a=Dc(r,o)),i&&a||(a=Dc(r,(i=n[Math.floor(n.length/2)]).cc)||r[Math.floor(r.length/2)]);var s=i.programDateTime,u=a.programDateTime;s&&u&&Oc((u-s)/1e3-(a.start-i.start),e)}}}var Pc=Math.pow(2,17),Lc=D((function e(t){R(this,e),this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}),[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null)}},{key:"abort",value:function(){this.loader&&this.loader.abort()}},{key:"load",value:function(e,t){var r=this,n=e.url;if(!n)return Promise.reject(new Uc({type:go.NETWORK_ERROR,details:mo.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a ".concat(n?"part list":"url")),networkDetails:null}));this.abort();var i=this.config,a=i.fLoader,o=i.loader;return new Promise((function(s,u){if(r.loader&&r.loader.destroy(),e.gap){if(e.tagList.some((function(e){return"GAP"===e[0]})))return void u(Vc(e));e.gap=!1}var c=r.loader=e.loader=a?new a(i):new o(i),d=Nc(e),l=tc(i.fragLoadPolicy.default),h={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:Pc};e.stats=c.stats,c.load(d,h,{onSuccess:function(t,n,i,a){r.resetLoader(e,c);var o=t.data;i.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(o.slice(0,16)),o=o.slice(16)),s({frag:e,part:null,payload:o,networkDetails:a})},onError:function(t,i,a,o){r.resetLoader(e,c),u(new Uc({type:go.NETWORK_ERROR,details:mo.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:uo({url:n,data:void 0},t),error:new Error("HTTP Error ".concat(t.code," ").concat(t.text)),networkDetails:a,stats:o}))},onAbort:function(t,n,i){r.resetLoader(e,c),u(new Uc({type:go.NETWORK_ERROR,details:mo.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:i,stats:t}))},onTimeout:function(t,n,i){r.resetLoader(e,c),u(new Uc({type:go.NETWORK_ERROR,details:mo.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after ".concat(h.timeout,"ms")),networkDetails:i,stats:t}))},onProgress:function(r,n,i,a){t&&t({frag:e,part:null,payload:i,networkDetails:a})}})}))}},{key:"loadPart",value:function(e,t,r){var n=this;this.abort();var i=this.config,a=i.fLoader,o=i.loader;return new Promise((function(s,u){if(n.loader&&n.loader.destroy(),e.gap||t.gap)u(Vc(e,t));else{var c=n.loader=e.loader=a?new a(i):new o(i),d=Nc(e,t),l=tc(i.fragLoadPolicy.default),h={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Pc};t.stats=c.stats,c.load(d,h,{onSuccess:function(i,a,o,u){n.resetLoader(e,c),n.updateStatsFromPart(e,t);var d={frag:e,part:t,payload:i.data,networkDetails:u};r(d),s(d)},onError:function(r,i,a,o){n.resetLoader(e,c),u(new Uc({type:go.NETWORK_ERROR,details:mo.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:uo({url:d.url,data:void 0},r),error:new Error("HTTP Error ".concat(r.code," ").concat(r.text)),networkDetails:a,stats:o}))},onAbort:function(r,i,a){e.stats.aborted=t.stats.aborted,n.resetLoader(e,c),u(new Uc({type:go.NETWORK_ERROR,details:mo.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:a,stats:r}))},onTimeout:function(r,i,a){n.resetLoader(e,c),u(new Uc({type:go.NETWORK_ERROR,details:mo.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error("Timeout after ".concat(h.timeout,"ms")),networkDetails:a,stats:r}))}})}}))}},{key:"updateStatsFromPart",value:function(e,t){var r=e.stats,n=t.stats,i=n.total;if(r.loaded+=n.loaded,i){var a=Math.round(e.duration/t.duration),o=Math.min(Math.round(r.loaded/i),a),s=(a-o)*Math.round(r.loaded/o);r.total=r.loaded+s}else r.total=Math.max(r.loaded,r.total);var u=r.loading,c=n.loading;u.start?u.first+=c.first-c.start:(u.start=c.start,u.first=c.first),u.end=c.end}},{key:"resetLoader",value:function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}]);function Nc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=t||e,n={frag:e,part:t,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},i=r.byteRangeStartOffset,a=r.byteRangeEndOffset;if(ho(i)&&ho(a)){var o,s=i,u=a;if("initSegment"===e.sn&&"AES-128"===(null==(o=e.decryptdata)?void 0:o.method)){var c=a-i;c%16&&(u=a+(16-c%16)),0!==i&&(n.resetIV=!0,s=i-16)}n.rangeStart=s,n.rangeEnd=u}return n}function Vc(e,t){var r=new Error("GAP ".concat(e.gap?"tag":"attribute"," found")),n={type:go.MEDIA_ERROR,details:mo.FRAG_GAP,fatal:!1,frag:e,error:r,networkDetails:null};return t&&(n.part=t),(t||e).stats.aborted=!0,new Uc(n)}var Uc=function(){function e(t){var r;return R(this,e),(r=c(this,e,[t.error.message])).data=void 0,r.data=t,r}return f(e,o(Error)),D(e)}(),Fc=D((function e(t,r){R(this,e),this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=r}),[{key:"decrypt",value:function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}]),Bc=D((function e(t,r){R(this,e),this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=r}),[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),Wc=D((function e(){R(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}),[{key:"uint8ArrayToUint32Array_",value:function(e){for(var t=new DataView(e),r=new Uint32Array(4),n=0;n<4;n++)r[n]=t.getUint32(4*n);return r}},{key:"initTable",value:function(){var e=this.sBox,t=this.invSBox,r=this.subMix,n=r[0],i=r[1],a=r[2],o=r[3],s=this.invSubMix,u=s[0],c=s[1],d=s[2],l=s[3],h=new Uint32Array(256),f=0,p=0,v=0;for(v=0;v<256;v++)h[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var g=p^p<<1^p<<2^p<<3^p<<4;g=g>>>8^255&g^99,e[f]=g,t[g]=f;var m=h[f],y=h[m],_=h[y],S=257*h[g]^16843008*g;n[f]=S<<24|S>>>8,i[f]=S<<16|S>>>16,a[f]=S<<8|S>>>24,o[f]=S,S=16843009*_^65537*y^257*m^16843008*f,u[g]=S<<24|S>>>8,c[g]=S<<16|S>>>16,d[g]=S<<8|S>>>24,l[g]=S,f?(f=m^h[h[h[_^m]]],p^=h[h[p]]):f=p=1}}},{key:"expandKey",value:function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,n=0;n<t.length&&r;)r=t[n]===this.key[n],n++;if(!r){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var a,o,s,u,c=this.ksRows=4*(i+6+1),d=this.keySchedule=new Uint32Array(c),l=this.invKeySchedule=new Uint32Array(c),h=this.sBox,f=this.rcon,p=this.invSubMix,v=p[0],g=p[1],m=p[2],y=p[3];for(a=0;a<c;a++)a<i?s=d[a]=t[a]:(u=s,a%i==0?(u=h[(u=u<<8|u>>>24)>>>24]<<24|h[u>>>16&255]<<16|h[u>>>8&255]<<8|h[255&u],u^=f[a/i|0]<<24):i>6&&a%i==4&&(u=h[u>>>24]<<24|h[u>>>16&255]<<16|h[u>>>8&255]<<8|h[255&u]),d[a]=s=(d[a-i]^u)>>>0);for(o=0;o<c;o++)a=c-o,u=3&o?d[a]:d[a-4],l[o]=o<4||a<=4?u:v[h[u>>>24]]^g[h[u>>>16&255]]^m[h[u>>>8&255]]^y[h[255&u]],l[o]=l[o]>>>0}}},{key:"networkToHostOrderSwap",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"decrypt",value:function(e,t,r){for(var n,i,a,o,s,u,c,d,l,h,f,p,v,g,m=this.keySize+6,y=this.invKeySchedule,_=this.invSBox,S=this.invSubMix,A=S[0],b=S[1],E=S[2],k=S[3],C=this.uint8ArrayToUint32Array_(r),w=C[0],T=C[1],R=C[2],I=C[3],D=new Int32Array(e),M=new Int32Array(D.length),O=this.networkToHostOrderSwap;t<D.length;){for(l=O(D[t]),h=O(D[t+1]),f=O(D[t+2]),p=O(D[t+3]),s=l^y[0],u=p^y[1],c=f^y[2],d=h^y[3],v=4,g=1;g<m;g++)n=A[s>>>24]^b[u>>16&255]^E[c>>8&255]^k[255&d]^y[v],i=A[u>>>24]^b[c>>16&255]^E[d>>8&255]^k[255&s]^y[v+1],a=A[c>>>24]^b[d>>16&255]^E[s>>8&255]^k[255&u]^y[v+2],o=A[d>>>24]^b[s>>16&255]^E[u>>8&255]^k[255&c]^y[v+3],s=n,u=i,c=a,d=o,v+=4;n=_[s>>>24]<<24^_[u>>16&255]<<16^_[c>>8&255]<<8^_[255&d]^y[v],i=_[u>>>24]<<24^_[c>>16&255]<<16^_[d>>8&255]<<8^_[255&s]^y[v+1],a=_[c>>>24]<<24^_[d>>16&255]<<16^_[s>>8&255]<<8^_[255&u]^y[v+2],o=_[d>>>24]<<24^_[s>>16&255]<<16^_[u>>8&255]<<8^_[255&c]^y[v+3],M[t]=O(n^w),M[t+1]=O(o^T),M[t+2]=O(a^R),M[t+3]=O(i^I),w=l,T=h,R=f,I=p,t+=4}return M.buffer}}]),Gc=D((function e(t){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).removePKCS7Padding,n=void 0===r||r;if(R(this,e),this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=t.enableSoftwareAES,this.removePKCS7Padding=n,n)try{var i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch(e){}this.useSoftware=!this.subtle}),[{key:"destroy",value:function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}},{key:"isSync",value:function(){return this.useSoftware}},{key:"flush",value:function(){var e=this.currentResult,t=this.remainderData;if(!e||t)return this.reset(),null;var r,n,i,a=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?(i=(n=(r=a).byteLength)&&new DataView(r.buffer).getUint8(n-1))?Qo(r,0,n-i):r:a}},{key:"reset",value:function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}},{key:"decrypt",value:function(e,t,r){var n=this;return this.useSoftware?new Promise((function(i,a){n.softwareDecrypt(new Uint8Array(e),t,r);var o=n.flush();o?i(o.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,r)}},{key:"softwareDecrypt",value:function(e,t,r){var n=this.currentIV,i=this.currentResult,a=this.remainderData;this.logOnce("JS AES decrypt"),a&&(e=Os(a,e),this.remainderData=null);var o=this.getValidChunk(e);if(!o.length)return null;n&&(r=n);var s=this.softwareDecrypter;s||(s=this.softwareDecrypter=new Wc),s.expandKey(t);var u=i;return this.currentResult=s.decrypt(o.buffer,0,r),this.currentIV=Qo(o,-16).buffer,u||null}},{key:"webCryptoDecrypt",value:function(e,t,r){var n=this;if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r));this.key=t,this.fastAesKey=new Bc(this.subtle,t)}return this.fastAesKey.expandKey().then((function(t){return n.subtle?(n.logOnce("WebCrypto AES decrypt"),new Fc(n.subtle,new Uint8Array(r)).decrypt(e.buffer,t)):Promise.reject(new Error("web crypto not initialized"))})).catch((function(i){return Ao.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, ".concat(i.name,": ").concat(i.message)),n.onWebCryptoError(e,t,r)}))}},{key:"onWebCryptoError",value:function(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);var n=this.flush();if(n)return n.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}},{key:"getValidChunk",value:function(e){var t=e,r=e.length-e.length%16;return r!==e.length&&(t=Qo(e,0,r),this.remainderData=Qo(e,r)),t}},{key:"logOnce",value:function(e){this.logEnabled&&(Ao.log("[decrypter]: ".concat(e)),this.logEnabled=!1)}}]),Hc="STOPPED",jc="IDLE",Kc="KEY_LOADING",zc="FRAG_LOADING",qc="FRAG_LOADING_WAITING_RETRY",Yc="WAITING_TRACK",Xc="PARSING",Qc="PARSED",Jc="ENDED",$c="ERROR",Zc="WAITING_INIT_PTS",ed="WAITING_LEVEL",td=function(e){function t(e,r,n,i,a){var o;return R(this,t),(o=c(this,t)).hls=void 0,o.fragPrevious=null,o.fragCurrent=null,o.fragmentTracker=void 0,o.transmuxer=null,o._state=Hc,o.playlistType=void 0,o.media=null,o.mediaBuffer=null,o.config=void 0,o.bitrateTest=!1,o.lastCurrentTime=0,o.nextLoadPosition=0,o.startPosition=0,o.startTimeOffset=null,o.loadedmetadata=!1,o.retryDate=0,o.levels=null,o.fragmentLoader=void 0,o.keyLoader=void 0,o.levelLastLoaded=null,o.startFragRequested=!1,o.decrypter=void 0,o.initPTS=[],o.onvseeking=null,o.onvended=null,o.logPrefix="",o.log=void 0,o.warn=void 0,o.playlistType=a,o.logPrefix=i,o.log=Ao.log.bind(Ao,"".concat(i,":")),o.warn=Ao.warn.bind(Ao,"".concat(i,":")),o.hls=e,o.fragmentLoader=new Lc(e.config),o.keyLoader=n,o.fragmentTracker=r,o.config=e.config,o.decrypter=new Gc(e.config),e.on(vo.MANIFEST_LOADED,o.onManifestLoaded,o),o}return f(t,e),D(t,[{key:"doTick",value:function(){this.onTickEnd()}},{key:"onTickEnd",value:function(){}},{key:"startLoad",value:function(e){}},{key:"stopLoad",value:function(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Hc}},{key:"_streamEnded",value:function(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;var r=t.partList;if(null!=r&&r.length){var n=r[r.length-1];return Rc.isBuffered(this.media,n.start+n.duration/2)}var i=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(i)}},{key:"getLevelDetails",value:function(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levelLastLoaded)?void 0:e.details}},{key:"onMediaAttached",value:function(e,t){var r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.state===Hc&&this.startLoad(n.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}},{key:"onMediaSeeking",value:function(){var e=this.config,t=this.fragCurrent,r=this.media,n=this.mediaBuffer,i=this.state,a=r?r.currentTime:0,o=Rc.bufferInfo(n||r,a,e.maxBufferHole);if(this.log("media seeking to ".concat(ho(a)?a.toFixed(3):a,", state: ").concat(i)),this.state===Jc)this.resetLoadingState();else if(t){var s=e.maxFragLookUpTolerance,u=t.start-s,c=t.start+t.duration+s;if(!o.len||c<o.start||u>o.end){var d=a>c;(a<u||d)&&(d&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}r&&(this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0),this.lastCurrentTime=a),this.loadedmetadata||o.len||(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoaded",value:function(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}},{key:"onHandlerDestroying",value:function(){this.hls.off(vo.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),s(t,"onHandlerDestroying",this)([]),this.hls=null}},{key:"onHandlerDestroyed",value:function(){this.state=Hc,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,s(t,"onHandlerDestroyed",this)([])}},{key:"loadFragment",value:function(e,t,r){this._loadFragForPlayback(e,t,r)}},{key:"_loadFragForPlayback",value:function(e,t,r){var n=this;this._doFragLoad(e,t,r,(function(t){if(n.fragContextChanged(e))return n.warn("Fragment ".concat(e.sn).concat(t.part?" p: "+t.part.index:""," of level ").concat(e.level," was dropped during download.")),void n.fragmentTracker.removeFragment(e);e.stats.chunkCount++,n._handleFragmentLoadProgress(t)})).then((function(t){if(t){var r=n.state;n.fragContextChanged(e)?(r===zc||!n.fragCurrent&&r===Xc)&&(n.fragmentTracker.removeFragment(e),n.state=jc):("payload"in t&&(n.log("Loaded fragment ".concat(e.sn," of level ").concat(e.level)),n.hls.trigger(vo.FRAG_LOADED,t)),n._handleFragmentLoadComplete(t))}})).catch((function(t){n.state!==Hc&&n.state!==$c&&(n.warn("Frag error: ".concat((null==t?void 0:t.message)||t)),n.resetFragmentLoading(e))}))}},{key:"clearTrackerIfNeeded",value:function(e){var t,r=this.fragmentTracker;if(r.getState(e)===Ac){var n=e.type,i=this.getFwdBufferInfo(this.mediaBuffer,n),a=Math.max(e.duration,i?i.len:this.config.maxBufferLength),o=this.backtrackFragment;(1===(o?e.sn-o.sn:0)||this.reduceMaxBufferLength(a,e.duration))&&r.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===bc&&r.removeFragment(e))}},{key:"checkLiveUpdate",value:function(e){if(e.updated&&!e.live){var t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}},{key:"flushMainBuffer",value:function(e,t){if(e-t){var r={startOffset:e,endOffset:t,type:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null};this.hls.trigger(vo.BUFFER_FLUSHING,r)}}},{key:"_loadInitSegment",value:function(e,t){var r=this;this._doFragLoad(e,t).then((function(t){if(!t||r.fragContextChanged(e)||!r.levels)throw new Error("init load aborted");return t})).then((function(t){var n=r.hls,i=t.payload,a=e.decryptdata;if(i&&i.byteLength>0&&null!=a&&a.key&&a.iv&&"AES-128"===a.method){var o=self.performance.now();return r.decrypter.decrypt(new Uint8Array(i),a.key.buffer,a.iv.buffer).catch((function(t){throw n.trigger(vo.ERROR,{type:go.MEDIA_ERROR,details:mo.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t})).then((function(i){var a=self.performance.now();return n.trigger(vo.FRAG_DECRYPTED,{frag:e,payload:i,stats:{tstart:o,tdecrypt:a}}),t.payload=i,r.completeInitSegmentLoad(t)}))}return r.completeInitSegmentLoad(t)})).catch((function(t){r.state!==Hc&&r.state!==$c&&(r.warn(t),r.resetFragmentLoading(e))}))}},{key:"completeInitSegmentLoad",value:function(e){if(!this.levels)throw new Error("init load aborted, missing levels");var t=e.frag.stats;this.state=jc,e.frag.data=new Uint8Array(e.payload),t.parsing.start=t.buffering.start=self.performance.now(),t.parsing.end=t.buffering.end=self.performance.now(),this.tick()}},{key:"fragContextChanged",value:function(e){var t=this.fragCurrent;return!e||!t||e.sn!==t.sn||e.level!==t.level}},{key:"fragBufferedComplete",value:function(e,t){var r,n,i,a,o=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.playlistType===Su?"level":"track"," ").concat(e.level," (frag:[").concat((null!=(r=e.startPTS)?r:NaN).toFixed(3),"-").concat((null!=(n=e.endPTS)?n:NaN).toFixed(3),"] > buffer:").concat(o?function(e){for(var t="",r=e.length,n=0;n<r;n++)t+="[".concat(e.start(n).toFixed(3),"-").concat(e.end(n).toFixed(3),"]");return t}(Rc.getBuffered(o)):"(detached)",")")),"initSegment"!==e.sn){var s;if(e.type!==bu){var u=e.elementaryStreams;if(!Object.keys(u).some((function(e){return!!u[e]})))return void(this.state=jc)}var c=null==(s=this.levels)?void 0:s[e.level];null!=c&&c.fragmentError&&(this.log("Resetting level fragment error count of ".concat(c.fragmentError," on frag buffered")),c.fragmentError=0)}this.state=jc,o&&(!this.loadedmetadata&&e.type==Su&&o.buffered.length&&(null==(i=this.fragCurrent)?void 0:i.sn)===(null==(a=this.fragPrevious)?void 0:a.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}},{key:"seekToStartPos",value:function(){}},{key:"_handleFragmentLoadComplete",value:function(e){var t=this.transmuxer;if(t){var r=e.frag,n=e.part,i=e.partsLoaded,a=!i||0===i.length||i.some((function(e){return!e})),o=new Ic(r.level,r.sn,r.stats.chunkCount+1,0,n?n.index:-1,!a);t.flush(o)}}},{key:"_handleFragmentLoadProgress",value:function(e){}},{key:"_doFragLoad",value:function(e,t){var r,n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3?arguments[3]:void 0,o=null==t?void 0:t.details;if(!this.levels||!o)throw new Error("frag load aborted, missing level".concat(o?"":" detail","s"));var s=null;if(!e.encrypted||null!=(r=e.decryptdata)&&r.key?!e.encrypted&&o.encryptedFragments.length&&this.keyLoader.loadClear(e,o.encryptedFragments):(this.log("Loading key for ".concat(e.sn," of [").concat(o.startSN,"-").concat(o.endSN,"], ").concat("[stream-controller]"===this.logPrefix?"level":"track"," ").concat(e.level)),this.state=Kc,this.fragCurrent=e,s=this.keyLoader.load(e).then((function(e){if(!n.fragContextChanged(e.frag))return n.hls.trigger(vo.KEY_LOADED,e),n.state===Kc&&(n.state=jc),e})),this.hls.trigger(vo.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(s=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),i=Math.max(e.start,i||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){var u=o.partList;if(u&&a){i>e.end&&o.fragmentHint&&(e=o.fragmentHint);var c=this.getNextPart(u,e,i);if(c>-1){var d,l=u[c];return this.log("Loading part sn: ".concat(e.sn," p: ").concat(l.index," cc: ").concat(e.cc," of playlist [").concat(o.startSN,"-").concat(o.endSN,"] parts [0-").concat(c,"-").concat(u.length-1,"] ").concat("[stream-controller]"===this.logPrefix?"level":"track",": ").concat(e.level,", target: ").concat(parseFloat(i.toFixed(3)))),this.nextLoadPosition=l.start+l.duration,this.state=zc,d=s?s.then((function(r){return!r||n.fragContextChanged(r.frag)?null:n.doFragPartsLoad(e,l,t,a)})).catch((function(e){return n.handleFragLoadError(e)})):this.doFragPartsLoad(e,l,t,a).catch((function(e){return n.handleFragLoadError(e)})),this.hls.trigger(vo.FRAG_LOADING,{frag:e,part:l,targetBufferTime:i}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):d}if(!e.url||this.loadedEndOfParts(u,i))return Promise.resolve(null)}}this.log("Loading fragment ".concat(e.sn," cc: ").concat(e.cc," ").concat(o?"of ["+o.startSN+"-"+o.endSN+"] ":"").concat("[stream-controller]"===this.logPrefix?"level":"track",": ").concat(e.level,", target: ").concat(parseFloat(i.toFixed(3)))),ho(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=zc;var h,f=this.config.progressive;return h=f&&s?s.then((function(t){return!t||n.fragContextChanged(null==t?void 0:t.frag)?null:n.fragmentLoader.load(e,a)})).catch((function(e){return n.handleFragLoadError(e)})):Promise.all([this.fragmentLoader.load(e,f?a:void 0),s]).then((function(e){var t=v(e,1)[0];return!f&&t&&a&&a(t),t})).catch((function(e){return n.handleFragLoadError(e)})),this.hls.trigger(vo.FRAG_LOADING,{frag:e,targetBufferTime:i}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):h}},{key:"doFragPartsLoad",value:function(e,t,r,n){var i=this;return new Promise((function(a,o){var s,u=[],c=null==(s=r.details)?void 0:s.partList,d=function(t){i.fragmentLoader.loadPart(e,t,n).then((function(n){u[t.index]=n;var o=n.part;i.hls.trigger(vo.FRAG_LOADED,n);var s=Xu(r,e.sn,t.index+1)||Qu(c,e.sn,t.index+1);if(!s)return a({frag:e,part:o,partsLoaded:u});d(s)})).catch(o)};d(t)}))}},{key:"handleFragLoadError",value:function(e){if("data"in e){var t=e.data;e.data&&t.details===mo.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(vo.ERROR,t)}else this.hls.trigger(vo.ERROR,{type:go.OTHER_ERROR,details:mo.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}},{key:"_handleTransmuxerFlush",value:function(e){var t=this.getCurrentContext(e);if(t&&this.state===Xc){var r=t.frag,n=t.part,i=t.level,a=self.performance.now();r.stats.parsing.end=a,n&&(n.stats.parsing.end=a),this.updateLevelTiming(r,n,i,e.partial)}else this.fragCurrent||this.state===Hc||this.state===$c||(this.state=jc)}},{key:"getCurrentContext",value:function(e){var t=this.levels,r=this.fragCurrent,n=e.level,i=e.sn,a=e.part;if(null==t||!t[n])return this.warn("Levels object was unset while buffering fragment ".concat(i," of level ").concat(n,". The current chunk will not be buffered.")),null;var o=t[n],s=a>-1?Xu(o,i,a):null,u=s?s.fragment:function(e,t,r){if(null==e||!e.details)return null;var n=e.details,i=n.fragments[t-n.startSN];return i||((i=n.fragmentHint)&&i.sn===t?i:t<n.startSN&&r&&r.sn===t?r:null)}(o,i,r);return u?(r&&r!==u&&(u.stats=r.stats),{frag:u,part:s,level:o}):null}},{key:"bufferFragmentData",value:function(e,t,r,n,i){var a;if(e&&this.state===Xc){var o=e.data1,s=e.data2,u=o;if(o&&s&&(u=Os(o,s)),null!=(a=u)&&a.length){var c={type:e.type,frag:t,part:r,chunkMeta:n,parent:t.type,data:u};if(this.hls.trigger(vo.BUFFER_APPENDING,c),e.dropped&&e.independent&&!r){if(i)return;this.flushBufferGap(t)}}}}},{key:"flushBufferGap",value:function(e){var t=this.media;if(t)if(Rc.isBuffered(t,t.currentTime)){var r=t.currentTime,n=Rc.bufferInfo(t,r,0),i=e.duration,a=Math.min(2*this.config.maxFragLookUpTolerance,.25*i),o=Math.max(Math.min(e.start-a,n.end-a),r+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}else this.flushMainBuffer(0,e.start)}},{key:"getFwdBufferInfo",value:function(e,t){var r=this.getLoadPosition();return ho(r)?this.getFwdBufferInfoAtPos(e,r,t):null}},{key:"getFwdBufferInfoAtPos",value:function(e,t,r){var n=this.config.maxBufferHole,i=Rc.bufferInfo(e,t,n);if(0===i.len&&void 0!==i.nextStart){var a=this.fragmentTracker.getBufferedFrag(t,r);if(a&&i.nextStart<a.end)return Rc.bufferInfo(e,t,Math.max(i.nextStart,n))}return i}},{key:"getMaxBufferLength",value:function(e){var t,r=this.config;return t=e?Math.max(8*r.maxBufferSize/e,r.maxBufferLength):r.maxBufferLength,Math.min(t,r.maxMaxBufferLength)}},{key:"reduceMaxBufferLength",value:function(e,t){var r=this.config,n=Math.max(Math.min(e-t,r.maxBufferLength),t),i=Math.max(e-3*t,r.maxMaxBufferLength/2,n);return i>=n&&(r.maxMaxBufferLength=i,this.warn("Reduce max buffer length to ".concat(i,"s")),!0)}},{key:"getAppendedFrag",value:function(e){var t=this.fragmentTracker.getAppendedFrag(e,Su);return t&&"fragment"in t?t.fragment:t}},{key:"getNextFragment",value:function(e,t){var r=t.fragments,n=r.length;if(!n)return null;var i,a=this.config,o=r[0].start;if(t.live){var s=a.initialLiveManifestSize;if(n<s)return this.warn("Not enough fragments to start playback (have: ".concat(n,", need: ").concat(s,")")),null;(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<o)&&(i=this.getInitialLiveFragment(t,r),this.startPosition=this.nextLoadPosition=i?this.hls.liveSyncPosition||i.start:e)}else e<=o&&(i=r[0]);if(!i){var u=a.lowLatencyMode?t.partEnd:t.fragmentEnd;i=this.getFragmentAtPosition(e,u,t)}return this.mapToInitFragWhenRequired(i)}},{key:"isLoopLoading",value:function(e,t){var r=this.fragmentTracker.getState(e);return(r===Ec||r===bc&&!!e.gap)&&this.nextLoadPosition>t}},{key:"getNextFragmentLoopLoading",value:function(e,t,r,n,i){var a=e.gap,o=this.getNextFragment(this.nextLoadPosition,t);if(null===o)return o;if(e=o,a&&e&&!e.gap&&r.nextStart){var s=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,n);if(null!==s&&r.len+s.len>=i)return this.log('buffer full after gaps in "'.concat(n,'" playlist starting at sn: ').concat(e.sn)),null}return e}},{key:"mapToInitFragWhenRequired",value:function(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}},{key:"getNextPart",value:function(e,t,r){for(var n=-1,i=!1,a=!0,o=0,s=e.length;o<s;o++){var u=e[o];if(a=a&&!u.independent,n>-1&&r<u.start)break;var c=u.loaded;c?n=-1:(i||u.independent||a)&&u.fragment===t&&(n=o),i=c}return n}},{key:"loadedEndOfParts",value:function(e,t){var r=e[e.length-1];return r&&t>r.start&&r.loaded}},{key:"getInitialLiveFragment",value:function(e,t){var r=this.fragPrevious,n=null;if(r){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: ".concat(r.programDateTime)),n=function(e,t,r){if(null===t||!Array.isArray(e)||!e.length||!ho(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;r=r||0;for(var n=0;n<e.length;++n){var i=e[n];if(oc(t,r,i))return i}return null}(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){var i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){var a=t[i-e.startSN];r.cc===a.cc&&(n=a,this.log("Live playlist, switching playlist, load frag with next SN: ".concat(n.sn)))}n||(n=function(e,t){return nc(e,(function(e){return e.cc<t?1:e.cc>t?-1:0}))}(t,r.cc),n&&this.log("Live playlist, switching playlist, load frag with same CC: ".concat(n.sn)))}}else{var o=this.hls.liveSyncPosition;null!==o&&(n=this.getFragmentAtPosition(o,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n}},{key:"getFragmentAtPosition",value:function(e,t,r){var n,i=this.config,a=this.fragPrevious,o=r.fragments,s=r.endSN,u=r.fragmentHint,c=i.maxFragLookUpTolerance,d=r.partList,l=!!(i.lowLatencyMode&&null!=d&&d.length&&u);if(l&&u&&!this.bitrateTest&&(o=o.concat(u),s=u.sn),n=e<t?ic(a,o,e,e>t-c?0:c):o[o.length-1]){var h=n.sn-r.startSN,f=this.fragmentTracker.getState(n);if((f===Ec||f===bc&&n.gap)&&(a=n),a&&n.sn===a.sn&&(!l||d[0].fragment.sn>n.sn)&&a&&n.level===a.level){var p=o[h+1];n=n.sn<s&&this.fragmentTracker.getState(p)!==Ec?p:null}}return n}},{key:"synchronizeToLiveEdge",value:function(e){var t=this.config,r=this.media;if(r){var n=this.hls.liveSyncPosition,i=r.currentTime,a=e.fragments[0].start,o=e.edge,s=i>=a-t.maxFragLookUpTolerance&&i<=o;if(null!==n&&r.duration>n&&(i<n||!s)){var u=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!s&&r.readyState<4||i<o-u)&&(this.loadedmetadata||(this.nextLoadPosition=n),r.readyState&&(this.warn("Playback: ".concat(i.toFixed(3)," is located too far from the end of live sliding playlist: ").concat(o,", reset currentTime to : ").concat(n.toFixed(3))),r.currentTime=n))}}}},{key:"alignPlaylists",value:function(e,t,r){var n=e.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;var i=e.fragments[0].start,a=!t,o=e.alignedSliding&&ho(i);if(a||!o&&!i){var s=this.fragPrevious;!function(e,t,r){t&&(function(e,t,r){if(function(e,t,r){return!(!t||!(r.endCC>r.startCC||e&&e.cc<r.startCC))}(e,r,t)){var n=function(e,t){var r=e.fragments,n=t.fragments;if(n.length&&r.length){var i=Dc(r,n[0].cc);if(i&&(!i||i.startPTS))return i;Ao.log("No frag in previous level to align on")}else Ao.log("No fragments to align")}(r,t);n&&ho(n.start)&&(Ao.log("Adjusting PTS using last level due to CC increase within current level ".concat(t.url)),Oc(n.start,t))}}(e,r,t),!r.alignedSliding&&t&&xc(r,t),r.alignedSliding||!t||r.skippedSegments||qu(t,r))}(s,r,e);var u=e.fragments[0].start;return this.log("Live playlist sliding: ".concat(u.toFixed(2)," start-sn: ").concat(t?t.startSN:"na","->").concat(e.startSN," prev-sn: ").concat(s?s.sn:"na"," fragments: ").concat(n)),u}return i}},{key:"waitForCdnTuneIn",value:function(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}},{key:"setStartPosition",value:function(e,t){var r=this.startPosition;if(r<t&&(r=-1),-1===r||-1===this.lastCurrentTime){var n=null!==this.startTimeOffset,i=n?this.startTimeOffset:e.startTimeOffset;null!==i&&ho(i)?(r=t+i,i<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log("Start time offset ".concat(i," found in ").concat(n?"multivariant":"media"," playlist, adjust startPosition to ").concat(r)),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r}},{key:"getLoadPosition",value:function(){var e=this.media,t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}},{key:"handleFragLoadAborted",value:function(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn("Fragment ".concat(e.sn).concat(t?" part "+t.index:""," of level ").concat(e.level," was aborted")),this.resetFragmentLoading(e))}},{key:"resetFragmentLoading",value:function(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===qc)||(this.state=jc)}},{key:"onFragmentOrKeyLoadError",value:function(e,t){if(t.chunkMeta&&!t.frag){var r=this.getCurrentContext(t.chunkMeta);r&&(t.frag=r.frag)}var n=t.frag;if(n&&n.type===e&&this.levels)if(this.fragContextChanged(n)){var i;this.warn("Frag load error must match current frag to retry ".concat(n.url," > ").concat(null==(i=this.fragCurrent)?void 0:i.url))}else{var a=t.details===mo.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(n,!0);var o=t.errorAction,s=o||{},u=s.action,c=s.retryCount,d=void 0===c?0:c,l=s.retryConfig;if(o&&5===u&&l){this.resetStartWhenNotLoaded(this.levelLastLoaded);var h=ec(l,d);this.warn("Fragment ".concat(n.sn," of ").concat(e," ").concat(n.level," errored with ").concat(t.details,", retrying loading ").concat(d+1,"/").concat(l.maxNumRetry," in ").concat(h,"ms")),o.resolved=!0,this.retryDate=self.performance.now()+h,this.state=qc}else if(l&&o){if(this.resetFragmentErrors(e),!(d<l.maxNumRetry))return void Ao.warn("".concat(t.details," reached or exceeded max retry (").concat(d,")"));a||3===u||(o.resolved=!0)}else 2===(null==o?void 0:o.action)?this.state=ed:this.state=$c;this.tickImmediate()}}},{key:"reduceLengthAndFlushBuffer",value:function(e){if(this.state===Xc||this.state===Qc){var t=e.frag,r=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,r),i=n&&n.len>.5;i&&this.reduceMaxBufferLength(n.len,(null==t?void 0:t.duration)||10);var a=!i;return a&&this.warn("Buffer full error while media.currentTime is not buffered, flush ".concat(r," buffer")),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}},{key:"resetFragmentErrors",value:function(e){e===Au&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==Hc&&(this.state=jc)}},{key:"afterBufferFlushed",value:function(e,t,r){if(e){var n=Rc.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,r),this.state===Jc&&this.resetLoadingState()}}},{key:"resetLoadingState",value:function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=jc}},{key:"resetStartWhenNotLoaded",value:function(e){if(!this.loadedmetadata){this.startFragRequested=!1;var t=e?e.details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}},{key:"resetWhenMissingContext",value:function(e){this.warn("The loading context changed while buffering fragment ".concat(e.sn," of level ").concat(e.level,". This chunk will not be buffered.")),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}},{key:"removeUnbufferedFrags",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}},{key:"updateLevelTiming",value:function(e,t,r,n){var i,a=this,o=r.details;if(o){if(!Object.keys(e.elementaryStreams).reduce((function(t,i){var s=e.elementaryStreams[i];if(s){var u=s.endPTS-s.startPTS;if(u<=0)return a.warn("Could not parse fragment ".concat(e.sn," ").concat(i," duration reliably (").concat(u,")")),t||!1;var c=n?0:zu(o,e,s.startPTS,s.endPTS,s.startDTS,s.endDTS);return a.hls.trigger(vo.LEVEL_PTS_UPDATED,{details:o,level:r,drift:c,type:i,frag:e,start:s.startPTS,end:s.endPTS}),!0}return t}),!1)&&null===(null==(i=this.transmuxer)?void 0:i.error)){var s=new Error("Found no media in fragment ".concat(e.sn," of level ").concat(e.level," resetting transmuxer to fallback to playlist timing"));if(0===r.fragmentError&&(r.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(s.message),this.hls.trigger(vo.ERROR,{type:go.MEDIA_ERROR,details:mo.FRAG_PARSING_ERROR,fatal:!1,error:s,frag:e,reason:"Found no media in msn ".concat(e.sn,' of level "').concat(r.url,'"')}),!this.hls)return;this.resetTransmuxer()}this.state=Qc,this.hls.trigger(vo.FRAG_PARSED,{frag:e,part:t})}else this.warn("level.details undefined")}},{key:"resetTransmuxer",value:function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}},{key:"recoverWorkerError",value:function(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}},{key:"state",get:function(){return this._state},set:function(e){var t=this._state;t!==e&&(this._state=e,this.log("".concat(t,"->").concat(e)))}}])}(_c),rd=D((function e(){R(this,e),this.chunks=[],this.dataLength=0}),[{key:"push",value:function(e){this.chunks.push(e),this.dataLength+=e.length}},{key:"flush",value:function(){var e,t=this.chunks,r=this.dataLength;return t.length?(e=1===t.length?t[0]:function(e,t){for(var r=new Uint8Array(t),n=0,i=0;i<e.length;i++){var a=e[i];r.set(a,n),n+=a.length}return r}(t,r),this.reset(),e):new Uint8Array(0)}},{key:"reset",value:function(){this.chunks.length=0,this.dataLength=0}}]);function nd(){return{type:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",id:-1,pid:-1,inputTimeScale:arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,sequenceNumber:-1,samples:[],dropped:0}}var id=D((function e(){R(this,e),this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}),[{key:"resetInitSegment",value:function(e,t,r,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}},{key:"resetTimeStamp",value:function(e){this.initPTS=e,this.resetContiguity()}},{key:"resetContiguity",value:function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}},{key:"canParse",value:function(e,t){return!1}},{key:"appendFrame",value:function(e,t,r){}},{key:"demux",value:function(e,t){this.cachedData&&(e=Os(this.cachedData,e),this.cachedData=null);var r,n=es(e,0),i=n?n.length:0,a=this._audioTrack,o=this._id3Track,s=n?ns(n):void 0,u=e.length;for((null===this.basePTS||0===this.frameIndex&&ho(s))&&(this.basePTS=ad(s,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),n&&n.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Mu,duration:Number.POSITIVE_INFINITY});i<u;){if(this.canParse(e,i)){var c=this.appendFrame(a,e,i);c?(this.frameIndex++,this.lastPTS=c.sample.pts,r=i+=c.length):i=u}else rs(e,i)?(n=es(e,i),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Mu,duration:Number.POSITIVE_INFINITY}),r=i+=n.length):i++;if(i===u&&r!==u){var d=Qo(e,r);this.cachedData?this.cachedData=Os(this.cachedData,d):this.cachedData=d}}return{audioTrack:a,videoTrack:nd(),id3Track:o,textTrack:nd()}}},{key:"demuxSampleAes",value:function(e,t,r){return Promise.reject(new Error("[".concat(this,"] This demuxer does not support Sample-AES decryption")))}},{key:"flush",value:function(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:nd(),id3Track:this._id3Track,textTrack:nd()}}},{key:"destroy",value:function(){}}]),ad=function(e,t,r){return ho(e)?90*e:9e4*t+(r?9e4*r.baseTime/r.timescale:0)};function od(e,t){return 255===e[t]&&240==(246&e[t+1])}function sd(e,t){return 1&e[t+1]?7:9}function ud(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function cd(e,t){return t+1<e.length&&od(e,t)}function dd(e,t){if(cd(e,t)){var r=sd(e,t);if(t+r>=e.length)return!1;var n=ud(e,t);if(n<=r)return!1;var i=t+n;return i===e.length||cd(e,i)}return!1}function ld(e,t,r,n,i){if(!e.samplerate){var a=function(e,t,r,n){var i,a,o,s,u=navigator.userAgent.toLowerCase(),c=n,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i=1+((192&t[r+2])>>>6);var l=(60&t[r+2])>>>2;if(!(l>d.length-1))return o=(1&t[r+2])<<2,o|=(192&t[r+3])>>>6,Ao.log("manifest codec:".concat(n,", ADTS type:").concat(i,", samplingIndex:").concat(l)),/firefox/i.test(u)?l>=6?(i=5,s=new Array(4),a=l-3):(i=2,s=new Array(2),a=l):-1!==u.indexOf("android")?(i=2,s=new Array(2),a=l):(i=5,s=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&l>=6?a=l-3:((n&&-1!==n.indexOf("mp4a.40.2")&&(l>=6&&1===o||/vivaldi/i.test(u))||!n&&1===o)&&(i=2,s=new Array(2)),a=l)),s[0]=i<<3,s[0]|=(14&l)>>1,s[1]|=(1&l)<<7,s[1]|=o<<3,5===i&&(s[1]|=(14&a)>>1,s[2]=(1&a)<<7,s[2]|=8,s[3]=0),{config:s,samplerate:d[l],channelCount:o,codec:"mp4a.40."+i,manifestCodec:c};var h=new Error("invalid ADTS sampling index:".concat(l));e.emit(vo.ERROR,vo.ERROR,{type:go.MEDIA_ERROR,details:mo.FRAG_PARSING_ERROR,fatal:!0,error:h,reason:h.message})}(t,r,n,i);if(!a)return;e.config=a.config,e.samplerate=a.samplerate,e.channelCount=a.channelCount,e.codec=a.codec,e.manifestCodec=a.manifestCodec,Ao.log("parsed codec:".concat(e.codec,", rate:").concat(a.samplerate,", channels:").concat(a.channelCount))}}function hd(e){return 9216e4/e}function fd(e,t,r,n,i){var a,o=n+i*hd(e.samplerate),s=function(e,t){var r=sd(e,t);if(t+r<=e.length){var n=ud(e,t)-r;if(n>0)return{headerLength:r,frameLength:n}}}(t,r);if(s){var u=s.frameLength,c=s.headerLength,d=c+u,l=Math.max(0,r+d-t.length);l?(a=new Uint8Array(d-c)).set(t.subarray(r+c,t.length),0):a=t.subarray(r+c,r+d);var h={unit:a,pts:o};return l||e.samples.push(h),{sample:h,length:d,missing:l}}var f=t.length-r;return(a=new Uint8Array(f)).set(t.subarray(r,t.length),0),{sample:{unit:a,pts:o},length:f,missing:-1}}var pd=null,vd=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],gd=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],md=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],yd=[0,1,1,4];function _d(e,t,r,n,i){if(!(r+24>t.length)){var a=Sd(t,r);if(a&&r+a.frameLength<=t.length){var o=n+i*(9e4*a.samplesPerFrame/a.sampleRate),s={unit:t.subarray(r,r+a.frameLength),pts:o,dts:o};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(s),{sample:s,length:a.frameLength,missing:0}}}}function Sd(e,t){var r=e[t+1]>>3&3,n=e[t+1]>>1&3,i=e[t+2]>>4&15,a=e[t+2]>>2&3;if(1!==r&&0!==i&&15!==i&&3!==a){var o=e[t+2]>>1&1,s=e[t+3]>>6,u=1e3*vd[14*(3===r?3-n:3===n?3:4)+i-1],c=gd[3*(3===r?0:2===r?1:2)+a],d=3===s?1:2,l=md[r][n],h=yd[n],f=8*l*h,p=Math.floor(l*u/c+o)*h;if(null===pd){var v=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);pd=v?parseInt(v[1]):0}return!!pd&&pd<=87&&2===n&&u>=224e3&&0===s&&(e[t+3]=128|e[t+3]),{sampleRate:c,channelCount:d,frameLength:p,samplesPerFrame:f}}}function Ad(e,t){return!(255!==e[t]||224&~e[t+1]||!(6&e[t+1]))}function bd(e,t){return t+1<e.length&&Ad(e,t)}function Ed(e,t){if(t+1<e.length&&Ad(e,t)){var r=Sd(e,t),n=4;null!=r&&r.frameLength&&(n=r.frameLength);var i=t+n;return i===e.length||bd(e,i)}return!1}var kd=function(e){function t(e,r){var n;return R(this,t),(n=c(this,t)).observer=void 0,n.config=void 0,n.observer=e,n.config=r,n}return f(t,e),D(t,[{key:"resetInitSegment",value:function(e,r,n,i){s(t,"resetInitSegment",this)([e,r,n,i]),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:r,duration:i,inputTimeScale:9e4,dropped:0}}},{key:"canParse",value:function(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&od(e,t)&&ud(e,t)<=e.length-t}(e,t)}},{key:"appendFrame",value:function(e,t,r){ld(e,this.observer,t,r,e.manifestCodec);var n=fd(e,t,r,this.basePTS,this.frameIndex);if(n&&0===n.missing)return n}}],[{key:"probe",value:function(e){if(!e)return!1;var t=es(e,0),r=(null==t?void 0:t.length)||0;if(Ed(e,r))return!1;for(var n=e.length;r<n;r++)if(dd(e,r))return Ao.log("ADTS sync word found !"),!0;return!1}}])}(id),Cd=/\/emsg[-/]ID3/i,wd=D((function e(t,r){R(this,e),this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=r}),[{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(e,t,r,n){var i=this.videoTrack=nd("video",1),a=this.audioTrack=nd("audio",1),o=this.txtTrack=nd("text",1);if(this.id3Track=nd("id3",1),this.timeOffset=0,null!=e&&e.byteLength){var s=Cs(e);if(s.video){var u=s.video,c=u.id,d=u.timescale,l=u.codec;i.id=c,i.timescale=o.timescale=d,i.codec=l}if(s.audio){var h=s.audio,f=h.id,p=h.timescale,v=h.codec;a.id=f,a.timescale=p,a.codec=v}o.id=gs.text,i.sampleDuration=0,i.duration=a.duration=n}}},{key:"resetContiguity",value:function(){this.remainderData=null}},{key:"demux",value:function(e,t){this.timeOffset=t;var r=e,n=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Os(this.remainderData,e));var a=function(e){var t={valid:null,remainder:null},r=Es(e,["moof"]);if(r.length<2)return t.remainder=e,t;var n=r[r.length-1];return t.valid=Qo(e,0,n.byteOffset-8),t.remainder=Qo(e,n.byteOffset-8),t}(r);this.remainderData=a.remainder,n.samples=a.valid||new Uint8Array}else n.samples=r;var o=this.extractID3Track(n,t);return i.samples=xs(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}},{key:"flush",value:function(){var e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;var n=this.extractID3Track(t,this.timeOffset);return r.samples=xs(e,t),{videoTrack:t,audioTrack:nd(),id3Track:n,textTrack:nd()}}},{key:"extractID3Track",value:function(e,t){var r=this.id3Track;if(e.samples.length){var n=Es(e.samples,["emsg"]);n&&n.forEach((function(e){var n=function(e){var t=e[0],r="",n="",i=0,a=0,o=0,s=0,u=0,c=0;if(0===t){for(;"\0"!==ms(e.subarray(c,c+1));)r+=ms(e.subarray(c,c+1)),c+=1;for(r+=ms(e.subarray(c,c+1)),c+=1;"\0"!==ms(e.subarray(c,c+1));)n+=ms(e.subarray(c,c+1)),c+=1;n+=ms(e.subarray(c,c+1)),c+=1,i=_s(e,12),a=_s(e,16),s=_s(e,20),u=_s(e,24),c=28}else if(1===t){i=_s(e,c+=4);var d=_s(e,c+=4),l=_s(e,c+=4);for(c+=4,o=Math.pow(2,32)*d+l,fo(o)||(o=Number.MAX_SAFE_INTEGER,Ao.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),s=_s(e,c),u=_s(e,c+=4),c+=4;"\0"!==ms(e.subarray(c,c+1));)r+=ms(e.subarray(c,c+1)),c+=1;for(r+=ms(e.subarray(c,c+1)),c+=1;"\0"!==ms(e.subarray(c,c+1));)n+=ms(e.subarray(c,c+1)),c+=1;n+=ms(e.subarray(c,c+1)),c+=1}return{schemeIdUri:r,value:n,timeScale:i,presentationTime:o,presentationTimeDelta:a,eventDuration:s,id:u,payload:e.subarray(c,e.byteLength)}}(e);if(Cd.test(n.schemeIdUri)){var i=ho(n.presentationTime)?n.presentationTime/n.timeScale:t+n.presentationTimeDelta/n.timeScale,a=4294967295===n.eventDuration?Number.POSITIVE_INFINITY:n.eventDuration/n.timeScale;a<=.001&&(a=Number.POSITIVE_INFINITY);var o=n.payload;r.samples.push({data:o,len:o.byteLength,dts:i,pts:i,type:Ou,duration:a})}}))}return r}},{key:"demuxSampleAes",value:function(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){return function(e){for(var t=e.byteLength,r=0;r<t;){var n=_s(e,r);if(n>8&&109===e[r+4]&&111===e[r+5]&&111===e[r+6]&&102===e[r+7])return!0;r=n>1?r+n:t}return!1}(e)}}]),Td=function(e,t){var r=0,n=5;t+=n;for(var i=new Uint32Array(1),a=new Uint32Array(1),o=new Uint8Array(1);n>0;){o[0]=e[t];var s=Math.min(n,8),u=8-s;a[0]=4278190080>>>24+u<<u,i[0]=(o[0]&a[0])>>u,r=r?r<<s|i[0]:i[0],t+=1,n-=s}return r},Rd=function(e){function t(e){var r;return R(this,t),(r=c(this,t)).observer=void 0,r.observer=e,r}return f(t,e),D(t,[{key:"resetInitSegment",value:function(e,r,n,i){s(t,"resetInitSegment",this)([e,r,n,i]),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:r,duration:i,inputTimeScale:9e4,dropped:0}}},{key:"canParse",value:function(e,t){return t+64<e.length}},{key:"appendFrame",value:function(e,t,r){var n=Id(e,t,r,this.basePTS,this.frameIndex);if(-1!==n)return{sample:e.samples[e.samples.length-1],length:n,missing:0}}}],[{key:"probe",value:function(e){if(!e)return!1;var t=es(e,0);if(!t)return!1;var r=t.length;return 11===e[r]&&119===e[r+1]&&void 0!==ns(t)&&Td(e,r)<16}}])}(id);function Id(e,t,r,n,i){if(r+8>t.length)return-1;if(11!==t[r]||119!==t[r+1])return-1;var a=t[r+4]>>6;if(a>=3)return-1;var o=[48e3,44100,32e3][a],s=63&t[r+4],u=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*s+a];if(r+u>t.length)return-1;var c=t[r+6]>>5,d=0;2===c?d+=2:(1&c&&1!==c&&(d+=2),4&c&&(d+=2));var l=(t[r+6]<<8|t[r+7])>>12-d&1,h=[2,1,2,3,3,4,4,5][c]+l,f=t[r+5]>>3,p=7&t[r+5],v=new Uint8Array([a<<6|f<<1|p>>2,(3&p)<<6|c<<3|l<<2|s>>4,s<<4&224]),g=n+i*(1536/o*9e4),m=t.subarray(r,r+u);return e.config=v,e.channelCount=h,e.samplerate=o,e.samples.push({unit:m,pts:g}),u}var Dd=D((function e(){R(this,e),this.VideoSample=null}),[{key:"createVideoSample",value:function(e,t,r,n){return{key:e,frame:!1,pts:t,dts:r,units:[],debug:n,length:0}}},{key:"getLastNalUnit",value:function(e){var t,r,n=this.VideoSample;if(n&&0!==n.units.length||(n=e[e.length-1]),null!=(t=n)&&t.units){var i=n.units;r=i[i.length-1]}return r}},{key:"pushAccessUnit",value:function(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){var r=t.samples,n=r.length;if(!n)return void t.dropped++;var i=r[n-1];e.pts=i.pts,e.dts=i.dts}t.samples.push(e)}e.debug.length&&Ao.log(e.pts+"/"+e.dts+":"+e.debug)}}]),Md=D((function e(t){R(this,e),this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}),[{key:"loadWord",value:function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,n=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");n.set(e.subarray(r,r+i)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}},{key:"skipBits",value:function(e){var t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;if(e>32&&Ao.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(t=e-t)>0&&this.bitsAvailable?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){for(var t=8,r=8,n=0;n<e;n++)0!==r&&(r=(t+this.readEG()+256)%256),t=0===r?t:r}},{key:"readSPS",value:function(){var e,t,r,n=0,i=0,a=0,o=0,s=this.readUByte.bind(this),u=this.readBits.bind(this),c=this.readUEG.bind(this),d=this.readBoolean.bind(this),l=this.skipBits.bind(this),h=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);s();var v=s();if(u(5),l(3),s(),f(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){var g=c();if(3===g&&l(1),f(),f(),l(1),d())for(t=3!==g?8:12,r=0;r<t;r++)d()&&p(r<6?16:64)}f();var m=c();if(0===m)c();else if(1===m)for(l(1),h(),h(),e=c(),r=0;r<e;r++)h();f(),l(1);var y=c(),_=c(),S=u(1);0===S&&l(1),l(1),d()&&(n=c(),i=c(),a=c(),o=c());var A=[1,1];if(d()&&d())switch(s()){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:A=[s()<<8|s(),s()<<8|s()]}return{width:Math.ceil(16*(y+1)-2*n-2*i),height:(2-S)*(_+1)*16-(S?2:4)*(a+o),pixelRatio:A}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),Od=function(e){function t(){return R(this,t),c(this,t,arguments)}return f(t,e),D(t,[{key:"parseAVCPES",value:function(e,t,r,n,i){var a,o=this,s=this.parseAVCNALu(e,r.data),u=this.VideoSample,c=!1;r.data=null,u&&s.length&&!e.audFound&&(this.pushAccessUnit(u,e),u=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"")),s.forEach((function(n){var s;switch(n.type){case 1:var d=!1;a=!0;var l,h=n.data;if(c&&h.length>4){var f=new Md(h).readSliceType();2!==f&&4!==f&&7!==f&&9!==f||(d=!0)}d&&null!=(l=u)&&l.frame&&!u.key&&(o.pushAccessUnit(u,e),u=o.VideoSample=null),u||(u=o.VideoSample=o.createVideoSample(!0,r.pts,r.dts,"")),u.frame=!0,u.key=d;break;case 5:a=!0,null!=(s=u)&&s.frame&&!u.key&&(o.pushAccessUnit(u,e),u=o.VideoSample=null),u||(u=o.VideoSample=o.createVideoSample(!0,r.pts,r.dts,"")),u.key=!0,u.frame=!0;break;case 6:a=!0,Ls(n.data,1,r.pts,t.samples);break;case 7:var p,v;a=!0,c=!0;var g=n.data,m=new Md(g).readSPS();if(!e.sps||e.width!==m.width||e.height!==m.height||(null==(p=e.pixelRatio)?void 0:p[0])!==m.pixelRatio[0]||(null==(v=e.pixelRatio)?void 0:v[1])!==m.pixelRatio[1]){e.width=m.width,e.height=m.height,e.pixelRatio=m.pixelRatio,e.sps=[g],e.duration=i;for(var y=g.subarray(1,4),_="avc1.",S=0;S<3;S++){var A=y[S].toString(16);A.length<2&&(A="0"+A),_+=A}e.codec=_}break;case 8:a=!0,e.pps=[n.data];break;case 9:a=!0,e.audFound=!0,u&&o.pushAccessUnit(u,e),u=o.VideoSample=o.createVideoSample(!1,r.pts,r.dts,"");break;case 12:a=!0;break;default:a=!1,u&&(u.debug+="unknown NAL "+n.type+" ")}u&&a&&u.units.push(n)})),n&&u&&(this.pushAccessUnit(u,e),this.VideoSample=null)}},{key:"parseAVCNALu",value:function(e,t){var r,n,i=t.byteLength,a=e.naluState||0,o=a,s=[],u=0,c=-1,d=0;for(-1===a&&(c=0,d=31&t[0],a=0,u=1);u<i;)if(r=t[u++],a)if(1!==a)if(r)if(1===r){if(n=u-a-1,c>=0){var l={data:t.subarray(c,n),type:d};s.push(l)}else{var h=this.getLastNalUnit(e.samples);h&&(o&&u<=4-o&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-o)),n>0&&(h.data=Os(h.data,t.subarray(0,n)),h.state=0))}u<i?(c=u,d=31&t[u],a=0):a=-1}else a=0;else a=3;else a=r?0:2;else a=r?0:1;if(c>=0&&a>=0){var f={data:t.subarray(c,i),type:d,state:a};s.push(f)}if(0===s.length){var p=this.getLastNalUnit(e.samples);p&&(p.data=Os(p.data,t))}return e.naluState=a,s}}])}(Dd),xd=D((function e(t,r,n){R(this,e),this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new Gc(r,{removePKCS7Padding:!1})}),[{key:"decryptBuffer",value:function(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}},{key:"decryptAacSample",value:function(e,t,r){var n=this,i=e[t].unit;if(!(i.length<=16)){var a=i.subarray(16,i.length-i.length%16),o=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(o).then((function(a){var o=new Uint8Array(a);i.set(o,16),n.decrypter.isSync()||n.decryptAacSamples(e,t+1,r)}))}}},{key:"decryptAacSamples",value:function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32||(this.decryptAacSample(e,t,r),this.decrypter.isSync())))return}}},{key:"getAvcEncryptedData",value:function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),n=0,i=32;i<e.length-16;i+=160,n+=16)r.set(e.subarray(i,i+16),n);return r}},{key:"getAvcDecryptedUnit",value:function(e,t){for(var r=new Uint8Array(t),n=0,i=32;i<e.length-16;i+=160,n+=16)e.set(r.subarray(n,n+16),i);return e}},{key:"decryptAvcSample",value:function(e,t,r,n,i){var a=this,o=Ns(i.data),s=this.getAvcEncryptedData(o);this.decryptBuffer(s.buffer).then((function(s){i.data=a.getAvcDecryptedUnit(o,s),a.decrypter.isSync()||a.decryptAvcSamples(e,t,r+1,n)}))}},{key:"decryptAvcSamples",value:function(e,t,r,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void n();for(var i=e[t].units;!(r>=i.length);r++){var a=i[r];if(!(a.data.length<=48||1!==a.type&&5!==a.type||(this.decryptAvcSample(e,t,r,n,a),this.decrypter.isSync())))return}}}}]),Pd=188,Ld=function(){function e(t,r,n){R(this,e),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=t,this.config=r,this.typeSupported=n,this.videoParser=new Od}return D(e,[{key:"resetInitSegment",value:function(t,r,n,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=e.createTrack("video"),this._audioTrack=e.createTrack("audio",i),this._id3Track=e.createTrack("id3"),this._txtTrack=e.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=r,this.videoCodec=n,this._duration=i}},{key:"resetTimeStamp",value:function(){}},{key:"resetContiguity",value:function(){var e=this._audioTrack,t=this._videoTrack,r=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}},{key:"demux",value:function(t,r){var n,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];i||(this.sampleAes=null);var o=this._videoTrack,s=this._audioTrack,u=this._id3Track,c=this._txtTrack,d=o.pid,l=o.pesData,h=s.pid,f=u.pid,p=s.pesData,v=u.pesData,g=null,m=this.pmtParsed,y=this._pmtId,_=t.length;if(this.remainderData&&(_=(t=Os(this.remainderData,t)).length,this.remainderData=null),_<Pd&&!a)return this.remainderData=t,{audioTrack:s,videoTrack:o,id3Track:u,textTrack:c};var S=Math.max(0,e.syncOffset(t));(_-=(_-S)%Pd)<t.byteLength&&!a&&(this.remainderData=new Uint8Array(t.buffer,_,t.buffer.byteLength-_));for(var A=0,b=S;b<_;b+=Pd)if(71===t[b]){var E=!!(64&t[b+1]),k=Nd(t,b),C=void 0;if((48&t[b+3])>>4>1){if((C=b+5+t[b+4])===b+Pd)continue}else C=b+4;switch(k){case d:E&&(l&&(n=Wd(l))&&this.videoParser.parseAVCPES(o,c,n,!1,this._duration),l={data:[],size:0}),l&&(l.data.push(t.subarray(C,b+Pd)),l.size+=b+Pd-C);break;case h:if(E){if(p&&(n=Wd(p)))switch(s.segmentCodec){case"aac":this.parseAACPES(s,n);break;case"mp3":this.parseMPEGPES(s,n);break;case"ac3":this.parseAC3PES(s,n)}p={data:[],size:0}}p&&(p.data.push(t.subarray(C,b+Pd)),p.size+=b+Pd-C);break;case f:E&&(v&&(n=Wd(v))&&this.parseID3PES(u,n),v={data:[],size:0}),v&&(v.data.push(t.subarray(C,b+Pd)),v.size+=b+Pd-C);break;case 0:E&&(C+=t[C]+1),y=this._pmtId=Vd(t,C);break;case y:E&&(C+=t[C]+1);var w=Ud(t,C,this.typeSupported,i,this.observer);(d=w.videoPid)>0&&(o.pid=d,o.segmentCodec=w.segmentVideoCodec),(h=w.audioPid)>0&&(s.pid=h,s.segmentCodec=w.segmentAudioCodec),(f=w.id3Pid)>0&&(u.pid=f),null===g||m||(Ao.warn("MPEG-TS PMT found at ".concat(b," after unknown PID '").concat(g,"'. Backtracking to sync byte @").concat(S," to parse all TS packets.")),g=null,b=S-188),m=this.pmtParsed=!0;break;case 17:case 8191:break;default:g=k}}else A++;A>0&&Fd(this.observer,new Error("Found ".concat(A," TS packet/s that do not start with 0x47"))),o.pesData=l,s.pesData=p,u.pesData=v;var T={audioTrack:s,videoTrack:o,id3Track:u,textTrack:c};return a&&this.extractRemainingSamples(T),T}},{key:"flush",value:function(){var e,t=this.remainderData;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e}},{key:"extractRemainingSamples",value:function(e){var t,r=e.audioTrack,n=e.videoTrack,i=e.id3Track,a=e.textTrack,o=n.pesData,s=r.pesData,u=i.pesData;if(o&&(t=Wd(o))?(this.videoParser.parseAVCPES(n,a,t,!0,this._duration),n.pesData=null):n.pesData=o,s&&(t=Wd(s))){switch(r.segmentCodec){case"aac":this.parseAACPES(r,t);break;case"mp3":this.parseMPEGPES(r,t);break;case"ac3":this.parseAC3PES(r,t)}r.pesData=null}else null!=s&&s.size&&Ao.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=s;u&&(t=Wd(u))?(this.parseID3PES(i,t),i.pesData=null):i.pesData=u}},{key:"demuxSampleAes",value:function(e,t,r){var n=this.demux(e,r,!0,!this.config.progressive),i=this.sampleAes=new xd(this.observer,this.config,t);return this.decrypt(n,i)}},{key:"decrypt",value:function(e,t){return new Promise((function(r){var n=e.audioTrack,i=e.videoTrack;n.samples&&"aac"===n.segmentCodec?t.decryptAacSamples(n.samples,0,(function(){i.samples?t.decryptAvcSamples(i.samples,0,0,(function(){r(e)})):r(e)})):i.samples&&t.decryptAvcSamples(i.samples,0,0,(function(){r(e)}))}))}},{key:"destroy",value:function(){this._duration=0}},{key:"parseAACPES",value:function(e,t){var r,n,i,a=0,o=this.aacOverFlow,s=t.data;if(o){this.aacOverFlow=null;var u=o.missing,c=o.sample.unit.byteLength;if(-1===u)s=Os(o.sample.unit,s);else{var d=c-u;o.sample.unit.set(s.subarray(0,u),d),e.samples.push(o.sample),a=o.missing}}for(r=a,n=s.length;r<n-1&&!cd(s,r);r++);if(r!==a){var l,h=r<n-1;if(l=h?"AAC PES did not start with ADTS header,offset:".concat(r):"No ADTS header found in AAC PES",Fd(this.observer,new Error(l),h),!h)return}if(ld(e,this.observer,s,r,this.audioCodec),void 0!==t.pts)i=t.pts;else{if(!o)return void Ao.warn("[tsdemuxer]: AAC PES unknown PTS");var f=hd(e.samplerate);i=o.sample.pts+f}for(var p,v=0;r<n;){if(r+=(p=fd(e,s,r,i,v)).length,p.missing){this.aacOverFlow=p;break}for(v++;r<n-1&&!cd(s,r);r++);}}},{key:"parseMPEGPES",value:function(e,t){var r=t.data,n=r.length,i=0,a=0,o=t.pts;if(void 0!==o)for(;a<n;)if(bd(r,a)){var s=_d(e,r,a,o,i);if(!s)break;a+=s.length,i++}else a++;else Ao.warn("[tsdemuxer]: MPEG PES unknown PTS")}},{key:"parseAC3PES",value:function(e,t){var r=t.data,n=t.pts;if(void 0!==n)for(var i,a=r.length,o=0,s=0;s<a&&(i=Id(e,r,s,n,o++))>0;)s+=i;else Ao.warn("[tsdemuxer]: AC3 PES unknown PTS")}},{key:"parseID3PES",value:function(e,t){if(void 0!==t.pts){var r=lo({},t,{type:this._videoTrack?Ou:Mu,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}else Ao.warn("[tsdemuxer]: ID3 PES unknown PTS")}}],[{key:"probe",value:function(t){var r=e.syncOffset(t);return r>0&&Ao.warn("MPEG2-TS detected but first sync word found @ offset ".concat(r)),-1!==r}},{key:"syncOffset",value:function(e){for(var t=e.length,r=Math.min(940,t-Pd)+1,n=0;n<r;){for(var i=!1,a=-1,o=0,s=n;s<t;s+=Pd){if(71!==e[s]||t-s!==Pd&&71!==e[s+Pd]){if(o)return-1;break}if(o++,-1===a&&0!==(a=s)&&(r=Math.min(a+18612,e.length-Pd)+1),i||(i=0===Nd(e,s)),i&&o>1&&(0===a&&o>2||s+Pd>r))return a}n++}return-1}},{key:"createTrack",value:function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:gs[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}}])}();function Nd(e,t){return((31&e[t+1])<<8)+e[t+2]}function Vd(e,t){return(31&e[t+10])<<8|e[t+11]}function Ud(e,t,r,n,i){var a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<o;){var s=Nd(e,t),u=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!n){Bd("ADTS AAC");break}case 15:-1===a.audioPid&&(a.audioPid=s);break;case 21:-1===a.id3Pid&&(a.id3Pid=s);break;case 219:if(!n){Bd("H.264");break}case 27:-1===a.videoPid&&(a.videoPid=s,a.segmentVideoCodec="avc");break;case 3:case 4:r.mpeg||r.mp3?-1===a.audioPid&&(a.audioPid=s,a.segmentAudioCodec="mp3"):Ao.log("MPEG audio found, not supported in this browser");break;case 193:if(!n){Bd("AC-3");break}case 129:r.ac3?-1===a.audioPid&&(a.audioPid=s,a.segmentAudioCodec="ac3"):Ao.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===a.audioPid&&u>0)for(var c=t+5,d=u;d>2;){106===e[c]&&(!0!==r.ac3?Ao.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=s,a.segmentAudioCodec="ac3"));var l=e[c+1]+2;c+=l,d-=l}break;case 194:case 135:return Fd(i,new Error("Unsupported EC-3 in M2TS found")),a;case 36:return Fd(i,new Error("Unsupported HEVC in M2TS found")),a}t+=u+5}return a}function Fd(e,t,r){Ao.warn("parsing error: ".concat(t.message)),e.emit(vo.ERROR,vo.ERROR,{type:go.MEDIA_ERROR,details:mo.FRAG_PARSING_ERROR,fatal:!1,levelRetry:r,error:t,reason:t.message})}function Bd(e){Ao.log("".concat(e," with AES-128-CBC encryption found in unencrypted stream"))}function Wd(e){var t,r,n,i,a,o=0,s=e.data;if(!e||0===e.size)return null;for(;s[0].length<19&&s.length>1;)s[0]=Os(s[0],s[1]),s.splice(1,1);if(1===((t=s[0])[0]<<16)+(t[1]<<8)+t[2]){if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;var u=t[7];192&u&&(i=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&u?i-(a=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)>54e5&&(Ao.warn("".concat(Math.round((i-a)/9e4),"s delta between PTS and DTS, align them")),i=a):a=i);var c=(n=t[8])+9;if(e.size<=c)return null;e.size-=c;for(var d=new Uint8Array(e.size),l=0,h=s.length;l<h;l++){var f=(t=s[l]).byteLength;if(c){if(c>f){c-=f;continue}t=t.subarray(c),f-=c,c=0}d.set(t,o),o+=f}return r&&(r-=n+3),{data:d,pts:i,dts:a,len:r}}return null}var Gd=function(e){function t(){return R(this,t),c(this,t,arguments)}return f(t,e),D(t,[{key:"resetInitSegment",value:function(e,r,n,i){s(t,"resetInitSegment",this)([e,r,n,i]),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:r,duration:i,inputTimeScale:9e4,dropped:0}}},{key:"canParse",value:function(e,t){return function(e,t){return Ad(e,t)&&4<=e.length-t}(e,t)}},{key:"appendFrame",value:function(e,t,r){if(null!==this.basePTS)return _d(e,t,r,this.basePTS,this.frameIndex)}}],[{key:"probe",value:function(e){if(!e)return!1;var t=es(e,0),r=(null==t?void 0:t.length)||0;if(t&&11===e[r]&&119===e[r+1]&&void 0!==ns(t)&&Td(e,r)<=16)return!1;for(var n=e.length;r<n;r++)if(Ed(e,r))return Ao.log("MPEG Audio sync word found !"),!0;return!1}}])}(id),Hd=D((function e(){R(this,e)}),null,[{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}]),jd=Math.pow(2,32)-1,Kd=function(){function e(){R(this,e)}return D(e,null,[{key:"init",value:function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:r,audio:n};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,o,u,o,s),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))}},{key:"box",value:function(e){for(var t=8,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=n.length,o=a;a--;)t+=n[a].byteLength;var s=new Uint8Array(t);for(s[0]=t>>24&255,s[1]=t>>16&255,s[2]=t>>8&255,s[3]=255&t,s.set(e,4),a=0,t=8;a<o;a++)s.set(n[a],t),t+=n[a].byteLength;return s}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,r){r*=t;var n=Math.floor(r/(jd+1)),i=Math.floor(r%(jd+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,r,n){return e.box(e.types.moof,e.mfhd(t),e.traf(n,r))}},{key:"moov",value:function(t){for(var r=t.length,n=[];r--;)n[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(n).concat(e.mvex(t)))}},{key:"mvex",value:function(t){for(var r=t.length,n=[];r--;)n[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(n))}},{key:"mvhd",value:function(t,r){r*=t;var n=Math.floor(r/(jd+1)),i=Math.floor(r%(jd+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,a)}},{key:"sdtp",value:function(t){var r,n,i=t.samples||[],a=new Uint8Array(4+i.length);for(r=0;r<i.length;r++)n=i[r].flags,a[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,a)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var r,n,i,a=[],o=[];for(r=0;r<t.sps.length;r++)i=(n=t.sps[r]).byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(n));for(r=0;r<t.pps.length;r++)i=(n=t.pps[r]).byteLength,o.push(i>>>8&255),o.push(255&i),o=o.concat(Array.prototype.slice.call(n));var s=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(o))),u=t.width,c=t.height,d=t.pixelRatio[0],l=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,l>>24,l>>16&255,l>>8&255,255&l])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"audioStsd",value:function(e){var t=e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0])}},{key:"mp4a",value:function(t){return e.box(e.types.mp4a,e.audioStsd(t),e.box(e.types.esds,e.esds(t)))}},{key:"mp3",value:function(t){return e.box(e.types[".mp3"],e.audioStsd(t))}},{key:"ac3",value:function(t){return e.box(e.types["ac-3"],e.audioStsd(t),e.box(e.types.dac3,t.config))}},{key:"stsd",value:function(t){return"audio"===t.type?"mp3"===t.segmentCodec&&"mp3"===t.codec?e.box(e.types.stsd,e.STSD,e.mp3(t)):"ac3"===t.segmentCodec?e.box(e.types.stsd,e.STSD,e.ac3(t)):e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var r=t.id,n=t.duration*t.timescale,i=t.width,a=t.height,o=Math.floor(n/(jd+1)),s=Math.floor(n%(jd+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,a>>8&255,255&a,0,0]))}},{key:"traf",value:function(t,r){var n=e.sdtp(t),i=t.id,a=Math.floor(r/(jd+1)),o=Math.floor(r%(jd+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o])),e.trun(t,n.length+16+20+8+16+8+8),n)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var r=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,r){var n,i,a,o,s,u,c=t.samples||[],d=c.length,l=12+16*d,h=new Uint8Array(l);for(r+=8+l,h.set(["video"===t.type?1:0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),n=0;n<d;n++)a=(i=c[n]).duration,o=i.size,s=i.flags,u=i.cts,h.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,o>>>24&255,o>>>16&255,o>>>8&255,255&o,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*n);return e.box(e.types.trun,h)}},{key:"initSegment",value:function(t){e.types||e.init();var r=e.moov(t);return Os(e.FTYP,r)}}])}();function zd(e,t){var r=e*t*(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1);return arguments.length>3&&void 0!==arguments[3]&&arguments[3]?Math.round(r):r}function qd(e){return zd(e,1e3,11111111111111112e-21,arguments.length>1&&void 0!==arguments[1]&&arguments[1])}Kd.types=void 0,Kd.HDLR_TYPES=void 0,Kd.STTS=void 0,Kd.STSC=void 0,Kd.STCO=void 0,Kd.STSZ=void 0,Kd.VMHD=void 0,Kd.SMHD=void 0,Kd.STSD=void 0,Kd.FTYP=void 0,Kd.DINF=void 0;var Yd=null,Xd=null,Qd=D((function e(t,r,n){if(R(this,e),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=t,this.config=r,this.typeSupported=n,this.ISGenerated=!1,null===Yd){var i=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Yd=i?parseInt(i[1]):0}if(null===Xd){var a=navigator.userAgent.match(/Safari\/(\d+)/i);Xd=a?parseInt(a[1]):0}}),[{key:"destroy",value:function(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}},{key:"resetTimeStamp",value:function(e){Ao.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}},{key:"resetNextTimestamp",value:function(){Ao.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}},{key:"resetInitSegment",value:function(){Ao.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}},{key:"getVideoStartPts",value:function(e){var t=!1,r=e.reduce((function(e,r){var n=r.pts-e;return n<-4294967296?(t=!0,Jd(e,r.pts)):n>0?e:r.pts}),e[0].pts);return t&&Ao.debug("PTS rollover detected"),r}},{key:"remux",value:function(e,t,r,n,i,a,o,s){var u,c,d,l,h,f,p=i,v=i,g=e.pid>-1,m=t.pid>-1,y=t.samples.length,_=e.samples.length>0,S=o&&y>0||y>1;if((!g||_)&&(!m||S)||this.ISGenerated||o){if(this.ISGenerated){var A,b,E,k,C=this.videoTrackConfig;!C||t.width===C.width&&t.height===C.height&&(null==(A=t.pixelRatio)?void 0:A[0])===(null==(b=C.pixelRatio)?void 0:b[0])&&(null==(E=t.pixelRatio)?void 0:E[1])===(null==(k=C.pixelRatio)?void 0:k[1])||this.resetInitSegment()}else d=this.generateIS(e,t,i,a);var w,T=this.isVideoContiguous,R=-1;if(S&&(R=function(e){for(var t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!T&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,R>0){Ao.warn("[mp4-remuxer]: Dropped ".concat(R," out of ").concat(y," video samples due to a missing keyframe"));var I=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(R),t.dropped+=R,w=v+=(t.samples[0].pts-I)/t.inputTimeScale}else-1===R&&(Ao.warn("[mp4-remuxer]: No keyframe found out of ".concat(y," video samples")),f=!1);if(this.ISGenerated){if(_&&S){var D=this.getVideoStartPts(t.samples),M=(Jd(e.samples[0].pts,D)-D)/t.inputTimeScale;p+=Math.max(0,M),v+=Math.max(0,-M)}if(_){if(e.samplerate||(Ao.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(e,t,i,a)),c=this.remuxAudio(e,p,this.isAudioContiguous,a,m||S||s===Au?v:void 0),S){var O=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(Ao.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(e,t,i,a)),u=this.remuxVideo(t,v,T,O)}}else S&&(u=this.remuxVideo(t,v,T,0));u&&(u.firstKeyFrame=R,u.independent=-1!==R,u.firstKeyFramePTS=w)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(h=$d(r,i,this._initPTS,this._initDTS)),n.samples.length&&(l=Zd(n,i,this._initPTS))),{audio:c,video:u,initSegment:d,independent:f,text:l,id3:h}}},{key:"generateIS",value:function(e,t,r,n){var i,a,o,s=e.samples,u=t.samples,c=this.typeSupported,d={},l=this._initPTS,h=!l||n,f="audio/mp4";if(h&&(i=a=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":c.mpeg?(f="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}d.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&c.mpeg?new Uint8Array(0):Kd.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(o=e.inputTimeScale,l&&o===l.timescale?h=!1:i=a=s[0].pts-Math.round(o*r))}if(t.sps&&t.pps&&u.length){if(t.timescale=t.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Kd.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(o=t.inputTimeScale,l&&o===l.timescale)h=!1;else{var p=this.getVideoStartPts(u),v=Math.round(o*r);a=Math.min(a,Jd(u[0].dts,p)-v),i=Math.min(i,p-v)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(d).length)return this.ISGenerated=!0,h?(this._initPTS={baseTime:i,timescale:o},this._initDTS={baseTime:a,timescale:o}):i=o=void 0,{tracks:d,initPTS:i,timescale:o}}},{key:"remuxVideo",value:function(e,t,r,n){var i,a,o=e.inputTimeScale,s=e.samples,u=[],c=s.length,d=this._initPTS,l=this.nextAvcDts,h=8,f=this.videoSampleDuration,p=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,g=!1;if(!r||null===l){var m=t*o,y=s[0].pts-Jd(s[0].dts,s[0].pts);Yd&&null!==l&&Math.abs(m-y-l)<15e3?r=!0:l=m-y}for(var _=d.baseTime*o/d.timescale,S=0;S<c;S++){var A=s[S];A.pts=Jd(A.pts-_,l),A.dts=Jd(A.dts-_,l),A.dts<s[S>0?S-1:S].dts&&(g=!0)}g&&s.sort((function(e,t){var r=e.dts-t.dts,n=e.pts-t.pts;return r||n})),i=s[0].dts;var b=s[s.length-1].dts-i,E=b?Math.round(b/(c-1)):f||e.inputTimeScale/30;if(r){var k=i-l,C=k>E,w=k<-1;if((C||w)&&(C?Ao.warn("AVC: ".concat(qd(k,!0)," ms (").concat(k,"dts) hole between fragments detected at ").concat(t.toFixed(3))):Ao.warn("AVC: ".concat(qd(-k,!0)," ms (").concat(k,"dts) overlapping between fragments detected at ").concat(t.toFixed(3))),!w||l>=s[0].pts||Yd)){i=l;var T=s[0].pts-k;if(C)s[0].dts=i,s[0].pts=T;else for(var R=0;R<s.length&&!(s[R].dts>T);R++)s[R].dts-=k,s[R].pts-=k;Ao.log("Video: Initial PTS/DTS adjusted: ".concat(qd(T,!0),"/").concat(qd(i,!0),", delta: ").concat(qd(k,!0)," ms"))}}for(var I=0,D=0,M=i=Math.max(0,i),O=0;O<c;O++){for(var x=s[O],P=x.units,L=P.length,N=0,V=0;V<L;V++)N+=P[V].data.length;D+=N,I+=L,x.length=N,x.dts<M?(x.dts=M,M+=E/4|0||1):M=x.dts,p=Math.min(x.pts,p),v=Math.max(x.pts,v)}a=s[c-1].dts;var U,F=D+4*I+8;try{U=new Uint8Array(F)}catch(e){return void this.observer.emit(vo.ERROR,vo.ERROR,{type:go.MUX_ERROR,details:mo.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:F,reason:"fail allocating video mdat ".concat(F)})}var B=new DataView(U.buffer);B.setUint32(0,F),U.set(Kd.types.mdat,4);for(var W=!1,G=Number.POSITIVE_INFINITY,H=Number.POSITIVE_INFINITY,j=Number.NEGATIVE_INFINITY,K=Number.NEGATIVE_INFINITY,z=0;z<c;z++){for(var q=s[z],Y=q.units,X=0,Q=0,J=Y.length;Q<J;Q++){var $=Y[Q],Z=$.data,ee=$.data.byteLength;B.setUint32(h,ee),h+=4,U.set(Z,h),h+=ee,X+=4+ee}var te=void 0;if(z<c-1)f=s[z+1].dts-q.dts,te=s[z+1].pts-q.pts;else{var re=this.config,ne=z>0?q.dts-s[z-1].dts:E;if(te=z>0?q.pts-s[z-1].pts:E,re.stretchShortVideoTrack&&null!==this.nextAudioPts){var ie=Math.floor(re.maxBufferHole*o),ae=(n?p+n*o:this.nextAudioPts)-q.pts;ae>ie?((f=ae-ne)<0?f=ne:W=!0,Ao.log("[mp4-remuxer]: It is approximately ".concat(ae/90," ms to the next segment; using duration ").concat(f/90," ms for the last video frame."))):f=ne}else f=ne}var oe=Math.round(q.pts-q.dts);G=Math.min(G,f),j=Math.max(j,f),H=Math.min(H,te),K=Math.max(K,te),u.push(new tl(q.key,f,X,oe))}if(u.length)if(Yd){if(Yd<70){var se=u[0].flags;se.dependsOn=2,se.isNonSync=0}}else if(Xd&&K-H<j-G&&E/j<.025&&0===u[0].cts){Ao.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var ue=i,ce=0,de=u.length;ce<de;ce++){var le=ue+u[ce].duration,he=ue+u[ce].cts;if(ce<de-1){var fe=le+u[ce+1].cts;u[ce].duration=fe-he}else u[ce].duration=ce?u[ce-1].duration:E;u[ce].cts=0,ue=le}}f=W||!f?E:f,this.nextAvcDts=l=a+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;var pe={data1:Kd.moof(e.sequenceNumber++,i,lo({},e,{samples:u})),data2:U,startPTS:p/o,endPTS:(v+f)/o,startDTS:i/o,endDTS:l/o,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,pe}},{key:"getSamplesPerFrame",value:function(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}},{key:"remuxAudio",value:function(e,t,r,n,i){var a=e.inputTimeScale,o=a/(e.samplerate?e.samplerate:a),s=this.getSamplesPerFrame(e),u=s*o,c=this._initPTS,d="mp3"===e.segmentCodec&&this.typeSupported.mpeg,l=[],h=void 0!==i,f=e.samples,p=d?0:8,v=this.nextAudioPts||-1,g=t*a,m=c.baseTime*a/c.timescale;if(this.isAudioContiguous=r=r||f.length&&v>0&&(n&&Math.abs(g-v)<9e3||Math.abs(Jd(f[0].pts-m,g)-v)<20*u),f.forEach((function(e){e.pts=Jd(e.pts-m,g)})),!r||v<0){if(!(f=f.filter((function(e){return e.pts>=0}))).length)return;v=0===i?0:n&&!h?Math.max(0,g):f[0].pts}if("aac"===e.segmentCodec)for(var y=this.config.maxAudioFramesDrift,_=0,S=v;_<f.length;_++){var A=f[_],b=A.pts,E=b-S,k=Math.abs(1e3*E/a);if(E<=-y*u&&h)0===_&&(Ao.warn("Audio frame @ ".concat((b/a).toFixed(3),"s overlaps nextAudioPts by ").concat(Math.round(1e3*E/a)," ms.")),this.nextAudioPts=v=S=b);else if(E>=y*u&&k<1e4&&h){var C=Math.round(E/u);(S=b-C*u)<0&&(C--,S+=u),0===_&&(this.nextAudioPts=v=S),Ao.warn("[mp4-remuxer]: Injecting ".concat(C," audio frame @ ").concat((S/a).toFixed(3),"s due to ").concat(Math.round(1e3*E/a)," ms gap."));for(var w=0;w<C;w++){var T=Math.max(S,0),R=Hd.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);R||(Ao.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),R=A.unit.subarray()),f.splice(_,0,{unit:R,pts:T}),S+=u,_++}}A.pts=S,S+=u}for(var I,D=null,M=null,O=0,x=f.length;x--;)O+=f[x].unit.byteLength;for(var P=0,L=f.length;P<L;P++){var N=f[P],V=N.unit,U=N.pts;if(null!==M)l[P-1].duration=Math.round((U-M)/o);else{if(r&&"aac"===e.segmentCodec&&(U=v),D=U,!(O>0))return;O+=p;try{I=new Uint8Array(O)}catch(e){return void this.observer.emit(vo.ERROR,vo.ERROR,{type:go.MUX_ERROR,details:mo.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:O,reason:"fail allocating audio mdat ".concat(O)})}d||(new DataView(I.buffer).setUint32(0,O),I.set(Kd.types.mdat,4))}I.set(V,p);var F=V.byteLength;p+=F,l.push(new tl(!0,s,F,0)),M=U}var B=l.length;if(B){var W=l[l.length-1];this.nextAudioPts=v=M+o*W.duration;var G=d?new Uint8Array(0):Kd.moof(e.sequenceNumber++,D/o,lo({},e,{samples:l}));e.samples=[];var H=D/a,j=v/a,K={data1:G,data2:I,startPTS:H,endPTS:j,startDTS:H,endDTS:j,type:"audio",hasAudio:!0,hasVideo:!1,nb:B};return this.isAudioContiguous=!0,K}}},{key:"remuxEmptyAudio",value:function(e,t,r,n){var i=e.inputTimeScale,a=i/(e.samplerate?e.samplerate:i),o=this.nextAudioPts,s=this._initDTS,u=9e4*s.baseTime/s.timescale,c=(null!==o?o:n.startDTS*i)+u,d=n.endDTS*i+u,l=1024*a,h=Math.ceil((d-c)/l),f=Hd.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(Ao.warn("[mp4-remuxer]: remux empty Audio"),f){for(var p=[],v=0;v<h;v++){var g=c+v*l;p.push({unit:f,pts:g,dts:g})}return e.samples=p,this.remuxAudio(e,t,r,!1)}Ao.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")}}]);function Jd(e,t){var r;if(null===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}function $d(e,t,r,n){var i=e.samples.length;if(i){for(var a=e.inputTimeScale,o=0;o<i;o++){var s=e.samples[o];s.pts=Jd(s.pts-r.baseTime*a/r.timescale,t*a)/a,s.dts=Jd(s.dts-n.baseTime*a/n.timescale,t*a)/a}var u=e.samples;return e.samples=[],{samples:u}}}function Zd(e,t,r){var n=e.samples.length;if(n){for(var i=e.inputTimeScale,a=0;a<n;a++){var o=e.samples[a];o.pts=Jd(o.pts-r.baseTime*i/r.timescale,t*i)/i}e.samples.sort((function(e,t){return e.pts-t.pts}));var s=e.samples;return e.samples=[],{samples:s}}}var el,tl=D((function e(t,r,n,i){R(this,e),this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=r,this.size=n,this.cts=i,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:t?2:1,isNonSync:t?0:1}})),rl=D((function e(){R(this,e),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}),[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(e){this.initPTS=e,this.lastEndTime=null}},{key:"resetNextTimestamp",value:function(){this.lastEndTime=null}},{key:"resetInitSegment",value:function(e,t,r,n){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(function(e,t){if(!e||!t)return e;var r=t.keyId;return r&&t.isCommonEncryption&&Es(e,["moov","trak"]).forEach((function(e){var t=Es(e,["mdia","minf","stbl","stsd"])[0].subarray(8),n=Es(t,["enca"]),i=n.length>0;i||(n=Es(t,["encv"])),n.forEach((function(e){Es(i?e.subarray(28):e.subarray(78),["sinf"]).forEach((function(e){var t=Ds(e);if(t){var n=t.subarray(8,24);n.some((function(e){return 0!==e}))||(Ao.log("[eme] Patching keyId in 'enc".concat(i?"a":"v",">sinf>>tenc' box: ").concat(fs(n)," -> ").concat(fs(r))),t.set(r,8))}}))}))})),e}(e,n)),this.emitInitSegment=!0}},{key:"generateInitSegment",value:function(e){var t=this.audioCodec,r=this.videoCodec;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var n=this.initData=Cs(e);n.audio&&(t=nl(n.audio,Ro)),n.video&&(r=nl(n.video,Io));var i={};n.audio&&n.video?i.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:n.audio?i.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:n.video?i.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:Ao.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i}},{key:"remux",value:function(e,t,r,n,i,a){var o,s,u=this.initPTS,c=this.lastEndTime,d={audio:void 0,video:void 0,text:n,id3:r,initSegment:void 0};ho(c)||(c=this.lastEndTime=i||0);var l=t.samples;if(null==l||!l.length)return d;var h={initPTS:void 0,timescale:1},f=this.initData;if(null!=(o=f)&&o.length||(this.generateInitSegment(l),f=this.initData),null==(s=f)||!s.length)return Ao.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);var p=function(e,t){for(var r=0,n=0,i=0,a=Es(e,["moof","traf"]),o=0;o<a.length;o++){var s=a[o],u=Es(s,["tfhd"])[0],c=t[_s(u,4)];if(c){var d=c.default,l=_s(u,0)|(null==d?void 0:d.flags),h=null==d?void 0:d.duration;8&l&&(h=_s(u,2&l?12:8));for(var f=c.timescale||9e4,p=Es(s,["trun"]),v=0;v<p.length;v++)!(r=Ms(p[v]))&&h&&(r=h*_s(p[v],4)),c.type===Io?n+=r/f:c.type===Ro&&(i+=r/f)}}if(0===n&&0===i){for(var g=1/0,m=0,y=0,_=Es(e,["sidx"]),S=0;S<_.length;S++){var A=ks(_[S]);if(null!=A&&A.references){g=Math.min(g,A.earliestPresentationTime/A.timescale);var b=A.references.reduce((function(e,t){return e+t.info.duration||0}),0);y=(m=Math.max(m,b+A.earliestPresentationTime/A.timescale))-g}}if(y&&ho(y))return y}return n||i}(l,f),v=function(e,t){return Es(t,["moof","traf"]).reduce((function(t,r){var n=Es(r,["tfdt"])[0],i=n[0],a=Es(r,["tfhd"]).reduce((function(t,r){var a=_s(r,4),o=e[a];if(o){var s=_s(n,4);if(1===i){if(s===ps)return Ao.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;s*=ps+1,s+=_s(n,8)}var u=s/(o.timescale||9e4);if(ho(u)&&(null===t||u<t))return u}return t}),null);return null!==a&&ho(a)&&(null===t||a<t)?a:t}),null)}(f,l),g=null===v?i:v;(function(e,t,r,n){if(null===e)return!0;var i=Math.max(n,1),a=t-e.baseTime/e.timescale;return Math.abs(a-r)>i}(u,g,i,p)||h.timescale!==u.timescale&&a)&&(h.initPTS=g-i,u&&1===u.timescale&&Ao.warn("Adjusting initPTS by ".concat(h.initPTS-u.baseTime)),this.initPTS=u={baseTime:h.initPTS,timescale:1});var m=e?g-u.baseTime/u.timescale:c,y=m+p;!function(e,t,r){Es(t,["moof","traf"]).forEach((function(t){Es(t,["tfhd"]).forEach((function(n){var i=_s(n,4),a=e[i];if(a){var o=a.timescale||9e4;Es(t,["tfdt"]).forEach((function(e){var t=e[0],n=r*o;if(n){var i=_s(e,4);if(0===t)i-=n,bs(e,4,i=Math.max(i,0));else{i*=Math.pow(2,32),i+=_s(e,8),i-=n,i=Math.max(i,0);var a=Math.floor(i/(ps+1)),s=Math.floor(i%(ps+1));bs(e,4,a),bs(e,8,s)}}}))}}))}))}(f,l,u.baseTime/u.timescale),p>0?this.lastEndTime=y:(Ao.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var _=!!f.audio,S=!!f.video,A="";_&&(A+="audio"),S&&(A+="video");var b={data1:l,startPTS:m,startDTS:m,endPTS:y,endDTS:y,type:A,hasAudio:_,hasVideo:S,nb:1,dropped:0};return d.audio="audio"===b.type?b:void 0,d.video="audio"!==b.type?b:void 0,d.initSegment=h,d.id3=$d(r,i,u,u),n.samples.length&&(d.text=Zd(n,i,u)),d}}]);function nl(e,t){var r=null==e?void 0:e.codec;if(r&&r.length>4)return r;if(t===Ro){if("ec-3"===r||"ac-3"===r||"alac"===r)return r;if("fLaC"===r||"Opus"===r)return tu(r,!1);var n="mp4a.40.5";return Ao.info('Parsed audio codec "'.concat(r,'" or audio object type not handled. Using "').concat(n,'"')),n}return Ao.warn('Unhandled video codec "'.concat(r,'"')),"hvc1"===r||"hev1"===r?"hvc1.1.6.L120.90":"av01"===r?"av01.0.04M.08":"avc1.42e01e"}try{el=self.performance.now.bind(self.performance)}catch(e){Ao.debug("Unable to use Performance API on this environment"),el=null==Vo?void 0:Vo.Date.now}var il=[{demux:wd,remux:rl},{demux:Ld,remux:Qd},{demux:kd,remux:Qd},{demux:Gd,remux:Qd}];il.splice(2,0,{demux:Rd,remux:Qd});var al=D((function e(t,r,n,i,a){R(this,e),this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=r,this.config=n,this.vendor=i,this.id=a}),[{key:"configure",value:function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}},{key:"push",value:function(e,t,r,n){var i=this,a=r.transmuxing;a.executeStart=el();var o=new Uint8Array(e),s=this.currentTransmuxState,u=this.transmuxConfig;n&&(this.currentTransmuxState=n);var c=n||s,d=c.contiguous,l=c.discontinuity,h=c.trackSwitch,f=c.accurateTimeOffset,p=c.timeOffset,v=c.initSegmentChange,g=u.audioCodec,m=u.videoCodec,y=u.defaultInitPts,_=u.duration,S=u.initSegmentData,A=function(e,t){var r=null;return e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(r=t),r}(o,t);if(A&&"AES-128"===A.method){var b=this.getDecrypter();if(!b.isSync())return this.decryptionPromise=b.webCryptoDecrypt(o,A.key.buffer,A.iv.buffer).then((function(e){var t=i.push(e,null,r);return i.decryptionPromise=null,t})),this.decryptionPromise;var E=b.softwareDecrypt(o,A.key.buffer,A.iv.buffer);if(r.part>-1&&(E=b.flush()),!E)return a.executeEnd=el(),ol(r);o=new Uint8Array(E)}var k=this.needsProbing(l,h);if(k){var C=this.configureTransmuxer(o);if(C)return Ao.warn("[transmuxer] ".concat(C.message)),this.observer.emit(vo.ERROR,vo.ERROR,{type:go.MEDIA_ERROR,details:mo.FRAG_PARSING_ERROR,fatal:!1,error:C,reason:C.message}),a.executeEnd=el(),ol(r)}(l||h||v||k)&&this.resetInitSegment(S,g,m,_,t),(l||v||k)&&this.resetInitialTimestamp(y),d||this.resetContiguity();var w=this.transmux(o,A,p,f,r),T=this.currentTransmuxState;return T.contiguous=!0,T.discontinuity=!1,T.trackSwitch=!1,a.executeEnd=el(),w}},{key:"flush",value:function(e){var t=this,r=e.transmuxing;r.executeStart=el();var n=this.decrypter,i=this.currentTransmuxState,a=this.decryptionPromise;if(a)return a.then((function(){return t.flush(e)}));var o=[],s=i.timeOffset;if(n){var u=n.flush();u&&o.push(this.push(u,null,e))}var c=this.demuxer,d=this.remuxer;if(!c||!d)return r.executeEnd=el(),[ol(e)];var l=c.flush(s);return sl(l)?l.then((function(r){return t.flushRemux(o,r,e),o})):(this.flushRemux(o,l,e),o)}},{key:"flushRemux",value:function(e,t,r){var n=t.audioTrack,i=t.videoTrack,a=t.id3Track,o=t.textTrack,s=this.currentTransmuxState,u=s.accurateTimeOffset,c=s.timeOffset;Ao.log("[transmuxer.ts]: Flushed fragment ".concat(r.sn).concat(r.part>-1?" p: "+r.part:""," of level ").concat(r.level));var d=this.remuxer.remux(n,i,a,o,c,u,!0,this.id);e.push({remuxResult:d,chunkMeta:r}),r.transmuxing.executeEnd=el()}},{key:"resetInitialTimestamp",value:function(e){var t=this.demuxer,r=this.remuxer;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))}},{key:"resetContiguity",value:function(){var e=this.demuxer,t=this.remuxer;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}},{key:"resetInitSegment",value:function(e,t,r,n,i){var a=this.demuxer,o=this.remuxer;a&&o&&(a.resetInitSegment(e,t,r,n),o.resetInitSegment(e,t,r,i))}},{key:"destroy",value:function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}},{key:"transmux",value:function(e,t,r,n,i){return t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,r,n,i):this.transmuxUnencrypted(e,r,n,i)}},{key:"transmuxUnencrypted",value:function(e,t,r,n){var i=this.demuxer.demux(e,t,!1,!this.config.progressive),a=i.audioTrack,o=i.videoTrack,s=i.id3Track,u=i.textTrack;return{remuxResult:this.remuxer.remux(a,o,s,u,t,r,!1,this.id),chunkMeta:n}}},{key:"transmuxSampleAes",value:function(e,t,r,n,i){var a=this;return this.demuxer.demuxSampleAes(e,t,r).then((function(e){return{remuxResult:a.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,r,n,!1,a.id),chunkMeta:i}}))}},{key:"configureTransmuxer",value:function(e){for(var t,r=this.config,n=this.observer,i=this.typeSupported,a=this.vendor,o=0,s=il.length;o<s;o++){var u;if(null!=(u=il[o].demux)&&u.probe(e)){t=il[o];break}}if(!t)return new Error("Failed to find demuxer by probing fragment data");var c=this.demuxer,d=this.remuxer,l=t.remux,h=t.demux;d&&d instanceof l||(this.remuxer=new l(n,r,i,a)),c&&c instanceof h||(this.demuxer=new h(n,r,i),this.probe=h.probe)}},{key:"needsProbing",value:function(e,t){return!this.demuxer||!this.remuxer||e||t}},{key:"getDecrypter",value:function(){var e=this.decrypter;return e||(e=this.decrypter=new Gc(this.config)),e}}]),ol=function(e){return{remuxResult:{},chunkMeta:e}};function sl(e){return"then"in e&&e.then instanceof Function}var ul=D((function e(t,r,n,i,a){R(this,e),this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=r,this.initSegmentData=n,this.duration=i,this.defaultInitPts=a||null})),cl=D((function e(t,r,n,i,a,o){R(this,e),this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=r,this.accurateTimeOffset=n,this.trackSwitch=i,this.timeOffset=a,this.initSegmentChange=o})),dl={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,n,a,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,a||e,o),u=r?r+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,a=n.length,o=new Array(a);i<a;i++)o[i]=n[i].fn;return o},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,a,o){var s=r?r+e:e;if(!this._events[s])return!1;var u,c,d=this._events[s],l=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),l){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,n),!0;case 4:return d.fn.call(d.context,t,n,i),!0;case 5:return d.fn.call(d.context,t,n,i,a),!0;case 6:return d.fn.call(d.context,t,n,i,a,o),!0}for(c=1,u=new Array(l-1);c<l;c++)u[c-1]=arguments[c];d.fn.apply(d.context,u)}else{var h,f=d.length;for(c=0;c<f;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),l){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,t);break;case 3:d[c].fn.call(d[c].context,t,n);break;case 4:d[c].fn.call(d[c].context,t,n,i);break;default:if(!u)for(h=1,u=new Array(l-1);h<l;h++)u[h-1]=arguments[h];d[c].fn.apply(d[c].context,u)}}return!0},s.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||o(this,a);else{for(var u=0,c=[],d=s.length;u<d;u++)(s[u].fn!==t||i&&!s[u].once||n&&s[u].context!==n)&&c.push(s[u]);c.length?this._events[a]=1===c.length?c[0]:c:o(this,a)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}(dl);var ll=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(dl.exports),hl=D((function e(t,r,n,i){var a=this;R(this,e),this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var o=t.config;this.hls=t,this.id=r,this.useWorker=!!o.enableWorker,this.onTransmuxComplete=n,this.onFlush=i;var s=function(e,t){(t=t||{}).frag=a.frag,t.id=a.id,e===vo.ERROR&&(a.error=t.error),a.hls.trigger(e,t)};this.observer=new ll,this.observer.on(vo.FRAG_DECRYPTED,s),this.observer.on(vo.ERROR,s);var u,c,d,l,h=zs(o.preferManagedMediaSource)||{isTypeSupported:function(){return!1}},f={mpeg:h.isTypeSupported("audio/mpeg"),mp3:h.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:h.isTypeSupported('audio/mp4; codecs="ac-3"')};if(!this.useWorker||"undefined"==typeof Worker||!o.workerPath&&"function"!=typeof __HLS_WORKER_BUNDLE__)this.transmuxer=new al(this.observer,f,o,"",r);else try{o.workerPath?(Ao.log("loading Web Worker ".concat(o.workerPath,' for "').concat(r,'"')),this.workerContext=(d=o.workerPath,l=new self.URL(d,self.location.href).href,{worker:new self.Worker(l),scriptURL:l})):(Ao.log('injecting Web Worker for "'.concat(r,'"')),this.workerContext=(u=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(".concat(__HLS_WORKER_BUNDLE__.toString(),")(true);")],{type:"text/javascript"}),c=self.URL.createObjectURL(u),{worker:new self.Worker(c),objectURL:c})),this.onwmsg=function(e){return a.onWorkerMessage(e)};var p=this.workerContext.worker;p.addEventListener("message",this.onwmsg),p.onerror=function(e){var t=new Error("".concat(e.message,"  (").concat(e.filename,":").concat(e.lineno,")"));o.enableWorker=!1,Ao.warn('Error in "'.concat(r,'" Web Worker, fallback to inline')),a.hls.trigger(vo.ERROR,{type:go.OTHER_ERROR,details:mo.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})},p.postMessage({cmd:"init",typeSupported:f,vendor:"",id:r,config:JSON.stringify(o)})}catch(e){Ao.warn('Error setting up "'.concat(r,'" Web Worker, fallback to inline'),e),this.resetWorker(),this.error=null,this.transmuxer=new al(this.observer,f,o,"",r)}}),[{key:"resetWorker",value:function(){if(this.workerContext){var e=this.workerContext,t=e.worker,r=e.objectURL;r&&self.URL.revokeObjectURL(r),t.removeEventListener("message",this.onwmsg),t.onerror=null,t.terminate(),this.workerContext=null}}},{key:"destroy",value:function(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}},{key:"push",value:function(e,t,r,n,i,a,o,s,u,c){var d,l,h=this;u.transmuxing.start=self.performance.now();var f=this.transmuxer,p=a?a.start:i.start,v=i.decryptdata,g=this.frag,m=!(g&&i.cc===g.cc),y=!(g&&u.level===g.level),_=g?u.sn-g.sn:-1,S=this.part?u.part-this.part.index:-1,A=0===_&&u.id>1&&u.id===(null==g?void 0:g.stats.chunkCount),b=!y&&(1===_||0===_&&(1===S||A&&S<=0)),E=self.performance.now();(y||_||0===i.stats.parsing.start)&&(i.stats.parsing.start=E),!a||!S&&b||(a.stats.parsing.start=E);var k=!(g&&(null==(d=i.initSegment)?void 0:d.url)===(null==(l=g.initSegment)?void 0:l.url)),C=new cl(m,b,s,y,p,k);if(!b||m||k){Ao.log("[transmuxer-interface, ".concat(i.type,"]: Starting new transmux session for sn: ").concat(u.sn," p: ").concat(u.part," level: ").concat(u.level," id: ").concat(u.id,"\n        discontinuity: ").concat(m,"\n        trackSwitch: ").concat(y,"\n        contiguous: ").concat(b,"\n        accurateTimeOffset: ").concat(s,"\n        timeOffset: ").concat(p,"\n        initSegmentChange: ").concat(k));var w=new ul(r,n,t,o,c);this.configureTransmuxer(w)}if(this.frag=i,this.part=a,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:v,chunkMeta:u,state:C},e instanceof ArrayBuffer?[e]:[]);else if(f){var T=f.push(e,v,u,C);sl(T)?(f.async=!0,T.then((function(e){h.handleTransmuxComplete(e)})).catch((function(e){h.transmuxerError(e,u,"transmuxer-interface push error")}))):(f.async=!1,this.handleTransmuxComplete(T))}}},{key:"flush",value:function(e){var t=this;e.transmuxing.start=self.performance.now();var r=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(r){var n=r.flush(e);sl(n)||r.async?(sl(n)||(n=Promise.resolve(n)),n.then((function(r){t.handleFlushResult(r,e)})).catch((function(r){t.transmuxerError(r,e,"transmuxer-interface flush error")}))):this.handleFlushResult(n,e)}}},{key:"transmuxerError",value:function(e,t,r){this.hls&&(this.error=e,this.hls.trigger(vo.ERROR,{type:go.MEDIA_ERROR,details:mo.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,fatal:!1,error:e,err:e,reason:r}))}},{key:"handleFlushResult",value:function(e,t){var r=this;e.forEach((function(e){r.handleTransmuxComplete(e)})),this.onFlush(t)}},{key:"onWorkerMessage",value:function(e){var t=e.data;if(null!=t&&t.event){var r=this.hls;if(this.hls)switch(t.event){case"init":var n,i=null==(n=this.workerContext)?void 0:n.objectURL;i&&self.URL.revokeObjectURL(i);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":Ao[t.data.logType]&&Ao[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}}else Ao.warn("worker message received with no ".concat(t?"event name":"data"))}},{key:"configureTransmuxer",value:function(e){var t=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}},{key:"handleTransmuxComplete",value:function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}]);function fl(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!pl(e[r].attrs,t[r].attrs))return!1;return!0}function pl(e,t,r){var n=e["STABLE-RENDITION-ID"];return n&&!r?n===t["STABLE-RENDITION-ID"]:!(r||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some((function(r){return e[r]!==t[r]}))}function vl(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}var gl=function(e){function t(e,r,n){var i;return R(this,t),(i=c(this,t,[e,r,n,"[audio-stream-controller]",Au])).videoBuffer=null,i.videoTrackCC=-1,i.waitingVideoCC=-1,i.bufferedTrack=null,i.switchingTrack=null,i.trackId=-1,i.waitingData=null,i.mainDetails=null,i.flushing=!1,i.bufferFlushed=!1,i.cachedTrackLoadedData=null,i._registerListeners(),i}return f(t,e),D(t,[{key:"onHandlerDestroying",value:function(){this._unregisterListeners(),s(t,"onHandlerDestroying",this)([]),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}},{key:"_registerListeners",value:function(){var e=this.hls;e.on(vo.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(vo.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.on(vo.LEVEL_LOADED,this.onLevelLoaded,this),e.on(vo.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(vo.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(vo.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(vo.ERROR,this.onError,this),e.on(vo.BUFFER_RESET,this.onBufferReset,this),e.on(vo.BUFFER_CREATED,this.onBufferCreated,this),e.on(vo.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(vo.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(vo.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(vo.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(vo.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(vo.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.off(vo.LEVEL_LOADED,this.onLevelLoaded,this),e.off(vo.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(vo.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(vo.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(vo.ERROR,this.onError,this),e.off(vo.BUFFER_RESET,this.onBufferReset,this),e.off(vo.BUFFER_CREATED,this.onBufferCreated,this),e.off(vo.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(vo.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(vo.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(vo.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"onInitPtsFound",value:function(e,t){var r=t.frag,n=t.id,i=t.initPTS,a=t.timescale;if("main"===n){var o=r.cc;this.initPTS[r.cc]={baseTime:i,timescale:a},this.log("InitPTS for cc: ".concat(o," found from main: ").concat(i)),this.videoTrackCC=o,this.state===Zc&&this.tick()}}},{key:"startLoad",value:function(e){if(!this.levels)return this.startPosition=e,void(this.state=Hc);var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),t>0&&-1===e?(this.log("Override startPosition with lastCurrentTime @".concat(t.toFixed(3))),e=t,this.state=jc):(this.loadedmetadata=!1,this.state=Yc),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}},{key:"doTick",value:function(){switch(this.state){case jc:this.doTickIdle();break;case Yc:var e,r=this.levels,n=this.trackId,i=null==r||null==(e=r[n])?void 0:e.details;if(i){if(this.waitForCdnTuneIn(i))break;this.state=Zc}break;case qc:var a,o=performance.now(),u=this.retryDate;if(!u||o>=u||null!=(a=this.media)&&a.seeking){var c=this.levels,d=this.trackId;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((null==c?void 0:c[d])||null),this.state=jc}break;case Zc:var l=this.waitingData;if(l){var h=l.frag,f=l.part,p=l.cache,v=l.complete;if(void 0!==this.initPTS[h.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=zc;var g={frag:h,part:f,payload:p.flush(),networkDetails:null};this._handleFragmentLoadProgress(g),v&&s(t,"_handleFragmentLoadComplete",this)([g])}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc (".concat(h.cc,") cancelled because video is at cc ").concat(this.videoTrackCC)),this.clearWaitingFragment();else{var m=this.getLoadPosition(),y=Rc.bufferInfo(this.mediaBuffer,m,this.config.maxBufferHole);ac(y.end,this.config.maxFragLookUpTolerance,h)<0&&(this.log("Waiting fragment cc (".concat(h.cc,") @ ").concat(h.start," cancelled because another fragment at ").concat(y.end," is needed")),this.clearWaitingFragment())}}else this.state=jc}this.onTickEnd()}},{key:"clearWaitingFragment",value:function(){var e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=jc)}},{key:"resetLoadingState",value:function(){this.clearWaitingFragment(),s(t,"resetLoadingState",this)([])}},{key:"onTickEnd",value:function(){var e=this.media;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}},{key:"doTickIdle",value:function(){var e=this.hls,t=this.levels,r=this.media,n=this.trackId,i=e.config;if((r||!this.startFragRequested&&i.startFragPrefetch)&&null!=t&&t[n]){var a=t[n],o=a.details;if(!o||o.live&&this.levelLastLoaded!==a||this.waitForCdnTuneIn(o))this.state=Yc;else{var s=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&s&&(this.bufferFlushed=!1,this.afterBufferFlushed(s,Ro,Au));var u=this.getFwdBufferInfo(s,Au);if(null!==u){var c=this.bufferedTrack,d=this.switchingTrack;if(!d&&this._streamEnded(u,o))return e.trigger(vo.BUFFER_EOS,{type:"audio"}),void(this.state=Jc);var l=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Su),h=u.len,f=this.getMaxBufferLength(null==l?void 0:l.len),p=o.fragments,v=p[0].start,g=this.flushing?this.getLoadPosition():u.end;if(d&&r){var m=this.getLoadPosition();c&&!pl(d.attrs,c.attrs)&&(g=m),o.PTSKnown&&m<v&&(u.end>v||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=v+.05)}if(!(h>=f&&!d&&g<p[p.length-1].start)){var y=this.getNextFragment(g,o),_=!1;if(y&&this.isLoopLoading(y,g)&&(_=!!y.gap,y=this.getNextFragmentLoopLoading(y,o,u,Su,f)),y){var S=l&&y.start>l.end+o.targetduration;if(S||(null==l||!l.len)&&u.len){var A=this.getAppendedFrag(y.start,Su);if(null===A)return;if(_||(_=!!A.gap||!!S&&0===l.len),S&&!_||_&&u.nextStart&&u.nextStart<A.end)return}this.loadFragment(y,a,g)}else this.bufferFlushed=!0}}}}}},{key:"getMaxBufferLength",value:function(e){var r=s(t,"getMaxBufferLength",this)([]);return e?Math.min(Math.max(r,e),this.config.maxMaxBufferLength):r}},{key:"onMediaDetaching",value:function(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,s(t,"onMediaDetaching",this)([])}},{key:"onAudioTracksUpdated",value:function(e,t){var r=t.audioTracks;this.resetTransmuxer(),this.levels=r.map((function(e){return new Hu(e)}))}},{key:"onAudioTrackSwitching",value:function(e,t){var r=!!t.url;this.trackId=t.id;var n=this.fragCurrent;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.switchingTrack=t,this.state=jc,this.flushAudioIfNeeded(t)):(this.switchingTrack=null,this.bufferedTrack=t,this.state=Hc),this.tick()}},{key:"onManifestLoading",value:function(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}},{key:"onLevelLoaded",value:function(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(vo.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}},{key:"onAudioTrackLoaded",value:function(e,t){var r;if(null!=this.mainDetails){var n=this.levels,i=t.details,a=t.id;if(n){this.log("Audio track ".concat(a," loaded [").concat(i.startSN,",").concat(i.endSN,"]").concat(i.lastPartSn?"[part-".concat(i.lastPartSn,"-").concat(i.lastPartIndex,"]"):"",",duration:").concat(i.totalduration));var o=n[a],s=0;if(i.live||null!=(r=o.details)&&r.live){this.checkLiveUpdate(i);var u,c=this.mainDetails;if(i.deltaUpdateFailed||!c)return;!o.details&&i.hasProgramDateTime&&c.hasProgramDateTime?(xc(i,c),s=i.fragments[0].start):s=this.alignPlaylists(i,o.details,null==(u=this.levelLastLoaded)?void 0:u.details)}o.details=i,this.levelLastLoaded=o,this.startFragRequested||!this.mainDetails&&i.live||this.setStartPosition(this.mainDetails||i,s),this.state!==Yc||this.waitForCdnTuneIn(i)||(this.state=jc),this.tick()}else this.warn("Audio tracks were reset while loading level ".concat(a))}else this.cachedTrackLoadedData=t}},{key:"_handleFragmentLoadProgress",value:function(e){var t,r=e.frag,n=e.part,i=e.payload,a=this.config,o=this.trackId,s=this.levels;if(s){var u=s[o];if(u){var c=u.details;if(!c)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(r.start);var d=a.defaultAudioCodec||u.audioCodec||"mp4a.40.2",l=this.transmuxer;l||(l=this.transmuxer=new hl(this.hls,Au,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var h=this.initPTS[r.cc],f=null==(t=r.initSegment)?void 0:t.data;if(void 0!==h){var p=n?n.index:-1,v=-1!==p,g=new Ic(r.level,r.sn,r.stats.chunkCount,i.byteLength,p,v);l.push(i,f,d,"",r,n,c.totalduration,!1,g,h)}else this.log("Unknown video PTS for cc ".concat(r.cc,", waiting for video PTS before demuxing audio frag ").concat(r.sn," of [").concat(c.startSN," ,").concat(c.endSN,"],track ").concat(o)),(this.waitingData=this.waitingData||{frag:r,part:n,cache:new rd,complete:!1}).cache.push(new Uint8Array(i)),this.waitingVideoCC=this.videoTrackCC,this.state=Zc}else this.warn("Audio track is undefined on fragment load progress")}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment ".concat(r.sn," of level ").concat(r.level," will not be buffered"))}},{key:"_handleFragmentLoadComplete",value:function(e){this.waitingData?this.waitingData.complete=!0:s(t,"_handleFragmentLoadComplete",this)([e])}},{key:"onBufferReset",value:function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}},{key:"onBufferCreated",value:function(e,t){var r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}},{key:"onFragBuffered",value:function(e,t){var r=t.frag,n=t.part;if(r.type===Au)if(this.fragContextChanged(r))this.warn("Fragment ".concat(r.sn).concat(n?" p: "+n.index:""," of level ").concat(r.level," finished buffering, but was aborted. state: ").concat(this.state,", audioSwitch: ").concat(this.switchingTrack?this.switchingTrack.name:"false"));else{if("initSegment"!==r.sn){this.fragPrevious=r;var i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(vo.AUDIO_TRACK_SWITCHED,uo({},i)))}this.fragBufferedComplete(r,n)}else if(!this.loadedmetadata&&r.type===Su){var a=this.videoBuffer||this.media;a&&Rc.getBuffered(a).length&&(this.loadedmetadata=!0)}}},{key:"onError",value:function(e,r){var n;if(r.fatal)this.state=$c;else switch(r.details){case mo.FRAG_GAP:case mo.FRAG_PARSING_ERROR:case mo.FRAG_DECRYPT_ERROR:case mo.FRAG_LOAD_ERROR:case mo.FRAG_LOAD_TIMEOUT:case mo.KEY_LOAD_ERROR:case mo.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Au,r);break;case mo.AUDIO_TRACK_LOAD_ERROR:case mo.AUDIO_TRACK_LOAD_TIMEOUT:case mo.LEVEL_PARSING_ERROR:r.levelRetry||this.state!==Yc||(null==(n=r.context)?void 0:n.type)!==yu||(this.state=jc);break;case mo.BUFFER_APPEND_ERROR:case mo.BUFFER_FULL_ERROR:if(!r.parent||"audio"!==r.parent)return;if(r.details===mo.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(r)&&(this.bufferedTrack=null,s(t,"flushMainBuffer",this)([0,Number.POSITIVE_INFINITY,"audio"]));break;case mo.INTERNAL_EXCEPTION:this.recoverWorkerError(r)}}},{key:"onBufferFlushing",value:function(e,t){t.type!==Io&&(this.flushing=!0)}},{key:"onBufferFlushed",value:function(e,t){var r=t.type;if(r!==Io){this.flushing=!1,this.bufferFlushed=!0,this.state===Jc&&(this.state=jc);var n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,r,Au),this.tick())}}},{key:"_handleTransmuxComplete",value:function(e){var t,r="audio",n=this.hls,i=e.remuxResult,a=e.chunkMeta,o=this.getCurrentContext(a);if(o){var s=o.frag,u=o.part,c=o.level,d=c.details,l=i.audio,h=i.text,f=i.id3,p=i.initSegment;if(!this.fragContextChanged(s)&&d){if(this.state=Xc,this.switchingTrack&&l&&this.completeAudioSwitch(this.switchingTrack),null!=p&&p.tracks){var v=s.initSegment||s;this._bufferInitSegment(c,p.tracks,v,a),n.trigger(vo.FRAG_PARSING_INIT_SEGMENT,{frag:v,id:r,tracks:p.tracks})}if(l){var g=l.startPTS,m=l.endPTS,y=l.startDTS,_=l.endDTS;u&&(u.elementaryStreams[Ro]={startPTS:g,endPTS:m,startDTS:y,endDTS:_}),s.setElementaryStreamInfo(Ro,g,m,y,_),this.bufferFragmentData(l,s,u,a)}if(null!=f&&null!=(t=f.samples)&&t.length){var S=lo({id:r,frag:s,details:d},f);n.trigger(vo.FRAG_PARSING_METADATA,S)}if(h){var A=lo({id:r,frag:s,details:d},h);n.trigger(vo.FRAG_PARSING_USERDATA,A)}}else this.fragmentTracker.removeFragment(s)}else this.resetWhenMissingContext(a)}},{key:"_bufferInitSegment",value:function(e,t,r,n){if(this.state===Xc){t.video&&delete t.video;var i=t.audio;if(i){i.id="audio";var a=e.audioCodec;this.log("Init audio buffer, container:".concat(i.container,", codecs[level/parsed]=[").concat(a,"/").concat(i.codec,"]")),a&&1===a.split(",").length&&(i.levelCodec=a),this.hls.trigger(vo.BUFFER_CODECS,t);var o=i.initSegment;if(null!=o&&o.byteLength){var s={type:"audio",frag:r,part:null,chunkMeta:n,parent:r.type,data:o};this.hls.trigger(vo.BUFFER_APPENDING,s)}this.tickImmediate()}}}},{key:"loadFragment",value:function(e,r,n){var i,a=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||a===Sc||a===bc)if("initSegment"===e.sn)this._loadInitSegment(e,r);else if(null!=(i=r.details)&&i.live&&!this.initPTS[e.cc]){this.log("Waiting for video PTS in continuity counter ".concat(e.cc," of live stream before loading audio fragment ").concat(e.sn," of level ").concat(this.trackId)),this.state=Zc;var o=this.mainDetails;o&&o.fragments[0].start!==r.details.fragments[0].start&&xc(r.details,o)}else this.startFragRequested=!0,s(t,"loadFragment",this)([e,r,n]);else this.clearTrackerIfNeeded(e)}},{key:"flushAudioIfNeeded",value:function(e){var r=this.media,n=this.bufferedTrack,i=null==n?void 0:n.attrs,a=e.attrs;r&&i&&(i.CHANNELS!==a.CHANNELS||n.name!==e.name||n.lang!==e.lang)&&(this.log("Switching audio track : flushing all audio"),s(t,"flushMainBuffer",this)([0,Number.POSITIVE_INFINITY,"audio"]),this.bufferedTrack=null)}},{key:"completeAudioSwitch",value:function(e){var t=this.hls;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(vo.AUDIO_TRACK_SWITCHED,uo({},e))}}])}(td),ml=function(e){function t(e){var r;return R(this,t),(r=c(this,t,[e,"[audio-track-controller]"])).tracks=[],r.groupIds=null,r.tracksInGroup=[],r.trackId=-1,r.currentTrack=null,r.selectDefaultTrack=!0,r.registerListeners(),r}return f(t,e),D(t,[{key:"registerListeners",value:function(){var e=this.hls;e.on(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.on(vo.MANIFEST_PARSED,this.onManifestParsed,this),e.on(vo.LEVEL_LOADING,this.onLevelLoading,this),e.on(vo.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(vo.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(vo.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.off(vo.MANIFEST_PARSED,this.onManifestParsed,this),e.off(vo.LEVEL_LOADING,this.onLevelLoading,this),e.off(vo.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(vo.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(vo.ERROR,this.onError,this)}},{key:"destroy",value:function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,s(t,"destroy",this)([])}},{key:"onManifestLoading",value:function(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}},{key:"onManifestParsed",value:function(e,t){this.tracks=t.audioTracks||[]}},{key:"onAudioTrackLoaded",value:function(e,t){var r=t.id,n=t.groupId,i=t.details,a=this.tracksInGroup[r];if(a&&a.groupId===n){var o=a.details;a.details=t.details,this.log("Audio track ".concat(r,' "').concat(a.name,'" lang:').concat(a.lang," group:").concat(n," loaded [").concat(i.startSN,"-").concat(i.endSN,"]")),r===this.trackId&&this.playlistLoaded(r,t,o)}else this.warn("Audio track with id:".concat(r," and group:").concat(n," not found in active group ").concat(null==a?void 0:a.groupId))}},{key:"onLevelLoading",value:function(e,t){this.switchLevel(t.level)}},{key:"onLevelSwitching",value:function(e,t){this.switchLevel(t.level)}},{key:"switchLevel",value:function(e){var t=this.hls.levels[e];if(t){var r=t.audioGroups||null,n=this.groupIds,i=this.currentTrack;if(!r||(null==n?void 0:n.length)!==(null==r?void 0:r.length)||null!=r&&r.some((function(e){return-1===(null==n?void 0:n.indexOf(e))}))){this.groupIds=r,this.trackId=-1,this.currentTrack=null;var a=this.tracks.filter((function(e){return!r||-1!==r.indexOf(e.groupId)}));if(a.length)this.selectDefaultTrack&&!a.some((function(e){return e.default}))&&(this.selectDefaultTrack=!1),a.forEach((function(e,t){e.id=t}));else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=a;var o=this.hls.config.audioPreference;if(!i&&o){var s=pc(o,a,gc);if(s>-1)i=a[s];else{var u=pc(o,this.tracks);i=this.tracks[u]}}var c=this.findTrackId(i);-1===c&&i&&(c=this.findTrackId(null));var d={audioTracks:a};this.log("Updating audio tracks, ".concat(a.length," track(s) found in group(s): ").concat(null==r?void 0:r.join(","))),this.hls.trigger(vo.AUDIO_TRACKS_UPDATED,d);var l=this.trackId;if(-1!==c&&-1===l)this.setAudioTrack(c);else if(a.length&&-1===l){var h,f=new Error("No audio track selected for current audio group-ID(s): ".concat(null==(h=this.groupIds)?void 0:h.join(",")," track count: ").concat(a.length));this.warn(f.message),this.hls.trigger(vo.ERROR,{type:go.MEDIA_ERROR,details:mo.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}else this.shouldReloadPlaylist(i)&&this.setAudioTrack(this.trackId)}}},{key:"onError",value:function(e,t){!t.fatal&&t.context&&(t.context.type!==yu||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||(this.requestScheduled=-1,this.checkRetry(t)))}},{key:"allAudioTracks",get:function(){return this.tracks}},{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}},{key:"setAudioOption",value:function(e){var t=this.hls;if(t.config.audioPreference=e,e){var r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){var n=this.currentTrack;if(n&&vc(e,n,gc))return n;var i=pc(e,this.tracksInGroup,gc);if(i>-1){var a=this.tracksInGroup[i];return this.setAudioTrack(i),a}if(n){var o=t.loadLevel;-1===o&&(o=t.firstAutoLevel);var s=function(e,t,r,n,i){var a=t[n],o=t.reduce((function(e,t,r){var n=t.uri;return(e[n]||(e[n]=[])).push(r),e}),{})[a.uri];o.length>1&&(n=Math.max.apply(Math,o));var s=a.videoRange,u=a.frameRate,c=a.codecSet.substring(0,4),d=mc(t,n,(function(t){if(t.videoRange!==s||t.frameRate!==u||t.codecSet.substring(0,4)!==c)return!1;var n=t.audioGroups,a=r.filter((function(e){return!n||-1!==n.indexOf(e.groupId)}));return pc(e,a,i)>-1}));return d>-1?d:mc(t,n,(function(t){var n=t.audioGroups,a=r.filter((function(e){return!n||-1!==n.indexOf(e.groupId)}));return pc(e,a,i)>-1}))}(e,t.levels,r,o,gc);if(-1===s)return null;t.nextLoadLevel=s}if(e.channels||e.audioCodec){var u=pc(e,r);if(u>-1)return r[u]}}}return null}},{key:"setAudioTrack",value:function(e){var t=this.tracksInGroup;if(e<0||e>=t.length)this.warn("Invalid audio track id: ".concat(e));else{this.clearTimer(),this.selectDefaultTrack=!1;var r=this.currentTrack,n=t[e],i=n.details&&!n.details.live;if(!(e===this.trackId&&n===r&&i||(this.log("Switching to audio-track ".concat(e,' "').concat(n.name,'" lang:').concat(n.lang," group:").concat(n.groupId," channels:").concat(n.channels)),this.trackId=e,this.currentTrack=n,this.hls.trigger(vo.AUDIO_TRACK_SWITCHING,uo({},n)),i))){var a=this.switchParams(n.url,null==r?void 0:r.details,n.details);this.loadPlaylist(a)}}}},{key:"findTrackId",value:function(e){for(var t=this.tracksInGroup,r=0;r<t.length;r++){var n=t[r];if((!this.selectDefaultTrack||n.default)&&(!e||vc(e,n,gc)))return r}if(e){for(var i=e.name,a=e.lang,o=e.assocLang,s=e.characteristics,u=e.audioCodec,c=e.channels,d=0;d<t.length;d++)if(vc({name:i,lang:a,assocLang:o,characteristics:s,audioCodec:u,channels:c},t[d],gc))return d;for(var l=0;l<t.length;l++){var h=t[l];if(pl(e.attrs,h.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(var f=0;f<t.length;f++){var p=t[f];if(pl(e.attrs,p.attrs,["LANGUAGE"]))return f}}return-1}},{key:"loadPlaylist",value:function(e){var r=this.currentTrack;if(this.shouldLoadPlaylist(r)&&r){s(t,"loadPlaylist",this)([]);var n=r.id,i=r.groupId,a=r.url;if(e)try{a=e.addDirectives(a)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(e))}this.log("loading audio-track playlist ".concat(n,' "').concat(r.name,'" lang:').concat(r.lang," group:").concat(i)),this.clearTimer(),this.hls.trigger(vo.AUDIO_TRACK_LOADING,{url:a,id:n,groupId:i,deliveryDirectives:e||null})}}}])}(uc),yl=function(e){function t(e,r,n){var i;return R(this,t),(i=c(this,t,[e,r,n,"[subtitle-stream-controller]",bu])).currentTrackId=-1,i.tracksBuffered=[],i.mainDetails=null,i._registerListeners(),i}return f(t,e),D(t,[{key:"onHandlerDestroying",value:function(){this._unregisterListeners(),s(t,"onHandlerDestroying",this)([]),this.mainDetails=null}},{key:"_registerListeners",value:function(){var e=this.hls;e.on(vo.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(vo.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.on(vo.LEVEL_LOADED,this.onLevelLoaded,this),e.on(vo.ERROR,this.onError,this),e.on(vo.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(vo.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(vo.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(vo.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(vo.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(vo.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(vo.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(vo.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.off(vo.LEVEL_LOADED,this.onLevelLoaded,this),e.off(vo.ERROR,this.onError,this),e.off(vo.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(vo.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(vo.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(vo.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(vo.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(vo.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"startLoad",value:function(e){this.stopLoad(),this.state=jc,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}},{key:"onManifestLoading",value:function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}},{key:"onMediaDetaching",value:function(){this.tracksBuffered=[],s(t,"onMediaDetaching",this)([])}},{key:"onLevelLoaded",value:function(e,t){this.mainDetails=t.details}},{key:"onSubtitleFragProcessed",value:function(e,t){var r=t.frag,n=t.success;if(this.fragPrevious=r,this.state=jc,n){var i=this.tracksBuffered[this.currentTrackId];if(i){for(var a,o=r.start,s=0;s<i.length;s++)if(o>=i[s].start&&o<=i[s].end){a=i[s];break}var u=r.start+r.duration;a?a.end=u:(a={start:o,end:u},i.push(a)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null)}}}},{key:"onBufferFlushing",value:function(e,t){var r=t.startOffset,n=t.endOffset;if(0===r&&n!==Number.POSITIVE_INFINITY){var i=n-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach((function(e){for(var t=0;t<e.length;)if(e[t].end<=i)e.shift();else{if(!(e[t].start<i))break;e[t].start=i,t++}})),this.fragmentTracker.removeFragmentsInRange(r,i,bu)}}},{key:"onFragBuffered",value:function(e,t){var r;this.loadedmetadata||t.frag.type!==Su||null!=(r=this.media)&&r.buffered.length&&(this.loadedmetadata=!0)}},{key:"onError",value:function(e,t){var r=t.frag;(null==r?void 0:r.type)===bu&&(t.details===mo.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Hc&&(this.state=jc))}},{key:"onSubtitleTracksUpdated",value:function(e,t){var r=this,n=t.subtitleTracks;this.levels&&fl(this.levels,n)?this.levels=n.map((function(e){return new Hu(e)})):(this.tracksBuffered=[],this.levels=n.map((function(e){var t=new Hu(e);return r.tracksBuffered[t.id]=[],t})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,bu),this.fragPrevious=null,this.mediaBuffer=null)}},{key:"onSubtitleTrackSwitch",value:function(e,t){var r;if(this.currentTrackId=t.id,null!=(r=this.levels)&&r.length&&-1!==this.currentTrackId){var n=this.levels[this.currentTrackId];null!=n&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.setInterval(500)}else this.clearInterval()}},{key:"onSubtitleTrackLoaded",value:function(e,t){var r,n=this.currentTrackId,i=this.levels,a=t.details,o=t.id;if(i){var s=i[o];if(!(o>=i.length)&&s){this.log("Subtitle track ".concat(o," loaded [").concat(a.startSN,",").concat(a.endSN,"]").concat(a.lastPartSn?"[part-".concat(a.lastPartSn,"-").concat(a.lastPartIndex,"]"):"",",duration:").concat(a.totalduration)),this.mediaBuffer=this.mediaBufferTimeRanges;var u=0;if(a.live||null!=(r=s.details)&&r.live){var c=this.mainDetails;if(a.deltaUpdateFailed||!c)return;var d,l=c.fragments[0];s.details?0===(u=this.alignPlaylists(a,s.details,null==(d=this.levelLastLoaded)?void 0:d.details))&&l&&Yu(a,u=l.start):a.hasProgramDateTime&&c.hasProgramDateTime?(xc(a,c),u=a.fragments[0].start):l&&Yu(a,u=l.start)}s.details=a,this.levelLastLoaded=s,o===n&&(this.startFragRequested||!this.mainDetails&&a.live||this.setStartPosition(this.mainDetails||a,u),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===jc&&(ic(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),s.details=void 0)))}}else this.warn("Subtitle tracks were reset while loading level ".concat(o))}},{key:"_handleFragmentLoadComplete",value:function(e){var t=this,r=e.frag,n=e.payload,i=r.decryptdata,a=this.hls;if(!this.fragContextChanged(r)&&n&&n.byteLength>0&&null!=i&&i.key&&i.iv&&"AES-128"===i.method){var o=performance.now();this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer).catch((function(e){throw a.trigger(vo.ERROR,{type:go.MEDIA_ERROR,details:mo.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:r}),e})).then((function(e){var t=performance.now();a.trigger(vo.FRAG_DECRYPTED,{frag:r,payload:e,stats:{tstart:o,tdecrypt:t}})})).catch((function(e){t.warn("".concat(e.name,": ").concat(e.message)),t.state=jc}))}}},{key:"doTick",value:function(){if(this.media){if(this.state===jc){var e=this.currentTrackId,t=this.levels,r=null==t?void 0:t[e];if(!r||!t.length||!r.details)return;var n=this.config,i=this.getLoadPosition(),a=Rc.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,n.maxBufferHole),o=a.end,s=a.len,u=this.getFwdBufferInfo(this.media,Su),c=r.details;if(s>this.getMaxBufferLength(null==u?void 0:u.len)+c.levelTargetDuration)return;var d=c.fragments,l=d.length,h=c.edge,f=null,p=this.fragPrevious;if(o<h){var v=n.maxFragLookUpTolerance,g=o>h-v?0:v;!(f=ic(p,d,Math.max(d[0].start,o),g))&&p&&p.start<d[0].start&&(f=d[0])}else f=d[l-1];if(!f)return;if("initSegment"!==(f=this.mapToInitFragWhenRequired(f)).sn){var m=d[f.sn-c.startSN-1];m&&m.cc===f.cc&&this.fragmentTracker.getState(m)===Sc&&(f=m)}this.fragmentTracker.getState(f)===Sc&&this.loadFragment(f,r,o)}}else this.state=jc}},{key:"getMaxBufferLength",value:function(e){var r=s(t,"getMaxBufferLength",this)([]);return e?Math.max(r,e):r}},{key:"loadFragment",value:function(e,r,n){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,r):(this.startFragRequested=!0,s(t,"loadFragment",this)([e,r,n]))}},{key:"mediaBufferTimeRanges",get:function(){return new _l(this.tracksBuffered[this.currentTrackId]||[])}}])}(td),_l=D((function e(t){R(this,e),this.buffered=void 0;var r=function(e,r,n){if((r>>>=0)>n-1)throw new DOMException("Failed to execute '".concat(e,"' on 'TimeRanges': The index provided (").concat(r,") is greater than the maximum bound (").concat(n,")"));return t[r][e]};this.buffered={get length(){return t.length},end:function(e){return r("end",e,t.length)},start:function(e){return r("start",e,t.length)}}})),Sl=function(e){function t(e){var r;return R(this,t),(r=c(this,t,[e,"[subtitle-track-controller]"])).media=null,r.tracks=[],r.groupIds=null,r.tracksInGroup=[],r.trackId=-1,r.currentTrack=null,r.selectDefaultTrack=!0,r.queuedDefaultTrack=-1,r.asyncPollTrackChange=function(){return r.pollTrackChange(0)},r.useTextTrackPolling=!1,r.subtitlePollingInterval=-1,r._subtitleDisplay=!0,r.onTextTracksChanged=function(){if(r.useTextTrackPolling||self.clearInterval(r.subtitlePollingInterval),r.media&&r.hls.config.renderTextTracksNatively){for(var e=null,t=Du(r.media.textTracks),n=0;n<t.length;n++)if("hidden"===t[n].mode)e=t[n];else if("showing"===t[n].mode){e=t[n];break}var i=r.findTrackForTextTrack(e);r.subtitleTrack!==i&&r.setSubtitleTrack(i)}},r.registerListeners(),r}return f(t,e),D(t,[{key:"destroy",value:function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,s(t,"destroy",this)([])}},{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}},{key:"registerListeners",value:function(){var e=this.hls;e.on(vo.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(vo.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.on(vo.MANIFEST_PARSED,this.onManifestParsed,this),e.on(vo.LEVEL_LOADING,this.onLevelLoading,this),e.on(vo.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(vo.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(vo.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(vo.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(vo.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.off(vo.MANIFEST_PARSED,this.onManifestParsed,this),e.off(vo.LEVEL_LOADING,this.onLevelLoading,this),e.off(vo.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(vo.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(vo.ERROR,this.onError,this)}},{key:"onMediaAttached",value:function(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}},{key:"pollTrackChange",value:function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}},{key:"onMediaDetaching",value:function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),Du(this.media.textTracks).forEach((function(e){Ru(e)})),this.subtitleTrack=-1,this.media=null)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}},{key:"onManifestParsed",value:function(e,t){this.tracks=t.subtitleTracks}},{key:"onSubtitleTrackLoaded",value:function(e,t){var r=t.id,n=t.groupId,i=t.details,a=this.tracksInGroup[r];if(a&&a.groupId===n){var o=a.details;a.details=t.details,this.log("Subtitle track ".concat(r,' "').concat(a.name,'" lang:').concat(a.lang," group:").concat(n," loaded [").concat(i.startSN,"-").concat(i.endSN,"]")),r===this.trackId&&this.playlistLoaded(r,t,o)}else this.warn("Subtitle track with id:".concat(r," and group:").concat(n," not found in active group ").concat(null==a?void 0:a.groupId))}},{key:"onLevelLoading",value:function(e,t){this.switchLevel(t.level)}},{key:"onLevelSwitching",value:function(e,t){this.switchLevel(t.level)}},{key:"switchLevel",value:function(e){var t=this.hls.levels[e];if(t){var r=t.subtitleGroups||null,n=this.groupIds,i=this.currentTrack;if(!r||(null==n?void 0:n.length)!==(null==r?void 0:r.length)||null!=r&&r.some((function(e){return-1===(null==n?void 0:n.indexOf(e))}))){this.groupIds=r,this.trackId=-1,this.currentTrack=null;var a=this.tracks.filter((function(e){return!r||-1!==r.indexOf(e.groupId)}));if(a.length)this.selectDefaultTrack&&!a.some((function(e){return e.default}))&&(this.selectDefaultTrack=!1),a.forEach((function(e,t){e.id=t}));else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=a;var o=this.hls.config.subtitlePreference;if(!i&&o){this.selectDefaultTrack=!1;var s=pc(o,a);if(s>-1)i=a[s];else{var u=pc(o,this.tracks);i=this.tracks[u]}}var c=this.findTrackId(i);-1===c&&i&&(c=this.findTrackId(null));var d={subtitleTracks:a};this.log("Updating subtitle tracks, ".concat(a.length,' track(s) found in "').concat(null==r?void 0:r.join(","),'" group-id')),this.hls.trigger(vo.SUBTITLE_TRACKS_UPDATED,d),-1!==c&&-1===this.trackId&&this.setSubtitleTrack(c)}else this.shouldReloadPlaylist(i)&&this.setSubtitleTrack(this.trackId)}}},{key:"findTrackId",value:function(e){for(var t=this.tracksInGroup,r=this.selectDefaultTrack,n=0;n<t.length;n++){var i=t[n];if((!r||i.default)&&(r||e)&&(!e||vc(i,e)))return n}if(e){for(var a=0;a<t.length;a++){var o=t[a];if(pl(e.attrs,o.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return a}for(var s=0;s<t.length;s++){var u=t[s];if(pl(e.attrs,u.attrs,["LANGUAGE"]))return s}}return-1}},{key:"findTrackForTextTrack",value:function(e){if(e)for(var t=this.tracksInGroup,r=0;r<t.length;r++)if(vl(t[r],e))return r;return-1}},{key:"onError",value:function(e,t){!t.fatal&&t.context&&(t.context.type!==_u||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}},{key:"allSubtitleTracks",get:function(){return this.tracks}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}},{key:"setSubtitleOption",value:function(e){if(this.hls.config.subtitlePreference=e,e){var t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){var r=this.currentTrack;if(r&&vc(e,r))return r;var n=pc(e,this.tracksInGroup);if(n>-1){var i=this.tracksInGroup[n];return this.setSubtitleTrack(n),i}if(r)return null;var a=pc(e,t);if(a>-1)return t[a]}}return null}},{key:"loadPlaylist",value:function(e){s(t,"loadPlaylist",this)([]);var r=this.currentTrack;if(this.shouldLoadPlaylist(r)&&r){var n=r.id,i=r.groupId,a=r.url;if(e)try{a=e.addDirectives(a)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(e))}this.log("Loading subtitle playlist for id ".concat(n)),this.hls.trigger(vo.SUBTITLE_TRACK_LOADING,{url:a,id:n,groupId:i,deliveryDirectives:e||null})}}},{key:"toggleTrackModes",value:function(){var e=this.media;if(e){var t,r=Du(e.textTracks),n=this.currentTrack;if(n&&((t=r.filter((function(e){return vl(n,e)}))[0])||this.warn('Unable to find subtitle TextTrack with name "'.concat(n.name,'" and language "').concat(n.lang,'"'))),[].slice.call(r).forEach((function(e){"disabled"!==e.mode&&e!==t&&(e.mode="disabled")})),t){var i=this.subtitleDisplay?"showing":"hidden";t.mode!==i&&(t.mode=i)}}}},{key:"setSubtitleTrack",value:function(e){var t=this.tracksInGroup;if(this.media)if(e<-1||e>=t.length||!ho(e))this.warn("Invalid subtitle track id: ".concat(e));else{this.clearTimer(),this.selectDefaultTrack=!1;var r=this.currentTrack,n=t[e]||null;if(this.trackId=e,this.currentTrack=n,this.toggleTrackModes(),n){var i=!!n.details&&!n.details.live;if(e!==this.trackId||n!==r||!i){this.log("Switching to subtitle-track ".concat(e)+(n?' "'.concat(n.name,'" lang:').concat(n.lang," group:").concat(n.groupId):""));var a=n.id,o=n.groupId,s=void 0===o?"":o,u=n.name,c=n.type,d=n.url;this.hls.trigger(vo.SUBTITLE_TRACK_SWITCH,{id:a,groupId:s,name:u,type:c,url:d});var l=this.switchParams(n.url,null==r?void 0:r.details,n.details);this.loadPlaylist(l)}}else this.hls.trigger(vo.SUBTITLE_TRACK_SWITCH,{id:e})}else this.queuedDefaultTrack=e}}])}(uc),Al=D((function e(t){R(this,e),this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}),[{key:"append",value:function(e,t,r){var n=this.queues[t];n.push(e),1!==n.length||r||this.executeNext(t)}},{key:"insertAbort",value:function(e,t){this.queues[t].unshift(e),this.executeNext(t)}},{key:"appendBlocker",value:function(e){var t,r=new Promise((function(e){t=e})),n={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(n,e),r}},{key:"executeNext",value:function(e){var t=this.queues[e];if(t.length){var r=t[0];try{r.execute()}catch(t){Ao.warn('[buffer-operation-queue]: Exception executing "'.concat(e,'" SourceBuffer operation: ').concat(t)),r.onError(t);var n=this.buffers[e];null!=n&&n.updating||this.shiftAndExecuteNext(e)}}}},{key:"shiftAndExecuteNext",value:function(e){this.queues[e].shift(),this.executeNext(e)}},{key:"current",value:function(e){return this.queues[e][0]}}]),bl=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,El=D((function e(t){var r=this;R(this,e),this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=function(e){r.hls&&r.hls.pauseBuffering()},this._onStartStreaming=function(e){r.hls&&r.hls.resumeBuffering()},this._onMediaSourceOpen=function(){var e=r.media,t=r.mediaSource;r.log("Media source opened"),e&&(e.removeEventListener("emptied",r._onMediaEmptied),r.updateMediaElementDuration(),r.hls.trigger(vo.MEDIA_ATTACHED,{media:e,mediaSource:t})),t&&t.removeEventListener("sourceopen",r._onMediaSourceOpen),r.checkPendingTracks()},this._onMediaSourceClose=function(){r.log("Media source closed")},this._onMediaSourceEnded=function(){r.log("Media source ended")},this._onMediaEmptied=function(){var e=r.mediaSrc,t=r._objectUrl;e!==t&&Ao.error("Media element src was set while attaching MediaSource (".concat(t," > ").concat(e,")"))},this.hls=t;var n,i="[buffer-controller]";this.appendSource=(n=zs(t.config.preferManagedMediaSource),"undefined"!=typeof self&&n===self.ManagedMediaSource),this.log=Ao.log.bind(Ao,i),this.warn=Ao.warn.bind(Ao,i),this.error=Ao.error.bind(Ao,i),this._initSourceBuffer(),this.registerListeners()}),[{key:"hasSourceTypes",value:function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}},{key:"destroy",value:function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}},{key:"registerListeners",value:function(){var e=this.hls;e.on(vo.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(vo.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.on(vo.MANIFEST_PARSED,this.onManifestParsed,this),e.on(vo.BUFFER_RESET,this.onBufferReset,this),e.on(vo.BUFFER_APPENDING,this.onBufferAppending,this),e.on(vo.BUFFER_CODECS,this.onBufferCodecs,this),e.on(vo.BUFFER_EOS,this.onBufferEos,this),e.on(vo.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(vo.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(vo.FRAG_PARSED,this.onFragParsed,this),e.on(vo.FRAG_CHANGED,this.onFragChanged,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(vo.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(vo.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.off(vo.MANIFEST_PARSED,this.onManifestParsed,this),e.off(vo.BUFFER_RESET,this.onBufferReset,this),e.off(vo.BUFFER_APPENDING,this.onBufferAppending,this),e.off(vo.BUFFER_CODECS,this.onBufferCodecs,this),e.off(vo.BUFFER_EOS,this.onBufferEos,this),e.off(vo.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(vo.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(vo.FRAG_PARSED,this.onFragParsed,this),e.off(vo.FRAG_CHANGED,this.onFragChanged,this)}},{key:"_initSourceBuffer",value:function(){this.sourceBuffer={},this.operationQueue=new Al(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}},{key:"onManifestLoading",value:function(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}},{key:"onManifestParsed",value:function(e,t){var r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.log("".concat(this.bufferCodecEventsExpected," bufferCodec event(s) expected"))}},{key:"onMediaAttaching",value:function(e,t){var r=this.media=t.media,n=zs(this.appendSource);if(r&&n){var i,a=this.mediaSource=new n;this.log("created media source: ".concat(null==(i=a.constructor)?void 0:i.name)),a.addEventListener("sourceopen",this._onMediaSourceOpen),a.addEventListener("sourceended",this._onMediaSourceEnded),a.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(a.addEventListener("startstreaming",this._onStartStreaming),a.addEventListener("endstreaming",this._onEndStreaming));var o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{r.removeAttribute("src");var s=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||s&&a instanceof s,kl(r),function(e,t){var r=self.document.createElement("source");r.type="video/mp4",r.src=t,e.appendChild(r)}(r,o),r.load()}catch(e){r.src=o}else r.src=o;r.addEventListener("emptied",this._onMediaEmptied)}}},{key:"onMediaDetaching",value:function(){var e=this.media,t=this.mediaSource,r=this._objectUrl;if(t){if(this.log("media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(e){this.warn("onMediaDetaching: ".concat(e.message," while calling endOfStream"))}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming)),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),this.mediaSrc===r?(e.removeAttribute("src"),this.appendSource&&kl(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(vo.MEDIA_DETACHED,void 0)}},{key:"onBufferReset",value:function(){var e=this;this.getSourceBufferTypes().forEach((function(t){e.resetBuffer(t)})),this._initSourceBuffer()}},{key:"resetBuffer",value:function(e){var t=this.sourceBuffer[e];try{var r;t&&(this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,null!=(r=this.mediaSource)&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(t))}catch(t){this.warn("onBufferReset ".concat(e),t)}}},{key:"onBufferCodecs",value:function(e,t){var r=this,n=this.getSourceBufferTypes().length,i=Object.keys(t);if(i.forEach((function(e){if(n){var i=r.tracks[e];if(i&&"function"==typeof i.buffer.changeType){var a,o=t[e],s=o.id,u=o.codec,c=o.levelCodec,d=o.container,l=o.metadata,h=ru(i.codec,i.levelCodec),f=null==h?void 0:h.replace(bl,"$1"),p=ru(u,c),v=null==(a=p)?void 0:a.replace(bl,"$1");if(p&&f!==v){"audio"===e.slice(0,5)&&(p=tu(p,r.appendSource));var g="".concat(d,";codecs=").concat(p);r.appendChangeType(e,g),r.log("switching codec ".concat(h," to ").concat(p)),r.tracks[e]={buffer:i.buffer,codec:u,container:d,levelCodec:c,metadata:l,id:s}}}}else r.pendingTracks[e]=t[e]})),!n){var a=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==a&&(this.log("".concat(a," bufferCodec event(s) expected ").concat(i.join(","))),this.bufferCodecEventsExpected=a),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks()}}},{key:"appendChangeType",value:function(e,t){var r=this,n=this.operationQueue,i={execute:function(){var i=r.sourceBuffer[e];i&&(r.log("changing ".concat(e," sourceBuffer type to ").concat(t)),i.changeType(t)),n.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(t){r.warn("Failed to change ".concat(e," SourceBuffer type"),t)}};n.append(i,e,!!this.pendingTracks[e])}},{key:"onBufferAppending",value:function(e,t){var r=this,n=this.hls,i=this.operationQueue,a=this.tracks,o=t.data,s=t.type,u=t.frag,c=t.part,d=t.chunkMeta,l=d.buffering[s],h=self.performance.now();l.start=h;var f=u.stats.buffering,p=c?c.stats.buffering:null;0===f.start&&(f.start=h),p&&0===p.start&&(p.start=h);var v=a.audio,g=!1;"audio"===s&&"audio/mpeg"===(null==v?void 0:v.container)&&(g=!this.lastMpegAudioChunk||1===d.id||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);var m=u.start,y={execute:function(){if(l.executeStart=self.performance.now(),g){var e=r.sourceBuffer[s];if(e){var t=m-e.timestampOffset;Math.abs(t)>=.1&&(r.log("Updating audio SourceBuffer timestampOffset to ".concat(m," (delta: ").concat(t,") sn: ").concat(u.sn,")")),e.timestampOffset=m)}}r.appendExecutor(o,s)},onStart:function(){},onComplete:function(){var e=self.performance.now();l.executeEnd=l.end=e,0===f.first&&(f.first=e),p&&0===p.first&&(p.first=e);var t=r.sourceBuffer,n={};for(var i in t)n[i]=Rc.getBuffered(t[i]);r.appendErrors[s]=0,"audio"===s||"video"===s?r.appendErrors.audiovideo=0:(r.appendErrors.audio=0,r.appendErrors.video=0),r.hls.trigger(vo.BUFFER_APPENDED,{type:s,frag:u,part:c,chunkMeta:d,parent:u.type,timeRanges:n})},onError:function(e){var t={type:go.MEDIA_ERROR,parent:u.type,details:mo.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:u,part:c,chunkMeta:d,error:e,err:e,fatal:!1};if(e.code===DOMException.QUOTA_EXCEEDED_ERR)t.details=mo.BUFFER_FULL_ERROR;else{var i=++r.appendErrors[s];t.details=mo.BUFFER_APPEND_ERROR,r.warn("Failed ".concat(i,"/").concat(n.config.appendErrorMaxRetry,' times to append segment in "').concat(s,'" sourceBuffer')),i>=n.config.appendErrorMaxRetry&&(t.fatal=!0)}n.trigger(vo.ERROR,t)}};i.append(y,s,!!this.pendingTracks[s])}},{key:"onBufferFlushing",value:function(e,t){var r=this,n=this.operationQueue,i=function(e){return{execute:r.removeExecutor.bind(r,e,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(vo.BUFFER_FLUSHED,{type:e})},onError:function(t){r.warn("Failed to remove from ".concat(e," SourceBuffer"),t)}}};t.type?n.append(i(t.type),t.type):this.getSourceBufferTypes().forEach((function(e){n.append(i(e),e)}))}},{key:"onFragParsed",value:function(e,t){var r=this,n=t.frag,i=t.part,a=[],o=i?i.elementaryStreams:n.elementaryStreams;o[Do]?a.push("audiovideo"):(o[Ro]&&a.push("audio"),o[Io]&&a.push("video")),0===a.length&&this.warn("Fragments must have at least one ElementaryStreamType set. type: ".concat(n.type," level: ").concat(n.level," sn: ").concat(n.sn)),this.blockBuffers((function(){var e=self.performance.now();n.stats.buffering.end=e,i&&(i.stats.buffering.end=e);var t=i?i.stats:n.stats;r.hls.trigger(vo.FRAG_BUFFERED,{frag:n,part:i,stats:t,id:n.type})}),a)}},{key:"onFragChanged",value:function(e,t){this.trimBuffers()}},{key:"onBufferEos",value:function(e,t){var r=this;this.getSourceBufferTypes().reduce((function(e,n){var i=r.sourceBuffer[n];return!i||t.type&&t.type!==n||(i.ending=!0,i.ended||(i.ended=!0,r.log("".concat(n," sourceBuffer now EOS")))),e&&!(i&&!i.ended)}),!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers((function(){r.getSourceBufferTypes().forEach((function(e){var t=r.sourceBuffer[e];t&&(t.ending=!1)}));var e=r.mediaSource;e&&"open"===e.readyState?(r.log("Calling mediaSource.endOfStream()"),e.endOfStream()):e&&r.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: ".concat(e.readyState))})))}},{key:"onLevelUpdated",value:function(e,t){var r=t.details;r.fragments.length&&(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}},{key:"trimBuffers",value:function(){var e=this.hls,t=this.details,r=this.media;if(r&&null!==t&&this.getSourceBufferTypes().length){var n=e.config,i=r.currentTime,a=t.levelTargetDuration,o=t.live&&null!==n.liveBackBufferLength?n.liveBackBufferLength:n.backBufferLength;if(ho(o)&&o>0){var s=Math.max(o,a),u=Math.floor(i/a)*a-s;this.flushBackBuffer(i,a,u)}if(ho(n.frontBufferFlushThreshold)&&n.frontBufferFlushThreshold>0){var c=Math.max(n.maxBufferLength,n.frontBufferFlushThreshold),d=Math.max(c,a),l=Math.floor(i/a)*a+d;this.flushFrontBuffer(i,a,l)}}}},{key:"flushBackBuffer",value:function(e,t,r){var n=this,i=this.details,a=this.sourceBuffer;this.getSourceBufferTypes().forEach((function(o){var s=a[o];if(s){var u=Rc.getBuffered(s);if(u.length>0&&r>u.start(0)){if(n.hls.trigger(vo.BACK_BUFFER_REACHED,{bufferEnd:r}),null!=i&&i.live)n.hls.trigger(vo.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(s.ended&&u.end(u.length-1)-e<2*t)return void n.log("Cannot flush ".concat(o," back buffer while SourceBuffer is in ended state"));n.hls.trigger(vo.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:o})}}}))}},{key:"flushFrontBuffer",value:function(e,t,r){var n=this,i=this.sourceBuffer;this.getSourceBufferTypes().forEach((function(a){var o=i[a];if(o){var s=Rc.getBuffered(o),u=s.length;if(u<2)return;var c=s.start(u-1),d=s.end(u-1);if(r>c||e>=c&&e<=d)return;if(o.ended&&e-d<2*t)return void n.log("Cannot flush ".concat(a," front buffer while SourceBuffer is in ended state"));n.hls.trigger(vo.BUFFER_FLUSHING,{startOffset:c,endOffset:1/0,type:a})}}))}},{key:"updateMediaElementDuration",value:function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var e=this.details,t=this.hls,r=this.media,n=this.mediaSource,i=e.fragments[0].start+e.totalduration,a=r.duration,o=ho(n.duration)?n.duration:0;e.live&&t.config.liveDurationInfinity?(n.duration=1/0,this.updateSeekableRange(e)):(i>o&&i>a||!ho(a))&&(this.log("Updating Media Source duration to ".concat(i.toFixed(3))),n.duration=i)}}},{key:"updateSeekableRange",value:function(e){var t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&null!=t&&t.setLiveSeekableRange){var n=Math.max(0,r[0].start),i=Math.max(n,n+e.totalduration);this.log("Media Source duration is set to ".concat(t.duration,". Setting seekable range to ").concat(n,"-").concat(i,".")),t.setLiveSeekableRange(n,i)}}},{key:"checkPendingTracks",value:function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,r=this.pendingTracks,n=Object.keys(r).length;if(n&&(!e||2===n||"audiovideo"in r)){this.createSourceBuffers(r),this.pendingTracks={};var i=this.getSourceBufferTypes();if(i.length)this.hls.trigger(vo.BUFFER_CREATED,{tracks:this.tracks}),i.forEach((function(e){t.executeNext(e)}));else{var a=new Error("could not create source buffer for media codec(s)");this.hls.trigger(vo.ERROR,{type:go.MEDIA_ERROR,details:mo.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:a,reason:a.message})}}}},{key:"createSourceBuffers",value:function(e){var t=this,r=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");var i,a=function(a){if(!r[a]){var o=e[a];if(!o)throw Error("source buffer exists for track ".concat(a,", however track does not"));var s=-1===(null==(i=o.levelCodec)?void 0:i.indexOf(","))?o.levelCodec:o.codec;s&&"audio"===a.slice(0,5)&&(s=tu(s,t.appendSource));var u="".concat(o.container,";codecs=").concat(s);t.log("creating sourceBuffer(".concat(u,")"));try{var c=r[a]=n.addSourceBuffer(u),d=a;t.addBufferListener(d,"updatestart",t._onSBUpdateStart),t.addBufferListener(d,"updateend",t._onSBUpdateEnd),t.addBufferListener(d,"error",t._onSBUpdateError),t.appendSource&&t.addBufferListener(d,"bufferedchange",(function(e,r){var n=r.removedRanges;null!=n&&n.length&&t.hls.trigger(vo.BUFFER_FLUSHED,{type:a})})),t.tracks[a]={buffer:c,codec:s,container:o.container,levelCodec:o.levelCodec,metadata:o.metadata,id:o.id}}catch(e){t.error("error while trying to add sourceBuffer: ".concat(e.message)),t.hls.trigger(vo.ERROR,{type:go.MEDIA_ERROR,details:mo.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,sourceBufferName:a,mimeType:u})}}};for(var o in e)a(o)}},{key:"mediaSrc",get:function(){var e,t,r=(null==(e=this.media)||null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==r?void 0:r.src}},{key:"_onSBUpdateStart",value:function(e){this.operationQueue.current(e).onStart()}},{key:"_onSBUpdateEnd",value:function(e){var t;if("closed"!==(null==(t=this.mediaSource)?void 0:t.readyState)){var r=this.operationQueue;r.current(e).onComplete(),r.shiftAndExecuteNext(e)}else this.resetBuffer(e)}},{key:"_onSBUpdateError",value:function(e,t){var r,n=new Error("".concat(e," SourceBuffer error. MediaSource readyState: ").concat(null==(r=this.mediaSource)?void 0:r.readyState));this.error("".concat(n),t),this.hls.trigger(vo.ERROR,{type:go.MEDIA_ERROR,details:mo.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:n,fatal:!1});var i=this.operationQueue.current(e);i&&i.onError(n)}},{key:"removeExecutor",value:function(e,t,r){var n=this.media,i=this.mediaSource,a=this.operationQueue,o=this.sourceBuffer[e];if(!n||!i||!o)return this.warn("Attempting to remove from the ".concat(e," SourceBuffer, but it does not exist")),void a.shiftAndExecuteNext(e);var s=ho(n.duration)?n.duration:1/0,u=ho(i.duration)?i.duration:1/0,c=Math.max(0,t),d=Math.min(r,s,u);d>c&&(!o.ending||o.ended)?(o.ended=!1,this.log("Removing [".concat(c,",").concat(d,"] from the ").concat(e," SourceBuffer")),o.remove(c,d)):a.shiftAndExecuteNext(e)}},{key:"appendExecutor",value:function(e,t){var r=this.sourceBuffer[t];if(r)r.ended=!1,r.appendBuffer(e);else if(!this.pendingTracks[t])throw new Error("Attempting to append to the ".concat(t," SourceBuffer, but it does not exist"))}},{key:"blockBuffers",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getSourceBufferTypes();if(!r.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var n=this.operationQueue,i=r.map((function(e){return n.appendBlocker(e)}));Promise.all(i).then((function(){e(),r.forEach((function(e){var r=t.sourceBuffer[e];null!=r&&r.updating||n.shiftAndExecuteNext(e)}))}))}},{key:"getSourceBufferTypes",value:function(){return Object.keys(this.sourceBuffer)}},{key:"addBufferListener",value:function(e,t,r){var n=this.sourceBuffer[e];if(n){var i=r.bind(this,e);this.listeners[e].push({event:t,listener:i}),n.addEventListener(t,i)}}},{key:"removeBufferListeners",value:function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach((function(e){t.removeEventListener(e.event,e.listener)}))}}]);function kl(e){var t=e.querySelectorAll("source");[].slice.call(t).forEach((function(t){e.removeChild(t)}))}var Cl={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},wl=function(e){return String.fromCharCode(Cl[e]||e)},Tl=15,Rl=100,Il={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Dl={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Ml={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Ol={25:2,26:4,29:6,30:8,31:10,27:13,28:15},xl=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Pl=D((function e(){R(this,e),this.time=null,this.verboseLevel=0}),[{key:"log",value:function(e,t){if(this.verboseLevel>=e){var r="function"==typeof t?t():t;Ao.log("".concat(this.time," [").concat(e,"] ").concat(r))}}}]),Ll=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t},Nl=D((function e(){R(this,e),this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}),[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var n=t[r];e.hasOwnProperty(n)&&(this[n]=e[n])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}},{key:"copy",value:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),Vl=D((function e(){R(this,e),this.uchar=" ",this.penState=new Nl}),[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(e,t){this.uchar=e,this.penState.copy(t)}},{key:"setPenState",value:function(e){this.penState.copy(e)}},{key:"equals",value:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}},{key:"copy",value:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),Ul=D((function e(t){R(this,e),this.chars=[],this.pos=0,this.currPenState=new Nl,this.cueStartTime=null,this.logger=void 0;for(var r=0;r<Rl;r++)this.chars.push(new Vl);this.logger=t}),[{key:"equals",value:function(e){for(var t=0;t<Rl;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}},{key:"copy",value:function(e){for(var t=0;t<Rl;t++)this.chars[t].copy(e.chars[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<Rl;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}},{key:"setCursor",value:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Rl&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Rl)}},{key:"moveCursor",value:function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(e){var t=this;e>=144&&this.backSpace();var r=wl(e);this.pos>=Rl?this.logger.log(0,(function(){return"Cannot insert "+e.toString(16)+" ("+r+") at position "+t.pos+". Skipping it!"})):(this.chars[this.pos].setChar(r,this.currPenState),this.moveCursor(1))}},{key:"clearFromPos",value:function(e){var t;for(t=e;t<Rl;t++)this.chars[t].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var e=[],t=!0,r=0;r<Rl;r++){var n=this.chars[r].uchar;" "!==n&&(t=!1),e.push(n)}return t?"":e.join("")}},{key:"setPenStyles",value:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}]),Fl=D((function e(t){R(this,e),this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(var r=0;r<Tl;r++)this.rows.push(new Ul(t));this.logger=t}),[{key:"reset",value:function(){for(var e=0;e<Tl;e++)this.rows[e].clear();this.currRow=14}},{key:"equals",value:function(e){for(var t=!0,r=0;r<Tl;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<Tl;t++)this.rows[t].copy(e.rows[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<Tl;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}},{key:"backSpace",value:function(){this.rows[this.currRow].backSpace()}},{key:"clearToEndOfRow",value:function(){this.rows[this.currRow].clearToEndOfRow()}},{key:"insertChar",value:function(e){this.rows[this.currRow].insertChar(e)}},{key:"setPen",value:function(e){this.rows[this.currRow].setPenStyles(e)}},{key:"moveCursor",value:function(e){this.rows[this.currRow].moveCursor(e)}},{key:"setCursor",value:function(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}},{key:"setPAC",value:function(e){this.logger.log(2,(function(){return"pacData = "+JSON.stringify(e)}));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var r=0;r<Tl;r++)this.rows[r].clear();var n=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){var a=i.rows[n].cueStartTime,o=this.logger.time;if(null!==a&&null!==o&&a<o)for(var s=0;s<this.nrRollUpRows;s++)this.rows[t-this.nrRollUpRows+s+1].copy(i.rows[n+s])}}this.currRow=t;var u=this.rows[this.currRow];if(null!==e.indent){var c=e.indent,d=Math.max(c-1,0);u.setCursor(e.indent),e.color=u.chars[d].penState.foreground}var l={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(l)}},{key:"setBkgData",value:function(e){this.logger.log(2,(function(){return"bkgData = "+JSON.stringify(e)})),this.backSpace(),this.setPen(e),this.insertChar(32)}},{key:"setRollUpRows",value:function(e){this.nrRollUpRows=e}},{key:"rollUp",value:function(){var e=this;if(null!==this.nrRollUpRows){this.logger.log(1,(function(){return e.getDisplayText()}));var t=this.currRow+1-this.nrRollUpRows,r=this.rows.splice(t,1)[0];r.clear(),this.rows.splice(this.currRow,0,r),this.logger.log(2,"Rolling up")}else this.logger.log(3,"roll_up but nrRollUpRows not set yet")}},{key:"getDisplayText",value:function(e){e=e||!1;for(var t=[],r="",n=-1,i=0;i<Tl;i++){var a=this.rows[i].getTextString();a&&(n=i+1,e?t.push("Row "+n+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r}},{key:"getTextAndFormat",value:function(){return this.rows}}]),Bl=D((function e(t,r,n){R(this,e),this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new Fl(n),this.nonDisplayedMemory=new Fl(n),this.lastOutputScreen=new Fl(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}),[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(e){this.outputFilter=e}},{key:"setPAC",value:function(e){this.writeScreen.setPAC(e)}},{key:"setBkgData",value:function(e){this.writeScreen.setBkgData(e)}},{key:"setMode",value:function(e){e!==this.mode&&(this.mode=e,this.logger.log(2,(function(){return"MODE="+e})),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}},{key:"insertChars",value:function(e){for(var t=this,r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(function(){return n+": "+t.writeScreen.getDisplayText(!0)})),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(function(){return"DISPLAYED: "+t.displayedMemory.getDisplayText(!0)})),this.outputDataUpdate())}},{key:"ccRCL",value:function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}},{key:"ccFON",value:function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}},{key:"ccCR",value:function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}},{key:"ccENM",value:function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){var e=this;if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(function(){return"DISP: "+e.displayedMemory.getDisplayText()}))}this.outputDataUpdate(!0)}},{key:"ccTO",value:function(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}},{key:"ccMIDROW",value:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}},{key:"outputDataUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}]),Wl=D((function e(t,r,n){R(this,e),this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;var i=this.logger=new Pl;this.channels=[null,new Bl(t,r,i),new Bl(t+1,n,i)]}),[{key:"getHandler",value:function(e){return this.channels[e].getHandler()}},{key:"setHandler",value:function(e,t){this.channels[e].setHandler(t)}},{key:"addData",value:function(e,t){var r=this;this.logger.time=e;for(var n=function(e){var n=127&t[e],i=127&t[e+1],a=!1,o=null;if(0===n&&0===i)return 0;r.logger.log(3,(function(){return"["+Ll([t[e],t[e+1]])+"] -> ("+Ll([n,i])+")"}));var s=r.cmdHistory;if(n>=16&&n<=31){if(function(e,t,r){return r.a===e&&r.b===t}(n,i,s))return Gl(null,null,s),r.logger.log(3,(function(){return"Repeated command ("+Ll([n,i])+") is dropped"})),0;Gl(n,i,r.cmdHistory),(a=r.parseCmd(n,i))||(a=r.parseMidrow(n,i)),a||(a=r.parsePAC(n,i)),a||(a=r.parseBackgroundAttributes(n,i))}else Gl(null,null,s);if(!a&&(o=r.parseChars(n,i))){var u=r.currentChannel;u&&u>0?r.channels[u].insertChars(o):r.logger.log(2,"No channel found yet. TEXT-MODE?")}a||o||r.logger.log(2,(function(){return"Couldn't parse cleaned data "+Ll([n,i])+" orig: "+Ll([t[e],t[e+1]])}))},i=0;i<t.length;i+=2)n(i)}},{key:"parseCmd",value:function(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;var r=20===e||21===e||23===e?1:2,n=this.channels[r];return 20===e||21===e||28===e||29===e?32===t?n.ccRCL():33===t?n.ccBS():34===t?n.ccAOF():35===t?n.ccAON():36===t?n.ccDER():37===t?n.ccRU(2):38===t?n.ccRU(3):39===t?n.ccRU(4):40===t?n.ccFON():41===t?n.ccRDC():42===t?n.ccTR():43===t?n.ccRTD():44===t?n.ccEDM():45===t?n.ccCR():46===t?n.ccENM():47===t&&n.ccEOC():n.ccTO(t-32),this.currentChannel=r,!0}},{key:"parseMidrow",value:function(e,t){var r=0;if((17===e||25===e)&&t>=32&&t<=47){if((r=17===e?1:2)!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;var n=this.channels[r];return!!n&&(n.ccMIDROW(t),this.logger.log(3,(function(){return"MIDROW ("+Ll([e,t])+")"})),!0)}return!1}},{key:"parsePAC",value:function(e,t){var r;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(16===e||24===e)&&t>=64&&t<=95))return!1;var n=e<=23?1:2;r=t>=64&&t<=95?1===n?Il[e]:Ml[e]:1===n?Dl[e]:Ol[e];var i=this.channels[n];return!!i&&(i.setPAC(this.interpretPAC(r,t)),this.currentChannel=n,!0)}},{key:"interpretPAC",value:function(e,t){var r,n={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,n.underline=!(1&~r),r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((r-16)/2),n}},{key:"parseChars",value:function(e,t){var r,n,i=null,a=null;return e>=25?(r=2,a=e-8):(r=1,a=e),a>=17&&a<=19?(n=17===a?t+80:18===a?t+112:t+144,this.logger.log(2,(function(){return"Special char '"+wl(n)+"' in channel "+r})),i=[n]):e>=32&&e<=127&&(i=0===t?[e]:[e,t]),i&&this.logger.log(3,(function(){return"Char codes =  "+Ll(i).join(",")})),i}},{key:"parseBackgroundAttributes",value:function(e,t){var r;if(!((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47))return!1;var n={};16===e||24===e?(r=Math.floor((t-32)/2),n.background=xl[r],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0));var i=e<=23?1:2;return this.channels[i].setBkgData(n),!0}},{key:"reset",value:function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}Gl(null,null,this.cmdHistory)}},{key:"cueSplitAtTime",value:function(e){for(var t=0;t<this.channels.length;t++){var r=this.channels[t];r&&r.cueSplitAtTime(e)}}}]);function Gl(e,t,r){r.a=e,r.b=t}var Hl=D((function e(t,r){R(this,e),this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=r}),[{key:"dispatchCue",value:function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}},{key:"newCue",value:function(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}},{key:"reset",value:function(){this.cueRanges=[],this.startTime=null}}]),jl=function(){if(null!=Vo&&Vo.VTTCue)return self.VTTCue;var e=["","lr","rl"],t=["start","middle","end","left","right"];function r(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;var r=t.toLowerCase();return!!~e.indexOf(r)&&r}function n(e){return r(t,e)}function i(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var o in a)e[o]=a[o]}return e}function a(t,a,o){var s=this,u={enumerable:!0};s.hasBeenReset=!1;var c="",d=!1,l=t,h=a,f=o,p=null,v="",g=!0,m="auto",y="start",_=50,S="middle",A=50,b="middle";Object.defineProperty(s,"id",i({},u,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(s,"pauseOnExit",i({},u,{get:function(){return d},set:function(e){d=!!e}})),Object.defineProperty(s,"startTime",i({},u,{get:function(){return l},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");l=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",i({},u,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",i({},u,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",i({},u,{get:function(){return p},set:function(e){p=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",i({},u,{get:function(){return v},set:function(t){var n=function(t){return r(e,t)}(t);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");v=n,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",i({},u,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",i({},u,{get:function(){return m},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",i({},u,{get:function(){return y},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",i({},u,{get:function(){return _},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",i({},u,{get:function(){return S},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");S=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",i({},u,{get:function(){return A},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");A=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",i({},u,{get:function(){return b},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}})),s.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}(),Kl=D((function e(){R(this,e)}),[{key:"decode",value:function(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}]);function zl(e){function t(e,t,r,n){return 3600*(0|e)+60*(0|t)+(0|r)+parseFloat(n||0)}var r=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?t(r[2],r[3],0,r[4]):t(r[1],r[2],r[3],r[4]):null}var ql=D((function e(){R(this,e),this.values=Object.create(null)}),[{key:"set",value:function(e,t){this.get(e)||""===t||(this.values[e]=t)}},{key:"get",value:function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}},{key:"has",value:function(e){return e in this.values}},{key:"alt",value:function(e,t,r){for(var n=0;n<r.length;++n)if(t===r[n]){this.set(e,t);break}}},{key:"integer",value:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}},{key:"percent",value:function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}]);function Yl(e,t,r,n){var i=n?e.split(n):[e];for(var a in i)if("string"==typeof i[a]){var o=i[a].split(r);2===o.length&&t(o[0],o[1])}}var Xl=new jl(0,0,""),Ql="middle"===Xl.align?"middle":"center";function Jl(e,t,r){var n=e;function i(){var t=zl(e);if(null===t)throw new Error("Malformed timestamp: "+n);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=i(),a(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);e=e.slice(3),a(),t.endTime=i(),a(),function(e,t){var n=new ql;Yl(e,(function(e,t){var i;switch(e){case"region":for(var a=r.length-1;a>=0;a--)if(r[a].id===t){n.set(e,r[a].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":i=t.split(","),n.integer(e,i[0]),n.percent(e,i[0])&&n.set("snapToLines",!1),n.alt(e,i[0],["auto"]),2===i.length&&n.alt("lineAlign",i[1],["start",Ql,"end"]);break;case"position":i=t.split(","),n.percent(e,i[0]),2===i.length&&n.alt("positionAlign",i[1],["start",Ql,"end","line-left","line-right","auto"]);break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start",Ql,"end","left","right"])}}),/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical","");var i=n.get("line","auto");"auto"===i&&-1===Xl.line&&(i=-1),t.line=i,t.lineAlign=n.get("lineAlign","start"),t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100),t.align=n.get("align",Ql);var a=n.get("position","auto");"auto"===a&&50===Xl.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}function $l(e){return e.replace(/<br(?: \/)?>/gi,"\n")}var Zl=D((function e(){R(this,e),this.state="INITIAL",this.buffer="",this.decoder=new Kl,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}),[{key:"parse",value:function(e){var t=this;function r(){var e=t.buffer,r=0;for(e=$l(e);r<e.length&&"\r"!==e[r]&&"\n"!==e[r];)++r;var n=e.slice(0,r);return"\r"===e[r]&&++r,"\n"===e[r]&&++r,t.buffer=e.slice(r),n}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var n="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var i=(n=r()).match(/^()?WEBVTT([ \t].*)?$/);if(null==i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var a=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:n=r(),t.state){case"HEADER":/:/.test(n)?Yl(n,(function(e,t){}),/:/):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new jl(0,0,""),t.state="CUE",-1===n.indexOf("--\x3e")){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Jl(n,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var o=-1!==n.indexOf("--\x3e");if(!n||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=n;continue;case"BADCUE":n||(t.state="ID")}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}},{key:"flush",value:function(){var e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}]),eh=/\r\n|\n\r|\n|\r/g,th=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.slice(r,r+t.length)===t},rh=function(e){for(var t=5381,r=e.length;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()};function nh(e,t,r){return rh(e.toString())+rh(t.toString())+rh(r)}var ih="stpp.ttml.im1t",ah=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,oh=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,sh={left:"start",center:"center",right:"end",start:"start",end:"end"};function uh(e,t,r,n){var i=Es(new Uint8Array(e),["mdat"]);if(0!==i.length){var a=i.map((function(e){return hs(e)})),o=function(e,t){return zd(e,t,1/(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1),arguments.length>3&&void 0!==arguments[3]&&arguments[3])}(t.baseTime,1,t.timescale);try{a.forEach((function(e){return r(function(e,t){var r=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");var n={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},i=Object.keys(n).reduce((function(e,t){return e[t]=r.getAttribute("ttp:".concat(t))||n[t],e}),{}),a="preserve"!==r.getAttribute("xml:space"),o=dh(ch(r,"styling","style")),s=dh(ch(r,"layout","region")),u=ch(r,"body","[begin]");return[].map.call(u,(function(e){var r=lh(e,a);if(!r||!e.hasAttribute("begin"))return null;var n=ph(e.getAttribute("begin"),i),u=ph(e.getAttribute("dur"),i),c=ph(e.getAttribute("end"),i);if(null===n)throw fh(e);if(null===c){if(null===u)throw fh(e);c=n+u}var d=new jl(n-t,c-t,r);d.id=nh(d.startTime,d.endTime,d.text);var l=function(e,t,r){var n="http://www.w3.org/ns/ttml#styling",i=null,a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;return a&&r.hasOwnProperty(a)&&(i=r[a]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((function(r,a){var o=hh(t,n,a)||hh(e,n,a)||hh(i,n,a);return o&&(r[a]=o),r}),{})}(s[e.getAttribute("region")],o[e.getAttribute("style")],o),h=l.textAlign;if(h){var f=sh[h];f&&(d.lineAlign=f),d.align=h}return lo(d,l),d})).filter((function(e){return null!==e}))}(e,o))}))}catch(e){n(e)}}else n(new Error("Could not parse IMSC1 mdat"))}function ch(e,t,r){var n=e.getElementsByTagName(t)[0];return n?[].slice.call(n.querySelectorAll(r)):[]}function dh(e){return e.reduce((function(e,t){var r=t.getAttribute("xml:id");return r&&(e[r]=t),e}),{})}function lh(e,t){return[].slice.call(e.childNodes).reduce((function(e,r,n){var i;return"br"===r.nodeName&&n?e+"\n":null!=(i=r.childNodes)&&i.length?lh(r,t):t?e+r.textContent.trim().replace(/\s+/g," "):e+r.textContent}),"")}function hh(e,t,r){return e&&e.hasAttributeNS(t,r)?e.getAttributeNS(t,r):null}function fh(e){return new Error("Could not parse ttml timestamp ".concat(e))}function ph(e,t){if(!e)return null;var r=zl(e);return null===r&&(ah.test(e)?r=function(e,t){var r=ah.exec(e),n=(0|r[4])+(0|r[5])/t.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+n/t.frameRate}(e,t):oh.test(e)&&(r=function(e,t){var r=oh.exec(e),n=Number(r[1]);switch(r[2]){case"h":return 3600*n;case"m":return 60*n;case"ms":return 1e3*n;case"f":return n/t.frameRate;case"t":return n/t.tickRate}return n}(e,t))),r}var vh=D((function e(t){R(this,e),this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},t.on(vo.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(vo.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(vo.MANIFEST_LOADING,this.onManifestLoading,this),t.on(vo.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(vo.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(vo.FRAG_LOADING,this.onFragLoading,this),t.on(vo.FRAG_LOADED,this.onFragLoaded,this),t.on(vo.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(vo.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(vo.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(vo.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(vo.BUFFER_FLUSHING,this.onBufferFlushing,this)}),[{key:"destroy",value:function(){var e=this.hls;e.off(vo.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(vo.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.off(vo.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(vo.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(vo.FRAG_LOADING,this.onFragLoading,this),e.off(vo.FRAG_LOADED,this.onFragLoaded,this),e.off(vo.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(vo.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(vo.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(vo.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(vo.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}},{key:"initCea608Parsers",value:function(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){var e=new Hl(this,"textTrack1"),t=new Hl(this,"textTrack2"),r=new Hl(this,"textTrack3"),n=new Hl(this,"textTrack4");this.cea608Parser1=new Wl(1,e,t),this.cea608Parser2=new Wl(3,r,n)}}},{key:"addCues",value:function(e,t,r,n,i){for(var a,o,s,u,c=!1,d=i.length;d--;){var l=i[d],h=(a=l[0],o=l[1],s=t,u=r,Math.min(o,u)-Math.max(a,s));if(h>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],r),c=!0,h/(r-t)>.5))return}if(c||i.push([t,r]),this.config.renderTextTracksNatively){var f=this.captionsTracks[e];this.Cues.newCue(f,t,r,n)}else{var p=this.Cues.newCue(null,t,r,n);this.hls.trigger(vo.CUES_PARSED,{type:"captions",cues:p,track:e})}}},{key:"onInitPtsFound",value:function(e,t){var r=this,n=t.frag,i=t.id,a=t.initPTS,o=t.timescale,s=this.unparsedVttFrags;"main"===i&&(this.initPTS[n.cc]={baseTime:a,timescale:o}),s.length&&(this.unparsedVttFrags=[],s.forEach((function(e){r.onFragLoaded(vo.FRAG_LOADED,e)})))}},{key:"getExistingTrack",value:function(e,t){var r=this.media;if(r)for(var n=0;n<r.textTracks.length;n++){var i=r.textTracks[n];if(mh(i,{name:e,lang:t}))return i}return null}},{key:"createCaptionsTrack",value:function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}},{key:"createNativeTrack",value:function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,r=this.captionsTracks,n=this.media,i=t[e],a=i.label,o=i.languageCode,s=this.getExistingTrack(a,o);if(s)r[e]=s,Ru(r[e]),wu(r[e],n);else{var u=this.createTextTrack("captions",a,o);u&&(u[e]=!0,r[e]=u)}}}},{key:"createNonNativeTrack",value:function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var r={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(vo.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}}}},{key:"createTextTrack",value:function(e,t,r){var n=this.media;if(n)return n.addTextTrack(e,t,r)}},{key:"onMediaAttaching",value:function(e,t){this.media=t.media,this._cleanTracks()}},{key:"onMediaDetaching",value:function(){var e=this.captionsTracks;Object.keys(e).forEach((function(t){Ru(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}}},{key:"onManifestLoading",value:function(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}},{key:"_cleanTracks",value:function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var r=0;r<t.length;r++)Ru(t[r])}}},{key:"onSubtitleTracksUpdated",value:function(e,t){var r=this,n=t.subtitleTracks||[],i=n.some((function(e){return e.textCodec===ih}));if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(fl(this.tracks,n))return void(this.tracks=n);if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){var a=this.media,o=a?Du(a.textTracks):null;if(this.tracks.forEach((function(e,t){var n;if(o){for(var i=null,a=0;a<o.length;a++)if(o[a]&&mh(o[a],e)){i=o[a],o[a]=null;break}i&&(n=i)}if(n)Ru(n);else{var s=gh(e);(n=r.createTextTrack(s,e.name,e.lang))&&(n.mode="disabled")}n&&r.textTracks.push(n)})),null!=o&&o.length){var s=o.filter((function(e){return null!==e})).map((function(e){return e.label}));s.length&&Ao.warn("Media element contains unused subtitle tracks: ".concat(s.join(", "),". Replace media element for each source to clear TextTracks and captions menu."))}}else if(this.tracks.length){var u=this.tracks.map((function(e){return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}}));this.hls.trigger(vo.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:u})}}}},{key:"onManifestLoaded",value:function(e,t){var r=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((function(e){var t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(t){var n="textTrack".concat(t[1]),i=r.captionsProperties[n];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)}}))}},{key:"closedCaptionsForLevel",value:function(e){var t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}},{key:"onFragLoading",value:function(e,t){if(this.enabled&&t.frag.type===Su){var r,n,i=this.cea608Parser1,a=this.cea608Parser2,o=this.lastSn,s=t.frag,u=s.cc,c=s.sn,d=null!=(r=null==(n=t.part)?void 0:n.index)?r:-1;i&&a&&(c!==o+1||c===o&&d!==this.lastPartIndex+1||u!==this.lastCc)&&(i.reset(),a.reset()),this.lastCc=u,this.lastSn=c,this.lastPartIndex=d}}},{key:"onFragLoaded",value:function(e,t){var r=t.frag,n=t.payload;if(r.type===bu)if(n.byteLength){var i=r.decryptdata,a="stats"in t;if(null==i||!i.encrypted||a){var o=this.tracks[r.level],s=this.vttCCs;s[r.cc]||(s[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),o&&o.textCodec===ih?this._parseIMSC1(r,n):this._parseVTTs(t)}}else this.hls.trigger(vo.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}},{key:"_parseIMSC1",value:function(e,t){var r=this,n=this.hls;uh(t,this.initPTS[e.cc],(function(t){r._appendCues(t,e.level),n.trigger(vo.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(t){Ao.log("Failed to parse IMSC1: ".concat(t)),n.trigger(vo.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))}},{key:"_parseVTTs",value:function(e){var t,r=this,n=e.frag,i=e.payload,a=this.initPTS,o=this.unparsedVttFrags,s=a.length-1;if(a[n.cc]||-1!==s){var u=this.hls;!function(e,t,r,n,i,a,o){var s,u=new Zl,c=hs(new Uint8Array(e)).trim().replace(eh,"\n").split("\n"),d=[],l=t?function(e){return zd(e,9e4,1/(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1))}(t.baseTime,t.timescale):0,h="00:00.000",f=0,p=0,v=!0;u.oncue=function(e){var a=r[n],o=r.ccOffset,u=(f-l)/9e4;if(null!=a&&a.new&&(void 0!==p?o=r.ccOffset=a.start:function(e,t,r){var n=e[t],i=e[n.prevCC];if(!i||!i.new&&n.new)return e.ccOffset=e.presentationOffset=n.start,void(n.new=!1);for(;null!=(a=i)&&a.new;){var a;e.ccOffset+=n.start-i.start,n.new=!1,i=e[(n=i).prevCC]}e.presentationOffset=r}(r,n,u)),u){if(!t)return void(s=new Error("Missing initPTS for VTT MPEGTS"));o=u-r.presentationOffset}var c=e.endTime-e.startTime,h=Jd(9e4*(e.startTime+o-p),9e4*i)/9e4;e.startTime=Math.max(h,0),e.endTime=Math.max(h+c,0);var v=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(v)),e.id||(e.id=nh(e.startTime,e.endTime,v)),e.endTime>0&&d.push(e)},u.onparsingerror=function(e){s=e},u.onflush=function(){s?o(s):a(d)},c.forEach((function(e){if(v){if(th(e,"X-TIMESTAMP-MAP=")){v=!1,e.slice(16).split(",").forEach((function(e){th(e,"LOCAL:")?h=e.slice(6):th(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))}));try{p=function(e){var t=parseInt(e.slice(-3)),r=parseInt(e.slice(-6,-4)),n=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(ho(t)&&ho(r)&&ho(n)&&ho(i)))throw Error("Malformed X-TIMESTAMP-MAP: Local:".concat(e));return t+=1e3*r,(t+=6e4*n)+36e5*i}(h)/1e3}catch(e){s=e}return}""===e&&(v=!1)}u.parse(e+"\n")})),u.flush()}(null!=(t=n.initSegment)&&t.data?Os(n.initSegment.data,new Uint8Array(i)):i,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,(function(e){r._appendCues(e,n.level),u.trigger(vo.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})}),(function(t){var a="Missing initPTS for VTT MPEGTS"===t.message;a?o.push(e):r._fallbackToIMSC1(n,i),Ao.log("Failed to parse VTT cue: ".concat(t)),a&&s>n.cc||u.trigger(vo.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:t})}))}else o.push(e)}},{key:"_fallbackToIMSC1",value:function(e,t){var r=this,n=this.tracks[e.level];n.textCodec||uh(t,this.initPTS[e.cc],(function(){n.textCodec=ih,r._parseIMSC1(e,t)}),(function(){n.textCodec="wvtt"}))}},{key:"_appendCues",value:function(e,t){var r=this.hls;if(this.config.renderTextTracksNatively){var n=this.textTracks[t];if(!n||"disabled"===n.mode)return;e.forEach((function(e){return Tu(n,e)}))}else{var i=this.tracks[t];if(!i)return;var a=i.default?"default":"subtitles"+t;r.trigger(vo.CUES_PARSED,{type:"subtitles",cues:e,track:a})}}},{key:"onFragDecrypted",value:function(e,t){t.frag.type===bu&&this.onFragLoaded(vo.FRAG_LOADED,t)}},{key:"onSubtitleTracksCleared",value:function(){this.tracks=[],this.captionsTracks={}}},{key:"onFragParsingUserdata",value:function(e,t){this.initCea608Parsers();var r=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&r&&n){var i=t.frag,a=t.samples;if(i.type!==Su||"NONE"!==this.closedCaptionsForLevel(i))for(var o=0;o<a.length;o++){var s=a[o].bytes;if(s){var u=this.extractCea608Data(s);r.addData(a[o].pts,u[0]),n.addData(a[o].pts,u[1])}}}}},{key:"onBufferFlushing",value:function(e,t){var r=t.startOffset,n=t.endOffset,i=t.endOffsetSubtitles,a=t.type,o=this.media;if(o&&!(o.currentTime<n)){if(!a||"video"===a){var s=this.captionsTracks;Object.keys(s).forEach((function(e){return Iu(s[e],r,n)}))}if(this.config.renderTextTracksNatively&&0===r&&void 0!==i){var u=this.textTracks;Object.keys(u).forEach((function(e){return Iu(u[e],r,i)}))}}}},{key:"extractCea608Data",value:function(e){for(var t=[[],[]],r=31&e[0],n=2,i=0;i<r;i++){var a=e[n++],o=127&e[n++],s=127&e[n++];if((0!==o||0!==s)&&4&a){var u=3&a;0!==u&&1!==u||(t[u].push(o),t[u].push(s))}}return t}}]);function gh(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function mh(e,t){return!!e&&e.kind===gh(t)&&vl(t,e)}var yh=function(){function e(t){R(this,e),this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}return D(e,[{key:"setStreamController",value:function(e){this.streamController=e}},{key:"destroy",value:function(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}},{key:"registerListeners",value:function(){var e=this.hls;e.on(vo.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(vo.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(vo.MANIFEST_PARSED,this.onManifestParsed,this),e.on(vo.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(vo.BUFFER_CODECS,this.onBufferCodecs,this),e.on(vo.MEDIA_DETACHING,this.onMediaDetaching,this)}},{key:"unregisterListener",value:function(){var e=this.hls;e.off(vo.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(vo.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(vo.MANIFEST_PARSED,this.onManifestParsed,this),e.off(vo.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(vo.BUFFER_CODECS,this.onBufferCodecs,this),e.off(vo.MEDIA_DETACHING,this.onMediaDetaching,this)}},{key:"onFpsDropLevelCapping",value:function(e,t){var r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}},{key:"onMediaAttaching",value:function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}},{key:"onManifestParsed",value:function(e,t){var r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}},{key:"onLevelsUpdated",value:function(e,t){this.timer&&ho(this.autoLevelCapping)&&this.detectPlayerSize()}},{key:"onBufferCodecs",value:function(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}},{key:"onMediaDetaching",value:function(){this.stopCapping()}},{key:"detectPlayerSize",value:function(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);var e=this.hls.levels;if(e.length){var t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&Ao.log("Setting autoLevelCapping to ".concat(r,": ").concat(e[r].height,"p@").concat(e[r].bitrate," for media ").concat(this.mediaWidth,"x").concat(this.mediaHeight)),t.autoLevelCapping=r,t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}},{key:"getMaxLevel",value:function(t){var r=this,n=this.hls.levels;if(!n.length)return-1;var i=n.filter((function(e,n){return r.isLevelAllowed(e)&&n<=t}));return this.clientRect=null,e.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}},{key:"startCapping",value:function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"stopCapping",value:function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}},{key:"getDimensions",value:function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.width||t.height||(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}},{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return e}},{key:"isLevelAllowed",value:function(e){return!this.restrictedLevels.some((function(t){return e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height}))}}],[{key:"getMaxLevelByMediaSize",value:function(e,t,r){if(null==e||!e.length)return-1;for(var n,i,a=e.length-1,o=Math.max(t,r),s=0;s<e.length;s+=1){var u=e[s];if((u.width>=o||u.height>=o)&&(n=u,!(i=e[s+1])||n.width!==i.width||n.height!==i.height)){a=s;break}}return a}}])}(),_h=D((function e(t){R(this,e),this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}),[{key:"setStreamController",value:function(e){this.streamController=e}},{key:"registerListeners",value:function(){this.hls.on(vo.MEDIA_ATTACHING,this.onMediaAttaching,this)}},{key:"unregisterListeners",value:function(){this.hls.off(vo.MEDIA_ATTACHING,this.onMediaAttaching,this)}},{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}},{key:"onMediaAttaching",value:function(e,t){var r=this.hls.config;if(r.capLevelOnFPSDrop){var n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&"function"==typeof n.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function(e,t,r){var n=performance.now();if(t){if(this.lastTime){var i=n-this.lastTime,a=r-this.lastDroppedFrames,o=t-this.lastDecodedFrames,s=1e3*a/i,u=this.hls;if(u.trigger(vo.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:r}),s>0&&a>u.config.fpsDroppedMonitoringThreshold*o){var c=u.currentLevel;Ao.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(-1===u.autoLevelCapping||u.autoLevelCapping>=c)&&(c-=1,u.trigger(vo.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}},{key:"checkFPSInterval",value:function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}]),Sh="[eme]",Ah=function(){function e(t){R(this,e),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=e.CDMCleanupPromise?[e.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=Ao.debug.bind(Ao,Sh),this.log=Ao.log.bind(Ao,Sh),this.warn=Ao.warn.bind(Ao,Sh),this.error=Ao.error.bind(Ao,Sh),this.hls=t,this.config=t.config,this.registerListeners()}return D(e,[{key:"destroy",value:function(){this.unregisterListeners(),this.onMediaDetached();var e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}},{key:"registerListeners",value:function(){this.hls.on(vo.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(vo.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(vo.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(vo.MANIFEST_LOADED,this.onManifestLoaded,this)}},{key:"unregisterListeners",value:function(){this.hls.off(vo.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(vo.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(vo.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(vo.MANIFEST_LOADED,this.onManifestLoaded,this)}},{key:"getLicenseServerUrl",value:function(e){var t=this.config,r=t.drmSystems,n=t.widevineLicenseUrl,i=r[e];if(i)return i.licenseUrl;if(e===Uo.WIDEVINE&&n)return n;throw new Error('no license server URL configured for key-system "'.concat(e,'"'))}},{key:"getServerCertificateUrl",value:function(e){var t=this.config.drmSystems[e];if(t)return t.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'.concat(e,'"]'))}},{key:"attemptKeySystemAccess",value:function(e){var t=this,r=this.hls.levels,n=function(e,t,r){return!!e&&r.indexOf(e)===t},i=r.map((function(e){return e.audioCodec})).filter(n),a=r.map((function(e){return e.videoCodec})).filter(n);return i.length+a.length===0&&a.push("avc1.42e01e"),new Promise((function(r,n){var o=function(e){var s=e.shift();t.getMediaKeysPromise(s,i,a).then((function(e){return r({keySystem:s,mediaKeys:e})})).catch((function(t){e.length?o(e):n(t instanceof Rh?t:new Rh({type:go.KEY_SYSTEM_ERROR,details:mo.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))}))};o(e)}))}},{key:"requestMediaKeySystemAccess",value:function(e,t){var r=this.config.requestMediaKeySystemAccessFunc;if("function"!=typeof r){var n="Configured requestMediaKeySystemAccess is not a function ".concat(r);return null===Xo&&"http:"===self.location.protocol&&(n="navigator.requestMediaKeySystemAccess is not available over insecure protocol ".concat(location.protocol)),Promise.reject(new Error(n))}return r(e,t)}},{key:"getMediaKeysPromise",value:function(e,t,r){var n=this,i=function(e,t,r,n){var i;switch(e){case Uo.FAIRPLAY:i=["cenc","sinf"];break;case Uo.WIDEVINE:case Uo.PLAYREADY:i=["cenc"];break;case Uo.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error("Unknown key-system: ".concat(e))}return function(e,t,r,n){return[{initDataTypes:e,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:t.map((function(e){return{contentType:'audio/mp4; codecs="'.concat(e,'"'),robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null}})),videoCapabilities:r.map((function(e){return{contentType:'video/mp4; codecs="'.concat(e,'"'),robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}}))}]}(i,t,r,n)}(e,t,r,this.config.drmSystemOptions),a=this.keySystemAccessPromises[e],o=null==a?void 0:a.keySystemAccess;if(!o){this.log('Requesting encrypted media "'.concat(e,'" key-system access with config: ').concat(JSON.stringify(i))),o=this.requestMediaKeySystemAccess(e,i);var s=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch((function(t){n.log('Failed to obtain access to key-system "'.concat(e,'": ').concat(t))})),o.then((function(t){n.log('Access for key-system "'.concat(t.keySystem,'" obtained'));var r=n.fetchServerCertificate(e);return n.log('Create media-keys for "'.concat(e,'"')),s.mediaKeys=t.createMediaKeys().then((function(t){return n.log('Media-keys created for "'.concat(e,'"')),r.then((function(r){return r?n.setMediaKeysServerCertificate(t,e,r):t}))})),s.mediaKeys.catch((function(t){n.error('Failed to create media-keys for "'.concat(e,'"}: ').concat(t))})),s.mediaKeys}))}return o.then((function(){return a.mediaKeys}))}},{key:"createMediaKeySessionContext",value:function(e){var t=e.decryptdata,r=e.keySystem,n=e.mediaKeys;this.log('Creating key-system session "'.concat(r,'" keyId: ').concat(fs(t.keyId||[])));var i=n.createSession(),a={decryptdata:t,keySystem:r,mediaKeys:n,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(a),a}},{key:"renewKeySession",value:function(e){var t=e.decryptdata;if(t.pssh){var r=this.createMediaKeySessionContext(e),n=this.getKeyIdString(t);this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(r,"cenc",t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}},{key:"getKeyIdString",value:function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return fs(e.keyId)}},{key:"updateKeySession",value:function(e,t){var r,n=e.mediaKeysSession;return this.log('Updating key-session "'.concat(n.sessionId,'" for keyID ').concat(fs((null==(r=e.decryptdata)?void 0:r.keyId)||[]),"\n      } (data length: ").concat(t?t.byteLength:t,")")),n.update(t)}},{key:"selectKeySystemFormat",value:function(e){var t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: ".concat(e.sn," ").concat(e.type,": ").concat(e.level,") key formats ").concat(t.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}},{key:"getKeyFormatPromise",value:function(e){var t=this;return new Promise((function(r,n){var i=qo(t.config),a=e.map(Ho).filter((function(e){return!!e&&-1!==i.indexOf(e)}));return t.getKeySystemSelectionPromise(a).then((function(e){var t=e.keySystem,i=zo(t);i?r(i):n(new Error('Unable to find format for key-system "'.concat(t,'"')))})).catch(n)}))}},{key:"loadKey",value:function(e){var t=this,r=e.keyInfo.decryptdata,n=this.getKeyIdString(r),i="(keyId: ".concat(n,' format: "').concat(r.keyFormat,'" method: ').concat(r.method," uri: ").concat(r.uri,")");this.log("Starting session for key ".concat(i));var a=this.keyIdToKeySessionPromise[n];return a||(a=this.keyIdToKeySessionPromise[n]=this.getKeySystemForKeyPromise(r).then((function(n){var a=n.keySystem,o=n.mediaKeys;return t.throwIfDestroyed(),t.log("Handle encrypted media sn: ".concat(e.frag.sn," ").concat(e.frag.type,": ").concat(e.frag.level," using key ").concat(i)),t.attemptSetMediaKeys(a,o).then((function(){t.throwIfDestroyed();var e=t.createMediaKeySessionContext({keySystem:a,mediaKeys:o,decryptdata:r});return t.generateRequestWithPreferredKeySession(e,"cenc",r.pssh,"playlist-key")}))}))).catch((function(e){return t.handleError(e)})),a}},{key:"throwIfDestroyed",value:function(){if(!this.hls)throw new Error("invalid state")}},{key:"handleError",value:function(e){this.hls&&(this.error(e.message),e instanceof Rh?this.hls.trigger(vo.ERROR,e.data):this.hls.trigger(vo.ERROR,{type:go.KEY_SYSTEM_ERROR,details:mo.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}},{key:"getKeySystemForKeyPromise",value:function(e){var t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){var n=Ho(e.keyFormat),i=n?[n]:qo(this.config);return this.attemptKeySystemAccess(i)}return r}},{key:"getKeySystemSelectionPromise",value:function(e){if(e.length||(e=qo(this.config)),0===e.length)throw new Rh({type:go.KEY_SYSTEM_ERROR,details:mo.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options ".concat(JSON.stringify({drmSystems:this.config.drmSystems})));return this.attemptKeySystemAccess(e)}},{key:"_onMediaEncrypted",value:function(e){var t=this,r=e.initDataType,n=e.initData,i='"'.concat(e.type,'" event: init data type: "').concat(r,'"');if(this.debug(i),null!==n){var a,o;if("sinf"===r&&this.config.drmSystems[Uo.FAIRPLAY]){var s=ms(new Uint8Array(n));try{var u=Lo(JSON.parse(s).sinf),c=Ds(new Uint8Array(u));if(!c)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");a=c.subarray(8,24),o=Uo.FAIRPLAY}catch(e){return void this.warn("".concat(i," Failed to parse sinf: ").concat(e))}}else{var d=function(e){var t=[];if(e instanceof ArrayBuffer)for(var r=e.byteLength,n=0;n+32<r;){var i=Vs(new DataView(e,n));t.push(i),n+=i.size}return t}(n),l=d.filter((function(e){return e.systemId===jo}))[0];if(!l)return void(0===d.length||d.some((function(e){return!e.systemId}))?this.warn("".concat(i," contains incomplete or invalid pssh data")):this.log("ignoring ".concat(i," for ").concat(d.map((function(e){return Ko(e.systemId)})).join(",")," pssh data in favor of playlist keys")));if(o=Ko(l.systemId),0===l.version&&l.data){var h=l.data.length-22;a=l.data.subarray(h,h+16)}}if(o&&a){for(var f,p=fs(a),v=this.keyIdToKeySessionPromise,g=this.mediaKeySessions,m=v[p],y=function(){var e=g[_],i=e.decryptdata;if(!i.keyId)return 0;var o=fs(i.keyId);return p===o||-1!==i.uri.replace(/-/g,"").indexOf(p)?(m=v[o],i.pssh||(delete v[o],i.pssh=new Uint8Array(n),i.keyId=a,m=v[p]=m.then((function(){return t.generateRequestWithPreferredKeySession(e,r,n,"encrypted-event-key-match")}))),1):void 0},_=0;_<g.length&&(0===(f=y())||1!==f);_++);m||(m=v[p]=this.getKeySystemSelectionPromise([o]).then((function(e){var i,o=e.keySystem,s=e.mediaKeys;t.throwIfDestroyed();var u=new Fs("ISO-23001-7",p,null!=(i=zo(o))?i:"");return u.pssh=new Uint8Array(n),u.keyId=a,t.attemptSetMediaKeys(o,s).then((function(){t.throwIfDestroyed();var e=t.createMediaKeySessionContext({decryptdata:u,keySystem:o,mediaKeys:s});return t.generateRequestWithPreferredKeySession(e,r,n,"encrypted-event-no-match")}))}))),m.catch((function(e){return t.handleError(e)}))}}}},{key:"_onWaitingForKey",value:function(e){this.log('"'.concat(e.type,'" event'))}},{key:"attemptSetMediaKeys",value:function(e,t){var r=this,n=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'.concat(e,'"'));var i=Promise.all(n).then((function(){if(!r.media)throw new Error("Attempted to set mediaKeys without media element attached");return r.media.setMediaKeys(t)}));return this.setMediaKeysQueue.push(i),i.then((function(){r.log('Media-keys set for "'.concat(e,'"')),n.push(i),r.setMediaKeysQueue=r.setMediaKeysQueue.filter((function(e){return-1===n.indexOf(e)}))}))}},{key:"generateRequestWithPreferredKeySession",value:function(e,t,r,n){var i,a,o=this,s=null==(i=this.config.drmSystems)||null==(a=i[e.keySystem])?void 0:a.generateRequest;if(s)try{var u=s.call(this.hls,t,r,e);if(!u)throw new Error("Invalid response from configured generateRequest filter");t=u.initDataType,r=e.decryptdata.pssh=u.initData?new Uint8Array(u.initData):null}catch(e){var c;if(this.warn(e.message),null!=(c=this.hls)&&c.config.debug)throw e}if(null===r)return this.log('Skipping key-session request for "'.concat(n,'" (no initData)')),Promise.resolve(e);var d=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'.concat(n,'": ').concat(d," (init data type: ").concat(t," length: ").concat(r?r.byteLength:null,")"));var l=new ll,h=e._onmessage=function(t){var r=e.mediaKeysSession;if(r){var n=t.messageType,i=t.message;o.log('"'.concat(n,'" message event for session "').concat(r.sessionId,'" message size: ').concat(i.byteLength)),"license-request"===n||"license-renewal"===n?o.renewLicense(e,i).catch((function(e){o.handleError(e),l.emit("error",e)})):"license-release"===n?e.keySystem===Uo.FAIRPLAY&&(o.updateKeySession(e,No("acknowledged")),o.removeSession(e)):o.warn('unhandled media key message type "'.concat(n,'"'))}else l.emit("error",new Error("invalid state"))},f=e._onkeystatuseschange=function(t){if(e.mediaKeysSession){o.onKeyStatusChange(e);var r=e.keyStatus;l.emit("keyStatus",r),"expired"===r&&(o.warn("".concat(e.keySystem," expired for key ").concat(d)),o.renewKeySession(e))}else l.emit("error",new Error("invalid state"))};e.mediaKeysSession.addEventListener("message",h),e.mediaKeysSession.addEventListener("keystatuseschange",f);var p=new Promise((function(e,t){l.on("error",t),l.on("keyStatus",(function(r){r.startsWith("usable")?e():"output-restricted"===r?t(new Rh({type:go.KEY_SYSTEM_ERROR,details:mo.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===r?t(new Rh({type:go.KEY_SYSTEM_ERROR,details:mo.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'.concat(r,'"'))):"expired"===r?t(new Error("key expired while generating request")):o.warn('unhandled key status change "'.concat(r,'"'))}))}));return e.mediaKeysSession.generateRequest(t,r).then((function(){var t;o.log('Request generated for key-session "'.concat(null==(t=e.mediaKeysSession)?void 0:t.sessionId,'" keyId: ').concat(d))})).catch((function(e){throw new Rh({type:go.KEY_SYSTEM_ERROR,details:mo.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},"Error generating key-session request: ".concat(e))})).then((function(){return p})).catch((function(t){throw l.removeAllListeners(),o.removeSession(e),t})).then((function(){return l.removeAllListeners(),e}))}},{key:"onKeyStatusChange",value:function(e){var t=this;e.mediaKeysSession.keyStatuses.forEach((function(r,n){t.log('key status change "'.concat(r,'" for keyStatuses keyId: ').concat(fs("buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n))," session keyId: ").concat(fs(new Uint8Array(e.decryptdata.keyId||[]))," uri: ").concat(e.decryptdata.uri)),e.keyStatus=r}))}},{key:"fetchServerCertificate",value:function(e){var t=this.config,r=new t.loader(t),n=this.getServerCertificateUrl(e);return n?(this.log('Fetching server certificate for "'.concat(e,'"')),new Promise((function(i,a){var o={responseType:"arraybuffer",url:n},s=t.certLoadPolicy.default,u={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:function(e,t,r,n){i(e.data)},onError:function(t,r,i,s){a(new Rh({type:go.KEY_SYSTEM_ERROR,details:mo.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:uo({url:o.url,data:void 0},t)},'"'.concat(e,'" certificate request failed (').concat(n,"). Status: ").concat(t.code," (").concat(t.text,")")))},onTimeout:function(t,r,i){a(new Rh({type:go.KEY_SYSTEM_ERROR,details:mo.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:{url:o.url,data:void 0}},'"'.concat(e,'" certificate request timed out (').concat(n,")")))},onAbort:function(e,t,r){a(new Error("aborted"))}};r.load(o,u,c)}))):Promise.resolve()}},{key:"setMediaKeysServerCertificate",value:function(e,t,r){var n=this;return new Promise((function(i,a){e.setServerCertificate(r).then((function(a){n.log("setServerCertificate ".concat(a?"success":"not supported by CDM"," (").concat(null==r?void 0:r.byteLength,') on "').concat(t,'"')),i(e)})).catch((function(e){a(new Rh({type:go.KEY_SYSTEM_ERROR,details:mo.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))}))}))}},{key:"renewLicense",value:function(e,t){var r=this;return this.requestLicense(e,new Uint8Array(t)).then((function(t){return r.updateKeySession(e,new Uint8Array(t)).catch((function(e){throw new Rh({type:go.KEY_SYSTEM_ERROR,details:mo.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))}))}},{key:"unpackPlayReadyKeyMessage",value:function(e,t){var r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;var n=(new DOMParser).parseFromString(r,"application/xml"),i=n.querySelectorAll("HttpHeader");if(i.length>0)for(var a,o=0,s=i.length;o<s;o++){var u,c,d=null==(u=(a=i[o]).querySelector("name"))?void 0:u.textContent,l=null==(c=a.querySelector("value"))?void 0:c.textContent;d&&l&&e.setRequestHeader(d,l)}var h=n.querySelector("Challenge"),f=null==h?void 0:h.textContent;if(!f)throw new Error("Cannot find <Challenge> in key message");return No(atob(f))}},{key:"setupLicenseXHR",value:function(e,t,r,n){var i=this,a=this.config.licenseXhrSetup;return a?Promise.resolve().then((function(){if(!r.decryptdata)throw new Error("Key removed");return a.call(i.hls,e,t,r,n)})).catch((function(o){if(!r.decryptdata)throw o;return e.open("POST",t,!0),a.call(i.hls,e,t,r,n)})).then((function(r){return e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:r||n}})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))}},{key:"requestLicense",value:function(e,t){var r=this,n=this.config.keyLoadPolicy.default;return new Promise((function(i,a){var o=r.getLicenseServerUrl(e.keySystem);r.log("Sending license request to URL: ".concat(o));var s=new XMLHttpRequest;s.responseType="arraybuffer",s.onreadystatechange=function(){if(!r.hls||!e.mediaKeysSession)return a(new Error("invalid state"));if(4===s.readyState)if(200===s.status){r._requestLicenseFailureCount=0;var u=s.response;r.log("License received ".concat(u instanceof ArrayBuffer?u.byteLength:u));var c=r.config.licenseResponseCallback;if(c)try{u=c.call(r.hls,s,o,e)}catch(e){r.error(e)}i(u)}else{var d=n.errorRetry,l=d?d.maxNumRetry:0;if(r._requestLicenseFailureCount++,r._requestLicenseFailureCount>l||s.status>=400&&s.status<500)a(new Rh({type:go.KEY_SYSTEM_ERROR,details:mo.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:s,response:{url:o,data:void 0,code:s.status,text:s.statusText}},"License Request XHR failed (".concat(o,"). Status: ").concat(s.status," (").concat(s.statusText,")")));else{var h=l-r._requestLicenseFailureCount+1;r.warn("Retrying license request, ".concat(h," attempts left")),r.requestLicense(e,t).then(i,a)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=s,r.setupLicenseXHR(s,o,e,t).then((function(t){var n=t.xhr,i=t.licenseChallenge;e.keySystem==Uo.PLAYREADY&&(i=r.unpackPlayReadyKeyMessage(n,i)),n.send(i)}))}))}},{key:"onMediaAttached",value:function(e,t){if(this.config.emeEnabled){var r=t.media;this.media=r,r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}}},{key:"onMediaDetached",value:function(){var t=this,r=this.media,n=this.mediaKeySessions;r&&(r.removeEventListener("encrypted",this.onMediaEncrypted),r.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Fs.clearKeyUriToKeyIdMap();var i=n.length;e.CDMCleanupPromise=Promise.all(n.map((function(e){return t.removeSession(e)})).concat(null==r?void 0:r.setMediaKeys(null).catch((function(e){t.log("Could not clear media keys: ".concat(e))})))).then((function(){i&&(t.log("finished closing key sessions and clearing media keys"),n.length=0)})).catch((function(e){t.log("Could not close sessions and clear media keys: ".concat(e))}))}},{key:"onManifestLoading",value:function(){this.keyFormatPromise=null}},{key:"onManifestLoaded",value:function(e,t){var r=t.sessionKeys;if(r&&this.config.emeEnabled&&!this.keyFormatPromise){var n=r.reduce((function(e,t){return-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e}),[]);this.log("Selecting key-system from session-keys ".concat(n.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(n)}}},{key:"removeSession",value:function(e){var t=this,r=e.mediaKeysSession,n=e.licenseXhr;if(r){this.log("Remove licenses and keys and close session ".concat(r.sessionId)),e._onmessage&&(r.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(r.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var i=this.mediaKeySessions.indexOf(e);return i>-1&&this.mediaKeySessions.splice(i,1),r.remove().catch((function(e){t.log("Could not remove session: ".concat(e))})).then((function(){return r.close()})).catch((function(e){t.log("Could not close session: ".concat(e))}))}}}])}();Ah.CDMCleanupPromise=void 0;var bh,Eh,kh,Ch,wh,Th,Rh=function(){function e(t,r){var n;return R(this,e),(n=c(this,e,[r])).data=void 0,t.error||(t.error=new Error(r)),n.data=t,t.err=t.error,n}return f(e,o(Error)),D(e)}();(Eh=bh||(bh={})).MANIFEST="m",Eh.AUDIO="a",Eh.VIDEO="v",Eh.MUXED="av",Eh.INIT="i",Eh.CAPTION="c",Eh.TIMED_TEXT="tt",Eh.KEY="k",Eh.OTHER="o",(Ch=kh||(kh={})).DASH="d",Ch.HLS="h",Ch.SMOOTH="s",Ch.OTHER="o",(Th=wh||(wh={})).OBJECT="CMCD-Object",Th.REQUEST="CMCD-Request",Th.SESSION="CMCD-Session",Th.STATUS="CMCD-Status";var Ih=w(w(w(w({},wh.OBJECT,["br","d","ot","tb"]),wh.REQUEST,["bl","dl","mtp","nor","nrr","su"]),wh.SESSION,["cid","pr","sf","sid","st","v"]),wh.STATUS,["bs","rtp"]),Dh=D((function e(t,r){R(this,e),this.value=void 0,this.params=void 0,Array.isArray(t)&&(t=t.map((function(t){return t instanceof e?t:new e(t)}))),this.value=t,this.params=r})),Mh=D((function e(t){R(this,e),this.description=void 0,this.description=t})),Oh="Bare Item",xh=/[\x00-\x1f\x7f]+/;function Ph(e,t,r){return function(e,t,r,n){return new Error("failed to ".concat("serialize",' "').concat((i=t,Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":"object"===j(i)?JSON.stringify(i):String(i)),'" as ').concat(r),{cause:n});var i}(0,e,t,r)}function Lh(e){if(function(e){return e<-999999999999999||999999999999999<e}(e))throw Ph(e,"Integer");return e.toString()}function Nh(e,t){if(e<0)return-Nh(-e,t);var r=Math.pow(10,t);if(Math.abs(e*r%1-.5)<Number.EPSILON){var n=Math.floor(e*r);return(n%2==0?n:n+1)/r}return Math.round(e*r)/r}function Vh(e){var t=Nh(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw Ph(e,"Decimal");var r=t.toString();return r.includes(".")?r:"".concat(r,".0")}function Uh(e){var t,r=(t=e).description||t.toString().slice(7,-1);if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(r))throw Ph(r,"Token");return r}function Fh(e){switch(j(e)){case"number":if(!ho(e))throw Ph(e,Oh);return Number.isInteger(e)?Lh(e):Vh(e);case"string":return function(e){if(xh.test(e))throw Ph(e,"String");return'"'.concat(e.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),'"')}(e);case"symbol":return Uh(e);case"boolean":return function(e){if("boolean"!=typeof e)throw Ph(e,"Boolean");return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return function(e){return"@".concat(Lh(e.getTime()/1e3))}(e);if(e instanceof Uint8Array)return function(e){if(!1===ArrayBuffer.isView(e))throw Ph(e,"Byte Sequence");return":".concat((t=e,btoa(String.fromCharCode.apply(String,y(t)))),":");var t}(e);if(e instanceof Mh)return Uh(e);default:throw Ph(e,Oh)}}function Bh(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw Ph(e,"Key");return e}function Wh(e){return null==e?"":Object.entries(e).map((function(e){var t=v(e,2),r=t[0],n=t[1];return!0===n?";".concat(Bh(r)):";".concat(Bh(r),"=").concat(Fh(n))})).join("")}function Gh(e){return e instanceof Dh?"".concat(Fh(e.value)).concat(Wh(e.params)):Fh(e)}var Hh=function(e){return Math.round(e)},jh=function(e){return 100*Hh(e/100)},Kh={br:Hh,d:Hh,bl:jh,dl:jh,mtp:jh,nor:function(e,t){return null!=t&&t.baseUrl&&(e=function(e,t){var r=new URL(e),n=new URL(t);if(r.origin!==n.origin)return e;for(var i=r.pathname.split("/").slice(1),a=n.pathname.split("/").slice(1,-1);i[0]===a[0];)i.shift(),a.shift();for(;a.length;)a.shift(),i.unshift("..");return i.join("/")}(e,t.baseUrl)),encodeURIComponent(e)},rtp:jh,tb:Hh};function zh(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?function(e,t){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{whitespace:!0};if("object"!==j(e))throw Ph(e,"Dict");var r=e instanceof Map?e.entries():Object.entries(e),n=null!=t&&t.whitespace?" ":"";return Array.from(r).map((function(e){var t=v(e,2),r=t[0],n=t[1];n instanceof Dh==0&&(n=new Dh(n));var i=Bh(r);return!0===n.value?i+=Wh(n.params):(i+="=",Array.isArray(n.value)?i+=function(e){return"(".concat(e.value.map(Gh).join(" "),")").concat(Wh(e.params))}(n):i+=Gh(n)),i})).join(",".concat(n))}(e,t)}(function(e,t){var r={};if(null==e||"object"!==j(e))return r;var n=Object.keys(e).sort(),i=lo({},Kh,null==t?void 0:t.formatters),a=null==t?void 0:t.filter;return n.forEach((function(n){if(null==a||!a(n)){var o=e[n],s=i[n];s&&(o=s(o,t)),"v"===n&&1===o||"pr"==n&&1===o||function(e){return"number"==typeof e?ho(e):null!=e&&""!==e&&!1!==e}(o)&&(function(e){return"ot"===e||"sf"===e||"st"===e}(n)&&"string"==typeof o&&(o=new Mh(o)),r[n]=o)}})),r}(e,t),lo({whitespace:!1},t)):""}var qh=/CMCD=[^&#]+/,Yh=D((function e(t){var r=this;R(this,e),this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){r.initialized&&(r.starved=!0),r.buffering=!0},this.onPlaying=function(){r.initialized||(r.initialized=!0),r.buffering=!1},this.applyPlaylistData=function(e){try{r.apply(e,{ot:bh.MANIFEST,su:!r.initialized})}catch(e){Ao.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=function(e){try{var t=e.frag,n=r.hls.levels[t.level],i=r.getObjectType(t),a={d:1e3*t.duration,ot:i};i!==bh.VIDEO&&i!==bh.AUDIO&&i!=bh.MUXED||(a.br=n.bitrate/1e3,a.tb=r.getTopBandwidth(i)/1e3,a.bl=r.getBufferLength(i)),r.apply(e,a)}catch(e){Ao.warn("Could not generate segment CMCD data.",e)}},this.hls=t;var n=this.config=t.config,i=n.cmcd;null!=i&&(n.pLoader=this.createPlaylistLoader(),n.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||function(){try{return crypto.randomUUID()}catch(n){try{var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){var r=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==e?t:3&t|8).toString(16)}))}}}(),this.cid=i.contentId,this.useHeaders=!0===i.useHeaders,this.includeKeys=i.includeKeys,this.registerListeners())}),[{key:"registerListeners",value:function(){var e=this.hls;e.on(vo.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(vo.MEDIA_DETACHED,this.onMediaDetached,this),e.on(vo.BUFFER_CREATED,this.onBufferCreated,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(vo.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(vo.MEDIA_DETACHED,this.onMediaDetached,this),e.off(vo.BUFFER_CREATED,this.onBufferCreated,this)}},{key:"destroy",value:function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}},{key:"onMediaAttached",value:function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}},{key:"onMediaDetached",value:function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}},{key:"onBufferCreated",value:function(e,t){var r,n;this.audioBuffer=null==(r=t.tracks.audio)?void 0:r.buffer,this.videoBuffer=null==(n=t.tracks.video)?void 0:n.buffer}},{key:"createData",value:function(){var e;return{v:1,sf:kh.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}},{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};lo(t,this.createData());var r=t.ot===bh.INIT||t.ot===bh.VIDEO||t.ot===bh.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);var n=this.includeKeys;n&&(t=Object.keys(t).reduce((function(e,r){return n.includes(r)&&(e[r]=t[r]),e}),{})),this.useHeaders?(e.headers||(e.headers={}),function(e,t){lo(e,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return{};var r=Object.entries(e),n=Object.entries(Ih).concat(Object.entries((null==t?void 0:t.customHeaderMap)||{})),i=r.reduce((function(e,t){var r,i=v(t,2),a=i[0],o=i[1],s=(null==(r=n.find((function(e){return e[1].includes(a)})))?void 0:r[0])||wh.REQUEST;return null!=e[s]||(e[s]={}),e[s][a]=o,e}),{});return Object.entries(i).reduce((function(e,r){var n=v(r,2),i=n[0],a=n[1];return e[i]=zh(a,t),e}),{})}(t,void 0))}(e.headers,t)):e.url=function(e,t){var r=function(e){if(!e)return"";var t=zh(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return"".concat("CMCD","=").concat(encodeURIComponent(t))}(t,void 0);if(!r)return e;if(qh.test(e))return e.replace(qh,r);var n=e.includes("?")?"&":"?";return"".concat(e).concat(n).concat(r)}(e.url,t)}},{key:"getObjectType",value:function(e){var t=e.type;return"subtitle"===t?bh.TIMED_TEXT:"initSegment"===e.sn?bh.INIT:"audio"===t?bh.AUDIO:"main"===t?this.hls.audioTracks.length?bh.VIDEO:bh.MUXED:void 0}},{key:"getTopBandwidth",value:function(e){var t,r=0,n=this.hls;if(e===bh.AUDIO)t=n.audioTracks;else{var i=n.maxAutoLevel,a=i>-1?i+1:n.levels.length;t=n.levels.slice(0,a)}var o,s=A(t);try{for(s.s();!(o=s.n()).done;){var u=o.value;u.bitrate>r&&(r=u.bitrate)}}catch(e){s.e(e)}finally{s.f()}return r>0?r:NaN}},{key:"getBufferLength",value:function(e){var t=this.hls.media,r=e===bh.AUDIO?this.audioBuffer:this.videoBuffer;return r&&t?1e3*Rc.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len:NaN}},{key:"createPlaylistLoader",value:function(){var e=this.config.pLoader,t=this.applyPlaylistData,r=e||this.config.loader;return D((function e(t){R(this,e),this.loader=void 0,this.loader=new r(t)}),[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}},{key:"destroy",value:function(){this.loader.destroy()}},{key:"abort",value:function(){this.loader.abort()}},{key:"load",value:function(e,r,n){t(e),this.loader.load(e,r,n)}}])}},{key:"createFragmentLoader",value:function(){var e=this.config.fLoader,t=this.applyFragmentData,r=e||this.config.loader;return D((function e(t){R(this,e),this.loader=void 0,this.loader=new r(t)}),[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}},{key:"destroy",value:function(){this.loader.destroy()}},{key:"abort",value:function(){this.loader.abort()}},{key:"load",value:function(e,r,n){t(e),this.loader.load(e,r,n)}}])}}]),Xh=D((function e(t){R(this,e),this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.log=Ao.log.bind(Ao,"[content-steering]:"),this.registerListeners()}),[{key:"registerListeners",value:function(){var e=this.hls;e.on(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.on(vo.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(vo.MANIFEST_PARSED,this.onManifestParsed,this),e.on(vo.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e&&(e.off(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.off(vo.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(vo.MANIFEST_PARSED,this.onManifestParsed,this),e.off(vo.ERROR,this.onError,this))}},{key:"startLoad",value:function(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){var e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}},{key:"stopLoad",value:function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}},{key:"clearTimeout",value:function(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}},{key:"destroy",value:function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}},{key:"removeLevel",value:function(e){var t=this.levels;t&&(this.levels=t.filter((function(t){return t!==e})))}},{key:"onManifestLoading",value:function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}},{key:"onManifestLoaded",value:function(e,t){var r=t.contentSteering;null!==r&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}},{key:"onManifestParsed",value:function(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}},{key:"onError",value:function(e,t){var r=t.errorAction;if(2===(null==r?void 0:r.action)&&1===r.flags){var n=this.levels,i=this.pathwayPriority,a=this.pathwayId;if(t.context){var o=t.context,s=o.groupId,u=o.pathwayId,c=o.type;s&&n?a=this.getPathwayForGroupId(s,c,a):u&&(a=u)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!i&&n&&(i=n.reduce((function(e,t){return-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e}),[])),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==a),r.resolved||Ao.warn("Could not resolve ".concat(t.details,' ("').concat(t.error.message,'") with content-steering for Pathway: ').concat(a," levels: ").concat(n?n.length:n," priorities: ").concat(JSON.stringify(i)," penalized: ").concat(JSON.stringify(this.penalizedPathways)))}}},{key:"filterParsedLevels",value:function(e){this.levels=e;var t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){var r=e[0].pathwayId;this.log("No levels found in Pathway ".concat(this.pathwayId,'. Setting initial Pathway to "').concat(r,'"')),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log("Found ".concat(t.length,"/").concat(e.length,' levels in Pathway "').concat(this.pathwayId,'"')),t}},{key:"getLevelsForPathway",value:function(e){return null===this.levels?[]:this.levels.filter((function(t){return e===t.pathwayId}))}},{key:"updatePathwayPriority",value:function(e){var t;this.pathwayPriority=e;var r=this.penalizedPathways,n=performance.now();Object.keys(r).forEach((function(e){n-r[e]>3e5&&delete r[e]}));for(var i=0;i<e.length;i++){var a=e[i];if(!(a in r)){if(a===this.pathwayId)return;var o=this.hls.nextLoadLevel,s=this.hls.levels[o];if((t=this.getLevelsForPathway(a)).length>0){this.log('Setting Pathway to "'.concat(a,'"')),this.pathwayId=a,Ju(t),this.hls.trigger(vo.LEVELS_UPDATED,{levels:t});var u=this.hls.levels[o];s&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==s.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==s.bitrate&&this.log("Unstable Pathways change from bitrate ".concat(s.bitrate," to ").concat(u.bitrate)),this.hls.nextLoadLevel=o);break}}}}},{key:"getPathwayForGroupId",value:function(e,t,r){for(var n=this.getLevelsForPathway(r).concat(this.levels||[]),i=0;i<n.length;i++)if(t===yu&&n[i].hasAudioGroup(e)||t===_u&&n[i].hasSubtitleGroup(e))return n[i].pathwayId;return r}},{key:"clonePathways",value:function(e){var t=this,r=this.levels;if(r){var n={},i={};e.forEach((function(e){var a=e.ID,o=e["BASE-ID"],s=e["URI-REPLACEMENT"];if(!r.some((function(e){return e.pathwayId===a}))){var u=t.getLevelsForPathway(o).map((function(e){var t=new ko(e.attrs);t["PATHWAY-ID"]=a;var r=t.AUDIO&&"".concat(t.AUDIO,"_clone_").concat(a),o=t.SUBTITLES&&"".concat(t.SUBTITLES,"_clone_").concat(a);r&&(n[t.AUDIO]=r,t.AUDIO=r),o&&(i[t.SUBTITLES]=o,t.SUBTITLES=o);var u=Jh(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",s),c=new Hu({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:u,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(var d=1;d<e.audioGroups.length;d++)c.addGroupId("audio","".concat(e.audioGroups[d],"_clone_").concat(a));if(e.subtitleGroups)for(var l=1;l<e.subtitleGroups.length;l++)c.addGroupId("text","".concat(e.subtitleGroups[l],"_clone_").concat(a));return c}));r.push.apply(r,y(u)),Qh(t.audioTracks,n,s,a),Qh(t.subtitleTracks,i,s,a)}}))}}},{key:"loadSteeringManifest",value:function(e){var t,r=this,n=this.hls.config,i=n.loader;this.loader&&this.loader.destroy(),this.loader=new i(n);try{t=new self.URL(e)}catch(t){return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: ".concat(e))}if("data:"!==t.protocol){var a=0|(this.hls.bandwidthEstimate||n.abrEwmaDefaultEstimate);t.searchParams.set("_HLS_pathway",this.pathwayId),t.searchParams.set("_HLS_throughput",""+a)}var o={responseType:"json",url:t.href},s=n.steeringManifestLoadPolicy.default,u=s.errorRetry||s.timeoutRetry||{},c={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},d={onSuccess:function(e,n,i,a){r.log('Loaded steering manifest: "'.concat(t,'"'));var o=e.data;if(1===o.VERSION){r.updated=performance.now(),r.timeToLoad=o.TTL;var s=o["RELOAD-URI"],u=o["PATHWAY-CLONES"],c=o["PATHWAY-PRIORITY"];if(s)try{r.uri=new self.URL(s,t).href}catch(e){return r.enabled=!1,void r.log("Failed to parse Steering Manifest RELOAD-URI: ".concat(s))}r.scheduleRefresh(r.uri||i.url),u&&r.clonePathways(u);var d={steeringManifest:o,url:t.toString()};r.hls.trigger(vo.STEERING_MANIFEST_LOADED,d),c&&r.updatePathwayPriority(c)}else r.log("Steering VERSION ".concat(o.VERSION," not supported!"))},onError:function(e,t,n,i){if(r.log("Error loading steering manifest: ".concat(e.code," ").concat(e.text," (").concat(t.url,")")),r.stopLoad(),410===e.code)return r.enabled=!1,void r.log("Steering manifest ".concat(t.url," no longer available"));var a=1e3*r.timeToLoad;if(429!==e.code)r.scheduleRefresh(r.uri||t.url,a);else{var o=r.loader;if("function"==typeof(null==o?void 0:o.getResponseHeader)){var s=o.getResponseHeader("Retry-After");s&&(a=1e3*parseFloat(s))}r.log("Steering manifest ".concat(t.url," rate limited"))}},onTimeout:function(e,t,n){r.log("Timeout loading steering manifest (".concat(t.url,")")),r.scheduleRefresh(r.uri||t.url)}};this.log("Requesting steering manifest: ".concat(t)),this.loader.load(o,c,d)}},{key:"scheduleRefresh",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3*this.timeToLoad;this.clearTimeout(),this.reloadTimer=self.setTimeout((function(){var r,n=null==(r=t.hls)?void 0:r.media;!n||n.ended?t.scheduleRefresh(e,1e3*t.timeToLoad):t.loadSteeringManifest(e)}),r)}}]);function Qh(e,t,r,n){e&&Object.keys(t).forEach((function(i){var a=e.filter((function(e){return e.groupId===i})).map((function(e){var a=lo({},e);return a.details=void 0,a.attrs=new ko(a.attrs),a.url=a.attrs.URI=Jh(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",r),a.groupId=a.attrs["GROUP-ID"]=t[i],a.attrs["PATHWAY-ID"]=n,a}));e.push.apply(e,y(a))}))}function Jh(e,t,r,n){var i,a=n.HOST,o=n.PARAMS,s=n[r];t&&(i=null==s?void 0:s[t])&&(e=i);var u=new self.URL(e);return a&&!i&&(u.host=a),o&&Object.keys(o).sort().forEach((function(e){e&&u.searchParams.set(e,o[e])})),u.href}var $h=/^age:\s*[\d.]+\s*$/im,Zh=D((function e(t){R(this,e),this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new To,this.retryDelay=0}),[{key:"destroy",value:function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}},{key:"abortInternal",value:function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}},{key:"abort",value:function(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}},{key:"load",value:function(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}},{key:"loadInternal",value:function(){var e=this,t=this.config,r=this.context;if(t&&r){var n=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;var a=this.xhrSetup;a?Promise.resolve().then((function(){if(e.loader===n&&!e.stats.aborted)return a(n,r.url)})).catch((function(t){if(e.loader===n&&!e.stats.aborted)return n.open("GET",r.url,!0),a(n,r.url)})).then((function(){e.loader!==n||e.stats.aborted||e.openAndSendXhr(n,r,t)})).catch((function(t){e.callbacks.onError({code:n.status,text:t.message},r,n,i)})):this.openAndSendXhr(n,r,t)}}},{key:"openAndSendXhr",value:function(e,t,r){e.readyState||e.open("GET",t.url,!0);var n=t.headers,i=r.loadPolicy,a=i.maxTimeToFirstByteMs,o=i.maxLoadTimeMs;if(n)for(var s in n)e.setRequestHeader(s,n[s]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=a&&ho(a)?a:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}},{key:"readystatechange",value:function(){var e=this.context,t=this.loader,r=this.stats;if(e&&t){var n=t.readyState,i=this.config;if(!r.aborted&&n>=2&&(0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),4===n)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;var a=t.status,o="text"!==t.responseType;if(a>=200&&a<300&&(o&&t.response||null!==t.responseText)){r.loading.end=Math.max(self.performance.now(),r.loading.first);var s=o?t.response:t.responseText,u="arraybuffer"===t.responseType?s.byteLength:s.length;if(r.loaded=r.total=u,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first),!this.callbacks)return;var c=this.callbacks.onProgress;if(c&&c(r,e,s,t),!this.callbacks)return;var d={url:t.responseURL,data:s,code:a};this.callbacks.onSuccess(d,r,e,t)}else{var l=i.loadPolicy.errorRetry;rc(l,r.retry,!1,{url:e.url,data:void 0,code:a})?this.retry(l):(Ao.error("".concat(a," while loading ").concat(e.url)),this.callbacks.onError({code:a,text:t.statusText},e,t,r))}}}}},{key:"loadtimeout",value:function(){if(this.config){var e=this.config.loadPolicy.timeoutRetry;if(rc(e,this.stats.retry,!0))this.retry(e);else{var t;Ao.warn("timeout while loading ".concat(null==(t=this.context)?void 0:t.url));var r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}}},{key:"retry",value:function(e){var t=this.context,r=this.stats;this.retryDelay=ec(e,r.retry),r.retry++,Ao.warn("".concat(status?"HTTP Status "+status:"Timeout"," while loading ").concat(null==t?void 0:t.url,", retrying ").concat(r.retry,"/").concat(e.maxNumRetry," in ").concat(this.retryDelay,"ms")),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}},{key:"loadprogress",value:function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}},{key:"getCacheAge",value:function(){var e=null;if(this.loader&&$h.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}},{key:"getResponseHeader",value:function(e){return this.loader&&new RegExp("^".concat(e,":\\s*[\\d.]+\\s*$"),"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}]),ef=/(\d+)-(\d+)\/(\d+)/,tf=D((function e(t){R(this,e),this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||rf,this.controller=new self.AbortController,this.stats=new To}),[{key:"destroy",value:function(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}},{key:"abortInternal",value:function(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}},{key:"abort",value:function(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}},{key:"load",value:function(e,t,r){var n=this,i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();var a=function(e,t){var r={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(lo({},e.headers))};return e.rangeEnd&&r.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),r}(e,this.controller.signal),o=r.onProgress,s="arraybuffer"===e.responseType,u=s?"byteLength":"length",c=t.loadPolicy,d=c.maxTimeToFirstByteMs,l=c.maxLoadTimeMs;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,a),self.clearTimeout(this.requestTimeout),t.timeout=d&&ho(d)?d:l,this.requestTimeout=self.setTimeout((function(){n.abortInternal(),r.onTimeout(i,e,n.response)}),t.timeout),self.fetch(this.request).then((function(a){n.response=n.loader=a;var u=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(n.requestTimeout),t.timeout=l,n.requestTimeout=self.setTimeout((function(){n.abortInternal(),r.onTimeout(i,e,n.response)}),l-(u-i.loading.start)),!a.ok){var c=a.status,d=a.statusText;throw new af(d||"fetch, bad network response",c,a)}return i.loading.first=u,i.total=function(e){var t=e.get("Content-Range");if(t){var r=function(e){var t=ef.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(ho(r))return r}var n=e.get("Content-Length");if(n)return parseInt(n)}(a.headers)||i.total,o&&ho(t.highWaterMark)?n.loadProgressively(a,i,e,t.highWaterMark,o):s?a.arrayBuffer():"json"===e.responseType?a.json():a.text()})).then((function(a){var s=n.response;if(!s)throw new Error("loader destroyed");self.clearTimeout(n.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);var c=a[u];c&&(i.loaded=i.total=c);var d={url:s.url,data:a,code:s.status};o&&!ho(t.highWaterMark)&&o(i,e,a,s),r.onSuccess(d,i,e,s)})).catch((function(t){if(self.clearTimeout(n.requestTimeout),!i.aborted){var a=t&&t.code||0,o=t?t.message:null;r.onError({code:a,text:o},e,t?t.details:null,i)}}))}},{key:"getCacheAge",value:function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}},{key:"getResponseHeader",value:function(e){return this.response?this.response.headers.get(e):null}},{key:"loadProgressively",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0,a=new rd,o=e.body.getReader(),s=function(){return o.read().then((function(o){if(o.done)return a.dataLength&&i(t,r,a.flush(),e),Promise.resolve(new ArrayBuffer(0));var u=o.value,c=u.length;return t.loaded+=c,c<n||a.dataLength?(a.push(u),a.dataLength>=n&&i(t,r,a.flush(),e)):i(t,r,u,e),s()})).catch((function(){return Promise.reject()}))};return s()}}]);function rf(e,t){return new self.Request(e.url,t)}var nf,af=function(){function e(t,r,n){var i;return R(this,e),(i=c(this,e,[t])).code=void 0,i.details=void 0,i.code=r,i.details=n,i}return f(e,o(Error)),D(e)}(),of=/\s/,sf=uo(uo({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Zh,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:yc,bufferController:El,capLevelController:yh,errorController:sc,fpsController:_h,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Xo,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:{newCue:function(e,t,r,n){for(var i,a,o,s,u,c=[],d=self.VTTCue||self.TextTrackCue,l=0;l<n.rows.length;l++)if(o=!0,s=0,u="",!(i=n.rows[l]).isEmpty()){for(var h,f=0;f<i.chars.length;f++)of.test(i.chars[f].uchar)&&o?s++:(u+=i.chars[f].uchar,o=!1);i.cueStartTime=t,t===r&&(r+=1e-4),s>=16?s--:s++;var p=$l(u.trim()),v=nh(t,r,p);null!=e&&null!=(h=e.cues)&&h.getCueById(v)||((a=new d(t,r,p)).id=v,a.line=l+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*s/32)),c.push(a))}return e&&c.length&&(c.sort((function(e,t){return"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line})),c.forEach((function(t){return Tu(e,t)}))),c}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:yl,subtitleTrackController:Sl,timelineController:vh,audioStreamController:gl,audioTrackController:ml,emeController:Ah,cmcdController:Yh,contentSteeringController:Xh});function uf(e){return e&&"object"===j(e)?Array.isArray(e)?e.map(uf):Object.keys(e).reduce((function(t,r){return t[r]=uf(e[r]),t}),{}):e}var cf=function(e){function t(e,r){var n;return R(this,t),(n=c(this,t,[e,"[level-controller]"]))._levels=[],n._firstLevel=-1,n._maxAutoLevel=-1,n._startLevel=void 0,n.currentLevel=null,n.currentLevelIndex=-1,n.manualLevelIndex=-1,n.steering=void 0,n.onParsedComplete=void 0,n.steering=r,n._registerListeners(),n}return f(t,e),D(t,[{key:"_registerListeners",value:function(){var e=this.hls;e.on(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.on(vo.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(vo.LEVEL_LOADED,this.onLevelLoaded,this),e.on(vo.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(vo.FRAG_BUFFERED,this.onFragBuffered,this),e.on(vo.ERROR,this.onError,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.off(vo.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(vo.LEVEL_LOADED,this.onLevelLoaded,this),e.off(vo.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(vo.FRAG_BUFFERED,this.onFragBuffered,this),e.off(vo.ERROR,this.onError,this)}},{key:"destroy",value:function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),s(t,"destroy",this)([])}},{key:"stopLoad",value:function(){this._levels.forEach((function(e){e.loadError=0,e.fragmentError=0})),s(t,"stopLoad",this)([])}},{key:"resetLevels",value:function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}},{key:"onManifestLoading",value:function(e,t){this.resetLevels()}},{key:"onManifestLoaded",value:function(e,t){var r=this.hls.config.preferManagedMediaSource,n=[],i={},a={},o=!1,s=!1,u=!1;t.levels.forEach((function(e){var t,c,d=e.attrs,l=e.audioCodec,h=e.videoCodec;-1!==(null==(t=l)?void 0:t.indexOf("mp4a.40.34"))&&(nf||(nf=/chrome|firefox/i.test(navigator.userAgent)),nf&&(e.audioCodec=l=void 0)),l&&(e.audioCodec=l=tu(l,r)),0===(null==(c=h)?void 0:c.indexOf("avc1"))&&(h=e.videoCodec=function(e){for(var t=e.split(","),r=0;r<t.length;r++){var n=t[r].split(".");if(n.length>2){var i=n.shift()+".";i+=parseInt(n.shift()).toString(16),i+=("000"+parseInt(n.shift()).toString(16)).slice(-4),t[r]=i}}return t.join(",")}(h));var f=e.width,p=e.height,v=e.unknownCodecs;if(o||(o=!(!f||!p)),s||(s=!!h),u||(u=!!l),!(null!=v&&v.length||l&&!Ys(l,"audio",r)||h&&!Ys(h,"video",r))){var g=d.CODECS,m=d["FRAME-RATE"],y=d["HDCP-LEVEL"],_=d["PATHWAY-ID"],S=d.RESOLUTION,A=d["VIDEO-RANGE"],b="".concat(_||".","-"),E="".concat(b).concat(e.bitrate,"-").concat(S,"-").concat(m,"-").concat(g,"-").concat(A,"-").concat(y);if(i[E])if(i[E].uri===e.url||e.attrs["PATHWAY-ID"])i[E].addGroupId("audio",d.AUDIO),i[E].addGroupId("text",d.SUBTITLES);else{var k=a[E]+=1;e.attrs["PATHWAY-ID"]=new Array(k+1).join(".");var C=new Hu(e);i[E]=C,n.push(C)}else{var w=new Hu(e);i[E]=w,a[E]=1,n.push(w)}}})),this.filterAndSortMediaOptions(n,t,o,s,u)}},{key:"filterAndSortMediaOptions",value:function(e,t,r,n,i){var a=this,o=[],s=[],u=e;if((r||n)&&i&&(u=u.filter((function(e){var t,r=e.videoCodec,n=e.videoRange,i=e.width,a=e.height;return(!!r||!(!i||!a))&&!!(t=n)&&Bu.indexOf(t)>-1}))),0!==u.length){if(t.audioTracks){var c=this.hls.config.preferManagedMediaSource;df(o=t.audioTracks.filter((function(e){return!e.audioCodec||Ys(e.audioCodec,"audio",c)})))}t.subtitles&&df(s=t.subtitles);var d=u.slice(0);u.sort((function(e,t){if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return Bu.indexOf(e.videoRange)-Bu.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){var n=Js(e.videoCodec),i=Js(t.videoCodec);if(n!==i)return i-n}if(e.uri===t.uri&&e.codecSet!==t.codecSet){var a=$s(e.codecSet),o=$s(t.codecSet);if(a!==o)return o-a}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0}));var l=d[0];if(this.steering&&(u=this.steering.filterParsedLevels(u)).length!==d.length)for(var h=0;h<d.length;h++)if(d[h].pathwayId===u[0].pathwayId){l=d[h];break}this._levels=u;for(var f=0;f<u.length;f++)if(u[f]===l){var p;this._firstLevel=f;var v=l.bitrate,g=this.hls.bandwidthEstimate;if(this.log("manifest loaded, ".concat(u.length," level(s) found, first bitrate: ").concat(v)),void 0===(null==(p=this.hls.userConfig)?void 0:p.abrEwmaDefaultEstimate)){var m=Math.min(v,this.hls.config.abrEwmaDefaultEstimateMax);m>g&&g===sf.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=m)}break}var y=i&&!n,_={levels:u,audioTracks:o,subtitleTracks:s,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:n,altAudio:!y&&o.some((function(e){return!!e.url}))};this.hls.trigger(vo.MANIFEST_PARSED,_),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else Promise.resolve().then((function(){if(a.hls){t.levels.length&&a.warn("One or more CODECS in variant not supported: ".concat(JSON.stringify(t.levels[0].attrs)));var e=new Error("no level with compatible codecs found in manifest");a.hls.trigger(vo.ERROR,{type:go.MEDIA_ERROR,details:mo.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:e,reason:e.message})}}))}},{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;if(0!==t.length){if(e<0||e>=t.length){var r=new Error("invalid level idx"),n=e<0;if(this.hls.trigger(vo.ERROR,{type:go.OTHER_ERROR,details:mo.LEVEL_SWITCH_ERROR,level:e,fatal:n,error:r,reason:r.message}),n)return;e=Math.min(e,t.length-1)}var i=this.currentLevelIndex,a=this.currentLevel,o=a?a.attrs["PATHWAY-ID"]:void 0,s=t[e],u=s.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=s,i!==e||!s.details||!a||o!==u){this.log("Switching to level ".concat(e," (").concat(s.height?s.height+"p ":"").concat(s.videoRange?s.videoRange+" ":"").concat(s.codecSet?s.codecSet+" ":"","@").concat(s.bitrate,")").concat(u?" with Pathway "+u:""," from level ").concat(i).concat(o?" with Pathway "+o:""));var c={level:e,attrs:s.attrs,details:s.details,bitrate:s.bitrate,averageBitrate:s.averageBitrate,maxBitrate:s.maxBitrate,realBitrate:s.realBitrate,width:s.width,height:s.height,codecSet:s.codecSet,audioCodec:s.audioCodec,videoCodec:s.videoCodec,audioGroups:s.audioGroups,subtitleGroups:s.subtitleGroups,loaded:s.loaded,loadError:s.loadError,fragmentError:s.fragmentError,name:s.name,id:s.id,uri:s.uri,url:s.url,urlId:0,audioGroupIds:s.audioGroupIds,textGroupIds:s.textGroupIds};this.hls.trigger(vo.LEVEL_SWITCHING,c);var d=s.details;if(!d||d.live){var l=this.switchParams(s.uri,null==a?void 0:a.details,d);this.loadPlaylist(l)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"onError",value:function(e,t){!t.fatal&&t.context&&t.context.type===mu&&t.context.level===this.level&&this.checkRetry(t)}},{key:"onFragBuffered",value:function(e,t){var r=t.frag;if(void 0!==r&&r.type===Su){var n=r.elementaryStreams;if(!Object.keys(n).some((function(e){return!!n[e]})))return;var i=this._levels[r.level];null!=i&&i.loadError&&(this.log("Resetting level error count of ".concat(i.loadError," on frag buffered")),i.loadError=0)}}},{key:"onLevelLoaded",value:function(e,t){var r,n,i=t.level,a=t.details,o=this._levels[i];if(!o)return this.warn("Invalid level index ".concat(i)),void(null!=(n=t.deliveryDirectives)&&n.skip&&(a.deltaUpdateFailed=!0));i===this.currentLevelIndex?(0===o.fragmentError&&(o.loadError=0),this.playlistLoaded(i,t,o.details)):null!=(r=t.deliveryDirectives)&&r.skip&&(a.deltaUpdateFailed=!0)}},{key:"loadPlaylist",value:function(e){s(t,"loadPlaylist",this)([]);var r=this.currentLevelIndex,n=this.currentLevel;if(n&&this.shouldLoadPlaylist(n)){var i=n.uri;if(e)try{i=e.addDirectives(i)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(e))}var a=n.attrs["PATHWAY-ID"];this.log("Loading level index ".concat(r).concat(void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:""," with").concat(a?" Pathway "+a:""," ").concat(i)),this.clearTimer(),this.hls.trigger(vo.LEVEL_LOADING,{url:i,level:r,pathwayId:n.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}},{key:"removeLevel",value:function(e){var t,r=this,n=this._levels.filter((function(t,n){return n!==e||(r.steering&&r.steering.removeLevel(t),t===r.currentLevel&&(r.currentLevel=null,r.currentLevelIndex=-1,t.details&&t.details.fragments.forEach((function(e){return e.level=-1}))),!1)}));Ju(n),this._levels=n,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(vo.LEVELS_UPDATED,{levels:n})}},{key:"onLevelsUpdated",value:function(e,t){var r=t.levels;this._levels=r}},{key:"checkMaxAutoUpdated",value:function(){var e=this.hls,t=e.autoLevelCapping,r=e.maxAutoLevel,n=e.maxHdcpLevel;this._maxAutoLevel!==r&&(this._maxAutoLevel=r,this.hls.trigger(vo.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:t,levels:this.levels,maxAutoLevel:r,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}])}(uc);function df(e){var t={};e.forEach((function(e){var r=e.groupId||"";e.id=t[r]=t[r]||0,t[r]++}))}var lf=D((function e(t){R(this,e),this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=t}),[{key:"abort",value:function(e){for(var t in this.keyUriToKeyInfo){var r=this.keyUriToKeyInfo[t].loader;if(r){var n;if(e&&e!==(null==(n=r.context)?void 0:n.frag.type))return;r.abort()}}}},{key:"detach",value:function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}},{key:"destroy",value:function(){for(var e in this.detach(),this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}},{key:"createKeyLoadError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mo.KEY_LOAD_ERROR,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return new Uc({type:go.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:r,networkDetails:n})}},{key:"loadClear",value:function(e,t){var r=this;if(this.emeController&&this.config.emeEnabled)for(var n=e.sn,i=e.cc,a=function(){var e=t[o];if(i<=e.cc&&("initSegment"===n||"initSegment"===e.sn||n<e.sn))return r.emeController.selectKeySystemFormat(e).then((function(t){e.setKeyFormat(t)})),1},o=0;o<t.length&&!a();o++);}},{key:"load",value:function(e){var t=this;return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then((function(r){return t.loadInternal(e,r)})):this.loadInternal(e)}},{key:"loadInternal",value:function(e,t){var r,n;t&&e.setKeyFormat(t);var i=e.decryptdata;if(!i){var a=new Error(t?"Expected frag.decryptdata to be defined after setting format ".concat(t):"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,mo.KEY_LOAD_ERROR,a))}var o=i.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,mo.KEY_LOAD_ERROR,new Error('Invalid key URI: "'.concat(o,'"'))));var s,u=this.keyUriToKeyInfo[o];if(null!=(r=u)&&r.decryptdata.key)return i.key=u.decryptdata.key,Promise.resolve({frag:e,keyInfo:u});if(null!=(n=u)&&n.keyLoadPromise)switch(null==(s=u.mediaKeySessionContext)?void 0:s.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return u.keyLoadPromise.then((function(t){return i.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:u}}))}switch(u=this.keyUriToKeyInfo[o]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===i.keyFormat?this.loadKeyHTTP(u,e):this.loadKeyEME(u,e);case"AES-128":return this.loadKeyHTTP(u,e);default:return Promise.reject(this.createKeyLoadError(e,mo.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'.concat(i.method,'"'))))}}},{key:"loadKeyEME",value:function(e,t){var r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var n=this.emeController.loadKey(r);if(n)return(e.keyLoadPromise=n.then((function(t){return e.mediaKeySessionContext=t,r}))).catch((function(t){throw e.keyLoadPromise=null,t}))}return Promise.resolve(r)}},{key:"loadKeyHTTP",value:function(e,t){var r=this,n=this.config,i=new n.loader(n);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((function(a,o){var s={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=n.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:function(e,t,n,i){var s=n.frag,u=n.keyInfo,c=n.url;if(!s.decryptdata||u!==r.keyUriToKeyInfo[c])return o(r.createKeyLoadError(s,mo.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),i));u.decryptdata.key=s.decryptdata.key=new Uint8Array(e.data),s.keyLoader=null,u.loader=null,a({frag:s,keyInfo:u})},onError:function(e,n,i,a){r.resetLoader(n),o(r.createKeyLoadError(t,mo.KEY_LOAD_ERROR,new Error("HTTP Error ".concat(e.code," loading key ").concat(e.text)),i,uo({url:s.url,data:void 0},e)))},onTimeout:function(e,n,i){r.resetLoader(n),o(r.createKeyLoadError(t,mo.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),i))},onAbort:function(e,n,i){r.resetLoader(n),o(r.createKeyLoadError(t,mo.INTERNAL_ABORTED,new Error("key loading aborted"),i))}};i.load(s,c,d)}))}},{key:"resetLoader",value:function(e){var t=e.frag,r=e.keyInfo,n=e.url,i=r.loader;t.keyLoader===i&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[n],i&&i.destroy()}}]);function hf(){return self.SourceBuffer||self.WebKitSourceBuffer}function ff(){if(!zs())return!1;var e=hf();return!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove}var pf=D((function e(t,r,n,i){R(this,e),this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=r,this.fragmentTracker=n,this.hls=i}),[{key:"destroy",value:function(){this.media=null,this.hls=this.fragmentTracker=null}},{key:"poll",value:function(e,t){var r=this.config,n=this.media,i=this.stalled;if(null!==n){var a=n.currentTime,o=n.seeking,s=this.seeking&&!o,u=!this.seeking&&o;if(this.seeking=o,a===e)if(u||s)this.stalled=null;else if(n.paused&&!o||n.ended||0===n.playbackRate||!Rc.getBuffered(n).length)this.nudgeRetry=0;else{var c=Rc.bufferInfo(n,a,0),d=c.nextStart||0;if(o){var l=c.len>2,h=!d||t&&t.start<=a||d-a>2&&!this.fragmentTracker.getPartialFragment(a);if(l||h)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var f;if(!(c.len>0||d))return;var p=Math.max(d,c.start||0)-a,v=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,g=(null==v||null==(f=v.details)?void 0:f.live)?2*v.details.targetduration:2,m=this.fragmentTracker.getPartialFragment(a);if(p>0&&(p<=g||m))return void(n.paused||this._trySkipBufferHole(m))}var y=self.performance.now();if(null!==i){var _=y-i;if(o||!(_>=250)||(this._reportStall(c),this.media)){var S=Rc.bufferInfo(n,a,r.maxBufferHole);this._tryFixBufferStall(S,_)}}else this.stalled=y}else if(this.moved=!0,o||(this.nudgeRetry=0),null!==i){if(this.stallReported){var A=self.performance.now()-i;Ao.warn("playback not stuck anymore @".concat(a,", after ").concat(Math.round(A),"ms")),this.stallReported=!1}this.stalled=null}}}},{key:"_tryFixBufferStall",value:function(e,t){var r=this.config,n=this.fragmentTracker,i=this.media;if(null!==i){var a=i.currentTime,o=n.getPartialFragment(a);if(o&&(this._trySkipBufferHole(o)||!this.media))return;(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-a<r.maxBufferHole)&&t>1e3*r.highBufferWatchdogPeriod&&(Ao.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}}},{key:"_reportStall",value:function(e){var t=this.hls,r=this.media;if(!this.stallReported&&r){this.stallReported=!0;var n=new Error("Playback stalling at @".concat(r.currentTime," due to low buffer (").concat(JSON.stringify(e),")"));Ao.warn(n.message),t.trigger(vo.ERROR,{type:go.MEDIA_ERROR,details:mo.BUFFER_STALLED_ERROR,fatal:!1,error:n,buffer:e.len})}}},{key:"_trySkipBufferHole",value:function(e){var t=this.config,r=this.hls,n=this.media;if(null===n)return 0;var i=n.currentTime,a=Rc.bufferInfo(n,i,0),o=i<a.start?a.start:a.nextStart;if(o){var s=a.len<=t.maxBufferHole,u=a.len>0&&a.len<1&&n.readyState<3,c=o-i;if(c>0&&(s||u)){if(c>t.maxBufferHole){var d=this.fragmentTracker,l=!1;if(0===i){var h=d.getAppendedFrag(0,Su);h&&o<h.end&&(l=!0)}if(!l){var f=e||d.getAppendedFrag(i,Su);if(f){for(var p=!1,v=f.end;v<o;){var g=d.getPartialFragment(v);if(!g){p=!0;break}v+=g.duration}if(p)return 0}}}var m=Math.max(o+.05,i+.1);if(Ao.warn("skipping hole, adjusting currentTime from ".concat(i," to ").concat(m)),this.moved=!0,this.stalled=null,n.currentTime=m,e&&!e.gap){var y=new Error("fragment loaded with buffer holes, seeking from ".concat(i," to ").concat(m));r.trigger(vo.ERROR,{type:go.MEDIA_ERROR,details:mo.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:y,reason:y.message,frag:e})}return m}}return 0}},{key:"_tryNudgeBuffer",value:function(){var e=this.config,t=this.hls,r=this.media,n=this.nudgeRetry;if(null!==r){var i=r.currentTime;if(this.nudgeRetry++,n<e.nudgeMaxRetry){var a=i+(n+1)*e.nudgeOffset,o=new Error("Nudging 'currentTime' from ".concat(i," to ").concat(a));Ao.warn(o.message),r.currentTime=a,t.trigger(vo.ERROR,{type:go.MEDIA_ERROR,details:mo.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1})}else{var s=new Error("Playhead still not moving while enough data buffered @".concat(i," after ").concat(e.nudgeMaxRetry," nudges"));Ao.error(s.message),t.trigger(vo.ERROR,{type:go.MEDIA_ERROR,details:mo.BUFFER_STALLED_ERROR,error:s,fatal:!0})}}}}]),vf=function(e){function t(e,r,n){var i;return R(this,t),(i=c(this,t,[e,r,n,"[stream-controller]",Su])).audioCodecSwap=!1,i.gapController=null,i.level=-1,i._forceStartLoad=!1,i.altAudio=!1,i.audioOnly=!1,i.fragPlaying=null,i.onvplaying=null,i.onvseeked=null,i.fragLastKbps=0,i.couldBacktrack=!1,i.backtrackFragment=null,i.audioCodecSwitch=!1,i.videoBuffer=null,i._registerListeners(),i}return f(t,e),D(t,[{key:"_registerListeners",value:function(){var e=this.hls;e.on(vo.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(vo.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.on(vo.MANIFEST_PARSED,this.onManifestParsed,this),e.on(vo.LEVEL_LOADING,this.onLevelLoading,this),e.on(vo.LEVEL_LOADED,this.onLevelLoaded,this),e.on(vo.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(vo.ERROR,this.onError,this),e.on(vo.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(vo.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(vo.BUFFER_CREATED,this.onBufferCreated,this),e.on(vo.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(vo.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(vo.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(vo.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(vo.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(vo.MANIFEST_LOADING,this.onManifestLoading,this),e.off(vo.MANIFEST_PARSED,this.onManifestParsed,this),e.off(vo.LEVEL_LOADED,this.onLevelLoaded,this),e.off(vo.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(vo.ERROR,this.onError,this),e.off(vo.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(vo.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(vo.BUFFER_CREATED,this.onBufferCreated,this),e.off(vo.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(vo.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(vo.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"onHandlerDestroying",value:function(){this._unregisterListeners(),s(t,"onHandlerDestroying",this)([])}},{key:"startLoad",value:function(e){if(this.levels){var t=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){var n=r.startLevel;-1===n&&(r.config.testBandwidth&&this.levels.length>1?(n=0,this.bitrateTest=!0):n=r.firstAutoLevel),r.nextLoadLevel=n,this.level=r.loadLevel,this.loadedmetadata=!1}t>0&&-1===e&&(this.log("Override startPosition with lastCurrentTime @".concat(t.toFixed(3))),e=t),this.state=jc,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=Hc}},{key:"stopLoad",value:function(){this._forceStartLoad=!1,s(t,"stopLoad",this)([])}},{key:"doTick",value:function(){switch(this.state){case ed:var e=this.levels,t=this.level,r=null==e?void 0:e[t],n=null==r?void 0:r.details;if(n&&(!n.live||this.levelLastLoaded===r)){if(this.waitForCdnTuneIn(n))break;this.state=jc;break}if(this.hls.nextLoadLevel!==this.level){this.state=jc;break}break;case qc:var i,a=self.performance.now(),o=this.retryDate;if(!o||a>=o||null!=(i=this.media)&&i.seeking){var s=this.levels,u=this.level,c=null==s?void 0:s[u];this.resetStartWhenNotLoaded(c||null),this.state=jc}}this.state===jc&&this.doTickIdle(),this.onTickEnd()}},{key:"onTickEnd",value:function(){s(t,"onTickEnd",this)([]),this.checkBuffer(),this.checkFragmentChanged()}},{key:"doTickIdle",value:function(){var e=this.hls,t=this.levelLastLoaded,r=this.levels,n=this.media;if(null!==t&&(n||!this.startFragRequested&&e.config.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)){var i=e.nextLoadLevel;if(null!=r&&r[i]){var a=r[i],o=this.getMainFwdBufferInfo();if(null!==o){var s=this.getLevelDetails();if(s&&this._streamEnded(o,s)){var u={};return this.altAudio&&(u.type="video"),this.hls.trigger(vo.BUFFER_EOS,u),void(this.state=Jc)}e.loadLevel!==i&&-1===e.manualLevel&&this.log("Adapting to level ".concat(i," from level ").concat(this.level)),this.level=e.nextLoadLevel=i;var c=a.details;if(!c||this.state===ed||c.live&&this.levelLastLoaded!==a)return this.level=i,void(this.state=ed);var d=o.len,l=this.getMaxBufferLength(a.maxBitrate);if(!(d>=l)){this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);var h=this.backtrackFragment?this.backtrackFragment.start:o.end,f=this.getNextFragment(h,c);if(this.couldBacktrack&&!this.fragPrevious&&f&&"initSegment"!==f.sn&&this.fragmentTracker.getState(f)!==Ec){var p,v=(null!=(p=this.backtrackFragment)?p:f).sn-c.startSN,g=c.fragments[v-1];g&&f.cc===g.cc&&(f=g,this.fragmentTracker.removeFragment(g))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,h)){if(!f.gap){var m=this.audioOnly&&!this.altAudio?Ro:Io,y=(m===Io?this.videoBuffer:this.mediaBuffer)||this.media;y&&this.afterBufferFlushed(y,m,Su)}f=this.getNextFragmentLoopLoading(f,c,o,Su,l)}f&&(!f.initSegment||f.initSegment.data||this.bitrateTest||(f=f.initSegment),this.loadFragment(f,a,h))}}}}}},{key:"loadFragment",value:function(e,r,n){var i=this.fragmentTracker.getState(e);this.fragCurrent=e,i===Sc||i===bc?"initSegment"===e.sn?this._loadInitSegment(e,r):this.bitrateTest?(this.log("Fragment ".concat(e.sn," of level ").concat(e.level," is being downloaded to test bitrate and will not be buffered")),this._loadBitrateTestFrag(e,r)):(this.startFragRequested=!0,s(t,"loadFragment",this)([e,r,n])):this.clearTrackerIfNeeded(e)}},{key:"getBufferedFrag",value:function(e){return this.fragmentTracker.getBufferedFrag(e,Su)}},{key:"followingBufferedFrag",value:function(e){return e?this.getBufferedFrag(e.end+.5):null}},{key:"immediateLevelSwitch",value:function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"nextLevelSwitch",value:function(){var e=this.levels,t=this.media;if(null!=t&&t.readyState){var r,n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);var i=this.getLevelDetails();if(null!=i&&i.live){var a=this.getMainFwdBufferInfo();if(!a||a.len<2*i.targetduration)return}if(!t.paused&&e){var o=e[this.hls.nextLoadLevel],s=this.fragLastKbps;r=s&&this.fragCurrent?this.fragCurrent.duration*o.maxBitrate/(1e3*s)+1:0}else r=0;var u=this.getBufferedFrag(t.currentTime+r);if(u){var c=this.followingBufferedFrag(u);if(c){this.abortCurrentFrag();var d=c.maxStartPTS?c.maxStartPTS:c.start,l=c.duration,h=Math.max(u.end,d+Math.min(Math.max(l-this.config.maxFragLookUpTolerance,l*(this.couldBacktrack?.5:.125)),l*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(h,Number.POSITIVE_INFINITY)}}}}},{key:"abortCurrentFrag",value:function(){var e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Kc:case zc:case qc:case Xc:case Qc:this.state=jc}this.nextLoadPosition=this.getLoadPosition()}},{key:"flushMainBuffer",value:function(e,r){s(t,"flushMainBuffer",this)([e,r,this.altAudio?"video":null])}},{key:"onMediaAttached",value:function(e,r){s(t,"onMediaAttached",this)([e,r]);var n=r.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),n.addEventListener("playing",this.onvplaying),n.addEventListener("seeked",this.onvseeked),this.gapController=new pf(this.config,n,this.fragmentTracker,this.hls)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),s(t,"onMediaDetaching",this)([])}},{key:"onMediaPlaying",value:function(){this.tick()}},{key:"onMediaSeeked",value:function(){var e=this.media,t=e?e.currentTime:null;ho(t)&&this.log("Media seeked to ".concat(t.toFixed(3)));var r=this.getMainFwdBufferInfo();null!==r&&0!==r.len?this.tick():this.warn('Main forward buffer length on "seeked" event '.concat(r?r.len:"empty",")"))}},{key:"onManifestLoading",value:function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(vo.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}},{key:"onManifestParsed",value:function(e,t){var r,n,i=!1,a=!1;t.levels.forEach((function(e){var t=e.audioCodec;t&&(i=i||-1!==t.indexOf("mp4a.40.2"),a=a||-1!==t.indexOf("mp4a.40.5"))})),this.audioCodecSwitch=i&&a&&!("function"==typeof(null==(n=hf())||null==(r=n.prototype)?void 0:r.changeType)),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}},{key:"onLevelLoading",value:function(e,t){var r=this.levels;if(r&&this.state===jc){var n=r[t.level];(!n.details||n.details.live&&this.levelLastLoaded!==n||this.waitForCdnTuneIn(n.details))&&(this.state=ed)}}},{key:"onLevelLoaded",value:function(e,t){var r,n=this.levels,i=t.level,a=t.details,o=a.totalduration;if(n){this.log("Level ".concat(i," loaded [").concat(a.startSN,",").concat(a.endSN,"]").concat(a.lastPartSn?"[part-".concat(a.lastPartSn,"-").concat(a.lastPartIndex,"]"):"",", cc [").concat(a.startCC,", ").concat(a.endCC,"] duration:").concat(o));var s=n[i],u=this.fragCurrent;!u||this.state!==zc&&this.state!==qc||u.level!==t.level&&u.loader&&this.abortCurrentFrag();var c=0;if(a.live||null!=(r=s.details)&&r.live){var d;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;c=this.alignPlaylists(a,s.details,null==(d=this.levelLastLoaded)?void 0:d.details)}if(s.details=a,this.levelLastLoaded=s,this.hls.trigger(vo.LEVEL_UPDATED,{details:a,level:i}),this.state===ed){if(this.waitForCdnTuneIn(a))return;this.state=jc}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,c),this.tick()}else this.warn("Levels were reset while loading level ".concat(i))}},{key:"_handleFragmentLoadProgress",value:function(e){var t,r=e.frag,n=e.part,i=e.payload,a=this.levels;if(a){var o=a[r.level],s=o.details;if(!s)return this.warn("Dropping fragment ".concat(r.sn," of level ").concat(r.level," after level details were reset")),void this.fragmentTracker.removeFragment(r);var u=o.videoCodec,c=s.PTSKnown||!s.live,d=null==(t=r.initSegment)?void 0:t.data,l=this._getAudioCodec(o),h=this.transmuxer=this.transmuxer||new hl(this.hls,Su,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=n?n.index:-1,p=-1!==f,v=new Ic(r.level,r.sn,r.stats.chunkCount,i.byteLength,f,p),g=this.initPTS[r.cc];h.push(i,d,l,u,r,n,s.totalduration,c,v,g)}else this.warn("Levels were reset while fragment load was in progress. Fragment ".concat(r.sn," of level ").concat(r.level," will not be buffered"))}},{key:"onAudioTrackSwitching",value:function(e,t){var r=this.altAudio;if(!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var n=this.fragCurrent;n&&(this.log("Switching to main audio track, cancel main fragment load"),n.abortRequests(),this.fragmentTracker.removeFragment(n)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var i=this.hls;r&&(i.trigger(vo.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),i.trigger(vo.AUDIO_TRACK_SWITCHED,t)}}},{key:"onAudioTrackSwitched",value:function(e,t){var r=t.id,n=!!this.hls.audioTracks[r].url;if(n){var i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=n,this.tick()}},{key:"onBufferCreated",value:function(e,t){var r,n,i=t.tracks,a=!1;for(var o in i){var s=i[o];if("main"===s.id){if(n=o,r=s,"video"===o){var u=i[o];u&&(this.videoBuffer=u.buffer)}}else a=!0}a&&r?(this.log("Alternate track found, use ".concat(n,".buffered to schedule main fragment loading")),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}},{key:"onFragBuffered",value:function(e,t){var r=t.frag,n=t.part;if(!r||r.type===Su){if(this.fragContextChanged(r))return this.warn("Fragment ".concat(r.sn).concat(n?" p: "+n.index:""," of level ").concat(r.level," finished buffering, but was aborted. state: ").concat(this.state)),void(this.state===Qc&&(this.state=jc));var i=n?n.stats:r.stats;this.fragLastKbps=Math.round(8*i.total/(i.buffering.end-i.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,n)}}},{key:"onError",value:function(e,t){var r;if(t.fatal)this.state=$c;else switch(t.details){case mo.FRAG_GAP:case mo.FRAG_PARSING_ERROR:case mo.FRAG_DECRYPT_ERROR:case mo.FRAG_LOAD_ERROR:case mo.FRAG_LOAD_TIMEOUT:case mo.KEY_LOAD_ERROR:case mo.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Su,t);break;case mo.LEVEL_LOAD_ERROR:case mo.LEVEL_LOAD_TIMEOUT:case mo.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==ed||(null==(r=t.context)?void 0:r.type)!==mu||(this.state=jc);break;case mo.BUFFER_APPEND_ERROR:case mo.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;if(t.details===mo.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case mo.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}},{key:"checkBuffer",value:function(){var e=this.media,t=this.gapController;if(e&&t&&e.readyState){if(this.loadedmetadata||!Rc.getBuffered(e).length){var r=this.state!==jc?this.fragCurrent:null;t.poll(this.lastCurrentTime,r)}this.lastCurrentTime=e.currentTime}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=jc,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}},{key:"onBufferFlushed",value:function(e,t){var r=t.type;if(r!==Ro||this.audioOnly&&!this.altAudio){var n=(r===Io?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(n,r,Su),this.tick()}}},{key:"onLevelsUpdated",value:function(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=t.levels}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"seekToStartPos",value:function(){var e=this.media;if(e){var t=e.currentTime,r=this.startPosition;if(r>=0&&t<r){if(e.seeking)return void this.log("could not seek to ".concat(r,", already seeking at ").concat(t));var n=Rc.getBuffered(e),i=(n.length?n.start(0):0)-r;i>0&&(i<this.config.maxBufferHole||i<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by ".concat(i," to match buffer start")),r+=i,this.startPosition=r),this.log("seek to target start position ".concat(r," from current time ").concat(t)),e.currentTime=r}}}},{key:"_getAudioCodec",value:function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}},{key:"_loadBitrateTestFrag",value:function(e,t){var r=this;e.bitrateTest=!0,this._doFragLoad(e,t).then((function(n){var i=r.hls;if(n&&!r.fragContextChanged(e)){t.fragmentError=0,r.state=jc,r.startFragRequested=!1,r.bitrateTest=!1;var a=e.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),i.trigger(vo.FRAG_LOADED,n),e.bitrateTest=!1}}))}},{key:"_handleTransmuxComplete",value:function(e){var t,r="main",n=this.hls,i=e.remuxResult,a=e.chunkMeta,o=this.getCurrentContext(a);if(o){var s=o.frag,u=o.part,c=o.level,d=i.video,l=i.text,h=i.id3,f=i.initSegment,p=c.details,v=this.altAudio?void 0:i.audio;if(this.fragContextChanged(s))this.fragmentTracker.removeFragment(s);else{if(this.state=Xc,f){if(null!=f&&f.tracks){var g=s.initSegment||s;this._bufferInitSegment(c,f.tracks,g,a),n.trigger(vo.FRAG_PARSING_INIT_SEGMENT,{frag:g,id:r,tracks:f.tracks})}var m=f.initPTS,y=f.timescale;ho(m)&&(this.initPTS[s.cc]={baseTime:m,timescale:y},n.trigger(vo.INIT_PTS_FOUND,{frag:s,id:r,initPTS:m,timescale:y}))}if(d&&p&&"initSegment"!==s.sn){var _=p.fragments[s.sn-1-p.startSN],S=s.sn===p.startSN,A=!_||s.cc>_.cc;if(!1!==i.independent){var b=d.startPTS,E=d.endPTS,k=d.startDTS,C=d.endDTS;if(u)u.elementaryStreams[d.type]={startPTS:b,endPTS:E,startDTS:k,endDTS:C};else if(d.firstKeyFrame&&d.independent&&1===a.id&&!A&&(this.couldBacktrack=!0),d.dropped&&d.independent){var w=this.getMainFwdBufferInfo(),T=(w?w.end:this.getLoadPosition())+this.config.maxBufferHole,R=d.firstKeyFramePTS?d.firstKeyFramePTS:b;if(!S&&T<R-this.config.maxBufferHole&&!A)return void this.backtrack(s);A&&(s.gap=!0),s.setElementaryStreamInfo(d.type,s.start,E,s.start,C,!0)}else S&&b>2&&(s.gap=!0);s.setElementaryStreamInfo(d.type,b,E,k,C),this.backtrackFragment&&(this.backtrackFragment=s),this.bufferFragmentData(d,s,u,a,S||A)}else{if(!S&&!A)return void this.backtrack(s);s.gap=!0}}if(v){var I=v.startPTS,D=v.endPTS,M=v.startDTS,O=v.endDTS;u&&(u.elementaryStreams[Ro]={startPTS:I,endPTS:D,startDTS:M,endDTS:O}),s.setElementaryStreamInfo(Ro,I,D,M,O),this.bufferFragmentData(v,s,u,a)}if(p&&null!=h&&null!=(t=h.samples)&&t.length){var x={id:r,frag:s,details:p,samples:h.samples};n.trigger(vo.FRAG_PARSING_METADATA,x)}if(p&&l){var P={id:r,frag:s,details:p,samples:l.samples};n.trigger(vo.FRAG_PARSING_USERDATA,P)}}}else this.resetWhenMissingContext(a)}},{key:"_bufferInitSegment",value:function(e,t,r,n){var i=this;if(this.state===Xc){this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;var a=t.audio,o=t.video,s=t.audiovideo;if(a){var u=e.audioCodec,c=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u=-1!==u.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");var d=a.metadata;d&&"channelCount"in d&&1!==(d.channelCount||1)&&-1===c.indexOf("firefox")&&(u="mp4a.40.5")}u&&-1!==u.indexOf("mp4a.40.5")&&-1!==c.indexOf("android")&&"audio/mpeg"!==a.container&&(u="mp4a.40.2",this.log("Android: force audio codec to ".concat(u))),e.audioCodec&&e.audioCodec!==u&&this.log('Swapping manifest audio codec "'.concat(e.audioCodec,'" for "').concat(u,'"')),a.levelCodec=u,a.id="main",this.log("Init audio buffer, container:".concat(a.container,", codecs[selected/level/parsed]=[").concat(u||"","/").concat(e.audioCodec||"","/").concat(a.codec,"]"))}o&&(o.levelCodec=e.videoCodec,o.id="main",this.log("Init video buffer, container:".concat(o.container,", codecs[level/parsed]=[").concat(e.videoCodec||"","/").concat(o.codec,"]"))),s&&this.log("Init audiovideo buffer, container:".concat(s.container,", codecs[level/parsed]=[").concat(e.codecs,"/").concat(s.codec,"]")),this.hls.trigger(vo.BUFFER_CODECS,t),Object.keys(t).forEach((function(e){var a=t[e].initSegment;null!=a&&a.byteLength&&i.hls.trigger(vo.BUFFER_APPENDING,{type:e,data:a,frag:r,part:null,chunkMeta:n,parent:r.type})})),this.tickImmediate()}}},{key:"getMainFwdBufferInfo",value:function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Su)}},{key:"backtrack",value:function(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=jc}},{key:"checkFragmentChanged",value:function(){var e=this.media,t=null;if(e&&e.readyState>1&&!1===e.seeking){var r=e.currentTime;if(Rc.isBuffered(e,r)?t=this.getAppendedFrag(r):Rc.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;var n=this.fragPlaying,i=t.level;n&&t.sn===n.sn&&n.level===i||(this.fragPlaying=t,this.hls.trigger(vo.FRAG_CHANGED,{frag:t}),n&&n.level===i||this.hls.trigger(vo.LEVEL_SWITCHED,{level:i}))}}}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentFrag",get:function(){var e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}},{key:"currentProgramDateTime",get:function(){var e=this.media;if(e){var t=e.currentTime,r=this.currentFrag;if(r&&ho(t)&&ho(r.programDateTime)){var n=r.programDateTime+1e3*(t-r.start);return new Date(n)}}return null}},{key:"currentLevel",get:function(){var e=this.currentFrag;return e?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.currentFrag;return e?this.followingBufferedFrag(e):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])}(td),gf=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};R(this,e),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new ll,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,function(e,t){if("object"===("undefined"==typeof console?"undefined":j(console))&&!0===e||"object"===j(e)){!function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];r.forEach((function(t){So[t]=e[t]?e[t].bind(e):function(e){var t=self.console[e];return t?t.bind(self.console,"[".concat(e,"] >")):yo}(t)}))}(e,"debug","log","info","warn","error");try{So.log('Debug logs enabled for "'.concat(t,'" in hls.js version ',"1.5.17"))}catch(e){So=_o}}else So=_o}(t.debug||!1,"Hls instance");var r=this.config=function(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var r=uf(e),n=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((function(e){var i="".concat("level"===e?"playlist":e,"LoadPolicy"),a=void 0===t[i],o=[];n.forEach((function(n){var s="".concat(e,"Loading").concat(n),u=t[s];if(void 0!==u&&a){o.push(s);var c=r[i].default;switch(t[i]={default:c},n){case"TimeOut":c.maxLoadTimeMs=u,c.maxTimeToFirstByteMs=u;break;case"MaxRetry":c.errorRetry.maxNumRetry=u,c.timeoutRetry.maxNumRetry=u;break;case"RetryDelay":c.errorRetry.retryDelayMs=u,c.timeoutRetry.retryDelayMs=u;break;case"MaxRetryTimeout":c.errorRetry.maxRetryDelayMs=u,c.timeoutRetry.maxRetryDelayMs=u}}})),o.length&&Ao.warn('hls.js config: "'.concat(o.join('", "'),'" setting(s) are deprecated, use "').concat(i,'": ').concat(JSON.stringify(t[i])))})),uo(uo({},r),t)}(e.DefaultConfig,t);this.userConfig=t,r.progressive&&function(e){var t=e.loader;t!==tf&&t!==Zh?(Ao.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}()&&(e.loader=tf,e.progressive=!0,e.enableSoftwareAES=!0,Ao.log("[config]: Progressive streaming enabled, using FetchLoader"))}(r);var n=r.abrController,i=r.bufferController,a=r.capLevelController,o=r.errorController,s=r.fpsController,u=new o(this),c=this.abrController=new n(this),d=this.bufferController=new i(this),l=this.capLevelController=new a(this),h=new s(this),f=new Cu(this),p=new Vu(this),v=r.contentSteeringController,g=v?new v(this):null,m=this.levelController=new cf(this,g),y=new kc(this),_=new lf(this.config),S=this.streamController=new vf(this,y,_);l.setStreamController(S),h.setStreamController(S);var A=[f,m,S];g&&A.splice(1,0,g),this.networkControllers=A;var b=[c,d,l,h,p,y];this.audioTrackController=this.createController(r.audioTrackController,A);var E=r.audioStreamController;E&&A.push(new E(this,y,_)),this.subtitleTrackController=this.createController(r.subtitleTrackController,A);var k=r.subtitleStreamController;k&&A.push(new k(this,y,_)),this.createController(r.timelineController,b),_.emeController=this.emeController=this.createController(r.emeController,b),this.cmcdController=this.createController(r.cmcdController,b),this.latencyController=this.createController(Uu,b),this.coreComponents=b,A.push(u);var C=u.onErrorOut;"function"==typeof C&&this.on(vo.ERROR,C,u)}return D(e,[{key:"createController",value:function(e,t){if(e){var r=new e(this);return t&&t.push(r),r}return null}},{key:"on",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.on(e,t,r)}},{key:"once",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.once(e,t,r)}},{key:"removeAllListeners",value:function(e){this._emitter.removeAllListeners(e)}},{key:"off",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,n=arguments.length>3?arguments[3]:void 0;this._emitter.off(e,t,r,n)}},{key:"listeners",value:function(e){return this._emitter.listeners(e)}},{key:"emit",value:function(e,t,r){return this._emitter.emit(e,t,r)}},{key:"trigger",value:function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){if(Ao.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),!this.triggeringException){this.triggeringException=!0;var r=e===vo.ERROR;this.trigger(vo.ERROR,{type:go.OTHER_ERROR,details:mo.INTERNAL_EXCEPTION,fatal:r,event:e,error:t}),this.triggeringException=!1}}return!1}},{key:"listenerCount",value:function(e){return this._emitter.listenerCount(e)}},{key:"destroy",value:function(){Ao.log("destroy"),this.trigger(vo.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(e){return e.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(e){return e.destroy()})),this.coreComponents.length=0;var e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}},{key:"attachMedia",value:function(e){Ao.log("attachMedia"),this._media=e,this.trigger(vo.MEDIA_ATTACHING,{media:e})}},{key:"detachMedia",value:function(){Ao.log("detachMedia"),this.trigger(vo.MEDIA_DETACHING,void 0),this._media=null}},{key:"loadSource",value:function(e){this.stopLoad();var t=this.media,r=this.url,n=this.url=oo.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,Ao.log("loadSource:".concat(n)),t&&r&&(r!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(vo.MANIFEST_LOADING,{url:e})}},{key:"startLoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;Ao.log("startLoad(".concat(e,")")),this.started=!0,this.networkControllers.forEach((function(t){t.startLoad(e)}))}},{key:"stopLoad",value:function(){Ao.log("stopLoad"),this.started=!1,this.networkControllers.forEach((function(e){e.stopLoad()}))}},{key:"resumeBuffering",value:function(){this.started&&this.networkControllers.forEach((function(e){"fragmentLoader"in e&&e.startLoad(-1)}))}},{key:"pauseBuffering",value:function(){this.networkControllers.forEach((function(e){"fragmentLoader"in e&&e.stopLoad()}))}},{key:"swapAudioCodec",value:function(){Ao.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){Ao.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)}},{key:"removeLevel",value:function(e){this.levelController.removeLevel(e)}},{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){Ao.log("set currentLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){Ao.log("set nextLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){Ao.log("set loadLevel:".concat(e)),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){Ao.log("set firstLevel:".concat(e)),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){var e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e},set:function(e){Ao.log("set startLevel:".concat(e)),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(Ao.log("set autoLevelCapping:".concat(e)),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN},set:function(e){this.abrController.resetEstimator(e)}},{key:"ttfbEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(e){(function(e){return Fu.indexOf(e)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var r=e.length,n=0;n<r;n++)if(e[n].maxBitrate>=t)return n;return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.levels,r=this.autoLevelCapping,n=this.maxHdcpLevel;if(e=-1===r&&null!=t&&t.length?t.length-1:r,n)for(var i=e;i--;){var a=t[i].attrs["HDCP-LEVEL"];if(a&&a<=n)return i}return e}},{key:"firstAutoLevel",get:function(){return this.abrController.firstAutoLevel}},{key:"nextAutoLevel",get:function(){return this.abrController.nextAutoLevel},set:function(e){this.abrController.nextAutoLevel=e}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"setAudioOption",value:function(e){var t;return null==(t=this.audioTrackController)?void 0:t.setAudioOption(e)}},{key:"setSubtitleOption",value:function(e){var t;return null==(t=this.subtitleTrackController)||t.setSubtitleOption(e),null}},{key:"allAudioTracks",get:function(){var e=this.audioTrackController;return e?e.allAudioTracks:[]}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"allSubtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.5.17"}},{key:"isMSESupported",value:function(){return ff()}},{key:"isSupported",value:function(){return function(){if(!ff())return!1;var e=zs();return"function"==typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some((function(t){return e.isTypeSupported(Qs(t,"video"))}))||["mp4a.40.2","fLaC"].some((function(t){return e.isTypeSupported(Qs(t,"audio"))})))}()}},{key:"getMediaSource",value:function(){return zs()}},{key:"Events",get:function(){return vo}},{key:"ErrorTypes",get:function(){return go}},{key:"ErrorDetails",get:function(){return mo}},{key:"DefaultConfig",get:function(){return e.defaultConfig?e.defaultConfig:sf},set:function(t){e.defaultConfig=t}}])}();gf.defaultConfig=void 0;var mf=function(e){function t(e,r){var n;return R(this,t),(n=c(this,t,[e])).type=r,n.domMap=new Map,n.hlsMap=new Map,n.levelsMap=new Map,n.totalDurationMap=new Map,n.settingMap=new Map,n.resourceMap=new Map,n.loadDeferedMap=new Map,n.loadedMap=new Map,n.intervalMap=new Map,n.pauseSet=new Set,n}return f(t,e),D(t,[{key:"initSubscription",value:function(){var e=this;Ot.on(Nt.ChatSettings).pipe(Rt(this.destroy$)).subscribe((function(t){if(null!=t&&t.id){var r,n={};try{n=JSON.parse((null==t?void 0:t.settings)||"{}")}catch(e){}e.settingMap.set(t.id,n),xt.dispatch(Pt.BindEvent,{streamId:t.id,event:"rewind-config",params:"true"===(null===(r=n)||void 0===r?void 0:r.rewind_on)})}})),Ot.on(Nt.RewindResources).pipe(Rt(this.destroy$)).subscribe((function(t){if(t&&(e.resourceMap.set(t.id,{url:t.url,params:t.params,headers:t.headers,sig:t.sig}),!e.loadedMap.get(t.id))){var r,n=e.loadDeferedMap.get(t.id);n&&(null==n||null===(r=n.resolve)||void 0===r||r.call(n,!0),e.loadedMap.set(t.id,!0))}}))}},{key:"checkRefreshToken",value:function(e){var t=this;this.intervalMap.get(e)&&(clearInterval(this.intervalMap.get(e)),this.intervalMap.delete(e));var r=window.setInterval((function(){e&&t.livePlayer.sendToSignal(Lt.RewindTokenRefresh,{id:e})}),36e5);this.intervalMap.set(e,r)}},{key:"createRewind",value:(r=H(O().mark((function e(t,r){var n,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loadedMap.get(t)){e.next=4;break}return null!==(n=this.resourceMap.get(t))&&void 0!==n&&n.url||this.loadDeferedMap.set(t,new re),e.next=4,null===(i=this.loadDeferedMap.get(t))||void 0===i?void 0:i.promise;case 4:"hls"===this.type&&this.createHLS(t,r),this.checkRefreshToken(t);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"destroyRewind",value:function(e){this.resourceMap.delete(e),"hls"===this.type&&this.destroyHLS(e),this.domMap.delete(e),this.levelsMap.delete(e),this.totalDurationMap.delete(e),this.loadDeferedMap.delete(e),this.loadedMap.delete(e),this.intervalMap.get(e)&&window.clearInterval(this.intervalMap.get(e)),this.intervalMap.delete(e)}},{key:"destroyHLS",value:function(e){var t;null===(t=this.hlsMap.get(e))||void 0===t||t.destroy(),this.hlsMap.delete(e)}},{key:"createHLS",value:function(e,t){var r=this,n=this.settingMap.get(e);if("true"===(null==n?void 0:n.rewind_on)){var i,a=new gf({xhrSetup:function(i,a){var o,s,u=a+"?"+((null===(o=r.resourceMap.get(e))||void 0===o?void 0:o.params)||"");i.open("GET",u,!0),"true"!==n.disable_presig&&i.setRequestHeader("x-zm-presig",(null===(s=r.resourceMap.get(e))||void 0===s?void 0:s.sig)||t)}});this.hlsMap.set(e,a),gf.isSupported()&&(a.on(gf.Events.MEDIA_ATTACHED,(function(){})),a.on(gf.Events.MANIFEST_PARSED,(function(t,n){r.levelsMap.set(e,n.levels.map((function(e){return e.height})))})),a.loadSource((null===(i=this.resourceMap.get(e))||void 0===i?void 0:i.url)||""),a.on(gf.Events.LEVEL_LOADED,(function(t,n){var i=n.details.totalduration;r.totalDurationMap.get(e)!==i&&(xt.dispatch(Pt.BindEvent,{streamId:e,event:"rewind-total-time",params:i}),r.totalDurationMap.set(e,i))})))}}},{key:"checkIfLive",value:function(e,t){var r=this.hlsMap.get(e);null!=r&&r.liveSyncPosition&&r.liveSyncPosition-t<=2&&xt.dispatch(Pt.BindEvent,{streamId:e,event:"switch-to-live"})}},{key:"attachMedia",value:function(e,t){var r,n=this;null===(r=this.hlsMap.get(e))||void 0===r||r.attachMedia(t),t.ontimeupdate=function(){n.checkIfLive(e,t.currentTime),xt.dispatch(Pt.BindEvent,{streamId:e,event:"timeupdate",params:t.currentTime})},t.oncanplaythrough=function(){n.pauseSet.has(e)||t.play()},t.onwaiting=function(){xt.dispatch(Pt.BindEvent,{streamId:e,event:"waiting"})},t.onplaying=function(){xt.dispatch(Pt.BindEvent,{streamId:e,event:"playing"})},this.pauseSet.has(e)||xt.dispatch(Pt.BindEvent,{streamId:e,event:"waiting"}),this.domMap.set(e,t)}},{key:"detachMedia",value:function(e){var t;null===(t=this.hlsMap.get(e))||void 0===t||t.detachMedia(),this.pauseSet.delete(e);var r=this.domMap.get(e);r&&(r.ontimeupdate=null,r.oncanplaythrough=null,r.onwaiting=null,r.onplaying=null,this.domMap.delete(e))}},{key:"changeResolution",value:function(e,t){var r=-1,n={0:90,1:180,2:360,3:720,4:1080}[t];n&&(r=function(e,t){e.sort((function(e,t){return e-t}));var r=e.indexOf(t);if(-1!==r)return r;for(var n=e.length-1;n>=0;n--)if(e[n]<t)return n;return-1}(this.levelsMap.get(e)||[],n));var i=this.hlsMap.get(e);i&&(i.currentLevel=r)}},{key:"pause",value:function(e){var t=this;e.forEach((function(e){var r;t.pauseSet.add(e),null===(r=t.domMap.get(e))||void 0===r||r.pause()}))}},{key:"play",value:function(e){var t=this;e.forEach((function(e){var r;t.pauseSet.delete(e),null===(r=t.domMap.get(e))||void 0===r||r.play()}))}},{key:"mute",value:function(e,t){var r=this;e.forEach((function(e){r.domMap.get(e)&&(r.domMap.get(e).muted=t)}))}},{key:"muteAll",value:function(e){var t,r=A(this.domMap.values());try{for(r.s();!(t=r.n()).done;)t.value.muted=e}catch(e){r.e(e)}finally{r.f()}}},{key:"changeAudioVolume",value:function(e){var t,r=A(this.domMap.values());try{for(r.s();!(t=r.n()).done;)t.value.volume=e}catch(e){r.e(e)}finally{r.f()}}}]);var r}(It),yf=function(){function e(){var t;R(this,e),(t=c(this,e)).canvasId="live-video-canvas-"+ee();var r=t.attachShadow({mode:"open"}),n=document.createElement("slot");return t.appendCanvas=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n;r.insertBefore(e,t)},r.appendChild(n),t}return f(e,o(HTMLElement)),D(e,[{key:"connectedCallback",value:function(){}},{key:"disconnectedCallback",value:function(){var e;null===(e=this.cleanUp)||void 0===e||e.call(this)}},{key:"createCanvas",value:function(){var t=Ar(this,this.canvasId,(function(t,r,n){var i,a;null===(i=e.sdk)||void 0===i||null===(a=i.sendToMedia)||void 0===a||a.call(i,p.UPDATE_CANVAS_SIZE,{width:r,height:n,canvas:t})}),this.getAttribute("z-index")||""),r=t.canvas,n=t.cleanUp;this.canvas=r,this.cleanUp=n,this.isConnected}},{key:"getCanvas",value:function(){return this.canvas||this.createCanvas(),this.canvas}}])}(),_f=function(e){function t(e){var r;R(this,t),(r=c(this,t)).destroy$=new We,r.subscribeVideoCache=[],r.subscribeAudioCache=[],r.subscribeLTTCache=[],r.subscribeRewindCache=[],r.subscribeBulletScreenCache=[],r.videoRenderCache=[],r.audioPlayCache=!1,r.sessionSet=new Set,r.userName="",r.networkType="DataChannel-UDP",r.currentVolume=0,r.lobbyId="",r.isInRewind=!1,r.channelStreamMap=new Map,r.lssUrl="",r.lssHost="";var n,i=e.tagName||"live-video",a=i+"-container";return customElements.get(a)?customElements.get(a).sdk=r:(customElements.define(a,yf),yf.sdk=r),r.props=e,r.timing=new to(r),r.timing.playerInit(),customElements.get(i)?((n=customElements.get(i)).container=e.container,n.sdk=r,n.containerTagName=a,n.tagName=i,n.useContainer=!e.container):(_r.container=e.container,_r.sdk=r,_r.containerTagName=a,_r.tagName=i,_r.useContainer=!e.container,customElements.define(i,_r)),r.hlsService=new mf(r,r.props.playerType||"hls"),r.timing.startParsePing(),r.pingService=new eo(r,{cloudInfoList:r.props.zcList,virtualZonePathTokenList:r.props.virtualZoneList}),r.timing.endParsePing(),r.mediaService=new Vt(r,e.baseResPath,{log:function(t,r){var n,i;"object"===j(t)&&(t=JSON.stringify(t)),null===(n=e.logAgent)||void 0===n||null===(i=n.log)||void 0===i||i.call(n,t,r)},warn:function(t,r){var n,i;"object"===j(t)&&(t=JSON.stringify(t)),null===(n=e.logAgent)||void 0===n||null===(i=n.warn)||void 0===i||i.call(n,t,r)},info:function(t,r){var n,i;"object"===j(t)&&(t=JSON.stringify(t)),null===(n=e.logAgent)||void 0===n||null===(i=n.info)||void 0===i||i.call(n,t,r)},error:function(t,r){var n,i;"object"===j(t)&&(t=JSON.stringify(t)),null===(n=e.logAgent)||void 0===n||null===(i=n.error)||void 0===i||i.call(n,t,r)},directReport:function(t,r){var n,i;"object"===j(t)&&(t=JSON.stringify(t)),null===(n=e.logAgent)||void 0===n||null===(i=n.log)||void 0===i||i.call(n,t,r)}}),r.timing.startPingRequest(),r.pingPromise=r.pingService.pingZC().then((function(t){if(r.timing.endPingRequest(),te()&&localStorage.getItem("disable_ping_")&&r.channelStreamMap.set("test_stream_id_1234567890","test_stream_id_1234567890"),t){r.lobbyId=t.lobbyId;var a,o=new Map;t.isVirtual?t.playbackTokenMap&&Object.keys(t.playbackTokenMap).forEach((function(e){var n=l(t.token);_f.playbackTokenList.push({channelId:e,playbackToken:t.playbackTokenMap[e]}),o.set(n.streamId,t.playbackTokenMap[e]),r.channelStreamMap.set(e,n.streamId)})):null===(a=t.playbackTokens)||void 0===a||a.forEach((function(e){var t=l(e.playbackToken);_f.playbackTokenList.push(e),o.set(t.streamId,e.playbackToken),r.channelStreamMap.set(e.channelId||t.channelId,t.streamId)})),r.lssUrl=t.url,r.lssHost=t.host,r.emit("ping_success",t.isVirtual?"":t.token,t.url),r.emit("ping-success",t.isVirtual?"":t.token,t.url),r.timing.pingSuccess(),customElements.get(i)&&n&&n.reloadElements(!0),r.signalService=new Tr(r,o,t.isVirtual),r.renderService=new kr(r,e.container,e.backgroundColor,e.zIndex),r.closedCaptionService=new Rn(r),r.bulletScreenService=new no(r,{trackCount:3}),r.interactiveService=new io(r),r.initService()}})).catch((function(e){Ut.error("catch ping error: "+e.message)})),xt.on(Pt.Failover).pipe(Rt(r.destroy$)).subscribe(H(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(_f.totalFailoverTime>10)){e.next=3;break}return r.emit("player-error",{code:P.TooManyFailover,reason:L.TooManyFailover}),e.abrupt("return");case 3:if(!(_f.failoverTime<3)){e.next=12;break}return r.emit("failover"),e.next=7,_f.destroy(!1);case 7:setTimeout((function(){var e=_f.init(r.props,!0);_f.playbackTokenList.forEach((function(t){null==e||e.addPlaybckToken(t)}))}),1e3*_f.failoverTime),_f.failoverTime++,_f.totalFailoverTime++,e.next=13;break;case 12:r.emit("player-error",{code:P.WebSocketBroken,reason:L.WebSocketBroken});case 13:case"end":return e.stop()}}),e)})))),Mt.on(E.DATACHANNEL_OPEN).pipe(Rt(r.destroy$)).subscribe((function(){r.timing.udpSuccess()})),r}return f(t,e),D(t,[{key:"zIndex",get:function(){return this.props.zIndex}},{key:"getNetworkHint",value:function(){return this.props.networkHint}},{key:"emit",value:function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];if("player-error"===e){var a;if(this.sessionSet.size<=0)return!1;this.sendToSignal(Lt.MonitorLog,{mlog:"PLAYER_ERROR,"+(null==n||null===(a=n[0])||void 0===a?void 0:a.code)})}return s(t,"emit",this)([e].concat(n))}},{key:"initService",value:(i=H(O().mark((function e(){var t,r,n,i=this;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.hlsService.init(),r=this.lssUrl+"&cid="+_f.cid,(function(){try{return!!/android/i.test(navigator.userAgent)}catch(e){return!1}}()||function(){try{return!!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)}catch(e){return!1}}())&&(r+="&mobile=1"),n=se(navigator.userAgent)||"",r+="&device=".concat(n),null===(t=this.signalService)||void 0===t||t.init(r),Ut.log("cid: "+_f.cid),this.emit("user-cid",_f.cid),xt.on(Pt.SignalAvaliable).pipe(Rt(this.destroy$)).subscribe((function(e){var t,n,a,o,s,u;i.timing.wsSuccess(),e.enableWebtransport&&e.webtransportPort&&(null==M||null===(s=M.util)||void 0===s||null===(u=s.isChromeVersionHigherThan)||void 0===u?void 0:u.call(s,97))&&"function"==typeof WebTransport&&(i.networkType="WebTransport-UDP"),null===(t=i.mediaService)||void 0===t||null===(t=t.init({url:r,cid:_f.cid,udpPolicy:i.props.udpRetryPolicy,lobbyId:i.lobbyId,enableTCP:e.enableTCP,enableWebtransport:e.enableWebtransport,webtransportPort:e.webtransportPort}))||void 0===t||t.then((function(e){var t=v(e,2),r=t[0],n=t[1];r&&n?i.emit("load-success"):i.emit("load-failure")})),null===(n=i.renderService)||void 0===n||n.init(),null===(a=i.bulletScreenService)||void 0===a||a.init(),i.closedCaptionService.init(),null===(o=i.interactiveService)||void 0===o||o.init()})),xt.on(Pt.VideoDecodeInit).pipe(Rt(this.destroy$)).subscribe((function(){i.subscribeRewindCache&&(i.subscribeRewind(i.subscribeRewindCache),i.subscribeRewindCache=[]),i.subscribeVideoCache.length&&(i.subscribeVideo(i.subscribeVideoCache),i.subscribeVideoCache=[]),i.subscribeLTTCache.length&&(i.subscribeLTT(i.subscribeLTTCache),i.subscribeLTTCache=[]),i.subscribeBulletScreenCache.length&&(i.subscribeBulletScreen(i.subscribeBulletScreenCache),i.subscribeBulletScreenCache=[]),i.videoRenderCache.length&&(i.startRenderVideo(i.videoRenderCache),i.videoRenderCache=[])})),xt.on(Pt.AudioDecodeInit).pipe(Rt(this.destroy$)).subscribe((function(){i.subscribeAudioCache.length&&(i.subscribeAudio(i.subscribeAudioCache),i.subscribeAudioCache=[])})),bt([xt.on(Pt.AudioDecodeInit),xt.on(Pt.AudioCanPlay)]).pipe(Rt(this.destroy$)).subscribe((function(){i.audioPlayCache&&(i.startPlayAudio(),i.audioPlayCache=!1)}));case 12:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"destroy",value:function(){var e,t=this;null===(e=this.pingPromise)||void 0===e||e.then((function(){var e,r,n,i;null===(e=t.signalService)||void 0===e||e.destroy(),null===(r=t.mediaService)||void 0===r||r.destroy(),null===(n=t.renderService)||void 0===n||n.destroy(),null===(i=t.bulletScreenService)||void 0===i||i.destroy(),t.stopPlayAudio()})),this.destroy$.next(),this.destroy$.complete(),this.removeAllListeners()}},{key:"getStreamId",value:function(e){return this.channelStreamMap.get(e)}},{key:"addPlaybckToken",value:function(e){var t;_f.playbackTokenList.push(e);var r=l(e.playbackToken[0]);this.channelStreamMap.set(e.channelId||r.channelId,r.streamId),null===(t=this.signalService)||void 0===t||t.addPlaybackToken(e)}},{key:"subscribeVideo",value:function(e){var t,r;xt.getVal(Pt.VideoDecodeInit)?null===(t=this.signalService)||void 0===t||t.subscribeMedia(x.Video,e):(r=this.subscribeVideoCache).push.apply(r,y(e))}},{key:"unSubscribeVideo",value:function(e){var t;xt.getVal(Pt.VideoDecodeInit)?null===(t=this.signalService)||void 0===t||t.unSubscribeMedia(x.Video,e.map((function(e){return e.id}))):this.subscribeVideoCache=this.subscribeVideoCache.filter((function(t){return!e.find((function(e){return e.id===t.id&&e.viewId===t.viewId}))}))}},{key:"subscribeAudio",value:function(e){var t,r;xt.getVal(Pt.AudioDecodeInit)?null===(t=this.signalService)||void 0===t||t.subscribeMedia(x.Audio,e):(r=this.subscribeAudioCache).push.apply(r,y(e))}},{key:"unSubscribeAudio",value:function(e){var t;null===(t=this.signalService)||void 0===t||t.unSubscribeMedia(x.Audio,e)}},{key:"subscribeLTT",value:function(e){var t,r;xt.getVal(Pt.SignalAvaliable)?null===(t=this.signalService)||void 0===t||t.subscribeMedia(x.LTT,e):(r=this.subscribeLTTCache).push.apply(r,y(e))}},{key:"unSubscribeLTT",value:function(e){var t;null===(t=this.signalService)||void 0===t||t.unSubscribeMedia(x.LTT,e)}},{key:"subscribeBulletScreen",value:function(e){var t,r,n;xt.getVal(Pt.SignalAvaliable)?"function"==typeof DecompressionStream?null===(t=this.signalService)||void 0===t||t.subscribeMedia(x.BulletScreen,e):null===(r=this.signalService)||void 0===r||r.subscribeMedia(x.NoCompressedBulletScreen,e):(n=this.subscribeBulletScreenCache).push.apply(n,y(e))}},{key:"unSubscribeBulletScreen",value:function(e){var t,r;"function"==typeof DecompressionStream?null===(t=this.signalService)||void 0===t||t.unSubscribeMedia(x.BulletScreen,e):null===(r=this.signalService)||void 0===r||r.unSubscribeMedia(x.NoCompressedBulletScreen,e)}},{key:"startRenderVideo",value:function(e){var t,r;xt.getVal(Pt.VideoDecodeInit)?null===(t=this.renderService)||void 0===t||t.tryToPlayVideo(e):(r=this.videoRenderCache).push.apply(r,y(e))}},{key:"stopRenderVideo",value:function(e){var t;null===(t=this.renderService)||void 0===t||t.stopVideo(e)}},{key:"renderBulletScreen",value:function(e,t){var r;null===(r=this.bulletScreenService)||void 0===r||r.addRender(e,t)}},{key:"play",value:function(e,t){var r,n;t&&(this.playAudio(e.map((function(e){return e.id}))),this.currentVolume&&this.changeAudioVolume(this.currentVolume)),null===(r=this.renderService)||void 0===r||r.tryToPlayVideo(e.map((function(e){return C(C({},e),{},{hasAudio:t})}))),this.subscribeVideo(e),null===(n=this.hlsService)||void 0===n||n.play(e.map((function(e){return e.id})))}},{key:"pause",value:function(e,t){var r,n,i;t&&!this.isInRewind&&(this.stopAudio(e.map((function(e){return e.id}))),null===(i=this.mediaService)||void 0===i||i.changeAudioVolume(0)),null===(r=this.renderService)||void 0===r||r.pauseVideo(e.map((function(e){return C(C({},e),{},{hasAudio:t})}))),this.unSubscribeVideo(e),null===(n=this.hlsService)||void 0===n||n.pause(e.map((function(e){return e.id})))}},{key:"startPlayAudio",value:function(){var e;xt.getVal(Pt.AudioDecodeInit)&&xt.getVal(Pt.AudioCanPlay)?null===(e=this.mediaService)||void 0===e||e.playAudio():this.audioPlayCache=!0}},{key:"openAudio",value:function(){var e,t,r,n;this.isInRewind?(null===(e=this.mediaService)||void 0===e||e.stopAudio(),null===(t=this.hlsService)||void 0===t||t.muteAll(!1)):(null===(r=this.mediaService)||void 0===r||r.playAudio(),null===(n=this.hlsService)||void 0===n||n.muteAll(!0))}},{key:"stopPlayAudio",value:function(){var e,t;this.isInRewind?null===(e=this.hlsService)||void 0===e||e.muteAll(!0):null===(t=this.mediaService)||void 0===t||t.stopAudio()}},{key:"playVideo",value:function(e){var t=this;this.subscribeVideo(e),this.startRenderVideo(e),e.forEach((function(e){return t.sessionSetAdd(e.id)}))}},{key:"updateVideoPosition",value:function(e){var t;null===(t=this.renderService)||void 0===t||t.updateVideoPosition(e)}},{key:"stopVideo",value:function(e){var t=this;this.unSubscribeVideo(e),this.stopRenderVideo(e),e.forEach((function(e){return t.sessionSetDelete(e.id)}))}},{key:"playAudio",value:function(e){var t,r;this.isInRewind?(this.unSubscribeAudio(e),null===(t=this.hlsService)||void 0===t||t.mute(e,!1)):(this.subscribeAudio(e.map((function(e){return{id:e}}))),this.startPlayAudio(),null===(r=this.hlsService)||void 0===r||r.mute(e,!0))}},{key:"stopAudio",value:function(e){var t;this.unSubscribeAudio(e),null===(t=this.hlsService)||void 0===t||t.mute(e,!0)}},{key:"setBulletScreenUserName",value:function(e){this.userName=e}},{key:"setChatUserName",value:function(e){this.userName=e}},{key:"sendQA",value:function(e,t){var r;null===(r=this.signalService)||void 0===r||r.sendQA(e,t)}},{key:"sendReaction",value:function(e,t){var r;null===(r=this.signalService)||void 0===r||r.sendReaction(e,t)}},{key:"sendBulletScreen",value:function(e,t,r){var n;null===(n=this.signalService)||void 0===n||n.sendBulletScreen(e,this.userName,t,r)}},{key:"enableHardwareDecode",value:function(e){var t;null===(t=this.mediaService)||void 0===t||t.enableHardwareDecode(e)}},{key:"changeAudioVolume",value:function(e){var t,r;this.currentVolume=e,null===(t=this.mediaService)||void 0===t||t.changeAudioVolume(e),null===(r=this.hlsService)||void 0===r||r.changeAudioVolume(e)}},{key:"subscribeRewind",value:function(e){var t,r;xt.getVal(Pt.VideoDecodeInit)?null===(t=this.signalService)||void 0===t||t.subscribeMedia(x.Rewind,e):(r=this.subscribeRewindCache).push.apply(r,y(e))}},{key:"unSubscribeRewind",value:function(e){var t;xt.getVal(Pt.VideoDecodeInit)?null===(t=this.signalService)||void 0===t||t.unSubscribeMedia(x.Rewind,e.map((function(e){return e.id}))):this.subscribeRewindCache=this.subscribeRewindCache.filter((function(t){return!e.find((function(e){return e.id===t.id&&e.viewId===t.viewId}))}))}},{key:"initRewind",value:(n=H(O().mark((function e(t){var r;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.subscribeRewind([{id:t}]),e.next=3,null===(r=this.hlsService)||void 0===r?void 0:r.createRewind(t,_f.cid);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"stopRewind",value:function(e){var t;null===(t=this.hlsService)||void 0===t||t.destroyRewind(e)}},{key:"attachRewindMedia",value:function(e,t){var r;null===(r=this.hlsService)||void 0===r||r.attachMedia(e,t),this.isInRewind=!0}},{key:"detachRewindMedia",value:function(e){var t;null===(t=this.hlsService)||void 0===t||t.detachMedia(e),this.isInRewind=!1}},{key:"changeResolution",value:function(e,t){var r;null===(r=this.hlsService)||void 0===r||r.changeResolution(e,t)}},{key:"sessionSetAdd",value:function(e){var t;this.sessionSet.add(e),this.sessionSet.size>0&&(null===(t=this.mediaService)||void 0===t||t.toggleQosMonitor(!0))}},{key:"sessionSetDelete",value:function(e){var t;this.sessionSet.delete(e),0===this.sessionSet.size&&(null===(t=this.mediaService)||void 0===t||t.toggleQosMonitor(!1))}},{key:"setWatermark",value:function(e){var t,r=e.enable,n=e.text,i=e.opacity,a=e.repeat,o=e.position;null===(t=this.mediaService)||void 0===t||t.setWatermark({enableWaterMark:r,waterMarkText:n,watermarkOpacity:i,watermarkRepeated:a,watermarkPosition:ue(o)})}},{key:"getWatermarkData",value:function(e){var t;return null===(t=this.mediaService)||void 0===t?void 0:t.getWatermarkData(e)}},{key:"sendToMedia",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};null===(t=this.mediaService)||void 0===t||t.sendToMedia(e,r)}},{key:"sendToSignal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!!this.signalService&&this.signalService.sendToSignal(e,t)}}],[{key:"preload",value:function(e){Vt.preload(e)}},{key:"init",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Ut.setAgent(e.logAgent||{}),Ut.init(["LSS"]),!this.instance){this.cid||(this.cid=e.cid||ee()),Ft.init(this.cid,this.instance),Ft.add("PINIT ".concat(this.cid)),this.instance=new _f(e,r),document.addEventListener("click",this.listener);var n,i=A(this.eventLists);try{var a=function(){var e=v(n.value,2),r=e[0];e[1].forEach((function(e){var n;return null===(n=t.instance)||void 0===n?void 0:n.on(r,e)}))};for(i.s();!(n=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}this.audioCanPlay&&xt.dispatch(Pt.AudioCanPlay,!0)}return this.instance}},{key:"destroy",value:(r=H(O().mark((function e(){var t,r,n=arguments;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!(n.length>0&&void 0!==n[0])||n[0],Ft.destroy(),document.removeEventListener("click",this.listener),null===(t=this.instance)||void 0===t||t.destroy(),this.instance=null,_f.cid="",Dt.reset(),r&&(_f.playbackTokenList=[],_f.eventLists=new Map);case 8:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"listen",value:function(e,t){var r;this.instance&&(this.eventLists.get(e)?null===(r=this.eventLists.get(e))||void 0===r||r.push(t):this.eventLists.set(e,[t]),this.instance.on(e,t))}},{key:"addPlaybckToken",value:function(e){this.instance&&this.instance.addPlaybckToken(e)}},{key:"getLssAddr",value:function(){return this.instance?this.instance.lssHost:""}},{key:"setChatUserName",value:function(e){this.instance&&this.instance.setChatUserName(e)}},{key:"setWatermark",value:function(e){this.instance&&this.instance.setWatermark(e),M.util.watermark.updateWaterMarkInfo({enableWaterMark:e.enable,waterMarkText:e.text,watermarkOpacity:e.opacity,watermarkRepeated:e.repeat,watermarkPosition:ue(e.position)}),xt.dispatch(Pt.UpdateWatermark,!0)}},{key:"getWatermarkData",value:function(e){return M.util.watermark.getWaterMarkData(e)}},{key:"getBuildVersion",value:function(){return 263}}]);var r,n,i}(Gt),Sf=_f;Sf.totalFailoverTime=0,Sf.failoverTime=0,Sf.audioCanPlay=!1,Sf.cid="",Sf.playbackTokenList=[],Sf.eventLists=new Map,Sf.listener=function(){_f.audioCanPlay||(xt.dispatch(Pt.AudioCanPlay,!0),_f.audioCanPlay=!0)},Sf.on=Sf.listen,e.Player=Sf,Object.defineProperties(e,w({__esModule:{value:!0}},Symbol.toStringTag,{value:"Module"}))},"object"===j(t)?n(t):n((r="undefined"!=typeof globalThis?globalThis:r||self)["live-player"]={})}(0,B.exports)),B.exports);function H(e){return{all:e=e||new Map,on:function(t,r){var n=e.get(t);n?n.push(r):e.set(t,[r])},off:function(t,r){var n=e.get(t);n&&(r?n.splice(n.indexOf(r)>>>0,1):e.set(t,[]))},emit:function(t,r){var n=e.get(t);n&&n.slice().map((function(e){e(r)})),(n=e.get("*"))&&n.slice().map((function(e){e(t,r)}))}}}var j=function(e,t){return j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},j(e,t)};function K(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}j(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var z=function(){return z=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},z.apply(this,arguments)};function q(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function Y(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function X(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)o.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return o}function Q(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e}function J(e){return this instanceof J?(this.v=e,this):new J(e)}function $(e){return"function"==typeof e}function Z(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var ee=Z((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function te(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var re=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,r,n,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var o=Y(a),s=o.next();!s.done;s=o.next())s.value.remove(this)}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else a.remove(this);var u=this.initialTeardown;if($(u))try{u()}catch(e){i=e instanceof ee?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var d=Y(c),l=d.next();!l.done;l=d.next()){var h=l.value;try{ie(h)}catch(e){i=null!=i?i:[],e instanceof ee?i=Q(Q([],X(i)),X(e.errors)):i.push(e)}}}catch(e){r={error:e}}finally{try{l&&!l.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}}if(i)throw new ee(i)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)ie(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&te(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&te(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}();function ne(e){return e instanceof re||e&&"closed"in e&&$(e.remove)&&$(e.add)&&$(e.unsubscribe)}function ie(e){$(e)?e():e.unsubscribe()}re.EMPTY;var ae=void 0;function oe(e){!function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];setTimeout.apply(void 0,Q([e,t],X(r)))}((function(){throw e}))}function se(){}var ue=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,ne(t)&&t.add(r)):r.destination=he,r}return K(t,e),t.create=function(e,t,r){return new de(e,t,r)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(re),ce=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){le(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){le(e)}else le(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){le(e)}},e}(),de=function(e){function t(t,r,n){var i,a=e.call(this)||this;return i=$(t)||!t?{next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:t,a.destination=new ce(i),a}return K(t,e),t}(ue);function le(e){oe(e)}var he={closed:!0,next:se,error:function(e){throw e},complete:se},fe="function"==typeof Symbol&&Symbol.observable||"@@observable";function pe(e){return e}var ve=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n,i=this,a=(n=e)&&n instanceof ue||function(e){return e&&$(e.next)&&$(e.error)&&$(e.complete)}(n)&&ne(n)?e:new de(e,t,r);return function(){var e=i,t=e.operator,r=e.source;a.add(t?t.call(a,r):r?i._subscribe(a):i._trySubscribe(a))}(),a},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=ge(t))((function(t,n){var i=new de({next:function(t){try{e(t)}catch(e){n(e),i.unsubscribe()}},error:n,complete:t});r.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[fe]=function(){return this},e.prototype.pipe=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return(0===(e=t).length?pe:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)})(this)},e.prototype.toPromise=function(e){var t=this;return new(e=ge(e))((function(e,r){var n;t.subscribe((function(e){return n=e}),(function(e){return r(e)}),(function(){return e(n)}))}))},e.create=function(t){return new e(t)},e}();function ge(e){var t;return null!==(t=null!=e?e:ae)&&void 0!==t?t:Promise}function me(e){return function(t){if(function(e){return $(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function ye(e,t,r,n,i){return new _e(e,t,r,n,i)}var _e=function(e){function t(t,r,n,i,a,o){var s=e.call(this,t)||this;return s.onFinalize=a,s.shouldUnsubscribe=o,s._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return K(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(ue),Se=new ve((function(e){return e.complete()})),Ae=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e},be="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Ee(e){if(e instanceof ve)return e;if(null!=e){if(function(e){return $(e[fe])}(e))return a=e,new ve((function(e){var t=a[fe]();if($(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Ae(e))return i=e,new ve((function(e){for(var t=0;t<i.length&&!e.closed;t++)e.next(i[t]);e.complete()}));if($(null==(n=e)?void 0:n.then))return r=e,new ve((function(e){r.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,oe)}));if(function(e){return Symbol.asyncIterator&&$(null==e?void 0:e[Symbol.asyncIterator])}(e))return ke(e);if(function(e){return $(null==e?void 0:e[be])}(e))return t=e,new ve((function(e){var r,n;try{for(var i=Y(t),a=i.next();!a.done;a=i.next()){var o=a.value;if(e.next(o),e.closed)return}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}e.complete()}));if(function(e){return $(null==e?void 0:e.getReader)}(e))return ke(function(e){return function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),a=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){a.push([e,t,r,n])>1||s(e,t)}))})}function s(e,t){try{(r=i[e](t)).value instanceof J?Promise.resolve(r.value.v).then(u,c):d(a[0][2],r)}catch(e){d(a[0][3],e)}var r}function u(e){s("next",e)}function c(e){s("throw",e)}function d(e,t){e(t),a.shift(),a.length&&s(a[0][0],a[0][1])}}(this,arguments,(function(){var t,r,n;return q(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,J(t.read())];case 3:return r=i.sent(),n=r.value,r.done?[4,J(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,J(n)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}(e))}var t,r,n,i,a;throw function(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}(e)}function ke(e){return new ve((function(t){(function(e,t){var r,n,i,a;return function(e,t,r,n){return new(r||(r=Promise))((function(t,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,o)}s((n=n.apply(e,[])).next())}))}(this,0,void 0,(function(){var o,s;return q(this,(function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),r=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=Y(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){!function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}(n,i,(t=e[r](t)).done,t.value)}))}}}(e),u.label=1;case 1:return[4,r.next()];case 2:if((n=u.sent()).done)return[3,4];if(o=n.value,t.next(o),t.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=u.sent(),i={error:s},[3,11];case 6:return u.trys.push([6,,9,10]),n&&!n.done&&(a=r.return)?[4,a.call(r)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}var Ce=Z((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function we(e,t){return me((function(r,n){var i=0;r.subscribe(ye(n,(function(r){n.next(e.call(t,r,i++))})))}))}var Te=Array.isArray;function Re(e,t,r){return void 0===r&&(r=1/0),$(t)?Re((function(r,n){return we((function(e,i){return t(r,e,n,i)}))(Ee(e(r,n)))}),r):("number"==typeof t&&(r=t),me((function(t,n){return function(e,t,r,n){var i=[],a=0,o=0,s=!1,u=function(){!s||i.length||a||t.complete()},c=function(e){a++;var s=!1;Ee(r(e,o++)).subscribe(ye(t,(function(e){t.next(e)}),(function(){s=!0}),void 0,(function(){if(s)try{for(a--;i.length&&a<n;)void 0,e=i.shift(),c(e);u()}catch(e){t.error(e)}var e})))};return e.subscribe(ye(t,(function(e){return a<n?c(e):i.push(e)}),(function(){s=!0,u()}))),function(){}}(t,n,e,r)})))}var Ie=["addListener","removeListener"],De=["addEventListener","removeEventListener"],Me=["on","off"];function Oe(e,t,r,n){if($(r)&&(n=r,r=void 0),n)return Oe(e,t,r).pipe(function(e){return we((function(t){return function(e,t){return Te(t)?e.apply(void 0,Q([],X(t))):e(t)}(e,t)}))}(n));var i=X(function(e){return $(e.addEventListener)&&$(e.removeEventListener)}(e)?De.map((function(n){return function(i){return e[n](t,i,r)}})):function(e){return $(e.addListener)&&$(e.removeListener)}(e)?Ie.map(xe(e,t)):function(e){return $(e.on)&&$(e.off)}(e)?Me.map(xe(e,t)):[],2),a=i[0],o=i[1];if(!a&&Ae(e))return Re((function(e){return Oe(e,t,r)}))(Ee(e));if(!a)throw new TypeError("Invalid event target");return new ve((function(e){var t=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.next(1<t.length?t:t[0])};return a(t),function(){return o(t)}}))}function xe(e,t){return function(r){return function(n){return e[r](t,n)}}}function Pe(e){return e<=0?function(){return Se}:me((function(t,r){var n=0;t.subscribe(ye(r,(function(t){++n<=e&&(r.next(t),e<=n&&r.complete())})))}))}function Le(e){switch(e.responseType){case"json":if("response"in e)return e.response;var t=e;return JSON.parse(t.responseText);case"document":return e.responseXML;default:return"response"in e?e.response:(t=e).responseText}}var Ne=function(e,t,r,n){void 0===n&&(n="download_load"),this.originalEvent=e,this.xhr=t,this.request=r,this.type=n;var i=t.status,a=t.responseType;this.status=null!=i?i:0,this.responseType=null!=a?a:"";var o=t.getAllResponseHeaders();this.responseHeaders=o?o.split("\n").reduce((function(e,t){var r=t.indexOf(": ");return e[t.slice(0,r)]=t.slice(r+2),e}),{}):{},this.response=Le(t);var s=e.loaded,u=e.total;this.loaded=s,this.total=u},Ve=Z((function(e){return function(e,t,r){var n;this.message=e,this.name="AjaxError",this.xhr=t,this.request=r,this.status=t.status,this.responseType=t.responseType;try{n=Le(t)}catch(e){n=t.responseText}this.response=n}})),Ue=function(){function e(e,t){return Ve.call(this,"ajax timeout",e,t),this.name="AjaxTimeoutError",this}return e.prototype=Object.create(Ve.prototype),e}();var Fe=we((function(e){return e.response}));var Be,We,Ge=(Be=function(e){var t;return t="string"==typeof e?{url:e}:e,new ve((function(e){var r,n,i,a=z({async:!0,crossDomain:!1,withCredentials:!1,method:"GET",timeout:0,responseType:"json"},t),o=a.queryParams,s=a.body,u=a.headers,c=a.url;if(!c)throw new TypeError("url is required");if(o)if(c.includes("?")){var d=c.split("?");if(2<d.length)throw new TypeError("invalid url");i=new URLSearchParams(d[1]),new URLSearchParams(o).forEach((function(e,t){return i.set(t,e)})),c=d[0]+"?"+i}else c=c+"?"+(i=new URLSearchParams(o));var l={};if(u)for(var h in u)u.hasOwnProperty(h)&&(l[h.toLowerCase()]=u[h]);var f=a.crossDomain;f||"x-requested-with"in l||(l["x-requested-with"]="XMLHttpRequest");var p=a.withCredentials,v=a.xsrfCookieName,g=a.xsrfHeaderName;if((p||!f)&&v&&g){var m=null!==(n=null===(r=null===document||void 0===document?void 0:document.cookie.match(new RegExp("(^|;\\s*)("+v+")=([^;]*)")))||void 0===r?void 0:r.pop())&&void 0!==n?n:"";m&&(l[g]=m)}var y,_=function(e,t){var r;if(!e||"string"==typeof e||function(e){return"undefined"!=typeof FormData&&e instanceof FormData}(e)||function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams}(e)||function(e){return Xe(e,"ArrayBuffer")}(e)||function(e){return Xe(e,"File")}(e)||function(e){return Xe(e,"Blob")}(e)||function(e){return"undefined"!=typeof ReadableStream&&e instanceof ReadableStream}(e))return e;if(function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView(e)}(e))return e.buffer;if("object"==typeof e)return t["content-type"]=null!==(r=t["content-type"])&&void 0!==r?r:"application/json;charset=utf-8",JSON.stringify(e);throw new TypeError("Unknown body type")}(s,l),S=z(z({},a),{url:c,headers:l,body:_});y=t.createXHR?t.createXHR():new XMLHttpRequest;var A=t.progressSubscriber,b=t.includeDownloadProgress,E=void 0!==b&&b,k=t.includeUploadProgress,C=void 0!==k&&k,w=function(t,r){y.addEventListener(t,(function(){var t,n=r();null===(t=null==A?void 0:A.error)||void 0===t||t.call(A,n),e.error(n)}))};w("timeout",(function(){return new Ue(y,S)})),w("abort",(function(){return new Ve("aborted",y,S)}));var T=function(e,t){return new Ne(t,y,S,e+"_"+t.type)},R=function(t,r,n){t.addEventListener(r,(function(t){e.next(T(n,t))}))};C&&[Ke,ze,qe].forEach((function(e){return R(y.upload,e,He)})),A&&[Ke,ze].forEach((function(e){return y.upload.addEventListener(e,(function(e){var t;return null===(t=null==A?void 0:A.next)||void 0===t?void 0:t.call(A,e)}))})),E&&[Ke,ze].forEach((function(e){return R(y,e,je)}));var I=function(t){var r="ajax error"+(t?" "+t:"");e.error(new Ve(r,y,S))};y.addEventListener("error",(function(e){var t;null===(t=null==A?void 0:A.error)||void 0===t||t.call(A,e),I()})),y.addEventListener(qe,(function(t){var r,n,i=y.status;if(i<400){null===(r=null==A?void 0:A.complete)||void 0===r||r.call(A);var a=void 0;try{a=T(je,t)}catch(t){return void e.error(t)}e.next(a),e.complete()}else null===(n=null==A?void 0:A.error)||void 0===n||n.call(A,t),I(i)}));var D=S.user,M=S.method,O=S.async;for(var h in D?y.open(M,c,O,D,S.password):y.open(M,c,O),O&&(y.timeout=S.timeout,y.responseType=S.responseType),"withCredentials"in y&&(y.withCredentials=S.withCredentials),l)l.hasOwnProperty(h)&&y.setRequestHeader(h,l[h]);return _?y.send(_):y.send(),function(){y&&4!==y.readyState&&y.abort()}}))},Be.get=function(e,t){return Ge({method:"GET",url:e,headers:t})},Be.post=function(e,t,r){return Ge({method:"POST",url:e,body:t,headers:r})},Be.delete=function(e,t){return Ge({method:"DELETE",url:e,headers:t})},Be.put=function(e,t,r){return Ge({method:"PUT",url:e,body:t,headers:r})},Be.patch=function(e,t,r){return Ge({method:"PATCH",url:e,body:t,headers:r})},Be.getJSON=function(e,t){return Fe(Ge({method:"GET",url:e,headers:t}))},Be),He="upload",je="download",Ke="loadstart",ze="progress",qe="load",Ye=Object.prototype.toString;function Xe(e,t){return Ye.call(e)==="[object "+t+"]"}var Qe=new Uint8Array(16);function Je(){if(!We&&!(We="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return We(Qe)}for(var $e=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Ze=[],et=0;et<256;++et)Ze.push((et+256).toString(16).substr(1));function tt(e,t,r){var n=(e=e||{}).random||(e.rng||Je)();return n[6]=15&n[6]|64,n[8]=63&n[8]|128,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(Ze[e[t+0]]+Ze[e[t+1]]+Ze[e[t+2]]+Ze[e[t+3]]+"-"+Ze[e[t+4]]+Ze[e[t+5]]+"-"+Ze[e[t+6]]+Ze[e[t+7]]+"-"+Ze[e[t+8]]+Ze[e[t+9]]+"-"+Ze[e[t+10]]+Ze[e[t+11]]+Ze[e[t+12]]+Ze[e[t+13]]+Ze[e[t+14]]+Ze[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&$e.test(e)}(r))throw TypeError("Stringified UUID is invalid");return r}(n)}function rt(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var nt="object"==typeof global&&global&&global.Object===Object&&global,it="object"==typeof self&&self&&self.Object===Object&&self,at=nt||it||Function("return this")(),ot=function(){return at.Date.now()},st=/\s/,ut=/^\s+/;var ct=at.Symbol,dt=Object.prototype,lt=dt.hasOwnProperty,ht=dt.toString,ft=ct?ct.toStringTag:void 0,pt=Object.prototype.toString,vt=ct?ct.toStringTag:void 0;var gt=/^[-+]0x[0-9a-f]+$/i,mt=/^0b[01]+$/i,yt=/^0o[0-7]+$/i,_t=parseInt;function St(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return null!=e&&"object"==typeof e}(e)&&"[object Symbol]"==function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":vt&&vt in Object(e)?function(e){var t=lt.call(e,ft),r=e[ft];try{e[ft]=void 0;var n=!0}catch(e){}var i=ht.call(e);return n&&(t?e[ft]=r:delete e[ft]),i}(e):function(e){return pt.call(e)}(e)}(e)}(e))return NaN;if(rt(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=rt(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=function(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&st.test(e.charAt(t)););return t}(e)+1).replace(ut,""):e}(e);var r=mt.test(e);return r||yt.test(e)?_t(e.slice(2),r?2:8):gt.test(e)?NaN:+e}var At=Math.max,bt=Math.min;const Et="INVALID_OPERATION";let kt=function(e){return e.LocalStorage="LocalStorage",e.SessionStorage="SessionStorage",e.Memory="Memory",e}({});const Ct=L("{}");class wt{constructor(e){this.sessionStorageKey=void 0,this.localStorageKey=void 0,this.sessionCache=void 0,this.localCache=void 0,this.memoryCache=void 0,this.sessionStorageKey=L(`zoom-storage-${e}`),this.localStorageKey=L("zoom-local-storage"),this.memoryCache={};try{this.sessionCache=JSON.parse(N(sessionStorage.getItem(this.sessionStorageKey)||Ct)),this.localCache=JSON.parse(N(localStorage.getItem(this.localStorageKey)||Ct))}catch(e){console.error(e),this.sessionCache={},this.localCache={}}}static init(e){this.instance=new wt(e)}static get(e){if(void 0===this.instance)throw new Error("read before initial");return this.instance.getValue(e).value}static set(e,t,r){if(void 0===this.instance)throw new Error("set before initial");return this.instance.setValue(e,t,r)}static remove(e){if(void 0===this.instance)throw new Error("remove before initial");return this.instance.removeValue(e)}static clearSession(){if(void 0===this.instance)throw new Error("clear before initial");return this.instance.memoryCache={},this.instance.sessionCache={},this.instance.localCache={},sessionStorage.removeItem(this.instance.sessionStorageKey)}getValue(e){return this.sessionCache.hasOwnProperty(e)?{value:this.sessionCache[e],type:kt.SessionStorage}:this.localCache.hasOwnProperty(e)?{value:this.localCache[e],type:kt.LocalStorage}:{value:this.memoryCache[e],type:kt.Memory}}setValue(e,t,r){if(!e)throw new Error("key is null");switch(r){case kt.SessionStorage:{const r=this.sessionCache[e];let n=t;return"function"==typeof t&&(n=t(r)),r!==n&&(this.sessionCache[e]=n,this.flushValue(kt.SessionStorage)),n}case kt.LocalStorage:{const r=this.localCache[e];let n=t;return"function"==typeof t&&(n=t(r)),r!==n&&(this.localCache[e]=n,this.flushValue(kt.LocalStorage)),n}case kt.Memory:{const r=this.memoryCache[e];let n=t;return"function"==typeof t&&(n=t(r)),this.memoryCache[e]=n,n}default:return null}}removeValue(e){const{type:t}=this.getValue(e);switch(t){case kt.SessionStorage:delete this.sessionCache[e],this.flushValue(kt.SessionStorage);break;case kt.LocalStorage:delete this.localCache[e],this.flushValue(kt.LocalStorage);break;case kt.Memory:delete this.memoryCache[e]}}flushValue(e){e===kt.SessionStorage?sessionStorage.setItem(this.sessionStorageKey,L(JSON.stringify(this.sessionCache))):e===kt.LocalStorage&&localStorage.setItem(this.localStorageKey,L(JSON.stringify(this.localCache)))}}wt.instance=void 0;let Tt=function(e){return e.WebclientDeviceId="WEBCLIENT_DEVICE_ID",e.VSDKLogTrackingId="ZM_VSDK_LOG_TRACKING_IDS",e}({}),Rt=function(e){return e.DisableAutoReportLogs="DISABLE_AUTO_REPORT_LOGS",e}({});var It,Dt,Mt,Ot;!function(e){e[e.PLAIN=0]="PLAIN",e[e.RSA=1]="RSA",e[e.AESGCM256=2]="AESGCM256"}(It||(It={})),function(e){e[e.info=0]="info",e[e.debug=1]="debug",e[e.log=2]="log",e[e.warn=3]="warn",e[e.error=4]="error"}(Dt||(Dt={})),function(e){e[e.PROTECT_LOCAL_KEY=0]="PROTECT_LOCAL_KEY"}(Mt||(Mt={})),function(e){e.beforeInit="beforeInit",e.afterInit="afterInit",e.beforeLog="beforeLog",e.hitSizeLimit="hitSizeLimit",e.afterLog="afterLog",e.beforeReport="beforeReport",e.afterReport="afterReport"}(Ot||(Ot={}));class xt{constructor(){}}var Pt,Lt,Nt={exports:{}},Vt={exports:{}},Ut=function(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var r=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),r}(Object.freeze({__proto__:null,default:{}}));function Ft(){return Pt||(Pt=1,Vt.exports=(e=e||function(e){var t;if("undefined"!=typeof window&&window.crypto&&(t=window.crypto),"undefined"!=typeof self&&self.crypto&&(t=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(t=globalThis.crypto),!t&&"undefined"!=typeof window&&window.msCrypto&&(t=window.msCrypto),!t&&void 0!==U&&U.crypto&&(t=U.crypto),!t)try{t=Ut}catch(e){}var r=function(){if(t){if("function"==typeof t.getRandomValues)try{return t.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof t.randomBytes)try{return t.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},n=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),i={},a=i.lib={},o=a.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=a.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var a=0;a<i;a++){var o=r[a>>>2]>>>24-a%4*8&255;t[n+a>>>2]|=o<<24-(n+a)%4*8}else for(var s=0;s<i;s+=4)t[n+s>>>2]=r[s>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(r());return new s.init(t,e)}}),u=i.enc={},c=u.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var a=t[i>>>2]>>>24-i%4*8&255;n.push((a>>>4).toString(16)),n.push((15&a).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new s.init(r,t/2)}},d=u.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var a=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(a))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new s.init(r,t)}},l=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},h=a.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,i=n.words,a=n.sigBytes,o=this.blockSize,u=a/(4*o),c=(u=t?e.ceil(u):e.max((0|u)-this._minBufferSize,0))*o,d=e.min(4*c,a);if(c){for(var l=0;l<c;l+=o)this._doProcessBlock(i,l);r=i.splice(0,c),n.sigBytes-=d}return new s.init(r,d)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});a.Hasher=h.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new f.HMAC.init(e,r).finalize(t)}}});var f=i.algo={};return i}(Math),e)),Vt.exports;var e}var Bt,Wt,Gt=Lt?Nt.exports:(Lt=1,Nt.exports=Ft().enc.Utf8),Ht={exports:{}},jt=(Bt||(Bt=1,Ht.exports=(Wt=Ft(),function(){var e=Wt,t=e.lib.WordArray;function r(e,r,n){for(var i=[],a=0,o=0;o<r;o++)if(o%4){var s=n[e.charCodeAt(o-1)]<<o%4*2|n[e.charCodeAt(o)]>>>6-o%4*2;i[a>>>2]|=s<<24-a%4*8,a++}return t.create(i,a)}e.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],a=0;a<r;a+=3)for(var o=(t[a>>>2]>>>24-a%4*8&255)<<16|(t[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|t[a+2>>>2]>>>24-(a+2)%4*8&255,s=0;s<4&&a+.75*s<r;s++)i.push(n.charAt(o>>>6*(3-s)&63));var u=n.charAt(64);if(u)for(;i.length%4;)i.push(u);return i.join("")},parse:function(e){var t=e.length,n=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var a=0;a<n.length;a++)i[n.charCodeAt(a)]=a}var o=n.charAt(64);if(o){var s=e.indexOf(o);-1!==s&&(t=s)}return r(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),Wt.enc.Base64)),Ht.exports),Kt=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))};const zt=e=>{try{const t=jt.parse(e);return Gt.stringify(t)}catch(t){return e}},qt=e=>{for(var t=e.length,r=e.length-1;r>=0;r--){var n=e.charCodeAt(r);n>127&&n<=2047?t++:n>2047&&n<=65535&&(t+=2),n>=56320&&n<=57343&&r--}return t},Yt=()=>Kt(void 0,void 0,void 0,(function*(){return yield self.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"])})),Xt=(e,t,r)=>Kt(void 0,void 0,void 0,(function*(){try{return yield self.crypto.subtle.encrypt({name:"AES-GCM",iv:r},t,e)}catch(e){throw e}})),Qt=(e,t)=>{const r="string"==typeof e?function(e){const t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let t=0,n=e.length;t<n;t++)r[t]=e.charCodeAt(t);return t}(e):e;return self.crypto.subtle.encrypt({name:"RSA-OAEP"},t,r)},Jt={},$t=(e,t)=>{Jt[t]=e},Zt=Jt,er=e=>{try{return JSON.stringify(e)}catch(e){return"json stringify failed"}},tr=e=>{try{return JSON.parse(e)}catch(t){return e}};const rr=e=>{let t=0;return t+=qt(e.message),e.tags.forEach((e=>{t+=qt(e)})),t};class nr{constructor(e){this.uuid="randomUUID"in self.crypto?self.crypto.randomUUID():"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)));const{databaseName:t,maxSize:r,publicKey:n,reportUrl:i,plugins:a,idbManager:o,logManager:s,currentSize:u,externalKeys:c,codecWorkerFilePath:d}=e;this.databaseName=t,this.maxSize=r,this.publicKey=null!=n?n:"",this.reportUrl=null!=i?i:"",this.plugins=null!=a?a:[],this.idbManager=o,this.logManager=s,this.currentSize=null!=u?u:0,this.externalKeys=c,this.commonMethods=Object.assign({},Zt)}getLocalAESGCM256Key(){var e;return function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))}(this,void 0,void 0,(function*(){if(this.localAESGCM256Key)return this.localAESGCM256Key;this.localAESGCM256Key=yield Yt();const t=this.externalKeys?null===(e=this.externalKeys.filter((e=>e.usage===Mt.PROTECT_LOCAL_KEY))[0])||void 0===e?void 0:e.key:void 0;return yield this.idbManager.saveAESGCM256Key(this.uuid,this.localAESGCM256Key,t),this.localAESGCM256Key}))}updateCurrentSize(e){var t;let r=null!==(t=this.currentSize)&&void 0!==t?t:0;if(e instanceof Map)for(const[t,n]of e)r+=rr(n);else r+=rr(e);return this.currentSize=r,r>=this.maxSize}}const ir=(...e)=>{const t={},r=[];for(const n of e)n.forEach((e=>{t[e.id]||(t[e.id]=!0,r.push(e))}));const n=new Map;return r.sort(((e,t)=>(null==e?void 0:e.id)-(null==t?void 0:t.id))).forEach((e=>{n.set(e.id,e)})),n},ar=(e,t)=>{const r=new Map;return t.forEach((t=>{e(t)&&r.set(t.id,t)})),r};class or{constructor(){this.getStore=()=>({byTag:Object.assign({},this.store.byTag),byTime:new Map(this.store.byTime)}),this.pushByTime=e=>{for(const t of e)this.store.byTime.set(t.id,t)},this.pushByTag=e=>{e.forEach((e=>{const t=e.tags;Array.isArray(t)&&t.forEach((t=>{this.store.byTag[t]||(this.store.byTag[t]=new Map),this.store.byTag[t].set(e.id,e)}))}))},this.addLog=e=>{let t=e;Array.isArray(e)||(t=[e]),this.pushByTime(t),this.pushByTag(t)},this.syncFromIDB=e=>function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))}(this,void 0,void 0,(function*(){const t=yield e.getAllLogs();this.addLog(t)})),this.reset=()=>{this.store={byTag:{},byTime:new Map}},this.deleteLogs=e=>{for(const t of e){const e=this.store.byTime.get(t);if(!e)continue;const{tags:r}=e;for(const e of r)this.store.byTag[e].delete(t);this.store.byTime.delete(t)}},this.filterStore=e=>{const t=((e,t)=>{if(!t)return e.byTime;if("string"==typeof t)return e.byTag[t]||new Map;if(Array.isArray(t)){if(t.every((e=>"string"==typeof e)))return ir(...t.map((t=>e.byTag[t])).filter((e=>Boolean(e))))}else{if("function"==typeof t)return ar(t,e.byTime);if("object"==typeof t)if(t.tags&&t.filter){if("string"==typeof t.tags)return ar(t.filter,e.byTag[t.tags]);if(Array.isArray(t.tags)&&t.tags.every((e=>"string"==typeof e)))return ir(...t.tags.map((r=>{const n=e.byTag[r];return n?ar(t.filter,n):new Map})))}else{if(t.filter)return ar(t.filter,e.byTime);if(t.tags){if("string"==typeof t)return e.byTag[t]||new Map;if(Array.isArray(t)&&t.every((e=>"string"==typeof e)))return ir(...t.map((t=>e.byTag[t])))}}else console.error("Wrong filter type")}return new Map})(this.store,e),r=new Map;for(const[e,n]of t){const t=Object.assign(Object.assign({},n),{message:tr(zt(n.message))});r.set(e,t)}return r},this.store={byTag:{},byTime:new Map}}}function sr(e,t,r){const n=e.plugins;if(!Array.isArray(n))return r;let i=r;return n.forEach((r=>{const n=r[t];if("function"==typeof n){const t=n(e,i);t&&(i=t)}})),i}const ur=(e,t,r,n,i,a={})=>function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))}(void 0,void 0,void 0,(function*(){const{noCache:o,extraProperties:s={}}=a,u=((e,t,r,n,i,a)=>{const o=Array.isArray(t)?t:[t],s=Date.now();return Object.assign({message:e,logLevel:r,tags:o,encryptMode:n,timestamp:s,laplaceSessionId:i},a)})(`${t}`,r,n,i,e.uuid,s),c=sr(e,Ot.beforeLog,u);if(o)sr(e,Ot.afterLog,u);else{const{idbManager:t,logManager:r}=e,n=yield t.makeNextId();c.message=(e=>{try{const t=Gt.parse(e);return jt.stringify(t)}catch(t){return e}})(c.message);const i=Object.assign(Object.assign({},c),{id:n});e.updateCurrentSize(i)&&sr(e,Ot.hitSizeLimit,i),r.addLog(i),yield t.addLog(i),sr(e,Ot.afterLog,i)}}));$t(ur,"commonLog");const cr=e=>new Promise((t=>{if(e.isSendByBeacon)navigator.sendBeacon?(navigator.sendBeacon(e.url,e.data),t({report:e.reportItem})):t({error:"sendBeacon is not supported",report:e.reportItem});else{const r=new XMLHttpRequest;r.open(e.type||"GET",e.url,!0),r.withCredentials=e.withCredentials,r.onerror=r=>{t({error:r,report:e.reportItem})},r.onreadystatechange=function(){if(4===r.readyState){const n=r.status;t(n>=200&&n<300?{report:e.reportItem}:{error:`Request failed, status: ${n}, responseText: ${r.responseText}`,report:e.reportItem})}},Object.entries(e.headers).forEach((([e,t])=>{t&&e&&r.setRequestHeader(e,t)})),r.send(e.data)}}));const dr=(e,t=2)=>{let r=`${e}`;for(;r.length<t;)r=`0${r}`;return r},lr=e=>{const t=new Date(e);return`${t.getUTCFullYear()}-${dr(t.getUTCMonth()+1)}-${dr(t.getUTCDate())} ${dr(t.getUTCHours())}:${dr(t.getUTCMinutes())}:${dr(t.getUTCSeconds())}.${dr(t.getUTCMilliseconds(),3)}`},hr={version:"000001",flag:"0"},fr=(e,t)=>Array.from(e.values()).reduce(((e,r)=>{const n=((e,t)=>{const{message:r,logLevel:n,tags:i,timestamp:a,encryptMode:o,id:s}=e,u=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["message","logLevel","tags","timestamp","encryptMode","id"]),c=Object.assign(Object.assign({time:lr(a),logLevel:Dt[n],message:r,tags:i},t),u);return er(c)})(r,t),i=qt(n),a=e[e.length-1];return a.currentSize+i>30720?e.push({messages:[n],ids:[r.id],currentSize:i}):(a.messages.push(n),a.ids.push(r.id),a.currentSize+=i),e}),[{messages:[],ids:[],currentSize:0}]).filter((e=>e.currentSize>0)).map((e=>({messages:e.messages.join("\n"),ids:e.ids,meta:hr}))),pr=(e,t,r)=>((e,t,r)=>Promise.all(e.map((e=>Object.assign({url:t||"",type:"POST",withCredentials:!1,headers:{},data:er({messages:e.messages,meta:e.meta}),reportItem:e},r))).map(cr)))(e,t.reportUrl,r).then((e=>{e.forEach((e=>{var r;sr(t,Ot.afterReport,{report:e.report,error:null!==(r=e.error)&&void 0!==r?r:null})}))})),vr=(e,t,r)=>function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))}(void 0,void 0,void 0,(function*(){const n=e.logManager.filterStore(t);if(!n||0===(null==n?void 0:n.size)||!r)return;const{xhrOptions:i={},additionalContext:a}=r,o=sr(e,Ot.beforeReport,n),s=fr(o,a);pr(s,e,i)}));$t(vr,"commonReport");var gr=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))};const mr=(e,t,r)=>gr(void 0,void 0,void 0,(function*(){const{idbManager:n,logManager:i}=e;if(Array.isArray(r)&&(yield n.deleteLogs(r),i.deleteLogs(r),!t))return;const a=e.logManager.filterStore(t),o=[];for(const[e,t]of a)o.push(t.id);let s=o;Array.isArray(o)||(s=[o]),yield n.deleteLogs(s),i.deleteLogs(s)})),yr=e=>gr(void 0,void 0,void 0,(function*(){const{idbManager:t,logManager:r}=e;yield t.reset(),r.reset()}));function _r(e){return new Promise(((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)}))}function Sr(e,t){let r;return(n,i)=>(()=>{if(r)return r;const n=indexedDB.open(e);return n.onupgradeneeded=()=>n.result.createObjectStore(t),r=_r(n),r.then((e=>{e.onclose=()=>r=void 0}),(()=>{})),r})().then((e=>i(e.transaction(t,n).objectStore(t))))}let Ar;function br(){return Ar||(Ar=Sr("keyval-store","keyval")),Ar}function Er(e,t=br()){return t("readwrite",(t=>(e.forEach((e=>t.delete(e))),_r(t.transaction))))}function kr(e=br()){return e("readonly",(t=>{if(t.getAll&&t.getAllKeys)return Promise.all([_r(t.getAllKeys()),_r(t.getAll())]).then((([e,t])=>e.map(((e,r)=>[e,t[r]]))));const r=[];return e("readonly",(e=>function(e){return e.openCursor().onsuccess=function(){this.result&&((e=>{r.push([e.key,e.value])})(this.result),this.result.continue())},_r(e.transaction)}(e).then((()=>r))))}))}$t(mr,"commonDelete"),$t(yr,"commonReset");const Cr={default:{queue:[],isRunning:!1,listeners:[]}},wr=e=>{let t=Cr[e];return t||(t={queue:[],isRunning:!1,listeners:[]},Cr[e]=t),t};function Tr(e){return function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))}(this,void 0,void 0,(function*(){const t=wr(e),{queue:r,listeners:n}=t;for(;r.length>0&&!t.isRunning;){const n=r.shift();t.isRunning=!0;try{const e=yield n.task();n.resolution(e)}catch(e){n.rejection(e)}t.isRunning=!1,Tr(e)}n.length&&n.forEach((e=>{e()}))}))}function Rr(e,t="default"){const r=wr(t);try{return new Promise(((n,i)=>{r.queue.push({task:e,resolution:n,rejection:i}),Tr(t)}))}catch(e){return Promise.reject(e)}}const Ir=(e,t)=>{wr(e).listeners.push(t)};var Dr=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))};const Mr="change_meta",Or="change_log",xr=()=>Promise.resolve();class Pr{constructor(e){this.waitingForReset=!1,this.resetting=!1,this.isChangingMeta=!1,this.isChangingLog=!1,this.dbFailCount={read:0,write:0},this.get=e=>function(e,t=br()){return t("readonly",(t=>_r(t.get(e))))}(e,this.store),this.set=(e,t)=>Dr(this,void 0,void 0,(function*(){try{return!(this.dbFailCount.write>3)&&(yield function(e,t,r=br()){return r("readwrite",(r=>(r.put(t,e),_r(r.transaction))))}(e,t,this.store))}catch(r){r instanceof DOMException&&(r&&"QuotaExceededError"===r.name?(yield this.deleteOldLogsForSetNewOne(),yield this.set(e,t)):this.dbFailCount.write+=1),console.error(r)}})),this.deleteOldLogsForSetNewOne=()=>Dr(this,void 0,void 0,(function*(){var e;const t=yield this.getAllLogs(),r=[];for(let n=0;n<13;n++){const i=null===(e=t[n])||void 0===e?void 0:e.id;(i||0===i)&&r.push(`${i}`)}return Er(r,this.store)})),this.adjustMaxId=()=>Dr(this,void 0,void 0,(function*(){return this.resetting?xr():(this.isChangingMeta=!0,yield Rr((()=>Dr(this,void 0,void 0,(function*(){var e;const t=yield this.getAllLogs(),r=t[t.length-1],n=null!==(e=null==r?void 0:r.id)&&void 0!==e?e:0;return yield this.set("maxId",n),n}))),Mr))})),this.makeNextId=()=>Dr(this,void 0,void 0,(function*(){return this.resetting?xr():(this.isChangingMeta=!0,yield Rr((()=>Dr(this,void 0,void 0,(function*(){const e=yield this.get("maxId");if(!e&&0!==e)return yield this.set("maxId",0),0;const t=e+1;return yield this.set("maxId",t),t}))),Mr))})),this.addLog=e=>Dr(this,void 0,void 0,(function*(){if(this.resetting)return xr();this.isChangingLog=!0,yield Rr((()=>Dr(this,void 0,void 0,(function*(){const{id:t}=e;return this.set(`${t}`,e)}))),Or)})),this.getAllLogs=()=>Dr(this,void 0,void 0,(function*(){return(yield kr(this.store)).filter((([e])=>"maxId"!==e)).sort(((e,t)=>{var r,n;return(null===(r=e[1])||void 0===r?void 0:r.id)-(null===(n=t[1])||void 0===n?void 0:n.id)})).map((([,e])=>e))})),this.deleteLogs=e=>Dr(this,void 0,void 0,(function*(){if(this.resetting)return xr();this.isChangingLog=!0,yield Rr((()=>Dr(this,void 0,void 0,(function*(){return Er(e.map((e=>`${e}`)),this.store)}))),Or),yield this.adjustMaxId()})),this.saveAESGCM256Key=(e,t,r)=>Dr(this,void 0,void 0,(function*(){if(r){const n=yield self.crypto.subtle.exportKey("raw",t),i=yield((e,t,r)=>Kt(void 0,void 0,void 0,(function*(){return new Promise(((n,i)=>{requestAnimationFrame((()=>Kt(void 0,void 0,void 0,(function*(){var i;const a=null===(i=null==t?void 0:t.algorithm)||void 0===i?void 0:i.name;let o;if("RSA-OAEP"===a?o=Qt:"AES-GCM"===a&&(o=Xt),!o)throw new Error("Unsupported encrypt key type");if("string"==typeof e){const i=new TextEncoder,a=yield o(i.encode(e),t,r);n(a)}else{const i=yield o(e,t,r);n(i)}}))))}))})))(n,r,new Uint8Array(16));yield this.set(`aes-gcm-256-${e}`,i)}else yield this.set(`aes-gcm-256-${e}`,t)})),this.reset=()=>Dr(this,void 0,void 0,(function*(){return this.resetting?xr():(this.waitingForReset=!0,this.isChangingLog||this.isChangingMeta?xr():(this.resetting=!0,yield function(e=br()){return e("readwrite",(e=>(e.clear(),_r(e.transaction))))}(this.store),this.resetting=!1,void(this.waitingForReset=!1)))})),this.store=Sr(e,e+"-store"),Ir(Mr,(()=>{if(this.isChangingMeta=!1,this.waitingForReset)return this.reset()})),Ir(Or,(()=>{if(this.isChangingLog=!1,this.waitingForReset)return this.reset()}))}}var Lr=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))};const Nr={databaseName:"laplace-default-db",maxSize:49283072};class Vr{constructor(e){this.commonLogWithContext=(e,t,r,n,i)=>Lr(this,void 0,void 0,(function*(){yield ur(this.runtimeMetaManager,e,t,r,n,i)})),this.commonReportWithContext=(e,t)=>Lr(this,void 0,void 0,(function*(){yield vr(this.runtimeMetaManager,e,t)})),this.commonDeleteWithContext=e=>Lr(this,void 0,void 0,(function*(){yield mr(this.runtimeMetaManager,e)})),this.resetWithContext=()=>Lr(this,void 0,void 0,(function*(){yield yr(this.runtimeMetaManager)})),this.initLocalAESGCM256Key=()=>Lr(this,void 0,void 0,(function*(){return yield Yt()})),this.doNotUseDirtyGetStore=()=>this.runtimeMetaManager.logManager.getStore(),this.log=(e,t,r)=>Lr(this,void 0,void 0,(function*(){yield this.commonLogWithContext(e,t,Dt.log,It.PLAIN,{extraProperties:r})})),this.info=(e,t,r)=>Lr(this,void 0,void 0,(function*(){yield this.commonLogWithContext(e,t,Dt.info,It.PLAIN,{extraProperties:r})})),this.warn=(e,t,r)=>Lr(this,void 0,void 0,(function*(){yield this.commonLogWithContext(e,t,Dt.warn,It.PLAIN,{extraProperties:r})})),this.debug=(e,t,r)=>Lr(this,void 0,void 0,(function*(){yield this.commonLogWithContext(e,t,Dt.debug,It.PLAIN,{extraProperties:r})})),this.error=(e,t,r)=>Lr(this,void 0,void 0,(function*(){yield this.commonLogWithContext(e,t,Dt.error,It.PLAIN,{extraProperties:r})})),this.logWithEncryption=(e,t,r)=>Lr(this,void 0,void 0,(function*(){yield this.commonLogWithContext(e,t,Dt.log,It.AESGCM256,{extraProperties:r})})),this.infoWithEncryption=(e,t,r)=>Lr(this,void 0,void 0,(function*(){yield this.commonLogWithContext(e,t,Dt.info,It.AESGCM256,{extraProperties:r})})),this.debugWithEncryption=(e,t,r)=>Lr(this,void 0,void 0,(function*(){yield this.commonLogWithContext(e,t,Dt.debug,It.AESGCM256,{extraProperties:r})})),this.warnWithEncryption=(e,t,r)=>Lr(this,void 0,void 0,(function*(){yield this.commonLogWithContext(e,t,Dt.warn,It.AESGCM256,{extraProperties:r})})),this.errorWithEncryption=(e,t,r)=>Lr(this,void 0,void 0,(function*(){yield this.commonLogWithContext(e,t,Dt.error,It.AESGCM256,{extraProperties:r})})),this.logWithoutCache=(e,t,r)=>Lr(this,void 0,void 0,(function*(){yield this.commonLogWithContext(e,t,Dt.log,It.PLAIN,{extraProperties:r,noCache:!0})})),this.infoWithoutCache=(e,t,r)=>Lr(this,void 0,void 0,(function*(){yield this.commonLogWithContext(e,t,Dt.info,It.PLAIN,{extraProperties:r,noCache:!0})})),this.warnWithoutCache=(e,t,r)=>Lr(this,void 0,void 0,(function*(){yield this.commonLogWithContext(e,t,Dt.warn,It.PLAIN,{extraProperties:r,noCache:!0})})),this.debugWithoutCache=(e,t,r)=>Lr(this,void 0,void 0,(function*(){yield this.commonLogWithContext(e,t,Dt.debug,It.PLAIN,{extraProperties:r,noCache:!0})})),this.errorWithoutCache=(e,t,r)=>Lr(this,void 0,void 0,(function*(){yield this.commonLogWithContext(e,t,Dt.error,It.PLAIN,{extraProperties:r,noCache:!0})})),this.getLogs=e=>{const t=this.runtimeMetaManager.logManager;return t?t.filterStore(e):new Map},this.report=(...e)=>((e,t,r={})=>function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))}(void 0,void 0,void 0,(function*(){var n,i;const a=null!==(n=r.sampleRate)&&void 0!==n?n:1;if(Math.random()>a)return;if(qt(t)>30720)throw new Error("ERROR: Laplace .report(strMsg) size bigger than 30KB is NOT allowed.");const o=Object.assign({message:Object.assign({strMsg:t},r.extraMsg),time:lr(Date.now())},r.extraData);return(null===(i=null==r?void 0:r.tags)||void 0===i?void 0:i.length)&&(o.tags=null==r?void 0:r.tags),pr([{messages:JSON.stringify(o),meta:hr}],e,r.xhrOptions)})))(this.runtimeMetaManager,...e),this.reportByHttps=(e,t)=>Lr(this,void 0,void 0,(function*(){yield this.commonReportWithContext(e,t)})),this.deleteLog=e=>Lr(this,void 0,void 0,(function*(){yield this.commonDeleteWithContext(e)})),this.deleteAll=()=>Lr(this,void 0,void 0,(function*(){yield this.resetWithContext()}));const{runtimeMetaManager:t}=e;this.runtimeMetaManager=t}}Vr.init=e=>Lr(void 0,void 0,void 0,(function*(){const{databaseName:t="laplace-default-db"}=e,r=new Pr(t),n=new or,i=new nr(Object.assign(Object.assign(Object.assign({},Nr),e),{idbManager:r,logManager:n}));sr(i,Ot.beforeInit),yield n.syncFromIDB(i.idbManager);const a=new Vr({runtimeMetaManager:i});return sr(i,Ot.afterInit),a}));class Ur extends xt{constructor(e){super(),this.config={verbose:!1},this.beforeLog=(e,t)=>{const{verbose:r}=this.config;switch(r&&console.log("beforeLog, ","state: ",t,"meta: ",e),t.logLevel){case Dt.error:console.error(t.message);break;case Dt.warn:console.warn(t.message);break;case Dt.log:console.log(t.message);break;case Dt.debug:console.debug(t.message);break;case Dt.info:console.info(t.message)}},this.afterLog=(e,t)=>{const{verbose:r}=this.config;r&&console.log("afterLog, ","state: ",t,"meta: ",e)},this.beforeReport=(e,t)=>{const{verbose:r}=this.config;r&&console.log("beforeReport, ","pluginParams: ",t,"meta: ",e)},this.afterReport=(e,t)=>{const{verbose:r}=this.config;r&&console.log("afterReport, ","pluginParams: ",t,"runtimeMetaManager: ",e)},e&&(this.config=e)}}const Fr=e=>{const t=[];for(const[r,n]of e)t.push(n);return t};class Br extends xt{constructor(e){super(),this.config={debug:!1},this.debugLog=e=>{const{debug:t}=this.config;t&&console.log(`[AutoCleanLogPlugin]: ${e}`)},this.afterInit=e=>{const{expireBefore:t}=this.config;if(!t)return void this.debugLog("early return on beforeInit because expireBefore is falsy");const{logManager:r,commonMethods:{commonDelete:n}}=e,i=r.getStore().byTime,a=("function"==typeof t?Fr(i).filter(t):Fr(i).filter((e=>e.timestamp<t))).map((e=>e.id));n(e,void 0,a),this.debugLog(`afterInit, clean log id: ${a}`)},this.afterReport=(e,{report:t,error:r})=>{if(r)return this.debugLog("error"),void console.error(r);const{cleanAfterReport:n}=this.config;if(!n)return void this.debugLog("early return on afterReport because cleanAfterReport is falsy");const{commonMethods:{commonDelete:i}}=e;i(e,void 0,t.ids),this.debugLog(`afterReport, clean log id: ${t.ids}`)},e&&(this.config=e)}}var Wr,Gr,Hr=function(){if(Gr)return Wr;Gr=1;var e="Expected a function",t=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,n=/^0b[01]+$/i,i=/^0o[0-7]+$/i,a=parseInt,o="object"==typeof U&&U&&U.Object===Object&&U,s="object"==typeof self&&self&&self.Object===Object&&self,u=o||s||Function("return this")(),c=Object.prototype.toString,d=Math.max,l=Math.min,h=function(){return u.Date.now()};function f(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function p(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==c.call(e)}(e))return NaN;if(f(e)){var o="function"==typeof e.valueOf?e.valueOf():e;e=f(o)?o+"":o}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(t,"");var s=n.test(e);return s||i.test(e)?a(e.slice(2),s?2:8):r.test(e)?NaN:+e}return Wr=function(t,r,n){var i=!0,a=!0;if("function"!=typeof t)throw new TypeError(e);return f(n)&&(i="leading"in n?!!n.leading:i,a="trailing"in n?!!n.trailing:a),function(t,r,n){var i,a,o,s,u,c,v=0,g=!1,m=!1,y=!0;if("function"!=typeof t)throw new TypeError(e);function _(e){var r=i,n=a;return i=a=void 0,v=e,s=t.apply(n,r)}function S(e){var t=e-c;return void 0===c||t>=r||t<0||m&&e-v>=o}function A(){var e=h();if(S(e))return b(e);u=setTimeout(A,function(e){var t=r-(e-c);return m?l(t,o-(e-v)):t}(e))}function b(e){return u=void 0,y&&i?_(e):(i=a=void 0,s)}function E(){var e=h(),t=S(e);if(i=arguments,a=this,c=e,t){if(void 0===u)return function(e){return v=e,u=setTimeout(A,r),g?_(e):s}(c);if(m)return u=setTimeout(A,r),_(c)}return void 0===u&&(u=setTimeout(A,r)),s}return r=p(r)||0,f(n)&&(g=!!n.leading,o=(m="maxWait"in n)?d(p(n.maxWait)||0,r):o,y="trailing"in n?!!n.trailing:y),E.cancel=function(){void 0!==u&&clearTimeout(u),v=0,i=c=a=u=void 0},E.flush=function(){return void 0===u?s:b(h())},E}(t,r,{leading:i,maxWait:r,trailing:a})}}(),jr=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(Hr);const Kr=["RESOURCE_ERROR","JS_ERROR","UNHANDLED_PROMISE_REJECTION"];class zr extends xt{constructor(e){super(),this.config={debug:!1,publicTags:[]},this.errorCount=0,this.hashErrors={},this.runtimeMetaManager=null,this.addPublicTags=e=>{var t;return null===(t=this.config.publicTags)||void 0===t?void 0:t.concat(e).filter((e=>e))},this.debugLog=e=>{const{debug:t}=this.config;t&&console.log("[AutoLogErrorPlugin]:",e)},this.ignore=e=>{var t,r,n,i,a;return void 0!==(null===(t=this.config)||void 0===t?void 0:t.maxErrorCount)&&this.errorCount>=(null===(r=this.config)||void 0===r?void 0:r.maxErrorCount)||!!(null===(n=this.config)||void 0===n?void 0:n.ignoredErrorMsgKeywords)&&e&&(null===(a=null===(i=this.config)||void 0===i?void 0:i.ignoredErrorMsgKeywords)||void 0===a?void 0:a.some((t=>null==e?void 0:e.includes(t))))},this.report=jr((()=>{if(null===this.runtimeMetaManager)return;const{autoReport:e}=this.config,{commonMethods:{commonReport:t}}=this.runtimeMetaManager;return t(this.runtimeMetaManager,Kr,e)}),600,{trailing:!0,leading:!1}),this.afterInit=e=>{if(this.runtimeMetaManager=e,!self.addEventListener)return;const{commonMethods:{commonLog:t}}=e,r=(r,n,i)=>{this.debugLog(i),this.errorCount+=1;try{return function(e){const t=(new TextEncoder).encode(e);return crypto.subtle.digest("SHA-1",t).then((e=>Array.from(new Uint8Array(e)).map((e=>e.toString(16).padStart(2,"0"))).join("")))}(r).then((i=>this.hashErrors[i]?"dismissed":(this.hashErrors[i]=!0,t(e,r,this.addPublicTags([].concat(n)),Dt.error,It.PLAIN,{extraProperties:{messageHash:i}}).then(this.report)))).catch(console.error)}catch(e){return console.error(e),Promise.resolve(e)}};try{self.addEventListener("error",(e=>{var t,n,i,a,o,s,u;if(!this.ignore(null==e?void 0:e.message)){if((null==e?void 0:e.target)&&((null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.src)||(null===(n=null==e?void 0:e.target)||void 0===n?void 0:n.href))){const t=`Load Resource Error in ${null===(i=null==e?void 0:e.target)||void 0===i?void 0:i.tagName} element: ${(null===(a=null==e?void 0:e.target)||void 0===a?void 0:a.src)||(null===(o=null==e?void 0:e.target)||void 0===o?void 0:o.href)}`;return r(t,"RESOURCE_ERROR",e)}{const t=`Javascript Runtime Error in ${null==e?void 0:e.filename} (${null==e?void 0:e.lineno}:${null==e?void 0:e.colno}): ${null==e?void 0:e.message}\nStack: ${null!==(u=null===(s=null==e?void 0:e.error)||void 0===s?void 0:s.stack)&&void 0!==u?u:null==e?void 0:e.stack}`;return r(t,"JS_ERROR",e)}}})),self.addEventListener("unhandledrejection",(e=>{var t;if(this.ignore(null===(t=null==e?void 0:e.reason)||void 0===t?void 0:t.message))return;let n;const i=null==e?void 0:e.reason;return n="string"==typeof i?`Promise Error: ${i}`:i instanceof Error?`Promise Error: ${i.message} ${i.name} ${i.stack}`:"object"==typeof i?`Promise Error with reason: ${er(i)}`:`Promise Error with unrecognized reason: ${i}`,r(n,"UNHANDLED_PROMISE_REJECTION",e)}))}catch(e){console.error(e)}this.debugLog("afterInit, add listener")},e&&(this.config=e),this.config.publicTags=[].concat(null==e?void 0:e.publicTags)}}function qr(e){return`{E}${e}{/E}`}const Yr=["exception flow","MEDIA SDK"];let Xr=function(e){return e[e.OPERATION_TIMEOUT=1]="OPERATION_TIMEOUT",e[e.INTERNAL_ERROR=2]="INTERNAL_ERROR",e[e.SESSION_FETCH_INFO_ERROR=200]="SESSION_FETCH_INFO_ERROR",e[e.SESSION_IN_ANOTHER_SESSION=3e3]="SESSION_IN_ANOTHER_SESSION",e[e.SESSION_INCORRECT_PASSCODE=3004]="SESSION_INCORRECT_PASSCODE",e[e.SESSION_NOT_STARTED=3008]="SESSION_NOT_STARTED",e[e.SESSION_USER_REMOVED=3009]="SESSION_USER_REMOVED",e[e.SESSION_ROLE_TYPE_ERROR=3010]="SESSION_ROLE_TYPE_ERROR",e[e.SESSION_WEBINAR_USER_REMOVED=3620]="SESSION_WEBINAR_USER_REMOVED",e[e.SESSION_INVALID_PARAMETER=4003]="SESSION_INVALID_PARAMETER",e[e.SESSION_ENDED=4004]="SESSION_ENDED",e[e.SESSION_LOCKED=4006]="SESSION_LOCKED",e[e.SESSION_IB_BLOCKED=4007]="SESSION_IB_BLOCKED",e[e.SESSION_PARTICIPANT_EXIST=4008]="SESSION_PARTICIPANT_EXIST",e[e.CLIENT_PLATFORM_UNSUPPORTED=5e3]="CLIENT_PLATFORM_UNSUPPORTED",e[e.CLIENT_DEPENDENT_ASSETS_INACCESSIBLE=5001]="CLIENT_DEPENDENT_ASSETS_INACCESSIBLE",e[e.CLIENT_SESSION_STATE_CLOSED=5002]="CLIENT_SESSION_STATE_CLOSED",e[e.CLIENT_SESSION_STATE_RECONNECTING=5003]="CLIENT_SESSION_STATE_RECONNECTING",e[e.CLIENT_SESSION_STATE_ON_HOLD=5004]="CLIENT_SESSION_STATE_ON_HOLD",e[e.CLIENT_SESSION_NOT_WEBINAR=5005]="CLIENT_SESSION_NOT_WEBINAR",e[e.CLIENT_HOST_OR_MANAGER_PERMISSION_REQUIRED=5006]="CLIENT_HOST_OR_MANAGER_PERMISSION_REQUIRED",e[e.CLIENT_HOST_PERMISSION_REQUIRED=5007]="CLIENT_HOST_PERMISSION_REQUIRED",e[e.CLIENT_ORIGIN_HOST_PERMISSION_REQUIRED=5008]="CLIENT_ORIGIN_HOST_PERMISSION_REQUIRED",e[e.CLIENT_ATTENDEE_APPLICABLE_ONLY=5009]="CLIENT_ATTENDEE_APPLICABLE_ONLY",e[e.CLIENT_PARTICIPANT_APPLICABLE_ONLY=5010]="CLIENT_PARTICIPANT_APPLICABLE_ONLY",e[e.CLIENT_MISMATCH_USER=5011]="CLIENT_MISMATCH_USER",e[e.CLIENT_DUPLICATED_JOIN=5012]="CLIENT_DUPLICATED_JOIN",e[e.CLIENT_INVALID_JOIN_PARAMETER=5013]="CLIENT_INVALID_JOIN_PARAMETER",e[e.CLIENT_HOST_DISALLOW_RENAME=5014]="CLIENT_HOST_DISALLOW_RENAME",e[e.STREAM_MISMATCH_DEVICE=6e3]="STREAM_MISMATCH_DEVICE",e[e.STREAM_MISMATCH_USER=6001]="STREAM_MISMATCH_USER",e[e.STREAM_SESSION_JOIN_REQUIRED=6002]="STREAM_SESSION_JOIN_REQUIRED",e[e.STREAM_MISMATCH_RENDER_ELEMENT=6003]="STREAM_MISMATCH_RENDER_ELEMENT",e[e.AUDIO_CAPTURE_FAILED=6010]="AUDIO_CAPTURE_FAILED",e[e.AUDIO_CAPTURE_LOADING=6011]="AUDIO_CAPTURE_LOADING",e[e.AUDIO_IN_PSTN=6012]="AUDIO_IN_PSTN",e[e.AUDIO_ENCODING_REQUIRED=6013]="AUDIO_ENCODING_REQUIRED",e[e.AUDIO_SHARE_AUDIO_CONFLICT=6014]="AUDIO_SHARE_AUDIO_CONFLICT",e[e.AUDIO_NOT_STARTED=6015]="AUDIO_NOT_STARTED",e[e.AUDIO_ATTENDEE_NOT_ALLOWED=6016]="AUDIO_ATTENDEE_NOT_ALLOWED",e[e.SECONDARY_AUDIO_UNSUPPORTED=6017]="SECONDARY_AUDIO_UNSUPPORTED",e[e.SECONDARY_AUDIO_DEVICE_CONFLICT=6018]="SECONDARY_AUDIO_DEVICE_CONFLICT",e[e.SECONDARY_AUDIO_SCREEN_SHARING_CONFLICT=6019]="SECONDARY_AUDIO_SCREEN_SHARING_CONFLICT",e[e.SECONDARY_AUDIO_NOT_STARTED=6020]="SECONDARY_AUDIO_NOT_STARTED",e[e.PSTN_MISMATCH_COUNTRY_CODE=6021]="PSTN_MISMATCH_COUNTRY_CODE",e[e.PSTN_NOT_CONNECTED=6022]="PSTN_NOT_CONNECTED",e[e.CRC_NOT_CONNECTED=6023]="CRC_NOT_CONNECTED",e[e.AUDIO_ALLOW_TALK_UNSUPPORTED=6024]="AUDIO_ALLOW_TALK_UNSUPPORTED",e[e.AUDIO_ALLOW_TALK_MISMATCH_USER=6025]="AUDIO_ALLOW_TALK_MISMATCH_USER",e[e.AUDIO_PROCESSOR_UNSUPPORTED=6026]="AUDIO_PROCESSOR_UNSUPPORTED",e[e.AUDIO_PROCESSOR_DUPLICATE_CREATE=6027]="AUDIO_PROCESSOR_DUPLICATE_CREATE",e[e.AUDIO_PROCESSOR_MISMATCH_PROCESSOR=6028]="AUDIO_PROCESSOR_MISMATCH_PROCESSOR",e[e.VIDEO_CAMERA_PERMISSION_DENIED=6100]="VIDEO_CAMERA_PERMISSION_DENIED",e[e.VIDEO_NO_CAMERA=6101]="VIDEO_NO_CAMERA",e[e.VIDEO_MISMATCH_CAMERA=6102]="VIDEO_MISMATCH_CAMERA",e[e.VIDEO_CAMERA_TAKEN=6103]="VIDEO_CAMERA_TAKEN",e[e.VIDEO_VB_INITIALIZE_ERROR=6104]="VIDEO_VB_INITIALIZE_ERROR",e[e.VIDEO_CAPTURE_LOADING=6105]="VIDEO_CAPTURE_LOADING",e[e.VIDEO_MUTED_BY_HOST=6106]="VIDEO_MUTED_BY_HOST",e[e.VIDEO_VB_UNSUPPORTED=6107]="VIDEO_VB_UNSUPPORTED",e[e.VIDEO_VB_PROCESSOR_CONFLICT=6108]="VIDEO_VB_PROCESSOR_CONFLICT",e[e.VIDEO_MISMATCH_STATE=6109]="VIDEO_MISMATCH_STATE",e[e.VIDEO_ESTABLISH_STREAM_ERROR=6110]="VIDEO_ESTABLISH_STREAM_ERROR",e[e.VIDEO_RENDER_LIMIT_EXCEED=6111]="VIDEO_RENDER_LIMIT_EXCEED",e[e.VIDEO_METHOD_DEPRECATED=6112]="VIDEO_METHOD_DEPRECATED",e[e.VIDEO_VB_IMAGE_INACCESSIBLE=6113]="VIDEO_VB_IMAGE_INACCESSIBLE",e[e.VIDEO_VB_MISMATCH_STATE=6114]="VIDEO_VB_MISMATCH_STATE",e[e.VIDEO_MASK_IMAGE_INACCESSIBLE=6115]="VIDEO_MASK_IMAGE_INACCESSIBLE",e[e.VIDEO_MASK_PROCESSOR_CONFLICT=6116]="VIDEO_MASK_PROCESSOR_CONFLICT",e[e.VIDEO_SPOTLIGHT_MISMATCH_STATE=6117]="VIDEO_SPOTLIGHT_MISMATCH_STATE",e[e.VIDEO_SPOTLIGHT_MULTI_CONFLICT=6118]="VIDEO_SPOTLIGHT_MULTI_CONFLICT",e[e.VIDEO_PROCESSOR_UNSUPPORTED=6119]="VIDEO_PROCESSOR_UNSUPPORTED",e[e.VIDEO_PROCESSOR_LIMIT_EXCEED=6120]="VIDEO_PROCESSOR_LIMIT_EXCEED",e[e.VIDEO_PROCESSOR_DUPLICATE_CREATE=6121]="VIDEO_PROCESSOR_DUPLICATE_CREATE",e[e.VIDEO_PROCESSOR_MISMATCH_PROCESSOR=6122]="VIDEO_PROCESSOR_MISMATCH_PROCESSOR",e[e.FAR_END_CAMERA_CONTROL_DEVICE_UNSUPPORTED=6150]="FAR_END_CAMERA_CONTROL_DEVICE_UNSUPPORTED",e[e.FAR_END_CAMERA_CONTROL_MISMATCH_STATE=6151]="FAR_END_CAMERA_CONTROL_MISMATCH_STATE",e[e.FAR_END_CAMERA_PERMISSION_REQUIRED=6152]="FAR_END_CAMERA_PERMISSION_REQUIRED",e[e.FAR_END_CAMERA_INVALID_RANGE=6153]="FAR_END_CAMERA_INVALID_RANGE",e[e.FAR_END_CAMERA_RATE_LIMIT=6154]="FAR_END_CAMERA_RATE_LIMIT",e[e.SCREEN_SHARE_USER_DENIED=6200]="SCREEN_SHARE_USER_DENIED",e[e.SCREEN_SHARE_SYSTEM_DENIED=6201]="SCREEN_SHARE_SYSTEM_DENIED",e[e.SCREEN_SHARE_UNSUPPORTED=6202]="SCREEN_SHARE_UNSUPPORTED",e[e.SCREEN_SHARE_SUBSESSION_CONFLICT=6203]="SCREEN_SHARE_SUBSESSION_CONFLICT",e[e.SCREEN_SHARE_HOST_PRIVILEGE_REQUIRED=6204]="SCREEN_SHARE_HOST_PRIVILEGE_REQUIRED",e[e.SCREEN_SHARE_MISMATCH_STATE=6205]="SCREEN_SHARE_MISMATCH_STATE",e[e.SCREEN_SHARE_OPTIMIZE_VIDEO_UNSUPPORTED=6206]="SCREEN_SHARE_OPTIMIZE_VIDEO_UNSUPPORTED",e[e.SCREEN_SHARE_OPTIMIZE_VIDEO_CONFLICT=6207]="SCREEN_SHARE_OPTIMIZE_VIDEO_CONFLICT",e[e.SCREEN_SHARE_INVALID_PRIVILEGE=6208]="SCREEN_SHARE_INVALID_PRIVILEGE",e[e.SCREEN_SHARE_IB_DENIED=6209]="SCREEN_SHARE_IB_DENIED",e[e.SCREEN_SHARE_ANNOTATION_ACCOUNT_DISABLE=6210]="SCREEN_SHARE_ANNOTATION_ACCOUNT_DISABLE",e[e.SCREEN_SHARE_ANNOTATION_NO_ACTIVE_SHARE=6211]="SCREEN_SHARE_ANNOTATION_NO_ACTIVE_SHARE",e[e.SCREEN_SHARE_ANNOTATION_PRESENTER_DISABLED=6212]="SCREEN_SHARE_ANNOTATION_PRESENTER_DISABLED",e[e.SCREEN_SHARE_ANNOTATION_DUPLICATE_START=6213]="SCREEN_SHARE_ANNOTATION_DUPLICATE_START",e[e.SCREEN_SHARE_ANNOTATION_START_ERROR=6214]="SCREEN_SHARE_ANNOTATION_START_ERROR",e[e.SCREEN_SHARE_ANNOTATION_INCORRECT_PARAMETER=6215]="SCREEN_SHARE_ANNOTATION_INCORRECT_PARAMETER",e[e.SCREEN_SHARE_ANNOTATION_NOT_SUPPORT=6216]="SCREEN_SHARE_ANNOTATION_NOT_SUPPORT",e[e.SCREEN_SHARE_ANNOTATION_NOT_START=6217]="SCREEN_SHARE_ANNOTATION_NOT_START",e[e.REMOTE_CONTROL_ACCOUNT_DISABLE=6300]="REMOTE_CONTROL_ACCOUNT_DISABLE",e[e.REMOTE_CONTROL_MISMATCH_STATE=6301]="REMOTE_CONTROL_MISMATCH_STATE",e[e.REMOTE_CONTROL_PERMISSION_REQUIRED=6302]="REMOTE_CONTROL_PERMISSION_REQUIRED",e[e.REMOTE_CONTROL_MISMATCH_DISPLAY_SURFACE=6303]="REMOTE_CONTROL_MISMATCH_DISPLAY_SURFACE",e[e.REMOTE_CONTROL_INVALID_LAUNCH_SCHEME=6304]="REMOTE_CONTROL_INVALID_LAUNCH_SCHEME",e[e.CHAT_EMPTY_MESSAGE=7e3]="CHAT_EMPTY_MESSAGE",e[e.CHAT_MISMATCH_USER=7001]="CHAT_MISMATCH_USER",e[e.CHAT_INSUFFICIENT_PRIVILEGE=7002]="CHAT_INSUFFICIENT_PRIVILEGE",e[e.CHAT_INVALID_PRIVILEGE=7003]="CHAT_INVALID_PRIVILEGE",e[e.CHAT_SUBSESSION_CONFLICT=7004]="CHAT_SUBSESSION_CONFLICT",e[e.CHAT_EMPTY_FILE=7005]="CHAT_EMPTY_FILE",e[e.CHAT_INVALID_RETRY_TOKEN=7006]="CHAT_INVALID_RETRY_TOKEN",e[e.CHAT_MISMATCH_FILE_TYPE=7007]="CHAT_MISMATCH_FILE_TYPE",e[e.CHAT_EXCEED_FILE_SIZE=7008]="CHAT_EXCEED_FILE_SIZE",e[e.CHAT_INVALID_MSG_ID_OR_URL=7009]="CHAT_INVALID_MSG_ID_OR_URL",e[e.CHAT_FILE_ACCOUNT_DISABLE=7010]="CHAT_FILE_ACCOUNT_DISABLE",e[e.CHAT_DELETE_ACCOUNT_DISABLE=7011]="CHAT_DELETE_ACCOUNT_DISABLE",e[e.CMD_EMPTY_MESSAGE=7100]="CMD_EMPTY_MESSAGE",e[e.CMD_MISMATCH_USER=7101]="CMD_MISMATCH_USER",e[e.CMD_INVALID_MESSAGE_TYPE=7102]="CMD_INVALID_MESSAGE_TYPE",e[e.CMD_EXCEED_MESSAGE_LENGTH=7103]="CMD_EXCEED_MESSAGE_LENGTH",e[e.CMD_CHANNEL_NOT_READY=7104]="CMD_CHANNEL_NOT_READY",e[e.RECORDING_ACCOUNT_DISABLE=7200]="RECORDING_ACCOUNT_DISABLE",e[e.RECORDING_STOP_FORBIDDEN=7201]="RECORDING_STOP_FORBIDDEN",e[e.RECORDING_MISMATCH_STATE=7202]="RECORDING_MISMATCH_STATE",e[e.RECORDING_ISO_DISABLE=7203]="RECORDING_ISO_DISABLE",e[e.RECORDING_IQ_DISABLE=7204]="RECORDING_IQ_DISABLE",e[e.RECORDING_IQ_PERMISSION_REQUIRED=7205]="RECORDING_IQ_PERMISSION_REQUIRED",e[e.RECORDING_IQ_MISMATCH_STATE=7206]="RECORDING_IQ_MISMATCH_STATE",e[e.LOCAL_RECORDING_ACCOUNT_DISABLE=7207]="LOCAL_RECORDING_ACCOUNT_DISABLE",e[e.LOCAL_RECORDING_INVALID_VALUE=7208]="LOCAL_RECORDING_INVALID_VALUE",e[e.LOCAL_RECORDING_MISMATCH_STATE=7209]="LOCAL_RECORDING_MISMATCH_STATE",e[e.TRANSCRIPTION_ACCOUNT_DISABLE=7300]="TRANSCRIPTION_ACCOUNT_DISABLE",e[e.TRANSCRIPTION_FEATURE_DISABLE=7301]="TRANSCRIPTION_FEATURE_DISABLE",e[e.TRANSCRIPTION_LANGUAGE_UNSUPPORTED=7302]="TRANSCRIPTION_LANGUAGE_UNSUPPORTED",e[e.TRANSCRIPTION_MISMATCH_STATE=7303]="TRANSCRIPTION_MISMATCH_STATE",e[e.TRANSLATION_ACCOUNT_DISABLE=7304]="TRANSLATION_ACCOUNT_DISABLE",e[e.TRANSLATION_LANGUAGE_UNSUPPORTED=7305]="TRANSLATION_LANGUAGE_UNSUPPORTED",e[e.MANUAL_CAPTION_ACCOUNT_DISABLE=7306]="MANUAL_CAPTION_ACCOUNT_DISABLE",e[e.MANUAL_CAPTION_FEATURE_DISABLE=7307]="MANUAL_CAPTION_FEATURE_DISABLE",e[e.MANUAL_CAPTION_MISMATCH_USER=7308]="MANUAL_CAPTION_MISMATCH_USER",e[e.MANUAL_CAPTION_INSUFFICIENT_PRIVILEGE=7309]="MANUAL_CAPTION_INSUFFICIENT_PRIVILEGE",e[e.LIVE_STREAM_ACCOUNT_DISABLE=7400]="LIVE_STREAM_ACCOUNT_DISABLE",e[e.LIVE_STREAM_INVALID_PARAMETER=7401]="LIVE_STREAM_INVALID_PARAMETER",e[e.LIVE_STREAM_MISMATCH_STATE=7402]="LIVE_STREAM_MISMATCH_STATE",e[e.SUBSESSION_ACCOUNT_DISABLE=7500]="SUBSESSION_ACCOUNT_DISABLE",e[e.SUBSESSION_EXCEED_CAPACITY=7501]="SUBSESSION_EXCEED_CAPACITY",e[e.SUBSESSION_MISMATCH_ID=7502]="SUBSESSION_MISMATCH_ID",e[e.SUBSESSION_MISMATCH_USER=7503]="SUBSESSION_MISMATCH_USER",e[e.SUBSESSION_MISMATCH_STATE=7504]="SUBSESSION_MISMATCH_STATE",e[e.SUBSESSION_EXIT_RESTRICTED=7505]="SUBSESSION_EXIT_RESTRICTED",e[e.SUBSESSION_BROADCAST_DISABLE=7506]="SUBSESSION_BROADCAST_DISABLE",e[e.SUBSESSION_BROADCAST_INVALID_CONTENT=7507]="SUBSESSION_BROADCAST_INVALID_CONTENT",e[e.SUBSESSION_BROADCAST_VOICE_DISABLE=7508]="SUBSESSION_BROADCAST_VOICE_DISABLE",e[e.SUBSESSION_BROADCAST_VOICE_RESTRICTED=7509]="SUBSESSION_BROADCAST_VOICE_RESTRICTED",e[e.SUBSESSION_BROADCAST_VOICE_MISMATCH_STATE=7510]="SUBSESSION_BROADCAST_VOICE_MISMATCH_STATE",e[e.REACTION_ACCOUNT_DISABLE=7600]="REACTION_ACCOUNT_DISABLE",e[e.REACTION_INVALID_PARAMETER=7601]="REACTION_INVALID_PARAMETER",e[e.SUMMARY_ACCOUNT_DISABLE=7700]="SUMMARY_ACCOUNT_DISABLE",e[e.QA_INVALID_PARAMETER=7800]="QA_INVALID_PARAMETER",e[e.QA_INSUFFICIENT_PRIVILEGE=7801]="QA_INSUFFICIENT_PRIVILEGE",e[e.BROADCAST_STREAMING_ACCOUNT_DISABLE=7900]="BROADCAST_STREAMING_ACCOUNT_DISABLE",e[e.BROADCAST_STREAMING_MISMATCH_STATE=7901]="BROADCAST_STREAMING_MISMATCH_STATE",e[e.BROADCAST_STREAMING_INVALID_CHANNEL_ID=7902]="BROADCAST_STREAMING_INVALID_CHANNEL_ID",e}({});const Qr={enable:!1,enableReport:!1,gatewayEndPoint:"",newGatewayEndPoint:"",logLevel:{debug:!1,log:!1,info:!1,print:!1,warn:!1,error:!1},performanceReportRatio:.25,trackingCount:7},Jr=["debug","log","info","print","warn","error"],$r=(e,t)=>[...e,...t].filter((e=>!!e));class Zr{static getInstance(){return this.agentInstance||(this.agentInstance=new Zr),this.agentInstance}constructor(){this.laplace=void 0,this.trackingId=void 0,this.logConfig=void 0,this.reportUrl=void 0,this.publicTags=void 0,this.accountId=void 0,this.disableAutoReport=void 0,this.debouncedReport=void 0,this.initConfig=async e=>{let t,r=Qr;try{e.logConfig&&(r=JSON.parse(e.logConfig),r.gatewayEndPoint&&(this.reportUrl=r.gatewayEndPoint),r.newGatewayEndPoint&&(this.reportUrl=r.newGatewayEndPoint));const{enable:n,enableReport:i,reportUrl:a,logLevel:o,encryptKeys:s,trackingId:u,accountId:c}=e;if(void 0!==n&&(r={...r,enable:!!n}),void 0!==i&&(r={...r,enableReport:!!i}),a&&(this.reportUrl=a),"string"==typeof o){const e=Jr.indexOf(o),t=Jr.reduce(((t,r,n)=>n<e?{...t,[`${r}`]:!1}:{...t,[`${r}`]:!0}),{});r={...r,logLevel:t}}else void 0!==o&&(r={...r,logLevel:o});if(u&&(this.trackingId=u,r={...r,enable:!0,enableReport:!0}),void 0!==s){const e=Array.isArray(s)?s:[s];t=await Promise.all(e.map((e=>function(e){return window.crypto.subtle.importKey("raw",(new TextEncoder).encode(e.slice(0,32)),"AES-GCM",!1,["encrypt","decrypt"])}(e).then((e=>({usage:Mt.PROTECT_LOCAL_KEY,key:e}))))))}void 0!==c&&(this.accountId=c)}catch(e){console.error("parse log config error",e)}const n=(new Date).getTime()-6048e5,i=r.enableReport&&this.reportUrl?{gzip:!1,encrypt:!1,additionalContext:{trackingId:this.trackingId}}:void 0;this.publicTags=["VideoSDK",this.trackingId],e.isUIToolkit&&this.publicTags.push("UI-Toolkit");const a=[e.debugMode&&new Ur({verbose:!1}),new Br({debug:!1,cleanAfterReport:!0,expireBefore:n}),new zr({debug:!1,autoReport:i,ignoredErrorMsgKeywords:["table index is out of bounds"],maxErrorCount:223,publicTags:this.accountId?[...this.publicTags,qr(this.accountId)]:this.publicTags})].filter(Boolean);return{laplaceConfig:{databaseName:"ZM-VSDK-LOG-DATABASE",maxSize:49283072,publicKey:e.logEncryptionPubKey,reportUrl:this.reportUrl,externalKeys:t,plugins:a},logConfig:r}},this.handleInitLaplaceSuccess=(e,t)=>{var r;this.laplace=e;const n=wt.get(Tt.VSDKLogTrackingId);let i=[];try{i=JSON.parse(n?window.atob(n):"[]")}catch(e){}i.length>=(null!==(r=null==t?void 0:t.trackingCount)&&void 0!==r?r:7)&&i.shift();const a=i.reduce(((e,t)=>({...e,[`${t}`]:!0})),{});e.deleteLog((e=>{var t;return!(null!==(t=e.tags)&&void 0!==t&&t.some((e=>a[e])))})),i.push(this.trackingId),wt.set(Tt.VSDKLogTrackingId,window.btoa(JSON.stringify(i)),kt.LocalStorage);const o=navigator.hardwareConcurrency>=4?5e3:1e4;this.debouncedReport=function(e,t=5e3){const r=[];let n;const i=function(e,t,r){var n,i,a,o,s,u,c=0,d=!1,l=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var r=n,a=i;return n=i=void 0,c=t,o=e.apply(a,r)}function p(e){var r=e-u;return void 0===u||r>=t||r<0||l&&e-c>=a}function v(){var e=ot();if(p(e))return g(e);s=setTimeout(v,function(e){var r=t-(e-u);return l?bt(r,a-(e-c)):r}(e))}function g(e){return s=void 0,h&&n?f(e):(n=i=void 0,o)}function m(){var e=ot(),r=p(e);if(n=arguments,i=this,u=e,r){if(void 0===s)return function(e){return c=e,s=setTimeout(v,t),d?f(e):o}(u);if(l)return clearTimeout(s),s=setTimeout(v,t),f(u)}return void 0===s&&(s=setTimeout(v,t)),o}return t=St(t)||0,rt(r)&&(d=!0,a=(l="maxWait"in r)?At(St(r.maxWait)||0,t):a,h="trailing"in r||h),m.cancel=function(){void 0!==s&&clearTimeout(s),c=0,n=u=i=s=void 0},m.flush=function(){return void 0===s?o:g(ot())},m}(((t,n)=>{const i=e(t,n);return r.length=0,i}),t,{leading:!0,trailing:!0,maxWait:1e4});return window.addEventListener("beforeunload",(()=>{var t;i.cancel&&i.cancel(),r.length>0&&(null!==(t=n)&&void 0!==t&&t.xhrOptions&&Object.assign(n.xhrOptions,{isSendByBeacon:!0}),e(r,n))})),(e,t)=>(Array.isArray(e)?r.push(...e):"string"==typeof e&&r.push(e),n=t,i(r,t))}(this.laplace.reportByHttps.bind(this.laplace),o)},this.init=async e=>{const{laplaceConfig:t,logConfig:r}=await this.initConfig(e);return r.enable?(this.logConfig=r,Vr.init(t).then((e=>{this.handleInitLaplaceSuccess(e,r)})).catch((e=>{throw{type:"INTERNAL_ERROR",reason:"Logger init failed.",error:e,errorCode:Xr.INTERNAL_ERROR}}))):Promise.reject({type:Et,reason:"Logger feature is not enabled."})},this.check=e=>{var t;return!(!this.checkLaplace()||(null===(t=this.logConfig)||void 0===t||null===(t=t.logLevel)||void 0===t||!t[e])&&(console.warn(`Logger ${e} is not enabled.`),1))},this.log=(e,t,r)=>{if(this.check("log"))try{var n;return null===(n=this.laplace.logWithEncryption(e,$r(t,r)))||void 0===n?void 0:n.catch((()=>{}))}catch(e){return}},this.logWithExtraProperties=(e,t,r)=>{if(this.check("log"))try{var n;return null===(n=this.laplace.log(e,t,r))||void 0===n?void 0:n.catch((()=>{}))}catch(e){return}},this.warn=(e,t,r)=>{if(this.check("warn"))try{var n;return null===(n=this.laplace.warnWithEncryption(e,$r(t,r)))||void 0===n?void 0:n.catch((()=>{}))}catch(e){return}},this.info=(e,t,r)=>{if(this.check("info"))try{var n;return null===(n=this.laplace.infoWithEncryption(e,$r(t,r)))||void 0===n?void 0:n.catch((()=>{}))}catch(e){return}},this.debug=(e,t,r)=>{if(this.check("debug"))try{var n;return null===(n=this.laplace.debugWithEncryption(e,$r(t,r)))||void 0===n?void 0:n.catch((()=>{}))}catch(e){return}},this.error=(e,t,r)=>{if(this.check("error"))try{var n;return null===(n=this.laplace.errorWithEncryption(e,$r(t,r)))||void 0===n?void 0:n.catch((()=>{}))}catch(e){return}},this.checkLaplace=()=>{var e;return!(null===(e=this.laplace)||void 0===e||!e.log)},this.makeLogger=e=>{var t;const r=$r(null!==(t=this.publicTags)&&void 0!==t?t:[],e);return{log:(e,t)=>this.log(e,r,null!=t?t:[]),logWithExtraProperties:(e,t)=>this.logWithExtraProperties(e,r,t),warn:(e,t)=>this.warn(e,r,null!=t?t:[]),info:(e,t)=>this.info(e,r,null!=t?t:[]),debug:(e,t)=>this.debug(e,r,null!=t?t:[]),error:(e,t)=>this.error(e,r,null!=t?t:[]),directReport:(e,t)=>{const r="string"!=typeof e?JSON.stringify(e):e,n=(Array.isArray(t)?t:[t]).filter(Boolean);n.push("MEDIA SDK Direct"),this.report(r,n,"info")}}},this.reportToGlobalTracing=(e,t=!1,r=!1)=>{var n;if(!this.checkLaplace())return Promise.reject({type:Et,reason:"Logger has not been enabled or initialized."});if(null===(n=this.logConfig)||void 0===n||!n.enableReport||!this.reportUrl)return Promise.reject({type:Et,reason:"Please use getLogs to obtain log data and report by yourself."});if(function(){try{return!!wt.get(Rt.DisableAutoReportLogs)}catch(e){return!1}}()&&!t)return Promise.resolve();const i=function(e){let t=!0;return e&&(t=!(Array.isArray(e)?e:[e]).some((e=>Yr.some((t=>`${e}`.indexOf(t)>-1))))),t}(e);return(t||i?this.laplace.reportByHttps.bind(this.laplace):this.debouncedReport)(e,{gzip:!1,encrypt:!1,xhrOptions:{url:this.reportUrl,isSendByBeacon:r},additionalContext:{trackingId:this.trackingId}})},this.report=(e,t,r="warn")=>{if(this.checkLaplace()&&this.logConfig.enableReport&&this.reportUrl){var n,i;const a=Array.isArray(t)?t:[t],o=this.accountId?[...a,qr(this.accountId)]:a;null===(n=(i=this.makeLogger(o))[`${r}`])||void 0===n||null===(n=n.call(i,e))||void 0===n||n.then((()=>{this.reportToGlobalTracing(a)}))}},this.getLogs=(e,t)=>{if(!this.checkLaplace())return console.warn("Logger has not been enabled or initialized."),[];const r=e.getState(),{meeting:{meetingNumber:n,userId:i,userEmail:a,userName:o}}=r,s={meetingNumber:n,userId:i,userEmail:a,userName:o},u=this.laplace.getLogs(t),c=[];for(const[,e]of u)c.push({...e,...s});return c},this.doNotUseDirtyGetStore=()=>this.checkLaplace()?this.laplace.doNotUseDirtyGetStore():(console.warn("Logger has not been enabled or initialized."),{byTag:{},byTime:new Map}),this.trackingId=tt()}}Zr.agentInstance=void 0;let en=function(e){return e.ConnectionChange="connection-change",e.VideoStatisticDataChange="video-statistic-data-change",e.AudioStatisticDataChange="audio-statistic-data-change",e.AutoPlayFailed="auto-play-audio-failed",e}({});const tn=Object.values(en).filter((e=>"string"==typeof e)),rn="LIVE_PLAYER_PING_STATUS",nn="LIVE_PLAYER_LOAD_STATUS";let an=function(e){return e[e.Video_90P=0]="Video_90P",e[e.Video_180P=1]="Video_180P",e[e.Video_360P=2]="Video_360P",e[e.Video_720P=3]="Video_720P",e[e.Video_1080P=4]="Video_1080P",e}({});function on(e,t){const r=t.match(e);return r&&r.length>0&&r[1]||""}function sn(e,t){const r=t.match(e);return r&&r.length>1&&r[2]||""}const un=/version\/(\d+(\.?_?\d+)+)/i,cn=[{test:[/opera/i],describe:e=>["Opera(Legacy)",on(un,e)||on(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e)]},{test:[/opr\/|opios/i],describe:e=>["Opera",on(/(?:opr|opios)[\s/](\S+)/i,e)||on(un,e)]},{test:[/SamsungBrowser/i],describe:e=>["Samsung Internet for Android",on(un,e)||on(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e)]},{test:[/micromessenger/i],describe:e=>["WeChat",on(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||on(un,e)]},{test:[/qqbrowser/i],describe:e=>[/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser",on(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||on(un,e)]},{test:[/msie|trident/i],describe:e=>["Internet Explorer",on(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e)]},{test:[/\sedg\//i],describe:e=>["Microsoft Edge",on(/\sedg\/(\d+(\.?_?\d+)+)/i,e)]},{test:[/edg([ea]|ios)/i],describe:e=>["Microsoft Edge(Legacy)",sn(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e)]},{test:[/firefox|iceweasel|fxios/i],describe:e=>["Firefox",on(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e)]},{test:[/electron/i],describe:e=>["Electron",on(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e)]},{test:[/chromium/i],describe:e=>["Chromium",on(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||on(un,e)]},{test:[/chrome|crios|crmo/i],describe:e=>["Chrome",on(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e)]},{test:e=>!/like android/i.test(e)&&/android/i.test(e),describe:e=>["Android Browser",on(un,e)]},{test:[/safari|applewebkit/i],describe:e=>["Safari",on(un,e)]}],dn=[{test:e=>{const t=e.match(/OpenHarmony (\d+\.?\d*)/);return(null==t?void 0:t.length)&&Number(t[1])>=5},describe:e=>["HarmonyOS",on(/OpenHarmony (\d+\.?\d*)/i,e)]},{test:[/windows /i],describe:e=>["Windows",on(/Windows ((NT|XP)( \d\d?.\d)?)/i,e)]},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:e=>["iOS",sn(/(Version\/)(\d[\d.]+)/,e)]},{test:[/macintosh/i],describe:e=>["macOS",on(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,".")]},{test:[/(ipod|iphone|ipad)/i],describe:e=>["iOS",on(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".")]},{test:e=>!/like android/i.test(e)&&/android/i.test(e),describe:e=>["Android",on(/android[\s/-](\d+(\.\d+)*)/i,e)]},{test:[/linux/i],describe:()=>["Linux"]},{test:[/CrOS/],describe:()=>["Chrome OS"]}],ln=new class{constructor(){this._browser=void 0,this._os=void 0,this._browserVersion=void 0,this._osVersion=void 0,this._clientHintsData=void 0,"userAgentData"in navigator&&navigator.userAgentData.getHighEntropyValues(["architecture","bitness","formFactor","model","platformVersion","wow64"]).then((e=>{this._clientHintsData=e,this._os&&this._osVersion&&this._clientHintsData.platform&&this._clientHintsData.platformVersion&&(this._os=this._clientHintsData.platform,this._osVersion=this._clientHintsData.platformVersion)})).catch((e=>{console.warn(e)}))}_getBrowserVersion(){var e;if(null!==(e=this._clientHintsData)&&void 0!==e&&null!==(e=e.brands)&&void 0!==e&&e.length){const e=this._clientHintsData.brands.filter((e=>!/(Chromium|Not.*Brand)/i.test(e.brand)))[0];e&&(this._browser=e.brand);const t=this._clientHintsData.brands.find((e=>{var t;return"chromium"===(null===(t=e.brand)||void 0===t?void 0:t.toLowerCase())}));t?(this._browserVersion=t.version,this._browser||(this._browser=t.brand)):this._browserVersion=e.version}else{const e=navigator.userAgent,t=cn.find((t=>"function"==typeof t.test?t.test(e):t.test.some((t=>t.test(e)))));if(t){const r=t.describe(e);this._browser=r[0],this._browserVersion=r[1],this.isIOSMobile&&(this._browser="ios-safari")}else this._browser="unknown",this._browserVersion="0"}}_getOSVersion(){var e,t;if(null!==(e=this._clientHintsData)&&void 0!==e&&e.platform&&null!==(t=this._clientHintsData)&&void 0!==t&&t.platformVersion)this._os=this._clientHintsData.platform,this._osVersion=this._clientHintsData.platformVersion;else{const e=navigator.userAgent,t=dn.find((t=>"function"==typeof t.test?t.test(e):t.test.some((t=>t.test(e)))));if(t){const r=t.describe(e);this._os=r[0],this._osVersion=r[1]}else this._os="unknown",this._osVersion="0"}}get browser(){return this._browser||this._getBrowserVersion(),this._browser}get browserVersion(){return this._browserVersion||this._getBrowserVersion(),this._browserVersion}get os(){return this._os||this._getOSVersion(),this._os}get osVersion(){return this._osVersion||this._getOSVersion(),this._osVersion}get isIE(){return"Internet Explorer"===this.browser}get isLegacyEdge(){return"Microsoft Edge(Legacy)"===this.browser}get isLegacyOpera(){return"Opera(Legacy)"===this.browser}get isFirefox(){return"Firefox"===this.browser}get isSafari(){return"Safari"===this.browser}get isChrome(){var e,t;if(null!==(e=this._clientHintsData)&&void 0!==e&&null!==(e=e.brands)&&void 0!==e&&e.length)return null===(t=this._clientHintsData)||void 0===t?void 0:t.brands.some((e=>{var t;return"chromium"===(null===(t=e.brand)||void 0===t?void 0:t.toLocaleLowerCase())}));const{userAgent:r}=navigator;return!this.isLegacyOpera&&!this.isLegacyEdge&&/chrome/i.test(r)&&/webkit/i.test(r)}get isLegacyChrome(){var e;return this.isChrome&&"function"!=typeof(null===(e=navigator.mediaDevices)||void 0===e?void 0:e.getDisplayMedia)}get isMacOS(){return"macOS"===this.os}get isIPad(){var e;return/iPad/i.test(navigator.userAgent)||this.isMacOS&&(null===(e=navigator)||void 0===e?void 0:e.maxTouchPoints)>2}get isHarmonyOS(){return"HarmonyOS"===this.os}get isIOSMobile(){return"iOS"===this.os||this.isIPad}get architecture(){var e,t;return null!==(e=null===(t=this._clientHintsData)||void 0===t?void 0:t.architecture)&&void 0!==e?e:""}get isArm(){return this.architecture?"arm"===this.architecture:/arm/i.test(navigator.userAgent)}get isChromeOS(){return"Chrome OS"===this.os}get isAndroidBrowser(){var e;return"android"===(null===(e=this.os)||void 0===e?void 0:e.toLowerCase())}get isArmChromeOS(){return this.isArm&&this.isChromeOS}get isAndroidOrIOSBrowser(){return this.isAndroidBrowser||this.isIOSMobile}get isSupportEssentialAudioAndVideoAbility(){return"object"==typeof WebAssembly&&"function"==typeof Worker}get isSupportAudioWorklet(){return"function"==typeof AudioWorklet}get isSupportImageCapture(){return"ImageCapture"in window}get isSupportMediaStreamTrackProcessor(){return"MediaStreamTrackProcessor"in window}get isSupportOffscreenCanvas(){var e;return null===(e=window.JsMediaSDK_Instance)||void 0===e||null===(e=e.util)||void 0===e?void 0:e.isSupportOffscreenCanvas()}get gpu(){var e;return this.isSupportOffscreenCanvas?null===(e=window.JsMediaSDK_Instance)||void 0===e||null===(e=e.util)||void 0===e||null===(e=e.getGpuInfo())||void 0===e?void 0:e.renderInfo:""}get bitness(){var e,t;return null!==(e=null===(t=this._clientHintsData)||void 0===t?void 0:t.bitness)&&void 0!==e?e:""}get model(){var e,t;return null!==(e=null===(t=this._clientHintsData)||void 0===t?void 0:t.model)&&void 0!==e?e:""}get wow64(){var e;if("windows"===this.os.toLowerCase())return null===(e=this._clientHintsData)||void 0===e?void 0:e.wow64}get isSupportSendScreenSharing(){return"getDisplayMedia"in navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getDisplayMedia}get isSupportSharedArrayBuffer(){return"function"==typeof SharedArrayBuffer}};var hn=function(e){return e.ConnectionChange="connection-change",e.OnHoldChange="on-hold-change",e.UserAdd="user-added",e.UserUpdate="user-updated",e.UserRemove="user-removed",e.AttendeeUpdate="attendee-updated",e.MeetingAttributeUpdate="meeting-attribute-updated",e.PromoteAttendeeConsent="promote-attendee-consent",e.ActiveAppsUpdate="active-apps-updated",e.SharePronounTypeUpdate="share-pronoun-type-update",e}(hn||{});hn.ConnectionChange,hn.OnHoldChange,hn.UserAdd,hn.UserUpdate,hn.UserRemove,hn.AttendeeUpdate,hn.MeetingAttributeUpdate,hn.PromoteAttendeeConsent,hn.ActiveAppsUpdate,hn.SharePronounTypeUpdate;let fn=function(e){return e[e.Stop=0]="Stop",e[e.Start=1]="Start",e[e.Pause=2]="Pause",e}({});const pn=(()=>{const e=new ArrayBuffer(684),t=new Uint32Array(e);return t.set([1179011410,676,1163280727,544501094,16,65539,16e3,64e3,2097156,1635017060,640],0),new Blob([t],{type:"audio/wav"})})();let vn=function(e){return e.Computer="computer",e.Phone="phone",e}({});var gn=function(e){return e.StatusUpdate="archiving-status-update",e.OptionsUpdate="archiving-options-update",e}(gn||{});gn.StatusUpdate,gn.OptionsUpdate,H(),new Array;var mn="NOT_FOUND",yn=function(e,t){return e===t},_n=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var a,o=0,s={memoizeOptions:void 0},u=n.pop();if("object"==typeof u&&(s=u,u=n.pop()),"function"!=typeof u)throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof u+"]");var c=s.memoizeOptions,d=void 0===c?r:c,l=Array.isArray(d)?d:[d],h=function(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every((function(e){return"function"==typeof e}))){var r=t.map((function(e){return"function"==typeof e?"function "+(e.name||"unnamed")+"()":typeof e})).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+r+"]")}return t}(n),f=e.apply(void 0,[function(){return o++,u.apply(null,arguments)}].concat(l)),p=e((function(){for(var e=[],t=h.length,r=0;r<t;r++)e.push(h[r].apply(null,arguments));return a=f.apply(null,e)}));return Object.assign(p,{resultFunc:u,memoizedResultFunc:f,dependencies:h,lastResult:function(){return a},recomputations:function(){return o},resetRecomputations:function(){return o=0}}),p}}((function(e,t){var r,n,i="object"==typeof t?t:{equalityCheck:t},a=i.equalityCheck,o=void 0===a?yn:a,s=i.maxSize,u=void 0===s?1:s,c=i.resultEqualityCheck,d=function(e){return function(t,r){if(null===t||null===r||t.length!==r.length)return!1;for(var n=t.length,i=0;i<n;i++)if(!e(t[i],r[i]))return!1;return!0}}(o),l=1===u?(r=d,{get:function(e){return n&&r(n.key,e)?n.value:mn},put:function(e,t){n={key:e,value:t}},getEntries:function(){return n?[n]:[]},clear:function(){n=void 0}}):function(e,t){var r=[];function n(e){var n=r.findIndex((function(r){return t(e,r.key)}));if(n>-1){var i=r[n];return n>0&&(r.splice(n,1),r.unshift(i)),i.value}return mn}return{get:n,put:function(t,i){n(t)===mn&&(r.unshift({key:t,value:i}),r.length>e&&r.pop())},getEntries:function(){return r},clear:function(){r=[]}}}(u,d);function h(){var t=l.get(arguments);if(t===mn){if(t=e.apply(null,arguments),c){var r=l.getEntries().find((function(e){return c(e.value,t)}));r&&(t=r.value)}l.put(arguments,t)}return t}return h.clearCache=function(){return l.clear()},h}));const Sn=({participants:{attendeesList:e}})=>e,An=({participants:{xmppAttendeeList:e}})=>e;let bn=function(e){return e[e.Host=10]="Host",e[e.Panelist=20]="Panelist",e[e.Attendee=30]="Attendee",e}({}),En=function(e){return e[e.Client=9]="Client",e[e.Phone=5]="Phone",e[e.H323=15]="H323",e[e.Assitant=51]="Assitant",e}({}),kn=function(e){return e[e.NotStarted=1]="NotStarted",e[e.InProgress=2]="InProgress",e[e.Closing=3]="Closing",e[e.Closed=4]="Closed",e}({}),Cn=function(e){return e.Initial="initial",e.Invited="invited",e.Joining="joining",e.InRoom="in room",e.Leaving="leaving",e.TimeUp="time up",e.MainSession="main session",e}({});const wn=({breakoutRoom:e})=>e&&e.controlStatus,Tn=({breakoutRoom:e})=>e&&e.currentRoom.status,Rn=_n([({meeting:{userId:e}})=>e,Sn],((e,t)=>t.find((t=>t.userId===e))));_n([Rn],(e=>(null==e?void 0:e.isHost)||(null==e?void 0:e.bCoHost)));const In=_n([Rn],(e=>null==e?void 0:e.isHost));_n([An],(e=>e.filter((e=>e.userRole===bn.Attendee)))),_n([Sn],(e=>e.filter((e=>e.bHold&&!e.bid))));const Dn=_n([Sn,wn,Tn],((e,t,r)=>t!==kn.InProgress&&t!==kn.Closing||r!==Cn.InRoom?e.filter((e=>!e.bHold&&!e.bid)):e.filter((e=>!e.bHold))));var Mn;_n([({participants:{assistantList:e}})=>e],(e=>e)),_n([Dn],(e=>e.find((e=>e.isHost)))),_n([Dn],(e=>e.filter((e=>e.bCoHost)))),_n([Rn,Dn],((e,t)=>t.filter((t=>t.userId!==(null==e?void 0:e.userId))))),_n([An],(e=>e.reduce(((e,t)=>{const{jid:r}=t;return Object.assign(e,{[r]:t}),e}),{}))),_n([An,({meeting:{jid:e}})=>e],((e,t)=>{var r;return null===(r=e.find((e=>e.jid===t)))||void 0===r?void 0:r.userId})),_n([Sn],((e=[])=>e.some((e=>(null==e?void 0:e.bLocalRecord)===fn.Start)))),_n([wn,({meeting:e})=>e&&e.meetingOptions,Sn,In],((e,t,r,n)=>{const i=r.filter((e=>e.bCoHost)),{moveToWRIfHostLeave:a}=t,o=e===kn.InProgress;return n&&!!a&&i.length<=0&&!o&&r.length>1})),_n([Sn,Tn,({breakoutRoom:e})=>e&&e.mainSessionAttendeeList],((e,t,r)=>(t===Cn.InRoom?r:e).filter((e=>{return!(e.bHold||e.isHost||e.audio===vn.Phone||(n=null==e?void 0:e.userType,(n&En.Phone)===En.Phone)||(t=null==e?void 0:e.caps,r=null==e?void 0:e.bMultiStreamVideoUser,((e,t)=>(e=>!!(128&e))(e)&&void 0!==t)(t,r)&&r));var t,r,n}))));const On=Zr.getInstance();var xn=u("instance"),Pn=u("dependentAssets"),Ln=u("alternativeNameForLiveVideo"),Nn=u("webEndpoint"),Vn=u("watermark"),Un=u("isPlayerInitialized"),Fn=u("eventCallbacks"),Bn=u("attachmentMap"),Wn=u("emitter"),Gn=u("initEventListeners"),Hn=u("handlePlayerInitializeEvents");class jn{constructor(){Object.defineProperty(this,Hn,{value:zn}),Object.defineProperty(this,Gn,{value:Kn}),Object.defineProperty(this,Pn,{writable:!0,value:void 0}),Object.defineProperty(this,Ln,{writable:!0,value:void 0}),Object.defineProperty(this,Nn,{writable:!0,value:void 0}),Object.defineProperty(this,Vn,{writable:!0,value:void 0}),Object.defineProperty(this,Un,{writable:!0,value:!1}),Object.defineProperty(this,Fn,{writable:!0,value:new Map}),Object.defineProperty(this,Bn,{writable:!0,value:new Map}),Object.defineProperty(this,Wn,{writable:!0,value:void 0}),o(this,Wn)[Wn]=H()}static createClient(e){return o(this,xn)[xn]||(o(this,xn)[xn]=new jn),e&&(o(o(this,xn)[xn],Pn)[Pn]=e.dependentAssets||"Global",o(o(this,xn)[xn],Ln)[Ln]=e.alternativeNameForLiveVideo||"live-video",o(o(this,xn)[xn],Nn)[Nn]=e.webEndpoint||"zoom.us",e.watermark&&(o(o(this,xn)[xn],Vn)[Vn]=e.watermark)),o(jn,xn)[xn]}static destroyClient(){if(o(this,xn)[xn]){const e=o(o(this,xn)[xn],Bn)[Bn];if(e.size>0)for(const[t,r]of e.entries())r.forEach((e=>{e.setAttribute("live-session-id","")})),e.delete(t);wt.clearSession(),G.Player.destroy(),o(this,xn)[xn]=void 0}}async attachStreaming(e,t,r,n){const i=`https://${o(this,Nn)[Nn]}/live/playback?${new URLSearchParams({channelId:e}).toString()}`,{cloudInfoList:a,virtualZonePathTokenList:s,logConfig:u}=await(c=Ge({url:i,method:"GET",headers:{zlk:t},crossDomain:V(i)}).pipe(we((e=>{const{status:t,errorCode:r,errorMessage:n,result:i}=e.response;if(t&&0===r&&i)return i;throw new Error(`Failed to fetch the channel info: ${n}`)}))),new Promise((function(e,t){var r,n=!1;c.subscribe({next:function(e){r=e,n=!0},error:t,complete:function(){n?e(r):t(new Ce)}})})));var c;if(o(this,Un)[Un])G.Player.addPlaybckToken(a.map((e=>e.playbackTokens)));else{wt.init(e);try{const t=JSON.parse(u);null!=t&&t.gatewayEndPoint&&On.init({enable:!0,enableReport:!0,reportUrl:t.gatewayEndPoint,logLevel:t.logLevel,trackingId:e})}catch(e){}G.Player.init({zcList:a,virtualZoneList:s,baseResPath:`${o(this,Pn)[Pn]}`,zIndex:2,tid:e,tagName:o(this,Ln)[Ln],logAgent:On.makeLogger(["Broadcast Streaming Viewer","Live Player"]),udpRetryPolicy:{retryCount:2,retryTimeout:2e3,retryInterval:0}}),o(this,Vn)[Vn]?G.Player.setWatermark({enable:!0,...o(this,Vn)[Vn]}):G.Player.setWatermark({enable:!1}),o(this,Gn)[Gn]()}await o(this,Hn)[Hn]();const d=o(this,Ln)[Ln];let l;if(n){if("string"==typeof n){if(l=document.querySelector(n),!l)return Promise.reject({type:"INVALID_PARAMETERS",reason:"Cannot find the element"})}else l=n;if(l.tagName.toUpperCase()!==d.toUpperCase())return Promise.reject({type:"INVALID_PARAMETERS",reason:"Invalid element type"})}else l=document.createElement(d);const h=o(this,Bn)[Bn].get(e)||[];-1!==(null==h?void 0:h.findIndex((e=>e===l)))?l.setAttribute("size",`${r}`):(l.setAttribute("live-session-id",e),l.setAttribute("size",`${r}`),h.push(l),o(this,Bn)[Bn].set(e,h));try{await function(){const e=URL.createObjectURL(pn),t=new Audio(e);t.muted=!1;const r=(n=()=>Promise.reject(),new Promise((e=>{setTimeout((()=>{e(n())}),3e3)})));var n;const i=ln.isIOSMobile?new Promise(((e,r)=>{var n;t.addEventListener("canplaythrough",(()=>{t.play().then((()=>{e(!0)})).catch((e=>{r(e)}))})),null===(n=t.load)||void 0===n||n.call(t)})):t.play();return Promise.race([i,r]).finally((()=>{URL.revokeObjectURL(e)}))}(),l.setAttribute("muted","false"),l.setAttribute("volume","0.8")}catch(e){var f;null===(f=o(this,Fn)[Fn].get(en.AutoPlayFailed))||void 0===f||f.forEach((e=>{e("")}))}return l}async detachStreaming(e,t){if(!o(this,Bn)[Bn].has(e))return;const r=o(this,Bn)[Bn].get(e);let n;if(r){const a=o(this,Ln)[Ln];let s;var i;if(t&&(s="string"==typeof t?document.querySelector(t):t,(null===(i=s)||void 0===i?void 0:i.tagName.toUpperCase())!==a.toUpperCase()&&(s=null)),s){const t=r.indexOf(s);-1!==t&&(s.setAttribute("live-session-id",""),r.splice(t,1),n=s,o(this,Bn)[Bn].set(e,r))}else n=[...r],r.forEach((e=>{e.setAttribute("live-session-id","")})),o(this,Bn)[Bn].delete(e)}return n}on(e,t){if(tn.includes(e)){const r=o(this,Fn)[Fn].get(e);r?(r.push(t),o(this,Fn)[Fn].set(e,r)):o(this,Fn)[Fn].set(e,[t])}}off(e,t){if(tn.includes(e)){const r=o(this,Fn)[Fn].get(e);if(r){const n=r.indexOf(t);-1!==n&&(r.splice(n,1),o(this,Fn)[Fn].set(e,r))}}}}function Kn(){G.Player.on("ping-success",(()=>{o(this,Wn)[Wn].emit(rn,!0),On.report("Player ping success",["Broadcast Streaming Viewer"],"info")})),G.Player.on("player-error",(({code:e,reason:t})=>{o(this,Wn)[Wn].emit(rn,!1),On.report(`Player error: ${e}, reason: ${t}`,["Broadcast Streaming Viewer"],"error")})),G.Player.on("load-failure",(()=>{o(this,Wn)[Wn].emit(nn,!0),On.report("Player load js and wasm failure",["Broadcast Streaming Viewer"],"error")})),G.Player.on("load-success",(()=>{o(this,Wn)[Wn].emit(nn,!0)})),G.Player.on("audio-analytics",(e=>{var t;null===(t=o(this,Fn)[Fn].get(en.AudioStatisticDataChange))||void 0===t||t.forEach((t=>{t(e)}))})),G.Player.on("video-analytics",(e=>{var t;null===(t=o(this,Fn)[Fn].get(en.VideoStatisticDataChange))||void 0===t||t.forEach((t=>{t(e)}))})),G.Player.on("bad-quality",(e=>{On.report(`Player bad quality,type: ${e}`,["Broadcast Streaming Viewer"],"warn")})),G.Player.on("user-cid",(e=>{const{browser:t,browserVersion:r,os:n,osVersion:i,gpu:a,architecture:s,model:u,bitness:c,isSupportSharedArrayBuffer:d,isSupportOffscreenCanvas:l}=ln;On.report(JSON.stringify({cid:e,browserVersion:`${t} ${r}`,osVersion:`${n} ${i}`,gpu:a,architecture:s,model:u,bitness:c,livePlayerVersion:G.Player.getBuildVersion(),sdkVersion:Mn.VERSION,sharedArrayBuffer:d,offscreenCanvas:l,dependentAssets:o(this,Pn)[Pn]}),["Broadcast Streaming Viewer","bsv_info_map"],"info")})),G.Player.on("connection-type",(e=>{On.report(`Player connection type: ${e}`,["Broadcast Streaming Viewer"],"info")}))}function zn(){void 0===Promise.withResolvers&&(Promise.withResolvers=()=>{let e,t;return{promise:new Promise(((r,n)=>{e=r,t=n})),resolve:e,reject:t}});const{promise:e,resolve:t,reject:r}=Promise.withResolvers();return Oe(o(this,Wn)[Wn],rn).pipe(Pe(1),Re((e=>{if(e)return Oe(o(this,Wn)[Wn],nn).pipe(Pe(1));throw new Error("Ping error")}))).subscribe({next:e=>{var n;let i="";e?(o(this,Un)[Un]=!0,i="Connected",t(i)):r("Fail to connect the server"),null===(n=o(this,Fn)[Fn].get(en.ConnectionChange))||void 0===n||n.forEach((e=>{e({state:i})}))},error:()=>{var e;null===(e=o(this,Fn)[Fn].get(en.ConnectionChange))||void 0===e||e.forEach((e=>{e({state:"Fail"})})),r("Fail to connect the server")}}),e}Mn=jn,Object.defineProperty(jn,xn,{writable:!0,value:void 0}),jn.VERSION="";const qn="2.2.5",Yn="https://dmogdx0jrul3u.cloudfront.net/videosdk/".concat(qn,"/lib"),Xn="https://source.zoom.us/videosdk/".concat(qn,"/lib"),Qn="https://jssdk.zoomus.cn/videosdk/".concat(qn,"/lib");[...["userId","avatar","displayName","isHost","audio","muted","bVideoOn","sharerOn","sharerPause","userIdentity","isSpeakerOnly","bVideoShare","bShareAudioOn","userGuid","isPhoneUser","isInFailover",{from:"isCoHost",to:"isManager"},{from:"bAllowISORecord",to:"isAllowIndividualRecording"},{from:"bVideoConnect",to:"isVideoConnect"},{from:"bShareToBORooms",to:"bShareToSubsession"},{from:"bid",to:"subsessionId"},{from:"phoneNumber",to:e=>void 0===e?{}:{phoneNumber:e}}],{from:"userGUID",to:"userGuid"},{from:"bCoHost",to:e=>({isManager:!!e})},{from:"userType",to:e=>({isPhoneUser:!(5&~e)})},{from:"bid",to:e=>e?{subsessionId:e}:{}},{from:"bInFailover",to:"isInFailover"}].map((e=>"string"==typeof e?e:e.from));var Jn=r("streamingClient");class $n{static createClient(t){if(!e(this,Jn)[Jn]){var r;jn.VERSION=qn;const n=(e=>{let t="";switch(e){case"Global":t=Xn;break;case"CN":t=Qn;break;case"CDN":t=Yn;break;default:t=e}return t})(null!==(r=null==t?void 0:t.dependentAssets)&&void 0!==r?r:"Global"),i=a(a({},null!=t?t:{}),{},{dependentAssets:n});e(this,Jn)[Jn]=jn.createClient(i)}return e(this,Jn)[Jn]}static destroyClient(){e(this,Jn)[Jn]&&(jn.destroyClient(),e(this,Jn)[Jn]=null)}}Object.defineProperty($n,Jn,{writable:!0,value:void 0}),$n.VERSION=qn;export{an as VideoQuality,$n as default};
