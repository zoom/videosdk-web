/*! For license information please see annoter.min.js.LICENSE.txt */
"use strict";(self.webpackChunkJsMediaSDK_Instance=self.webpackChunkJsMediaSDK_Instance||[]).push([[208],{1822:(t,e,s)=>{s.r(e),s.d(e,{AnnotationMgr:()=>_a});var i=Object.defineProperty,r=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,l=(t,e,s)=>e in t?i(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,c=(t,e)=>{for(var s in e||(e={}))o.call(e,s)&&l(t,s,e[s]);if(a)for(var s of a(e))h.call(e,s)&&l(t,s,e[s]);return t},d=(t,e)=>r(t,n(e)),u=(t,e)=>{var s={};for(var i in t)o.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(null!=t&&a)for(var i of a(t))e.indexOf(i)<0&&h.call(t,i)&&(s[i]=t[i]);return s},p=(t,e,s)=>l(t,"symbol"!=typeof e?e+"":e,s),g=(t=>(t[t.ANNO_TOOL_TYPE_NONE=0]="ANNO_TOOL_TYPE_NONE",t[t.ANNO_TOOL_TYPE_PEN=1]="ANNO_TOOL_TYPE_PEN",t[t.ANNO_TOOL_TYPE_HIGHLIGHTER=2]="ANNO_TOOL_TYPE_HIGHLIGHTER",t[t.ANNO_TOOL_TYPE_SPOTLIGHT=3]="ANNO_TOOL_TYPE_SPOTLIGHT",t[t.ANNO_TOOL_TYPE_ARROW=4]="ANNO_TOOL_TYPE_ARROW",t[t.ANNO_TOOL_TYPE_TEXTBOX=5]="ANNO_TOOL_TYPE_TEXTBOX",t[t.ANNO_TOOL_TYPE_PICTURE=6]="ANNO_TOOL_TYPE_PICTURE",t[t.ANNO_TOOL_TYPE_ERASER=7]="ANNO_TOOL_TYPE_ERASER",t[t.ANNO_TOOL_TYPE_BRUSH_ERASER=8]="ANNO_TOOL_TYPE_BRUSH_ERASER",t[t.ANNO_TOOL_TYPE_PICKER=9]="ANNO_TOOL_TYPE_PICKER",t[t.ANNO_TOOL_TYPE_SELECTOR=10]="ANNO_TOOL_TYPE_SELECTOR",t[t.ANNO_TOOL_TYPE_AUTO_LINE=11]="ANNO_TOOL_TYPE_AUTO_LINE",t[t.ANNO_TOOL_TYPE_AUTO_ARROW1=12]="ANNO_TOOL_TYPE_AUTO_ARROW1",t[t.ANNO_TOOL_TYPE_AUTO_ARROW2=13]="ANNO_TOOL_TYPE_AUTO_ARROW2",t[t.ANNO_TOOL_TYPE_AUTO_RECTANGLE=14]="ANNO_TOOL_TYPE_AUTO_RECTANGLE",t[t.ANNO_TOOL_TYPE_AUTO_RECTANGLE_SEMI_FILL=15]="ANNO_TOOL_TYPE_AUTO_RECTANGLE_SEMI_FILL",t[t.ANNO_TOOL_TYPE_AUTO_ROUNDEDRECTANGLE=16]="ANNO_TOOL_TYPE_AUTO_ROUNDEDRECTANGLE",t[t.ANNO_TOOL_TYPE_AUTO_ROUNDEDRECTANGLE_SEMI_FILL=17]="ANNO_TOOL_TYPE_AUTO_ROUNDEDRECTANGLE_SEMI_FILL",t[t.ANNO_TOOL_TYPE_AUTO_ELLIPSE=18]="ANNO_TOOL_TYPE_AUTO_ELLIPSE",t[t.ANNO_TOOL_TYPE_AUTO_ELLIPSE_SEMI_FILL=19]="ANNO_TOOL_TYPE_AUTO_ELLIPSE_SEMI_FILL",t[t.ANNO_TOOL_TYPE_AUTO_DOUBLE_ARROW=20]="ANNO_TOOL_TYPE_AUTO_DOUBLE_ARROW",t[t.ANNO_TOOL_TYPE_AUTO_RECTANGLE_FILL=21]="ANNO_TOOL_TYPE_AUTO_RECTANGLE_FILL",t[t.ANNO_TOOL_TYPE_AUTO_ROUNDEDRECTANGLE_FILL=22]="ANNO_TOOL_TYPE_AUTO_ROUNDEDRECTANGLE_FILL",t[t.ANNO_TOOL_TYPE_AUTO_ELLIPSE_FILL=23]="ANNO_TOOL_TYPE_AUTO_ELLIPSE_FILL",t[t.ANNO_TOOL_TYPE_AUTO_DIAMOND=24]="ANNO_TOOL_TYPE_AUTO_DIAMOND",t[t.ANNO_TOOL_TYPE_AUTO_STAMP_ARROW=25]="ANNO_TOOL_TYPE_AUTO_STAMP_ARROW",t[t.ANNO_TOOL_TYPE_AUTO_STAMP_CHECK=26]="ANNO_TOOL_TYPE_AUTO_STAMP_CHECK",t[t.ANNO_TOOL_TYPE_AUTO_STAMP_X=27]="ANNO_TOOL_TYPE_AUTO_STAMP_X",t[t.ANNO_TOOL_TYPE_MULTI_FLAT_PEN=28]="ANNO_TOOL_TYPE_MULTI_FLAT_PEN",t[t.ANNO_TOOL_TYPE_MULTI_FLAT_ERASER=29]="ANNO_TOOL_TYPE_MULTI_FLAT_ERASER",t[t.ANNO_TOOL_TYPE_MULTI_THICKNESS_PEN=30]="ANNO_TOOL_TYPE_MULTI_THICKNESS_PEN",t[t.ANNO_TOOL_TYPE_AUTO_STAMP_STAR=31]="ANNO_TOOL_TYPE_AUTO_STAMP_STAR",t[t.ANNO_TOOL_TYPE_AUTO_STAMP_HEART=32]="ANNO_TOOL_TYPE_AUTO_STAMP_HEART",t[t.ANNO_TOOL_TYPE_AUTO_STAMP_QM=33]="ANNO_TOOL_TYPE_AUTO_STAMP_QM",t[t.ANNO_TOOL_TYPE_MULTI_SHAPE_DETECTOR=34]="ANNO_TOOL_TYPE_MULTI_SHAPE_DETECTOR",t[t.ANNO_TOOL_TYPE_MULTI_TEXT_DETECTOR=35]="ANNO_TOOL_TYPE_MULTI_TEXT_DETECTOR",t[t.ANNO_TOOL_TYPE_FADE_PEN=36]="ANNO_TOOL_TYPE_FADE_PEN",t[t.ANNO_TOOL_TYPE_AUTO_DIAMOND_SEMI_FILL=37]="ANNO_TOOL_TYPE_AUTO_DIAMOND_SEMI_FILL",t[t.ANNO_TOOL_TYPE_AUTO_DIAMOND_FILL=38]="ANNO_TOOL_TYPE_AUTO_DIAMOND_FILL",t))(g||{});const f=[1,2,36],_=[11,12,20],O=[14,15,21,24,37,38,18,19,23],m=[26,25,32,33,31,27];function v(t,e){var s=t.charCodeAt(e);if(isNaN(s))return"";if(s<55296||s>57343)return t.charAt(e);if(55296<=s&&s<=56319){if(t.length<=e+1)throw"High surrogate without following low surrogate";var i=t.charCodeAt(e+1);if(56320>i||i>57343)throw"High surrogate without following low surrogate";return t.charAt(e)+t.charAt(e+1)}if(0===e)throw"Low surrogate without preceding high surrogate";var r=t.charCodeAt(e-1);if(55296>r||r>56319)throw"Low surrogate without preceding high surrogate";return!1}const b={camelize:function(t){return t.replace(/-+(.)?/g,(function(t,e){return e?e.toUpperCase():""}))},capitalize:function(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())},escapeXml:function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(t){var e,s=0,i=[];for(s=0;s<t.length;s++)!1!==(e=v(t,s))&&i.push(e);return i}};var y=(t=>(t.Group="Group",t.Image="Image",t.ActiveSelection="ActiveSelection",t.Gradient="Gradient",t))(y||{});const A=new class{constructor(){p(this,"shapeMap",new Map),p(this,"parserMap",new Map)}add(t,e){this.shapeMap.set(t,e)}has(t){return this.shapeMap.has(t)}get(t){return this.shapeMap.get(t)}getByObjType(t){const e=b.camelize(t.charAt(0).toUpperCase()+t.slice(1));return this.shapeMap.get(e)}addSVGParser(t,e){this.parserMap.set(t,e)}hasSVGParser(t){return this.parserMap.has(t)}getSVGParser(t){return this.parserMap.get(t)}};var T=Array.prototype.slice;function S(t,e,s){if(t&&0!==t.length){var i=t.length-1,r=e?t[i][e]:t[i];if(e)for(;i--;)s(t[i][e],r)&&(r=t[i][e]);else for(;i--;)s(t[i],r)&&(r=t[i]);return r}}const w={fill:function(t,e){for(var s=t.length;s--;)t[s]=e;return t},invoke:function(t,e){for(var s=T.call(arguments,2),i=[],r=0,n=t.length;r<n;r++)i[r]=s.length?t[r][e].apply(t[r],s):t[r][e].call(t[r]);return i},min:function(t,e){return S(t,e,(function(t,e){return t<e}))},max:function(t,e){return S(t,e,(function(t,e){return t>=e}))}};function x(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t}const I=class t{constructor(t){p(this,"_source"),t?this._tryParsingColor(t):this.setSource([0,0,0,1])}static fromHsla(e){return t.fromHsl(e)}static fromHex(e){return t.fromSource(t.sourceFromHex(e))}_tryParsingColor(e){var s;e in t.colorNameMap&&(e=t.colorNameMap[e]),"transparent"===e&&(s=[255,255,255,0]),s||(s=t.sourceFromHex(e)),s||(s=t.sourceFromRgb(e)),s||(s=t.sourceFromHsl(e)),s||(s=[0,0,0,1]),s&&this.setSource(s)}_rgbToHsl(t,e,s){var i,r,n,a=w.max([t/=255,e/=255,s/=255]),o=w.min([t,e,s]);if(n=(a+o)/2,a===o)i=r=0;else{var h=a-o;switch(r=n>.5?h/(2-a-o):h/(a+o),a){case t:i=(e-s)/h+(e<s?6:0);break;case e:i=(s-t)/h+2;break;case s:i=(t-e)/h+4}i/=6}return[Math.round(360*i),Math.round(100*r),Math.round(100*n)]}getSource(){return this._source}setSource(t){this._source=t}toRgb(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"}toRgba(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"}toHsl(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"}toHsla(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+t[3]+")"}toHex(){var t,e,s,i=this.getSource();return t=1===(t=i[0].toString(16)).length?"0"+t:t,e=1===(e=i[1].toString(16)).length?"0"+e:e,s=1===(s=i[2].toString(16)).length?"0"+s:s,t.toUpperCase()+e.toUpperCase()+s.toUpperCase()}toHexa(){var t,e=this.getSource();return t=1===(t=(t=Math.round(255*e[3])).toString(16)).length?"0"+t:t,this.toHex()+t.toUpperCase()}getAlpha(){return this.getSource()[3]}setAlpha(t){var e=this.getSource();return e[3]=t,this.setSource(e),this}toGrayscale(){var t=this.getSource(),e=parseInt((.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),10),s=t[3];return this.setSource([e,e,e,s]),this}toBlackWhite(t){var e=this.getSource(),s=(.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),i=e[3];return t=t||127,s=Number(s)<Number(t)?0:255,this.setSource([s,s,s,i]),this}overlayWith(e){e instanceof t||(e=new t(e));var s,i=[],r=this.getAlpha(),n=this.getSource(),a=e.getSource();for(s=0;s<3;s++)i.push(Math.round(.5*n[s]+.5*a[s]));return i[3]=r,this.setSource(i),this}};p(I,"reRGBa",/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i),p(I,"reHSLa",/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i),p(I,"reHex",/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i),p(I,"colorNameMap",{aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"}),p(I,"fromRgb",(function(t){return I.fromSource(I.sourceFromRgb(t))})),p(I,"sourceFromRgb",(function(t){var e=t.match(I.reRGBa);if(e){var s=parseInt(e[1],10)/(/%$/.test(e[1])?100:1)*(/%$/.test(e[1])?255:1),i=parseInt(e[2],10)/(/%$/.test(e[2])?100:1)*(/%$/.test(e[2])?255:1),r=parseInt(e[3],10)/(/%$/.test(e[3])?100:1)*(/%$/.test(e[3])?255:1);return[parseInt(s,10),parseInt(i,10),parseInt(r,10),e[4]?parseFloat(e[4]):1]}})),p(I,"fromRgba",I.fromRgb),p(I,"fromHsl",(function(t){return I.fromSource(I.sourceFromHsl(t))})),p(I,"sourceFromHsl",(function(t){var e=t.match(I.reHSLa);if(e){var s,i,r,n=(parseFloat(e[1])%360+360)%360/360,a=parseFloat(e[2])/(/%$/.test(e[2])?100:1),o=parseFloat(e[3])/(/%$/.test(e[3])?100:1);if(0===a)s=i=r=o;else{var h=o<=.5?o*(a+1):o+a-o*a,l=2*o-h;s=x(l,h,n+1/3),i=x(l,h,n),r=x(l,h,n-1/3)}return[Math.round(255*s),Math.round(255*i),Math.round(255*r),e[4]?parseFloat(e[4]):1]}})),p(I,"sourceFromHex",(function(t){if(t.match(I.reHex)){var e=t.slice(t.indexOf("#")+1),s=3===e.length||4===e.length,i=8===e.length||4===e.length,r=s?e.charAt(0)+e.charAt(0):e.substring(0,2),n=s?e.charAt(1)+e.charAt(1):e.substring(2,4),a=s?e.charAt(2)+e.charAt(2):e.substring(4,6),o=i?s?e.charAt(3)+e.charAt(3):e.substring(6,8):"FF";return[parseInt(r,16),parseInt(n,16),parseInt(a,16),parseFloat((parseInt(o,16)/255).toFixed(2))]}})),p(I,"fromSource",(function(t){var e=new I;return e.setSource(t),e}));let C=I;function k(t,e){e.forEach((e=>{const s=e.prototype||e;Object.getOwnPropertyNames(s).forEach((e=>{Object.hasOwnProperty.call(t.prototype,e)||Object.defineProperty(t.prototype,e,Object.getOwnPropertyDescriptor(s,e)||Object.create(null))}))}))}class E{constructor(t,e){p(this,"x"),p(this,"y"),p(this,"type","point"),this.x=t,this.y=e}add(t){return new E(this.x+t.x,this.y+t.y)}addEquals(t){return this.x+=t.x,this.y+=t.y,this}scalarAdd(t){return new E(this.x+t,this.y+t)}scalarAddEquals(t){return this.x+=t,this.y+=t,this}subtract(t){return new E(this.x-t.x,this.y-t.y)}subtractEquals(t){return this.x-=t.x,this.y-=t.y,this}scalarSubtract(t){return new E(this.x-t,this.y-t)}scalarSubtractEquals(t){return this.x-=t,this.y-=t,this}multiply(t){return new E(this.x*t,this.y*t)}multiplyEquals(t){return this.x*=t,this.y*=t,this}divide(t){return new E(this.x/t,this.y/t)}divideEquals(t){return this.x/=t,this.y/=t,this}eq(t){return this.x===t.x&&this.y===t.y}lt(t){return this.x<t.x&&this.y<t.y}lte(t){return this.x<=t.x&&this.y<=t.y}gt(t){return this.x>t.x&&this.y>t.y}gte(t){return this.x>=t.x&&this.y>=t.y}lerp(t,e){return typeof e>"u"&&(e=.5),e=Math.max(Math.min(1,e),0),new E(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)}distanceFrom(t){var e=this.x-t.x,s=this.y-t.y;return Math.sqrt(e*e+s*s)}midPointFrom(t){return this.lerp(t)}min(t){return new E(Math.min(this.x,t.x),Math.min(this.y,t.y))}max(t){return new E(Math.max(this.x,t.x),Math.max(this.y,t.y))}toString(){return this.x+","+this.y}setXY(t,e){return this.x=t,this.y=e,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setFromPoint(t){return this.x=t.x,this.y=t.y,this}swap(t){var e=this.x,s=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=s}clone(){return new E(this.x,this.y)}}const P={NUM_FRACTION_DIGITS:2},j={DEFAULT_SVG_FONT_SIZE:2};var R={exports:{}};const L=(null==R.exports?{}:R.exports).default||R.exports,N=Object.freeze(Object.defineProperty({__proto__:null,default:L},Symbol.toStringTag,{value:"Module"}));let D,F,M;if(typeof document<"u"&&typeof window<"u")F=document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?document:document.implementation.createHTMLDocument(""),D=window;else{var B=new(L||N).JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;F=B.document,M=(L||N).implForWrapper,(L||N).Canvas,D=B}const Y=typeof Buffer<"u"&&typeof window>"u";"ontouchstart"in D||"ontouchstart"in F||D&&D.navigator&&D.navigator.maxTouchPoints;const H={version:"4.6.0",charWidthsCache:{},DPI:96,commaWsp:"(?:\\s+,?\\s*|,\\s*)",rePathCommand:/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,fontPaths:{},iMatrix:[1,0,0,1,0,0],boundsOfCurveCache:new class{constructor(t=100,e=1){p(this,"store",new Map),this.limit=t,this.cleanBulk=e}has(t){return this.store.has(t)}get(t){return this.store.get(t)}set(t,e){if(this.has(t))return;const s=this.store;if(s.size+1>this.limit){const t=s.keys();for(let e=0;e<this.cleanBulk;e++){const e=t.next();if(e.done)break;s.delete(e.value)}}s.set(t,e)}}(2e4,300),perfLimitSizeTotal:2097152,maxCacheSideLimit:4096,minCacheSideLimit:256,devicePixelRatio:D.devicePixelRatio||D.webkitDevicePixelRatio||D.mozDevicePixelRatio||1,browserShadowBlurConstant:1,_measuringContext:void 0},z={log:console.log,warn:console.warn,error:console.error};var W=Math.sqrt,X=Math.atan2,U=Math.pow,V=Math.PI/180,G=Math.PI/2;const q={cos:function(t){if(0===t)return 1;switch(t<0&&(t=-t),t/G){case 1:case 3:return 0;case 2:return-1}return Math.cos(t)},sin:function(t){if(0===t)return 0;var e=1;switch(t<0&&(e=-1),t/G){case 1:return e;case 2:return 0;case 3:return-e}return Math.sin(t)},removeFromArray:function(t,e){var s=t.indexOf(e);return-1!==s&&t.splice(s,1),t},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},degreesToRadians:function(t){return t*V},radiansToDegrees:function(t){return t/V},rotatePoint:function(t,e,s){var i=new E(t.x-e.x,t.y-e.y),r=q.rotateVector(i,s);return new E(r.x,r.y).addEquals(e)},rotateVector:function(t,e){var s=q.sin(e),i=q.cos(e);return{x:t.x*i-t.y*s,y:t.x*s+t.y*i}},transformPoint:function(t,e,s){return s?new E(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y):new E(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},makeBoundingBoxFromPoints:function(t,e){if(e)for(var s=0;s<t.length;s++)t[s]=q.transformPoint(t[s],e);var i=[t[0].x,t[1].x,t[2].x,t[3].x],r=w.min(i),n=w.max(i)-r,a=[t[0].y,t[1].y,t[2].y,t[3].y],o=w.min(a);return{left:r,top:o,width:n,height:w.max(a)-o}},invertTransform:function(t){var e=1/(t[0]*t[3]-t[1]*t[2]),s=[e*t[3],-e*t[1],-e*t[2],e*t[0]],i=q.transformPoint({x:t[4],y:t[5]},s,!0);return s[4]=-i.x,s[5]=-i.y,s},toFixed:function(t,e){return parseFloat(Number(t).toFixed(e))},parseUnit:function(t,e){var s=/\D{0,2}$/.exec(t),i=parseFloat(t);switch(e||(e=j.DEFAULT_SVG_FONT_SIZE),s[0]){case"mm":return i*H.DPI/25.4;case"cm":return i*H.DPI/2.54;case"in":return i*H.DPI;case"pt":return i*H.DPI/72;case"pc":return i*H.DPI/72*12;case"em":return i*e;default:return i}},falseFunction:function(){return!1},getSvgAttributes:function(t){var e=["instantiated_by_use","style","id","class"];switch(t){case"linearGradient":e=e.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":e=e.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":e=e.concat(["offset","stop-color","stop-opacity"])}return e},loadImage:function(t,e,s,i){if(t){var r=q.createImage(),n=function(){e&&e.call(s,r,!1),r=r.onload=r.onerror=null};r.onload=n,r.onerror=function(){z.log("Error loading "+r.src),e&&e.call(s,null,!0),r=r.onload=r.onerror=null},0!==t.indexOf("data")&&null!=i&&(r.crossOrigin=i),"data:image/svg"===t.substring(0,14)&&(r.onload=null,q.loadImageInDom(r,n)),r.src=t}else e&&e.call(s,t)},loadImageInDom:function(t,e){var s=F.createElement("div");s.style.width=s.style.height="1px",s.style.left=s.style.top="-100%",s.style.position="absolute",s.appendChild(t),F.querySelector("body").appendChild(s),t.onload=function(){e(),s.parentNode.removeChild(s),s=null}},populateWithProperties:function(t,e,s){if(s&&"[object Array]"===Object.prototype.toString.call(s))for(var i=0,r=s.length;i<r;i++)s[i]in t&&(e[s[i]]=t[s[i]])},drawDashedLine:function(t,e,s,i,r,n){var a=i-e,o=r-s,h=W(a*a+o*o),l=X(o,a),c=n.length,d=0,u=!0;for(t.save(),t.translate(e,s),t.moveTo(0,0),t.rotate(l),e=0;h>e;)(e+=n[d++%c])>h&&(e=h),t[u?"lineTo":"moveTo"](e,0),u=!u;t.restore()},createCanvasElement:function(){return F.createElement("canvas")},copyCanvasElement:function(t){var e=q.createCanvasElement();return e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),e},toDataURL:function(t,e,s){const i="pdf"===e||"svg"===e?"":"image/";return t.toDataURL(i+e,s)},createImage:function(){return F.createElement("img")},multiplyTransformMatrices:function(t,e,s){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],s?0:t[0]*e[4]+t[2]*e[5]+t[4],s?0:t[1]*e[4]+t[3]*e[5]+t[5]]},qrDecompose:function(t){var e=X(t[1],t[0]),s=U(t[0],2)+U(t[1],2),i=W(s),r=(t[0]*t[3]-t[2]*t[1])/i,n=X(t[0]*t[2]+t[1]*t[3],s);return{angle:e/V,scaleX:i,scaleY:r,skewX:n/V,skewY:0,translateX:t[4],translateY:t[5]}},calcRotateMatrix:function(t){if(!t.angle)return H.iMatrix.concat();var e=q.degreesToRadians(t.angle),s=q.cos(e),i=q.sin(e);return[s,i,-i,s,0,0]},calcDimensionsMatrix:function(t){var e=typeof t.scaleX>"u"?1:t.scaleX,s=typeof t.scaleY>"u"?1:t.scaleY,i=[t.flipX?-e:e,0,0,t.flipY?-s:s,0,0],r=q.multiplyTransformMatrices,n=q.degreesToRadians;return t.skewX&&(i=r(i,[1,0,Math.tan(n(t.skewX)),1],!0)),t.skewY&&(i=r(i,[1,Math.tan(n(t.skewY)),0,1],!0)),i},composeMatrix:function(t){var e=[1,0,0,1,t.translateX||0,t.translateY||0],s=q.multiplyTransformMatrices;return t.angle&&(e=s(e,q.calcRotateMatrix(t))),(1!==t.scaleX||1!==t.scaleY||t.skewX||t.skewY||t.flipX||t.flipY)&&(e=s(e,q.calcDimensionsMatrix(t))),e},resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.rotate(0)},saveObjectTransform:function(t){return{scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,angle:t.angle,left:t.left,flipX:t.flipX,flipY:t.flipY,top:t.top}},isTransparent:function(t,e,s,i){i>0&&(e>i?e-=i:e=0,s>i?s-=i:s=0);var r,n=!0,a=t.getImageData(e,s,2*i||1,2*i||1),o=a.data.length;for(r=3;r<o&&!1!=(n=a.data[r]<=0);r+=4);return a=null,n},parsePreserveAspectRatioAttribute:function(t){var e,s="meet",i=t.split(" ");return i&&i.length&&("meet"!==(s=i.pop())&&"slice"!==s?(e=s,s="meet"):i.length&&(e=i.pop())),{meetOrSlice:s,alignX:"none"!==e?e.slice(1,4):"none",alignY:"none"!==e?e.slice(5,8):"none"}},clearFabricFontCache:function(t){(t=(t||"").toLowerCase())?H.charWidthsCache[t]&&delete H.charWidthsCache[t]:H.charWidthsCache={}},limitDimsByArea:function(t,e){var s=Math.sqrt(e*t),i=Math.floor(e/s);return{x:Math.floor(s),y:i}},capValue:function(t,e,s){return Math.max(t,Math.min(e,s))},findScaleToFit:function(t,e){return Math.min(e.width/t.width,e.height/t.height)},findScaleToCover:function(t,e){return Math.max(e.width/t.width,e.height/t.height)},matrixToSVG:function(t){return"matrix("+t.map((function(t){return q.toFixed(t,P.NUM_FRACTION_DIGITS)})).join(" ")+")"},removeTransformFromObject:function(t,e){var s=q.invertTransform(e),i=q.multiplyTransformMatrices(s,t.calcOwnMatrix());q.applyTransformToObject(t,i)},addTransformToObject:function(t,e){q.applyTransformToObject(t,q.multiplyTransformMatrices(e,t.calcOwnMatrix()))},applyTransformToObject:function(t,e){var s=q.qrDecompose(e),i=new E(s.translateX,s.translateY);t.flipX=!1,t.flipY=!1,t.set("scaleX",s.scaleX),t.set("scaleY",s.scaleY),t.skewX=s.skewX,t.skewY=s.skewY,t.angle=s.angle,t.setPositionByOrigin(i,"center","center")},sizeAfterTransform:function(t,e,s){var i=t/2,r=e/2,n=[{x:-i,y:-r},{x:i,y:-r},{x:-i,y:r},{x:i,y:r}],a=q.calcDimensionsMatrix(s),o=q.makeBoundingBoxFromPoints(n,a);return{x:o.width,y:o.height}}};class J{constructor(t=""){p(this,"points"),p(this,"status"),this.status=t,this.points=[]}appendPoint(t){return this.points.push(t),this}appendPoints(t){return this.points=this.points.concat(t),this}static intersectLineLine(t,e,s,i){var r,n=(i.x-s.x)*(t.y-s.y)-(i.y-s.y)*(t.x-s.x),a=(e.x-t.x)*(t.y-s.y)-(e.y-t.y)*(t.x-s.x),o=(i.y-s.y)*(e.x-t.x)-(i.x-s.x)*(e.y-t.y);if(0!==o){var h=n/o,l=a/o;0<=h&&h<=1&&0<=l&&l<=1?(r=new J("Intersection")).appendPoint(new E(t.x+h*(e.x-t.x),t.y+h*(e.y-t.y))):r=new J}else r=new J(0===n||0===a?"Coincident":"Parallel");return r}static intersectLinePolygon(t,e,s){var i,r,n,a,o=new J,h=s.length;for(a=0;a<h;a++)i=s[a],r=s[(a+1)%h],n=J.intersectLineLine(t,e,i,r),o.appendPoints(n.points);return o.points.length>0&&(o.status="Intersection"),o}static intersectPolygonPolygon(t,e){var s,i=new J,r=t.length;for(s=0;s<r;s++){var n=t[s],a=t[(s+1)%r],o=J.intersectLinePolygon(n,a,e);i.appendPoints(o.points)}return i.points.length>0&&(i.status="Intersection"),i}static intersectPolygonRectangle(t,e,s){var i=e.min(s),r=e.max(s),n=new E(r.x,i.y),a=new E(i.x,r.y),o=J.intersectLinePolygon(i,n,t),h=J.intersectLinePolygon(n,r,t),l=J.intersectLinePolygon(r,a,t),c=J.intersectLinePolygon(a,i,t),d=new J;return d.appendPoints(o.points),d.appendPoints(h.points),d.appendPoints(l.points),d.appendPoints(c.points),d.points.length>0&&(d.status="Intersection"),d}}const{degreesToRadians:K,transformPoint:Z}=q,Q={left:-.5,top:-.5,center:0,bottom:.5,right:.5},$=t=>"string"==typeof t?Q[t]:t-.5,tt=q.degreesToRadians,et=q.multiplyTransformMatrices,st=q.transformPoint;function it(t,e){if(!t||t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==e[s])return!1;return!0}const rt=class{constructor(){p(this,"oCoords",null),p(this,"aCoords",null),p(this,"lineCoords",null),p(this,"ownMatrixCache",null),p(this,"matrixCache",null)}_getCoords(t,e){return e?t?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),t?this.aCoords:this.lineCoords)}getCoords(t,e){return s=this._getCoords(t,e),[new E(s.tl.x,s.tl.y),new E(s.tr.x,s.tr.y),new E(s.br.x,s.br.y),new E(s.bl.x,s.bl.y)];var s}forEachParent(t){const e=new Set;let s=this.group;for(;s&&!e.has(s);)e.add(s),t(s),s=s.group}getTotalScaleSimple(t,e){var s;let i=null!=(s=null!=e?e:this[t])?s:1;return this.forEachParent((e=>{var s;i*=null!=(s=e[t])?s:1})),i}intersectsWithRect(t,e,s,i){var r=this.getCoords(s,i);return"Intersection"===J.intersectPolygonRectangle(r,t,e).status}intersectsWithObject(t,e,s){return"Intersection"===J.intersectPolygonPolygon(this.getCoords(e,s),t.getCoords(e,s)).status||t.isContainedWithinObject(this,e,s)||this.isContainedWithinObject(t,e,s)}isContainedWithinObject(t,e,s){for(var i=this.getCoords(e,s),r=e?t.aCoords:t.lineCoords,n=0,a=t._getImageLines(r);n<4;n++)if(!t.containsPoint(i[n],a))return!1;return!0}isContainedWithinRect(t,e,s,i){var r=this.getBoundingRect(s,i);return r.left>=t.x&&r.left+r.width<=e.x&&r.top>=t.y&&r.top+r.height<=e.y}containsPoint(t,e,s,i){var r=this._getCoords(s,i),n=(e=e||this._getImageLines(r),this._findCrossPoints(t,e));return 0!==n&&n%2==1}isOnScreen(t){if(!this.canvas)return!1;var e=this.canvas.vptCoords.tl,s=this.canvas.vptCoords.br;return!(!this.getCoords(!0,t).some((function(t){return t.x<=s.x&&t.x>=e.x&&t.y<=s.y&&t.y>=e.y}))&&!this.intersectsWithRect(e,s,!0,t))||this._containsCenterOfCanvas(e,s,t)}_containsCenterOfCanvas(t,e,s){var i={x:(t.x+e.x)/2,y:(t.y+e.y)/2};return!!this.containsPoint(i,null,!0,s)}isPartiallyOnScreen(t){if(!this.canvas)return!1;var e=this.canvas.vptCoords.tl,s=this.canvas.vptCoords.br;return!!this.intersectsWithRect(e,s,!0,t)||this.getCoords(!0,t).every((function(t){return(t.x>=s.x||t.x<=e.x)&&(t.y>=s.y||t.y<=e.y)}))&&this._containsCenterOfCanvas(e,s,t)}_getImageLines(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}}_findCrossPoints(t,e){var s,i,r,n,a,o=0;for(var h in e)if(!((a=e[h]).o.y<t.y&&a.d.y<t.y||a.o.y>=t.y&&a.d.y>=t.y||(a.o.x===a.d.x&&a.o.x>=t.x?n=a.o.x:(s=(a.d.y-a.o.y)/(a.d.x-a.o.x),i=t.y-0*t.x,r=a.o.y-s*a.o.x,n=-(i-r)/(0-s)),n>=t.x&&(o+=1),2!==o)))break;return o}getBoundingRect(t,e){var s=this.getCoords(t,e);return q.makeBoundingBoxFromPoints(s)}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}_constrainScale(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:0===t?1e-4:t}scale(t){return this._set("scaleX",t),this._set("scaleY",t),this.setCoords()}scaleToWidth(t,e){var s=this.getBoundingRect(e).width/this.getScaledWidth();return this.scale(t/this.width/s)}scaleToHeight(t,e){var s=this.getBoundingRect(e).height/this.getScaledHeight();return this.scale(t/this.height/s)}getTotalAngle(){return this.group?q.qrDecompose(this.calcTransformMatrix()).angle:this.angle}calcCoords(t){return t?this.calcACoords():this.calcOCoords()}calcLineCoords(){var t=this.getViewportTransform(),e=this.padding,s=tt(this.angle),i=q.cos(s)*e,r=q.sin(s)*e,n=i+r,a=i-r,o=this.calcACoords(),h={tl:st(o.tl,t),tr:st(o.tr,t),bl:st(o.bl,t),br:st(o.br,t)};return e&&(h.tl.x-=a,h.tl.y-=n,h.tr.x+=n,h.tr.y-=a,h.bl.x-=n,h.bl.y+=a,h.br.x+=a,h.br.y+=n),h}calcCanvasLineCoords(){const t=this.group?q.multiplyTransformMatrices(this.getViewportTransform(),this.group.calcTransformMatrix()):this.getViewportTransform(),e=this.padding,s=q.degreesToRadians(this.angle),i=q.cos(s)*e,r=q.sin(s)*e,n=i+r,a=i-r,o=this.calcACoords(),h={tl:q.transformPoint(o.tl,t),tr:q.transformPoint(o.tr,t),bl:q.transformPoint(o.bl,t),br:q.transformPoint(o.br,t)};return e&&(h.tl.x-=a,h.tl.y-=n,h.tr.x+=n,h.tr.y-=a,h.bl.x-=n,h.bl.y+=a,h.br.x+=a,h.br.y+=n),h}calcOCoords(){var t=this._calcRotateMatrix(),e=this._calcTranslateMatrix(),s=this.getViewportTransform(),i=et(s,e),r=et(i,t),n=(r=et(r,[1/s[0],0,0,1/s[3],0,0]),this._calculateCurrentDimensions()),a={};return this.forEachControl((function(t,e,s){a[e]=t.positionHandler(n,r,s)})),a}calcACoords(){var t=this._calcRotateMatrix(),e=this._calcTranslateMatrix(),s=et(e,t),i=this._getTransformedDimensions(),r=i.x/2,n=i.y/2;return{tl:st({x:-r,y:-n},s),tr:st({x:r,y:-n},s),bl:st({x:-r,y:n},s),br:st({x:r,y:n},s)}}calcAbsCoords(){var t;const e=this.calcACoords(),s=null==(t=this.group)?void 0:t.calcTransformMatrix();let i=[e.tl,e.tr,e.bl,e.br];return i=s?i.map((t=>q.transformPoint(t,s))):i,{tl:i[0],tr:i[1],bl:i[2],br:i[3]}}setCoords(t){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),t||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this}_calcRotateMatrix(){return q.calcRotateMatrix(this)}_calcTranslateMatrix(){var t=this.getCenterPoint();return[1,0,0,1,t.x,t.y]}transformMatrixKey(t){let e=[];return!t&&this.group&&(e=this.group.transformMatrixKey(t)),e.push(this.top,this.left,this.scaleX,this.scaleY,this.skewX,this.skewY,this.angle,$(this.originX),$(this.originY),this.width,this.height,this.strokeWidth,+this.flipX,+this.flipY),e}calcTransformMatrix(t){var e=this.calcOwnMatrix();if(t||!this.group)return e;var s=this.transformMatrixKey(t),i=this.matrixCache||(this.matrixCache={});return it(i.key,s)?i.value:(this.group&&(e=et(this.group.calcTransformMatrix(!1),e)),i.key=s,i.value=e,e)}calcOwnMatrix(){var t=this.transformMatrixKey(!0),e=this.ownMatrixCache||(this.ownMatrixCache={});if(it(e.key,t))return e.value;var s=this._calcTranslateMatrix(),i={angle:this.angle,translateX:s[4],translateY:s[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return e.key=t,e.value=q.composeMatrix(i),e.value}_calcDimensionsTransformMatrix(t,e,s){return q.calcDimensionsMatrix({skewX:t,skewY:e,scaleX:this.scaleX*(s&&this.flipX?-1:1),scaleY:this.scaleY*(s&&this.flipY?-1:1)})}_getNonTransformedDimensions(){var t=this.strokeWidth;return{x:this.width+t,y:this.height+t}}_getTransformedDimensions(t,e){typeof t>"u"&&(t=this.skewX),typeof e>"u"&&(e=this.skewY);var s,i,r,n=0===t&&0===e;if(this.strokeUniform?(i=this.width,r=this.height):(i=(s=this._getNonTransformedDimensions()).x,r=s.y),n)return this._finalizeDimensions(i*this.scaleX,r*this.scaleY);var a=q.sizeAfterTransform(i,r,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:t,skewY:e});return this._finalizeDimensions(a.x,a.y)}_finalizeDimensions(t,e){return this.strokeUniform?{x:t+this.strokeWidth,y:e+this.strokeWidth}:{x:t,y:e}}_calculateCurrentDimensions(){var t=this.getViewportTransform(),e=this._getTransformedDimensions();return st(e,t,!0).scalarAdd(2*this.padding)}};rt.prototype.oCoords=null,rt.prototype.aCoords=null,rt.prototype.lineCoords=null,rt.prototype.ownMatrixCache=null,rt.prototype.matrixCache=null,rt.prototype.controls={};let nt=rt;function at(t,e,s){if(s)if(!Y&&e instanceof Element)t=e;else if(e instanceof Array){t=[];for(var i=0,r=e.length;i<r;i++)t[i]=at({},e[i],s)}else if(e&&"object"==typeof e)for(var n in e)"canvas"===n||"group"===n?t[n]=null:e.hasOwnProperty(n)&&(t[n]=at({},e[n],s));else t=e;else for(var n in e)t[n]=e[n];return t}const ot={extend:at,clone:function(t,e){return at({},t,e)}};var ht=ot.extend,lt="stateProperties";function ct(t,e,s){var i={};s.forEach((function(e){i[e]=t[e]})),ht(t[e],i,!0)}function dt(t,e,s){if(t===e)return!0;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var i=0,r=t.length;i<r;i++)if(!dt(t[i],e[i]))return!1;return!0}if(t&&"object"==typeof t){var n,a=Object.keys(t);if(!e||"object"!=typeof e||!s&&a.length!==Object.keys(e).length)return!1;for(i=0,r=a.length;i<r;i++)if("canvas"!==(n=a[i])&&"group"!==n&&!dt(t[n],e[n]))return!1;return!0}}class ut{_setOptions(t){for(const e in t)this.set(e,t[e])}_setObject(t){for(const e in t)this._set(e,t[e])}set(t,e){return"object"==typeof t?this._setObject(t):this._set(t,e),this}_set(t,e){this[t]=e}toggle(t){const e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this}get(t){return this[t]}}function pt(t,e){if(!this.__eventListeners[t])return;const s=this.__eventListeners[t];if(s)if(e){const t=s.indexOf(e);t>-1&&s.splice(t,1)}else s.length=0}function gt(t,e){var s=function(){e.apply(this,arguments),this.off(t,s)}.bind(this);this.on(t,s)}class ft{constructor(){p(this,"__eventListeners")}once(t,e){if(1===arguments.length)for(var s in t)gt.call(this,s,t[s]);else gt.call(this,t,e);return this}on(t,e){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var s in t)this.on(s,t[s]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(e);return this}off(t,e){if(!this.__eventListeners)return this;if(0===arguments.length)for(t in this.__eventListeners)pt.call(this,t);else if(1===arguments.length&&"object"==typeof arguments[0])for(var s in t)pt.call(this,s,t[s]);else pt.call(this,t,e);return this}fire(t,e){if(!this.__eventListeners)return this;var s=this.__eventListeners[t];if(!s)return this;for(var i=0,r=s.length;i<r;i++)s[i]&&s[i].call(this,e||{});return this}}function _t(t,e){if(e){if(e.toLive)return t+": url(#SVGID_"+e.id+"); ";var s=new C(e),i=t+": "+s.toRgb()+"; ",r=s.getAlpha();return 1!==r&&(i+=t+"-opacity: "+r.toString()+"; "),i}return t+": none; "}var Ot=q.toFixed;function mt(){return!1}function vt(t,e,s,i){return-s*Math.cos(t/i*(Math.PI/2))+s+e}function bt(t){var e=!1;return St((function(s){t||(t={});var i,r=s||+new Date,n=t.duration||500,a=r+n,o=t.onChange||mt,h=t.abort||mt,l=t.onComplete||mt,c=t.easing||vt,d="startValue"in t?t.startValue:0,u="endValue"in t?t.endValue:100,p=t.byValue||u-d;t.onStart&&t.onStart(),function t(s){var g=(i=s||+new Date)>a?n:i-r,f=g/n,_=c(g,d,p,n),O=Math.abs((_-d)/p);if(!e){if(h(_,O,f))return void l(u,1,1);if(i>a)return o(u,1,1),void l(u,1,1);o(_,O,f),St(t)}}(r)})),function(){e=!0}}const yt=window,At=yt.requestAnimationFrame||yt.webkitRequestAnimationFrame||yt.mozRequestAnimationFrame||yt.oRequestAnimationFrame||yt.msRequestAnimationFrame||function(t){return yt.setTimeout(t,1e3/60)},Tt=yt.cancelAnimationFrame||yt.clearTimeout;function St(t){return At(t)}function wt(t){return Tt(t)}class xt{constructor(){p(this,"_onObjectAdded"),p(this,"_onObjectRemoved"),p(this,"renderOnAddRemove"),p(this,"_objects",[])}add(...t){if(this._objects.push(...t),this._onObjectAdded)for(var e=0,s=arguments.length;e<s;e++)this._onObjectAdded(arguments[e]);return this.renderOnAddRemove&&this._onCollectionChanged(),this}_onCollectionChanged(){}insertAt(t,e,s){var i=this._objects;return s?i[e]=t:i.splice(e,0,t),this._onObjectAdded&&this._onObjectAdded(t),this.renderOnAddRemove&&this._onCollectionChanged(),this}remove(...t){for(var e,s=this._objects,i=!1,r=0,n=t.length;r<n;r++)-1!==(e=s.indexOf(t[r]))&&(i=!0,s.splice(e,1),this._onObjectRemoved&&this._onObjectRemoved(t[r]));return this.renderOnAddRemove&&i&&this._onCollectionChanged(),this}forEachObject(t,e){for(var s=this.getObjects(),i=0,r=s.length;i<r;i++)t.call(e,s[i],i,s);return this}getObjects(t){return typeof t>"u"?this._objects.concat():this._objects.filter((function(e){return e.type===t}))}item(t){return this._objects[t]}isEmpty(){return 0===this._objects.length}size(){return this._objects.length}contains(t,e){return this._objects.indexOf(t)>-1||!!e&&this._objects.some((function(e){return"function"==typeof e.contains&&e.contains(t,!0)}))}complexity(){return this._objects.reduce((function(t,e){return t+(e.complexity?e.complexity():0)}),0)}}function It(t,e){var s=t.style;if(!s)return t;if("string"==typeof e)return t.style.cssText+=";"+e,e.indexOf("opacity")>-1?jt(t,e.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(var i in e)"opacity"===i?jt(t,e[i]):s["float"===i||"cssFloat"===i?typeof s.styleFloat>"u"?"cssFloat":"styleFloat":i]=e[i];return t}const Ct=document.createElement("div"),kt="string"==typeof Ct.style.opacity,Et="string"==typeof Ct.style.filter,Pt=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/;let jt=function(t){return t};kt?jt=function(t,e){return t.style.opacity=e,t}:Et&&(jt=function(t,e){var s=t.style;return t.currentStyle&&!t.currentStyle.hasLayout&&(s.zoom=1),Pt.test(s.filter)?(e=e>=.9999?"":"alpha(opacity="+100*e+")",s.filter=s.filter.replace(Pt,e)):s.filter+=" alpha(opacity="+100*e+")",t});const Rt=Array.prototype.slice,Lt=document;var Nt,Dt,Ft=function(t){return Rt.call(t,0)};try{Nt=Ft(Lt.childNodes)instanceof Array}catch(Ve){}function Mt(t,e){var s=Lt.createElement(t);for(var i in e)"class"===i?s.className=e[i]:"for"===i?s.htmlFor=e[i]:s.setAttribute(i,e[i]);return s}function Bt(t){for(var e=0,s=0,i=Lt.documentElement,r=Lt.body||{scrollLeft:0,scrollTop:0};t&&(t.parentNode||t.host)&&((t=t.parentNode||t.host)===Lt?(e=r.scrollLeft||i.scrollLeft||0,s=r.scrollTop||i.scrollTop||0):(e+=t.scrollLeft||0,s+=t.scrollTop||0),1!==t.nodeType||"fixed"!==t.style.position););return{left:e,top:s}}Nt||(Ft=function(t){for(var e=new Array(t.length),s=t.length;s--;)e[s]=t[s];return e}),Dt=Lt.defaultView&&Lt.defaultView.getComputedStyle?function(t,e){var s=Lt.defaultView.getComputedStyle(t,null);return s?s[e]:void 0}:function(t,e){var s=t.style[e];return!s&&t.currentStyle&&(s=t.currentStyle[e]),s};var Yt=document.documentElement.style,Ht="userSelect"in Yt?"userSelect":"MozUserSelect"in Yt?"MozUserSelect":"WebkitUserSelect"in Yt?"WebkitUserSelect":"KhtmlUserSelect"in Yt?"KhtmlUserSelect":"";const zt={setImageSmoothing:function(t,e){t.imageSmoothingEnabled=t.imageSmoothingEnabled||t.webkitImageSmoothingEnabled||t.mozImageSmoothingEnabled||t.msImageSmoothingEnabled||t.oImageSmoothingEnabled,t.imageSmoothingEnabled=e},getById:function(t){return"string"==typeof t?Lt.getElementById(t):t},toArray:Ft,addClass:function(t,e){t&&-1===(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className+=(t.className?" ":"")+e)},makeElement:Mt,wrapElement:function(t,e,s){return"string"==typeof e&&(e=Mt(e,s)),t.parentNode&&t.parentNode.replaceChild(e,t),e.appendChild(t),e},getScrollLeftTop:Bt,getElementOffset:function(t){var e,s,i=t&&t.ownerDocument,r={left:0,top:0},n={left:0,top:0},a={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!i)return n;for(var o in a)n[a[o]]+=parseInt(Dt(t,o),10)||0;return e=i.documentElement,typeof t.getBoundingClientRect<"u"&&(r=t.getBoundingClientRect()),s=Bt(t),{left:r.left+s.left-(e.clientLeft||0)+n.left,top:r.top+s.top-(e.clientTop||0)+n.top}},getNodeCanvas:function(t){var e=M(t);return e._canvas||e._image},cleanUpJsdomNode:function(t){if(Y){var e=M(t);e&&(e._canvas&&(e._canvas.width=0,e._canvas.height=0),e._image&&(e._image.width=0,e._image.height=0),e._canvas=null,e._image=null,e._currentSrc=null,e._attributes=null,e._classList=null)}},makeElementUnselectable:function(t){return typeof t.onselectstart<"u"&&(t.onselectstart=q.falseFunction),Ht?t.style[Ht]="none":"string"==typeof t.unselectable&&(t.unselectable="on"),t},makeElementSelectable:function(t){return typeof t.onselectstart<"u"&&(t.onselectstart=null),Ht?t.style[Ht]="":"string"==typeof t.unselectable&&(t.unselectable=""),t},setStyle:It},Wt=ot.extend,Xt=zt.getElementOffset,Ut=q.removeFromArray,Vt=q.toFixed,Gt=q.transformPoint,qt=q.invertTransform,Jt=zt.getNodeCanvas,Kt=q.createCanvasElement,Zt=new Error("Could not initialize `canvas` element");class Qt{constructor(t,e){p(this,"isRendering",0),p(this,"backgroundColor",""),p(this,"backgroundImage",null),p(this,"overlayColor",""),p(this,"overlayImage",null),p(this,"includeDefaultValues",!0),p(this,"stateful",!1),p(this,"renderOnAddRemove",!0),p(this,"controlsAboveOverlay",!1),p(this,"allowTouchScrolling",!1),p(this,"imageSmoothingEnabled",!0),p(this,"viewportTransform",H.iMatrix.concat()),p(this,"backgroundVpt",!0),p(this,"overlayVpt",!0),p(this,"enableRetinaScaling",!0),p(this,"vptCoords",{}),p(this,"skipOffscreen",!0),p(this,"clipPath"),p(this,"svgViewportTransformation",!0),e||(e={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(t,e)}_initStatic(t,e){var s=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(t),this._initOptions(e),this.interactive||this._initRetinaScaling(),e.overlayImage&&this.setOverlayImage(e.overlayImage,s),e.backgroundImage&&this.setBackgroundImage(e.backgroundImage,s),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor,s),e.overlayColor&&this.setOverlayColor(e.overlayColor,s),this.calcOffset()}_isRetinaScaling(){return 1!==H.devicePixelRatio&&this.enableRetinaScaling}getRetinaScaling(){return this._isRetinaScaling()?H.devicePixelRatio:1}_initRetinaScaling(){if(this._isRetinaScaling()){var t=H.devicePixelRatio;this.__initRetinaScaling(t,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(t,this.upperCanvasEl,this.contextTop)}}__initRetinaScaling(t,e,s){e.setAttribute("width",this.width*t),e.setAttribute("height",this.height*t),s.scale(t,t)}calcOffset(){return this._offset=Xt(this.lowerCanvasEl),this}setOverlayImage(t,e,s){return this.__setBgOverlayImage("overlayImage",t,e,s)}setBackgroundImage(t,e,s){return this.__setBgOverlayImage("backgroundImage",t,e,s)}setOverlayColor(t,e){return this.__setBgOverlayColor("overlayColor",t,e)}setBackgroundColor(t,e){return this.__setBgOverlayColor("backgroundColor",t,e)}__setBgOverlayImage(t,e,s,i){if("string"==typeof e){const r=A.get(y.Image);q.loadImage(e,(function(e,n){if(e){var a=new r(e,i);this[t]=a,a.canvas=this}s&&s(e,n)}),this,i&&i.crossOrigin)}else i&&e.setOptions(i),this[t]=e,e&&(e.canvas=this),s&&s(e,!1);return this}__setBgOverlayColor(t,e,s){return this[t]=e,this}_createCanvasElement(){var t=Kt();if(!t||(t.style||(t.style={}),typeof t.getContext>"u"))throw Zt;return t}_initOptions(t){var e=this.lowerCanvasEl;this._setOptions(t),this.width=this.width||parseInt(e.width,10)||0,this.height=this.height||parseInt(e.height,10)||0,this.lowerCanvasEl.style&&(e.width=this.width,e.height=this.height,e.style.width=this.width+"px",e.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())}_createLowerCanvas(t){t&&t.getContext?this.lowerCanvasEl=t:this.lowerCanvasEl=zt.getById(t)||this._createCanvasElement(),zt.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")}getWidth(){return this.width}getHeight(){return this.height}setWidth(t,e){return this.setDimensions({width:t},e)}setHeight(t,e){return this.setDimensions({height:t},e)}setDimensions(t,e){var s;for(var i in e=e||{},t)s=t[i],e.cssOnly||(this._setBackstoreDimension(i,t[i]),s+="px",this.hasLostContext=!0),e.backstoreOnly||this._setCssDimension(i,s);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(),this._initRetinaScaling(),this.calcOffset(),e.cssOnly||this.requestRenderAll(),this}_setBackstoreDimension(t,e){return this.lowerCanvasEl[t]=e,this.upperCanvasEl&&(this.upperCanvasEl[t]=e),this.cacheCanvasEl&&(this.cacheCanvasEl[t]=e),this[t]=e,this}_setCssDimension(t,e){return this.lowerCanvasEl.style[t]=e,this.upperCanvasEl&&(this.upperCanvasEl.style[t]=e),this.wrapperEl&&(this.wrapperEl.style[t]=e),this}getZoom(){return this.viewportTransform[0]}setViewportTransform(t){var e,s,i,r=this._activeObject,n=this.backgroundImage,a=this.overlayImage;for(this.viewportTransform=t,s=0,i=this._objects.length;s<i;s++)(e=this._objects[s]).group||e.setCoords(!0);return r&&r.setCoords(),n&&n.setCoords(!0),a&&a.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this}zoomToPoint(t,e){var s=t,i=this.viewportTransform.slice(0);t=Gt(t,qt(this.viewportTransform)),i[0]=e,i[3]=e;var r=Gt(t,i);return i[4]+=s.x-r.x,i[5]+=s.y-r.y,this.setViewportTransform(i)}setZoom(t){return this.zoomToPoint(new E(0,0),t),this}absolutePan(t){var e=this.viewportTransform.slice(0);return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)}relativePan(t){return this.absolutePan(new E(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))}getElement(){return this.lowerCanvasEl}_onObjectAdded(t){this.stateful&&t.setupState(),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added")}_onObjectRemoved(t){this.fire("object:removed",{target:t}),t.fire("removed"),delete t.canvas}_onCollectionChanged(){this.requestRenderAll()}clearContext(t){return t.clearRect(0,0,this.width,this.height),this}getContext(){return this.contextContainer}clear(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this}renderAll(){var t=this.contextContainer;return this.renderCanvas(t,this._objects),this}renderAndReset(){this.isRendering=0,this.renderAll()}requestRenderAll(){return this.isRendering||(this.isRendering=St(this.renderAndResetBound)),this}calcViewportBoundaries(){var t={},e=this.width,s=this.height,i=qt(this.viewportTransform);return t.tl=Gt({x:0,y:0},i),t.br=Gt({x:e,y:s},i),t.tr=new E(t.br.x,t.tl.y),t.bl=new E(t.tl.x,t.br.y),this.vptCoords=t,t}cancelRequestedRender(){this.isRendering&&(wt(this.isRendering),this.isRendering=0)}renderCanvas(t,e){var s=this.viewportTransform,i=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(t),zt.setImageSmoothing(t,this.imageSmoothingEnabled),this.fire("before:render",{ctx:t}),this._renderBackground(t),t.save(),t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this._renderObjects(t,e),t.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),i&&(i.canvas=this,i.shouldCache(),i._transformDone=!0,i.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t)),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:renderLower",{ctx:t}),this.fire("after:render",{ctx:t})}drawClipPathOnCanvas(t){var e=this.viewportTransform,s=this.clipPath;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t.globalCompositeOperation="destination-in",s.transform(t),t.scale(1/s.zoomX,1/s.zoomY),t.drawImage(s._cacheCanvas,-s.cacheTranslationX,-s.cacheTranslationY),t.restore()}_renderObjects(t,e){var s,i;for(s=0,i=e.length;s<i;++s)e[s]&&e[s].render(t)}_renderBackgroundOrOverlay(t,e){var s=this[e+"Color"],i=this[e+"Image"],r=this.viewportTransform,n=this[e+"Vpt"];if(s||i){if(s){t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.fillStyle=s.toLive?s.toLive(t,this):s,n&&t.transform(r[0],r[1],r[2],r[3],r[4],r[5]),t.transform(1,0,0,1,s.offsetX||0,s.offsetY||0);var a=s.gradientTransform||s.patternTransform;a&&t.transform(a[0],a[1],a[2],a[3],a[4],a[5]),t.fill(),t.restore()}i&&(t.save(),n&&t.transform(r[0],r[1],r[2],r[3],r[4],r[5]),i.render(t),t.restore())}}_renderBackground(t){this._renderBackgroundOrOverlay(t,"background")}_renderOverlay(t){this._renderBackgroundOrOverlay(t,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}centerObjectH(t){return this._centerObject(t,new E(this.getCenter().left,t.getCenterPoint().y))}centerObjectV(t){return this._centerObject(t,new E(t.getCenterPoint().x,this.getCenter().top))}centerObject(t){var e=this.getCenter();return this._centerObject(t,new E(e.left,e.top))}viewportCenterObject(t){var e=this.getVpCenter();return this._centerObject(t,e)}viewportCenterObjectH(t){var e=this.getVpCenter();return this._centerObject(t,new E(e.x,t.getCenterPoint().y)),this}viewportCenterObjectV(t){var e=this.getVpCenter();return this._centerObject(t,new E(t.getCenterPoint().x,e.y))}getVpCenter(){var t=this.getCenter(),e=qt(this.viewportTransform);return Gt({x:t.left,y:t.top},e)}_centerObject(t,e){return t.setPositionByOrigin(e,"center","center"),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this}toDatalessJSON(t){return this.toDatalessObject(t)}toObject(t){return this._toObjectMethod("toObject",t)}toDatalessObject(t){return this._toObjectMethod("toDatalessObject",t)}_toObjectMethod(t,e){var s=this.clipPath,i={version:H.version,objects:this._toObjects(t,e)};return s&&!s.excludeFromExport&&(i.clipPath=this._toObject(this.clipPath,t,e)),Wt(i,this.__serializeBgOverlay(t,e)),q.populateWithProperties(this,i,e),i}_toObjects(t,e){return this._objects.filter((function(t){return!t.excludeFromExport})).map((function(s){return this._toObject(s,t,e)}),this)}_toObject(t,e,s){var i;this.includeDefaultValues||(i=t.includeDefaultValues,t.includeDefaultValues=!1);var r=t[e](s);return this.includeDefaultValues||(t.includeDefaultValues=i),r}__serializeBgOverlay(t,e){var s={},i=this.backgroundImage,r=this.overlayImage,n=this.backgroundColor,a=this.overlayColor;return n&&n.toObject?n.excludeFromExport||(s.background=n.toObject(e)):n&&(s.background=n),a&&a.toObject?a.excludeFromExport||(s.overlay=a.toObject(e)):a&&(s.overlay=a),i&&!i.excludeFromExport&&(s.backgroundImage=this._toObject(i,t,e)),r&&!r.excludeFromExport&&(s.overlayImage=this._toObject(r,t,e)),s}toSVG(t,e){t||(t={}),t.reviver=e;var s=[];return this._setSVGPreamble(s,t),this._setSVGHeader(s,t),this.clipPath&&s.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor(s,"background"),this._setSVGBgOverlayImage(s,"backgroundImage",e),this._setSVGObjects(s,e),this.clipPath&&s.push("</g>\n"),this._setSVGBgOverlayColor(s,"overlay"),this._setSVGBgOverlayImage(s,"overlayImage",e),s.push("</svg>"),s.join("")}_setSVGPreamble(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')}_setSVGHeader(t,e){var s,i=e.width||this.width,r=e.height||this.height,n='viewBox="0 0 '+this.width+" "+this.height+'" ',a=Ue.NUM_FRACTION_DIGITS;e.viewBox?n='viewBox="'+e.viewBox.x+" "+e.viewBox.y+" "+e.viewBox.width+" "+e.viewBox.height+'" ':this.svgViewportTransformation&&(s=this.viewportTransform,n='viewBox="'+Vt(-s[4]/s[0],a)+" "+Vt(-s[5]/s[3],a)+" "+Vt(this.width/s[0],a)+" "+Vt(this.height/s[3],a)+'" '),t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',i,'" ','height="',r,'" ',n,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",H.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(e),"</defs>\n")}createSVGClipPathMarkup(t){var e=this.clipPath;return e?(e.clipPathId="CLIPPATH_"+Ue.__uid++,'<clipPath id="'+e.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(t.reviver)+"</clipPath>\n"):""}createSVGRefElementsMarkup(){var t=this;return["background","overlay"].map((function(e){var s=t[e+"Color"];if(s&&s.toLive){var i=t[e+"Vpt"],r=t.viewportTransform,n={width:t.width/(i?r[0]:1),height:t.height/(i?r[3]:1)};return s.toSVG(n,{additionalTransform:i?q.matrixToSVG(r):""})}})).join("")}createSVGFontFacesMarkup(){var t,e,s,i,r,n,a,o,h="",l={},c=H.fontPaths,d=[];for(this._objects.forEach((function t(e){d.push(e),e._objects&&e._objects.forEach(t)})),a=0,o=d.length;a<o;a++)if(e=(t=d[a]).fontFamily,-1!==t.type.indexOf("text")&&!l[e]&&c[e]&&(l[e]=!0,t.styles))for(r in s=t.styles)for(n in i=s[r])!l[e=i[n].fontFamily]&&c[e]&&(l[e]=!0);for(var u in l)h+=["\t\t@font-face {\n","\t\t\tfont-family: '",u,"';\n","\t\t\tsrc: url('",c[u],"');\n","\t\t}\n"].join("");return h&&(h=['\t<style type="text/css">',"<![CDATA[\n",h,"]]>","</style>\n"].join("")),h}_setSVGObjects(t,e){var s,i,r,n=this._objects;for(i=0,r=n.length;i<r;i++)!(s=n[i]).excludeFromExport&&this._setSVGObject(t,s,e)}_setSVGObject(t,e,s){t.push(e.toSVG(s))}_setSVGBgOverlayImage(t,e,s){this[e]&&!this[e].excludeFromExport&&this[e].toSVG&&t.push(this[e].toSVG(s))}_setSVGBgOverlayColor(t,e){var s=this[e+"Color"],i=this.viewportTransform,r=this.width,n=this.height;if(s)if(s.toLive){var a=s.repeat,o=q.invertTransform(i),h=this[e+"Vpt"]?q.matrixToSVG(o):"";t.push('<rect transform="'+h+" translate(",r/2,",",n/2,')"',' x="',s.offsetX-r/2,'" y="',s.offsetY-n/2,'" ','width="',"repeat-y"===a||"no-repeat"===a?s.source.width:r,'" height="',"repeat-x"===a||"no-repeat"===a?s.source.height:n,'" fill="url(#SVGID_'+s.id+')"',"></rect>\n")}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',s,'"',"></rect>\n")}sendToBack(t){if(!t)return this;var e,s,i,r=this._activeObject;if(t===r&&"activeSelection"===t.type)for(e=(i=r._objects).length;e--;)s=i[e],Ut(this._objects,s),this._objects.unshift(s);else Ut(this._objects,t),this._objects.unshift(t);return this.renderOnAddRemove&&this.requestRenderAll(),this}bringToFront(t){if(!t)return this;var e,s,i,r=this._activeObject;if(t===r&&"activeSelection"===t.type)for(i=r._objects,e=0;e<i.length;e++)s=i[e],Ut(this._objects,s),this._objects.push(s);else Ut(this._objects,t),this._objects.push(t);return this.renderOnAddRemove&&this.requestRenderAll(),this}sendBackwards(t,e){if(!t)return this;var s,i,r,n,a,o=this._activeObject,h=0;if(t===o&&"activeSelection"===t.type)for(a=o._objects,s=0;s<a.length;s++)i=a[s],(r=this._objects.indexOf(i))>0+h&&(n=r-1,Ut(this._objects,i),this._objects.splice(n,0,i)),h++;else 0!==(r=this._objects.indexOf(t))&&(n=this._findNewLowerIndex(t,r,e),Ut(this._objects,t),this._objects.splice(n,0,t));return this.renderOnAddRemove&&this.requestRenderAll(),this}_findNewLowerIndex(t,e,s){var i,r;if(s){for(i=e,r=e-1;r>=0;--r)if(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t)){i=r;break}}else i=e-1;return i}bringForward(t,e){if(!t)return this;var s,i,r,n,a,o=this._activeObject,h=0;if(t===o&&"activeSelection"===t.type)for(s=(a=o._objects).length;s--;)i=a[s],(r=this._objects.indexOf(i))<this._objects.length-1-h&&(n=r+1,Ut(this._objects,i),this._objects.splice(n,0,i)),h++;else(r=this._objects.indexOf(t))!==this._objects.length-1&&(n=this._findNewUpperIndex(t,r,e),Ut(this._objects,t),this._objects.splice(n,0,t));return this.renderOnAddRemove&&this.requestRenderAll(),this}_findNewUpperIndex(t,e,s){var i,r,n;if(s){for(i=e,r=e+1,n=this._objects.length;r<n;++r)if(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t)){i=r;break}}else i=e+1;return i}moveTo(t,e){return Ut(this._objects,t),this._objects.splice(e,0,t),this.renderOnAddRemove&&this.requestRenderAll()}dispose(){return this.isRendering&&(wt(this.isRendering),this.isRendering=0),this.forEachObject((function(t){t.dispose&&t.dispose()})),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),this.lowerCanvasEl.style=this._originalCanvasStyle,delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),zt.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this}toString(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}static supports(t){var e=Kt();if(!e||!e.getContext)return null;var s=e.getContext("2d");return s&&"setLineDash"===t?typeof s.setLineDash<"u":null}createPNGStream(){if(!Y)return null;var t=Jt(this.lowerCanvasEl);return t&&t.createPNGStream()}createJPEGStream(t){if(!Y)return null;var e=Jt(this.lowerCanvasEl);return e&&e.createJPEGStream(t)}}p(Qt,"EMPTY_JSON",'{"objects": [], "background": "white"}'),k(Qt,[ut,ft,xt,class{toDataURL(t){t||(t={});var e=t.format||"png",s=t.quality||1,i=(t.multiplier||1)*(t.enableRetinaScaling?this.getRetinaScaling():1),r=this.toCanvasElement(i,t);return q.toDataURL(r,e,s)}toCanvasElement(t,e){t=t||1;var s=((e=e||{}).width||this.width)*t,i=(e.height||this.height)*t,r=this.getZoom(),n=this.width,a=this.height,o=r*t,h=this.viewportTransform,l=(h[4]-(e.left||0))*t,c=(h[5]-(e.top||0))*t,d=this.interactive,u=[o,0,0,o,l,c],p=this.enableRetinaScaling,g=q.createCanvasElement(),f=this.contextTop;return g.width=s,g.height=i,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=u,this.width=s,this.height=i,this.calcViewportBoundaries(),this.renderCanvas(g.getContext("2d"),this._objects),this.viewportTransform=h,this.width=n,this.height=a,this.calcViewportBoundaries(),this.interactive=d,this.enableRetinaScaling=p,this.contextTop=f,g}}]),Qt.prototype.toJSON=Qt.prototype.toObject;const $t=q.degreesToRadians,te=q.degreesToRadians;var ee=["e","se","s","sw","w","nw","n","ne","e"],se=["ns","nesw","ew","nwse"],ie="left",re="top",ne="right",ae="bottom",oe="center",he={top:ae,bottom:re,left:ne,right:ie,center:oe},le=q.radiansToDegrees,ce=Math.sign||function(t){return(t>0)-(t<0)||+t};function de(t,e){var s=t.angle+le(Math.atan2(e.y,e.x))+360;return Math.round(s%360/45)}function ue(t,e){var s=e.transform.target,i=s.canvas,r=ot.clone(e);r.target=s,i&&i.fire("object:"+t,r),s.fire(t,e)}function pe(t,e){var s=e.canvas,i=t[s.uniScaleKey];return s.uniformScaling&&!i||!s.uniformScaling&&i}function ge(t){return t.originX===oe&&t.originY===oe}function fe(t,e,s){var i=t.lockScalingX,r=t.lockScalingY;return!!(i&&r||!e&&(i||r)&&s||i&&"x"===e||r&&"y"===e)}function _e(t,e,s,i){return{e:t,transform:e,pointer:{x:s,y:i}}}function Oe(t){return function(e,s,i,r){var n=s.target,a=n.getCenterPoint(),o=n.translateToOriginPoint(a,s.originX,s.originY),h=t(e,s,i,r);return n.setPositionByOrigin(o,s.originX,s.originY),h}}function me(t,e){return function(s,i,r,n){var a=e(s,i,r,n);return a&&ue(t,_e(s,i,r,n)),a}}function ve(t,e,s,i,r){var n=t.target,a=n.controls[t.corner],o=n.canvas.getZoom(),h=n.padding/o,l=n.toLocalPoint(new E(i,r),e,s);return l.x>=h&&(l.x-=h),l.x<=-h&&(l.x+=h),l.y>=h&&(l.y-=h),l.y<=h&&(l.y+=h),l.x-=a.offsetX,l.y-=a.offsetY,l}function be(t){return t.flipX!==t.flipY}function ye(t,e,s,i,r){if(0!==t[e]){var n=r/t._getTransformedDimensions()[i]*t[s];t.set(s,n)}}function Ae(t,e,s,i){var r,n=e.target,a=n._getTransformedDimensions(0,n.skewY),o=ve(e,e.originX,e.originY,s,i),h=Math.abs(2*o.x)-a.x,l=n.skewX;h<2?r=0:(r=le(Math.atan2(h/n.scaleX,a.y/n.scaleY)),e.originX===ie&&e.originY===ae&&(r=-r),e.originX===ne&&e.originY===re&&(r=-r),be(n)&&(r=-r));var c=l!==r;if(c){var d=n._getTransformedDimensions().y;n.set("skewX",r),ye(n,"skewY","scaleY","y",d)}return c}function Te(t,e,s,i){var r,n=e.target,a=n._getTransformedDimensions(n.skewX,0),o=ve(e,e.originX,e.originY,s,i),h=Math.abs(2*o.y)-a.y,l=n.skewY;h<2?r=0:(r=le(Math.atan2(h/n.scaleY,a.x/n.scaleX)),e.originX===ie&&e.originY===ae&&(r=-r),e.originX===ne&&e.originY===re&&(r=-r),be(n)&&(r=-r));var c=l!==r;if(c){var d=n._getTransformedDimensions().x;n.set("skewY",r),ye(n,"skewX","scaleX","x",d)}return c}function Se(t,e,s,i,r){var n,a,o,h;r=r||{};var l,c,d,u,p,g,f=e.target,_=f.lockScalingX,O=f.lockScalingY,m=r.by,v=pe(t,f),b=fe(f,m,v),y=e.gestureScale;if(b)return!1;if(y)c=e.scaleX*y,d=e.scaleY*y;else{if(l=ve(e,e.originX,e.originY,s,i),p="y"!==m?ce(l.x):1,g="x"!==m?ce(l.y):1,e.signX||(e.signX=p),e.signY||(e.signY=g),f.lockScalingFlip&&(e.signX!==p||e.signY!==g))return!1;if(u=f._getTransformedDimensions(),v&&!m){var A=Math.abs(l.x)+Math.abs(l.y),T=e.original,S=A/(Math.abs(u.x*T.scaleX/f.scaleX)+Math.abs(u.y*T.scaleY/f.scaleY));c=T.scaleX*S,d=T.scaleY*S}else c=Math.abs(l.x*f.scaleX/u.x),d=Math.abs(l.y*f.scaleY/u.y);ge(e)&&(c*=2,d*=2),e.signX!==p&&"y"!==m&&(e.originX=he[e.originX],c*=-1,e.signX=p),e.signY!==g&&"x"!==m&&(e.originY=he[e.originY],d*=-1,e.signY=g)}var w=f.scaleX,x=f.scaleY;return m?("x"===m&&!(null!=(o=f.isScaleLimited)&&o.call(f,"scaleX",c))&&f.set("scaleX",c),"y"===m&&!(null!=(h=f.isScaleLimited)&&h.call(f,"scaleY",d))&&f.set("scaleY",d)):!(null!=(n=f.isScaleLimited)&&n.call(f,"scaleX",c))&&!(null!=(a=f.isScaleLimited)&&a.call(f,"scaleY",d))&&(!_&&f.set("scaleX",c),!O&&f.set("scaleY",d)),w!==f.scaleX||x!==f.scaleY}const we={scaleCursorStyleHandler:function(t,e,s){var i=pe(t,s),r="";if(0!==e.x&&0===e.y?r="x":0===e.x&&0!==e.y&&(r="y"),fe(s,r,i))return"not-allowed";var n=de(s,e);return ee[n]+"-resize"},skewCursorStyleHandler:function(t,e,s){if(0!==e.x&&s.lockSkewingY||0!==e.y&&s.lockSkewingX)return"not-allowed";var i=de(s,e)%4;return se[i]+"-resize"},scaleSkewCursorStyleHandler:function(t,e,s){return t[s.canvas.altActionKey]?we.skewCursorStyleHandler(t,e,s):we.scaleCursorStyleHandler(t,e,s)},rotationWithSnapping:me("rotating",Oe((function(t,e,s,i){var r=e,n=r.target,a=n.translateToOriginPoint(n.getCenterPoint(),r.originX,r.originY);if(n.lockRotation)return!1;var o,h=Math.atan2(r.ey-a.y,r.ex-a.x),l=Math.atan2(i-a.y,s-a.x),c=le(l-h+r.theta);if(n.snapAngle>0){var d=n.snapAngle,u=n.snapThreshold||d,p=Math.ceil(c/d)*d,g=Math.floor(c/d)*d;Math.abs(c-g)<u?c=g:Math.abs(c-p)<u&&(c=p)}return c<0&&(c=360+c),c%=360,o=n.angle!==c,n.angle=c,o}))),scalingEqually:me("scaling",Oe((function(t,e,s,i){return Se(t,e,s,i)}))),scalingX:me("scaling",Oe((function(t,e,s,i){return Se(t,e,s,i,{by:"x"})}))),scalingY:me("scaling",Oe((function(t,e,s,i){return Se(t,e,s,i,{by:"y"})}))),scalingYOrSkewingX:function(t,e,s,i){return t[e.target.canvas.altActionKey]?we.skewHandlerX(t,e,s,i):we.scalingY(t,e,s,i)},scalingXOrSkewingY:function(t,e,s,i){return t[e.target.canvas.altActionKey]?we.skewHandlerY(t,e,s,i):we.scalingX(t,e,s,i)},changeWidth:me("resizing",Oe((function(t,e,s,i){var r=e.target,n=ve(e,e.originX,e.originY,s,i),a=r.strokeWidth/(r.strokeUniform?r.scaleX:1),o=ge(e)?2:1,h=r.width,l=Math.abs(n.x*o/r.scaleX)-a;return r.set("width",Math.max(l,0)),h!==l}))),skewHandlerX:function(t,e,s,i){var r,n=e.target,a=n.skewX,o=e.originY;return!n.lockSkewingX&&(0===a?r=ve(e,oe,oe,s,i).x>0?ie:ne:(a>0&&(r=o===re?ie:ne),a<0&&(r=o===re?ne:ie),be(n)&&(r=r===ie?ne:ie)),e.originX=r,me("skewing",Oe(Ae))(t,e,s,i))},skewHandlerY:function(t,e,s,i){var r,n=e.target,a=n.skewY,o=e.originX;return!n.lockSkewingY&&(0===a?r=ve(e,oe,oe,s,i).y>0?re:ae:(a>0&&(r=o===ie?re:ae),a<0&&(r=o===ie?ae:re),be(n)&&(r=r===re?ae:re)),e.originY=r,me("skewing",Oe(Te))(t,e,s,i))},dragHandler:function(t,e,s,i){var r=e.target,n=s-e.offsetX,a=i-e.offsetY,o=!r.get("lockMovementX")&&r.left!==n,h=!r.get("lockMovementY")&&r.top!==a;return o&&r.set("left",n),h&&r.set("top",a),(o||h)&&ue("moving",_e(t,e,s,i)),o||h},scaleOrSkewActionName:function(t,e,s){var i=t[s.canvas.altActionKey];return 0===e.x?i?"skewX":"scaleY":0===e.y?i?"skewY":"scaleX":void 0},rotationStyleHandler:function(t,e,s){return s.lockRotation?"not-allowed":e.cursorStyle},fireEvent:ue,wrapWithFixedAnchor:Oe,wrapWithFireEvent:me,getLocalPoint:ve,renderCircleControl:function(t,e,s,i,r){i=i||{};var n,a=this.sizeX||i.cornerSize||r.cornerSize,o=this.sizeY||i.cornerSize||r.cornerSize,h=typeof i.transparentCorners<"u"?i.transparentCorners:r.transparentCorners,l=h?"stroke":"fill",c=!h&&(i.cornerStrokeColor||r.cornerStrokeColor),d=e,u=s;t.save(),t.fillStyle=i.cornerColor||r.cornerColor,t.strokeStyle=i.cornerStrokeColor||r.cornerStrokeColor,a>o?(n=a,t.scale(1,o/a),u=s*a/o):o>a?(n=o,t.scale(a/o,1),d=e*o/a):n=a,t.lineWidth=1,t.beginPath(),t.arc(d,u,n/2,0,2*Math.PI,!1),t[l](),c&&t.stroke(),t.restore()},renderSquareControl:function(t,e,s,i,r){i=i||{};var n=this.sizeX||i.cornerSize||r.cornerSize,a=this.sizeY||i.cornerSize||r.cornerSize,o=typeof i.transparentCorners<"u"?i.transparentCorners:r.transparentCorners,h=o?"stroke":"fill",l=!o&&(i.cornerStrokeColor||r.cornerStrokeColor),c=n/2,d=a/2;t.save(),t.fillStyle=i.cornerColor||r.cornerColor,t.strokeStyle=i.cornerStrokeColor||r.cornerStrokeColor,t.lineWidth=1,t.translate(e,s),t.rotate(te(r.angle)),t[h+"Rect"](-c,-d,n,a),l&&t.strokeRect(-c,-d,n,a),t.restore()}};function xe(t,e,s,i){return!1}function Ie(t,e,s){return e.cursorStyle}class Ce{constructor(t){p(this,"visible",!0),p(this,"actionName","scale"),p(this,"angle",0),p(this,"x",0),p(this,"y",0),p(this,"offsetX",0),p(this,"offsetY",0),p(this,"sizeX",null),p(this,"sizeY",null),p(this,"touchSizeX",null),p(this,"touchSizeY",null),p(this,"cursorStyle","crosshair"),p(this,"withConnection",!1),p(this,"actionHandlerImpl"),p(this,"cursorStyleHandlerImpl"),p(this,"actionHandler",((t,e,s,i)=>{var r;return!(null==(r=null==e?void 0:e.target)||!r.canvas)&&this.actionHandlerImpl(t,e,s,i)})),p(this,"cursorStyleHandler",((t,e,s)=>s.canvas?this.cursorStyleHandlerImpl(t,e,s):e.cursorStyle));const e=t,{actionHandler:s,cursorStyleHandler:i}=e,r=u(e,["actionHandler","cursorStyleHandler"]);for(var n in this.actionHandlerImpl=s||xe,this.cursorStyleHandlerImpl=i||Ie,r)this[n]=t[n]}mouseDownHandler(){}mouseUpHandler(){}getActionHandler(){return this.actionHandler}getMouseDownHandler(){return this.mouseDownHandler}getMouseUpHandler(){return this.mouseUpHandler}getActionName(t,e){return e.actionName}getVisibility(t,e){var s=t._controlsVisibility;return s&&typeof s[e]<"u"?s[e]:this.visible}setVisibility(t){this.visible=t}positionHandler(t,e){return q.transformPoint({x:this.x*t.x+this.offsetX,y:this.y*t.y+this.offsetY},e)}calcCornerCoords(t,e,s,i,r){var n,a,o,h,l=r?this.touchSizeX:this.sizeX,c=r?this.touchSizeY:this.sizeY;if(l&&c&&l!==c){var d=Math.atan2(c,l),u=Math.sqrt(l*l+c*c)/2,p=d-q.degreesToRadians(t),g=Math.PI/2-d-q.degreesToRadians(t);n=u*q.cos(p),a=u*q.sin(p),o=u*q.cos(g),h=u*q.sin(g)}else u=.7071067812*(l&&c?l:e),p=q.degreesToRadians(45-t),n=o=u*q.cos(p),a=h=u*q.sin(p);return{tl:{x:s-h,y:i-o},tr:{x:s+n,y:i-a},bl:{x:s-n,y:i+a},br:{x:s+h,y:i+o}}}render(t,e,s,i,r){"circle"===((i=i||{}).cornerStyle||r.cornerStyle)?we.renderCircleControl.call(this,t,e,s,i,r):we.renderSquareControl.call(this,t,e,s,i,r)}}const ke=we.scaleSkewCursorStyleHandler,Ee=we.scaleCursorStyleHandler,Pe=we.scalingEqually,je=we.scalingYOrSkewingX,Re=we.scalingXOrSkewingY,Le=we.scaleOrSkewActionName;function Ne(t,e,s){var i="rgba("+parseInt(t[0]+s*(e[0]-t[0]),10)+","+parseInt(t[1]+s*(e[1]-t[1]),10)+","+parseInt(t[2]+s*(e[2]-t[2]),10);return(i+=","+(t&&e?parseFloat(t[3]+s*(e[3]-t[3])):1))+")"}function De(t,e,s,i){var r=new C(t).getSource(),n=new C(e).getSource(),a=i.onComplete,o=i.onChange;return i=i||{},bt(Object.assign(i,{duration:s||500,startValue:r,endValue:n,byValue:n,easing:function(t,e,s,r){return Ne(e,s,i.colorEasing?i.colorEasing(t,r):1-Math.cos(t/r*(Math.PI/2)))},onComplete:function(t,e,s){if(a)return a(Ne(n,n,0),e,s)},onChange:function(t,e,s){if(o){if(Array.isArray(t))return o(Ne(t,t,0),e,s);o(t,e,s)}}}))}const Fe=q.toFixed,Me=class t{constructor(t){for(var e in p(this,"color","rgb(0,0,0)"),p(this,"blur",0),p(this,"offsetX",0),p(this,"offsetY",0),p(this,"affectStroke",!1),p(this,"includeDefaultValues",!0),p(this,"nonScaling",!1),p(this,"id"),"string"==typeof t&&(t=this._parseShadow(t)),this.id=""+Ue.__uid++,t)this[e]=t[e]}_parseShadow(e){var s=e.trim(),i=t.reOffsetsAndBlur.exec(s)||[];return{color:(s.replace(t.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(i[1])||0,offsetY:parseFloat(i[2])||0,blur:parseFloat(i[3])||0}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(t){var e=40,s=40,i=Ue.NUM_FRACTION_DIGITS,r=q.rotateVector({x:this.offsetX,y:this.offsetY},q.degreesToRadians(-t.angle)),n=new C(this.color);return t.width&&t.height&&(e=100*Fe((Math.abs(r.x)+this.blur)/t.width,i)+20,s=100*Fe((Math.abs(r.y)+this.blur)/t.height,i)+20),t.flipX&&(r.x*=-1),t.flipY&&(r.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+s+'%" height="'+(100+2*s)+'%" x="-'+e+'%" width="'+(100+2*e)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+Fe(this.blur?this.blur/2:0,i)+'"></feGaussianBlur>\n\t<feOffset dx="'+Fe(r.x,i)+'" dy="'+Fe(r.y,i)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+n.toRgb()+'" flood-opacity="'+n.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'}toObject(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var e={},s=t.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach((function(t){this[t]!==s[t]&&(e[t]=this[t])}),this),e}};p(Me,"reOffsetsAndBlur",/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/);let Be=Me;const Ye=q.toFixed,He=b.capitalize,ze=q.degreesToRadians,We={type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!Y,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,isText:!1},Xe=class t{static get NUM_FRACTION_DIGITS(){return P.NUM_FRACTION_DIGITS}static set NUM_FRACTION_DIGITS(t){P.NUM_FRACTION_DIGITS=t}constructor(t){t&&this.setOptions(t)}_createCacheCanvas(){this._cacheProperties={},this._cacheCanvas=q.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(t){var e=H.perfLimitSizeTotal,s=t.width,i=t.height,r=H.maxCacheSideLimit,n=H.minCacheSideLimit;if(s<=r&&i<=r&&s*i<=e)return s<n&&(t.width=n),i<n&&(t.height=n),t;var a=s/i,o=q.limitDimsByArea(a,e),h=q.capValue,l=h(n,o.x,r),c=h(n,o.y,r);return s>l&&(t.zoomX/=s/l,t.width=l,t.capped=!0),i>c&&(t.zoomY/=i/c,t.height=c,t.capped=!0),t}_getCacheCanvasDimensions(){var t=this.getTotalObjectScaling(),e=this._getTransformedDimensions(0,0),s=e.x*t.scaleX/this.scaleX,i=e.y*t.scaleY/this.scaleY;return{width:s+2,height:i+2,zoomX:t.scaleX,zoomY:t.scaleY,x:s,y:i}}_updateCacheCanvas(){var t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){var e=t._currentTransform.target,s=t._currentTransform.action;if(this===e&&s.slice&&"scale"===s.slice(0,5))return!1}var i,r,n=this._cacheCanvas,a=this._limitCacheSize(this._getCacheCanvasDimensions()),o=H.minCacheSideLimit,h=a.width,l=a.height,c=a.zoomX,d=a.zoomY,u=h!==this.cacheWidth||l!==this.cacheHeight,p=this.zoomX!==c||this.zoomY!==d,g=u||p,f=0,_=0,O=!1;if(u){var m=this._cacheCanvas.width,v=this._cacheCanvas.height,b=h>m||l>v;O=b||(h<.9*m||l<.9*v)&&m>o&&v>o,b&&!a.capped&&(h>o||l>o)&&(f=.1*h,_=.1*l)}return this.isText&&this.path&&(g=!0,O=!0,f+=this.getHeightOfLine(0)*this.zoomX,_+=this.getHeightOfLine(0)*this.zoomY),!!g&&(O?(n.width=Math.ceil(h+f),n.height=Math.ceil(l+_)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,n.width,n.height)),i=a.x/2,r=a.y/2,this.cacheTranslationX=Math.round(n.width/2-i)+i,this.cacheTranslationY=Math.round(n.height/2-r)+r,this.cacheWidth=h,this.cacheHeight=l,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(c,d),this.zoomX=c,this.zoomY=d,!0)}setOptions(t){t&&this._setOptions(t)}transform(t){var e=this.group&&!this.group._transformDone||this.group&&this.canvas&&t===this.canvas.contextTop,s=this.calcTransformMatrix(!e);t.transform(s[0],s[1],s[2],s[3],s[4],s[5])}toObject(e){var s=t.NUM_FRACTION_DIGITS,i={type:this.type,version:H.version,originX:this.originX,originY:this.originY,left:Ye(this.left,s),top:Ye(this.top,s),width:Ye(this.width,s),height:Ye(this.height,s),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:Ye(this.strokeWidth,s),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:Ye(this.strokeMiterLimit,s),scaleX:Ye(this.scaleX,s),scaleY:Ye(this.scaleY,s),angle:Ye(this.angle,s),flipX:this.flipX,flipY:this.flipY,opacity:Ye(this.opacity,s),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:Ye(this.skewX,s),skewY:Ye(this.skewY,s)};return this.clipPath&&!this.clipPath.excludeFromExport&&(i.clipPath=this.clipPath.toObject(e),i.clipPath.inverted=this.clipPath.inverted,i.clipPath.absolutePositioned=this.clipPath.absolutePositioned),q.populateWithProperties(this,i,e),this.includeDefaultValues||(i=this._removeDefaultValues(i)),i}toDatalessObject(t){return this.toObject(t)}_removeDefaultValues(t){var e=A.getByObjType(t.type).prototype;return e.stateProperties.forEach((function(s){"left"!==s&&"top"!==s&&(t[s]===e[s]&&delete t[s],"[object Array]"===Object.prototype.toString.call(t[s])&&"[object Array]"===Object.prototype.toString.call(e[s])&&0===t[s].length&&0===e[s].length&&delete t[s])})),t}toString(){return"#<fabric."+He(this.type)+">"}getObjectScaling(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var t=q.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(t.scaleX),scaleY:Math.abs(t.scaleY)}}getTotalObjectScaling(){var t=this.getObjectScaling(),e=t.scaleX,s=t.scaleY;if(this.canvas){var i=this.canvas.getZoom(),r=this.canvas.getRetinaScaling();e*=i*r,s*=i*r}return{scaleX:e,scaleY:s}}getObjectOpacity(){var t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t}_set(t,e){var s="scaleX"===t||"scaleY"===t,i=this[t]!==e,r=!1;return s&&(e=this._constrainScale(e)),"scaleX"===t&&e<0?(this.flipX=!this.flipX,e*=-1):"scaleY"===t&&e<0?(this.flipY=!this.flipY,e*=-1):"shadow"!==t||!e||e instanceof Be?"dirty"===t&&this.group&&this.group.set("dirty",e):e=new Be(e),this[t]=e,i&&(r=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(t)>-1?(this.dirty=!0,r&&this.group.set("dirty",!0)):r&&this.stateProperties.indexOf(t)>-1&&this.group.set("dirty",!0)),this}setOnGroup(...t){}getViewportTransform(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:H.iMatrix.concat()}isNotVisible(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible}render(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(t),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),t.restore())}renderCache(t){t=t||{},this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,t.forClipping),this.dirty=!1)}_removeCacheCanvas(){this._cacheCanvas=null,this.cacheWidth=0,this.cacheHeight=0}hasStroke(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth}hasFill(){return this.fill&&"transparent"!==this.fill}needsItsOwnCache(){return!!("stroke"===this.paintFirst&&this.hasFill()&&this.hasStroke()&&"object"==typeof this.shadow||this.clipPath)}shouldCache(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching}willDrawShadow(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)}drawClipPathOnCache(t){var e=this.clipPath;if(t.save(),e.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",e.absolutePositioned){var s=q.invertTransform(this.calcTransformMatrix());t.transform(s[0],s[1],s[2],s[3],s[4],s[5])}e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}drawObject(t,e){var s=this.fill,i=this.stroke;e?(this.fill="black",this.stroke="",this._setClippingProperties(t)):this._renderBackground(t),this._render(t),this._drawClipPath(t),this.fill=s,this.stroke=i}_drawClipPath(t){var e=this.clipPath;e&&(e.canvas=this.canvas,e.shouldCache(),e._transformDone=!0,e.renderCache({forClipping:!0}),this.drawClipPathOnCache(t))}drawCacheOnCanvas(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(t){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!t&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!t){var e=this.cacheWidth/this.zoomX,s=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-e/2,-s/2,e,s)}return!0}return!1}_renderBackground(t){if(this.backgroundColor){var e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}}_setOpacity(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity}_setStrokeStyles(t,e){var s=e.stroke;s&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineDashOffset=e.strokeDashOffset,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,s.toLive?"percentage"===s.gradientUnits||s.gradientTransform||s.patternTransform?this._applyPatternForTransformedGradient(t,s):(t.strokeStyle=s.toLive(t,this),this._applyPatternGradientTransform(t,s)):t.strokeStyle=e.stroke)}_setFillStyles(t,e){var s=e.fill;s&&(s.toLive?(t.fillStyle=s.toLive(t,this),this._applyPatternGradientTransform(t,e.fill)):t.fillStyle=s)}_setClippingProperties(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000"}_setLineDash(t,e){!e||0===e.length||(1&e.length&&e.push.apply(e,e),t.setLineDash(e))}_renderControls(t,e){var s,i,r,n=this.getViewportTransform(),a=this.calcTransformMatrix();i=typeof(e=e||{}).hasBorders<"u"?e.hasBorders:this.hasBorders,r=typeof e.hasControls<"u"?e.hasControls:this.hasControls,a=q.multiplyTransformMatrices(n,a),s=q.qrDecompose(a),t.save(),t.translate(s.translateX,s.translateY),t.lineWidth=1*this.borderScaleFactor,this.group||(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),t.rotate(ze(s.angle)),e.forActiveSelection||this.group?i&&this.drawBordersInGroup(t,s,e):i&&this.drawBorders(t,e),r&&this.drawControls(t,e),t.restore()}_setShadow(t){if(this.shadow){var e,s=this.shadow,i=this.canvas,r=i&&i.viewportTransform[0]||1,n=i&&i.viewportTransform[3]||1;e=s.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),i&&i._isRetinaScaling()&&(r*=H.devicePixelRatio,n*=H.devicePixelRatio),t.shadowColor=s.color,t.shadowBlur=s.blur*H.browserShadowBlurConstant*(r+n)*(e.scaleX+e.scaleY)/4,t.shadowOffsetX=s.offsetX*r*e.scaleX,t.shadowOffsetY=s.offsetY*n*e.scaleY}}_removeShadow(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)}_applyPatternGradientTransform(t,e){if(!e||!e.toLive)return{offsetX:0,offsetY:0};var s=e.gradientTransform||e.patternTransform,i=-this.width/2+e.offsetX||0,r=-this.height/2+e.offsetY||0;return"percentage"===e.gradientUnits?t.transform(this.width,0,0,this.height,i,r):t.transform(1,0,0,1,i,r),s&&t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),{offsetX:i,offsetY:r}}_renderPaintInOrder(t){"stroke"===this.paintFirst?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))}_render(t){}_renderFill(t){this.fill&&(t.save(),this._setFillStyles(t,this),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore())}_renderStroke(t){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this.strokeUniform&&this.group){var e=this.getObjectScaling();t.scale(1/e.scaleX,1/e.scaleY)}else this.strokeUniform&&t.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(t,this.strokeDashArray),this._setStrokeStyles(t,this),t.stroke(),t.restore()}}_applyPatternForTransformedGradient(t,e){var s,i=this._limitCacheSize(this._getCacheCanvasDimensions()),r=q.createCanvasElement(),n=this.canvas.getRetinaScaling(),a=i.x/this.scaleX/n,o=i.y/this.scaleY/n;r.width=a,r.height=o,(s=r.getContext("2d")).beginPath(),s.moveTo(0,0),s.lineTo(a,0),s.lineTo(a,o),s.lineTo(0,o),s.closePath(),s.translate(a/2,o/2),s.scale(i.zoomX/this.scaleX/n,i.zoomY/this.scaleY/n),this._applyPatternGradientTransform(s,e),s.fillStyle=e.toLive(t),s.fill(),t.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),t.scale(n*this.scaleX/i.zoomX,n*this.scaleY/i.zoomY),t.strokeStyle=s.createPattern(r,"no-repeat")}_findCenterFromElement(){return{x:this.left+this.width/2,y:this.top+this.height/2}}_assignTransformMatrixProps(){if(this.transformMatrix){var t=q.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",t.scaleX),this.set("scaleY",t.scaleY),this.angle=t.angle,this.skewX=t.skewX,this.skewY=0}}_removeTransformMatrix(t){var e=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),e=q.transformPoint(e,this.transformMatrix)),this.transformMatrix=null,t&&(this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this.cropX=t.cropX,this.cropY=t.cropY,e.x+=t.offsetLeft,e.y+=t.offsetTop,this.width=t.width,this.height=t.height),this.setPositionByOrigin(e,"center","center")}cloneAsImage(t,e){const s=this.toCanvasElement(e),i=A.get(y.Image);return t&&i&&t(new i(s)),this}toCanvasElement(t){t||(t={});const e=q.saveObjectTransform(this),s=this.group,i=this.shadow,r=Math.abs,n=(t.multiplier||1)*(t.enableRetinaScaling?H.devicePixelRatio:1);delete this.group,t.withoutTransform&&q.resetObjectTransform(this),t.withoutShadow&&(this.shadow=null);var a,o,h,l,c=q.createCanvasElement(),d=this.getBoundingRect(!0,!0),u=this.shadow,p={x:0,y:0};u&&(o=u.blur,a=u.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),p.x=2*Math.round(r(u.offsetX)+o)*r(a.scaleX),p.y=2*Math.round(r(u.offsetY)+o)*r(a.scaleY)),h=d.width+p.x,l=d.height+p.y,c.width=Math.ceil(h),c.height=Math.ceil(l);var g=new Qt(c,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===t.format&&(g.backgroundColor="#fff"),this.setPositionByOrigin(new E(g.width/2,g.height/2),"center","center");var f=this.canvas;g.add(this);var _=g.toCanvasElement(n||1,t);return this.shadow=i,this.set("canvas",f),s&&(this.group=s),this.set(e).setCoords(),g._objects=[],g.dispose(),g=null,_}toDataURL(t){return t||(t={}),q.toDataURL(this.toCanvasElement(t),t.format||"png",t.quality||1)}isType(t){return this.type===t}complexity(){return 1}toJSON(t){return this.toObject(t)}rotate(t){var e=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return e&&this._setOriginToCenter(),this.set("angle",t),e&&this._resetOrigin(),this}centerH(){return this.canvas&&this.canvas.centerObjectH(this),this}viewportCenterH(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this}centerV(){return this.canvas&&this.canvas.centerObjectV(this),this}viewportCenterV(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this}center(){return this.canvas&&this.canvas.centerObject(this),this}viewportCenter(){return this.canvas&&this.canvas.viewportCenterObject(this),this}getLocalPointer(t,e){e=e||this.canvas.getPointer(t);var s=new E(e.x,e.y),i=this._getLeftTopCoords();return this.angle&&(s=q.rotatePoint(s,i,ze(-this.angle))),{x:s.x-i.x,y:s.y-i.y}}_setupCompositeOperation(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}};p(Xe,"__uid",0);let Ue=Xe;var Ve;k(Ue,[We,ut,ft,class{animate(){if(arguments[0]&&"object"==typeof arguments[0]){var t,e,s=[];for(t in arguments[0])s.push(t);for(var i=0,r=s.length;i<r;i++)t=s[i],e=i!==r-1,this._animate(t,arguments[0][t],arguments[1],e)}else this._animate.apply(this,arguments);return this}_animate(t,e,s,i){var r,n=this;e=e.toString(),s=s?ot.clone(s):{},~t.indexOf(".")&&(r=t.split("."));var a=n.colorProperties.indexOf(t)>-1||r&&n.colorProperties.indexOf(r[1])>-1,o=r?this.get(r[0])[r[1]]:this.get(t);"from"in s||(s.from=o),a||(e=~e.indexOf("=")?o+parseFloat(e.replace("=","")):parseFloat(e));var h={startValue:s.from,endValue:e,byValue:s.by,easing:s.easing,duration:s.duration,abort:s.abort&&function(t,e,i){return s.abort.call(n,t,e,i)},onChange(e,a,o){r?n[r[0]][r[1]]=e:n.set(t,e),!i&&s.onChange&&s.onChange(e,a,o)},onComplete(t,e,r){i||(n.setCoords(),s.onComplete&&s.onComplete(t,e,r))}};return a?De(h.startValue,h.endValue,h.duration,h):bt(h)}},nt,class{_findTargetCorner(t,e){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var s,i,r,n=t.x,a=t.y,o=Object.keys(this.oCoords),h=o.length-1;for(this.__corner=0;h>=0;h--)if(r=o[h],this.isControlVisible(r)&&(i=this._getImageLines(e?this.oCoords[r].touchCorner:this.oCoords[r].corner),0!==(s=this._findCrossPoints({x:n,y:a},i))&&s%2==1))return this.__corner=r,r;return!1}forEachControl(t){for(var e in this.controls)t(this.controls[e],e,this)}_setCornerCoords(){var t=this.oCoords;for(var e in t){var s=this.controls[e];t[e].corner=s.calcCornerCoords(this.angle,this.cornerSize,t[e].x,t[e].y,!1),t[e].touchCorner=s.calcCornerCoords(this.angle,this.touchCornerSize,t[e].x,t[e].y,!0)}}drawSelectionBackground(t){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;t.save();var e=this.getCenterPoint(),s=this._calculateCurrentDimensions(),i=this.canvas.viewportTransform;return t.translate(e.x,e.y),t.scale(1/i[0],1/i[3]),t.rotate($t(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-s.x/2,-s.y/2,s.x,s.y),t.restore(),this}drawBorders(t,e){e=e||{};var s=this._calculateCurrentDimensions(),i=this.borderScaleFactor,r=s.x+i,n=s.y+i,a=typeof e.hasControls<"u"?e.hasControls:this.hasControls,o=!1;return t.save(),t.strokeStyle=e.borderColor||this.borderColor,this._setLineDash(t,e.borderDashArray||this.borderDashArray),t.strokeRect(-r/2,-n/2,r,n),a&&(t.beginPath(),this.forEachControl((function(e,s,i){e.withConnection&&e.getVisibility(i,s)&&(o=!0,t.moveTo(e.x*r,e.y*n),t.lineTo(e.x*r+e.offsetX,e.y*n+e.offsetY))})),o&&t.stroke()),t.restore(),this}drawBordersInGroup(t,e,s){s=s||{};var i=q.sizeAfterTransform(this.width,this.height,e),r=this.strokeWidth,n=this.strokeUniform,a=this.borderScaleFactor,o=i.x+r*(n?this.canvas.getZoom():e.scaleX)+a,h=i.y+r*(n?this.canvas.getZoom():e.scaleY)+a;return t.save(),this._setLineDash(t,s.borderDashArray||this.borderDashArray),t.strokeStyle=s.borderColor||this.borderColor,t.strokeRect(-o/2,-h/2,o,h),t.restore(),this}drawControls(t,e){e=e||{},t.save();var s,i,r=this.canvas.getRetinaScaling();return t.setTransform(r,0,0,r,0,0),t.strokeStyle=t.fillStyle=e.cornerColor||this.cornerColor,this.transparentCorners||(t.strokeStyle=e.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(t,e.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(s=this.group.calcTransformMatrix()),this.forEachControl((function(r,n,a){i=a.oCoords[n],r.getVisibility(a,n)&&(s&&(i=q.transformPoint(i,s)),r.render(t,i.x,i.y,e,a))})),t.restore(),this}isControlVisible(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)}setControlVisible(t,e){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=e,this}setControlsVisibility(t){for(var e in t||(t={}),t)this.setControlVisible(e,t[e]);return this}onDeselect(){}onSelect(){}},class{translateToGivenOrigin(t,e,s,i,r){var n,a,o,h=t.x,l=t.y;return e=$(e),n=(i=$(i))-e,s=$(s),a=(r=$(r))-s,(n||a)&&(o=this._getTransformedDimensions(),h=t.x+n*o.x,l=t.y+a*o.y),new E(h,l)}translateToCenterPoint(t,e,s){var i=this.translateToGivenOrigin(t,e,s,"center","center");return this.angle?q.rotatePoint(i,t,K(this.angle)):i}translateToOriginPoint(t,e,s){var i=this.translateToGivenOrigin(t,"center","center",e,s);return this.angle?q.rotatePoint(i,t,K(this.angle)):i}getCenterPoint(){return this.getRelativeCenterPoint()}getRelativeCenterPoint(){const t=new E(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)}getAbsCenterPoint(){const t=this.getRelativeCenterPoint(),e=this.group;return e?Z(t,e.calcTransformMatrix()):t}getPointByOrigin(t,e){var s=this.getCenterPoint();return this.translateToOriginPoint(s,t,e)}toLocalPoint(t,e,s){var i,r,n=this.getCenterPoint();return i=typeof e<"u"&&typeof s<"u"?this.translateToGivenOrigin(n,"center","center",e,s):new E(this.left,this.top),r=new E(t.x,t.y),this.angle&&(r=q.rotatePoint(r,n,-K(this.angle))),r.subtractEquals(i)}setPositionByOrigin(t,e,s){var i=this.translateToCenterPoint(t,e,s),r=this.translateToOriginPoint(i,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)}adjustPosition(t){var e,s,i=K(this.angle),r=this.getScaledWidth(),n=q.cos(i)*r,a=q.sin(i)*r;e="string"==typeof this.originX?originXOffset[this.originX]:this.originX-.5,s="string"==typeof t?originXOffset[t]:t-.5,this.left+=n*(s-e),this.top+=a*(s-e),this.setCoords(),this.originX=t}_setOriginToCenter(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var t=this.getCenterPoint();this.originX="center",this.originY="center",this.left=t.x,this.top=t.y}_resetOrigin(){var t=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=t.x,this.top=t.y,this._originalOriginX=null,this._originalOriginY=null}_getLeftTopCoords(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}},class{sendToBack(){return this.group?Qt.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this}bringToFront(){return this.group?Qt.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this}sendBackwards(t){return this.group?Qt.prototype.sendBackwards.call(this.group,this,t):this.canvas&&this.canvas.sendBackwards(this,t),this}bringForward(t){return this.group?Qt.prototype.bringForward.call(this.group,this,t):this.canvas&&this.canvas.bringForward(this,t),this}moveTo(t){return this.group&&"activeSelection"!==this.group.type?Qt.prototype.moveTo.call(this.group,this,t):this.canvas&&this.canvas.moveTo(this,t),this}},class{hasStateChanged(t){var e="_"+(t=t||lt);return Object.keys(this[e]).length<this[t].length||!dt(this[e],this,!0)}saveState(t){var e=t&&t.propertySet||lt,s="_"+e;return this[s]?(ct(this,s,this[e]),t&&t.stateProperties&&ct(this,s,t.stateProperties),this):this.setupState(t)}setupState(t){var e=(t=t||{}).propertySet||lt;return t.propertySet=e,this["_"+e]={},this.saveState(t),this}},class{constructor(){p(this,"FX_DURATION",500)}_getAngleValueForStraighten(){var t=this.angle%360;return t>0?90*Math.round((t-1)/90):90*Math.round(t/90)}straighten(){return this.rotate(this._getAngleValueForStraighten()),this}fxStraighten(t){var e=function(){},s=(t=t||{}).onComplete||e,i=t.onChange||e,r=this;return bt({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange(t){r.rotate(t),i()},onComplete(){r.setCoords(),s()}}),this}},class{getSvgStyles(t){var e=this.fillRule?this.fillRule:"nonzero",s=this.strokeWidth?this.strokeWidth:"0",i=this.strokeDashArray?this.strokeDashArray.join(" "):"none",r=this.strokeDashOffset?this.strokeDashOffset:"0",n=this.strokeLineCap?this.strokeLineCap:"butt",a=this.strokeLineJoin?this.strokeLineJoin:"miter",o=this.strokeMiterLimit?this.strokeMiterLimit:"4",h=typeof this.opacity<"u"?this.opacity:"1",l=this.visible?"":" visibility: hidden;",c=t?"":this.getSvgFilter(),d=_t("fill",this.fill);return[_t("stroke",this.stroke),"stroke-width: ",s,"; ","stroke-dasharray: ",i,"; ","stroke-linecap: ",n,"; ","stroke-dashoffset: ",r,"; ","stroke-linejoin: ",a,"; ","stroke-miterlimit: ",o,"; ",d,"fill-rule: ",e,"; ","opacity: ",h,";",c,l].join("")}getSvgSpanStyles(t,e){var s="; ",i=t.fontFamily?"font-family: "+(-1===t.fontFamily.indexOf("'")&&-1===t.fontFamily.indexOf('"')?"'"+t.fontFamily+"'":t.fontFamily)+s:"",r=t.strokeWidth?"stroke-width: "+t.strokeWidth+s:"",n=t.fontSize?"font-size: "+t.fontSize+"px"+s:"",a=t.fontStyle?"font-style: "+t.fontStyle+s:"",o=t.fontWeight?"font-weight: "+t.fontWeight+s:"",h=t.fill?_t("fill",t.fill):"",l=t.stroke?_t("stroke",t.stroke):"",c=this.getSvgTextDecoration(t);return c&&(c="text-decoration: "+c+s),[l,r,i,n,a,o,c,h,t.deltaY?"baseline-shift: "+-t.deltaY+"; ":"",e?"white-space: pre; ":""].join("")}getSvgTextDecoration(t){return["overline","underline","line-through"].filter((function(e){return t[e.replace("-","")]})).join(" ")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""}getSvgCommons(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")}getSvgTransform(t,e){var s=t?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+q.matrixToSVG(s)+(e||"")+'" '}_setSVGBg(t){if(this.backgroundColor){var e=Ue.NUM_FRACTION_DIGITS;t.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',Ot(-this.width/2,e),'" y="',Ot(-this.height/2,e),'" width="',Ot(this.width,e),'" height="',Ot(this.height,e),'"></rect>\n')}}toSVG(t){return this._createBaseSVGMarkup(this._toSVG(t),{reviver:t})}toClipPathSVG(t){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(t),{reviver:t})}_createBaseClipPathSVGMarkup(t,e){var s=(e=e||{}).reviver,i=e.additionalTransform||"",r=[this.getSvgTransform(!0,i),this.getSvgCommons()].join(""),n=t.indexOf("COMMON_PARTS");return t[n]=r,s?s(t.join("")):t.join("")}_createBaseSVGMarkup(t,e){var s,i,r=(e=e||{}).noStyle,n=e.reviver,a=r?"":'style="'+this.getSvgStyles()+'" ',o=e.withShadow?'style="'+this.getSvgFilter()+'" ':"",h=this.clipPath,l=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",c=h&&h.absolutePositioned,d=this.stroke,u=this.fill,p=this.shadow,g=[],f=t.indexOf("COMMON_PARTS"),_=e.additionalTransform;return h&&(h.clipPathId="CLIPPATH_"+Ue.__uid++,i='<clipPath id="'+h.clipPathId+'" >\n'+h.toClipPathSVG(n)+"</clipPath>\n"),c&&g.push("<g ",o,this.getSvgCommons()," >\n"),g.push("<g ",this.getSvgTransform(!1),c?"":o+this.getSvgCommons()," >\n"),s=[a,l,r?"":this.addPaintOrder()," ",_?'transform="'+_+'" ':""].join(""),t[f]=s,u&&u.toLive&&g.push(u.toSVG(this)),d&&d.toLive&&g.push(d.toSVG(this)),p&&g.push(p.toSVG(this)),h&&g.push(i),g.push(t.join("")),g.push("</g>\n"),c&&g.push("</g>\n"),n?n(g.join("")):g.join("")}addPaintOrder(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}}]),(Ve=Ue.prototype.controls).ml=new Ce({x:-.5,y:0,cursorStyleHandler:ke,actionHandler:Re,getActionName:Le}),Ve.mr=new Ce({x:.5,y:0,cursorStyleHandler:ke,actionHandler:Re,getActionName:Le}),Ve.mb=new Ce({x:0,y:.5,cursorStyleHandler:ke,actionHandler:je,getActionName:Le}),Ve.mt=new Ce({x:0,y:-.5,cursorStyleHandler:ke,actionHandler:je,getActionName:Le}),Ve.tl=new Ce({x:-.5,y:-.5,cursorStyleHandler:Ee,actionHandler:Pe}),Ve.tr=new Ce({x:.5,y:-.5,cursorStyleHandler:Ee,actionHandler:Pe}),Ve.bl=new Ce({x:-.5,y:.5,cursorStyleHandler:Ee,actionHandler:Pe}),Ve.br=new Ce({x:.5,y:.5,cursorStyleHandler:Ee,actionHandler:Pe}),Ve.mtr=new Ce({x:0,y:-.5,actionHandler:we.rotationWithSnapping,cursorStyleHandler:we.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"});const Ge=ot.clone,qe=w.min,Je=w.max;class Ke extends Ue{constructor(t,e,s){super(),p(this,"type","group"),p(this,"strokeWidth",0),p(this,"subTargetCheck",!1),p(this,"cacheProperties",[]),p(this,"useSetOnGroup",!1),this.initialize(t,e,s)}initialize(t,e,s){const i=e=e||{},{centerPoint:r}=i,n=u(i,["centerPoint"]),a=t||[];this._objects=[...a];for(var o=this._objects.length;o--;)this._objects[o].group=this;if(s)this._updateObjectsACoords();else{var h=e&&r;void 0!==e.originX&&(this.originX=e.originX),void 0!==e.originY&&(this.originY=e.originY),h||this._calcBounds(),this._updateObjectsCoords(h),this.setOptions(n)}this.setCoords()}_updateObjectsACoords(){for(var t=this._objects.length;t--;)this._objects[t].setCoords(!0)}_updateObjectsCoords(t){t=t||this.getCenterPoint();for(var e=this._objects.length;e--;)this._updateObjectCoords(this._objects[e],t)}_updateObjectCoords(t,e){var s=t.left,i=t.top;t.set({left:s-e.x,top:i-e.y}),t.group=this,t.setCoords(!0)}toString(){return"#<Group: ("+this.complexity()+")>"}addWithUpdate(t){var e=!!this.group;return this._restoreObjectsState(),q.resetObjectTransform(this),t&&(e&&q.removeTransformFromObject(t,this.group.calcTransformMatrix()),this._objects.push(t),t.group=this,t._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,e?this.group.addWithUpdate():this.setCoords(),this}removeWithUpdate(t){return this._restoreObjectsState(),q.resetObjectTransform(this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this}_onObjectAdded(t){this.dirty=!0,t.group=this,t._set("canvas",this.canvas)}_onObjectRemoved(t){this.dirty=!0,delete t.group}_set(t,e){var s=this._objects.length;if(this.useSetOnGroup)for(;s--;)this._objects[s].setOnGroup(t,e);if("canvas"===t)for(;s--;)this._objects[s]._set(t,e);return super._set.call(this,t,e)}toObject(t){var e=this.includeDefaultValues,s=this._objects.filter((function(t){return!t.excludeFromExport})).map((function(s){var i=s.includeDefaultValues;s.includeDefaultValues=e;var r=s.toObject(t);return s.includeDefaultValues=i,r})),i=super.toObject.call(this,t);return i.objects=s,i}toDatalessObject(t){var e,s=this.sourcePath;if(s)e=s;else{var i=this.includeDefaultValues;e=this._objects.map((function(e){var s=e.includeDefaultValues;e.includeDefaultValues=i;var r=e.toDatalessObject(t);return e.includeDefaultValues=s,r}))}var r=super.toDatalessObject.call(this,t);return r.objects=e,r}render(t){this._transformDone=!0,super.render(t),this._transformDone=!1}shouldCache(){var t=super.shouldCache.call(this);if(t)for(var e=0,s=this._objects.length;e<s;e++)if(this._objects[e].willDrawShadow())return this.ownCaching=!1,!1;return t}willDrawShadow(){if(super.willDrawShadow.call(this))return!0;for(var t=0,e=this._objects.length;t<e;t++)if(this._objects[t].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||this.group&&this.group.isOnACache()}drawObject(t){for(var e=0,s=this._objects.length;e<s;e++)this._objects[e].render(t);this._drawClipPath(t)}isCacheDirty(t){if(super.isCacheDirty(t))return!0;if(!this.statefullCache)return!1;for(var e=0,s=this._objects.length;e<s;e++)if(this._objects[e].isCacheDirty(!0)){if(this._cacheCanvas){var i=this.cacheWidth/this.zoomX,r=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-i/2,-r/2,i,r)}return!0}return!1}_restoreObjectsState(){var t=this.calcOwnMatrix();return this._objects.forEach((function(e){q.addTransformToObject(e,t),delete e.group,e.setCoords()})),this}realizeTransform(t,e){return q.addTransformToObject(t,e),t}destroy(){return this._objects.forEach((function(t){t.set("dirty",!0)})),this._restoreObjectsState()}ungroupOnCanvas(){return this._restoreObjectsState()}setObjectsCoords(){return this.forEachObject((function(t){t.setCoords(!0)})),this}_calcBounds(t){for(var e,s,i,r,n=[],a=[],o=["tr","br","bl","tl"],h=0,l=this._objects.length,c=o.length;h<l;++h){for(i=(e=this._objects[h]).calcACoords(),r=0;r<c;r++)s=o[r],n.push(i[s].x),a.push(i[s].y);e.aCoords=i}this._getBounds(n,a,t)}_getBounds(t,e,s){var i=new E(qe(t),qe(e)),r=new E(Je(t),Je(e)),n=i.y||0,a=i.x||0,o=r.x-i.x||0,h=r.y-i.y||0;this.width=o,this.height=h,s||this.setPositionByOrigin({x:a,y:n},"left","top")}_toSVG(t){for(var e=["<g ","COMMON_PARTS"," >\n"],s=0,i=this._objects.length;s<i;s++)e.push("\t\t",this._objects[s].toSVG(t));return e.push("</g>\n"),e}getSvgStyles(){var t=typeof this.opacity<"u"&&1!==this.opacity?"opacity: "+this.opacity+";":"",e=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),e].join("")}toClipPathSVG(t){for(var e=[],s=0,i=this._objects.length;s<i;s++)e.push("\t",this._objects[s].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(e,{reviver:t})}}k(Ke,[xt]);class Ze extends Ke{constructor(t,e){super(t,e),p(this,"type","activeSelection")}toGroup(){var t=this._objects.concat();this._objects=[];var e=Ue.prototype.toObject.call(this),s=new Ke([]);if(delete e.type,s.set(e),t.forEach((function(t){t.canvas.remove(t),t.group=s})),s._objects=t,!this.canvas)return s;var i=this.canvas;return i.add(s),i._activeObject=s,s.setCoords(),s}onDeselect(){return this.destroy(),!1}toString(){return"#<ActiveSelection: ("+this.complexity()+")>"}shouldCache(){return!1}isOnACache(){return!1}_renderControls(t,e,s){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,super._renderControls(t,e),typeof(s=s||{}).hasControls>"u"&&(s.hasControls=!1),s.forActiveSelection=!0;for(var i=0,r=this._objects.length;i<r;i++)this._objects[i]._renderControls(t,s);t.restore()}}ot.extend,ot.clone;var Qe=Array.prototype.join,$e={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},ts={m:"l",M:"L"};function es(t,e,s,i,r,n,a,o,h,l,c){var d=q.cos(t),u=q.sin(t),p=q.cos(e),g=q.sin(e),f=s*r*p-i*n*g+a,_=i*r*p+s*n*g+o;return["C",l+h*(-s*r*u-i*n*d),c+h*(-i*r*u+s*n*d),f+h*(s*r*g+i*n*p),_+h*(i*r*g-s*n*p),f,_]}function ss(t,e,s,i,r,n,a){var o=Math.PI,h=a*o/180,l=q.sin(h),c=q.cos(h),d=0,u=0,p=-c*t*.5-l*e*.5,g=-c*e*.5+l*t*.5,f=(s=Math.abs(s))*s,_=(i=Math.abs(i))*i,O=g*g,m=p*p,v=f*_-f*O-_*m,b=0;if(v<0){var y=Math.sqrt(1-v/(f*_));s*=y,i*=y}else b=(r===n?-1:1)*Math.sqrt(v/(f*O+_*m));var A=b*s*g/i,T=-b*i*p/s,S=c*A-l*T+.5*t,w=l*A+c*T+.5*e,x=is(1,0,(p-A)/s,(g-T)/i),I=is((p-A)/s,(g-T)/i,(-p-A)/s,(-g-T)/i);0===n&&I>0?I-=2*o:1===n&&I<0&&(I+=2*o);for(var C=Math.ceil(Math.abs(I/o*2)),k=[],E=I/C,P=8/3*Math.sin(E/4)*Math.sin(E/4)/Math.sin(E/2),j=x+E,R=0;R<C;R++)k[R]=es(x,j,c,l,s,i,S,w,P,d,u),d=k[R][5],u=k[R][6],x=j,j+=E;return k}function is(t,e,s,i){var r=Math.atan2(e,t),n=Math.atan2(i,s);return n>=r?n-r:2*Math.PI-(r-n)}function rs(t,e,s,i,r,n,a,o){let h;const l=H.boundsOfCurveCache;if(l&&(h=Qe.call(arguments),l.has(h)))return l.get(h);var c,d,u,p,g,f,_,O,m=Math.sqrt,v=Math.min,b=Math.max,y=Math.abs,A=[],T=[[],[]];d=6*t-12*s+6*r,c=-3*t+9*s-9*r+3*a,u=3*s-3*t;for(var S=0;S<2;++S)if(S>0&&(d=6*e-12*i+6*n,c=-3*e+9*i-9*n+3*o,u=3*i-3*e),y(c)<1e-12){if(y(d)<1e-12)continue;0<(p=-u/d)&&p<1&&A.push(p)}else!((_=d*d-4*u*c)<0)&&(0<(g=(-d+(O=m(_)))/(2*c))&&g<1&&A.push(g),0<(f=(-d-O)/(2*c))&&f<1&&A.push(f));for(var w,x,I,C=A.length,k=C;C--;)w=(I=1-(p=A[C]))*I*I*t+3*I*I*p*s+3*I*p*p*r+p*p*p*a,T[0][C]=w,x=I*I*I*e+3*I*I*p*i+3*I*p*p*n+p*p*p*o,T[1][C]=x;T[0][k]=t,T[1][k]=e,T[0][k+1]=a,T[1][k+1]=o;var E=[{x:v.apply(null,T[0]),y:v.apply(null,T[1])},{x:b.apply(null,T[0]),y:b.apply(null,T[1])}];return l&&l.set(h,E),E}function ns(t,e,s){for(var i=s[1],r=s[2],n=s[3],a=s[4],o=s[5],h=ss(s[6]-t,s[7]-e,i,r,a,o,n),l=0,c=h.length;l<c;l++)h[l][1]+=t,h[l][2]+=e,h[l][3]+=t,h[l][4]+=e,h[l][5]+=t,h[l][6]+=e;return h}function as(t,e,s,i){return Math.sqrt((s-t)*(s-t)+(i-e)*(i-e))}function os(t,e,s,i,r,n,a,o){return function(h){var l=function(t){return t*t*t}(h),c=function(t){return 3*t*t*(1-t)}(h),d=function(t){return 3*t*(1-t)*(1-t)}(h),u=function(t){return(1-t)*(1-t)*(1-t)}(h);return{x:a*l+r*c+s*d+t*u,y:o*l+n*c+i*d+e*u}}}function hs(t,e,s,i,r,n,a,o){return function(h){var l=1-h,c=3*l*l*(s-t)+6*l*h*(r-s)+3*h*h*(a-r),d=3*l*l*(i-e)+6*l*h*(n-i)+3*h*h*(o-n);return Math.atan2(d,c)}}function ls(t,e,s,i,r,n){return function(a){var o=function(t){return t*t}(a),h=function(t){return 2*t*(1-t)}(a),l=function(t){return(1-t)*(1-t)}(a);return{x:r*o+s*h+t*l,y:n*o+i*h+e*l}}}function cs(t,e,s,i,r,n){return function(a){var o=1-a,h=2*o*(s-t)+2*a*(r-s),l=2*o*(i-e)+2*a*(n-i);return Math.atan2(l,h)}}function ds(t,e,s){var i,r,n={x:e,y:s},a=0;for(r=1;r<=100;r+=1)i=t(r/100),a+=as(n.x,n.y,i.x,i.y),n=i;return a}function us(t){for(var e,s,i,r,n=0,a=t.length,o=0,h=0,l=0,c=0,d=[],u=0;u<a;u++){switch(i={x:o,y:h,command:(e=t[u])[0]},e[0]){case"M":i.length=0,l=o=e[1],c=h=e[2];break;case"L":i.length=as(o,h,e[1],e[2]),o=e[1],h=e[2];break;case"C":s=os(o,h,e[1],e[2],e[3],e[4],e[5],e[6]),r=hs(o,h,e[1],e[2],e[3],e[4],e[5],e[6]),i.iterator=s,i.angleFinder=r,i.length=ds(s,o,h),o=e[5],h=e[6];break;case"Q":s=ls(o,h,e[1],e[2],e[3],e[4]),r=cs(o,h,e[1],e[2],e[3],e[4]),i.iterator=s,i.angleFinder=r,i.length=ds(s,o,h),o=e[3],h=e[4];break;case"Z":case"z":i.destX=l,i.destY=c,i.length=as(o,h,l,c),o=l,h=c}n+=i.length,d.push(i)}return d.push({length:n,x:o,y:h}),d}const ps={joinPath:function(t){return t.map((function(t){return t.join(" ")})).join(" ")},parsePath:function(t){var e,s,i,r,n,a=[],o=[],h=H.rePathCommand,l="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",c="("+l+")"+H.commaWsp,d="([01])"+H.commaWsp+"?",u=new RegExp(c+"?"+c+"?"+c+d+d+c+"?("+l+")","g");if(!t||!t.match)return a;for(var p,g=0,f=(n=t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;g<f;g++){r=(e=n[g]).slice(1).trim(),o.length=0;var _=e.charAt(0);if(p=[_],"a"===_.toLowerCase())for(var O;O=u.exec(r);)for(var m=1;m<O.length;m++)o.push(O[m]);else for(;i=h.exec(r);)o.push(i[0]);m=0;for(var v=o.length;m<v;m++)s=parseFloat(o[m]),isNaN(s)||p.push(s);var b=$e[_.toLowerCase()],y=ts[_]||_;if(p.length-1>b)for(var A=1,T=p.length;A<T;A+=b)a.push([_].concat(p.slice(A,A+b))),_=y;else a.push(p)}return a},makePathSimpler:function(t){var e,s,i,r,n,a,o=0,h=0,l=t.length,c=0,d=0,u=[];for(s=0;s<l;++s){switch(i=!1,(e=t[s].slice(0))[0]){case"l":e[0]="L",e[1]+=o,e[2]+=h;case"L":o=e[1],h=e[2];break;case"h":e[1]+=o;case"H":e[0]="L",e[2]=h,o=e[1];break;case"v":e[1]+=h;case"V":e[0]="L",h=e[1],e[1]=o,e[2]=h;break;case"m":e[0]="M",e[1]+=o,e[2]+=h;case"M":o=e[1],h=e[2],c=e[1],d=e[2];break;case"c":e[0]="C",e[1]+=o,e[2]+=h,e[3]+=o,e[4]+=h,e[5]+=o,e[6]+=h;case"C":n=e[3],a=e[4],o=e[5],h=e[6];break;case"s":e[0]="S",e[1]+=o,e[2]+=h,e[3]+=o,e[4]+=h;case"S":"C"===r?(n=2*o-n,a=2*h-a):(n=o,a=h),o=e[3],h=e[4],e[0]="C",e[5]=e[3],e[6]=e[4],e[3]=e[1],e[4]=e[2],e[1]=n,e[2]=a,n=e[3],a=e[4];break;case"q":e[0]="Q",e[1]+=o,e[2]+=h,e[3]+=o,e[4]+=h;case"Q":n=e[1],a=e[2],o=e[3],h=e[4];break;case"t":e[0]="T",e[1]+=o,e[2]+=h;case"T":"Q"===r?(n=2*o-n,a=2*h-a):(n=o,a=h),e[0]="Q",o=e[1],h=e[2],e[1]=n,e[2]=a,e[3]=o,e[4]=h;break;case"a":e[0]="A",e[6]+=o,e[7]+=h;case"A":i=!0,u=u.concat(ns(o,h,e)),o=e[6],h=e[7];break;case"z":case"Z":o=c,h=d}i||u.push(e),r=e[0]}return u},getSmoothPathFromPoints:function(t,e){var s,i=[],r=new E(t[0].x,t[0].y),n=new E(t[1].x,t[1].y),a=t.length,o=1,h=0,l=a>2;for(e=e||0,l&&(o=t[2].x<n.x?-1:t[2].x===n.x?0:1,h=t[2].y<n.y?-1:t[2].y===n.y?0:1),i.push(["M",r.x-o*e,r.y-h*e]),s=1;s<a;s++){if(!r.eq(n)){var c=r.midPointFrom(n);i.push(["Q",r.x,r.y,c.x,c.y])}r=t[s],s+1<t.length&&(n=t[s+1])}return l&&(o=r.x>t[s-2].x?1:r.x===t[s-2].x?0:-1,h=r.y>t[s-2].y?1:r.y===t[s-2].y?0:-1),i.push(["L",r.x+o*e,r.y+h*e]),i},getPathSegmentsInfo:us,getBoundsOfCurve:rs,getPointOnPath:function(t,e,s){s||(s=us(t));for(var i=0;e-s[i].length>0&&i<s.length-2;)e-=s[i].length,i++;var r,n=s[i],a=e/n.length,o=n.command,h=t[i];switch(o){case"M":return{x:n.x,y:n.y,angle:0};case"Z":case"z":return(r=new E(n.x,n.y).lerp(new E(n.destX,n.destY),a)).angle=Math.atan2(n.destY-n.y,n.destX-n.x),r;case"L":return(r=new E(n.x,n.y).lerp(new E(h[1],h[2]),a)).angle=Math.atan2(h[2]-n.y,h[1]-n.x),r;case"C":case"Q":return function(t,e){for(var s,i,r,n=0,a=0,o=t.iterator,h={x:t.x,y:t.y},l=.01,c=t.angleFinder;a<e&&n<=1&&l>1e-4;)s=o(n),r=n,(i=as(h.x,h.y,s.x,s.y))+a>e?n-=l/=2:(h=s,n+=l,a+=i);return s.angle=c(r),s}(n,e)}},transformPath:function(t,e,s){return s&&(e=q.multiplyTransformMatrices(e,[1,0,0,1,-s.x,-s.y])),t.map((function(t){for(var s=t.slice(0),i=new E(0,0),r=1;r<t.length-1;r+=2)i.x=t[r],i.y=t[r+1],i=q.transformPoint(i,e),s[r]=i.x,s[r+1]=i.y;return s}))},getBoundsOfArc:function(t,e,s,i,r,n,a,o,h){for(var l,c=0,d=0,u=[],p=ss(o-t,h-e,s,i,n,a,r),g=0,f=p.length;g<f;g++)l=rs(c,d,p[g][1],p[g][2],p[g][3],p[g][4],p[g][5],p[g][6]),u.push({x:l[0].x+t,y:l[0].y+e}),u.push({x:l[1].x+t,y:l[1].y+e}),c=p[g][5],d=p[g][6];return u},drawArc:function(t,e,s,i){ns(e,s,i=i.slice(0).unshift("X")).forEach((function(e){t.bezierCurveTo.apply(t,e.slice(1))}))}};class gs extends Ue{constructor(t,e){e=e||{},super(),p(this,"type","polyline"),p(this,"points",null),p(this,"cacheProperties",Ue.prototype.cacheProperties.concat("points")),this.points=t||[],this.setOptions(e),this._setPositionDimensions(e)}_setPositionDimensions(t){var e,s=this._calcDimensions();this.width=s.width,this.height=s.height,t.fromSVG||(e=this.translateToGivenOrigin({x:s.left-this.strokeWidth/2,y:s.top-this.strokeWidth/2},"left","top",this.originX,this.originY)),typeof t.left>"u"&&(this.left=t.fromSVG?s.left:e.x),typeof t.top>"u"&&(this.top=t.fromSVG?s.top:e.y),this.pathOffset={x:s.left+this.width/2,y:s.top+this.height/2}}_calcDimensions(){var t=this.points,e=w.min(t,"x")||0,s=w.min(t,"y")||0;return{left:e,top:s,width:(w.max(t,"x")||0)-e,height:(w.max(t,"y")||0)-s}}toObject(t){return ot.extend(super.toObject(t),{points:this.points.concat()})}_toSVG(){for(var t=[],e=this.pathOffset.x,s=this.pathOffset.y,i=Ue.NUM_FRACTION_DIGITS,r=0,n=this.points.length;r<n;r++)t.push(q.toFixed(this.points[r].x-e,i),",",q.toFixed(this.points[r].y-s,i)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',t.join(""),'" />\n']}commonRender(t){var e,s=this.points.length,i=this.pathOffset.x,r=this.pathOffset.y;if(!s||isNaN(this.points[s-1].y))return!1;t.beginPath(),t.moveTo(this.points[0].x-i,this.points[0].y-r);for(var n=0;n<s;n++)e=this.points[n],t.lineTo(e.x-i,e.y-r);return!0}_render(t){this.commonRender(t)&&this._renderPaintInOrder(t)}complexity(){return this.get("points").length}}const fs=w.min,_s=w.max,Os=ot.extend,ms=Object.prototype.toString,vs=q.toFixed;class bs extends Ue{constructor(t,e){e=e||{},super(),p(this,"type","path"),p(this,"path",null),p(this,"cacheProperties",Ue.prototype.cacheProperties.concat("path","fillRule")),p(this,"stateProperties",Ue.prototype.stateProperties.concat("path")),this.setOptions(e),this.initialize(t,e)}initialize(t,e){e=e||{},t||(t=[]);var s="[object Array]"===ms.call(t);this.path=ps.makePathSimpler(s?t:ps.parsePath(t)),this.path&&gs.prototype._setPositionDimensions.call(this,e)}_renderPathCommands(t){var e,s=0,i=0,r=0,n=0,a=0,o=0,h=-this.pathOffset.x,l=-this.pathOffset.y;t.beginPath();for(var c=0,d=this.path.length;c<d;++c)switch(e=this.path[c],e[0]){case"L":r=e[1],n=e[2],t.lineTo(r+h,n+l);break;case"M":s=r=e[1],i=n=e[2],t.moveTo(r+h,n+l);break;case"C":r=e[5],n=e[6],a=e[3],o=e[4],t.bezierCurveTo(e[1]+h,e[2]+l,a+h,o+l,r+h,n+l);break;case"Q":t.quadraticCurveTo(e[1]+h,e[2]+l,e[3]+h,e[4]+l),r=e[3],n=e[4],a=e[1],o=e[2];break;case"z":case"Z":r=s,n=i,t.closePath()}}_render(t){this._renderPathCommands(t),this._renderPaintInOrder(t)}toString(){return"#<Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"}toObject(t){return Os(super.toObject(t),{path:this.path.map((function(t){return t.slice()}))})}toDatalessObject(t){var e=this.toObject(["sourcePath"].concat(t));return e.sourcePath&&delete e.path,e}_toSVG(){return["<path ","COMMON_PARTS",'d="',ps.joinPath(this.path),'" stroke-linecap="round" ',"/>\n"]}_getOffsetTransform(){var t=Ue.NUM_FRACTION_DIGITS;return" translate("+vs(-this.pathOffset.x,t)+", "+vs(-this.pathOffset.y,t)+")"}toClipPathSVG(t){var e=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}toSVG(t){var e=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}complexity(){return this.path.length}_calcDimensions(){for(var t,e,s=[],i=[],r=0,n=0,a=0,o=0,h=0,l=this.path.length;h<l;++h){switch((t=this.path[h])[0]){case"L":a=t[1],o=t[2],e=[];break;case"M":r=a=t[1],n=o=t[2],e=[];break;case"C":e=ps.getBoundsOfCurve(a,o,t[1],t[2],t[3],t[4],t[5],t[6]),a=t[5],o=t[6];break;case"Q":e=ps.getBoundsOfCurve(a,o,t[1],t[2],t[1],t[2],t[3],t[4]),a=t[3],o=t[4];break;case"z":case"Z":a=r,o=n}e.forEach((function(t){s.push(t.x),i.push(t.y)})),s.push(a),i.push(o)}var c=fs(s)||0,d=fs(i)||0;return{left:c,top:d,width:(_s(s)||0)-c,height:(_s(i)||0)-d}}}const ys=ot.extend,As=class t extends Ue{constructor(t,e){e||(e={}),super(),p(this,"type","image"),p(this,"strokeWidth",0),p(this,"srcFromAttribute",!1),p(this,"_lastScaleX",1),p(this,"_lastScaleY",1),p(this,"_filterScalingX",1),p(this,"_filterScalingY",1),p(this,"minimumScaleTrigger",.5),p(this,"stateProperties",Ue.prototype.stateProperties.concat("cropX","cropY")),p(this,"cacheProperties",Ue.prototype.cacheProperties.concat("cropX","cropY")),p(this,"cacheKey",""),p(this,"cropX",0),p(this,"cropY",0),p(this,"imageSmoothing",!0),this.setOptions(e),this.filters=[],this.cacheKey="texture"+Ue.__uid++,this._initElement(t,e)}getElement(){return this._element||{}}setElement(t,e){return this._element=t,this._originalElement=t,this._initConfig(e),this}dispose(){this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(t){zt.cleanUpJsdomNode(this[t]),this[t]=void 0}.bind(this))}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){var t=this.getElement();return{width:t.naturalWidth||t.width,height:t.naturalHeight||t.height}}_stroke(t){if(this.stroke&&0!==this.strokeWidth){var e=this.width/2,s=this.height/2;t.beginPath(),t.moveTo(-e,-s),t.lineTo(e,-s),t.lineTo(e,s),t.lineTo(-e,s),t.lineTo(-e,-s),t.closePath()}}toObject(t){var e=[];return this.filters.forEach((function(t){t&&e.push(t.toObject())})),ys(super.toObject(["cropX","cropY"].concat(t)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:e})}hasCrop(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){var t,e=[],s=[],i=this._element,r=-this.width/2,n=-this.height/2,a="",o="";if(!i)return[];if(this.hasCrop()){var h=Ue.__uid++;e.push('<clipPath id="imageCrop_'+h+'">\n','\t<rect x="'+r+'" y="'+n+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),a=' clip-path="url(#imageCrop_'+h+')" '}if(this.imageSmoothing||(o='" image-rendering="optimizeSpeed'),s.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',r-this.cropX,'" y="',n-this.cropY,'" width="',i.width||i.naturalWidth,'" height="',i.height||i.height,o,'"',a,"></image>\n"),this.stroke||this.strokeDashArray){var l=this.fill;this.fill=null,t=["\t<rect ",'x="',r,'" y="',n,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=l}return"fill"!==this.paintFirst?e.concat(t,s):e.concat(s,t)}getSrc(t){var e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():this.srcFromAttribute?e.getAttribute("src"):e.src:this.src||""}setSrc(t,e,s){return q.loadImage(t,(function(t,i){this.setElement(t,s),this._setWidthHeight(),e&&e(this,i)}),this,s&&s.crossOrigin),this}toString(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'}_render(t){zt.setImageSmoothing(t,this.imageSmoothing),this._stroke(t),this._renderPaintInOrder(t)}drawCacheOnCanvas(t){zt.setImageSmoothing(t,this.imageSmoothing),Ue.prototype.drawCacheOnCanvas.call(this,t)}shouldCache(){return this.needsItsOwnCache()}_renderFill(t){var e=this._element;if(e){var s=this._filterScalingX,i=this._filterScalingY,r=this.width,n=this.height,a=Math.min,o=Math.max,h=o(this.cropX,0),l=o(this.cropY,0),c=e.naturalWidth||e.width||0,d=e.naturalHeight||e.height||0,u=h*s,p=l*i,g=a(r*s,c-u),f=a(n*i,d-p),_=-r/2,O=-n/2,m=a(r,c/s-h),v=a(n,d/i-l);e&&t.drawImage(e,u,p,g,f,_,O,m,v)}}_needsResize(){var t=this.getTotalObjectScaling();return t.scaleX!==this._lastScaleX||t.scaleY!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_initElement(e,s){this.setElement(zt.getById(e),s),zt.addClass(this.getElement(),t.CSS_CANVAS)}_initConfig(t){t||(t={}),this.setOptions(t),this._setWidthHeight(t)}_setWidthHeight(t){t||(t={});var e=this.getElement();this.width=t.width||e.naturalWidth||e.width||0,this.height=t.height||e.naturalHeight||e.height||0}parsePreserveAspectRatioAttribute(){var t,e=q.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),s=this._element.width,i=this._element.height,r=1,n=1,a=0,o=0,h=0,l=0,c=this.width,d=this.height,u={width:c,height:d};return!e||"none"===e.alignX&&"none"===e.alignY?(r=c/s,n=d/i):("meet"===e.meetOrSlice&&(t=(c-s*(r=n=q.findScaleToFit(this._element,u)))/2,"Min"===e.alignX&&(a=-t),"Max"===e.alignX&&(a=t),t=(d-i*n)/2,"Min"===e.alignY&&(o=-t),"Max"===e.alignY&&(o=t)),"slice"===e.meetOrSlice&&(t=s-c/(r=n=q.findScaleToCover(this._element,u)),"Mid"===e.alignX&&(h=t/2),"Max"===e.alignX&&(h=t),t=i-d/n,"Mid"===e.alignY&&(l=t/2),"Max"===e.alignY&&(l=t),s=c/r,i=d/n)),{width:s,height:i,scaleX:r,scaleY:n,offsetLeft:a,offsetTop:o,cropX:h,cropY:l}}};As.prototype.getSvgSrc=As.prototype.getSrc,p(As,"CSS_CANVAS","canvas-img"),p(As,"fromURL",(function(t,e,s){q.loadImage(t,(function(t,i){e&&e(new As(t,s),i)}),null,s&&s.crossOrigin)}));let Ts=As;const Ss=q.toFixed,ws=/  +/g,xs=ot.clone;var Is="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide".split(" ");const Cs=class t extends Ue{constructor(t,e){super(),p(this,"_reNewline",/\r?\n/),p(this,"_reSpacesAndTabs",/[ \t\r]/g),p(this,"_reSpaceAndTab",/[ \t\r]/),p(this,"_reWords",/\S+/g),p(this,"type","text"),p(this,"fontSize",40),p(this,"fontWeight","normal"),p(this,"fontFamily","Times New Roman"),p(this,"underline",!1),p(this,"overline",!1),p(this,"linethrough",!1),p(this,"textAlign","left"),p(this,"fontStyle","normal"),p(this,"lineHeight",1.16),p(this,"superscript",{size:.6,baseline:-.35}),p(this,"subscript",{size:.6,baseline:.11}),p(this,"textBackgroundColor",""),p(this,"stateProperties",Ue.prototype.stateProperties.concat(Is)),p(this,"cacheProperties",Ue.prototype.cacheProperties.concat(Is)),p(this,"stroke",null),p(this,"shadow",null),p(this,"path",null),p(this,"pathStartOffset",0),p(this,"pathSide","left"),p(this,"_fontSizeFraction",.222),p(this,"offsets",{underline:.1,linethrough:-.315,overline:-.88}),p(this,"_fontSizeMult",1.13),p(this,"charSpacing",0),p(this,"styles",null),p(this,"_measuringContext",null),p(this,"deltaY",0),p(this,"direction","ltr"),p(this,"_styleProperties",["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"]),p(this,"__charBounds",[]),p(this,"CACHE_FONT_SIZE",400),p(this,"MIN_TEXT_WIDTH",2),p(this,"isText",!0),this.styles=e&&e.styles||{},this.text=t,this.__skipDimension=!0,this.setOptions(e),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})}static get DEFAULT_SVG_FONT_SIZE(){return j.DEFAULT_SVG_FONT_SIZE}static set DEFAULT_SVG_FONT_SIZE(t){j.DEFAULT_SVG_FONT_SIZE=t}initialize(t,e){}setPathInfo(){var t=this.path;t&&(t.segmentsInfo=ps.getPathSegmentsInfo(t.path))}getMeasuringContext(){return H._measuringContext||(H._measuringContext=this.canvas&&this.canvas.contextCache||q.createCanvasElement().getContext("2d")),H._measuringContext}_splitText(){var t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t}initDimensions(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))}enlargeSpaces(){for(var t,e,s,i,r,n,a,o=0,h=this._textLines.length;o<h;o++)if(("justify"===this.textAlign||o!==h-1&&!this.isEndOfWrapping(o))&&(i=0,r=this._textLines[o],(e=this.getLineWidth(o))<this.width&&(a=this.textLines[o].match(this._reSpacesAndTabs)))){s=a.length,t=(this.width-e)/s;for(var l=0,c=r.length;l<=c;l++)n=this.__charBounds[o][l],this._reSpaceAndTab.test(r[l])?(n.width+=t,n.kernedWidth+=t,n.left+=i,i+=t):n.left+=i}}isEndOfWrapping(t){return t===this._textLines.length-1}missingNewlineOffset(t){return 1}toString(){return"#<Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'}_getCacheCanvasDimensions(){var t=super._getCacheCanvasDimensions(),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t}_render(t){var e=this.path;e&&!e.isNotVisible()&&e._render(t),this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")}_renderText(t){"stroke"===this.paintFirst?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))}_setTextStyles(t,e,s){t.textBaseline="alphabetic",t.font=this._getFontDeclaration(e,s)}calcTextWidth(){for(var t=this.getLineWidth(0),e=1,s=this._textLines.length;e<s;e++){var i=this.getLineWidth(e);i>t&&(t=i)}return t}_renderTextLine(t,e,s,i,r,n){this._renderChars(t,e,s,i,r,n)}_renderTextLinesBackground(t){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var e,s,i,r,n,a,o,h=t.fillStyle,l=this._getLeftOffset(),c=this._getTopOffset(),d=0,u=0,p=this.path,g=0,f=this._textLines.length;g<f;g++)if(e=this.getHeightOfLine(g),this.textBackgroundColor||this.styleHas("textBackgroundColor",g)){i=this._textLines[g],s=this._getLineLeftOffset(g),u=0,d=0,r=this.getValueOfPropertyAt(g,0,"textBackgroundColor");for(var _=0,O=i.length;_<O;_++)n=this.__charBounds[g][_],a=this.getValueOfPropertyAt(g,_,"textBackgroundColor"),p?(t.save(),t.translate(n.renderLeft,n.renderTop),t.rotate(n.angle),t.fillStyle=a,a&&t.fillRect(-n.width/2,-e/this.lineHeight*(1-this._fontSizeFraction),n.width,e/this.lineHeight),t.restore()):a!==r?(o=l+s+d,"rtl"===this.direction&&(o=this.width-o-u),t.fillStyle=r,r&&t.fillRect(o,c,u,e/this.lineHeight),d=n.left,u=n.width,r=a):u+=n.kernedWidth;a&&!p&&(o=l+s+d,"rtl"===this.direction&&(o=this.width-o-u),t.fillStyle=a,t.fillRect(o,c,u,e/this.lineHeight)),c+=e}else c+=e;t.fillStyle=h,this._removeShadow(t)}}getFontCache(t){var e=t.fontFamily.toLowerCase();H.charWidthsCache[e]||(H.charWidthsCache[e]={});var s=H.charWidthsCache[e],i=t.fontStyle.toLowerCase()+"_"+(t.fontWeight+"").toLowerCase();return s[i]||(s[i]={}),s[i]}_measureChar(t,e,s,i){var r,n,a,o,h=this.getFontCache(e),l=s+t,c=this._getFontDeclaration(e)===this._getFontDeclaration(i),d=e.fontSize/this.CACHE_FONT_SIZE;if(s&&void 0!==h[s]&&(a=h[s]),void 0!==h[t]&&(o=r=h[t]),c&&void 0!==h[l]&&(o=(n=h[l])-a),void 0===r||void 0===a||void 0===n){var u=this.getMeasuringContext();this._setTextStyles(u,e,!0)}return void 0===r&&(o=r=u.measureText(t).width,h[t]=r),void 0===a&&c&&s&&(a=u.measureText(s).width,h[s]=a),c&&void 0===n&&(n=u.measureText(l).width,h[l]=n,o=n-a),{width:r*d,kernedWidth:o*d}}getHeightOfChar(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")}measureLine(t){var e=this._measureLine(t);return 0!==this.charSpacing&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e}_measureLine(t){var e,s,i,r,n,a,o=0,h=this._textLines[t],l=new Array(h.length),c=0,d=this.path,u="right"===this.pathSide;for(this.__charBounds[t]=l,e=0;e<h.length;e++)s=h[e],r=this._getGraphemeBox(s,t,e,i),l[e]=r,o+=r.kernedWidth,i=s;if(l[e]={left:r?r.left+r.width:0,width:0,kernedWidth:0,height:this.fontSize},d){switch(a=d.segmentsInfo[d.segmentsInfo.length-1].length,(n=ps.getPointOnPath(d.path,0,d.segmentsInfo)).x+=d.pathOffset.x,n.y+=d.pathOffset.y,this.textAlign){case"left":c=u?a-o:0;break;case"center":c=(a-o)/2;break;case"right":c=u?0:a-o}for(c+=this.pathStartOffset*(u?-1:1),e=u?h.length-1:0;u?e>=0:e<h.length;u?e--:e++)r=l[e],c>a?c%=a:c<0&&(c+=a),this._setGraphemeOnPath(c,r,n),c+=r.kernedWidth}return{width:o,numOfSpaces:0}}_setGraphemeOnPath(t,e,s){var i=t+e.kernedWidth/2,r=this.path,n=ps.getPointOnPath(r.path,i,r.segmentsInfo);e.renderLeft=n.x-s.x,e.renderTop=n.y-s.y,e.angle=n.angle+("right"===this.pathSide?Math.PI:0)}_getGraphemeBox(t,e,s,i,r){var n,a=this.getCompleteStyleDeclaration(e,s),o=i?this.getCompleteStyleDeclaration(e,s-1):{},h=this._measureChar(t,a,i,o),l=h.kernedWidth,c=h.width;0!==this.charSpacing&&(c+=n=this._getWidthOfCharSpacing(),l+=n);var d={width:c,left:0,height:a.fontSize,kernedWidth:l,deltaY:a.deltaY};if(s>0&&!r){var u=this.__charBounds[e][s-1];d.left=u.left+u.width+h.kernedWidth-h.width}return d}getHeightOfLine(t){if(this.__lineHeights[t])return this.__lineHeights[t];var e=this._textLines[t],s=this.getHeightOfChar(t,0);if(e)for(var i=1,r=e.length;i<r;i++)s=Math.max(this.getHeightOfChar(t,i),s);return this.__lineHeights[t]=s*this.lineHeight*this._fontSizeMult}calcTextHeight(){for(var t,e=0,s=0,i=this._textLines.length;s<i;s++)t=this.getHeightOfLine(s),e+=s===i-1?t/this.lineHeight:t;return e}_getLeftOffset(){return"ltr"===this.direction?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(t,e){t.save();for(var s=0,i=this._getLeftOffset(),r=this._getTopOffset(),n=0,a=this._textLines.length;n<a;n++){var o=this.getHeightOfLine(n),h=o/this.lineHeight,l=this._getLineLeftOffset(n);this._renderTextLine(e,t,this._textLines[n],i+l,r+s+h,n),s+=o}t.restore()}_renderTextFill(t){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(t,"fillText")}_renderTextStroke(t){(!this.stroke||0===this.strokeWidth)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())}_renderChars(t,e,s,i,r,n){var a,o,h,l,c,d=this.getHeightOfLine(n),u=-1!==this.textAlign.indexOf("justify"),p="",g=0,f=this.path,_=!u&&0===this.charSpacing&&this.isEmptyStyles(n)&&!f,O="ltr"===this.direction,m="ltr"===this.direction?1:-1;if(e.save(),r-=d*this._fontSizeFraction/this.lineHeight,_)return e.direction=O?"ltr":"rtl",e.textAlign=O?"left":"right",this._renderChar(t,e,n,0,s.join(""),i,r,d),void e.restore();for(var v=0,b=s.length-1;v<=b;v++)l=v===b||this.charSpacing||f,p+=s[v],h=this.__charBounds[n][v],0===g?(i+=m*(h.kernedWidth-h.width),g+=h.width):g+=h.kernedWidth,u&&!l&&this._reSpaceAndTab.test(s[v])&&(l=!0),l||(a=a||this.getCompleteStyleDeclaration(n,v),o=this.getCompleteStyleDeclaration(n,v+1),l=this._hasStyleChanged(a,o)),l&&(f?(e.save(),e.translate(h.renderLeft,h.renderTop),e.rotate(h.angle),this._renderChar(t,e,n,v,p,-g/2,0,d),e.restore()):(c=i,e.direction=O?"ltr":"rtl",e.textAlign=O?"left":"right",this._renderChar(t,e,n,v,p,c,r,d)),p="",a=o,i+=m*g,g=0);e.restore()}_applyPatternGradientTransformText(t){var e,s=q.createCanvasElement(),i=this.width+this.strokeWidth,r=this.height+this.strokeWidth;return s.width=i,s.height=r,(e=s.getContext("2d")).beginPath(),e.moveTo(0,0),e.lineTo(i,0),e.lineTo(i,r),e.lineTo(0,r),e.closePath(),e.translate(i/2,r/2),e.fillStyle=t.toLive(e),this._applyPatternGradientTransform(e,t),e.fill(),e.createPattern(s,"no-repeat")}handleFiller(t,e,s){var i,r;return s.toLive?"percentage"===s.gradientUnits||s.gradientTransform||s.patternTransform?(i=-this.width/2,r=-this.height/2,t.translate(i,r),t[e]=this._applyPatternGradientTransformText(s),{offsetX:i,offsetY:r}):(t[e]=s.toLive(t,this),this._applyPatternGradientTransform(t,s)):(t[e]=s,{offsetX:0,offsetY:0})}_setStrokeStyles(t,e){return t.lineWidth=e.strokeWidth,t.lineCap=this.strokeLineCap,t.lineDashOffset=this.strokeDashOffset,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,this.handleFiller(t,"strokeStyle",e.stroke)}_setFillStyles(t,e){return this.handleFiller(t,"fillStyle",e.fill)}_renderChar(t,e,s,i,r,n,a){var o,h,l=this._getStyleDeclaration(s,i),c=this.getCompleteStyleDeclaration(s,i),d="fillText"===t&&c.fill,u="strokeText"===t&&c.stroke&&c.strokeWidth;!u&&!d||(e.save(),d&&(o=this._setFillStyles(e,c)),u&&(h=this._setStrokeStyles(e,c)),e.font=this._getFontDeclaration(c),l&&l.textBackgroundColor&&this._removeShadow(e),l&&l.deltaY&&(a+=l.deltaY),d&&e.fillText(r,n-o.offsetX,a-o.offsetY),u&&e.strokeText(r,n-h.offsetX,a-h.offsetY),e.restore())}setSuperscript(t,e){return this._setScript(t,e,this.superscript)}setSubscript(t,e){return this._setScript(t,e,this.subscript)}_setScript(t,e,s){var i=this.get2DCursorLocation(t,!0),r=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"fontSize"),n=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"deltaY"),a={fontSize:r*s.size,deltaY:n+r*s.baseline};return this.setSelectionStyles(a,t,e),this}_hasStyleChanged(t,e){return t.fill!==e.fill||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth||t.fontSize!==e.fontSize||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.deltaY!==e.deltaY}_hasStyleChangedForSvg(t,e){return this._hasStyleChanged(t,e)||t.overline!==e.overline||t.underline!==e.underline||t.linethrough!==e.linethrough}_getLineLeftOffset(t){var e=this.getLineWidth(t),s=this.width-e,i=this.textAlign,r=this.direction,n=this.isEndOfWrapping(t),a=0;return"justify"===i||"justify-center"===i&&!n||"justify-right"===i&&!n||"justify-left"===i&&!n?0:("center"===i&&(a=s/2),"right"===i&&(a=s),"justify-center"===i&&(a=s/2),"justify-right"===i&&(a=s),"rtl"===r&&(a-=s),a)}_clearCache(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}_shouldClearDimensionCache(){var t=this._forceClearCache;return t||(t=this.hasStateChanged("_dimensionAffectingProps")),t&&(this.dirty=!0,this._forceClearCache=!1),t}getLineWidth(t){return this.__lineWidths[t]?this.__lineWidths[t]:(e=""===this._textLines[t]?0:this.measureLine(t).width,this.__lineWidths[t]=e,e);var e}_getWidthOfCharSpacing(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(t,e,s){var i=this._getStyleDeclaration(t,e);return i&&typeof i[s]<"u"?i[s]:this[s]}_renderTextDecoration(t,e){if(this[e]||this.styleHas(e)){for(var s,i,r,n,a,o,h,l,c,d,u,p,g,f,_,O,m=this._getLeftOffset(),v=this._getTopOffset(),b=this.path,y=this._getWidthOfCharSpacing(),A=this.offsets[e],T=0,S=this._textLines.length;T<S;T++)if(s=this.getHeightOfLine(T),this[e]||this.styleHas(e,T)){h=this._textLines[T],f=s/this.lineHeight,n=this._getLineLeftOffset(T),d=0,u=0,l=this.getValueOfPropertyAt(T,0,e),O=this.getValueOfPropertyAt(T,0,"fill"),c=v+f*(1-this._fontSizeFraction),i=this.getHeightOfChar(T,0),a=this.getValueOfPropertyAt(T,0,"deltaY");for(var w=0,x=h.length;w<x;w++)if(p=this.__charBounds[T][w],g=this.getValueOfPropertyAt(T,w,e),_=this.getValueOfPropertyAt(T,w,"fill"),r=this.getHeightOfChar(T,w),o=this.getValueOfPropertyAt(T,w,"deltaY"),b&&g&&_)t.save(),t.fillStyle=O,t.translate(p.renderLeft,p.renderTop),t.rotate(p.angle),t.fillRect(-p.kernedWidth/2,A*r+o,p.kernedWidth,this.fontSize/15),t.restore();else if((g!==l||_!==O||r!==i||o!==a)&&u>0){var I=m+n+d;"rtl"===this.direction&&(I=this.width-I-u),l&&O&&(t.fillStyle=O,t.fillRect(I,c+A*i+a,u,this.fontSize/15)),d=p.left,u=p.width,l=g,O=_,i=r,a=o}else u+=p.kernedWidth;I=m+n+d,"rtl"===this.direction&&(I=this.width-I-u),t.fillStyle=_,g&&_&&t.fillRect(I,c+A*i+a,u-y,this.fontSize/15),v+=s}else v+=s;this._removeShadow(t)}}_getFontDeclaration(e,s){var i=e||this,r=this.fontFamily,n=t.genericFonts.indexOf(r.toLowerCase())>-1,a=void 0===r||r.indexOf("'")>-1||r.indexOf(",")>-1||r.indexOf('"')>-1||n?i.fontFamily:'"'+i.fontFamily+'"';return[Y?i.fontWeight:i.fontStyle,Y?i.fontStyle:i.fontWeight,s?this.CACHE_FONT_SIZE+"px":i.fontSize+"px",a].join(" ")}render(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),super.render(t)))}_splitTextIntoLines(t){for(var e=t.split(this._reNewline),s=new Array(e.length),i=["\n"],r=[],n=0;n<e.length;n++)s[n]=b.graphemeSplit(e[n]),r=r.concat(s[n],i);return r.pop(),{_unwrappedLines:s,lines:e,graphemeText:r,graphemeLines:s}}toObject(t){var e=Is.concat(t),s=super.toObject(e);return s.styles=xs(this.styles,!0),s.path&&(s.path=this.path.toObject()),s}set(t,e){super.set(t,e);var s=!1,i=!1;if("object"==typeof t)for(var r in t)"path"===r&&this.setPathInfo(),s=s||-1!==this._dimensionAffectingProps.indexOf(r),i=i||"path"===r;else s=-1!==this._dimensionAffectingProps.indexOf(t),i="path"===t;return i&&this.setPathInfo(),s&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static positionFromTspan(t){}};p(Cs,"genericFonts",["sans-serif","serif","cursive","fantasy","monospace"]),Cs.prototype._dimensionAffectingProps=["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide"],Cs.prototype.controls={};let ks=Cs;k(ks,[class{_toSVG(){var t=this._getSVGLeftTopOffsets(),e=this._getSVGTextAndBg(t.textTop,t.textLeft);return this._wrapSVGTextAndBg(e)}toSVG(t){return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,noStyle:!0,withShadow:!0})}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(t){var e=this.getSvgTextDecoration(this);return[t.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",e?'text-decoration="'+e+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",t.textSpans.join(""),"</text>\n"]}_getSVGTextAndBg(t,e){var s,i=[],r=[],n=t;this._setSVGBg(r);for(var a=0,o=this._textLines.length;a<o;a++)s=this._getLineLeftOffset(a),(this.textBackgroundColor||this.styleHas("textBackgroundColor",a))&&this._setSVGTextLineBg(r,a,e+s,n),this._setSVGTextLineText(i,a,e+s,n),n+=this.getHeightOfLine(a);return{textSpans:i,textBgRects:r}}_createTextCharSpan(t,e,s,i){var r=t!==t.trim()||t.match(ws),n=this.getSvgSpanStyles(e,r),a=n?'style="'+n+'"':"",o=e.deltaY,h="",l=Ue.NUM_FRACTION_DIGITS;return o&&(h=' dy="'+Ss(o,l)+'" '),['<tspan x="',Ss(s,l),'" y="',Ss(i,l),'" ',h,a,">",b.escapeXml(t),"</tspan>"].join("")}_setSVGTextLineText(t,e,s,i){var r,n,a,o,h,l=this.getHeightOfLine(e),c=-1!==this.textAlign.indexOf("justify"),d="",u=0,p=this._textLines[e];i+=l*(1-this._fontSizeFraction)/this.lineHeight;for(var g=0,f=p.length-1;g<=f;g++)h=g===f||this.charSpacing,d+=p[g],a=this.__charBounds[e][g],0===u?(s+=a.kernedWidth-a.width,u+=a.width):u+=a.kernedWidth,c&&!h&&this._reSpaceAndTab.test(p[g])&&(h=!0),h||(r=r||this.getCompleteStyleDeclaration(e,g),n=this.getCompleteStyleDeclaration(e,g+1),h=this._hasStyleChangedForSvg(r,n)),h&&(o=this._getStyleDeclaration(e,g)||{},t.push(this._createTextCharSpan(d,o,s,i)),d="",r=n,s+=u,u=0)}_pushTextBgRect(t,e,s,i,r,n){var a=Ue.NUM_FRACTION_DIGITS;t.push("\t\t<rect ",this._getFillAttributes(e),' x="',Ss(s,a),'" y="',Ss(i,a),'" width="',Ss(r,a),'" height="',Ss(n,a),'"></rect>\n')}_setSVGTextLineBg(t,e,s,i){for(var r,n,a=this._textLines[e],o=this.getHeightOfLine(e)/this.lineHeight,h=0,l=0,c=this.getValueOfPropertyAt(e,0,"textBackgroundColor"),d=0,u=a.length;d<u;d++)r=this.__charBounds[e][d],(n=this.getValueOfPropertyAt(e,d,"textBackgroundColor"))!==c?(c&&this._pushTextBgRect(t,c,s+l,i,h,o),l=r.left,h=r.width,c=n):h+=r.kernedWidth;n&&this._pushTextBgRect(t,n,s+l,i,h,o)}_getFillAttributes(t){var e=t&&"string"==typeof t?new C(t):"";return e&&e.getSource()&&1!==e.getAlpha()?'opacity="'+e.getAlpha()+'" fill="'+e.setAlpha(1).toRgb()+'"':'fill="'+t+'"'}_getSVGLineTopOffset(t){for(var e,s=0,i=0;i<t;i++)s+=this.getHeightOfLine(i);return e=this.getHeightOfLine(i),{lineTop:s,offset:(this._fontSizeMult-this._fontSizeFraction)*e/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(t){return Ue.prototype.getSvgStyles.call(this,t)+" white-space: pre;"}},class{isEmptyStyles(t){if(!this.styles||typeof t<"u"&&!this.styles[t])return!0;var e=typeof t>"u"?this.styles:{line:this.styles[t]};for(var s in e)for(var i in e[s])for(var r in e[s][i])return!1;return!0}styleHas(t,e){if(!this.styles||!t||""===t||typeof e<"u"&&!this.styles[e])return!1;var s=typeof e>"u"?this.styles:{0:this.styles[e]};for(var i in s)for(var r in s[i])if(typeof s[i][r][t]<"u")return!0;return!1}cleanStyle(t){if(!this.styles||!t||""===t)return!1;var e,s,i=this.styles,r=0,n=!0,a=0;for(var o in i){for(var h in e=0,i[o]){var l;r++,(l=i[o][h]).hasOwnProperty(t)?(s?l[t]!==s&&(n=!1):s=l[t],l[t]===this[t]&&delete l[t]):n=!1,0!==Object.keys(l).length?e++:delete i[o][h]}0===e&&delete i[o]}for(var c=0;c<this._textLines.length;c++)a+=this._textLines[c].length;n&&r===a&&(this[t]=s,this.removeStyle(t))}removeStyle(t){if(this.styles&&t&&""!==t){var e,s,i,r=this.styles;for(s in r){for(i in e=r[s])delete e[i][t],0===Object.keys(e[i]).length&&delete e[i];0===Object.keys(e).length&&delete r[s]}}}_extendStyles(t,e){var s=this.get2DCursorLocation(t);this._getLineStyle(s.lineIndex)||this._setLineStyle(s.lineIndex),this._getStyleDeclaration(s.lineIndex,s.charIndex)||this._setStyleDeclaration(s.lineIndex,s.charIndex,{}),ot.extend(this._getStyleDeclaration(s.lineIndex,s.charIndex),e)}get2DCursorLocation(t,e){typeof t>"u"&&(t=this.selectionStart);for(var s=e?this._unwrappedTextLines:this._textLines,i=s.length,r=0;r<i;r++){if(t<=s[r].length)return{lineIndex:r,charIndex:t};t-=s[r].length+this.missingNewlineOffset(r)}return{lineIndex:r-1,charIndex:s[r-1].length<t?s[r-1].length:t}}getSelectionStyles(t,e,s){typeof t>"u"&&(t=this.selectionStart||0),typeof e>"u"&&(e=this.selectionEnd||t);for(var i=[],r=t;r<e;r++)i.push(this.getStyleAtPosition(r,s));return i}getStyleAtPosition(t,e){var s=this.get2DCursorLocation(t);return(e?this.getCompleteStyleDeclaration(s.lineIndex,s.charIndex):this._getStyleDeclaration(s.lineIndex,s.charIndex))||{}}setSelectionStyles(t,e,s){typeof e>"u"&&(e=this.selectionStart||0),typeof s>"u"&&(s=this.selectionEnd||e);for(var i=e;i<s;i++)this._extendStyles(i,t);return this._forceClearCache=!0,this}_getStyleDeclaration(t,e){var s=this.styles&&this.styles[t];return s?s[e]:null}getCompleteStyleDeclaration(t,e){for(var s,i=this._getStyleDeclaration(t,e)||{},r={},n=0;n<this._styleProperties.length;n++)r[s=this._styleProperties[n]]=typeof i[s]>"u"?this[s]:i[s];return r}_setStyleDeclaration(t,e,s){this.styles[t][e]=s}_deleteStyleDeclaration(t,e){delete this.styles[t][e]}_getLineStyle(t){return!!this.styles[t]}_setLineStyle(t){this.styles[t]={}}_deleteLineStyle(t){delete this.styles[t]}}]),function(t,e){t.mtr=e.mtr,t.tr=e.tr,t.br=e.br,t.tl=e.tl,t.bl=e.bl,t.mt=e.mt,t.mb=e.mb,t.mr=new Ce({x:.5,y:0,actionHandler:we.changeWidth,cursorStyleHandler:ke,actionName:"resizing"}),t.ml=new Ce({x:-.5,y:0,actionHandler:we.changeWidth,cursorStyleHandler:ke,actionName:"resizing"})}(ks.prototype.controls,Ue.prototype.controls),k(class extends ks{constructor(){super(...arguments),p(this,"type","textbox"),p(this,"minWidth",20),p(this,"dynamicMinWidth",2),p(this,"__cachedLines",null),p(this,"lockScalingFlip",!0),p(this,"noScaleCache",!1),p(this,"_dimensionAffectingProps",ks.prototype._dimensionAffectingProps.concat("width")),p(this,"_wordJoiners",/[ \t\r]/),p(this,"splitByGrapheme",!1)}initDimensions(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))}_generateStyleMap(t){for(var e=0,s=0,i=0,r={},n=0;n<t.graphemeLines.length;n++)"\n"===t.graphemeText[i]&&n>0?(s=0,i++,e++):!this.splitByGrapheme&&this._reSpaceAndTab.test(t.graphemeText[i])&&n>0&&(s++,i++),r[n]={line:e,offset:s},i+=t.graphemeLines[n].length,s+=t.graphemeLines[n].length;return r}styleHas(t,e){if(this._styleMap&&!this.isWrapping){var s=this._styleMap[e];s&&(e=s.line)}return ks.prototype.styleHas.call(this,t,e)}isEmptyStyles(t){if(!this.styles)return!0;var e,s,i=0,r=!1,n=this._styleMap[t],a=this._styleMap[t+1];for(var o in n&&(t=n.line,i=n.offset),a&&(r=a.line===t,e=a.offset),s=typeof t>"u"?this.styles:{line:this.styles[t]})for(var h in s[o])if(h>=i&&(!r||h<e))for(var l in s[o][h])return!1;return!0}_getStyleDeclaration(t,e){if(this._styleMap&&!this.isWrapping){var s=this._styleMap[t];if(!s)return null;t=s.line,e=s.offset+e}return super._getStyleDeclaration(t,e)}_setStyleDeclaration(t,e,s){var i=this._styleMap[t];t=i.line,e=i.offset+e,this.styles[t][e]=s}_deleteStyleDeclaration(t,e){var s=this._styleMap[t];t=s.line,e=s.offset+e,delete this.styles[t][e]}_getLineStyle(t){var e=this._styleMap[t];return!!this.styles[e.line]}_setLineStyle(t){var e=this._styleMap[t];this.styles[e.line]={}}_wrapText(t,e){var s,i=[];for(this.isWrapping=!0,s=0;s<t.length;s++)i=i.concat(this._wrapLine(t[s],s,e));return this.isWrapping=!1,i}_measureWord(t,e,s){var i,r=0;s=s||0;for(var n=0,a=t.length;n<a;n++)r+=this._getGraphemeBox(t[n],e,n+s,i,!0).kernedWidth,i=t[n];return r}_wrapLine(t,e,s,i){var r=0,n=this.splitByGrapheme,a=[],o=[],h=n?b.graphemeSplit(t):t.split(this._wordJoiners),l="",c=0,d=n?"":" ",u=0,p=0,g=0,f=!0,_=this._getWidthOfCharSpacing();i=i||0,0===h.length&&h.push([]),s-=i;for(var O=0;O<h.length;O++)l=n?h[O]:b.graphemeSplit(h[O]),u=this._measureWord(l,e,c),c+=l.length,(r+=p+u-_)>s&&!f?(a.push(o),o=[],r=u,f=!0):r+=_,!f&&!n&&o.push(d),o=o.concat(l),p=n?0:this._measureWord([d],e,c),c++,f=!1,u>g&&(g=u);return O&&a.push(o),g+i>this.dynamicMinWidth&&(this.dynamicMinWidth=g-_+i),a}isEndOfWrapping(t){return!this._styleMap[t+1]||this._styleMap[t+1].line!==this._styleMap[t].line}missingNewlineOffset(t){return this.splitByGrapheme?this.isEndOfWrapping(t)?1:0:1}_splitTextIntoLines(t){for(var e=ks.prototype._splitTextIntoLines.call(this,t),s=this._wrapText(e.lines,this.width),i=new Array(s.length),r=0;r<s.length;r++)i[r]=s[r].join("");return e.lines=i,e.graphemeLines=s,e}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){var t={};for(var e in this._styleMap)this._textLines[e]&&(t[this._styleMap[e].line]=1);for(var e in this.styles)t[e]||delete this.styles[e]}toObject(t){return super.toObject(["minWidth","splitByGrapheme"].concat(t))}},[ft]);const Es=!!document.createElement("div").attachEvent,Ps=["touchstart","touchmove","touchend"];function js(t,e,s,i){t&&t.addEventListener(e,s,!Es&&i)}function Rs(t,e,s,i){t&&t.removeEventListener(e,s,!Es&&i)}function Ls(t){return Ps.indexOf(t.type)>-1||"touch"===t.pointerType}const Ns={addListener:js,removeListener:Rs,getPointer:function(t){var e=t.target,s=zt.getScrollLeftTop(e),i=function(t){var e=t.changedTouches;return e&&e[0]?e[0]:t}(t);return{x:i.clientX+s.left,y:i.clientY+s.top}},isTouchEvent:Ls},Ds={passive:!1};function Fs(t,e){return t.button&&t.button===e-1}const Ms={mainTouchId:null,_fire:we.fireEvent,_initEventListeners(){this.removeListeners(),this._bindEvents(),this.addOrRemove(js)},_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove(t){var e=this.upperCanvasEl,s=this._getEventPrefix();t(D,"resize",this._onResize),t(e,s+"down",this._onMouseDown),t(e,s+"move",this._onMouseMove,Ds),t(e,s+"out",this._onMouseOut),t(e,s+"enter",this._onMouseEnter),t(e,"wheel",this._onMouseWheel),t(e,"contextmenu",this._onContextMenu),t(e,"dblclick",this._onDoubleClick),t(e,"dragover",this._onDragOver),t(e,"dragenter",this._onDragEnter),t(e,"dragleave",this._onDragLeave),t(e,"drop",this._onDrop),this.enablePointerEvents||t(e,"touchstart",this._onTouchStart,Ds)},removeListeners(){this.addOrRemove(Rs);var t=this._getEventPrefix();Rs(F,t+"up",this._onMouseUp),Rs(F,"touchend",this._onTouchEnd,Ds),Rs(F,t+"move",this._onMouseMove,Ds),Rs(F,"touchmove",this._onMouseMove,Ds)},_bindEvents(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._simpleEventHandler.bind(this,"drop"),this.eventsBound=!0)},_onMouseWheel(t){this.__onMouseWheel(t)},_onMouseOut(t){var e=this._hoveredTarget;this.fire("mouse:out",{target:e,e:t}),this._hoveredTarget=null,e&&e.fire("mouseout",{e:t});var s=this;this._hoveredTargets.forEach((function(i){s.fire("mouse:out",{target:e,e:t}),i&&e.fire("mouseout",{e:t})})),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach((function(t){t.isEditing&&t.hiddenTextarea.focus()}))},_onMouseEnter(t){!this._currentTransform&&!this.findTarget(t)&&(this.fire("mouse:over",{target:null,e:t}),this._hoveredTarget=null,this._hoveredTargets=[])},_onDragOver(t){t.preventDefault();var e=this._simpleEventHandler("dragover",t);this._fireEnterLeaveEvents(e,t)},_onContextMenu(t){return this.stopContextMenu&&(t.stopPropagation(),t.preventDefault()),!1},_onDoubleClick(t){this._cacheTransformEventData(t),this._handleEvent(t,"dblclick"),this._resetTransformEventData(t)},getPointerId(t){var e=t.changedTouches;return e?e[0]&&e[0].identifier:this.enablePointerEvents?t.pointerId:-1},_isMainEvent(t){return!0===t.isPrimary||!1!==t.isPrimary&&("touchend"===t.type&&0===t.touches.length||!t.changedTouches||t.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart(t){t.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();var e=this.upperCanvasEl,s=this._getEventPrefix();js(F,"touchend",this._onTouchEnd,Ds),js(F,"touchmove",this._onMouseMove,Ds),Rs(e,s+"down",this._onMouseDown)},_onMouseDown(t){this.__onMouseDown(t),this._resetTransformEventData();var e=this.upperCanvasEl,s=this._getEventPrefix();Rs(e,s+"move",this._onMouseMove,Ds),js(F,s+"up",this._onMouseUp),js(F,s+"move",this._onMouseMove,Ds)},_onTouchEnd(t){if(!(t.touches.length>0)){this.__onMouseUp(t),this._resetTransformEventData(),this.mainTouchId=null;var e=this._getEventPrefix();Rs(F,"touchend",this._onTouchEnd,Ds),Rs(F,"touchmove",this._onMouseMove,Ds);var s=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout((function(){js(s.upperCanvasEl,e+"down",s._onMouseDown),s._willAddMouseDown=0}),400)}},_onMouseUp(t){this.__onMouseUp(t),this._resetTransformEventData();var e=this.upperCanvasEl,s=this._getEventPrefix();this._isMainEvent(t)&&(Rs(F,s+"up",this._onMouseUp),Rs(F,s+"move",this._onMouseMove,Ds),js(e,s+"move",this._onMouseMove,Ds))},_onMouseMove(t){!this.allowTouchScrolling&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)},_onResize(){this.calcOffset()},_shouldRender(t){var e=this._activeObject;return!!(!!e!=!!t||e&&t&&e!==t)||(e&&e.isEditing,!1)},__onMouseUp(t){var e,s=this._currentTransform,i=this._groupSelector,r=!1,n=!i||0===i.left&&0===i.top;if(this._cacheTransformEventData(t),e=this._target,this._handleEvent(t,"up:before"),Fs(t,3))this.fireRightClick&&this._handleEvent(t,"up",3,n);else{if(Fs(t,2))return this.fireMiddleClick&&this._handleEvent(t,"up",2,n),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(t);else if(this._isMainEvent(t)){if(s&&(this._finalizeCurrentTransform(t),r=s.actionPerformed),!n){var a=e===this._activeObject;this._maybeGroupObjects(t),r||(r=this._shouldRender(e)||!a&&e===this._activeObject)}if(e){if(e.selectable&&e!==this._activeObject&&"up"===e.activeOn)this.setActiveObject(e,t),r=!0;else{var o=e._findTargetCorner(this.getPointer(t,!0),Ls(t)),h=e.controls[o],l=h&&h.getMouseUpHandler(t,e,h);if(l){var c=this.getPointer(t);l(t,s,c.x,c.y)}}e.isMoving=!1}this._setCursorFromEvent(t,e),this._handleEvent(t,"up",1,n),this._groupSelector=null,this._currentTransform=null,e&&(e.__corner=0),r?this.requestRenderAll():n||this.renderTop()}}},_simpleEventHandler(t,e){var s=this.findTarget(e),i=this.targets,r={e,target:s,subTargets:i};if(this.fire(t,r),s&&s.fire(t,r),!i)return s;for(var n=0;n<i.length;n++)i[n].fire(t,r);return s},_handleEvent(t,e,s,i){var r=this._target,n=this.targets||[],a={e:t,target:r,subTargets:n,button:s||1,isClick:i||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};"up"===e&&(a.currentTarget=this.findTarget(t),a.currentSubTargets=this.targets),this.fire("mouse:"+e,a),r&&r.fire("mouse"+e,a);for(var o=0;o<n.length;o++)n[o].fire("mouse"+e,a)},_finalizeCurrentTransform(t){var e,s=this._currentTransform,i=s.target,r={e:t,target:i,transform:s,action:s.action};i._scaling&&(i._scaling=!1),i.setCoords(),(s.actionPerformed||this.stateful&&i.hasStateChanged())&&(s.actionPerformed&&(e=this._addEventOptions(r,s),this._fire(e,r)),this._fire("modified",r))},_addEventOptions(t,e){var s,i;switch(e.action){case"scaleX":s="scaled",i="x";break;case"scaleY":s="scaled",i="y";break;case"skewX":s="skewed",i="x";break;case"skewY":s="skewed",i="y";break;case"scale":s="scaled",i="equally";break;case"rotate":s="rotated";break;case"drag":s="moved"}return t.by=i,s},_onMouseDownInDrawingMode(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(t).requestRenderAll();var e=this.getPointer(t);this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down")},_onMouseMoveInDrawingMode(t){if(this._isCurrentlyDrawing){var e=this.getPointer(t);this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")},_onMouseUpInDrawingMode(t){var e=this.getPointer(t);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:t,pointer:e}),this._handleEvent(t,"up")},__onMouseDown(t){this._cacheTransformEventData(t),this._handleEvent(t,"down:before");var e=this._target;if(Fs(t,3))this.fireRightClick&&this._handleEvent(t,"down",3);else if(Fs(t,2))this.fireMiddleClick&&this._handleEvent(t,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(t);else if(this._isMainEvent(t)&&!this._currentTransform){var s=this._pointer;this._previousPointer=s;var i=this._shouldRender(e),r=this._shouldGroup(t,e);if(this._shouldClearSelection(t,e)?this.discardActiveObject(t):r&&(this._handleGrouping(t,e),e=this._activeObject),this.selection&&(!e||!e.selectable&&!e.isEditing&&e!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),e){var n=e===this._activeObject;e.selectable&&"down"===e.activeOn&&this.setActiveObject(e,t);var a=e._findTargetCorner(this.getPointer(t,!0),Ls(t));if(e.__corner=a,e===this._activeObject&&(a||!r)){this._setupCurrentTransform(t,e,n);var o=e.controls[a],h=(s=this.getPointer(t),o&&o.getMouseDownHandler(t,e,o));h&&h(t,this._currentTransform,s.x,s.y)}}this._handleEvent(t,"down"),(i||r)&&this.requestRenderAll()}},_resetTransformEventData(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData(t){this._resetTransformEventData(),this._pointer=this.getPointer(t,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)||null},_beforeTransform(t){var e=this._currentTransform;this.stateful&&e.target.saveState(),this.fire("before:transform",{e:t,transform:e})},__onMouseMove(t){var e,s;if(this._handleEvent(t,"move:before"),this._cacheTransformEventData(t),this.isDrawingMode)this._onMouseMoveInDrawingMode(t);else if(this._isMainEvent(t)){var i=this._groupSelector;i?(s=this._absolutePointer,i.left=s.x-i.ex,i.top=s.y-i.ey,this.renderTop()):this._currentTransform?this._transformObject(t):(e=this.findTarget(t)||null,this._setCursorFromEvent(t,e),this._fireOverOutEvents(e,t)),this._handleEvent(t,"move"),this._resetTransformEventData()}},_fireOverOutEvents(t,e){var s=this._hoveredTarget,i=this._hoveredTargets,r=this.targets,n=Math.max(i.length,r.length);this.fireSyntheticInOutEvents(t,e,{oldTarget:s,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var a=0;a<n;a++)this.fireSyntheticInOutEvents(r[a],e,{oldTarget:i[a],evtOut:"mouseout",evtIn:"mouseover"});var o=new Set([t,...r]),h=new Set([s,i]),l=new Set([t,...r,s,...i]),c=[],d=[];for(let t of l)o.has(t)&&!h.has(t)&&c.push(t),!o.has(t)&&h.has(t)&&d.push(t);var u=Math.max(c.length,d.length);for(a=0;a<u;a++)this.fireSyntheticInOutEvents(c[a],e,{oldTarget:d[a],evtOut:"abs_mouseout",evtIn:"abs_mouseover"});this._hoveredTarget=t,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents(t,e){var s=this._draggedoverTarget,i=this._hoveredTargets,r=this.targets,n=Math.max(i.length,r.length);this.fireSyntheticInOutEvents(t,e,{oldTarget:s,evtOut:"dragleave",evtIn:"dragenter"});for(var a=0;a<n;a++)this.fireSyntheticInOutEvents(r[a],e,{oldTarget:i[a],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=t},fireSyntheticInOutEvents(t,e,s){var i,r,n,a=s.oldTarget,o=a!==t,h=s.canvasEvtIn,l=s.canvasEvtOut;o&&(i={e,target:t,previousTarget:a},r={e,target:a,nextTarget:t}),n=t&&o,a&&o&&(l&&this.fire(l,r),a.fire(s.evtOut,r)),n&&(h&&this.fire(h,i),t.fire(s.evtIn,i))},__onMouseWheel(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()},_transformObject(t){var e=this.getPointer(t),s=this._currentTransform;s.reset=!1,s.shiftKey=t.shiftKey,s.altKey=t[this.centeredKey],this._performTransformAction(t,s,e),s.actionPerformed&&this.requestRenderAll()},_performTransformAction(t,e,s){const i=Date.now(),r=Math.abs(t.clientX-e.event.clientX),n=Math.abs(t.clientY-e.event.clientY),a=Math.sqrt(r*r+n*n);if(i-e.mouseDownTimestamp>80||a>5){var o=s.x,h=s.y,l=e.action,c=!1,d=e.actionHandler;d&&(c=d(t,e,o,h)),"drag"===l&&c&&(e.target.isMoving=!0,this.setCursor(e.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||c}},_setCursorFromEvent(t,e){if(!e)return this.setCursor(this.defaultCursor),!1;var s=e.hoverCursor||this.hoverCursor,i=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,r=(!i||!i.contains(e))&&e._findTargetCorner(this.getPointer(t,!0));r?this.setCursor(this.getCornerCursor(r,e,t)):(e.subTargetCheck&&this.targets.concat().reverse().map((function(t){s=t.hoverCursor||s})),this.setCursor(s))},getCornerCursor(t,e,s){var i=e.controls[t];return i.cursorStyleHandler(s,i,e)}},Bs=Math.min,Ys=Math.max,Hs=Ns.getPointer,zs=q.degreesToRadians,Ws=Ns.isTouchEvent;let Xs=class extends Qt{constructor(t,e){super(t,e),p(this,"isRenderingTop",0),this._initInteractive(),this._createCacheCanvas()}_initInteractive(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.calcOffset()}_chooseObjectsToRender(){var t,e,s,i=this.getActiveObjects();if(i.length>0&&!this.preserveObjectStacking){e=[],s=[];for(var r=0,n=this._objects.length;r<n;r++)t=this._objects[r],-1===i.indexOf(t)?e.push(t):s.push(t);i.length>1&&(this._activeObject._objects=s),e.push.apply(e,s)}else e=this._objects;return e}renderAll(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&this.renderTopLayer(this.contextTop);var t=this.contextContainer;return this.renderCanvas(t,this._chooseObjectsToRender()),this}renderTopLayer(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore()}renderTop(){var t=this.contextTop;return this.clearContext(t),this.renderTopLayer(t),this.fire("after:render"),this.fire("after:renderTop"),this}requestRenderTop(){this.isRenderingTop||(this.isRenderingTop=St((()=>{try{this.renderTop()}finally{this.isRenderingTop=0}})))}_normalizePointer(t,e){var s=t.calcTransformMatrix(),i=q.invertTransform(s),r=this.restorePointerVpt(e);return q.transformPoint(r,i)}isTargetTransparent(t,e,s){if(t.shouldCache()&&t._cacheCanvas&&t!==this._activeObject){var i=this._normalizePointer(t,{x:e,y:s}),r=Math.max(t.cacheTranslationX+i.x*t.zoomX,0),n=Math.max(t.cacheTranslationY+i.y*t.zoomY,0);return q.isTransparent(t._cacheContext,Math.round(r),Math.round(n),this.targetFindTolerance)}var a=this.contextCache,o=t.selectionBackgroundColor,h=this.viewportTransform;return t.selectionBackgroundColor="",this.clearContext(a),a.save(),a.transform(h[0],h[1],h[2],h[3],h[4],h[5]),t.render(a),a.restore(),t.selectionBackgroundColor=o,q.isTransparent(a,e,s,this.targetFindTolerance)}_isSelectionKeyPressed(t){return"[object Array]"===Object.prototype.toString.call(this.selectionKey)?!!this.selectionKey.find((function(e){return!0===t[e]})):t[this.selectionKey]}_shouldClearSelection(t,e){var s=this.getActiveObjects(),i=this._activeObject;return!e||e&&i&&s.length>1&&-1===s.indexOf(e)&&i!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&i&&i!==e}_shouldCenterTransform(t,e,s){var i;if(t)return"scale"===e||"scaleX"===e||"scaleY"===e||"resizing"===e?i=this.centeredScaling||t.centeredScaling:"rotate"===e&&(i=this.centeredRotation||t.centeredRotation),i?!s:s}_getOriginFromCorner(t,e){var s={x:t.originX,y:t.originY};return"ml"===e||"tl"===e||"bl"===e?s.x="right":("mr"===e||"tr"===e||"br"===e)&&(s.x="left"),"tl"===e||"mt"===e||"tr"===e?s.y="bottom":("bl"===e||"mb"===e||"br"===e)&&(s.y="top"),s}_getActionFromCorner(t,e,s,i){if(!e||!t)return"drag";var r=i.controls[e];return r.getActionName(s,r,i)}_setupCurrentTransform(t,e,s){if(e){var i=this.getPointer(t),r=e.__corner,n=e.controls[r],a=s&&r?n.getActionHandler(t,e,n):we.dragHandler,o=this._getActionFromCorner(s,r,t,e),h=this._getOriginFromCorner(e,r),l=t[this.centeredKey],c={target:e,action:o,actionHandler:a,corner:r,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:i.x-e.left,offsetY:i.y-e.top,originX:h.x,originY:h.y,ex:i.x,ey:i.y,lastX:i.x,lastY:i.y,theta:zs(e.angle),width:e.width*e.scaleX,shiftKey:t.shiftKey,altKey:l,original:q.saveObjectTransform(e)};this._shouldCenterTransform(e,o,l)&&(c.originX="center",c.originY="center"),c.original.originX=h.x,c.original.originY=h.y,this._currentTransform=c,this._beforeTransform(t)}}setCursor(t){this.upperCanvasEl.style.cursor=t}_drawSelection(t){var e=this._groupSelector,s=new E(e.ex,e.ey),i=q.transformPoint(s,this.viewportTransform),r=new E(e.ex+e.left,e.ey+e.top),n=q.transformPoint(r,this.viewportTransform),a=Math.min(i.x,n.x),o=Math.min(i.y,n.y),h=Math.max(i.x,n.x),l=Math.max(i.y,n.y),c=this.selectionLineWidth/2;this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(a,o,h-a,l-o)),this.selectionLineWidth&&this.selectionBorderColor&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,a+=c,o+=c,h-=c,l-=c,Ue.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(a,o,h-a,l-o))}findTarget(t,e){if(!this.skipTargetFind){var s,i,r=this.getPointer(t,!0),n=this._activeObject,a=this.getActiveObjects(),o=Ws(t),h=a.length>1&&!e||1===a.length;if(this.targets=[],h&&n._findTargetCorner(r,o)||a.length>1&&!e&&n===this._searchPossibleTargets([n],r))return n;if(1===a.length&&n===this._searchPossibleTargets([n],r)){if(!this.preserveObjectStacking)return n;s=n,i=this.targets,this.targets=[]}var l=this._searchPossibleTargets(this._objects,r);return t[this.altSelectionKey]&&l&&s&&l!==s&&(l=s,this.targets=i),l}}_checkTarget(t,e,s){if(e&&e.visible&&e.evented&&e.containsPoint(t)){if(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing)return!0;if(!this.isTargetTransparent(e,s.x,s.y))return!0}}_searchPossibleTargets(t,e){for(var s,i,r=t.length;r--;){var n=t[r],a=n.group?this._normalizePointer(n.group,e):e;if(this._checkTarget(a,n,e)){(s=t[r]).subTargetCheck&&s instanceof Ke&&(i=this._searchPossibleTargets(s._objects,e))&&this.targets.push(i);break}}return s}restorePointerVpt(t){return q.transformPoint(t,q.invertTransform(this.viewportTransform))}getPointer(t,e){if(this._absolutePointer&&!e)return this._absolutePointer;if(this._pointer&&e)return this._pointer;var s,i=Hs(t),r=this.upperCanvasEl,n=r.getBoundingClientRect(),a=n.width||0,o=n.height||0;(!a||!o)&&("top"in n&&"bottom"in n&&(o=Math.abs(n.top-n.bottom)),"right"in n&&"left"in n&&(a=Math.abs(n.right-n.left))),this.calcOffset(),i.x=i.x-this._offset.left,i.y=i.y-this._offset.top,e||(i=this.restorePointerVpt(i));var h=this.getRetinaScaling();return 1!==h&&(i.x/=h,i.y/=h),s=0===a||0===o?{width:1,height:1}:{width:r.width/a,height:r.height/o},{x:i.x*s.width,y:i.y*s.height}}_createUpperCanvas(){var t=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),e=this.lowerCanvasEl,s=this.upperCanvasEl;s?s.className="":(s=this._createCanvasElement(),this.upperCanvasEl=s),zt.addClass(s,"upper-canvas "+t),this.wrapperEl.appendChild(s),this._copyCanvasStyle(e,s),this._applyCanvasStyle(s),this.contextTop=s.getContext("2d")}_createCacheCanvas(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")}_initWrapperElement(){this.wrapperEl=zt.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),zt.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),zt.makeElementUnselectable(this.wrapperEl)}_applyCanvasStyle(t){var e=this.width||t.width,s=this.height||t.height;zt.setStyle(t,{position:"absolute",width:e+"px",height:s+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),t.width=e,t.height=s,zt.makeElementUnselectable(t)}_copyCanvasStyle(t,e){e.style.cssText=t.style.cssText}getSelectionContext(){return this.contextTop}getSelectionElement(){return this.upperCanvasEl}getActiveObject(){return this._activeObject}getActiveObjects(){var t=this._activeObject;return t?"activeSelection"===t.type&&t._objects?t._objects.slice(0):[t]:[]}_onObjectRemoved(t){t===this._activeObject&&(this.fire("before:selection:cleared",{target:t}),this._discardActiveObject(),this.fire("selection:cleared",{target:t}),t.fire("deselected")),t===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),super._onObjectRemoved(t)}_fireSelectionEvents(t,e){var s=!1,i=this.getActiveObjects(),r=[],n=[];t.forEach((function(t){-1===i.indexOf(t)&&(s=!0,t.fire("deselected",{e,target:t}),n.push(t))})),i.forEach((function(i){-1===t.indexOf(i)&&(s=!0,i.fire("selected",{e,target:i}),r.push(i))})),t.length>0&&i.length>0?s&&this.fire("selection:updated",{e,selected:r,deselected:n,updated:r[0]||n[0],target:this._activeObject}):i.length>0?this.fire("selection:created",{e,selected:r,target:this._activeObject}):t.length>0&&this.fire("selection:cleared",{e,deselected:n})}setActiveObject(t,e){var s=this.getActiveObjects();return this._setActiveObject(t,e),this._fireSelectionEvents(s,e),this}_setActiveObject(t,e){return!(this._activeObject===t||!this._discardActiveObject(e,t)||t.onSelect({e})||(this._activeObject=t,0))}_discardActiveObject(t,e){var s=this._activeObject;if(s){if(s.onDeselect({e:t,object:e}))return!1;this._activeObject=null}return!0}discardActiveObject(t){var e=this.getActiveObjects(),s=this.getActiveObject();return e.length&&this.fire("before:selection:cleared",{target:s,e:t}),this._discardActiveObject(t),this._fireSelectionEvents(e,t),this}dispose(){this.isRendering&&wt(this.isRendering),this.isRenderingTop&&wt(this.isRenderingTop);var t=this.wrapperEl;return this.removeListeners(),t.contains(this.upperCanvasEl)&&t.removeChild(this.upperCanvasEl),t.contains(this.lowerCanvasEl)&&t.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(t){zt.cleanUpJsdomNode(this[t]),this[t]=void 0}.bind(this)),t.parentNode&&t.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),this.wrapperEl=null,super.dispose(),this}clear(){return this.discardActiveObject(),this.clearContext(this.contextTop),super.clear()}drawControls(t){var e=this._activeObject;e&&e._renderControls(t)}_toObject(t,e,s){var i=this._realizeGroupTransformOnObject(t),r=super._toObject(t,e,s);return this._unwindGroupTransformOnObject(t,i),r}_realizeGroupTransformOnObject(t){if(t.group&&"activeSelection"===t.group.type&&this._activeObject===t.group){var e={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach((function(s){e[s]=t[s]})),q.addTransformToObject(t,this._activeObject.calcOwnMatrix()),e}return null}_unwindGroupTransformOnObject(t,e){e&&t.set(e)}_setSVGObject(t,e,s){var i=this._realizeGroupTransformOnObject(e);super._setSVGObject(t,e,s),this._unwindGroupTransformOnObject(e,i)}setViewportTransform(t){return this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),super.setViewportTransform(t)}};function Us(t){return new RegExp("^("+t.join("|")+")\\b","i")}function Vs(t,e,s,i){return t<Math.abs(e)?(t=e,i=s/4):i=0===e&&0===t?s/(2*Math.PI)*Math.asin(1):s/(2*Math.PI)*Math.asin(e/t),{a:t,c:e,p:s,s:i}}function Gs(t,e,s){return t.a*Math.pow(2,10*(e-=1))*Math.sin((e*s-t.s)*(2*Math.PI)/t.p)}function qs(t,e,s,i){return s-Js(i-t,0,s,i)+e}function Js(t,e,s,i){return(t/=i)<1/2.75?s*(7.5625*t*t)+e:t<2/2.75?s*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?s*(7.5625*(t-=2.25/2.75)*t+.9375)+e:s*(7.5625*(t-=2.625/2.75)*t+.984375)+e}k(Xs,[{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],_hoveredTarget:null,_hoveredTargets:[],_activeObject:void 0},Ms,class{_shouldGroup(t,e){var s=this._activeObject;return s&&this._isSelectionKeyPressed(t)&&e&&e.selectable&&this.selection&&(s!==e||"activeSelection"===s.type)&&!e.onSelect({e:t})}_handleGrouping(t,e){var s=this._activeObject;s.__corner||e===s&&(!(e=this.findTarget(t,!0))||!e.selectable)||(s&&"activeSelection"===s.type?this._updateActiveSelection(e,t):this._createActiveSelection(e,t))}_updateActiveSelection(t,e){var s=this._activeObject,i=s._objects.slice(0);s.contains(t)?(s.removeWithUpdate(t),this._hoveredTarget=t,this._hoveredTargets=this.targets.concat(),1===s.size()&&this._setActiveObject(s.item(0),e)):(s.addWithUpdate(t),this._hoveredTarget=s,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(i,e)}_createActiveSelection(t,e){var s=this.getActiveObjects(),i=this._createGroup(t);this._hoveredTarget=i,this._setActiveObject(i,e),this._fireSelectionEvents(s,e)}_createGroup(t){var e=this._objects,s=e.indexOf(this._activeObject)<e.indexOf(t)?[this._activeObject,t]:[t,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new Ze(s,{canvas:this})}_groupSelectedObjects(t){var e,s=this._collectObjects(t);1===s.length?this.setActiveObject(s[0],t):s.length>1&&(e=new Ze(s.reverse(),{canvas:this}),this.setActiveObject(e,t))}_collectObjects(t){for(var e,s=[],i=this._groupSelector.ex,r=this._groupSelector.ey,n=i+this._groupSelector.left,a=r+this._groupSelector.top,o=new E(Bs(i,n),Bs(r,a)),h=new E(Ys(i,n),Ys(r,a)),l=!this.selectionFullyContained,c=i===n&&r===a,d=this._objects.length;d--&&!((e=this._objects[d])&&e.selectable&&e.visible&&(l&&e.intersectsWithRect(o,h,!0)||e.isContainedWithinRect(o,h,!0)||l&&e.containsPoint(o,null,!0)||l&&e.containsPoint(h,null,!0))&&(s.push(e),c)););return s.length>1&&(s=s.filter((function(e){return!e.onSelect({e:t})}))),s}_maybeGroupObjects(t){this.selection&&this._groupSelector&&this._groupSelectedObjects(t),this.setCursor(this.defaultCursor),this._groupSelector=null}}]),Us(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),Us(["symbol","image","marker","pattern","view","svg"]),Us(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),Us(["symbol","g","a","svg","clipPath","defs"]),ot.extend,ot.clone;const Ks={easeInQuad:function(t,e,s,i){return s*(t/=i)*t+e},easeOutQuad:function(t,e,s,i){return-s*(t/=i)*(t-2)+e},easeInOutQuad:function(t,e,s,i){return(t/=i/2)<1?s/2*t*t+e:-s/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,s,i){return s*(t/=i)*t*t+e},easeOutCubic:function(t,e,s,i){return s*((t=t/i-1)*t*t+1)+e},easeInOutCubic:function(t,e,s,i){return(t/=i/2)<1?s/2*t*t*t+e:s/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,s,i){return s*(t/=i)*t*t*t+e},easeOutQuart:function(t,e,s,i){return-s*((t=t/i-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,s,i){return(t/=i/2)<1?s/2*t*t*t*t+e:-s/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,s,i){return s*(t/=i)*t*t*t*t+e},easeOutQuint:function(t,e,s,i){return s*((t=t/i-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,s,i){return(t/=i/2)<1?s/2*t*t*t*t*t+e:s/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,s,i){return-s*Math.cos(t/i*(Math.PI/2))+s+e},easeOutSine:function(t,e,s,i){return s*Math.sin(t/i*(Math.PI/2))+e},easeInOutSine:function(t,e,s,i){return-s/2*(Math.cos(Math.PI*t/i)-1)+e},easeInExpo:function(t,e,s,i){return 0===t?e:s*Math.pow(2,10*(t/i-1))+e},easeOutExpo:function(t,e,s,i){return t===i?e+s:s*(1-Math.pow(2,-10*t/i))+e},easeInOutExpo:function(t,e,s,i){return 0===t?e:t===i?e+s:(t/=i/2)<1?s/2*Math.pow(2,10*(t-1))+e:s/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,s,i){return-s*(Math.sqrt(1-(t/=i)*t)-1)+e},easeOutCirc:function(t,e,s,i){return s*Math.sqrt(1-(t=t/i-1)*t)+e},easeInOutCirc:function(t,e,s,i){return(t/=i/2)<1?-s/2*(Math.sqrt(1-t*t)-1)+e:s/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(t,e,s,i){var r=0;return 0===t?e:1==(t/=i)?e+s:(r||(r=.3*i),-Gs(Vs(s,s,r,1.70158),t,i)+e)},easeOutElastic:function(t,e,s,i){var r=0;if(0===t)return e;if(1==(t/=i))return e+s;r||(r=.3*i);var n=Vs(s,s,r,1.70158);return n.a*Math.pow(2,-10*t)*Math.sin((t*i-n.s)*(2*Math.PI)/n.p)+n.c+e},easeInOutElastic:function(t,e,s,i){var r=0;if(0===t)return e;if(2==(t/=i/2))return e+s;r||(r=i*(.3*1.5));var n=Vs(s,s,r,1.70158);return t<1?-.5*Gs(n,t,i)+e:n.a*Math.pow(2,-10*(t-=1))*Math.sin((t*i-n.s)*(2*Math.PI)/n.p)*.5+n.c+e},easeInBack:function(t,e,s,i,r){return void 0===r&&(r=1.70158),s*(t/=i)*t*((r+1)*t-r)+e},easeOutBack:function(t,e,s,i,r){return void 0===r&&(r=1.70158),s*((t=t/i-1)*t*((r+1)*t+r)+1)+e},easeInOutBack:function(t,e,s,i,r){return void 0===r&&(r=1.70158),(t/=i/2)<1?s/2*(t*t*((1+(r*=1.525))*t-r))+e:s/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},easeInBounce:qs,easeOutBounce:Js,easeInOutBounce:function(t,e,s,i){return t<i/2?.5*qs(2*t,0,s,i)+e:.5*Js(2*t-i,0,s,i)+.5*s+e}},Zs={groupSVGElements:function(t,e,s){var i;return t&&1===t.length?t[0]:(e&&(e.width&&e.height?e.centerPoint={x:e.width/2,y:e.height/2}:(delete e.width,delete e.height)),i=new Ke(t,e),typeof s<"u"&&(i.sourcePath=s),i)},convertGroupToActiveSelection(t){if(t.canvas){var e=t._objects,s=t.canvas;t._objects=[];var i=t.toObject();delete i.objects;var r=new Ze([]);return r.set(i),r.type="activeSelection",s.remove(this),e.forEach((function(t){t.group=r,t.dirty=!0,s.add(t)})),r.canvas=s,r._objects=e,s._activeObject=r,r.setCoords(),r}}},Qs=d(c(c(d(c(d(c(c({ease:Ks,animate:bt,animateColor:De},Ns),zt),{setStyle:It}),Zs),{array:w,object:ot,string:b}),q),ps),{requestAnimFrame:St,cancelAnimFrame:wt});A.add(y.Group,Ke),A.add(y.ActiveSelection,Ze),A.add(y.Image,Ts),A.add(y.Gradient,class{constructor(t){p(this,"offsetX",0),p(this,"offsetY",0),p(this,"gradientTransform",null),p(this,"gradientUnits","pixels"),p(this,"type","linear"),p(this,"id"),p(this,"coords"),p(this,"colorStops"),t||(t={}),t.coords||(t.coords={}),this.id?this.id+="_"+Ue.__uid++:this.id=""+Ue.__uid++,Object.keys(t).forEach((e=>{this[e]=t[e]}));const e={x1:t.coords.x1||0,y1:t.coords.y1||0,x2:t.coords.x2||0,y2:t.coords.y2||0,r1:0,r2:0};"radial"===this.type&&(e.r1=t.coords.r1||0,e.r2=t.coords.r2||0),this.coords=e,this.colorStops=t.colorStops.slice()}addColorStop(t){for(var e in t){var s=new C(t[e]);this.colorStops.push({offset:parseFloat(e),color:s.toRgb(),opacity:s.getAlpha()})}return this}toObject(t){var e={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return q.populateWithProperties(this,e,t),e}toSVG(t,e){var s,i,r,n,a=Ge(this.coords,!0),o=(e=e||{},Ge(this.colorStops,!0)),h=a.r1>a.r2,l=this.gradientTransform?this.gradientTransform.concat():H.iMatrix.concat(),c=-this.offsetX,d=-this.offsetY,u=!!e.additionalTransform,p="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox";if(o.sort((function(t,e){return t.offset-e.offset})),"objectBoundingBox"===p?(c/=t.width,d/=t.height):(c+=t.width/2,d+=t.height/2),"path"===t.type&&"percentage"!==this.gradientUnits&&(c-=t.pathOffset.x,d-=t.pathOffset.y),l[4]-=c,l[5]-=d,n='id="SVGID_'+this.id+'" gradientUnits="'+p+'"',n+=' gradientTransform="'+(u?e.additionalTransform+" ":"")+q.matrixToSVG(l)+'" ',"linear"===this.type?r=["<linearGradient ",n,' x1="',a.x1,'" y1="',a.y1,'" x2="',a.x2,'" y2="',a.y2,'">\n']:"radial"===this.type&&(r=["<radialGradient ",n,' cx="',h?a.x1:a.x2,'" cy="',h?a.y1:a.y2,'" r="',h?a.r1:a.r2,'" fx="',h?a.x2:a.x1,'" fy="',h?a.y2:a.y1,'">\n']),"radial"===this.type){if(h)for((o=o.concat()).reverse(),s=0,i=o.length;s<i;s++)o[s].offset=1-o[s].offset;var g=Math.min(a.r1,a.r2);if(g>0){var f=g/Math.max(a.r1,a.r2);for(s=0,i=o.length;s<i;s++)o[s].offset+=f*(1-o[s].offset)}}for(s=0,i=o.length;s<i;s++){var _=o[s];r.push("<stop ",'offset="',100*_.offset+"%",'" style="stop-color:',_.color,typeof _.opacity<"u"?";stop-opacity: "+_.opacity:";",'"/>\n')}return r.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),r.join("")}toLive(t){var e,s,i,r=Ge(this.coords);if(this.type){for("linear"===this.type?e=t.createLinearGradient(r.x1,r.y1,r.x2,r.y2):"radial"===this.type&&(e=t.createRadialGradient(r.x1,r.y1,r.r1,r.x2,r.y2,r.r2)),s=0,i=this.colorStops.length;s<i;s++){var n=this.colorStops[s].color,a=this.colorStops[s].opacity,o=this.colorStops[s].offset;typeof a<"u"&&(n=new C(n).setAlpha(a).toRgba()),e.addColorStop(o,n)}return e}}});const $s={Star:{path:"m16.2 49.9c0.3-1.1 0.7-3.7 1.8-10.9 0.5-3.2 0.8-2.7-5.9-9.6-3.5-3.6-4.1-4.3-3.3-4.6 0.5-0.1 3.8-0.7 7.5-1.3 3.5-0.6 6.6-1.4 6.8-1.6 0.2-0.4 1.8-3.4 3.5-6.8 1.7-3.3 3.2-6.1 3.4-6.1 0.2 0 1.7 2.8 3.5 6.3 1.7 3.3 3.4 6.4 3.8 6.7 0.3 0.3 3.4 1 6.7 1.6 3.5 0.5 6.6 1.1 7.1 1.3 0.7 0.3-0.1 1.4-4.3 5.6l-5.2 5.3 0.4 3c1 6.6 1.4 9.5 1.8 10.9 0.2 0.7 0.1 1.3-0.1 1.3-0.2 0-3.2-1.3-6.4-3-3.3-1.6-6.5-3-7.2-3-0.6 0-3.9 1.4-7.3 3-3.4 1.7-6.3 3-6.5 3-0.3 0-0.3-0.5-0.1-1.1z",fill:"#d7bf76"},Question:{path:"m27.8 51.1c-1.8-2-0.4-5.1 2.3-5.1 2.5 0 3.9 3.4 2 5.1-1.2 1.1-3.3 1.1-4.3 0zm0-10c-1.1-1.3-1-4.6 0.2-7.4 1.1-2.3 3.3-4.5 8.2-8.1 2.8-2.1 4.8-4.6 4.8-6.1 0-1.2-2-3-4.3-3.8-2.5-0.8-10.8-0.9-13.2 0-3 1-4 1.8-4.3 3.2-0.5 2-1.7 3.1-3.2 3.1-4.1 0-4-5.9 0.2-9.6 5-4.3 17.9-5.2 24.6-1.8 4.2 2.2 6.2 5 6.2 8.9 0 4.7-2 7.5-9.2 13q-4.8 3.6-4.8 6.6c0 2.6-3.5 3.9-5.2 2z",fill:"#639bcc"},Heart:{path:"m29.3 48.1c-0.2-0.5-3.6-4.1-7.6-8-6.1-6-7.5-7.7-8.8-10.4-0.8-1.8-1.7-4.2-1.7-5.4-0.3-2.5 0.8-6.5 2.4-8.6 3.3-4 11.6-4.1 15.4-0.1l1 1.1 1.5-1.4c4.9-4.7 13.5-3.3 16.2 2.6 1.6 3.7 1.5 7.6-0.6 11.8-1.4 2.9-2.9 4.7-8.9 10.5-3.9 3.9-7.2 7.3-7.2 7.6 0 1-1.4 1.2-1.7 0.3z",fill:"#ea4736"},Cross:{path:"m11.1 48.8c-0.7-0.7-1.1-1.8-1.1-2.9 0-1.5 0.8-2.4 7.1-8.8l7.2-7.1-7.2-7.2c-6.5-6.5-7.1-7.2-7.1-8.9 0-2.3 1.7-3.9 4-3.9 1.5 0 2.5 0.7 8.8 7.1l7.2 7.1 7.2-7.1c6.5-6.5 7.2-7.1 8.9-7.1 2.3 0 3.9 1.6 3.9 4 0 1.5-0.7 2.4-7.1 8.8l-7.1 7.2 7.1 7.2c6.5 6.5 7.1 7.2 7.1 8.9 0 2.3-1.6 3.9-4 3.9-1.5 0-2.4-0.7-8.8-7.1l-7.2-7.1-7.1 7.1c-6.5 6.4-7.3 7.1-8.9 7.1-1.3 0-2.1-0.3-2.9-1.2z",fill:"#e8754c"},Check:{path:"m17.3 44.2c-9.3-7-9.3-7-9.3-9.2 0-2.4 1.7-4 4-4 1.3 0 2.7 0.8 6.3 3.5 2.6 2 4.9 3.5 5.2 3.4 0.3-0.1 5.4-5.7 11.4-12.4 10.3-11.6 11-12.3 12.8-12.4 2.6-0.2 4.3 1.3 4.3 3.9 0 1.6-1.1 3-12.9 16.3-15.7 17.5-14.1 16.8-21.9 10.9z",fill:"#75c15c"},Arrow:{path:"m36.5 40.3v-5.8h-13.3-13.2v-4.5-4.5h13.3 13.2l0.1-5.8 0.2-5.8 6.5 7.8c3.6 4.3 6.5 8 6.6 8.2 0.1 0.3-10.2 13.1-12.4 15.3-1 1-1 0.9-1-4.9z",fill:"#5eb5f9"}};class ti extends bs{constructor(t,e={}){const{transform:s,id:i,width:r,height:n}=e,a=$s[t]||$s.Star;super(Qs.parsePath(a.path),{stroke:a.fill,fill:a.fill,id:i});let o=s||H.iMatrix.slice();if(r&&n){const t=r/this.width;o=Qs.multiplyTransformMatrices(o,[t,0,0,t,0,0])}Qs.applyTransformToObject(this,o)}}class ei extends bs{constructor(t,e){var s;super([],e),p(this,"type","ZoomLine"),p(this,"startPoint"),p(this,"endPoint"),p(this,"arrowType"),this.startPoint=t.start,this.endPoint=t.end,this.arrowType=null!=(s=t.arrowType)?s:"",super.initialize(this.makeLine(),e)}get hasLeftArrow(){return"arrow_left"===this.arrowType||"arrow_left_right"===this.arrowType}get hasRightArrow(){return"arrow_left_right"===this.arrowType}_render(t){const{startPoint:e,endPoint:s}=this;this.drawArrow(t,e,s,!this.hasLeftArrow),this.drawArrow(t,s,e,!this.hasRightArrow),super._render(t)}intersectsWithLine(t,e){return"Intersection"===J.intersectLineLine(t,e,this.startPoint,this.endPoint).status}makeLine(){let t=this.startPoint.clone(),e=this.endPoint.clone();const s=e.x-t.x,i=e.y-t.y,r=Math.sqrt(s*s+i*i),n=new E(s/r,i/r).multiply(this.arrowHeadInnerLen-4);return e=e.subtract(n),t=t.add(n),function(t,e){return[["M",t.x,t.y],["L",e.x,e.y]]}(t,e)}get arrowHeadInnerLen(){return Math.max(10.5,6*this.strokeWidth)}get arrowHeadOuterLen(){return Math.max(14,9*this.strokeWidth)}get arrowHeadOuterHeight(){return 3.15*this.strokeWidth}drawArrow(t,e,s,i){t.save();const r=this.strokeWidth/2,n=s.x-e.x,a=s.y-e.y,o=Math.atan2(a,n);t.translate((s.x-e.x)/2,(s.y-e.y)/2),t.rotate(o);const h=this.arrowHeadInnerLen,l=this.arrowHeadOuterLen,c=this.arrowHeadOuterHeight;t.beginPath(),t.moveTo(0,0),i?(t.lineTo(-h,0),t.lineWidth=this.strokeWidth,t.strokeStyle=this.stroke,t.stroke()):(t.lineTo(-l,c),t.lineTo(-h,r),t.lineTo(-h,-r),t.lineTo(-l,-c),t.closePath(),t.fillStyle=this.stroke,t.fill()),t.restore()}}function si(t,e){return(t[0]-e[0])**2+(t[1]-e[1])**2}function ii(t,e,s){const i=si(e,s);if(0===i)return si(t,e);let r=((t[0]-e[0])*(s[0]-e[0])+(t[1]-e[1])*(s[1]-e[1]))/i;return r=Math.max(0,Math.min(1,r)),si(t,function(t,e,s){return[t[0]+(e[0]-t[0])*s,t[1]+(e[1]-t[1])*s]}(e,s,r))}function ri(t,e){return ni(t,0,t.length,e)}function ni(t,e,s,i,r){const n=r||[],a=t[e],o=t[s-1];let h=0,l=1;for(let i=e+1;i<s-1;++i){const e=ii(t[i],a,o);e>h&&(h=e,l=i)}return Math.sqrt(h)>i?(ni(t,e,l+1,i,n),ni(t,l,s,i,n)):(n.length||n.push(a),n.push(o)),n}function ai(t){return[...t]}function oi(t,e){return{x:t.x+e.x,y:t.y+e.y}}function hi(t,e){return t.map((t=>oi(t,e)))}function li(t,e){return new E(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])}function ci(t,e){return t.map((t=>li(t,e)))}function di(t){return{x:-t.x,y:-t.y}}function ui(t,e){return li(t,Qs.invertTransform(e))}function pi(t){if(!t.length)return[];if(1===t.length){const e=t[0];return[["M",e.x,e.y],["L",e.x,e.y]]}if(2===t.length){const e=t[0],s=t[1];return[["M",e.x,e.y],["L",s.x,s.y]]}const e=function(t,e=0){const s=t.length;if(s<3)throw new Error("A curve must have at least three points.");const i=[];if(3===s)i.push(ai(t[0]),ai(t[1]),ai(t[2]),ai(t[2]));else{const s=[];s.push(t[0],t[0]);for(let e=1;e<t.length;e++)s.push(t[e]),e===t.length-1&&s.push(t[e]);const r=[],n=1-e;i.push(ai(s[0]));for(let t=1;t+2<s.length;t++){const e=s[t];r[0]=[e[0],e[1]],r[1]=[e[0]+(n*s[t+1][0]-n*s[t-1][0])/6,e[1]+(n*s[t+1][1]-n*s[t-1][1])/6],r[2]=[s[t+1][0]+(n*s[t][0]-n*s[t+2][0])/6,s[t+1][1]+(n*s[t][1]-n*s[t+2][1])/6],r[3]=[s[t+1][0],s[t+1][1]],i.push(r[1],r[2],r[3])}}return i}(t.map((t=>[t.x,t.y]))),s=[["M",e[0][0],e[0][1]]];for(let t=1;t<e.length;t+=3){const i=e[t],r=e[t+1],n=e[t+2];s.push(["C",i[0],i[1],r[0],r[1],n[0],n[1]])}return s}function gi(t,e){const s=t.x-e.x,i=t.y-e.y;return Math.sqrt(s*s+i*i)}function fi(t,e){return Math.abs(t.x-e.x)<1e-6&&Math.abs(t.y-e.y)<1e-6}function _i(t,e){return{x:e.x-t.x,y:e.y-t.y}}function Oi(t,e){return t.x*e.x+t.y*e.y}class mi{constructor(t,e){p(this,"start"),p(this,"end"),p(this,"_length"),this.start=t,this.end=e}get length(){return void 0===this._length&&(this._length=this.calculateLength()),this._length}calculateLength(){return gi(this.start,this.end)}project(t,e=!1){if(fi(this.start,this.end))return this.start;const s=this.start,i=this.end,r=t,n=((i.x-s.x)*(r.x-s.x)+(i.y-s.y)*(r.y-s.y))/((i.x-s.x)**2+(i.y-s.y)**2),a={x:s.x+(i.x-s.x)*n,y:s.y+(i.y-s.y)*n};return e?a:Oi(_i(s,i),_i(s,a))<0?s:Oi(_i(i,s),_i(i,a))<0?i:a}}function vi({ctx:t,obj:e}){t.save();try{e.render(t)}catch(t){}t.restore()}class bi extends bs{constructor(t,e){const s=t;1===s.length&&s.push(oi(s[0],{x:.1,y:.1}));const i=e,{id:r,strokeWidth:n=2,stroke:a="#005AC8"}=i,o=u(i,["id","strokeWidth","stroke"]);super(pi(s),d(c({},o),{strokeWidth:n,stroke:a})),p(this,"type","ZoomScribble"),p(this,"id"),p(this,"opacity",1),p(this,"fill","transparent"),p(this,"strokeLineCap","round"),p(this,"strokeLineJoin","round"),p(this,"noScaleCache",!1),p(this,"originX","left"),p(this,"originY","top"),p(this,"points",[]),p(this,"pointsObjs",[]),p(this,"pointsObjSpace",[]),p(this,"vptMinDistanceToCheckContain",20),p(this,"vptMinDistanceToPreciseSelect",10),p(this,"hoverCursor","auto"),p(this,"strokeUniform",!0),p(this,"objectCaching",!1),this.id=r||4294967296*Math.floor(65536*Math.random())+((null==crypto?void 0:crypto.getRandomValues(new Uint32Array(1))[0])||Math.floor(4294967296*Math.random())),this.strokeWidth=n,this.stroke=a,this.setPoints(s)}setPoints(t){this.points=t,this.pointsObjs=t.map((t=>new E(t.x,t.y))),this.pointsObjSpace=function(t){const e=function(t){if(!t.length)return{left:0,top:0,width:0,height:0,center:{x:0,y:0}};const{minX:e,minY:s,maxX:i,maxY:r}=t.reduce(((t,e,s)=>(0===s||(t.minX=Math.min(t.minX,e.x),t.minY=Math.min(t.minY,e.y),t.maxX=Math.max(t.maxX,e.x),t.maxY=Math.max(t.maxY,e.y)),t)),{minX:t[0].x,minY:t[0].y,maxX:t[0].x,maxY:t[0].y}),n=i-e,a=r-s;return{left:e,top:s,width:n,height:a,center:{x:e+n/2,y:s+a/2}}}(t);return{points:hi(t,di(e.center)),center:e.center,transform:[1,0,0,1,e.center.x,e.center.y]}}(t).points}updatePoints(t,e="normal"){this.setPoints(t);const s="simple"===e?function(t){if(!t.length)return[];if(1===t.length){const e=t[0];return[["M",e.x,e.y],["L",e.x,e.y]]}if(2===t.length){const e=t[0],s=t[1];return[["M",e.x,e.y],["L",s.x,s.y]]}const e=[];for(let s=0;s<t.length;s++){const i=t[s];if(0===s)e.push(["M",i.x,i.y]);else{if(1===s)continue;{const i=t[s-1],r=t[s],n={x:(i.x+r.x)/2,y:(i.y+r.y)/2};e.push(["Q",i.x,i.y,n.x,n.y])}}}return e}(t):pi(t);bs.prototype.initialize.call(this,s),this.dirty=!0}containsPoint(t,e,s,i){var r;const n=super.containsPoint(t,e,s,i);if(!this.strokeUniform)return n;if(!e&&(void 0===s||s)){if(!n)return!1;if((null==(r=this.canvas)?void 0:r._activeObject)===this)return n;let e;e=s?ui(t,this.calcTransformMatrix()):this.group?li(t,Qs.invertTransform(this.calcOwnMatrix())):function(t,e,s){return ui(li(t,Qs.invertTransform(e)),s)}(t,this.getViewportTransform(),this.calcTransformMatrix());const i=ci(ci(this.pointsObjSpace,this.calcTransformMatrix()),this.getViewportTransform()),a=1/(this.scaleX||1);return this.checkContainsPointInViewport(function(t,e,s){return li(li(t,s),e)}(e,this.getViewportTransform(),this.calcTransformMatrix()),Math.max(this.vptMinDistanceToCheckContain,this.strokeWidth*a/2),i)}return n}checkContainsPointInViewport(t,e,s){const i=this.closestPointTo(t,s);return!!i&&i.closestDistance<=e}closestPointTo(t,e){let s;return e.forEach(((e,i,r)=>{const n=r[i+1];if(e&&n){const i=new mi(e,n).project(t,!1),r=gi(i,t);(void 0===s||s.closestDistance>r)&&(s={closestPoint:i,closestDistance:r})}})),s}}class yi extends bi{constructor(t,e){super(t,e),p(this,"type","ZoomHighlighter"),this.stroke=new C(this.stroke).setAlpha(.4).toRgba()}}class Ai extends bi{constructor(t,e){super(t,e),p(this,"type","ZoomFade");let s=()=>{};this.on("added",(()=>{s=Qs.animate({startValue:1,endValue:0,duration:3e3,easing:Qs.ease.easeOutCubic,onChange:t=>{var e;this.opacity=t,null==(e=this.canvas)||e.requestRenderAll()},onComplete:()=>{var t;null==(t=this.canvas)||t.remove(this)}})})),this.on("removed",(()=>{s()}))}}var Ti=(t=>(t.Pen="pen",t.Text="text",t.Line="line",t.Shape="shape",t.Stamp="stamp",t))(Ti||{}),Si=(t=>(t.Smooth="smooth",t.Fade="fade",t.Highlighter="highlighter",t))(Si||{}),wi=(t=>(t.Simple="simple",t.ArrowLeft="arrow_left",t.ArrowLeftRight="arrow_left_right",t))(wi||{}),xi=(t=>(t.Rectangle="rectangle",t.Ellipse="ellipse",t.Diamond="diamond",t))(xi||{}),Ii=(t=>(t.Border="border",t.Shaded="shaded",t.Filled="filled",t))(Ii||{}),Ci=(t=>(t.addObject="addObject",t.removeObject="removeObject",t))(Ci||{});const ki=255;function Ei(t){return t.toString(16).padStart(2,"0").toUpperCase()}function Pi(t){if(t<0||t>16777215)throw new Error("Decimal value must be between 0 and 16777215.");const e=t>>8&255,s=255&t;return"#".concat(Ei(t>>16&255)).concat(Ei(e)).concat(Ei(s))}function ji(t){return function(t){try{return Pi(t)}catch(t){return""}}("number"==typeof t?t:ki)||"#0000FF"}function Ri(t){if(!/^#[0-9A-Fa-f]{6}$/.test(t))throw new Error("Invalid hex color format. Use #RRGGBB.");const e=t.slice(1);return parseInt(e,16)}const Li=(t,e,s,i)=>{const r=Math.sqrt((e.y-t.y)**2+(e.x-t.x)**2),n=Math.sqrt((e.y-s.y)**2+(e.x-s.x)**2),a=e.x-t.x,o=e.y-t.y,h=e.x-s.x,l=e.y-s.y;if(0===i||0===r||0===n||a*l-h*o==0)return{x1:e.x,y1:e.y,x2:e.x,y2:e.y,ox:e.x,oy:e.y,or:0};const c=e.x-a/r*i,d=e.y-o/r*i,u=e.x-h/n*i,p=e.y-l/n*i,g=(a*l*c-h*o*u+o*l*(d-p))/(a*l-h*o),f=(a*l*p-h*o*d-a*h*(c-u))/(a*l-h*o);return{x1:c,y1:d,x2:u,y2:p,ox:g,oy:f,or:Math.sqrt((c-g)**2+(d-f)**2)}};const Ni=Qs.makePathSimpler,Di={[xi.Diamond]:{pathFn:({w:t,h:e,cornerRadius:s=0})=>{const i=Li({x:0,y:e/2},{x:t/2,y:0},{x:t,y:e/2},s),r=Li({x:t/2,y:0},{x:t,y:e/2},{x:t/2,y:e},s),n=Li({x:t,y:e/2},{x:t/2,y:e},{x:0,y:e/2},s),a=Li({x:t/2,y:e},{x:0,y:e/2},{x:t/2,y:0},s);return Ni([["M",0,0],["M",t,e],["M",i.x1,i.y1],["A",i.or,i.or,0,0,1,i.x2,i.y2],["L",r.x1,r.y1],["A",r.or,r.or,0,0,1,r.x2,r.y2],["L",n.x1,n.y1],["A",n.or,n.or,0,0,1,n.x2,n.y2],["L",a.x1,a.y1],["A",a.or,a.or,0,0,1,a.x2,a.y2],["L",i.x1,i.y1]])}},[xi.Ellipse]:{pathFn:()=>"M 0 17.5 A 1 1 0 0 1 35 17.5 A 1 1 0 0 1 0 17.5"},[xi.Rectangle]:{pathFn:({w:t,h:e,cornerRadius:s=0})=>{const i=[["M",0,0],["L",80,0],["L",80,80],["L",0,80],["L",0,0],["Z"]],r=function(t){return function(t){var e;return Array.isArray(null==(e=t[0])?void 0:e[0])}(t)?t.reduce(((t,e)=>{const s=bs.prototype._calcDimensions.call({path:e});if(!t)return s;const i=Math.min(s.left,t.left),r=Math.min(s.top,t.top);return{left:i,top:r,width:Math.max(s.left+s.width,t.left+t.width)-i,height:Math.max(s.top+s.height,t.top+t.height)-r}}),null)||{left:0,top:0,width:0,height:0}:bs.prototype._calcDimensions.call({path:t})}(i),n=((t,e=0,s=0,i=1,r=1)=>t.map((t=>{const n=t[0];if("L"===n||"M"===n){const[,a,o]=t;return[n,(a+e)*i,(o+s)*r]}if("C"===n){const[,a,o,h,l,c,d]=t;return[n,(a+e)*i,(o+s)*r,(h+e)*i,(l+s)*r,(c+e)*i,(d+s)*r]}if("Q"===n){const[,a,o,h,l]=t;return[n,(a+e)*i,(o+s)*r,(h+e)*i,(l+s)*r]}return t})))(i,0,0,t/r.width,e/r.height);if(0===s)return n;const a={x:n[0][1],y:n[0][2]},o={x:n[1][1],y:n[1][2]},h={x:n[2][1],y:n[2][2]},l={x:n[3][1],y:n[3][2]},c=Li(a,o,h,s),d=Li(o,h,l,s),u=Li(h,l,a,s),p=Li(l,a,o,s);return Ni([["M",c.x1,c.y1],["A",c.or,c.or,0,0,1,c.x2,c.y2],["L",d.x1,d.y1],["A",d.or,d.or,0,0,1,d.x2,d.y2],["L",u.x1,u.y1],["A",u.or,u.or,0,0,1,u.x2,u.y2],["L",p.x1,p.y1],["A",p.or,p.or,0,0,1,p.x2,p.y2],["L",c.x1,c.y1]])}}};class Fi extends bs{constructor(t,e={}){var s;const{transform:i,id:r,width:n,height:a,style:o,lineData:h}=e,l=(Di[t]||Di.rectangle).pathFn({w:n,h:a}),c=ji(e.color),d=c;let u=c,p=0;o===Ii.Border&&h?(u="transparent",p=null!=(s=h.width)?s:1):o===Ii.Shaded&&(u=new C(u).setAlpha(.4).toRgba()),super(l,{stroke:d,strokeWidth:p,fill:u,id:r});let g=i||H.iMatrix.slice();if(n&&a){const t=n/this.width,e=a/this.height;g=Qs.multiplyTransformMatrices(g,[t,0,0,e,0,0])}Qs.applyTransformToObject(this,g)}}const Mi="Arial",Bi=new Map,Yi=document.createElement("canvas").getContext("2d");Yi&&(Yi.font="100px ".concat(Mi));const Hi=new RegExp(new RegExp("\\p{Script=Han}","u")),zi=new RegExp(new RegExp("\\p{Script=Hangul}","u")),Wi=new RegExp(new RegExp("\\p{Emoji_Presentation}","u")),Xi=(t,e)=>{let s=t,i=Bi.get(s)||0;if(!i&&Yi){let r=!1;if(Hi.test(t)&&(s="HAN_SIZE_KEY",t="",r=!0),zi.test(t)&&(s="HANGUL_SIZE_KEY",t="",r=!0),Wi.test(t)&&(s="EMOJI_SIZE_KEY",t="",r=!0),r)return((t,e,s)=>{let i=Bi.get(t)||0;if(!i&&Yi){const{width:s}=Yi.measureText(e);i=s,Bi.set(t,i)}return i*s/100})(s,t,e);const{width:n}=Yi.measureText(t);i=n,Bi.set(s,i)}return i*e/100},Ui=new Map,Vi=0,Gi={12:.95,16:.95,24:.96,34:.97,36:.98,48:1,60:.96,80:.96,[Vi]:.96};let qi;const Ji=document.createRange(),Ki=(t,e)=>(Ji.setStart(t,0),Ji.setEnd(t,e),Ji.getClientRects()),Zi={p:"Paragraph",span:"Span",br:"Break",a:"Link",li:"List"};class Qi{constructor(){p(this,"actualHeight",0),p(this,"actualWidth",0),p(this,"html"),p(this,"width",0),p(this,"fontSize",0),p(this,"fontWeight",400),p(this,"maxLines"),p(this,"overflow",!1),p(this,"fontFamily",Mi),p(this,"layoutResult",[]),p(this,"currentParagraph"),p(this,"isCurrentParagraphBidi",!1),p(this,"steps",[]),p(this,"lineTexts",[]),p(this,"generateRectId",(t=>"".concat(t.x,"-").concat(t.y,"-").concat(t.height,"-").concat(t.width))),p(this,"isValidLineBreak",((t,e,s,i)=>{const r=[];this.loopClientRects(t,(t=>{t&&r.push(this.generateRectId(t))}));const n=r.find((t=>!s.includes(t)));if(n){if(e.includes(n)){const t=i.find((t=>t.id===n));return t&&(t.index=s.length),{valid:!0,search:!1,foundRectId:n}}return{valid:!1,search:!0}}return{valid:!1,search:!1}}))}addContainer(){const t=document.createElement("div");return t.style.cssText="\n    position: fixed;\n    visibility: hidden;\n    top: 0;\n    left: 0;\n    z-index: -999;    \n    background: #fff;\n  ",document.body.appendChild(t),t}getContainer(){if(qi)return qi;const t=document.querySelector("___layout-container___");return qi=t||this.addContainer(),qi}getNodeType(t){var e;const s=null==(e=null==t?void 0:t.tagName)?void 0:e.toLowerCase();let i=Zi[s];return i||(i="Others"),i}calcStepBasedOnCharMeasure(t,e,s){try{let i=0,r=0,n=0,a=t[0];const o=[0],h=[],l=(e,s,l)=>{n=s,o.push(n),i=l,h.push(e),r+=1,a=t[r]};let c=-1;for(const o of e){const d=o.length;if(c+=d,r===t.length-1){h.push(e.length-1-n);break}const u=Xi(o,s),p=u+i;0===i&&p>=a?l(d,c,0):i<=a&&p>a?(a-i>p-a?l(c-n,c,0):l(c-d-n,c-d,u),i>a&&l(c-n,c,0)):i=p}return h}catch(t){return[]}}getLayoutForEachNode(t,e){let s=this.getNodeType(t);if(("Paragraph"===s||"List"===s)&&(this.currentParagraph={isBullet:!1,isOrdered:!1,blockIndex:this.layoutResult.length,textRects:[]},this.layoutResult.push(this.currentParagraph)),t.childNodes.length)t.childNodes.forEach((t=>this.getLayoutForEachNode(t,e)));else if(t.textContent&&3===t.nodeType){const i=t.parentNode;s=this.getNodeType(i);const r=Number(i.style.fontSize.replace("px","")),n=i.style.color||"#000",a="bold"===i.style.fontWeight,o=i.style.fontStyle.includes("italic"),h=i.style.textDecoration||"",l=h.includes("underline"),c=h.includes("line-through");let d;"Link"===s&&(d=i.href),this.currentParagraph&&this.currentParagraph.textRects.push(...this.getLineRectForNode(t,r,{bold:a,underline:l,strike:c,link:d,italic:o,color:n},e))}}getStep(t){var e;const s=null!=(e=this.steps[t])?e:1;return Number.isNaN(s)?1:Math.max(1,s)}loopClientRects(t,e){for(let s=0;s<t.length;s++)e(t[s],s)}getLineRectForNode(t,e,s,i){const r=t.textContent;if(!r)return[];const n=[0],a=[];let o=0,h=0;const l=Ki(t,r.length),d=[],u=[],p=[],g=[];this.loopClientRects(l,(t=>{u.push(t.width);const e=this.generateRectId(t);p.push(e);const{x:s,y:i,width:r,height:n}=t;d.push({x:s,y:i,width:r,height:n,id:e,index:-1})}));const f=l.length;if(1===f)a.push(r);else{this.steps=this.calcStepBasedOnCharMeasure(u,r,e),o+=this.getStep(h);let s=0;for(;o<r.length;){let e=!1;const i=Ki(t,o+1),l=i.length-1;if(l>=h+1){if(s=-1,o+=s,o<n[n.length-1])break}else if(l===h){const c=this.isValidLineBreak(i,p,g,d);if(c.valid){let s=o+1;for(;Ki(t,s+1).length-1===l&&s<r.length-1;)s+=1;h+=1,a.push(r.slice(n[n.length-1],s)),n.push(s),o=s+this.getStep(h),e=!0,c.foundRectId&&g.push(c.foundRectId)}else{if(!c.search)break;s=1,o+=s}}else s=1,o+=s;if(e&&(s=0,o>=r.length&&(o=r.length-1)),h===f-1){a.push(r.slice(n[n.length-1],r.length));break}}}d.sort(((t,e)=>t.index<0?1:e.index<0?-1:t.index-e.index));const _=[];return d.forEach(((t,r)=>{const n=a[r];if(t&&n){const{x:r,y:a,width:o,height:h}=t,l=((t,e,s)=>{var i;const r="".concat(t,"-").concat(e,"-").concat(s),n=Ui.get(r);if(n)return n;const a=document.createElement("div");a.style.display="inline-block",a.style.fontSize="".concat(e,"px"),a.style.lineHeight="".concat(s,"px");const o=document.createElement("span");o.innerHTML="Ag";const h=document.createElement("div");h.classList.add("editor_calc_getTextHeight"),h.style.display="inline-block",h.style.width="1px",h.style.height="0px";const l={baselineOffset:0,height:0,descent:0};a.appendChild(o),o.style.fontFamily=t;const c=document.createElement("div");c.appendChild(a),c.appendChild(h),document.body.appendChild(c);try{h.style.verticalAlign="baseline";const t=h.getBoundingClientRect(),s=o.getBoundingClientRect();if(void 0===t||void 0===s)throw new Error;const r=null!=(i=Gi[e])?i:Gi[0];l.baselineOffset=(t.top-s.top)*r}finally{c.parentElement&&c.parentElement.removeChild(c)}return l||void 0})(Mi,e,1.2*e);_.push({size:e,top:a-i,left:r,width:o,height:h,baselineOffset:(null==l?void 0:l.baselineOffset)||2*h/3,attributes:c({},s),firstInLine:!1,text:n})}})),_}resetState(){this.layoutResult=[],this.steps=[],this.overflow=!1}clear(){this.html=void 0}update(){this.resetState();const t=this.getContainer();t.firstChild&&t.firstChild.remove(),this.html&&t.appendChild(this.html);const e=t.firstChild;return e&&this.getLayoutForEachNode(e,t.getBoundingClientRect().top),this.actualHeight=t.firstChild.clientHeight,this.actualWidth=e.clientWidth,this.clear(),this.layoutResult}getTextRectsForRender(){return this.layoutResult}}let $i=null;class tr extends Ue{constructor(t){super({}),p(this,"text",""),p(this,"width",0),p(this,"height",0),p(this,"fontSize",30),p(this,"color","red"),p(this,"layoutRects",[]),p(this,"id"),this.id=t.id,this.text=t.text,this.width=t.width,this.height=t.height,this.color=t.color,this.fontSize=t.fontSize,this.updateLayout(),Qs.applyTransformToObject(this,t.transform),console.log("add text layout",this.layoutRects)}createDOMForTextContent(){const t=document.createElement("p");return t.textContent=this.text,t.style.width="".concat(this.width,"px"),t.style.fontSize="".concat(this.fontSize,"px"),t.style.fontFamily=Mi,t.style.wordBreak="break-word",t.style.padding="0",t.style.margin="0",t.dir="auto",t}updateLayout(){const t=($i||($i=new Qi),$i);t.html=this.createDOMForTextContent(),t.fontFamily=Mi,t.fontSize=this.fontSize,t.width=this.width,this.layoutRects=t.update(),this.height=t.actualHeight}_render(t){t.save(),t.transform(1,0,0,1,-this.width/2,-this.height/2),function(t,e,s){for(let i=0;i<t.length;i++){const r=t[i];for(let t=0;t<r.textRects.length;t++){const i=r.textRects[t],{italic:n=!1,bold:a=!1}=i.attributes,{top:o,left:h,width:l,size:c,height:d,baselineOffset:u}=i,p=n?"italic":"",g=a?"700":"400",f=o+u,_=i.text;e.fillStyle=s.color,e.font="".concat(p," ").concat(g," ").concat(c,"px ").concat(Mi),e.fillText(_,h,o+u);const O=Math.max(Math.floor(c/10),1);i.attributes.underline&&e.fillRect(h,f+.05*c,l,O),i.attributes.strike&&e.fillRect(h,f-c/3,l,O)}}}(this.layoutRects,t,{color:this.color}),t.restore()}}function er(t){return"ZoomScribble"===t.type}function sr(t){return"ZoomHighlighter"===t.type}function ir(t){return"ZoomFade"===t.type}function rr(t){return"ZoomLine"===t.type}Ue.prototype.transparentCorners=!1,Ue.prototype.shouldCache=()=>!1,Ue.prototype.hasControls=!1,Ue.prototype.hasBorders=!1,Ue.prototype.lockMovementX=!0,Ue.prototype.lockMovementY=!0;class nr extends Xs{setCursor(){}setActiveObject(){return this}getObjsInArea(t,e){const s=this._objects,i=[];for(let r=0;r<s.length;r++){const n=s[r];!n||!n.visible||(n.intersectsWithRect(t,e,!0)||n.isContainedWithinRect(t,e,!0))&&i.push(n)}return i}}const ar=["scribble:created","eraser:removed","tool:updated","after:renderLower"];class or{constructor(t){p(this,"canvas"),p(this,"tool",null),p(this,"providers",[]),this.canvas=new nr(t);const{canvas:e}=this;e.selection=!1}setWrapperStyle(t){const e=this.canvas.wrapperEl;e&&Qs.setStyle(e,t)}setViewport(t){this.canvas.setViewportTransform(t),this.canvas.requestRenderAll()}getCanvas(){return this.canvas}clear(){this.canvas.clear()}getTool(){return this.tool}clearTool(){this.tool=null}switchTool(t,e={}){this.tool={type:t,props:e},this.emit("tool:updated")}add(...t){this.canvas.add(...t)}getObjs(){return this.canvas._objects}getObjById(t){return this.canvas._objects.find((e=>e.id===t))}removeObjById(t){const e=this.canvas._objects.find((e=>e.id===t));e&&(this.canvas.remove(e),this.canvas.requestRenderAll())}removeAll(){const t=this.canvas._objects;t.length&&(this.canvas.remove(...t),this.canvas.requestRenderAll())}requestRenderAll(){this.canvas.requestRenderAll()}resize(t,e,s,i){if("abs"===i){this.canvas.enableRetinaScaling=!1;const i=1,r=t/((null==s?void 0:s.x)||1)/i,n=e/((null==s?void 0:s.y)||1)/i;this.canvas.setDimensions({width:r,height:n}),this.canvas.calcOffset(),this.setViewport([1/i,0,0,1/i,0,0]),this.setWrapperStyle({transformOrigin:"0 0",transform:"scaleX(".concat(t/r,") scaleY(").concat(e/n,")")})}else this.canvas.enableRetinaScaling=!0,this.canvas.setDimensions({width:t,height:e}),this.canvas.calcOffset(),s&&s.x&&s.y&&this.setViewport([s.x,0,0,s.y,0,0]),this.setWrapperStyle({transform:null})}register(t){t.register(this),this.providers.push(t)}hideObjById(t){const e=this.canvas._objects.find((e=>e.id===t));e&&(e.set("stroke","transparent"),this.canvas.requestRenderAll())}destroy(){this.providers.forEach((t=>t.unregister())),this.providers.length=0,this.canvas.dispose()}emit(t,e){if(ar.includes(t))try{this.canvas.fire(t,e)}catch(t){console.error(t)}}on(t,e){return ar.includes(t)?(this.canvas.on(t,e),()=>{this.canvas.off(t,e)}):()=>{}}off(t,e){ar.includes(t)&&this.canvas.off(t,e)}}function hr(t,e,s){return t.on(e,s),()=>{t.off(e,s)}}var lr=(t=>(t[t.LEFT=0]="LEFT",t[t.MIDDLE=1]="MIDDLE",t[t.RIGHT=2]="RIGHT",t))(lr||{});class cr{constructor(){p(this,"tool",{type:"eraser",props:{}}),p(this,"cleanups",[]),p(this,"detecting",!1),p(this,"mouseMovePoints",[]),p(this,"cancelAnimate",null),p(this,"updateTrailPath",null),p(this,"trailPath",null),p(this,"radius",5)}register(t){const e=t.getCanvas(),s=()=>{const e=t.getTool();return(null==e?void 0:e.type)===this.tool.type};function i(e){e&&(t.removeObjById(e.id),t.emit("eraser:removed",e))}const r=()=>{e.requestRenderTop()};this.cleanups.push(hr(e,"after:renderTop",(()=>{if(this.trailPath){const t=e.getSelectionContext();t.save();const s=e.viewportTransform;s&&t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),vi({obj:this.trailPath,ctx:t}),t.restore()}})),hr(e,"mouse:down",(t=>{const r=t.e;if(!s()||this.detecting||r.button===lr.RIGHT||r.button===lr.MIDDLE)return;const n=e.getPointer(r);this.mouseMovePoints.push(new E(n.x,n.y)),this.detecting=!0,t.target&&i(t.target),this.trailPath=new bi([],{stroke:"#DFE3E8",opacity:.4,strokeWidth:2*this.radius,strokeLineCap:"round",strokeLineJoin:"round",objectCaching:!1}),this.animate()})),hr(e,"mouse:move",(t=>{const s=t.e;if(!this.detecting)return;const r=e.getPointer(s);if(this.mouseMovePoints.push(new E(r.x,r.y)),t.target)i(t.target);else{const t=this.mouseMovePoints,s=t[t.length-2],r=t[t.length-1];if(s&&r&&!fi(s,r)){const{min:t,max:n}=Math,a=new E(t(s.x,r.x),t(s.y,r.y)),o=new E(n(s.x,r.x),n(s.y,r.y)),h=e.getObjsInArea(a,o);if(h.length){const t=J.intersectLinePolygon;for(const e of h)e&&((er(e)||ir(e)||sr(e))&&e.points.length&&"Intersection"===t(s,r,e.pointsObjs).status&&i(e),rr(e)&&e.intersectsWithLine(s,r)&&i(e))}}}this.animate()})),hr(e,"mouse:up",(()=>{this.resetState(),r()})),t.on("tool:updated",(()=>{s()||(this.resetState(),r())}))),this.updateTrailPath=()=>{if(!this.trailPath||this.mouseMovePoints.length<=0||!e.viewportTransform)return;const t=this.mouseMovePoints.slice();this.trailPath.updatePoints(t,"simple"),r()}}resetState(){this.detecting=!1,this.mouseMovePoints=[],this.trailPath=null}animate(){this.cancelAnimate&&(this.cancelAnimate(),this.cancelAnimate=null),this.updateTrailPath&&this.mouseMovePoints.length&&(this.cancelAnimate=Qs.animate({startValue:Math.floor(this.mouseMovePoints.length/10),endValue:this.mouseMovePoints.length-1,duration:1500,easing:(t,e,s,i)=>e+(s-e)*(t=>t**.3)(t/i),onChange:t=>{var e;this.mouseMovePoints=this.mouseMovePoints.slice(Math.floor(t)),null==(e=this.updateTrailPath)||e.call(this)},onComplete:()=>{var t;null==(t=this.updateTrailPath)||t.call(this)}}))}unregister(){this.cleanups.forEach((t=>t())),this.cleanups.length=0,this.resetState()}}class dr{constructor(){p(this,"tool",{type:"pen",props:{strokeWidth:void 0,stroke:void 0}}),p(this,"points",[]),p(this,"path",null),p(this,"cleanups",[]),p(this,"currentPointer",null)}register(t){const e=t.getCanvas(),s=()=>{const e=t.getTool();return"highlighter"===(null==e?void 0:e.type)},i=()=>{const e=t.getTool();return"fade"===(null==e?void 0:e.type)},r=()=>(()=>{const e=t.getTool();return"pen"===(null==e?void 0:e.type)})()||s()||i(),n=()=>{var e;return(null==(e=t.getTool())?void 0:e.props)||c({},this.tool.props)},a=()=>{e.requestRenderTop()};this.cleanups.push(hr(e,"after:renderTop",(()=>{if(this.path){const t=e.getSelectionContext();t.save();const s=e.viewportTransform;s&&t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),vi({obj:this.path,ctx:t}),t.restore()}})),hr(e,"mouse:down",(t=>{const o=t.e;if(!r()||o.button===lr.RIGHT||o.button===lr.MIDDLE||this.currentPointer||this.path)return;this.currentPointer={pointerId:o.pointerId};const h=e.getPointer(o),l=n();this.points=[h],this.path=s()?new yi(this.points,{stroke:l.stroke,strokeWidth:l.strokeWidth}):i()?new Ai(this.points,{stroke:l.stroke,strokeWidth:l.strokeWidth}):new bi(this.points,{stroke:l.stroke,strokeWidth:l.strokeWidth}),a()})),hr(e,"mouse:move",(t=>{const s=t.e;if(!this.path||!this.currentPointer||this.currentPointer.pointerId!==s.pointerId)return;const i=e.getPointer(s);this.points.push(i),this.path.updatePoints(this.points,"simple"),a()})),hr(e,"mouse:up",(s=>{if(!this.path||!this.currentPointer)return;const i=s.e,r=e.getPointer(i);this.points.push(r);const n=ri(this.points.map((t=>[t.x,t.y])),.7);this.path.updatePoints(n.map((([t,e])=>new E(t,e)))),e.add(this.path),t.emit("scribble:created",this.path),this.resetState(),a()})),t.on("tool:updated",(()=>{r()||(this.resetState(),a())})))}resetState(){this.path=null,this.currentPointer=null,this.points=[]}unregister(){this.cleanups.forEach((t=>t())),this.cleanups.length=0,this.resetState()}}class ur{constructor(){p(this,"textObj",null),p(this,"cleanups",[]),p(this,"tool",{type:"text",props:{color:void 0}})}register(t){}unregister(){this.cleanups.forEach((t=>t())),this.cleanups.length=0}}function pr(t){const e=t.height,s=t.width,i=t.absHeight;return{vW:s,vH:e,scale:{x:s/t.absWidth,y:e/i},mode:t.sizeMode}}var gr=(t=>(t[t.ONACK=0]="ONACK",t[t.TOOL_SELECT=1]="TOOL_SELECT",t[t.ERASE_ALL=2]="ERASE_ALL",t[t.RESIZE=3]="RESIZE",t[t.REMOVE_OBJECTS=4]="REMOVE_OBJECTS",t[t.RESTORE_OBJECTS=5]="RESTORE_OBJECTS",t[t.TOOL_BAR_CLOSED=6]="TOOL_BAR_CLOSED",t[t.CHANGE_SESSION=7]="CHANGE_SESSION",t[t.UPDATE_CANVAS=8]="UPDATE_CANVAS",t[t.DESTROY_SESSION=9]="DESTROY_SESSION",t[t.ADD_OBJECT=10]="ADD_OBJECT",t))(gr||{});const fr={[g.ANNO_TOOL_TYPE_PEN]:"pen",[g.ANNO_TOOL_TYPE_HIGHLIGHTER]:"highlighter",[g.ANNO_TOOL_TYPE_FADE_PEN]:"fade",[g.ANNO_TOOL_TYPE_ERASER]:"eraser",[g.ANNO_TOOL_TYPE_AUTO_LINE]:"line",[g.ANNO_TOOL_TYPE_AUTO_ARROW1]:"line_arrow_left",[g.ANNO_TOOL_TYPE_AUTO_DOUBLE_ARROW]:"line_arrow_left_right"},_r={[g.ANNO_TOOL_TYPE_AUTO_STAMP_CHECK]:"Check",[g.ANNO_TOOL_TYPE_AUTO_STAMP_ARROW]:"Arrow",[g.ANNO_TOOL_TYPE_AUTO_STAMP_HEART]:"Heart",[g.ANNO_TOOL_TYPE_AUTO_STAMP_QM]:"Question",[g.ANNO_TOOL_TYPE_AUTO_STAMP_STAR]:"Star",[g.ANNO_TOOL_TYPE_AUTO_STAMP_X]:"Cross"};class Or{constructor(){p(this,"onAnnotationMsg",(()=>{})),p(this,"onRenderEnd"),p(this,"editor"),p(this,"historicalObjs",new Map),p(this,"sessionId"),p(this,"sessionArchive",new Map),p(this,"hasInit",!1)}init(t){this.onAnnotationMsg=t.onAnnotationMsg,this.sessionId=t.sessionId,this.editor=this.createEditor({annoCanvas:t.annoCanvas,size:pr(t)});const{styles:e,onRenderEnd:s}=t;e&&this.editor.setWrapperStyle(e),this.onRenderEnd=s,this.hasInit=!0}createEditor(t){const{annoCanvas:e,size:s}=t,i=new or(e);return i.register(new dr),i.register(new cr),i.register(new ur),i.resize(s.vW,s.vH,s.scale,s.mode),i.on("scribble:created",(t=>{const e=function(t){if(er(t)||sr(t)||ir(t))return{type:Ti.Pen,points:t.points,penFormat:{type:er(t)?Si.Smooth:sr(t)?Si.Highlighter:Si.Fade,lineData:{width:t.strokeWidth,color:t.stroke?Ri("#".concat(new C(t.stroke).toHex())):ki}}}}(t);e&&this.onAnnotationMsg({type:Ci.addObject,objectId:t.id,objectData:e})})),i.on("eraser:removed",(t=>{this.historicalObjs.set(t.id,t),this.onAnnotationMsg({type:Ci.removeObject,objectId:t.id})})),i.on("after:renderLower",(()=>{const{onRenderEnd:t}=this;t&&t()})),i}reInit(t){const e=this.editor.getObjs().slice(),s=this.editor.getTool();this.editor.destroy(),this.editor=this.createEditor({annoCanvas:t.annoCanvas,size:pr(t)}),t.styles&&this.editor.setWrapperStyle(t.styles),this.editor.add(...e),s&&this.editor.switchTool(s.type,s.props)}destroy(){this.hasInit&&(this.historicalObjs.clear(),this.sessionArchive.clear(),this.editor.destroy())}restoreObjs(t){for(const e of t){const t=this.historicalObjs.get(e);t&&this.editor.add(t),this.historicalObjs.delete(e)}this.editor.requestRenderAll()}snapshot(){return{historicalObjs:new Map(this.historicalObjs),onCanvasObjs:this.editor.getObjs().slice()}}saveSession(){const t=this.snapshot();(t.historicalObjs.size||t.onCanvasObjs.length)&&this.sessionArchive.set(this.sessionId,t)}switchSession(t){if(this.sessionId===t)return;const e=this.sessionArchive.get(t);this.saveSession(),this.editor.removeAll(),this.historicalObjs=new Map,this.sessionId=t,e&&(this.historicalObjs=e.historicalObjs,this.editor.add(...e.onCanvasObjs)),this.editor.requestRenderAll()}removeAll(){const t=this.editor.getObjs();for(const e of t)this.historicalObjs.set(e.id,e);this.editor.removeAll()}removeObjs(t){for(const e of t){const t=this.editor.getObjById(e);t&&(this.historicalObjs.set(e,t),this.editor.removeObjById(e))}this.editor.requestRenderAll()}switchTool(t,e){const s={};(function(t){return f.includes(t)||_.includes(t)||O.includes(t)})(t)&&(s.strokeWidth=e.width||2,s.stroke=ji(e.color));const{tool:i,opts:r}=function(t){let e="none";const s={};return t in fr?e=fr[t]:m.includes(t)&&(e="stamp",s.type=_r[t]),{tool:e,opts:s}}(t);Object.assign(s,r),this.editor.switchTool(i,s)}onMessage(t){if(1===t.type){const e=t,{type:s,toolType:i}=e,r=u(e,["type","toolType"]);this.switchTool(i,r)}else if(2===t.type)this.removeAll();else if(0===t.type)this.editor.hideObjById(t.objectId);else if(6===t.type)this.editor.clearTool();else if(3===t.type){const e=pr(t);this.editor.resize(e.vW,e.vH,e.scale,e.mode)}else if(5===t.type)this.restoreObjs(t.objectIds);else if(4===t.type)this.removeObjs(t.objectIds);else if(7===t.type)this.switchSession(t.sessionId);else if(8===t.type)this.reInit(t);else if(9===t.type)this.sessionArchive.delete(t.sessionId),this.sessionId===t.sessionId&&(this.historicalObjs.clear(),this.editor.removeAll());else if(10===t.type){const e=function(t){var e,s,i,r,n;const{objectData:a,objectId:o}=t;switch(a.type){case Ti.Pen:{const{penFormat:t,points:r}=a;if(t.type===Si.Smooth)return new bi(r,{id:o,strokeWidth:t.lineData.width,stroke:Pi(null!=(e=t.lineData.color)?e:ki)});if(t.type===Si.Highlighter)return new yi(r,{id:o,strokeWidth:t.lineData.width,stroke:Pi(null!=(s=t.lineData.color)?s:ki)});if(t.type===Si.Fade)return new Ai(r,{id:o,strokeWidth:t.lineData.width,stroke:Pi(null!=(i=t.lineData.color)?i:ki)});break}case Ti.Shape:{const{shapeFormat:{type:t,style:e,lineData:s,color:i},transform:r,width:n,height:h}=a;return new Fi(t,{style:e,color:i,id:o,transform:r,width:n,height:h,lineData:s})}case Ti.Line:{const{lineFormat:{type:t,start:e,end:s,lineData:i}}=a;return new ei({arrowType:t===wi.Simple?"":t===wi.ArrowLeft?"arrow_left":"arrow_left_right",start:new E(e.x,e.y),end:new E(s.x,s.y)},{id:o,strokeWidth:(null==i?void 0:i.width)||2,stroke:Pi(null!=(r=null==i?void 0:i.color)?r:ki)})}case Ti.Text:{const{textFormat:t,transform:e,width:s,height:i}=a;return new tr({id:o,text:t.text,color:Pi(null!=(n=t.color)?n:ki),width:s,height:i,transform:e,fontSize:t.fontSize})}case Ti.Stamp:{const{transform:t,stampFormat:e,width:s,height:i}=a;return new ti(e.type,{id:o,transform:t,width:s,height:i})}}}(t.data);if(!e)return;this.editor.add(e)}}}function mr(t){return t>>>10}function vr(t){return t>>>8<<10|(t<<8>>>18)%1023}let br=0,yr=0,Ar=0,Tr=0;class Sr{constructor(t){this._id=t}getId(){return this._id}setId(t){this._id=t}}class wr extends Sr{constructor(t){super(t)}acquireDocId(t){return br++,this._id=mr(t)<<10|1023&br,this._id}amendDocId(t){return this._id=mr(t)<<10|1023&this._id,this._id}}class xr extends Sr{constructor(t){super(t)}acquirePageId(t){return yr++,this._id=mr(t)<<10|1023&yr,this._id}AmendPageId(t){return this._id=mr(t)<<10|1023&this._id,this._id}}class Ir extends Sr{constructor(t){super(t)}acquireObjId(t){return Ar++,this._id=vr(t)<<18|262143&Ar,this._id}AmendObjId(t){return this._id=vr(t)<<18|262143&this._id,this._id}}class Cr extends Sr{constructor(t){super(t)}acquirePduId(){return this._id=Tr++,this._id}}const kr=4294967295;var Er,Pr,jr,Rr,Lr,Nr,Dr,Fr,Mr,Br,Yr,Hr,zr,Wr,Xr,Ur,Vr,Gr,qr,Jr,Kr,Zr,Qr,$r,tn,en,sn,rn;function nn(){return{toolType:g.ANNO_TOOL_TYPE_NONE,width:0,color:0,alpha:0}}!function(t){t[t.kComposite=0]="kComposite",t[t.kGroup=1]="kGroup",t[t.kPen=2]="kPen",t[t.kSmoothPen=3]="kSmoothPen",t[t.kHighlighter=4]="kHighlighter",t[t.kSpotlight=5]="kSpotlight",t[t.kArrow=6]="kArrow",t[t.kArrowWnd=7]="kArrowWnd",t[t.kTextbox=8]="kTextbox",t[t.kAutoLine=9]="kAutoLine",t[t.kAutoArrow1=10]="kAutoArrow1",t[t.kAutoArrow2=11]="kAutoArrow2",t[t.kAutoRectangle=12]="kAutoRectangle",t[t.kAutoRoundedRectangle=13]="kAutoRoundedRectangle",t[t.kAutoEllipse=14]="kAutoEllipse",t[t.kAutoDoubleArrow=15]="kAutoDoubleArrow",t[t.kAutoDiamond=16]="kAutoDiamond",t[t.kAutoStampArrow=17]="kAutoStampArrow",t[t.kAutoStampCheck=18]="kAutoStampCheck",t[t.kAutoStampX=19]="kAutoStampX",t[t.kThicknessPen=20]="kThicknessPen",t[t.kAutoStampStar=21]="kAutoStampStar",t[t.kAutoStampHeart=22]="kAutoStampHeart",t[t.kAutoStampQm=23]="kAutoStampQm",t[t.kImage=24]="kImage",t[t.kFadePen=25]="kFadePen",t[t.kStickyNote=26]="kStickyNote",t[t.kWbSdkObj=27]="kWbSdkObj",t[t.kAutoTriangle=28]="kAutoTriangle",t[t.kAutoStar=29]="kAutoStar",t[t.kAutoOffPage=30]="kAutoOffPage",t[t.kAutoData=31]="kAutoData",t[t.kAutoBarrel=32]="kAutoBarrel",t[t.kAutoDelay=33]="kAutoDelay",t[t.kAutoDisplay=34]="kAutoDisplay",t[t.kAutoDocument=35]="kAutoDocument",t[t.kAutoManualInput=36]="kAutoManualInput",t[t.kAutoMerge=37]="kAutoMerge",t[t.kAutoMultiDoc=38]="kAutoMultiDoc",t[t.kAutoTerminator=39]="kAutoTerminator",t[t.kAutoPredefProcess=40]="kAutoPredefProcess",t[t.kAutoPreparation=41]="kAutoPreparation",t[t.kAutoCloud=42]="kAutoCloud",t[t.kAutoArrowLeft=43]="kAutoArrowLeft",t[t.kAutoArrowRight=44]="kAutoArrowRight",t[t.kAutoArrowLeftRight=45]="kAutoArrowLeftRight",t[t.kAutoOctagon=46]="kAutoOctagon",t[t.kAutoHexagon=47]="kAutoHexagon",t[t.kAutoPentagon=48]="kAutoPentagon",t[t.kAutoHeart=49]="kAutoHeart",t[t.kAutoDecagon=50]="kAutoDecagon",t[t.kAutoCube=51]="kAutoCube",t[t.kAutoCross=52]="kAutoCross",t[t.kAutoTrapezoid=53]="kAutoTrapezoid",t[t.kAutoOr=54]="kAutoOr",t[t.kAutoSummingJunction=55]="kAutoSummingJunction",t[t.kAutoManualOperation=56]="kAutoManualOperation",t[t.kAutoCard=57]="kAutoCard",t[t.kAutoHardDisk=58]="kAutoHardDisk",t[t.kAutoInternalStorage=59]="kAutoInternalStorage",t[t.kAutoDisplayNew=60]="kAutoDisplayNew",t[t.kAutoLoopLimit=61]="kAutoLoopLimit",t[t.kAutoCollate=62]="kAutoCollate",t[t.kAutoActor=63]="kAutoActor",t[t.kAutoNote=64]="kAutoNote",t[t.kAutoPackage=65]="kAutoPackage",t[t.kAutoUseCase=66]="kAutoUseCase",t[t.kAutoSendSignal=67]="kAutoSendSignal",t[t.kAutoReceiveSignal=68]="kAutoReceiveSignal",t[t.kAutoPlus=69]="kAutoPlus",t[t.kAutoMinus=70]="kAutoMinus",t[t.kAutoMultiply=71]="kAutoMultiply",t[t.kAutoDivide=72]="kAutoDivide",t[t.kAutoEqual=73]="kAutoEqual",t[t.kAutoNotEqual=74]="kAutoNotEqual",t[t.kAutoMetaShape=75]="kAutoMetaShape",t[t.kHandwritePen=76]="kHandwritePen",t[t.kNull=77]="kNull"}(Er||(Er={})),function(t){t[t.kAppBase=4096]="kAppBase",t[t.kAppMax=8191]="kAppMax",t[t.kDocBase=8192]="kDocBase",t[t.kDocRequestDraw=8193]="kDocRequestDraw",t[t.kDocRequestDrawAck=8194]="kDocRequestDrawAck",t[t.kPageBase=12288]="kPageBase",t[t.kPageSync=12293]="kPageSync",t[t.kAnnoObjBase=65536]="kAnnoObjBase",t[t.kAnnoObjAdd=65537]="kAnnoObjAdd",t[t.kAnnoObjAddAck=65538]="kAnnoObjAddAck",t[t.kAnnoObjRemove=65539]="kAnnoObjRemove",t[t.kAnnoObjRestore=65540]="kAnnoObjRestore",t[t.kAnnoObjRemoveUser=65541]="kAnnoObjRemoveUser",t[t.kAnnoObjRestoreUser=65542]="kAnnoObjRestoreUser",t[t.kAnnoObjRemoveAll=65545]="kAnnoObjRemoveAll",t[t.kAnnoObjRestoreAll=65546]="kAnnoObjRestoreAll",t[t.kAnnoObjRemoveAllByHost=65547]="kAnnoObjRemoveAllByHost",t[t.kAnnoObjRestoreAllByHost=65548]="kAnnoObjRestoreAllByHost",t[t.kAnnoArrowBase=131072]="kAnnoArrowBase",t[t.kAnnoArrowAdd=131073]="kAnnoArrowAdd",t[t.kAnnoArrowRemove=131074]="kAnnoArrowRemove",t[t.kAnnoArrowChange=131075]="kAnnoArrowChange",t[t.kAnnoArrowMax=131583]="kAnnoArrowMax",t[t.kNull=143360]="kNull"}(Pr||(Pr={})),function(t){t[t.FROM_LOCAL=0]="FROM_LOCAL",t[t.FROM_REMOTE=1]="FROM_REMOTE"}(jr||(jr={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.ACCPETED=1]="ACCPETED",t[t.DECLINED=2]="DECLINED"}(Rr||(Rr={})),function(t){t[t.ANNO_LINE_FORMAT_TYPE_NONE=0]="ANNO_LINE_FORMAT_TYPE_NONE",t[t.ANNO_LINE_FORMAT_TYPE_COLOR=1]="ANNO_LINE_FORMAT_TYPE_COLOR",t[t.ANNO_LINE_FORMAT_TYPE_DEFAULT=1]="ANNO_LINE_FORMAT_TYPE_DEFAULT"}(Lr||(Lr={})),function(t){t[t.ANNO_LINE_DASH_STYLE_SOLID=0]="ANNO_LINE_DASH_STYLE_SOLID",t[t.ANNO_LINE_DASH_STYLE_DASH=1]="ANNO_LINE_DASH_STYLE_DASH",t[t.ANNO_LINE_DASH_STYLE_DOT=2]="ANNO_LINE_DASH_STYLE_DOT",t[t.ANNO_LINE_DASH_STYLE_DASHDOT=3]="ANNO_LINE_DASH_STYLE_DASHDOT",t[t.ANNO_LINE_DASH_STYLE_DASHDOTDOT=4]="ANNO_LINE_DASH_STYLE_DASHDOTDOT",t[t.ANNO_LINE_DASH_STYLE_PATTERN=5]="ANNO_LINE_DASH_STYLE_PATTERN",t[t.ANNO_LINE_DASH_STYLE_DEFAULT=0]="ANNO_LINE_DASH_STYLE_DEFAULT"}(Nr||(Nr={})),function(t){t[t.ANNO_LINE_JOIN_STYLE_JOINMITER=0]="ANNO_LINE_JOIN_STYLE_JOINMITER",t[t.ANNO_LINE_JOIN_STYLE_JOINROUND=1]="ANNO_LINE_JOIN_STYLE_JOINROUND",t[t.ANNO_LINE_JOIN_STYLE_JOINBEVEL=2]="ANNO_LINE_JOIN_STYLE_JOINBEVEL",t[t.ANNO_LINE_JOIN_STYLE_MITERORBEVEL=3]="ANNO_LINE_JOIN_STYLE_MITERORBEVEL",t[t.ANNO_LINE_JOIN_STYLE_DEFAULT=1]="ANNO_LINE_JOIN_STYLE_DEFAULT"}(Dr||(Dr={})),function(t){t[t.ANNO_LINE_CAP_STYLE_BUTT=0]="ANNO_LINE_CAP_STYLE_BUTT",t[t.ANNO_LINE_CAP_STYLE_CAPROUND=1]="ANNO_LINE_CAP_STYLE_CAPROUND",t[t.ANNO_LINE_CAP_STYLE_CAPSQUARE=2]="ANNO_LINE_CAP_STYLE_CAPSQUARE",t[t.ANNO_LINE_CAP_STYLE_CAPTRIANGLE=3]="ANNO_LINE_CAP_STYLE_CAPTRIANGLE",t[t.ANNO_LINE_CAP_STYLE_DEFAULT=1]="ANNO_LINE_CAP_STYLE_DEFAULT"}(Fr||(Fr={})),function(t){t[t.ANNO_OBJ_FLAG_NOTHING=0]="ANNO_OBJ_FLAG_NOTHING",t[t.ANNO_OBJ_FLAG_WITH_TRANSFORM=1]="ANNO_OBJ_FLAG_WITH_TRANSFORM",t[t.ANNO_OBJ_FLAG_WITH_LINE=2]="ANNO_OBJ_FLAG_WITH_LINE",t[t.ANNO_OBJ_FLAG_WITH_FILL=4]="ANNO_OBJ_FLAG_WITH_FILL",t[t.ANNO_OBJ_FLAG_WITH_TEXTFRAME=8]="ANNO_OBJ_FLAG_WITH_TEXTFRAME"}(Mr||(Mr={})),function(t){t[t.ANNO_ENCODE_TYPE_NONE=0]="ANNO_ENCODE_TYPE_NONE",t[t.ANNO_ENCODE_TYPE_BASE64=1]="ANNO_ENCODE_TYPE_BASE64",t[t.ANNO_ENCODE_TYPE_GZIP_BASE64=2]="ANNO_ENCODE_TYPE_GZIP_BASE64"}(Br||(Br={})),function(t){t.ADD_OBJECT="addObject",t.REMOVE_OBJECT="removeObject"}(Yr||(Yr={})),function(t){t[t.SELECT_MOUSE=0]="SELECT_MOUSE",t[t.SELECT_TOOL=1]="SELECT_TOOL",t[t.SELECT_ERASER=2]="SELECT_ERASER",t[t.UNDO=3]="UNDO",t[t.REDO=4]="REDO",t[t.CLEAR=5]="CLEAR",t[t.CLOSE_TOOL_BAR=6]="CLOSE_TOOL_BAR",t[t.UPDATE_PARAMS=7]="UPDATE_PARAMS",t[t.PAUSE_ANNOTATION=8]="PAUSE_ANNOTATION",t[t.SHOW_ANNOTATOR_NAME=9]="SHOW_ANNOTATOR_NAME",t[t.ANNOTATOR_ID_TO_NAME=10]="ANNOTATOR_ID_TO_NAME",t[t.ANNO_CANVAS_SIZE_UPDATE=11]="ANNO_CANVAS_SIZE_UPDATE"}(Hr||(Hr={})),function(t){t[t.CLEAR_MINE=0]="CLEAR_MINE",t[t.CLEAR_VIEWER=1]="CLEAR_VIEWER",t[t.CLEAR_ALL=2]="CLEAR_ALL"}(zr||(zr={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(Wr||(Wr={})),function(t){t[t.TOP=0]="TOP",t[t.CENTER=1]="CENTER",t[t.BOTTOM=2]="BOTTOM"}(Xr||(Xr={})),function(t){t[t.ANNO_FILL_FORMAT_TYPE_NONE=0]="ANNO_FILL_FORMAT_TYPE_NONE",t[t.ANNO_FILL_FORMAT_TYPE_COLOR=1]="ANNO_FILL_FORMAT_TYPE_COLOR",t[t.ANNO_FILL_FORMAT_TYPE_DEFAULT=0]="ANNO_FILL_FORMAT_TYPE_DEFAULT"}(Ur||(Ur={})),function(t){t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT",t[t.JUSTIFY=3]="JUSTIFY",t[t.JUSTIFY_LOW=4]="JUSTIFY_LOW",t[t.NATURAL=5]="NATURAL",t[t.DISTRIBUTE=6]="DISTRIBUTE",t[t.THAI_DISTRIBUTE=7]="THAI_DISTRIBUTE"}(Vr||(Vr={})),function(t){t[t.BASELINE=0]="BASELINE",t[t.TOP=1]="TOP",t[t.CENTER=2]="CENTER",t[t.FAREAST50=3]="FAREAST50"}(Gr||(Gr={})),function(t){t[t.LEFT_TO_RIGHT=0]="LEFT_TO_RIGHT",t[t.RIGHT_TO_LEFT=1]="RIGHT_TO_LEFT"}(qr||(qr={})),function(t){t[t.NONE=0]="NONE",t[t.NUMBERERD=1]="NUMBERERD",t[t.UNNUMBERERD=2]="UNNUMBERERD",t[t.PICTURE=3]="PICTURE"}(Jr||(Jr={})),function(t){t[t.ALPHA_LC_PERIOD=0]="ALPHA_LC_PERIOD"}(Kr||(Kr={})),function(t){t[t.ANNO_TAB_STOP_TYPE_LEFT=0]="ANNO_TAB_STOP_TYPE_LEFT",t[t.ANNO_TAB_STOP_TYPE_RIGHT=1]="ANNO_TAB_STOP_TYPE_RIGHT",t[t.ANNO_TAB_STOP_TYPE_CENTER=2]="ANNO_TAB_STOP_TYPE_CENTER",t[t.ANNO_TAB_STOP_TYPE_DECIMAL=3]="ANNO_TAB_STOP_TYPE_DECIMAL"}(Zr||(Zr={})),function(t){t[t.ADD_OBJ=0]="ADD_OBJ",t[t.REMOVE_OBJ=1]="REMOVE_OBJ",t[t.RESTORE_OBJ=2]="RESTORE_OBJ",t[t.REMOVE_ALL_OBJ=3]="REMOVE_ALL_OBJ",t[t.RESTORE_ALL_OBJ=4]="RESTORE_ALL_OBJ"}(Qr||(Qr={})),function(t){t.Pen="pen",t.Text="text",t.Line="line",t.Shape="shape",t.Stamp="stamp"}($r||($r={})),function(t){t.Smooth="smooth",t.Fade="fade",t.Highlighter="highlighter"}(tn||(tn={})),function(t){t.Rectangle="rectangle",t.Ellipse="ellipse",t.Diamond="diamond"}(en||(en={})),function(t){t.addObject="addObject",t.removeObject="removeObject"}(sn||(sn={}));class an{constructor(t){this.mData=t?Array.from(t):[],this.currentPos=0}getSize(){return this.mData.length}writeInt8(t){this.mData.push(255&t),this.currentPos+=1}writeInt16(t){this.mData.push(255&t),this.mData.push(t>>>8&255),this.currentPos+=2}writeInt32(t){this.mData.push(255&t),this.mData.push(t>>>8&255),this.mData.push(t>>>16&255),this.mData.push(t>>>24&255),this.currentPos+=4}writeInt16At(t,e){this.mData[t]=255&e,this.mData[t+1]=e>>>8&255}writeInt32At(t,e){this.mData[t]=255&e,this.mData[t+1]=e>>>8&255,this.mData[t+2]=e>>>16&255,this.mData[t+3]=e>>>24&255}writeFloat32(t){const e=new DataView(new ArrayBuffer(4));e.setFloat32(0,t,!0);const s=new Uint8Array(e.buffer);for(let t=0;t<4;t++)this.mData.push(s[t]);this.currentPos+=4}writeString(t){const e=t.length;this.writeInt32(e);for(let s=0;s<e;s++)this.writeInt16(t.charCodeAt(s))}writeStringIn16BitCode(t){let e=0;for(;e<t.length;)this.writeInt16(t.charCodeAt(e++))}readInt8(){const t=this.currentPos;if(t>=this.mData.length)return 0;const e=this.mData[t];return this.currentPos+=1,e}readInt16(){const t=this.currentPos;if(t+1>=this.mData.length)return 0;const e=this.mData[t]|this.mData[t+1]<<8;return this.currentPos+=2,e}readInt32(){const t=this.readInt32At(this.currentPos);return this.currentPos+=4,t}readInt32At(t){return t<0||t+4>this.mData.length?0:this.mData[t]|this.mData[t+1]<<8|this.mData[t+2]<<16|this.mData[t+3]<<24}readString(){const t=this.readInt32();let e="";for(let s=0;s<t&&s<this.mData.length;s++)e+=String.fromCharCode(this.readInt16());return e}readStringFrom16CharCode(t){let e=[],s=0;for(;s<t;)e.push(this.readInt16()),s++;return String.fromCharCode(...e)}readFloat32(){if(this.currentPos+3>=this.mData.length)return 0;const t=this.mData.slice(this.currentPos,this.currentPos+4),e=new DataView(new Uint8Array(t).buffer);return this.currentPos+=4,e.getFloat32(0,!0)}toInt8Array(){return new Uint8Array(this.mData)}tell(){return this.currentPos}seek(t){this.currentPos=this.mData.length>t?t:this.mData.length-1}}function on(t,e){t.writeInt16(e.struSize),t.writeInt32(e.dataSize)}function hn(t,e){e.struSize=t.readInt16(),e.dataSize=t.readInt32()}function ln(t,e,s){const i=t.tell();s.struSize!=i-e&&(s.struSize=i-e,t.writeInt16At(e,s.struSize))}function cn(t,e,s){const i=t.tell();s.dataSize!=i-e&&(s.dataSize=i-e,t.writeInt32At(e+2,s.dataSize))}function dn(t,e,s){t.tell()-e<s.struSize&&t.seek(e+s.struSize)}function un(t,e,s){t.tell()-e<s.dataSize&&t.seek(e+s.dataSize)}function pn(t,e,s,i){return{dnSource:jr.FROM_LOCAL,appId:t||kr,userName:e||"",docId:s||kr,pageId:i||kr,annoObjIds:new Array}}function gn(t){return t>>>16&255|(t>>>8&255)<<8|(255&t)<<16}function fn(t,e){return{pduType:e,appId:t.appId||kr,docId:t.docId||kr,pageId:t.pageId||kr,annoObjIds:t.annoObjIds||[],whiteboardObjIds:t.whiteboardObjIds||[]}}function _n(t){const{left:e,top:s,right:i,bottom:r}=t,n=Math.abs(i-e),a=Math.abs(r-s);return{width:n,height:a,transform:[1,0,0,1,e+n/2,s+a/2]}}!function(t){t[t.ANNO_OBJ_HIT_CONSTRAINT_NONE=0]="ANNO_OBJ_HIT_CONSTRAINT_NONE",t[t.ANNO_OBJ_HIT_CONSTRAINT_LEFT_TOP=1]="ANNO_OBJ_HIT_CONSTRAINT_LEFT_TOP",t[t.ANNO_OBJ_HIT_CONSTRAINT_CENTER_TOP=2]="ANNO_OBJ_HIT_CONSTRAINT_CENTER_TOP",t[t.ANNO_OBJ_HIT_CONSTRAINT_RIGHT_TOP=4]="ANNO_OBJ_HIT_CONSTRAINT_RIGHT_TOP",t[t.ANNO_OBJ_HIT_CONSTRAINT_RIGHT_CENTER=8]="ANNO_OBJ_HIT_CONSTRAINT_RIGHT_CENTER",t[t.ANNO_OBJ_HIT_CONSTRAINT_RIGHT_BOTTOM=16]="ANNO_OBJ_HIT_CONSTRAINT_RIGHT_BOTTOM",t[t.ANNO_OBJ_HIT_CONSTRAINT_CENTER_BOTTOM=32]="ANNO_OBJ_HIT_CONSTRAINT_CENTER_BOTTOM",t[t.ANNO_OBJ_HIT_CONSTRAINT_LEFT_BOTTOM=64]="ANNO_OBJ_HIT_CONSTRAINT_LEFT_BOTTOM",t[t.ANNO_OBJ_HIT_CONSTRAINT_LEFT_CENTER=128]="ANNO_OBJ_HIT_CONSTRAINT_LEFT_CENTER",t[t.ANNO_OBJ_HIT_CONSTRAINT_ALL=255]="ANNO_OBJ_HIT_CONSTRAINT_ALL"}(rn||(rn={}));class On{constructor(){this.annoObjScribble={struSize:6,dataSize:6,annoPoints:[]}}pack(t){const e=t.tell(),s=this.annoObjScribble.annoPoints.length;if(on(t,this.annoObjScribble),ln(t,e,this.annoObjScribble),s>0){t.writeInt32(s);for(let e=0;e<s;e++)t.writeInt32(this.annoObjScribble.annoPoints[e].x),t.writeInt32(this.annoObjScribble.annoPoints[e].y)}cn(t,e,this.annoObjScribble)}unpack(t){const e=t.tell();hn(t,this.annoObjScribble),dn(t,e,this.annoObjScribble);const s=t.readInt32();for(let e=0;e<s;e++){const e=t.readInt32(),s=t.readInt32();this.annoObjScribble.annoPoints.push({x:e,y:s})}un(t,e,this.annoObjScribble)}setData(t){this.annoObjScribble.annoPoints=t}getData(){return this.annoObjScribble.annoPoints}}class mn{constructor(){}pack(t){}unpack(t){}}class vn extends mn{constructor(t){super(),this.transform={struSize:30,dataSize:30,a:0,b:0,c:0,d:0,tx:0,ty:0},t&&(this.transform.a=t.a,this.transform.b=t.b,this.transform.c=t.c,this.transform.d=t.d,this.transform.tx=t.tx,this.transform.ty=t.ty)}pack(t){t.writeFloat32(this.transform.a),t.writeFloat32(this.transform.b),t.writeFloat32(this.transform.c),t.writeFloat32(this.transform.d),t.writeFloat32(this.transform.tx),t.writeFloat32(this.transform.ty)}unpack(t){this.transform.a=t.readFloat32(),this.transform.b=t.readFloat32(),this.transform.c=t.readFloat32(),this.transform.d=t.readFloat32(),this.transform.tx=t.readFloat32(),this.transform.ty=t.readFloat32()}}class bn extends mn{constructor(t){super(),this.annoLineFormat={struSize:10,dataSize:40,type:Lr.ANNO_LINE_FORMAT_TYPE_DEFAULT,annoLineData:{colorLine:{struSize:30,dataSize:30,dashStyle:Nr.ANNO_LINE_DASH_STYLE_DEFAULT,joinStyle:Dr.ANNO_LINE_JOIN_STYLE_DEFAULT,capStyle:Fr.ANNO_LINE_CAP_STYLE_DEFAULT,width:2,color:255,alpha:1}}},t&&(t.type in Lr&&(this.annoLineFormat.type=t.type),t.lineData&&(this.annoLineFormat.annoLineData.colorLine.width=t.lineData.width,this.annoLineFormat.annoLineData.colorLine.color=gn(t.lineData.color)))}pack(t){super.pack(t);const e=t.tell();switch(on(t,this.annoLineFormat),t.writeInt32(this.annoLineFormat.type),this.annoLineFormat.type){case Lr.ANNO_LINE_FORMAT_TYPE_NONE:break;case Lr.ANNO_LINE_FORMAT_TYPE_DEFAULT:{const e=t.tell();on(t,this.annoLineFormat.annoLineData.colorLine),t.writeInt32(this.annoLineFormat.annoLineData.colorLine.dashStyle),t.writeInt32(this.annoLineFormat.annoLineData.colorLine.joinStyle),t.writeInt32(this.annoLineFormat.annoLineData.colorLine.capStyle),t.writeInt32(this.annoLineFormat.annoLineData.colorLine.width),t.writeInt32(this.annoLineFormat.annoLineData.colorLine.color),t.writeFloat32(this.annoLineFormat.annoLineData.colorLine.alpha),cn(t,e,this.annoLineFormat.annoLineData.colorLine);break}}cn(t,e,this.annoLineFormat)}unpack(t){super.unpack(t);const e=t.tell();switch(hn(t,this.annoLineFormat),this.annoLineFormat.type=t.readInt32(),dn(t,e,this.annoLineFormat),this.annoLineFormat.type){case Lr.ANNO_LINE_FORMAT_TYPE_NONE:break;case Lr.ANNO_LINE_FORMAT_TYPE_COLOR:{const e=t.tell();hn(t,this.annoLineFormat.annoLineData.colorLine),this.annoLineFormat.annoLineData.colorLine.dashStyle=t.readInt32(),this.annoLineFormat.annoLineData.colorLine.joinStyle=t.readInt32(),this.annoLineFormat.annoLineData.colorLine.capStyle=t.readInt32(),this.annoLineFormat.annoLineData.colorLine.width=t.readInt32(),this.annoLineFormat.annoLineData.colorLine.color=gn(t.readInt32()),this.annoLineFormat.annoLineData.colorLine.alpha=t.readFloat32(),dn(t,e,this.annoLineFormat.annoLineData.colorLine),un(t,e,this.annoLineFormat.annoLineData.colorLine);break}}un(t,e,this.annoLineFormat)}}class yn extends mn{constructor(t){super(),this.annoFillFormat={struSize:10,dataSize:10,type:Ur.ANNO_FILL_FORMAT_TYPE_DEFAULT,colorFill:{struSize:14,dataSize:14,color:0,alpha:1}},t&&(t.type in Ur&&(this.annoFillFormat.type=t.type),t.colorFill&&(this.annoFillFormat.colorFill.color=t.colorFill.color,this.annoFillFormat.colorFill.alpha=t.colorFill.alpha))}pack(t){super.pack(t);const e=t.tell();switch(on(t,this.annoFillFormat),t.writeInt32(this.annoFillFormat.type),ln(t,e,this.annoFillFormat),this.annoFillFormat.type){case Ur.ANNO_FILL_FORMAT_TYPE_NONE:break;case Ur.ANNO_FILL_FORMAT_TYPE_COLOR:{const e=t.tell();on(t,this.annoFillFormat.colorFill),t.writeInt32(this.annoFillFormat.colorFill.color),t.writeFloat32(this.annoFillFormat.colorFill.alpha),ln(t,e,this.annoFillFormat.colorFill),cn(t,e,this.annoFillFormat.colorFill);break}}cn(t,e,this.annoFillFormat)}unpack(t){super.unpack(t);const e=t.tell();switch(hn(t,this.annoFillFormat),this.annoFillFormat.type=t.readInt32(),dn(t,e,this.annoFillFormat),this.annoFillFormat.type){case Ur.ANNO_FILL_FORMAT_TYPE_NONE:break;case Ur.ANNO_FILL_FORMAT_TYPE_COLOR:{const e=t.tell();hn(t,this.annoFillFormat.colorFill),this.annoFillFormat.colorFill.color=t.readInt32(),this.annoFillFormat.colorFill.alpha=t.readFloat32(),dn(t,e,this.annoFillFormat.colorFill),un(t,e,this.annoFillFormat.colorFill);break}}un(t,e,this.annoFillFormat)}}class An extends Ir{constructor(t){super(kr),this.annoObjHeader={struSize:18,dataSize:18,objType:Er.kNull,objFlag:kr,objId:kr},this.annoObjHeader.objType=t,this.annoObjHeader.objFlag=2,this.annoTransform=null,this.annoLineFormat=null,this.annoFillFormat=null,this.annoTextFrame=null,this.annoObjHitConstraint=rn.ANNO_OBJ_HIT_CONSTRAINT_NONE,this.appId=kr,this.docId=kr,this.pageId=kr}pack(t){var e,s,i,r;this.annoObjHeader.objId=this.getId();const n=t.tell();on(t,this.annoObjHeader),t.writeInt32(this.annoObjHeader.objType),t.writeInt32(this.annoObjHeader.objFlag),t.writeInt32(this.annoObjHeader.objId),this.annoObjHeader.objFlag&Mr.ANNO_OBJ_FLAG_WITH_TRANSFORM&&(null===(e=this.annoTransform)||void 0===e||e.pack(t)),this.annoObjHeader.objFlag&Mr.ANNO_OBJ_FLAG_WITH_LINE&&(null===(s=this.annoLineFormat)||void 0===s||s.pack(t)),this.annoObjHeader.objFlag&Mr.ANNO_OBJ_FLAG_WITH_FILL&&(null===(i=this.annoFillFormat)||void 0===i||i.pack(t)),this.annoObjHeader.objFlag&Mr.ANNO_OBJ_FLAG_WITH_TEXTFRAME&&(null===(r=this.annoTextFrame)||void 0===r||r.pack(t)),cn(t,n,this.annoObjHeader)}unpack(t){const e=t.tell();hn(t,this.annoObjHeader),this.annoObjHeader.objType=t.readInt32(),this.annoObjHeader.objFlag=t.readInt32(),this.annoObjHeader.objId=t.readInt32(),dn(t,e,this.annoObjHeader),this.setId(this.annoObjHeader.objId),this.annoObjHeader.objFlag&Mr.ANNO_OBJ_FLAG_WITH_TRANSFORM&&(this.annoTransform=new vn,this.annoTransform.unpack(t)),this.annoObjHeader.objFlag&Mr.ANNO_OBJ_FLAG_WITH_LINE&&(this.annoLineFormat=new bn,this.annoLineFormat.unpack(t)),this.annoObjHeader.objFlag&Mr.ANNO_OBJ_FLAG_WITH_FILL&&(this.annoFillFormat=new yn,this.annoFillFormat.unpack(t)),this.annoObjHeader.objFlag&Mr.ANNO_OBJ_FLAG_WITH_TEXTFRAME&&(this.annoTextFrame=new Xn,this.annoTextFrame.unpack(t)),un(t,e,this.annoObjHeader)}packIds(t){t.writeInt32(1),t.writeInt32(this.getId())}setObjHeader(t){this.annoObjHeader.objId=t.objectId}setLineFormat(t){const e=new bn(t);this.annoLineFormat=e}makeCopy(){const t=new An(this.annoObjHeader.objType);return t.setObjHeader({objectId:this.annoObjHeader.objId}),t.setLineFormat(this.annoLineFormat.annoLineFormat),t}setData(t){}getPoints(){return[]}}class Tn extends An{constructor(t){super(t),this.annoObjScribble=new On}pack(t){super.pack(t),this.annoObjScribble.pack(t)}unpack(t){super.unpack(t),this.annoObjScribble.unpack(t)}setData(t){this.annoObjScribble.setData(t)}getPoints(){return this.annoObjScribble.getData()}}class Sn extends Tn{constructor(){super(Er.kSmoothPen)}}class wn extends Tn{constructor(){super(Er.kHighlighter)}}class xn extends Tn{constructor(){super(Er.kFadePen)}}class In extends An{constructor(){super(Er.kArrowWnd),this.annoObjArrow={struSize:28,dataSize:28,position:{x:0,y:0},size:{width:0,height:0},color:255,alpha:1,title:""}}pack(t){super.pack(t);const e=t.tell();on(t,this.annoObjArrow),t.writeInt32(this.annoObjArrow.position.x),t.writeInt32(this.annoObjArrow.position.y),t.writeInt32(this.annoObjArrow.color),t.writeInt16(this.annoObjArrow.alpha),t.writeInt16(this.annoObjArrow.size.width),t.writeInt16(this.annoObjArrow.size.height),ln(t,e,this.annoObjArrow),t.writeString(this.annoObjArrow.title),cn(t,e,this.annoObjArrow)}unpack(t){super.unpack(t);const e=t.tell();hn(t,this.annoObjArrow),this.annoObjArrow.position.x=t.readInt32(),this.annoObjArrow.position.y=t.readInt32(),this.annoObjArrow.color=t.readInt32(),this.annoObjArrow.alpha=t.readInt16(),this.annoObjArrow.size.width=t.readInt32(),this.annoObjArrow.size.height=t.readInt32(),dn(t,e,this.annoObjArrow),this.annoObjArrow.title=t.readString(),un(t,e,this.annoObjArrow)}}class Cn extends An{constructor(t){super(t),this.annoObjAutoShape={struSize:22,dataSize:22,bounds:{left:0,top:0,right:0,bottom:0}}}pack(t){super.pack(t);const e=t.tell();on(t,this.annoObjAutoShape),t.writeInt32(this.annoObjAutoShape.bounds.left),t.writeInt32(this.annoObjAutoShape.bounds.top),t.writeInt32(this.annoObjAutoShape.bounds.right),t.writeInt32(this.annoObjAutoShape.bounds.bottom),ln(t,e,this.annoObjAutoShape),cn(t,e,this.annoObjAutoShape)}unpack(t){super.unpack(t);const e=t.tell();hn(t,this.annoObjAutoShape),this.annoObjAutoShape.bounds.left=t.readInt32(),this.annoObjAutoShape.bounds.top=t.readInt32(),this.annoObjAutoShape.bounds.right=t.readInt32(),this.annoObjAutoShape.bounds.bottom=t.readInt32(),dn(t,e,this.annoObjAutoShape),un(t,e,this.annoObjAutoShape)}}class kn extends Cn{constructor(){super(Er.kAutoLine)}}class En extends Cn{constructor(){super(Er.kAutoRectangle)}}class Pn extends Cn{constructor(){super(Er.kAutoDiamond)}}class jn extends Cn{constructor(){super(Er.kAutoTriangle)}}class Rn extends Cn{constructor(){super(Er.kAutoEllipse)}}class Ln extends Cn{constructor(t){super(t)}}class Nn extends Cn{constructor(){super(Er.kTextbox)}}class Dn extends Cn{constructor(t){super(t),this.annoObjHitConstraint=rn.ANNO_OBJ_HIT_CONSTRAINT_LEFT_TOP||rn.ANNO_OBJ_HIT_CONSTRAINT_CENTER_TOP||rn.ANNO_OBJ_HIT_CONSTRAINT_RIGHT_TOP||rn.ANNO_OBJ_HIT_CONSTRAINT_RIGHT_CENTER||rn.ANNO_OBJ_HIT_CONSTRAINT_RIGHT_BOTTOM||rn.ANNO_OBJ_HIT_CONSTRAINT_CENTER_BOTTOM||rn.ANNO_OBJ_HIT_CONSTRAINT_LEFT_BOTTOM||rn.ANNO_OBJ_HIT_CONSTRAINT_LEFT_CENTER}}class Fn{constructor(){this.fontDescriptor={struSize:0,dataSize:0,size:0,color:0,alpha:0,weight:0,style:0,baseLineOffset:0,name:"",nameAscii:"",nameOther:"",nameComplexScript:""}}pack(t){const e=t.tell();on(t,this.fontDescriptor),t.writeInt8(this.fontDescriptor.size),t.writeInt32(this.fontDescriptor.color),t.writeFloat32(this.fontDescriptor.alpha),t.writeFloat32(this.fontDescriptor.weight),t.writeInt32(this.fontDescriptor.style),t.writeFloat32(this.fontDescriptor.baseLineOffset),t.writeInt32(this.fontDescriptor.name.length),t.writeInt32(this.fontDescriptor.nameAscii.length),t.writeInt32(this.fontDescriptor.nameOther.length),t.writeInt32(this.fontDescriptor.nameComplexScript.length),ln(t,e,this.fontDescriptor),t.writeStringIn16BitCode(this.fontDescriptor.name),t.writeStringIn16BitCode(this.fontDescriptor.nameAscii),t.writeStringIn16BitCode(this.fontDescriptor.nameOther),t.writeStringIn16BitCode(this.fontDescriptor.nameComplexScript),cn(t,e,this.fontDescriptor)}unpack(t){const e=t.tell();hn(t,this.fontDescriptor),this.fontDescriptor.size=t.readInt8(),this.fontDescriptor.color=t.readInt32(),this.fontDescriptor.alpha=t.readFloat32(),this.fontDescriptor.weight=t.readFloat32(),this.fontDescriptor.style=t.readInt32(),this.fontDescriptor.baseLineOffset=t.readFloat32();const s=t.readInt32(),i=t.readInt32(),r=t.readInt32(),n=t.readInt32();dn(t,e,this.fontDescriptor),this.fontDescriptor.name=t.readStringFrom16CharCode(s),this.fontDescriptor.nameAscii=t.readStringFrom16CharCode(i),this.fontDescriptor.nameOther=t.readStringFrom16CharCode(r),this.fontDescriptor.nameComplexScript=t.readStringFrom16CharCode(n),un(t,e,this.fontDescriptor)}}class Mn{constructor(){this.bulletFormat={struSize:0,dataSize:0,character:0,type:Jr.NONE,style:Kr.ALPHA_LC_PERIOD,number:0,relativeSize:0,startValue:0},this.annoFontDescriptor=new Fn}pack(t){const e=t.tell();on(t,this.bulletFormat),t.writeInt32(this.bulletFormat.character),t.writeInt32(this.bulletFormat.type),t.writeInt32(this.bulletFormat.style),t.writeInt32(this.bulletFormat.number),t.writeFloat32(this.bulletFormat.relativeSize),t.writeInt32(this.bulletFormat.startValue),ln(t,e,this.bulletFormat),this.annoFontDescriptor.pack(t),cn(t,e,this.bulletFormat)}unpack(t){const e=t.tell();hn(t,this.bulletFormat),this.bulletFormat.character=t.readInt32(),this.bulletFormat.type=t.readInt32(),this.bulletFormat.style=t.readInt32(),this.bulletFormat.number=t.readInt32(),this.bulletFormat.relativeSize=t.readFloat32(),this.bulletFormat.startValue=t.readInt32(),dn(t,e,this.bulletFormat),this.annoFontDescriptor.unpack(t),un(t,e,this.bulletFormat)}}class Bn{constructor(){this.paragraphFormat={struSize:0,dataSize:0,alignment:Vr.CENTER,baseLineAlignment:Gr.BASELINE,textDirection:qr.LEFT_TO_RIGHT,spaceBefore:0,spaceAfter:0,spaceBetween:0,wordWrap:0,hasBullet:!1},this.annoBulletFormat=new Mn}pack(t){var e;const s=t.tell();on(t,this.paragraphFormat),t.writeInt32(this.paragraphFormat.alignment),t.writeInt32(this.paragraphFormat.baseLineAlignment),t.writeInt32(this.paragraphFormat.textDirection),t.writeFloat32(this.paragraphFormat.spaceBefore),t.writeFloat32(this.paragraphFormat.spaceAfter),t.writeFloat32(this.paragraphFormat.spaceBetween),t.writeInt32(this.paragraphFormat.wordWrap),t.writeInt8(this.paragraphFormat.hasBullet?1:0),ln(t,s,this.paragraphFormat),this.paragraphFormat.hasBullet&&(null===(e=this.annoBulletFormat)||void 0===e||e.pack(t)),cn(t,s,this.paragraphFormat)}unpack(t){const e=t.tell();hn(t,this.paragraphFormat),this.paragraphFormat.alignment=t.readInt32(),this.paragraphFormat.baseLineAlignment=t.readInt32(),this.paragraphFormat.textDirection=t.readInt32(),this.paragraphFormat.spaceBefore=t.readFloat32(),this.paragraphFormat.spaceAfter=t.readFloat32(),this.paragraphFormat.spaceBetween=t.readFloat32(),this.paragraphFormat.wordWrap=t.readInt32(),this.paragraphFormat.hasBullet=1===t.readInt8(),dn(t,e,this.paragraphFormat),this.paragraphFormat.hasBullet&&this.annoBulletFormat.unpack(t),un(t,e,this.paragraphFormat)}}class Yn{constructor(){this.textRange={struSize:0,dataSize:0,bounds:{left:0,top:0,right:0,bottom:0},languageId:0,indentLevel:0,startPosition:0,textLength:0,text:""},this.annoParagraphFormat=new Bn,this.annoFontDescriptor=new Fn}pack(t){const e=t.tell();on(t,this.textRange),t.writeInt32(this.textRange.bounds.left),t.writeInt32(this.textRange.bounds.top),t.writeInt32(this.textRange.bounds.right),t.writeInt32(this.textRange.bounds.bottom),t.writeInt16(this.textRange.languageId),t.writeInt8(this.textRange.indentLevel),t.writeInt32(this.textRange.startPosition),t.writeInt32(this.textRange.textLength),ln(t,e,this.textRange),this.textRange.textLength>0&&this.textRange.text&&t.writeStringIn16BitCode(this.textRange.text),this.annoParagraphFormat.pack(t),this.annoFontDescriptor.pack(t),cn(t,e,this.textRange)}unpack(t){const e=t.tell();hn(t,this.textRange),this.textRange.bounds.left=t.readInt32(),this.textRange.bounds.top=t.readInt32(),this.textRange.bounds.right=t.readInt32(),this.textRange.bounds.bottom=t.readInt32(),this.textRange.languageId=t.readInt16(),this.textRange.indentLevel=t.readInt8(),this.textRange.startPosition=t.readInt32(),this.textRange.textLength=t.readInt32(),dn(t,e,this.textRange),this.textRange.textLength&&(this.textRange.text=t.readStringFrom16CharCode(this.textRange.textLength)),this.annoParagraphFormat.unpack(t),this.annoFontDescriptor.unpack(t),un(t,e,this.textRange)}}class Hn{constructor(){this.tabStop={struSize:0,dataSize:0,tabStopType:Zr.ANNO_TAB_STOP_TYPE_LEFT,position:0}}pack(t){const e=t.tell();on(t,this.tabStop),t.writeInt32(this.tabStop.tabStopType),t.writeFloat32(this.tabStop.position),ln(t,e,this.tabStop),cn(t,e,this.tabStop)}unpack(t){const e=t.tell();hn(t,this.tabStop),this.tabStop.tabStopType=t.readInt32(),this.tabStop.position=t.readFloat32(),dn(t,e,this.tabStop),un(t,e,this.tabStop)}}class zn{constructor(){this.rulerLevel={struSize:0,dataSize:0,firstMargin:0,leftMargin:0}}pack(t){const e=t.tell();on(t,this.rulerLevel),t.writeFloat32(this.rulerLevel.firstMargin),t.writeFloat32(this.rulerLevel.leftMargin),ln(t,e,this.rulerLevel),cn(t,e,this.rulerLevel)}unpack(t){const e=t.tell();hn(t,this.rulerLevel),this.rulerLevel.firstMargin=t.readFloat32(),this.rulerLevel.leftMargin=t.readFloat32(),dn(t,e,this.rulerLevel),un(t,e,this.rulerLevel)}}class Wn{constructor(){this.ruler={struSize:0,dataSize:0,numberOfRulerLevels:0,numberOfTabStops:0},this.annoRulerLevels=[],this.annoTabStops=[]}pack(t){const e=t.tell();on(t,this.ruler),t.writeInt32(this.ruler.numberOfRulerLevels),t.writeInt32(this.ruler.numberOfTabStops),ln(t,e,this.ruler);for(let e=0;e<this.annoRulerLevels.length;e++)this.annoRulerLevels[e].pack(t);for(let e=0;e<this.annoTabStops.length;e++)this.annoTabStops[e].pack(t);cn(t,e,this.ruler)}unpack(t){const e=t.tell();hn(t,this.ruler),this.ruler.numberOfRulerLevels=t.readInt32(),this.ruler.numberOfTabStops=t.readInt32(),dn(t,e,this.ruler);for(let e=0;e<this.ruler.numberOfRulerLevels;e++){const e=new zn;e.unpack(t),this.annoRulerLevels.push(e)}for(let e=0;e<this.ruler.numberOfTabStops;e++){const e=new Hn;e.unpack(t),this.annoTabStops.push(e)}un(t,e,this.ruler)}}class Xn extends mn{constructor(){super(),this.textFrame={struSize:0,dataSize:0,hasText:!1,wordWrap:!1,horizontalAnchor:!1,verticalAnchor:!1,marginLeft:0,marginTop:0,marginRight:0,marginBottom:0,orientation:Wr.HORIZONTAL,verticalAlignment:Xr.TOP,bounds:{left:0,top:0,right:0,bottom:0},numberOfTextRange:0},this.annoTextRanges=[],this.annoRuler=new Wn}pack(t){const e=t.tell();on(t,this.textFrame),t.writeInt8(this.textFrame.hasText?1:0),t.writeInt8(this.textFrame.wordWrap?1:0),t.writeInt8(this.textFrame.horizontalAnchor?1:0),t.writeInt8(this.textFrame.verticalAnchor?1:0),t.writeFloat32(this.textFrame.marginLeft),t.writeFloat32(this.textFrame.marginTop),t.writeFloat32(this.textFrame.marginRight),t.writeFloat32(this.textFrame.marginBottom),t.writeInt32(this.textFrame.orientation),t.writeInt32(this.textFrame.verticalAlignment),t.writeInt32(this.textFrame.bounds.left),t.writeInt32(this.textFrame.bounds.top),t.writeInt32(this.textFrame.bounds.right),t.writeInt32(this.textFrame.bounds.bottom),t.writeInt32(this.textFrame.numberOfTextRange),ln(t,e,this.textFrame);for(let e=0;e<this.annoTextRanges.length;e++)this.annoTextRanges[e].pack(t);this.annoRuler.pack(t),cn(t,e,this.textFrame)}unpack(t){const e=t.tell();hn(t,this.textFrame),this.textFrame.hasText=1===t.readInt8(),this.textFrame.wordWrap=1===t.readInt8(),this.textFrame.horizontalAnchor=1===t.readInt8(),this.textFrame.verticalAnchor=1===t.readInt8(),this.textFrame.marginLeft=t.readFloat32(),this.textFrame.marginTop=t.readFloat32(),this.textFrame.marginRight=t.readFloat32(),this.textFrame.marginBottom=t.readFloat32(),this.textFrame.orientation=t.readInt32(),this.textFrame.verticalAlignment=t.readInt32(),this.textFrame.bounds.left=t.readInt32(),this.textFrame.bounds.top=t.readInt32(),this.textFrame.bounds.right=t.readInt32(),this.textFrame.bounds.bottom=t.readInt32(),this.textFrame.numberOfTextRange=t.readInt32(),dn(t,e,this.textFrame);for(let e=0;e<this.textFrame.numberOfTextRange;e++){const e=new Yn;e.unpack(t),this.annoTextRanges.push(e)}this.annoRuler.unpack(t),un(t,e,this.textFrame)}}class Un extends wr{constructor(t){super(t.appId),this.appId=t.appId,this.isPresenter=t.isPresenter,this.userName=t.userName,this.preseterId=t.preseterId,this.page=new Vn(t)}handlePageSync(t,e){this.setId(t),this.page.setPageId(e)}getPageId(){return this.page.getPageId()}}class Vn extends xr{constructor(t){super(t.appId),this._isErased=!1,this.pageName="",this.appId=t.appId||0,this.currentPageId=this.acquirePageId(t.appId)}setPageId(t){this.currentPageId=t}getPageId(){return this.currentPageId}isErased(){return this._isErased}setErased(t){this._isErased=t}getPageName(){return this.pageName}setPageName(t){this.pageName=t}packPage(t){t.writeInt32(this.currentPageId),t.writeInt8(this._isErased?1:0),t.writeString(this.pageName)}}function Gn(t,e){var s;const i=null===(s=t.annoLineFormat)||void 0===s?void 0:s.annoLineFormat.annoLineData.colorLine,r={width:i.width,color:i.color,alpha:i.alpha},n={x:t.annoObjAutoShape.bounds.left,y:t.annoObjAutoShape.bounds.top},a={x:t.annoObjAutoShape.bounds.right,y:t.annoObjAutoShape.bounds.bottom};return{type:$r.Line,lineFormat:{type:e,lineData:r,start:n,end:a}}}class qn extends Cr{constructor(t,e,s){super(kr),this.annoPduHeader={struSize:22,dataSize:22,pduType:Pr.kNull,pduId:kr,appId:kr,pduTimeStamp:Date.now()},this.annoPduHeader.pduType=t,s?this.data=s:(this.annoPduHeader.pduId=this.acquirePduId(),this.annoPduHeader.pduTimeStamp=Date.now(),this.data=new an(null))}pack(){this.data.writeInt16(this.annoPduHeader.struSize),this.data.writeInt32(this.annoPduHeader.dataSize),this.data.writeInt32(this.annoPduHeader.pduType),this.data.writeInt32(this.annoPduHeader.pduId),this.data.writeInt32(this.annoPduHeader.appId),this.data.writeInt32(this.annoPduHeader.pduTimeStamp)}unpack(){const t=this.data.tell();this.annoPduHeader.struSize=this.data.readInt16(),this.annoPduHeader.dataSize=this.data.readInt32(),this.annoPduHeader.pduType=this.data.readInt32(),this.annoPduHeader.pduId=this.data.readInt32(),this.annoPduHeader.appId=this.data.readInt32(),this.annoPduHeader.pduTimeStamp=this.data.readInt32(),dn(this.data,t,this.annoPduHeader.struSize),un(this.data,t,this.annoPduHeader.dataSize)}getPduType(){return this.annoPduHeader.pduType||Pr.kNull}toInt8Array(){return this.data.toInt8Array()}}class Jn extends qn{constructor(t,e,s){super(t,e,s),this.annoPduDocRequestDraw={struSize:14,dataSize:14,requesterId:kr,docId:kr,requesterEngineVersion:510,requesterName:""},e&&(this.annoPduHeader.appId=e.appId,this.annoPduDocRequestDraw.requesterId=e.appId,this.annoPduDocRequestDraw.docId=e.docId,this.annoPduDocRequestDraw.requesterName=e.userName,this.pack()),s&&(this.data=s,this.unpack())}pack(){super.pack();const t=this.data.tell();this.data.writeInt16(this.annoPduDocRequestDraw.struSize),this.data.writeInt32(this.annoPduDocRequestDraw.dataSize),this.data.writeInt32(this.annoPduDocRequestDraw.docId),this.data.writeInt32(this.annoPduDocRequestDraw.requesterEngineVersion),ln(this.data,t,this.annoPduDocRequestDraw),this.data.writeString(this.annoPduDocRequestDraw.requesterName),cn(this.data,t,this.annoPduDocRequestDraw)}unpack(){super.unpack();const t=this.data.tell();this.annoPduDocRequestDraw.struSize=this.data.readInt16(),this.annoPduDocRequestDraw.dataSize=this.data.readInt32(),this.annoPduDocRequestDraw.docId=this.data.readInt32(),this.annoPduDocRequestDraw.requesterEngineVersion=this.data.readInt32(),dn(this.data,t,this.annoPduDocRequestDraw),this.annoPduDocRequestDraw.requesterName=this.data.readString(),un(this.data,t,this.annoPduDocRequestDraw),this.annoPduDocRequestDraw.requesterId=this.annoPduHeader.appId}}class Kn extends qn{constructor(t,e,s){super(t,e,s),this.annoPduDocRequestDrawAck={struSize:26,dataSize:26,requesterId:kr,composerId:kr,docId:kr,composerEngineVersion:kr,composerAckCode:Rr.UNKNOWN,docDpiScale:1,composerName:""},e?(this.annoPduHeader.appId=e.appId,this.annoPduDocRequestDrawAck.requesterId=e.ackRequesterId||0,this.annoPduDocRequestDrawAck.composerId=e.appId,this.annoPduDocRequestDrawAck.docId=e.docId,this.annoPduDocRequestDrawAck.composerEngineVersion=510,this.annoPduDocRequestDrawAck.composerAckCode=e.docRequestDrawAckCode||0,this.annoPduDocRequestDrawAck.docDpiScale=1,this.annoPduDocRequestDrawAck.composerName=e.userName,this.pack()):s&&(this.data=s,this.unpack())}pack(){super.pack();const t=this.data.tell();this.data.writeInt16(this.annoPduDocRequestDrawAck.struSize),this.data.writeInt32(this.annoPduDocRequestDrawAck.dataSize),this.data.writeInt32(this.annoPduDocRequestDrawAck.requesterId),this.data.writeInt32(this.annoPduDocRequestDrawAck.docId),this.data.writeInt32(this.annoPduDocRequestDrawAck.composerEngineVersion),this.data.writeInt32(this.annoPduDocRequestDrawAck.composerAckCode),this.data.writeFloat32(this.annoPduDocRequestDrawAck.docDpiScale),this.data.writeString(this.annoPduDocRequestDrawAck.composerName),cn(this.data,t,this.annoPduDocRequestDrawAck)}unpack(){super.unpack();const t=this.data.tell();this.annoPduDocRequestDrawAck.struSize=this.data.readInt16(),this.annoPduDocRequestDrawAck.dataSize=this.data.readInt32(),this.annoPduDocRequestDrawAck.requesterId=this.data.readInt32(),this.annoPduDocRequestDrawAck.docId=this.data.readInt32(),this.annoPduDocRequestDrawAck.composerEngineVersion=this.data.readInt32(),this.annoPduDocRequestDrawAck.composerAckCode=this.data.readInt32(),this.annoPduDocRequestDrawAck.docDpiScale=this.data.readFloat32(),dn(this.data,t,this.annoPduDocRequestDrawAck),this.annoPduDocRequestDrawAck.composerName=this.data.readString(),un(this.data,t,this.annoPduDocRequestDrawAck)}toInt8Array(){return this.data.toInt8Array()}}class Zn extends qn{constructor(t,e,s){var i;super(t,e,s),this.annoPduPage={struSize:14,dataSize:14,docId:kr,pageId:kr},e?(this.annoPduHeader.appId=e.appId,this.annoPduPage.docId=e.appId,this.annoPduPage.pageId=e.pageId,(null===(i=e.annoPages)||void 0===i?void 0:i.length)&&(this.annoPages=e.annoPages),this.pack()):s&&(this.data=s,this.unpack())}pack(){super.pack();const t=this.data.tell();this.data.writeInt16(this.annoPduPage.struSize),this.data.writeInt32(this.annoPduPage.dataSize),this.data.writeInt32(this.annoPduPage.docId),this.data.writeInt32(this.annoPduPage.pageId),ln(this.data,t,this.annoPduPage),this.data.writeInt32(this.annoPages.length),this.annoPages.forEach((t=>{t.packPage(this.data)})),cn(this.data,t,this.annoPduPage)}unpack(){super.unpack();const t=this.data.tell();this.annoPduPage.struSize=this.data.readInt16(),this.annoPduPage.dataSize=this.data.readInt32(),this.annoPduPage.docId=this.data.readInt32(),this.annoPduPage.pageId=this.data.readInt32(),dn(this.data,t,this.annoPduPage);const e=this.data.readInt32();if(e>0){this.annoPages=[];for(let t=0;t<e;t++){const t=new Vn({});t.setPageId(this.data.readInt32()),t.setErased(!!this.data.readInt8()),t.setPageName(this.data.readString()),this.annoPages.push(t)}}un(this.data,t,this.annoPduPage)}}class Qn extends qn{constructor(t,e,s){super(t,e,s),this.annoPduObj={struSize:14,dataSize:14,docId:kr,pageId:kr},e&&(this.annoPduHeader.appId=e.appId,this.annoPduObj.docId=e.docId,this.annoPduObj.pageId=e.pageId,e.annoObj&&(this.annoPduObj.annoObj=e.annoObj),e.annoObjIds&&(this.annoPduObj.annoObjIds=e.annoObjIds))}getHeader(){return this.annoPduHeader}}class $n extends Qn{constructor(t,e,s){super(t,e,s),e?this.pack():s&&this.unpack()}pack(){super.pack();const t=this.data.tell();this.data.writeInt16(this.annoPduObj.struSize),this.data.writeInt32(this.annoPduObj.dataSize),this.data.writeInt32(this.annoPduObj.docId),this.data.writeInt32(this.annoPduObj.pageId),this.annoPduObj.annoObj&&this.annoPduObj.annoObj.pack(this.data),cn(this.data,t,this.annoPduObj)}unpack(){var t;super.unpack();const e=this.data.tell();this.annoPduObj.struSize=this.data.readInt16(),this.annoPduObj.dataSize=this.data.readInt32(),this.annoPduObj.docId=this.data.readInt32(),this.annoPduObj.pageId=this.data.readInt32(),dn(this.data,e,this.annoPduObj);const s=(i=this.data).readInt32At(i.currentPos+6);var i;this.annoPduObj.annoObj=function(t){switch(t){case Er.kSmoothPen:return new Sn;case Er.kHighlighter:return new wn;case Er.kFadePen:return new xn;case Er.kTextbox:return new Nn;case Er.kAutoLine:return new kn;case Er.kAutoArrow1:case Er.kAutoArrow2:case Er.kAutoDoubleArrow:return new Ln(t);case Er.kAutoRectangle:return new En;case Er.kAutoEllipse:return new Rn;case Er.kAutoDiamond:return new Pn;case Er.kAutoTriangle:return new jn;case Er.kAutoStampArrow:case Er.kAutoStampCheck:case Er.kAutoStampX:case Er.kAutoStampStar:case Er.kAutoStampHeart:case Er.kAutoStampQm:return new Dn(t);default:return}}(s),null===(t=this.annoPduObj.annoObj)||void 0===t||t.unpack(this.data),un(this.data,e,this.annoPduObj)}}class ta extends Qn{constructor(t,e,s){super(t,e,s),e?(this.timeStampOfRequest=e.timeStampOfAckRequest,this.captureFrameRate=e.captureFrameRate||10,this.pack()):s&&this.unpack()}pack(){super.pack(),this.annoPduObj.struSize+=5,this.annoPduObj.dataSize=this.annoPduObj.struSize;const t=this.data.tell();this.data.writeInt16(this.annoPduObj.struSize),this.data.writeInt32(this.annoPduObj.dataSize),this.data.writeInt32(this.annoPduObj.docId),this.data.writeInt32(this.annoPduObj.pageId),this.data.writeInt32(this.timeStampOfRequest),this.data.writeInt8(this.captureFrameRate),this.annoPduObj.annoObj?this.annoPduObj.annoObj.packIds(this.data):this.data.writeInt32(0),cn(this.data,t,this.annoPduObj)}unpack(){super.unpack();const t=this.data.tell();this.annoPduObj.struSize=this.data.readInt16(),this.annoPduObj.dataSize=this.data.readInt32(),this.annoPduObj.docId=this.data.readInt32(),this.annoPduObj.pageId=this.data.readInt32(),this.timeStampOfRequest=this.data.readInt32(),this.captureFrameRate=this.data.readInt8(),dn(this.data,t,this.annoPduObj);const e=this.data.readInt32();if(e>0){this.annoPduObj.annoObjIds=this.annoPduObj.annoObjIds||[];for(let t=0;t<e;t++)this.annoPduObj.annoObjIds.push(this.data.readInt32())}un(this.data,t,this.annoPduObj)}}class ea extends Qn{constructor(t,e,s){super(t,e,s),e?this.pack():s&&this.unpack()}pack(){super.pack();const t=this.data.tell();this.data.writeInt16(this.annoPduObj.struSize),this.data.writeInt32(this.annoPduObj.dataSize),this.data.writeInt32(this.annoPduObj.docId),this.data.writeInt32(this.annoPduObj.pageId),this.annoPduObj.annoObj&&this.annoPduObj.annoObj.pack(this.data),cn(this.data,t,this.annoPduObj)}unpack(){var t;super.unpack();const e=this.data.tell();this.annoPduObj.struSize=this.data.readInt16(),this.annoPduObj.dataSize=this.data.readInt32(),this.annoPduObj.docId=this.data.readInt32(),this.annoPduObj.pageId=this.data.readInt32(),dn(this.data,e,this.annoPduObj),this.annoPduObj.annoObj=new In,null===(t=this.annoPduObj.annoObj)||void 0===t||t.unpack(this.data),un(this.data,e,this.annoPduObj)}}class sa extends Qn{constructor(t,e,s){super(t,e,s),e?this.pack():s&&this.unpack()}pack(){super.pack();const t=this.data.tell();if(this.data.writeInt16(this.annoPduObj.struSize),this.data.writeInt32(this.annoPduObj.dataSize),this.data.writeInt32(this.annoPduObj.docId),this.data.writeInt32(this.annoPduObj.pageId),this.annoPduObj.annoObjIds){const t=this.annoPduObj.annoObjIds.length;this.data.writeInt32(t);for(let e=0;e<t;e++)this.data.writeInt32(this.annoPduObj.annoObjIds[e])}else this.data.writeInt32(0);cn(this.data,t,this.annoPduObj)}unpack(){super.unpack();const t=this.data.tell();this.annoPduObj.struSize=this.data.readInt16(),this.annoPduObj.dataSize=this.data.readInt32(),this.annoPduObj.docId=this.data.readInt32(),this.annoPduObj.pageId=this.data.readInt32(),dn(this.data,t,this.annoPduObj);const e=this.data.readInt32();if(e>0){this.annoPduObj.annoObjIds=this.annoPduObj.annoObjIds||[];for(let t=0;t<e;t++)this.annoPduObj.annoObjIds.push(this.data.readInt32())}un(this.data,t,this.annoPduObj)}}class ia extends sa{constructor(t,e,s){super(t,e,s)}pack(){super.pack()}unpack(){super.unpack()}}class ra extends sa{constructor(t,e,s){super(t,e,s)}pack(){super.pack()}unpack(){super.unpack()}}class na extends sa{constructor(t,e,s){super(t,e,s)}pack(){super.pack()}unpack(){super.unpack()}}class aa extends sa{constructor(t,e,s){super(t,e,s)}pack(){super.pack()}unpack(){super.unpack()}}class oa extends Qn{constructor(t,e,s){super(t,e,s),e?this.pack():s&&this.unpack()}pack(){super.pack();const t=this.data.tell();if(this.data.writeInt16(this.annoPduObj.struSize),this.data.writeInt32(this.annoPduObj.dataSize),this.data.writeInt32(this.annoPduObj.docId),this.data.writeInt32(this.annoPduObj.pageId),this.annoPduObj.annoObjIds){const t=this.annoPduObj.annoObjIds.length;this.data.writeInt32(t);for(let e=0;e<t;e++)this.data.writeInt32(this.annoPduObj.annoObjIds[e])}else this.data.writeInt32(0);cn(this.data,t,this.annoPduObj)}unpack(){super.unpack();const t=this.data.tell();this.annoPduObj.struSize=this.data.readInt16(),this.annoPduObj.dataSize=this.data.readInt32(),this.annoPduObj.docId=this.data.readInt32(),this.annoPduObj.pageId=this.data.readInt32(),dn(this.data,t,this.annoPduObj);const e=this.data.readInt32();if(e>0){this.annoPduObj.annoObjIds=this.annoPduObj.annoObjIds||[];for(let t=0;t<e;t++)this.annoPduObj.annoObjIds.push(this.data.readInt32())}un(this.data,t,this.annoPduObj)}}class ha extends oa{constructor(t,e,s){super(t,e,s)}pack(){super.pack()}unpack(){super.unpack()}}class la extends oa{constructor(t,e,s){super(t,e,s)}pack(){super.pack()}unpack(){super.unpack()}}var ca=s(1461),da=s(9109);class ua extends Sr{constructor(t){super(t.appId),this.currentTool=nn(),this.objectMapW2M=new Map,this.objectMapM2W=new Map,this.appId=t.appId,this.userName=t.userName,this.presenterId=t.presenterId,this.isPresenter=t.isPresenter,this.isBOSession=t.isBOSession,this.boardSDKIns=t.boardSDKIns,this.doc=this._createNewDoc()}startAnnote(){}sendMsgToBoard(t){var e;null===(e=this.boardSDKIns)||void 0===e||e.onMessage(t)}destroy(){this.doc=null,this.objectMapW2M.clear(),this.objectMapM2W.clear()}sendAnnoMessage(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.presenterId;const s=new an(null),i=this._getAnnoMessageHeaderOption();s.writeInt8(37),s.writeInt8(i),s.writeInt16(1),s.writeInt32(e);const r={command:"SEND_ANNOTATION_PDU",isPresenter:this.isPresenter,data:new Uint8Array(s.mData.concat(t.mData))};da.A.mediaSDKHandle.sendAnnotationPdu(r,this.isPresenter)}setTool(t){this.currentTool=t}_getAnnoMessageHeaderOption(){let t=0;return t|=this.isPresenter?1:0,t|=this.isBOSession?2:0,t}handleClear(t){const{clearType:e}=t;switch(e){case zr.CLEAR_MINE:this.clearAllMine();break;case zr.CLEAR_ALL:this.clearAll(t);break;case zr.CLEAR_VIEWER:this.clearViewers()}}clearAllMine(){}clearAll(t){}handleUndo(){}handleRedo(){}handleAddLocalObject(t){}handleRemoveLocalObject(t){}onRequestDrawAck(){}handleObjAddAck(t){}clearViewers(){}handleRequestDraw(t){}handlePageSync(t){}handleAddObjRequest(t){}handleRemoveObjRequest(t){}handleRestoreObjRequest(t){}handleRemoveUserObjRequest(t){}handleRestoreUserObjRequest(t){}handleObjRemoveAllByHost(t){}handleObjRestoreAllByHost(t){}handleShowAnnotatorName(t){}handleAnnotatorId2Name(t){}updateUserName(t){this.userName=t}_createNewDoc(){return new Un({appId:this.appId,isPresenter:this.isPresenter,userName:this.userName,preseterId:this.presenterId})}}class pa extends ua{constructor(t){super(t),this.readyToAnnote=!1,this.actionPduQueue=[],this.executedActions=[],this.revokedActions=[],this.sendRequestDrawPdu()}startAnnote(){super.startAnnote(),da.A.Notify_APPUI(ca.x$W,{status:!!this.executedActions.length,presenterId:this.presenterId}),da.A.Notify_APPUI(ca.p4Z,{status:!!this.revokedActions.length,presenterId:this.presenterId})}destroy(){super.destroy(),this.boardSDKIns.onMessage({type:gr.DESTROY_SESSION,sessionId:this.presenterId.toString()}),this.readyToAnnote=!1,this.executedActions=[],this.revokedActions=[],this.actionPduQueue=[]}sendRequestDrawPdu(){let t=pn(this.appId,this.userName,this.doc.getId());const e=new Jn(Pr.kDocRequestDraw,t);this.sendAnnoMessage(e.data)}sendAnnoAction(t){this.readyToAnnote?this.sendAnnoMessage(t.data):this.actionPduQueue.push(t)}onRequestDrawAck(){for(this.readyToAnnote=!0;this.actionPduQueue.length;){const t=this.actionPduQueue.shift();this.sendAnnoAction(t)}}handleObjAddAck(t){const{annoObjIds:e}=t.annoPduObj;(null==e?void 0:e.length)&&e.forEach((t=>{const e=this.objectMapM2W.get(t);setTimeout((()=>{this.boardSDKIns.onMessage({type:gr.ONACK,objectId:e,sessionId:this.presenterId})}),750)}))}handleAddLocalObject(t){const e=this.currentTool.toolType;let s;switch(e){case g.ANNO_TOOL_TYPE_PEN:s=new Sn;break;case g.ANNO_TOOL_TYPE_HIGHLIGHTER:s=new wn;break;case g.ANNO_TOOL_TYPE_FADE_PEN:s=new xn}if(!s)return;const i=s.acquireObjId(this.appId);s.setObjHeader({objId:i});const{objectData:r,presenterId:n=this.presenterId}=t;if(!r)return;r.penFormat&&s.setLineFormat(r.penFormat),r.points&&s.setData(r.points),this.doc||(this.doc=this._createNewDoc(),this.readyToAnnote=!1,this.sendRequestDrawPdu());let a=pn(this.appId,this.userName,this.doc.getId(),this.doc.getPageId());a.annoObj=s;const o=new $n(Pr.kAnnoObjAdd,a);a.annoObjIds=[i],a.whiteboardObjIds=[t.objectId];const h=fn(a,Pr.kAnnoObjAdd);e!==g.ANNO_TOOL_TYPE_FADE_PEN&&this._pushToExecutedAction(h),this.sendAnnoAction(o),this.objectMapW2M.set(t.objectId,i),this.objectMapM2W.set(i,t.objectId)}handleRemoveLocalObject(t){const e=this.objectMapW2M.get(t.objectId);if(e)for(let s=0;s<this.executedActions.length;s++){const i=this.executedActions[s];if(i.pduType!==Pr.kAnnoObjAdd)continue;const r=i.annoObjIds;if(!r.includes(e))continue;let n=pn(this.appId,this.userName,i.docId,i.pageId);n.annoObjIds=r,n.whiteboardObjIds=[t.objectId];const a=new ia(Pr.kAnnoObjRemove,n),o=fn(n,Pr.kAnnoObjRemove);this._pushToExecutedAction(o),this.sendAnnoAction(a);break}}clearAllMine(){let t=pn(this.appId,void 0,this.doc.getId(),this.doc.getPageId());const e=[],s=[];for(let t=0;t<this.executedActions.length;t++){const i=this.executedActions[t];if(i.pduType===Pr.kAnnoObjAdd){if(i.isRemoved)continue;i.annoObjIds.forEach((t=>{e.push(t),s.push(this.objectMapM2W.get(t))})),i.isRemoved=!0}}if(!e.length)return t;t.annoObjIds=e,t.whiteboardObjIds=s,this.boardSDKIns.onMessage({type:gr.ERASE_ALL,objectIds:s,sessionId:this.presenterId});const i=new ha(Pr.kAnnoObjRemoveUser,t),r=fn(t,Pr.kAnnoObjRemoveUser);return this._pushToExecutedAction(r),this.sendAnnoAction(i),t}clearAll(t){const{isHost:e}=t;if(!e)return;let s,i,r=this.clearAllMine();i=Pr.kAnnoObjRemoveAllByHost,s=new na(i,r);const n=fn(r,i);this._pushToExecutedAction(n),this.sendAnnoAction(s)}handleUndo(){const t=this._popExecutedAction();if(!t)return;const e=this._copyPduActionData(t);let s,i;switch(t.pduType){case Pr.kAnnoObjAdd:case Pr.kAnnoObjRestore:s=new ia(Pr.kAnnoObjRemove,e),i=gr.REMOVE_OBJECTS;break;case Pr.kAnnoObjRemove:s=new ra(Pr.kAnnoObjRestore,e),i=gr.RESTORE_OBJECTS;break;case Pr.kAnnoObjRemoveUser:s=new la(Pr.kAnnoObjRestoreUser,e),this._markRemoveStatus(e,!1),i=gr.RESTORE_OBJECTS;break;case Pr.kAnnoObjRemoveAllByHost:s=new aa(Pr.kAnnoObjRestoreAllByHost,e),this._markRemoveStatus(e,!1),i=gr.RESTORE_OBJECTS}this.boardSDKIns.onMessage({type:i,objectIds:e.whiteboardObjIds,sessionId:this.presenterId}),this._pushToRevokedAction(t),this.sendAnnoAction(s)}handleRedo(){const t=this._popRevokedAction();if(!t)return;const e=this._copyPduActionData(t);let s,i;switch(t.pduType){case Pr.kAnnoObjAdd:case Pr.kAnnoObjRestore:s=new ra(Pr.kAnnoObjRestore,e),i=gr.RESTORE_OBJECTS;break;case Pr.kAnnoObjRemove:s=new ia(t.pduType,e),i=gr.REMOVE_OBJECTS;break;case Pr.kAnnoObjRemoveUser:s=new ha(t.pduType,e),i=gr.REMOVE_OBJECTS,this._markRemoveStatus(e,!0);break;case Pr.kAnnoObjRemoveAllByHost:s=new na(t.pduType,e),i=gr.REMOVE_OBJECTS,this._markRemoveStatus(e,!0)}this.boardSDKIns.onMessage({type:i,objectIds:e.whiteboardObjIds,sessionId:this.presenterId}),this._pushToExecutedAction(t),this.sendAnnoAction(s)}_pushToExecutedAction(t){const e=this.executedActions.length;this.executedActions.push(t),0===e&&da.A.Notify_APPUI(ca.x$W,{status:!0,presenterId:this.presenterId})}_pushToRevokedAction(t){const e=this.revokedActions.length;this.revokedActions.push(t),0===e&&da.A.Notify_APPUI(ca.p4Z,{status:!0,presenterId:this.presenterId})}_popExecutedAction(){const t=this.executedActions.length,e=this.executedActions.pop();return t&&!this.executedActions.length&&da.A.Notify_APPUI(ca.x$W,{status:!1,presenterId:this.presenterId}),e}_popRevokedAction(){const t=this.revokedActions.length,e=this.revokedActions.pop();return t&&!this.revokedActions.length&&da.A.Notify_APPUI(ca.p4Z,{status:!1,presenterId:this.presenterId}),e}_copyPduActionData(t){let e=pn();return Object.assign(e,t),e}_markRemoveStatus(t,e){const{annoObjIds:s}=t;if(null==s?void 0:s.length)for(let t=0;t<this.executedActions.length;t++){const i=this.executedActions[t];if(i.pduType===Pr.kAnnoObjAdd){if(!!i.isRemoved===e)continue;i.annoObjIds.forEach((t=>{s.includes(t)&&(i.isRemoved=e)}))}}}}class ga extends ua{constructor(t){super(t),this.executedActions=[],this.revokedActions=[],this.showAnnotatorName=!1,this.annotatorInfo=new Map,this.presenterId=this.appId,this.sessionObjRecord=[]}startAnnote(){super.startAnnote(),da.A.Notify_APPUI(ca.x$W,{status:!!this.executedActions.length,presenterId:this.presenterId}),da.A.Notify_APPUI(ca.p4Z,{status:!!this.revokedActions.length,presenterId:this.presenterId})}destroy(){var t;super.destroy();try{null===(t=this.boardSDKIns)||void 0===t||t.destroy()}catch(t){}this.boardSDKIns=null,this.sessionObjRecord=[],this.executedActions=[],this.revokedActions=[],this.annotatorInfo.clear()}handleAddLocalObject(t){this.currentTool.toolType!==g.ANNO_TOOL_TYPE_FADE_PEN&&this._pushToExecutedAction({type:Qr.ADD_OBJ,objectIds:[t.objectId],isRemoved:!1})}handleRemoveLocalObject(t){for(let e=0;e<this.executedActions.length;e++){const s=this.executedActions[e];if(s.type===Qr.ADD_OBJ&&-1!==s.objectIds.indexOf(t.objectId)){s.isRemoved=!0;break}}this._pushToExecutedAction({type:Qr.REMOVE_OBJ,objectIds:[t.objectId],isRemoved:!0})}clearAllMine(){this._clearAll(!0,!1)}clearAll(){this._clearAll(!0,!0)}clearViewers(){this._clearAll(!1,!0)}_clearAll(t,e){const s=[];t&&this.executedActions.forEach((t=>{t.type===Qr.ADD_OBJ&&(s.push(t.objectIds[0]),t.isRemoved=!0)})),e&&this.sessionObjRecord.forEach((t=>{t.isRemoved||(s.push(t.objId),t.isRemoved=!0)})),this.boardSDKIns.onMessage({type:gr.REMOVE_OBJECTS,objectIds:s,sessionId:this.appId}),this._pushToExecutedAction({objectIds:s,type:Qr.REMOVE_ALL_OBJ,isRemoved:!0})}handleUndo(){const t=this._popExecutedAction();if(!t)return;let e;switch(t.type){case Qr.ADD_OBJ:e=gr.REMOVE_OBJECTS,t.isRemoved=!0;break;case Qr.REMOVE_OBJ:e=gr.RESTORE_OBJECTS,t.isRemoved=!1;break;case Qr.RESTORE_ALL_OBJ:e=gr.REMOVE_OBJECTS,this._markRemoveStatus(t.objectIds,!0);break;case Qr.REMOVE_ALL_OBJ:e=gr.RESTORE_OBJECTS,this._markRemoveStatus(t.objectIds,!1);break;default:return}this.boardSDKIns.onMessage({type:e,objectIds:t.objectIds,sessionId:this.appId}),this._pushToRevokedAction(t)}handleRedo(){const t=this._popRevokedAction();if(!t)return;let e;switch(t.type){case Qr.ADD_OBJ:e=gr.RESTORE_OBJECTS,t.isRemoved=!1;break;case Qr.REMOVE_OBJ:e=gr.REMOVE_OBJECTS,t.isRemoved=!0;break;case Qr.RESTORE_ALL_OBJ:e=gr.RESTORE_OBJECTS,this._markRemoveStatus(t.objectIds,!1);break;case Qr.REMOVE_ALL_OBJ:e=gr.REMOVE_OBJECTS,this._markRemoveStatus(t.objectIds,!0);break;default:return}this.boardSDKIns.onMessage({type:e,objectIds:t.objectIds,sessionId:this.appId}),this._pushToExecutedAction(t)}handleShowAnnotatorName(t){this.showAnnotatorName=t}handleAnnotatorId2Name(t){const{userId:e,userName:s}=t;e&&s&&this.annotatorInfo.set(e,s)}handleRequestDraw(t){let e=pn(this.appId,this.userName,this.doc.getId(),this.doc.getPageId());const s=t.annoPduDocRequestDraw.requesterId;da.A.Notify_APPUI(ca.rV1,{userId:s}),e.ackRequesterId=s,e.docRequestDrawAckCode=Rr.ACCPETED;const i=new Kn(Pr.kDocRequestDrawAck,e);this.sendAnnoMessage(i.data,s),e.annoPages=[this.doc.page];const r=new Zn(Pr.kPageSync,e);this.sendAnnoMessage(r.data,s)}handlePageSync(t){const{docId:e,pageId:s}=t.annoPduPage;this.doc.handlePageSync(e,s)}handleAddObjRequest(t){const e=t.annoPduObj.annoObj,s=t.annoPduHeader.appId,{objId:i}=e.annoObjHeader;let r=function(t){const{objType:e}=t.annoObjHeader;switch(e){case Er.kSmoothPen:case Er.kHighlighter:case Er.kFadePen:return function(t){const e=t.getPoints();let s;const{objType:i,objFlag:r}=t.annoObjHeader;switch(i){case Er.kSmoothPen:s=tn.Smooth;break;case Er.kHighlighter:s=tn.Highlighter;break;case Er.kFadePen:s=tn.Fade}let n;if(r&Mr.ANNO_OBJ_FLAG_WITH_LINE){const e=t.annoLineFormat.annoLineFormat;n={width:e.annoLineData.colorLine.width,color:e.annoLineData.colorLine.color,alpha:e.annoLineData.colorLine.alpha}}const a={type:s,lineData:n};return{type:$r.Pen,points:e,penFormat:a}}(t);case Er.kAutoLine:return Gn(t,wi.Simple);case Er.kAutoArrow1:return Gn(t,wi.ArrowLeft);case Er.kAutoDoubleArrow:return Gn(t,wi.ArrowLeftRight);case Er.kAutoRectangle:case Er.kAutoEllipse:case Er.kAutoDiamond:return function(t){const e=_n(t.annoObjAutoShape.bounds);let s,i,r,n;switch(t.annoObjHeader.objType){case Er.kAutoRectangle:s=en.Rectangle;break;case Er.kAutoEllipse:s=en.Ellipse;break;case Er.kAutoDiamond:s=en.Diamond}if(t.annoFillFormat)i=1===t.annoFillFormat.annoFillFormat.colorFill.alpha?Ii.Filled:Ii.Shaded,r=t.annoFillFormat.annoFillFormat.colorFill.color,r=gn(r);else if(i=Ii.Border,t.annoLineFormat){const e=t.annoLineFormat.annoLineFormat.annoLineData;r=e.colorLine.color,n={width:e.colorLine.width,color:r,alpha:e.colorLine.alpha}}return Object.assign({type:$r.Shape,shapeFormat:{type:s,style:i,lineData:n,color:r}},e)}(t);case Er.kAutoStampArrow:case Er.kAutoStampCheck:case Er.kAutoStampX:case Er.kAutoStampStar:case Er.kAutoStampHeart:case Er.kAutoStampQm:return function(t){const e=_n(t.annoObjAutoShape.bounds);let s;switch(t.annoObjHeader.objType){case Er.kAutoStampArrow:s="Arrow";break;case Er.kAutoStampCheck:s="Check";break;case Er.kAutoStampX:s="Cross";break;case Er.kAutoStampStar:s="Star";break;case Er.kAutoStampHeart:s="Heart";break;case Er.kAutoStampQm:s="Question"}return Object.assign({type:$r.Stamp,stampFormat:{type:s}},e)}(t);case Er.kTextbox:return function(t){const e=t.annoTextFrame.textFrame,s=t.annoTextFrame.annoTextRanges[0],i=_n(e.bounds),r=s.textRange.text,n=gn(s.annoFontDescriptor.fontDescriptor.color),a=s.annoFontDescriptor.fontDescriptor.size,o=s.annoFontDescriptor.fontDescriptor.name;return Object.assign({type:$r.Text,textFormat:{text:r,color:n,fontSize:a,fontFamily:o}},i)}(t);default:return null}}(e);const n=this.showAnnotatorName?this.annotatorInfo.get(s):"";r&&this.boardSDKIns.onMessage({type:gr.ADD_OBJECT,data:{objectId:i,objectData:r},annotatorName:n});let a=pn(this.appId,this.userName,this.doc.getId(),this.doc.getPageId());a.timeStampOfAckRequest=t.annoPduHeader.pduTimeStamp,a.annoObj=e;const o=new ta(Pr.kAnnoObjAddAck,a);this.sessionObjRecord.push({userId:s,objId:i,isRemoved:!1}),this.sendAnnoMessage(o.data,s)}handleRemoveObjRequest(t){const e=t.annoPduObj.annoObjIds;e.forEach((t=>{for(let e=0;e<this.sessionObjRecord.length;)t===this.sessionObjRecord[e].objId?this.sessionObjRecord.splice(e,1):e++})),this.boardSDKIns.onMessage({type:gr.REMOVE_OBJECTS,objectIds:e,sessionId:this.appId})}handleRestoreObjRequest(t){const e=t.annoPduObj.annoObjIds,s=t.annoPduHeader.appId;this._handleRestoreObj(e,s)}_handleRestoreObj(t,e){t.forEach((t=>{this.sessionObjRecord.push({userId:e,objId:t,isRemoved:!1})})),this.boardSDKIns.onMessage({type:gr.RESTORE_OBJECTS,objectIds:t,sessionId:this.appId})}handleRemoveUserObjRequest(t){const e=t.annoPduObj.annoObjIds,s=t.annoPduHeader.appId;e.forEach((t=>{for(let e=0;e<this.sessionObjRecord.length;){const i=this.sessionObjRecord[e];t===i.objId&&s===i.userId?this.sessionObjRecord.splice(e,1):e++}})),this.boardSDKIns.onMessage({type:gr.REMOVE_OBJECTS,objectIds:e,sessionId:this.appId})}handleRestoreUserObjRequest(t){const e=t.annoPduObj.annoObjIds,s=t.annoPduHeader.appId;this._handleRestoreObj(e,s)}handleObjRemoveAllByHost(t){this._clearAll(!0,!0)}handleObjRestoreAllByHost(t){const e=[];this.sessionObjRecord.forEach((t=>{t.isRemoved&&(e.push(t.objId),t.isRemoved=!1)})),this.boardSDKIns.onMessage({type:gr.RESTORE_OBJECTS,objectIds:e,sessionId:this.appId})}_pushToExecutedAction(t){const e=this.executedActions.length;this.executedActions.push(t),0===e&&da.A.Notify_APPUI(ca.x$W,{status:!0,presenterId:this.presenterId})}_pushToRevokedAction(t){const e=this.revokedActions.length;this.revokedActions.push(t),0===e&&da.A.Notify_APPUI(ca.p4Z,{status:!0,presenterId:this.presenterId})}_popExecutedAction(){const t=this.executedActions.length,e=this.executedActions.pop();return t&&!this.executedActions.length&&da.A.Notify_APPUI(ca.x$W,{status:!1,presenterId:this.presenterId}),e}_popRevokedAction(){const t=this.revokedActions.length,e=this.revokedActions.pop();return t&&!this.revokedActions.length&&da.A.Notify_APPUI(ca.p4Z,{status:!1,presenterId:this.presenterId}),e}_markRemoveStatus(t,e){(null==t?void 0:t.length)&&(this.executedActions.forEach((s=>{s.type===Qr.ADD_OBJ&&-1!==t.indexOf(s.objectIds[0])&&(s.isRemoved=e)})),this.sessionObjRecord.forEach((s=>{-1!==t.indexOf(s.objId)&&(s.isRemoved=e)})))}}const fa=new Map;class _a extends Sr{constructor(t){super(t.appId),this.currentTool=nn(),this.appId=t.appId,this.userName=t.userName,this.presenterId=t.presenterId,this.sharingMainCanvas=t.sharingMainCanvas,this.annoCanvas=t.annoCanvas,this.remoteSizeInfo=t.remoteSizeInfo,this.shareCanvasOserver=new MutationObserver(this.updateAnnoCanvasSize.bind(this)),this.canvasSizeInfo={width:0,height:0},this.annoSession=this._createSession(this.presenterId,t.isBOSession)}destroy(){var t,e;null===(t=this.boardSDKIns)||void 0===t||t.destroy(),null===(e=this.boardSDKPresentorIns)||void 0===e||e.destroy(),fa.forEach((t=>{t.destroy()})),this.shareCanvasOserver.disconnect()}startAnnotation(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.presenterId,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.presenterId=t;const s=t===this.appId;let i=fa.get(t);i||(i=this._createSession(t),i.isBOSession=e),this.annoSession=i,i.startAnnote();const r=s?this.boardSDKPresentorIns:this.boardSDKIns;this.shareCanvasOserver.disconnect(),this.shareCanvasOserver.observe(this.sharingMainCanvas,{attributes:!0}),r.onMessage({type:gr.CHANGE_SESSION,sessionId:this.presenterId.toString()}),r.onMessage(Object.assign({type:gr.TOOL_SELECT},this.currentTool))}stopAnnotation(t){const{presenterId:e}=t;if(!e)return;this.currentTool=nn();const s=e,i=fa.get(s);this.annoSession===i&&(this.annoSession=null),null==i||i.destroy(),e===this.appId&&(this.boardSDKPresentorIns=null),fa.delete(s)}updateCanvas(t){var e;this.sharingMainCanvas=t.sharingMainCanvas,this.annoCanvas=t.annoCanvas;const s=this._checkRemoteSizeInfo();null===(e=this.annoSession)||void 0===e||e.sendMsgToBoard(Object.assign({type:gr.UPDATE_CANVAS,annoCanvas:this.annoCanvas,styles:this._getAnnoCavansStyle()},s))}updateRemoteSizeInfo(t){this.updateAnnoCanvasSize({absWidth:t.width,absHeight:t.height})}updateAnnoCanvasSize(t){var e;(null===(e=this.annoSession)||void 0===e?void 0:e.isPresenter)&&(null==t?void 0:t.width)&&(null==t?void 0:t.height)&&(this.canvasSizeInfo.width=parseInt(t.width)/window.devicePixelRatio,this.canvasSizeInfo.height=parseInt(t.height)/window.devicePixelRatio),t.absWidth&&t.absHeight&&(this.remoteSizeInfo.width=t.absWidth,this.remoteSizeInfo.height=t.absHeight);const s=this._checkRemoteSizeInfo();s.width&&s.height&&this.annoSession&&(this.annoSession.isPresenter&&(this.sharingMainCanvas.width===s.absWidth&&this.sharingMainCanvas.height===s.absHeight||(this.sharingMainCanvas.width=s.absWidth,this.sharingMainCanvas.height=s.absHeight)),setTimeout((()=>{var t;null===(t=this.annoSession)||void 0===t||t.sendMsgToBoard(Object.assign({type:gr.RESIZE},s))}),300))}getAppId(){return this.appId}onRWGMessage(t){if(37!==t[0])return;const e=function(t){const e=new an(t.subarray(8)),s=function(t){t.seek(6);const e=t.readInt32();return t.seek(0),e}(e);switch(s){case Pr.kDocRequestDraw:return new Jn(s,void 0,e);case Pr.kDocRequestDrawAck:return new Kn(s,void 0,e);case Pr.kPageSync:return new Zn(s,void 0,e);case Pr.kAnnoObjAdd:return new $n(s,void 0,e);case Pr.kAnnoArrowAdd:return new ea(s,void 0,e);case Pr.kAnnoObjAddAck:return new ta(s,void 0,e);case Pr.kAnnoObjRemove:return new ia(s,void 0,e);case Pr.kAnnoObjRestore:return new ra(s,void 0,e);case Pr.kAnnoObjRemoveUser:return new ha(s,void 0,e);case Pr.kAnnoObjRestoreUser:return new la(s,void 0,e);case Pr.kAnnoObjRemoveAllByHost:return new na(s,void 0,e);case Pr.kAnnoObjRestoreAllByHost:return new aa(s,void 0,e)}return null}(t);if(e)switch(e.getPduType()){case Pr.kDocRequestDraw:this.handleRequestDraw(e);break;case Pr.kDocRequestDrawAck:this.handleRequestDrawAck(e);break;case Pr.kPageSync:this.handlePageSync(e);break;case Pr.kAnnoObjAdd:case Pr.kAnnoArrowAdd:this.handleAddObjRequest(e);break;case Pr.kAnnoObjRemove:this.handleRemoveObjRequest(e);break;case Pr.kAnnoObjRestore:this.handleRestoreObjRequest(e);break;case Pr.kAnnoObjRemoveUser:this.handleRemoveUserObjRequest(e);break;case Pr.kAnnoObjRestoreUser:this.handleRestoreUserObjRequest(e);break;case Pr.kAnnoObjAddAck:this.handleObjAddAck(e);break;case Pr.kAnnoObjRemoveAllByHost:this.handleObjRemoveAllByHost(e);break;case Pr.kAnnoObjRestoreAllByHost:this.handleObjRestoreAllByHost(e)}}handleRequestDraw(t){var e;null===(e=fa.get(this.appId))||void 0===e||e.handleRequestDraw(t)}handleRequestDrawAck(t){var e,s;if((null===(e=t.annoPduDocRequestDrawAck)||void 0===e?void 0:e.requesterId)===this.appId){const e=t.annoPduHeader.appId;null===(s=fa.get(e))||void 0===s||s.onRequestDrawAck()}}handlePageSync(t){var e;const s=t.annoPduHeader.appId;null===(e=fa.get(s))||void 0===e||e.handlePageSync(t)}handleObjAddAck(t){var e;const s=t.annoPduHeader.appId;null===(e=fa.get(s))||void 0===e||e.handleObjAddAck(t)}handleAddObjRequest(t){var e;null===(e=fa.get(this.appId))||void 0===e||e.handleAddObjRequest(t)}handleRemoveObjRequest(t){var e;null===(e=fa.get(this.appId))||void 0===e||e.handleRemoveObjRequest(t)}handleRestoreObjRequest(t){var e;null===(e=fa.get(this.appId))||void 0===e||e.handleRestoreObjRequest(t)}handleRemoveUserObjRequest(t){var e;null===(e=fa.get(this.appId))||void 0===e||e.handleRemoveUserObjRequest(t)}handleRestoreUserObjRequest(t){var e;null===(e=fa.get(this.appId))||void 0===e||e.handleRestoreUserObjRequest(t)}handleObjRemoveAllByHost(t){var e;null===(e=fa.get(this.appId))||void 0===e||e.handleObjRemoveAllByHost(t)}handleObjRestoreAllByHost(t){var e;null===(e=fa.get(this.appId))||void 0===e||e.handleObjRestoreAllByHost(t)}onAnnotationMsg(t){const{type:e}=t;switch(e){case Yr.ADD_OBJECT:this.handleAddLocalObject(t);break;case Yr.REMOVE_OBJECT:this.handleRemoveLocalObject(t)}}handleAddLocalObject(t){var e;null===(e=this.annoSession)||void 0===e||e.handleAddLocalObject(t)}handleRemoveLocalObject(t){var e;null===(e=this.annoSession)||void 0===e||e.handleRemoveLocalObject(t)}onBoardRenderEnded(){var t;(null===(t=this.annoSession)||void 0===t?void 0:t.isPresenter)&&da.A.mediaSDKHandle.onAnnoRenderRequired()}onAnnotationActions(t){var e;switch(t.actionType){case Hr.SELECT_MOUSE:t.toolType=g.ANNO_TOOL_TYPE_NONE,this.handleSelectTool(t);break;case Hr.SELECT_ERASER:t.toolType=g.ANNO_TOOL_TYPE_ERASER,this.handleSelectTool(t);break;case Hr.SELECT_TOOL:this.handleSelectTool(t);break;case Hr.UNDO:this.handleUndo();break;case Hr.REDO:this.handleRedo();break;case Hr.CLEAR:this.handleClear(t);break;case Hr.CLOSE_TOOL_BAR:null===(e=this.annoSession)||void 0===e||e.sendMsgToBoard({type:gr.TOOL_BAR_CLOSED});break;case Hr.UPDATE_PARAMS:this.handleUpdateParams(t);break;case Hr.PAUSE_ANNOTATION:this.handlePauseAnnotation(t);break;case Hr.SHOW_ANNOTATOR_NAME:this.handleShowAnnotatorName(!!t.toShow);break;case Hr.ANNOTATOR_ID_TO_NAME:this.handleAnnotatorId2Name(t);break;case Hr.ANNO_CANVAS_SIZE_UPDATE:this.handleAnnoCanvasSizeUpdate(t)}}handleSelectTool(t){var e,s;const{toolType:i,width:r,color:n}=t,a=parseInt(n),o=16777215&a,h=(a>>>24)/255;this.currentTool={toolType:i,width:r,color:o,alpha:h},null===(e=this.annoSession)||void 0===e||e.setTool(this.currentTool),null===(s=this.annoSession)||void 0===s||s.sendMsgToBoard(Object.assign({type:gr.TOOL_SELECT},this.currentTool))}handleUndo(){var t;null===(t=fa.get(this.presenterId))||void 0===t||t.handleUndo()}handleRedo(){var t;null===(t=fa.get(this.presenterId))||void 0===t||t.handleRedo()}handleClear(t){var e;null===(e=fa.get(this.presenterId))||void 0===e||e.handleClear(t)}handleUpdateParams(t){const{userName:e}=t;"string"==typeof e&&fa.forEach((t=>{t.updateUserName(e)}))}handlePauseAnnotation(t){var e;const{paused:s}=t;if("boolean"==typeof s){let t;t=s?{toolType:g.ANNO_TOOL_TYPE_NONE}:this.currentTool,null===(e=this.annoSession)||void 0===e||e.sendMsgToBoard(Object.assign({type:gr.TOOL_SELECT,sessionId:this.presenterId},t))}}handleShowAnnotatorName(t){var e;null===(e=fa.get(this.appId))||void 0===e||e.handleShowAnnotatorName(t)}handleAnnotatorId2Name(t){var e;const{userId:s,userName:i}=t;null===(e=fa.get(this.appId))||void 0===e||e.handleAnnotatorId2Name({userId:s,userName:i})}handleAnnoCanvasSizeUpdate(t){var e;const s=parseInt(t.width),i=parseInt(t.height);this.canvasSizeInfo.width=s,this.canvasSizeInfo.height=i;const r=this._checkRemoteSizeInfo();r.width=s,r.height=i,null===(e=this.annoSession)||void 0===e||e.sendMsgToBoard(Object.assign({type:gr.RESIZE},r))}_createSession(t){let e,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.appId===t,r=this._getBoardSDKIns(i),n={appId:this.appId,userName:this.userName,presenterId:t,isBOSession:s,boardSDKIns:r,isPresenter:i};return e=i?new ga(n):new pa(n),fa.set(t,e),e}_getBoardSDKIns(t){const e=this._checkRemoteSizeInfo();let s=Object.assign({annoCanvas:this.annoCanvas,onAnnotationMsg:this.onAnnotationMsg.bind(this),sessionId:this.presenterId.toString(),styles:this._getAnnoCavansStyle(),onRenderEnd:this.onBoardRenderEnded.bind(this)},e);return t?(this.boardSDKPresentorIns||(this.boardSDKPresentorIns=new Or,this.boardSDKPresentorIns.init(s)),this.boardSDKPresentorIns):(this.boardSDKIns||(this.boardSDKIns=new Or,this.boardSDKIns.init(s)),this.boardSDKIns)}_checkRemoteSizeInfo(){var t,e,s,i,r,n,a,o;const h=this.remoteSizeInfo.width,l=this.remoteSizeInfo.height,c=(null===(t=this.annoSession)||void 0===t?void 0:t.isPresenter)?"abs":"";let d,u;return(null===(e=this.annoSession)||void 0===e?void 0:e.isPresenter)?(d=(null===(s=this.canvasSizeInfo)||void 0===s?void 0:s.width)||(null===(i=this.annoCanvas)||void 0===i?void 0:i.offsetWidth),u=(null===(r=this.canvasSizeInfo)||void 0===r?void 0:r.height)||(null===(n=this.annoCanvas)||void 0===n?void 0:n.offsetHeight)):(d=(null===(a=this.sharingMainCanvas)||void 0===a?void 0:a.offsetWidth)||h,u=(null===(o=this.sharingMainCanvas)||void 0===o?void 0:o.offsetHeight)||l),{width:d,height:u,absWidth:h,absHeight:l,sizeMode:c}}_getAnnoCavansStyle(){return{zIndex:this.annoCanvas.style.zIndex,position:"absolute",top:"0",left:"0"}}}}}]);
//# sourceMappingURL=https://d1cdksi819e9z7.cloudfront.net/sourcemap/annoter.min.js-08ecfca1a31669235cc2.map