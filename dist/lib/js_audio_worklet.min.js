(()=>{var e={2601:(e,t,s)=>{e.exports=s(4444)},3565:(e,t,s)=>{"use strict";var r=s(1960);e.exports=r},2671:(e,t,s)=>{"use strict";s(2344),e.exports=s(5951)},4444:(e,t,s)=>{"use strict";e.exports=s(214)},214:(e,t,s)=>{"use strict";s(397);var r=s(3565);e.exports=r},2159:(e,t,s)=>{"use strict";var r=s(2250),i=s(4640),a=TypeError;e.exports=function(e){if(r(e))return e;throw new a(i(e)+" is not a function")}},6624:(e,t,s)=>{"use strict";var r=s(6285),i=String,a=TypeError;e.exports=function(e){if(r(e))return e;throw new a(i(e)+" is not an object")}},5807:(e,t,s)=>{"use strict";var r=s(1907),i=r({}.toString),a=r("".slice);e.exports=function(e){return a(i(e),8,-1)}},1626:(e,t,s)=>{"use strict";var r=s(9447),i=s(4284),a=s(5817);e.exports=r?function(e,t,s){return i.f(e,t,a(1,s))}:function(e,t,s){return e[t]=s,e}},5817:e=>{"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},2532:(e,t,s)=>{"use strict";var r=s(5951),i=Object.defineProperty;e.exports=function(e,t){try{i(r,e,{value:t,configurable:!0,writable:!0})}catch(s){r[e]=t}return t}},9447:(e,t,s)=>{"use strict";var r=s(8828);e.exports=!r((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},9552:(e,t,s)=>{"use strict";var r=s(5951),i=s(6285),a=r.document,o=i(a)&&i(a.createElement);e.exports=function(e){return o?a.createElement(e):{}}},6794:(e,t,s)=>{"use strict";var r=s(5951).navigator,i=r&&r.userAgent;e.exports=i?String(i):""},798:(e,t,s)=>{"use strict";var r,i,a=s(5951),o=s(6794),n=a.process,u=a.Deno,h=n&&n.versions||u&&u.version,c=h&&h.v8;c&&(i=(r=c.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&o&&(!(r=o.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=o.match(/Chrome\/(\d+)/))&&(i=+r[1]),e.exports=i},1091:(e,t,s)=>{"use strict";var r=s(5951),i=s(6024),a=s(2361),o=s(2250),n=s(3846).f,u=s(7463),h=s(2046),c=s(8311),l=s(1626),f=s(9724);s(6128);var p=function(e){var t=function(s,r,a){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(s);case 2:return new e(s,r)}return new e(s,r,a)}return i(e,this,arguments)};return t.prototype=e.prototype,t};e.exports=function(e,t){var s,i,d,b,m,_,g,S,A,E=e.target,T=e.global,y=e.stat,w=e.proto,v=T?r:y?r[E]:r[E]&&r[E].prototype,C=T?h:h[E]||l(h,E,{})[E],M=C.prototype;for(b in t)i=!(s=u(T?b:E+(y?".":"#")+b,e.forced))&&v&&f(v,b),_=C[b],i&&(g=e.dontCallGetSet?(A=n(v,b))&&A.value:v[b]),m=i&&g?g:t[b],(s||w||typeof _!=typeof m)&&(S=e.bind&&i?c(m,r):e.wrap&&i?p(m):w&&o(m)?a(m):m,(e.sham||m&&m.sham||_&&_.sham)&&l(S,"sham",!0),l(C,b,S),w&&(f(h,d=E+"Prototype")||l(h,d,{}),l(h[d],b,m),e.real&&M&&(s||!M[b])&&l(M,b,m)))}},8828:e=>{"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},6024:(e,t,s)=>{"use strict";var r=s(1505),i=Function.prototype,a=i.apply,o=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(r?o.bind(a):function(){return o.apply(a,arguments)})},8311:(e,t,s)=>{"use strict";var r=s(2361),i=s(2159),a=s(1505),o=r(r.bind);e.exports=function(e,t){return i(e),void 0===t?e:a?o(e,t):function(){return e.apply(t,arguments)}}},1505:(e,t,s)=>{"use strict";var r=s(8828);e.exports=!r((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},3930:(e,t,s)=>{"use strict";var r=s(1505),i=Function.prototype.call;e.exports=r?i.bind(i):function(){return i.apply(i,arguments)}},2361:(e,t,s)=>{"use strict";var r=s(5807),i=s(1907);e.exports=function(e){if("Function"===r(e))return i(e)}},1907:(e,t,s)=>{"use strict";var r=s(1505),i=Function.prototype,a=i.call,o=r&&i.bind.bind(a,a);e.exports=r?o:function(e){return function(){return a.apply(e,arguments)}}},5582:(e,t,s)=>{"use strict";var r=s(2046),i=s(5951),a=s(2250),o=function(e){return a(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?o(r[e])||o(i[e]):r[e]&&r[e][t]||i[e]&&i[e][t]}},9367:(e,t,s)=>{"use strict";var r=s(2159),i=s(7136);e.exports=function(e,t){var s=e[t];return i(s)?void 0:r(s)}},5951:function(e,t,s){"use strict";var r=function(e){return e&&e.Math===Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof s.g&&s.g)||r("object"==typeof this&&this)||function(){return this}()||Function("return this")()},9724:(e,t,s)=>{"use strict";var r=s(1907),i=s(9298),a=r({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return a(i(e),t)}},3648:(e,t,s)=>{"use strict";var r=s(9447),i=s(8828),a=s(9552);e.exports=!r&&!i((function(){return 7!==Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}))},6946:(e,t,s)=>{"use strict";var r=s(1907),i=s(8828),a=s(5807),o=Object,n=r("".split);e.exports=i((function(){return!o("z").propertyIsEnumerable(0)}))?function(e){return"String"===a(e)?n(e,""):o(e)}:o},2250:e=>{"use strict";var t="object"==typeof document&&document.all;e.exports=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},7463:(e,t,s)=>{"use strict";var r=s(8828),i=s(2250),a=/#|\.prototype\./,o=function(e,t){var s=u[n(e)];return s===c||s!==h&&(i(t)?r(t):!!t)},n=o.normalize=function(e){return String(e).replace(a,".").toLowerCase()},u=o.data={},h=o.NATIVE="N",c=o.POLYFILL="P";e.exports=o},7136:e=>{"use strict";e.exports=function(e){return null==e}},6285:(e,t,s)=>{"use strict";var r=s(2250);e.exports=function(e){return"object"==typeof e?null!==e:r(e)}},7376:e=>{"use strict";e.exports=!0},5594:(e,t,s)=>{"use strict";var r=s(5582),i=s(2250),a=s(8280),o=s(1175),n=Object;e.exports=o?function(e){return"symbol"==typeof e}:function(e){var t=r("Symbol");return i(t)&&a(t.prototype,n(e))}},4284:(e,t,s)=>{"use strict";var r=s(9447),i=s(3648),a=s(8661),o=s(6624),n=s(470),u=TypeError,h=Object.defineProperty,c=Object.getOwnPropertyDescriptor,l="enumerable",f="configurable",p="writable";t.f=r?a?function(e,t,s){if(o(e),t=n(t),o(s),"function"==typeof e&&"prototype"===t&&"value"in s&&p in s&&!s[p]){var r=c(e,t);r&&r[p]&&(e[t]=s.value,s={configurable:f in s?s[f]:r[f],enumerable:l in s?s[l]:r[l],writable:!1})}return h(e,t,s)}:h:function(e,t,s){if(o(e),t=n(t),o(s),i)try{return h(e,t,s)}catch(e){}if("get"in s||"set"in s)throw new u("Accessors not supported");return"value"in s&&(e[t]=s.value),e}},3846:(e,t,s)=>{"use strict";var r=s(9447),i=s(3930),a=s(2574),o=s(5817),n=s(7374),u=s(470),h=s(9724),c=s(3648),l=Object.getOwnPropertyDescriptor;t.f=r?l:function(e,t){if(e=n(e),t=u(t),c)try{return l(e,t)}catch(e){}if(h(e,t))return o(!i(a.f,e,t),e[t])}},8280:(e,t,s)=>{"use strict";var r=s(1907);e.exports=r({}.isPrototypeOf)},2574:(e,t)=>{"use strict";var s={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!s.call({1:2},1);t.f=i?function(e){var t=r(this,e);return!!t&&t.enumerable}:s},581:(e,t,s)=>{"use strict";var r=s(3930),i=s(2250),a=s(6285),o=TypeError;e.exports=function(e,t){var s,n;if("string"===t&&i(s=e.toString)&&!a(n=r(s,e)))return n;if(i(s=e.valueOf)&&!a(n=r(s,e)))return n;if("string"!==t&&i(s=e.toString)&&!a(n=r(s,e)))return n;throw new o("Can't convert object to primitive value")}},2046:e=>{"use strict";e.exports={}},4239:(e,t,s)=>{"use strict";var r=s(7136),i=TypeError;e.exports=function(e){if(r(e))throw new i("Can't call method on "+e);return e}},6128:(e,t,s)=>{"use strict";var r=s(7376),i=s(5951),a=s(2532),o="__core-js_shared__",n=e.exports=i[o]||a(o,{});(n.versions||(n.versions=[])).push({version:"3.46.0",mode:r?"pure":"global",copyright:"Â© 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"})},5816:(e,t,s)=>{"use strict";var r=s(6128);e.exports=function(e,t){return r[e]||(r[e]=t||{})}},9846:(e,t,s)=>{"use strict";var r=s(798),i=s(8828),a=s(5951).String;e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol("symbol detection");return!a(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},7374:(e,t,s)=>{"use strict";var r=s(6946),i=s(4239);e.exports=function(e){return r(i(e))}},9298:(e,t,s)=>{"use strict";var r=s(4239),i=Object;e.exports=function(e){return i(r(e))}},6028:(e,t,s)=>{"use strict";var r=s(3930),i=s(6285),a=s(5594),o=s(9367),n=s(581),u=s(6264),h=TypeError,c=u("toPrimitive");e.exports=function(e,t){if(!i(e)||a(e))return e;var s,u=o(e,c);if(u){if(void 0===t&&(t="default"),s=r(u,e,t),!i(s)||a(s))return s;throw new h("Can't convert object to primitive value")}return void 0===t&&(t="number"),n(e,t)}},470:(e,t,s)=>{"use strict";var r=s(6028),i=s(5594);e.exports=function(e){var t=r(e,"string");return i(t)?t:t+""}},4640:e=>{"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},6499:(e,t,s)=>{"use strict";var r=s(1907),i=0,a=Math.random(),o=r(1.1.toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+o(++i+a,36)}},1175:(e,t,s)=>{"use strict";var r=s(9846);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},8661:(e,t,s)=>{"use strict";var r=s(9447),i=s(8828);e.exports=r&&i((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},6264:(e,t,s)=>{"use strict";var r=s(5951),i=s(5816),a=s(9724),o=s(6499),n=s(9846),u=s(1175),h=r.Symbol,c=i("wks"),l=u?h.for||h:h&&h.withoutSetter||o;e.exports=function(e){return a(c,e)||(c[e]=n&&a(h,e)?h[e]:l("Symbol."+e)),c[e]}},2344:(e,t,s)=>{"use strict";var r=s(1091),i=s(5951);r({global:!0,forced:i.globalThis!==i},{globalThis:i})},397:(e,t,s)=>{"use strict";s(2344)},1960:(e,t,s)=>{"use strict";var r=s(2671);e.exports=r}},t={};function s(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,s),a.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=s(2601),t=s.n(e),r=function(e,t){this._BYTES_PER_ELEMENT=t,this.capacity=(e.byteLength-8)/t,this.usableCapacity=this.capacity-1,this.buf=e,this.write_ptr=new Uint32Array(this.buf,0,1),this.read_ptr=new Uint32Array(this.buf,4,1),this.storageUint8s=new Uint8Array(this.buf,8,e.byteLength-8)};r.prototype.available_read=function(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_read(e,t)},r.prototype._available_read=function(e,t){return(t+this.capacity-e)%this.capacity},r.prototype.dequeue=function(){var e=Atomics.load(this.read_ptr,0);let t=new Uint32Array(this.buf,e*this._BYTES_PER_ELEMENT+8,1);return this.storageUint8s.subarray(e*this._BYTES_PER_ELEMENT+4,e*this._BYTES_PER_ELEMENT+4+t[0])},r.prototype.addReadPtr=function(){var e=Atomics.load(this.read_ptr,0);Atomics.store(this.read_ptr,0,(e+1)%this.capacity)},r.prototype.getReaderPtr=function(){return this.read_ptr[0]},r.prototype.setReaderPtr=function(e){Atomics.store(this.read_ptr,0,e%this.capacity)},r.prototype.get=function(e){let t=e%this.capacity,s=new Uint32Array(this.buf,t*this._BYTES_PER_ELEMENT+8,1);return this.storageUint8s.subarray(t*this._BYTES_PER_ELEMENT+4,t*this._BYTES_PER_ELEMENT+4+s[0])};const i=r,a="MEDIASDK_CACHE_INFO";function o(e){postMessage({status:35,data:e})}function n(e,t=null){var s,r;if(t instanceof Error||t instanceof ErrorEvent){const i=t;e+=" Code: "+(null==i?void 0:i.code)+" Message: "+(null==t?void 0:t.message)+" Stack: "+(null!==(r=null===(s=null==i?void 0:i.error)||void 0===s?void 0:s.stack)&&void 0!==r?r:null==i?void 0:i.stack),t=null}postMessage({status:61,errorMessage:e,errorEvent:t})}function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t)return t.postMessage({status:48,data:e});postMessage({status:48,data:e})}new class{constructor(){this._highFrequencyLogs={},this.fixVersion="",this.cacheLogStack=[],this.isFlushing=!1}setInstance(e,t){this._instance=e,this.fixVersion=t}getMessageFromErrorOrEvent(e,t){let s=e;return t instanceof ErrorEvent?(t.filename&&(s+=` File: ${t.filename}`),(t.lineno||t.colno)&&(s+=` Line: ${t.lineno}:${t.colno}`),t.message&&(s+=` Message: ${t.message}`),t.error&&(s+=`\nStack: ${t.error.stack}`)):t instanceof Error?(t.message&&(s+=` Message: ${t.message}`),t.stack&&(s+=` Stack: ${t.stack}`),t.name&&(s+=` Name: ${t.name}`),t.constraint&&(s+=` Constraint: ${t.constraint}`)):t instanceof CloseEvent?(t.code&&(s+=` Code: ${t.code}`),t.reason&&(s+=` Reason: ${t.reason}`),s+=` wasClean: ${t.wasClean}`):t instanceof DOMException?(t.message&&(s+=` Message: ${t.message}`),t.name&&(s+=` Name: ${t.name}`)):s+=t?t.toString():"",s}_addCacheLog(e,t){this.cacheLogStack.length<100&&this.cacheLogStack.push({type:e,message:t})}flushCacheLog(){if(this._instance&&this.cacheLogStack.length>0&&!this.isFlushing){this.isFlushing=!0;let e="";this.cacheLogStack.forEach((t=>{let{type:s,message:{message:r="",tags:i=[]}}=t;const o=r?`${i.join("|")}:${r}|----|`:"";switch(s){case"log":this._log(r,[...i,a]);break;case"warn":case"error":case"severityerror":case"directReport":e+=o}})),e&&this._directReport(e,[a]),this.cacheLogStack=[],this.isFlushing=!1}}log(e,t=[]){this._instance?(this.flushCacheLog(),this._log(e,t)):this._addCacheLog("log",{message:e,tags:t})}warn(e,t=null,s=[]){e=this.getMessageFromErrorOrEvent(e,t),this._instance?(this.flushCacheLog(),this._warn(e,s)):this._addCacheLog("warn",{message:e,tags:s})}error(e,t=null,s=[]){var r;e=this.getMessageFromErrorOrEvent(e,t),this._highFrequencyLogs[e]?this._highFrequencyLogs[e]+=1:this._highFrequencyLogs[e]=1,!((r=this._highFrequencyLogs[e])&r-1)&&(this._instance?(this.flushCacheLog(),this._error(e,s)):this._addCacheLog("error",{message:e,tags:s}))}severityerror(e,t=[]){this._instance?(this.flushCacheLog(),this._severityerror(JSON.stringify(e),t)):this._addCacheLog("severityerror",{message:JSON.stringify(e),tags:t})}directReport(e,t=["MEDIASDK_INFO"]){var s;this._instance?(this.flushCacheLog(),null===(s=this._directReport)||void 0===s||s.call(this,e,t)):this._addCacheLog("directReport",{message:e,tags:t})}_log(e,t=[]){this._instance&&this._instance.log(e,t)}_warn(e,t=[]){this._instance&&this._instance.warn(e,t)}_error(e,t=[]){this._instance&&this._instance.error(e,[this.fixVersion,...t])}_severityerror(e,t=[]){this._instance&&this._instance.error(e,t)}_directReport(e,t=[]){var s,r;this._instance&&(null===(r=(s=this._instance).directReport)||void 0===r||r.call(s,{msg:e},t))}clearHighFrequencyLogs(){this._highFrequencyLogs={}}},new Error,new Map,new Map,new class{constructor(){this.ssrcInfoMap=new Map,this.timer=null}updateSSRCInfo(e,t){this.ssrcInfoMap.has(e)||this.ssrcInfoMap.set(e,{firstTime:0,lastTime:0,frames:0,fps:0}),this._calculateFPS(e,t),this._removeZeroFPS()}_calculateFPS(e,t){const s=this.ssrcInfoMap.get(e);if(0===s.frames?s.firstTime=t:s.lastTime=t,s.frames+=1,s.frames>2&&s.frames%5==0&&s.lastTime-s.firstTime>=1e3){const t=Math.floor(1e3/((s.lastTime-s.firstTime)/(s.frames-1)));s.fps!==t&&(this._notifyFPS(e,t),s.fps=t),s.firstTime=s.lastTime,s.frames=1}}_removeZeroFPS(){let e=Date.now();this.ssrcInfoMap.forEach(((t,s)=>{const r=this.ssrcInfoMap.get(s);r&&r.lastTime&&e-r.lastTime>2e3&&(this.ssrcInfoMap.delete(s),this._notifyFPS(s,0))}))}_notifyFPS(e,t){postMessage({status:66.6,data:{ssrc:e,fps:t}})}_checkIfNewFrameComing(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout((()=>{this._removeZeroFPS(),this.timer=null}),2500)}},new class{constructor(){this.ssrcInfoMap=new Map,this.timer=null}updateSSRCInfo(e,t){this.ssrcInfoMap.has(e)||this.ssrcInfoMap.set(e,{timeList:[],lastTime:0,fps:0}),this._calculateFPS(e,t),this._removeZeroFPS(),this._checkIfNewFrameComing()}_calculateFPS(e,t){const s=this.ssrcInfoMap.get(e);if(s.timeList.push(t),s.lastTime=t,s.timeList.length>2){const t=s.timeList[0],r=s.timeList[s.timeList.length-1];if(r-t>=1e3){const i=Math.floor(1e3/((r-t)/(s.timeList.length-1)));s.fps!==i&&(this._notifyFPS(e,i),s.fps=i),s.timeList=[]}}s.timeList.length>30&&(s.timeList=s.timeList.slice(s.timeList.length-30))}_removeZeroFPS(){this.ssrcInfoMap.forEach(((e,t)=>{const s=this.ssrcInfoMap.get(t);s&&Date.now()-s.lastTime>2e3&&(this.ssrcInfoMap.delete(t),this._notifyFPS(t,0))}))}_notifyFPS(e,t){postMessage({status:66.6,data:{ssrc:e,fps:t}})}_checkIfNewFrameComing(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout((()=>{this._removeZeroFPS(),this.timer=null}),2500)}};const h=(new Map([["useinbandfec",1],["maxaveragebitrate",48e3],["maxplaybackrate",24e3],["sprop-maxcapturerate",24e3],["sprop-stereo",null],["stereo",null]]),new Map([["useinbandfec",null],["maxaveragebitrate",96e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3],["sprop-stereo",1],["stereo",1]]),new Map([["useinbandfec",null],["maxaveragebitrate",96e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3],["sprop-stereo",1],["stereo",1]]),new Map([["useinbandfec",null],["maxaveragebitrate",128e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3],["sprop-stereo",1],["stereo",1]]),new Map([["useinbandfec",null],["maxaveragebitrate",128e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3],["sprop-stereo",1],["stereo",1]]),new Map([["useinbandfec",null],["maxaveragebitrate",96e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3]]),new Map([["useinbandfec",1],["maxaveragebitrate",64e3],["maxplaybackrate",24e3],["sprop-maxcapturerate",24e3],["sprop-stereo",null],["stereo",null]]),new Map([["stereo",1]]),0),c={ENCODE:1,DECODE:2,DECRPT:3,DECRPT_DECODE:4,WORKLET_APM_ONLY:5},l={MUTE:0,UNMUTE:1,LEAVED:2,MUTE_APM_ONLY:3,UNMUTE_APM_ONLY:4};let f,p,d=0;const b=new Map,m=[1,2,4,8,16,32,64,128,256];let _,g,S,A,E,T,y,w,v,C=null,M=!0;function P(e){if(C=e,!f)return;if(!e)return;const{update:t,remove:s}=e;t&&t.length>0&&t.forEach((e=>{const{userId:t,muted:s,bShareOn:r}=e;t&&(null!=r?r||v(f,t+1|512,!1,!0):v(f,t+1,!!s,!1))})),s&&s.length>0&&s.forEach((e=>{const{userId:t,muted:s}=e;t&&v(f,t+1,!!s,!0)}))}var D=0,L=!1,R=null,I=!1;const O={WASMTYPE:c,AUDIO_STATE:l,onWasmModuleReady:function(e){if(!e)return console.warn("[AudioWASMAdapter] Module undefined");_=e.cwrap("_Heartbeat","number",["number"]),g=e.cwrap("_MuteUnmuteState","number",["number","number"]),S=e.cwrap("_Switch_Original_Sound","number",["number","boolean","boolean","boolean","boolean"]),A=e.cwrap("_Deliver_Recorded_Data","number",["number","number","number","number","number","number"]),E=e.cwrap("_Switch_Denoise","number",["number","boolean","number","boolean","boolean"]),T=e.cwrap("_Audio_Init","number",["number","string","string","number","number","boolean","boolean","boolean","number","boolean"]),y=e.cwrap("_Switch_High_Bitrate","number",["number","number"]),w=e.cwrap("_Set_All_Speech_Volume_Level","number",["number"]),v=e.cwrap("_Update_Remote_User_Send_Status","number",["number","number","boolean","boolean"])},setAudioInstanceAndType:function(e,t,s){f=e,t&&(d=t),s&&(p=s),d!==c.DECODE&&d!==c.DECRPT_DECODE||P(C)},muteUnmuteState:function(e){if(null!=Object.values(l).find((t=>t==e)))return f?void(d!=c.WORKLET_APM_ONLY&&(g(f,e),o("muteUnmuteState: "+e))):o("muteUnmuteState: -1")},switchOriginalSound:function(e,t,s,r){f&&S(f,e,t,s,r)},deliverRecordedData:function(e,t,s,r){f&&A(f,e,t,0,s,r)},switchDenoise:function(e,t,s=h,r=!1){f&&(L=e,E(f,!!e,s,!!t,r))},audioInit:function(e,t,s,r,i,a,o,n,u,h){return T(e,t,s,r,i,a,o,n,u,h)},setDecoder:function(e){R=e},needCalculateDenoiseOutput:function(){I=!0},switchHighBitrate:function(e){f&&y(f,e)},disableJitterLog:function(){M=!1},setAllSpeechVolume:function(e){f&&w(f,e)},updateAllRemoteUserSendStatus:P,writeViperExWASMtoFS:function(e){var t;let s=!1;try{FS.writeFile("/viperex.wasm",new Uint8Array(e),{canOwn:!0}),s=!0,o("VIPEREX_WRITE_SUCCESS:1")}catch(e){o(`VIPEREX_WRITE_SUCCESS:0-${d}-${e.message}`),n(`Write ViperExWASM to FS failed wasm type: ${d}, message: ${e.message}, error: `,e),s=!1}finally{return null===(t=null==p?void 0:p.port)||void 0===t||t.postMessage({status:"viperExACK"}),s}},onMonitorLogWASM:function(e,t){if(t<=0)return;const s=Module.HEAPU8.subarray(e,e+t),r=String.fromCharCode.apply(null,s);r&&(!M&&r.includes("JITTER")||r.includes("WCL_MCM_AUDIO_RECEIVE")&&d!=c.DECRPT&&d!=c.DECRPT_DECODE||r.includes("WCL_MCM_AUDIO,")&&d==c.DECRPT||(d==c.ENCODE||d==c.DECRPT||d==c.DECRPT_DECODE?u(r):d==c.DECODE?p&&p.port&&u(r,p.port):d==c.WORKLET_APM_ONLY&&p.port&&p.port.postMessage({status:"SPEECH_LOG",data:{log:r}})))},onGlobalTracingLogWASM:function(e,t,s,r){if(t<=0)return;const i=Module.HEAPU8.subarray(e,e+t);let a=String.fromCharCode.apply(null,i);if(a){if(1==r){const e=`${r}_${s}_${a.substring(0,100)}`,t=(b.get(e)||0)+1;if(b.set(e,t),!m.includes(t)&&(t<256||t%256!=0)&&t>=64)return;a=`${a} [Count: ${t}] `}switch(s){case 0:case 2:break;case 1:postMessage({status:61,errorMessage:"[WASM audio] "+a,level:"low"});break;case 3:n("[WASM audio] "+a)}}},onMuteSpeechWarningWASM:function(){postMessage({status:121})},onAudioLevelWASM:function(e,t,s){d!=c.ENCODE&&d!=c.WORKLET_APM_ONLY||1==e&&(0===t&&0===D||(D=t,d===c.ENCODE?postMessage({status:38,value:t}):(null==p?void 0:p.port)&&p.port.postMessage({status:38,data:t})))},onAPMProcessedPCMWASM:function(e,t,s,r){if(!L)return;let i=Module.HEAPF32.subarray(e/4,e/4+t);if(R){if(I){I=!1;let{sumRms:e}=function(e,t){let s=0,r=0;for(let i=0;i<e.length;i+=t){r+=e[i]*e[i];let t=Math.abs(e[i]);t>s&&(s=t)}return s=s>1?1:s,{sumRms:r/e.length/t,absMax:s}}(i,2),t=function(e){let t=0;return t=e>.1995?15:e>.0794?14:e>.0316?13:e>.0126?12:e>.005?11:e>.002?10:e>79433e-8?9:e>31623e-8?8:e>12589e-8?7:e>50119e-9?6:e>19953e-9?5:e>79433e-10?4:e>31623e-10?3:e>12589e-10?2:e>5.0119e-7?1:0,t}(e);p.port&&p.port.postMessage({status:"AUDIO_LEVEL_R16_DENOISE",level:t})}R.push([i])}},onSenderStatsLogWASM:function(e,t,s,r,i,a){t=Date.now(),d===c.ENCODE&&postMessage({status:206,data:{ssrc:e,timestamp:t,roundTripTime:s,jitter:r,packetsLost:i,packetsSent:a,kind:"audio"}})},onReceiverStatsLogWASM:function(e,t,s,r,i,a){}};class k{constructor(){this.cacheSize=0,this.sameCacheSizeCounter=0}shouldSendCacheSize(e){return e===this.cacheSize&&this.sameCacheSizeCounter++,(this.cacheSize!==e||200===this.sameCacheSizeCounter)&&(this.sameCacheSizeCounter=0,this.cacheSize=e,!0)}}class N{constructor(e,t,s){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(this.STATE_READ_READY=0,this.STATE_READ_INDEX=1,this.STATE_WRITE_READY=2,this.STATE_WRITE_INDEX=3,this.STATE_DATA_COUNT=4,this.STATE_CACHE_SIZE=5,this.STATY_READY_NO=0,this.STATY_READY_YES=1,this.sabState=new Uint32Array(e),this.sabBuffer=new Float32Array(t),this.perFrameLength=s,this.writeChannelNumb=r,this.bufferLen=this.sabBuffer.length,this.supportSpecialOptimization=this.bufferLen%s==0,this.bufferIndex=null,this.supportSpecialOptimization){let e=this.bufferLen/s;this.bufferIndex=[];for(let t=0;t<e;t++)this.bufferIndex.push(this.sabBuffer.subarray(t*s,t*s+s))}this.placeBuffer=new Float32Array(this.perFrameLength),this.QUANTUM_SIZE=128,this.CACHE_SIZE_MAX_VALUE=Math.floor(Math.floor(this.bufferLen/this.QUANTUM_SIZE)/2),this.CACHE_SIZE_MIN_VALUE=6,this.CACHE_SIZE_MAX_VALUE<this.CACHE_SIZE_MIN_VALUE&&(this.CACHE_SIZE_MAX_VALUE=this.CACHE_SIZE_MIN_VALUE),this.setCacheSize(this.CACHE_SIZE_MIN_VALUE),this._counter=0,this.onCacheSizeChange=null,this.cacheSizeController=new k}getCacheSize(){return Atomics.load(this.sabState,this.STATE_CACHE_SIZE)}setCacheSize(e){e>this.CACHE_SIZE_MAX_VALUE&&(e=this.CACHE_SIZE_MAX_VALUE),e<this.CACHE_SIZE_MIN_VALUE&&(e=this.CACHE_SIZE_MIN_VALUE),this.onCacheSizeChange&&this.cacheSizeController.shouldSendCacheSize(e)&&this.onCacheSizeChange(e),Atomics.store(this.sabState,this.STATE_CACHE_SIZE,e)}setQuantumSize(e){this.QUANTUM_SIZE=e,this.CACHE_SIZE_MAX_VALUE=Math.floor(Math.floor(this.bufferLen/this.QUANTUM_SIZE)/2),this.CACHE_SIZE_MAX_VALUE<this.CACHE_SIZE_MIN_VALUE&&(this.CACHE_SIZE_MAX_VALUE=this.CACHE_SIZE_MIN_VALUE)}isNeedMoreData(){let e=Atomics.load(this.sabState,this.STATE_CACHE_SIZE);return Atomics.load(this.sabState,this.STATE_DATA_COUNT)<e*this.QUANTUM_SIZE}shouldAdjustCacheBuffer(){this._counter>0&&this.setCacheSize(this.getCacheSize()+1)}clear(){this.sabState&&(this.sabState[this.STATE_READ_READY]=0,this.sabState[this.STATE_READ_INDEX]=0,this.sabState[this.STATE_WRITE_READY]=0,this.sabState[this.STATE_WRITE_INDEX]=0,this.sabState[this.STATE_DATA_COUNT]=0),this._counter=0}setWriteReady(){this.sabState[this.STATE_WRITE_READY]=this.STATY_READY_YES}isReady(){return this.sabState[this.STATE_WRITE_READY]&&this.sabState[this.STATE_READ_READY]}getDataCount(){return Atomics.load(this.sabState,this.STATE_DATA_COUNT)}write(e){if(void 0===e[0]||e[0].length*this.writeChannelNumb!==this.perFrameLength)return;let t=this.sabState[this.STATE_READ_READY];return this.sabState[this.STATE_WRITE_READY]||(this.sabState[this.STATE_WRITE_READY]=this.STATY_READY_YES,this.sabState[this.STATE_WRITE_INDEX]=0),t?this.supportSpecialOptimization?this.writeSpecial(e):this.writeNormal(e):void 0}writeNormal(e){let t=this.sabState[this.STATE_WRITE_INDEX];for(let s=0;s<this.writeChannelNumb;s++)for(let r=0;e[s]&&r<e[s].length;r++)this.sabBuffer[(t+r*this.writeChannelNumb+s)%this.bufferLen]=e[s][r];t+=this.perFrameLength,t>=this.bufferLen&&(t-=this.bufferLen),this.sabState[this.STATE_WRITE_INDEX]=t,Atomics.add(this.sabState,this.STATE_DATA_COUNT,this.perFrameLength)}writeSpecial(e){let t=this.sabState[this.STATE_WRITE_INDEX];for(let s=0;s<this.writeChannelNumb;s++)for(let r=0;e[s]&&r<e[s].length;r++)this.bufferIndex[t][r*this.writeChannelNumb+s]=e[s][r];t=(t+1)%this.bufferIndex.length,this.sabState[this.STATE_WRITE_INDEX]=t,Atomics.add(this.sabState,this.STATE_DATA_COUNT,this.perFrameLength)}read(){let e=this.sabState[this.STATE_READ_READY],t=this.sabState[this.STATE_WRITE_READY];if(e||(this.sabState[this.STATE_READ_READY]=this.STATY_READY_YES,this.sabState[this.STATE_READ_INDEX]=0),!t)return null;let s=this.supportSpecialOptimization?this.readSpecial():this.readNormal();return null===s?this.shouldAdjustCacheBuffer():this._counter++,s}readNormal(){let e=this.sabState[this.STATE_READ_INDEX],t=Atomics.load(this.sabState,this.STATE_DATA_COUNT);if(t<this.perFrameLength)return null;if(t>this.bufferLen){let s=Math.ceil((t-this.bufferLen)/this.perFrameLength)+1;e=(s*this.perFrameLength+e)%this.bufferLen,Atomics.sub(this.sabState,this.STATE_DATA_COUNT,s*this.perFrameLength)}let s=null;if(this.bufferLen-e>=this.perFrameLength)s=this.sabBuffer.subarray(e,e+this.perFrameLength);else{let t=this.sabBuffer.subarray(e),r=this.sabBuffer.subarray(0,this.perFrameLength-t.length);s=this.placeBuffer,s.set(t),s.set(r,t.length)}return e+=this.perFrameLength,e>=this.bufferLen&&(e-=this.bufferLen),this.sabState[this.STATE_READ_INDEX]=e,Atomics.sub(this.sabState,this.STATE_DATA_COUNT,this.perFrameLength),s}readSpecial(){let e=this.sabState[this.STATE_READ_INDEX],t=Atomics.load(this.sabState,this.STATE_DATA_COUNT);if(t<this.perFrameLength)return null;if(t>this.bufferLen){let s=Math.ceil((t-this.bufferLen)/this.perFrameLength)+1;e=(s+e)%this.bufferIndex.length,Atomics.sub(this.sabState,this.STATE_DATA_COUNT,s*this.perFrameLength)}let s=this.bufferIndex[e];return e=(e+1)%this.bufferIndex.length,this.sabState[this.STATE_READ_INDEX]=e,Atomics.sub(this.sabState,this.STATE_DATA_COUNT,this.perFrameLength),s}}class x{constructor(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.rframes=e,this.wframes=t,this.writeChannelNumb=s,this.cap=this.lcm(e,t),this.buffer=new Float32Array(this.cap),this.remain=0,this.woffset=0,this.roffset=0}gcd(e,t){return 0===t?e:this.gcd(t,e%t)}lcm(e,t){return e/this.gcd(e,t)*t}push(e){if(null==e[0]||e[0].length*this.writeChannelNumb==this.wframes){for(let t=0;t<this.writeChannelNumb;t++)for(let s=0;s<e[0].length;s++)this.buffer[(this.woffset+s*this.writeChannelNumb+t)%this.cap]=e[t]?e[t][s]:e[0][s];this.woffset+=this.wframes,this.remain+=this.wframes,this.woffset>=this.cap&&(this.woffset=this.woffset%this.cap)}else{var t;console.error("[Audio] critical error in AudioWorklet: data.length:",e.length,"this.woffset:",this.woffset,"this.cap:",this.cap),_workletPrinter&&_workletPrinter.error("critical error in AudioWorklet: ".concat(null===(t=e[0])||void 0===t?void 0:t.length," ").concat(his.writeChannelNumb," ").concat(this.wframes))}}read(){if(!this.hasData())return null;let e=this.buffer.subarray(this.roffset,this.roffset+this.rframes);return this.remain-=this.rframes,this.roffset+=this.rframes,this.roffset>=this.cap&&(this.roffset=this.roffset%this.cap),e}hasData(){return this.remain>=this.rframes}clear(){this.buffer.fill(0),this.remain=0,this.woffset=0,this.roffset=0}}t().onWasmModuleReady=function(){O.onWasmModuleReady(Module),H=Module.cwrap("_Audio_Init","number",["number","string","string","number","number","boolean","boolean","boolean","number","boolean"]),(j=H(G,$,X,0,0,!0,!1,!1,1))?O.setAudioInstanceAndType(j,O.WASMTYPE.DECODE,fe):_workletPrinter.error("audio_handle not exist"),Y=Module.cwrap("_Audio_Try_Analysis","number",["number","number","number","number"]),V=Module.cwrap("_Get_Mixed_Audio","number",["number","number","number","number"]),Z=Module.cwrap("_setMultiViewFlag","number",["number","boolean"]),te=Module.cwrap("_Interpretation_Configure","number",["number","number","number","number"]),re=Module.cwrap("_Set_Speech_Volume_Level","number",["number","number","number"]),Module.cwrap("_Get_Receiver_Monitor_Statistics","number",["number"]),ne=Module.cwrap("_Set_Audio_Statistics_Flag","number",["number","boolean"]),se=Module._malloc(4*ae),Module.HEAPU32.subarray(se/4,se/4+ae),Z(j,Q),ie=Module._malloc(oe),Module.HEAP8.subarray(ie,ie+oe),fe.port.postMessage({status:"WASM_INIT_SUCCESS",data:{audio_handle:0!==j}})},t().onAbort=function(e){_workletPrinter.error("WASM onAbort "+(e?e.message:""),e)},t().preInit=function(e){_workletPrinter.debug("WASM preInit"+(e?e.message:""),e)},t().preRun=function(e){_workletPrinter.debug("WASM preRun"+(e?e.message:""),e)},t()._workletPrinter=new class{constructor(e){this.messageQueue=[],this.auidoNodePort,this.userAgent="",this.isSafari=!1,this.debug=this.debug.bind(this),this.log=this.log.bind(this),this.warn=this.warn.bind(this),this.error=this.error.bind(this),this.print_=this.print_.bind(this),this.messageHeader=e}setUserAgent(e){this.userAgent=e,this.userAgent.match(/AppleWebKit\/(\d+)\./)&&(this.isSafari=!0)}setAuidoNodePort(e){this.auidoNodePort=e}debug(e){e=this.messageHeader+e;for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];this.print_({level:"debug",message:e,data:s})}log(e){e=this.messageHeader+e;for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];this.print_({level:"log",message:e,data:s})}warn(e){e=this.messageHeader+e;for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];this.print_({level:"warn",message:e,data:s})}error(e){e=this.messageHeader+e;for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];this.print_({level:"error",message:e,data:s})}print_(e){if(this.messageQueue.push(e),this.auidoNodePort)for(;this.messageQueue.length;){let e=this.messageQueue.shift();this._postToWorkerPrint(e)}}_postToWorkerPrint(e){this.auidoNodePort&&this.auidoNodePort.postMessage({status:"workletMessage",data:{level:e.level,message:e.message,data:e.data}})}}("[Audio][Worklet][WASM]"),t().AudioWasmAdapter=O;class B{constructor(){this.buffList=[],this.cacheMinSize=4,this.cacheMaxSize=16,this.cacheSize=this.cacheMinSize,this.onCacheSizeChange=null,this.onrollbackbuffer=null,this.onneedmoredata=null,this.isReady=!1,this.cacheSizeController=new k}push(e){this.isReady=!0,this.buffList.push({buff:e,offset:0})}copy(e,t,s,r){return e.length-t<=s.length-r?(0===t?s.set(e,r):s.set(e.subarray(t),r),e.length-t):(s.set(e.subarray(t,t+s.length-r),r),s.length-r)}increaseCacheSize(){this.isReady&&this.cacheSize++,this.cacheSize>this.cacheMaxSize&&(this.cacheSize=this.cacheMaxSize),this.onCacheSizeChange&&this.isReady&&this.cacheSizeController.shouldSendCacheSize(this.cacheSize)&&this.onCacheSizeChange(this.cacheSize)}copyTo(e){if(0===this.buffList.length)return e.fill(0),void this.increaseCacheSize();let t=this.buffList[0];if(t.buff.length-t.offset>=e.length)this.copy(t.buff,t.offset,e,0),t.offset+=e.length,t.offset===t.buff.length&&(this.buffList.shift(),this.onrollbackbuffer&&this.onrollbackbuffer(t.buff));else{if(this.buffList.length<2)return e.fill(0),void this.increaseCacheSize();let s=this.copy(t.buff,t.offset,e,0);this.buffList.shift(),this.onrollbackbuffer&&this.onrollbackbuffer(t.buff),t=this.buffList[0],s=this.copy(t.buff,t.offset,e,s),t.offset+=s}}requestMoreData(){this.buffList.length<this.cacheSize&&this.onneedmoredata&&this.onneedmoredata()}hasData(){return this.buffList.length>=2}}class F{constructor(e){this.buffList=[],this.frameLength=e,this.onframedata=null}copy(e,t,s,r){if(e[0].length*K<=s.length-r){for(let t=0;t<K;t++)for(let i=0;e[t]&&i<e[t].length;i++)s[r+i*K+t]=e[t][i];return(e[0].length-t)*K}for(let t=0;t<K;t++)for(let i=0;e[t]&&i<e[t].length&&r+i*K+t<s.length;i++)s[r+i*K+t]=e[t][i];return s.length-r}rollbackbuffer(e){this.buffList.push({buff:e,offset:0})}push(e){0===this.buffList.length&&this.buffList.push({buff:new Float32Array(this.frameLength),offset:0});let t=this.buffList[0];if(t.buff.length-t.offset>=e[0].length*K){let s=this.copy(e,0,t.buff,t.offset);t.offset+=s,t.buff.length===t.offset&&(this.buffList.shift(),this.onframedata&&this.onframedata(t.buff))}else{let s=this.copy(e,0,t.buff,t.offset);if(this.buffList.shift(),this.onframedata&&this.onframedata(t.buff),e[0].length*K>s){let t=[];for(let r=0;r<K;r++)t.push(e[r].subarray(Math.floor(s/K)+(s%K>r?1:0)));this.push(t)}}}}class U{constructor(e,t){this.context=t,this.decodePort=null,this.encodePort=null,this.captureSize=e/100*K,this.playBuffer=new B,this.playBuffer.onrollbackbuffer=e=>{this.decodePort},this.playBuffer.onneedmoredata=()=>{this.decodePort&&this.decodePort.postMessage({status:1})},this.playBuffer.onCacheSizeChange=e=>{this.decodePort&&this.decodePort.postMessage({status:3,cacheSize:e})},this.quantum=new Float32Array(128*J),this.captureBuffer=new F(this.captureSize),this.captureBuffer.onframedata=e=>{this.encodePort&&this.encodePort.postMessage({command:2,buffer:e},[e.buffer])}}setDecodePort(e){this.decodePort&&this.decodePort.close(),this.decodePort=e,this.decodePort.onmessage=this.handleDecodeData.bind(this)}setEncodePort(e){this.encodePort&&this.encodePort.close(),this.encodePort=e,this.encodePort.onmessage=this.handleEncodeData.bind(this)}handleDecodeData(e){this.context.isPlaying&&this.playBuffer.push(e.data.data)}handleEncodeData(e){0===e.data.event&&this.captureBuffer.rollbackbuffer(e.data.buffer)}requestMoreData(){this.playBuffer.requestMoreData()}close(){this.decodePort&&(this.decodePort=null,this.decodePort.close()),this.encodePort&&(this.encodePort=null,this.encodePort.close())}write(e){this.captureBuffer.push(e)}read(){return this.playBuffer.copyTo(this.quantum),this.requestMoreData(),this.quantum}}let W="undefined"!=typeof SharedArrayBuffer,z=!0;var H=null,Y=null,j=null,V=null,Z=null;let X=0,$=0,G=0,q=0,Q=!1,K=1,J=1,ee=null;var te,se,re,ie,ae=10;let oe=1500;var ne,ue={audioStatisticsFlag:!1};function he(e){let t=e[1];return 4294967296*e[2]+t}new Map,t().update_play_time=function(e,t){if(t){var s=new Uint8Array(t),r=Module.HEAP8.subarray(e+0,e+t);if(s.set(r),Q){var i;null===(i=fe.videoDecodePort)||void 0===i||i.postMessage({status:1,data:s},[s.buffer])}else{let e=new Uint32Array(s.buffer),t=null,r=null,i=0,a=0;for(let o=0;o<s.length/16;o++){let s=e[4*o];512&s?(t=e.subarray(4*o,4*o+4),a=he(t)):s>>10==q>>10&&(r=e.subarray(4*o,4*o+4),i=he(r))}if(!i&&!a)return;fe.port.postMessage({status:57,at:i,st:a})}}};let ce=null,le=null;t().frame_callback=function(e,t,s,r,i,a,o,n){ce===e&&le.length==t*o||(le=Module.HEAPF32.subarray(e/4,e/4+t*o),ce=e),ee.push([le])};let fe=null;class pe extends AudioWorkletProcessor{static get parameterDescriptors(){return[{name:"pcm",defaultValue:1}]}constructor(e){var s,r;super(),fe=this,monitorLOG("WIB"),this.port.onmessage=this.handleMessage.bind(this),this.isPlaying=!1,this.isCapturing=!1,this.wasmModule=null==e||null===(s=e.processorOptions)||void 0===s?void 0:s.wasmModule,e&&e.processorOptions&&(e.processorOptions.audioEncodeChannelsNum&&(K=e.processorOptions.audioEncodeChannelsNum),e.processorOptions.audioDecodeChannelsNum&&(J=e.processorOptions.audioDecodeChannelsNum)),this.SABConstructor(e&&e.processorOptions?e.processorOptions.sharedBuffer:null),this.noSABConstructor(),t().fsHandler&&t().fsHandler.setPort(this.port),null!=e&&null!==(r=e.processorOptions)&&void 0!==r&&r.userAgent&&_workletPrinter.setUserAgent(e.processorOptions.userAgent),_workletPrinter.setAuidoNodePort(this.port),monitorLOG("WIE")}SABConstructor(e){this.sampleRate_=0,this.g_sharedbuffer=e||null,this.encodeSAB=null,this.decodeSAB=null,this.audioEncodePort=null,this.audioDecodePort=null,this.videoDecodePort=null,this.rtpSAB=null,this.stopPlayAudio=!1,ee=new x(128*J,sampleRate/100*J)}noSABConstructor(){this.audioProcessBuffer=new U(sampleRate,this),this.isRunning=!0}handleMessage(e){const{status:t,data:s}=e.data;switch(t){case"diableSharedArrayBuffer":W=!1;break;case"disableDecoderinworklet":z=!1;break;case"data":console.info("Dropped audio data before initialized");break;case"stopPlayAudio":this.isPlaying=!1;break;case"stopWorklet":me=!0;break;case"startPlayAudio":this.isPlaying=!0;break;case"StartCaptureAudio":this.isCapturing=!0;break;case"sampleRate":this.sampleRate_=s;break;case"audiowasm":try{initWasm(Module,this.wasmModule)}catch(e){fe.port.postMessage({status:"WASM_INIT_FAILED"}),_workletPrinter.error("init WASM failed, error message:"+e.message+e.stack)}break;case"initData":G=s.userid,X=s.meetingid,$=s.meetingnum;break;case"currentSSRC":q=s;break;case"stop_audio_incoming":this.stopPlayAudio=s;break;case"codecDoAVSync":Q=!0,Z&&j&&Z(j,!0);break;case"checkProcess":{monitorLOG("PCC"+_e);let e=parseInt(1e3*ge/this.sampleRate_);monitorLOG("ADD:"+e),!_e!==Se&&(Se=!_e,fe.port.postMessage({status:"PROCESS_EXCEPTIONS",data:Se})),_e=0,ge=0;break}case"interpretation_set_lang":Module.HEAPU32.subarray(se/4,se/4+ae)[0]=s.lang,te(j,1,se,1);break;case"interpretation_enable":Module.HEAPU32.subarray(se/4,se/4+ae)[0]=s.enable?1:0,te(j,0,se,1);break;case"interpretation_mute_origin":Module.HEAPU32.subarray(se/4,se/4+ae)[0]=s.mute?1:0,te(j,2,se,1);break;case"interpretation_set_interpreter":{let e=Module.HEAPU32.subarray(se/4,se/4+ae),t=se;s.interpreterList.length>=ae&&(t=Module._malloc(4*s.interpreterList.length),e=Module.HEAPU32.subarray(t/4,t/4+s.interpreterList.length));for(let t=0;t<s.interpreterList.length;t++)e[t]=s.interpreterList[t];te(j,3,t,s.interpreterList.length),s.interpreterList.length>=ae&&Module._free(t);break}case"setSpeechVolumeLevel":if(!j)return;re(j,s.userid,s.volume);break;case 131:O.setAllSpeechVolume(s.volume);break;case"USER_NODE_AUDIO_STATUS_LIST":O.updateAllRemoteUserSendStatus(s);break;case 160:ue.audioStatisticsFlag=!!s.enable,r=ue.audioStatisticsFlag,j&&ne(j,r);break;default:W?this.handleMessageForSAB(e):this.handleMessageForNoSAB(e)}var r}handleMessageForSAB(e){const{status:t,data:s}=e.data;switch(t){case"encodeAudioPort":this.audioEncodePort&&this.audioEncodePort.close(),this.audioEncodePort=e.ports[0];break;case"decodeAudioPort":this.audioDecodePort&&this.audioDecodePort.close(),this.audioDecodePort=e.ports[0],this.audioDecodePort.onmessage=function(e){};break;case"decodeVideoPort":this.videoDecodePort&&this.videoDecodePort.close(),this.videoDecodePort=e.ports[0];break;case"close":break;case"sharedBuffer":s&&(this.g_sharedbuffer=s),this.g_sharedbuffer&&(this.encodeSAB=new N(this.g_sharedbuffer.inputState,this.g_sharedbuffer.inputBuffer,128*K,K),this.decodeSAB=new N(this.g_sharedbuffer.outputState,this.g_sharedbuffer.outputBuffer,128*J),this.g_sharedbuffer.echoState&&this.g_sharedbuffer.echoBuffer&&(this.echoSAB=new N(this.g_sharedbuffer.echoState,this.g_sharedbuffer.echoBuffer,128*J,J)),this.rtpSAB=new i(this.g_sharedbuffer.rtpBuffer,1200),this.decodeSAB.onCacheSizeChange=e=>{this.audioDecodePort&&this.audioDecodePort.postMessage({status:3,cacheSize:e,isSAB:!0})});break;default:console.warn("unhanle commands in audioworklet",t)}}handleMessageForNoSAB(e){const{status:t}=e.data;switch(t){case"encodeAudioPort":this.audioProcessBuffer.setEncodePort(e.ports[0]);break;case"decodeAudioPort":this.audioProcessBuffer.setDecodePort(e.ports[0]);break;case"close":this.audioProcessBuffer.close(),this.isPlaying=!1,this.isRunning=!1;break;default:console.warn("unhanle commands in audioworklet",t)}}onReceivedRTP(){}process(e,t,s){if(_e++,me)return!1;try{return W?z?this.SABDecodeProcess(e,t,s):this.SABProcess(e,t,s):this.NoSABprocess(e,t,s)}catch(e){return _workletPrinter.error("::process() exception: "+e.message+e.stack),!0}}NoSABprocess(e,t,s){return!(!this.isRunning||this.isPlaying&&(this.inputDataForNoSAB(e),this.outputDataForNoSAB(t),0))}inputDataForNoSAB(e){if(!e[0]||!e[0][0])return!0;let t=e[0];if(ge+=t[0].length,!be&&e[0].length<K)try{for(let s=e[0].length;!be&&s<K;s++)t.push(t[0])}catch(e){be=!0,_workletPrinter.error("::inputDataForNoSAB() exception: "+e.message+e.stack)}this.audioProcessBuffer.write(t)}outputDataForNoSAB(e){let t=this.audioProcessBuffer.read();if(this.stopPlayAudio)return!0;let s=e[0];if(1===J)for(let e=0;e<s.length;e++)s[e].set(t);else for(let e=0;e<J;e++)for(let r=0;s[e]&&r<s[e].length;r++)s[e][r]=t[r*J+e]}inputData(e){if(!this.encodeSAB)return!0;ge+=e[0].length,this.encodeSAB.write(e),this.audioEncodePort.postMessage({command:2,buffer:!1})}outputDecodeData(e,s){try{ee.hasData()||V&&(sampleRate!=de&&(t().sampleRateLog(de,sampleRate,"","",3),de=sampleRate),V(j,sampleRate/100,0,sampleRate,J))}catch(e){_workletPrinter.error("::outputDecodeData() get_mixed_Audio exception: "+e.message+e.stack)}try{let t=ee.read();if(!t)return;if(1===J)for(let s=0;s<e.length;s++)e[s].set(t);else for(let s=0;s<J;s++)for(let r=0;e[s]&&r<e[s].length;r++)e[s][r]=t[r*J+s];s&&this.echoSAB&&this.echoSAB.write(e)}catch(e){_workletPrinter.error("::outputDecodeData() set outputs exception: "+e.message+e.stack)}}outputData(e){if(!this.decodeSAB)return!0;let t=this.decodeSAB.read();if(null===t||this.stopPlayAudio)return!0;if(1===J)for(let s=0;s<e.length;s++)e[s].set(t);else for(let s=0;s<J;s++)for(let r=0;e[s]&&r<e[s].length;r++)e[s][r]=t[r*J+s]}SABDecodeProcess(e,s,r){try{if(!this.rtpSAB)return t().monitorLOG("SABN"),!0;{let e=this.rtpSAB.available_read();e>100&&(e=100);let t=this.rtpSAB.getReaderPtr(),s=0;for(;s<e;){s++;let e=this.rtpSAB.get(t);t++,j&&ie&&(Module.HEAP8.subarray(ie,ie+oe).set(e),Y(j,0,ie,e.length))}this.rtpSAB.setReaderPtr(t)}}catch(e){_workletPrinter.error("::SABDecodeProcess() audio_decode exception: "+e.message+e.stack)}try{let t=e[0],r=s[0];if(!this.g_sharedbuffer)return!0;if(!this.sampleRate_||!r[0])return!0;let i=t[0]&&this.isCapturing;if(i){if(t.length<K&&!be)try{for(let e=t.length;!be&&e<K;e++)t.push(t[0])}catch(e){be=!0,_workletPrinter.error("::SABDecodeProcess() copy input data exception: "+e.message+e.stack)}this.inputData(t)}return this.outputDecodeData(r,i),!0}catch(e){_workletPrinter.error("::SABDecodeProcess() inputs or outputs exception: "+e.message+e.stack)}return!0}SABProcess(e,t,s){let r=e[0],i=t[0];if(!this.g_sharedbuffer)return!0;if(!this.sampleRate_||!i[0])return!0;if(r[0]&&this.isCapturing){if(!be&&r.length<K)try{for(let e=r.length;!be&&e<K;e++)r.push(r[0])}catch(e){be=!0,_workletPrinter.error("::SABProcess() exception: "+e.message+e.stack)}this.inputData(r)}return this.outputData(i),!0}}var de=0,be=!1,me=!1,_e=0,ge=0,Se=!1;t().LOG_OUT=function(){},t().fsHandler?(t().LOG_OUT_WEBRTC=t().fsHandler.handleFile,t().Get_ExternalRecord=t().fsHandler.handleViperPrint):(t().LOG_OUT_WEBRTC=function(){},t().Get_ExternalRecord=function(){}),t().send_data=function(){},t().monitorLOG=function(e){e&&fe.port.postMessage({status:"MONITOR_LOG",data:e})},t().sampleRateLog=function(e,s,r,i,a){if(!e&&!s)return;let o=null;switch(a){case 1:o="GGDS: ";break;case 2:o="SCAG: ";break;case 3:o="SCIW: "}let n=o+e+"|"+s+"|"+r+"|"+i;t().monitorLOG(n)},t().wcl_trace_log=function(e,s){t().fsHandler&&t().fsHandler.handleAudioSDKUtilPrint(e,s)},t().Viper_NetworkTrace=function(e,t){},registerProcessor("zoomAudioWorklet",pe)})()})();
//# sourceMappingURL=https://d1cdksi819e9z7.cloudfront.net/sourcemap/js_audio_worklet.min.js-811db574c4df5c88ad4d.map