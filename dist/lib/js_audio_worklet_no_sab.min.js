!function(t){var e={};function s(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(i,o,function(e){return t[e]}.bind(null,o));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([,function(t,e){const s=0,i=1,o=2;class r{constructor(){this.buffList=[],this.cacheMinSize=4,this.cacheMaxSize=16,this.cacheSize=this.cacheMinSize,this.onrollbackbuffer=null,this.onneedmoredata=null,this.isReady=!1}push(t){this.isReady=!0,this.buffList.push({buff:t,offset:0})}copy(t,e,s,i){return t.length-e<=s.length-i?(0===e?s.set(t,i):s.set(t.subarray(e),i),t.length-e):(s.set(t.subarray(e,e+s.length-i),i),s.length-i)}increaseCacheSize(){this.isReady&&this.cacheSize++,this.cacheSize>this.cacheMaxSize&&(this.cacheSize=this.cacheMaxSize)}copyTo(t){if(0===this.buffList.length)return t.fill(0),this.increaseCacheSize(),void console.log("buffer count 0, is not enough");let e=this.buffList[0];if(e.buff.length-e.offset>=t.length)this.copy(e.buff,e.offset,t,0),e.offset+=t.length,e.offset===e.buff.length&&(this.buffList.shift(),this.onrollbackbuffer&&this.onrollbackbuffer(e.buff));else{if(this.buffList.length<2)return t.fill(0),console.log("buffer count 1, is not enough"),void this.increaseCacheSize();let s=this.copy(e.buff,e.offset,t,0);this.buffList.shift(),this.onrollbackbuffer&&this.onrollbackbuffer(e.buff),e=this.buffList[0],s=this.copy(e.buff,e.offset,t,s),e.offset+=s}}requestMoreData(){this.buffList.length<this.cacheSize&&this.onneedmoredata&&this.onneedmoredata()}hasData(){return this.buffList.length>=2}}class a{constructor(t){this.buffList=[],this.frameLength=t,this.onframedata=null}copy(t,e,s,i){return t.length-e<=s.length-i?(0===e?s.set(t,i):s.set(t.subarray(e),i),t.length-e):(s.set(t.subarray(e,e+s.length-i),i),s.length-i)}rollbackbuffer(t){this.buffList.push({buff:t,offset:0})}push(t){0===this.buffList.length&&this.buffList.push({buff:new Float32Array(this.frameLength),offset:0});let e=this.buffList[0];if(e.buff.length-e.offset>=t.length){let s=this.copy(t,0,e.buff,e.offset);e.offset+=s,e.buff.length===e.offset&&(this.buffList.shift(),this.onframedata&&this.onframedata(e.buff))}else{let s=this.copy(t,0,e.buff,e.offset);this.buffList.shift(),this.onframedata&&this.onframedata(e.buff),t.length>s&&this.push(t.subarray(s))}}}class f{constructor(t,e){this.context=e,this.decodePort=null,this.encodePort=null,this.captureSize=t/100,this.playBuffer=new r,this.playBuffer.onrollbackbuffer=t=>{this.decodePort},this.playBuffer.onneedmoredata=()=>{this.decodePort&&this.decodePort.postMessage({status:i})},this.quantum=new Float32Array(128),this.captureBuffer=new a(this.captureSize),this.captureBuffer.onframedata=t=>{this.encodePort&&this.encodePort.postMessage({command:o,buffer:t},[t.buffer])}}setDecodePort(t){this.decodePort&&this.decodePort.close(),this.decodePort=t,this.decodePort.onmessage=this.handleDecodeData.bind(this)}setEncodePort(t){this.encodePort&&this.encodePort.close(),this.encodePort=t,this.encodePort.onmessage=this.handleEncodeData.bind(this)}handleDecodeData(t){if(this.context.isPlaying&&this.playBuffer.push(t.data.data),this.isCapturing&&t.data.aec){t.data.aec,t.data.channels,t.data.sampleHz}}handleEncodeData(t){switch(t.data.event){case s:this.captureBuffer.rollbackbuffer(t.data.buffer)}}requestMoreData(){this.playBuffer.requestMoreData()}close(){this.decodePort&&(this.decodePort=null,this.decodePort.close()),this.encodePort&&(this.encodePort=null,this.encodePort.close())}write(t){this.captureBuffer.push(t)}read(){return this.playBuffer.copyTo(this.quantum),this.requestMoreData(),this.quantum}}registerProcessor("zoomAudioWorklet",class extends AudioWorkletProcessor{constructor(){super(),this.port.onmessage=this.handleMessage.bind(this),this.audioProcessBuffer=new f(sampleRate,this),this.isRunning=!0,this.isPlaying=!1,this.isCapturing=!1}handleMessage(t){const{status:e,data:s}=t.data;switch(e){case"encodeAudioPort":this.audioProcessBuffer.setEncodePort(t.ports[0]);break;case"decodeAudioPort":this.audioProcessBuffer.setDecodePort(t.ports[0]);break;case"stopPlayAudio":this.isPlaying=!1;break;case"startPlayAudio":this.isPlaying=!0;break;case"StartCaptureAudio":this.isCapturing=!0;break;case"close":this.audioProcessBuffer.close(),this.isPlaying=!1,this.isRunning=!1;break;default:console.warn("unhanle commands in audioworklet",e)}}inputData(t){if(!t[0]||!t[0][0])return!0;this.audioProcessBuffer.write(t[0][0])}outputData(t){let e=this.audioProcessBuffer.read();for(let s=0;s<t.length;s++)for(let i=0;i<t[s].length;i++)t[s][i].set(e)}process(t,e){return!(!this.isRunning||this.isPlaying&&(this.inputData(t),this.outputData(e),0))}})}]);