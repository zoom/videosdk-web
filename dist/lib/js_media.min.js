!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("disk-file-writer")):"function"==typeof define&&define.amd?define("JsMediaSDK_Instance",["disk-file-writer"],t):"object"==typeof exports?exports.JsMediaSDK_Instance=t(require("disk-file-writer")):e.JsMediaSDK_Instance=t(e["disk-file-writer"])}(window,(function(e){return function(e){function t(t){for(var r,a,n=t[0],o=t[1],s=0,d=[];s<n.length;s++)a=n[s],i[a]&&d.push(i[a][0]),i[a]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r]);for(u&&u(t);d.length;)d.shift()()}var r={},i={0:0};function a(t){if(r[t])return r[t].exports;var i=r[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.e=function(e){var t=[],r=i[e];if(0!==r)if(r)t.push(r[2]);else{var n=new Promise((function(t,a){r=i[e]=[t,a]}));t.push(r[2]=n);var o,s=document.createElement("script");s.charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.src=function(e){return a.p+""+({1:"wmsc-vendors"}[e]||e)+".min.js"}(e);var u=new Error;o=function(t){s.onerror=s.onload=null,clearTimeout(d);var r=i[e];if(0!==r){if(r){var a=t&&("load"===t.type?"missing":t.type),n=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+a+": "+n+")",u.type=a,u.request=n,r[1](u)}i[e]=void 0}};var d=setTimeout((function(){o({type:"timeout",target:s})}),12e4);s.onerror=s.onload=o,document.head.appendChild(s)}return Promise.all(t)},a.m=e,a.c=r,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(r,i,function(t){return e[t]}.bind(null,i));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a.oe=function(e){throw console.error(e),e};var n=window.webpackJsonpJsMediaSDK_Instance=window.webpackJsonpJsMediaSDK_Instance||[],o=n.push.bind(n);n.push=t,n=n.slice();for(var s=0;s<n.length;s++)t(n[s]);var u=o;return a(a.s=56)}([function(e,t,r){"use strict";r.r(t);var i=r(21),a=r(9),n=r(3),o=r(23),s=r.n(o),u=r(26),d=r.n(u),c=r(20),l=r.n(c),h=r(12),f=r.n(h),p=r(13),v=r.n(p),m=r(22);function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=l()(e);if(t){var a=l()(this).constructor;r=Reflect.construct(i,arguments,a)}else r=i.apply(this,arguments);return d()(this,r)}}var _=Object(m.a)("sdk.init"),S=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";f()(this,e),this.name=r,this.handler=null,this.wasm=null,this.socket=null,this.defered=new n.Deferred,this.initSuccessPromise=this.defered.promise,this.wasmDefered=new n.Deferred,this.wasmSuccessPromise=this.wasmDefered.promise,this.handlerDefered=new n.Deferred,this.handlerSuccessPromise=this.handlerDefered.promise,this.socketDefered=new n.Deferred,this.socketSuccessPromise=this.socketDefered.promise,Promise.all([this.wasmSuccessPromise,this.handlerSuccessPromise,this.socketSuccessPromise]).then((function(e){var r=e.every((function(e){return!0===e}));t.defered.resolve(r),r||_.error(t.name,{handler:t.handler,wasm:t.wasm,socket:t.socket})}))}return v()(e,[{key:"setHanderSuccess",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.handler=e,this.handlerDefered.resolve(e)}},{key:"setWasmSuccess",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.wasm=e,this.wasmDefered.resolve(e)}},{key:"setSocketSuccess",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.socket=e,this.socketDefered.resolve(e)}},{key:"checkInitSuccess",value:function(){var e=this.handler&&this.wasm&&this.socket;return e&&this.defered.resolve(!0),e}},{key:"isSocketInitSuccess",value:function(){return this.socket}},{key:"waitforInitSuccess",value:function(){return this.initSuccessPromise}},{key:"resetHandleDeferred",value:function(){this.setHanderSuccess(!0),this.handlerDefered=new n.Deferred,this.handlerSuccessPromise=this.handlerDefered.promise}}]),e}(),E=function(e){s()(r,e);var t=g(r);function r(e){return f()(this,r),t.call(this,e)}return v()(r)}(S),b=function(e){s()(r,e);var t=g(r);function r(e){return f()(this,r),t.call(this,e)}return v()(r)}(S),y=function(e){s()(r,e);var t=g(r);function r(e){return f()(this,r),t.call(this,e)}return v()(r)}(S),C=r(5),A=Object(m.a)("sdk.variables");function R(){this.crashCount=0,this.crashLastTime=0,this.AEW=null,this.ADW=null,this.AEWF=null,this.ADWF=null,this.VE=null,this.VD=null,this.SE=null,this.SD=null,this.extVBPort=null,this.frameSent=0,this.frameReceived=0}R.prototype.initDB=function(){var e,t={},r=this;t.init=function(i){if(this.db_name=i.db_name,this.db_version=i.db_version,this.db_store_name=i.db_store_name,indexedDB){try{e=indexedDB.open(this.db_name,this.db_version)}catch(e){return a.default.error("Error opening IndexedDB",e),void(r.indexDbObject=null)}e.onerror=function(e){r.indexDbObject=null},e.onupgradeneeded=function(e){this.db=e.target.result,this.db.createObjectStore(t.db_store_name)},e.onsuccess=function(e){t.db=e.target.result,r.openIndexFlag=!0,r.indexDbObject.select("delay")}}else r.indexDbObject=null},t.put=function(e,r){try{var i=t.db.transaction(t.db_store_name,"readwrite").objectStore(t.db_store_name).put(e,r);i.onsuccess=function(){},i.onerror=function(e){a.default.error("Set Delay failed!",e)}}catch(e){a.default.error("IndexDb put Failed!",e)}},t.delete=function(r){(e=t.db.transaction(t.db_store_name,"readwrite").objectStore(t.db_store_name).delete(r)).onsuccess=function(){A("Delete the key:"+r)}},t.select=function(e){try{var i=t.db.transaction(t.db_store_name,"readwrite").objectStore(t.db_store_name);if(e)var n=i.get(e);else n=i.getAll();n.onsuccess=function(){r.audioDelay=n.result},n.onerror=function(){r.audioDelay=0}}catch(e){a.default.error("IndexDb Select Failed",e)}},t.clear=function(){t.db.transaction(t.db_store_name,"readwrite").objectStore(t.db_store_name).clear().onsuccess=function(){A("Clear the IndexDb Successfully")}},t.close=function(){t.db&&t.db.close()},this.indexDbObject=t,this.indexDbObject.init({db_name:"AEC",db_version:1,db_store_name:"delay"})},R.prototype.Notify_APPUI_SAFE=function(e){for(var t=this,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];if("number"==typeof e||"string"==typeof e)i=arguments;else if(e!==this.instance)return;this._Notify_APPUI&&(A("Notify_APPUI_SAFE",i),this._Notify_APPUI.apply(this,i),this._callbackList.forEach((function(e){return e.apply(t,i)})))},R.prototype.Notify_APPUI=R.prototype.Notify_APPUI_SAFE,R.prototype.queueMessageToRwg=function(e,t){this.rwgMessageList.push({jsEvent:e,message:t})},R.prototype.clearMessageToRwg=function(){var e=this;this.rwgConnectSuccess=!0,this.rwgMessageList.length>0&&(this.rwgAgent||this._Notify_APPUI)&&(this.rwgMessageList.forEach((function(t){var r=t.jsEvent,i=t.message;e.sendMessageToRwg(r,i,!1,!1)})),this.rwgMessageList=[])},R.prototype.destroyQueueMessageToRwg=function(){this.rwgConnectSuccess=!1,this.rwgMessageList=[]},R.prototype.sendMessageToRwg=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(this.rwgConnectSuccess&&(this.rwgAgent||this._Notify_APPUI)||!r){this.rwgConnectSuccess&&i&&this.clearMessageToRwg();try{this.rwgAgent?this.rwgAgent.sendMessageToRwg(t):this.Notify_APPUI_SAFE(e,t)}catch(e){a.default.error("Error sending message to RWG",e)}}else this.queueMessageToRwg(e,t)},R.prototype.reinit=function(e){this.instance=e,this.SPECIAL_ID=0,this._callbackList=[],this._Notify_APPUI=null,this.localAudioDecMGR=null,this.localVideoDecMGR=null,this.localAudioEncMGR=null,this.localVideoEncMGR=null,this.localSharingDecMGR=null,this.localMouseDecMGR=null,this.localSharingEncMGR=null,this.localAudioPara=null,this.localVideoPara={},this.localSharingPara=null,this.Audio_WebSocket_Ip_Address=null,this.Audio_Web_Transport_Ip_Address=null,this.Video_WebSocket_Ip_Address=null,this.Video_Web_Transport_Ip_Address=null,this.Sharing_WebSocket_Ip_Address=null,this.mediaSDKHandle=null,this.audio_pcm_queue=new i.a,this.int16Array=null,this.isInitialFailed=!1,this.isAudioEncodeWASMOK=!1,this.isAudioDecodeWASMOK=!1,this.isVideoEncodeWASMOK=!1,this.isVideoDecodeWASMOK=!1,this.isSharingDecodeWASMOK=!1,this.isSharingEncodeWASMOK=!1,this.audioEncWorkerPath="",this.audioDecWorkerPath="",this.videoDecWorkerPath="",this.videoEncWorkerPath="",this.sharingDecWorkerPath="",this.sharingEncWorkerPath="",this.isAudioEncodePostStart=!1,this.isAudioDecodePostStart=!1,this.isVideoDecodePostStart=!1,this.isVideoEncodePostStart=!1,this.isSharingDecodePostStart=!1,this.isSharingEncodePostStart=!1,this.isAudioEncodeThreadStart=!1,this.isAudioDecodeThreadStart=!1,this.isVideoDecodeThreadStart=!1,this.isSharingDecodeThreadStart=!1,this.isVideoEncodeThreadStart=!1,this.isSharingEncodeThreadStart=!1,this.isAudioPlayWork=!1,this.isVideoPlayWork=!1,this.isSharingPlayWork=!1,this.shareBufferSampleNumb=30,this.audioWasmInfo=null,this.initialSuccessNumb=0,this.TotalWaitEvent=0,this.audioPostInterval=null,this.sharedBuffer=null,this.decoderinworklet=null,this.decoderinworkletOP=null,this.chromeWideAEC=null,this.shareSystemAudio=!1,this.indexDbObject=null,this.audioDelay=0,this.openIndexFlag=!1,this.audioBufferSize=n.default.browser.isFirefox?30:15,this.monitorEncodeVideo=null,this.monitorDecodeVideo=null,this.monitorEncodeSharing=null,this.monitorDecodeSharing=null,this.monitorEncodeAudio=null,this.monitorDecodeAudio=null,this.monitorVideoCapture=null,this.monitorVideoReadyCaptureWidth=0,this.monitorVideoReadyCaptureHeight=0,this.monitorIntervalHandle=null,this.monitorVideoUserID=null,this.monitorSharingUserID=null,this.monitorSharingEncodeAPPInfo=null,this.monitorVideoDecodeAPPInfo=null,this.monitorVideoEncodeAPPInfo=null,this.monitorCid=null,this.e2eencrypt=!1,this.AudioNode=null,this.SharingAudioNode=null,this.CurrentSSRC=0,this.CurrentSSRCTime=0,this.audioPlayTime=0,this.videoDecResponseText=null,this.videoEncResponseText=null,this.sharingDecodeResponse=null,this.sharingEncodeResponse=null,this.sharingDecInitInstance=new E(C.f.SHARING_DECODE),this.sharingEncInitInstance=new E(C.f.SHARING_ENCODE),this.videoDecInitInstance=new b(C.f.VIDEO_DECODE),this.videoInitInstance=new b(C.f.VIDEO_ENCODE),this.audioDecInitInstance=new y(C.f.AUDIO_DECODE),this.audioEncodeInitInstance=new y(C.f.AUDIO_ENCODE),this.audioDecodeResponse=null,this.audioEncodeResponse=null,this.ivObj={},this.userNodeList=[],this.rwgAgent=null,this.ComputerAudioStatus=C.a.ComputerAudio_Null,this.DesktopAudioStatus=C.a.DesktopAudio_Null,this.initDB(),this.resourceManager=null,this.vbarraybuffer=null,this.vbbin=null,this.vbjson=null,this.tfjsurl=null,this.afnbin=null,this.afnjson=null,this.basebin=null,this.basejson=null,this.interpretationMessage=new i.a,this.workletWasmInitSuccess=!1,this.videoEncodeInitSuccess=null,this.vbPreloadSuccess=null,this.enableAduioBridge=!1,this.audioMode=-1,this.enableEchoDetection=0,this.isPreviewMode={audioEncode:!1,audioDecode:!1,videoEncode:!1,videoDecode:!1},this.rwgConnectSuccess=!1,this.rwgMessageList=[],this.localSsrc=0,this.frameSent=0,this.frameReceived=0};var I=new R;t.default=I},function(e,t,r){var i=r(99),a=r(48);e.exports=function(e,t){var r=a(e,t,"get");return i(e,r)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";r.r(t),r.d(t,"START_MEDIA",(function(){return i})),r.d(t,"ADD_RENDER_VIDEO",(function(){return a})),r.d(t,"STOP_RENDER_VIDEO",(function(){return n})),r.d(t,"START_CAPTURE_VIDEO",(function(){return o})),r.d(t,"STOP_CAPTURE_VIDEO",(function(){return s})),r.d(t,"ADD_RENDER_AUDIO",(function(){return u})),r.d(t,"STOP_RENDER_AUDIO",(function(){return d})),r.d(t,"UNMUTE_AUDIO",(function(){return c})),r.d(t,"MUTE_AUDIO",(function(){return l})),r.d(t,"CHANGE_FRAME_RATE",(function(){return h})),r.d(t,"CHANGE_VIDEO_RESOLUTION",(function(){return f})),r.d(t,"CHANGE_AUDIO_SPEAKER",(function(){return p})),r.d(t,"CHANGE_VIDEO_CAPTURE_DEVICE",(function(){return v})),r.d(t,"CHANGE_CURRENT_ACTIVE_SSRC",(function(){return m})),r.d(t,"REMOVE_AUDIO_CAPTURE",(function(){return g})),r.d(t,"LEAVE_MEETING",(function(){return _})),r.d(t,"MEETING_FAIL_OVER",(function(){return S})),r.d(t,"END_MEDIA",(function(){return E})),r.d(t,"CHANGE_AUDIO_MIC",(function(){return b})),r.d(t,"WEBRTC_RESTART",(function(){return y})),r.d(t,"REMOVE_RENDER_AUDIO",(function(){return C})),r.d(t,"LEAVE_COMPUTER_AUDIO",(function(){return A})),r.d(t,"JOIN_COMPUTER_AUDIO",(function(){return R})),r.d(t,"START_SHARING",(function(){return I})),r.d(t,"STOP_SHARING",(function(){return w})),r.d(t,"SWITCH_CANVAS_FOR_VIDEO_CAPTURE",(function(){return T})),r.d(t,"START_REMOTE_CONTROL",(function(){return k})),r.d(t,"UPDATE_REMOTE_CONTROL_PROPERTIES",(function(){return D})),r.d(t,"CANCEL_REMOTE_CONTROL",(function(){return O})),r.d(t,"UPDATE_SUBSCRIBE_VIDEO",(function(){return M})),r.d(t,"START_DESKTOP_SHARING",(function(){return x})),r.d(t,"START_SHARING_WHITEBOARD",(function(){return P})),r.d(t,"STOP_DESKTOP_SHARING",(function(){return N})),r.d(t,"STOP_SHARING_WHITEBOARD",(function(){return V})),r.d(t,"PAUSE_DESKTOP_SHARING",(function(){return U})),r.d(t,"RESUME_DESKTOP_SHARING",(function(){return L})),r.d(t,"CHECK_CHROME_SHARING_EXTENSION",(function(){return W})),r.d(t,"SWITCH_CANVAS_FOR_SHARING_CAPTURE",(function(){return B})),r.d(t,"CHANGE_CURRENT_SHARING_ACTIVE_SSRC",(function(){return G})),r.d(t,"COMMAND_SOCKET_MESSAGE_NOTIFY",(function(){return F})),r.d(t,"RESEND_REMOTE_CONTROL_POSITION_PDU",(function(){return H})),r.d(t,"AES_GCM_IV_VALUE",(function(){return j})),r.d(t,"USER_NODE_LIST",(function(){return K})),r.d(t,"UPDATE_SHARING_DECODE_PARAM",(function(){return q})),r.d(t,"PAUSE_OR_RESUME_AUDIO_DECODE",(function(){return X})),r.d(t,"UPDATE_CANVAS_SIZE",(function(){return Y})),r.d(t,"CLEAR_CANVAS",(function(){return z})),r.d(t,"ZOOM_RENDER",(function(){return Q})),r.d(t,"CHANGE_SHARING_2ND_VIDEO_CAPTUREVIDEO_DEVICE",(function(){return J})),r.d(t,"SET_OTHER_AUDIO_VOLUME_LEVEL",(function(){return Z})),r.d(t,"USER_NODE_AUDIO_STATUS_LIST",(function(){return $})),r.d(t,"UPDATE_MASK_CANVAS_SIZE",(function(){return ee})),r.d(t,"MOVE_PTZ_CAMERA",(function(){return te})),r.d(t,"START_STOP_REMOTE_CONTROL_CHECK",(function(){return re})),r.d(t,"SEND_REMOTE_CONTROL_QR_CODE",(function(){return ie})),r.d(t,"AUDIO_CC_SELECT_LANGUAGE",(function(){return ae})),r.d(t,"AUIOD_INTERPRETATION_MUTE",(function(){return ne})),r.d(t,"AUDIO_INTERPRETATION_SELECT_LANGUAGE",(function(){return oe})),r.d(t,"AUDIO_INTERPRETATION_LIST_INFO",(function(){return se})),r.d(t,"AUDIO_INTERPRETATION_ENABLE",(function(){return ue})),r.d(t,"VIDEO_MASK_SETTING",(function(){return de})),r.d(t,"UPDATE_BG_IMAGE",(function(){return ce})),r.d(t,"UPDATE_MASK_INFO",(function(){return le})),r.d(t,"FINISH_MASK_SETTING",(function(){return he})),r.d(t,"START_VIDEO_STREAM_IN_MASK_SETTING_SUCCESS",(function(){return fe})),r.d(t,"VIDEO_ENABLE_DECODE_HW",(function(){return pe})),r.d(t,"VIDEO_ENABLE_ENCODE_HW",(function(){return ve})),r.d(t,"JOIN_DESKTOP_AUDIO",(function(){return me})),r.d(t,"LEAVE_DESKTOP_AUDIO",(function(){return ge})),r.d(t,"SET_DESKTOP_VOLUME",(function(){return _e})),r.d(t,"MIRROR_MY_VIDEO",(function(){return Se})),r.d(t,"REMOVE_EXPIRED_CANVAS",(function(){return Ee})),r.d(t,"WEBGL_LOST_REPLACE_CANVAS",(function(){return be})),r.d(t,"UPDATE_VIDEO_QUALITY",(function(){return ye})),r.d(t,"SEND_RENDER_LOG",(function(){return Ce})),r.d(t,"USER_NODE_LIST_IN_MAIN_SESSION",(function(){return Ae})),r.d(t,"UPDATE_MEDIA_PARAMS",(function(){return Re})),r.d(t,"SHARING_ADD_REV_CHANNEL_TYPE",(function(){return Ie})),r.d(t,"SHARING_REMOVE_REV_CHANNEL_TYPE",(function(){return we})),r.d(t,"BUILD_MS_CHANNEL_IN_BO",(function(){return Te})),r.d(t,"BUILD_MA_CHANNEL_IN_BO",(function(){return ke})),r.d(t,"ENABLE_SHARE_TO_BO",(function(){return De})),r.d(t,"ENABLE_BROADCAST_TO_BO",(function(){return Oe})),r.d(t,"SWITCH_WATER_MARK_FLAG",(function(){return Me})),r.d(t,"START_VIDEO_VB_SETTING",(function(){return xe})),r.d(t,"UPDATE_VIDEO_VB_BG_IMAGE",(function(){return Pe})),r.d(t,"STOP_VIDEO_VB_SETTING",(function(){return Ne})),r.d(t,"START_VIDEO_STREAM_IN_VB_SETTING_SUCCESS",(function(){return Ve})),r.d(t,"SWITCH_MASK_AND_VB",(function(){return Ue})),r.d(t,"VB_MODEL_PRELOADING_3S",(function(){return Le})),r.d(t,"VB_MODEL_PRELOADING_10S",(function(){return We})),r.d(t,"VB_MODEL_PRELOADING_OK",(function(){return Be})),r.d(t,"ENABLE_VIDEO_OBSERVER",(function(){return Ge})),r.d(t,"SWITCH_SHARING_TYPE",(function(){return Fe})),r.d(t,"CHANGE_HID_ENABLE",(function(){return He})),r.d(t,"NEW_ACTIVE_SPEAKER_SSRC",(function(){return je})),r.d(t,"NEW_ACTIVE_SPEAKER_FIRST_FRAME_CALLBACK",(function(){return Ke})),r.d(t,"CANCEL_NEW_ACTIVE_SPEAKER_BEFORE_CALL_BACK",(function(){return qe})),r.d(t,"NOTIFY_SDK_JOIN_RWG_SUCCESS",(function(){return Xe})),r.d(t,"AUDIO_BRIDGE_FIRST_RECV_DATA",(function(){return Ye})),r.d(t,"AUDIO_BRIDGE_CAN_SEND_DATA",(function(){return ze})),r.d(t,"FIRST_VIDEO_FRAME",(function(){return Qe})),r.d(t,"PREVIEW_INIT_VIDEO_DECODE_SUCCESS",(function(){return Je})),r.d(t,"PREVIEW_INIT_AUDIO_DECODE_SUCCESS",(function(){return Ze})),r.d(t,"WHITEBOARD_JOIN_MESSAGE",(function(){return $e})),r.d(t,"AUDIO_DENOISE_SWITCH",(function(){return et})),r.d(t,"SET_CODEC_MODE",(function(){return tt})),r.d(t,"STOP_AUDIO_INCOMING",(function(){return rt})),r.d(t,"MOBILE_ROTATE",(function(){return it})),r.d(t,"SAVE_LOCAL_LOG",(function(){return at})),r.d(t,"CHANGE_AUDIO_PROFILE",(function(){return nt})),r.d(t,"AUDIO_JOIN_SUCCESS",(function(){return ot})),r.d(t,"SHARE_2ND_AUDIO_CAPTURE_DEVICE",(function(){return st})),r.d(t,"ON_HOLD",(function(){return ut})),r.d(t,"Audio_Dec_WASM_OK",(function(){return dt})),r.d(t,"Audio_Dec_Handle_OK",(function(){return ct})),r.d(t,"Audio_Dec_WebSocket_OK",(function(){return lt})),r.d(t,"Audio_Enc_WASM_OK",(function(){return ht})),r.d(t,"Audio_Enc_Handle_OK",(function(){return ft})),r.d(t,"Video_Dec_WASM_OK",(function(){return pt})),r.d(t,"Video_Dec_Handle_OK",(function(){return vt})),r.d(t,"Video_Dec_WebSocket_OK",(function(){return mt})),r.d(t,"Video_Enc_WASM_OK",(function(){return gt})),r.d(t,"Video_Enc_Handle_OK",(function(){return _t})),r.d(t,"Sharing_Dec_WASM_OK",(function(){return St})),r.d(t,"Sharing_Dec_PICTURE",(function(){return Et})),r.d(t,"AUDIO_DELAY",(function(){return bt})),r.d(t,"Sharing_Dec_WebSocket_OK",(function(){return yt})),r.d(t,"Sharing_Handle_OK",(function(){return Ct})),r.d(t,"Sharing_Data",(function(){return At})),r.d(t,"DECODE_MESSAGE",(function(){return Rt})),r.d(t,"Video_Enc_WebSocket_OK",(function(){return It})),r.d(t,"Video_Capture_Tick",(function(){return wt})),r.d(t,"MONITOR_MESSAGE",(function(){return Tt})),r.d(t,"SHARING_DECODE_MONITOR_MESSAGE",(function(){return kt})),r.d(t,"WORKER_MAIN_VIDEO_ENCODE_RINGBUFFER_TICK",(function(){return Dt})),r.d(t,"WORKER_MAIN_AUDIO_ENCODE_RINGBUFFER_TICK",(function(){return Ot})),r.d(t,"WORKER_MAIN_VIDEO_DECODE_RINGBUFFER_TICK",(function(){return Mt})),r.d(t,"Audio_Encode_Preview_OK",(function(){return xt})),r.d(t,"Video_Encode_Preview_OK",(function(){return Pt})),r.d(t,"DOWNLOAD_WASM_FROM_MAIN_THREAD",(function(){return Nt})),r.d(t,"APP_TROUBLESHOOTING_INFO",(function(){return Vt})),r.d(t,"DELTA_D",(function(){return Ut})),r.d(t,"DELTA_C",(function(){return Lt})),r.d(t,"DELTA_S",(function(){return Wt})),r.d(t,"WCL_TROUBLESHOOTING_INFO",(function(){return Bt})),r.d(t,"SHARING_DATA_VIDEO_MODE",(function(){return Gt})),r.d(t,"MOUSE_DATA_VIDEO_MODE",(function(){return Ft})),r.d(t,"SHARING_DECODE_MESSAGE",(function(){return Ht})),r.d(t,"VIDEO_ENCODED_DATA",(function(){return jt})),r.d(t,"VIDEO_DROP_RATIO_FROM_WCL",(function(){return Kt})),r.d(t,"VIDEO_DATA_DROP_RATIO",(function(){return qt})),r.d(t,"AUDIO_ENCODED_DATA",(function(){return Xt})),r.d(t,"THREAD_ENCODE_BUFFER",(function(){return Yt})),r.d(t,"WASMPTR",(function(){return zt})),r.d(t,"AUDIO_MONITOR_LOG",(function(){return Qt})),r.d(t,"AUDIO_PREVIEW_ASN",(function(){return Jt})),r.d(t,"VIDEO_RESOLUTION_UPDATE",(function(){return Zt})),r.d(t,"VIDEO_RENDER_MONITOR_LOG",(function(){return $t})),r.d(t,"Sharing_Width_And_Height_Info",(function(){return er})),r.d(t,"SHARING_RENDER_MONITOR_LOG",(function(){return tr})),r.d(t,"SHARING_GET_IMAGE_DATA_WRONG",(function(){return rr})),r.d(t,"AES_GCM_IV_TO_WASM",(function(){return ir})),r.d(t,"AES_GCM_IV_CALLBACK_FROM_WASM",(function(){return ar})),r.d(t,"CURRENT_SSRC_TIME",(function(){return nr})),r.d(t,"HARDWARE_VIDEO_INFO_LOG",(function(){return or})),r.d(t,"WhiteBoard_Video_Capture_Tick",(function(){return sr})),r.d(t,"Video_Sharing_Handle_OK",(function(){return ur})),r.d(t,"Audio_Dec_WASM_FAILED",(function(){return dr})),r.d(t,"Audio_Dec_Handle_FAILED",(function(){return cr})),r.d(t,"Audio_Dec_WebSocket_FAILED",(function(){return lr})),r.d(t,"Audio_Enc_WASM_FAILED",(function(){return hr})),r.d(t,"Audio_Enc_Handle_FAILED",(function(){return fr})),r.d(t,"Video_Dec_WASM_FAILED",(function(){return pr})),r.d(t,"Video_Dec_Handle_FAILED",(function(){return vr})),r.d(t,"Video_Dec_WebSocket_FAILED",(function(){return mr})),r.d(t,"Video_Enc_WASM_FAILED",(function(){return gr})),r.d(t,"Video_Enc_Handle_FAILED",(function(){return _r})),r.d(t,"Sharing_Dec_WASM_FAILED",(function(){return Sr})),r.d(t,"Audio_Mute",(function(){return Er})),r.d(t,"Sharing_Handle_FAILED",(function(){return br})),r.d(t,"Sharing_Dec_WebSocket_FAILED",(function(){return yr})),r.d(t,"Video_Enc_WebSocket_FAILED",(function(){return Cr})),r.d(t,"MULTIVIEW_WEBGL_CONTEXT_LOST",(function(){return Ar})),r.d(t,"WEBGL_CONTEXT_CREATE_FAILED",(function(){return Rr})),r.d(t,"Video_Sharing_Handle_FAILED",(function(){return Ir})),r.d(t,"MEDIA_HEALTH_CHECK_FAILED",(function(){return wr})),r.d(t,"INIT_SUCCESS",(function(){return Tr})),r.d(t,"INIT_SUCCESS_VIDEO",(function(){return kr})),r.d(t,"INIT_SUCCESS_AUDIO",(function(){return Dr})),r.d(t,"INIT_SUCCESS_SHARING",(function(){return Or})),r.d(t,"USER_GRANT_CAPTURE_AUDIO",(function(){return Mr})),r.d(t,"CURRENT_VIDEO_RESOLUTION",(function(){return xr})),r.d(t,"SHARING_DEC_THREAD_OK",(function(){return Pr})),r.d(t,"SHARING_DATA",(function(){return Nr})),r.d(t,"SHARING_PARA",(function(){return Vr})),r.d(t,"SHARING_MORE_INFO",(function(){return Ur})),r.d(t,"VIDEO_DECODE_MAX_SIZE",(function(){return Lr})),r.d(t,"CURRENT_CAPTURE_VIDEO_WIDTH_HEIGHT",(function(){return Wr})),r.d(t,"START_VIDEO_CAPTURE_SUCCESS",(function(){return Br})),r.d(t,"STOP_VIDEO_CAPTURE_SUCCESS",(function(){return Gr})),r.d(t,"START_REMOTE_CONTROL_SUCCESS",(function(){return Fr})),r.d(t,"CANCEL_REMOTE_CONTROL_SUCCESS",(function(){return Hr})),r.d(t,"REMOTE_CONTROL_COPIED_TEXT_NOTIFY",(function(){return jr})),r.d(t,"MONITOR_LOG",(function(){return Kr})),r.d(t,"CURRENT_DESKTOP_SHARING_WIDTH_HEIGHT",(function(){return qr})),r.d(t,"DESKTOP_SHARING_CAPTURE_SUCCESS",(function(){return Xr})),r.d(t,"CHECK_CHROME_SHARING_EXTENSION_RESPONSE",(function(){return Yr})),r.d(t,"SHARING_DECODE_MAX_SIZE",(function(){return zr})),r.d(t,"REQUEST_AUDIO_BRIDGE_TOKEN",(function(){return Qr})),r.d(t,"SEND_MESSAGE_TO_RWG",(function(){return Jr})),r.d(t,"AES_GCM_IV_RESPONSE",(function(){return Zr})),r.d(t,"WCL_SIP_CREATE_SUCCESS",(function(){return $r})),r.d(t,"SHARING_DESKTOP_STREAM_HAVE_AUDIO",(function(){return ei})),r.d(t,"JOIN_COMPUTER_AUDIO_COMPLETE",(function(){return ti})),r.d(t,"JOIN_DESKTOP_AUDIO_COMPLETE",(function(){return ri})),r.d(t,"LEAVE_COMPUTER_AUDIO_COMPLETE",(function(){return ii})),r.d(t,"LEAVE_DESKTOP_AUDIO_COMPLETE",(function(){return ai})),r.d(t,"HID_STATUS_MUTE",(function(){return ni})),r.d(t,"HID_STATUS_OFF_HOOK",(function(){return oi})),r.d(t,"WB_MESSAGE",(function(){return si})),r.d(t,"AUDIO_STREAM_FAILED",(function(){return ui})),r.d(t,"VIDEO_STREAM_FAILED",(function(){return di})),r.d(t,"AUDIO_SPEAKER_SET_SUCCESS",(function(){return ci})),r.d(t,"FIRST_IOS_FRAME",(function(){return li})),r.d(t,"AUDIOBRIDGE_EBABLE_SHARE_TO_BO_SUCCESS",(function(){return hi})),r.d(t,"AUDIOBRIDGE_SET_CC_LANG_SUCCESS",(function(){return fi})),r.d(t,"AUDIOBRIDGE_ENABLE_BROADCAST_TO_BO_SUCCESS",(function(){return pi})),r.d(t,"AUDIO_LEVEL_INDICATOR",(function(){return vi})),r.d(t,"SYNC_RENDERER_TYPE_RESPONSE",(function(){return mi})),r.d(t,"INIT_FAILED",(function(){return gi})),r.d(t,"INIT_FAILED_VIDEO",(function(){return _i})),r.d(t,"INIT_FAILED_AUDIO",(function(){return Si})),r.d(t,"INIT_FAILED_SHARING",(function(){return Ei})),r.d(t,"USER_FORBIDDED_CAPTURE_AUDIO",(function(){return bi})),r.d(t,"AUDIO_WEBSOCKET_BROKEN",(function(){return yi})),r.d(t,"VIDEO_WEBSOCKET_BROKEN",(function(){return Ci})),r.d(t,"SHARING_DEC_THREAD_FAILED",(function(){return Ai})),r.d(t,"AUDIO_ZERO_DATA",(function(){return Ri})),r.d(t,"AUDIO_CTX_SAMPLERATE",(function(){return Ii})),r.d(t,"USER_FORBIDDED_CAPTURE_VIDEO",(function(){return wi})),r.d(t,"USER_CAMERA_IS_TAKEN_BY_OTHER_PROGRAMS",(function(){return Ti})),r.d(t,"STOP_VIDEO_CAPTURE_FAILED",(function(){return ki})),r.d(t,"START_REMOTE_CONTROL_FAILED",(function(){return Di})),r.d(t,"CANCEL_REMOTE_CONTROL_FAILED",(function(){return Oi})),r.d(t,"REMOTE_CONTROL_PASTE_TEXT_LENGTH_OVERFLOW",(function(){return Mi})),r.d(t,"USER_STOP_DESKTOP_SHARING",(function(){return xi})),r.d(t,"USER_CANCEL_PERMISSION_REQUEST",(function(){return Pi})),r.d(t,"DESKTOP_SHARING_CHROME_EXTENSION_UNINSTALLED",(function(){return Ni})),r.d(t,"DESKTOP_SHARING_PERMISSION_DENIED",(function(){return Vi})),r.d(t,"DESKTOP_SHARING_TIME_OUT",(function(){return Ui})),r.d(t,"DESKTOP_SHARING_ERROR",(function(){return Li})),r.d(t,"AUDIO_SPEAKER_SET_ERROR",(function(){return Wi})),r.d(t,"DESKTOP_SHARING_SYSTEM_ERROR",(function(){return Bi})),r.d(t,"AUDIO_CLIPPING",(function(){return Gi})),r.d(t,"AUDIO_AUTO_PLAY_FAILED",(function(){return Fi})),r.d(t,"WCL_SIP_HUNGUP_FAILED",(function(){return Hi})),r.d(t,"WCL_SIP_WEBSOCKET_DISCONNECTED",(function(){return ji})),r.d(t,"WCL_SIP_WEBSOCKET_CONNECT_ERROR",(function(){return Ki})),r.d(t,"SHARING_DESKTOP_STREAM_HAVE_NO_AUDIO",(function(){return qi})),r.d(t,"WCL_AUDIO_BRIDGE_RECONNECT_START",(function(){return Xi})),r.d(t,"WCL_AUDIO_BRIDGE_RECONNECT_END",(function(){return Yi})),r.d(t,"WCL_SIP_REJECT_INVITE",(function(){return zi})),r.d(t,"WEBGL_LOST_IN_MULTI_VIEW",(function(){return Qi})),r.d(t,"MASK_SETTING_PARA_ERROR",(function(){return Ji})),r.d(t,"VIDEO_VB_SETTING_PARA_ERROR",(function(){return Zi})),r.d(t,"NOTIFY_UI_FAILOVER",(function(){return $i})),r.d(t,"RECOVER_WEBRTC_AUDIO",(function(){return ea})),r.d(t,"AUDIO_CONNECT_HID_JOIN_FAILED",(function(){return ta})),r.d(t,"JOIN_COMPUTER_AUDIO_FAILURE",(function(){return ra})),r.d(t,"AUDIOBRIDGE_EBABLE_BROADCAST_TO_BO_FAILURE",(function(){return ia})),r.d(t,"AUDIOBRIDGE_SET_CC_LANG_FAILURE",(function(){return aa})),r.d(t,"AUDIOBRIDGE_EBABLE_SHARE_TO_BO_FAILURE",(function(){return na})),r.d(t,"AUDIO_MIC_SET_ERROR",(function(){return oa})),r.d(t,"NOTIFY_UI_WMSC_FAILOVER",(function(){return sa})),r.d(t,"NOTIFY_UI_WMSC_WSS_DISCONNECTED",(function(){return ua})),r.d(t,"AUDIO_STOP",(function(){return da})),r.d(t,"AUDIO_START",(function(){return ca})),r.d(t,"AUDIO_REMOVE",(function(){return la})),r.d(t,"AUDIO_ILLEGAL",(function(){return ha})),r.d(t,"SHARING_PARAM_INFO_FROM_SOCKET",(function(){return fa})),r.d(t,"VIDEO_DATA_FROM_WORKER",(function(){return pa})),r.d(t,"AUDIO_DATA_FROM_WORKER",(function(){return va})),r.d(t,"VIDEO_ENCODE_DATA_FROM_WORKER",(function(){return ma})),r.d(t,"ZOOM_CONNECTION_VIDEO_OFFER_EVT",(function(){return ga})),r.d(t,"ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT",(function(){return _a})),r.d(t,"ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT",(function(){return Sa})),r.d(t,"ZOOM_CONNECTION_REMOVE_UDP_EVT",(function(){return Ea})),r.d(t,"EVT_TYPE_WS_VIDEO_DATACHANNEL_ANSWER",(function(){return ba})),r.d(t,"WS_CONF_AB_TOKEN_REQ",(function(){return ya})),r.d(t,"WS_CONF_AB_TOKEN_RES",(function(){return Ca})),r.d(t,"WS_CONF_END_INDICATION",(function(){return Aa})),r.d(t,"WS_VIDEO_MULTI_SUBSCRIBE_REQ",(function(){return Ra})),r.d(t,"WS_VIDEO_MULTI_UNSUBSCRIBE_REQ",(function(){return Ia})),r.d(t,"RWG_MONITOR_LOG_EVENT",(function(){return wa})),r.d(t,"PUBSUB_EVT",(function(){return Ta})),r.d(t,"CURRENT_CAPTURE_VIDEO_WIDTH_HEIGHT_FROM_WORKER",(function(){return ka})),r.d(t,"CURRENT_DESKTOP_SHARING_WIDTH_HEIGHT_FROM_WORKER",(function(){return Da})),r.d(t,"SHARING_FIRST_DECODE_FRAME_RECEIVED",(function(){return Oa})),r.d(t,"SHARING_FIRST_DECODE_FRAME_RECEIVED_SSRC",(function(){return Ma})),r.d(t,"VIDEO_CAPTURER_RESOLUTION_CHANGE",(function(){return xa})),r.d(t,"VIDEO_CAPTURE_FRAME_COUNT_STATISTIC",(function(){return Pa})),r.d(t,"SHARING_CAPTURE_FRAME_COUNT_STATISTIC",(function(){return Na})),r.d(t,"UNSUPPORTED_SHARING_FORMAT",(function(){return Va})),r.d(t,"UNSUPPORTED_VIDEO_FORMAT",(function(){return Ua})),r.d(t,"FIRST_SHARING_FRAME_FOR_MOBILE",(function(){return La})),r.d(t,"MEDIA_VIDEO_REPORT_DROP_RATIO",(function(){return Wa})),r.d(t,"MEDIA_VIDEO_REPORT_RTT",(function(){return Ba})),r.d(t,"CONNECT_WEBTRANSPORT_OK",(function(){return Ga})),r.d(t,"CONNECT_WEBTRANSPORT_CLOSE",(function(){return Fa})),r.d(t,"CURRENT_MEDIA_DATA_TRANSPORT_TYPE",(function(){return Ha})),r.d(t,"CONNECT_WEBSOCKET_CLOSE",(function(){return ja})),r.d(t,"CURRENT_ENCODED_TYPE",(function(){return Ka})),r.d(t,"VIDEO_SHARING_CAPTURER_RESOLUTION_CHANGE",(function(){return qa})),r.d(t,"RQUEST_ANIMATION_MODE",(function(){return Xa})),r.d(t,"SET_INTERVAL_MODE",(function(){return Ya})),r.d(t,"HAVE_NO_WATERMARK",(function(){return za})),r.d(t,"HAVE_WATERMARK",(function(){return Qa})),r.d(t,"DATA_DIRECTION_FROM_RECEIVE",(function(){return Ja})),r.d(t,"DATA_DIRECTION_FROM_SEND",(function(){return Za})),r.d(t,"RWG_WCL_PDU_QOS_DATA",(function(){return $a})),r.d(t,"RWG_WCL_PDU_QOS_DATA_VIDEO",(function(){return en})),r.d(t,"WHITEBOARD_WORKER_MESSAGE",(function(){return tn})),r.d(t,"SPEAKING_WHEN_MUTE",(function(){return rn})),r.d(t,"SUBSCRIBE_VIDEO",(function(){return an})),r.d(t,"UNSUBSCRIBE_VIDEO",(function(){return nn})),r.d(t,"UI_SUBSCRIBE_VIDEO",(function(){return on})),r.d(t,"UI_UNSUBSCRIBE_VIDEO",(function(){return sn})),r.d(t,"MOBILE_CAPTURE_DEVICE_CHANGE",(function(){return un})),r.d(t,"AUDIO_QOS_DATA",(function(){return dn})),r.d(t,"VIDEO_QOS_DATA",(function(){return cn})),r.d(t,"VIDEOSHARE_QOS_DATA",(function(){return ln})),r.d(t,"NETWORK_QUALITY_CHANGE",(function(){return hn})),r.d(t,"NETWORK_QUALITY_CHANGE_AUDIO",(function(){return fn})),r.d(t,"sdkIvTypeKeyEnum",(function(){return pn})),r.d(t,"CURRENT_DECODE_VIDEO_QUALITY",(function(){return vn})),r.d(t,"CURRENT_DECODE_VIDEO_FPS",(function(){return mn})),r.d(t,"ENABLE_REUSE_STREAM",(function(){return gn})),r.d(t,"PRESET_MEDIA_CONSTRAINTS",(function(){return _n})),r.d(t,"DESTORY_REUSE_STREAM",(function(){return Sn})),r.d(t,"VB_SETTING_PARA_ERROR_TYPE",(function(){return En})),r.d(t,"AUDIO_STREAM_MUTED",(function(){return bn})),r.d(t,"AUDIO_STREAM_UNMUTED",(function(){return yn})),r.d(t,"EXPOSE_VB_FRAME",(function(){return Cn})),r.d(t,"UNIFIED_VB_FRAME",(function(){return An})),r.d(t,"UNIFIED_VB_STOP",(function(){return Rn})),r.d(t,"UNIFIED_VB_PAUSE",(function(){return In})),r.d(t,"UNIFIED_VB_ACK",(function(){return wn}));var i=0,a=1,n=2,o=3,s=4,u=5,d=6,c=7,l=8,h=9,f=10,p=11,v=12,m=13,g=14,_=15,S=16,E=17,b=18,y=19,C=20,A=21,R=22,I=23,w=24,T=25,k=26,D=27,O=28,M=29,x=30,P=30.1,N=31,V=31.1,U=32,L=33,W=34,B=35,G=36,F=40,H=41,j=42,K=43,q=44,X=45,Y=46,z=47,Q=48,J=49,Z=50,$=51,ee=52,te=53,re=54,ie=55,ae=57,ne=58,oe=59,se=60,ue=61,de=62,ce=63,le=64,he=65,fe=66,pe=70,ve=71,me=72,ge=73,_e=74,Se=75,Ee=76,be=77,ye=78,Ce=79,Ae=80,Re=81,Ie=82,we=83,Te=84,ke=85,De=86,Oe=87,Me=90,xe=91,Pe=92,Ne=93,Ve=94,Ue=95,Le=96,We=97,Be=98,Ge=99,Fe=101,He=100,je=110,Ke=111,qe=112,Xe=113,Ye=114,ze=115,Qe=116,Je=117,Ze=118,$e=120,et=121,tt=122,rt=123,it=124,at=125,nt=126,ot=127,st=129,ut=136,dt=1,ct=2,lt=3,ht=4,ft=5,pt=7,vt=8,mt=9,gt=10,_t=11,St=12,Et=13,bt=14,yt=15,Ct=16,At=17,Rt=18,It=19,wt=20,Tt=21,kt=3021,Dt=22,Ot=23,Mt=24,xt=26,Pt=27,Nt=30,Vt=31,Ut=32,Lt=33,Wt=34,Bt=35,Gt=36,Ft=37,Ht=38,jt=39,Kt=40,qt=41,Xt=42,Yt=46,zt=47,Qt=48,Jt=49,Zt=50,$t=51,er=52,tr=53,rr=54,ir=55,ar=56,nr=57,or=58,sr=60,ur=62,dr=-1,cr=-2,lr=-3,hr=-4,fr=-5,pr=-7,vr=-8,mr=-9,gr=-10,_r=-11,Sr=-12,Er=-13,br=-14,yr=-15,Cr=-16,Ar=-26,Rr=-27,Ir=-28,wr=-129,Tr=1,kr=1.1,Dr=1.2,Or=1.3,Mr=2,xr=3,Pr=4,Nr=5,Vr=6,Ur=6.1,Lr=7,Wr=8,Br=9,Gr=10,Fr=11,Hr=12,jr=13,Kr=14,qr=15,Xr=16,Yr=17,zr=18,Qr=19,Jr=20,Zr=21,$r=22,ei=23,ti=24,ri=25,ii=26,ai=27,ni=28,oi=29,si=30,ui=31,di=32,ci=33,li=34,hi=35,fi=36,pi=37,vi=38,mi=39,gi=-1,_i=-1.1,Si=-1.2,Ei=-1.3,bi=-2,yi=-3,Ci=-4,Ai=-5,Ri=-6,Ii=-7,wi=-8,Ti=-9,ki=-10,Di=-11,Oi=-12,Mi=-14,xi=-15,Pi=-16,Ni=-17,Vi=-18,Ui=-19,Li=-20,Wi=-21,Bi=-22,Gi=-23,Fi=-24,Hi=-25,ji=-26,Ki=-28,qi=-27,Xi=-29,Yi=-31,zi=-30,Qi=-32,Ji=-33,Zi=-34,$i=-35,ea=-36,ta=-24,ra=-37,ia=-38,aa=-39,na=-40,oa=-41,sa=-42,ua=-43,da=0,ca=1,la=2,ha=-1,fa="SHARING_PARAM_INFO_FROM_SOCKET",pa="VIDEO_DATA_FROM_WORKER",va="AUDIO_DATA_FROM_WORKER",ma="VIDEO_ENCODE_DATA_FROM_WORKER",ga=24321,_a=24322,Sa=24322,Ea=24323,ba=24322,ya=4300,Ca=4299,Aa=7939,Ra=12303,Ia=12305,wa=4167,Ta={ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT:"ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT",ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT:"ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT",END_MEDIA:"END_MEDIA",DESTROY:"DESTROY",DC_COMING_MESSAGE:"DC_COMING_MESSAGE",AUDIO_BRIDGE_WS_TOKEN:"AUDIO_BRIDGE_WS_TOKEN"},ka=67,Da=68,Oa=69,Ma=70,xa=71,Pa=72,Na=73,Va=75,Ua=76,La=78,Wa=100,Ba=101,Ga=105,Fa=106,Ha=107,ja=108,Ka=109,qa=110,Xa=0,Ya=1,za=!1,Qa=!0,Ja=0,Za=1,$a=108,en=104,tn=120,rn=121,an=130,nn=131,on=132,sn=133,un=135,dn="AUDIO_QOS_DATA",cn="VIDEO_QOS_DATA",ln="VIDEOSHARE_QOS_DATA",hn="NETWORK_QUALITY_CHANGE",fn="NETWORK_QUALITY_CHANGE_AUDIO",pn={VIDEO_ENCODE:"0",VIDEO_DECODE:"1",AUDIO_ENCODE:"2",AUDIO_DECODE:"3",SHARING_ENCODE:"4",SHARING_DECODE:"5"},vn=66.5,mn=66.6,gn="ENABLE_REUSE_STREAM",_n="PRESET_MEDIA_CONSTRAINTS",Sn="DESTORY_REUSE_STREAM",En={FAIL:4},bn="AUDIO_STREAM_MUTED",yn="AUDIO_STREAM_UNMUTED",Cn="EXPOSE_VB_FRAME",An="UNIFIED_VB_FRAME",Rn="UNIFIED_VB_STOP",In="UNIFIED_VB_PAUSE",wn="UNIFIED_VB_ACK"},function(e,t,r){"use strict";r.r(t);var i,a,n=r(19),o=r.n(n),s=r(11),u=r.n(s),d=r(12),c=r.n(d),l=r(13),h=r.n(l),f=r(4),p=r.n(f),v=function(){};v.prototype={threads:(a=u()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=u()(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(WebAssembly.validate(t)){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,e.abrupt("return",((new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),!0));case 6:return e.prev=6,e.t0=e.catch(2),e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e,null,[[2,6]])})));return function(t){return e.apply(this,arguments)}}()(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])));case 1:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)}),simd:(i=u()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11])));case 1:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})};var m=new v,g=r(30),_=r(9),S=r(0),E=r(6);r(14);r.d(t,"apiSupportUtility",(function(){return M})),r.d(t,"IsSupportWebGLOffscreenCanvas",(function(){return F})),r.d(t,"DetectIsMTRAndroidWithSAB",(function(){return H})),r.d(t,"Get_Logical_SSrc",(function(){return K})),r.d(t,"createAudioContext",(function(){return q})),r.d(t,"Deferred",(function(){return de})),r.d(t,"getFilename",(function(){return ce})),r.d(t,"IntegrityHelper",(function(){return le})),r.d(t,"getGcd",(function(){return he})),r.d(t,"getLcm",(function(){return fe})),r.d(t,"AdjustRegion_AspectRatio",(function(){return pe})),r.d(t,"deepEqual",(function(){return ve})),r.d(t,"getWMSCModule",(function(){return me})),r.d(t,"addSelfViewDebugInfoForWebRTC",(function(){return ge})),r.d(t,"addUserEventListener",(function(){return _e})),r.d(t,"VideoStreamCanCapture",(function(){return Se})),r.d(t,"CheckCanvasSize",(function(){return Ee})),r.d(t,"parseDOMParams",(function(){return be}));var b,y,C,A,R={},I=(y={},C=navigator.userAgent.toLowerCase(),(b=C.match(/rv:([\d.]+)\) like gecko/))||(b=C.match(/msie ([\d\.]+)/))?y.ie=b[1]:(b=C.match(/edge\/([\d\.]+)/))?y.edge=b[1]:(b=C.match(/firefox\/([\d\.]+)/))?y.firefox=b[1]:(b=C.match(/(?:opera|opr).([\d\.]+)/))?y.opera=b[1]:(b=C.match(/chrome\/([\d\.]+)/))?y.chrome=b[1]:(b=C.match(/version\/([\d\.]+).*safari/))&&(y.safari=b[1]),A=y,function(){return A}),w=function(e,t){for(var r=t.toString().split("."),i=e.toString().split("."),a=r.length,n=i.length,o=Math.min(a,n),s=0;s<o;s++){var u=parseInt(r[s],10),d=parseInt(i[s],10);if(u!==d)return d>u}return n>=a},T=function(e,t){var r=I();if("chromium"===e){if(r.chrome||r.edg||r.opera){var i=r.chrome||r.edg||r.opera;return w(i,t)}}else if(r[e])return w(r[e],t);return!1},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:90;return T("chrome",e)},D=function(e){return T("firefox",e)},O=function(e){return T("safari",e)};var M=new(function(){function e(){c()(this,e),this._isSupportMultiThread=!1,this._isSupportSIMD=!1,this.inProgressPromise={checkSupportMultiThread:null,checkSupportSIMD:null},this._isSupportWebtransport=!1,this._isSupportVirtualBackground=!1}var t,r;return h()(e,[{key:"checkIsSupportMultiThread",value:(r=u()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.getIsSupportMultiThread()){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,!this.inProgressPromise.checkSupportMultiThread){e.next=8;break}return e.next=6,this.inProgressPromise.checkSupportMultiThread;case 6:e.next=14;break;case 8:return this.inProgressPromise.checkSupportMultiThread=m.threads(),e.t0=this,e.next=12,this.inProgressPromise.checkSupportMultiThread;case 12:e.t1=e.sent,e.t0._setIsSupportMultiThread.call(e.t0,e.t1);case 14:e.next=19;break;case 16:e.prev=16,e.t2=e.catch(2),this._setIsSupportMultiThread(!1);case 19:case"end":return e.stop()}}),e,this,[[2,16]])}))),function(){return r.apply(this,arguments)})},{key:"_setIsSupportMultiThread",value:function(e){this._isSupportMultiThread=e}},{key:"getIsSupportMultiThread",value:function(){return this._isSupportMultiThread}},{key:"checkIsSupportSIMD",value:(t=u()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.getIsSupportSIMD()){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,!this.inProgressPromise.checkSupportSIMD){e.next=8;break}return e.next=6,this.inProgressPromise.checkSupportSIMD;case 6:e.next=14;break;case 8:return this.inProgressPromise.checkSupportSIMD=m.simd(),e.t0=this,e.next=12,this.inProgressPromise.checkSupportSIMD;case 12:e.t1=e.sent,e.t0._setIsSupportSIMD.call(e.t0,e.t1);case 14:e.next=19;break;case 16:e.prev=16,e.t2=e.catch(2),this._setIsSupportSIMD(!1);case 19:case"end":return e.stop()}}),e,this,[[2,16]])}))),function(){return t.apply(this,arguments)})},{key:"_setIsSupportSIMD",value:function(e){this._isSupportSIMD=e}},{key:"getIsSupportSIMD",value:function(){return this._isSupportSIMD}},{key:"getIsSupportWebtransport",value:function(){return k(97)&&"function"==typeof WebTransport&&this._isSupportWebtransport}},{key:"setIsSupportWebtransport",value:function(e){this._isSupportWebtransport=!!e}},{key:"getIsSupportVirtualBackground",value:function(){var e=k(91)||D(89)||O(17.4);return navigator.hardwareConcurrency&&navigator.hardwareConcurrency>2&&e&&"function"==typeof OffscreenCanvas&&this._isSupportVirtualBackground}},{key:"setIsSupportVirtualBackground",value:function(e){this._isSupportVirtualBackground=!!e}},{key:"getIsRenderSelfVideoInEncodeWorker",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!S.default.enableMultiDecodeVideoWithoutSAB&&e&&!this.getIsSupportMultiThread()&&this.getIsSupportVirtualBackground()}}]),e}()),x={capacity:void 0,capacity1080:!0,get capacityfor720(){return void 0!==this.capacity&&this.capacity},set capacityfor720(e){this.capacity=e},get capacityfor1080(){return void 0!==this.capacity1080&&this.capacity1080},set capacityfor1080(e){this.capacity1080=e}},P={capacitydeco:void 0,get capacitydecofor1080(){return void 0!==this.capacitydeco&&this.capacitydeco},set capacitydecofor1080(e){this.capacitydeco=e}},N={MaxCount:1,get MaxCountRender(){return this.MaxCount},set MaxCountRender(e){this.MaxCount=e}};function V(e,t,r){var i=e.match(t);return i&&i.length>=r&&parseInt(i[r],10)}function U(){var e=window.navigator,t={browser:null,version:null};if("undefined"==typeof window||!window.navigator)return t.browser="Not a browser.",t;if(e.mozGetUserMedia)t.browser="firefox",t.version=V(e.userAgent,/Firefox\/(\d+)\./,1);else if(e.webkitGetUserMedia)t.browser="chrome",t.version=V(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=V(e.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!window.RTCPeerConnection||!e.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=V(e.userAgent,/AppleWebKit\/(\d+)\./,1)}return t}var L=U();var W,B=function(){if("function"!=typeof OffscreenCanvas)return!1;var e={isSupportWebgl:!1,isSupportWebgl2:!1,renderer_info:"",vendor_info:""};try{var t=new OffscreenCanvas(1,1),r=t.getContext("webgl")||t.getContext("experimental-webgl")||t.getContext("moz-webgl")||t.getContext("webkit-3d");if(r){e.isSupportWebgl=!0;var i=r.getExtension("WEBGL_debug_renderer_info"),a=r.getParameter(i.UNMASKED_RENDERER_WEBGL),n=r.getParameter(i.UNMASKED_VENDOR_WEBGL);e.renderer_info=a.toLowerCase(),e.vendor_info=n}}catch(e){console.error(e)}try{new OffscreenCanvas(1,1).getContext("webgl2")&&(e.isSupportWebgl2=!0)}catch(e){console.error(e)}return e}(),G=((W=Object.assign({},B)).cpu=navigator.hardwareConcurrency?navigator.hardwareConcurrency:0,W.VE=0,W.SE=0,W.VD=0,W.SD=0,W.SAB=null!=("undefined"==typeof SharedArrayBuffer?"undefined":o()(SharedArrayBuffer)),W.errorMessage=null,W.visibility=!0,W.unvisibilitycount=0,W.time=0,W);function F(){return B.isSupportWebgl}function H(){return-1!==navigator.userAgent.indexOf("MSFT Teams Android Room")&&"undefined"!=typeof SharedArrayBuffer}function j(){return"function"==typeof VideoTrackReader&&"function"==typeof VideoFrame}function K(e){return e?e>>10<<10:-1}function q(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return _.default.log("Creating ".concat(e," AudioContext")),(t=r?new AudioContext(r):new AudioContext).onstatechange=function(){_.default.log("".concat(e," AudioContext state changed to ").concat(t.state))},t.onsinkchange=function(){"object"===o()(t.sinkId)&&"none"===t.sinkId.type?_.default.log("".concat(e," AudioContext - Audio changed to not play on any device")):_.default.log("".concat(e," AudioContext - Audio output device changed to ").concat(t.sinkId))},t}var X,Y,z,Q,J,Z,$,ee,te,re,ie,ae,ne,oe,se,ue;t.default={isMTRAndroidWithSAB:function(){return H()},isSupport2DCanvasDrawFrame:function(){return("function"==typeof MediaStreamTrackProcessor||j())&&"chrome"==L.browser&&L.version>=90&&-1==navigator.appVersion.indexOf("Mac")},checkLocalP2PConnection:function(){return new Promise(function(){var e=u()(p.a.mark((function e(t,r){var i,a,n,o,s,u,d,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=function(e){e&&e.close()},i=function(e){return new Promise((function(t,r){e.onconnectionstatechange=function(r){"connected"===e.connectionState&&t(!0)}}))},n=null,o=null,s=document.createElement("canvas"),e.prev=5,s.width=200,s.height=200,s.getContext("2d"),c=s.captureStream(),"function"==typeof RTCPeerConnection){e.next=13;break}return t(!1),e.abrupt("return");case 13:if(n=new RTCPeerConnection,o=new RTCPeerConnection,n.onicecandidate=function(e){e.candidate&&o.addIceCandidate(new RTCIceCandidate(e.candidate))},o.onicecandidate=function(e){e.candidate&&n.addIceCandidate(new RTCIceCandidate(e.candidate))},Promise.all([i(n),i(o)]).then((function(){t(!0),a(n),a(o)})),"function"==typeof n.addStream){e.next=21;break}return t(!1),e.abrupt("return");case 21:return e.next=23,n.addStream(c);case 23:return e.next=25,n.createOffer();case 25:return u=e.sent,e.next=28,n.setLocalDescription(u);case 28:return e.next=30,o.setRemoteDescription(u);case 30:return e.next=32,o.createAnswer();case 32:return d=e.sent,e.next=35,o.setLocalDescription(d);case 35:return e.next=37,n.setRemoteDescription(d);case 37:setTimeout((function(){t(!1),a(n),a(o)}),200),e.next=44;break;case 40:e.prev=40,e.t0=e.catch(5),_.default.error("Error when trying to check for local RTC peer connection",e.t0),t(!1);case 44:case"end":return e.stop()}}),e,null,[[5,40]])})));return function(t,r){return e.apply(this,arguments)}}())},getDocumentHandle:function(e){return document.getElementById(e)},browserType:L,browser:{isFirefox:"firefox"===L.browser,isChrome:"chrome"===L.browser,isSafari:"safari"===L.browser},isIphoneOrIpadSafari:function(){return this.isIphoneOrIpadBrowser()||this.isIpadOS()},isOpera65:function(){return function(){try{var e=navigator.userAgent.match(/OPR\/(\d+)\./);return!!(e&&Number(e[1])<66)}catch(e){return!1}}()},isOpera:function(){return/opera|opr\/[\d]+/i.test(navigator.userAgent)},isOperaVersionHigherThan:function(e){try{var t=navigator.userAgent.match(/OPR\/(\d+)\./);return!!(t&&Number(t[1])>=e)}catch(e){return!1}},isAndroidBrowser:function(){return function(){try{var e=navigator.userAgent||navigator.vendor||window.opera;return!!/android/i.test(e)}catch(e){return!1}}()},isSupportVideoFrame:function(){return"undefined"!=typeof VideoFrame},isQuestBrowser:function(){return function(){try{return/oculusbrowser/i.test(navigator.userAgent)}catch(e){return!1}}()},isMobileSafariSupportVideoFrame:function(){return(this.isIphoneOrIpadBrowser()||this.isIpadOS()&&S.default.rwgAgent)&&this.isSupportVideoFrame()},isSelfPreviewRenderWithVideo:function(){return!!this.isMobileSafariSupportVideoFrame()||(!M.getIsSupportMultiThread()&&!M.getIsSupportVirtualBackground()&&this.isSupportVideoFrameOrBitmapCapture()||this.isAndroidBrowser()&&!this.isMTRAndroidWithSAB()&&!S.default.rwgAgent)},isSupportNewWaitRoomFlow:function(){return!0},isIphoneOrIpadBrowser:function(){try{return!!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)}catch(e){return!1}},isIpadOS:function(){return navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&(/iPad/.test(navigator.platform)||/MacIntel/.test(navigator.platform))},isChromeOS:function(){return function(){try{return!!/\bCrOS\b/.test(navigator.userAgent)}catch(e){return!1}}()},isWindowsChrome:function(){var e=navigator.userAgent;return/windows/i.test(e)},isTeslaMode:function(){return/TESLA/.test(navigator.userAgent)},isMac:function(){return navigator.platform.indexOf("Mac")>-1},isWindows:function(){return navigator.platform.indexOf("Win")>-1},isLinux:function(){return navigator.platform.indexOf("Linux")>-1&&!this.isChromeOS()},isSupportChromeWideAEC:function(){var e=S.default.chromeWideAEC&&this.isChromeOS()&&k(116);return(this.isMac()||this.isWindows()||this.isLinux())&&k(111)||e||S.default.isGoogleMeetMode},isSupportOpenMicWhenShareAudio:function(){return this.isSupportChromeWideAEC()&&!S.default.shareSystemAudio},getAudioFeatureFlags:function(){return S.default.enableAudioBridge?4:12},isSupportShareMultiStream:function(){return!0},isSupportVideoLTR:function(){return!0},isSupportAudioBridgeAvsync:function(){return!0},getAudioContextConfigure:function(){var e={};return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:90;return T("chromium",e)}(74)&&(e={sampleRate:48e3,latencyHint:.02}),e},download:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(R[e])return R[e];var r=new Promise((function(r,i){var a={};t&&(a.integrity=t),fetch(e,a).then((function(e){r(e.text())})).catch((function(e){i(e)}))}));return R[e]=r,r},downloadAndCompileWebAssembly:function(e,t,r){var i=arguments;return u()(p.a.mark((function a(){var n,o,s;return p.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(n=!(i.length>3&&void 0!==i[3])||i[3],o="".concat(e).concat(n),!R[o]){a.next=4;break}return a.abrupt("return",R[o]);case 4:return s=new Promise(function(){var i=u()(p.a.mark((function i(a,o){var s,u,d,c,l,h,f;return p.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:s=null,u=3,d=0;case 3:if(!(d<u)){i.next=47;break}if(i.prev=4,r.add_monitor("CS".concat(t)),!n){i.next=12;break}return i.next=9,WebAssembly.compileStreaming(fetch(e,{priority:"high"}));case 9:s=i.sent,i.next=19;break;case 12:return i.next=14,fetch(e,{priority:"high"});case 14:return c=i.sent,i.next=17,c.arrayBuffer();case 17:l=i.sent,s=l;case 19:r.add_monitor("CE".concat(t)),i.next=41;break;case 22:if(i.prev=22,i.t0=i.catch(4),_.default.error("Failed to download WASM file using ".concat(n?"compileStreaming":"fetch",": ").concat(e," for worker type: ").concat(t),i.t0),"TypeError"!==i.t0.name){i.next=41;break}return i.prev=26,i.next=29,fetch(e,{priority:"high"});case 29:return h=i.sent,i.next=32,h.arrayBuffer();case 32:return f=i.sent,i.next=35,WebAssembly.compile(f);case 35:s=i.sent,i.next=41;break;case 38:i.prev=38,i.t1=i.catch(26),_.default.error("Failed to download WASM file using compile: ".concat(e," for worker type: ").concat(t),i.t1);case 41:if(!s){i.next=44;break}return a(s),i.abrupt("return");case 44:d++,i.next=3;break;case 47:o(new Error("Unable to download and compile WASM file: ".concat(e," for worker type: ").concat(t)));case 48:case"end":return i.stop()}}),i,null,[[4,22],[26,38]])})));return function(e,t){return i.apply(this,arguments)}}()),R[o]=s,a.abrupt("return",s);case 7:case"end":return a.stop()}}),a)})))()},readBlob:function(e){return new Promise((function(t,r){var i=new FileReader;i.onload=function(){t(i.result)},i.readAsText(e)}))},readBlobAsBuffer:function(e){return new Promise((function(t,r){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.readAsArrayBuffer(e)}))},lengthInUtf8Bytes:function(e){var t=encodeURIComponent(e).match(/%[89ABab]/g);return e.length+(t?t.length:0)},isLittleEndian:function(){var e=new ArrayBuffer(2),t=new Uint8Array(e),r=new Uint16Array(e);return t[0]=170,t[1]=187,48042===r[0]},sleep:function(e){return new Promise((function(t,r){setTimeout((function(){t(!0)}),e)}))},isSDKSupportMultiThread:(ue=u()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.checkIsSupportMultiThread();case 2:return e.abrupt("return",M.getIsSupportMultiThread());case 3:case"end":return e.stop()}}),e)}))),function(){return ue.apply(this,arguments)}),is32bitChrome:(se=u()(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1==navigator.userAgent.indexOf("WOW64")){e.next=4;break}return e.abrupt("return",!0);case 4:if(!navigator.userAgentData||!navigator.userAgentData.getHighEntropyValues){e.next=11;break}return e.next=7,navigator.userAgentData.getHighEntropyValues(["wow64"]);case 7:return t=e.sent,e.abrupt("return",t.wow64);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e)}))),function(){return se.apply(this,arguments)}),isAMDGraphic:function(){try{return this.graphicName().includes("amd")}catch(e){return!1}},graphicName:B.renderer_info,graphicvendorname:B.vendor_info,isGraphicShouldUseHardwareAccelerationDecode:function(){return!(!this.isAMDGraphic()||!this.isChromeOS())||!(this.isAMDGraphic()&&!this.isChromeOS())},VP9MachineDetect:function(){var e=navigator.mediaCapabilities.decodingInfo({type:"webrtc",video:{contentType:"video/vp9",bitrate:1e7,framerate:25,height:1920,width:1080}});return new Promise((function(t,r){e.then((function(e){e.supported||(_.default.log("video/vp9 codec isn't supported in software or hardware"),t(!1)),t(e.powerEfficient)})).catch((function(e){_.default.warn("Error when trying to determine support for VP9 codec",e),t(!1)}))}))},IsSupportVideoDecodeHardwareAcceleration:function(){var e=this;return u()(p.a.mark((function t(){var r,i;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"!=typeof VideoDecoder||e.browser.isSafari){t.next=19;break}return r=new Uint8Array([1,100,0,31,255,225,0,14,103,100,0,51,172,27,26,17,129,64,22,201,160,16,7,0,5,104,200,66,60,48,0,5,104,82,16,207,12,0,25,104,114,16,143,24,67,17,132,56,140,84,81,8,18,22,41,3,194,98,3,5,32,122,9,140,0,5,104,36,132,51,203,0,5,104,46,132,51,195,0,25,104,54,132,35,198,16,196,97,14,35,21,20,66,4,133,138,64,240,152,128,193,72,30,130,99,0,5,104,62,132,51,203]),i={codec:"avc1.640028",description:r,codedWidth:1280,codedHeight:720,hardwareAcceleration:"prefer-hardware"},t.prev=3,t.next=6,VideoDecoder.isConfigSupported(i);case 6:if(!t.sent.supported){t.next=11;break}return t.abrupt("return",!0);case 11:return t.abrupt("return",!1);case 12:t.next=17;break;case 14:return t.prev=14,t.t0=t.catch(3),t.abrupt("return",!1);case 17:t.next=20;break;case 19:return t.abrupt("return",!1);case 20:case"end":return t.stop()}}),t,null,[[3,14]])})))()},IsSupportVideoEncodeHardwareAcceleration:function(){var e=this;return u()(p.a.mark((function t(){var r;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"!=typeof VideoEncoder||e.browser.isSafari){t.next=13;break}return r={codec:"avc1.640028",bitrate:15e5,width:1280,height:720,avc:{format:"annexb"},framerate:25,hardwareAcceleration:"no-preference",latencyMode:"realtime",bitrateMode:"constant",scalabilityMode:"L1T2"},t.next=5,VideoEncoder.isConfigSupported(r);case 5:if(!t.sent.supported){t.next=10;break}return t.abrupt("return",!0);case 10:return t.abrupt("return",!1);case 11:t.next=14;break;case 13:return t.abrupt("return",!1);case 14:case"end":return t.stop()}}),t)})))()},AdapterWhiteListCheckForEncoder:function(){if(!F())return-1;try{var e=B.renderer_info,t=B.vendor_info,r=e.toLowerCase(),i=t.includes("ARM"),a=(r.includes("amd"),r.includes("intel"));r.includes("hd graphics"),r.includes("nvidia"),r.includes("geforce");return a?0:i?-1:0}catch(e){return 0}},isChromeVersionHigherThan:k,isFirefoxVersionHigherThan:D,isSafariVersionHigherThan:O,isSDKSupportSIMD:function(){return u()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("object"===("undefined"==typeof WebAssembly?"undefined":o()(WebAssembly))){e.next=2;break}return e.abrupt("return",!1);case 2:if("chrome"!=L.browser){e.next=11;break}if(!(L.version>=84)){e.next=8;break}return e.next=6,M.checkIsSupportSIMD();case 6:e.next=9;break;case 8:return e.abrupt("return",!1);case 9:e.next=13;break;case 11:return e.next=13,M.checkIsSupportSIMD();case 13:return e.abrupt("return",M.getIsSupportSIMD());case 14:case"end":return e.stop()}}),e)})))()},buffer2stringSplitByComma:function(e){return new Uint8Array(e).join(",")},stringSplitByComma2Buffer:function(e){try{for(var t=e.split(",").map((function(e){return parseInt(e)})),r=new ArrayBuffer(t.length),i=new Uint8Array(r),a=0;a<t.length;a++)i[a]=t[a];return r}catch(e){return null}},removeDuplicates:function(e,t){var r=[];return e.forEach((function(e){for(var i=!1,a=0;a<r.length;a++)if(!t.call(null,r[a],e)){i=!0;break}i||r.push(e)})),r},getBrowserVersion:function(){var e=function(){var e=navigator.userAgent.toLowerCase();if(e.indexOf("firefox")>0)return e.match(/firefox\/[\d.]+/gi);if(e.indexOf("safari")>0&&e.indexOf("chrome")<0){var t,r="safari/unknow";return r=e.match(/safari\/[\d.]+/gi),t=e.match(/safari\/[\d.]+/gi),r&&(r=[r.toString().replace("version","safari")]),t&&(r=[t.toString().replace("version","safari")]),r}return e.indexOf("chrome")>0?e.match(/chrome\/[\d.]+/gi):"other"}();return e[0]&&e[0].match(/(\d+)/)?e[0].match(/(\d+)/)[0]:"other"},getIOSMajorVersion:function(){if(/iP(hone|od|ad)/.test(navigator.platform)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return parseInt(e[1],10)}return null},getMacSafariMajorVersion:function(){if(this.browser.isSafari){var e=navigator.userAgent.match(/Version\/([\d\.]+)/);return e&&e[1]?parseFloat(e[1]):null}return null},isSupportImageCapture:function(){return"function"==typeof ImageCapture&&F()},isSupportOffscreenCanvas:function(){return F()},isSupport2dOffscreenCanvas:function(){return"function"==typeof OffscreenCanvas},isSupportVideoTrackReader:function(){return j()&&F()},isSupportMediaStreamTrackProcessor:function(){return"function"==typeof MediaStreamTrackProcessor&&F()},isSupportVideoFrameOrBitmapCapture:function(){return this.isSupportImageCapture()||this.isSupportVideoTrackReader()||this.isSupportMediaStreamTrackProcessor()},isSupportSharedArrayBuffer:function(){return"undefined"!=typeof SharedArrayBuffer},queryPTZPermisson:function(){return u()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.permissions.query({name:"camera",panTiltZoom:!0});case 3:if("granted"!=e.sent.state){e.next=6;break}return e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 9:return e.prev=9,e.t0=e.catch(0),_.default.error("Error when querying pan-tilt-zoom permission",e.t0),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))()},isSupportCameraPan:function(){return!!navigator.mediaDevices.getSupportedConstraints().pan},isSupportCameraTilt:function(){return!!navigator.mediaDevices.getSupportedConstraints().tilt},isSupportCameraZoom:function(){return!!navigator.mediaDevices.getSupportedConstraints().zoom},isSupportPTZ:function(){var e=navigator.mediaDevices.getSupportedConstraints();return e.pan&&e.tilt&&e.zoom},get720pcapacity:function(){return x.capacityfor720},set720pcapacity:function(e){x.capacityfor720=e},get1080pcapacity:function(){return x.capacity1080},set1080pcapacity:function(e){x.capacity1080=e},isSupportBrowserWebRTC:function(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&window.RTCPeerConnection)},getsub1080pcapacity:function(){return P.capacitydecofor1080},setsub1080pcapacity:function(e){P.capacitydecofor1080=e},setMaxCountRender:function(e){N.MaxCountRender=e},getMaxCountRender:function(){return N.MaxCountRender},checkAudioAutoPlay:function(){return new Promise((function(e,t){var r=new ArrayBuffer(684),i=new Uint32Array(r);i.set([1179011410,676,1163280727,544501094,16,65539,16e3,64e3,2097156,1635017060,640],0);var a=new Blob([i],{type:"audio/wav"}),n=window.URL.createObjectURL(a),o=new Audio(n);o.addEventListener("canplaythrough",(function(){o.play().then((function(){e(!0)})).catch((function(e){_.default.log("Unable to auto play audio",e),t(e)})).finally((function(){window.URL.revokeObjectURL(n)}))})),o.load&&o.load()}))},isSupportSendVideoFullHD:function(){return this.isSupportVideoShareSend()&&navigator.hardwareConcurrency>=8},isSupportSendVideoShareFullHD:function(){return!1},isSupportVideoShare:function(){return!0},isSupportVideoShareSend:function(){var e,t=U();return"chrome"==t.browser&&(e=this.getBrowserVersion()),!!this.isSupportSharedArrayBuffer()&&!("chrome"!==t.browser||e&&e<=100||navigator.hardwareConcurrency<=2||this.isTeslaMode()||this.isAndroidBrowser()&&!this.isMTRAndroidWithSAB()||this.isIphoneOrIpadBrowser())},isSupportVideoShareReceive:function(){return!0},getOption:function(e,t,r){try{var i=e.length;if(t>i)return 0;var a=e.slice(i-t-r+1,i-t+1);if(a)return parseInt(a,16)}catch(e){}return 0},isSupportWebGPURender:function(e){var t=this;return u()(p.a.mark((function r(){var i,a;return p.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=t.parseGPUBlacklist(e),r.next=3,t.evaluateRendererType(1,0,i);case 3:return a=r.sent,r.abrupt("return",a==E.j.WEBGPU);case 5:case"end":return r.stop()}}),r)})))()},getGpuInfo:function(){var e;try{e="".concat(null==B?void 0:B.vendor_info," ").concat(null==B?void 0:B.renderer_info)}catch(e){}return e},getMachineCapability:function(){var e,t,r,i,a,n,o;return G.VE=null===S.default||void 0===S.default||null===(e=S.default.localVideoPara)||void 0===e||null===(e=e.VE)||void 0===e?void 0:e.buffer.byteLength,G.VD=null===S.default||void 0===S.default||null===(t=S.default.localVideoPara)||void 0===t||null===(t=t.VD)||void 0===t?void 0:t.buffer.byteLength,G.SE=null===S.default||void 0===S.default||null===(r=S.default.localVideoPara)||void 0===r||null===(r=r.SE)||void 0===r?void 0:r.buffer.byteLength,G.SD=null===S.default||void 0===S.default||null===(i=S.default.localVideoPara)||void 0===i||null===(i=i.SD)||void 0===i?void 0:i.buffer.byteLength,G.dt=null===S.default||void 0===S.default||null===(a=S.default.localVideoPara)||void 0===a?void 0:a.videodecodethreadnumb,G.et=null===S.default||void 0===S.default||null===(n=S.default.localVideoPara)||void 0===n?void 0:n.videoencodethreadnumb,G.MT=null===S.default||void 0===S.default||null===(o=S.default.localVideoPara)||void 0===o?void 0:o.isSupportMultiThread,G.time=performance.now(),G},watermark:(ae=new g.a,ne=document.createElement("canvas"),oe={enableWaterMark:!1,waterMarkText:"",watermarkOpacity:0,watermarkRepeated:!1,watermarkPosition:void 0},{getWaterMarkData:function(e){var t=e.width,r=e.height;if(!oe.enableWaterMark)return null;var i=t<512||r<288?16:oe.watermarkPosition,a=oe.watermarkRepeated&&t>306&&r>202,n=function(e,t){if(e<640&&e){var r=640/e;e=640,t=Math.round(t*r)}return{width:e,height:t}}(t,r);return t=n.width,r=n.height,a?ae.Get_Repeated_WaterMarkRGBA({canvas:ne,name:oe.waterMarkText,width:n.width,height:n.height,opacity:oe.watermarkOpacity,position:i,convertToDataUrl:!0}):ae.Get_WaterMarkRGBA({canvas:ne,name:oe.waterMarkText,width:n.width,height:n.height,opacity:oe.watermarkOpacity,position:i,convertToDataUrl:!0})},updateWaterMarkInfo:function(e){Object.assign(oe,e)}}),isSupportAudioDenoise:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=U();if("chrome"==t.browser){var r=this.getBrowserVersion();if(r<=100)return!1}var i=WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]));return!1!==i&&(!0!==i?(_.default.error("WebAssembly.validate don't return a boolean"),!1):!(!e&&!this.isSupportSharedArrayBuffer())&&!(navigator.hardwareConcurrency<=2||this.isTeslaMode()||this.isAndroidBrowser()&&!this.isMTRAndroidWithSAB()||this.isIphoneOrIpadBrowser()))},isSupportPlayStereo:function(){return!!(this.browser.isFirefox||this.browser.isSafari||this.isSupportChromeWideAEC())},isBrowserSupportStereo:function(){return!this.browser.isSafari},isSupportShare2ndAudioDevice:function(e){return!this.browser.isSafari&&!this.isIphoneOrIpadBrowser()&&(!!e||!(this.isMac()&&!k(126))&&!!this.isSupportSharedArrayBuffer())},isSupportSharingStereo:function(){return!1},isSupportVideoActiveChannel:function(){return!0},evaluateRendererType:function(){var e=arguments,t=this;return u()(p.a.mark((function r(){var i,a,n,o,s,u,d,c,l;return p.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=e.length>0&&void 0!==e[0]?e[0]:0,a=e.length>1&&void 0!==e[1]?e[1]:0,n=e.length>2&&void 0!==e[2]?e[2]:null,o=E.j.WEBGL,s=null,u=F(),r.prev=6,t.isWebGL2Supported(a)?o=E.j.WEBGL_2:_.default.log("evaluateRendererType() WebGL 2 is not supported."),t.isSupportVideoFrame()){r.next=11;break}return _.default.log("evaluateRendererType() WebGPU is not supported. (reason: VideoFrame is not supported)"),r.abrupt("return",o);case 11:if(t.isMac()||t.isWindows()||t.isChromeOS()||t.isLinux()){r.next=15;break}return _.default.log("evaluateRendererType() WebGPU is not supported. (reason: unsupported platform)"),r.abrupt("return",o);case 15:if(t.browser.isChrome&&t.isChromeVersionHigherThan(119)||t.isOpera()&&t.isOperaVersionHigherThan(108)||t.browser.isChrome&&(t.isLinux()||t.isAndroidBrowser())&&t.isChromeVersionHigherThan(121)){r.next=19;break}return _.default.log("evaluateRendererType() WebGPU is not supported. (reason: unmatched browser)"),r.abrupt("return",o);case 19:if(navigator.gpu){r.next=21;break}return r.abrupt("return",o);case 21:return r.next=23,navigator.gpu.requestAdapter();case 23:if(d=r.sent){r.next=27;break}return _.default.log("evaluateRendererType() WebGPU is not supported. (reason: no available adapter.)"),r.abrupt("return",o);case 27:return r.next=29,d.requestDevice();case 29:if(r.sent){r.next=33;break}return _.default.log("evaluateRendererType() WebGPU is not supported. (reason: no available device.)"),r.abrupt("return",o);case 33:return r.next=35,d.requestAdapterInfo();case 35:if(c=r.sent){r.next=39;break}return _.default.log("evaluateRendererType() WebGPU is not supported. (reason: no available adapter info.)"),r.abrupt("return",o);case 39:if(_.default.log("evaluateRendererType() GPUAdapterInfo: arch=".concat(c.architecture,", vendor=").concat(c.vendor)),console.log("evaluateRendererType() GPUAdapterInfo: arch=".concat(c.architecture,", vendor=").concat(c.vendor)),l=t.queryDeviceProfile(c),t.isGPUProfileOnWebGPUWhitelist(l,n)){r.next=45;break}return r.abrupt("return",o);case 45:if(!u){r.next=58;break}if(s=new OffscreenCanvas(1,1),s.getContext("webgpu")){r.next=51;break}return _.default.log("evaluateRendererType() WebGPU is not supported. (reason: no available GPUContext.)"),r.abrupt("return",o);case 51:if(t.isOpFeatureEnabled(i)){r.next=54;break}return _.default.log("evaluateRendererType() WebGPU is not supported. (reason: WebGPU is not allowed for this account.)"),r.abrupt("return",o);case 54:s=null,o=E.j.WEBGPU,r.next=59;break;case 58:_.default.log("evaluateRendererType() OffscreenCanvas is not supported while checking WebGPU.");case 59:return r.abrupt("return",o);case 62:return r.prev=62,r.t0=r.catch(6),_.default.error("evaluateRendererType()",r.t0),r.abrupt("return",o);case 66:return r.prev=66,s=null,r.finish(66);case 69:case"end":return r.stop()}}),r,null,[[6,62,66,69]])})))()},isOpFeatureEnabled:function(e){return 1&e},queryDeviceProfile:function(e){if(e){var t={};return t.architecture=e.architecture,t.vendor=e.vendor,t}return null},isGPUProfileOnWebGPUWhitelist:function(e,t){if(!e)return!1;var r=e.vendor,i=e.architecture;return-1==E.g.indexOf(r)?(_.default.log("isGPUProfileOnWebGPUWhitelist() vendor:".concat(r," arch:").concat(i," is not on the vendor whitelist!")),!1):null===t||!this.isHitGPUBlacklist(r,i,t)},isHitGPUBlacklist:function(e,t,r){if(""===e||void 0===e||void 0===t||void 0===r)return!1;for(var i=0;i<r.length;i++){var a=r[i];if(e.includes(a.vendor)&&t.includes(a.generations))return!0}return!1},parseGPUBlacklist:function(e){var t=null;if(e)try{var r=JSON.parse(e);t=null==r?void 0:r.GPUBlacklist}catch(t){_.default.error("parseGPUBlacklist() failed to read mediaBlockConfig! val=".concat(e))}return t},getRendererTypeList:function(e,t,r){var i=this;return u()(p.a.mark((function a(){var n,o,s,u,d;return p.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=i.parseGPUBlacklist(r),a.next=3,i.isWebGPUSupported(e,n);case 3:return o=a.sent,s=i.isWebGL2Supported(t),u=F(),d=[],o&&d.push({rendererType:E.j.WEBGPU,rendererName:"WebGPU"}),s&&d.push({rendererType:E.j.WEBGL_2,rendererName:"WebGL2"}),u&&d.push({rendererType:E.j.WEBGL,rendererName:"WebGL"}),a.abrupt("return",d);case 11:case"end":return a.stop()}}),a)})))()},isWebGL2Supported:function(e){return"function"==typeof OffscreenCanvas&&(B.isSupportWebgl2&&this.isOpFeatureEnabled(e))},isWebGL2SupportedWhenOpEnabled:function(){return B.isSupportWebgl2},isWebGPUSupported:function(e,t){var r=this;return u()(p.a.mark((function i(){var a,n,o,s;return p.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(r.isSupportVideoFrame()){i.next=2;break}return i.abrupt("return",!1);case 2:if(r.isMac()||r.isWindows()||r.isChromeOS()||r.isLinux()){i.next=5;break}return i.abrupt("return",!1);case 5:if(r.browser.isChrome&&r.isChromeVersionHigherThan(119)||r.isOpera()&&r.isOperaVersionHigherThan(108)||r.browser.isChrome&&(r.isLinux()||r.isAndroidBrowser())&&r.isChromeVersionHigherThan(121)){i.next=8;break}return i.abrupt("return",!1);case 8:if(navigator.gpu){i.next=10;break}return i.abrupt("return",!1);case 10:return i.next=12,navigator.gpu.requestAdapter();case 12:if(a=i.sent){i.next=15;break}return i.abrupt("return",!1);case 15:return i.next=17,a.requestDevice();case 17:if(i.sent){i.next=20;break}return i.abrupt("return",!1);case 20:return i.next=22,a.requestAdapterInfo();case 22:if(n=i.sent){i.next=25;break}return i.abrupt("return",!1);case 25:if(o=r.queryDeviceProfile(n),r.isGPUProfileOnWebGPUWhitelist(o,t)){i.next=30;break}return _.default.log("isWebGPUSupported() hit blacklist! profile=".concat(JSON.stringify(o),", blacklist=").concat(JSON.stringify(t))),i.abrupt("return",!1);case 30:if(s=new OffscreenCanvas(1,1),s.getContext("webgpu")){i.next=35;break}return s=null,i.abrupt("return",!1);case 35:if(r.isOpFeatureEnabled(e)){i.next=38;break}return s=null,i.abrupt("return",!1);case 38:return s=null,i.abrupt("return",!0);case 40:case"end":return i.stop()}}),i)})))()},isRendererTypeSupported:function(e,t,r,i){var a=this;return u()(p.a.mark((function n(){return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(e<=E.j.UNDEFINED||e>E.j.WEBGL_2)){n.next=2;break}return n.abrupt("return",!1);case 2:if(e!==E.j.WEBGL){n.next=6;break}return n.abrupt("return",F());case 6:if(e!==E.j.WEBGL_2){n.next=10;break}return n.abrupt("return",a.isWebGL2Supported(r));case 10:if(e!==E.j.WEBGPU){n.next=16;break}return n.next=13,a.isWebGPUSupported(t,i);case 13:return n.abrupt("return",n.sent);case 16:return n.abrupt("return",!1);case 17:case"end":return n.stop()}}),n)})))()},videoToMediaStreamManager:(z=document.createElement("canvas"),Q=z.getContext("2d"),J=640,Z=360,$=navigator.hardwareConcurrency&&navigator.hardwareConcurrency<4?10:24,ee=1e3/("chrome"===L.browser?$:10),te=null,re=0,ie=null,{_draw:function(){if(X){this.drawCanvas(z,Q,J,Z);var e=performance.now();if(re){var t=e-re;t>ee?this._setFasterTimer():t<.8*ee&&this._clearFastTimer()}re=e}},_setFasterTimer:function(){var e=this;te||(te=setInterval((function(){X&&X.currentTime>0&&!X.paused&&!X.ended&&performance.now()-re>=ee/2&&e.drawCanvas(z,Q,J,Z)}),ee))},_clearFastTimer:function(){re=0,clearInterval(te),te=null},drawCanvas:function(e,t,r,i){e.width=r,e.height=i;var a=0,n=0;X.videoWidth/X.videoHeight>r/i?a=r/i*(n=X.videoHeight):n=i/r*(a=X.videoWidth),t.drawImage(X,(X.videoWidth-a)/2,(X.videoHeight-n)/2,a,n,0,0,r,i)},startCapture:function(e,t,r){return X=e,t&&r&&t/r==16/9&&(J=t,Z=r),ie&&X.removeEventListener("timeupdate",ie),ie=this._draw.bind(this),e.addEventListener("timeupdate",ie),Y=z.captureStream($)},stopCapture:function(){ie&&X.removeEventListener("timeupdate",ie),this._clearFastTimer(),Y&&(Y.getVideoTracks().forEach((function(e){return e.stop()})),Y=null),X=null},isSupported:function(){return"function"==typeof HTMLCanvasElement.prototype.captureStream}}),audioToMediaStreamMananger:function(){var e=null,t=null,r=null,i=null,a=null;return{startCapture:function(n){if(t||(t=q("File")),a&&n===a)e=a;else{this.destroy(),a=e=n,i=t.createMediaElementSource(e);var o=t.createMediaStreamDestination();i.connect(o),r=o.stream}return"suspended"!==t.state&&"interrupted"!==t.state||t.resume(),r},stopCapture:function(){t&&t.suspend(),e=null},destroy:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];i&&i.disconnect(),r&&(r.getAudioTracks().forEach((function(e){return e.stop()})),r=null),a=null,i=null,!e&&t&&(t.close(),t=null)},isAudioFileStream:function(e){return e===r},isSupported:function(){return"undefined"!=typeof AudioContext&&"function"==typeof AudioContext.prototype.createMediaStreamDestination&&"function"==typeof AudioContext.prototype.createMediaElementSource}}}()};function de(){var e=this;this.promise=new Promise((function(t,r){e.reject=r,e.resolve=t}))}function ce(e){return e.split("/").pop().split("?")[0].split("#")[0]}var le=function(){function e(t,r){c()(this,e),this.scriptURL=t,this.lateLoadedAssetsHash=r}return h()(e,[{key:"getIntegrity",value:function(){var e=ce(this.scriptURL),t=this.lateLoadedAssetsHash[e];return t||null}}]),e}();function he(e,t){var r=Math.max(e,t),i=Math.min(e,t);return r%i==0?i:he(r%i,i)}function fe(e,t){return e*t/he(e,t)}function pe(e,t,r,i,a,n,o){if(0==e||0==t)return!1;if(0!=a){var s=fe(e,a),u=s/e;e=s,t*=u}if(0!=n){var d=fe(t,n),c=d/t;t=d,e*=c}if(o.width<e||o.height<t)return!1;var l=o.width/e,h=o.height/t,f=l<h?l:h,p=e*f,v=t*f,m=o.x+(o.width-p)/2,g=o.y+(o.height-v)/2;0!=r&&(m-=m%r),0!=i&&(g-=g%i);var _={};return _.left=m,_.top=g,_.width=p,_.height=v,_}function ve(e,t){if(e===t)return!0;if(i(e)&&i(t)){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e)if(!ve(e[r],t[r]))return!1;return!0}function i(e){return"object"===o()(e)&&null!=e}}function me(){return r.e(1).then(r.t.bind(null,104,7))}function ge(e,t,r){if(e&&t.userId){var i=t.userId;if(t.webrtcflag){var a=r,n="self_view_debug_".concat(i);if(a){a.setAttribute("controls","");var o=a.parentNode;if(!o)return;var s=e.getVideoTracks()[0],u=s.getSettings(),d=u.width,c=void 0===d?0:d,l=u.height,h=void 0===l?0:l,f=[{elementId:"s_u_"+i,value:"userId: ".concat(i)},{elementId:"s_r_"+i,value:"stream resolutions: ".concat(c,"x").concat(h)},{elementId:"s_a_"+i,value:"stream active: ".concat(e.active)},{elementId:"s_m_"+i,value:"video track muted: ".concat(s.muted)},{elementId:"s_p_"+i,value:"video tag paused: ".concat(!!a.paused)},{elementId:"s_sr_"+i,value:"video tag src: ".concat(!!a.srcObject)}],p=o.querySelector("#".concat(n));p?(p.nextElementSibling&&o.removeChild(p.nextElementSibling),f.reverse().forEach((function(e){var t=e.elementId,r=e.value,i=o.querySelector("#".concat(t));i?i.innerText=r:p.insertAdjacentHTML("afterbegin",'<div id="'.concat(t,'" style="color: red; font-size: 12px; text-align: right; margin-right: 5px">').concat(r,"</div>"))}))):a.insertAdjacentHTML("afterend",'<div id="'.concat(n,'" style="position: absolute; top: 50%; transform: translate(0, -50%); right: 0px; padding-right:3px"></div>'))}else{var v=document.getElementById(n);if(v)v.parentNode.removeChild(v)}}}}function _e(e){var t=document.body,r=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];function i(){e()}return r.forEach((function(e){return t.addEventListener(e,i,!1)})),function(){r.forEach((function(e){return t.removeEventListener(e,i)}))}}function Se(e){var t=null==e?void 0:e.getVideoTracks();return!(null==t||!t.length)&&!t[0].muted}function Ee(e,t){(e<0||t<0||e>3e3||t>3e3)&&_.default.error("CANVASSIZE:".concat(e,"x").concat(t))}function be(e){var t={dom:null,id:""};if(e)if("string"==typeof e)t.dom=document.getElementById(e),t.id=e;else if(e instanceof HTMLElement){var r;t.dom=e,t.id=null==e||null===(r=e.getAttribute)||void 0===r?void 0:r.call(e,"id")}return t}},function(e,t,r){var i=r(61)();e.exports=i;try{regeneratorRuntime=i}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}},function(e,t,r){"use strict";r.d(t,"h",(function(){return o})),r.d(t,"d",(function(){return s})),r.d(t,"c",(function(){return u})),r.d(t,"b",(function(){return d})),r.d(t,"e",(function(){return c})),r.d(t,"f",(function(){return l})),r.d(t,"i",(function(){return h})),r.d(t,"a",(function(){return f})),r.d(t,"g",(function(){return p}));var i,a=r(16),n=r.n(a),o={ZOOM_CONNECTION_COMMAND:0,ZOOM_CONNECTION_AUDIO:1,ZOOM_CONNECTION_VIDEO:2,ZOOM_CONNECTION_SHARING_JPEG:3,ZOOM_CONNECTION_SHARING_VIDEO:4,ZOOM_CONNECTION_MEDIA_LOG:5,ZOOM_CONNECTION_SHARING_REMOTE_CONTROL:6,ZOOM_CONNECTION_UNKNOW:7},s={NET_WEBSOCKET:0,NET_DATACHANNEL:1,NET_WEBTRANSPORT:2},u={encode:1,decode:2},d={AUDIO:1,SHARING:2,VIDEO:3},c={UNKNOWN:0,WIN:1,MAC:2,PAD:3,MOBILE:4,CALL_IN:5,LINUX:6,WEB:7,CHROME:8},l={VIDEO_ENCODE:"0",VIDEO_DECODE:"1",AUDIO_ENCODE:"2",AUDIO_DECODE:"3",SHARING_ENCODE:"4",SHARING_DECODE:"5"},h=function(){var e={};for(var t in l)e[l[t]]="WCL_"+t;return e}(),f={ComputerAudio_Null:0,ComputerAudio_Connecting:1,ComputerAudio_Connected:2,DesktopAudio_Null:0,DesktopAudio_Connecting:1,DesktopAudio_Connected:2},p=(i={},n()(i,l.AUDIO_ENCODE,"audio.encode"),n()(i,l.AUDIO_DECODE,"audio.decode"),n()(i,l.VIDEO_ENCODE,"video.encode"),n()(i,l.VIDEO_DECODE,"video.decode"),n()(i,l.SHARING_ENCODE,"share.encode"),n()(i,l.SHARING_DECODE,"share.decode"),i)},function(e,t,r){"use strict";r.d(t,"C",(function(){return i})),r.d(t,"j",(function(){return a})),r.d(t,"t",(function(){return n})),r.d(t,"k",(function(){return o})),r.d(t,"v",(function(){return s})),r.d(t,"x",(function(){return u})),r.d(t,"p",(function(){return d})),r.d(t,"s",(function(){return c})),r.d(t,"q",(function(){return l})),r.d(t,"r",(function(){return h})),r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return p})),r.d(t,"w",(function(){return v})),r.d(t,"g",(function(){return m})),r.d(t,"y",(function(){return g})),r.d(t,"z",(function(){return _})),r.d(t,"A",(function(){return S})),r.d(t,"B",(function(){return E})),r.d(t,"e",(function(){return b})),r.d(t,"d",(function(){return y})),r.d(t,"c",(function(){return C})),r.d(t,"f",(function(){return A})),r.d(t,"n",(function(){return R})),r.d(t,"o",(function(){return I})),r.d(t,"m",(function(){return w})),r.d(t,"l",(function(){return T})),r.d(t,"h",(function(){return k})),r.d(t,"u",(function(){return D})),r.d(t,"i",(function(){return O}));var i={AVAILABLE:0,NOT_SUPPORTED:1,CANNOT_REQ_ADAPTER:2,CANNOT_REQ_DEVICE:3},a={UNDEFINED:0,WEBGL:1,WEBGPU:2,WEBGL_2:3},n={AVAILABLE:0,VIDEO:1,SHARE:2},o={IDLE:0,PENDING:1,READY:2,RENDERING:3},s={UNKNOWN:-1,BASE_LAYER:0,BLEND_LAYER:1},u={UNKNOWN:-1,EXTERNAL_TEX:0,GPU_TEX_YUV:1,GPU_TEX_RGBA:2,CLEAR_COLOR:3},d=0,c=1,l=2,h=3,f=[{u:1,v:0},{u:1,v:1},{u:0,v:1},{u:1,v:0},{u:0,v:0},{u:0,v:1}],p=[{x:1,y:1},{x:1,y:-1},{x:-1,y:-1},{x:1,y:1},{x:-1,y:1},{x:-1,y:-1}],v={VS_BASE:0,CURSOR:1,WATERMARK:2,MASK:3,END:4},m=["intel","nvidia","apple","amd","qualcomm","arm"],g="\n    struct VertexOutput {\n        @builtin(position) Position: vec4<f32>,\n        @location(0) uv: vec2<f32>,\n    };\n    \n    @vertex\n    fn vertex_main(\n        @builtin(vertex_index) VertexIndex: u32,\n        @location(0) vtxPos: vec2<f32>,\n        @location(1) uvPos: vec2<f32>\n    ) -> VertexOutput {\n    \n        var output: VertexOutput;\n        output.Position = vec4<f32>(vtxPos, 0.0, 1.0);\n        output.uv = uvPos;\n        return output;\n    }\n\n    @group(0) @binding(0) var vfSampler: sampler;\n    @group(0) @binding(1) var vfTexture: texture_external;\n    \n    @fragment\n    fn fragment_main(@location(0) uv : vec2<f32>) -> @location(0) vec4<f32> {\n        var color: vec4<f32> = textureSampleBaseClampToEdge(vfTexture, vfSampler, uv);\n        return color;\n    }\n",_="\n    struct VertexOutput {\n        @builtin(position) Position: vec4<f32>,\n        @location(0) uv: vec2<f32>,\n    };\n\n    @group(0) @binding(6) var<uniform> vertexUniforms: FsUniforms;\n    \n    @vertex\n    fn vertex_main(\n        @builtin(vertex_index) VertexIndex: u32,\n        @location(0) vtxPos: vec2<f32>,\n        @location(1) uvPos: vec2<f32>\n    ) -> VertexOutput {\n    \n        var output: VertexOutput;\n        output.Position = vec4<f32>(vtxPos, 0.0, 1.0);\n        if (vertexUniforms.rotation == 3) {\n            output.uv = 1 - uvPos;\n        } else {\n            output.uv = uvPos;\n        }\n        \n        return output;\n    }\n\n    struct FsUniforms {\n        yuvMode: f32,\n        colorRange: f32,\n        rotation: f32,\n    };\n    \n    @group(0) @binding(0) var yPlaneSampler: sampler;\n    @group(0) @binding(1) var uvPlaneSampler: sampler;\n    @group(0) @binding(2) var yPlaneTex: texture_2d<f32>;\n    @group(0) @binding(3) var uPlaneTex: texture_2d<f32>;\n    @group(0) @binding(4) var vPlaneTex: texture_2d<f32>;\n    @group(0) @binding(5) var<uniform> uniforms: FsUniforms;\n    // @group(0) @binding(7) var<storage, read_write> outputBuffer: array<f32>;\n    \n    @fragment\n    fn fragment_main(@location(0) uv : vec2<f32>) -> @location(0) vec4<f32> {\n        let y = textureSampleBaseClampToEdge(yPlaneTex, yPlaneSampler, uv).r;\n        var u: f32;\n        var v: f32;\n        if (uniforms.yuvMode == 1) {\n            u = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).r;\n            v = textureSampleBaseClampToEdge(vPlaneTex, uvPlaneSampler, uv).r;\n        } else {\n            u = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).r;\n            v = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).a;\n        }\n\n        const yuv2RGB_L = mat4x4(\n            1.1643835616, 0, 1.7927410714, -0.9729450750,\n            1.1643835616, -0.2132486143, -0.5329093286, 0.3014826655,\n            1.1643835616, 2.1124017857, 0, -1.1334022179,\n            0, 0, 0, 1\n        );\n\n        const yuv2RGB_F = mat4x4(\n            1.0, 0, 1.402, -.701,\n            1.0, -.34413, -.71414, .529135,\n            1.0, 1.772, 0, -.886,\n            0, 0, 0, 1\n        );\n\n        var color = vec4<f32>(y, u, v, 1.0);\n        if (uniforms.colorRange == 0) {\n            color = color * yuv2RGB_L;\n        } else {\n            color = color * yuv2RGB_F;\n        }\n\n        return color;\n    }\n",S="\n    struct VertexOutput {\n        @builtin(position) Position: vec4<f32>,\n        @location(0) uv: vec2<f32>,\n    };\n\n    @group(0) @binding(5) var<uniform> vertexUniforms: FsUniforms;\n    @vertex\n    fn vertex_main(\n        @builtin(vertex_index) VertexIndex: u32,\n        @location(0) vtxPos: vec2<f32>,\n        @location(1) uvPos: vec2<f32>\n    ) -> VertexOutput {\n    \n        var output: VertexOutput;\n        output.Position = vec4<f32>(vtxPos, 0.0, 1.0);\n        if (vertexUniforms.rotation == 3) {\n            output.uv = 1 - uvPos;\n        } else {\n            output.uv = uvPos;\n        }\n        return output;\n    }\n\n    struct FsUniforms {\n        yuvMode: f32,\n        colorRange: f32,\n        rotation: f32,\n    };\n    \n    @group(0) @binding(0) var yPlaneSampler: sampler;\n    @group(0) @binding(1) var uvPlaneSampler: sampler;\n    @group(0) @binding(2) var yPlaneTex: texture_2d<f32>;\n    @group(0) @binding(3) var uPlaneTex: texture_2d<f32>;\n    @group(0) @binding(4) var<uniform> uniforms: FsUniforms;\n    // @group(0) @binding(5) var<storage, read_write> outputBuffer: array<f32>;\n    \n    @fragment\n    fn fragment_main(@location(0) uv : vec2<f32>) -> @location(0) vec4<f32> {\n        let y = textureSampleBaseClampToEdge(yPlaneTex, yPlaneSampler, uv).r;\n        var u: f32;\n        var v: f32;\n        u = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).r;\n        v = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).g;\n\n        const yuv2RGB_L = mat4x4(\n            1.1643835616, 0, 1.7927410714, -0.9729450750,\n            1.1643835616, -0.2132486143, -0.5329093286, 0.3014826655,\n            1.1643835616, 2.1124017857, 0, -1.1334022179,\n            0, 0, 0, 1\n        );\n\n        const yuv2RGB_F = mat4x4(\n            1.0, 0, 1.402, -.701,\n            1.0, -.34413, -.71414, .529135,\n            1.0, 1.772, 0, -.886,\n            0, 0, 0, 1\n        );\n\n        var color = vec4<f32>(y, u, v, 1.0);\n        if (uniforms.colorRange == 0) {\n            color = color * yuv2RGB_L;\n        } else {\n            color = color * yuv2RGB_F;\n        }\n\n        // outputBuffer[0] = y;\n        // outputBuffer[1] = u;\n        // outputBuffer[2] = v;\n        // outputBuffer[3] = color.r;\n        // outputBuffer[4] = color.g;\n        // outputBuffer[5] = color.b;\n        // outputBuffer[6] = color.a;\n\n        return color;\n    }\n",E="\n    @group(0) @binding(0) var watermarkSampler: sampler;\n    @group(0) @binding(1) var watermarkTex: texture_2d<f32>;\n\n    struct VertexOutput {\n        @builtin(position) Position: vec4<f32>,\n        @location(0) uv: vec2<f32>,\n    };\n\n    @vertex\n    fn v_main(\n        @builtin(vertex_index) VertexIndex: u32,\n        @location(0) pos: vec2<f32>,\n        @location(1) uvPos: vec2<f32>\n    ) -> VertexOutput {\n\n        var output: VertexOutput;\n        output.Position = vec4<f32>(pos, 0.0, 1.0);\n        output.uv = uvPos;\n        return output;\n    }\n\n    @fragment\n    fn f_main(@location(0) uv: vec2<f32>) -> @location(0) vec4<f32> {\n        var color: vec4<f32> = textureSampleBaseClampToEdge(watermarkTex, watermarkSampler, uv);\n        if (color.r == 0 && color.g == 0 && color.b == 0) {\n            color.a = 0;\n        }\n        return color;\n    }\n",b="\n\n    struct FsUniforms {\n        cursorFlag: f32,\n        cursorInfo: vec4f\n    };\n\n    @group(0) @binding(0) var cursorSampler: sampler;\n    @group(0) @binding(1) var cursorTex: texture_2d<f32>;\n    @group(0) @binding(2) var<uniform> uniforms: FsUniforms;\n\n    struct VertexOutput {\n        @builtin(position) Position: vec4<f32>,\n        @location(0) uv: vec2<f32>,\n    };\n\n    @vertex\n    fn v_main(\n        @builtin(vertex_index) VertexIndex: u32,\n        @location(0) pos: vec2<f32>,\n        @location(1) uvPos: vec2<f32>\n    ) -> VertexOutput {\n\n        var output: VertexOutput;\n        output.Position = vec4<f32>(pos, 0.0, 1.0);\n        output.uv = uvPos;\n        return output;\n    }\n\n    @fragment\n    fn f_main(@location(0) uv: vec2<f32>) -> @location(0) vec4<f32> {\n        var color: vec4<f32> = textureSampleBaseClampToEdge(cursorTex, cursorSampler, uv);\n        // if (uniforms.cursorFlag == 1) {\n        //     if (uniforms.cursorInfo.z > 0.0 \n        //         && uv.x >= uniforms.cursorInfo.x\n        //         && uv.y >= uniforms.cursorInfo.y\n        //         && uv.x < uniforms.cursorInfo.x + uniforms.cursorInfo.z\n        //         && uv.y < uniforms.cursorInfo.y + uniforms.cursorInfo.w) {\n\n        //         var cursorCoord: vec2f = uv - uniforms.cursorInfo.xy;\n        //         cursorCoord = cursorCoord / uniforms.cursorInfo.zw;\n        //         var cursorColor: vec4<f32> = textureSampleBaseClampToEdge(cursorTex, cursorSampler, cursorCoord);\n        //         color = color * (1.0 - cursorColor.a) + cursorColor * cursorColor.a;\n        //     }\n        // }\n\n        return color;\n    }\n",y="\n    @vertex\n    fn v_main(\n        @builtin(vertex_index) VertexIndex: u32,\n        @location(0) vtxPos: vec2<f32>,\n    ) -> @builtin(position) vec4<f32> {\n        return vec4<f32>(vtxPos, 0.0, 1.0);\n    }\n    \n    @fragment\n    fn f_main() -> @location(0) vec4<f32> {\n        return vec4(0.0, 0.0, 0.0, 1.0);\n    }\n",C="\n    @vertex\n    fn v_main(\n        @builtin(vertex_index) VertexIndex: u32,\n        @location(0) vtxPos: vec2<f32>,\n    ) -> @builtin(position) vec4<f32> {\n        return vec4<f32>(vtxPos, 0.0, 1.0);\n    }\n\n    struct ClearColorUniforms {\n        clearColor: vec4<f32>,\n    };\n\n    @group(0) @binding(0) var<uniform> uniforms: ClearColorUniforms;\n    @fragment\n    fn f_main() -> @location(0) vec4<f32> {\n        return uniforms.clearColor;\n    }\n",A={TEXTURE_BUFFER:0,VERTEX_BUFFER:1,TEXTURE:2},R={LOW:0,MEDIUM:1,HIGH:2,OVERUSE:3},I={LOW:6e4,MEDIUM:45e3,HIGH:3e4,OVERUSE:15e3},w=[60,120,180,360,540,720,1080,2160],T={VIDEO_FRAME:0,YUV_I420:1,YUV_NV12:2,RGBA_WATERMARK:3,RGBA_CURSOR:4,CLEAR_COLOR:5},k=6,D=[180,360,540,720,1080,2160],O=5},function(e,t,r){"use strict";r.r(t);var i=r(2),a=r(0),n=r(9),o={AEWF:"Audio encode WASM failed to download/compile",ADWF:"Audio decode WASM failed to download/compile",VDWF:"Video decode WASM failed to download/compile",VEWF:"Video encode WASM failed to download/compile",SEWF:"Sharing encode WASM failed to download/compile",SDWF:"Sharing decode WASM failed to download/compile",MWCGLF:"WebGL context failed to be restored",VCFF:"Captured video format is not supported",SHHF:"Initialization of sharing decode WASM failed",SDSF:"Sharing decode WebSocket failed to connect after 10 attempts",SEHF:"Initialization of sharing encode WASM failed",SESF:"Sharing encode WebSocket failed to connect after 10 attempts",ADHF:"Initialization of audio decode WASM failed",ADSF:"Audio decode WebSocket failed to connect after 10 attempts",AEHF:"Initialization of audio encode WASM failed",AESF:"Audio encode WebSocket failed to connect after 10 attempts",VDHF:"Initialization of video decode WASM failed",VDSF:"Video decode WebSocket failed to connect after 10 attempts",VEHF:"Initialization of video encode WASM failed",VESF:"Video encode WebSocket failed to connect after 10 attempts",INITVDCERR:"An error occurred when initializing video WebRTC DataChannel",INITADCERR:"An error occurred when initializing audio WebRTC DataChannel"},s=function(){function e(){this.base_time=null,this.monitor="",this.last_get_monitor_time=0,this.checkIsNecessaryLogMap=new Map,this.highfrequencyerror=new Map}return e.prototype={init:function(){this.base_time||(this.base_time=(new Date).getTime(),this.checkIsNecessaryLogMap=new Map,this.add_monitor("STARTMONITOR"+this.base_time))},add_monitor:function(e,t){if(this.base_time||this.init(),e)try{if(o[e]){var r=o[e];t&&(r="".concat(r,". Additional information: ").concat(t)),n.default.error(r)}var i=!1;"F"!=e[e.length-1]&&"f"!=e[e.length-1]||(i=!0);var a=(new Date).getTime()-this.base_time;this.monitor?this.monitor=this.monitor+e+"("+Math.ceil(a)+")":this.monitor=e+"("+Math.ceil(a)+")",this.monitor.length>2e3&&(i=!0),i&&this.send_instant_monitor()}catch(e){n.default.error("Error when adding data to the monitor log",e)}},get_monitor:function(){var e=this.monitor,t=(new Date).getTime();return null!=e&&(e.length>80||t-this.last_get_monitor_time>180)?(this.last_get_monitor_time=t,this.monitor=null,"WCL_M, "+e):""},get_instant_monitor:function(){var e=this.monitor;return this.monitor=null,"WCL_M, "+e},send_instant_monitor:function(){var e=this.get_instant_monitor();e&&a.default.sendMessageToRwg(i.MONITOR_LOG,{evt:i.RWG_MONITOR_LOG_EVENT,seq:1,body:{data:e}})},add_monitor2:function(e){if(this.base_time||this.init(),e){var t=(new Date).getTime()-this.base_time;this.monitor?this.monitor=this.monitor+e+"("+t+")":this.monitor=e+"("+t+")"}},add_monitor3:function(e){(this.base_time||this.init(),e)&&(this.highfrequencyerror[e]?this.highfrequencyerror[e]+=1:this.highfrequencyerror[e]=1,Object(n.isPowerOf2)(this.highfrequencyerror[e])&&this.add_monitor(e,"Occurred ".concat(this.highfrequencyerror[e]," times")))},checkIsNecessaryExceptionLogAndReturnRepeatTimes:function(e){var t=this,r=!0,i=0;try{return this.checkIsNecessaryLogMap.get(e)&&this.checkIsNecessaryLogMap.get(e)%100!=0&&(r=!1),{isNecessary:r,repeatNumber:void 0===(i=this.checkIsNecessaryLogMap.get(e))?0:i}}catch(e){return{isNecessary:!0,repeatNumber:0}}finally{var a=this.checkIsNecessaryLogMap.get(e)||0;if(this.checkIsNecessaryLogMap.set(e,a+1),this.checkIsNecessaryLogMap.size>200){var n=Array.from(this.checkIsNecessaryLogMap.keys()).slice(0,20);console.log("delete log cache keys",n),n.forEach((function(e){return t.checkIsNecessaryLogMap.delete(e)}))}}},reset:function(){this.base_time=null,this.last_get_monitor_time=0,this.monitor="",this.highfrequencyerror.clear()}},new e}();t.default=s},function(e,t,r){var i=r(100),a=r(48);e.exports=function(e,t,r){var n=a(e,t,"set");return i(e,n,r),r},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";r.r(t),r.d(t,"isPowerOf2",(function(){return u})),r.d(t,"GlobalTracingLogger",(function(){return s}));var i=r(12),a=r.n(i),n=r(13),o=r.n(n),s=function(){function e(){a()(this,e),this._highFrequencyLogs={}}return o()(e,[{key:"setInstance",value:function(e){this._instance=e}},{key:"getMessageFromErrorOrEvent",value:function(e,t){var r=e;return t instanceof ErrorEvent?(t.filename&&(r+=" File: ".concat(t.filename)),(t.lineno||t.colno)&&(r+=" Line: ".concat(t.lineno,":").concat(t.colno)),t.message&&(r+=" Message: ".concat(t.message)),t.error&&(r+="\nStack: ".concat(t.error.stack))):t instanceof Error?(t.fileName&&(r+=" File: ".concat(t.fileName)),(t.lineNumber||t.columnNumber)&&(r+=" Line: ".concat(t.lineNumber,":").concat(t.columnNumber)),t.message&&(r+=" Message: ".concat(t.message)),t.stack&&(r+=" Stack: ".concat(t.stack)),t.name&&(r+=" Name: ".concat(t.name)),t.constraint&&(r+=" Constraint: ".concat(t.constraint))):t instanceof CloseEvent?(t.code&&(r+=" Code: ".concat(t.code)),t.reason&&(r+=" Reason: ".concat(t.reason)),r+=" wasClean: ".concat(t.wasClean)):t instanceof DOMException?(t.message&&(r+=" Message: ".concat(t.message)),t.name&&(r+=" Name: ".concat(t.name))):r+=t?t.toString():"",r}},{key:"error",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e=this.getMessageFromErrorOrEvent(e,t),this._highFrequencyLogs[e]?this._highFrequencyLogs[e]+=1:this._highFrequencyLogs[e]=1;var r=u(this._highFrequencyLogs[e]);this._instance&&r&&this._instance.error(e)}},{key:"severityerror",value:function(e,t){this._instance&&this._instance.error(JSON.stringify(e),t)}},{key:"warn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e=this.getMessageFromErrorOrEvent(e,t),this._instance&&this._instance.warn(e)}},{key:"log",value:function(e){this._instance&&this._instance.log(e)}},{key:"clearHighFrequencyLogs",value:function(){this._highFrequencyLogs={}}}]),e}(),u=function(e){return 0==(e&e-1)},d=new s;t.default=d},function(e,t,r){"use strict";r.d(t,"k",(function(){return i})),r.d(t,"Y",(function(){return a})),r.d(t,"e",(function(){return n})),r.d(t,"p",(function(){return o})),r.d(t,"u",(function(){return s})),r.d(t,"ab",(function(){return u})),r.d(t,"J",(function(){return d})),r.d(t,"R",(function(){return c})),r.d(t,"d",(function(){return l})),r.d(t,"j",(function(){return h})),r.d(t,"V",(function(){return f})),r.d(t,"M",(function(){return p})),r.d(t,"K",(function(){return v})),r.d(t,"i",(function(){return m})),r.d(t,"h",(function(){return g})),r.d(t,"o",(function(){return _})),r.d(t,"T",(function(){return S})),r.d(t,"W",(function(){return E})),r.d(t,"S",(function(){return b})),r.d(t,"U",(function(){return y})),r.d(t,"O",(function(){return C})),r.d(t,"Z",(function(){return A})),r.d(t,"s",(function(){return R})),r.d(t,"t",(function(){return I})),r.d(t,"P",(function(){return w})),r.d(t,"q",(function(){return T})),r.d(t,"Q",(function(){return k})),r.d(t,"X",(function(){return D})),r.d(t,"G",(function(){return O})),r.d(t,"F",(function(){return M})),r.d(t,"H",(function(){return x})),r.d(t,"E",(function(){return P})),r.d(t,"D",(function(){return N})),r.d(t,"db",(function(){return V})),r.d(t,"bb",(function(){return U})),r.d(t,"eb",(function(){return L})),r.d(t,"cb",(function(){return W})),r.d(t,"r",(function(){return B})),r.d(t,"a",(function(){return G})),r.d(t,"m",(function(){return F})),r.d(t,"n",(function(){return H})),r.d(t,"l",(function(){return j})),r.d(t,"y",(function(){return K})),r.d(t,"A",(function(){return q})),r.d(t,"B",(function(){return X})),r.d(t,"w",(function(){return Y})),r.d(t,"x",(function(){return z})),r.d(t,"I",(function(){return Q})),r.d(t,"z",(function(){return J})),r.d(t,"C",(function(){return Z})),r.d(t,"L",(function(){return $})),r.d(t,"v",(function(){return ee})),r.d(t,"gb",(function(){return te})),r.d(t,"fb",(function(){return re})),r.d(t,"N",(function(){return ie})),r.d(t,"c",(function(){return ae})),r.d(t,"b",(function(){return ne})),r.d(t,"f",(function(){return oe})),r.d(t,"g",(function(){return se}));var i=30,a=35,n=48,o=61,s=-26,u=-27,d=-129,c=-130,l=-131,h=50,f=51,p=52,v=53,m=66.5,g=66.6,_=78,S=-1,E=0,b=1,y=2,C=3,A=!0,R=30,I=1,w=24,T=10,k=8294400,D={DESKTOP:0,MOBILE:1,ANDROID:2,IPHONE:3},O=0,M=1,x=-1,P=0,N=1,V=0,U=1,L=2,W=U+L,B=25,G=1,F=-1,H=0,j=1,K=0,q=1,X=2|q,Y=4|q,z=X|Y,Q=8,J=16,Z=3,$=107,ee="100",te="101",re="102",ie="WCL_M,isWebEnabled:1, isLocalEnabled:1, isSmartBkgnd:1, bkgType:2",ae=0,ne=1,oe=2,se=3},function(e,t){function r(e,t,r,i,a,n,o){try{var s=e[n](o),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(i,a)}e.exports=function(e){return function(){var t=this,i=arguments;return new Promise((function(a,n){var o=e.apply(t,i);function s(e){r(o,a,n,s,u,"next",e)}function u(e){r(o,a,n,s,u,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(41);function a(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,i(a.key),a)}}e.exports=function(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return l})),r.d(t,"f",(function(){return h})),r.d(t,"d",(function(){return f})),r.d(t,"g",(function(){return p})),r.d(t,"c",(function(){return v})),r.d(t,"e",(function(){return g}));var i=r(12),a=r.n(i),n=r(13),o=r.n(n),s=(r(11),r(4),r(10)),u=r(9);function d(){return self.GROWABLE_HEAP_U8?self.GROWABLE_HEAP_U8():Module.HEAPU8}var c="undefined"!=typeof window;function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;c?u.default.error(e,t):h(e,t)}function h(e){var t,r,i,a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(n instanceof Error||n instanceof ErrorEvent)&&(e+="Message: "+(null===(t=n)||void 0===t?void 0:t.message)+" Stack: "+(null!==(r=null===(i=n)||void 0===i||null===(i=i.error)||void 0===i?void 0:i.stack)&&void 0!==r?r:null===(a=n)||void 0===a?void 0:a.stack),n=null);postMessage({status:s.p,errorMessage:e,errorEvent:n})}function f(e){postMessage({status:s.Y,data:e})}function p(e){postMessage({status:s.u,canvasId:e,replaceCanvas:!1})}var v=function(){function e(t){a()(this,e),this.sharedBufferList=t}return o()(e,[{key:"storeFlexible",value:function(e,t){var r=e.byteLength-this.sharedBufferList.bytesPerElement;if(r>0){var i=Math.floor(.1*this.sharedBufferList.bytesPerElement),a=r>i?r:i;if(a+this.sharedBufferList.bytesPerElement>t)return Promise.reject("too big, more than maxBytesPerElement");this.sharedBufferList.increaseBufferSize(a)}return this.store(e)}},{key:"store",value:function(e){var t=this;return this.sharedBufferList.get().then((function(r){try{return t.obj=r,r.uint8s.set(e,0),t.yuvdata=new Uint8Array(r.uint8s.buffer,0,e.byteLength),!0}catch(e){throw e}finally{t.autoRecycle()}}))}},{key:"storeSync",value:function(e){var t=this.sharedBufferList.getSync();return null!==t&&(this.obj=t,t.uint8s.set(e,0),this.yuvdata=new Uint8Array(t.uint8s.buffer,0,e.byteLength),!0)}},{key:"autoRecycle",value:function(){var e=this;this.autoRecycleInterval=setTimeout((function(){console.log("autoRecycle",e.obj.index),e.recycle()}),5e3)}},{key:"recycle",value:function(){try{this.autoRecycleInterval&&clearInterval(this.autoRecycleInterval),this.sharedBufferList.recycle(this.obj.index)}catch(e){h("Error in YuvWrap.recycle: ".concat(e))}}}]),e}();var m=["","MOZ_","OP_","WEBKIT_"];function g(e,t){for(var r=0;r<m.length;++r){var i=m[r]+t,a=e.getExtension(i);if(a)return a}}var _=function(){function e(){a()(this,e),this.ssrcInfoMap=new Map,this.timer=null}return o()(e,[{key:"updateSSRCInfo",value:function(e,t){this.ssrcInfoMap.has(e)||this.ssrcInfoMap.set(e,{firstTime:0,lastTime:0,frames:0,fps:0}),this._calculateFPS(e,t),this._removeZeroFPS()}},{key:"_calculateFPS",value:function(e,t){var r=this.ssrcInfoMap.get(e);if(0===r.frames?r.firstTime=t:r.lastTime=t,r.frames+=1,r.frames>2&&r.frames%5==0&&r.lastTime-r.firstTime>=1e3){var i=Math.floor(1e3/((r.lastTime-r.firstTime)/(r.frames-1)));r.fps!==i&&(this._notifyFPS(e,i),r.fps=i),r.firstTime=r.lastTime,r.frames=1}}},{key:"_removeZeroFPS",value:function(){var e=this,t=Date.now();this.ssrcInfoMap.forEach((function(r,i){var a=e.ssrcInfoMap.get(i);a&&t-a.lastTime>2e3&&(e.ssrcInfoMap.delete(i),e._notifyFPS(i,0))}))}},{key:"_notifyFPS",value:function(e,t){postMessage({status:s.h,data:{ssrc:e,fps:t}})}},{key:"_checkIfNewFrameComing",value:function(){var e=this;this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout((function(){e._removeZeroFPS(),e.timer=null}),2500)}}]),e}();new Map,new _},function(e,t,r){var i=r(66),a=r(67),n=r(40),o=r(68);e.exports=function(e,t){return i(e)||a(e,t)||n(e,t)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(41);e.exports=function(e,t,r){return(t=i(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";var i=r(38),a=r(51),n=i;r.n(a)()(i)&&(n=window.PubSub);var o=function(){};o.prototype={publish:function(){return n.publish.apply(this,arguments)},publishSync:function(){return n.publishSync.apply(this,arguments)},trigger:function(){return this.publish.apply(this,arguments)},triggerSync:function(){return this.publishSync.apply(this,arguments)},emit:function(){return this.publish.apply(this,arguments)},subscribe:function(){return n.subscribe.apply(this,arguments)},on:function(){return this.subscribe.apply(this,arguments)},unsubscribe:function(){return n.unsubscribe.apply(this,arguments)},clearAllSubscriptions:function(){n.clearAllSubscriptions()}},t.a=new o},function(e,t,r){var i=r(57),a=r(58),n=r(40),o=r(59);e.exports=function(e){return i(e)||a(e)||n(e)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function r(t){return e.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function r(t){return e.exports=r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";function i(){this.a=[],this.b=0,this.residue=null}i.prototype.getLength=function(){return this.a.length-this.b},i.prototype.isEmpty=function(){return 0==this.a.length},i.prototype.enqueue=function(e){this.a.push(e)},i.prototype.dequeue=function(){if(0!=this.a.length){var e=this.a[this.b];return 2*++this.b>=this.a.length&&(this.a=this.a.slice(this.b),this.b=0),e}return null},i.prototype.peek=function(){return 0<this.a.length?this.a[this.b]:void 0},i.prototype.clear=function(){this.a=[],this.b=0},t.a=i},function(e,t,r){"use strict";var i=r(18),a=r.n(i),n=r(19),o="object"===("undefined"==typeof localStorage?"undefined":r.n(n)()(localStorage))&&localStorage.__islogdebug,s=function(e,t){function r(){var e=[];return e.push.apply(e,arguments),e}!0===t&&(o=!0);var i=function(){var t;o&&(t=console).log.apply(t,[e].concat(a()(r(arguments))))};return["log","info","warn","error"].forEach((function(t){i[t]=function(){var i;o&&(i=console)[t].apply(i,[e].concat(a()(r(arguments))))}})),i.isEnable=function(){return o},i};s.isEnable=function(){return o},t.a=s},function(e,t,r){var i=r(36);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(44),a="object"==typeof self&&self&&self.Object===Object&&self,n=i||a||Function("return this")();e.exports=n},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(19).default,a=r(25);e.exports=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return a(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(43),a=r(75),n=r(76),o=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":o&&o in Object(e)?a(e):n(e)}},function(e,t,r){var i=r(27),a=r(29);e.exports=function(e){return"number"==typeof e||a(e)&&"[object Number]"==i(e)}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,r){"use strict";var i=r(12),a=r.n(i),n=r(13),o=r.n(n),s=function(){function e(){a()(this,e)}return o()(e,[{key:"_drawWatermarkWithShadow",value:function(e){var t=e.ctx,r=e.textPos,i=e.opacity,a=e.name;t.fillStyle="rgba(0, 0, 0, ".concat(i,")"),t.fillText(a,r.x,r.y),t.fillStyle="rgba(255, 255, 255, ".concat(i,")"),t.fillText(a,r.x+1,r.y+1)}},{key:"_getTransformInfo",value:function(e){var t,r=e.canvas,i=e.position;if(1===i)t={x:r.width/2,y:0,rateRadio:0,maxWidth:r.width};else if(2===i)t={x:r.width/2,y:r.height,rateRadio:0,maxWidth:r.width};else if(4===i)t={x:0,y:r.height/2,rateRadio:Math.PI/2,maxWidth:r.height};else if(8===i)t={x:r.width,y:r.height/2,rateRadio:-Math.PI/2,maxWidth:r.height};else{var a=-21*Math.PI/180;t={x:r.width/2,y:r.height/2,rateRadio:a,maxWidth:Math.min(r.width/Math.cos(a),-r.height/Math.sin(a))}}return t.maxWidth>100&&(t.maxWidth-=50),t}},{key:"_calcTextPos",value:function(e){var t=e.position,r=e.ctx,i=e.name,a=e.textWidth,n=this._getPaddingWidth({ctx:r,position:t,name:i});return 1===t?{x:-a.width/2,y:n}:2===t||4===t||8===t?{x:-a.width/2,y:-n}:{x:-a.width/2,y:r.measureText(i[0]).width/2}}},{key:"_getPaddingWidth",value:function(e){var t=e.ctx,r=e.position,i=e.name;return[1,2,4,8].includes(r)?32:t.measureText(i[0]).width}},{key:"_setBaseLine",value:function(e){var t=e.ctx,r=e.position;t.textBaseline=1===r?"top":2===r||4===r||8===r?"bottom":"middle"}},{key:"Get_WaterMarkRGBA",value:function(e){var t=e.canvas,r=e.name,i=e.width,a=e.height,n=e.opacity,o=void 0===n?.15:n,s=e.position,u=e.convertToDataUrl;if(r&&i&&a){o=o||.15;i*=1,a*=1,t.width=i,t.height=a;var d,c=this._getTransformInfo({canvas:t,position:s}),l=t.getContext("2d");if(l.clearRect(0,0,t.width,t.height),l.translate(c.x,c.y),l.rotate(c.rateRadio),this._setBaseLine({ctx:l,position:s}),l.lineWidth=1,l.imageSmoothingEnabled=!0,1==r.length){var h=c.maxWidth/r.length;l.font=h+"px  'Segoe UI'",d=l.measureText(r)}else{var f=16;for(l.font=f+"px  'Segoe UI'",d=l.measureText(r);d.width<c.maxWidth-2*this._getPaddingWidth({ctx:l,position:s,name:r});)f+=1,l.font=f+"px  'Segoe UI'",d=l.measureText(r);if(d.width>c.maxWidth-2*this._getPaddingWidth({ctx:l,position:s,name:r}))if(f>16)f-=1,l.font=f+"px  'Segoe UI'",d=l.measureText(r);else{for(var p=r;r.length>5&&d.width>c.maxWidth-2*this._getPaddingWidth({ctx:l,position:s,name:r+"..."});)r=r.slice(0,r.length-1),d=l.measureText(r+"...");p!==r&&(r+="...")}}var v,m=this._calcTextPos({position:s,ctx:l,name:r,textWidth:d});if(this._drawWatermarkWithShadow({ctx:l,name:r,opacity:o,textPos:m}),u)v=t.toDataURL();else{var g=l.getImageData(0,0,l.canvas.width,l.canvas.height);v=new Uint8Array(g.data.buffer)}return l.rotate(-c.rateRadio),l.translate(-c.x,-c.y),v}}},{key:"Get_Repeated_WaterMarkRGBA",value:function(e){var t=e.canvas,r=e.name,i=e.width,a=e.height,n=e.opacity,o=void 0===n?.15:n,s=(e.position,e.convertToDataUrl);if(r&&i&&a){o=o||.15;i*=1,a*=1,t.width=i,t.height=a;var u=t.getContext("2d");u.clearRect(0,0,t.width,t.height),u.translate(i/2,a/2),u.rotate(-21*Math.PI/180),u.imageSmoothingEnabled=!0;u.font="".concat(32,"px 'Segoe UI'"),u.textBaseline="top";var d,c=u.measureText(r),l=.37*c.width,h=0,f=-a;do{var p=h%2==0?l-i:-i;do{u.fillStyle="rgba(0, 0, 0, ".concat(o,")"),u.fillText(r,p,f),u.fillStyle="rgba(255, 255, 255, ".concat(o,")"),u.fillText(r,p+1,f+1),p+=c.width+l}while(p<i);f+=32+l,h++}while(f<a);if(s)d=t.toDataURL();else{var v=u.getImageData(0,0,u.canvas.width,u.canvas.height);d=new Uint8Array(v.data.buffer)}return u.rotate(21*Math.PI/180),u.translate(-i/2,-a/2),d}}}]),e}();t.a=s},function(e,t,r){var i=r(74),a=r(79);e.exports=function(e,t){var r=a(e,t);return i(r)?r:void 0}},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t,r){var i=r(27),a=r(32);e.exports=function(e){if(!a(e))return!1;var t=i(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},function(e,t,r){var i=r(95),a=r(32);e.exports=function(e,t,r){var n=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return a(r)&&(n="leading"in r?!!r.leading:n,o="trailing"in r?!!r.trailing:o),i(e,t,{leading:n,maxWait:t,trailing:o})}},function(t,r){t.exports=e},function(e,t){function r(t,i){return e.exports=r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,r(t,i)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){(function(e){!function(r,i){"use strict";var a={};r.PubSub=a;var n=r.define;!function(e){var t={},r=-1;function i(e){var t;for(t in e)if(e.hasOwnProperty(t))return!0;return!1}function a(e,t,r){try{e(t,r)}catch(e){setTimeout(function(e){return function(){throw e}}(e),0)}}function n(e,t,r){e(t,r)}function o(e,r,i,o){var s,u=t[r],d=o?n:a;if(t.hasOwnProperty(r))for(s in u)u.hasOwnProperty(s)&&d(u[s],e,i)}function s(e,r,a,n){var s=function(e,t,r){return function(){var i=String(e),a=i.lastIndexOf(".");for(o(e,e,t,r);-1!==a;)a=(i=i.substr(0,a)).lastIndexOf("."),o(e,i,t,r)}}(e,r,n);return!!function(e){for(var r=String(e),a=Boolean(t.hasOwnProperty(r)&&i(t[r])),n=r.lastIndexOf(".");!a&&-1!==n;)n=(r=r.substr(0,n)).lastIndexOf("."),a=Boolean(t.hasOwnProperty(r)&&i(t[r]));return a}(e)&&(!0===a?s():setTimeout(s,0),!0)}e.publish=function(t,r){return s(t,r,!1,e.immediateExceptions)},e.publishSync=function(t,r){return s(t,r,!0,e.immediateExceptions)},e.subscribe=function(e,i){if("function"!=typeof i)return!1;t.hasOwnProperty(e)||(t[e]={});var a="uid_"+String(++r);return t[e][a]=i,a},e.subscribeOnce=function(t,r){var i=e.subscribe(t,(function(){e.unsubscribe(i),r.apply(this,arguments)}));return e},e.clearAllSubscriptions=function(){t={}},e.clearSubscriptions=function(e){var r;for(r in t)t.hasOwnProperty(r)&&0===r.indexOf(e)&&delete t[r]},e.unsubscribe=function(r){var i,a,n,o="string"==typeof r&&(t.hasOwnProperty(r)||function(e){var r;for(r in t)if(t.hasOwnProperty(r)&&0===r.indexOf(e))return!0;return!1}(r)),s=!o&&"string"==typeof r,u="function"==typeof r,d=!1;if(!o){for(i in t)if(t.hasOwnProperty(i)){if(a=t[i],s&&a[r]){delete a[r],d=r;break}if(u)for(n in a)a.hasOwnProperty(n)&&a[n]===r&&(delete a[n],d=!0)}return d}e.clearSubscriptions(r)}}(a),"function"==typeof n&&n.amd?n((function(){return a})):(void 0!==e&&e.exports&&(t=e.exports=a),t.PubSub=a,e.exports=t=a)}("object"==typeof window&&window||this)}).call(this,r(37)(e))},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(39);e.exports=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(19).default,a=r(60);e.exports=function(e){var t=a(e,"string");return"symbol"===i(t)?t:String(t)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){var r=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||r)}},function(e,t,r){var i=r(24).Symbol;e.exports=i},function(e,t,r){(function(t){var r="object"==typeof t&&t&&t.Object===Object&&t;e.exports=r}).call(this,r(45))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){var r=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return r.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},function(e,t){e.exports=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(20),a=r(36),n=r(62),o=r(63);function s(t){var r="function"==typeof Map?new Map:void 0;return e.exports=s=function(e){if(null===e||!n(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return o(e,arguments,i(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),a(t,e)},e.exports.__esModule=!0,e.exports.default=e.exports,s(t)}e.exports=s,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(65);e.exports=function(e,t){if(null==e)return{};var r,a,n=i(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(69),a=r(72),n=r(84),o=r(86),s=r(87),u=r(88),d=r(42),c=r(90),l=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(s(e)&&(o(e)||"string"==typeof e||"function"==typeof e.splice||u(e)||c(e)||n(e)))return!e.length;var t=a(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(d(e))return!i(e).length;for(var r in e)if(l.call(e,r))return!1;return!0}},function(e,t,r){var i;!function(a,n){"use strict";var o="model",s="name",u="type",d="vendor",c="version",l="mobile",h="tablet",f="smarttv",p=function(e){for(var t={},r=0;r<e.length;r++)t[e[r].toUpperCase()]=e[r];return t},v=function(e,t){return"string"==typeof e&&-1!==m(t).indexOf(m(e))},m=function(e){return e.toLowerCase()},g=function(e,t){if("string"==typeof e)return e=e.replace(/^\s\s*/,""),void 0===t?e:e.substring(0,500)},_=function(e,t){for(var r,i,a,n,o,s,u=0;u<t.length&&!o;){var d=t[u],c=t[u+1];for(r=i=0;r<d.length&&!o&&d[r];)if(o=d[r++].exec(e))for(a=0;a<c.length;a++)s=o[++i],"object"==typeof(n=c[a])&&n.length>0?2===n.length?"function"==typeof n[1]?this[n[0]]=n[1].call(this,s):this[n[0]]=n[1]:3===n.length?"function"!=typeof n[1]||n[1].exec&&n[1].test?this[n[0]]=s?s.replace(n[1],n[2]):void 0:this[n[0]]=s?n[1].call(this,s,n[2]):void 0:4===n.length&&(this[n[0]]=s?n[3].call(this,s.replace(n[1],n[2])):void 0):this[n]=s||void 0;u+=2}},S=function(e,t){for(var r in t)if("object"==typeof t[r]&&t[r].length>0){for(var i=0;i<t[r].length;i++)if(v(t[r][i],e))return"?"===r?void 0:r}else if(v(t[r],e))return"?"===r?void 0:r;return e},E={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},b={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[c,[s,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[c,[s,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[s,c],[/opios[\/ ]+([\w\.]+)/i],[c,[s,"Opera Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[c,[s,"Opera GX"]],[/\bopr\/([\w\.]+)/i],[c,[s,"Opera"]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[c,[s,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[s,c],[/\bddg\/([\w\.]+)/i],[c,[s,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[c,[s,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[c,[s,"WeChat"]],[/konqueror\/([\w\.]+)/i],[c,[s,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[c,[s,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[c,[s,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[c,[s,"Smart Lenovo Browser"]],[/(avast|avg)\/([\w\.]+)/i],[[s,/(.+)/,"$1 Secure Browser"],c],[/\bfocus\/([\w\.]+)/i],[c,[s,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[c,[s,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[c,[s,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[c,[s,"Dolphin"]],[/coast\/([\w\.]+)/i],[c,[s,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[c,[s,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[c,[s,"Firefox"]],[/\bqihu|(qi?ho?o?|360)browser/i],[[s,"360 Browser"]],[/(oculus|sailfish|huawei|vivo)browser\/([\w\.]+)/i],[[s,/(.+)/,"$1 Browser"],c],[/samsungbrowser\/([\w\.]+)/i],[c,[s,"Samsung Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[s,/_/g," "],c],[/metasr[\/ ]?([\d\.]+)/i],[c,[s,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[s,"Sogou Mobile"],c],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[s,c],[/(lbbrowser)/i,/\[(linkedin)app\]/i],[s],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[s,"Facebook"],c],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[s,c],[/\bgsa\/([\w\.]+) .*safari\//i],[c,[s,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[c,[s,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[c,[s,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[s,"Chrome WebView"],c],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[c,[s,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[s,c],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[c,[s,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[c,s],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[s,[c,S,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[s,c],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[s,"Netscape"],c],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[c,[s,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[s,c],[/(cobalt)\/([\w\.]+)/i],[s,[c,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",m]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[["architecture","arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[["architecture","armhf"]],[/windows (ce|mobile); ppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[["architecture",/ower/,"",m]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[["architecture",m]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[o,[d,"Samsung"],[u,h]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[o,[d,"Samsung"],[u,l]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[o,[d,"Apple"],[u,l]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[o,[d,"Apple"],[u,h]],[/(macintosh);/i],[o,[d,"Apple"]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[o,[d,"Sharp"],[u,l]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[o,[d,"Huawei"],[u,h]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[o,[d,"Huawei"],[u,l]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[o,/_/g," "],[d,"Xiaomi"],[u,l]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[o,/_/g," "],[d,"Xiaomi"],[u,h]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[o,[d,"OPPO"],[u,l]],[/\b(opd2\d{3}a?) bui/i],[o,[d,"OPPO"],[u,h]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[o,[d,"Vivo"],[u,l]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[o,[d,"Realme"],[u,l]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[o,[d,"Motorola"],[u,l]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[o,[d,"Motorola"],[u,h]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[o,[d,"LG"],[u,h]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[o,[d,"LG"],[u,l]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[o,[d,"Lenovo"],[u,h]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[o,/_/g," "],[d,"Nokia"],[u,l]],[/(pixel c)\b/i],[o,[d,"Google"],[u,h]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[o,[d,"Google"],[u,l]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[o,[d,"Sony"],[u,l]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[o,"Xperia Tablet"],[d,"Sony"],[u,h]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[o,[d,"OnePlus"],[u,l]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[o,[d,"Amazon"],[u,h]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[o,/(.+)/g,"Fire Phone $1"],[d,"Amazon"],[u,l]],[/(playbook);[-\w\),; ]+(rim)/i],[o,d,[u,h]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[o,[d,"BlackBerry"],[u,l]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[o,[d,"ASUS"],[u,h]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[o,[d,"ASUS"],[u,l]],[/(nexus 9)/i],[o,[d,"HTC"],[u,h]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[d,[o,/_/g," "],[u,l]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[o,[d,"Acer"],[u,h]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[o,[d,"Meizu"],[u,l]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[o,[d,"Ulefone"],[u,l]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[d,o,[u,l]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[d,o,[u,h]],[/(surface duo)/i],[o,[d,"Microsoft"],[u,h]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[o,[d,"Fairphone"],[u,l]],[/(u304aa)/i],[o,[d,"AT&T"],[u,l]],[/\bsie-(\w*)/i],[o,[d,"Siemens"],[u,l]],[/\b(rct\w+) b/i],[o,[d,"RCA"],[u,h]],[/\b(venue[\d ]{2,7}) b/i],[o,[d,"Dell"],[u,h]],[/\b(q(?:mv|ta)\w+) b/i],[o,[d,"Verizon"],[u,h]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[o,[d,"Barnes & Noble"],[u,h]],[/\b(tm\d{3}\w+) b/i],[o,[d,"NuVision"],[u,h]],[/\b(k88) b/i],[o,[d,"ZTE"],[u,h]],[/\b(nx\d{3}j) b/i],[o,[d,"ZTE"],[u,l]],[/\b(gen\d{3}) b.+49h/i],[o,[d,"Swiss"],[u,l]],[/\b(zur\d{3}) b/i],[o,[d,"Swiss"],[u,h]],[/\b((zeki)?tb.*\b) b/i],[o,[d,"Zeki"],[u,h]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[d,"Dragon Touch"],o,[u,h]],[/\b(ns-?\w{0,9}) b/i],[o,[d,"Insignia"],[u,h]],[/\b((nxa|next)-?\w{0,9}) b/i],[o,[d,"NextBook"],[u,h]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[d,"Voice"],o,[u,l]],[/\b(lvtel\-)?(v1[12]) b/i],[[d,"LvTel"],o,[u,l]],[/\b(ph-1) /i],[o,[d,"Essential"],[u,l]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[o,[d,"Envizen"],[u,h]],[/\b(trio[-\w\. ]+) b/i],[o,[d,"MachSpeed"],[u,h]],[/\btu_(1491) b/i],[o,[d,"Rotor"],[u,h]],[/(shield[\w ]+) b/i],[o,[d,"Nvidia"],[u,h]],[/(sprint) (\w+)/i],[d,o,[u,l]],[/(kin\.[onetw]{3})/i],[[o,/\./g," "],[d,"Microsoft"],[u,l]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[o,[d,"Zebra"],[u,h]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[o,[d,"Zebra"],[u,l]],[/smart-tv.+(samsung)/i],[d,[u,f]],[/hbbtv.+maple;(\d+)/i],[[o,/^/,"SmartTV"],[d,"Samsung"],[u,f]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[d,"LG"],[u,f]],[/(apple) ?tv/i],[d,[o,"Apple TV"],[u,f]],[/crkey/i],[[o,"Chromecast"],[d,"Google"],[u,f]],[/droid.+aft(\w+)( bui|\))/i],[o,[d,"Amazon"],[u,f]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[o,[d,"Sharp"],[u,f]],[/(bravia[\w ]+)( bui|\))/i],[o,[d,"Sony"],[u,f]],[/(mitv-\w{5}) bui/i],[o,[d,"Xiaomi"],[u,f]],[/Hbbtv.*(technisat) (.*);/i],[d,o,[u,f]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[d,g],[o,g],[u,f]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[u,f]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[d,o,[u,"console"]],[/droid.+; (shield) bui/i],[o,[d,"Nvidia"],[u,"console"]],[/(playstation [345portablevi]+)/i],[o,[d,"Sony"],[u,"console"]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[o,[d,"Microsoft"],[u,"console"]],[/((pebble))app/i],[d,o,[u,"wearable"]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[o,[d,"Apple"],[u,"wearable"]],[/droid.+; (glass) \d/i],[o,[d,"Google"],[u,"wearable"]],[/droid.+; (wt63?0{2,3})\)/i],[o,[d,"Zebra"],[u,"wearable"]],[/(quest( \d| pro)?)/i],[o,[d,"Facebook"],[u,"wearable"]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[d,[u,"embedded"]],[/(aeobc)\b/i],[o,[d,"Amazon"],[u,"embedded"]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[o,[u,l]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[o,[u,h]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[u,h]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[u,l]],[/(android[-\w\. ]{0,9});.+buil/i],[o,[d,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[c,[s,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[c,[s,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[s,c],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[c,s]],os:[[/microsoft (windows) (vista|xp)/i],[s,c],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[s,[c,S,E]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[c,S,E],[s,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[c,/_/g,"."],[s,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[s,"Mac OS"],[c,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[c,s],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[s,c],[/\(bb(10);/i],[c,[s,"BlackBerry"]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[c,[s,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[c,[s,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[c,[s,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[c,[s,"watchOS"]],[/crkey\/([\d\.]+)/i],[c,[s,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[s,"Chromium OS"],c],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[s,c],[/(sunos) ?([\w\.\d]*)/i],[[s,"Solaris"],c],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[s,c]]},y=function(e,t){if("object"==typeof e&&(t=e,e=void 0),!(this instanceof y))return new y(e,t).getResult();var r=void 0!==a&&a.navigator?a.navigator:void 0,i=e||(r&&r.userAgent?r.userAgent:""),n=r&&r.userAgentData?r.userAgentData:void 0,d=t?function(e,t){var r={};for(var i in e)t[i]&&t[i].length%2==0?r[i]=t[i].concat(e[i]):r[i]=e[i];return r}(b,t):b,f=r&&r.userAgent==i;return this.getBrowser=function(){var e,t={};return t[s]=void 0,t[c]=void 0,_.call(t,i,d.browser),t.major="string"==typeof(e=t[c])?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0,f&&r&&r.brave&&"function"==typeof r.brave.isBrave&&(t[s]="Brave"),t},this.getCPU=function(){var e={architecture:void 0};return _.call(e,i,d.cpu),e},this.getDevice=function(){var e={vendor:void 0,model:void 0,type:void 0};return _.call(e,i,d.device),f&&!e[u]&&n&&n.mobile&&(e[u]=l),f&&"Macintosh"==e[o]&&r&&void 0!==r.standalone&&r.maxTouchPoints&&r.maxTouchPoints>2&&(e[o]="iPad",e[u]=h),e},this.getEngine=function(){var e={name:void 0,version:void 0};return _.call(e,i,d.engine),e},this.getOS=function(){var e={name:void 0,version:void 0};return _.call(e,i,d.os),f&&!e[s]&&n&&n.platform&&"Unknown"!=n.platform&&(e[s]=n.platform.replace(/chrome os/i,"Chromium OS").replace(/macos/i,"Mac OS")),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i="string"==typeof e&&e.length>500?g(e,500):e,this},this.setUA(i),this};y.VERSION="1.0.38",y.BROWSER=p([s,c,"major"]),y.CPU=p(["architecture"]),y.DEVICE=p([o,d,u,"console",l,f,h,"wearable","embedded"]),y.ENGINE=y.OS=p([s,c]),void 0!==t?(void 0!==e&&e.exports&&(t=e.exports=y),t.UAParser=y):r(94)?void 0===(i=function(){return y}.call(t,r,t,e))||(e.exports=i):void 0!==a&&(a.UAParser=y);var C=void 0!==a&&(a.jQuery||a.Zepto);if(C&&!C.ua){var A=new y;C.ua=A.getResult(),C.ua.get=function(){return A.getUA()},C.ua.set=function(e){A.setUA(e);var t=A.getResult();for(var r in t)C.ua[r]=t[r]}}}("object"==typeof window?window:this)},function(e,t,r){"use strict";(function(e){var i=r(11),a=r.n(i),n=r(4),o=r.n(n),s=r(34),u=r.n(s),d=r(22),c=r(17),l=r(2),h=r(28),f=r.n(h),p=r(54),v=r.n(p),m=r(3),g=r(5),_=Object(d.a)("sdk.remoteControl"),S=0,E=0,b=83,y=82,C=84,A=85,R=87,I=88;function w(e){var t=this;this.dom=e.dom,this.socketURL=e.socketURL,this.meetingID=e.meetingID,this.condID=e.condID,this.blobSocket=null;var r=this._keyMouseEventHandler.bind(this);this.keyMouseEventHandler=function(e){t.keyMouseFilters(e).then((function(e){r(e)}))},this.keyMouseEventHandlerThrottle=u()((function(e){t.keyMouseEventHandler(e)}),1e3/24),this.pasteOnDocument=this._pasteOnDocument.bind(this),this.copyOnDocument=this._copyOnDocument.bind(this),this.cutOnDocument=this._cutOnDocument.bind(this),this.focus=this._focus.bind(this),this.PUBSUB_SHARING_PARAM_INFO_TOKEN=null,this.preventDefault=this._preventDefault.bind(this),this.browserBlurEventHandler=this._browserBlurEventHandler.bind(this),this.positionMap={canvas:{offsetX:0,offsetY:0},src:{x:0,y:0,w:0,h:0,scaleWidth:0,scaleHeight:0},dst:{x:0,y:0,w:0,h:0}},this.blockedKeyboardEventOfPaste=[],this.keydownupMergeRemoveMap={},this.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map={},this.PASTE_MAX_BYTE_LENGTH=64e3,this.currentMousePositionProps={clientX:0,clientY:0,x2video:0,y2video:0},this.isControllerNow=!0,this.remoteOS=g.e.UNKNOWN,this.localOS=this.getLocalOS(),this._blockedCopyKeyboardList=[],this.maxSleep=500}w.prototype={start:function(){var e=this;return new Promise(function(){var t=a()(o.a.mark((function t(r,i){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,_("remote control start"),e.modifyDom(),e.bindEvent(),e.subscribeSharingWidthOrHeightChange(),t.next=7,e.connectSocket();case 7:e.sendPostionPDU(),e.socketBlobMessageHandler(),r(!0),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),i(t.t0);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(e,r){return t.apply(this,arguments)}}())},destroy:function(){var e=this;return new Promise((function(t,r){try{_("destroy remote control"),e.unbindEvent(),e.uncheckAndClearKeydownupMergeRemoveMap(),e.destroySocket(),c.a.unsubscribe(e.PUBSUB_SHARING_PARAM_INFO_TOKEN),t(!0)}catch(e){_(e),t(!1)}}))},modifyDom:function(){try{this.dom.setAttribute("tabindex","0"),this.dom.focus()}catch(e){}},_focus:function(){this.dom.focus()},getLocalOS:function(){var t=e.navigator.platform;return/win/i.test(t)?g.e.WIN:/mac/i.test(t)?g.e.MAC:g.e.UNKNOWN},setIsControlerNow:function(e){this.isControllerNow=e},blobSocketCheckAndSend:function(e){this.isControllerNow&&this.blobSocket.send(e)},isKeyboardEvent:function(e){return!!e&&(e.type&&-1!==["keydown","keyup"].indexOf(e.type.toLowerCase()))},isThisKeyIgnoreCase:function(e,t){return e.key&&e.key.toLowerCase()==t.toLowerCase()},_copyOnDocument:function(e){var t=this;return a()(o.a.mark((function r(){var i;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.isFocusNow()){r.next=2;break}return r.abrupt("return");case 2:if(i=t._blockedCopyKeyboardList,"done"!=i[i.length-1]){r.next=8;break}return r.abrupt("return");case 8:t._blockedCopyKeyboardList=[],t._blockedCopyKeyboardList.push("done");case 10:_("copyOnDocument",e),t.processMonitorCtrlMetaWithKey("c");case 12:case"end":return r.stop()}}),r)})))()},_cutOnDocument:function(e){var t=this;return a()(o.a.mark((function r(){return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.isFocusNow()){r.next=2;break}return r.abrupt("return");case 2:_("_cutOnDocument",e),t.processMonitorCtrlMetaWithKey("x");case 4:case"end":return r.stop()}}),r)})))()},processMonitorCtrlMetaWithKey:function(e){var t=this,r=0,i=1,a=2,n=this.remoteOS===g.e.MAC,o={t:"keydown",event_type:1,repeat:!1,alt:!1,shift:!1,capslock:!1,numlock:!0,pduType:A,ctrl:!n,super:n},s=Object.assign({},o,{charCode:0,keyCode:n?91:17,key:n?"Meta":"Control"}),u=Object.assign({},o,{charCode:e.charCodeAt(0),keyCode:e.toUpperCase().charCodeAt(0),key:e}),d=Object.assign({},s,{input_event_type:r}),c=(Object.assign({},s,{input_event_type:a}),Object.assign({},u,{input_event_type:r})),l=(Object.assign({},u,{input_event_type:a}),Object.assign({},s,{t:"keyup",ctrl:!1,super:!1,input_event_type:i})),h=Object.assign({},u,{t:"keyup",ctrl:!1,super:n,input_event_type:i});(n?[d,c,h,l]:[d,c,l,h]).forEach((function(e){t.processEvent(e)}))},isFocusNow:function(){return this.dom===document.activeElement},_pasteOnDocument:function(e){var t=this;return a()(o.a.mark((function r(){var i,a,n,s,u,d,c,l,h,f,p;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.isFocusNow()){for(i=(e.clipboardData||window.clipboardData).getData("text"),_("_pasteOnDocument",i),a=[],n=0;n<i.length;n++)for(s=i[n],u=v.a.encode(s),d=0;d<u.length;d++)a.push(u.charCodeAt(d));for(c=new ArrayBuffer(8+a.length),l=new Uint8Array(c),h=new DataView(c,4,4),f=new Uint8Array(c,8),l[0]=R,h.setUint32(0,a.length,!0),p=0;p<a.length;p++)f[p]=a[p];a.length>t.PASTE_MAX_BYTE_LENGTH?(t.triggerPasteTextLengthOverflow(),t.dropAllEventFromBlockedKeyboardEventOfPaste()):(t.blobSocketCheckAndSend(c),t.processMonitorCtrlMetaWithKey("v"))}case 1:case"end":return r.stop()}}),r)})))()},onReturnCopiedText:function(e){!this._onReturnCopiedText_list&&(this._onReturnCopiedText_list=[]),this._onReturnCopiedText_list.push(e)},triggerReturnCopiedText:function(e){this._onReturnCopiedText_list&&this._onReturnCopiedText_list.forEach((function(t){return t(e)}))},onPasteTextLengthOverflow:function(e){!this._onPasteTextLengthOverflow_list&&(this._onPasteTextLengthOverflow_list=[]),this._onPasteTextLengthOverflow_list.push(e)},triggerPasteTextLengthOverflow:function(){this._onPasteTextLengthOverflow_list&&this._onPasteTextLengthOverflow_list.forEach((function(e){return e()}))},dropAllEventFromBlockedKeyboardEventOfPaste:function(){this.blockedKeyboardEventOfPaste=[]},createParamsFromKeyboardEvent:function(e){return{key:e.key,code:e.code,shiftKey:e.shiftKey,altKey:e.altKey,repeat:e.repeat,charCode:e.charCode,keyCode:e.keyCode,which:e.which,ctrlKey:e.ctrlKey,metaKey:e.metaKey}},sendAllEventFromBlockedKeyboardEventOfPaste:function(){for(_("blockedKeyboardEventOfPaste.length",this.blockedKeyboardEventOfPaste.length);this.blockedKeyboardEventOfPaste.length>0;){var e=this.blockedKeyboardEventOfPaste.shift();this._keyMouseEventHandler(e)}},_preventDefault:function(e){if(-1!==["keydown","keyup"].indexOf(e.type))for(var t=["v","c","x"],r=0;r<t.length;r++)if(e.ctrlKey^e.metaKey&&this.isThisKeyIgnoreCase(e,t[r]))return;e.preventDefault()},subscribeSharingWidthOrHeightChange:function(){var e=this;this.PUBSUB_SHARING_PARAM_INFO_TOKEN=c.a.on(l.SHARING_PARAM_INFO_FROM_SOCKET,(function(t,r){_("subscribeSharingWidthOrHeightChange",r.body),e.positionMap.dst.w=r.body.logicWidth,e.positionMap.dst.h=r.body.logicHeight,e.positionMap.src.w=r.body.logicWidth,e.positionMap.src.h=r.body.logicHeight,e.sendPostionPDU()}))},setDstWidthAndHeight:function(e,t){if(!e||!t)throw new Error("the value of destination sharing video width/height are not correct");this.positionMap.dst.w=e,this.positionMap.dst.h=t},setSrcWidthAndHeight:function(e,t){if(!e||!t)throw new Error("the value of source sharing video width/height are not correct");this.positionMap.src.w=e,this.positionMap.src.h=t},setSrcWidthAndHeightAndSendPDU:function(e,t){if(!e||!t)throw new Error("the value of source sharing video width/height are not correct");this.positionMap.src.w!==e&&this.positionMap.src.h!==t&&(this.setSrcWidthAndHeight(e,t),this.sendPostionPDU())},setSrcOffsetXYAndSendPDU:function(e,t){e=Math.floor(e),t=Math.floor(t),this.positionMap.canvas.offsetX===e&&this.positionMap.canvas.offsetY===t||(this.setSrcOffsetXY(e,t),this.sendPostionPDU())},setSrcScaleWidthAndHeight:function(e,t){if(!e||!t)throw new Error("the value of source sharing video scaleWidth/scaleHeight are not correct");this.positionMap.src.scaleWidth=e,this.positionMap.src.scaleHeight=t},setSrcOffsetXY:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=Math.floor(e),i=Math.floor(t);if(!f()(r)&&!f()(i))throw new Error("the value of source offset x or y is not correct");this.positionMap.canvas.offsetX=r,this.positionMap.canvas.offsetY=i},sendPostionPDU:function(){var e=new ArrayBuffer(36),t=new Uint8Array(e),r=new DataView(e,4),i=new DataView(e,20);t[0]=y,r.setInt32(0,this.positionMap.src.x,!0),r.setInt32(4,this.positionMap.src.y,!0),r.setInt32(8,this.positionMap.src.w,!0),r.setInt32(12,this.positionMap.src.h,!0),i.setInt32(0,this.positionMap.dst.x,!0),i.setInt32(4,this.positionMap.dst.y,!0),i.setInt32(8,this.positionMap.dst.w,!0),i.setInt32(12,this.positionMap.dst.h,!0),_("send position pdu");try{this.blobSocket.send(e)}catch(e){}},unbindEvent:function(){var e=this.dom;e.removeEventListener("click",this.focus),e.removeEventListener("keydown",this.keyMouseEventHandler),e.removeEventListener("keyup",this.keyMouseEventHandler),document.removeEventListener("paste",this.pasteOnDocument),document.removeEventListener("copy",this.copyOnDocument),document.removeEventListener("cut",this.cutOnDocument),e.removeEventListener("contextmenu",this.preventDefault),e.removeEventListener("wheel",this.preventDefault),e.removeEventListener("dblclick",this.preventDefault),e.removeEventListener("keydown",this.preventDefault),e.removeEventListener("keyup",this.preventDefault),e.removeEventListener("dblclick",this.keyMouseEventHandler),e.removeEventListener("mousedown",this.keyMouseEventHandler),e.removeEventListener("mouseup",this.keyMouseEventHandler),e.removeEventListener("mousemove",this.keyMouseEventHandlerThrottle),e.removeEventListener("wheel",this.keyMouseEventHandler),window.removeEventListener("blur",this.browserBlurEventHandler)},bindEvent:function(){var e=this.dom;_("dom",e),e.addEventListener("click",this.focus),e.addEventListener("keydown",this.keyMouseEventHandler),e.addEventListener("keyup",this.keyMouseEventHandler),document.addEventListener("paste",this.pasteOnDocument),document.addEventListener("copy",this.copyOnDocument),document.addEventListener("cut",this.cutOnDocument),e.addEventListener("contextmenu",this.preventDefault),e.addEventListener("wheel",this.preventDefault),e.addEventListener("dblclick",this.preventDefault),e.addEventListener("keydown",this.preventDefault),e.addEventListener("keyup",this.preventDefault),e.addEventListener("dblclick",this.keyMouseEventHandler),e.addEventListener("mousedown",this.keyMouseEventHandler),e.addEventListener("mouseup",this.keyMouseEventHandler),e.addEventListener("mousemove",this.keyMouseEventHandlerThrottle),e.addEventListener("wheel",this.keyMouseEventHandler),window.addEventListener("blur",this.browserBlurEventHandler)},recordCurrentMousePosition:function(e){try{var t=this.positionMap,r=e.clientX,i=e.clientY;Object.assign(this.currentMousePositionProps,{clientX:r,clientY:i,x2video:r-t.canvas.offsetX,y2video:i-t.canvas.offsetY})}catch(e){}},resolvePosition:function(e){var t=e.clientX,r=e.clientY,i=this.positionMap;return t-=i.canvas.offsetX,r-=i.canvas.offsetY,t*=i.dst.w/i.src.scaleWidth,r*=i.dst.h/i.src.scaleHeight,{x:t=Math.floor(t),y:r=Math.floor(r)}},generateBuffer:function(e){if(void 0!==e.key&&!/^[\x00-\x7F]*$/.test(e.key))throw new Error("params.key must only contain ascii character");var t=8;(e=Object.assign({v:0,x:0,y:0,dx:0,dy:0,repeat:0},e)).pduType===C&&(t+=4);var r=new ArrayBuffer(t),i=new Uint8Array(r),a=new DataView(r,4),n=new DataView(r,4);if(i[0]=e.pduType,i[1]=63&e.input_event_type,e.pduType===b)a.setUint16(0,e.x,!0),a.setUint16(2,e.y,!0);else if(e.pduType===C)n.setInt16(0,e.x,!0),n.setInt16(2,e.y,!0),n.setInt16(4,e.dx,!0),n.setInt16(6,e.dy,!0);else if(e.pduType===A){var o=new DataView(r,4),s=new DataView(r,6),u=new Uint8Array(r,2);o.setUint16(0,e.keyCode,!0),s.setUint16(0,e.charCode,!0);var d={shift:1,capslock:2,ctrl:4,alt:8,numlock:16,super:32},c=0;Object.keys(d).forEach((function(t){!0===e[t]&&(c+=d[t])})),u[0]=c,e.repeat&&(i[1]=32|i[1])}return r},processEvent:function(e){this.blobSocket&&this.blobSocketCheckAndSend(this.generateBuffer(e))},debug:function(e){var t={};(e.pduType===A?["t","keyCode","charCode","key"]:["t","x","y","dx","dy","input_event_type"]).forEach((function(r){t[r]=e[r]})),_("debug",JSON.stringify(t))},blockedPasteKeyboard:function(e){var t=this;return new Promise((function(r,i){t.isKeyboardEvent(e)&&t.isPasteEvent(e)?t.blockedKeyboardEventOfPaste.push(e):r(e)}))},isPasteEvent:function(e){var t=this.isThisKeyIgnoreCase(e,"v");return!!(e.ctrlKey^e.metaKey&&t)},isCopyEvent:function(e){var t=this.isThisKeyIgnoreCase(e,"c");return!!(e.ctrlKey^e.metaKey&&t)},isCutEvent:function(e){var t=this.isThisKeyIgnoreCase(e,"x");return!!(e.ctrlKey^e.metaKey&&t)},returnNewEventByTransformCtrlKeyOrCommandKey:function(e){var t=this.createParamsFromKeyboardEvent(e);switch(this.remoteOS){case g.e.WIN:Object.assign(t,{ctrlKey:!0,metaKey:!1});break;case g.e.MAC:Object.assign(t,{ctrlKey:!1,metaKey:!0});break;case g.e.UNKNOWN:}return new e.constructor(e.type,t)},transformCtrlCAndCommandC:function(e){var t=this,r=this;return new Promise((function(i,a){if(t.isKeyboardEvent(e)&&(e.ctrlKey||e.metaKey)&&r.isThisKeyIgnoreCase(e,"c")){r.createParamsFromKeyboardEvent(e);i(r.returnNewEventByTransformCtrlKeyOrCommandKey(e))}else i(e)}))},keyMouseEventHandlerFilter_MatainKeyDownUpMergeMap:function(e){var t=this;return new Promise((function(r,i){try{t.isKeyboardEvent(e)&&e.key&&("keydown"!==e.type||e.repeat||(t.keydownupMergeRemoveMap[e.key]={t:+new Date,e:e}),"keydown"===e.type&&e.repeat&&delete t.keydownupMergeRemoveMap[e.key],"keyup"===e.type&&delete t.keydownupMergeRemoveMap[e.key])}catch(e){_.error(e)}r(e)}))},_browserBlurEventHandler:function(){this._checkAndClearKeydownupMergeRemoveMap(this.maxSleep,!0)},checkAndClearKeydownupMergeRemoveMap:function(){var e=this,t=this;this.checkAndClearKeydownupMergeRemoveMapInterval=setInterval((function(){t._checkAndClearKeydownupMergeRemoveMap(e.maxSleep)}),100)},_checkAndClearKeydownupMergeRemoveMap:function(e,t){var r=this,i=this.keydownupMergeRemoveMap;Object.keys(i).forEach((function(a){var n=i[a];if(+new Date-n.t>=e||t){var o=new n.e.constructor("keyup",n.e);try{r._keyMouseEventHandler(o)}catch(e){}delete r.keydownupMergeRemoveMap[a]}}))},uncheckAndClearKeydownupMergeRemoveMap:function(){this._checkAndClearKeydownupMergeRemoveMap(0),clearInterval(this.checkAndClearKeydownupMergeRemoveMapInterval)},keyMouseFilters:function(e){var t=this;return new Promise((function(t,r){t(e)})).then((function(e){return t.blockedPasteKeyboard(e)})).then((function(e){return t.blockedCopyKeyboard(e)})).then((function(e){return t.blockedCutKeyboard(e)})).then((function(e){return t.keyMouseEventHandlerFilter_MatainKeyDownUpMergeMap(e)})).then((function(e){return t.blockedSomeKeyboardEventNotHaveKeydownBefore(e)})).then((function(e){return t.keyMouseEventHandlerFilter_EVERY_KEYUP_MUST_HAVE_KEYDOWN_BEFORE(e)}))},blockedSingleMetaKey:function(e){var t=this;return new Promise((function(r,i){t.isKeyboardEvent(e)&&e.key&&(/command/i.test(e.key)||/meta/i.test(e.key)||/control/i.test(e.key))&&!e.shiftKey&&!e.altKey&&e.ctrlKey^e.metaKey||r(e)}))},blockedCutKeyboard:function(e){var t=this;return new Promise((function(r,i){t.isKeyboardEvent(e)&&t.isCutEvent(e)||r(e)}))},blockedCopyKeyboard:function(e){var t=this;return new Promise((function(r,i){t.isKeyboardEvent(e)&&t.isCopyEvent(e)?t._blockedCopyKeyboardList.push(e):r(e)}))},blockedSomeKeyboardEventNotHaveKeydownBefore:function(e){var t=this;return new Promise((function(r,i){if(t.isKeyboardEvent(e)&&e.key){var a=!1;if(["x","c","v"].forEach((function(r){t.isThisKeyIgnoreCase(e,r)&&(a=!0)})),"keyup"===e.type&&a)if(!!!t.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map[e.key])return}r(e)}))},keyMouseEventHandlerFilter_EVERY_KEYUP_MUST_HAVE_KEYDOWN_BEFORE:function(e){var t=this;return new Promise((function(r,i){try{if(t.isKeyboardEvent(e)&&e.key&&("keydown"===e.type&&(t.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map[e.key]=e),"keyup"===e.type)){var a=!!t.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map[e.key];delete t.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map[e.key];var n=!1;if(["meta"].forEach((function(r){t.isThisKeyIgnoreCase(e,r)&&(n=!0)})),!a&&!n){_.warn("keyup trigger, but no keydown before");var o=new e.constructor("keydown",e);t._keyMouseEventHandler(o)}}}catch(e){_.error(e)}r(e)}))},_keyMouseEventHandler:function(e){this.isKeyboardEvent(e)&&_("_keyMouseEventHandler keyboard",e);var t={},r={keydown:0,keyup:1,keychar:2},i={mousemove:0,mousedown:{left:1,right:4,middle:7},mouseup:{left:2,right:5,middle:8},mouseleftdbldown:3,mouserightdbldown:6,wheel:10},a=e.getModifierState?function(t){return e.getModifierState(t)}:function(e,t){return t},n=S,o=e.key&&1===e.key.length;if(-1!==["keydown","keyup"].indexOf(e.type))t.event_type=1,n=A,void 0!==r[e.type]&&(t.input_event_type=r[e.type]);else{if(-1===["mousedown","mouseup","mousemove","wheel","click","dblclick","contextmenu"].indexOf(e.type))return void _.warn("the event type cannot be handled");t.event_type=0,this.recordCurrentMousePosition(e);var s=this.resolvePosition(e);if(Object.assign(t,{x:s.x,y:s.y}),n="wheel"===e.type?C:b,void 0!==i[e.type]&&(t.input_event_type=i[e.type]),-1!==["mousedown","mouseup"].indexOf(e.type)){var u;switch(e.button){case 0:u="left";break;case 1:u="middle";break;case 2:u="right";break;default:u="left"}t.input_event_type=i[e.type][u]}-1!==["dblclick"].indexOf(e.type)&&(t.input_event_type=i.mouseleftdbldown)}if("wheel"===e.type){var d={deltaX:"dx",deltaY:"dy"};Object.keys(d).forEach((function(r){e[r]&&(t[d[r]]=e[r]>0?-100:100)}))}var c=this.ctrlMetaConvert({keyCode:e.keyCode,key:e.key,ctrlKey:e.ctrlKey,metaKey:e.metaKey});Object.assign(t,{t:e.type,pduType:n,keyCode:c.keyCode,charCode:o?e.key.charCodeAt(0):0,key:c.key,repeat:e.repeat,ctrl:c.ctrlKey,alt:e.altKey,super:c.metaKey,shift:e.shiftKey,capslock:a("CapsLock",!1),numlock:a("NumLock",!1)}),this.isKeyboardEvent(e)&&_("processEvent",JSON.stringify(t)),this.processEvent(t)},ctrlMetaConvert:function(e){var t=e.metaKey,r=e.ctrlKey;return(this.remoteOS===g.e.MAC&&this.localOS===g.e.WIN||this.remoteOS===g.e.WIN&&this.localOS===g.e.MAC)&&e.key&&(/Meta/i.test(e.key)?(e.ctrlKey=!0,e.keyCode=17,e.metaKey=r,e.key="Control"):/Control/i.test(e.key)&&(e.metaKey=!0,e.keyCode=91,e.ctrlKey=t,e.key="Meta")),e},isCapslock:function(e){var t=e.keyCode,r=e.key,i=e.shiftKey;return!!/[a-zA-Z]/.test(r)&&(r.charCodeAt(0)!==t?!i:i)},stop:function(){var e=this;return a()(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.blobSocket&&e.blobSocket.close(),e.blobSocket=null;case 2:case"end":return t.stop()}}),t)})))()},connectSocket:function(){var e=this;return a()(o.a.mark((function t(){var r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.createBlobSocket("".concat(e.socketURL,"/wc/media/").concat(e.meetingID,"?type=r&mode=2&cid=").concat(e.condID));case 2:return(r=t.sent).binaryType="blob",e.blobSocket=r,t.abrupt("return",!0);case 6:case"end":return t.stop()}}),t)})))()},socketBlobMessageHandler:function(){if(this.blobSocket){var e=this;this.blobSocket.addEventListener("message",function(){var t=a()(o.a.mark((function t(r){var i,a,n,s,u,d,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=r.data,t.next=3,m.default.readBlobAsBuffer(i,i.size);case 3:if(a=t.sent,n=new Int8Array(a),(s=n[0])!==I||!e.isControllerNow){t.next=14;break}return u=i.slice(8),t.next=10,m.default.readBlob(u);case 10:d=t.sent,c=n[4],_("COPY_TEXT_FROM_RWG",d,c),e.triggerReturnCopiedText({data:d,x:e.currentMousePositionProps.x2video,y:e.currentMousePositionProps.y2video});case 14:s===E&&e.blobSocket.send(a);case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},destroySocket:function(){try{this.blobSocket.close(),this.blobSocket=null}catch(e){_("destroySocket",e)}},createBlobSocket:function(e){return new Promise((function(t,r){var i=new WebSocket(e);i.addEventListener("open",(function(){})),i.addEventListener("message",(function(e){try{var r=JSON.parse(e.data);0===r.evt&&r.body&&t(i)}catch(e){}})),i.addEventListener("error",(function(e){r(e)})),i.addEventListener("close",(function(){r(new Error("socket close"))}))}))},setRemoteOS:function(e){void 0!==e&&(this.remoteOS=e)}},t.a=w}).call(this,r(45))},function(e,t,r){!function(e){var t,r,i,a=String.fromCharCode;function n(e){for(var t,r,i=[],a=0,n=e.length;a<n;)(t=e.charCodeAt(a++))>=55296&&t<=56319&&a<n?56320==(64512&(r=e.charCodeAt(a++)))?i.push(((1023&t)<<10)+(1023&r)+65536):(i.push(t),a--):i.push(t);return i}function o(e){if(e>=55296&&e<=57343)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function s(e,t){return a(e>>t&63|128)}function u(e){if(0==(4294967168&e))return a(e);var t="";return 0==(4294965248&e)?t=a(e>>6&31|192):0==(4294901760&e)?(o(e),t=a(e>>12&15|224),t+=s(e,6)):0==(4292870144&e)&&(t=a(e>>18&7|240),t+=s(e,12),t+=s(e,6)),t+=a(63&e|128)}function d(){if(i>=r)throw Error("Invalid byte index");var e=255&t[i];if(i++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function c(){var e,a;if(i>r)throw Error("Invalid byte index");if(i==r)return!1;if(e=255&t[i],i++,0==(128&e))return e;if(192==(224&e)){if((a=(31&e)<<6|d())>=128)return a;throw Error("Invalid continuation byte")}if(224==(240&e)){if((a=(15&e)<<12|d()<<6|d())>=2048)return o(a),a;throw Error("Invalid continuation byte")}if(240==(248&e)&&(a=(7&e)<<18|d()<<12|d()<<6|d())>=65536&&a<=1114111)return a;throw Error("Invalid UTF-8 detected")}e.version="3.0.0",e.encode=function(e){for(var t=n(e),r=t.length,i=-1,a="";++i<r;)a+=u(t[i]);return a},e.decode=function(e){t=n(e),r=t.length,i=0;for(var o,s=[];!1!==(o=c());)s.push(o);return function(e){for(var t,r=e.length,i=-1,n="";++i<r;)(t=e[i])>65535&&(n+=a((t-=65536)>>>10&1023|55296),t=56320|1023&t),n+=a(t);return n}(s)}}(t)},function(e,t,r){var i=r(27),a=r(29);e.exports=function(e){return!0===e||!1===e||a(e)&&"[object Boolean]"==i(e)}},function(e,t,r){var i=r(101).default;e.exports=i},function(e,t,r){var i=r(39);e.exports=function(e){if(Array.isArray(e))return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(19).default;e.exports=function(e,t){if("object"!==i(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!==i(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(19).default;function a(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */e.exports=a=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",d=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function h(e,t,r,i){var a=t&&t.prototype instanceof v?t:v,n=Object.create(a.prototype),s=new T(i||[]);return o(n,"_invoke",{value:A(e,r,s)}),n}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p={};function v(){}function m(){}function g(){}var _={};l(_,u,(function(){return this}));var S=Object.getPrototypeOf,E=S&&S(S(k([])));E&&E!==r&&n.call(E,u)&&(_=E);var b=g.prototype=v.prototype=Object.create(_);function y(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){var r;o(this,"_invoke",{value:function(a,o){function s(){return new t((function(r,s){!function r(a,o,s,u){var d=f(e[a],e,o);if("throw"!==d.type){var c=d.arg,l=c.value;return l&&"object"==i(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,s,u)}),(function(e){r("throw",e,s,u)})):t.resolve(l).then((function(e){c.value=e,s(c)}),(function(e){return r("throw",e,s,u)}))}u(d.arg)}(a,o,r,s)}))}return r=r?r.then(s,s):s()}})}function A(e,t,r){var i="suspendedStart";return function(a,n){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw n;return D()}for(r.method=a,r.arg=n;;){var o=r.delegate;if(o){var s=R(o,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===i)throw i="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i="executing";var u=f(e,t,r);if("normal"===u.type){if(i=r.done?"completed":"suspendedYield",u.arg===p)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i="completed",r.method="throw",r.arg=u.arg)}}}function R(e,t){var r=t.method,i=e.iterator[r];if(void 0===i)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,R(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var a=f(i,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,p;var n=a.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function k(e){if(e){var t=e[u];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:D}}function D(){return{value:void 0,done:!0}}return m.prototype=g,o(b,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:m,configurable:!0}),m.displayName=l(g,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,l(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},t.awrap=function(e){return{__await:e}},y(C.prototype),l(C.prototype,d,(function(){return this})),t.AsyncIterator=C,t.async=function(e,r,i,a,n){void 0===n&&(n=Promise);var o=new C(h(e,r,i,a),n);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},y(b),l(b,c,"Generator"),l(b,u,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var i in t)r.push(i);return r.reverse(),function e(){for(;r.length;){var i=r.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=k,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return o.type="throw",o.arg=e,t.next=r,i&&(t.method="next",t.arg=void 0),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var a=i.arg;w(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:k(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},t}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(36),a=r(64);function n(t,r,o){return a()?(e.exports=n=Reflect.construct.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=n=function(e,t,r){var a=[null];a.push.apply(a,t);var n=new(Function.bind.apply(e,a));return r&&i(n,r.prototype),n},e.exports.__esModule=!0,e.exports.default=e.exports),n.apply(null,arguments)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){if(null==e)return{};var r,i,a={},n=Object.keys(e);for(i=0;i<n.length;i++)r=n[i],t.indexOf(r)>=0||(a[r]=e[r]);return a},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var i,a,n,o,s=[],u=!0,d=!1;try{if(n=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(i=n.call(r)).done)&&(s.push(i.value),s.length!==t);u=!0);}catch(e){d=!0,a=e}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(d)throw a}}return s}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var i=r(42),a=r(70),n=Object.prototype.hasOwnProperty;e.exports=function(e){if(!i(e))return a(e);var t=[];for(var r in Object(e))n.call(e,r)&&"constructor"!=r&&t.push(r);return t}},function(e,t,r){var i=r(71)(Object.keys,Object);e.exports=i},function(e,t){e.exports=function(e,t){return function(r){return e(t(r))}}},function(e,t,r){var i=r(73),a=r(80),n=r(81),o=r(82),s=r(83),u=r(27),d=r(46),c=d(i),l=d(a),h=d(n),f=d(o),p=d(s),v=u;(i&&"[object DataView]"!=v(new i(new ArrayBuffer(1)))||a&&"[object Map]"!=v(new a)||n&&"[object Promise]"!=v(n.resolve())||o&&"[object Set]"!=v(new o)||s&&"[object WeakMap]"!=v(new s))&&(v=function(e){var t=u(e),r="[object Object]"==t?e.constructor:void 0,i=r?d(r):"";if(i)switch(i){case c:return"[object DataView]";case l:return"[object Map]";case h:return"[object Promise]";case f:return"[object Set]";case p:return"[object WeakMap]"}return t}),e.exports=v},function(e,t,r){var i=r(31)(r(24),"DataView");e.exports=i},function(e,t,r){var i=r(33),a=r(77),n=r(32),o=r(46),s=/^\[object .+?Constructor\]$/,u=Function.prototype,d=Object.prototype,c=u.toString,l=d.hasOwnProperty,h=RegExp("^"+c.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!n(e)||a(e))&&(i(e)?h:s).test(o(e))}},function(e,t,r){var i=r(43),a=Object.prototype,n=a.hasOwnProperty,o=a.toString,s=i?i.toStringTag:void 0;e.exports=function(e){var t=n.call(e,s),r=e[s];try{e[s]=void 0;var i=!0}catch(e){}var a=o.call(e);return i&&(t?e[s]=r:delete e[s]),a}},function(e,t){var r=Object.prototype.toString;e.exports=function(e){return r.call(e)}},function(e,t,r){var i,a=r(78),n=(i=/[^.]+$/.exec(a&&a.keys&&a.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"";e.exports=function(e){return!!n&&n in e}},function(e,t,r){var i=r(24)["__core-js_shared__"];e.exports=i},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,r){var i=r(31)(r(24),"Map");e.exports=i},function(e,t,r){var i=r(31)(r(24),"Promise");e.exports=i},function(e,t,r){var i=r(31)(r(24),"Set");e.exports=i},function(e,t,r){var i=r(31)(r(24),"WeakMap");e.exports=i},function(e,t,r){var i=r(85),a=r(29),n=Object.prototype,o=n.hasOwnProperty,s=n.propertyIsEnumerable,u=i(function(){return arguments}())?i:function(e){return a(e)&&o.call(e,"callee")&&!s.call(e,"callee")};e.exports=u},function(e,t,r){var i=r(27),a=r(29);e.exports=function(e){return a(e)&&"[object Arguments]"==i(e)}},function(e,t){var r=Array.isArray;e.exports=r},function(e,t,r){var i=r(33),a=r(47);e.exports=function(e){return null!=e&&a(e.length)&&!i(e)}},function(e,t,r){(function(e){var i=r(24),a=r(89),n=t&&!t.nodeType&&t,o=n&&"object"==typeof e&&e&&!e.nodeType&&e,s=o&&o.exports===n?i.Buffer:void 0,u=(s?s.isBuffer:void 0)||a;e.exports=u}).call(this,r(37)(e))},function(e,t){e.exports=function(){return!1}},function(e,t,r){var i=r(91),a=r(92),n=r(93),o=n&&n.isTypedArray,s=o?a(o):i;e.exports=s},function(e,t,r){var i=r(27),a=r(47),n=r(29),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,e.exports=function(e){return n(e)&&a(e.length)&&!!o[i(e)]}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,r){(function(e){var i=r(44),a=t&&!t.nodeType&&t,n=a&&"object"==typeof e&&e&&!e.nodeType&&e,o=n&&n.exports===a&&i.process,s=function(){try{var e=n&&n.require&&n.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=s}).call(this,r(37)(e))},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t,r){var i=r(32),a=r(96),n=r(97),o=Math.max,s=Math.min;e.exports=function(e,t,r){var u,d,c,l,h,f,p=0,v=!1,m=!1,g=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function _(t){var r=u,i=d;return u=d=void 0,p=t,l=e.apply(i,r)}function S(e){return p=e,h=setTimeout(b,t),v?_(e):l}function E(e){var r=e-f;return void 0===f||r>=t||r<0||m&&e-p>=c}function b(){var e=a();if(E(e))return y(e);h=setTimeout(b,function(e){var r=t-(e-f);return m?s(r,c-(e-p)):r}(e))}function y(e){return h=void 0,g&&u?_(e):(u=d=void 0,l)}function C(){var e=a(),r=E(e);if(u=arguments,d=this,f=e,r){if(void 0===h)return S(f);if(m)return h=setTimeout(b,t),_(f)}return void 0===h&&(h=setTimeout(b,t)),l}return t=n(t)||0,i(r)&&(v=!!r.leading,c=(m="maxWait"in r)?o(n(r.maxWait)||0,t):c,g="trailing"in r?!!r.trailing:g),C.cancel=function(){void 0!==h&&clearTimeout(h),p=0,u=f=d=h=void 0},C.flush=function(){return void 0===h?l:y(a())},C}},function(e,t,r){var i=r(24);e.exports=function(){return i.Date.now()}},function(e,t,r){var i=r(32),a=r(98),n=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,u=/^0o[0-7]+$/i,d=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(a(e))return NaN;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(n,"");var r=s.test(e);return r||u.test(e)?d(e.slice(2),r?2:8):o.test(e)?NaN:+e}},function(e,t,r){var i=r(27),a=r(29);e.exports=function(e){return"symbol"==typeof e||a(e)&&"[object Symbol]"==i(e)}},function(e,t){e.exports=function(e,t){return t.get?t.get.call(e):t.value},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";r.r(t);var i={};r.r(i),r.d(i,"setCachedUserNodeListToWorker",(function(){return ve})),r.d(i,"setUserNodeListToWorker",(function(){return me})),r.d(i,"UpdateAudioPlayStatus",(function(){return ge})),r.d(i,"UpdateVideoPlayStatus",(function(){return _e})),r.d(i,"UpdateSharingPlayStatus",(function(){return Ee})),r.d(i,"preserveMessageController",(function(){return ye})),r.d(i,"previewController",(function(){return Ce})),r.d(i,"initVideoEncode",(function(){return Ae})),r.d(i,"CloseMediaNetSessionToRwg",(function(){return we})),r.d(i,"AssertMediaSdkNotDestory",(function(){return Te})),r.d(i,"initVideoDecode",(function(){return ke})),r.d(i,"initAudioEncode",(function(){return Oe})),r.d(i,"initAudioDecode",(function(){return xe})),r.d(i,"initSharingDecode",(function(){return Ne})),r.d(i,"initSharingEncode",(function(){return Ue})),r.d(i,"Sharing_Decode_Post_message",(function(){return We})),r.d(i,"Sharing_Encode_Post_message",(function(){return Ge})),r.d(i,"addAudioMonitorLog",(function(){return et})),r.d(i,"initAudioSharedBuffer",(function(){return st})),r.d(i,"setSharingEngineInitProperties",(function(){return dt})),r.d(i,"setAudioEngineInitProperties",(function(){return ct})),r.d(i,"setVideoEngineInitProperties",(function(){return lt})),r.d(i,"Set_Audio_WebSocket_Ip_Address",(function(){return ht})),r.d(i,"Set_Audio_Web_Transport_Ip_Address",(function(){return ft})),r.d(i,"Set_Video_WebSocket_Ip_Address",(function(){return pt})),r.d(i,"Set_Video_Web_Transport_Ip_Address",(function(){return vt})),r.d(i,"JsAudioEngine_UnInit",(function(){return mt})),r.d(i,"JsVideoEngine_UnInit",(function(){return gt})),r.d(i,"JsSharingEngine_UnInit",(function(){return _t})),r.d(i,"Video_Encode_Frame",(function(){return St})),r.d(i,"Sharing_Encode_Frame",(function(){return Et})),r.d(i,"Put_Video_Frame_Buffer",(function(){return yt})),r.d(i,"Clear_Decoded_Sharing_Frame",(function(){return Ct})),r.d(i,"Add_Video_Decode_Thread",(function(){return It})),r.d(i,"Add_Audio_Decode_Thread",(function(){return Pt})),r.d(i,"Get_SSRC_Latest_Time",(function(){return Vt})),r.d(i,"Get_Video_SSRC_Latest_Time",(function(){return Ut})),r.d(i,"Meeting_Fail_Over",(function(){return Lt})),r.d(i,"Modify_Audio_SampleRate",(function(){return Ht})),r.d(i,"Notify_Audio_Thread_Status",(function(){return jt})),r.d(i,"Notify_Audio_Thread_AEC_Status",(function(){return Kt})),r.d(i,"Notify_Audio_Thread_Msg_Channel",(function(){return qt})),r.d(i,"Notify_Video_Thread_Msg_Channel",(function(){return Xt})),r.d(i,"Notify_Video_Sharing_Msg_Channel",(function(){return Yt})),r.d(i,"Notify_Audio_Thread_Msg_Channel2",(function(){return zt})),r.d(i,"Notify_Audio_Thread_Msg_Channel3",(function(){return Qt})),r.d(i,"Notify_Audio_Video_Thread_Msg_Channel",(function(){return Jt})),r.d(i,"Notify_Video_Encode_Thread",(function(){return Zt})),r.d(i,"Notify_Video_Encode_Thread_Transferable_Data",(function(){return $t})),r.d(i,"TransoferDataToVideoEncodeThread",(function(){return er})),r.d(i,"Notify_Video_Decode_Thread",(function(){return tr})),r.d(i,"Notify_Sharing_Video_Encode_Thread_Transferable_Data",(function(){return rr})),r.d(i,"Notify_Sharing_Encode_Thread_Transferable_Data",(function(){return ir})),r.d(i,"Notify_Sharing_Video_Decode_Thread",(function(){return ar})),r.d(i,"Notify_Sharing_Decode_Thread",(function(){return nr})),r.d(i,"Notify_Audio_Thread_CurrentSSRC",(function(){return or})),r.d(i,"Notify_Audio_Encode_Thread",(function(){return sr})),r.d(i,"Notify_Audio_Decode_Thread",(function(){return ur})),r.d(i,"Notify_Audio_Thread_Interpretation_Enable",(function(){return dr})),r.d(i,"Notify_Audio_Thread_CC_Set_Lang",(function(){return cr})),r.d(i,"Notify_Audio_Thread_Interpretation_Set_Lang",(function(){return lr})),r.d(i,"Notify_Audio_Thread_Interpretation_Mute",(function(){return hr})),r.d(i,"Notify_Audio_Thread_Interpretation_Set_Interpreter",(function(){return fr})),r.d(i,"Reset_Aec",(function(){return pr})),r.d(i,"Set_Aec_Delay",(function(){return vr})),r.d(i,"saveBrowserInfo",(function(){return gr})),r.d(i,"sendMonitorLog",(function(){return _r})),r.d(i,"Start_Monitor",(function(){return Sr})),r.d(i,"Send_Render_Monitor_Log",(function(){return Er})),r.d(i,"Stop_Monitor",(function(){return br})),r.d(i,"Update_Video_Encrpt",(function(){return yr})),r.d(i,"Update_Sharing_Encrpt",(function(){return Cr})),r.d(i,"Update_Sharing_Video_Encode_Status",(function(){return Ar})),r.d(i,"Update_Sharing_Encode_Status",(function(){return Rr})),r.d(i,"Notify_Sharing_Video_Encode_Thread",(function(){return Ir})),r.d(i,"Notify_Sharing_Encode_Thread",(function(){return wr})),r.d(i,"Update_Audio_Encrpt",(function(){return Tr})),r.d(i,"disableSocketReconnect",(function(){return kr})),r.d(i,"closeAllPromiseObject",(function(){return Dr})),r.d(i,"clearWorkerListener",(function(){return Or})),r.d(i,"closeAllMedia",(function(){return Mr})),r.d(i,"destroyAllWorkers",(function(){return Pr})),r.d(i,"pushMessageToWorker",(function(){return Wr})),r.d(i,"isVideoEncodeHandleReady",(function(){return Gr})),r.d(i,"transportSettingCanvas",(function(){return Fr})),r.d(i,"initResourceManager",(function(){return Hr})),r.d(i,"prepareVBfile",(function(){return Kr})),r.d(i,"transportImageBitMap",(function(){return qr})),r.d(i,"transportBgImageBitMap",(function(){return Xr})),r.d(i,"transportVBBgImageBitMap",(function(){return Yr})),r.d(i,"transportMaskImageBitMap",(function(){return zr})),r.d(i,"MirrorSendVideo",(function(){return Qr})),r.d(i,"isSharingNotClearChromeVersion",(function(){return Jr})),r.d(i,"MEDIA_INIT_SUCCESS_CALLBACK_METADATA",(function(){return Zr})),r.d(i,"setMediaSessionHold",(function(){return $r}));var a=r(18),n=r.n(a),o=r(19),s=r.n(o),u=r(11),d=r.n(u),c=r(12),l=r.n(c),h=r(13),f=r.n(h),p=r(16),v=r.n(p),m=r(4),g=r.n(m),_=r(25),S=r.n(_),E=r(23),b=r.n(E),y=r(26),C=r.n(y),A=r(20),R=r.n(A),I=r(49),w=r.n(I),T=r(50),k=r.n(T),D=r(15),O=r.n(D),M=r(2),x=r(10),P=r(21);function N(){this.ssrcQueueMap=new Map,N.prototype.AddQueue=function(e){var t=new P.a;return this.ssrcQueueMap.set(e,t),t},N.prototype.DeleteQueue=function(e){this.ssrcQueueMap.delete(e)},N.prototype.GetQueue=function(e){return this.ssrcQueueMap.get(e)},N.prototype.GetQueueData=function(e){return this.ssrcQueueMap.get(e).dequeue()},N.prototype.PutQueueData=function(e,t){this.ssrcQueueMap.get(e).enqueue(t)},N.prototype.GetQueueLength=function(e){var t=this.ssrcQueueMap.get(e);return null!==t?t.getLength():0}}var V=function(){this.frames=0,this.ntp=new P.a};V.prototype={UpdateVideoInfo:function(e){this.frames++,this.ntp.getLength()>30&&this.ntp.dequeue(),this.ntp.enqueue(e)},GetVideoFpsInfo:function(){var e=this.ntp.getLength();if(!(e<5)){for(var t=0,r=0,i=0,a=0,n=0;n<e;n++){var o=this.ntp.dequeue();0==o&&0==i?r++:0!=o?(a=0,0==i&&(i=o),t=o):0!=i&&t!=i&&0==o&&a++}return 0==t||t==i?0:e-r-a-1!=0?(t-i)/(e-r-a-1):0}}};var U=function(){this.ssrcInfoMap=new Map};function L(){this.ssrcQueueMap=new Map,this.ssrcInfo=new U,L.prototype.AddQueue=function(e){var t=new P.a;return this.ssrcQueueMap.set(e,t),t},L.prototype.DeleteQueue=function(e){this.ssrcQueueMap.delete(e)},L.prototype.GetQueue=function(e){return this.ssrcQueueMap.get(e)},L.prototype.ClearQueue=function(){this.ssrcQueueMap.clear()},L.prototype.GetQueueData=function(e){return this.ssrcQueueMap.get(e).dequeue()},L.prototype.PutQueueData=function(e,t){this.ssrcQueueMap.get(e).enqueue(t)},L.prototype.GetQueueLength=function(e){var t=this.ssrcQueueMap.get(e);return t?t.getLength():0},L.prototype.UpdateInfo=function(e,t){this.ssrcInfo.UpdateSSRCInfo(e,t)},L.prototype.GetFpsInfo=function(e){return this.ssrcInfo.GetSSRCFpsInfo(e)}}U.prototype={UpdateSSRCInfo:function(e,t){var r=this.ssrcInfoMap.get(e);r||(r=new V,this.ssrcInfoMap.set(e,r)),r.UpdateVideoInfo(t)},GetSSRCFpsInfo:function(e){var t=this.ssrcInfoMap.get(e);return t?t.GetVideoFpsInfo():0}};var W=function(){function e(e){var t=e.sessionid;this.map=new Map,this.AudioQueueMGR=new N,this.timemap=new Map,this.sessionid=t||0}return e.prototype.Add=function(e,t){this.map.set(e,t),this.AudioQueueMGR.AddQueue(e)},e.prototype.Clear=function(){this.map.clear()},e.prototype.Keys=function(){return this.map.keys()},e.prototype.UpdateSSRCTimeMap=function(e){this.timemap=e},e.prototype.GetSSRCTimeMap=function(e){return this.timemap?this.timemap.get(e):null},e}();function B(e){var t=e.sessionid;this.sessionid=t||0,this.map=new Map,this.VideoQueueMGR=new L}B.prototype.Add=function(e,t){this.map.set(e,t)},B.prototype.Clear=function(){this.map.clear()},B.prototype.Keys=function(){return this.map.keys()};var G=function(){this.frames=0,this.ntp=new P.a};G.prototype={UpdateSharingInfo:function(e){this.frames++,this.ntp.getLength()>30&&this.ntp.dequeue(),this.ntp.enqueue(e)},GetSharingFpsInfo:function(){var e=this.ntp.getLength();if(!(e<5)){for(var t=0,r=0,i=0,a=0,n=0;n<e;n++){var o=this.ntp.dequeue();0==o&&0==i?r++:0!=o?(a=0,0==i&&(i=o),t=o):0!=i&&t!=i&&0==o&&a++}return 0==t||t==i?0:e-r-a-1!=0?(t-i)/(e-r-a-1):0}}};var F=function(){this.ssrcInfoMap=new Map};function H(){this.ssrcQueueMap=new Map,this.ssrcInfo=new F,H.prototype.AddQueue=function(e){var t=new P.a;return this.ssrcQueueMap.set(e,t),t},H.prototype.DeleteQueue=function(e){this.ssrcQueueMap.delete(e)},H.prototype.GetQueue=function(e){return this.ssrcQueueMap.get(e)},H.prototype.ClearQueue=function(){this.ssrcQueueMap.clear()},H.prototype.GetQueueData=function(e){return this.ssrcQueueMap.get(e).dequeue()},H.prototype.PutQueueData=function(e,t){this.ssrcQueueMap.get(e).enqueue(t)},H.prototype.GetQueueLength=function(e){var t=this.ssrcQueueMap.get(e);return t?t.getLength():0},H.prototype.UpdateInfo=function(e,t){this.ssrcInfo.UpdateSSRCInfo(e,t)},H.prototype.GetFpsInfo=function(e){return this.ssrcInfo.GetSSRCFpsInfo(e)}}function j(e){var t=e.sessionid;this.map=new Map,this.sQueue=new P.a,this.SharingQueueMGR=new H,this.sessionid=t||0}F.prototype={UpdateSSRCInfo:function(e,t){var r=this.ssrcInfoMap.get(e);r||(r=new G,this.ssrcInfoMap.set(e,r)),r.UpdateSharingInfo(t)},GetSSRCFpsInfo:function(e){var t=this.ssrcInfoMap.get(e);return t?t.GetSharingFpsInfo():0}},j.prototype.Clear=function(){this.map.clear()},j.prototype.Keys=function(){return this.map.keys()},j.prototype.Add=function(e,t){this.map.set(e,t)},j.prototype.Get=function(e){return this.map.get(e)},j.prototype.PutData=function(e){e&&this.sQueue&&this.sQueue.enqueue(e)},j.prototype.GetData=function(){if(this.sQueue)return this.sQueue.dequeue()},j.prototype.ClearBuffer=function(){this.sQueue&&(this.sQueue=new P.a)};var K,q=r(3),X=r(22),Y=r(9),z=r(17),Q=r(7),J=r(5),Z=r(0),$=r(52),ee=r.n($),te=["name","messageParams","direction"];function re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?re(Object(r),!0).forEach((function(t){v()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ae=Object(X.a)("sdk.engine"),ne=M.VB_SETTING_PARA_ERROR_TYPE;function oe(e,t){return se.apply(this,arguments)}function se(){return(se=d()(g.a.mark((function e(t,r){var i,a,n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===J.f.VIDEO_ENCODE?3:e.t0===J.f.VIDEO_DECODE?5:e.t0===J.f.AUDIO_ENCODE?7:e.t0===J.f.AUDIO_DECODE?9:e.t0===J.f.SHARING_DECODE?11:e.t0===J.f.SHARING_ENCODE?13:15;break;case 3:return i=Z.default.videoEncResponseText,e.abrupt("break",15);case 5:return i=Z.default.videoDecResponseText,e.abrupt("break",15);case 7:return i=Z.default.audioEncodeResponse,e.abrupt("break",15);case 9:return i=Z.default.audioDecodeResponse,e.abrupt("break",15);case 11:return i=Z.default.sharingDecodeResponse,e.abrupt("break",15);case 13:return i=Z.default.sharingEncodeResponse,e.abrupt("break",15);case 15:if(i){e.next=19;break}return e.next=18,de(r.workerJsFileUrl,r.integrityHelper);case 18:i=e.sent;case 19:return a="wasmUrl = '"+r.workerWasmFileUrl+"';","self.__wasmCodeDataEndFlag = 1;",n=/self\.__wasmCodeDataEndFlag\s*=\s*1[;|,]/,e.abrupt("return",i.replace(n,a+"self.__wasmCodeDataEndFlag = 1;"));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ue(){return(ue=d()(g.a.mark((function e(t,r,i,a,n){var o,s,u;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||!n.isDestroy){e.next=3;break}return Q.default.add_monitor("ZIDX",a),e.abrupt("return",ae("WorkerType:".concat(a,";The relative SDK instance is destroy, don't start relative worker, avoid multiple same workers. ")));case 3:if(o={},J.i[a]&&Object.assign(o,{name:J.i[a]}),!1,a==J.f.AUDIO_ENCODE?Z.default.AEW&&(s=Z.default.AEW):a==J.f.AUDIO_DECODE&&Z.default.ADW&&(s=Z.default.ADW),s){e.next=22;break}return e.t0=window.URL,e.t1=Blob,e.next=12,oe(a,t);case 12:e.t2=e.sent,e.t3=[e.t2],e.t4=new e.t1(e.t3),u=e.t0.createObjectURL.call(e.t0,e.t4),(s=new Worker(u,o)).addEventListener("error",(function(e){if(e.message&&e.message.includes("RuntimeError:")){var t=performance.now();t-Z.default.crashLastTime>3e4&&(Z.default.crashCount++,Z.default.crashLastTime=t,Z.default.Notify_APPUI(M.NOTIFY_UI_FAILOVER),fe("NOTIFY_UI_FAILOVER  ".concat(Z.default.crashCount)))}})),a===J.f.VIDEO_ENCODE&&s.postMessage({command:"WORKER_BOLB_URL",blobUrl:u}),Z.default.mediaSDKHandle.is32bitbrowser&&(a==J.f.AUDIO_ENCODE?Z.default.AEW=s:a==J.f.AUDIO_DECODE&&(Z.default.ADW=s)),e.next=23;break;case 22:a==J.f.AUDIO_ENCODE?Z.default.AEWF=!0:a==J.f.AUDIO_DECODE&&(Z.default.ADWF=!0);case 23:r&&r.call(i,s);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function de(e,t){var r=null;return t&&(r=t.getIntegrity()),q.default.download(e,r)}function ce(e,t,r,i,a){var n=this;return new Promise((function(o,s){!function(e,t,r,i,a){ue.apply(this,arguments)}(e,(function(e){var a=Z.default.SPECIAL_ID;t&&(Q.default.add_monitor("WAM"+i),t.Add(a,e)),e.onmessage=function(e){r(e)},o()}),n,i,a)}))}function le(e,t){var r=t.data;[he,pe].forEach((function(t){try{t.call(null,e,r)}catch(e){Y.default.error("Error from allWorkersListener",e)}}))}function he(e,t){-1!==[J.f.AUDIO_ENCODE,J.f.VIDEO_ENCODE,J.f.SHARING_ENCODE].indexOf(e)&&t.status===M.AES_GCM_IV_CALLBACK_FROM_WASM&&(ae("allWorkersListener_AES_IV",e,t),Z.default.Notify_APPUI_SAFE(M.AES_GCM_IV_RESPONSE,{workerType:e,iv:q.default.buffer2stringSplitByComma(t.data)}))}function fe(e){var t=q.default.getMachineCapability();t.errorMessage=e,Y.default.severityerror(t,["MEDIASDK_ERROR"])}function pe(e,t){if(t.status===x.p){var r="Error from ".concat(e," worker: ").concat(t.errorMessage);-1!=r.indexOf("E:H")?fe(r):Y.default.error(r,t.errorEvent)}}function ve(e){try{var t;null!==(t=Z.default.userNodeList)&&void 0!==t&&t.length&&Wr(e,{userNodeList:Z.default.userNodeList},129,!1,!1)}catch(t){Y.default.error("Error when sending cached user node list to worker workerType "+e,t)}}function me(e){var t=Z.default.userNodeList||[],r=e.concat(t);Z.default.userNodeList=q.default.removeDuplicates(r,(function(e,t){return e.userid!==t.userid})),[J.f.AUDIO_ENCODE,J.f.AUDIO_DECODE,J.f.VIDEO_ENCODE,J.f.VIDEO_DECODE,J.f.SHARING_ENCODE,J.f.SHARING_DECODE].forEach(function(){var e=d()(g.a.mark((function e(t){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===J.f.AUDIO_ENCODE?3:e.t0===J.f.AUDIO_DECODE?5:e.t0===J.f.VIDEO_ENCODE?7:e.t0===J.f.VIDEO_DECODE?9:e.t0===J.f.SHARING_ENCODE?11:e.t0===J.f.SHARING_DECODE?13:15;break;case 3:return r=Z.default.audioEncodeInitInstance,e.abrupt("break",15);case 5:return r=Z.default.audioDecInitInstance,e.abrupt("break",15);case 7:return r=Z.default.videoInitInstance,e.abrupt("break",15);case 9:return r=Z.default.videoDecInitInstance,e.abrupt("break",15);case 11:return r=Z.default.sharingEncInitInstance,e.abrupt("break",15);case 13:return r=Z.default.sharingDecInitInstance,e.abrupt("break",15);case 15:return e.prev=15,e.next=18,r.waitforInitSuccess();case 18:ae("setUserNodeListToWorker init success",t),Wr(t,{userNodeList:Z.default.userNodeList},129,!1,!0),e.next=25;break;case 22:e.prev=22,e.t1=e.catch(15),Y.default.error("Error when sending user node list to worker",e.t1);case 25:case"end":return e.stop()}}),e,null,[[15,22]])})));return function(t){return e.apply(this,arguments)}}())}function ge(e){Z.default.isAudioPlayWork=e}function _e(e){return Se.apply(this,arguments)}function Se(){return(Se=d()(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z.default.isVideoPlayWork=t,e.next=3,Wr(J.f.VIDEO_DECODE,{isVideoPlayWork:t},"VideoPlayStatus",!1,!0);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ee(e){Z.default.isSharingPlayWork=e}var be,ye=(be={SDK_TO_WORKER:"SDK_TO_WORKER",SDK_TO_WORKER_WAIT_OK:"SDK_TO_WORKER_WAIT_OK",SDK_TO_APP:"SDK_TO_APP",SDK_TO_SDK:"SDK_TO_SDK"},{nameMap:{INIT_VIDEO_ENCODE_SUCCESS:"INIT_VIDEO_ENCODE_SUCCESS",INIT_VIDEO_DECODE_SUCCESS:"INIT_VIDEO_DECODE_SUCCESS",CREATE_VIDEO_ENCODE_HANDLE_SUCCESS:"CREATE_VIDEO_ENCODE_HANDLE_SUCCESS",CREATE_VIDEO_DECODE_HANDLE_SUCCESS:"CREATE_VIDEO_DECODE_HANDLE_SUCCESS",CREATE_AUDIO_ENCODE_HANDLE_SUCCESS:"CREATE_AUDIO_ENCODE_HANDLE_SUCCESS",CREATE_AUDIO_DECODE_HANDLE_SUCCESS:"CREATE_AUDIO_DECODE_HANDLE_SUCCESS"},map:new Map,direction:be,clear:function(){this.map.clear()},subscribeMessage:function(e){var t=this.map.get(e);t&&(t.forEach((function(e){var t=e.direction,r=e.messageParams,i=e.handler;if(t===be.SDK_TO_APP)Z.default.Notify_APPUI.apply(Z.default,n()(r));else if(t===be.SDK_TO_WORKER_WAIT_OK)Wr.apply(void 0,n()(r));else if(t===be.SDK_TO_WORKER){var a=O()(r,2),o=a[0],s=a[1],u=Vr(o);u&&u.postMessage(s)}else t===be.SDK_TO_SDK&&i&&i(r)})),this.map.delete(e))},enqueueMessage:function(e){var t=e.name,r=e.messageParams,i=e.direction,a=k()(e,te);this.map.has(t)||this.map.set(t,[]),this.map.get(t).push(ie({direction:i,messageParams:r||[]},a))}}),Ce={resetAudioEncode:function(e){!e&&Z.default.isPreviewMode.audioEncode&&(Z.default.isAudioEncodePostStart=!1),Z.default.isPreviewMode.audioEncode=!!e},resetAudioDecode:function(e){!e&&Z.default.isPreviewMode.audioDecode&&(Z.default.isAudioDecodePostStart=!1),Z.default.isPreviewMode.audioDecode=!!e},resetVideoEncode:function(e){!e&&Z.default.isPreviewMode.videoEncode&&(Z.default.isVideoEncodePostStart=!1),Z.default.isPreviewMode.videoEncode=!!e},resetVideoDecode:function(e){!e&&Z.default.isPreviewMode.videoDecode&&(Z.default.isVideoDecodePostStart=!1),Z.default.isPreviewMode.videoDecode=!!e}};function Ae(e,t){return Re.apply(this,arguments)}function Re(){return(Re=d()(g.a.mark((function e(t,r){var i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z.default.localVideoEncMGR||(Z.default.localVideoEncMGR=new B({sessionid:r._id})),Ie(J.f.VIDEO_DECODE,Z.default.localVideoEncMGR.sessionid,r._id),Z.default.videoEncWorkerPath=t.workerJsFileUrl,e.next=5,de(t.workerJsFileUrl,t.integrityHelper);case 5:if(i=e.sent,Z.default.videoEncResponseText=i,Te(r)){e.next=9;break}return e.abrupt("return",!1);case 9:return e.next=11,Dt(0,null,r,t);case 11:if(Te(r,"Add_Video_Encode_Thread")){e.next=14;break}return Y.default.error("Add_Video_Encode_Thread Worker Not Controled"),e.abrupt("return",!1);case 14:return ye.subscribeMessage(ye.nameMap.CREATE_VIDEO_ENCODE_HANDLE_SUCCESS),e.next=17,Tt(r);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ie(e,t,r){var i=t==r;return i||Y.default.error("mediasdkInstance id ".concat(r," not equal  media type ").concat(e," id ").concat(t)),i}function we(e,t){Z.default.sendMessageToRwg(M.SEND_MESSAGE_TO_RWG,{evt:M.ZOOM_CONNECTION_REMOVE_UDP_EVT,body:{flag:t,type:e}},!1)}function Te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.isDestroy&&Y.default.log("mediasdkInstance id ".concat(e._id," is Destoryed from ").concat(t)),!e.isDestroy}function ke(e,t){return De.apply(this,arguments)}function De(){return(De=d()(g.a.mark((function e(t,r){var i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z.default.localVideoDecMGR||(Z.default.localVideoDecMGR=new B({sessionid:r._id})),Ie(J.f.VIDEO_DECODE,Z.default.localVideoDecMGR.sessionid,r._id),Z.default.videoDecWorkerPath=t.workerJsFileUrl,e.next=5,de(t.workerJsFileUrl,t.integrityHelper);case 5:if(i=e.sent,Te(r)){e.next=8;break}return e.abrupt("return",!1);case 8:return Z.default.videoDecResponseText=i,e.next=11,It(0,null,r,t);case 11:if(Te(r,"Add_Video_Decode_Thread")){e.next=14;break}return Y.default.error("Add_Video_Decode_Thread Worker Not Controled"),e.abrupt("return",!1);case 14:return ye.subscribeMessage(ye.nameMap.CREATE_VIDEO_DECODE_HANDLE_SUCCESS),e.next=17,At(r);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oe(e,t){return Me.apply(this,arguments)}function Me(){return(Me=d()(g.a.mark((function e(t,r){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,st(r.audioCtx.sampleRate);case 2:return Z.default.localAudioEncMGR||(Z.default.localAudioEncMGR=new W({sessionid:r._id})),Ie(J.f.AUDIO_ENCODE,Z.default.localAudioEncMGR.sessionid,r._id),Z.default.audioEncWorkerPath=t.workerJsFileUrl,e.next=7,de(t.workerJsFileUrl,t.integrityHelper);case 7:if(Z.default.audioEncodeResponse=e.sent,Te(r)){e.next=10;break}return e.abrupt("return",!1);case 10:return e.next=12,Gt(0,r,t);case 12:if(Te(r,"Add_Audio_Encode_Thread")){e.next=15;break}return Y.default.error("Add_Audio_Encode_Thread Worker Not Controled"),e.abrupt("return",!1);case 15:return ye.subscribeMessage(ye.nameMap.CREATE_AUDIO_ENCODE_HANDLE_SUCCESS),e.next=18,Wt(r);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(e,t){return Pe.apply(this,arguments)}function Pe(){return(Pe=d()(g.a.mark((function e(t,r){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,st(r.audioCtx.sampleRate);case 2:return Z.default.localAudioDecMGR||(Z.default.localAudioDecMGR=new W({sessionid:r._id})),Ie(J.f.AUDIO_DECODE,Z.default.localAudioDecMGR.sessionid,r._id),Z.default.audioDecWorkerPath=t.workerJsFileUrl,e.next=7,de(t.workerJsFileUrl,t.integrityHelper);case 7:if(Z.default.audioDecodeResponse=e.sent,"string"==typeof Z.default.audioDecodeResponse?Q.default.add_monitor("DAFL"+Z.default.audioDecodeResponse.length):Q.default.add_monitor("DAFF"),Te(r)){e.next=11;break}return e.abrupt("return",!1);case 11:return e.next=13,Pt(0,null,r,t);case 13:if(Te(r,"Add_Audio_Decode_Thread")){e.next=16;break}return Y.default.error("Add_Audio_Decode_Thread Worker Not Controled"),e.abrupt("return",!1);case 16:return ye.subscribeMessage(ye.nameMap.CREATE_AUDIO_DECODE_HANDLE_SUCCESS),Q.default.add_monitor("ADTS"),e.next=20,Mt(r);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ne(e,t){return Ve.apply(this,arguments)}function Ve(){return(Ve=d()(g.a.mark((function e(t,r){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z.default.localSharingDecMGR||(Z.default.localSharingDecMGR=new j({sessionid:r._id})),Z.default.localMouseDecMGR||(Z.default.localMouseDecMGR=new j({sessionid:r._id})),Ie(J.f.SHARING_DECODE,Z.default.localSharingDecMGR.sessionid,r._id),Z.default.sharingDecWorkerPath=t.workerJsFileUrl,e.next=6,de(t.workerJsFileUrl,t.integrityHelper);case 6:if(Z.default.sharingDecodeResponse=e.sent,Te(r)){e.next=9;break}return e.abrupt("return",!1);case 9:return e.next=11,nt(r,t);case 11:if(Te(r,"Add_Sharing_Decode_Thread")){e.next=14;break}return Y.default.error("Add_Sharing_Decode_Thread Worker Not Controled"),e.abrupt("return",!1);case 14:return e.next=16,We(r);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ue(e,t){return Le.apply(this,arguments)}function Le(){return(Le=d()(g.a.mark((function e(t,r){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z.default.localSharingEncMGR||(Z.default.localSharingEncMGR=new j({sessionid:r._id})),Ie(J.f.SHARING_ENCODE,Z.default.localSharingEncMGR.sessionid,r._id),Z.default.sharingEncWorkerPath=t.workerJsFileUrl,e.next=5,de(t.workerJsFileUrl,t.integrityHelper);case 5:if(Z.default.sharingEncodeResponse=e.sent,Te(r)){e.next=8;break}return e.abrupt("return",!1);case 8:return e.next=10,it(r,t);case 10:if(Te(r,"Add_Sharing_Encode_Thread")){e.next=13;break}return Y.default.error("Add_Sharing_Encode_Thread Worker Not Controled"),e.abrupt("return",!1);case 13:return e.next=15,Ge(r);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function We(e){return Be.apply(this,arguments)}function Be(){return(Be=d()(g.a.mark((function e(t){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.default.sharingDecInitInstance.wasmSuccessPromise;case 2:if(Te(t)){e.next=4;break}return e.abrupt("return",!1);case 4:(r=Z.default.localSharingDecMGR.Get(Z.default.SPECIAL_ID))&&!Z.default.isSharingDecodePostStart&&(r.postMessage({command:1,_id:t._id,websocket_ip_address:Z.default.Sharing_WebSocket_Ip_Address,confId:Z.default.localSharingPara.userid,confKey:"",logon:Z.default.localSharingPara.logon,meetingid:Z.default.localSharingPara.meetingid,meetingnumb:Z.default.localSharingPara.meetingnumb,multiThreadNum:1,graphicalname:q.default.graphicName,vendorname:q.default.graphicvendorname,rendererType:Z.default.localSharingPara.rendererType,isWebCodecDecoderOnWhitelist:Z.default.localSharingPara.isWebCodecDecoderOnWhitelist}),Z.default.isSharingDecodePostStart=!0);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ge(e){return Fe.apply(this,arguments)}function Fe(){return(Fe=d()(g.a.mark((function e(t){var r,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.default.sharingEncInitInstance.wasmSuccessPromise;case 2:if(Te(t)){e.next=4;break}return e.abrupt("return",!1);case 4:(r=Z.default.localSharingEncMGR.Get(Z.default.SPECIAL_ID))&&!Z.default.isSharingEncodePostStart&&(1,Q.default.add_monitor2("STN1"),i=null,Z.default.ivObj&&(i=Z.default.ivObj[J.f.SHARING_ENCODE],i=q.default.stringSplitByComma2Buffer(i)),r.postMessage({command:1,_id:t._id,encode:!0,websocket_ip_address:Z.default.Sharing_WebSocket_Ip_Address,confId:Z.default.localSharingPara.userid,confKey:"",logon:Z.default.localSharingPara.logon,isChromeOrEdge:q.default.browser.isChrome,meetingid:Z.default.localSharingPara.meetingid,meetingnumb:Z.default.localSharingPara.meetingnumb,multiThreadNum:1,iv:i,uplimit:Z.default.uplimit,graphicalname:q.default.graphicName,vendorname:q.default.graphicvendorname,rendererType:Z.default.localSharingPara.rendererType}),Z.default.isSharingEncodePostStart=!0);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function He(e){var t=e.data;try{if(t.status===M.Sharing_Data)(function(e){try{var t=e.ssrcFromPDU;if(null==t)return!0;return(4294966272&Z.default.localSharingPara.userid)!=(4294966272&t)}catch(e){return!0}})(t.data)&&bt(t.data);else if(t.status===M.Sharing_Width_And_Height_Info)z.a.publish(M.SHARING_PARAM_INFO_FROM_SOCKET,{body:{width:t.logicWidth,height:t.logicHeight,logicWidth:t.logicWidth,logicHeight:t.logicHeight}}),Z.default.Notify_APPUI(M.SHARING_PARA,{body:{width:t.logicWidth,height:t.logicHeight,logicWidth:t.logicWidth,logicHeight:t.logicHeight}});else if(t.status===M.FIRST_SHARING_FRAME_FOR_MOBILE)Z.default.Notify_APPUI(M.FIRST_IOS_FRAME,t.ssrc);else if(t.status===M.SHARING_RENDER_MONITOR_LOG)Q.default.add_monitor2(t.data);else if(t.status===M.SHARING_FIRST_DECODE_FRAME_RECEIVED)Q.default.add_monitor("FSF"),Z.default.Notify_APPUI(M.SHARING_FIRST_DECODE_FRAME_RECEIVED_SSRC,{ssrc:t.ssrc});else if(t.status===M.SHARING_DATA_VIDEO_MODE)!function(e,t,r,i,a,n,o,s,u,d,c,l,h){if(!Z.default.isSharingPlayWork)return;var f={yuvdata:t,ntptime:r,ssrc:e,width:i,height:a,r_x:n,r_y:o,r_w:s,r_h:u,logic_w:d,logic_h:c,yuv_limited:l,isFromMainSession:h};Z.default.mediaSDKHandle.SharingRenderObj.Put_Sharing_Data_From_Queue(f,15)}(t.sharing_ssrc,t.data,t.sharing_timestamp,t.sharing_width,t.sharing_height,t.rendering_x,t.rendering_y,t.rendering_w,t.rendering_h,t.logic_w,t.logic_h,t.yuv_limited,t.isFromMainSession);else if(t.status===M.MOUSE_DATA_VIDEO_MODE)!function(e,t,r,i,a,n,o,s,u,d){if(!Z.default.isSharingPlayWork)return;var c={buffer:t,ntptime:r,ssrc:e,width:i,height:a,r_x:n,r_y:o,mLogic_w:s,mLogic_h:u,sync_id:d};Z.default.mediaSDKHandle.SharingRenderObj.Put_Mouse_Data_Into_Queue(c)}(t.mouse_ssrc,t.data,t.mouse_timestamp,t.mouse_width,t.mouse_height,t.mouse_x,t.mouse_y,t.mLogic_w,t.mLogic_h,t.sync_id);else if(t.status===M.SHARING_DECODE_MESSAGE)Z.default.Notify_APPUI(M.SHARING_DECODE_MAX_SIZE,{ssrc:t.ssrc,size:t.size,fps:t.size});else if(t.status===M.VIDEOSHARE_QOS_DATA){var r=ie({encoding:!1},t.data);Z.default.Notify_APPUI_SAFE(M.VIDEOSHARE_QOS_DATA,r)}else if(t.status===M.Sharing_Dec_WASM_OK)Q.default.add_monitor("SDWS"),Z.default.isSharingDecodeWASMOK=!0,Z.default.sharingDecInitInstance.setWasmSuccess();else if(t.status===M.Sharing_Dec_WASM_FAILED)Q.default.add_monitor("SDWF",t.data),fe("SDWF"),Z.default.sharingDecInitInstance.setWasmSuccess(!1);else if(t.status===M.Sharing_Handle_OK||t.status===M.Video_Sharing_Handle_OK)Q.default.add_monitor("SDHS"),Z.default.sharingDecInitInstance.setHanderSuccess();else if(t.status===M.Sharing_Handle_FAILED)Q.default.add_monitor("SHHF"),Z.default.sharingDecInitInstance.setHanderSuccess(!1);else if(t.status===M.Sharing_Dec_WebSocket_OK)Q.default.add_monitor("SDSS"),Z.default.sharingDecInitInstance.setSocketSuccess();else if(t.status===M.Sharing_Dec_WebSocket_FAILED)Q.default.add_monitor("SDSF"),Z.default.sharingDecInitInstance.isSocketInitSuccess()&&Z.default.Notify_APPUI_SAFE(M.VIDEO_WEBSOCKET_BROKEN,null),Z.default.sharingDecInitInstance.setSocketSuccess(!1);else{if(t.status==M.MONITOR_MESSAGE)return void _r(t.data);if(t.status===M.DOWNLOAD_WASM_FROM_MAIN_THREAD){var i=Z.default.localSharingDecMGR.map.get(Z.default.SPECIAL_ID);ze(t.url,i,J.f.SHARING_DECODE)}else if(t.status==M.APP_TROUBLESHOOTING_INFO)Z.default.monitorSharingDecodeAPPInfo=t,_r(Z.default.monitorSharingDecodeAPPInfo.data),Z.default.monitorSharingDecodeAPPInfo=null;else if(t.status==M.WCL_TROUBLESHOOTING_INFO)Q.default.add_monitor("SD"+t.data);else if(t.status==M.MULTIVIEW_WEBGL_CONTEXT_LOST)Z.default.Notify_APPUI(M.WEBGL_LOST_IN_MULTI_VIEW,{canvasId:t.canvasId,replaceCanvas:!!t.replaceCanvas});else if(t.status==M.SHARING_DECODE_MONITOR_MESSAGE)Z.default.monitorDecodeSharing=t;else if(t.status==M.VIDEO_ENCODED_DATA){var a=t.data;z.a.triggerSync(M.VIDEO_DATA_FROM_WORKER,a)}else"SHARING_DECODE_PTR"==t.status?z.a.triggerSync("SHARING_DECODE_PTR",t):"WFMO"==t.status?Ye(J.f.SHARING_DECODE):le(J.f.SHARING_DECODE,e)}}catch(e){Y.default.error("Error in SharingDec_Listener",e)}}function je(e){var t=e.data;try{if(t.status===M.Sharing_Data)bt(t.data);else if(t.status===M.SHARING_GET_IMAGE_DATA_WRONG)Q.default.add_monitor("GIDF");else if(t.status===M.Sharing_Dec_WASM_OK)Q.default.add_monitor("SEWS"),Z.default.isSharingEncodeWASMOK=!0,Z.default.sharingEncInitInstance.setWasmSuccess();else if(t.status===M.Sharing_Dec_WASM_FAILED)Q.default.add_monitor("SEWF",t.data),fe("SEWF"),Z.default.sharingEncInitInstance.setWasmSuccess(!1);else if(t.status===M.Sharing_Handle_OK||t.status===M.Video_Sharing_Handle_OK)Q.default.add_monitor("SEHS"),Z.default.sharingEncInitInstance.setHanderSuccess();else if(t.status===M.Sharing_Handle_FAILED)Q.default.add_monitor("SEHF"),Z.default.sharingEncInitInstance.setHanderSuccess(!1);else if(t.status===M.Sharing_Dec_WebSocket_OK)Q.default.add_monitor("SESS"),Z.default.sharingEncInitInstance.setSocketSuccess();else if(t.status===M.Sharing_Dec_WebSocket_FAILED)Q.default.add_monitor("SESF",t.data),Z.default.sharingEncInitInstance.isSocketInitSuccess()&&Z.default.Notify_APPUI_SAFE(M.VIDEO_WEBSOCKET_BROKEN,null),Z.default.sharingEncInitInstance.setSocketSuccess(!1);else if(t.status==M.SHARING_CAPTURE_FRAME_COUNT_STATISTIC)Q.default.add_monitor2("SCFOK");else if(t.status==M.UNSUPPORTED_SHARING_FORMAT)Q.default.add_monitor("SCFF"+t.format);else if(t.status==M.Video_Capture_Tick)Z.default.mediaSDKHandle.isSupportVideoTrackReader?(Z.default.mediaSDKHandle.canISendNextSharingFrame=!0,Z.default.mediaSDKHandle.Process_Sharing()):Z.default.mediaSDKHandle.Process_Sharing();else if(t.status==M.WhiteBoard_Video_Capture_Tick)Z.default.mediaSDKHandle.Process_Sharing();else if(t.status===M.CURRENT_DESKTOP_SHARING_WIDTH_HEIGHT_FROM_WORKER)Z.default.Notify_APPUI(M.CURRENT_DESKTOP_SHARING_WIDTH_HEIGHT,{width:t.width,height:t.height});else{if(t.status==M.MONITOR_MESSAGE)return void _r(t.data);if(t.status==M.DOWNLOAD_WASM_FROM_MAIN_THREAD){var r=Z.default.localSharingEncMGR.map.get(Z.default.SPECIAL_ID);ze(t.url,r)}else if(t.status===M.VIDEOSHARE_QOS_DATA){var i=ie({encoding:!0},t.data);Z.default.Notify_APPUI_SAFE(M.VIDEOSHARE_QOS_DATA,i)}else t.status==M.APP_TROUBLESHOOTING_INFO?(Z.default.monitorSharingEncodeAPPInfo=t,_r(Z.default.monitorSharingEncodeAPPInfo.data),Z.default.monitorSharingEncodeAPPInfo=null):t.status==M.WCL_TROUBLESHOOTING_INFO?Q.default.add_monitor("SE"+t.data):t.status==M.MULTIVIEW_WEBGL_CONTEXT_LOST?Z.default.Notify_APPUI(M.WEBGL_LOST_IN_MULTI_VIEW,{canvasId:t.canvasId,replaceCanvas:!!t.replaceCanvas}):t.status==M.WHITEBOARD_WORKER_MESSAGE?Z.default.Notify_APPUI(M.WB_MESSAGE,{data:t.data}):"WFMO"==t.status?Ye(J.f.SHARING_ENCODE):t.status==x.J?(Z.default.Notify_APPUI_SAFE(M.MEDIA_HEALTH_CHECK_FAILED,x.J),Y.default.error("Health Check Failed: ".concat(x.J,", ").concat(t.videoType,",").concat(t.subforme,",").concat(t.hasRTPPackets))):le(J.f.SHARING_ENCODE,e)}}catch(e){Y.default.error("Error in SharingEnc_Listener",e)}}function Ke(e){var t,r=e.data,i=!0;try{if(r.status===M.VIDEO_DATA_DROP_RATIO);else if("NewActiveSpeakerFirstframeCallback"===r.status)Z.default.Notify_APPUI(M.NEW_ACTIVE_SPEAKER_FIRST_FRAME_CALLBACK,{ssrc:r.ssrc});else if(r.status===M.VIDEO_RESOLUTION_UPDATE)Z.default.Notify_APPUI(M.CURRENT_VIDEO_RESOLUTION,{width:r.width,height:r.height});else if(r.status===M.VIDEO_ENCODED_DATA){i=!1;var a=r.data;z.a.triggerSync(M.VIDEO_DATA_FROM_WORKER,a)}else if(r.status===M.WORKER_MAIN_VIDEO_DECODE_RINGBUFFER_TICK){var n=Z.default.mediaSDKHandle.videoDecodeFrameBackSABRingBufferConsumer;n&&n.consumeAll(Z.default.mediaSDKHandle.bVideoDecodeFrameBackSABRingBufferConsumeCopyData)}else if(r.status===M.VIDEO_RENDER_MONITOR_LOG)Q.default.add_monitor2(r.data);else if(r.status==M.MULTIVIEW_WEBGL_CONTEXT_LOST)Q.default.add_monitor("MWGLF"),Z.default.Notify_APPUI(M.WEBGL_LOST_IN_MULTI_VIEW,{canvasId:r.canvasId,replaceCanvas:!!r.replaceCanvas});else if(r.status==M.WEBGL_CONTEXT_CREATE_FAILED)Q.default.add_monitor("MWCGLF");else if(r.status===M.VIDEO_DROP_RATIO_FROM_WCL){var o=r.data;z.a.triggerSync(M.VIDEO_DATA_FROM_WORKER,o)}else if(0===r.status)yt(r.video_ssrc,r.data,r.video_timestamp,r.video_width,r.video_height,r.rendering_x,r.rendering_y,r.rendering_w,r.rendering_h,r.rotation,r.yuv_limited);else if(r.status===M.Video_Dec_WASM_OK)Q.default.add_monitor("VDWS"),Z.default.isVideoDecodeWASMOK=!0,Z.default.videoDecInitInstance.setWasmSuccess(),Z.default.videoDecInitInstance.setSocketSuccess(),Z.default.isPreviewMode.videoDecode&&Z.default.Notify_APPUI_SAFE(M.PREVIEW_INIT_VIDEO_DECODE_SUCCESS);else if(r.status===M.DECODE_MESSAGE){var s=r.size;Z.default.Notify_APPUI(M.VIDEO_DECODE_MAX_SIZE,{ssrc:r.ssrc,size:s}),Q.default.add_monitor("VDMS:"+s)}else if(r.status===M.Video_Dec_WASM_FAILED)Q.default.add_monitor("VDWF",r.data),fe("VDWF"),Z.default.videoDecInitInstance.setWasmSuccess(!1);else if(r.status===M.Video_Dec_Handle_OK)Q.default.add_monitor("VDHS"),Z.default.videoDecInitInstance.setHanderSuccess();else if(r.status===M.Video_Dec_Handle_FAILED)Q.default.add_monitor("VDHF"),Z.default.videoDecInitInstance.setHanderSuccess(!1);else if(r.status===M.Video_Dec_WebSocket_OK)Q.default.add_monitor("VDSS");else if(r.status===M.Video_Dec_WebSocket_FAILED)Q.default.add_monitor("VDSF"),Z.default.videoDecInitInstance.isSocketInitSuccess()&&Z.default.Notify_APPUI_SAFE(M.VIDEO_WEBSOCKET_BROKEN,null),Z.default.videoDecInitInstance.setSocketSuccess(!1);else if(r.status===M.CONNECT_WEBTRANSPORT_OK)Q.default.add_monitor("VDWPS");else if(r.status===M.CONNECT_WEBTRANSPORT_CLOSE)Q.default.add_monitor("VDWPCLOSE"),we(J.h.ZOOM_CONNECTION_VIDEO,J.d.NET_WEBTRANSPORT);else if(r.status===M.CONNECT_WEBSOCKET_CLOSE)Q.default.add_monitor("VDWSCLOSE");else if(r.status===M.CURRENT_MEDIA_DATA_TRANSPORT_TYPE)Q.default.add_monitor("VDTTP:"+r.type);else if(r.status==M.MONITOR_MESSAGE)Z.default.monitorDecodeVideo=r,_r(r.data),i=!1;else if(r.status==M.APP_TROUBLESHOOTING_INFO)i=!1,Z.default.monitorVideoDecodeAPPInfo=r,Z.default.sendMessageToRwg(M.MONITOR_LOG,{evt:M.RWG_MONITOR_LOG_EVENT,seq:1,body:{data:Z.default.monitorVideoDecodeAPPInfo.data}}),Z.default.monitorVideoDecodeAPPInfo=null;else if(r.status==M.DOWNLOAD_WASM_FROM_MAIN_THREAD){var u=Z.default.localVideoDecMGR.map.get(Z.default.SPECIAL_ID);ze(r.url,u,J.f.VIDEO_DECODE),i=!1}else if(r.status==M.WCL_TROUBLESHOOTING_INFO)i=!1,Q.default.add_monitor("VD"+r.data);else if(r.status===M.CURRENT_DECODE_VIDEO_QUALITY)Z.default.Notify_APPUI_SAFE(M.CURRENT_DECODE_VIDEO_QUALITY,r.data);else if(r.status===M.CURRENT_DECODE_VIDEO_FPS)Z.default.Notify_APPUI_SAFE(M.CURRENT_DECODE_VIDEO_FPS,r.data);else if(r.status===M.VIDEO_QOS_DATA){var d=ie({encoding:!1},r.data);Z.default.Notify_APPUI_SAFE(M.VIDEO_QOS_DATA,d)}else r.status===M.HARDWARE_VIDEO_INFO_LOG?Q.default.add_monitor(r.data):"VIDEO_DECODE_PTR"===r.status?z.a.triggerSync("VIDEO_DECODE_PTR",r):"FIRST_VIDEO_FRAME"===r.status?(Z.default.Notify_APPUI_SAFE(M.FIRST_VIDEO_FRAME),Q.default.add_monitor("FVF")):r.status===M.NETWORK_QUALITY_CHANGE?Z.default.Notify_APPUI_SAFE(M.NETWORK_QUALITY_CHANGE,{isUplink:r.isUplink,networkLevel:r.networkLevel,bwLevel:r.bwLevel}):"WFMO"==r.status?(i=!1,Ye(J.f.VIDEO_DECODE)):r.status==M.Video_Sharing_Handle_OK?i=!0:(r.status==x.p&&(i=!1),le(J.f.VIDEO_DECODE,e))}catch(e){Y.default.error("Error in VideoDec_Listener",e)}i&&null!==(t=Z.default.mediaSDKHandle)&&void 0!==t&&t.isSupportVideoShare&&He(e)}function qe(e){var t,r=e.data,i=!0;if(r!==M.WORKER_MAIN_VIDEO_ENCODE_RINGBUFFER_TICK){try{if(r.status===M.VIDEO_DATA_DROP_RATIO);else if("VBPredictDone"===r.status)Q.default.add_monitor("VBPOK"+r.predictCostTime),Z.default.isPreviewMode.videoEncode&&ye.enqueueMessage({name:ye.nameMap.INIT_VIDEO_ENCODE_SUCCESS,messageParams:[M.VB_MODEL_PRELOADING_OK,null],direction:ye.direction.SDK_TO_APP}),Z.default.Notify_APPUI(M.VB_MODEL_PRELOADING_OK,null);else if("VBPredictAbout3s"===r.status)Q.default.add_monitor("VBP3S"),Z.default.Notify_APPUI(M.VB_MODEL_PRELOADING_3S,null);else if("VBPredictAbout10s"===r.status)Q.default.add_monitor("VBP10S"),Z.default.Notify_APPUI(M.VB_MODEL_PRELOADING_10S,null);else if("vbInitializeFailed"===r.status)Y.default.error("VB tensorflow backend initialize failed"),Q.default.add_monitor("VBBEF"),Z.default.Notify_APPUI(M.VIDEO_VB_SETTING_PARA_ERROR,ne.FAIL);else if(r.status===M.VIDEO_ENCODED_DATA){var a=r.data;z.a.triggerSync(M.VIDEO_DATA_FROM_WORKER,a),i=!1}else if(0===r.status);else if(r.status===M.Video_Enc_WASM_OK||r.status===M.Video_Dec_WASM_OK)Q.default.add_monitor("VEWS"),Z.default.isVideoEncodeWASMOK=!0,Z.default.videoInitInstance.setWasmSuccess();else if(r.status===M.Video_Enc_WASM_FAILED)Q.default.add_monitor("VEWF",r.data),fe("VEWF"),Z.default.videoInitInstance.setWasmSuccess(!1);else if(r.status===M.Video_Enc_Handle_OK||M.Video_Dec_Handle_OK===r.status)Q.default.add_monitor("VEHS"),Z.default.videoInitInstance.setHanderSuccess();else if(r.status===M.Video_Enc_Handle_FAILED||M.Video_Dec_Handle_FAILED===r.status)Q.default.add_monitor("VEHF"),Z.default.videoInitInstance.setHanderSuccess(!1);else if(r.status===M.Video_Enc_WebSocket_OK||M.Video_Dec_WebSocket_OK===r.status)Q.default.add_monitor("VESS"),Z.default.videoInitInstance.setSocketSuccess();else if(r.status===M.Video_Enc_WebSocket_FAILED||r.status===M.Video_Dec_WebSocket_FAILED)Q.default.add_monitor("VESF"),Z.default.videoInitInstance.isSocketInitSuccess()&&Z.default.Notify_APPUI_SAFE(M.VIDEO_WEBSOCKET_BROKEN,null),Z.default.videoInitInstance.setSocketSuccess(!1);else if(r.status===M.CONNECT_WEBTRANSPORT_OK)Q.default.add_monitor("VEWPS");else if(r.status===M.CONNECT_WEBTRANSPORT_CLOSE)Q.default.add_monitor("VEWPCLOSE");else if(r.status===M.CONNECT_WEBSOCKET_CLOSE)Q.default.add_monitor("VEWSCLOSE");else if(r.status===M.CURRENT_MEDIA_DATA_TRANSPORT_TYPE)Q.default.add_monitor("VETTP:"+r.type);else if(r.status===M.CURRENT_ENCODED_TYPE)Q.default.add_monitor("VEHORS:"+r.type);else if(r.status===M.Video_Capture_Tick)Z.default.mediaSDKHandle.Process_Video();else if(r.status===M.CURRENT_CAPTURE_VIDEO_WIDTH_HEIGHT_FROM_WORKER)Z.default.Notify_APPUI(M.CURRENT_CAPTURE_VIDEO_WIDTH_HEIGHT,{width:r.width,height:r.height});else if(r.status===M.VIDEO_CAPTURER_RESOLUTION_CHANGE)Q.default.add_monitor("VCRC"+r.width),Z.default.mediaSDKHandle.Change_Video_Capture_Resolution(r.width,r.height);else if(r.status==M.VIDEO_CAPTURE_FRAME_COUNT_STATISTIC)Q.default.add_monitor2("VCFOK");else if(r.status==M.UNSUPPORTED_VIDEO_FORMAT)Q.default.add_monitor("VCFF","format: ".concat(r.format));else{if(r.status==M.MONITOR_MESSAGE)return i=!1,void _r(r.data);if(r.status==M.APP_TROUBLESHOOTING_INFO)i=!1,Z.default.monitorVideoEncodeAPPInfo=r,_r(Z.default.monitorVideoEncodeAPPInfo.data),Z.default.monitorVideoEncodeAPPInfo=null;else if(r.status==M.SHARING_DECODE_MONITOR_MESSAGE)Z.default.monitorEncodeSharing=r;else if(r.status===M.DOWNLOAD_WASM_FROM_MAIN_THREAD){var n=Z.default.localVideoEncMGR.map.get(Z.default.SPECIAL_ID);ze(r.url,n,J.f.VIDEO_ENCODE),i=!1}else if(r.status==M.WCL_TROUBLESHOOTING_INFO)i=!1,Q.default.add_monitor("VE"+r.data);else if(r.status==M.THREAD_ENCODE_BUFFER){var o=Z.default.SPECIAL_ID;if(Z.default.localVideoDecMGR)(s=Z.default.localVideoDecMGR.map.get(o))&&s.postMessage({command:"encodedbuffer",wasmMemory:r.wasmMemory})}else if(r.status==M.WASMPTR){var s,u=Z.default.SPECIAL_ID;if(Z.default.localVideoDecMGR)(s=Z.default.localVideoDecMGR.map.get(u))&&s.postMessage({command:"encodedimagebitmapwasmptr",data:r.data,wasmMemory:r.wasmMemory});else Z.default.isPreviewMode.videoEncode&&ye.enqueueMessage({name:ye.nameMap.INIT_VIDEO_DECODE_SUCCESS,messageParams:[J.f.VIDEO_DECODE,{command:"encodedimagebitmapwasmptr",data:r.data,wasmMemory:r.wasmMemory}],direction:ye.direction.SDK_TO_WORKER})}else if(r.status===M.VIDEO_QOS_DATA){var d=ie({encoding:!0},r.data);Z.default.Notify_APPUI_SAFE(M.VIDEO_QOS_DATA,d)}else if(r.status===M.VIDEOSHARE_QOS_DATA){var c=ie({encoding:!0},r.data);Z.default.Notify_APPUI_SAFE(M.VIDEOSHARE_QOS_DATA,c)}else if(r.status==M.MULTIVIEW_WEBGL_CONTEXT_LOST)Z.default.Notify_APPUI(M.WEBGL_LOST_IN_MULTI_VIEW,{canvasId:r.canvasId,replaceCanvas:!!r.replaceCanvas});else if("VIDEO_ENCODE_PTR"===r.status)z.a.triggerSync("VIDEO_ENCODE_PTR",r);else if(r.status===M.Video_Encode_Preview_OK)Z.default.mediaSDKHandle.init_Notify_APPUI(!0,J.f.VIDEO_ENCODE);else if(r.status==M.VIDEO_SHARING_CAPTURER_RESOLUTION_CHANGE)Z.default.mediaSDKHandle.Change_Sharing_Capture_Resolution(r.mode);else if(r.status===M.NETWORK_QUALITY_CHANGE)Z.default.Notify_APPUI_SAFE(M.NETWORK_QUALITY_CHANGE,{isUplink:r.isUplink,networkLevel:r.networkLevel,bwLevel:r.bwLevel});else if("WFMO"==r.status)i=!1,Ye(J.f.VIDEO_ENCODE);else if(r.status==x.R)Z.default.Notify_APPUI_SAFE(M.MEDIA_HEALTH_CHECK_FAILED,x.R),Y.default.error("Health Check Failed: ".concat(x.R,", ").concat(r.videoType,",").concat(r.subforme,",").concat(r.hasRTPPackets));else if(r.status===M.EXPOSE_VB_FRAME){var l=r.frame,h=Z.default.frameSent,f=Z.default.frameReceived;Z.default.extVBPort&&h===f?(Z.default.extVBPort.postMessage({type:M.UNIFIED_VB_FRAME,frame:l}),Z.default.frameSent++):Q.default.add_monitor("EVBOF-".concat(h-f)),l.close()}else r.status==M.Video_Sharing_Handle_OK?i=!0:(r.status==x.p&&(i=!1),le(J.f.VIDEO_ENCODE,e))}}catch(e){Y.default.error("Error in VideoEnc_Listener",e)}i&&null!==(t=Z.default.mediaSDKHandle)&&void 0!==t&&t.isSupportVideoShare&&je(e)}else{var p=Z.default.mediaSDKHandle.videoEncodeRingbufferConsumer;p&&p.consumeAll()}}function Xe(e,t){var r;try{r=new WebAssembly.Memory({initial:e,maximum:t,shared:!0})}catch(e){Y.default.error("E:H Allocate WasmMemory Failed",e)}return r}function Ye(e){var t,r,i=!1,a=q.default.isIphoneOrIpadBrowser()||q.default.isIpadOS()?4096:8192,n=Z.default.mediaSDKHandle.is32bitbrowser||!q.default.isChromeVersionHigherThan(90)||q.default.isChromeOS();if(e==J.f.VIDEO_ENCODE){var o;if(r=Z.default.localVideoEncMGR.map.get(0),Z.default.VE)i=!0,t=Z.default.VE;else null!==(o=Z.default.mediaSDKHandle)&&void 0!==o&&o.isSupportVideoShare&&(a=32e3),t=Xe(1024,a),n&&(Z.default.VE=t);Z.default.localVideoPara&&(Z.default.localVideoPara.VE=t)}else if(e==J.f.VIDEO_DECODE){var s;if(r=Z.default.localVideoDecMGR.map.get(0),Z.default.VD)i=!0,t=Z.default.VD;else null!==(s=Z.default.mediaSDKHandle)&&void 0!==s&&s.isSupportVideoShare&&(a=16384),t=Xe(1024,a),n&&(Z.default.VD=t);Z.default.localVideoPara&&(Z.default.localVideoPara.VD=t)}else e==J.f.SHARING_ENCODE?(r=Z.default.localSharingEncMGR.map.get(0),Z.default.SE?(i=!0,t=Z.default.SE):(t=Xe(1024,a),n&&(Z.default.SE=t)),Z.default.localVideoPara&&(Z.default.localVideoPara.SE=t)):e==J.f.SHARING_DECODE&&(r=Z.default.localSharingDecMGR.map.get(0),Z.default.SD?(i=!0,t=Z.default.SD):(t=Xe(1024,a),n&&(Z.default.SD=t)),Z.default.localVideoPara&&(Z.default.localVideoPara.SD=t));i&&new Uint8Array(t.buffer).fill(0);r.postMessage({command:"wasmMemory",data:t})}function ze(e,t,r){q.default.downloadAndCompileWebAssembly(e,r,Q.default,!q.default.browser.isSafari&&Z.default.enableStreamingInstantiate).then((function(e){t.postMessage({command:"DOWNLOAD_WASM_FROM_MAIN_THREAD_OK",data:e})})).catch((function(e){t.postMessage({command:"DOWNLOAD_WASM_FROM_MAIN_THREAD_FAILED"})}))}var Qe,Je,Ze,$e,et=(Qe={send:null,recvWorklet:null,recvWorker:null},Je=null,Ze=/(WCL_MCM_AUDIO.*?)(\{\[SPEECHINPUT_R16\]\}),(.*?),(.*?),(.*?),(.*?),(\{\[SEND\]\}.*?)(\{\[DENOISE\]\}.*?)\{\[CAPTURE\]\},(.*?),(\{\[AEC\]\},.*?),(\{\[END\]\})/,$e=/(WCL_MCM_AUDIO.*?)(\{\[SPEECHOUTPUT_R16\]\},)(.*?),(\{\[NETWORK\]\}.*?)(\{\[RECEIVE\]\}.*?)\{\[RENDER\]\},(.*?),(.*?)(\{\[END\]\})/,{push:function(e){var t=e.log,r=e.logSource;if(t&&this._isLogValid(t)){if(this._checkNeedReportImmediate(t,r))return r===x.g?this._sendWebRTCLog(t):this._report(t);r===x.c?Qe.send=t:r===x.b?Qe.recvWorker=t:Qe.recvWorklet=t,this._clearTImer(),Je=setTimeout(this._checkNeedReport.bind(this),2e3)}},_isLogValid:function(e){return!!(e.match("WCL_MCM_AUDIO")||e.match("JITTER")||e.match("DEVICE")||e.match("ORIGINAL_SOUND")||e.match("AUDIO_CODEC_EVENT")||e.match("AUDIOEVENT"))},_checkNeedReportImmediate:function(e,t){return t===x.g||!e.match("SPEECHOUTPUT_R16")&&!e.match("SPEECHINPUT_R16")},_checkNeedReport:function(){var e=this._generateLog();e&&this._report(e)},_sendWebRTCLog:function(e){var t=this._parseSend(e),r=t.denoise,i=t.captureCounter;this._report("WCL_AB,"+r+"{[CAPTURTE]},"+i+",{[END]}")},_generateLog:function(){if(!Qe.send&&!Qe.recvWorker&&!Qe.recvWorklet)return null;var e=this._parseSend(Qe.send),t=e.inputputPrefix,r=e.speechInStr,i=e.speechInOutStr,a=e.denoiseInStr,n=e.denoiseOutStr,o=e.send,s=e.denoise,u=e.captureCounter,d=e.aec,c={};Qe.recvWorklet&&(c=this._parseRecv(Qe.recvWorklet));var l=this._parseRecv(Qe.recvWorker),h=c.outputPrefix||l.outputPrefix,f=c.speechOutStr||l.speechOutStr,p=c.network||l.network,v=c.renderCounter||l.renderCounter,m=c.others||l.others,g=l.receive;this.recordEchoLog(d);var _=t||h,S="{[SPEECH_R16]},".concat(r,",").concat(i,",").concat(f,",").concat(a,",").concat(n,",").concat(d,",").concat(p).concat(g).concat(m,"{[PROCESS]},").concat(u,",").concat(v,",").concat(o).concat(s,"{[END]}");return"".concat(_).concat(S)},recordEchoLog:function(e){var t=e.match(/-?\d+/g);t&&(parseInt(t[0])||parseInt(t[1]))&&Y.default.error("echo captured: "+t[0]+": "+t[1])},_parseSend:function(e){var t=Ze.exec(e||"")||[];return{inputputPrefix:t[1]||"",speechInStr:t[3]||"",speechInOutStr:t[4]||"",denoiseInStr:t[5]||"",denoiseOutStr:t[6]||"",send:t[7]||"",denoise:t[8]||"",captureCounter:t[9]||"",aec:t[10]||""}},_parseRecv:function(e){var t=$e.exec(e||"")||[];return{outputPrefix:t[1]||"",speechOutStr:t[3]||"",network:t[4]||"",receive:t[5]||"",renderCounter:t[6]||"",others:t[7]||""}},_report:function(e){e&&Z.default.sendMessageToRwg(M.MONITOR_LOG,{evt:M.RWG_MONITOR_LOG_EVENT,seq:1,body:{data:e}})},_clearTImer:function(){clearTimeout(Je),Je=null},clear:function(){Qe={send:null,recv:null},this._clearTImer()}});function tt(e){var t=e.data;try{if(0===t.status)t.time?Z.default.AudioNode&&Z.default.AudioNode.postData("data",{ssrc:Z.default.CurrentSSRC,data:t.data,time:t.time}):Z.default.AudioNode&&Z.default.AudioNode.postData("data",{ssrc:Z.default.CurrentSSRC,data:t.data,time:null});else if(t.status===M.Audio_Enc_WASM_OK||t.status===M.Audio_Dec_WASM_OK)Q.default.add_monitor("ADWS"),Z.default.isAudioDecodeWASMOK=!0,Z.default.audioDecInitInstance.setWasmSuccess(),Z.default.isPreviewMode.audioDecode&&Z.default.Notify_APPUI_SAFE(M.PREVIEW_INIT_AUDIO_DECODE_SUCCESS);else if(t.status===M.Audio_Dec_WASM_FAILED)Q.default.add_monitor("ADWF",t.data),fe("ADWF"),Z.default.audioDecInitInstance.setWasmSuccess(!1);else if(t.status===M.Audio_Dec_Handle_OK)Q.default.add_monitor("ADHS"),Z.default.audioDecInitInstance.setHanderSuccess();else if(t.status===M.Audio_Dec_Handle_FAILED)Q.default.add_monitor("ADHF"),Z.default.audioDecInitInstance.setHanderSuccess(!1);else if(t.status===M.Audio_Dec_WebSocket_OK)Q.default.add_monitor("ADSS"),Z.default.audioDecInitInstance.setSocketSuccess();else if(t.status===M.Audio_Dec_WebSocket_FAILED)Q.default.add_monitor("ADSF"),Z.default.audioDecInitInstance.isSocketInitSuccess()&&Z.default.Notify_APPUI_SAFE(M.AUDIO_WEBSOCKET_BROKEN,null),Z.default.audioDecInitInstance.setSocketSuccess(!1);else if(t.status===M.CONNECT_WEBTRANSPORT_OK)Q.default.add_monitor("ADWPS");else if(t.status===M.CONNECT_WEBTRANSPORT_CLOSE)Q.default.add_monitor("ADWPCLOSE"),we(J.h.ZOOM_CONNECTION_AUDIO,J.d.NET_WEBTRANSPORT);else if(t.status===M.CONNECT_WEBSOCKET_CLOSE)Q.default.add_monitor("ADWSCLOSE");else if(t.status===M.CURRENT_MEDIA_DATA_TRANSPORT_TYPE)Q.default.add_monitor("ADTTP:"+t.type);else if(t.status==M.MONITOR_MESSAGE)Z.default.monitorDecodeAudio=t;else if(t.status===M.DOWNLOAD_WASM_FROM_MAIN_THREAD){var r=Z.default.localAudioDecMGR.map.get(Z.default.SPECIAL_ID);ze(t.url,r,J.f.AUDIO_DECODE)}else if(t.status==M.WCL_TROUBLESHOOTING_INFO)Q.default.add_monitor("AD"+t.data);else if(t.status==M.CURRENT_SSRC_TIME)t.at&&Z.default.CurrentSSRCTime!==t.at&&(Z.default.CurrentSSRCTime=t.at,Z.default.audioPlayTime=Date.now()),t.st&&Z.default.mediaSDKHandle.SharingRenderObj&&Z.default.mediaSDKHandle.SharingRenderObj.SetcATimeStamp(t.st);else if("multiCurrentTime"==t.status){if(Z.default.localVideoDecMGR){var i=Z.default.localVideoDecMGR.map.get(Z.default.SPECIAL_ID);i&&i.postMessage({command:"audioDecodeTime",data:t.data,status:1})}}else if(t.status==M.AUDIO_ENCODED_DATA)z.a.triggerSync(M.AUDIO_DATA_FROM_WORKER,t.data);else if(t.status===M.AUDIO_MONITOR_LOG)et.push({log:t.data,logSource:x.b});else if(t.status===M.AUDIO_QOS_DATA){var a=ie({encoding:!1},t.data);Z.default.Notify_APPUI_SAFE(M.AUDIO_QOS_DATA,a)}else t.status===M.NETWORK_QUALITY_CHANGE_AUDIO?Z.default.Notify_APPUI_SAFE(M.NETWORK_QUALITY_CHANGE_AUDIO,{isUplink:t.isUplink,networkLevel:t.networkLevel,bwLevel:t.bwLevel}):le(J.f.AUDIO_DECODE,e)}catch(e){Y.default.error("Error in AudioDecodeListener",e)}}function rt(e){if(Z.default.localAudioDecMGR||Z.default.isPreviewMode.audioEncode)try{var t=e.data;if(t.status===M.WORKER_MAIN_AUDIO_ENCODE_RINGBUFFER_TICK){var r=Z.default.mediaSDKHandle.audioEncodeRingBufferConsumer;r&&r.consumeAll(!0)}else if(0==t.status){var i=Z.default.SPECIAL_ID,a=Z.default.localAudioDecMGR.map.get(i);a&&a.postMessage({command:"EncodedAudioFrame",data:t.data},[t.data.buffer])}else if(t.status==M.AUDIO_ENCODED_DATA)z.a.triggerSync(M.AUDIO_DATA_FROM_WORKER,t.data);else if(t.status===M.Audio_Enc_WASM_OK||t.status===M.Audio_Dec_WASM_OK)Q.default.add_monitor("AEWS"),Z.default.isAudioEncodeWASMOK=!0,Z.default.audioEncodeInitInstance.setWasmSuccess();else if(t.status===M.Audio_Enc_WASM_FAILED||t.status===M.Audio_Dec_WASM_FAILED)Q.default.add_monitor("AEWF",t.data),fe("AEWF"),Z.default.audioEncodeInitInstance.setWasmSuccess(!1);else if(t.status===M.Audio_Dec_Handle_OK)Q.default.add_monitor("AEHS"),Z.default.audioEncodeInitInstance.setHanderSuccess();else if(t.status===M.Audio_Dec_WebSocket_OK)Q.default.add_monitor("AESS"),Z.default.audioEncodeInitInstance.setSocketSuccess();else if(t.status===M.Audio_Dec_WebSocket_FAILED)Q.default.add_monitor("AESF"),Z.default.audioEncodeInitInstance.isSocketInitSuccess()&&Z.default.Notify_APPUI_SAFE(M.AUDIO_WEBSOCKET_BROKEN,null),Z.default.audioEncodeInitInstance.setSocketSuccess(!1);else if(t.status===M.Audio_Dec_Handle_FAILED)Q.default.add_monitor("AEHF"),Z.default.audioEncodeInitInstance.setHanderSuccess(!1);else if(t.status===M.Audio_Enc_Handle_FAILED)Z.default.Notify_APPUI_SAFE(M.Audio_Enc_Handle_FAILED,null);else if(t.status===M.CONNECT_WEBTRANSPORT_OK)Q.default.add_monitor("AEWPS");else if(t.status===M.CONNECT_WEBTRANSPORT_CLOSE)Q.default.add_monitor("AEWPCLOSE");else if(t.status===M.CONNECT_WEBSOCKET_CLOSE)Q.default.add_monitor("AEWSCLOSE");else if(t.status===M.CURRENT_MEDIA_DATA_TRANSPORT_TYPE)Q.default.add_monitor("AETTP:"+t.type);else if(t.status===M.Audio_Mute)Z.default.Notify_APPUI&&Z.default.Notify_APPUI(M.AUDIO_ZERO_DATA,null);else if(t.status===M.AUDIO_DELAY)Z.default.indexDbObject.put(t.delay,"delay"),Z.default.openIndexFlag&&Z.default.indexDbObject.select("delay");else if(t.status===M.DOWNLOAD_WASM_FROM_MAIN_THREAD){var n=Z.default.localAudioEncMGR.map.get(Z.default.SPECIAL_ID);ze(t.url,n,J.f.AUDIO_ENCODE)}else if(t.status==M.WCL_TROUBLESHOOTING_INFO)Q.default.add_monitor("AE"+t.data);else if(t.status==M.AUDIO_CLIPPING);else if(t.status===M.AUDIO_MONITOR_LOG)et.push({log:t.data,logSource:x.c});else if(t.status===M.AUDIO_QOS_DATA){var o=ie({encoding:!0},t.data);Z.default.Notify_APPUI_SAFE(M.AUDIO_QOS_DATA,o)}else t.status===M.Audio_Encode_Preview_OK?Z.default.mediaSDKHandle.init_Notify_APPUI(!0,J.f.AUDIO_ENCODE):t.status===M.SPEAKING_WHEN_MUTE?Z.default.Notify_APPUI_SAFE(M.SPEAKING_WHEN_MUTE):t.status===M.AUDIO_LEVEL_INDICATOR?Z.default.Notify_APPUI_SAFE(M.AUDIO_LEVEL_INDICATOR,{value:t.value}):t.status===M.NETWORK_QUALITY_CHANGE_AUDIO?Z.default.Notify_APPUI_SAFE(M.NETWORK_QUALITY_CHANGE_AUDIO,{isUplink:t.isUplink,networkLevel:t.networkLevel,bwLevel:t.bwLevel}):t.status==x.d?(Z.default.Notify_APPUI_SAFE(M.MEDIA_HEALTH_CHECK_FAILED,x.d),Y.default.error("Health Check Failed: ".concat(x.d,", ").concat(t.videoType,",").concat(t.subforme,",").concat(t.hasRTPPackets))):le(J.f.AUDIO_ENCODE,e)}catch(e){Y.default.error("Error in AudioEnc_Listener",e)}}function it(e,t){return at.apply(this,arguments)}function at(){return(at=d()(g.a.mark((function e(t,r){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!t.isDestroy){e.next=2;break}return e.abrupt("return",ae("WorkerType:sharingEnc;The relative SDK instance is destroy, don't start relative worker, avoid multiple same workers. "));case 2:if(Z.default.isSharingEncodeThreadStart){e.next=6;break}return Z.default.isSharingEncodeThreadStart=!0,e.next=6,ce(r,Z.default.localSharingEncMGR,je,J.f.SHARING_ENCODE,t);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nt(e,t){return ot.apply(this,arguments)}function ot(){return(ot=d()(g.a.mark((function e(t,r){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Z.default.isSharingDecodeThreadStart){e.next=4;break}return Z.default.isSharingDecodeThreadStart=!0,e.next=4,ce(r,Z.default.localSharingDecMGR,He,J.f.SHARING_DECODE,t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function st(e){return ut.apply(this,arguments)}function ut(){return(ut=d()(g.a.mark((function e(t){var r,i,a,n,o,s;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=q.default.browser.isSafari&&q.default.getMacSafariMajorVersion()<16,Z.default.sharedBuffer||!q.default.isSupportSharedArrayBuffer()||r||(ae("LP2PSP"),i=1,(q.default.browser.isFirefox||48e3===q.default.getAudioContextConfigure().sampleRate)&&(i=48),a=640,a=q.default.isChromeVersionHigherThan(74)?960:t/100*2,n=q.default.isBrowserSupportStereo()?2:1,o=q.default.isSupportPlayStereo()?2:1,s=q.default.isSupportSharingStereo()?2:1,Z.default.sharedBuffer={inputState:new SharedArrayBuffer(24),inputBuffer:new SharedArrayBuffer(i*a*4*4*n),sharingInputState:new SharedArrayBuffer(24),sharingInputBuffer:new SharedArrayBuffer(i*a*4*4*s),outputState:new SharedArrayBuffer(24),outputBuffer:new SharedArrayBuffer(i*a*4*4*2),rtpBuffer:new SharedArrayBuffer(120008),echoState:Z.default.enableEchoDetection?new SharedArrayBuffer(24):void 0,echoBuffer:Z.default.enableEchoDetection?new SharedArrayBuffer(i*a*4*4*o):void 0}),Q.default.add_monitor("INITSAB"+!!Z.default.sharedBuffer),Z.default.decoderinworklet=Z.default.decoderinworkletOP&&!!Z.default.sharedBuffer;case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dt(e,t){var r;Z.default.localSharingPara?Object.assign(Z.default.localSharingPara,t):Z.default.localSharingPara=t,r=e,Z.default.Sharing_WebSocket_Ip_Address=r}function ct(e,t){Z.default.localAudioPara?Object.assign(Z.default.localAudioPara,t):Z.default.localAudioPara=t,ht(e)}function lt(e,t){Z.default.localVideoPara?Object.assign(Z.default.localVideoPara,t):Z.default.localVideoPara=t,pt(e)}function ht(e){Z.default.Audio_WebSocket_Ip_Address=e}function ft(e){Z.default.Audio_Web_Transport_Ip_Address=e}function pt(e){Z.default.Video_WebSocket_Ip_Address=e}function vt(e){Z.default.Video_Web_Transport_Ip_Address=e}function mt(){!function(e){if(e=Z.default.SPECIAL_ID,Z.default.localAudioEncMGR){var t=Z.default.localAudioEncMGR.map.get(e);t&&(t.postMessage({command:2}),Z.default.localAudioEncMGR.map.delete(e)),Z.default.isAudioEncodePostStart=!1}}(Z.default.SPECIAL_ID),function(e){if(e=Z.default.SPECIAL_ID,Z.default.localAudioDecMGR){var t=Z.default.localAudioDecMGR.map.get(Z.default.SPECIAL_ID);t&&(t.postMessage({command:2}),Z.default.localAudioDecMGR.map.delete(e)),Z.default.isAudioDecodePostStart=!1}}(Z.default.SPECIAL_ID),Z.default.localAudioDecMGR=null,Z.default.localAudioEncMGR=null}function gt(){!function(e){if(e=Z.default.SPECIAL_ID,Z.default.localVideoDecMGR){var t=Z.default.localVideoDecMGR.map.get(e);t&&(t.postMessage({command:2}),Z.default.localVideoDecMGR.map.delete(e)),Z.default.isVideoDecodePostStart=!1}}(Z.default.SPECIAL_ID),Z.default.localVideoDecMGR=null,Z.default.localVideoEncMGR=null}function _t(){!function(){var e=Z.default.SPECIAL_ID;if(Z.default.localSharingDecMGR){var t=Z.default.localSharingDecMGR.Get(e);t&&(t.postMessage({command:2}),Z.default.localSharingDecMGR=null),Z.default.isSharingDecodeThreadStart=!1}}()}function St(e,t,r,i,a){if(Z.default.localVideoEncMGR){var n=Z.default.localVideoEncMGR.map.get(e);if(n){var o={command:"encodeVideoFrame",data:t,stride:r,x:i,y:a};n.postMessage(o,[o.data.buffer])}}}function Et(e,t,r,i,a,n){var o,s,u;(s=null!==(o=Z.default.mediaSDKHandle)&&void 0!==o&&o.isSupportVideoShare?Z.default.localVideoEncMGR.map.get(e):Z.default.localSharingEncMGR.map.get(e))&&(t?(u={command:"encodeSharingFrame",data:t,width:a,height:n},s.postMessage(u,[u.data.buffer])):(u={command:"encodeSharingFrame"},s.postMessage(u)))}function bt(e){Z.default.localSharingDecMGR&&("sharingPara"==e.type&&(Q.default.add_monitor("SHPA"),z.a.publish(M.SHARING_PARAM_INFO_FROM_SOCKET,e.data),Z.default.Notify_APPUI(M.SHARING_PARA,e.data)),Z.default.isSharingPlayWork&&Z.default.localSharingDecMGR.PutData(e))}function yt(e,t,r,i,a,n,o,s,u,d,c){if(Z.default.isVideoPlayWork){var l={yuvdata:t,ntptime:r,ssrc:e,width:i,height:a,r_x:n,r_y:o,r_w:s,r_h:u,rotation:d,yuv_limited:c};l.ssrc=l.ssrc>>10<<10,Z.default.mediaSDKHandle.VideoRenderObj.Put_Video_Data_Queue(l,15)}}function Ct(){return Z.default.localSharingDecMGR?Z.default.localSharingDecMGR.SharingQueueMGR.ClearQueue():Z.default.localMouseDecMGR?Z.default.localMouseDecMGR.SharingQueueMGR.ClearQueue():0}function At(e){return Rt.apply(this,arguments)}function Rt(){return(Rt=d()(g.a.mark((function e(t){var r,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Z.default.isPreviewMode.videoDecode){e.next=2;break}return e.abrupt("return");case 2:if(Z.default.localVideoDecMGR){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,Z.default.videoDecInitInstance.wasmSuccessPromise;case 6:if(Te(t)){e.next=8;break}return e.abrupt("return",!1);case 8:(r=Z.default.localVideoDecMGR.map.get(Z.default.SPECIAL_ID))&&!Z.default.isVideoDecodePostStart&&(Z.default.isVideoDecodePostStart=!0,i=ie(ie({command:1,_id:t._id,websocket_ip_address:Z.default.Video_WebSocket_Ip_Address?Z.default.Video_WebSocket_Ip_Address+"&mode=5":void 0,confId:Z.default.localVideoPara.confId,confKey:"",logon:Z.default.localVideoPara.logon,mtu_size:0,meetingid:Z.default.localVideoPara.meetingid,meetingnumb:Z.default.localVideoPara.meetingnumb,videoencodethreadnumb:1,videodecodethreadnumb:Z.default.localVideoPara.videodecodethreadnumb,isFirefox:Z.default.localVideoPara.isFirefox,isSupportMultiThread:Z.default.localVideoPara.isSupportMultiThread,isSupportVideoTrackReader:Z.default.localVideoPara.isSupportVideoTrackReader,isSupportOffscreenCanvas:Z.default.localVideoPara.isSupportOffscreenCanvas,isenablehw:Z.default.localVideoPara.isenablehw,isEnableVideoDecodeHardWareThread:Z.default.localVideoPara.isEnableVideoDecodeHardWareThread,qoson:Z.default.localVideoPara.qoson,isEnableHardWareThread:Z.default.localVideoPara.isEnableHardWareThread,isTeslaMode:Z.default.localVideoPara.isTeslaMode,enableMultiDecodeVideoWithoutSAB:!!Z.default.enableMultiDecodeVideoWithoutSAB},Z.default.Video_Web_Transport_Ip_Address?{webtransportURL:Z.default.Video_Web_Transport_Ip_Address+"&mode=1"}:{}),{},{enableAudioBridge:Z.default.enableAudioBridge,graphicalname:q.default.graphicName,vendorname:q.default.graphicvendorname,platformType:Z.default.localVideoPara.platformType,rendererType:Z.default.localVideoPara.rendererType,isWebCodecDecoderOnWhitelist:Z.default.localVideoPara.isWebCodecDecoderOnWhitelist}),r.postMessage(i));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function It(e,t,r,i){return wt.apply(this,arguments)}function wt(){return(wt=d()(g.a.mark((function e(t,r,i,a){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Z.default.isVideoDecodeThreadStart){e.next=4;break}return Z.default.isVideoDecodeThreadStart=!0,e.next=4,ce(a,Z.default.localVideoDecMGR,Ke,J.f.VIDEO_DECODE,i);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Tt(e){return kt.apply(this,arguments)}function kt(){return(kt=d()(g.a.mark((function e(t){var r,i,a,n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Z.default.localVideoEncMGR){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Z.default.videoInitInstance.wasmSuccessPromise;case 4:if(Te(t)){e.next=6;break}return e.abrupt("return");case 6:(r=Z.default.localVideoEncMGR.map.get(Z.default.SPECIAL_ID))&&!Z.default.isVideoEncodePostStart&&(Z.default.isVideoEncodePostStart=!0,i=0,i="firefox"===q.default.browserType.browser?1080:1070,Z.default.mediaSDKHandle.mtu_size=i,a=null,Z.default.ivObj&&(a=Z.default.ivObj[J.f.VIDEO_ENCODE],a=q.default.stringSplitByComma2Buffer(a)),n=ie(ie({command:1,_id:t._id,websocket_ip_address:Z.default.Video_WebSocket_Ip_Address?Z.default.Video_WebSocket_Ip_Address+"&mode=2":void 0,confId:Z.default.localVideoPara.confId,confKey:"",logon:Z.default.localVideoPara.logon,sendvideo:!0,isChromeOrEdge:q.default.browser.isChrome,mtu_size:i,meetingid:Z.default.localVideoPara.meetingid,meetingnumb:Z.default.localVideoPara.meetingnumb,videoencodethreadnumb:Z.default.localVideoPara.videoencodethreadnumb,iv:a,videodecodethreadnumb:Z.default.localVideoPara.videodecodethreadnumb,isSupportMultiThread:Z.default.localVideoPara.isSupportMultiThread,qoson:Z.default.localVideoPara.qoson,isSupportVirtualBackground:Z.default.localVideoPara.isSupportVirtualBackground,uplimit:Z.default.uplimit,isSupportWebCodecEnocde:Z.default.localVideoPara.isSupportWebCodecEnocde,initWebCodecFlag:Z.default.localVideoPara.initWebCodecFlag,is360penablehw:Z.default.localVideoPara.is360penablehw,enable720p:Z.default.localVideoPara.enable720p,isPreviewMode:Z.default.isPreviewMode.videoEncode},Z.default.Video_Web_Transport_Ip_Address?{webtransportURL:Z.default.Video_Web_Transport_Ip_Address+"&mode=2"}:{}),{},{enableAudioBridge:Z.default.enableAudioBridge,platformType:Z.default.localVideoPara.platformType,rendererType:Z.default.localVideoPara.rendererType,graphicalname:q.default.graphicName,vendorname:q.default.graphicvendorname,enableMultiDecodeVideoWithoutSAB:!!Z.default.enableMultiDecodeVideoWithoutSAB,IsRenderInWorker:Z.default.localVideoPara.IsRenderInWorker,enableVBWasmBackend:t.enableVBWasmBackend}),r.postMessage(n),Z.default.tfjsurl&&r.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:Z.default.tfjsurl,type:"js"}),Z.default.vbbin&&Z.default.vbjson&&r.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:Z.default.vbbin,json:Z.default.vbjson},index:0}),Z.default.afnbin&&Z.default.afnjson&&(r.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:Z.default.afnbin,json:Z.default.afnjson},index:1}),Z.default.basebin&&Z.default.basejson&&r.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:Z.default.basebin,json:Z.default.basejson},index:2})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dt(e,t,r,i){return Ot.apply(this,arguments)}function Ot(){return(Ot=d()(g.a.mark((function e(t,r,i,a){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Z.default.localVideoEncMGR){e.next=2;break}return e.abrupt("return");case 2:if(Z.default.isVideoEncodeThreadStart){e.next=6;break}return Z.default.isVideoEncodeThreadStart=!0,e.next=6,ce(a,Z.default.localVideoEncMGR,qe,J.f.VIDEO_ENCODE,i);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Mt(e){return xt.apply(this,arguments)}function xt(){return(xt=d()(g.a.mark((function e(t){var r,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Z.default.isPreviewMode.audioDecode){e.next=3;break}return Q.default.add_monitor("ZISA"),e.abrupt("return");case 3:if(Z.default.localAudioDecMGR){e.next=6;break}return Y.default.warn("jsMediaEngineVariables.localAudioDecMGR is null when call Audio_Decode_Post_message"),e.abrupt("return");case 6:return r=Z.default.localAudioDecMGR.map.get(Z.default.SPECIAL_ID),Z.default.ADWF&&r.postMessage({command:"RIWM"}),e.next=10,Z.default.audioDecInitInstance.wasmSuccessPromise;case 10:if(Te(t)){e.next=12;break}return e.abrupt("return",!0);case 12:if(r&&!Z.default.isAudioDecodePostStart){if(Z.default.isAudioDecodePostStart=!0,i=ie({command:1,_id:t._id,websocket_ip_address:Z.default.Audio_WebSocket_Ip_Address?Z.default.Audio_WebSocket_Ip_Address+"&mode=5":void 0,sampleRate:Z.default.localAudioPara.sampleRate,userid:Z.default.localAudioPara.userid,logon:Z.default.localAudioPara.logon,decode:1,meetingid:Z.default.localAudioPara.meetingid,meetingnumb:Z.default.localAudioPara.meetingnumb,videodecodethreadnumb:Z.default.localAudioPara.videodecodethreadnumb,isSupportMultiThread:Z.default.localAudioPara.isSupportMultiThread,qoson:Z.default.localAudioPara.qoson,decoderInWorklet:Z.default.decoderinworklet,audioDecodeChannelsNum:q.default.isSupportPlayStereo()?2:1,shouldNotChangeSampleRate:q.default.browser.isFirefox||q.default.browser.isSafari},Z.default.Audio_Web_Transport_Ip_Address?{webtransportURL:Z.default.Audio_Web_Transport_Ip_Address+"&mode=1"}:{}),Q.default.add_monitor("ADSM"),r.postMessage(i),Z.default.sharedBuffer){ae("post audioDec sab");try{r.postMessage({command:"sharedBuffer",data:Z.default.sharedBuffer})}catch(e){r.postMessage({command:"sharedBuffer",data:Z.default.sharedBuffer},[Z.default.sharedBuffer])}}}else Q.default.add_monitor("ADSME"+!!r+!!Z.default.isAudioDecodePostStart);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pt(e,t,r,i){return Nt.apply(this,arguments)}function Nt(){return(Nt=d()(g.a.mark((function e(t,r,i,a){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Q.default.add_monitor("AADT"),!i||!i.isDestroy){e.next=4;break}return Q.default.add_monitor("ZID"),e.abrupt("return",ae("WorkerType:audioDec;The relative SDK instance is destroy, don't start relative worker, avoid multiple same workers. "));case 4:if(Z.default.isAudioDecodeThreadStart){e.next=8;break}return Z.default.isAudioDecodeThreadStart=!0,e.next=8,ce(a,Z.default.localAudioDecMGR,tt,J.f.AUDIO_DECODE,i);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Vt(e){if(e>>=10,Z.default.localAudioDecMGR){var t=Z.default.localAudioDecMGR.GetSSRCTimeMap(e);return null===t?0:t}}function Ut(e){return{currentSSRCTime:Z.default.CurrentSSRCTime,audioPlayTime:Z.default.audioPlayTime}}function Lt(e,t){var r=Z.default.SPECIAL_ID,i=Z.default.localVideoDecMGR.map.get(r);i.postMessage({command:"failover",websocket_ip_address:t}),(i=Z.default.localAudioDecMGR.map.get(r)).postMessage({command:"failover",websocket_ip_address:e})}function Wt(e){return Bt.apply(this,arguments)}function Bt(){return(Bt=d()(g.a.mark((function e(t){var r,i,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Z.default.localAudioEncMGR){e.next=3;break}return Y.default.error("jsMediaEngineVariables.localAudioEncMGR is null when call Audio_Encode_Post_message"),e.abrupt("return");case 3:return r=Z.default.localAudioEncMGR.map.get(Z.default.SPECIAL_ID),Z.default.AEWF&&r.postMessage({command:"RIWM"}),e.next=7,Z.default.audioEncodeInitInstance.wasmSuccessPromise;case 7:if(Te(t)){e.next=9;break}return e.abrupt("return",!1);case 9:if(r&&!Z.default.isAudioEncodePostStart&&(Z.default.isAudioEncodePostStart=!0,i=null,Z.default.ivObj&&(i=Z.default.ivObj[J.f.AUDIO_ENCODE],i=q.default.stringSplitByComma2Buffer(i)),a=ie({command:1,_id:t._id,websocket_ip_address:Z.default.Audio_WebSocket_Ip_Address?Z.default.Audio_WebSocket_Ip_Address+"&mode=2":void 0,sampleRate:Z.default.localAudioPara.sampleRate,userid:Z.default.localAudioPara.userid,encode:1,meetingid:Z.default.localAudioPara.meetingid,meetingnumb:Z.default.localAudioPara.meetingnumb,iv:i,qoson:Z.default.localAudioPara.qoson,shouldNotChangeSampleRate:q.default.browser.isFirefox||q.default.browser.isSafari,isPreviewMode:Z.default.isPreviewMode.audioEncode,audioEncodeChannelsNum:q.default.isBrowserSupportStereo()?2:1,audioDecodeChannelsNum:q.default.isSupportPlayStereo()?2:1},Z.default.Audio_Web_Transport_Ip_Address?{webtransportURL:Z.default.Audio_Web_Transport_Ip_Address+"&mode=2"}:{}),r.postMessage(a),Z.default.sharedBuffer)){ae("post audioEnc sab");try{r.postMessage({command:"sharedBuffer",data:Z.default.sharedBuffer})}catch(e){r.postMessage({command:"sharedBuffer",data:Z.default.sharedBuffer},[Z.default.sharedBuffer])}}case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gt(e,t,r){return Ft.apply(this,arguments)}function Ft(){return(Ft=d()(g.a.mark((function e(t,r,i){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Z.default.isAudioEncodeThreadStart){e.next=4;break}return Z.default.isAudioEncodeThreadStart=!0,e.next=4,ce(i,Z.default.localAudioEncMGR,rt,J.f.AUDIO_ENCODE,r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ht(e){for(var t,r=Z.default.SPECIAL_ID,i=Z.default.audio_pcm_queue.dequeue();i;)i=Z.default.audio_pcm_queue.dequeue();Z.default.localAudioEncMGR&&(t=Z.default.localAudioEncMGR.map.get(r))&&Z.default.isAudioEncodePostStart&&t.postMessage({command:"modifySampleRate",sampleRate:e}),Z.default.localAudioDecMGR&&(t=Z.default.localAudioDecMGR.map.get(r))&&Z.default.isAudioDecodePostStart&&t.postMessage({command:"modifySampleRate",sampleRate:e})}function jt(e,t,r){var i;(e=Z.default.SPECIAL_ID,Z.default.localAudioDecMGR)&&((i=Z.default.localAudioDecMGR.map.get(e))&&i.postMessage({command:"mute",bOn:t,fakeLeave:r}));Z.default.localAudioEncMGR&&((i=Z.default.localAudioEncMGR.map.get(e))&&i.postMessage({command:"mute",bOn:t,fakeLeave:r}))}function Kt(e,t){var r;(e=Z.default.SPECIAL_ID,Z.default.localAudioDecMGR)&&((r=Z.default.localAudioDecMGR.map.get(e))&&r.postMessage({command:"AecFlag",flag:t}));Z.default.localAudioEncMGR&&((r=Z.default.localAudioEncMGR.map.get(e))&&r.postMessage({command:"AecFlag",flag:t}))}function qt(e,t,r,i){var a,n=Z.default.SPECIAL_ID;Z.default.localAudioDecMGR&&((a=Z.default.localAudioDecMGR.map.get(n))&&a.postMessage({command:r},[e.port2]));Z.default.localAudioEncMGR&&((a=Z.default.localAudioEncMGR.map.get(n))&&a.postMessage({command:i},[t.port1]))}function Xt(e,t){var r=Z.default.SPECIAL_ID;if(Z.default.localVideoDecMGR){var i=Z.default.localVideoDecMGR.map.get(r);i&&i.postMessage({command:"decodeVideoPort"},[e.port1])}if(Z.default.localVideoEncMGR){var a=Z.default.localVideoEncMGR.map.get(r);a&&a.postMessage({command:"encodeVideoPort"},[t.port2])}}function Yt(e,t){var r=Z.default.SPECIAL_ID;if(Z.default.localVideoDecMGR){var i=Z.default.localVideoDecMGR.map.get(r);i&&i.postMessage({command:"vsport"},[e.port1])}if(Z.default.localSharingDecMGR){var a=Z.default.localSharingDecMGR.map.get(r);a&&a.postMessage({command:"vsport"},[t.port2])}}function zt(e){var t=Z.default.SPECIAL_ID;if(Z.default.localAudioDecMGR){var r=Z.default.localAudioDecMGR.map.get(t);r&&r.postMessage({command:"decodeAudioPort2"},[e.port2])}}function Qt(e){var t=Z.default.SPECIAL_ID;if(Z.default.localAudioEncMGR){var r=Z.default.localAudioEncMGR.map.get(t);r&&r.postMessage({command:"shareAudioDecodeAudioPort2"},[e.port2])}}function Jt(e){var t=Z.default.SPECIAL_ID;if(Z.default.localVideoDecMGR){var r=Z.default.localVideoDecMGR.map.get(t);r&&r.postMessage({command:"decodeVideoPortWithAudio",port:e.port1},[e.port1])}}function Zt(e){var t=Z.default.SPECIAL_ID;if(Z.default.localVideoEncMGR){var r=Z.default.localVideoEncMGR.map.get(t);r&&r.postMessage(e)}}function $t(e,t){er({command:e,data:t},[t])}function er(e,t){var r=Z.default.SPECIAL_ID;if(!Z.default.localVideoEncMGR)return!1;var i=Z.default.localVideoEncMGR.map.get(r);return!!i&&(i.postMessage(e,t),!0)}function tr(e){var t=Z.default.SPECIAL_ID;if(Z.default.localVideoDecMGR){var r=Z.default.localVideoDecMGR.map.get(t);r&&r.postMessage(e)}}function rr(e,t){var r=Z.default.SPECIAL_ID;if(Z.default.localVideoEncMGR){var i=Z.default.localVideoEncMGR.map.get(r);i&&i.postMessage({command:e,data:t},[t])}}function ir(e,t){var r=Z.default.SPECIAL_ID;if(Z.default.localSharingEncMGR){var i=Z.default.localSharingEncMGR.map.get(r);i&&i.postMessage({command:e,data:t},[t])}}function ar(e){if(Z.default.localVideoDecMGR){var t=Z.default.localVideoDecMGR.map.get(Z.default.SPECIAL_ID);t&&t.postMessage(e)}}function nr(e){var t=Z.default.SPECIAL_ID;if(Z.default.localSharingDecMGR){var r=Z.default.localSharingDecMGR.map.get(t);r&&r.postMessage(e)}}function or(e){var t=Z.default.SPECIAL_ID;if(Z.default.localAudioDecMGR){var r=Z.default.localAudioDecMGR.map.get(t);r&&r.postMessage({command:"updateCurrentSSRC",SSRC:e})}}function sr(e){var t=Z.default.SPECIAL_ID;if(Z.default.localAudioEncMGR){var r=Z.default.localAudioEncMGR.map.get(t);r&&r.postMessage(e)}}function ur(e){var t=Z.default.SPECIAL_ID;if(Z.default.localAudioDecMGR){var r=Z.default.localAudioDecMGR.map.get(t);r&&r.postMessage(e)}}function dr(e){var t={command:"interpretation_enable",enable:e};sr(t),Z.default.decoderinworklet?Z.default.workletWasmInitSuccess&&Z.default.AudioNode?Z.default.AudioNode.postCMD("interpretation_enable",t):Z.default.interpretationMessage.enqueue(t):ur(t)}function cr(e){sr({command:"cc_set_lang",lang:e})}function lr(e){var t={command:"interpretation_set_lang",lang:e};sr(t),Z.default.decoderinworklet?Z.default.workletWasmInitSuccess&&Z.default.AudioNode?Z.default.AudioNode.postCMD("interpretation_set_lang",t):Z.default.interpretationMessage.enqueue(t):ur(t)}function hr(e){var t={command:"interpretation_mute_origin",mute:e};sr(t),Z.default.decoderinworklet?Z.default.workletWasmInitSuccess&&Z.default.AudioNode?Z.default.AudioNode.postCMD("interpretation_mute_origin",t):Z.default.interpretationMessage.enqueue(t):ur(t)}function fr(e){var t={command:"interpretation_set_interpreter",interpreterList:e};sr(t),Z.default.decoderinworklet?Z.default.workletWasmInitSuccess&&Z.default.AudioNode?Z.default.AudioNode.postCMD("interpretation_set_interpreter",t):Z.default.interpretationMessage.enqueue(t):ur(t)}function pr(){var e=Z.default.SPECIAL_ID;if(Z.default.localAudioEncMGR){var t=Z.default.localAudioEncMGR.map.get(e);t&&t.postMessage({command:"resetAec"})}}function vr(){var e=Z.default.SPECIAL_ID,t=20;if(Z.default.audioDelay&&(t=Z.default.audioDelay),Z.default.localAudioEncMGR){var r=Z.default.localAudioEncMGR.map.get(e);r&&r.postMessage({command:"SetAECDelay",delay:t})}}function mr(e){try{if(Q.default&&e){var t=["ERR:",e.message,"f"].join(""),r=Q.default.checkIsNecessaryExceptionLogAndReturnRepeatTimes(t);r.isNecessary?(ae("error repeat ".concat(r.repeatNumber),t),Q.default.add_monitor(t+"(repeat:".concat(r.repeatNumber,")"))):ae("error but ignore",e.message)}}catch(e){ae("_listenWindowErrorEvent error",e)}}function gr(){try{var e,t,r,i,a,n;Q.default.add_monitor(["BSAGT:",navigator.userAgent].join("")),Q.default.add_monitor("BSLITEND:"+(q.default.isLittleEndian()?1:0)),window.navigator.hardwareConcurrency&&Q.default.add_monitor("OSCPUS:"+window.navigator.hardwareConcurrency);var o=ee()(navigator.userAgent),s=null==o||null===(e=o.os)||void 0===e?void 0:e.name;null!==(t=s)&&void 0!==t&&t.toLowerCase().includes("mac")&&(null===(r=navigator)||void 0===r?void 0:r.maxTouchPoints)>2&&(s="ipad"),Q.default.add_monitor("os_name:".concat(s,"|os_version:").concat(null==o||null===(i=o.os)||void 0===i?void 0:i.version)),Q.default.add_monitor("browser_name:".concat(null==o||null===(a=o.browser)||void 0===a?void 0:a.name,"|browser_version:").concat(null==o||null===(n=o.browser)||void 0===n?void 0:n.version))}catch(e){}}function _r(e){Z.default.sendMessageToRwg(M.MONITOR_LOG,{evt:M.RWG_MONITOR_LOG_EVENT,seq:1,body:{data:e}})}function Sr(e){Q.default.init(),window.addEventListener("error",mr),Z.default.monitorIntervalHandle=setInterval((function(){var e=Q.default.get_monitor();(e&&_r(e),null!=Z.default.monitorEncodeVideo||null!=Z.default.monitorDecodeVideo||null!=Z.default.monitorVideoCapture||null!=Z.default.monitorEncodeSharing||null!=Z.default.monitorDecodeSharing||null!=Z.default.monitorSharingEncodeAPPInfo||null!=Z.default.monitorVideoDecodeAPPInfo||null!=Z.default.monitorVideoEncodeAPPInfo)&&(null!=Z.default.monitorSharingEncodeAPPInfo&&(_r(Z.default.monitorSharingEncodeAPPInfo.data),Z.default.monitorSharingEncodeAPPInfo=null),null!=Z.default.monitorVideoDecodeAPPInfo&&(_r(Z.default.monitorVideoDecodeAPPInfo.data),Z.default.monitorVideoDecodeAPPInfo=null),null!=Z.default.monitorVideoEncodeAPPInfo&&(_r(Z.default.monitorVideoEncodeAPPInfo.data),Z.default.monitorVideoEncodeAPPInfo=null))}),1e4)}function Er(e){Q.default.add_monitor2(e)}function br(e){window.removeEventListener("error",mr),clearInterval(Z.default.monitorIntervalHandle),Q.default.send_instant_monitor()}function yr(e){var t=Z.default.SPECIAL_ID;if(Z.default.localVideoEncMGR){var r=Z.default.localVideoEncMGR.map.get(t);r&&r.postMessage({command:"ENCRYPT",encrypt:e})}}function Cr(e){var t=Z.default.SPECIAL_ID;if(Z.default.localSharingEncMGR){var r=Z.default.localSharingEncMGR.Get(t);r&&r.postMessage({command:"ENCRYPT",encrypt:e})}}function Ar(e){if(Z.default.localVideoEncMGR){var t=Z.default.localVideoEncMGR.map.get(Z.default.SPECIAL_ID);t&&t.postMessage(e)}}function Rr(e){if(Z.default.localSharingEncMGR){var t=Z.default.localSharingEncMGR.map.get(Z.default.SPECIAL_ID);t&&t.postMessage(e)}}function Ir(e){if(Z.default.localVideoEncMGR){var t=Z.default.localVideoEncMGR.map.get(Z.default.SPECIAL_ID);t&&t.postMessage(e)}}function wr(e){if(Z.default.localSharingEncMGR){var t=Z.default.localSharingEncMGR.map.get(Z.default.SPECIAL_ID);t&&t.postMessage(e)}}function Tr(e){var t=Z.default.SPECIAL_ID;if(Z.default.localAudioEncMGR){var r=Z.default.localAudioEncMGR.map.get(t);r&&r.postMessage({command:"ENCRYPT",encrypt:e})}}function kr(){var e=Z.default.SPECIAL_ID;[Z.default.localAudioDecMGR,Z.default.localAudioEncMGR,Z.default.localVideoDecMGR,Z.default.localVideoEncMGR,Z.default.localSharingDecMGR,Z.default.localSharingEncMGR].forEach((function(t){t&&t.map.get(e)&&t.map.get(e).postMessage({command:"SOCKET_RECONNECT",disable:!0})}))}function Dr(e){e.forEach((function(e){e&&(e.setHanderSuccess(!1),e.setSocketSuccess(!1),e.setWasmSuccess(!1))}))}function Or(e,t){var r=Z.default.SPECIAL_ID;e&&e.forEach((function(e){e&&e.map.get(r)&&(e.map.get(r).onmessage=null)})),t&&t.forEach((function(e){e&&e.map.get(r)&&(e.map.get(r).onmessage=null)}))}function Mr(e,t,r){return xr.apply(this,arguments)}function xr(){return(xr=d()(g.a.mark((function e(t,r,i){var a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Z.default.SPECIAL_ID,r.forEach((function(e){e&&e.map.get(a)&&e.map.get(a).postMessage({command:2,_id:t._id})})),i.forEach((function(e){e&&e.map.get(a)&&e.map.get(a).postMessage({command:2,_id:t._id})})),e.next=7,q.default.sleep(1e3);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pr(e,t){return Nr.apply(this,arguments)}function Nr(){return(Nr=d()(g.a.mark((function e(t,r){var i,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Z.default.SPECIAL_ID,(a=t).forEach((function(e){e&&e.map.get(i)&&e.map.get(i).terminate()})),a=r,e.next=6,q.default.is32bitChrome();case 6:if(e.sent){e.next=8;break}a.forEach((function(e){e&&e.map.get(i)&&e.map.get(i).terminate()}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Vr(e){var t;switch(e){case J.f.AUDIO_DECODE:t=Z.default.localAudioDecMGR;break;case J.f.AUDIO_ENCODE:t=Z.default.localAudioEncMGR;break;case J.f.VIDEO_DECODE:t=Z.default.localVideoDecMGR;break;case J.f.VIDEO_ENCODE:t=Z.default.localVideoEncMGR;break;case J.f.SHARING_DECODE:t=Z.default.localSharingDecMGR;break;case J.f.SHARING_ENCODE:t=Z.default.localSharingEncMGR}var r=Z.default.SPECIAL_ID;return t&&t.map.get(r)?t.map.get(r):null}function Ur(e){return Lr.apply(this,arguments)}function Lr(){return(Lr=d()(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===J.f.VIDEO_ENCODE?3:e.t0===J.f.VIDEO_DECODE?6:e.t0===J.f.AUDIO_ENCODE?9:e.t0===J.f.AUDIO_DECODE?12:e.t0===J.f.SHARING_ENCODE?15:e.t0===J.f.SHARING_DECODE?18:21;break;case 3:return e.next=5,Z.default.videoInitInstance.initSuccessPromise;case 5:return e.abrupt("break",23);case 6:return e.next=8,Z.default.videoDecInitInstance.initSuccessPromise;case 8:return e.abrupt("break",23);case 9:return e.next=11,Z.default.audioEncodeInitInstance.initSuccessPromise;case 11:return e.abrupt("break",23);case 12:return e.next=14,Z.default.audioDecInitInstance.initSuccessPromise;case 14:return e.abrupt("break",23);case 15:return e.next=17,Z.default.sharingEncInitInstance.initSuccessPromise;case 17:return e.abrupt("break",23);case 18:return e.next=20,Z.default.sharingDecInitInstance.initSuccessPromise;case 20:return e.abrupt("break",23);case 21:return Y.default.error("No matched worker type: ".concat(t)),e.abrupt("break",23);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wr(e,t){return Br.apply(this,arguments)}function Br(){return(Br=d()(g.a.mark((function e(t,r){var i,a,n,o,s=arguments;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=s.length>2&&void 0!==s[2]?s[2]:7,a=s.length>3&&void 0!==s[3]&&s[3],!(n=s.length>4&&void 0!==s[4]&&s[4])){e.next=6;break}return e.next=6,Ur(t);case 6:if(o=Vr(t)){e.next=17;break}if(n){e.next=13;break}return ae("worker handle not ready, drop!",t,r,i),e.abrupt("return",!1);case 13:if(ae.warn("worker handle not ready, waiting!",t,r,i),o=Vr(t)){e.next=17;break}return e.abrupt("return");case 17:return a?o.postMessage({command:i,data:r},[r]):o.postMessage({command:i,data:r}),e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gr(){return null!==Vr(J.f.VIDEO_ENCODE)}function Fr(e,t,r){var i=Z.default.SPECIAL_ID;if(Z.default.localVideoEncMGR){var a=Z.default.localVideoEncMGR.map.get(i);a&&(e?a.postMessage({command:t,canvas:e,rendercanvasID:r},[e]):a.postMessage({command:t,canvas:e,rendercanvasID:r}))}}function Hr(e){var t;return t=new e({storeOptions:{nameSpaceId:"vbFile"}}),new Promise((function(e,r){t.on("ready",(function(){e(t)}))}))}function jr(e,t,r){return window.crypto.subtle.decrypt({name:"AES-GCM",iv:r},t,e)}function Kr(e,t){var r={};(Z.default.resourceManager?Promise.resolve(Z.default.resourceManager):Hr(t)).then((function(t){Z.default.resourceManager=t;for(var i,a,n=function(t){"bin"==e[t].type?Z.default.resourceManager.getFile(e[t].path+"610",{saveRootPath:e[t].path+"610",downloadOptions:{xhrParams:{headers:r,url:e[t].path,encoding:"arraybuffer",method:"GET"}}}).getResult().then((function(r){Q.default.add_monitor("VDBIN"),Z.default.vbarraybuffer=r.data;try{e[t].path.indexOf("dual")>=0&&(i=r.data,a=new Uint8Array(i,0,12),n=new Uint8Array(i,12,32),window.crypto.subtle.importKey("raw",n,"AES-GCM",!0,["encrypt","decrypt"]).then((function(e){var t=a.length+n.length,r=new Uint32Array(i.slice(t,t+4))[0];t+=4;var o=i.slice(t,t+r);t+=r,r=new Uint32Array(i.slice(t,t+4))[0],t+=4;var s=new Uint8Array(i,t,r);t+=r,r=new Uint32Array(i.slice(t,t+4))[0],t+=4;var u=i.slice(t,t+r);t+=r,r=new Uint32Array(i.slice(t,t+4))[0],t+=4;var d=new Uint8Array(i,t,r);Z.default.basebin=o,Z.default.afnbin=u,jr(d,e,a).then((function(e){Z.default.afnjson=(new TextDecoder).decode(e);var t=Z.default.SPECIAL_ID;if(Z.default.localVideoEncMGR){var r=Z.default.localVideoEncMGR.map.get(t);r&&Z.default.afnbin&&Z.default.afnjson&&r.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:Z.default.afnbin,json:Z.default.afnjson},index:1})}})),jr(s,e,a).then((function(e){Z.default.basejson=(new TextDecoder).decode(e);var t=Z.default.SPECIAL_ID;if(Z.default.localVideoEncMGR){var r=Z.default.localVideoEncMGR.map.get(t);r&&Z.default.basebin&&Z.default.basejson&&r.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:Z.default.basebin,json:Z.default.basejson},index:2})}}))})))}catch(e){Y.default.error("An error occurred when decrypting the virtual background file",e),Q.default.add_monitor("VBDECRYPTF"),Z.default.Notify_APPUI(M.VIDEO_VB_SETTING_PARA_ERROR,ne.FAIL)}var i,a,n})).catch((function(e){Y.default.error("An error occurred when trying to obtain the virtual background file",e),Q.default.add_monitor("VBFF"),Z.default.Notify_APPUI(M.VIDEO_VB_SETTING_PARA_ERROR,ne.FAIL)})):"js"==e[t].type&&(Q.default.add_monitor("VDTF"),Z.default.tfjsurl=e[t].path,i=Z.default.SPECIAL_ID,Z.default.localVideoEncMGR&&(a=Z.default.localVideoEncMGR.map.get(i))&&a.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:Z.default.tfjsurl,type:"js"}))},o=0;o<e.length;o++)n(o)}))}function qr(e){var t=Z.default.SPECIAL_ID;if(Z.default.localVideoEncMGR){var r=Z.default.localVideoEncMGR.map.get(t);r&&(e?r.postMessage({command:"imagebitmap",data:e},[e]):r.postMessage({command:"imagebitmap"}))}}function Xr(e,t){var r=Z.default.SPECIAL_ID;if(Z.default.localVideoEncMGR){var i=Z.default.localVideoEncMGR.map.get(r);i&&(e?i.postMessage({command:"maskandbgimagebitmap",imagename:t,data:e},[e]):i.postMessage({command:"maskandbgimagebitmap",imagename:t,data:e}))}}function Yr(e,t){var r=Z.default.SPECIAL_ID;if(Z.default.localVideoEncMGR){var i=Z.default.localVideoEncMGR.map.get(r);i&&(e?i.postMessage({command:"vbbgimagebitmap",imagename:t,data:e},[e]):i.postMessage({command:"vbbgimagebitmap",imagename:t,data:e}))}}function zr(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=Z.default.SPECIAL_ID;if(Z.default.localVideoEncMGR){var o=Z.default.localVideoEncMGR.map.get(n);o&&(e?o.postMessage({command:"maskandbgimagebitmap",imagename:t,data:e,maskCoordinate:r,width:i,height:a},[e]):o.postMessage({command:"maskandbgimagebitmap",imagename:t,data:e,maskCoordinate:r,width:i,height:a}))}}function Qr(e){var t=Z.default.SPECIAL_ID;if(Z.default.localVideoDecMGR){var r=Z.default.localVideoDecMGR.map.get(t);r&&r.postMessage(e)}}function Jr(){try{return q.default.browser.isChrome&&-1!==["85","86"].indexOf(q.default.getBrowserVersion())}catch(e){return ae(e),!1}}var Zr=(K={},v()(K,J.f.VIDEO_ENCODE,{success:M.INIT_SUCCESS_VIDEO,failed:M.INIT_FAILED_VIDEO,callbackDataValue:J.c.encode}),v()(K,J.f.VIDEO_DECODE,{success:M.INIT_SUCCESS_VIDEO,failed:M.INIT_FAILED_VIDEO,callbackDataValue:J.c.decode}),v()(K,J.f.AUDIO_ENCODE,{success:M.INIT_SUCCESS_AUDIO,failed:M.INIT_FAILED_AUDIO,callbackDataValue:J.c.encode}),v()(K,J.f.AUDIO_DECODE,{success:M.INIT_SUCCESS_AUDIO,failed:M.INIT_FAILED_AUDIO,callbackDataValue:J.c.decode}),v()(K,J.f.SHARING_DECODE,{success:M.INIT_SUCCESS_SHARING,failed:M.INIT_FAILED_SHARING,callbackDataValue:J.c.decode}),v()(K,J.f.SHARING_ENCODE,{success:M.INIT_SUCCESS_SHARING,failed:M.INIT_FAILED_SHARING,callbackDataValue:J.c.encode}),K);function $r(e,t){var r=[J.f.AUDIO_ENCODE,J.f.AUDIO_DECODE,J.f.VIDEO_ENCODE,J.f.VIDEO_DECODE];e.isSupportVideoShare||r.push(J.f.SHARING_ENCODE,J.f.SHARING_DECODE),r.forEach(function(){var e=d()(g.a.mark((function e(r){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Wr(r,t,130,!1,!0);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}function ei(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=R()(e);if(t){var a=R()(this).constructor;r=Reflect.construct(i,arguments,a)}else r=i.apply(this,arguments);return C()(this,r)}}var ti=null;"function"==typeof AudioWorklet&&(ti=function(e){b()(r,e);var t=ei(r);function r(e,i,a){var n;return l()(this,r),(n=t.call(this,e,i,a)).port.onmessage=n.handleMessage.bind(S()(n)),n}return f()(r,[{key:"handleMessage",value:function(e){var t=e.data;switch(t.status){case"delay":if(Z.default.localAudioDecMGR)(r=Z.default.localAudioDecMGR.map.get(0))&&r.postMessage({command:"delay"});break;case M.CURRENT_SSRC_TIME:t.at&&(Z.default.CurrentSSRCTime=t.at,Z.default.audioPlayTime=Date.now()),t.st&&Z.default.mediaSDKHandle.SharingRenderObj&&Z.default.mediaSDKHandle.SharingRenderObj.SetcATimeStamp(t.st);break;case M.AUDIO_MONITOR_LOG:et.push({log:t.data,logSource:x.f});break;case"MONITOR_LOG":Q.default.add_monitor(t.data);break;case"UPDATE_MULTIVIEW_TIME":var r;if(Z.default.localVideoDecMGR)(r=Z.default.localVideoDecMGR.map.get(0))&&r.postMessage({command:"audioDecodeTime",data:t.data,status:1});break;case"WASM_INIT_SUCCESS":for(Q.default.add_monitor("DIWL"+t.data.audio_handle),Z.default.workletWasmInitSuccess=!0;!Z.default.interpretationMessage.isEmpty();){var i=Z.default.interpretationMessage.dequeue();this.postCMD(i.command,i)}break;case"workletMessage":"error"===t.data.level&&Y.default.error(t.data.message,t.data.data)}}},{key:"postData",value:function(e,t){this.port.postMessage({status:e,data:t},[t.data.buffer])}},{key:"postCMD",value:function(e,t){this.port.postMessage({status:e,data:t})}}]),r}(w()(AudioWorkletNode)));var ri=ti;function ii(e){this.name="CameraOccupiedError",this.message=e,this.stack=(new Error).stack}ii.prototype=new Error;var ai=r(33),ni=r.n(ai),oi=r(53),si=r(55),ui=r.n(si),di=r(28),ci=r.n(di),li=r(34),hi=r.n(li);function fi(e){return e[0]<<24|e[1]<<16|e[2]<<8|e[3]}var pi={IsQosReport:function(e){return 21==e[4]&&0==e[13]},GetQOSSeq:function(e){!function(e){e[0],e[1]}(e.slice(17,19))},GetQOSTime:function(e){return 104==e[0]||16!=e[4]&&1!=e[5]?fi(e.slice(19,23)):fi(e.slice(15,19))},IsVideoPkg:function(e){return 103==e[0]}},vi=function(){function e(t){l()(this,e);var r=t||{};this.last_report_time=0,this.timeout_count=0,this.interval_report_time=r.interval||3e3,this.tag=r.tag||"monitor",this.max_timeout=0,this.min_timeout=2147483647,this.reportcallback=r.reportcallback,this._timeoutid=0}return f()(e,[{key:"_report",value:function(){this.reportcallback&&this.reportcallback(this.tag,Math.ceil(this.max_timeout),Math.ceil(this.min_timeout),this.timeout_count),this.timeout_count=0,this.max_timeout=0,this.min_timeout=2147483647}},{key:"timeoutReport",value:function(e,t){if(this.timeout_count++,e>this.max_timeout&&(this.max_timeout=e),e<this.min_timeout&&(this.min_timeout=e),!this._timeoutid){var r=this;this._timeoutid=setTimeout((function(){r._report(),r._timeoutid=0}),this.interval_report_time)}}}]),e}();function mi(e){var t=e||{};this._samples=[],this._interval_id=0,this._lasted_update_time=0,this._lasted_group_time=0,this._enable=!1,this._interval_time=t.interval||3e4,this._customer_callback=t.report_call,this._tag=t.tag||"netreport",this._group_interval=t.group_interval||1e3,this._enable_advanced=t.advanced||!1,this._current_count=0,this._qos_report=new vi({tag:"jitter",interval:3e4,reportcallback:this._qos_report_timeout.bind(this)}),this._qos_report_samples=[],this._cureen_qos_report=0}mi.prototype._qos_report_timeout=function(e,t,r,i){if(this._customer_callback){var a="".concat(e,",").concat(t,",").concat(r,",").concat(i);this._customer_callback(this._tag+"TimeOut",a)}},mi.prototype._report=function(){var e=(new Date).getTime(),t="".concat(e,"-").concat(this._samples.length,"-").concat(this._samples),r="".concat(e,"-").concat(this._qos_report_samples.length,"-").concat(this._qos_report_samples);t=t.replaceAll(",","|"),r=r.replaceAll(",","|"),this._customer_callback?(this._customer_callback(this._tag,t),this._enable_advanced&&this._customer_callback(this._tag+"QOS",r)):console.error("tag:".concat(this._tag,",").concat(t))},mi.prototype._group=function(){var e=performance.now();if(e>=this._lasted_group_time+1700)for(var t=Math.round((e-this._lasted_group_time)/1e3)-1,r=0;r<t;r++)this._samples.push(-1);this._lasted_group_time=e,this._samples.push(this._current_count),this._qos_report_samples.push(this._cureen_qos_report),this._cureen_qos_report=0,this._current_count=0,e>=this._lasted_update_time+this._interval_time&&(this._lasted_update_time=e,this._report(),this._samples=[],this._qos_report_samples=[])},mi.prototype.start=function(){this._enable||(this._lasted_update_time=performance.now(),this._lasted_group_time=this._lasted_update_time,this._samples=[],this._current_count=0,this._qos_report_samples=[],this._cureen_qos_report=0,this._interval_id=setInterval(this._group.bind(this),this._group_interval),this._enable=!0)},mi.prototype.stop=function(){this._enable&&(clearInterval(this._interval_id),this._interval_id=0,this._enable=!1)},mi.prototype.sample=function(e){if(this._enable&&(this._current_count++,this._enable_advanced)){if(pi.IsQosReport(e))return void this._cureen_qos_report++;if(pi.IsVideoPkg(e)){var t=pi.GetQOSTime(e),r=performance.now();if(this._lasted_qos_ts){var i=r-this._lasted_sys_ts-(t-this._lasted_qos_ts);i>30&&this._qos_report.timeoutReport(i,r)}this._lasted_qos_ts=t,this._lasted_sys_ts=r,this._lasted_data=e}}};var gi=Object(X.a)("sdk.rtcUtil"),_i=function(){function e(){var t=this;l()(this,e),this.rtcPeerConnection=null,this.dataChannel=null,this.dataChannelLabel=null,this.messageListener=null,this.datachannelcloselistener=null,this.datachannelopenlistener=null,this.rtcPeerConnectionCreatedListener=null,this.reconnectCount=0,this.reconnectMax=10,this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen=0,this.connectionID=null,this.pubSubTokenList=[],this.isForceClosed=!1,this.reconnectRTCPeerConnectionThrottle=hi()((function(){t.reconnectRTCPeerConnection()}),2e3),this.timeoutThenCloseInterval=null,this.userid=null,this.connectionType=null,this.dataChannelStatus="",this.delaycloseTimeout=0,this.delaycloseid_=0,this._send_statistic=null,this._recv_statistic=null}var t;return f()(e,[{key:"setUserid",value:function(e){this.userid=e}},{key:"setConnectionType",value:function(e){this.connectionType=e}},{key:"isSupportDataChannel",value:function(){return!!window.RTCDataChannel}},{key:"iceClosed",value:function(e){this.isForceClosed||(gi("rtcPeerConnection.iceClosed",e),this._close(!0),this._clear())}},{key:"initConnection",value:(t=d()(g.a.mark((function e(t){var r,i,a,n=this,o=arguments;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]?o[1]:"ZoomWebclientVideoDataChannel",Q.default.add_monitor("DCCONN"),this.isSupportDataChannel()){e.next=5;break}return Q.default.add_monitor("DCUNSUPPORT"),e.abrupt("return");case 5:return i="ZoomWebclientVideoDataChannel"==r?1:0,a=function(e,t){Q.default.add_monitor("".concat(e,":").concat(t))},this._send_statistic||(this._send_statistic=new mi({tag:i?"VDCS":"ADCS",report_call:a})),this._recv_statistic||(this._recv_statistic=new mi({tag:i?"VDCR":"ADCR",report_call:a})),this.dataChannelLabel=r,this.connectionID=t,this.rtcPeerConnection=new RTCPeerConnection({iceCandidatePoolSize:1}),this.rtcPeerConnection.addEventListener("iceconnectionstatechange",(function(e){if(!n.isForceClosed){var t=n.rtcPeerConnection;if("failed"!==t.iceConnectionState&&"closed"!==t.iceConnectionState||(gi("".concat(n.dataChannelLabel," iceconnectionstatechange"),t.iceConnectionState),Q.default.add_monitor("ICECONNSTATECHANGE:"+n.dataChannelLabel),n.iceClosed(),n.delaycloseid_&&(clearTimeout(n.delaycloseid_),n.delaycloseid_=0)),"disconnected"===t.iceConnectionState&&!n.delaycloseid_){var r=n;n.delaycloseid_=setTimeout((function(){r.delaycloseid_=0,r.iceClosed()}),r.delaycloseTimeout)}"connected"===t.iceConnectionState&&n.delaycloseid_&&(clearTimeout(n.delaycloseid_),n.delaycloseid_=0)}})),this._createDataChannel(),e.next=16,this.rtcPeerConnection.createOffer().then(function(){var e=d()(g.a.mark((function e(r){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return gi("original offer",JSON.stringify(r)),r.sdp=r.sdp.replace(/a=ice-ufrag:.+/g,"a=ice-ufrag:".concat(t)),gi("modified offer",r),e.abrupt("return",n.rtcPeerConnection.setLocalDescription(r));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(){n.rtcPeerConnectionCreatedListener.call(null,n.rtcPeerConnection)}));case 16:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_close",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Q.default.add_monitor("RTCPeerConnUtil.CLOSE"),this._recv_statistic&&this._recv_statistic.stop(),this._send_statistic&&this._send_statistic.stop();try{this._closeDataChannel(),this.rtcPeerConnection&&this.rtcPeerConnection.close()}catch(e){Y.default.error("Error when closing RTCPeerConnection",e)}finally{this.dataChannel=null,this.rtcPeerConnection=null,e&&this.datachannelcloselistener&&this.datachannelcloselistener(null),this.sendDataChannelStatusMonitorLog(),this.reconnectRTCPeerConnectionThrottle()}}},{key:"forceClose",value:function(){Q.default.add_monitor("DCFORCECLOSE:"+this.dataChannelLabel),gi("forceClose : "+this.dataChannelLabel),this.isForceClosed=!0,this._close(!0),this._clear()}},{key:"isDestroyed",value:function(){return this.isForceClosed}},{key:"_clear",value:function(){this.timeoutThenCloseInterval&&clearInterval(this.timeoutThenCloseInterval),this.timeoutThenCloseInterval=0,this.messageListener=null,this.datachannelcloselistener=null,this.datachannelopenlistener=null,this.pubSubTokenList.forEach((function(e){z.a.unsubscribe(e)})),this.pubSubTokenList=[]}},{key:"onConnectionCreated",value:function(e){this.rtcPeerConnectionCreatedListener=e}},{key:"reconnectRTCPeerConnection",value:function(){var e=this;this.isForceClosed||this.reconnectCount<this.reconnectMax&&this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen<this.reconnectMax&&(gi("".concat(this.dataChannelLabel," reconnect reconnectTotalCount  : ").concat(this.reconnectCount,"; reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen : ").concat(this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen,", reconnectMax : ").concat(this.reconnectMax)),this.reconnectCount+=1,this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen+=1,setTimeout((function(){e.initConnection(e.connectionID,e.dataChannelLabel)}),1e3*Math.pow(2,this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen)))}},{key:"oneSingleLineLog",value:function(e){setTimeout((function(){Q.default.send_instant_monitor(),Q.default.add_monitor(e),Q.default.send_instant_monitor()}),0)}},{key:"checkEmptyUserIdAndResendMonitor",value:function(e){e&&this.userid!=e&&(this.setUserid(e),this.sendDataChannelStatusMonitorLog())}},{key:"sendDataChannelStatusMonitorLog",value:function(){this.userid&&("OPEN"===this.dataChannelStatus?(Q.default.add_monitor("DCOPEN:"+this.dataChannelLabel),this.oneSingleLineLog("".concat("{[WLCCONT]}",",").concat(this.userid,",").concat(this.connectionType,",DCOPEN,").concat("{[WLCCONT]}"))):"CLOSED"===this.dataChannelStatus&&(Q.default.add_monitor("DCCLOSE:"+this.dataChannelLabel),this.oneSingleLineLog("".concat("{[WLCCONT]}",",").concat(this.userid,",").concat(this.connectionType,",DCCLOSE,").concat("{[WLCCONT]}"))))}},{key:"_closeDataChannel",value:function(){if(this.dataChannel)try{this.dataChannelStatus="CLOSED",this.datachannelclosehander&&this.dataChannel.removeEventListener("close",this.datachannelclosehander),this.dataChannel.close()}catch(e){Y.default.error("Error when trying to close existing RTCDataChannel",e)}finally{this.datachannelclosehander=null,this.dataChannel=null}}},{key:"_createDataChannel",value:function(){var e=this;this._closeDataChannel();var t=this.rtcPeerConnection.createDataChannel(this.dataChannelLabel,{ordered:!1,maxRetransmits:0,reliable:!1});t.binaryType="arraybuffer",t.addEventListener("open",(function(t){e.datachannelopenlistener&&e.datachannelopenlistener(t),e._send_statistic.start(),e._recv_statistic.start(),e.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen=0,clearInterval(e.timeoutThenCloseInterval),e.dataChannelStatus="OPEN",e.sendDataChannelStatusMonitorLog(),gi("dataChannel.onopen",t)})),this.datachannelclosehander=this._ondatachannelclosed.bind(this),t.addEventListener("close",this.datachannelclosehander),t.addEventListener("error",(function(t){var r=t.error||{};Y.default.warn("WebRTC DataChannel ".concat(e.dataChannelLabel," received error with errorDetail: ").concat(r.errorDetail),r),clearInterval(e.timeoutThenCloseInterval),Q.default.add_monitor("DCERROR","".concat(e.dataChannelLabel,": ").concat(r.message,", error detail: ").concat(r.errorDetail)),gi("dataChannel.onerror",t)})),t.addEventListener("message",(function(t){e._recv_statistic.sample(!1),e.messageListener&&e.messageListener.call(null,t.data)})),this.dataChannel=t}},{key:"_ondatachannelclosed",value:function(e){"CLOSED"!=this.dataChannelStatus&&(this._send_statistic&&this._send_statistic.stop(),this._recv_statistic&&this._recv_statistic.stop(),clearInterval(this.timeoutThenCloseInterval),gi("dataChannel.onclose",e),this.dataChannelStatus="CLOSED",this.datachannelcloselistener&&this.datachannelcloselistener(e),this._close(),this._clear())}},{key:"onMessage",value:function(e){this.messageListener=e}},{key:"onDataChannelClose",value:function(e){this.datachannelcloselistener=e}},{key:"onDataChannelOpen",value:function(e){this.datachannelopenlistener=e}},{key:"waitForAnswerFromRWG",value:function(e){var t=this,r=this;return new Promise((function(i,a){var n=z.a.on(e,(function(e,t){r.isDestroyed()&&a(),i(t)}));t.pubSubTokenList.push(n)}))}},{key:"setRemoteDescription",value:function(e){gi("setRemoteDescription",e),this.rtcPeerConnection.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e.sdp}))}},{key:"closeIfTimeout",value:function(){var e=this;clearInterval(this.timeoutThenCloseInterval),this.timeoutThenCloseInterval=setTimeout((function(){gi("closeIfTimeout"),e._close()}),1e4)}},{key:"addIceCandidate",value:function(e){this.rtcPeerConnection.addIceCandidate(new RTCIceCandidate({candidate:e,sdpMLineIndex:0,sdpMid:"0"}))}},{key:"sendVideoData",value:function(e){try{var t;null===(t=this.dataChannel)||void 0===t||t.send(e),this._send_statistic.sample(!1)}catch(e){Y.default.error("Error when sending video data via WebRTC",e),gi.error("sendVideoData",e)}}},{key:"sendAudioData",value:function(e){try{var t;null===(t=this.dataChannel)||void 0===t||t.send(e),this._send_statistic.sample(!1)}catch(e){Y.default.error("Error when sending audio data via WebRTC",e)}}},{key:"listenOnDataAndSend",value:function(e){var t=this,r=z.a.on(e,(function(e,r){t.sendVideoData(r)}));this.pubSubTokenList.push(r)}},{key:"listenOnDataAndSendAudio",value:function(e){var t=this,r=z.a.on(e,(function(e,r){t.sendAudioData(r)}));this.pubSubTokenList.push(r)}}]),e}(),Si=r(6),Ei=r(30),bi=r(14);function yi(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Ci(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ci(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function Ci(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function Ai(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function Ri(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ai(Object(r),!0).forEach((function(t){v()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ai(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ii=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:16/9;if(!e||!t)return null;var n=r||0,o=i||0;if(e/t>a){var s=t*a;return{width:s,height:t,left:Math.round((e-s)/2)+n,top:0+o}}var u=e/a;return{width:e,height:u,left:0+n,top:Math.round((t-u)/2)+o}};function wi(e){this.Notify_APPUI=e.Notify_APPUI,this.isSupportOffscreenCanvas=e.isSupportOffscreenCanvas,this.jsMediaEngine=e.jsMediaEngine,this.threadNumbs=e.videodecodethreadnumb,this.globalTracingLogger=e.globalTracingLogger,this.monitorLoggerFn=e.monitorLoggerFn,this.renderManager=e.renderManager,this.waterMarkCanvas=null,this.videoRenderLevel=10,this.videoRenderLevelCount=1,this.renderPeriodTotal=100,this.renderPeriodCount=0,this.renderPeriodTotalFps=0,this.renderPeriodFpsCount=0,this.lastRenderAudioTimeStamp=0,this.videoBufEmptyCount=0,this.videoBufCount=0,this.videoRenderMaxLevel=15,this.timestamp=0,this.audioPlayTime=0,this.videoTimestamp=0,this.videoWaterMarkName="",this.isCreateVideoWaterMark=!1,this.isWaterMarkRepeatedEnable=!1,this.waterMarkOpacity=.15,this.currentactive=0,this.audioPlaySsrc=0,this.currentVideoHeight=0,this.currentVideoWidth=0,this.videoRenderArray=[],this.WaterMarkRGBA=new Ei.a,this.vMonitorCount=0,this.videoQueue=new L,this.timestart=0,this.rendingFlag=!0,this.rAFID=0,this.rAFIDBack=null,this.prevRequestAnimationTimestap=0,this.retryRequestAnimationStep=2,this.ssrcDisplayMap=new Map,this.ssrcHaddataMap=new Map,this.canvasToLocalDisplay=new Map,this.canvasIdSet=new Set,this.selfvideossrc=0,this.localVideoPtr=0,this.sabBuffer=0,this.localvideossrc=0,this.encodedVideoSharedArrayBufferUint8Array=null,this.encodedVideoSharedArrayBufferUint16Array=null,this.encodedVideoSharedArrayWasmMemory=null,this.startCaptureVideo=!1,this.clearColor=new Uint8Array(4),this.videorendercanvas=null,this.keyrender=null,this.renderIndex=0,this.activeSpeakssrc=0,this.needClear=!1,this.renderMode=0,this.intervalHandle,this.croppingParams={top:0,left:0,height:1,width:1},this.coordinate={x:0,y:0,width:640,height:360},this.isSupportVideoTrackReader=!1,this.bWebglContextLostProtectingMap=new Map,this.ismirror=!1,this.lfTimeStamp=0,this.activeFps=0,this.lastActiveSSRC=0,this.disableOriginalRatio=!1,this.onStopDrawCallback=e.onStopDrawCallback,this.onReStoreCallback=e.onReStoreCallback,this.videoRenderWGLFSTOP=!1}wi.prototype.clearUseridRender=function(e,t,r){var i=e[0],a=i.display;if(a)if(a.setWatermarkFlag(0),this.renderMode)a.clearCanvas(t);else{var n=i.ssrc;if(!a||!t)return;this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.height=1,this.croppingParams.width=1,this.clearColor[0]=255*t.R,this.clearColor[1]=255*t.G,this.clearColor[2]=255*t.B,this.clearColor[3]=255*t.A;var o=this.renderManager.getRendererProvider().isWebGLRendererType(),s=this.renderManager.getRendererProvider().isWebGL2RendererType();if(o||s){var u=this.canvasToLocalDisplay.get(i.canvas);if(!u)return void console.log("no clearDisplay");u.setVideoMode(x.W),u.colorRange=0,u.setFillMode(1,1),u.updateSelfVideoTextures(1,1,this.clearColor,this.croppingParams,!0),void 0===r&&((r={}).x=i.x,r.y=i.y,r.width=i.width,r.height=i.height),u.drawSelfVideo(r,!0)}else{if(!a)return void console.log("no clearDisplay");a.setVideoMode(x.W),a.setColorRange(0),a.setFillMode(1,1),a.updateSelfVideoTextures(1,1,this.clearColor,this.croppingParams,!0),void 0===r&&((r={}).x=i.x,r.y=i.y,r.width=i.width,r.height=i.height),a.drawSelfVideo(r,!0)}var d=this;this.ssrcDisplayMap.forEach((function(e,t){var r,i;t==d.Get_Logical_SSrc(d.selfvideossrc)&&(r=!0),t==d.Get_Logical_SSrc(n)&&(i=!0),e.forEach((function(e){if(e.haddata&&!i){var t=e.display;d.coordinate.x=e.x,d.coordinate.y=e.y,d.coordinate.width=e.width,d.coordinate.height=e.height,t&&(!i||o&&s?t.getVideoMode()!=x.T&&(-1==[x.W,x.O].indexOf(t.getVideoMode())&&r?t.drawSelfVideo(d.coordinate,!1,d.ismirror):r?t.drawRemoteVideo(d.coordinate,d.ismirror):t.drawRemoteVideo(d.coordinate)):t.drawSelfVideo(d.coordinate,!0))}}))})),this.renderManager.renderFor(Si.t.VIDEO)}},wi.prototype.Set_Render_Array_rAF=function(e){if(this.videoRenderArray=e,this.ssrcDisplayMap.clear(),this.ssrcHaddataMap.clear(),this.videoRenderArray.length>0)for(var t=0;t<this.videoRenderArray.length;t++){var r=this.ssrcDisplayMap.get(this.Get_Logical_SSrc(this.videoRenderArray[t].ssrc));r?r.push(this.videoRenderArray[t]):((r=[]).push(this.videoRenderArray[t]),this.ssrcDisplayMap.set(this.Get_Logical_SSrc(this.videoRenderArray[t].ssrc),r),this.ssrcHaddataMap.set(this.Get_Logical_SSrc(this.videoRenderArray[t].ssrc),!1))}},wi.prototype.Set_Render_Array=function(e,t){this.renderMode?this.Set_Render_Array_IntervalMode(e,t):this.Set_Render_Array_rAF(e)},wi.prototype.ClearQueue=function(){this.videoQueue&&this.videoQueue.ClearQueue(),this.currentVideoHeight=0,this.currentVideoWidth=0},wi.prototype.Put_Video_Into_Buffer=function(e){if(this.videoQueue){var t=this.videoQueue.GetQueue(e.ssrc);if(t||(t=this.videoQueue.AddQueue(e.ssrc)),t.enqueue(e),this.videoQueue&&this.videoQueue.ssrcInfo){var r=e.ssrc>>10;this.videoQueue.ssrcInfo.UpdateSSRCInfo(r,e.ntptime)}for(var i=this.videoQueue.GetQueueLength(e.ssrc)-10;i>=0;)i--}},wi.prototype.Update_RemoteVideo_Texture=function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(this.Check_Request_Animation(),r)if(e&&i){var n=this.Get_Logical_SSrc(i),o=this.FindVideoRenderListFromMap(i);if(!o.length)return void this.renderManager.destroyUnusedVideoFrame(e);var s=this;this.ssrcHaddataMap.set(n,!0),this.croppingParams.top=e.visibleRect?0:e.cropTop,this.croppingParams.left=e.visibleRect?0:e.cropLeft,this.croppingParams.height=e.visibleRect?e.visibleRect.height:e.cropHeight,this.croppingParams.width=e.visibleRect?e.visibleRect.width:e.cropWidth,this.canvasIdSet.clear(),o&&o.forEach((function(r){r.haddata=!0;var i=r.display;s.coordinate.x=r.x,s.coordinate.y=r.y,s.coordinate.width=r.width,s.coordinate.height=r.height;var n=!(i&&i.reuse&&r.rendercanvasID&&t.canvasIdSet.has(r.rendercanvasID));i&&(i.setVideoMode(x.W),s.Should_Update_Watermark(i,r.width,r.height,r.width,r.height)&&s.Update_Display_Watermark(i,r.width,r.height,r.width,r.height),e&&i.updateRemoteVideoTexturesImageBitmap(s.croppingParams.width,s.croppingParams.height,e,s.croppingParams,a,n),t.canvasIdSet.add(r.rendercanvasID))}))}else this.renderManager.destroyUnusedVideoFrame(e);else{if(e&&e.ssrc){var u,d=this.Get_Logical_SSrc(e.ssrc),c=this.FindVideoRenderListFromMap(e.ssrc);if(!c.length)return e.yuvdataptr&&Module._free(e.yuvdataptr),void this.renderManager.destroyUnusedVideoFrame(e);var l=!1,h=this;this.ssrcHaddataMap.set(d,!0);var f=e;this.croppingParams.top=f.r_y,this.croppingParams.left=f.r_x,this.croppingParams.height=f.r_h,this.croppingParams.width=f.r_w,(u=f).enableMultiDecodeVideoWithoutSAB?u.yuvdata=u.data:u.yuvdata=Object(bi.a)().subarray(u.yuvdataptr,u.yuvdataptr+u.yuvlength),!u.yuvdata.length||u.yuvdata.length!=u.width*u.height*3/2||this.croppingParams.top<0||this.croppingParams.left<0||this.croppingParams.left+this.croppingParams.width>u.width||this.croppingParams.top+this.croppingParams.height>u.height||c&&(this.canvasIdSet.clear(),c.forEach((function(e){e.haddata=!0;var r=e.display;h.coordinate.x=e.x,h.coordinate.y=e.y,h.coordinate.width=e.width,h.coordinate.height=e.height;var i=!(r&&r.reuse&&e.rendercanvasID&&t.canvasIdSet.has(e.rendercanvasID));r&&(r.setVideoMode(x.S),t.Should_Update_Watermark(r,e.width,e.height,e.width,e.height)&&t.Update_Display_Watermark(r,e.width,e.height,e.width,e.height),u&&r.updateRemoteVideoTextures(u.width,u.height,h.croppingParams,u.yuvdata,u.rotation,u.yuv_limited,h.coordinate,l,i),t.canvasIdSet.add(e.rendercanvasID))})))}else this.renderManager.destroyUnusedVideoFrame(e);e.yuvdataptr&&Module._free(e.yuvdataptr)}},wi.prototype.Set_Cropping_Mode=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.disableOriginalRatio=!!e},wi.prototype.Update_Cropping_Params=function(){if(this.disableOriginalRatio){var e=Ii(this.croppingParams.width,this.croppingParams.height,this.croppingParams.left,this.croppingParams.top);e&&(this.croppingParams=Ri(Ri({},this.croppingParams),e))}},wi.prototype.Update_SelfVideo_Texture=function(e,t,r,i){var a=this,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:x.W,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(o?(this.croppingParams.top=o.top,this.croppingParams.left=o.left,this.croppingParams.width=o.width,this.croppingParams.height=o.height):(this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.height=t,this.croppingParams.width=e),this.renderMode){var s=0;this.canvasIdSet.clear();for(var u=this.FindVideoRenderList(i);s<u.length;s++){this.coordinate.x=u[s].x,this.coordinate.y=u[s].y,this.coordinate.width=u[s].width,this.coordinate.height=u[s].height,this.Update_Cropping_Params(),u[s].display.setVideoMode(n);var d=u[s],c=d.display,l=d.width,h=d.height;this.Should_Update_Watermark(c,l,h,l,h)&&this.Update_Display_Watermark(c,l,h,l,h);var f=!(c&&c.reuse&&u[s].rendercanvasID&&this.canvasIdSet.has(u[s].rendercanvasID));-1!==[x.W,x.O].indexOf(n)?(u[s].display.updateSelfVideoTextures(e,t,r,this.croppingParams,f),u[s].enableMultiDecodeVideoWithoutSAB?u[s].firstFrame=!0:u[s].display.drawSelfVideo(this.coordinate,!1,this.ismirror)):(u[s].display.updateRemoteVideoTextures(e,t,this.croppingParams,r,0,0,this.coordinate,!1,f),u[s].enableMultiDecodeVideoWithoutSAB?u[s].firstFrame=!0:u[s].display.drawRemoteVideo(this.coordinate,this.ismirror)),this.canvasIdSet.add(u[s].rendercanvasID)}this.renderManager.renderFor(Si.t.VIDEO)}else if(r&&i){var p=this.FindVideoRenderListFromMap(i);this.ssrcHaddataMap.set(i,!0);var v=this;p.length&&(this.canvasIdSet.clear(),p.forEach((function(i){i.haddata=!0,v.coordinate.x=i.x,v.coordinate.y=i.y,v.coordinate.width=i.width,v.coordinate.height=i.height,v.Update_Cropping_Params();var o=i.display,s=!(o&&o.reuse&&i.rendercanvasID&&a.canvasIdSet.has(i.rendercanvasID));o&&(o.setVideoMode(n),v.Should_Update_Watermark(o,i.width,i.height,i.width,i.height)&&v.Update_Display_Watermark(o,i.width,i.height,i.width,i.height),-1!==[x.W,x.O].indexOf(n)?o.updateSelfVideoTextures(e,t,r,v.croppingParams,s):o.updateRemoteVideoTextures(e,t,v.croppingParams,r,0,!0,v.coordinate,!1,s),a.canvasIdSet.add(i.rendercanvasID))})),this.renderManager.renderFor(Si.t.VIDEO))}},wi.prototype.Draw_Send_Video_Img=function(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:x.W,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.Update_SelfVideo_Texture(t,r,e,i,a,n)},wi.prototype.setMirrorMyVideoOption=function(e){this.ismirror=e},wi.prototype.Start_Draw=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return this.rendingFlag=!0,this.renderMode=e,e?t?(this.intervalHandle=setInterval(this.JsMediaSDK_VideoRender_interval.bind(this),t),this.intervalHandle):null:(Mi(this),this.Start_Request_Animation_Frame())},wi.prototype.Stop_Draw=function(){this.rendingFlag=!1,this.renderMode?clearInterval(this.intervalHandle):this.Stop_Request_Animation_Frame()},wi.prototype.contextLostCallback=function(e){var t=e.currentTarget.canvasId;Object(bi.g)(t),this.monitorLoggerFn&&this.monitorLoggerFn("MWGLF"),e.preventDefault()},wi.prototype.contextRestoredCallback=function(e){var t=e.currentTarget,r=t.canvasId,i=t.callback;this.Restored_From_Context_Lost(t,t,r,this.Log_Error.bind(this),i),this.onReStoreCallback&&this.onReStoreCallback(this)},wi.prototype.webGLContextLostProtect=function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;t&&t!==e&&(t.contextLostHandler&&t.removeEventListener("webglcontextlost",t.contextLostHandler),t.contextRestoredHandler&&t.removeEventListener("webglcontextrestored",t.contextRestoredHandler)),e&&!this.bWebglContextLostProtectingMap.get(e)&&(e.canvasId=r,e.callback=i,this.renderMode||((t=this.bWebglContextLostProtectingMap.get(r))&&(t.removeEventListener("webglcontextlost",t.contextLostHandler),t.removeEventListener("webglcontextrestored",t.contextRestoredHandler)),this.bWebglContextLostProtectingMap.set(r,e),e.contextLostHandler=this.contextLostCallback.bind(this),e.contextRestoredHandler=this.contextRestoredCallback.bind(this),e.addEventListener("webglcontextlost",e.contextLostHandler,{capture:!1}),e.addEventListener("webglcontextrestored",e.contextRestoredHandler,{capture:!1})))},wi.prototype._Replace_Video_Render_Array_From_Context_LOST=function(e){for(var t=e.canvas,r=e.oldCanvas,i=e.newDisplayMap,a=0;a<this.videoRenderArray.length;a++)if(this.videoRenderArray[a].canvas===r||this.videoRenderArray[a].canvas===t){r!==t&&(this.videoRenderArray[a].canvas=t);var n=this.videoRenderArray[a].display.getFillMode();this.videoRenderArray[a].display=i?i.get(this.videoRenderArray[a].display.getTextureIndex()):this._Create_WebGL_Canvas({videoRenderArrayIndex:a,canvas:t,canvasId:this.videoRenderArray[a].rendercanvasID}),n&&this.videoRenderArray[a].display&&this.videoRenderArray[a].display.setFillMode(n,this.videoRenderArray[a].display.getFillModeForResolution())}},wi.prototype.Restored_From_Context_Lost=function(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(this.renderMode)this._Replace_Video_Render_Array_From_Context_LOST({canvas:e,oldCanvas:t});else{var n=this.renderManager.onRestoredFromContextLost(r,e,t,this.threadNumbs,i,this.canvasToLocalDisplay);n&&(this.ssrcDisplayMap.forEach((function(r,i){r.forEach((function(r){if(r.haddata=!1,r.canvas===t){t!==e&&(r.canvas=e);var i=r.display;r.display=n.get(i.getTextureIndex())}}))})),this._Replace_Video_Render_Array_From_Context_LOST({canvas:e,oldCanvas:t,newDisplayMap:n}),null==a||a({canvas:e,oldCanvas:t,newDisplayMap:n}),this.rendingFlag&&this.Start_Request_Animation_Frame())}},wi.prototype.Replace_Canvas=function(e,t){var r=null;this.bWebglContextLostProtectingMap.forEach((function(e,i){i===t&&(r=e)})),r!=e&&(this.bWebglContextLostProtectingMap.delete(t),this.webGLContextLostProtect(e,r,t),this.Restored_From_Context_Lost(e,r,t,this.Log_Error.bind(this))),this.isSupportOffscreenCanvas&&(this.waterMarkCanvas||this.videorendercanvas)&&(this.waterMarkCanvas=this.videorendercanvas=new OffscreenCanvas(640,360))},wi.prototype.Get_Display=function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=this.renderManager.getRendererProvider().isWebGLRendererType(),n=this.renderManager.getRendererProvider().isWebGL2RendererType();(a||n)&&this.webGLContextLostProtect(e,null,t,i);var o=this.renderManager.getVideoRenderDisplay(e,t,this.threadNumbs,this.Log_Error.bind(this),this.canvasToLocalDisplay);return o},wi.prototype.GiveBack_Display=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e[0];r&&r.display&&this.renderManager.recycleRenderDisplay(r.canvas,r.display,t)},wi.prototype.Get_Logical_SSrc=function(e){return e?e>>10<<10:-1},wi.prototype.Set_LocalVideo_Ptr=function(e){e&&(this.localVideoPtr=e)},wi.prototype.Set_LocalVideo_Buffer=function(e){e&&(this.encodedVideoSharedArrayWasmMemory=e,this.sabBuffer=e.buffer,this.encodedVideoSharedArrayBufferUint8Array=new Uint8Array(this.sabBuffer),this.encodedVideoSharedArrayBufferUint16Array=new Uint16Array(this.sabBuffer))},wi.prototype.Set_LocalVideo_SSRC=function(e){e&&(this.localvideossrc=e,this.selfvideossrc=e)},wi.prototype.Draw_LocalVideo=function(){if(this.localVideoPtr&&this.sabBuffer&&this.localvideossrc){this.encodedVideoSharedArrayWasmMemory&&this.encodedVideoSharedArrayWasmMemory.buffer!=this.sabBuffer&&(this.encodedVideoSharedArrayBufferUint8Array=new Uint8Array(this.encodedVideoSharedArrayWasmMemory.buffer),this.encodedVideoSharedArrayBufferUint16Array=new Uint16Array(this.encodedVideoSharedArrayWasmMemory.buffer),this.sabBuffer=this.encodedVideoSharedArrayWasmMemory.buffer);var e=Atomics.load(this.encodedVideoSharedArrayBufferUint8Array,this.localVideoPtr),t=!0;if(e==Atomics.load(this.encodedVideoSharedArrayBufferUint8Array,this.localVideoPtr+1)&&(t=!1),t){var r=0,i=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(x.Q+4+8+2)*e)/2],a=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(x.Q+4+8+2)*e+2)/2],n=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(x.Q+4+8+2)*e+4)/2],o=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(x.Q+4+8+2)*e+6)/2],s=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(x.Q+4+8+2)*e+8)/2],u=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(x.Q+4+8+2)*e+10)/2],d=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+(x.Q+4+8+2)*e+12)/2];r=d&&d!==x.O?i*a*3/2:i*a*4,this.croppingParams.top=n,this.croppingParams.left=o,this.croppingParams.height=u,this.croppingParams.width=s;var c=this.encodedVideoSharedArrayBufferUint8Array.subarray(this.localVideoPtr+4+(x.Q+4+8+2)*e+4+8,this.localVideoPtr+4+(x.Q+4+8+2)*e+4+8+r);this.Update_SelfVideo_Texture(i,a,c,this.Get_Logical_SSrc(this.localvideossrc),d,this.croppingParams),Atomics.store(this.encodedVideoSharedArrayBufferUint8Array,this.localVideoPtr,(e+1)%10)}}},wi.prototype.Update_LocalVideo=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.localvideossrc;if(this.renderMode){for(var i=0,a=0,n=!1,o=this.FindVideoRenderList(r);a<o.length;a++){n=!0;var s=e;this.croppingParams.top=s.visibleRect?0:s.cropTop,this.croppingParams.left=s.visibleRect?0:s.cropLeft,this.croppingParams.height=s.visibleRect?s.visibleRect.height:s.cropHeight,this.croppingParams.width=s.visibleRect?s.visibleRect.width:s.cropWidth,this.coordinate.x=o[a].x,this.coordinate.y=o[a].y,this.coordinate.width=o[a].width,this.coordinate.height=o[a].height,this.Update_Cropping_Params();var u=o[a].display;u.setVideoMode(i);var d=o[a],c=d.display,l=d.width,h=d.height;0!=l&&0!=h&&(this.Should_Update_Watermark(c,l,h,l,h)&&this.Update_Display_Watermark(c,l,h,l,h),-1!==[x.W,x.O].indexOf(i)&&(o[a].display.updateRemoteVideoTexturesImageBitmap(this.croppingParams.width,this.croppingParams.height,s,this.croppingParams,s.rotation),o[a].enableMultiDecodeVideoWithoutSAB?o[a].firstFrame=!0:o[a].display.drawSelfVideo(this.coordinate,!1,this.ismirror)))}n||this.renderManager.destroyUnusedVideoFrame(e)}else this.Update_RemoteVideo_Texture(e,!0,r,t)},wi.prototype.Set_Capture_Video_Flag=function(e){this.startCaptureVideo=e},wi.prototype.Get_Capture_Video_Flag=function(){return this.startCaptureVideo},wi.prototype.FindVideoRender=function(e){if(!e)return null;for(var t=0;t<this.videoRenderArray.length;t++)if(this.videoRenderArray[t].ssrc&&this.videoRenderArray[t].ssrc>>10==e>>10)return this.videoRenderArray[t];return null},wi.prototype.FindVideoRenderList=function(e){var t=this.isActiveSeakerSsrc(e),r=this.FindVideoRender(x.a),i=[e>>10];t&&r&&i.push(x.a>>10);for(var a=[],n=0;n<this.videoRenderArray.length;n++)this.videoRenderArray[n].ssrc&&i.includes(this.videoRenderArray[n].ssrc>>10)&&a.push(this.videoRenderArray[n]);return a},wi.prototype.FindVideoRenderListFromMap=function(e){var t=this.isActiveSeakerSsrc(e),r=this.ssrcDisplayMap.get(this.Get_Logical_SSrc(e))||[],i=n()(r);if(t){var a=this.ssrcDisplayMap.get(this.Get_Logical_SSrc(x.a))||[];i.push.apply(i,n()(a))}return i},wi.prototype.JsMediaSDK_VideoRender_interval=function(){var e=this;this.startCaptureVideo&&this.Draw_LocalVideo();var t=this.FindVideoRender(x.a),r=this.FindVideoRender(this.activeSpeakssrc);if(0!=this.videoRenderArray.length){for(var i,a=function(){var a=e.videoRenderArray[n],o=(a.display,a.canvas),s=a.enableMultiDecodeVideoWithoutSAB,u=a.ssrc,d=a.isMyself;if(i=null,a==t&&r)return 1;var c=u;a!=t||r||(c=e.activeSpeakssrc);var l=[a];if(a==r&&t&&l.push(t),e.isActiveSsrcVideo(c)){var h=Date.now();if(e.jsMediaEngine){var f=e.jsMediaEngine.Get_Video_SSRC_Latest_Time();e.timestamp=f.currentSSRCTime,e.audioPlayTime=f.audioPlayTime}e.calPacingTime(h),h-e.timestart<e.pacingTime||(i=e.Get_Decoded_Video_Frame(e.Get_Logical_SSrc(c)),e.timestart=h)}else i=e.Get_Decoded_Video_Frame(e.Get_Logical_SSrc(c));if(i){var p;e.isActiveSsrcVideo(c)&&(e.videoTimestamp=i.ntptime),p=i.yuvdata instanceof bi.c?i.yuvdata.yuvdata:i.yuvdata,e.croppingParams.top=i.r_y,e.croppingParams.left=i.r_x,e.croppingParams.height=i.r_h,e.croppingParams.width=i.r_w;var v=i.width>i.height&&(1===i.rotation||3===i.rotation)||i.width<i.height&&1!==i.rotation&&3!==i.rotation,m=v?i.height:i.width,g=v?i.width:i.height,_=o.width,S=o.height;if(e.currentVideoHeight==e.croppingParams.height&&e.currentVideoWidth==e.croppingParams.width||(e.Notify_APPUI?e.Notify_APPUI(M.CURRENT_VIDEO_RESOLUTION,{width:e.croppingParams.width,height:e.croppingParams.height}):postMessage({status:x.j,width:e.croppingParams.width,height:e.croppingParams.height}),e.currentVideoHeight=e.croppingParams.height,e.currentVideoWidth=e.croppingParams.width),p.length==i.width*i.height*3/2&&i.r_x>=0&&i.r_y>=0&&i.r_x+i.r_w<=i.width&&i.r_y+i.r_h<=i.height){8400==e.vMonitorCount&&(e.jsMediaEngine?e.jsMediaEngine.Send_Render_Monitor_Log("VDGLM"):postMessage({status:x.V,data:"VDGLW"}),e.vMonitorCount=0),e.vMonitorCount++;var E=e;l.forEach((function(e){e.display&&(E.Should_Update_Watermark(e.display,m,g,_,S)&&E.Update_Display_Watermark(e.display,m,g,_,S),s?e.display&&(e.display.setVideoMode(x.S),e.display.updateRemoteVideoTextures(i.width,i.height,E.croppingParams,p,i.rotation,i.yuv_limited),e.firstFrame=!0):(e.display.setVideoMode(x.S),e.display.drawNextOutputPictureFrame(i.width,i.height,E.croppingParams,p,i.rotation,i.yuv_limited,e)))}))}else e.Log_Error("Invalid YUV data: ".concat(i.r_x," ").concat(i.r_y," ").concat(i.r_w," ").concat(i.r_h," ").concat(i.width," ").concat(i.height));i.yuvdata instanceof bi.c&&i.yuvdata.recycle()}s&&l.forEach((function(e){if(s&&e.firstFrame){var t={x:e.x,y:e.y,width:e.width,height:e.height};d?e.display.drawSelfVideo(t):e.display.drawRemoteVideo(t)}}))},n=0;n<this.videoRenderArray.length;n++)a();this.renderManager.renderFor(Si.t.VIDEO)}},wi.prototype.Get_Decoded_Video_Frame=function(e){if(this.videoQueue){var t=this.videoQueue.GetQueue(e);return t?t.dequeue():null}},wi.prototype.Set_SSRC_Latest_Time_Stamp=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.timestamp!==e&&"number"==typeof e&&e&&(this.timestamp=e,this.audioPlaySsrc=t,this.audioPlayTime=Date.now())},wi.prototype.Get_Decoded_Video_Buffer_Length=function(e){return this.videoQueue?this.videoQueue.GetQueueLength(e):0},wi.prototype.Get_SSRC_VIDEO_FPS=function(e){if(e>>=10,this.videoQueue&&this.videoQueue.ssrcInfo){var t=this.videoQueue.ssrcInfo.GetSSRCFpsInfo(e);if(t)return Math.round(t)}return 0},wi.prototype.Change_Current_SSRC=function(e){this.currentactive=e,this.ClearQueue()},wi.prototype.Set_Render_Array_IntervalMode=function(e,t){if(this.videoRenderArray=e,this.renderMode&&this.videoRenderArray.length>0)for(var r=0;r<this.videoRenderArray.length;r++){var i=this.videoRenderArray[r];t?i.display||(i.enableMultiDecodeVideoWithoutSAB=t,i.display=this.Get_Display(i.canvas,i.canvas.id),i.display&&i.display.setFillMode(i.fillMode,i.fillModeForResolution)):(i.display=this._Create_WebGL_Canvas({videoRenderArrayIndex:r,canvas:i.canvas,canvasId:i.rendercanvasID}),this.webGLContextLostProtect(i.canvas,void 0,i.rendercanvasID))}},wi.prototype._Create_WebGL_Canvas=function(e){var t=e.videoRenderArrayIndex,r=e.canvas,i=e.canvasId,a={forceNoGL:void 0,contextOptions:{webglcontextlostCallback:this.webglcontextlostCallback.bind(this),webglcontextrestoredCallback:this.webglcontextrestoredCallback.bind(this),params:{videoRenderArrayIndex:t,canvas:r,canvasId:i}},webGLResources:void 0,initMask:!1};return this.renderManager.createWebGLVideoRenderDisplay(r,i,0,a)},wi.prototype.webglcontextlostCallback=function(e,t){t.canvas,t.canvasId;e.preventDefault()},wi.prototype.webglcontextrestoredCallback=function(e,t){var r,i,a,n=t.videoRenderArrayIndex,o=t.canvas,s=t.canvasId;(!this.videoRenderArray||n>=(null===(r=this.videoRenderArray)||void 0===r?void 0:r.length))&&this.Log_Error("videoRenderArray:".concat(this.videoRenderArray,", length:").concat(null===(a=this.videoRenderArray)||void 0===a?void 0:a.length));this.renderMode&&n<(null===(i=this.videoRenderArray)||void 0===i?void 0:i.length)&&(this.videoRenderArray[n].display=this._Create_WebGL_Canvas({videoRenderArrayIndex:n,canvas:o,canvasId:s}),this.Set_Render_Array(this.videoRenderArray))},wi.prototype.ClearQueue=function(){try{var e,t=yi(this.videoQueue.ssrcQueueMap);try{for(t.s();!(e=t.n()).done;)for(var r=O()(e.value,2),i=(r[0],r[1]);!i.isEmpty();){var a=i.dequeue();a.yuvdata&&a.yuvdata instanceof bi.c&&a.yuvdata.recycle()}}catch(e){t.e(e)}finally{t.f()}}catch(e){this.Log_Error("Exception during VideoRender.ClearQueue",e)}this.videoQueue&&this.videoQueue.ClearQueue(),this.currentVideoHeight=0,this.currentVideoWidth=0},wi.prototype.Set_WaterMark_Info=function(e){var t=e.waterMarkCanvas,r=e.isCreateVideoWaterMark,i=e.videoWaterMarkName,a=e.watermarkOpacity,n=e.watermarkRepeated,o=e.watermarkPosition;this.waterMarkCanvas=t||this.videorendercanvas,this.isCreateVideoWaterMark=r,this.videoWaterMarkName=i,void 0!==n&&(this.isWaterMarkRepeatedEnable=!!n),void 0!==a&&(this.waterMarkOpacity=a),void 0!==o&&(this.watermarkPosition=o)},wi.prototype.Set_WaterMark_Flag=function(e){if(this.videoRenderArray.length>0)for(var t=0;t<this.videoRenderArray.length;t++){this.videoRenderArray[t].display.setWatermarkFlag(e?1:0)}},wi.prototype.Should_Watermark_Repeated=function(e,t){return this.isWaterMarkRepeatedEnable&&e>306&&t>202};var Ti=function(e,t){if(e<640&&e){var r=640/e;e=640,t=Math.round(t*r)}return{width:e,height:t}};wi.prototype.Update_Display_Watermark=function(e,t,r,i,a){var n=this.Should_Watermark_Repeated(i,a);this.waterMarkCanvas||this.videorendercanvas||(this.videorendercanvas=this.isSupportOffscreenCanvas?new OffscreenCanvas(640,360):null);var o=i<512||a<288?16:this.watermarkPosition,s=this.waterMarkCanvas||this.videorendercanvas;if(!("function"==typeof OffscreenCanvas&&s instanceof OffscreenCanvas&&OffscreenCanvasRenderingContext2D)||OffscreenCanvasRenderingContext2D.prototype.measureText){var u=Ti(t,r);t=u.width,r=u.height;var d=n?this.WaterMarkRGBA.Get_Repeated_WaterMarkRGBA({canvas:s,name:this.videoWaterMarkName,width:t,height:r,opacity:this.waterMarkOpacity,position:o}):this.WaterMarkRGBA.Get_WaterMarkRGBA({canvas:s,name:this.videoWaterMarkName,width:t,height:r,opacity:this.waterMarkOpacity,position:o});e.updateWatermark(t,r,d)}},wi.prototype.Should_Update_Watermark=function(e,t,r,i,a){if(!this.isCreateVideoWaterMark)return!1;var n=!1,o=Ti(t,r);o.width===e.getWatermarkWidth()&&o.height===e.getWatermarkHeight()||(n=!0);var s=this.Should_Watermark_Repeated(i,a);e.isSetWatermark()||(n=!0),s!==e.isWatermarkRepeated()&&(n=!0,e.setWatermarkRepeated(s)),this.waterMarkOpacity&&this.waterMarkOpacity!==e.getWatermarkOpacity()&&(n=!0,e.setWatermarkOpacity(this.waterMarkOpacity));var u=t<512||r<288?16:this.watermarkPosition;return u!==e.getWatermarkPosition()&&(n=!0,e.setWatermarkPosition(u)),n},wi.prototype.calCulateActiveFps=function(e){this.activeFps&&e>=this.lfTimeStamp?this.activeFps=500/(e-this.lfTimeStamp)+this.activeFps/2:this.lfTimeStamp&&(this.activeFps=1e3/(e-this.lfTimeStamp))},wi.prototype.Put_Video_Data_Queue=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;if(this.videoQueue){var r=this.videoQueue.GetQueue(e.ssrc);if(r||(r=this.videoQueue.AddQueue(e.ssrc)),r.enqueue(e),(this.Get_Logical_SSrc(this.currentactive)==this.Get_Logical_SSrc(e.ssrc)||this.Get_Logical_SSrc(this.audioPlaySsrc)==this.Get_Logical_SSrc(e.ssrc))&&(this.lfTimeStamp&&this.calCulateActiveFps(e.ntptime),this.lfTimeStamp=e.ntptime),this.lastActiveSSRC!=e.ssrc&&(this.lfTimeStamp=0,this.activeFps=0),this.lastActiveSSRC=e.ssrc,this.videoQueue&&this.videoQueue.ssrcInfo){var i=e.ssrc>>10;this.videoQueue.ssrcInfo.UpdateSSRCInfo(i,e.ntptime)}for(var a=this.videoQueue.GetQueueLength(e.ssrc),n=a-t;n>=0;){var o=this.Get_Decoded_Video_Frame(e.ssrc);o.yuvdata instanceof bi.c&&o.yuvdata.recycle(),n--}}else e.yuvdata&&e.yuvdata instanceof bi.c&&e.yuvdata.recycle()},wi.prototype.Set_VideoTrackReader=function(e){this.isSupportVideoTrackReader=e},wi.prototype.Clear_OffScreenCanvas=function(e){this.renderManager.clearOffscreenCanvas(e),e.contextLostHandler&&(e.removeEventListener("webglcontextlost",e.contextLostHandler),e.contextLostHandler=null),e.contextRestoredHandler&&(e.removeEventListener("webglcontextrestored",e.contextRestoredHandler),e.contextRestoredHandler=null),e.width=1,e.height=1},wi.prototype.Zoom_Render=function(e){},wi.prototype.Decode_Ssrc=function(e){return this.ssrcDisplayMap.has(this.Get_Logical_SSrc(e))||this.Get_Logical_SSrc(e)==this.Get_Logical_SSrc(this.selfvideossrc)};var ki,Di="undefined"==typeof window;function Oi(e){var t=Date.now(),r=ki;if(t-xi<30)r.Start_Request_Animation_Frame(e);else if(xi=t,r.rendingFlag){r.needClear&&(r.needClear=!1);try{r.startCaptureVideo&&r.localVideoPtr&&r.Draw_LocalVideo(),r.ssrcDisplayMap.forEach((function(e,i){if(i!=r.Get_Logical_SSrc(x.a)||!r.ssrcDisplayMap.has(r.Get_Logical_SSrc(r.activeSpeakssrc)))if(i==r.Get_Logical_SSrc(x.a)&&(i=r.activeSpeakssrc),r.isActiveSsrcVideo(i))if(r.calPacingTime(t),t-r.timestart<r.pacingTime);else{r.timestart=t;var a=r.Get_Decoded_Video_Frame(r.Get_Logical_SSrc(i));a&&(r.Update_RemoteVideo_Texture(a),r.videoTimestamp=a.ntptime)}else{var n=r.Get_Decoded_Video_Frame(r.Get_Logical_SSrc(i));n&&r.Update_RemoteVideo_Texture(n)}})),r.ssrcDisplayMap.forEach((function(e,t){var i=r.isSelfVideo(t);e.forEach((function(e){var t,a=e.display;null!=a&&null!==(t=a.isAvaiable)&&void 0!==t&&t.call(a)||setTimeout((function(){var e;null==a||null===(e=a.restoreContext)||void 0===e||e.call(a)}),5),e.haddata&&(r.coordinate.x=e.x,r.coordinate.y=e.y,r.coordinate.width=e.width,r.coordinate.height=e.height,a&&a.getVideoMode()!=x.T&&(i&&-1!==[x.W,x.O].indexOf(a.getVideoMode())?a.drawSelfVideo(r.coordinate,!1,r.ismirror):i?a.drawRemoteVideo(r.coordinate,r.ismirror):a.drawRemoteVideo(r.coordinate)))}))})),r.renderManager.renderFor(Si.t.VIDEO)}catch(e){r.Log_Error("Exception while rendering video",e)}r.Start_Request_Animation_Frame(e)}else r.rAFID&&r.Stop_Request_Animation_Frame()}function Mi(e){return!!e&&(ki=e,!0)}wi.prototype.Check_Request_Animation=function(){Di&&this.rendingFlag&&this.prevRequestAnimationTimestap&&(performance.now()-this.prevRequestAnimationTimestap>5e3&&!this.rAFIDBack&&(postMessage({status:MONITOR_MESSAGE,data:"WCL_M,RCIF"}),this.rAFID&&(cancelAnimationFrame(this.rAFID),this.rAFID=0),this.rAFIDBack=setInterval(Oi.bind(null,!0),30)))},wi.prototype.Start_Request_Animation_Frame=function(e,t){if(!e&&this.rAFIDBack&&(console.log("Request_Animation_start"),this.Stop_Request_Animation_Frame_Backup()),!this.rAFIDBack)return t||(this.retryRequestAnimationStep=2),this.prevRequestAnimationTimestap=performance.now(),this.rAFID=requestAnimationFrame(Oi),this.rAFID},wi.prototype.Stop_Request_Animation_Frame_Backup=function(){this.rAFIDBack&&(clearInterval(this.rAFIDBack),this.rAFIDBack=null)},wi.prototype.Stop_Request_Animation_Frame=function(){this.rAFID&&cancelAnimationFrame(this.rAFID),this.rAFID=0,this.prevRequestAnimationTimestap=0,this.retryRequestAnimationStep=2,this.Stop_Request_Animation_Frame_Backup()},wi.prototype.Log_Error=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.globalTracingLogger?this.globalTracingLogger.error(e,t):Object(bi.f)(e,t)},wi.prototype.calPacingTime=function(e){if(this.pacingTime=30,this.activeFps>=1&&this.activeFps<=40&&(this.pacingTime=1e3/this.activeFps),this.timestamp&&this.videoTimestamp){var t=this.timestamp+e-this.audioPlayTime,r=this.videoTimestamp+this.pacingTime-t,i=this.currentactive?this.currentactive:this.audioPlaySsrc,a=this.videoQueue.GetQueueLength(this.Get_Logical_SSrc(i));r>65&&r<1e4&&a>=1&&(this.pacingTime=1.5*this.pacingTime),r<-65&&(this.pacingTime=1*this.pacingTime/2)}else this.timestamp||(this.pacingTime>150?this.pacingTime=1*this.pacingTime/2:this.pacingTime=this.pacingTime-10)},wi.prototype.getRenderManager=function(){return this.renderManager},wi.prototype.cleanup=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.renderManager.cleanup(e,t,r)},wi.prototype.setActiveSpeakerSsrc=function(e){this.activeSpeakssrc=e},wi.prototype.getActiveSpeakerSsrc=function(e){return this.activeSpeakssrc},wi.prototype.isActiveSeakerSsrc=function(e){return this.activeSpeakssrc&&this.activeSpeakssrc>>10==e>>10},wi.prototype.isActiveSsrcVideo=function(e){var t=e>>10;return t==this.currentactive>>10||t==this.audioPlaySsrc>>10},wi.prototype.clearDraw=function(e){e&&(this.clearColor[0]=255*e.R,this.clearColor[1]=255*e.G,this.clearColor[2]=255*e.B,this.clearColor[3]=255*e.A),this.needClear=!0},wi.prototype.isSelfVideo=function(e){return this.Get_Logical_SSrc(e)==this.Get_Logical_SSrc(this.selfvideossrc)||this.isActiveSeakerSsrc(this.selfvideossrc)&&e>>10==x.a>>10};var xi=0,Pi=wi;function Ni(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Vi(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vi(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function Vi(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function Ui(e){this.Notify_APPUI=e.Notify_APPUI,this.PubSub=e.PubSub,this.jsMediaEngine=e.jsMediaEngine,this.globalTracingLogger=e.globalTracingLogger,this.renderManager=e.renderManager,this.currentshareactive=0,this.isFromMainSession=0,this.sharingWidthAndHeightInfo={logicHeight:0,logicWidth:0},this.currentSharingHeight=0,this.currentSharingWidth=0,this.currentSharingLogicHeight=0,this.currentSharingLogicWidth=0,this.isCreateSharingWaterMark=!1,this.sharingWaterMarkName="",this.isWaterMarkRepeatedEnable=!1,this.waterMarkOpacity=.15,this.SharingCanvasSizeInfo=null,this.Cursorx=null,this.Cursory=null,this.CursorWidth=null,this.CursorHeight=null,this.xratio=1,this.yratio=1,this.sharingDisplay=null,this.mouseQueue=new H,this.sharingQueue=new H,this.WaterMarkRGBA=new Ei.a,this.sMonitorCount=0,this.mMonitorCount=0,this.firstFrameForIOS=!1,this.timestart=0,this.asTime=0,this.rAFID=0,this.requestAnimation=!1,this.requestF=this.No_Bindthis_RAF.bind(this),this.cATimeStamp=0,this.lRTimeStamp=0,this.pacingtime=1,this.sharingFps=0,this.lfTimeStamp=0,this.maxQueueLength=0,this.vaTimeDelta=0,this.renderMode=x.G,this.SharingRenderInterval=0,this.RAFhealthCheckInterval=0,this.RAFLastTime=0,this.brefresh=!1,this.statisticObj=null}Ui.prototype.Start_Draw=function(){return this.requestAnimation=!0,this.Start_Request_Animation_Frame()},Ui.prototype.Stop_Draw=function(){return this.requestAnimation=!1,this.lRTimeStamp=0,this.cATimeStamp=0,this.Stop_Request_Animation_Frame()},Ui.prototype.Start_Request_Animation_Frame=function(){return this.rAFID=requestAnimationFrame(this.requestF),this.rAFID},Ui.prototype.Stop_Request_Animation_Frame=function(){this.rAFID&&(cancelAnimationFrame(this.rAFID),this.rAFID=0)},Ui.prototype.No_Bindthis_RAF=function(){var e=performance.now();this.RAFLastTime=e,this.requestAnimation?(this.calPacingTime(e),e-this.timestart>this.pacingtime&&(this.timestart=e,this.JsMediaSDK_SharingRender()),this.Start_Request_Animation_Frame()):this.Stop_Request_Animation_Frame()},Ui.prototype.No_Bindthis_Interval=function(){var e=performance.now();this.calPacingTime(e),e-this.timestart>this.pacingtime&&(this.timestart=e,this.JsMediaSDK_SharingRender())},Ui.prototype.calPacingTime=function(e){this.pacingtime=30,this.sharingFps&&this.sharingFps>0&&this.sharingFps<100&&(this.pacingtime=1e3/this.sharingFps);var t=this.Get_Current_QueueLength();if(this.cATimeStamp&&this.lRTimeStamp){var r=this.cATimeStamp+e-this.asTime;this.vaTimeDelta=this.lRTimeStamp+this.pacingtime-r,this.vaTimeDelta>65&&this.vaTimeDelta<1e4&&t>1&&(this.pacingtime=1.5*this.pacingtime),this.vaTimeDelta<-65&&(this.pacingtime=1*this.pacingtime/2)}else this.cATimeStamp||(this.pacingtime>150||t>20?this.pacingtime=1*this.pacingtime/2:this.pacingtime=this.pacingtime-10)},Ui.prototype.JsMediaSDK_SharingRender=function(){var e,t,r;if(this.sharingDisplay){var i,a;if(!1===(null===(e=(t=this.sharingDisplay).isAvaiable)||void 0===e?void 0:e.call(t)))return null===(i=(a=this.sharingDisplay).restoreContext)||void 0===i||i.call(a),void Object(bi.f)("JsMediaSDK_SharingRender canvas get context lost");null===(r=this.statisticObj)||void 0===r||r.sample();var n=this.Get_Decoded_Sharing_Frame(this.currentshareactive,this.isFromMainSession),o=this.Get_Decoded_Mouse_Frame(this.currentshareactive,this.isFromMainSession);if(n){var s,u;this.lRTimeStamp=n.ntptime,n.yuvdata instanceof bi.c?(s=n.yuvdata.yuvdata,u=n.yuvdata):(s=n.yuvdata,u=null),this.sharingWidthAndHeightInfo.logicWidth==n.logic_w&&this.sharingWidthAndHeightInfo.logicHeight==n.logic_h||(this.PubSub?PubSub.publish(M.SHARING_PARAM_INFO_FROM_SOCKET,{body:{width:n.logic_w,height:n.logic_h,logicWidth:n.logic_w,logicHeight:n.logic_h}}):(postMessage({status:x.M,logicWidth:n.logic_w,logicHeight:n.logic_h}),this.updateOffscreenCanvasSize(n.logic_w,n.logic_h)),this.sharingWidthAndHeightInfo.logicWidth=n.logic_w,this.sharingWidthAndHeightInfo.logicHeight=n.logic_h);var d=n.logic_h,c=n.logic_w,l=n.r_h,h=n.r_w;this.xratio=h/c,this.yratio=l/d;var f={top:n.r_x,left:n.r_y,height:n.r_h,width:n.r_w};this.currentSharingHeight==n.r_h&&this.currentSharingWidth==n.r_w&&this.currentSharingLogicHeight==n.logic_h&&this.currentSharingLogicWidth==n.logic_w||(this.Notify_APPUI?this.Notify_APPUI(M.SHARING_PARA,{body:{height:n.logic_h,width:n.logic_w,logicHeight:n.logic_h,logicWidth:n.logic_w}}):(postMessage({status:x.M,logicWidth:n.logic_w,logicHeight:n.logic_h}),this.updateOffscreenCanvasSize(n.logic_w,n.logic_h)),this.currentSharingHeight=n.r_h,this.currentSharingWidth=n.r_w,this.currentSharingLogicHeight=n.logic_h,this.currentSharingLogicWidth=n.logic_w);var p=this.SharingCanvasSizeInfo?this.SharingCanvasSizeInfo.width:n.r_w,v=this.SharingCanvasSizeInfo?this.SharingCanvasSizeInfo.height:n.r_h;this.Should_Update_Watermark(this.sharingDisplay,p,v)&&this.Update_Display_Watermark(this.sharingDisplay,p,v),3e3==this.sMonitorCount&&(this.jsMediaEngine?this.jsMediaEngine.Send_Render_Monitor_Log("SDIMM"):postMessage({status:x.K,data:"SDIMW"}),this.sMonitorCount=0),this.sMonitorCount++,this.sharingDisplay.drawNextOutputPictureFrame(n.width,n.height,f,s,null,n.yuv_limited),u&&u.recycle(),n.dataptr&&Module._free(n.dataptr)}else if(this.brefresh&&(this.brefresh=!1,0!=this.sharingDisplay.getTextureWidth()&&0!=this.sharingDisplay.getTextureHeight())){var m=this.SharingCanvasSizeInfo?this.SharingCanvasSizeInfo.width:this.currentSharingWidth,g=this.SharingCanvasSizeInfo?this.SharingCanvasSizeInfo.height:this.currentSharingHeight;this.Should_Update_Watermark(this.sharingDisplay,m,g)&&this.Update_Display_Watermark(this.sharingDisplay,m,g),this.sharingDisplay.drawNextOutputPictureFrame(this.sharingDisplay.getTextureWidth(),this.sharingDisplay.getTextureHeight(),this.sharingDisplay.getCroppingParams(),null,this.picRotation,!0,null,!1),n=!0}o&&(this.Cursorx=o.r_x*this.xratio,this.Cursory=o.r_y*this.yratio,this.CursorWidth=o.width*this.xratio,this.CursorHeight=o.height*this.yratio,this.sharingDisplay.updateCursor(o.width,o.height,o.buffer),3e3==this.mMonitorCount&&(this.jsMediaEngine?this.jsMediaEngine.Send_Render_Monitor_Log("SDSBM"):postMessage({status:x.K,data:"SDSBW"}),this.mMonitorCount=0),this.mMonitorCount++,this.sharingDisplay.drawCursor(1,this.Cursorx,this.Cursory,this.CursorWidth,this.CursorHeight)),n&&this.renderManager.renderFor(Si.t.SHARE)}else Object(bi.f)("JsMediaSDK_SharingRender error, display is null")},Ui.prototype.setOnlyAcceptUISize=function(e){this.bOnlyAcceptUISize=e},Ui.prototype.updateOffscreenCanvasSize=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.bOnlyAcceptUISize&&!r)return console.log("drop logic w/h");try{var i=this.sharingDisplay.getAttachedCanvas();i&&i instanceof OffscreenCanvas&&(i.width=e,i.height=t,this.brefresh=!0)}catch(e){this.Log_Error("Error updating OffscreenCanvas size",e)}},Ui.prototype.Set_Render_Display=function(e){this.sharingDisplay=e},Ui.prototype.Change_Current_SSRC=function(e,t){this.currentshareactive=e,this.currentSharingHeight=0,this.currentSharingWidth=0,this.currentSharingLogicHeight=0,this.currentSharingLogicWidth=0,this.isFromMainSession=t,this.firstFrameForIOS=!1,this.ClearQueue()},Ui.prototype.Set_WaterMark_Info=function(e){var t=e.waterMarkCanvas,r=e.isCreateSharingWaterMark,i=e.sharingWaterMarkName,a=e.watermarkOpacity,n=e.watermarkRepeated,o=e.watermarkPosition;r||(this.SharingCanvasSizeInfo=null),this.Replace_WaterMark_Canvas(t),this.isCreateSharingWaterMark=r,this.sharingWaterMarkName=i,void 0!==n&&(this.isWaterMarkRepeatedEnable=!!n),void 0!==a&&(this.waterMarkOpacity=a),void 0!==o&&(this.watermarkPosition=o)},Ui.prototype.Replace_WaterMark_Canvas=function(e){this.waterMarkCanvas=e},Ui.prototype.Set_WaterMark_Flag=function(e){this.sharingDisplay.setWatermarkFlag(e?1:0)},Ui.prototype.Should_Watermark_Repeated=function(e,t){return this.isWaterMarkRepeatedEnable&&e>306&&t>202};var Li=function(e,t){if(e<640&&e){var r=640/e;e=640,t=Math.round(t*r)}return{width:e,height:t}};Ui.prototype.Update_Display_Watermark=function(e,t,r){if(!("function"==typeof OffscreenCanvas&&this.waterMarkCanvas instanceof OffscreenCanvas&&OffscreenCanvasRenderingContext2D)||OffscreenCanvasRenderingContext2D.prototype.measureText){var i=t<512||r<288?16:this.watermarkPosition,a=this.Should_Watermark_Repeated(t,r),n=Li(t,r);t=n.width,r=n.height;var o=a?this.WaterMarkRGBA.Get_Repeated_WaterMarkRGBA({canvas:this.waterMarkCanvas,name:this.sharingWaterMarkName,width:t,height:r,opacity:this.waterMarkOpacity,position:i}):this.WaterMarkRGBA.Get_WaterMarkRGBA({canvas:this.waterMarkCanvas,name:this.sharingWaterMarkName,width:t,height:r,opacity:this.waterMarkOpacity,position:i});e.updateWatermark(t,r,o)}},Ui.prototype.Should_Update_Watermark=function(e,t,r){if(!this.isCreateSharingWaterMark)return!1;var i=!1,a=Li(t,r);a.width===e.getWatermarkWidth()&&a.height===e.getWatermarkHeight()||(i=!0);var n=this.Should_Watermark_Repeated(t,r);e.isSetWatermark()||(i=!0),n!==e.isWatermarkRepeated()&&(i=!0,e.setWatermarkRepeated(n)),this.waterMarkOpacity&&this.waterMarkOpacity!==e.getWatermarkOpacity()&&(i=!0,e.setWatermarkOpacity(this.waterMarkOpacity));var o=t<512||r<288?16:this.watermarkPosition;return o!==e.getWatermarkPosition()&&(i=!0,e.setWatermarkPosition(o)),i},Ui.prototype.Update_Sharing_Canvas_Size=function(e){var t=e.width,r=e.height;this.SharingCanvasSizeInfo={width:Math.round(t),height:Math.round(r)}},Ui.prototype.ClearQueue=function(){try{var e,t=Ni(this.sharingQueue.ssrcQueueMap);try{for(t.s();!(e=t.n()).done;)for(var r=O()(e.value,2),i=(r[0],r[1]);!i.isEmpty();){var a=i.dequeue();a.yuvdata&&a.yuvdata instanceof bi.c&&a.yuvdata.recycle(),a.dataptr&&Module._free(a.dataptr)}}catch(e){t.e(e)}finally{t.f()}}catch(e){this.Log_Error("Exception from SharingRender.ClearQueue",e)}this.sharingQueue&&this.sharingQueue.ClearQueue(),this.mouseQueue&&this.mouseQueue.ClearQueue(),this.currentSharingHeight=0,this.currentSharingWidth=0,this.currentSharingLogicHeight=0,this.currentSharingLogicWidth=0},Ui.prototype.Get_Decoded_Sharing_Frame=function(e,t){if(!this.sharingQueue)return null;var r=this.GetLogicalSSRCPart(e,t),i=this.sharingQueue.GetQueue(r);return i?i.dequeue():null},Ui.prototype.Get_Decoded_Mouse_Frame=function(e,t){if(this.mouseQueue){var r=this.GetLogicalSSRCPart(e,t),i=this.mouseQueue.GetQueue(r);return i?i.dequeue():null}},Ui.prototype.Put_Sharing_Data_From_Queue=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;if(this.sharingQueue){var r=this.GetLogicalSSRCPart(e.ssrc,e.isFromMainSession);this.firstFrameForIOS||r!=this.currentshareactive>>10||(this.firstFrameForIOS=!0,this.Notify_APPUI?this.Notify_APPUI(M.FIRST_IOS_FRAME,this.currentshareactive):postMessage({status:x.o,ssrc:this.currentshareactive}));var i=this.sharingQueue.GetQueue(r);i||(i=this.sharingQueue.AddQueue(r)),i.enqueue(e),this.lfTimeStamp&&(this.sharingFps?this.sharingFps=500/(e.ntptime-this.lfTimeStamp)+this.sharingFps/2:this.sharingFps=1e3/(e.ntptime-this.lfTimeStamp)),this.sharingFps!=1/0&&this.sharingFps||(this.sharingFps=20),this.lfTimeStamp=e.ntptime;var a=this.sharingQueue.GetQueueLength(r),n=a-t;for(this.maxQueueLength=t;n>=0;){var o=this.Get_Decoded_Sharing_Frame(e.ssrc,e.isFromMainSession);o.yuvdata instanceof bi.c&&o.yuvdata.recycle(),o.dataptr&&Module._free(o.dataptr),n--}}},Ui.prototype.Get_Current_QueueLength=function(){if(this.sharingQueue){var e=this.currentshareactive,t=this.GetLogicalSSRCPart(e,this.isFromMainSession);return this.sharingQueue.GetQueueLength(t)}},Ui.prototype.Put_Mouse_Data_Into_Queue=function(e){if(this.mouseQueue){var t=this.GetLogicalSSRCPart(e.ssrc,e.isFromMainSession),r=this.mouseQueue.GetQueue(t);r||(r=this.mouseQueue.AddQueue(t)),r.enqueue(e);for(var i=this.mouseQueue.GetQueueLength(t)-10;i>=0;)this.Get_Decoded_Mouse_Frame(e.ssrc,e.isFromMainSession),i--}},Ui.prototype.GetLogicalSSRCPart=function(e,t){var r=e>>10;return t&&(r|=1<<23),r},Ui.prototype.SetcATimeStamp=function(e){this.cATimeStamp=e,this.asTime=performance.now()},Ui.prototype.Log_Error=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.globalTracingLogger?this.globalTracingLogger.error(e,t):Object(bi.f)(e,t)},Ui.prototype.setMode=function(e){this.Stop_Draw2(),this.renderMode=e},Ui.prototype.Start_Draw2=function(e){var t,r=this;null===(t=this.statisticObj)||void 0===t||t.start(),this.renderMode?(this.SharingRenderInterval&&(clearInterval(this.SharingRenderInterval),this.SharingRenderInterval=0),this.SharingRenderInterval=setInterval((function(){r.No_Bindthis_Interval()}),20)):(this.Start_Draw(),this.startRAFHealthCheck())},Ui.prototype.Stop_Draw2=function(e){var t;null===(t=this.statisticObj)||void 0===t||t.stop(),this.renderMode?this.SharingRenderInterval&&(clearInterval(this.SharingRenderInterval),this.SharingRenderInterval=0):(this.Stop_Draw(),this.stopRAFHealthCheck())},Ui.prototype.startRAFHealthCheck=function(){var e=this;this.RAFLastTime=performance.now(),this.RAFhealthCheckInterval=setInterval((function(){var t=performance.now();!e.renderMode&&t-e.RAFLastTime>2e3&&(e.Stop_Draw2(),e.setMode(x.F),e.Start_Draw2(),e.Log_Error("Sharing RAF Failed"))}),2e3)},Ui.prototype.stopRAFHealthCheck=function(){this.RAFLastTime=0,this.RAFhealthCheckInterval&&clearInterval(this.RAFhealthCheckInterval)};var Wi=Ui;function Bi(e,t){var r=Math.pow(10,t);return Math.floor(e*r)/r}function Gi(e,t){var r=Math.pow(10,t);return Math.ceil(e*r)/r}function Fi(e,t,r){if(!e||t<0||r<0)throw new Error("isDimensionsOverMaxDimension2DSize() invalid parameters. res=".concat(e,", width=").concat(t,", height=").concat(r));var i=!1,a=0,n=e.acquireGPUFeaturesHelper();return n&&(a=n.queryMaxTextureDimension2D())>0&&(i=t>a||r>a),i&&(console.log("isDimensionsOverMaxDimension2DSize() w:".concat(t," h:").concat(r," max:").concat(a)),Object(bi.d)("isDimensionsOverMaxDimension2DSize() w:".concat(t," h:").concat(r," max:").concat(a))),i}var Hi=new Map,ji=[];function Ki(e){e.preventDefault()}function qi(e,t,r,i,a,n,o){this.canvasElement=e,this.canvasID=t,this.contextOptions=a,this.textureindex=r||0,this.texturestride=this.textureindex?3:o?4:6,this.initmask=o||!1,this.reuse=!1,qi.prototype.ROTATION_CLOCK0=0,qi.prototype.ROTATION_CLOCK90=1,qi.prototype.ROTATION_CLOCK180=2,qi.prototype.ROTATION_CLOCK270=3,this.webGLResources=n,n||(this.initContextGL(),this.contextGL&&(this.webGLContextLostProtect(),this.contextGL.isContextLost()&&this.restoreContext())),this.reinit(n);var s=new ArrayBuffer(4);this.dummpyCursor=new Uint8Array(s),this.dummpyWaterMark=new Uint8Array(s),this.cursorWidth=0,this.cursorHeight=0,this.hasCursor=0,this.hasWaterMark=0,this.watermarkOpacity=.15,this.watermarkData=null,this.watermarkWidth=0,this.watermarkHeight=0,this.isMultiView=!1,this.hasWholeFrame=0,this.croppingParams={},this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.width=0,this.croppingParams.height=0,this.textureWidth=0,this.textureHeight=0,this.canvasWidth=0,this.canvasHeight=0,this.picRotation=-1,this.bgColor=[0,0,0],this.cx=0,this.cy=0,this.cw=0,this.ch=0,this.colorRange=-1,this.videoMode=x.T,this.rotation=this.ROTATION_CLOCK0,this.fillMode=0,this.fillModeForResolution=0}function Xi(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=e.contextGL,o=n.canvas.width,s=n.canvas.height;a&&(o=a.width,s=a.height);var u,d,c,l,h=i==e.ROTATION_CLOCK90||i==e.ROTATION_CLOCK270?r:t,f=i==e.ROTATION_CLOCK90||i==e.ROTATION_CLOCK270?t:r,p=h/f*s,v=f/h*o;p>o?(u=0,c=1,l=1-(d=(s-v)/2/s)):(d=0,l=1,c=1-(u=(o-p)/2/o)),u=2*u-1,c=2*c-1,d=1-2*d,l=1-2*l;var m=new Float32Array([c,d,u,d,c,l,u,l,c,d,u,d,c,l,u,l]);n.bindBuffer(n.ARRAY_BUFFER,e.vertexPosBuffer),n.bufferData(n.ARRAY_BUFFER,m,n.DYNAMIC_DRAW)}function Yi(e,t,r,i,a){var o=e.contextGL,s=i.top/r,u=i.left/t,d=s+(i.height-1)/r,c=u+i.width/t,l=[u,s,c,s,c,d,u,d];a==e.ROTATION_CLOCK90&&(l.unshift(l[6],l[7]),l=l.slice(0,8)),a==e.ROTATION_CLOCK180&&(l.unshift(l[4],l[5],l[6],l[7]),l=l.slice(0,8)),a==e.ROTATION_CLOCK270&&(l.push(l[0],l[1]),l=l.slice(2));var h=l[0],f=l[1];l[0]=l[2],l[1]=l[3],l[2]=h,l[3]=f;var p=new Float32Array([].concat(n()(l),[1,0,0,0,1,1,0,1]));o.bindBuffer(o.ARRAY_BUFFER,e.texturePosBuffer),o.bufferData(o.ARRAY_BUFFER,p,o.DYNAMIC_DRAW)}qi.prototype.reinit=function(e){if(this.webGLResources=e,!this.contextGL||this.contextGL.isContextLost()||this.contextGL.glInitSucceed||this.webGLResources){if(this.webGLResources&&this.webGLResources.contextgl&&!this.webGLResources.contextgl.isContextLost()){this.contextGL=this.webGLResources.contextgl,this.shaderProgram=this.webGLResources.program,this.waterMarkTextureRef=this.webGLResources.waterMarkTextureRef,this.repeatedWaterMarkTextureRef=this.webGLResources.repeatedWaterMarkTextureRef,this.initTextures(!1),this.vertexPosBuffer=this.webGLResources.vBuffer,this.texturePosBuffer=this.webGLResources.tBuffer;var t=this.contextGL.getError();this.contextGL.glInitSucceed=t!=this.contextGL.NO_ERROR&&t!=this.contextGL.CONTEXT_LOST_WEBGL?0:1}}else{this.initProgram(),this.initmask?this.initTextures(!1):this.initTextures(!0),this.initBuffers();var r=this.contextGL.getError();this.contextGL.glInitSucceed=r!=this.contextGL.NO_ERROR&&r!=this.contextGL.CONTEXT_LOST_WEBGL?0:1}},qi.prototype.webGLContextLostSimulate=function(){var e="undefined"==typeof window?self:window;e.webGLEXTSimulate=e.webGLEXTSimulate||[],e.webGLEXTSimulate.push(Object(bi.e)(this.contextGL,"WEBGL_lose_context")),console.log("\n    webGLEXTSimulate[0].loseContext()\n    webGLEXTSimulate[0].restoreContext()\n    ")},qi.prototype.restoreContext=function(){if(this.contextGL)try{var e,t;if(null!==(e=this.canvasElement)&&void 0!==e&&e.loseContextExtension&&this.contextGL.isContextLost())null===(t=this.canvasElement)||void 0===t||t.loseContextExtension.restoreContext()}catch(e){Object(bi.f)("restoreContext exception: ".concat(JSON.stringify(e)))}},qi.prototype.webgGLContextLostCallback=function(e){Object(bi.f)("webglcontextlost event: canvas listener size=".concat(ji.length,",  canvas id: ").concat(this.canvasID,", , ids:").concat(ji.join())),e.preventDefault(),this.contextGL.glInitSucceed=0,this.contextOptions&&this.contextOptions.webglcontextlostCallback&&this.contextOptions.webglcontextlostCallback(e,this.contextOptions.params)},qi.prototype.removeEventListener=function(e,t){if(e&&t){0,e.removeEventListener("webglcontextlost",t.contextLostHandler),e.removeEventListener("webglcontextrestored",t.contextRestoredHandler);var r=ji.indexOf(this.canvasID);ji.splice(r,1),Hi.delete(e)}},qi.prototype.webGLContextRestoredCallback=function(e){Object(bi.f)("webglcontextrestored event from canvas id: ".concat(this.canvasID)),this.reinit(),this.contextOptions&&this.contextOptions.webglcontextrestoredCallback&&this.contextOptions.webglcontextrestoredCallback(e,this.contextOptions.params)},qi.prototype.webGLContextLostProtect=function(){this.canvasElement&&!this.canvasElement.loseContextExtension&&(this.canvasElement.loseContextExtension=Object(bi.e)(this.contextGL,"WEBGL_lose_context"));var e=this.canvasElement,t=Hi.get(e);t&&this.removeEventListener(e,t),Hi.set(e,this),this.contextLostHandler=this.webgGLContextLostCallback.bind(this),this.contextRestoredHandler=this.webGLContextRestoredCallback.bind(this),e.addEventListener("webglcontextlost",this.contextLostHandler,{capture:!1}),e.addEventListener("webglcontextrestored",this.contextRestoredHandler,{capture:!1}),-1===ji.indexOf(this.canvasID)&&(ji.push(this.canvasID),ji.length>4&&Object(bi.f)("canvas listener size=".concat(ji.length,", ids:").concat(ji.join())))},qi.prototype.isWebGL=function(){return this.contextGL},qi.prototype.isAvaiable=function(){return this.contextGL&&!this.contextGL.isContextLost()&&this.contextGL.glInitSucceed},qi.prototype.initContextGL=function(){for(var e,t,r=this.canvasElement,i=null,a=["webgl","experimental-webgl","moz-webgl","webkit-3d"],n=0;!i&&n<a.length;){var o=a[n];try{i=this.contextOptions?r.getContext(o,this.contextOptions):r.getContext(o)}catch(e){i=null}i&&"function"==typeof i.getParameter||(i=null),++n}(this.contextGL=i,i)?i.glInitSucceed=0:Object(bi.b)("Failed when trying to get WebGLContext on canvas(".concat(null===(e=this.canvasElement)||void 0===e?void 0:e.width,",").concat(null===(t=this.canvasElement)||void 0===t?void 0:t.height,")"))},qi.prototype.initProgram=function(){var e=this.contextGL,t=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 masktexturePos;","varying vec2 textureCoord;","varying vec2 masktextureCoord;","void main()","{","gl_Position = vertexPos;","textureCoord = texturePos.xy;","masktextureCoord = masktexturePos.xy;","}"].join("\n"),r=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 masktextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform sampler2D cursorSampler;","uniform sampler2D waterMarkSampler;","uniform sampler2D  previewVideoSampler;","uniform sampler2D maskSampler;","uniform vec4 cursorInfo;","uniform int onlyRGBA;","uniform int bgraMode;","uniform int colorRange;","uniform int waterMarkFlag;","uniform int cursorFlag;","uniform int maskFlag;","uniform int yuvmode;","const mat4 YUV2RGB_L = mat4","(","1.1643828125, 0, 1.59602734375, -.87078515625,","1.1643828125, -.39176171875, -.81296875, .52959375,","1.1643828125, 2.017234375, 0, -1.081390625,","0, 0, 0, 1",");","const mat4 YUV2RGB_F = mat4","(","1.0, 0, 1.402, -.701,","1.0, -.34413, -.71414, .529135,","1.0, 1.772, 0, -.886,","0, 0, 0, 1",");","void main(void) {","vec4 c;","if(waterMarkFlag!=1) {","if(onlyRGBA==0){","highp float y = texture2D(ySampler,  textureCoord).r;","highp float u;","highp float v;","if(yuvmode==1){","u = texture2D(uSampler,  textureCoord).r;","v = texture2D(vSampler,  textureCoord).r;","}","else{","u = texture2D(uSampler,  textureCoord).r;","v = texture2D(uSampler,  textureCoord).a;","}","if (colorRange == 0)","{","  c = vec4(y, u, v, 1) * YUV2RGB_L;","} else {","  c = vec4(y, u, v, 1) * YUV2RGB_F;","}","if(cursorFlag==1)","{","if (cursorInfo.z > 0.0 && textureCoord.x >= cursorInfo.x && textureCoord.y >= cursorInfo.y && ","    textureCoord.x < cursorInfo.x+cursorInfo.z && textureCoord.y < cursorInfo.y+cursorInfo.w ){"," vec2 cursorCoord = textureCoord - cursorInfo.xy;"," cursorCoord /= cursorInfo.zw;"," vec4 cursor = texture2D(cursorSampler, cursorCoord);"," c = c*(1.0-cursor.a) + cursor*cursor.a;","}","}","}","else{"," c = texture2D(previewVideoSampler, textureCoord);","if(bgraMode==1)","{"," c = vec4(c.b, c.g, c.r, c.a);","}","}","}","if(waterMarkFlag==1)","{"," c = texture2D(waterMarkSampler, textureCoord);","if(c.r == 0.0 && c.g == 0.0 && c.b == 0.0){"," c.a = 0.0;","}","}","if(maskFlag==1 && waterMarkFlag!=1)","{","vec4 mask = texture2D(maskSampler, masktextureCoord);","if(mask.r != 0.0 || mask.g != 0.0 || mask.b != 0.0){","c = mask* mask.a+ c*(1.0-mask.a);","}","}","if (waterMarkFlag!=1){","c.a = 1.0;","}","gl_FragColor = c;","}"].join("\n"),i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||e.isContextLost()||console.log("Vertex shader failed to compile: "+e.getShaderInfoLog(i));var a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,r),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)||e.isContextLost()||console.log("Fragment shader failed to compile: "+e.getShaderInfoLog(a));var n=e.createProgram();e.attachShader(n,i),e.attachShader(n,a),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)||e.isContextLost()||console.log("Program failed to compile: "+e.getProgramInfoLog(n)),e.useProgram(n),this.shaderProgram=n},qi.prototype.initBuffers=function(){var e=this.contextGL,t=this.shaderProgram,r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1,1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var i=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),this.vertexPosBuffer=r;var a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1,1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var n=e.getAttribLocation(t,"texturePos");if(e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),this.initmask&&!this.masktexturePosBuffer){var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var s=e.getAttribLocation(t,"masktexturePos");e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),this.masktexturePosBuffer=o}this.texturePosBuffer=a},qi.prototype.initTextures=function(e){var t=this.contextGL,r=this.shaderProgram;t.pixelStorei(t.UNPACK_ALIGNMENT,1);var i=this.initTexture();this.yTextureRef=i,this.oyTextureRef=i;var a=this.initTexture();this.uTextureRef=a,this.ouTextureRef=a;var n=this.initTexture();if(this.vTextureRef=n,this.ovTextureRef=n,e){this.BindTextures(x.S);var o=this.initTexture(),s=t.getUniformLocation(r,"cursorSampler");t.uniform1i(s,this.textureindex*this.texturestride+3),this.cursorTextureRef=o;var u=this.initTexture(),d=t.getUniformLocation(r,"waterMarkSampler");t.uniform1i(d,4),this.waterMarkTextureRef=u;var c=this.initTexture();this.repeatedWaterMarkTextureRef=c;var l=this.initTexture(),h=t.getUniformLocation(r,"previewVideoSampler");t.uniform1i(h,this.textureindex*this.texturestride+5),this.previewVideoTextureRef=l;var f=t.getUniformLocation(r,"cursorInfo");this.cursorInfoRef=f}if(this.initmask){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1);var p=this.initTexture(),v=t.getUniformLocation(r,"maskSampler");t.uniform1i(v,this.textureindex*this.texturestride+6),this.maskTextureRef=p}var m=t.getUniformLocation(r,"colorRange");this.colorRangeRef=m,this.onlyRGBARef=t.getUniformLocation(r,"onlyRGBA"),this.bgraModeRef=t.getUniformLocation(r,"bgraMode"),this.waterMarkFlagRef=t.getUniformLocation(r,"waterMarkFlag"),this.maskFlagRef=t.getUniformLocation(r,"maskFlag"),this.cursorFlagRef=t.getUniformLocation(r,"cursorFlag"),this.yuvmodeRef=t.getUniformLocation(r,"yuvmode")},qi.prototype.BindTextures=function(e){var t=this.contextGL,r=this.shaderProgram;if(t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.activeTexture(t.TEXTURE0+0),t.bindTexture(t.TEXTURE_2D,this.yTextureRef),t.activeTexture(t.TEXTURE0+1),t.bindTexture(t.TEXTURE_2D,this.uTextureRef),t.activeTexture(t.TEXTURE0+2),t.bindTexture(t.TEXTURE_2D,this.vTextureRef),e==x.S){var i=t.getUniformLocation(r,"ySampler");t.uniform1i(i,0);var a=t.getUniformLocation(r,"uSampler");t.uniform1i(a,1);var n=t.getUniformLocation(r,"vSampler");t.uniform1i(n,2)}else if(this.isRGBAMode(e)){var o=t.getUniformLocation(r,"previewVideoSampler");t.uniform1i(o,0);var s=t.getUniformLocation(r,"ySampler");t.uniform1i(s,0);var u=t.getUniformLocation(r,"uSampler");t.uniform1i(u,0);var d=t.getUniformLocation(r,"vSampler");t.uniform1i(d,0)}else if(e==x.U){var c=t.getUniformLocation(r,"ySampler");t.uniform1i(c,0);var l=t.getUniformLocation(r,"uSampler");t.uniform1i(l,1);var h=t.getUniformLocation(r,"vSampler");t.uniform1i(h,0)}var f=t.getUniformLocation(r,"previewVideoSampler");t.uniform1i(f,0);var p=t.getUniformLocation(r,"maskSampler");this.initmask?(t.activeTexture(t.TEXTURE0+6),t.bindTexture(t.TEXTURE_2D,this.maskTextureRef),t.uniform1i(p,6)):t.uniform1i(p,0);var v=t.getUniformLocation(r,"cursorSampler");t.uniform1i(v,0);var m=t.getUniformLocation(this.shaderProgram,"waterMarkSampler");t.uniform1i(m,0)},qi.prototype.initTexture=function(){var e=this.contextGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t},qi.prototype.clearDisplay=function(){var e=this.contextGL;e&&(e.enable(e.BLEND),e.blendFunc(e.ZERO,e.ZERO)),this.render()},qi.prototype.cleanup=function(e){var t=this.canvasElement,r=Hi.get(t);if(r&&this.removeEventListener(t,r),t.defaultContextLostHandler||(t.defaultContextLostHandler=Ki,t.addEventListener("webglcontextlost",Ki,{capture:!1})),this.isAvaiable()){var i=this.contextGL;i.deleteProgram(this.program),i.activeTexture(i.TEXTURE0+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE1+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE2+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),this.textureindex||this.initmask||(i.activeTexture(i.TEXTURE3+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE4+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(this.getRepeatedWatermarkTextureValue(i)),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE5+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null)),i.bindBuffer(i.ARRAY_BUFFER,null),i.deleteTexture(this.yTextureRef),i.deleteTexture(this.uTextureRef),i.deleteTexture(this.vTextureRef),this.textureindex||this.initmask||(i.deleteTexture(this.cursorTextureRef),i.deleteTexture(this.waterMarkTextureRef),i.deleteTexture(this.repeatedWaterMarkTextureRef),i.deleteTexture(this.previewVideoTextureRef),i.deleteBuffer(this.vertexPosBuffer),i.deleteBuffer(this.texturePosBuffer)),this.maskTextureRef&&i.deleteTexture(this.maskTextureRef),this.masktexturePosBuffer&&i.deleteBuffer(this.masktexturePosBuffer),i.glInitSucceed=0}},qi.prototype.drawNextOutputPicture=function(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=this.contextGL;n?this.drawNextOutputPictureFrame(e,t,r,i,a):this.drawNextOuptutPictureRGBA(e,t,r,i)},qi.prototype.updateVertexInfoForMultiView=function(e,t,r,i,a){var n,o,s,u,d=this.contextGL;if(this.isUseFillMode({width:r,height:i,rotation:a}))n=0,o=0,s=1,u=1;else{var c=a==this.ROTATION_CLOCK90||a==this.ROTATION_CLOCK270?i:r,l=a==this.ROTATION_CLOCK90||a==this.ROTATION_CLOCK270?r:i,h=c/l*t;h>e?(n=0,s=1,u=1-(o=(t-l/c*e)/2/t)):(o=0,u=1,s=1-(n=(e-h)/2/e))}n=2*n-1,s=2*s-1,o=1-2*o,u=1-2*u;var f=new Float32Array([s,o,n,o,s,u,n,u,1,1,-1,1,1,-1,-1,-1]);d.bindBuffer(d.ARRAY_BUFFER,this.vertexPosBuffer),d.bufferData(d.ARRAY_BUFFER,f,d.DYNAMIC_DRAW)},qi.prototype.updateTextureInfoForMultiView=function(e,t,r,i,a,o,s){var u,d,c,l,h=this.contextGL;if(this.isUseFillMode({width:r.width,height:r.height,rotation:i})){var f=i==this.ROTATION_CLOCK90||i==this.ROTATION_CLOCK270?s/o:o/s,p=r.left||0,v=r.top||0;if(r.width/r.height>f){var m=r.height*f;u=v/t,d=(Math.round((r.width-m)/2)+p)/e,c=u+(r.height-1)/t,l=d+m/e}else{var g=r.width/f;c=(u=(Math.round((r.height-g)/2)+v)/t)+(g-1)/t,l=(d=p/e)+r.width/e}}else u=Gi(r.top/t,2),d=Gi(r.left/e,2),c=Bi((r.top+r.height-1)/t,2),l=Bi((r.width-1+r.left)/e,2);var _=[d,u,l,u,l,c,d,c];i==this.ROTATION_CLOCK90&&(_.unshift(_[6],_[7]),_=_.slice(0,8)),i==this.ROTATION_CLOCK180&&(_.unshift(_[4],_[5],_[6],_[7]),_=_.slice(0,8)),i==this.ROTATION_CLOCK270&&(_.unshift(_[6],_[7]),(_=_.slice(0,8))[0]=1-_[0],_[2]=1-_[2],_[4]=1-_[4],_[6]=1-_[6]);var S=_[0],E=_[1];_[0]=_[2],_[1]=_[3],_[2]=S,_[3]=E,a&&(_[0]=1-_[0],_[2]=1-_[2],_[4]=1-_[4],_[6]=1-_[6]);var b=new Float32Array([].concat(n()(_),[1,0,0,0,1,1,0,1]));h.bindBuffer(h.ARRAY_BUFFER,this.texturePosBuffer),h.bufferData(h.ARRAY_BUFFER,b,h.DYNAMIC_DRAW)},qi.prototype.drawNextOutputPictureFrame=function(e,t,r,i,a){var n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];if(this.isAvaiable()){var u=this.contextGL,d=(this.texturePosBuffer,this.yTextureRef),c=this.uTextureRef,l=this.vTextureRef;u.enable(u.BLEND),u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA),a=a||this.ROTATION_CLOCK0;var h=(r=r||{top:0,left:0,width:e,height:t}).width!=this.croppingParams.width||r.height!=this.croppingParams.height,f=r.top!=this.croppingParams.top||r.left!=this.croppingParams.left,p=u.canvas.width!=this.canvasWidth||u.canvas.height!=this.canvasHeight,v=e!=this.textureWidth||t!=this.textureHeight,m=a!=this.picRotation;(h||p||m)&&Xi(this,r.width,r.height,a,o),(h||f||v||m)&&Yi(this,e,t,r,a);var g=n?0:1;g!=this.colorRange&&(u.uniform1i(this.colorRangeRef,g),this.colorRange=g),o?u.viewport(o.x,o.y,o.width,o.height):u.viewport(0,0,u.canvas.width,u.canvas.height),u.uniform1i(this.onlyRGBARef,0),u.uniform1i(this.yuvmodeRef,x.S),Object.assign(this.croppingParams,r),this.textureWidth=e,this.textureHeight=t,this.picRotation=a,this.canvasWidth=u.canvas.width,this.canvasHeight=u.canvas.height,u.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),u.clear(u.COLOR_BUFFER_BIT);var _=i,S=e*t;if(u.activeTexture(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,d),s){var E=_.subarray(0,S);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,e,t,0,u.LUMINANCE,u.UNSIGNED_BYTE,E)}var b=e/2*t/2;if(u.activeTexture(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,c),s){var y=_.subarray(S,S+b);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,e/2,t/2,0,u.LUMINANCE,u.UNSIGNED_BYTE,y)}var C=b;if(u.activeTexture(u.TEXTURE2),u.bindTexture(u.TEXTURE_2D,l),s){var A=_.subarray(S+b,S+b+C);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,e/2,t/2,0,u.LUMINANCE,u.UNSIGNED_BYTE,A)}u.activeTexture(u.TEXTURE3),u.bindTexture(u.TEXTURE_2D,this.cursorTextureRef),this.hasCursor?u.uniform1i(this.cursorFlagRef,1):s&&u.texImage2D(u.TEXTURE_2D,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,this.dummpyCursor),u.uniform4f(this.cursorInfoRef,this.cx,this.cy,this.cw,this.ch),u.activeTexture(u.TEXTURE5),u.bindTexture(u.TEXTURE_2D,this.previewVideoTextureRef),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,this.dummpyWaterMark);var R=u.getUniformLocation(this.shaderProgram,"maskSampler");u.uniform1i(R,5),this.render(),this.hasWholeFrame=1}},qi.prototype.updateTextureBlock=function(e,t,r,i,a){if(this.isAvaiable()){var n=this.contextGL,o=a;if(!(!this.hasWholeFrame||e<=0||t<=0||r<0||i<0||r+e>this.textureWidth||i+t>this.textureHeight)&&a&&a.length==e*t*3/2){var s=this.yTextureRef,u=this.uTextureRef,d=this.vTextureRef,c=e*t,l=o.subarray(0,c);n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,s),n.texSubImage2D(n.TEXTURE_2D,0,r,i,e,t,n.LUMINANCE,n.UNSIGNED_BYTE,l);var h=e/2*t/2,f=o.subarray(c,c+h);n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,u),n.texSubImage2D(n.TEXTURE_2D,0,r/2,i/2,e/2,t/2,n.LUMINANCE,n.UNSIGNED_BYTE,f);var p=h,v=o.subarray(c+h,c+h+p);n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,d),n.texSubImage2D(n.TEXTURE_2D,0,r/2,i/2,e/2,t/2,n.LUMINANCE,n.UNSIGNED_BYTE,v)}}},qi.prototype.updateCursor=function(e,t,r){if(this.isAvaiable()){var i=this.contextGL;e<=0||t<=0||!r||r.length!=e*t*4||(i.activeTexture(i.TEXTURE3),i.bindTexture(i.TEXTURE_2D,this.cursorTextureRef),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,r),this.cursorWidth=e,this.cursorHeight=t,this.hasCursor=1)}},qi.prototype.updateWatermark=function(e,t,r){if(this.isAvaiable()){this.contextGL;e<=0||t<=0||!r||r.length!=e*t*4||(this.watermarkData=r,this.watermarkWidth=e,this.watermarkHeight=t,this.hasWaterMark=1)}},qi.prototype.drawWatermark=function(){if(this.isAvaiable()){var e=this.contextGL;if(this.isSetWatermark()&&this.watermarkData&&this.watermarkWidth&&this.watermarkHeight){e.uniform1i(this.waterMarkFlagRef,1),this.isWatermarkRepeated()?(e.activeTexture(this.getRepeatedWatermarkTextureValue(e)),e.bindTexture(e.TEXTURE_2D,this.repeatedWaterMarkTextureRef)):(e.activeTexture(e.TEXTURE4),e.bindTexture(e.TEXTURE_2D,this.waterMarkTextureRef)),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.watermarkWidth,this.watermarkHeight,0,e.RGBA,e.UNSIGNED_BYTE,this.watermarkData);var t=e.getUniformLocation(this.shaderProgram,"waterMarkSampler");e.uniform1i(t,this.isWatermarkRepeated()?this.getRepeatedWatermarkUniformValue():4),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLE_STRIP,4,4)}}},qi.prototype.render=function(){if(this.isAvaiable()){var e=this.contextGL;e.uniform1i(this.waterMarkFlagRef,0),e.drawArrays(e.TRIANGLE_STRIP,0,4),this.drawWatermark()}},qi.prototype.drawCursor=function(e,t,r,i,a){if(this.isAvaiable()){var n=this.contextGL;if(!(!this.hasWholeFrame||e&&(i<0||a<0))){n.viewport(0,0,n.canvas.width,n.canvas.height);var o=this.yTextureRef,s=this.uTextureRef,u=this.vTextureRef,d=this.cursorTextureRef;if(n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,s),n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,u),n.activeTexture(n.TEXTURE3),n.bindTexture(n.TEXTURE_2D,d),e&&this.hasCursor){var c=t/this.croppingParams.width,l=r/this.croppingParams.height,h=i/this.croppingParams.width,f=a/this.croppingParams.height;this.cx=c,this.cy=l,this.cw=h,this.ch=f,n.uniform4f(this.cursorInfoRef,c,l,h,f)}else n.uniform4f(this.cursorInfoRef,0,0,0,0);this.render()}}},qi.prototype.clear=function(){this.hasWholeFrame=0,this.hasCursor=0},qi.prototype.clearCanvas=function(e){if(this.isAvaiable()){var t=this.contextGL;e?t.clearColor(e.R,e.G,e.B,e.A):t.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),t.clear(t.COLOR_BUFFER_BIT)}},qi.prototype.drawNextOuptutPictureRGBA=function(e,t,r,i){if(this.isAvaiable()){var a=i,n=this.canvasElement.getContext("2d"),o=n.getImageData(0,0,e,t);o.data.set(a),n.putImageData(o,0,0)}},qi.prototype.isRGBAMode=function(e){return-1!==[x.W,x.O].indexOf(e)},qi.prototype.updateRemoteVideoTextures=function(e,t,r,i,a){var n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if(this.isAvaiable()){var s=this.contextGL,u=this.yTextureRef,d=this.uTextureRef,c=this.vTextureRef;s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA);var l=this.isRGBAMode(this.videoMode);if(e<=0||t<=0||!i||!i.length||i.length!=e*t*3/2&&!l||r&&(r.top<0||r.left<0||r.left+r.width>e||r.top+r.height>t))return!1;var h=n?0:1;if(this.colorRange=h,this.rotation=a,Object.assign(this.croppingParams,r),this.textureWidth=e,this.textureHeight=t,this.canvasWidth=s.canvas.width,this.canvasHeight=s.canvas.height,o){if(s.bindTexture(s.TEXTURE_2D,u),!l){var f=i,p=e*t,v=f.subarray(0,p);s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e,t,0,s.LUMINANCE,s.UNSIGNED_BYTE,v);var m=0,g=0;this.videoMode==x.S?g=m=e/2*t/2:this.videoMode==x.U&&(m=e*t/2,g=0);var _=f.subarray(p,p+m);if(s.bindTexture(s.TEXTURE_2D,d),g){s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e/2,t/2,0,s.LUMINANCE,s.UNSIGNED_BYTE,_);var S=f.subarray(p+m,p+m+g);s.bindTexture(s.TEXTURE_2D,c),s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e/2,t/2,0,s.LUMINANCE,s.UNSIGNED_BYTE,S)}else s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE_ALPHA,e/2,t/2,0,s.LUMINANCE_ALPHA,s.UNSIGNED_BYTE,_);return!0}s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,t,0,s.RGBA,s.UNSIGNED_BYTE,i)}}},qi.prototype.updateRemoteVideoTexturesImageBitmap=function(e,t,r,i,a){var n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(!(e<=0||t<=0)&&r&&this.isAvaiable()){var o=this.contextGL;if(this.textureWidth=e,this.textureHeight=t,Number.isNaN(a)||(this.rotation=a),Object.assign(this.croppingParams,i),n){o.bindTexture(o.TEXTURE_2D,this.yTextureRef);var s=0,u=o.RGBA,d=o.RGBA,c=o.UNSIGNED_BYTE;o.texImage2D(o.TEXTURE_2D,s,u,d,c,r)}}},qi.prototype.updateSelfMaskImage=function(e,t,r){if(!(e<=0||t<=0)&&r&&r.length==e*t*4&&this.isAvaiable()){var i=this.contextGL;i.bindTexture(i.TEXTURE_2D,this.maskTextureRef),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,r)}},qi.prototype.VideoFlip=function(){if(this.isAvaiable()){var e=this.contextGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1)}},qi.prototype.drawRemoteVideo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isAvaiable()){var r=this.contextGL,i=this.isRGBAMode(this.videoMode)?1:0;r.uniform1i(this.colorRangeRef,this.colorRange),this.setUniformFlag(i,this.hasCursor,this.videoMode),this.initmask&&r.uniform1i(this.maskFlagRef,1),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,t,e.width,e.height),r.viewport(e.x,e.y,e.width,e.height),this.updateVertexInfoForMultiView(e.width,e.height,this.croppingParams.width,this.croppingParams.height,this.rotation),this.BindTextures(this.videoMode),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),this.render()}},qi.prototype.readPixelsSyncRequest=function(e,t,r,i){if(this.isAvaiable()){var a,n=this.contextGL;return this.destination&&this.destination.length==r*i*4||(this.destination=new Uint8Array(r*i*4)),a=this.destination,n.flush(),n.readPixels(e,t,r,i,n.RGBA,n.UNSIGNED_BYTE,a),a}},qi.prototype.updateSelfVideoTextures=function(e,t,r,i){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(!(e<=0||t<=0)&&r&&r.length%4==0&&this.isAvaiable()){var n=this.contextGL;this.textureWidth=e,this.textureHeight=t,this.rotation=this.ROTATION_CLOCK0,Object.assign(this.croppingParams,i),a&&(n.bindTexture(n.TEXTURE_2D,this.yTextureRef),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,t,0,n.RGBA,n.UNSIGNED_BYTE,r))}},qi.prototype.drawSelfVideo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.isAvaiable()){var i=this.contextGL;this.setUniformFlag(1,this.hasCursor,this.videoMode),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,r,e.width,e.height),i.viewport(e.x,e.y,e.width,e.height),t?(i.enable(i.BLEND),i.blendFunc(i.ZERO,i.ZERO),this.updateVertexInfoForMultiView(e.width,e.height,e.width,e.height,this.ROTATION_CLOCK0)):(i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),this.updateVertexInfoForMultiView(e.width,e.height,this.croppingParams.width,this.croppingParams.height,this.rotation)),this.BindTextures(x.W),this.render()}},qi.prototype.isSetWatermark=function(){return this.hasWaterMark},qi.prototype.recoverTextures=function(){},qi.prototype.setWatermarkFlag=function(e){this.hasWaterMark=e,e||(this.setWatermarkRepeated(!1),this.setWatermarkOpacity(),this.setWatermarkPosition(16))},qi.prototype.setUniformFlag=function(e,t,r){if(this.isAvaiable()){var i=this.contextGL;i.uniform1i(this.onlyRGBARef,e),i.uniform1i(this.bgraModeRef,e&&r===x.O?1:0),i.uniform1i(this.cursorFlagRef,t),e||i.uniform1i(this.yuvmodeRef,r)}},qi.prototype.setVideoMode=function(e){this.videoMode=e},qi.prototype.getVideoMode=function(e){return this.videoMode},qi.prototype.setWatermarkRepeated=function(e){this.watermarkRepeated=e},qi.prototype.isWatermarkRepeated=function(){return!!this.watermarkRepeated},qi.prototype.setWatermarkOpacity=function(e){this.watermarkOpacity=e||.15},qi.prototype.getWatermarkOpacity=function(){return this.watermarkOpacity},qi.prototype.setWatermarkPosition=function(e){this.watermarkPosition=e||16},qi.prototype.getWatermarkPosition=function(){return this.watermarkPosition},qi.prototype.setMultiView=function(e){return this.isMultiView=e},qi.prototype.getRepeatedWatermarkUniformValue=function(){return this.isMultiView?30:7},qi.prototype.getRepeatedWatermarkTextureValue=function(e){return this.isMultiView?e.TEXTURE30:e.TEXTURE7},qi.prototype.setFillMode=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.fillMode=e,this.fillModeForResolution=t},qi.prototype.getFillMode=function(){return this.fillMode},qi.prototype.getFillModeForResolution=function(){return this.fillModeForResolution},qi.prototype.getTextureIndex=function(){return this.textureindex},qi.prototype.getTextureWidth=function(){return this.textureWidth},qi.prototype.getTextureHeight=function(){return this.textureHeight},qi.prototype.getCroppingParams=function(){return this.croppingParams},qi.prototype.getIndex=function(){return this.textureindex},qi.prototype.getWatermarkWidth=function(){return this.watermarkWidth},qi.prototype.getWatermarkHeight=function(){return this.watermarkHeight},qi.prototype.getWatermarkOpacity=function(){return this.watermarkOpacity},qi.prototype.getAttachedCanvas=function(){return this.canvasElement},qi.prototype.resizeCanvasTo=function(e,t){this.contextGL.canvas.width=e,this.contextGL.canvas.height=t},qi.prototype.isUseFillMode=function(e){var t=e.width,r=e.height,i=e.rotation;if(!this.fillMode)return!1;if(!this.fillModeForResolution)return!0;if(!t||!r)return!1;var a=i===this.ROTATION_CLOCK90||i==this.ROTATION_CLOCK270?r/t:t/r;return(Array.isArray(this.fillModeForResolution)?this.fillModeForResolution:[this.fillModeForResolution]).some((function(e){return Math.abs(a-e)<.01}))};var zi=qi,Qi=new Map,Ji=[];function Zi(e){e.preventDefault()}function $i(e,t,r,i,a,n,o){this.canvasElement=e,this.canvasID=t,this.contextOptions=a,this.textureindex=r||0,this.texturestride=this.textureindex?3:o?4:6,this.initmask=o||!1,this.reuse=!1,$i.prototype.ROTATION_CLOCK0=0,$i.prototype.ROTATION_CLOCK90=1,$i.prototype.ROTATION_CLOCK180=2,$i.prototype.ROTATION_CLOCK270=3,this.webGLResources=n,n||(this.initContextGL(),this.contextGL&&(this.webGLContextLostProtect(),this.contextGL.isContextLost()&&this.restoreContext())),this.reinit(n);var s=new ArrayBuffer(4);this.dummpyCursor=new Uint8Array(s),this.dummpyWaterMark=new Uint8Array(s),this.cursorWidth=0,this.cursorHeight=0,this.hasCursor=0,this.hasWaterMark=0,this.watermarkOpacity=.15,this.watermarkData=null,this.watermarkWidth=0,this.watermarkHeight=0,this.isMultiView=!1,this.hasWholeFrame=0,this.croppingParams={},this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.width=0,this.croppingParams.height=0,this.textureWidth=0,this.textureHeight=0,this.canvasWidth=0,this.canvasHeight=0,this.picRotation=-1,this.bgColor=[0,0,0],this.cx=0,this.cy=0,this.cw=0,this.ch=0,this.colorRange=-1,this.videoMode=x.T,this.rotation=this.ROTATION_CLOCK0,this.fillMode=0,this.fillModeForResolution=0}function ea(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=e.contextGL,o=n.canvas.width,s=n.canvas.height;a&&(o=a.width,s=a.height);var u,d,c,l,h=i==e.ROTATION_CLOCK90||i==e.ROTATION_CLOCK270?r:t,f=i==e.ROTATION_CLOCK90||i==e.ROTATION_CLOCK270?t:r,p=h/f*s,v=f/h*o;p>o?(u=0,c=1,l=1-(d=(s-v)/2/s)):(d=0,l=1,c=1-(u=(o-p)/2/o)),u=2*u-1,c=2*c-1,d=1-2*d,l=1-2*l;var m=new Float32Array([c,d,u,d,c,l,u,l,c,d,u,d,c,l,u,l]);n.bindBuffer(n.ARRAY_BUFFER,e.vertexPosBuffer),n.bufferData(n.ARRAY_BUFFER,m,n.DYNAMIC_DRAW)}function ta(e,t,r,i,a){var o=e.contextGL,s=i.top/r,u=i.left/t,d=s+(i.height-1)/r,c=u+i.width/t,l=[u,s,c,s,c,d,u,d];a==e.ROTATION_CLOCK90&&(l.unshift(l[6],l[7]),l=l.slice(0,8)),a==e.ROTATION_CLOCK180&&(l.unshift(l[4],l[5],l[6],l[7]),l=l.slice(0,8)),a==e.ROTATION_CLOCK270&&(l.push(l[0],l[1]),l=l.slice(2));var h=l[0],f=l[1];l[0]=l[2],l[1]=l[3],l[2]=h,l[3]=f;var p=new Float32Array([].concat(n()(l),[1,0,0,0,1,1,0,1]));o.bindBuffer(o.ARRAY_BUFFER,e.texturePosBuffer),o.bufferData(o.ARRAY_BUFFER,p,o.DYNAMIC_DRAW)}$i.prototype.reinit=function(e){if(this.webGLResources=e,!this.contextGL||this.contextGL.isContextLost()||this.contextGL.glInitSucceed||this.webGLResources){if(this.webGLResources&&this.webGLResources.contextgl&&!this.webGLResources.contextgl.isContextLost()){this.contextGL=this.webGLResources.contextgl,this.shaderProgram=this.webGLResources.program,this.waterMarkTextureRef=this.webGLResources.waterMarkTextureRef,this.repeatedWaterMarkTextureRef=this.webGLResources.repeatedWaterMarkTextureRef,this.initTextures(!1),this.vertexPosBuffer=this.webGLResources.vBuffer,this.texturePosBuffer=this.webGLResources.tBuffer;var t=this.contextGL.getError();this.contextGL.glInitSucceed=t!=this.contextGL.NO_ERROR&&t!=this.contextGL.CONTEXT_LOST_WEBGL?0:1}}else{this.initProgram(),this.initmask?this.initTextures(!1):this.initTextures(!0),this.initBuffers();var r=this.contextGL.getError();this.contextGL.glInitSucceed=r!=this.contextGL.NO_ERROR&&r!=this.contextGL.CONTEXT_LOST_WEBGL?0:1}},$i.prototype.webGLContextLostSimulate=function(){var e="undefined"==typeof window?self:window;e.webGLEXTSimulate=e.webGLEXTSimulate||[],e.webGLEXTSimulate.push(Object(bi.e)(this.contextGL,"WEBGL_lose_context")),console.log("\n    webGLEXTSimulate[0].loseContext()\n    webGLEXTSimulate[0].restoreContext()\n    ")},$i.prototype.restoreContext=function(){if(this.contextGL)try{var e,t;if(null!==(e=this.canvasElement)&&void 0!==e&&e.loseContextExtension&&this.contextGL.isContextLost())null===(t=this.canvasElement)||void 0===t||t.loseContextExtension.restoreContext()}catch(e){Object(bi.f)("restoreContext exception: ".concat(JSON.stringify(e)))}},$i.prototype.webgGLContextLostCallback=function(e){Object(bi.f)("webgl2contextlost event: canvas listener size=".concat(Ji.length,",  canvas id: ").concat(this.canvasID,", , ids:").concat(Ji.join())),e.preventDefault(),this.contextGL.glInitSucceed=0,this.contextOptions&&this.contextOptions.webglcontextlostCallback&&this.contextOptions.webglcontextlostCallback(e,this.contextOptions.params)},$i.prototype.removeEventListener=function(e,t){if(e&&t){0,e.removeEventListener("webglcontextlost",t.contextLostHandler),e.removeEventListener("webglcontextrestored",t.contextRestoredHandler);var r=Ji.indexOf(this.canvasID);Ji.splice(r,1),Qi.delete(e)}},$i.prototype.webGLContextRestoredCallback=function(e){Object(bi.f)("webgl2contextrestored event from canvas id: ".concat(this.canvasID)),this.reinit(),this.contextOptions&&this.contextOptions.webglcontextrestoredCallback&&this.contextOptions.webglcontextrestoredCallback(e,this.contextOptions.params)},$i.prototype.webGLContextLostProtect=function(){this.canvasElement&&!this.canvasElement.loseContextExtension&&(this.canvasElement.loseContextExtension=Object(bi.e)(this.contextGL,"WEBGL_lose_context"));var e=this.canvasElement,t=Qi.get(e);t&&this.removeEventListener(e,t),Qi.set(e,this),this.contextLostHandler=this.webgGLContextLostCallback.bind(this),this.contextRestoredHandler=this.webGLContextRestoredCallback.bind(this),e.addEventListener("webglcontextlost",this.contextLostHandler,{capture:!1}),e.addEventListener("webglcontextrestored",this.contextRestoredHandler,{capture:!1}),-1===Ji.indexOf(this.canvasID)&&(Ji.push(this.canvasID),Ji.length>4&&Object(bi.f)("canvas listener size=".concat(Ji.length,", ids:").concat(Ji.join())))},$i.prototype.isWebGL2=function(){return this.contextGL},$i.prototype.isAvaiable=function(){return this.contextGL&&!this.contextGL.isContextLost()&&this.contextGL.glInitSucceed},$i.prototype.initContextGL=function(){for(var e,t,r=this.canvasElement,i=null,a=["webgl2"],n=0;!i&&n<a.length;){var o=a[n];try{i=this.contextOptions?r.getContext(o,this.contextOptions):r.getContext(o)}catch(e){i=null}i&&"function"==typeof i.getParameter||(i=null),++n}(this.contextGL=i,i)?i.glInitSucceed=0:Object(bi.b)("Failed when trying to get WebGLContext on canvas(".concat(null===(e=this.canvasElement)||void 0===e?void 0:e.width,",").concat(null===(t=this.canvasElement)||void 0===t?void 0:t.height,")"))},$i.prototype.initProgram=function(){var e=this.contextGL,t=e.createShader(e.VERTEX_SHADER);e.shaderSource(t,"#version 300 es\n    in vec4 vertexPos;\n    in vec4 texturePos;\n    in vec4 masktexturePos;\n    out vec2 textureCoord;\n    out vec2 masktextureCoord;\n\n    void main() {\n      gl_Position = vertexPos;\n      textureCoord = texturePos.xy;\n      masktextureCoord = masktexturePos.xy;\n    }\n  "),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||e.isContextLost()||console.log("Vertex shader failed to compile: "+e.getShaderInfoLog(t));var r=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(r,"#version 300 es\n    precision highp float;\n    in highp vec2 textureCoord;\n    in highp vec2 masktextureCoord;\n    uniform sampler2D ySampler;\n    uniform sampler2D uSampler;\n    uniform sampler2D vSampler;\n    uniform sampler2D cursorSampler;\n    uniform sampler2D waterMarkSampler;\n    uniform sampler2D  previewVideoSampler;\n    uniform sampler2D maskSampler;\n    uniform vec4 cursorInfo;\n    uniform int onlyRGBA;\n    uniform int bgraMode;\n    uniform int colorRange;\n    uniform int waterMarkFlag;\n    uniform int cursorFlag;\n    uniform int maskFlag;\n    uniform int yuvmode;\n\n    const mat4 YUV2RGB_L = mat4(\n      1.1643828125, 0, 1.59602734375, -.87078515625,\n      1.1643828125, -.39176171875, -.81296875, .52959375,\n      1.1643828125, 2.017234375, 0, -1.081390625,\n      0, 0, 0, 1\n    );\n    \n    const mat4 YUV2RGB_F = mat4(\n      1.0, 0, 1.402, -.701,\n      1.0, -.34413, -.71414, .529135,\n      1.0, 1.772, 0, -.886,\n      0, 0, 0, 1\n    );\n\n    out vec4 outputColor;\n  \n    void main(void) {\n      vec4 c;\n      if (waterMarkFlag != 1) {\n        if (onlyRGBA == 0) {\n          highp float y = texture(ySampler, textureCoord).r;\n          highp float u;\n          highp float v;\n          if (yuvmode == 1) {\n            u = texture(uSampler, textureCoord).r;\n            v = texture(vSampler, textureCoord).r;\n          } else {\n            u = texture(uSampler, textureCoord).r;\n            v = texture(uSampler, textureCoord).a;\n          }\n      \n          if (colorRange == 0) {\n            c = vec4(y, u, v, 1) * YUV2RGB_L;\n          } else {\n            c = vec4(y, u, v, 1) * YUV2RGB_F;\n          }\n  \n          if (cursorFlag == 1) {\n            if (cursorInfo.z > 0.0 && textureCoord.x >= cursorInfo.x && textureCoord.y >= cursorInfo.y && \n                textureCoord.x < cursorInfo.x+cursorInfo.z && textureCoord.y < cursorInfo.y+cursorInfo.w) {\n              vec2 cursorCoord = textureCoord - cursorInfo.xy;\n              cursorCoord /= cursorInfo.zw;\n              vec4 cursor = texture(cursorSampler, cursorCoord);\n              c = c*(1.0-cursor.a) + cursor*cursor.a;\n            }\n          }\n        } else {\n          c = texture(previewVideoSampler, textureCoord);\n          if (bgraMode == 1) {\n            c = vec4(c.b, c.g, c.r, c.a);\n          }\n        }\n      }\n\n      if (waterMarkFlag == 1) {\n        c = texture(waterMarkSampler, textureCoord);\n        if (c.r == 0.0 && c.g == 0.0 && c.b == 0.0) {\n          c.a = 0.0;\n        }\n      }\n\n      if (maskFlag == 1 && waterMarkFlag != 1) {\n        vec4 mask = texture(maskSampler, masktextureCoord);\n        if (mask.r != 0.0 || mask.g != 0.0 || mask.b != 0.0) {\n          c = mask* mask.a+ c*(1.0-mask.a);\n        }\n      }\n\n      if (waterMarkFlag!=1) {\n        c.a = 1.0;\n      }\n\n      outputColor = c;\n    }\n  "),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)||e.isContextLost()||console.log("Fragment shader failed to compile: "+e.getShaderInfoLog(r));var i=e.createProgram();e.attachShader(i,t),e.attachShader(i,r),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)||e.isContextLost()||console.log("Program failed to compile: "+e.getProgramInfoLog(i)),e.useProgram(i),this.shaderProgram=i},$i.prototype.initBuffers=function(){var e=this.contextGL,t=this.shaderProgram,r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1,1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var i=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),this.vertexPosBuffer=r;var a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1,1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var n=e.getAttribLocation(t,"texturePos");if(e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),this.initmask&&!this.masktexturePosBuffer){var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var s=e.getAttribLocation(t,"masktexturePos");e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),this.masktexturePosBuffer=o}this.texturePosBuffer=a},$i.prototype.initTextures=function(e){var t=this.contextGL,r=this.shaderProgram;t.pixelStorei(t.UNPACK_ALIGNMENT,1);var i=this.initTexture();this.yTextureRef=i,this.oyTextureRef=i;var a=this.initTexture();this.uTextureRef=a,this.ouTextureRef=a;var n=this.initTexture();if(this.vTextureRef=n,this.ovTextureRef=n,e){this.BindTextures(x.S);var o=this.initTexture(),s=t.getUniformLocation(r,"cursorSampler");t.uniform1i(s,this.textureindex*this.texturestride+3),this.cursorTextureRef=o;var u=this.initTexture(),d=t.getUniformLocation(r,"waterMarkSampler");t.uniform1i(d,4),this.waterMarkTextureRef=u;var c=this.initTexture();this.repeatedWaterMarkTextureRef=c;var l=this.initTexture(),h=t.getUniformLocation(r,"previewVideoSampler");t.uniform1i(h,this.textureindex*this.texturestride+5),this.previewVideoTextureRef=l;var f=t.getUniformLocation(r,"cursorInfo");this.cursorInfoRef=f}if(this.initmask){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1);var p=this.initTexture(),v=t.getUniformLocation(r,"maskSampler");t.uniform1i(v,this.textureindex*this.texturestride+6),this.maskTextureRef=p}var m=t.getUniformLocation(r,"colorRange");this.colorRangeRef=m,this.onlyRGBARef=t.getUniformLocation(r,"onlyRGBA"),this.bgraModeRef=t.getUniformLocation(r,"bgraMode"),this.waterMarkFlagRef=t.getUniformLocation(r,"waterMarkFlag"),this.maskFlagRef=t.getUniformLocation(r,"maskFlag"),this.cursorFlagRef=t.getUniformLocation(r,"cursorFlag"),this.yuvmodeRef=t.getUniformLocation(r,"yuvmode")},$i.prototype.BindTextures=function(e){var t=this.contextGL,r=this.shaderProgram;if(t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.activeTexture(t.TEXTURE0+0),t.bindTexture(t.TEXTURE_2D,this.yTextureRef),t.activeTexture(t.TEXTURE0+1),t.bindTexture(t.TEXTURE_2D,this.uTextureRef),t.activeTexture(t.TEXTURE0+2),t.bindTexture(t.TEXTURE_2D,this.vTextureRef),e==x.S){var i=t.getUniformLocation(r,"ySampler");t.uniform1i(i,0);var a=t.getUniformLocation(r,"uSampler");t.uniform1i(a,1);var n=t.getUniformLocation(r,"vSampler");t.uniform1i(n,2)}else if(this.isRGBAMode(e)){var o=t.getUniformLocation(r,"previewVideoSampler");t.uniform1i(o,0);var s=t.getUniformLocation(r,"ySampler");t.uniform1i(s,0);var u=t.getUniformLocation(r,"uSampler");t.uniform1i(u,0);var d=t.getUniformLocation(r,"vSampler");t.uniform1i(d,0)}else if(e==x.U){var c=t.getUniformLocation(r,"ySampler");t.uniform1i(c,0);var l=t.getUniformLocation(r,"uSampler");t.uniform1i(l,1);var h=t.getUniformLocation(r,"vSampler");t.uniform1i(h,0)}var f=t.getUniformLocation(r,"previewVideoSampler");t.uniform1i(f,0);var p=t.getUniformLocation(r,"maskSampler");this.initmask?(t.activeTexture(t.TEXTURE0+6),t.bindTexture(t.TEXTURE_2D,this.maskTextureRef),t.uniform1i(p,6)):t.uniform1i(p,0);var v=t.getUniformLocation(r,"cursorSampler");t.uniform1i(v,0);var m=t.getUniformLocation(this.shaderProgram,"waterMarkSampler");t.uniform1i(m,0)},$i.prototype.initTexture=function(){var e=this.contextGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t},$i.prototype.clearDisplay=function(){var e=this.contextGL;e&&(e.enable(e.BLEND),e.blendFunc(e.ZERO,e.ZERO)),this.render()},$i.prototype.cleanup=function(e){var t=this.canvasElement,r=Qi.get(t);if(r&&this.removeEventListener(t,r),t.defaultContextLostHandler||(t.defaultContextLostHandler=Zi,t.addEventListener("webglcontextlost",Zi,{capture:!1})),this.isAvaiable()){var i=this.contextGL;i.deleteProgram(this.program),i.activeTexture(i.TEXTURE0+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE1+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE2+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),this.textureindex||this.initmask||(i.activeTexture(i.TEXTURE3+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE4+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(this.getRepeatedWatermarkTextureValue(i)),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE5+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null)),i.bindBuffer(i.ARRAY_BUFFER,null),i.deleteTexture(this.yTextureRef),i.deleteTexture(this.uTextureRef),i.deleteTexture(this.vTextureRef),this.textureindex||this.initmask||(i.deleteTexture(this.cursorTextureRef),i.deleteTexture(this.waterMarkTextureRef),i.deleteTexture(this.repeatedWaterMarkTextureRef),i.deleteTexture(this.previewVideoTextureRef),i.deleteBuffer(this.vertexPosBuffer),i.deleteBuffer(this.texturePosBuffer)),this.maskTextureRef&&i.deleteTexture(this.maskTextureRef),this.masktexturePosBuffer&&i.deleteBuffer(this.masktexturePosBuffer),i.glInitSucceed=0}},$i.prototype.drawNextOutputPicture=function(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=this.contextGL;n?this.drawNextOutputPictureFrame(e,t,r,i,a):this.drawNextOuptutPictureRGBA(e,t,r,i)},$i.prototype.updateVertexInfoForMultiView=function(e,t,r,i,a){var n,o,s,u,d=this.contextGL;if(this.isUseFillMode({width:r,height:i,rotation:a}))n=0,o=0,s=1,u=1;else{var c=a==this.ROTATION_CLOCK90||a==this.ROTATION_CLOCK270?i:r,l=a==this.ROTATION_CLOCK90||a==this.ROTATION_CLOCK270?r:i,h=c/l*t;h>e?(n=0,s=1,u=1-(o=(t-l/c*e)/2/t)):(o=0,u=1,s=1-(n=(e-h)/2/e))}n=2*n-1,s=2*s-1,o=1-2*o,u=1-2*u;var f=new Float32Array([s,o,n,o,s,u,n,u,1,1,-1,1,1,-1,-1,-1]);d.bindBuffer(d.ARRAY_BUFFER,this.vertexPosBuffer),d.bufferData(d.ARRAY_BUFFER,f,d.DYNAMIC_DRAW)},$i.prototype.updateTextureInfoForMultiView=function(e,t,r,i,a,o,s){var u,d,c,l,h=this.contextGL;if(this.isUseFillMode({width:r.width,height:r.height,rotation:i})){var f=i==this.ROTATION_CLOCK90||i==this.ROTATION_CLOCK270?s/o:o/s,p=r.left||0,v=r.top||0;if(r.width/r.height>f){var m=r.height*f;u=v/t,d=(Math.round((r.width-m)/2)+p)/e,c=u+(r.height-1)/t,l=d+m/e}else{var g=r.width/f;c=(u=(Math.round((r.height-g)/2)+v)/t)+(g-1)/t,l=(d=p/e)+r.width/e}}else u=Gi(r.top/t,2),d=Gi(r.left/e,2),c=Bi((r.top+r.height-1)/t,2),l=Bi((r.width-1+r.left)/e,2);var _=[d,u,l,u,l,c,d,c];i==this.ROTATION_CLOCK90&&(_.unshift(_[6],_[7]),_=_.slice(0,8)),i==this.ROTATION_CLOCK180&&(_.unshift(_[4],_[5],_[6],_[7]),_=_.slice(0,8)),i==this.ROTATION_CLOCK270&&(_.unshift(_[6],_[7]),(_=_.slice(0,8))[0]=1-_[0],_[2]=1-_[2],_[4]=1-_[4],_[6]=1-_[6]);var S=_[0],E=_[1];_[0]=_[2],_[1]=_[3],_[2]=S,_[3]=E,a&&(_[0]=1-_[0],_[2]=1-_[2],_[4]=1-_[4],_[6]=1-_[6]);var b=new Float32Array([].concat(n()(_),[1,0,0,0,1,1,0,1]));h.bindBuffer(h.ARRAY_BUFFER,this.texturePosBuffer),h.bufferData(h.ARRAY_BUFFER,b,h.DYNAMIC_DRAW)},$i.prototype.drawNextOutputPictureFrame=function(e,t,r,i,a){var n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];if(this.isAvaiable()){var u=this.contextGL,d=(this.texturePosBuffer,this.yTextureRef),c=this.uTextureRef,l=this.vTextureRef;u.enable(u.BLEND),u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA),a=a||this.ROTATION_CLOCK0;var h=(r=r||{top:0,left:0,width:e,height:t}).width!=this.croppingParams.width||r.height!=this.croppingParams.height,f=r.top!=this.croppingParams.top||r.left!=this.croppingParams.left,p=u.canvas.width!=this.canvasWidth||u.canvas.height!=this.canvasHeight,v=e!=this.textureWidth||t!=this.textureHeight,m=a!=this.picRotation;(h||p||m)&&ea(this,r.width,r.height,a,o),(h||f||v||m)&&ta(this,e,t,r,a);var g=n?0:1;g!=this.colorRange&&(u.uniform1i(this.colorRangeRef,g),this.colorRange=g),o?u.viewport(o.x,o.y,o.width,o.height):u.viewport(0,0,u.canvas.width,u.canvas.height),u.uniform1i(this.onlyRGBARef,0),u.uniform1i(this.yuvmodeRef,x.S),Object.assign(this.croppingParams,r),this.textureWidth=e,this.textureHeight=t,this.picRotation=a,this.canvasWidth=u.canvas.width,this.canvasHeight=u.canvas.height,u.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),u.clear(u.COLOR_BUFFER_BIT);var _=i,S=e*t;if(u.activeTexture(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,d),s){var E=_.subarray(0,S);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,e,t,0,u.LUMINANCE,u.UNSIGNED_BYTE,E)}var b=e/2*t/2;if(u.activeTexture(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,c),s){var y=_.subarray(S,S+b);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,e/2,t/2,0,u.LUMINANCE,u.UNSIGNED_BYTE,y)}var C=b;if(u.activeTexture(u.TEXTURE2),u.bindTexture(u.TEXTURE_2D,l),s){var A=_.subarray(S+b,S+b+C);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,e/2,t/2,0,u.LUMINANCE,u.UNSIGNED_BYTE,A)}u.activeTexture(u.TEXTURE3),u.bindTexture(u.TEXTURE_2D,this.cursorTextureRef),this.hasCursor?u.uniform1i(this.cursorFlagRef,1):s&&u.texImage2D(u.TEXTURE_2D,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,this.dummpyCursor),u.uniform4f(this.cursorInfoRef,this.cx,this.cy,this.cw,this.ch),u.activeTexture(u.TEXTURE5),u.bindTexture(u.TEXTURE_2D,this.previewVideoTextureRef),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,this.dummpyWaterMark);var R=u.getUniformLocation(this.shaderProgram,"maskSampler");u.uniform1i(R,5),this.render(),this.hasWholeFrame=1}},$i.prototype.updateTextureBlock=function(e,t,r,i,a){if(this.isAvaiable()){var n=this.contextGL,o=a;if(!(!this.hasWholeFrame||e<=0||t<=0||r<0||i<0||r+e>this.textureWidth||i+t>this.textureHeight)&&a&&a.length==e*t*3/2){var s=this.yTextureRef,u=this.uTextureRef,d=this.vTextureRef,c=e*t,l=o.subarray(0,c);n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,s),n.texSubImage2D(n.TEXTURE_2D,0,r,i,e,t,n.LUMINANCE,n.UNSIGNED_BYTE,l);var h=e/2*t/2,f=o.subarray(c,c+h);n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,u),n.texSubImage2D(n.TEXTURE_2D,0,r/2,i/2,e/2,t/2,n.LUMINANCE,n.UNSIGNED_BYTE,f);var p=h,v=o.subarray(c+h,c+h+p);n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,d),n.texSubImage2D(n.TEXTURE_2D,0,r/2,i/2,e/2,t/2,n.LUMINANCE,n.UNSIGNED_BYTE,v)}}},$i.prototype.updateCursor=function(e,t,r){if(this.isAvaiable()){var i=this.contextGL;e<=0||t<=0||!r||r.length!=e*t*4||(i.activeTexture(i.TEXTURE3),i.bindTexture(i.TEXTURE_2D,this.cursorTextureRef),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,r),this.cursorWidth=e,this.cursorHeight=t,this.hasCursor=1)}},$i.prototype.updateWatermark=function(e,t,r){if(this.isAvaiable()){this.contextGL;e<=0||t<=0||!r||r.length!=e*t*4||(this.watermarkData=r,this.watermarkWidth=e,this.watermarkHeight=t,this.hasWaterMark=1)}},$i.prototype.drawWatermark=function(){if(this.isAvaiable()){var e=this.contextGL;if(this.isSetWatermark()&&this.watermarkData&&this.watermarkWidth&&this.watermarkHeight){e.uniform1i(this.waterMarkFlagRef,1),this.isWatermarkRepeated()?(e.activeTexture(this.getRepeatedWatermarkTextureValue(e)),e.bindTexture(e.TEXTURE_2D,this.repeatedWaterMarkTextureRef)):(e.activeTexture(e.TEXTURE4),e.bindTexture(e.TEXTURE_2D,this.waterMarkTextureRef)),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.watermarkWidth,this.watermarkHeight,0,e.RGBA,e.UNSIGNED_BYTE,this.watermarkData);var t=e.getUniformLocation(this.shaderProgram,"waterMarkSampler");e.uniform1i(t,this.isWatermarkRepeated()?this.getRepeatedWatermarkUniformValue():4),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLE_STRIP,4,4)}}},$i.prototype.render=function(){if(this.isAvaiable()){var e=this.contextGL;e.uniform1i(this.waterMarkFlagRef,0),e.drawArrays(e.TRIANGLE_STRIP,0,4),this.drawWatermark()}},$i.prototype.drawCursor=function(e,t,r,i,a){if(this.isAvaiable()){var n=this.contextGL;if(!(!this.hasWholeFrame||e&&(i<0||a<0))){n.viewport(0,0,n.canvas.width,n.canvas.height);var o=this.yTextureRef,s=this.uTextureRef,u=this.vTextureRef,d=this.cursorTextureRef;if(n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,s),n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,u),n.activeTexture(n.TEXTURE3),n.bindTexture(n.TEXTURE_2D,d),e&&this.hasCursor){var c=t/this.croppingParams.width,l=r/this.croppingParams.height,h=i/this.croppingParams.width,f=a/this.croppingParams.height;this.cx=c,this.cy=l,this.cw=h,this.ch=f,n.uniform4f(this.cursorInfoRef,c,l,h,f)}else n.uniform4f(this.cursorInfoRef,0,0,0,0);this.render()}}},$i.prototype.clear=function(){this.hasWholeFrame=0,this.hasCursor=0},$i.prototype.clearCanvas=function(e){if(this.isAvaiable()){var t=this.contextGL;e?t.clearColor(e.R,e.G,e.B,e.A):t.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),t.clear(t.COLOR_BUFFER_BIT)}},$i.prototype.drawNextOuptutPictureRGBA=function(e,t,r,i){if(this.isAvaiable()){var a=i,n=this.canvasElement.getContext("2d"),o=n.getImageData(0,0,e,t);o.data.set(a),n.putImageData(o,0,0)}},$i.prototype.isRGBAMode=function(e){return-1!==[x.W,x.O].indexOf(e)},$i.prototype.updateRemoteVideoTextures=function(e,t,r,i,a){var n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if(this.isAvaiable()){var s=this.contextGL,u=this.yTextureRef,d=this.uTextureRef,c=this.vTextureRef;s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA);var l=this.isRGBAMode(this.videoMode);if(e<=0||t<=0||!i||!i.length||i.length!=e*t*3/2&&!l||r&&(r.top<0||r.left<0||r.left+r.width>e||r.top+r.height>t))return!1;var h=n?0:1;if(this.colorRange=h,this.rotation=a,Object.assign(this.croppingParams,r),this.textureWidth=e,this.textureHeight=t,this.canvasWidth=s.canvas.width,this.canvasHeight=s.canvas.height,o){if(s.bindTexture(s.TEXTURE_2D,u),!l){var f=i,p=e*t,v=f.subarray(0,p);s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e,t,0,s.LUMINANCE,s.UNSIGNED_BYTE,v);var m=0,g=0;this.videoMode==x.S?g=m=e/2*t/2:this.videoMode==x.U&&(m=e*t/2,g=0);var _=f.subarray(p,p+m);if(s.bindTexture(s.TEXTURE_2D,d),g){s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e/2,t/2,0,s.LUMINANCE,s.UNSIGNED_BYTE,_);var S=f.subarray(p+m,p+m+g);s.bindTexture(s.TEXTURE_2D,c),s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e/2,t/2,0,s.LUMINANCE,s.UNSIGNED_BYTE,S)}else s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE_ALPHA,e/2,t/2,0,s.LUMINANCE_ALPHA,s.UNSIGNED_BYTE,_);return!0}s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,t,0,s.RGBA,s.UNSIGNED_BYTE,i)}}},$i.prototype.updateRemoteVideoTexturesImageBitmap=function(e,t,r,i,a){var n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(!(e<=0||t<=0)&&r&&this.isAvaiable()){var o=this.contextGL;if(this.textureWidth=e,this.textureHeight=t,Number.isNaN(a)||(this.rotation=a),Object.assign(this.croppingParams,i),n){o.bindTexture(o.TEXTURE_2D,this.yTextureRef);var s=0,u=o.RGBA,d=o.RGBA,c=o.UNSIGNED_BYTE;o.texImage2D(o.TEXTURE_2D,s,u,d,c,r)}}},$i.prototype.updateSelfMaskImage=function(e,t,r){if(!(e<=0||t<=0)&&r&&r.length==e*t*4&&this.isAvaiable()){var i=this.contextGL;i.bindTexture(i.TEXTURE_2D,this.maskTextureRef),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,r)}},$i.prototype.VideoFlip=function(){if(this.isAvaiable()){var e=this.contextGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1)}},$i.prototype.drawRemoteVideo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isAvaiable()){var r=this.contextGL,i=this.isRGBAMode(this.videoMode)?1:0;r.uniform1i(this.colorRangeRef,this.colorRange),this.setUniformFlag(i,this.hasCursor,this.videoMode),this.initmask&&r.uniform1i(this.maskFlagRef,1),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,t,e.width,e.height),r.viewport(e.x,e.y,e.width,e.height),this.updateVertexInfoForMultiView(e.width,e.height,this.croppingParams.width,this.croppingParams.height,this.rotation),this.BindTextures(this.videoMode),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),this.render()}},$i.prototype.readPixelsSyncRequest=function(e,t,r,i){if(this.isAvaiable()){var a,n=this.contextGL;return this.destination&&this.destination.length==r*i*4||(this.destination=new Uint8Array(r*i*4)),a=this.destination,n.flush(),n.readPixels(e,t,r,i,n.RGBA,n.UNSIGNED_BYTE,a),a}},$i.prototype.updateSelfVideoTextures=function(e,t,r,i){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(!(e<=0||t<=0)&&r&&r.length%4==0&&this.isAvaiable()){var n=this.contextGL;this.textureWidth=e,this.textureHeight=t,this.rotation=this.ROTATION_CLOCK0,Object.assign(this.croppingParams,i),a&&(n.bindTexture(n.TEXTURE_2D,this.yTextureRef),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,t,0,n.RGBA,n.UNSIGNED_BYTE,r))}},$i.prototype.drawSelfVideo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.isAvaiable()){var i=this.contextGL;this.setUniformFlag(1,this.hasCursor,this.videoMode),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,r,e.width,e.height),i.viewport(e.x,e.y,e.width,e.height),t?(i.enable(i.BLEND),i.blendFunc(i.ZERO,i.ZERO),this.updateVertexInfoForMultiView(e.width,e.height,e.width,e.height,this.ROTATION_CLOCK0)):(i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),this.updateVertexInfoForMultiView(e.width,e.height,this.croppingParams.width,this.croppingParams.height,this.rotation)),this.BindTextures(x.W),this.render()}},$i.prototype.isSetWatermark=function(){return this.hasWaterMark},$i.prototype.recoverTextures=function(){},$i.prototype.setWatermarkFlag=function(e){this.hasWaterMark=e,e||(this.setWatermarkRepeated(!1),this.setWatermarkOpacity(),this.setWatermarkPosition(16))},$i.prototype.setUniformFlag=function(e,t,r){if(this.isAvaiable()){var i=this.contextGL;i.uniform1i(this.onlyRGBARef,e),i.uniform1i(this.bgraModeRef,e&&r===x.O?1:0),i.uniform1i(this.cursorFlagRef,t),e||i.uniform1i(this.yuvmodeRef,r)}},$i.prototype.setVideoMode=function(e){this.videoMode=e},$i.prototype.getVideoMode=function(e){return this.videoMode},$i.prototype.setWatermarkRepeated=function(e){this.watermarkRepeated=e},$i.prototype.isWatermarkRepeated=function(){return!!this.watermarkRepeated},$i.prototype.setWatermarkOpacity=function(e){this.watermarkOpacity=e||.15},$i.prototype.getWatermarkOpacity=function(){return this.watermarkOpacity},$i.prototype.setWatermarkPosition=function(e){this.watermarkPosition=e||16},$i.prototype.getWatermarkPosition=function(){return this.watermarkPosition},$i.prototype.setMultiView=function(e){return this.isMultiView=e},$i.prototype.getRepeatedWatermarkUniformValue=function(){return this.isMultiView?30:7},$i.prototype.getRepeatedWatermarkTextureValue=function(e){return this.isMultiView?e.TEXTURE30:e.TEXTURE7},$i.prototype.setFillMode=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.fillMode=e,this.fillModeForResolution=t},$i.prototype.getFillMode=function(){return this.fillMode},$i.prototype.getFillModeForResolution=function(){return this.fillModeForResolution},$i.prototype.getTextureIndex=function(){return this.textureindex},$i.prototype.getIndex=function(){return this.textureindex},$i.prototype.getWatermarkWidth=function(){return this.watermarkWidth},$i.prototype.getWatermarkHeight=function(){return this.watermarkHeight},$i.prototype.getTextureWidth=function(){return this.textureWidth},$i.prototype.getTextureHeight=function(){return this.textureHeight},$i.prototype.getCroppingParams=function(){return this.croppingParams},$i.prototype.getWatermarkOpacity=function(){return this.watermarkOpacity},$i.prototype.getAttachedCanvas=function(){return this.canvasElement},$i.prototype.resizeCanvasTo=function(e,t){this.contextGL.canvas.width=e,this.contextGL.canvas.height=t},$i.prototype.isUseFillMode=function(e){var t=e.width,r=e.height,i=e.rotation;if(!this.fillMode)return!1;if(!this.fillModeForResolution)return!0;if(!t||!r)return!1;var a=i===this.ROTATION_CLOCK90||i==this.ROTATION_CLOCK270?r/t:t/r;return(Array.isArray(this.fillModeForResolution)?this.fillModeForResolution:[this.fillModeForResolution]).some((function(e){return Math.abs(a-e)<.01}))};var ra=$i,ia=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t.byteLength,s=arguments.length>6?arguments[6]:void 0;l()(this,e),this.offset=n,this._BYTES_PER_ELEMENT=r,this.capacity=(o-8)/r,this.usableCapacity=this.capacity-1,this.buf=t,this.write_ptr=new Uint32Array(this.buf,n,1),this.read_ptr=new Uint32Array(this.buf,n+4,1),this.storageUint8sByteOffset=n+8,this.storageUint8s=new Uint8Array(this.buf,this.storageUint8sByteOffset,o-8),this.byteLength=o,this.label=i,this.usingOneElementBuffer=a,s&&(this.wasmMemory=s),a&&(this.oneElementBuffer=new ArrayBuffer(r)),this.repushhander=0,this.repushlogcount=0,this.monitorpace=0}return f()(e,[{key:"checkBuffer",value:function(){this.wasmMemory&&this.wasmMemory.buffer!=this.buf&&(console.log("buffer change"),this.buf=this.wasmMemory.buffer,this.storageUint8s=new Uint8Array(this.buf,this.storageUint8sByteOffset,this.byteLength-8))}},{key:"enqueue",value:function(e){return this.available_write()>0&&this.push(e),{rd:Atomics.load(this.read_ptr,0),wr:Atomics.load(this.write_ptr,0)}}},{key:"enqueueSafe",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;for(this.dataBuffer||(this.dataBuffer=new P.a);this.dataBuffer.getLength()>0&&this.available_write()>0;){var a=this.dataBuffer.dequeue();a&&this.push(a)}var n=this.dataBuffer.getLength();if(e){if(this.available_write()>0&&0==n)return this.push(e),!0;if(!r)return!1;this.dataBuffer.enqueue(e),++n}if(n>0&&!this.repushhander&&(this.repushhander=setTimeout((function(){t.repushlogcount%10==0&&console.warn("<<< retry consume cache data"),t.repushlogcount++,t.repushhander=0,t.enqueueSafe(null)}),30)),n>=1e3&&(Y.default.warn("Cached data in SAB reached critical value, will be cleared"),this.dataBuffer.clear(),i&&i("vqslclear")),n>0&&i){var o=performance.now();(!this.monitorpace||o-this.monitorpace>2e4)&&(this.monitorpace=o,i&&i("vqsl"+n))}return!0}},{key:"push",value:function(e){return e instanceof Array?this._pushArray(e):this._push(e)}},{key:"_pushArray",value:function(e){var t=this,r=Atomics.load(this.write_ptr,0);this.checkBuffer();var i=0;e.forEach((function(e){t.storageUint8s.set(e,r*t._BYTES_PER_ELEMENT+8+4+i),i+=e.byteLength})),new Uint32Array(this.buf,this.offset+r*this._BYTES_PER_ELEMENT+8,1)[0]=i;var a=(r+1)%this.capacity;return Atomics.store(this.write_ptr,0,a),!0}},{key:"_push",value:function(e){var t=Atomics.load(this.write_ptr,0);this.checkBuffer(),this.storageUint8s.set(e,t*this._BYTES_PER_ELEMENT+8+4,e.byteLength),new Uint32Array(this.buf,this.offset+t*this._BYTES_PER_ELEMENT+8,1)[0]=e.byteLength;var r=(t+1)%this.capacity;return Atomics.store(this.write_ptr,0,r),!0}},{key:"addReadPtr",value:function(){var e=Atomics.load(this.read_ptr,0);Atomics.store(this.read_ptr,0,(e+1)%this.capacity)}},{key:"dequeue",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=Atomics.load(this.read_ptr,0);this.checkBuffer();var r,i,a,n=new Uint32Array(this.buf,this.offset+t*this._BYTES_PER_ELEMENT+8,1);if(e){r=this.oneElementBuffer?new Uint8Array(this.oneElementBuffer,0,n[0]):new Uint8Array(n[0]);var o=new Uint8Array(this.storageUint8s.buffer,t*this._BYTES_PER_ELEMENT+8+4+this.storageUint8sByteOffset,r.byteLength);r.set(o,0)}else r=this.storageUint8s.subarray(t*this._BYTES_PER_ELEMENT+8+4,t*this._BYTES_PER_ELEMENT+8+4+n[0]),i=t*this._BYTES_PER_ELEMENT+8+4+this.storageUint8sByteOffset,a=t*this._BYTES_PER_ELEMENT+8+4+n[0]+this.storageUint8sByteOffset;return e&&Atomics.store(this.read_ptr,0,(t+1)%this.capacity),e?r:{bCopyData:e,uint8s:r,begin:i,end:a}}},{key:"available_read",value:function(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_read(e,t)}},{key:"available_write",value:function(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_write(e,t)}},{key:"is_available_write",value:function(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._is_available_write(e,t)}},{key:"_available_read",value:function(e,t){return(t+this.capacity-e)%this.capacity}},{key:"_available_write",value:function(e,t){return this.usableCapacity-this._available_read(e,t)}},{key:"_is_available_write",value:function(e,t){return this._available_write(e,t)>0}},{key:"_storage_capacity",value:function(){return this.capacity}}],[{key:"getStorageForCapacity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:80,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500,r=8+(e+1)*t;return new SharedArrayBuffer(r)}}]),e}(),aa=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:80;if(l()(this,e),!(t instanceof ia))throw new Error("RingBuffer required");this.rb=t,this.dataCallback=r,this.interval=null,this.requestID=null,this.timeout_call=i,this.tick_lasted_time=0,this.timeoutMS=a,this.maxCount=n}return f()(e,[{key:"consume",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.interval||(this.bCopyData=r,this.interval=setInterval((function(){var t=performance.now();if(e.timeout_call){if(0!=e.tick_lasted_time){var r=t-e.tick_lasted_time;r>=e.timeoutMS&&e.timeout_call(r,t)}e.tick_lasted_time=t}e._dequeue()}),t),console.log("consume interval ".concat(this.interval)))}},{key:"consumeAll",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.bCopyData=e,this._dequeue()}},{key:"_dequeue",value:function(){var e=Math.min(this.rb.available_read(),this.maxCount);for(this.consoume_count=0;this.consoume_count<e;){this.consoume_count++;var t=this.rb.dequeue(this.bCopyData);this.dataCallback(t),this.bCopyData||this.rb.addReadPtr()}}},{key:"_consumeForAnimationFrame",value:function(){this._dequeue(),this.requestID=requestAnimationFrame(this._consumeForAnimationFrame.bind(this))}},{key:"consumeUsingRequestAnimationFrame",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.requestID||(this.bCopyData=e,this._consumeForAnimationFrame())}},{key:"cancelConsume",value:function(){console.log("cancelConsume interval ".concat(this.interval," requestID ").concat(this.requestID)),this.tick_lasted_time=0,clearInterval(this.interval),this.requestID&&cancelAnimationFrame(this.requestID),this.interval=null,this.requestID=null}}]),e}(),na=function(){function e(){l()(this,e),this.timeStampKey="video_timestamp",this.keysList=["video_ssrc","video_width","video_height","rendering_x","rendering_y","rendering_w","rendering_h","rotation","yuv_limited"],this.bCopyData=null,this.begin=null,this.end=null}return f()(e,[{key:"setOBJ",value:function(e){this.obj=e,this.yuvUint8s=e.data}},{key:"setBuffer",value:function(e){!1===e.bCopyData?(this.objUint8s=e.uint8s,this.bCopyData=e.bCopyData,this.begin=e.begin,this.end=e.end):(this.objUint8s=e,this.bCopyData=!0,this.begin=0,this.end=e.byteLength)}},{key:"buffer2Obj",value:function(){var e=new Uint32Array(this.objUint8s.buffer,this.begin,9),t=new DataView(this.objUint8s.buffer,this.begin+40,16),r={};this.keysList.forEach((function(t,i){r[t]=e[i]})),r[this.timeStampKey]=Number(t.getBigUint64(0,!0));var i,a=Number(t.getBigUint64(8,!0)),n=new Uint8Array(this.objUint8s.buffer,this.begin+40+8+8,a);return i=(this.bCopyData,n),r.data=i,r}},{key:"obj2buffer",value:function(){var e=this,t=new Uint8Array(56),r=this.keysList,i=new Uint32Array(t.buffer,0,9),a=new DataView(t.buffer,40,16);return r.forEach((function(t,r){i[r]=e.obj[t]})),a.setBigUint64(0,BigInt(this.obj[this.timeStampKey]),!0),a.setBigUint64(8,BigInt(this.yuvUint8s.byteLength),!0),[t,this.yuvUint8s]}}]),e}();function oa(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}var sa=function(){function e(t){l()(this,e),this.options=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oa(Object(r),!0).forEach((function(t){v()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oa(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({analyserFrequent:100},t||{}),this.asnTime=performance.now(),this.audioStream=null,this.analyserNodeBufferDataArray=null,this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.destinationNode=new MediaStreamAudioDestinationNode(this.audioCtx),this.initAnalyserNode(),this.lastUILevel=0}return f()(e,[{key:"initAnalyserNode",value:function(){this.analyserNode=this.audioCtx.createAnalyser(),this.analyserNode.connect(this.destinationNode),this.analyserNode.fftSize=1024}},{key:"setAudioStream",value:function(e){this.audioStream=e}},{key:"start",value:function(){var e=this;return this.getAnalyzingStatus()&&this.stop(),this.getDestroyedStatus()?Promise.reject(new Error("instance is destroyed already")):new Promise((function(t){e.setAnalyzingStatus(!0),e.sourceNode=e.audioCtx.createMediaStreamSource(e.audioStream),e.sourceNode.connect(e.analyserNode),e.resumeAudioCtx(),e.setAnalyzeInterval(),t(!0)}))}},{key:"stop",value:function(){this.setAnalyzingStatus(!1),this.clearAnalyzeInterval()}},{key:"destroy",value:function(){var e=this;this.stop(),this.analyserNode&&this.destinationNode&&this.analyserNode.disconnect(this.destinationNode),this.setDestroyedStatus(!0),this.audioCtx.suspend().finally((function(){return e.audioCtx.close()})),this.audioStream=null,this.analyserNodeBufferDataArray=null}},{key:"analyserNodeIntervalCallback",value:function(){if(this.analyserNodeBufferDataArray){this.analyserNode.getFloatTimeDomainData(this.analyserNodeBufferDataArray);var e=function(e,t){for(var r=0,i=0,a=0;a<e.length;a+=t){i+=e[a]*e[a];var n=Math.abs(e[a]);n>r&&(r=n)}return{sumRms:i/e.length/t,absMax:r=r>1?1:r}}(this.analyserNodeBufferDataArray,2),t=(e.sumRms,da(e.absMax));t!==this.lastUILevel&&(this.lastUILevel=t,this.options.analyserCallback(t))}}},{key:"setAnalyzeInterval",value:function(){this.clearAnalyzeInterval();var e=this.analyserNode.fftSize;this.analyserNodeBufferDataArray=new Float32Array(e),this.analyserNodeTimer=window.setInterval(this.analyserNodeIntervalCallback.bind(this),this.options.analyserFrequent)}},{key:"clearAnalyzeInterval",value:function(){this.analyserNodeTimer&&(window.clearInterval(this.analyserNodeTimer),this.analyserNodeTimer=null,this.analyserNodeBufferDataArray=null)}},{key:"getAnalyzingStatus",value:function(){return!!this.isAnalyzing}},{key:"setAnalyzingStatus",value:function(e){this.isAnalyzing=!!e}},{key:"getDestroyedStatus",value:function(){return!!this.isDestroyed}},{key:"setDestroyedStatus",value:function(e){this.isDestroyed=!!e}},{key:"resumeAudioCtx",value:function(){"running"!==this.audioCtx.state&&this.audioCtx.resume()}}]),e}(),ua=[0,1,2,3,4,4,5,5,5,5,6,6,6,6,6,7,7,7,7,8,8,8,9,9,9,9,9,9,9,9,9,9,9];function da(e){if("number"!=typeof e||e<0||e>1)return-1;var t=parseInt(32768*e/1e3);return 0==t&&e>250&&(t=1),ua[t]}var ca=function(e,t){return Q.default.add_monitor("AB"+e)},la=[],ha=[],fa=function(){function e(){l()(this,e),this.levelR16LogTimer=null,this.audioStatus=-1}return f()(e,[{key:"startLogTimer",value:function(){try{this.levelR16LogTimer||(this.levelR16LogTimer=setInterval((function(){la.push("x"),ha.push("x"),la.length>30&&la.shift(),ha.length>30&&ha.shift()}),1e3)),this.audioStatus=2}catch(e){ca("SALLTERR")}}},{key:"suspendLogTimer",value:function(e){try{this.levelR16LogTimer&&(clearInterval(this.levelR16LogTimer),this.levelR16LogTimer=null),this.audioStatus=e?3:1}catch(e){ca("PALLTERR")}}},{key:"destroy",value:function(){this.suspendLogTimer(),this.levelR16LogTimer=null}}]),e}(),pa=function(){function e(t){l()(this,e),this.audioStream=null,this.audioCtx=null,this.webRTCWorkletNode=null,this.inputNode=null,this.outputNode=null,this.isDestroyed=!1,this.mutedLevelLogTimer=new fa,this.initAudioContext(),this.isCreatingWorklet=!1,this.setAudioStreamCallback=t,this.doingDenoise=!1,this.checkProcessInterval=null}var t;return f()(e,[{key:"initAudioContext",value:function(){var e=this;if(!this.audioCtx){var t=q.default.getAudioContextConfigure();this.audioCtx=Object(q.createAudioContext)("WebRTCInput",t),this.audioCtx.onstatechange=function(){if(e.audioStream){var t=e.audioStream.getAudioTracks[0];if(t){var r=t.muted;"running"===e.audioCtx.state&&r&&(ca("ACRM"),Y.default.error("Audio context running when track muted"))}}},this.outputNode=this.audioCtx.createMediaStreamDestination(),this.resumeAudioCtx()}}},{key:"createWebRTCWorklet",value:(t=d()(g.a.mark((function e(t){var r,i,a,n=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.audioCtx&&t){e.next=2;break}return e.abrupt("return");case 2:if(!this.isCreatingWorklet){e.next=4;break}return e.abrupt("return");case 4:if(this.isCreatingWorklet=!0,this.webRTCWorkletNode){e.next=35;break}return e.prev=6,e.next=9,this.audioCtx.audioWorklet.addModule(t.jsPath);case 9:e.next=16;break;case 11:return e.prev=11,e.t0=e.catch(6),Y.default.error("Error when add webRTC worklet module",e.t0),this.isCreatingWorklet=!1,e.abrupt("return");case 16:if(r=void 0,!q.default.isSupportAudioDenoise(!0)){e.next=22;break}return i=t.wasmPath,e.next=21,q.default.downloadAndCompileWebAssembly(i,"AudioWorklet",Q.default,!q.default.browser.isSafari&&Z.default.enableStreamingInstantiate);case 21:r=e.sent;case 22:if(!this.isDestroyed){e.next=26;break}return Y.default.log("webrtc manager has been destroyed before create audio worklet node"),this.destroy(),e.abrupt("return");case 26:a=q.default.isBrowserSupportStereo()?2:1,this.webRTCWorkletNode=new ri(this.audioCtx,"webRTCWorklet",{processorOptions:{userAgent:navigator.userAgent,wasmModule:r,inputAudioChannel:a},numberOfOutputs:1,outputChannelCount:[2]}),this.webRTCWorkletNode.onprocessorerror=function(e){Y.default.error("Exception thrown in WebRTC AudioWorkletProcessor",e)},this.webRTCWorkletNode.postCMD("audiowasm"),this.webRTCWorkletNode.port.addEventListener("message",(function(e){n.handleMessage(e)})),this.audioStream&&!this.inputNode&&(this.inputNode=this.audioCtx.createMediaStreamSource(this.audioStream),this.inputNode.connect(this.webRTCWorkletNode)),this.webRTCWorkletNode.connect(this.outputNode),"running"===this.audioCtx.state&&this.startCheckProcess(),Y.default.log("create worklet successfully");case 35:this.isCreatingWorklet=!1,this.webRTCWorkletNode.postCMD("clearBuffer"),this.resumeAudioCtx();case 38:case"end":return e.stop()}}),e,this,[[6,11]])}))),function(e){return t.apply(this,arguments)})},{key:"handleMessage",value:function(e){var t=e.data;switch(t.status){case"AUDIO_LEVEL_R16":var r;if(1!=(null===(r=this.mutedLevelLogTimer)||void 0===r?void 0:r.audioStatus))break;var i=t.level.toString(16);la.push(i),la.length>30&&la.shift();break;case"AUDIO_LEVEL_R16_DENOISE":var a;if(1!=(null===(a=this.mutedLevelLogTimer)||void 0===a?void 0:a.audioStatus))break;var n=t.level.toString(16);ha.push(n),ha.length>30&&ha.shift();break;case"WASM_INIT_SUCCESS":this.changeDenoiseSwitch(this.denoiseSwitch,this.isHeadSet);break;case"audio_process_changed":Y.default.log("denoise switch changed"+t.data),this.doingDenoise=t.data,this.setAudioStreamCallback(null,null,!0);break;case M.AUDIO_LEVEL_INDICATOR:null!=t.data&&Z.default.Notify_APPUI_SAFE(M.AUDIO_LEVEL_INDICATOR,{value:t.data});break;case"SPEECH_LOG":et.push({log:t.data.log,logSource:x.g})}}},{key:"setAudioStream",value:function(e){this.audioStream=e,this.webRTCWorkletNode&&(this.inputNode&&(this.inputNode.disconnect(),this.inputNode=null),this.inputNode=this.audioCtx.createMediaStreamSource(this.audioStream),this.inputNode.connect(this.webRTCWorkletNode))}},{key:"getAudioStream",value:function(){return this.outputNode&&this.webRTCWorkletNode&&this.doingDenoise?this.outputNode.stream:this.audioStream}},{key:"changeDenoiseSwitch",value:function(e,t){this.denoiseSwitch=!!e,this.isHeadSet=!!t,this.webRTCWorkletNode&&this.webRTCWorkletNode.postCMD("audio_denoise_switch",{enable:this.denoiseSwitch,isHeadSet:this.isHeadSet})}},{key:"getLevelR16Log",value:function(){var e=la.join(""),t=ha.join("");return la=[],ha=[],{resLevelR16Log:e,resLevelR16LogDenoise:t}}},{key:"resumeAudioCtx",value:function(){this.audioCtx&&"running"!==this.audioCtx.state&&"closed"!==this.audioCtx.state&&this.audioCtx.resume().catch((function(e){Y.default.error("webRTC audioContext resume fail",e)}))}},{key:"suspendAudioCtx",value:function(){this.audioCtx&&"suspended"!==this.audioCtx.state&&this.audioCtx.suspend().catch((function(e){Y.default.error("Error when suspend audio context",e)}))}},{key:"changeAudioStatus",value:function(e,t){var r,i,a;t?(null===(r=this.mutedLevelLogTimer)||void 0===r||r.suspendLogTimer(!0),this.suspendAudioCtx()):e?(null===(i=this.mutedLevelLogTimer)||void 0===i||i.startLogTimer(),this.suspendAudioCtx()):(null===(a=this.mutedLevelLogTimer)||void 0===a||a.suspendLogTimer(!1),this.resumeAudioCtx())}},{key:"startCheckProcess",value:function(){var e=this;this.stopCheckProcess(),this.webRTCWorkletNode&&(this.webRTCWorkletNode.postCMD("clearProcess",null),this.checkProcessInterval=setInterval((function(){e.webRTCWorkletNode&&e.webRTCWorkletNode.postCMD("checkProcess",null)}),1e4))}},{key:"stopCheckProcess",value:function(){this.checkProcessInterval&&(clearInterval(this.checkProcessInterval),this.checkProcessInterval=null)}},{key:"destroy",value:function(){var e=this;try{this.isDestroyed=!0,this.webRTCWorkletNode&&(this.webRTCWorkletNode.disconnect(),this.webRTCWorkletNode.postCMD("stopWorklet",!0),this.webRTCWorkletNode=null),this.inputNode&&(this.inputNode.disconnect(this.audioLevelNode),this.inputNode=null),this.outputNode&&(this.outputNode.disconnect(),this.outputNode=null),this.audioCtx&&"closed"!==this.audioCtx.state&&this.audioCtx.suspend().finally((function(){e.audioCtx.close(),e.audioCtx=null})),this.audioStream=null,this.mutedLevelLogTimer&&(this.mutedLevelLogTimer.destroy(),this.mutedLevelLogTimer=null),this.wasmModule=null,this.isCreatingWorklet=!1,ca("DSALOK")}catch(e){ca("DSALERR"),Y.default.error("Error when destroy webRTC manager",e)}}}]),e}(),va=["headset","pods","buds","opencomm","arctis","mpow","hyperx cloud","zone wired","aeropex by aftershokz","plt focus","xiberia","pxc 550","tk-hs001","lifechat lx","cisco 56"],ma=[["wh-","wf-","wi-"],["1000x","ch","xb","sp","h9","c2","c5","c6","c1","h8","c4","c3"]],ga={jabra:["evolve","pro 900","pro 920","pro 93","pro 94","talk","biz","engage","elite","uc voice","link 180","link 2","link 860","link 850","link 400","blueparrott"],plantronics:["savi","blackwire","c5","c3","c4","c6","c7","bt","audio","da","encorepro","hw111n","gamecom","apu","voyager"],logitech:["h570","h820","h650","pro x"],sennheiser:["sc","mb","pc","sd","dect","g4me1","audio"],sony:["wh","wf","mdr"],bose:["qc","quiet","soundlink","soundsport","on-ear","nc"],beats:["fit","flex","power","solo","studio","mivi"],razer:["kraken","blackshark","barracuda","nari","hammerhead","opus"],yealink:["uh","wh","yh","cp"],soundcore:["life","liberty","spirit","strike"],addasound:["sr","epic"],jbl:["tune","quantum","live","wave","t450bt","c200","everest","c310"],epos:["impact","pc 8 usb","h3","adapt"],jlab:["go","bt","epic","studio"]};var _a=function(e){if("string"!=typeof e)return!1;for(var t=e.toLowerCase(),r=0;r<va.length;r++){var i=va[r];if(t.includes(i))return!0}for(var a=Object.keys(ga),n=0;n<a.length;n++){var o=a[n];if(t.includes(o))for(var s=ga[o],u=0;u<s.length;u++)if(t.includes(s[u]))return!0}for(var d=ma[0],c=ma[1],l=!1,h=0;h<d.length;h++)if(t.includes(d[h])){l=!0;break}if(l)for(var f=0;f<c.length;f++)if(t.includes(c[f]))return!0;return!1};function Sa(){}Sa.prototype.init=function(){this.micId=null,this.micLabel=null,this.speakerId=null,this.speakerLabel=null,this.cameraId=null,this.cameraLabel=null,this.startTime=Date.now(),this.userId=0,this.videoWidth=0,this.videoHeight=0,this.audioBridge=!1,this.isUpdatingDevice=!1,this.denoiseSwitch=!1,this.listAllDevices=!1},Sa.prototype.notifyDenoiseSetting=function(){q.default.isSupportAudioDenoise(!!this.audioBridge)&&this.micId&&(this.audioBridge?this.audioBridge.changeDenoiseSwitch(this.denoiseSwitch,ba.isHeadSet()):sr({command:"audio_denoise_switch",switch:this.denoiseSwitch,isHeadSet:ba.isHeadSet()}))},Sa.prototype.updateDeviceList=function(){var e=this;navigator.mediaDevices.enumerateDevices().then((function(t){t.forEach((function(t){"audioinput"==t.kind?e.sendDeviceInfo(-1,1,e.getIndex(t.label),t.deviceId,t.label,!0):"audiooutput"==t.kind&&e.sendDeviceInfo(-1,0,e.getIndex(t.label),t.deviceId,t.label,!0)}))}))},Sa.prototype.changeDenoiseSwitch=function(e){this.denoiseSwitch=e,this.notifyDenoiseSetting()},Sa.prototype.setAudioBridge=function(e){this.audioBridge=e},Sa.prototype.setUserId=function(e){"number"!=typeof e||Number.isNaN(e)||(this.userId=e,this.listAllDevices||(this.listAllDevices=!0,this.updateDeviceList()))},Sa.prototype.updateSelectedMicDevices=function(e,t,r,i){var a;t=null===(a=t)||void 0===a||null===(a=a.replace(/\([\w,\d]+:[\w,\d]+\)/i,""))||void 0===a?void 0:a.trim(),i&&(this.micId=e,this.micLabel=t),this.notifyDenoiseSetting(),this.sendDeviceInfo(r,1,this.getIndex(this.micLabel),e,t,i,this.isHeadSet())},Sa.prototype.updateSelectedSpeakerDevices=function(){var e=d()(g.a.mark((function e(t,r,i){var a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||"default",a="default",e.next=4,navigator.mediaDevices.enumerateDevices();case 4:e.sent.forEach((function(e){var r;"audiooutput"===e.kind&&e.deviceId===t&&(a=null===(r=e.label)||void 0===r||null===(r=r.replace(/\([\w,\d]+:[\w,\d]+\)/i,""))||void 0===r?void 0:r.trim())})),i&&(this.speakerId=t,this.speakerLabel=a),this.sendDeviceInfo(r,0,this.getIndex(this.speakerLabel),t,a,i,this.isHeadSet(!1));case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}(),Sa.prototype.updateSelectedCameraDevices=function(e,t,r,i,a,n,o){var s;this.cameraId=e,this.cameraLabel=null==t||null===(s=t.replace(/\([\w,\d]+:[\w,\d]+\)/i,""))||void 0===s?void 0:s.trim(),this.videoWidth=r,this.videoHeight=i,this.videoFrameRate=a,this.sendCameraInfo(n,o,a)},Sa.prototype.isHeadSet=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=null;return t=e?this.micLabel:this.speakerLabel,_a(t)},Sa.prototype.getIndex=function(e){return"default"==e?-1:"communications"==e?q.default.isMac()?0:-2:0},Sa.prototype.sendDeviceInfo=function(e,t,r,i,a,n,o){if(this.userId){var s=null,u=Date.now()-this.startTime;s=-1==e?"WCL_AUDIOD-ALL,"+this.userId+","+t+","+r+","+a+","+i+","+n+","+e+",7,"+u+",1":"WCL_AUDIOD,"+this.userId+","+t+","+r+","+a+","+i+","+n+","+e+",7,"+u+",1,"+(n?1:0)+","+o,Z.default.sendMessageToRwg(M.MONITOR_LOG,{evt:M.RWG_MONITOR_LOG_EVENT,seq:1,body:{data:s}})}},Sa.prototype.sendCameraInfo=function(e,t,r){if(this.userId&&!this.isUpdatingDevice){var i;i="WCL_CAMERA,"+this.userId+",0,"+this.cameraLabel+","+t+","+e+","+"-1,"+this.videoWidth+","+this.videoHeight+","+"-1,"+r+","+-1,Z.default.sendMessageToRwg(M.MONITOR_LOG,{evt:M.RWG_MONITOR_LOG_EVENT,seq:1,body:{data:i}})}};var Ea,ba=new Sa,ya=ba;function Ca(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Aa(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Aa(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function Aa(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var Ra,Ia,wa,Ta=function(e,t){return Q.default.add_monitor("AB"+e)},ka=q.default.browser.isSafari,Da=(q.default.browser.isChrome,Ea={},v()(Ea,x.y,new Map([["useinbandfec",{value:1,operater:"add"}],["maxaveragebitrate",{value:48e3,operater:"add"}],["maxplaybackrate",{value:24e3,operater:"add"}],["sprop-maxcapturerate",{value:24e3,operater:"add"}],["sprop-stereo",{value:1,operater:"sub"}],["stereo",{value:1,operater:"sub"}]])),v()(Ea,x.A,new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:96e3,operater:"add"}],["maxplaybackrate",{value:48e3,operater:"add"}],["sprop-maxcapturerate",{value:48e3,operater:"add"}],["sprop-stereo",{value:1,operater:"add"}],["stereo",{value:1,operater:"add"}]])),v()(Ea,x.B,new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:96e3,operater:"add"}],["maxplaybackrate",{value:48e3,operater:"add"}],["sprop-maxcapturerate",{value:48e3,operater:"add"}],["sprop-stereo",{value:1,operater:"add"}],["stereo",{value:1,operater:"add"}]])),v()(Ea,x.w,new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:128e3,operater:"add"}],["maxplaybackrate",{value:48e3,operater:"add"}],["sprop-maxcapturerate",{value:48e3,operater:"add"}],["sprop-stereo",{value:1,operater:"add"}],["stereo",{value:1,operater:"add"}]])),v()(Ea,x.x,new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:128e3,operater:"add"}],["maxplaybackrate",{value:48e3,operater:"add"}],["sprop-maxcapturerate",{value:48e3,operater:"add"}],["sprop-stereo",{value:1,operater:"add"}],["stereo",{value:1,operater:"add"}]])),v()(Ea,x.I,new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:"96000",operater:"add"}],["maxplaybackrate",{value:"48000",operater:"add"}],["sprop-maxcapturerate",{value:"48000",operater:"add"}]])),v()(Ea,x.z,new Map([["useinbandfec",{value:1,operater:"add"}],["maxaveragebitrate",{value:64e3,operater:"add"}],["maxplaybackrate",{value:24e3,operater:"add"}],["sprop-maxcapturerate",{value:24e3,operater:"add"}],["sprop-stereo",{value:1,operater:"sub"}],["stereo",{value:1,operater:"sub"}]])),Ea),Oa=(Ra=[],Ia={},wa=Date.now(),function(e){if(e.onlyAudioLevel)Ia[e.key]||(Ia[e.key]=[]),Ia[e.key].push(e.audioLevel);else if(Object.keys(Ia).forEach((function(t){e.ssrcMap[t]&&(e.ssrcMap[t].zoomAudioLevel=Ia[t])})),Ia={},Ra.push(e),Date.now()-wa>14e3){var t=Ra.reduce((function(e,t,r){var i=t.rtt,a=t.ssrcMap,n="";return Object.keys(a).forEach((function(e,t,o){var s=a[e],u=s.aveAudioLevel,d=s.audioLevel,c=s.aveJitterBufferDelay,l=s.jitter,h=s.packetsLost,f=s.packetsReceived,p=s.bytesReceived,v=s.zoomAudioLevel;n+="".concat(void 0===i?"":i,"|{[SSRCLOG]}|{").concat(e,"}|").concat(v.join(""),"|").concat(d,"|").concat(u,"|").concat(l,"|").concat(c,"|").concat(h,"|").concat(f,"|").concat(p),r===Ra.length-1&&t===o.length-1||(n+="#")})),e+n}),"WCL_AB,{[DOWNLINK]},");wa=Date.now(),t+=",{[END]}",Z.default.sendMessageToRwg(M.MONITOR_LOG,{evt:M.RWG_MONITOR_LOG_EVENT,seq:1,body:{data:t}}),Ia={},Ra=[]}}),Ma=function(){var e=[],t=Date.now();return function(r){if(e.push(r),Date.now()-t>14e3){var i="",a="",n=e.reduce((function(t,r,n){var o=r.rtt,s=r.bytesSent,u=r.audioLevel,d=r.audioLevelDenoise;return i+=u,a+=d||u,t+"".concat(void 0===o?"":o,"|").concat(void 0===s?"":s)+(n<e.length-1?"#":"")+(n==e.length-1?",{[SPEECH_R16]},".concat(i,",").concat(a,",{[END]}"):"")}),"WCL_AB,{[UPLINK]},");t=Date.now(),Z.default.sendMessageToRwg(M.MONITOR_LOG,{evt:M.RWG_MONITOR_LOG_EVENT,seq:1,body:{data:n}}),e=[]}}}(),xa={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",iceServers:[],iceTransportPolicy:"all"},Pa=function(){function e(t,r,i,a,n,o,s,u){var d=this;l()(this,e),this.publisherCandidate=[],this.subscriberCandidate=[],this.retry=0,this.retryPublish=0,this.nginxHost=t,this.rwgHost=r,this.conId=i,this.wsUrl=o?"wss://".concat(r,"/ab/signal?rwg=").concat(r,"&cid=").concat(i):"wss://".concat(t,"/ab/signal?rwg=").concat(r,"&cid=").concat(i),this.audioPlayerMap=new Map,this.onError=null,this.isRetrying=!1,this.recvOnly=!!a,this.audioCtx=Object(q.createAudioContext)("AudioBridgeFake"),this.destination=this.audioCtx.createMediaStreamDestination(),this.monitorTimer=null,this.audioReportCount=0,this.monitorTimerDuration=1e3,this.monitorInfo={subscriber:{},publisher:{}},this.muted=!1,this.audioMuteStatus=new Map,this.ssrcUserIdMap=new Map,this.published=!1,this.joinAudioAfterConnect=!1,this.audioMode=x.db,this.codecDoAVSync=!!n,this.normalAudioMap=new Map,this.shareAudioMap=new Map,this.audioProfile=x.y,this.syncTimer=null,this.workletPath=u,this.workletPath&&(this.webRTCWorkletManager=new pa(this.setNormalAudioStream.bind(this))),ka&&(this.monitorAudio=new Audio,this.shareMonitorAudio=new Audio),this.hasPaused=!1,this.recoverAfter1s=null,this.useWebRTCOnDesktop=s,this.receiveAudioStatus=new Map,document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&d.hasPaused&&d.audioMode&&d.playAllRemoteAudio()})),this.isMutedBySystem=!1}var t,r,i,a,n,o,s,u,c,h,p,v;return f()(e,[{key:"playAllRemoteAudio",value:function(){var e=this;if(!this.isMutedBySystem&&this.hasPaused&&this.audioMode){var t=Array.from(this.audioPlayerMap.values()).map((function(e){if(e.paused)return e.play()}));Promise.all(t).then((function(){e.hasPaused=!1})).catch((function(t){e.hasPaused=!0,Z.default.Notify_APPUI&&(Ta("REA"),Z.default.Notify_APPUI(M.RECOVER_WEBRTC_AUDIO))}))}}},{key:"reconnect",value:(v=d()(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isRetrying&&!this.isDestroyed){e.next=2;break}return e.abrupt("return");case 2:if(this.stopAVSyncTimer(),this.stopAudioQualityMonitorTimer(),this.destroySocketAndWebRtcConnect(!0),!(this.retry>=3)){e.next=10;break}return this.isRetrying=!1,Y.default.error("Audio Bridge failed to reconnect",t),Z.default.Notify_APPUI&&Z.default.Notify_APPUI(M.WCL_SIP_WEBSOCKET_CONNECT_ERROR),e.abrupt("return");case 10:return this.isRetrying=!0,e.next=13,q.default.sleep(3e3);case 13:if(!this.isDestroyed){e.next=15;break}return e.abrupt("return");case 15:return Ta("JOIN"+this.retry),this.retry++,Z.default.Notify_APPUI&&Z.default.Notify_APPUI(M.WCL_AUDIO_BRIDGE_RECONNECT_START),e.next=20,this.join(!0);case 20:this.isRetrying=!1;case 21:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"join",value:(p=d()(g.a.mark((function e(t,r){var i,a,n,o,s=this,u=arguments;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=u.length>2&&void 0!==u[2]?u[2]:x.db)===x.bb)try{this.cleanUserEventListener||(this.cleanUserEventListener=Object(q.addUserEventListener)(this.playAllRemoteAudio.bind(this))),null===(a=this.webRTCWorkletManager)||void 0===a||a.createWebRTCWorklet(this.workletPath),null===(n=this.webRTCWorkletManager)||void 0===n||n.startCheckProcess()}catch(e){Y.default.error("Error when creating webRTCWorklet",e)}if(this.stopDestoryOldSignalTimer(),this.audioMode=this.audioMode|i,!this.signal){e.next=12;break}return this.isDestroyed=!1,this.signal.isDestroyed=!1,this.signal.audioMode=this.audioMode,i&&(this.startAVSyncTimer(),this.signal.socket&&1===this.signal.socket.readyState&&this.signal.notify("audiostatus",{status:this.audioMode})),i===x.bb&&this.unmuteAllRemoteAudio(),this.startAudioQualityMonitorTimer(),e.abrupt("return");case 12:if(t){e.next=18;break}if(this.joinAudioAfterConnect=i,!this.isRetrying){e.next=18;break}return this.destroySocketAndWebRtcConnect(t),this.isDestroyed=!1,e.abrupt("return");case 18:if(this.destroySocketAndWebRtcConnect(t),this.isDestroyed=!1,this.signal=new Va(this.joinAudioAfterConnect),this.joinAudioAfterConnect&&this.startAVSyncTimer(),this.joinAudioAfterConnect=!1,e.prev=23,!r){e.next=28;break}o=r,e.next=34;break;case 28:return Ta("RTK"),Z.default.sendMessageToRwg(M.REQUEST_AUDIO_BRIDGE_TOKEN,{evt:M.WS_CONF_AB_TOKEN_REQ},!1),e.next=32,this.waitForTokenFromRWG(M.PUBSUB_EVT.AUDIO_BRIDGE_WS_TOKEN);case 32:o=e.sent,Ta("TK");case 34:this.signal.init("".concat(this.wsUrl,"&token=").concat(o)),e.next=40;break;case 37:e.prev=37,e.t0=e.catch(23),this.reconnect(e.t0);case 40:this.signal.onopen(function(){var e=d()(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.signal.audioMode&&s.startAudioQualityMonitorTimer(),s.isOpen=!0,s.retryPublish=0,!s.audioStream&&!s.recvOnly){e.next=11;break}return s.clearAudioPlayerMap(),s.setNormalAudioStream(s.audioStream),s.setShareAudioStream(s.shareAudioStream),e.next=9,s.publish();case 9:s.retry=0,Z.default.Notify_APPUI&&s.signal&&s.signal.audioMode&&Z.default.Notify_APPUI(M.WCL_AUDIO_BRIDGE_RECONNECT_END);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.signal.onclose((function(e){s.signal.destroy(),s.signal=null,s.reconnect(e)})),this.signal.onerror((function(e){s.isOpen||Y.default.error("Audio Bridge WebSocket open error"),s.signal.destroy(),s.signal=null,s.reconnect(e)})),this.signal.on_notify("command",(function(e){var t=(e||{}).data;if(t)try{(JSON.parse(t)||{}).evt===M.WS_CONF_END_INDICATION&&s.destroy(!1)}catch(e){}})),this.signal.UpdateNTP=function(e,t,r,i){if(s.useWebRTCOnDesktop&&s.codecDoAVSync){var a=new ArrayBuffer(16),n=e.toString(2),o=parseInt(n.substring(0,n.length-32),2),u=parseInt(n.substring(n.length-32,n.length),2),d=new DataView(a);d.setUint32(0,r,!0),d.setUint32(4,u,!0),d.setUint32(8,o,!0),d.setUint32(12,Date.now(),!0),tr({command:"audioDecodeTime",status:1,data:new Uint8Array(a)})}else 512&r?s.shareAudioMap.set(r>>10,{ntptime:e,rtptime:t,abssrc:i}):s.normalAudioMap.set(r>>10,{ntptime:e,rtptime:t,abssrc:i})},this.publisher&&this.removeAudioSender(),this.publisher=new RTCPeerConnection(xa),this.subscriber=new RTCPeerConnection(xa),this.normalAudioSender=null,this.shareAudioSender=null,this.publisher.addTransceiver("audio",{direction:"sendrecv"}),this.publisher.addTransceiver("audio",{direction:"sendrecv"}),this.signal.onOffer=function(){var e=d()(g.a.mark((function e(t){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ta("RERSDP"),s.updateSsrcUserIdMap(t),e.next=4,s.subscriber.setRemoteDescription(t);case 4:return s.subscriberCandidate.forEach((function(e){return s.subscriber.addIceCandidate(e)})),s.subscriberCandidate=[],e.next=8,s.subscriber.createAnswer();case 8:return(r=e.sent).sdp=s.updateSdpCodecParameters(r.sdp,"opus",new Map([["stereo",{value:1,operater:"add"}]])),e.next=12,s.subscriber.setLocalDescription(r);case 12:return Ta("RELSDP"),e.next=15,s.rpc("answer",{desc:r});case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.signal.onTrickle=function(){var e=d()(g.a.mark((function e(t,r){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:0==r?null!=s.subscriber.remoteDescription?(Ta("RERICE"),s.subscriber.addIceCandidate(t)):(Ta("RERICEF"),s.subscriberCandidate.push(t)):1==r?null!=s.publisher.remoteDescription?(Ta("SERICE"),s.publisher.addIceCandidate(t)):(Ta("SERICEF"),s.publisherCandidate.push(t)):Y.default.error("Audio Bridge onTrickle error: role: ".concat(r,", candidate: ").concat(t));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),this.publisher.onicecandidate=function(e){var t=e.candidate;Ta("SELICE"),s.signal.notify("trickle",{candidate:t,role:1})},this.publisher.onconnectionstatechange=function(){Ta("PCSC:"+s.publisher.connectionState),s.publisher&&("disconnected"===s.publisher.connectionState?setTimeout((function(){s.publisher&&"disconnected"===s.publisher.connectionState&&s.publish(!0)}),5e3):"connected"===s.publisher.connectionState&&(s.signal.isRtcConnected=!0,s.changeSDPAfterConnect&&(s.changeSDPAfterConnect=!1,s.resetOfferandAnswer()),s.publisher.firstConnected||(s.signal.publishPeerConnection=!0,s.publisher.firstConnected=!0,Z.default.Notify_APPUI(M.AUDIO_BRIDGE_CAN_SEND_DATA))))},this.subscriber.onicecandidate=function(e){var t=e.candidate;Ta("RELICE"),s.signal.notify("trickle",{candidate:t,role:0})},this.subscriber.ontrack=function(e){Ta("REVT");var t=e.streams[0],r=decodeURIComponent(t.id),i="ab-audio-"+r;e.track.onunmute=function(){var e=s.audioPlayerMap.get(r);if(e)e.srcObject=t;else{(e=document.createElement("audio")).addEventListener("playing",(function(){Ta("ASP:"+i)})),e.addEventListener("pause",(function(){Ta("APP:"+i),s.hasPaused=!0,"visible"===document.visibilityState&&null===s.recoverAfter1s&&(s.recoverAfter1s=setTimeout((function(){s.recoverAfter1s=null,s.playAllRemoteAudio()}),1e3))})),e.addEventListener("canplay",(function(){Ta("ACP:"+i)})),e.id=i,e.srcObject=t,e.autoplay=!0,e.controls=!1,s.audioPlayerMap.set(r,e),document.documentElement.appendChild(e);var a=ya.speakerId;e.setSinkId&&a&&e.setSinkId(a).catch((function(e){Y.default.error("Error when setting sink of audio player",e)}))}s.receiveAudioStatus.forEach((function(e,t){s.setShareVolumeLevel(t/10,e.volume,e.isFromMainSession,!1)})),s.isDestroyed&&(e.muted=!0),Ta("REVTP")},e.track.onmute=function(){Ta("REVTM");var e=s.audioPlayerMap.get(r);e&&e.remove(),s.audioPlayerMap.delete(r)}},this.subscriber.onconnectionstatechange=function(){Ta("SCSC:"+s.subscriber.connectionState),s.subscriber&&"connected"===s.subscriber.connectionState&&!s.subscriber.firstConnected&&(s.signal.subscribPeerConnection=!0,s.subscriber.firstConnected=!0,Z.default.Notify_APPUI(M.AUDIO_BRIDGE_FIRST_RECV_DATA))};case 59:case"end":return e.stop()}}),e,this,[[23,37]])}))),function(e,t){return p.apply(this,arguments)})},{key:"enableShareToBO",value:(h=d()(g.a.mark((function e(t){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,e.prev=1,e.next=4,this.rpc("Enable_Share_To_BO",{enable:t});case 4:r=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),Y.default.error("Error when enable share to BO",e.t0);case 10:r&&2==r.length?Z.default.Notify_APPUI(M.AUDIOBRIDGE_EBABLE_SHARE_TO_BO_SUCCESS,{enable:r[1].enable}):Z.default.Notify_APPUI(M.AUDIOBRIDGE_EBABLE_SHARE_TO_BO_FAILURE,{enable:t});case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return h.apply(this,arguments)})},{key:"enableBroadCastToBO",value:(c=d()(g.a.mark((function e(t){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,e.prev=1,e.next=4,this.rpc("Enable_Broadcast_To_BO",{enable:t});case 4:r=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),Y.default.error("Error when enable broadcast to bo",e.t0);case 10:r&&2==r.length?Z.default.Notify_APPUI(M.AUDIOBRIDGE_ENABLE_BROADCAST_TO_BO_SUCCESS,{enable:r[1].enable}):Z.default.Notify_APPUI(M.AUDIOBRIDGE_EBABLE_BROADCAST_TO_BO_FAILURE,{enable:t});case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return c.apply(this,arguments)})},{key:"leaveAudioWithoutDisconnect",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.db;(this.audioMode=this.audioMode&~r,this.signal&&(this.signal.audioMode=this.audioMode,this.signal.notify("audiostatus",{status:this.audioMode})),r===x.bb)?(this.setNormalAudioStream(null,!0),this.muteAllRemoteAudio(),this.cleanUserEventListener&&(this.cleanUserEventListener(),this.cleanUserEventListener=null),null===(e=this.webRTCWorkletManager)||void 0===e||e.changeAudioStatus(!1,!0),null===(t=this.webRTCWorkletManager)||void 0===t||t.stopCheckProcess()):r===x.eb&&this.setShareAudioStream(null,!0);this.audioMode===x.db&&(this.signal&&(this.signal.leaveTime=Date.now()),this.stopAudioQualityMonitorTimer(),this.stopAVSyncTimer())}},{key:"rpc",value:(u=d()(g.a.mark((function e(t){var r,i=arguments;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:[],!this.isDestroyed){e.next=4;break}return Y.default.error("audioBridge instance is destroyed, method ".concat(t)),e.abrupt("return","");case 4:if(e.prev=4,this.signal){e.next=8;break}return Y.default.error("Audio Bridge RPC error: method: ".concat(t,", params: ").concat(r)),e.abrupt("return","");case 8:return e.abrupt("return",this.signal.call(t,r));case 11:return e.prev=11,e.t0=e.catch(4),Y.default.error("Audio Bridge RPC error: method: ".concat(t,", params: ").concat(r),e.t0),e.abrupt("return","");case 15:case"end":return e.stop()}}),e,this,[[4,11]])}))),function(e){return u.apply(this,arguments)})},{key:"publish",value:(s=d()(g.a.mark((function e(t){var r,i,a,n,o=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.publisher&&this.isOpen){e.next=2;break}return e.abrupt("return");case 2:if(!t){e.next=6;break}if(!(this.retryPublish>=3)){e.next=5;break}return e.abrupt("return");case 5:this.retryPublish++;case 6:if(t){e.next=10;break}if(!this.published){e.next=9;break}return e.abrupt("return");case 9:this.published=!0;case 10:return e.next=12,this.publisher.createOffer({iceRestart:!!t});case 12:return(r=e.sent).sdp=this.changeOfferSDP(r.sdp),e.next=16,this.publisher.setLocalDescription(r);case 16:return this.uid||t||(this.uid=Na()),Ta("SELSDP"),e.next=20,t?this.rpc("offer",{desc:this.publisher.localDescription}):this.rpc("join",{uid:this.uid,offer:this.publisher.localDescription});case 20:if(!(i=e.sent)||2!==i.length){e.next=36;break}if(i[0],"answer"!==(a=i[1]).type){e.next=36;break}return Ta("SERSDP"),a.sdp=this.changeOfferSDP(a.sdp),this.publisherAnswer=a,e.next=30,this.publisher.setRemoteDescription(a);case 30:1===(n=this.publisher.getTransceivers()).length?this.normalAudioSender=n[0].sender:2==n.length&&(n[0].mid<n[1].mid?(this.normalAudioSender=n[0].sender,this.shareAudioSender=n[1].sender):(this.normalAudioSender=n[1].sender,this.shareAudioSender=n[0].sender)),this.publisherCandidate.forEach((function(e){o.publisher.addIceCandidate(e),Ta("SERICE")})),this.publisherCandidate=[],this.setNormalAudioStream(this.audioStream),this.setShareAudioStream(this.shareAudioStream);case 36:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"resetOfferandAnswer",value:(o=d()(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.publisher.createOffer();case 2:if((t=e.sent).sdp=this.changeOfferSDP(t.sdp),!this.publisherAnswer){e.next=12;break}return e.next=7,this.publisher.setLocalDescription(t);case 7:return this.publisherAnswer.sdp=this.changeOfferSDP(this.publisherAnswer.sdp),e.next=10,this.publisher.setRemoteDescription(this.publisherAnswer);case 10:return this.rpc("Set_AudioProfile",{audioProfile:this.audioProfile}),e.abrupt("return");case 12:Y.default.log("publisher answer is null when reset offer and answer");case 13:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"waitForTokenFromRWG",value:function(e){return new Promise((function(t,r){z.a.on(e,(function(e,r){t(r)}))}))}},{key:"updateSdpCodecParameters",value:function(e,t,r){try{for(var i=[],a=e.split("\r\n"),n=new RegExp("^a=rtpmap:([0-9]+) ".concat(t,"/")),o=0;o<a.length;o++){var s=a[o].match(n);s&&i.push(s[1])}if(i.length)for(var u=function(e){var t=i.reduce((function(t,r){return a[e].match(new RegExp("^a=fmtp:".concat(r," (.*)")))||t}),null);if(t){var n=new Map(t[1].split(";").map((function(e){return e.split("=")})));r.forEach((function(e,t){"add"===e.operater?n.set(t,e.value):"sub"===e.operater&&n.delete(t)}));var o,s=a[e].match(/a=fmtp:(\d+)/)[0]+" ",u=Ca(n);try{for(u.s();!(o=u.n()).done;){var d=O()(o.value,2),c=d[0],l=d[1];s+="".concat(c,"=").concat(l,";")}}catch(e){u.e(e)}finally{u.f()}s=s.slice(0,s.length-1),a[e]=s}},d=0;d<a.length;d++)u(d);return a.join("\r\n")}catch(t){return Y.default.error("Error when updateSdpCodecParameters",t),e}}},{key:"changeOfferSDP",value:function(e){try{for(var t=e.split("m="),r=0,i=[],a=1;a<t.length;a++){if(0===t[a].indexOf("audio")){r++;var n=t[a].match(/a=mid:(\d+)/);n&&i.push(n[1])}t[a]="m="+t[a]}if(1===r)return e=this.updateSdpCodecParameters(e,"opus",Da[this.audioProfile]);if(2!==r||2!=i.length)return Y.default.error("Audio line invalid: "+r),Y.default.error("mid line length invalid: "+i.length),e;for(var o="",s=0;s<t.length;s++)t[s].startsWith("m=audio")&&(-1!=t[s].indexOf("mid:"+Math.min(i[0],i[1]))?(t[s]=this.updateSdpCodecParameters(t[s],"opus",Da[this.audioProfile]),-1===t[s].indexOf("cname:Normal")&&(t[s]=t[s].replace(/a=ssrc:(.+) cname:/,"a=ssrc:$1 cname:Normal+"))):t[s].indexOf("mid:"+Math.min(i[0],i[1]))&&(t[s]=this.updateSdpCodecParameters(t[s],"opus",Da[x.I]),-1===t[s].indexOf("cname:Share")&&(t[s]=t[s].replace(/a=ssrc:(.+) cname:/,"a=ssrc:$1 cname:Share+")))),o+=t[s];return o}catch(t){return Y.default.error("Error when changeOfferSDP",t),e}}},{key:"setRecvOnly",value:function(e,t){this.recvOnly=!!e,this.recvOnly?this.setNormalAudioStream(null,!0):t&&this.setNormalAudioStream(t)}},{key:"setCodecDoAVSync",value:function(e){this.codecDoAVSync=e}},{key:"setNormalAudioStream",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!r){var i;if(t||this.recvOnly)this.audioStream=null===(i=this.destination)||void 0===i?void 0:i.stream;else this.audioStream=e;this.webRTCWorkletManager&&this.webRTCWorkletManager.setAudioStream(this.audioStream,this.muted)}var a=e;this.webRTCWorkletManager&&(a=this.webRTCWorkletManager.getAudioStream()),this.publishAudioStream(a,this.monitorAudio,this.normalAudioSender,"PAT")}},{key:"setShareAudioStream",value:function(e,t){var r;!e||t?this.shareAudioStream=null===(r=this.destination)||void 0===r?void 0:r.stream:this.shareAudioStream=e;this.publishAudioStream(this.shareAudioStream,this.shareMonitorAudio,this.shareAudioSender,"PAST")}},{key:"publishAudioStream",value:function(e,t,r,i){if(!this.isDestroyed){try{t&&e&&(t.srcObject=e,t.muted=!0,t.paused&&t.play())}catch(e){Y.default.error("error publishing audio stream",e)}i+=e&&e.id!==this.destination.stream.id?"T":"F",r?e.getAudioTracks().forEach((function(e){Y.default.log("publish track label"+e.label),Ta(i+": "+e.id),r.replaceTrack(e).catch((function(t){Ta(i+"F: "+e.id)}))})):Ta(i+"SE ")}}},{key:"mute",value:function(){var e;this.audioStream&&(Ta("SEVTP"),this.muted=!0,this.audioStream.getAudioTracks().forEach((function(e){e.enabled=!1})),null===(e=this.webRTCWorkletManager)||void 0===e||e.changeAudioStatus(!0,!1))}},{key:"unmute",value:function(){var e;this.audioStream&&(Ta("SEVTM"),this.muted=!1,this.audioStream.getAudioTracks().forEach((function(e){e.enabled=!0})),null===(e=this.webRTCWorkletManager)||void 0===e||e.changeAudioStatus(!1,!1))}},{key:"stopIncomingAudio",value:function(e){e?this.muteAllRemoteAudio():this.unmuteAllRemoteAudio()}},{key:"muteAllRemoteAudio",value:function(){var e,t=Ca(this.audioPlayerMap);try{for(t.s();!(e=t.n()).done;){var r=O()(e.value,2);r[0];r[1].muted=!0}}catch(e){t.e(e)}finally{t.f()}}},{key:"unmuteAllRemoteAudio",value:function(){var e,t=Ca(this.audioPlayerMap);try{for(t.s();!(e=t.n()).done;){var r=O()(e.value,2);r[0];r[1].muted=!1}}catch(e){t.e(e)}finally{t.f()}this.playAllRemoteAudio()}},{key:"setSpeechVolumeLevel",value:function(e,t){var r,i=Ca(this.audioPlayerMap);try{for(i.s();!(r=i.n()).done;){var a=O()(r.value,2),n=a[0],o=a[1];if(-1===n.indexOf("OS")){var s=Number(n.split("+")[0]||"0"),u=Number.isNaN(s)||!s?null:s>>10<<10;if(u&&u===e>>10<<10){var d=Math.min(Math.max(0,t),100)/100;o.volume=d;break}}}}catch(e){i.e(e)}finally{i.f()}}},{key:"changeSpeaker",value:(n=d()(g.a.mark((function e(t){var r,i,a,n,o,s,u,d,c;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!0,i="",a=Date.now(),n=[],o=Ca(this.audioPlayerMap),e.prev=5,o.s();case 7:if((s=o.n()).done){e.next=17;break}if((u=O()(s.value,2))[0],(d=u[1]).setSinkId){e.next=13;break}return r=!1,i="audioplayer.setSinkId is not supported on your device",e.abrupt("break",17);case 13:c=d.setSinkId(t),n.push(c);case 15:e.next=7;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(5),o.e(e.t0);case 22:return e.prev=22,o.f(),e.finish(22);case 25:return e.prev=25,e.next=28,Promise.all(n);case 28:e.next=35;break;case 30:e.prev=30,e.t1=e.catch(25),r=!1,i="Error when setting sink of audio player: "+e.t1.message,Y.default.error("Error when setting sink of audio player",e.t1);case 35:r?Z.default.Notify_APPUI(M.AUDIO_SPEAKER_SET_SUCCESS,t||"default"):Z.default.Notify_APPUI(M.AUDIO_SPEAKER_SET_ERROR,i),ya.updateSelectedSpeakerDevices(t,Date.now()-a,r);case 37:case"end":return e.stop()}}),e,this,[[5,19,22,25],[25,30]])}))),function(e){return n.apply(this,arguments)})},{key:"setShareVolumeLevel",value:function(e,t,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];i&&this.receiveAudioStatus.set(10*e+(r?1:0),{volume:t,isFromMainSession:r});var a,n=r?/(\d+)\+OS/:/(\d+)\+CS/,o=Ca(this.audioPlayerMap);try{for(o.s();!(a=o.n()).done;){var s=O()(a.value,2),u=s[0],d=s[1],c=u.match(n);c&&c.length>=2&&c[1]>>10===e&&512&c[1]&&(d.muted=!t)}}catch(e){o.e(e)}finally{o.f()}}},{key:"set_CC_lang",value:(a=d()(g.a.mark((function e(t){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,e.prev=1,e.next=4,this.rpc("set_CC_lang",{lang:t});case 4:r=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),Y.default.error("error when setting language",e.t0);case 10:r&&2===r.length?Z.default.Notify_APPUI(M.AUDIOBRIDGE_SET_CC_LANG_SUCCESS,r[1].lang):Z.default.Notify_APPUI(M.AUDIOBRIDGE_SET_CC_LANG_FAILURE,t);case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return a.apply(this,arguments)})},{key:"updateSsrcUserIdMap",value:function(e){var t=this;if(e){var r=e.sdp,i=(void 0===r?"":r).match(/a=ssrc:(.+) cname:(.+)/g);i&&i.forEach((function(e){var r=e.match(/a=ssrc:(.+) cname:(.+)/);if(r&&r[1]&&r[2]){var i=Number(r[2].split("+")[0]||"0"),a=Number.isNaN(i)||!i?null:i>>10<<10,n=Number(r[1]);t.ssrcUserIdMap.set(n,a)}}))}}},{key:"updateUserMuteUnmuteStatus",value:function(e){var t=this,r=e.update,i=e.remove;r&&r.length>0&&r.forEach((function(e){var r=e.userId,i=e.muted;r&&t.audioMuteStatus.set(r>>10<<10,!!i)})),i&&i.length>0&&i.forEach((function(e){var r=e.userId;r&&t.audioMuteStatus.set(r>>10<<10,!0)}))}},{key:"isUserMuted",value:function(e){var t=this.ssrcUserIdMap.get(e);if(!t)return!1;var r=this.audioMuteStatus.get(t);return void 0!==r&&!!r}},{key:"setAudioProfile",value:(i=d()(g.a.mark((function e(t){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.audioMode===x.bb||this.audioMode==x.cb){e.next=2;break}return e.abrupt("return");case 2:if(r=this.audioProfile,"backgroundNoiseSuppression"===t.currentSelect?(t.highBitrate?this.audioProfile=x.z:this.audioProfile=x.y,ya.changeDenoiseSwitch("Zoom"===t.backgroundNoiseSuppression)):(ya.changeDenoiseSwitch(!1),t.originalSound.highfidelity&&t.originalSound.stereo?this.audioProfile=x.x:t.originalSound.highfidelity?this.audioProfile=x.w:t.originalSound.stereo?this.audioProfile=x.B:this.audioProfile=x.A),r===this.audioProfile){e.next=11;break}if(this.publisher&&"connected"===this.publisher.connectionState){e.next=9;break}this.changeSDPAfterConnect=!0,e.next=11;break;case 9:return e.next=11,this.resetOfferandAnswer();case 11:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"clearAudioPlayerMap",value:function(){this.muteAllRemoteAudio();var e,t=Ca(this.audioPlayerMap);try{for(t.s();!(e=t.n()).done;){var r=O()(e.value,2);r[0];r[1].remove()}}catch(e){t.e(e)}finally{t.f()}this.audioPlayerMap.clear(),this.audioMuteStatus.clear()}},{key:"removeAudioSender",value:function(){this.normalAudioSender&&(this.publisher.removeTrack(this.normalAudioSender),this.normalAudioSender=null),this.shareAudioSender&&(this.publisher.removeTrack(this.shareAudioSender),this.shareAudioSender=null)}},{key:"destroySocketAndWebRtcConnect",value:function(e){this.published=!1;try{this.removeAudioSender()}catch(e){}this.publisher&&(this.publisher.close(),this.publisher=null),this.subscriber&&(this.subscriber.close(),this.subscriber=null),this.isOpen=!1,e||(this.retry=0),this.retryPublish=0,this.signal&&(this.signal.destroy(),this.signal=null),this.ssrcUserIdMap.clear()}},{key:"stopDestoryOldSignalTimer",value:function(){this.destroyOldSignalTimer&&(clearTimeout(this.destroyOldSignalTimer),this.destroyOldSignalTimer=null)}},{key:"startDestoryOldSignalTimer",value:function(){var e=this;this.stopDestoryOldSignalTimer(),this.destroyOldSignalTimer=setTimeout((function(){e.stopDestoryOldSignalTimer(),e.destroySocketAndWebRtcConnect()}),15e3)}},{key:"destroy",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Ta("DS"),this.isDestroyed=!0,this.cleanUserEventListener&&(this.cleanUserEventListener(),this.cleanUserEventListener=null),this.stopAudioQualityMonitorTimer(),this.stopAVSyncTimer(),this.stopDestoryOldSignalTimer(),e?(this.muteAllRemoteAudio(),this.setNormalAudioStream(null,!0),this.setShareAudioStream(null,!0),this.startDestoryOldSignalTimer()):(this.webRTCWorkletManager&&(this.webRTCWorkletManager.destroy(),this.webRTCWorkletManager=null),this.clearAudioPlayerMap(),this.destroySocketAndWebRtcConnect(),this.audioCtx&&(this.audioCtx.close(),this.audioCtx=null,this.destination=null,this.recvOnly=!1))}},{key:"startAudioQualityMonitorTimer",value:function(){var e=this;this.audioReportCount=0,this.stopAudioQualityMonitorTimer(),this.monitorTimer=setInterval((function(){var t=e.audioReportCount%5;e._publisherStatsParse(t),e._subscriberStatsParse(t),e.audioReportCount++}),this.monitorTimerDuration)}},{key:"stopAudioQualityMonitorTimer",value:function(){this.monitorTimer&&(clearInterval(this.monitorTimer),this.monitorTimer=null,this.audioReportCount=0,this.monitorInfo={subscriber:{},publisher:{}})}},{key:"publishStream",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r?this.setShareAudioStream(e):this.setNormalAudioStream(e),new Promise((function(e,r){t.published?e(!0):t.publish().then((function(){e(!1)}))}))}},{key:"stopAVSyncTimer",value:function(){this.syncTimer&&(clearInterval(this.syncTimer),this.syncTimer=null)}},{key:"syncSingleView",value:function(e,t){var r=0;if(t){var i=parseInt(t).toString(2),a=i.substring(0,i.length-32),n=i.substring(i.length-32,i.length);r=1e3*(a=parseInt(a,2))+232.8*(n=parseInt(n,2))/1e9}0==Z.default.mediaSDKHandle.RenderInMain?e?nr({command:"audioTimestamp",data:r}):tr({command:"audioDecodeTime",status:0,data:r}):e?Z.default.mediaSDKHandle.SharingRenderObj&&Z.default.mediaSDKHandle.SharingRenderObj.SetcATimeStamp(r):Z.default.CurrentSSRCTime!=r&&(Z.default.CurrentSSRCTime=r,Z.default.audioPlayTime=Date.now())}},{key:"startAVSyncTimer",value:function(){var e=this;this.stopAVSyncTimer(),this.syncTimer=setInterval((function(){if(e.subscriber){var t=0;e.subscriber.getReceivers().forEach((function(r){r.getSynchronizationSources().forEach((function(r){t++;var i=e.ssrcUserIdMap.get(r.source),a=null,n=!1;if((a=e.shareAudioMap.get(i>>10))&&a.abssrc===r.source?n=!0:a=e.normalAudioMap.get(i>>10),a){var o=a.ntptime,s=a.rtptime,u=o+(r.rtpTimestamp-s)*Math.pow(2,32)/48e3;e.isMultiView||i>>10!=Z.default.CurrentSSRC>>10&&!n||r.source===a.abssrc&&e.syncSingleView(n,u)}}))})),0===t&&(e.syncSingleView(!1,0),e.syncSingleView(!0,0))}}),500)}},{key:"_publisherStatsParse",value:(r=d()(g.a.mark((function e(t){var r,i,a,n,o,s,u,d=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.publisher){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.publisher.getStats();case 4:if(r=e.sent){e.next=7;break}return e.abrupt("return");case 7:i={},a=!1,n=this.monitorInfo.publisher,r.forEach((function(e){t||(a=d._publisherCandidatePairParse(e,i,n)||a,d._publisherLocalCadidateParse(e,n),d._publisherRemoteCadidateParse(e,n))})),t||a&&this.webRTCWorkletManager&&(o=this.webRTCWorkletManager.getLevelR16Log(),s=o.resLevelR16Log,u=o.resLevelR16LogDenoise,i.audioLevel=s,i.audioLevelDenoise=u,Ma(i));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_publisherCandidatePairParse",value:function(e,t,r){var i=!1,a=e.totalRoundTripTime,n=e.responsesReceived,o=e.bytesSent,s=e.timestamp,u=e.localCandidateId,d=e.remoteCandidateId,c=e.type,l=e.state,h=e.nominated;if("candidate-pair"===c&&"succeeded"===l&&h){if(r.prevStatInfo&&r.localCandidateId===u&&r.remoteCandidateId===d){var f=r.prevStatInfo;i=!0,Object.assign(t,{rtt:Math.floor(1e3*(n===f.responsesReceived?0:(a-f.totalRoundTripTime)/(n-f.responsesReceived))),bytesSent:this.muted?0:Math.floor((o-f.bytesSent)/(s-f.timestamp)*1e3)})}else r.localCandidateId=u,r.remoteCandidateId=d,r.prevStatInfo={};Object.assign(r.prevStatInfo,{totalRoundTripTime:a,responsesReceived:n,bytesSent:o,timestamp:s})}return i}},{key:"_publisherLocalCadidateParse",value:function(e,t){var r=e.id;if("local-candidate"===e.type&&r===t.localCandidateId){var i=e.ip,a=e.port,n=e.networkType;t.localCA&&t.localCA.ip===i&&t.localCA.port===a&&t.localCA.networkType===n||(t.localCA={ip:i,port:a,networkType:n},Ta("SELCA"+",".concat(i)+",".concat(a)+",".concat(n)))}}},{key:"_publisherRemoteCadidateParse",value:function(e,t){var r=e.id;if("remote-candidate"===e.type&&r===t.remoteCandidateId){var i=e.ip,a=e.port;t.remoteCA&&t.remoteCA.ip===i&&t.remoteCA.port===a||(t.remoteCA={ip:i,port:a},Ta("SERCA"+",".concat(i)+",".concat(a)))}}},{key:"_subscriberStatsParse",value:(t=d()(g.a.mark((function e(t){var r,i,a,n,o=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.subscriber){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.subscriber.getStats();case 4:if(r=e.sent){e.next=7;break}return e.abrupt("return");case 7:i={ssrcMap:{}},a=!1,n=this.monitorInfo.subscriber,r.forEach((function(e){t||(a=o._subscriberCandidatePairParse(e,i)||a,o._subscriberLocalCadidateParse(e),o._subscriberRemoteCandidateParse(e)),a=o._subscriberInboundRTPParse(e,i,n,t)||a})),a&&Oa(i);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_subscriberCandidatePairParse",value:function(e,t){var r=!1,i=this.monitorInfo.subscriber,a=e.totalRoundTripTime,n=e.responsesReceived,o=e.localCandidateId,s=e.remoteCandidateId,u=e.type,d=e.state,c=e.nominated;if("candidate-pair"===u&&"succeeded"===d&&c){if(i.prevStatInfo&&i.localCandidateId===o&&i.remoteCandidateId===s){var l=i.prevStatInfo;r=!0,Object.assign(t,{rtt:Math.floor(1e3*(n===l.responsesReceived?0:(a-l.totalRoundTripTime)/(n-l.responsesReceived)))})}else i.localCandidateId=o,i.remoteCandidateId=s,i.prevStatInfo={},i.ssrcMap={},r=!1;Object.assign(i.prevStatInfo,{totalRoundTripTime:a,responsesReceived:n})}return r}},{key:"_subscriberLocalCadidateParse",value:function(e){var t=e.id,r=e.type,i=this.monitorInfo.subscriber;if("local-candidate"===r&&t===i.localCandidateId){var a=e.ip,n=e.port,o=e.networkType;i.localCA&&i.localCA.ip===a&&i.localCA.port===n&&i.localCA.networkType===o||(i.localCA={ip:a,port:n,networkType:o},Ta("RELCA"+",".concat(a)+",".concat(n)+",".concat(o)))}}},{key:"_subscriberRemoteCandidateParse",value:function(e){var t=e.id,r=e.type,i=this.monitorInfo.subscriber;if("remote-candidate"===r&&t===i.remoteCandidateId){var a=e.ip,n=e.port;i.remoteCA&&i.remoteCA.ip===a&&i.remoteCA.port===n||(i.remoteCA={ip:a,port:n},Ta("RERCA"+",".concat(a)+",".concat(n)))}}},{key:"_subscriberInboundRTPParse",value:function(e,t,r,i){var a=void 0;if("inbound-rtp"===e.type){var n=e.totalAudioEnergy,o=e.timestamp,s=e.jitterBufferDelay,u=e.jitterBufferEmittedCount,d=e.ssrc,c=e.jitter,l=e.audioLevel,h=e.packetsLost,f=e.packetsReceived,p=e.bytesReceived,v=this.ssrcUserIdMap.get(d);if(Oa({key:"".concat(d,"-").concat(v),audioLevel:da(l),onlyAudioLevel:!0}),i)return!1;r.ssrcMap||(r.ssrcMap={});var m=r.ssrcMap[d];if(m){if(v){a=!0;var g=Math.sqrt((n-m.totalAudioEnergy)/(o-m.timestamp)).toFixed(4),_=-1;"number"==typeof l&&(_=l.toFixed(4));var S=Math.floor(1e3*(u===m.jitterBufferEmittedCount?0:(s-m.jitterBufferDelay)/(u-m.jitterBufferEmittedCount)));t.ssrcMap["".concat(d,"-").concat(v)]=Object.assign(t.ssrcMap["".concat(d,"-").concat(v)]||{},{aveAudioLevel:g<1e-4?0:g,audioLevel:_<1e-4?0:_,aveJitterBufferDelay:S,jitter:c,packetsLost:h-m.packetsLost,packetsReceived:Math.floor((f-m.packetsReceived)/(o-m.timestamp)*1e3),bytesReceived:Math.floor((p-m.bytesReceived)/(o-m.timestamp)*1e3)})}}else m=r.ssrcMap[d]={},a=!1;this.isUserMuted(d)||!this.ssrcUserIdMap.has(d)?r.ssrcMap[d]=null:Object.assign(m,{totalAudioEnergy:n,timestamp:o,jitterBufferDelay:s,jitterBufferEmittedCount:u,packetsLost:h,packetsReceived:f,bytesReceived:p})}return a}},{key:"changeDenoiseSwitch",value:function(e,t){var r;this.denoiseSwitch=e,this.isHeadSet=t,null===(r=this.webRTCWorkletManager)||void 0===r||r.changeDenoiseSwitch(e,t)}},{key:"updateQos",value:function(e){this.signal&&this.signal.notify("qos",{enable:e.enable,encoding:parseInt(e.workerType),pollingInterval:e.pollingInterval})}}]),e}();function Na(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function Va(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.db;this.onOffer,this.isRtcConnected=!1,this.isDestroyed=!1,this.audioMode=t,this.leaveTime=0,this.heartBeatDetection=null,this.publishPeerConnection=!1,this.subscribPeerConnection=!1,this.onopen=function(e){this._onopen=e},this.onclose=function(e){this._onclose=e},this.onerror=function(e){this._onerror=e},this.init=function(e){var t=this;Ta("INIT: ".concat(e)),this.socket=window.audioBridgeSignal=new WebSocket(e),this._notifyhandlers={},this.socket.addEventListener("open",(function(){Ta("WSO"),t.lastMessageTimeStamp=performance.now(),t.ping(),t.heartBeatDetection&&(clearTimeout(t.heartBeatDetection),t.heartBeatDetection=null),t.heartBeatDetection=setTimeout(function e(){var t;if(!this.isDestroyed&&1===(null===(t=this.socket)||void 0===t?void 0:t.readyState)){var r=performance.now()-this.lastMessageTimeStamp;r>32e3?(Ta("WST"),Y.default.error("didn't reveive message from websocket in the last 30s, notify UI failover, duration:  "+r),Z.default.Notify_APPUI(M.NOTIFY_UI_FAILOVER,x.v)):this.heartBeatDetection=setTimeout(e.bind(this),2e3)}}.bind(t),2e3),t.audioMode&&t.notify("audiostatus",{status:t.audioMode}),t._onopen&&t._onopen()})),this.socket.addEventListener("error",(function(e){t.isDestroyed||(Y.default.error("Audio Bridge WebSocket received error",e),Ta("WSE"),!t.audioMode&&Date.now()-t.leaveTime>=15e3?t._onerror&&t._onerror(e||!0):Z.default.Notify_APPUI&&(Y.default.error("socket error, notify UI failover: "+x.gb),Z.default.Notify_APPUI(M.NOTIFY_UI_FAILOVER,x.gb)))})),this.socket.addEventListener("close",(function(e){t.isDestroyed||(Y.default.error("Audio Bridge WebSocket close",e),Ta("WSC"),!t.audioMode&&Date.now()-t.leaveTime>=15e3?t._onclose&&t._onclose(e||!0):Z.default.Notify_APPUI&&(Y.default.error("socket close, notify UI failover: "+x.fb),Z.default.Notify_APPUI(M.NOTIFY_UI_FAILOVER,x.fb)))})),this.socket.addEventListener("message",function(){var e=d()(g.a.mark((function e(r){var i,a,n,o,s;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.lastMessageTimeStamp=performance.now(),"closing"!==(i=JSON.parse(r.data)).method){e.next=12;break}return(a=i.params.reason)===x.C?a="0"+(t.publishPeerConnection?"1":"0"):a===x.L&&(a="1"+(t.subscribPeerConnection?"1":"0")),Ta("closing: "+a),Y.default.error("received closing from audioBridge, notify UI failover: "+a),t.destroy(),Z.default.Notify_APPUI&&Z.default.Notify_APPUI(M.NOTIFY_UI_FAILOVER,a),e.abrupt("return");case 12:"offer"===i.method?t.onOffer&&t.onOffer(i.params):"trickle"===i.method?t.onTrickle&&t.onTrickle(i.params.candidate,i.params.role):"rtcpsr"===i.method?t.UpdateNTP(i.params.ntptime,i.params.rtptime,i.params.ssrc,i.params.abssrc):"qos"===i.method?((n=i.params).encoding=n.encoding===parseInt(J.f.AUDIO_ENCODE),n.sample_rate=48,Z.default.Notify_APPUI_SAFE(M.AUDIO_QOS_DATA,n)):"pong"===i.result?(o=parseInt(performance.now())-i.id,Ta("RTT: "+o)):(s=t._notifyhandlers[i.method])&&s(i.params);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},this.on_notify=function(e,t){this._notifyhandlers[e]=t},this.notify=function(e,t,r){var i;this.isDestroyed?Y.default.error("audioBridge instance is destroyed, method ".concat(e)):this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(JSON.stringify({method:e,params:t,id:r})):Y.default.error("Websocket is not open: ".concat(this.socket.readyState,", ").concat(null===(i=this.socket)||void 0===i?void 0:i.url))},this.call=function(){var e=d()(g.a.mark((function e(t,r){var i,a,n=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Na(),!this.socket||this.socket.readyState!==WebSocket.OPEN){e.next=5;break}this.socket.send(JSON.stringify({method:t,params:r,id:i})),e.next=7;break;case 5:return Y.default.error("Websocket is not open: ".concat(this.socket.readyState,", ").concat(null===(a=this.socket)||void 0===a?void 0:a.url)),e.abrupt("return");case 7:return e.abrupt("return",new Promise((function(e,t){n.socket.addEventListener("message",(function t(r){var a=JSON.parse(r.data);a.id===i&&(a.error?e(a):e(a.result),n.socket.removeEventListener("message",t))}))})));case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),this.ping=function(){e.notify("ping",{},parseInt(performance.now())),e.pingTimeout&&clearTimeout(e.pingTimeout),e.pingTimeout=setTimeout((function(){e.ping()}),1e4)},this.destroy=function(){e.isDestroyed=!0,e.publishPeerConnection=!1,e.subscribPeerConnection=!1,e.pingTimeout&&(clearTimeout(e.pingTimeout),e.pingTimeout=null),e.heartBeatDetection&&(clearTimeout(e.heartBeatDetection),e.heartBeatDetection=null),e.socket&&e.socket.close&&e.socket.close(3456,"close socket when destroy signal")}}function Ua(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return La(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return La(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function La(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var Wa,Ba=11,Ga=function(){function e(){l()(this,e)}var t,r;return f()(e,null,[{key:"init",value:(r=d()(g.a.mark((function e(t,r){var i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.navigator.hid&&window.navigator.hid.requestDevice){e.next=2;break}return e.abrupt("return",!1);case 2:return i=this.webHid=new Fa((function(e){switch(e.eventName){case"ondevicehookswitch":Z.default.Notify_APPUI_SAFE(M.HID_STATUS_OFF_HOOK,"on"===e.hookStatus);break;case"ondevicemuteswitch":Z.default.Notify_APPUI_SAFE(M.HID_STATUS_MUTE,e.isMute)}})),e.next=5,i.open({label:t,muted:r,hookStatus:"off"});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"sendReport",value:function(e,t){switch(e){case"hookswitch":this.webHid.sendDeviceReport({command:t?"offHook":"onHook"});break;case"mute":this.webHid.sendDeviceReport({command:t?"muteOn":"muteOff"})}}},{key:"destroy",value:(t=d()(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.webHid.close();case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),Fa=function(){function e(t){l()(this,e),this.deviceUsage={mute:{usageId:524297,usageName:"Mute"},offHook:{usageId:524311,usageName:"Off Hook"},ring:{usageId:524312,usageName:"Ring"},hookSwitch:{usageId:720928,usageName:"Hook Switch"},phoneMute:{usageId:720943,usageName:"Phone Mute"}},this.deviceCommand={outputReport:{mute:{reportId:0,usageOffset:-1},offHook:{reportId:0,usageOffset:-1},ring:{reportId:0,itemIndex:-1}},inputReport:{hookSwitch:{reportId:0,usageOffset:-1,isAbsolute:!1},phoneMute:{reportId:0,usageOffset:-1,isAbsolute:!1}}},this.device=null,this.inputReportRetFunc=t}var t,r,i,a;return f()(e,[{key:"getHexByte",value:function(e){for(var t=Number(e).toString(16);t.length<2;)t="0"+t;return t}},{key:"getHexByteStr",value:function(e){for(var t="",r=0;r<e.byteLength;++r)t+=this.getHexByte(e.getUint8(r))+" ";return t}},{key:"parseDeviceDescriptors",value:function(){try{if(this.outputEventGenerators=new Map,!this.device||!this.device.collections)return;var e=this.device.collections.find((function(e){return e.usagePage===Ba}));if(!e||0===Object.keys(e).length)return;if(e.inputReports&&!this.parseInputReports(e.inputReports))return!1;if(e.outputReports)return!!this.parseOutputReports(e.outputReports)}catch(e){console.error("parseDeviceDescriptors error:"+JSON.stringify(e,null,"    "))}}},{key:"parseInputReports",value:function(e){var t=this;return e.forEach((function(e){if(e.items.length&&void 0!==e.reportId){var r=0;e.items.forEach((function(i){void 0!==i.usages&&void 0!==i.reportSize&&void 0!==i.reportCount&&void 0!==i.isAbsolute&&(i.usages.forEach((function(a,n){switch(a){case t.deviceUsage.hookSwitch.usageId:t.deviceCommand.inputReport.hookSwitch={reportId:e.reportId,usageOffset:r+n*i.reportSize,isAbsolute:i.isAbsolute};break;case t.deviceUsage.phoneMute.usageId:t.deviceCommand.inputReport.phoneMute={reportId:e.reportId,usageOffset:r+n*i.reportSize,isAbsolute:i.isAbsolute}}})),r+=i.reportCount*i.reportSize)}))}})),0!==this.deviceCommand.inputReport.phoneMute.reportData&&0!==this.deviceCommand.inputReport.hookSwitch}},{key:"parseOutputReports",value:function(e){var t,r,i,a=this;for(var n in e.forEach((function(e){if(e.items.length&&void 0!==e.reportId){var t=0,r=new Map;e.items.forEach((function(i){void 0!==i.usages&&void 0!==i.reportSize&&void 0!==i.reportCount&&(i.usages.forEach((function(n,o){switch(n){case a.deviceUsage.mute.usageId:a.deviceCommand.outputReport.mute={reportId:e.reportId,usageOffset:t+o*i.reportSize},r.set(n,t+o*i.reportSize);break;case a.deviceUsage.offHook.usageId:a.deviceCommand.outputReport.offHook={reportId:e.reportId,usageOffset:t+o*i.reportSize},r.set(n,t+o*i.reportSize);break;case a.deviceUsage.ring.usageId:a.deviceCommand.outputReport.ring={reportId:e.reportId,usageOffset:t+o*i.reportSize},r.set(n,t+o*i.reportSize)}})),t+=i.reportCount*i.reportSize)}));var i,n=t,o=Ua(r);try{var s=function(){var e=O()(i.value,2),t=e[0],r=e[1];a.outputEventGenerators[t]=function(e){var t=new Uint8Array(n/8);if(r>=0&&e){var i=Math.trunc(r/8),a=r%8;t[i]=1<<a}return t}};for(o.s();!(i=o.n()).done;)s()}catch(e){o.e(e)}finally{o.f()}}})),this.outputEventGenerators){var o=this.getHexByte(n);o="0x0"+o,this.deviceUsage.mute.usageId===Number(o)?t=this.outputEventGenerators[this.deviceUsage.mute.usageId]:this.deviceUsage.offHook.usageId===Number(o)?i=this.outputEventGenerators[this.deviceUsage.offHook.usageId]:this.deviceUsage.ring.usageId===Number(o)&&(r=this.outputEventGenerators[this.deviceUsage.ring.usageId])}return!!(t||r||i)}},{key:"open",value:(a=d()(g.a.mark((function e(t){var r,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.hid.getDevices();case 2:if((r=e.sent).length&&(this.device=r.find((function(e){return t.label.includes(e.productName)}))),this.device){e.next=9;break}return e.next=7,navigator.hid.requestDevice({filters:[{usagePage:Ba}]});case 7:(i=e.sent).length&&(this.device=i.find((function(e){return t.label.includes(e.productName)})));case 9:if(this.device){e.next=11;break}return e.abrupt("return",!1);case 11:if(e.prev=11,!this.device.opened){e.next=15;break}return e.next=15,this.device.close();case 15:return e.next=17,this.device.open();case 17:if(this.parseDeviceDescriptors()){e.next=19;break}return e.abrupt("return",!1);case 19:return e.next=21,this.handleInputReport.bind(this);case 21:return this.device.oninputreport=e.sent,this.resetState({muted:t.muted,hookStatus:t.hookStatus}),e.abrupt("return",!0);case 26:e.prev=26,e.t0=e.catch(11),console.error("error content:"+e.t0);case 29:case"end":return e.stop()}}),e,this,[[11,26]])}))),function(e){return a.apply(this,arguments)})},{key:"close",value:(i=d()(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.resetState({muted:!1,hookStatus:"on"}),this.device){e.next=4;break}return e.abrupt("return");case 4:if(!this.device||!this.device.opened){e.next=7;break}return e.next=7,this.device.close();case 7:this.device.oninputreport=null,this.device=null,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0);case 14:case"end":return e.stop()}}),e,this,[[0,11]])}))),function(){return i.apply(this,arguments)})},{key:"resetState",value:function(e){var t=e.muted,r=e.hookStatus;this.device&&this.device.opened&&(this.device.hookStatus=r,this.device.muted=t,this.device.ring=!1,this.sendDeviceReport({command:"off"===r?"offHook":"onHook"}),this.sendDeviceReport({command:t?"muteOn":"muteOff"}))}},{key:"sendDeviceReport",value:(r=d()(g.a.mark((function e(t){var r,i,a,n,o,s,u,d,c,l,h,f,p,v,m,_,S,E,b,y,C,A,R,I,w,T;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.command&&this.device&&this.device.opened){e.next=2;break}return e.abrupt("return");case 2:if("muteOn"!==t.command&&"muteOff"!==t.command){e.next=7;break}if(this.outputEventGenerators[this.deviceUsage.mute.usageId]){e.next=5;break}return e.abrupt("return");case 5:e.next=15;break;case 7:if("onHook"!==t.command&&"offHook"!==t.command){e.next=12;break}if(this.outputEventGenerators[this.deviceUsage.offHook.usageId]){e.next=10;break}return e.abrupt("return");case 10:e.next=15;break;case 12:if("onRing"!==t.command&&"offRing"!==t.command){e.next=15;break}if(this.outputEventGenerators[this.deviceUsage.ring.usageId]){e.next=15;break}return e.abrupt("return");case 15:r=0,h=null,e.t0=t.command,e.next="muteOn"===e.t0||"muteOff"===e.t0?20:"onHook"===e.t0||"offHook"===e.t0?22:"onRing"===e.t0||"offRing"===e.t0?24:26;break;case 20:return r=this.deviceCommand.outputReport.mute.reportId,e.abrupt("break",27);case 22:return r=this.deviceCommand.outputReport.offHook.reportId,e.abrupt("break",27);case 24:return r=this.deviceCommand.outputReport.ring.reportId,e.abrupt("break",27);case 26:return e.abrupt("return");case 27:if(0!=r){e.next=29;break}return e.abrupt("return");case 29:if(a=this.device.muted,"off"!==this.device.hookStatus){e.next=34;break}i=!0,e.next=39;break;case 34:if("on"!==this.device.hookStatus){e.next=38;break}i=!1,e.next=39;break;case 38:return e.abrupt("return");case 39:n=this.device.ring,e.t1=t.command,e.next="muteOn"===e.t1?43:"muteOff"===e.t1?45:"onHook"===e.t1?47:"offHook"===e.t1?49:"onRing"===e.t1?51:"offRing"===e.t1?53:55;break;case 43:return s=!0,e.abrupt("break",56);case 45:return s=!1,e.abrupt("break",56);case 47:return o=!1,e.abrupt("break",56);case 49:return o=!0,e.abrupt("break",56);case 51:return u=!0,e.abrupt("break",56);case 53:return u=!1,e.abrupt("break",56);case 55:return e.abrupt("return");case 56:if(this.outputEventGenerators[this.deviceUsage.mute.usageId]&&(c=void 0===s?this.outputEventGenerators[this.deviceUsage.mute.usageId](a):this.outputEventGenerators[this.deviceUsage.mute.usageId](s)),this.outputEventGenerators[this.deviceUsage.offHook.usageId]&&(d=void 0===o?this.outputEventGenerators[this.deviceUsage.offHook.usageId](i):this.outputEventGenerators[this.deviceUsage.offHook.usageId](o)),this.outputEventGenerators[this.deviceUsage.ring.usageId]&&(l=void 0===u?this.outputEventGenerators[this.deviceUsage.ring.usageId](n):this.outputEventGenerators[this.deviceUsage.ring.usageId](u)),r===this.deviceCommand.outputReport.mute.reportId)if(null===h)h=new Uint8Array(c);else{f=Ua(c.entries());try{for(f.s();!(p=f.n()).done;)v=O()(p.value,2),m=v[0],_=v[1],h[m]|=_}catch(e){f.e(e)}finally{f.f()}}if(r===this.deviceCommand.outputReport.offHook.reportId)if(null===h)h=new Uint8Array(d);else{S=Ua(d.entries());try{for(S.s();!(E=S.n()).done;)b=O()(E.value,2),y=b[0],C=b[1],h[y]|=C}catch(e){S.e(e)}finally{S.f()}}if(r===this.deviceCommand.outputReport.ring.reportId)if(null===h)h=new Uint8Array(l);else{A=Ua(l.entries());try{for(A.s();!(R=A.n()).done;)I=O()(R.value,2),w=I[0],T=I[1],h[w]|=T}catch(e){A.e(e)}finally{A.f()}}return e.next=64,this.device.sendReport(r,h);case 64:e.t2=t.command,e.next="muteOn"===e.t2?67:"muteOff"===e.t2?69:"onHook"===e.t2?71:"offHook"===e.t2?73:"onRing"===e.t2?75:"offRing"===e.t2?77:79;break;case 67:return this.device.muted=!0,e.abrupt("break",80);case 69:return this.device.muted=!1,e.abrupt("break",80);case 71:return this.device.hookStatus="on",e.abrupt("break",80);case 73:return this.device.hookStatus="off",e.abrupt("break",80);case 75:return this.device.ring=!0,e.abrupt("break",80);case 77:return this.device.ring=!1,e.abrupt("break",80);case 79:return e.abrupt("break",80);case 80:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"sendReplyReport",value:(t=d()(g.a.mark((function e(t,r,i){var a,n,o,s,u,d,c,l,h,f;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=0,this.deviceCommand.outputReport.offHook.reportId===this.deviceCommand.outputReport.mute.reportId||t===this.deviceCommand.inputReport.hookSwitch.reportId?a=this.deviceCommand.outputReport.offHook.reportId:t===this.deviceCommand.inputReport.phoneMute.reportId&&(a=this.deviceCommand.outputReport.mute.reportId),this.device&&this.device.opened){e.next=4;break}return e.abrupt("return");case 4:if(0!==a&&void 0!==r&&void 0!==i){e.next=6;break}return e.abrupt("return");case 6:if(this.deviceCommand.outputReport.offHook.reportId===this.deviceCommand.outputReport.mute.reportId){o=this.outputEventGenerators[this.deviceUsage.mute.usageId](i),s=this.outputEventGenerators[this.deviceUsage.offHook.usageId](r),n=new Uint8Array(s),d=Ua(o.entries());try{for(d.s();!(c=d.n()).done;)l=O()(c.value,2),h=l[0],f=l[1],n[h]|=f}catch(e){d.e(e)}finally{d.f()}}else a===this.deviceCommand.outputReport.offHook.reportId?(s=this.outputEventGenerators[this.deviceUsage.offHook.usageId](r),n=new Uint8Array(s)):a===this.deviceCommand.outputReport.mute.reportId?(o=this.outputEventGenerators[this.deviceUsage.mute.usageId](i),n=new Uint8Array(o)):a===this.deviceCommand.outputReport.ring.reportId&&(u=this.outputEventGenerators[this.deviceUsage.mute.usageId](i),n=new Uint8Array(u));return e.next=9,this.device.sendReport(a,n);case 9:case"end":return e.stop()}}),e,this)}))),function(e,r,i){return t.apply(this,arguments)})},{key:"handleInputReport",value:function(e){try{var t=e.data,r=e.device,i=e.reportId;if(0===i)return;var a=this.deviceCommand.inputReport;if(i!==a.hookSwitch.reportId&&i!==a.phoneMute.reportId)return;var n=!1,o=!1,s=new Uint8Array(t.buffer);if(i===a.hookSwitch.reportId){var u=a.hookSwitch,d=Math.trunc(u.usageOffset/8),c=u.usageOffset%8,l=0!=(t.getUint8(d)&1<<c);a.hookSwitch.isAbsolute?"on"===this.device.hookStatus&&l?(this.device.hookStatus="off",n=!0):"off"!==this.device.hookStatus||l||(this.device.hookStatus="on",n=!0):l&&(this.device.hookStatus="off"===this.device.hookStatus?"on":"off",n=!0)}this.device.muted;if(i===a.phoneMute.reportId){var h=a.phoneMute,f=Math.trunc(h.usageOffset/8),p=h.usageOffset%8,v=0!=(t.getUint8(f)&1<<p);a.phoneMute.isAbsolute?this.device.muted!=v&&(this.device.muted=v,o=!0):v&&(this.device.muted=!this.device.muted,o=!0)}var m={productName:r.productName,reportId:this.getHexByte(i),reportData:s};if(n&&(m.eventName="ondevicehookswitch",m.hookStatus=this.device.hookStatus),o&&(m.eventName="ondevicemuteswitch",m.isMute=this.device.muted),this.inputReportRetFunc&&this.inputReportRetFunc(m),n||o){var g;if("off"===this.device.hookStatus)g=!0;else{if("on"!==this.device.hookStatus)return;g=!1}this.sendReplyReport(i,g,this.device.muted)}}catch(e){console.error(e)}}}]),e}(),Ha=r(35),ja=r.n(Ha),Ka=(Wa={},v()(Wa,J.f.AUDIO_ENCODE,"audioEncodeInitInstance"),v()(Wa,J.f.AUDIO_DECODE,"audioDecInitInstance"),v()(Wa,J.f.VIDEO_ENCODE,"videoInitInstance"),v()(Wa,J.f.VIDEO_DECODE,"videoDecInitInstance"),v()(Wa,J.f.SHARING_ENCODE,"sharingEncInitInstance"),v()(Wa,J.f.SHARING_DECODE,"sharingDecInitInstance"),Wa);function qa(){return Xa.apply(this,arguments)}function Xa(){return(Xa=d()(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Ha.FileWriter({maxDaysToKeepFile:1,fileSizeQuota:10485760}),e.abrupt("return",new Promise((function(e){t.on("initOK",(function(){e(t)}))})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ya=function(){function e(){l()(this,e),this.logWriterMap=window.logWriterMap=new Map,this.inited=!1}var t;return f()(e,[{key:"init",value:(t=d()(g.a.mark((function e(){var t=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.inited){e.next=2;break}return e.abrupt("return");case 2:this.inited=!0,Object.values(J.f).forEach(function(){var e=d()(g.a.mark((function e(r){var i,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qa();case 2:return i=e.sent,t.logWriterMap.set(r,i),e.next=6,Z.default[Ka[r]].waitforInitSuccess();case 6:a=i.createMessagePort(),Wr(r,a,"local_log_port",!0,!0),i.startWriteNormalLogFile({filenamePrefix:J.g[r],filenameExtension:".log",timestamp:!1,newLine:!1}),i.on("startWriteNormalLogFileReady",(function(){Wr(r,null,"local_log_ready",!1,!0)}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"saveLogFileByWorkerType",value:function(e){var t=this.logWriterMap.get(e);t&&t.saveLog()}},{key:"saveAllLogFiles",value:function(){ja.a.selectSaveDir().then((function(){Object.values(J.f).forEach((function(e){ja.a.saveLog({filenamePrefix:J.g[e],filenameExtension:".log"})}))}))}}]),e}(),za=function(){function e(){var t=this;l()(this,e),this.pressureLevel={nominal:0,fair:1,serious:2,critical:3},this.observer=new PressureObserver((function(e){t.result=t.pressureLevel[e[0].state],Q.default.add_monitor("CPC:"+t.result)}))}return f()(e,[{key:"init",value:function(){this.observer.observe("cpu")}},{key:"destroy",value:function(){this.observer.unobserve("cpu")}}]),e}();v()(za,"isSupportComputePressure",(function(){return"function"==typeof PressureObserver}));var Qa=r(1),Ja=r.n(Qa),Za=r(8),$a=r.n(Za);function en(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return tn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tn(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function tn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function rn(e,t){nn(e,t),t.add(e)}function an(e,t,r){nn(e,t),t.set(e,r)}function nn(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function on(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}var sn=new WeakMap,un=new WeakMap,dn=new WeakMap,cn=new WeakMap,ln=new WeakMap,hn=new WeakMap,fn=new WeakMap,pn=new WeakMap,vn=new WeakMap,mn=new WeakMap,gn=new WeakMap,_n=new WeakMap,Sn=new WeakMap,En=new WeakMap,bn=new WeakMap,yn=new WeakMap,Cn=new WeakMap,An=new WeakMap,Rn=new WeakMap,In=new WeakMap,wn=new WeakMap,Tn=new WeakMap,kn=new WeakMap,Dn=new WeakMap,On=new WeakMap,Mn=new WeakSet,xn=new WeakSet,Pn=new WeakSet,Nn=new WeakSet,Vn=new WeakSet,Un=new WeakSet,Ln=new WeakSet,Wn=new WeakSet,Bn=new WeakSet,Gn=new WeakSet,Fn=new WeakSet,Hn=new WeakSet,jn=new WeakSet,Kn=new WeakSet,qn=new WeakSet,Xn=new WeakSet,Yn=new WeakSet,zn=new WeakSet,Qn=new WeakSet,Jn=new WeakSet;function Zn(e){e&&e.forEach((function(e){e.markRenderingStatePending()}));var t=on(this,qn,fo).call(this,e);if(Ja()(this,pn)&&Ja()(this,fn)&&Ja()(this,gn))if(Ja()(this,sn)&&0!=Ja()(this,sn).width&&0!=Ja()(this,sn).height&&Ja()(this,fn)&&Ja()(this,fn).getCurrentTexture()&&0!=Ja()(this,fn).getCurrentTexture().width&&0!=Ja()(this,fn).getCurrentTexture().height)try{if(!Ja()(this,En)){var r=Ja()(this,On).byteLength,i=r;$a()(this,En,Ja()(this,gn).acquireBuffer(i,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE,r,!0,!1)),new Float32Array(Ja()(this,En).getMappedRange()).set(Ja()(this,On)),Ja()(this,En).unmap()}var a,n=on(this,Ln,ao).call(this),o=en(t);try{for(o.s();!(a=o.n()).done;){var s=O()(a.value,2),u=s[0],d=s[1];on(this,Yn,vo).call(this,u,d,n)}}catch(e){o.e(e)}finally{o.f()}var c=on(this,Kn,ho).call(this,Ja()(this,fn).getCurrentTexture().createView()),l=n.beginRenderPass(c);l.setVertexBuffer(0,Ja()(this,En));var h,f=en(t);try{for(f.s();!(h=f.n()).done;){var p=O()(h.value,2),v=(p[0],p[1]);if(v&&0!=v.length){var m,g=en(v);try{for(g.s();!(m=g.n()).done;){var _=m.value;if(_.unlock(),_.getTextureLayerType()!=Si.v.UNKNOWN){var S=_.getTextureType(),E=_.getUVCoords();if(S===Si.x.CLEAR_COLOR||E){var b=Ja()(this,sn).width,y=Ja()(this,sn).height,C=_.getViewport();if(!(!C||Number.isNaN(C.x)||Number.isNaN(C.y)||Number.isNaN(C.w)||Number.isNaN(C.h)||C.x<0||C.y<0)){if(C.x+C.w>b){var A=C.x+C.w-b;if(!(A>0&&A<=Si.i))continue;C.w-=A,C.w<=0&&(C.w=1)}if(C.y+C.h>y){var R=C.y+C.h-y;if(!(R>0&&R<=Si.i))continue;C.h-=R,C.h<=0&&(C.h=1)}var I=on(this,Xn,po).call(this,_);if(I){if(I.pipelineType!==Si.l.CLEAR_COLOR){var w=_.getUVCoordsBuffer();if(!w){var T=E.byteLength;w=Ja()(this,gn).acquireBuffer(T,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,E.byteLength,!1,!1),_.setUVCoordsBuffer(w)}Ja()(this,pn).queue.writeBuffer(w,0,E,0,E.length),l.setVertexBuffer(1,w)}l.setViewport(C.x,C.y,C.w,C.h,C.minDepth,C.maxDepth);var k=I.pipeline;l.setPipeline(k);var D=Ja()(this,pn).createBindGroup({layout:k.getBindGroupLayout(0),entries:I.entries});l.setBindGroup(0,D),l.draw(6,1,0,0)}}}}}}catch(e){g.e(e)}finally{g.f()}}}}catch(e){f.e(e)}finally{f.f()}l.end(),on(this,Wn,no).call(this)}catch(e){Object(bi.f)("[WebGUPRenderer] renderNoMsaa() error:".concat(e.message))}finally{Ja()(this,hn).recycleInUsedGPUBuffers(t)}else Ja()(this,hn).recycleInUsedGPUBuffers(t);else Ja()(this,hn).recycleInUsedGPUBuffers(t)}function $n(e){if(Ja()(this,pn)&&Ja()(this,fn)){var t=Ja()(this,pn).createBuffer({label:"VertexBuffer",size:Ja()(this,On).byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE,mappedAtCreation:!0});new Float32Array(t.getMappedRange()).set(Ja()(this,On)),t.unmap();var r,i=on(this,Ln,ao).call(this),a=on(this,qn,fo).call(this,e),n=en(a);try{for(n.s();!(r=n.n()).done;){var o=O()(r.value,2),s=o[0],u=o[1];on(this,Yn,vo).call(this,s,u,i)}}catch(e){n.e(e)}finally{n.f()}var d=on(this,Jn,_o).call(this,Ja()(this,sn)),c=on(this,jn,lo).call(this,0,d.createView(),Ja()(this,fn).getCurrentTexture().createView()),l=i.beginRenderPass(c);l.setVertexBuffer(0,t);var h,f=en(a);try{for(f.s();!(h=f.n()).done;){var p=O()(h.value,2),v=(p[0],p[1]);if(v&&0!=v.length){var m,g=en(v);try{for(g.s();!(m=g.n()).done;){var _=m.value;if(_.unlock(),_.getTextureLayerType()!=Si.v.UNKNOWN){var S=_.getUVCoords();if(S){var E=_.getUVCoordsBuffer();if(!E){var b=S.byteLength;E=Ja()(this,gn).acquireBuffer(b,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,S.byteLength,!1,!0),_.setUVCoordsBuffer(E)}Ja()(this,pn).queue.writeBuffer(E,0,S,0,S.length),l.setVertexBuffer(1,E);var y=Ja()(this,sn).width,C=Ja()(this,sn).height,A=_.getViewport();if(!(!A||Number.isNaN(A.x)||Number.isNaN(A.y)||Number.isNaN(A.w)||Number.isNaN(A.h)||A.x<0||A.y<0||A.x+A.w>y||A.y+A.h>C)){var R=on(this,Xn,po).call(this,_,!0);if(R){l.setViewport(A.x,A.y,A.w,A.h,A.minDepth,A.maxDepth);var I=R.pipeline;l.setPipeline(I);var w=Ja()(this,pn).createBindGroup({layout:I.getBindGroupLayout(0),entries:R.entries});l.setBindGroup(0,w),l.draw(6,1,0,0)}}}}}}catch(e){g.e(e)}finally{g.f()}}}}catch(e){f.e(e)}finally{f.f()}l.end(),on(this,Wn,no).call(this),e.forEach((function(e){e.markRenderingStatePending()}))}}function eo(e){if(Array.isArray(e)){for(var t=[],r=0;r<e.length;++r){var i=e[r];t.push(i.x),t.push(i.y)}Ja()(this,On).set(t,0)}}function to(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.getTextureBufferGroup();if(!Ja()(this,pn))return console.warn("[evalYuvTextureGroup] GPUDevice is not ready!"),i&&i.buffer&&i.buffer.unmap(),null;if(!t)return console.warn("[evalYuvTextureGroup] command encoder is invalid!"),i&&i.buffer&&i.buffer.unmap(),null;if(!i)return r||null;"unmapped"!=i.buffer.mapState&&i.buffer.unmap();var a=null,n=null,o=null,s=e.getWidth(),u=e.getHeight(),d=null!=r&&(s!=r.yPlaneTex.width||u!=r.yPlaneTex.height),c=!0;r&&(d?(Ja()(this,hn).destroyTextureGroup(e),c=!0):(a=r.yPlaneTex,n=r.uPlaneTex,o=r.vPlaneTex,c=!1));var l=!1,h="r8unorm";if(i&&i.bufferConfig&&"nv12"==i.bufferConfig.colorFormat&&(h="rg8unorm",l=!0),c){var f=e.getIndex(),p=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC,v=Ja()(this,Sn).assembleTextureConfig(s,u,p,"r8unorm",1),m=Ja()(this,Sn).assembleTextureConfig(s/2,u/2,p,h,1);(a=Ja()(this,Sn).acquireTexture(v))&&(a.label="RD(".concat(f,")-YPlaneTexture")),l?(n=Ja()(this,Sn).acquireTexture(m))&&(n.label="RD(".concat(f,")-UVPlaneTexture")):((n=Ja()(this,Sn).acquireTexture(m))&&(n.label="RD(".concat(f,")-UPlaneTexture")),(o=Ja()(this,Sn).acquireTexture(m))&&(o.label="RD(".concat(f,")-VPlaneTexture")))}t.copyBufferToTexture({buffer:i.buffer,offset:i.yPlaneBuffer.offset,bytesPerRow:i.yPlaneBuffer.bytesPerRow,rowsPerImage:i.yPlaneBuffer.rowsPerImage},{texture:a},[s,u,1]),t.copyBufferToTexture({buffer:i.buffer,offset:i.uPlaneBuffer.offset,bytesPerRow:i.uPlaneBuffer.bytesPerRow,rowsPerImage:i.uPlaneBuffer.rowsPerImage},{texture:n},[s/2,u/2,1]),i.vPlaneBuffer.offset>0&&!l&&t.copyBufferToTexture({buffer:i.buffer,offset:i.vPlaneBuffer.offset,bytesPerRow:i.vPlaneBuffer.bytesPerRow,rowsPerImage:i.vPlaneBuffer.rowsPerImage},{texture:o},[s/2,u/2,1]);var g={};return g.yPlaneTex=a,g.uPlaneTex=n,g.vPlaneTex=o,g}function ro(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.getTextureBufferGroup();if(!Ja()(this,pn))return console.warn("[evalRgbaTexture] GPUDevice is not ready!"),i&&i.buffer&&i.buffer.unmap(),null;if(!t)return console.warn("[evalRgbaTexture] command encoder is invalid!"),i&&i.buffer&&i.buffer.unmap(),null;if(!i)return r||null;"unmapped"!=i.buffer.mapState&&i.buffer.unmap();var a=e.getIndex(),n=e.getWidth(),o=e.getHeight(),s=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC,u=null,d=null!=r&&(n!=r.width||o!=r.height),c=!0;if(r&&(d?(Ja()(this,hn).destroyTextureGroup(e),c=!0):(u=r,c=!1)),c){var l=Ja()(this,Sn).assembleTextureConfig(n,o,s,"rgba8unorm",1);(u=Ja()(this,Sn).acquireTexture(l))&&(u.label="RD(".concat(a,")-rgbaTexture"))}return t.copyBufferToTexture({buffer:i.buffer,offset:0,bytesPerRow:i.bytesPerRow,rowsPerImage:i.rowsPerImage},{texture:u},[n,o,1]),u}function io(e,t){return Math.ceil(e/t)*t}function ao(){return Ja()(this,pn)?(Ja()(this,mn)||$a()(this,mn,Ja()(this,pn).createCommandEncoder()),Ja()(this,mn)):(Object(bi.f)("GPUDevice is not ready! No available command encoder."),null)}function no(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Ja()(this,mn)&&e?Ja()(this,pn).queue.submit([Ja()(this,mn).finish(),e.finish()]):Ja()(this,mn)?Ja()(this,pn).queue.submit([Ja()(this,mn).finish()]):e&&Ja()(this,pn).queue.submit([e.finish()]),$a()(this,mn,null)}function oo(e,t){if(!Ja()(this,pn))return null;if(!Ja()(this,Tn)){var r=Ja()(this,pn).createBindGroupLayout({label:"CursorTexBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]});if(!r)return null;var i=Ja()(this,pn).createPipelineLayout({label:"CursorTexPipelineLayout(".concat(e,")"),bindGroupLayouts:[r]}),a={label:"CursorTexRenderPipeline(".concat(e,")"),layout:i,vertex:{module:Ja()(this,pn).createShaderModule({code:Si.e}),entryPoint:"v_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:Ja()(this,pn).createShaderModule({code:Si.e}),entryPoint:"f_main",targets:[{format:Ja()(this,vn),blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"}};t&&(a.multisample={count:4}),$a()(this,Tn,Ja()(this,pn).createRenderPipeline(a))}return Ja()(this,Tn)}function so(e,t){if(!Ja()(this,pn))return null;if(!Ja()(this,wn)){var r=Ja()(this,pn).createBindGroupLayout({label:"WatermarkTexBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}}]});if(!r)return null;var i=Ja()(this,pn).createPipelineLayout({label:"WatermarkTexPipelineLayout(".concat(e,")"),bindGroupLayouts:[r]}),a={label:"WatermarkTexRenderPipeline(".concat(e,")"),layout:i,vertex:{module:Ja()(this,pn).createShaderModule({code:Si.B}),entryPoint:"v_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:Ja()(this,pn).createShaderModule({code:Si.B}),entryPoint:"f_main",targets:[{format:Ja()(this,vn),blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"}};t&&(a.multisample={count:4}),$a()(this,wn,Ja()(this,pn).createRenderPipeline(a))}return Ja()(this,wn)}function uo(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Ja()(this,pn)||!e)return null;if(!Ja()(this,An)){var r=Ja()(this,pn).createBindGroupLayout({label:"YuvBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:4,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:5,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:6,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),i=Ja()(this,pn).createPipelineLayout({label:"YuvPipelineLayout",bindGroupLayouts:[r]}),a={label:"YuvRenderPipeline",layout:i,vertex:{module:Ja()(this,pn).createShaderModule({code:e}),entryPoint:"vertex_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:Ja()(this,pn).createShaderModule({code:e}),entryPoint:"fragment_main",targets:[{format:Ja()(this,vn)}]},primitive:{topology:"triangle-list"}};t&&(a.multisample={count:4}),$a()(this,An,Ja()(this,pn).createRenderPipeline(a))}return Ja()(this,An)}function co(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Ja()(this,pn)||!e)return null;if(!Ja()(this,Rn)){var r=Ja()(this,pn).createBindGroupLayout({label:"YuvBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:4,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:5,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),i=Ja()(this,pn).createPipelineLayout({label:"YuvPipelineLayout",bindGroupLayouts:[r]}),a={label:"YuvRenderPipeline",layout:i,vertex:{module:Ja()(this,pn).createShaderModule({code:e}),entryPoint:"vertex_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:Ja()(this,pn).createShaderModule({code:e}),entryPoint:"fragment_main",targets:[{format:Ja()(this,vn)}]},primitive:{topology:"triangle-list"}};t&&(a.multisample={count:4}),$a()(this,Rn,Ja()(this,pn).createRenderPipeline(a))}return Ja()(this,Rn)}function lo(e,t,r){return{label:"renderPass - ".concat(e),colorAttachments:[{view:t,resolveTarget:r,loadOp:"clear",storeOp:"discard"}]}}function ho(e){return e&&(e.label="canvas-texture-view"),{label:"RenderPassNoMsaa",colorAttachments:[{view:e,loadOp:"clear",storeOp:"store"}]}}function fo(e){for(var t=new Map,r=0;r<e.length;++r)for(var i=e[r].getTextureLayersMap(),a=Si.w.VS_BASE;a<Si.w.END;++a)if(i.has(a)){var n=i.get(a);if(n){var o=t.get(a);o||(o=[]),o.push(n),t.set(a,o)}}return t}function po(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=null,i=null,a=null,n=null,o=e.getZIndex(),s=e.getTextureType(),u=e.getColorFormat();if(o==Si.w.VS_BASE){if(s==Si.x.EXTERNAL_TEX){n=Si.l.VIDEO_FRAME,r=this.acquireVideoFrameRenderPipeline(Si.y,t),i=this.acquireVideoFrameSampler();var d=e.getPendingVideoFrame();if(!d||0==d.codedWidth||0==d.codedHeight||!d.format)return e.setPendingVideoFrame(null),null;a=[{binding:0,resource:i},{binding:1,resource:Ja()(this,pn).importExternalTexture({source:d})}]}else if(s==Si.x.CLEAR_COLOR){n=Si.l.CLEAR_COLOR,r=this.acquireClearColorRenderPipeline(Si.c);var c=e.getClearColorUniformBuffer();if(!c)return null;a=[{binding:0,resource:{buffer:c}}]}else if(s==Si.x.GPU_TEX_YUV){"i420"==u?(n=Si.l.YUV_I420,r=on(this,Fn,uo).call(this,Si.z,t)):"nv12"==u&&(n=Si.l.YUV_NV12,r=on(this,Hn,co).call(this,Si.A,t)),i=this.acquireYuvTexturesSamplers();var l=e.getUniformBuffer();if(!l)return null;var h=e.getTextureGroup();h&&("i420"==u?a=[{binding:0,resource:i[0]},{binding:1,resource:i[1]},{binding:2,resource:h.yPlaneTex.createView()},{binding:3,resource:h.uPlaneTex.createView()},{binding:4,resource:h.vPlaneTex.createView()},{binding:5,resource:{buffer:l}},{binding:6,resource:{buffer:l}}]:"nv12"==u&&(a=[{binding:0,resource:i[0]},{binding:1,resource:i[1]},{binding:2,resource:h.yPlaneTex.createView()},{binding:3,resource:h.uPlaneTex.createView()},{binding:4,resource:{buffer:l}},{binding:5,resource:{buffer:l}}]))}}else if(o==Si.w.WATERMARK||o==Si.w.MASK){n=Si.l.RGBA_WATERMARK,r=on(this,Gn,so).call(this,o,t),i=this.acquireBlendTextureSampler();var f=e.getTextureGroup();f&&(a=[{binding:0,resource:i},{binding:1,resource:f.createView()}])}else if(o==Si.w.CURSOR){n=Si.l.RGBA_CURSOR,r=on(this,Bn,oo).call(this,o,t),i=this.acquireBlendTextureSampler();var p=e.getUniformBuffer();if(!p)return null;var v=e.getTextureGroup();v&&(a=[{binding:0,resource:i},{binding:1,resource:v.createView()},{binding:2,resource:{buffer:p}}])}if(n===Si.l.CLEAR_COLOR){if(!r||!a)return null}else if(!r||!i||!a||null==n)return null;var m={pipelineType:n,pipeline:r,entries:a};return m}function vo(e,t,r){var i,a=en(t);try{for(a.s();!(i=a.n()).done;){var n=i.value,o=n.getTextureType();o!=Si.x.EXTERNAL_TEX&&o!=Si.x.CLEAR_COLOR&&(e==Si.w.VS_BASE?on(this,zn,mo).call(this,n,r):e!=Si.w.CURSOR&&e!=Si.w.WATERMARK&&e!=Si.w.MASK||on(this,Qn,go).call(this,n,r))}}catch(e){a.e(e)}finally{a.f()}}function mo(e,t){var r=e.getTextureGroup();r?e.isNew()&&(r=on(this,Nn,to).call(this,e,t,r),e.setIsNew(!1)):(r=on(this,Nn,to).call(this,e,t,null),e.setIsNew(!1)),r&&e.setTextureGroup(r)}function go(e,t){var r=e.getTextureGroup();r?e.isNew()&&(r=on(this,Vn,ro).call(this,e,t,r),e.setIsNew(!1)):(r=on(this,Vn,ro).call(this,e,t,null),e.setIsNew(!1)),r&&e.setTextureGroup(r)}function _o(e){if(!e||!Ja()(this,pn))return Ja()(this,Dn)?Ja()(this,Dn):null;if(Ja()(this,Dn)){if(Ja()(this,Dn).width!=e.width||Ja()(this,Dn).height!=e.height){var t=Ja()(this,Sn).assembleTextureConfig(e.width,e.height,GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT,Ja()(this,vn),4);$a()(this,Dn,Ja()(this,Sn).acquireTexture(t))}}else{var r=Ja()(this,Sn).assembleTextureConfig(e.width,e.height,GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT,Ja()(this,vn),4);$a()(this,Dn,Ja()(this,Sn).acquireTexture(r))}return Ja()(this,Dn)}var So=function(){function e(t,r){if(l()(this,e),rn(this,Jn),rn(this,Qn),rn(this,zn),rn(this,Yn),rn(this,Xn),rn(this,qn),rn(this,Kn),rn(this,jn),rn(this,Hn),rn(this,Fn),rn(this,Gn),rn(this,Bn),rn(this,Wn),rn(this,Ln),rn(this,Un),rn(this,Vn),rn(this,Nn),rn(this,Pn),rn(this,xn),rn(this,Mn),an(this,sn,{writable:!0,value:null}),an(this,un,{writable:!0,value:0}),an(this,dn,{writable:!0,value:0}),an(this,cn,{writable:!0,value:!1}),an(this,ln,{writable:!0,value:!1}),an(this,hn,{writable:!0,value:null}),an(this,fn,{writable:!0,value:null}),an(this,pn,{writable:!0,value:null}),an(this,vn,{writable:!0,value:null}),an(this,mn,{writable:!0,value:null}),an(this,gn,{writable:!0,value:null}),an(this,_n,{writable:!0,value:null}),an(this,Sn,{writable:!0,value:null}),an(this,En,{writable:!0,value:null}),an(this,bn,{writable:!0,value:null}),an(this,yn,{writable:!0,value:null}),an(this,Cn,{writable:!0,value:null}),an(this,An,{writable:!0,value:null}),an(this,Rn,{writable:!0,value:null}),an(this,In,{writable:!0,value:null}),an(this,wn,{writable:!0,value:null}),an(this,Tn,{writable:!0,value:null}),an(this,kn,{writable:!0,value:null}),an(this,Dn,{writable:!0,value:null}),an(this,On,{writable:!0,value:new Float32Array(12)}),!r)throw new Error("[WebGPURenderer] resMgr is an invalid param! ".concat(r));$a()(this,sn,t),$a()(this,hn,r),this.initialize(t)}return f()(e,[{key:"switchMsaa",value:function(e){$a()(this,ln,e)}},{key:"isMsaaEnabled",value:function(){return Ja()(this,ln)}},{key:"setCanvas",value:function(e){e&&$a()(this,sn,e)}},{key:"setDevice",value:function(e){e&&$a()(this,pn,e)}},{key:"setRenderArgs",value:function(e,t){$a()(this,un,e||0),$a()(this,dn,Ja()(this,un)?3:t?4:6),$a()(this,cn,t||!1)}},{key:"setTextureIndex",value:function(e){$a()(this,un,e||0)}},{key:"initialize",value:function(e){Ja()(this,pn)||($a()(this,pn,Ja()(this,hn).acquireGPUDevice()),Ja()(this,pn))?(Ja()(this,vn)||$a()(this,vn,Ja()(this,hn).acquireCanvasFormat()),Ja()(this,gn)||$a()(this,gn,Ja()(this,hn).acquireGPUBufferMgr()),Ja()(this,_n)||$a()(this,_n,Ja()(this,hn).acquireGPUBufferPool()),Ja()(this,Sn)||$a()(this,Sn,Ja()(this,hn).acquireGPUTextureMgr()),this.configureGPUContext(e),on(this,Pn,eo).call(this,Si.b)):Object(bi.f)("[WebGPURenderer] initialize() device is not ready!")}},{key:"isGPUDeviceReady",value:function(){return null!=Ja()(this,pn)}},{key:"render",value:function(e){Ja()(this,ln)?on(this,xn,$n).call(this,e):on(this,Mn,Zn).call(this,e)}},{key:"updateVertexCoords",value:function(e){on(this,Pn,eo).call(this,e)}},{key:"createRGBATexture",value:function(e,t,r,i,a){var n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(t<0)return Object(bi.f)("[createRGBATexture] ".concat(t," is an invalid index!")),null;if(!Ja()(this,gn))return console.warn("[createRGBATexture] buffer manager is not ready!"),null;if(!Ja()(this,pn))return console.warn("[createRGBATexture] GPUDevice is not ready!"),null;if(null==a||void 0===a)return console.warn("[createRGBATexture] rgbaData is invalid!"),null;if(!e)return console.warn("[createRGBATexture] command encoder is invalid!"),null;var o=on(this,Un,io).call(this,Uint32Array.BYTES_PER_ELEMENT*r,256),s=GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC,u=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC,d=null,c=null!=n&&(r!=n.width||i!=n.height),l=!0;if(n&&(c?(Ja()(this,Sn).recycleTexture(n),l=!0):(d=n,l=!1)),l){var h=Ja()(this,Sn).assembleTextureConfig(r,i,u,"rgba8unorm",1);(d=Ja()(this,Sn).acquireTexture(h))&&(d.label="RD(".concat(t,")-rgbaTexture"))}for(var f=Ja()(this,gn).acquireBuffer("".concat(t,"_Y"),s,o*i,!0,!1),p=new Uint8Array(f.getMappedRange()),v=r*Uint32Array.BYTES_PER_ELEMENT,m=0;m<i;++m)p.set(a.subarray(m*v,(m+1)*v),m*o);return f.unmap(),e.copyBufferToTexture({buffer:f,offset:0,bytesPerRow:o,rowsPerImage:i},{texture:d},[r,i,1]),d}},{key:"writeToYuvTexturesBufferGroup",value:function(e,t){if(!(Ja()(this,gn)&&e&&t&&t.buffer&&t.bufferConfig&&"mapped"==t.buffer.mapState))return null;var r=e.yPlane,i=e.cbPlane,a=e.crPlane,n=on(this,Un,io).call(this,Uint8Array.BYTES_PER_ELEMENT*r.width,256),o=Uint8Array.BYTES_PER_ELEMENT;"nv12"==t.bufferConfig.colorFormat&&(o=Uint16Array.BYTES_PER_ELEMENT);var s=on(this,Un,io).call(this,o*i.width,256),u=n*r.height,d=0,c=n*r.height+s*i.height;a&&a.buffer&&(c+=s*a.height,d=0+u+s*i.height);var l=t.buffer,h=t.bufferArray;h||(h=l.getMappedRange(0,c),t.bufferArray=h);for(var f=new Uint8Array(h),p=r.width*Uint8Array.BYTES_PER_ELEMENT,v=0;v<r.height;++v)f.set(r.buffer.subarray(v*p,(v+1)*p),0+v*n);var m=p/2;0==d&&(m=i.width*Uint16Array.BYTES_PER_ELEMENT);for(var g=0;g<i.height;++g)f.set(i.buffer.subarray(g*m,(g+1)*m),u+g*s);if(d>0)for(var _=0;_<a.height;++_)f.set(a.buffer.subarray(_*m,(_+1)*m),d+_*s);return t.buffer=l,t.yPlaneBuffer={bytesPerRow:n,rowsPerImage:r.height,offset:0},t.uPlaneBuffer={bytesPerRow:s,rowsPerImage:i.height,offset:u},t.vPlaneBuffer={bytesPerRow:s,rowsPerImage:a.height,offset:d},t}},{key:"writeToRgbaTextureBuffer",value:function(e,t,r,i,a){if(!(Ja()(this,gn)&&i&&a&&a.buffer))return null;var n=on(this,Un,io).call(this,Uint32Array.BYTES_PER_ELEMENT*t,256),o=a.buffer,s=a.bufferArray;s||(s=o.getMappedRange(),a.bufferArray=s);for(var u=new Uint8Array(s),d=t*Uint32Array.BYTES_PER_ELEMENT,c=0;c<r;++c)u.set(i.subarray(c*d,(c+1)*d),c*n);return a.buffer=o,a.bytesPerRow=n,a.rowsPerImage=r,a}},{key:"produceVideoFrame",value:function(e,t){return new VideoFrame(e,t)}},{key:"writeUniformBuffer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!Ja()(this,pn))return Object(bi.f)("writeUniformBuffer() GPUDevice is not ready yet."),null;if(!t||0==t.length)return null;var i=r;return i||(i=Ja()(this,pn).createBuffer({label:e,size:t.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})),Ja()(this,pn).queue.writeBuffer(i,0,t,0,t.length),i}},{key:"acquireBlendTextureSampler",value:function(){return Ja()(this,pn)?(Ja()(this,kn)||$a()(this,kn,Ja()(this,pn).createSampler({})),Ja()(this,kn)):null}},{key:"configureGPUContext",value:function(e){Ja()(this,fn)||($a()(this,fn,e.getContext("webgpu")),Ja()(this,fn)?Ja()(this,fn).configure({device:Ja()(this,pn),format:Ja()(this,vn),alphaMode:"premultiplied"}):Object(bi.f)("configureGPUContext() webgpuContext is invalid! canvas=".concat(e)))}},{key:"unconfigureGPUContext",value:function(){Ja()(this,fn)&&(Ja()(this,fn).unconfigure(),$a()(this,fn,null))}},{key:"acquireVideoFrameRenderPipeline",value:function(e,t){if(!Ja()(this,pn)||!e)return null;if(!Ja()(this,bn)){var r=Ja()(this,pn).createBindGroupLayout({label:"VideoFrameBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,externalTexture:{}}]}),i={label:"VideoFrameRenderPipeline",layout:Ja()(this,pn).createPipelineLayout({label:"VideoFramePipelineLayout",bindGroupLayouts:[r]}),vertex:{module:Ja()(this,pn).createShaderModule({code:e}),entryPoint:"vertex_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:Ja()(this,pn).createShaderModule({code:e}),entryPoint:"fragment_main",targets:[{format:Ja()(this,vn)}]},primitive:{topology:"triangle-list"}};t&&(i.multisample={count:4}),$a()(this,bn,Ja()(this,pn).createRenderPipeline(i))}return Ja()(this,bn)}},{key:"acquireClearColorRenderPipeline",value:function(e){if(!Ja()(this,pn)||!e)return null;if(!Ja()(this,yn)){var t=Ja()(this,pn).createBindGroupLayout({label:"ClearColorBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]}),r={label:"ClearColorRenderPipeline",layout:Ja()(this,pn).createPipelineLayout({label:"ClearColorPipelineLayout",bindGroupLayouts:[t]}),vertex:{module:Ja()(this,pn).createShaderModule({code:e}),entryPoint:"v_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]}]},fragment:{module:Ja()(this,pn).createShaderModule({code:e}),entryPoint:"f_main",targets:[{format:Ja()(this,vn)}]},primitive:{topology:"triangle-list"}};$a()(this,yn,Ja()(this,pn).createRenderPipeline(r))}return Ja()(this,yn)}},{key:"acquireVideoFrameSampler",value:function(){return Ja()(this,pn)?(Ja()(this,Cn)||$a()(this,Cn,Ja()(this,pn).createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"})),Ja()(this,Cn)):null}},{key:"acquireYuvTexturesSamplers",value:function(){if(!Ja()(this,pn))return null;if(!Ja()(this,In)){$a()(this,In,[]);var e=Ja()(this,pn).createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"}),t=Ja()(this,pn).createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"});Ja()(this,In).push(e),Ja()(this,In).push(t)}return Ja()(this,In)}},{key:"clearAttachedCanvas",value:function(){if(Ja()(this,pn)&&Ja()(this,fn)&&Ja()(this,En)&&Ja()(this,sn)&&0!=Ja()(this,sn).width&&0!=Ja()(this,sn).height){var e=Ja()(this,pn).createCommandEncoder(),t=e.beginRenderPass({colorAttachments:[{view:Ja()(this,fn).getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]}),r=Ja()(this,pn).createRenderPipeline({layout:"auto",vertex:{module:Ja()(this,pn).createShaderModule({code:Si.d}),entryPoint:"v_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]}]},fragment:{module:Ja()(this,pn).createShaderModule({code:Si.d}),entryPoint:"f_main",targets:[{format:Ja()(this,vn)}]},primitive:{topology:"triangle-list"}});t.setVertexBuffer(0,Ja()(this,En)),t.setPipeline(r),t.draw(6),t.end(),Ja()(this,pn).queue.submit([e.finish()])}}},{key:"clear",value:function(){console.log("WebGPURender.clear")}},{key:"cleanup",value:function(){this.unconfigureGPUContext(),$a()(this,sn,null),$a()(this,vn,null),$a()(this,mn,null),$a()(this,En,null),$a()(this,bn,null),$a()(this,yn,null),$a()(this,Cn,null),$a()(this,An,null),$a()(this,Rn,null),$a()(this,In,null),$a()(this,wn,null),$a()(this,Tn,null),$a()(this,kn,null),$a()(this,Dn,null),Ja()(this,gn)&&$a()(this,gn,null),Ja()(this,pn)&&$a()(this,pn,null)}}]),e}();function Eo(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return bo(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bo(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function bo(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function yo(e,t){Ao(e,t),t.add(e)}function Co(e,t,r){Ao(e,t),t.set(e,r)}function Ao(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Ro(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}var Io=new WeakMap,wo=new WeakMap,To=new WeakMap,ko=new WeakMap,Do=new WeakSet,Oo=new WeakSet,Mo=new WeakSet,xo=new WeakSet,Po=new WeakSet,No=function(){function e(){l()(this,e),yo(this,Po),yo(this,xo),yo(this,Mo),yo(this,Oo),yo(this,Do),Co(this,Io,{writable:!0,value:Si.C.AVAILABLE}),Co(this,wo,{writable:!0,value:Si.j.WEBGL}),Co(this,To,{writable:!0,value:null}),Co(this,ko,{writable:!0,value:new Map})}var t;return f()(e,[{key:"evaluate",value:(t=d()(g.a.mark((function e(t){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if($a()(this,wo,Si.j.WEBGL),Ro(this,Do,Vo).call(this)){e.next=4;break}return e.abrupt("return",Ja()(this,wo));case 4:if(t.allowedOnTargetPlatforms){e.next=7;break}return e.abrupt("return",Ja()(this,wo));case 7:if(t.allowedOnTargetBrowsers){e.next=10;break}return e.abrupt("return",Ja()(this,wo));case 10:return e.next=12,Ro(this,Mo,Lo).call(this);case 12:if(e.sent){e.next=15;break}return e.abrupt("return",Ja()(this,wo));case 15:if(r=Ro(this,Oo,Uo).call(this),Ro(this,xo,Bo).call(this,r)){e.next=19;break}return e.abrupt("return",Ja()(this,wo));case 19:if(new OffscreenCanvas(1,1).getContext("webgpu")){e.next=24;break}return null,e.abrupt("return",Ja()(this,wo));case 24:return null,$a()(this,wo,Si.j.WEBGPU),e.abrupt("return",Ja()(this,wo));case 27:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"acquireRenderer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=null;return r&&Ja()(this,ko).clear(),Ja()(this,ko).has(e)&&(i=Ja()(this,ko).get(e))&&(e&&(i.setCanvas(e),i.initialize(e)),t&&i.setDevice(t.acquireGPUDevice())),null==i&&(i=Ro(this,Po,Go).call(this,Ja()(this,wo),e,t))&&Ja()(this,ko).set(e,i),i}},{key:"rendererReinitialize",value:function(){if(Ja()(this,ko)){var e,t=Eo(Ja()(this,ko));try{for(t.s();!(e=t.n()).done;){var r=O()(e.value,2),i=r[0],a=r[1];a&&a.initialize(i)}}catch(e){t.e(e)}finally{t.f()}}}},{key:"rendererUnconfigureGPUContext",value:function(){if(Ja()(this,ko)){var e,t=Eo(Ja()(this,ko));try{for(t.s();!(e=t.n()).done;){var r=O()(e.value,2),i=(r[0],r[1]);i&&i.unconfigureGPUContext()}}catch(e){t.e(e)}finally{t.f()}}}},{key:"getRendererType",value:function(){return Ja()(this,wo)}},{key:"setRendererType",value:function(e){$a()(this,wo,e)}},{key:"isWebGPURendererType",value:function(){return Ja()(this,wo)===Si.j.WEBGPU}},{key:"isWebGLRendererType",value:function(){return Ja()(this,wo)===Si.j.WEBGL}},{key:"isWebGL2RendererType",value:function(){return Ja()(this,wo)===Si.j.WEBGL_2}},{key:"cleanup",value:function(){var e,t=Eo(Ja()(this,ko));try{for(t.s();!(e=t.n()).done;){var r=O()(e.value,2),i=(r[0],r[1]);i&&i.cleanup()}}catch(e){t.e(e)}finally{t.f()}Ja()(this,ko).clear()}}]),e}();function Vo(){return!0}function Uo(){if(Ja()(this,To)){var e={};return e.architecture=Ja()(this,To).architecture,e.vendor=Ja()(this,To).vendor,e}return null}function Lo(){return Wo.apply(this,arguments)}function Wo(){return(Wo=d()(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.gpu){e.next=3;break}return $a()(this,Io,Si.C.NOT_SUPPORTED),e.abrupt("return",!1);case 3:return e.next=5,navigator.gpu.requestAdapter();case 5:if(t=e.sent){e.next=9;break}return $a()(this,Io,Si.C.CANNOT_REQ_ADAPTER),e.abrupt("return",!1);case 9:return e.next=11,t.requestDevice();case 11:if(e.sent){e.next=15;break}return $a()(this,Io,Si.C.CANNOT_REQ_DEVICE),e.abrupt("return",!1);case 15:return e.t0=$a.a,e.t1=this,e.t2=To,e.next=20,t.requestAdapterInfo();case 20:return e.t3=e.sent,(0,e.t0)(e.t1,e.t2,e.t3),Ja()(this,To)&&console.log("adapter info: ".concat(Ja()(this,To).architecture,", ").concat(Ja()(this,To).vendor)),$a()(this,Io,Si.C.AVAILABLE),e.abrupt("return",!0);case 25:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function Bo(e){if(!e)return!1;var t=e.vendor;return-1!==Si.g.indexOf(t)}function Go(e,t,r){return Fo.produce(e,t,r)}var Fo=function(){function e(){l()(this,e)}return f()(e,null,[{key:"produce",value:function(e,t,r){var i=null;return e===Si.j.WEBGPU&&(i=new So(t,r)),i}}]),e}(),Ho=No;function jo(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function Ko(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}var qo=new WeakSet,Xo=new WeakSet;function Yo(e){e.forEach((function(e){e.consumePendingGPUEvents()}))}function zo(e){return!e||0==e.length||-1==e.findIndex((function(e){return!!e&&(!!e.getTextureLayerByZIndex(Si.w.VS_BASE)&&e.isRenderingStateReady())}))}var Qo=function(){function e(){l()(this,e),jo(this,Xo),jo(this,qo)}return f()(e,[{key:"render",value:function(e,t){return e?e.isGPUDeviceReady()?t&&0!=t.length?(Ko(this,qo,Yo).call(this,t),void(Ko(this,Xo,zo).call(this,t)||e.render(t))):(console.warn("[RendererController] render displays are not available!"),void Object(bi.d)("[RendererController] render() displays are not available!")):(console.log("[RendererController] GPU device is not ready!"),void Object(bi.d)("[RendererController] render() GPU device is not ready!")):(console.warn("[RendererController] renderer is not attached!"),void Object(bi.d)("[RendererController] render() renderer is not attached!"))}}]),e}();function Jo(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}var Zo=new WeakMap,$o=new WeakMap,es=new WeakMap,ts=new WeakMap,rs=new WeakMap,is=new WeakMap,as=new WeakMap,ns=new WeakMap,os=new WeakMap,ss=new WeakMap,us=new WeakMap,ds=new WeakMap,cs=new WeakMap,ls=new WeakMap,hs=new WeakMap,fs=new WeakMap,ps=new WeakMap,vs=new WeakMap,ms=function(){function e(t,r){l()(this,e),Jo(this,Zo,{writable:!0,value:0}),Jo(this,$o,{writable:!0,value:-1}),Jo(this,es,{writable:!0,value:0}),Jo(this,ts,{writable:!0,value:0}),Jo(this,rs,{writable:!0,value:-1}),Jo(this,is,{writable:!0,value:null}),Jo(this,as,{writable:!0,value:-1}),Jo(this,ns,{writable:!0,value:null}),Jo(this,os,{writable:!0,value:null}),Jo(this,ss,{writable:!0,value:null}),Jo(this,us,{writable:!0,value:!1}),Jo(this,ds,{writable:!0,value:null}),Jo(this,cs,{writable:!0,value:null}),Jo(this,ls,{writable:!0,value:null}),Jo(this,hs,{writable:!0,value:null}),Jo(this,fs,{writable:!0,value:null}),Jo(this,ps,{writable:!0,value:!1}),Jo(this,vs,{writable:!0,value:""}),$a()(this,Zo,t),$a()(this,$o,r)}return f()(e,[{key:"getIndex",value:function(){return Ja()(this,Zo)}},{key:"lock",value:function(){$a()(this,us,!0)}},{key:"unlock",value:function(){$a()(this,us,!1)}},{key:"isLocked",value:function(){return Ja()(this,us)}},{key:"getZIndex",value:function(){return Ja()(this,$o)}},{key:"setWidth",value:function(e){$a()(this,es,e)}},{key:"setHeight",value:function(e){$a()(this,ts,e)}},{key:"getWidth",value:function(){return Ja()(this,es)}},{key:"getHeight",value:function(){return Ja()(this,ts)}},{key:"getRawData",value:function(){return Ja()(this,is)}},{key:"setRawData",value:function(e){$a()(this,is,e)}},{key:"setIsNew",value:function(e){$a()(this,ps,e)}},{key:"isNew",value:function(){return Ja()(this,ps)}},{key:"setColorFormat",value:function(e){$a()(this,vs,e)}},{key:"getColorFormat",value:function(){return Ja()(this,vs)}},{key:"setPendingVideoFrame",value:function(e){Ja()(this,ds)&&(Ja()(this,ds).close(),$a()(this,ds,null)),$a()(this,ds,e)}},{key:"clearPendingVideoFrame",value:function(){Ja()(this,ds)&&(Ja()(this,ds).close(),$a()(this,ds,null))}},{key:"setTextureLayerType",value:function(e){$a()(this,rs,e)}},{key:"getTextureLayerType",value:function(){return Ja()(this,rs)}},{key:"setTextureType",value:function(e){$a()(this,as,e)}},{key:"getTextureType",value:function(){return Ja()(this,as)}},{key:"getPendingVideoFrame",value:function(){return Ja()(this,ds)}},{key:"getUVCoords",value:function(){return Ja()(this,os)}},{key:"setUVCoords",value:function(e){$a()(this,os,e)}},{key:"getUVCoordsBuffer",value:function(){return Ja()(this,hs)}},{key:"setUVCoordsBuffer",value:function(e){$a()(this,hs,e)}},{key:"evalViewport",value:function(e,t,r,i,a){Ja()(this,ss)||$a()(this,ss,{}),Ja()(this,ss).x=Math.floor(e),Ja()(this,ss).w=Math.floor(r),Ja()(this,ss).h=Math.floor(i),Ja()(this,rs)==Si.v.BASE_LAYER?Ja()(this,ss).y=Math.floor(a-(t+i)):Ja()(this,ss).y=Math.floor(t),Ja()(this,ss).x<0&&(Ja()(this,ss).x=0),Ja()(this,ss).y<0&&(Ja()(this,ss).y=0),Ja()(this,ss).minDepth=0,Ja()(this,ss).maxDepth=1}},{key:"setViewport",value:function(e){$a()(this,ss,e)}},{key:"getViewport",value:function(){return Ja()(this,ss)}},{key:"getTextureGroup",value:function(){return Ja()(this,ns)}},{key:"setTextureGroup",value:function(e){$a()(this,ns,e)}},{key:"setUniformBuffer",value:function(e){$a()(this,cs,e)}},{key:"getUniformBuffer",value:function(){return Ja()(this,cs)}},{key:"setClearColorUniformBuffer",value:function(e){$a()(this,ls,e)}},{key:"getClearColorUniformBuffer",value:function(){return Ja()(this,ls)}},{key:"setTextureBufferGroup",value:function(e){$a()(this,fs,e)}},{key:"getTextureBufferGroup",value:function(){return Ja()(this,fs)}},{key:"destroyTextureBufferGroup",value:function(){Ja()(this,fs)&&$a()(this,fs,null)}},{key:"recycle",value:function(e){e&&(this.destroyTextureBufferGroup(),e.destroyTextureGroup(this)),Ja()(this,ds)&&(Ja()(this,ds).close(),$a()(this,ds,null)),Ja()(this,cs)&&(Ja()(this,cs).destroy(),$a()(this,cs,null)),Ja()(this,ls)&&(Ja()(this,ls).destroy(),$a()(this,ls,null)),$a()(this,Zo,-1),$a()(this,$o,-1),$a()(this,rs,Si.v.UNKNOWN),$a()(this,is,null),$a()(this,as,Si.x.UNKNOWN),$a()(this,os,null),$a()(this,ss,null),$a()(this,us,!1),$a()(this,ps,!1),$a()(this,vs,"")}}]),e}();function gs(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return _s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _s(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function _s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function Ss(e,t){bs(e,t),t.add(e)}function Es(e,t,r){bs(e,t),t.set(e,r)}function bs(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ys(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}var Cs=new WeakMap,As=new WeakMap,Rs=new WeakMap,Is=new WeakMap,ws=new WeakMap,Ts=new WeakMap,ks=new WeakMap,Ds=new WeakMap,Os=new WeakMap,Ms=new WeakMap,xs=new WeakMap,Ps=new WeakMap,Ns=new WeakMap,Vs=new WeakMap,Us=new WeakMap,Ls=new WeakMap,Ws=new WeakMap,Bs=new WeakMap,Gs=new WeakMap,Fs=new WeakMap,Hs=new WeakMap,js=new WeakMap,Ks=new WeakMap,qs=new WeakMap,Xs=new WeakMap,Ys=new WeakMap,zs=new WeakMap,Qs=new WeakMap,Js=new WeakMap,Zs=new WeakMap,$s=new WeakMap,eu=new WeakMap,tu=new WeakMap,ru=new WeakMap,iu=new WeakMap,au=new WeakMap,nu=new WeakMap,ou=new WeakMap,su=new WeakMap,uu=new WeakSet,du=new WeakSet,cu=new WeakSet,lu=new WeakSet,hu=new WeakSet,fu=new WeakSet,pu=new WeakSet,vu=new WeakSet,mu=new WeakSet,gu=new WeakSet,_u=new WeakSet,Su=new WeakSet,Eu=new WeakSet,bu=new WeakSet,yu=new WeakSet,Cu=new WeakSet,Au=new WeakSet,Ru=new WeakSet,Iu=new WeakSet,wu=new WeakSet,Tu=new WeakSet,ku=new WeakSet,Du=new WeakSet,Ou=new WeakSet,Mu=new WeakSet,xu=new WeakSet,Pu=new WeakSet,Nu=new WeakSet;function Vu(e,t,r){if(ys(this,Su,qu).call(this),Ja()(this,Vs))if(Ja()(this,Vs).isGPUDeviceReady()){var i=Si.w.VS_BASE,a=ys(this,bu,Yu).call(this,i);if(a.isLocked()){var n=a.getPendingVideoFrame();if(!n||n.codedWidth==e&&n.codedHeight==t)r instanceof VideoFrame&&r.close();else if(r instanceof VideoFrame)a.setPendingVideoFrame(r);else{var o={timestamp:0,codedWidth:e,codedHeight:t,format:"RGBA"},s=Ja()(this,Vs).produceVideoFrame(r,o);a.setPendingVideoFrame(s)}}else{if(r instanceof VideoFrame){a.getPendingVideoFrame()!=r&&a.setPendingVideoFrame(r)}else{var u={timestamp:0,codedWidth:e,codedHeight:t,format:"RGBA"},d=Ja()(this,Vs).produceVideoFrame(r,u);a.setPendingVideoFrame(d)}a.setTextureLayerType(Si.v.BASE_LAYER),a.setTextureType(Si.x.EXTERNAL_TEX),a.lock()}this.markRenderingStateReady()}else r instanceof VideoFrame&&r.close();else r instanceof VideoFrame&&r.close()}function Uu(e,t,r,i,a,n){ys(this,Su,qu).call(this);var o=Si.w.VS_BASE,s=ys(this,bu,Yu).call(this,o);if(s.setTextureLayerType(Si.v.BASE_LAYER),s.setTextureType(Si.x.GPU_TEX_YUV),s.isLocked()){var u=s.getWidth(),d=s.getHeight();u==t&&d==r||(s.setWidth(t),s.setHeight(r),s.setIsNew(!0))}else s.setWidth(t),s.setHeight(r),s.setIsNew(!0),s.lock();var c=ys(this,ku,rd).call(this,i,t,r,n),l=Ja()(this,Vs).writeToYuvTexturesBufferGroup(c,a);s.setTextureBufferGroup(l)}function Lu(e,t,r,i,a){var n=Si.w.CURSOR,o=ys(this,bu,Yu).call(this,n);if(o.setTextureLayerType(Si.v.BLEND_LAYER),o.setTextureType(Si.x.GPU_TEX_RGBA),o.isLocked()){var s=o.getWidth(),u=o.getHeight();s==t&&u==r||(o.setWidth(t),o.setHeight(r),o.setIsNew(!0))}else o.setWidth(t),o.setHeight(r),o.setIsNew(!0),o.lock();var d=Ja()(this,Vs).writeToRgbaTextureBuffer(e,t,r,i,a);o.setTextureBufferGroup(d)}function Wu(e,t,r,i,a){var n=Si.w.WATERMARK,o=ys(this,bu,Yu).call(this,n);if(o.setTextureLayerType(Si.v.BLEND_LAYER),o.setTextureType(Si.x.GPU_TEX_RGBA),o.isLocked()){var s=o.getWidth(),u=o.getHeight();s==t&&u==r||(o.setWidth(t),o.setHeight(r),o.setIsNew(!0))}else o.setWidth(t),o.setHeight(r),o.setIsNew(!0),o.lock();var d=Ja()(this,Vs).writeToRgbaTextureBuffer(e,t,r,i,a);o.setTextureBufferGroup(d)}function Bu(e,t,r){if(ys(this,Pu,sd).call(this,e))if(Ja()(this,Us)){var i=Si.w.VS_BASE,a=ys(this,bu,Yu).call(this,i),n=a.getUVCoords(),o=ys(this,vu,Hu).call(this,Ja()(this,Is),Ja()(this,ws),Ja()(this,Rs),Ja()(this,Os),r,e.width,e.height);if(n||(n=new Float32Array(12)),n.set(o,0),a.setUVCoords(n),Ja()(this,Rs).height>Ja()(this,Rs).width){var s=e.height*Ja()(this,Rs).width/Ja()(this,Rs).height,u=e.x+e.width/2-s/2;a.evalViewport(u,e.y,s,e.height,Ja()(this,Us).height)}else{var d=Math.abs(t.left)*e.width,c=e.x+(e.width-d)/2,l=Math.abs(t.top)*e.height,h=0;e.y>0&&(h=e.y+(e.height-l)/2),a.evalViewport(c,h,d,l,Ja()(this,Us).height)}}else console.log("drawVideoFrameBaseTextureLayer() canvas is invalid? canvas=".concat(Ja()(this,Us)))}function Gu(e,t,r){var i=Si.w.VS_BASE,a=ys(this,bu,Yu).call(this,i),n=a.getUVCoords(),o=ys(this,vu,Hu).call(this,Ja()(this,Is),Ja()(this,ws),Ja()(this,Rs),Ja()(this,Os),r,e.width,e.height);if(n||(n=new Float32Array(12)),n.set(o,0),a.setUVCoords(n),Ja()(this,Rs).height>Ja()(this,Rs).width){var s=e.height*Ja()(this,Rs).width/Ja()(this,Rs).height,u=e.x+e.width/2-s/2;a.evalViewport(u,e.y,s,e.height,Ja()(this,Us).height)}else{var d=Math.abs(t.left)*e.width,c=e.x+(e.width-d)/2,l=Math.abs(t.top)*e.height,h=0;e.y>0&&(h=e.y+(e.height-l)/2),a.evalViewport(c,h,d,l,Ja()(this,Us).height)}var f=ys(this,Cu,Qu).call(this);f&&f.buffer&&a.setUniformBuffer(f.buffer)}function Fu(e,t,r,i){var a=r.top/t,n=r.left/e,o=a+(r.height-1)/t,s=n+r.width/e,u=a;a=o;var d=[],c=[{x:s,y:o=u},{x:s,y:a},{x:n,y:a},{x:s,y:o},{x:n,y:o},{x:n,y:a}];if(void 0===i||null==i)for(var l=0;l<c.length;++l){var h={u:c[l].x,v:c[l].y};d.push(h)}if(i===Si.p)for(var f=0;f<c.length;++f){var p={u:c[f].x,v:c[f].y};d.push(p)}if(i===Si.s){c=[{x:s,y:o},{x:n,y:o},{x:n,y:a},{x:s,y:o},{x:s,y:a},{x:n,y:a}];for(var v=0;v<c.length;++v){var m=-1*Math.abs(c[v].x);c[v].x=m;var g={u:c[v].x+1,v:c[v].y};d.push(g)}}if(i===Si.q){c=[{x:n,y:o},{x:n,y:a},{x:s,y:a},{x:n,y:o},{x:s,y:o},{x:s,y:a}];for(var _=0;_<c.length;++_){var S=-1*Math.abs(c[_].y);c[_].y=S;var E={u:c[_].x,v:c[_].y+1};d.push(E)}}if(i===Si.r){c=[{x:n,y:a},{x:s,y:a},{x:s,y:o},{x:n,y:a},{x:n,y:o},{x:s,y:o}];for(var b=0;b<c.length;++b){var y={u:c[b].x,v:c[b].y};d.push(y)}}for(var C=[],A=0;A<d.length;++A){var R=d[A];C.push(R.u),C.push(R.v)}return C}function Hu(e,t,r,i,a,n,o){var s,u,d,c;if(this.isUseFillMode({w:r.width,h:r.height,rotation:i})){var l=i==Si.s||i==Si.r?o/n:n/o,h=r.left||0,f=r.top||0;if(r.width/r.height>l){var p=r.height*l;s=f/t,u=(Math.round((r.width-p)/2)+h)/e,d=s+(r.height-1)/t,c=u+p/e}else{var v=r.width/l;d=(s=(Math.round((r.height-v)/2)+f)/t)+(v-1)/t,c=(u=h/e)+r.width/e}}else s=Gi(r.top/t,2),u=Gi(r.left/e,2),d=Bi((r.top+r.height-1)/t,2),c=Bi((r.width-1+r.left)/e,2);var m=s;s=d;var g=[],_=[{x:c,y:d=m},{x:c,y:s},{x:u,y:s},{x:c,y:d},{x:u,y:d},{x:u,y:s}];if(void 0===i||null==i)for(var S=0;S<_.length;++S){var E={u:_[S].x,v:_[S].y};g.push(E)}if(i===Si.p)for(var b=0;b<_.length;++b){var y={u:_[b].x,v:_[b].y};g.push(y)}if(i===Si.s){_=[{x:c,y:d},{x:u,y:d},{x:u,y:s},{x:c,y:d},{x:c,y:s},{x:u,y:s}];for(var C=0;C<_.length;++C){var A=-1*Math.abs(_[C].x);_[C].x=A;var R={u:_[C].x+1,v:_[C].y};g.push(R)}}if(i===Si.q){var I=s;s=d,_=[{x:u,y:d=I},{x:u,y:s},{x:c,y:s},{x:u,y:d},{x:c,y:d},{x:c,y:s}];for(var w=0;w<_.length;++w){var T={u:_[w].x,v:_[w].y};g.push(T)}}if(i===Si.r){_=[{x:u,y:s},{x:c,y:s},{x:c,y:d},{x:u,y:s},{x:u,y:d},{x:c,y:d}];for(var k=0;k<_.length;++k){var D={u:_[k].x,v:_[k].y};g.push(D)}}if(a){g=[];for(var O=0;O<_.length;++O){var M=-1*Math.abs(_[O].x);_[O].x=M;var x={u:_[O].x+1,v:_[O].y};g.push(x)}}for(var P=[],N=0;N<g.length;++N){var V=g[N];P.push(V.u),P.push(V.v)}return P}function ju(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=e.width,o=e.height;a&&(n=a.width,o=a.height);var s,u,d,c,l=i==Si.s||i==Si.r?r:t,h=i==Si.s||i==Si.r?t:r,f=l/h*o,p=h/l*n;f>n?(s=0,d=1,c=1-(u=(o-p)/2/o)):(u=0,c=1,d=1-(s=(n-f)/2/n));var v=[{x:d=2*d-1,y:u=1-2*u},{x:d,y:c=1-2*c},{x:s=2*s-1,y:c},{x:d,y:u},{x:s,y:u},{x:s,y:c}];Ja()(this,Vs)&&Ja()(this,Vs).updateVertexCoords(v)}function Ku(e,t,r,i,a){var n,o,s,u;if(this.isUseFillMode({w:r,h:i,rotation:a}))n=0,o=0,s=1,u=1;else{var d=a==Si.s||a==Si.r?i:r,c=a==Si.s||a==Si.r?r:i,l=d/c*t;l>e?(n=0,s=1,u=1-(o=(t-c/d*e)/2/t)):(o=0,u=1,s=1-(n=(e-l)/2/e))}return{top:o=1-2*o,left:n=2*n-1,right:s=2*s-1,bottom:u=1-2*u}}function qu(){Ja()(this,Vs)||Object(bi.f)("[WebGPURenderDisplay] renderer is not attached!")}function Xu(e){if(e<0)throw new Error("[hasZIndexTexLayer] ".concat(e," is an invalid parameter!"));return Ja()(this,su).has(e)}function Yu(e){var t=null;return ys(this,Eu,Xu).call(this,e)?t=Ja()(this,su).get(e):(t=new ms(Ja()(this,Cs),e),Ja()(this,su).set(e,t)),t}function zu(e,t,r){Ja()(this,Us)&&($a()(this,Zs,e),$a()(this,ru,e&&r===x.O?1:0),$a()(this,iu,t),e||$a()(this,$s,r))}function Qu(){if(-1==Ja()(this,eu))return null;var e={yuvMode:x.S,colorRange:Ja()(this,eu),rotation:Ja()(this,Os)},t=null,r=Ja()(this,ou).get(Si.w.VS_BASE);if(r){var i=r.uniform;if(t=r.buffer,i.yuvMode!=e.yuvMode||i.colorRange!=e.colorRange||i.rotation!=e.rotation){var a=ys(this,Iu,$u).call(this,e);t=Ja()(this,Vs).writeUniformBuffer("YuvTexLayerUniformBuffer(idx=".concat(Ja()(this,Cs),")"),a,t)}}else{r={};var n=ys(this,Iu,$u).call(this,e);t=Ja()(this,Vs).writeUniformBuffer("YuvTexLayerUniformBuffer(idx=".concat(Ja()(this,Cs),")"),n)}return t?(r.uniform=e,r.buffer=t,Ja()(this,ou).set(Si.w.VS_BASE,r),r):null}function Ju(){if(!Ja()(this,nu))return null;var e={cursorFlag:Ja()(this,iu),cursorInfo:Ja()(this,nu)},t=null,r=Ja()(this,ou).get(Si.w.CURSOR);if(r){var i=r.uniform;if(t=r.buffer,i.cursorFlag!=e.cursorFlag||i.cursorInfo!=e.cursorInfo){var a=ys(this,wu,ed).call(this,e);t=Ja()(this,Vs).writeUniformBuffer("CursorTexLayerUniformBuffer(idx=".concat(Ja()(this,Cs),")"),a,t)}}else{r={};var n=ys(this,wu,ed).call(this,e);t=Ja()(this,Vs).writeUniformBuffer("CursorTexLayerUniformBuffer(idx=".concat(Ja()(this,Cs),")"),n)}return t?(r.uniform=e,r.buffer=t,Ja()(this,ou).set(Si.w.CURSOR,r),r):null}function Zu(e,t){return Math.ceil(e/t)*t}function $u(e){var t=ys(this,Ru,Zu).call(this,3*Float32Array.BYTES_PER_ELEMENT,16),r=new Float32Array(t/Float32Array.BYTES_PER_ELEMENT);return r[0]=e.yuvMode,r[1]=e.colorRange,r[2]=e.rotation,r}function ed(e){var t=ys(this,Ru,Zu).call(this,5*Float32Array.BYTES_PER_ELEMENT,16),r=new Float32Array(t/Float32Array.BYTES_PER_ELEMENT);return r[0]=e.cursorFlag,r[1]=e.cursorInfo.x,r[2]=e.cursorInfo.y,r[3]=e.cursorInfo.w,r[4]=e.cursorInfo.h,r}function td(e){if(!e||0==e.length)return null;var t=ys(this,Ru,Zu).call(this,4*Float32Array.BYTES_PER_ELEMENT,16),r=new Float32Array(t/Float32Array.BYTES_PER_ELEMENT);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function rd(e,t,r,i){var a=t*r,n=e.subarray(0,a),o=0,s=0;i==x.S?o=s=t/2*r/2:i==x.U&&(s=t*r/2,o=0);var u=e.subarray(a,a+s);return{yPlane:{buffer:n,width:t,height:r},crPlane:{buffer:0!=o?e.subarray(a+s,a+s+o):null,width:t/2,height:r/2},cbPlane:{buffer:u,width:t/2,height:r/2}}}function id(e,t,r){var i="",a=0,n=0;r==x.S?(a=e/2*t/2,i="i420",n=Uint8Array.BYTES_PER_ELEMENT):r==x.U&&(e*t/2,a=0,i="nv12",n=Uint16Array.BYTES_PER_ELEMENT);var o=ys(this,Ru,Zu).call(this,Uint8Array.BYTES_PER_ELEMENT*e,256),s=ys(this,Ru,Zu).call(this,n*e/2,256),u=o*t+s*t/2;return a>0&&(u+=s*t/2),{colorFormat:i,size:u,yPlane:{width:o,height:t},uvPlane:{width:s,height:t/2}}}function ad(e,t){var r=ys(this,Ru,Zu).call(this,Uint32Array.BYTES_PER_ELEMENT*e,256);return{colorFormat:"rgba",width:r,height:t,size:r*t}}function nd(e,t,r){t?t.buffer?r.size>t.buffer.size?(Ja()(this,Js).recycleTextureBufferGroup(e),t.buffer=Ja()(this,Js).requestTextureBuffer(r),t.bufferConfig=r):"mapped"==t.buffer.mapState||(Ja()(this,Js).recycleTextureBufferGroup(e),t.buffer=Ja()(this,Js).requestTextureBuffer(r),t.bufferConfig=r):(t.buffer=Ja()(this,Js).requestTextureBuffer(r),t.bufferConfig=r):((t={}).buffer=Ja()(this,Js).requestTextureBuffer(r),t.bufferConfig=r);return t}function od(){for(var e=[],t=0;t<Si.a.length;++t){var r=Si.a[t];e.push(r.u),e.push(r.v)}return e}function sd(e){return e&&0!=e.width&&0!=e.height}function ud(){if(Ja()(this,Js)){var e,t=gs(Ja()(this,su));try{for(t.s();!(e=t.n()).done;){var r=O()(e.value,2),i=(r[0],r[1]);i&&(Ja()(this,Js).recycleTextureBufferGroup(i,!1),Ja()(this,Js).destroyTextureGroup(i,!0))}}catch(e){t.e(e)}finally{t.f()}}else Object(bi.f)("clearTexLayerResources() GPUResManager is not attached!")}var dd=function(){function e(t,r){l()(this,e),Ss(this,Nu),Ss(this,Pu),Ss(this,xu),Ss(this,Mu),Ss(this,Ou),Ss(this,Du),Ss(this,ku),Ss(this,Tu),Ss(this,wu),Ss(this,Iu),Ss(this,Ru),Ss(this,Au),Ss(this,Cu),Ss(this,yu),Ss(this,bu),Ss(this,Eu),Ss(this,Su),Ss(this,_u),Ss(this,gu),Ss(this,mu),Ss(this,vu),Ss(this,pu),Ss(this,fu),Ss(this,hu),Ss(this,lu),Ss(this,cu),Ss(this,du),Ss(this,uu),Es(this,Cs,{writable:!0,value:0}),Es(this,As,{writable:!0,value:0}),Es(this,Rs,{writable:!0,value:{}}),Es(this,Is,{writable:!0,value:0}),Es(this,ws,{writable:!0,value:0}),Es(this,Ts,{writable:!0,value:0}),Es(this,ks,{writable:!0,value:0}),Es(this,Ds,{writable:!0,value:-1}),Es(this,Os,{writable:!0,value:Si.p}),Es(this,Ms,{writable:!0,value:x.T}),Es(this,xs,{writable:!0,value:0}),Es(this,Ps,{writable:!0,value:0}),Es(this,Ns,{writable:!0,value:!1}),Es(this,Vs,{writable:!0,value:null}),Es(this,Us,{writable:!0,value:null}),Es(this,Ls,{writable:!0,value:!1}),Es(this,Ws,{writable:!0,value:0}),Es(this,Bs,{writable:!0,value:!1}),Es(this,Gs,{writable:!0,value:0}),Es(this,Fs,{writable:!0,value:0}),Es(this,Hs,{writable:!0,value:0}),Es(this,js,{writable:!0,value:0}),Es(this,Ks,{writable:!0,value:Si.k.IDLE}),Es(this,qs,{writable:!0,value:0}),Es(this,Xs,{writable:!0,value:0}),Es(this,Ys,{writable:!0,value:0}),Es(this,zs,{writable:!0,value:!1}),Es(this,Qs,{writable:!0,value:0}),Es(this,Js,{writable:!0,value:null}),Es(this,Zs,{writable:!0,value:0}),Es(this,$s,{writable:!0,value:x.T}),Es(this,eu,{writable:!0,value:-1}),Es(this,tu,{writable:!0,value:0}),Es(this,ru,{writable:!0,value:0}),Es(this,iu,{writable:!0,value:0}),Es(this,au,{writable:!0,value:0}),Es(this,nu,{writable:!0,value:null}),Es(this,ou,{writable:!0,value:new Map}),Es(this,su,{writable:!0,value:new Map}),v()(this,"reuse",!1),$a()(this,Cs,t),$a()(this,Js,r),$a()(this,As,t||0),Ja()(this,Rs).top=0,Ja()(this,Rs).left=0,Ja()(this,Rs).width=0,Ja()(this,Rs).height=0,$a()(this,Is,0),$a()(this,ws,0),$a()(this,Ts,0),$a()(this,ks,0),$a()(this,Ms,x.T),$a()(this,xs,0),$a()(this,Ps,0),this.markRenderingStateIdle()}return f()(e,[{key:"addRenderer",value:function(e){$a()(this,Vs,e)}},{key:"removeRenderer",value:function(){$a()(this,Vs,null)}},{key:"setGPUResMgr",value:function(e){$a()(this,Js,e)}},{key:"removeGPUResMgr",value:function(){$a()(this,Js,null)}},{key:"attachCanvas",value:function(e){$a()(this,Us,e)}},{key:"getAttachedCanvas",value:function(){return Ja()(this,Us)}},{key:"detachCanvas",value:function(){$a()(this,Us,null)}},{key:"bindSsrc",value:function(e){$a()(this,Qs,e)}},{key:"unbindSsrc",value:function(){$a()(this,Qs,0)}},{key:"drawSelfVideo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(ys(this,Pu,sd).call(this,e)){ys(this,Su,qu).call(this),ys(this,yu,zu).call(this,1,Ja()(this,zs),Ja()(this,Ms));var i=null;i=t?ys(this,gu,Ku).call(this,e.width,e.height,e.width,e.height,Si.p):ys(this,gu,Ku).call(this,e.width,e.height,Ja()(this,Rs).width,Ja()(this,Rs).height,Ja()(this,Os)),ys(this,hu,Bu).call(this,e,i,r)}}},{key:"drawRemoteVideo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Ja()(this,Us)&&ys(this,Pu,sd).call(this,e)){ys(this,Su,qu).call(this);var r=this.isRgbaMode(Ja()(this,Ms))?1:0;ys(this,yu,zu).call(this,r,Ja()(this,zs),Ja()(this,Ms));var i=ys(this,gu,Ku).call(this,e.width,e.height,Ja()(this,Rs).width,Ja()(this,Rs).height,Ja()(this,Os));ys(this,fu,Gu).call(this,e,i,t)}}},{key:"drawCursor",value:function(e,t,r,i,a){if(!(!Ja()(this,qs)||e&&(i<0||a<0))){var n=Si.w.CURSOR,o=ys(this,bu,Yu).call(this,n),s=ys(this,bu,Yu).call(this,Si.w.VS_BASE);if(o.setUVCoords(s.getUVCoords()),o.evalViewport(t,r,i,a,Ja()(this,Us).height),e&&Ja()(this,zs)){var u={x:t/Ja()(this,Rs).width,y:r/Ja()(this,Rs).height,w:i/Ja()(this,Rs).width,h:a/Ja()(this,Rs).height};$a()(this,nu,u)}else{$a()(this,nu,{x:0,y:0,w:0,h:0})}var d=ys(this,Au,Ju).call(this);d&&d.buffer&&o.setUniformBuffer(d.buffer)}}},{key:"setMultiView",value:function(e){$a()(this,Ls,e)}},{key:"setFillMode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;$a()(this,xs,e),$a()(this,Ps,t)}},{key:"getFillMode",value:function(){return Ja()(this,xs)}},{key:"setColorRange",value:function(e){$a()(this,eu,e)}},{key:"getFillModeForResolution",value:function(){return Ja()(this,Ps)}},{key:"getTextureIndex",value:function(){return Ja()(this,As)}},{key:"isUseFillMode",value:function(e){var t=e.w,r=e.h,i=e.rotation;if(!Ja()(this,xs))return!1;if(!Ja()(this,Ps))return!0;if(!t||!r)return!1;var a=i===Si.s||i===Si.s?r/t:t/r;return(Array.isArray(Ja()(this,Ps))?Ja()(this,Ps):[Ja()(this,Ps)]).some((function(e){return Math.abs(a-e)<.01}))}},{key:"setVideoMode",value:function(e){$a()(this,Ms,e)}},{key:"getVideoMode",value:function(){return Ja()(this,Ms)}},{key:"setWatermarkFlag",value:function(e){$a()(this,Ws,e),e||(this.setWatermarkRepeated(!1),this.setWatermarkOpacity(),this.setWatermarkPosition(16))}},{key:"setWatermarkRepeated",value:function(e){$a()(this,Bs,e)}},{key:"isWatermarkRepeated",value:function(){return!!Ja()(this,Bs)}},{key:"setWatermarkOpacity",value:function(e){$a()(this,Gs,e||.15)}},{key:"getWatermarkOpacity",value:function(){return Ja()(this,Gs)}},{key:"setWatermarkPosition",value:function(e){$a()(this,Fs,e||16)}},{key:"getWatermarkPosition",value:function(){return Ja()(this,Fs)}},{key:"isSetWatermark",value:function(){return Ja()(this,Ws)}},{key:"isRgbaMode",value:function(e){return-1!==[x.W,x.O].indexOf(e)}},{key:"getTextureWidth",value:function(){return Ja()(this,Is)}},{key:"getTextureHeight",value:function(){return Ja()(this,ws)}},{key:"getCroppingParams",value:function(){return Ja()(this,Rs)}},{key:"recoverTextures",value:function(){}},{key:"updateWatermark",value:function(e,t,r){var i=Si.w.WATERMARK,a=ys(this,bu,Yu).call(this,i);if(!Ja()(this,Us)||!Ja()(this,Vs))return ys(this,Nu,ud).call(this),void this.markRenderingStatePending();if(e<=0||t<=0||!r||r.length!=e*t*4)return Ja()(this,Js).recycleTextureBufferGroup(a),void this.markRenderingStatePending();if(Fi(Ja()(this,Js),e,t))return Ja()(this,Js).recycleTextureBufferGroup(a),void this.markRenderingStatePending();if($a()(this,Hs,e),$a()(this,js,t),$a()(this,Ws,1),$a()(this,tu,1),ys(this,Eu,Xu).call(this,Si.w.VS_BASE)){var n=ys(this,bu,Yu).call(this,Si.w.VS_BASE).getViewport();if(n)try{var o=ys(this,Ou,ad).call(this,e,t);o.label="WatermarkTexBuffer(".concat(a.getIndex(),")-").concat(o.size);var s=a.getTextureBufferGroup();if(!(s=ys(this,Mu,nd).call(this,a,s,o))||!s.buffer)return console.warn("[updateWatermark()] texLayer(".concat(a.getIndex(),") cannot apply a GPU buffer!")),void this.markRenderingStatePending();ys(this,lu,Wu).call(this,Ja()(this,Cs),e,t,r,s),n&&a.setViewport(n);var u=a.getUVCoords(),d=ys(this,xu,od).call(this);u||(u=new Float32Array(12)),u.set(d,0),a.setUVCoords(u),a.setRawData(null),this.markRenderingStateReady()}catch(e){console.error("[WebGPURenderDisplay] updateWatermark() error:".concat(e.message)),Object(bi.d)("[WebGPURenderDisplay] updateWatermark() error:".concat(e.message)),Ja()(this,Js).recycleTextureBufferGroup(a),this.markRenderingStatePending()}else{console.log("[updateWatermark] base layer's viewport is not ready, set data to the texture layer for creating texture later."),Ja()(this,Js).recycleTextureBufferGroup(a),this.markRenderingStatePending();var c={index:Ja()(this,Cs),width:e,height:t,data:r};a.setRawData(c)}}else{console.log("[updateWatermark] base layer is not ready, set data to the texture layer for creating texture later."),Ja()(this,Js).recycleTextureBufferGroup(a),this.markRenderingStatePending();var l={index:Ja()(this,Cs),width:e,height:t,data:r};a.setRawData(l)}}},{key:"updateCursor",value:function(e,t,r){var i=Si.w.CURSOR,a=ys(this,bu,Yu).call(this,i);if(!Ja()(this,Us)||!Ja()(this,Vs))return ys(this,Nu,ud).call(this),void this.markRenderingStatePending();if(e<=0||t<=0||!r||r.length!=e*t*4)return Ja()(this,Js).recycleTextureBufferGroup(a),void this.markRenderingStatePending();$a()(this,Xs,e),$a()(this,Ys,t),$a()(this,zs,1);try{var n=ys(this,Ou,ad).call(this,e,t);n.label="CursorTexBuffer(".concat(a.getIndex(),")-").concat(n.size);var o=a.getTextureBufferGroup();if(!(o=ys(this,Mu,nd).call(this,a,o,n))||!o.buffer)return void console.warn("[updateCursor()] texLayer(".concat(a.getIndex(),") cannot apply a GPU buffer!"));if("mapped"!=o.buffer.mapState)return void console.error("updateCursor() why buffer state is not mapped!");ys(this,cu,Lu).call(this,Ja()(this,Cs),e,t,r,o),this.markRenderingStateReady()}catch(e){console.error("[WebGPURenderDisplay] updateCursor() error:".concat(e.message)),Object(bi.d)("[WebGPURenderDisplay] updateCursor() error:".concat(e.message)),Ja()(this,Js).recycleTextureBufferGroup(a),this.markRenderingStatePending()}}},{key:"updateSelfVideoTextures",value:function(e,t,r,i){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];ys(this,Su,qu).call(this);var n=ys(this,bu,Yu).call(this,Si.w.VS_BASE);if(!Ja()(this,Us)||!Ja()(this,Vs))return r&&r instanceof VideoFrame&&r.close(),ys(this,Nu,ud).call(this),void this.markRenderingStatePending();if(e<=0||t<=0||!r||r.length%4!=0)return r&&r instanceof VideoFrame&&r.close(),void this.markRenderingStatePending();if(1!=e||1!=t){if($a()(this,Is,e),$a()(this,ws,t),$a()(this,Os,Si.p),Object.assign(Ja()(this,Rs),i),!a)return r&&r instanceof VideoFrame&&r.close(),void this.markRenderingStatePending();try{ys(this,uu,Vu).call(this,e,t,r),this.markRenderingStateReady()}catch(e){console.log("[WebGPURenderDisplay] updateSelfVideoTextures() error:".concat(e.message)),Object(bi.d)("[WebGPURenderDisplay] updateSelfVideoTextures() error:".concat(e.message)),this.markRenderingStatePending(),r instanceof VideoFrame&&r.close();var o=ys(this,bu,Yu).call(this,Si.w.VS_BASE);o.setPendingVideoFrame(null)}}else{n.setPendingVideoFrame(null),ys(this,Nu,ud).call(this),r&&r instanceof VideoFrame&&r.close();var s=ys(this,Tu,td).call(this,r);if(s)if(Ja()(this,Vs)){var u=n.getClearColorUniformBuffer();u=Ja()(this,Vs).writeUniformBuffer("ClearColorUniformBuffer",s,u),n.setClearColorUniformBuffer(u),n.setTextureType(Si.x.CLEAR_COLOR)}else console.warn("updateSelfVideoTextures() renderer is not attached!");else Object(bi.f)("updateSelfVideoTextures() cannot create the uniform buffer array.");this.markRenderingStateReady()}}},{key:"updateRemoteVideoTexturesImageBitmap",value:function(e,t,r,i,a){var n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=ys(this,bu,Yu).call(this,Si.w.VS_BASE);if(!Ja()(this,Vs)||!Ja()(this,Us))return r&&r instanceof VideoFrame&&r.close(),ys(this,Nu,ud).call(this),void this.markRenderingStatePending();if(e<=0||t<=0||!r)return r&&r instanceof VideoFrame&&r.close(),void this.markRenderingStatePending();if($a()(this,Is,e),$a()(this,ws,t),Number.isNaN(a)||$a()(this,Os,a),Object.assign(Ja()(this,Rs),i),!n)return r&&r instanceof VideoFrame&&r.close(),void this.markRenderingStatePending();try{ys(this,uu,Vu).call(this,e,t,r),this.markRenderingStateReady()}catch(e){console.log("[WebGPURenderDisplay] updateRemoteVideoTexturesImageBitmap() error:".concat(e.message)),Object(bi.d)("[WebGPURenderDisplay] updateRemoteVideoTexturesImageBitmap() error:".concat(e.message)),this.markRenderingStatePending(),r instanceof VideoFrame&&r.close(),o.setPendingVideoFrame(null)}}},{key:"updateRemoteVideoTextures",value:function(e,t,r,i,a){var n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=arguments.length>6?arguments[6]:void 0,s=Si.w.VS_BASE,u=ys(this,bu,Yu).call(this,s);if(!Ja()(this,Us)||!Ja()(this,Vs))return ys(this,Nu,ud).call(this),void this.markRenderingStatePending();if(!ys(this,Pu,sd).call(this,o))return Ja()(this,Js).recycleTextureBufferGroup(u),void this.markRenderingStatePending();ys(this,Su,qu).call(this);var d=this.isRgbaMode(Ja()(this,Ms));if(e<=0||t<=0||!i||!i.length||i.length!=e*t*3/2&&!d||r&&(r.top<0||r.left<0||r.left+r.width>e||r.top+r.height>t))return Ja()(this,Js).recycleTextureBufferGroup(u),void this.markRenderingStatePending();if(d)try{ys(this,uu,Vu).call(this,e,t,i);var c=n?0:1;$a()(this,eu,c),$a()(this,Os,a),Object.assign(Ja()(this,Rs),r),$a()(this,Is,e),$a()(this,ws,t),$a()(this,Ts,Ja()(this,Us).width),$a()(this,ks,Ja()(this,Us).height)}catch(e){console.error("[WebGPURenderDisplay] updateRemoteVideoTextures() error:".concat(e.message)),Object(bi.d)("[WebGPURenderDisplay] updateRemoteVideoTextures() error:".concat(e.message)),u.setPendingVideoFrame(null),this.markRenderingStatePending()}finally{Ja()(this,Js).recycleTextureBufferGroup(u)}else try{var l=ys(this,Du,id).call(this,e,t,Ja()(this,Ms));l.label="YuvVideoTexBuffer(".concat(u.getIndex(),")-").concat(l.size),u.setColorFormat(l.colorFormat);var h=u.getTextureBufferGroup();if(!(h=ys(this,Mu,nd).call(this,u,h,l))||!h.buffer)return console.warn("[updateRemoteVideoTextures()] texLayer(".concat(u.getIndex(),") cannot apply a GPUBuffer!")),void this.markRenderingStatePending();var f=n?0:1;$a()(this,eu,f),$a()(this,Os,a),Object.assign(Ja()(this,Rs),r),$a()(this,Is,e),$a()(this,ws,t),$a()(this,Ts,Ja()(this,Us).width),$a()(this,ks,Ja()(this,Us).height),ys(this,du,Uu).call(this,Ja()(this,Cs),e,t,i,h,Ja()(this,Ms)),this.markRenderingStateReady()}catch(e){console.error("[WebGPURenderDisplay] updateRemoteVideoTextures() error:".concat(e.message," cs:").concat(e.stack)),Object(bi.d)("[WebGPURenderDisplay] updateRemoteVideoTextures() error:".concat(e.message)),Ja()(this,Js).recycleTextureBufferGroup(u),this.markRenderingStatePending()}}},{key:"drawNextOutputPictureFrame",value:function(e,t,r,i,a){var n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],u=Si.w.VS_BASE,d=ys(this,bu,Yu).call(this,u);if(!Ja()(this,Us)||!Ja()(this,Vs))return ys(this,Nu,ud).call(this),void this.markRenderingStatePending();if(Fi(Ja()(this,Js),e,t))return Ja()(this,Js).recycleTextureBufferGroup(d),void this.markRenderingStatePending();a=a||Si.p;var c=(r=r||{top:0,left:0,width:e,height:t}).width!=Ja()(this,Rs).width||r.height!=Ja()(this,Rs).height,l=r.top!=Ja()(this,Rs).top||r.left!=Ja()(this,Rs).left,h=Ja()(this,Us).width!=Ja()(this,Ts)||Ja()(this,Us).height!=Ja()(this,ks),f=e!=Ja()(this,Is)||t!=Ja()(this,ws),p=a!=Ja()(this,Ds);if((c||h||p)&&ys(this,mu,ju).call(this,Ja()(this,Us),r.width,r.height,a,o),c||l||f||p||!d.getUVCoords()){var v=ys(this,pu,Fu).call(this,e,t,r,a),m=d.getUVCoords();m||(m=new Float32Array(12)),m.set(v),d.setUVCoords(m)}var g=n?0:1;g!=Ja()(this,eu)&&$a()(this,eu,g),o?d.evalViewport(o.x,o.y,o.width,o.height,Ja()(this,Us).height):d.evalViewport(0,0,Ja()(this,Us).width,Ja()(this,Us).height,Ja()(this,Us).height),$a()(this,Zs,0),$a()(this,$s,x.S),Object.assign(Ja()(this,Rs),r),$a()(this,Is,e),$a()(this,ws,t),$a()(this,Ds,a),$a()(this,Ts,Ja()(this,Us).width),$a()(this,ks,Ja()(this,Us).height),d.setColorFormat("i420");try{var _=ys(this,Du,id).call(this,e,t,x.S);if(_.label="YuvShareTexBuffer(".concat(d.getIndex(),")-").concat(_.size),s){var S=d.getTextureBufferGroup();if(!(S=ys(this,Mu,nd).call(this,d,S,_))||!S.buffer)return console.warn("[drawNextOutputPictureFrame()] texLayer(".concat(d.getIndex(),") cannot apply a GPU buffer!")),void this.markRenderingStatePending();ys(this,du,Uu).call(this,Ja()(this,Cs),e,t,i,S,x.S);var E=ys(this,Cu,Qu).call(this);E&&E.buffer&&d.setUniformBuffer(E.buffer)}Ja()(this,zs)?$a()(this,iu,1):$a()(this,iu,0),$a()(this,qs,1),this.markRenderingStateReady()}catch(e){console.error("[WebGPURenderDisplay] drawNextOutputPictureFrame() error:".concat(e.message)),Object(bi.d)("[WebGPURenderDisplay] drawNextOutputPictureFrame() error:".concat(e.message)),Ja()(this,Js).recycleTextureBufferGroup(d),this.markRenderingStatePending()}}},{key:"clearCanvas",value:function(e){Ja()(this,Vs)&&Ja()(this,Vs).clearAttachedCanvas()}},{key:"updateSelfMaskImage",value:function(e,t,r){var i=Si.w.MASK,a=ys(this,bu,Yu).call(this,i);if(!Ja()(this,Us))return Ja()(this,Js).recycleTextureBufferGroup(a),void this.markRenderingStatePending();if(e<=0||t<=0||!r||r.length!=e*t*4)return Ja()(this,Js).recycleTextureBufferGroup(a),void this.markRenderingStatePending();if(!ys(this,Eu,Xu).call(this,Si.w.VS_BASE))return console.log("[updateSelfMaskImage] base layer is not ready."),Ja()(this,Js).recycleTextureBufferGroup(a),void this.markRenderingStatePending();try{var n=ys(this,Ou,ad).call(this,e,t),o=a.getTextureBufferGroup();if(!(o=ys(this,Mu,nd).call(this,a,o,n))||!o.buffer)return console.warn("[updateSelfMaskImage()] texLayer(".concat(a.getIndex(),") cannot apply a GPU buffer!")),void this.markRenderingStatePending();if(o.buffer.label="SelfMaskImageTexBuffer(".concat(a.getIndex(),")-").concat(n.size),a.setTextureLayerType(Si.v.BLEND_LAYER),a.setTextureType(Si.x.GPU_TEX_RGBA),a.isLocked()){var s=a.getWidth(),u=a.getHeight();s==e&&u==t||(a.setWidth(e),a.setHeight(t),a.setIsNew(!0))}else a.setWidth(e),a.setHeight(t),a.setIsNew(!0),a.lock();var d=Ja()(this,Vs).writeToRgbaTextureBuffer(Ja()(this,Cs),e,t,r,o);a.setTextureBufferGroup(d);var c=ys(this,bu,Yu).call(this,Si.w.VS_BASE),l=c.getViewport();l&&a.setViewport(l),a.setUVCoords(c.getUVCoords()),this.isSetWatermark()&&Ja()(this,Hs)&&Ja()(this,js),this.markRenderingStateReady()}catch(e){console.error("[WebGPURenderDisplay] updateSelfMaskImage() error:".concat(e.message)),Object(bi.d)("[WebGPURenderDisplay] updateSelfMaskImage() error:".concat(e.message)),Ja()(this,Js).recycleTextureBufferGroup(a),this.markRenderingStatePending()}}},{key:"readPixelsSyncRequest",value:function(e,t,r,i){}},{key:"isAvaiable",value:function(){return!0}},{key:"markRenderingStateReady",value:function(){$a()(this,Ks,Si.k.READY)}},{key:"markRenderingStateRendering",value:function(){$a()(this,Ks,Si.k.RENDERING)}},{key:"markRenderingStatePending",value:function(){$a()(this,Ks,Si.k.PENDING)}},{key:"markRenderingStateIdle",value:function(){$a()(this,Ks,Si.k.IDLE)}},{key:"isRenderingStateReady",value:function(){return Ja()(this,Ks)===Si.k.READY}},{key:"isInTargetRenderingState",value:function(e){return Ja()(this,Ks)===e}},{key:"getWatermarkWidth",value:function(){return Ja()(this,Hs)}},{key:"getWatermarkHeight",value:function(){return Ja()(this,js)}},{key:"getIndex",value:function(){return Ja()(this,Cs)}},{key:"getRenderingState",value:function(){return Ja()(this,Ks)}},{key:"recycle",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e){var r,i=gs(Ja()(this,su));try{for(i.s();!(r=i.n()).done;){var a=O()(r.value,2),n=(a[0],a[1]);n&&(Ja()(this,Js).recycleTextureBufferGroup(n,t),n.recycle(e))}}catch(e){i.e(e)}finally{i.f()}}else console.error("[WebGPURenderDisplay] recycle() resMgr is invalid!");this.markRenderingStateIdle(),Ja()(this,su).clear(),Ja()(this,ou).clear(),this.unbindSsrc()}},{key:"cleanup",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e?this.recycle(e,t):console.error("[WebGPURenderDisplay] cleanup() resMgr is invalid!  needToRecycle=".concat(t)),this.removeRenderer(),this.detachCanvas(),this.removeGPUResMgr()}},{key:"clear",value:function(e){console.log("WebGPURenderDisplay.clear"),this.clearCanvas(),$a()(this,qs,0),$a()(this,zs,0),this.recycle(e)}},{key:"clearDisplay",value:function(){console.log("WebGPURenderDisplay.clearDisplay"),this.clearCanvas()}},{key:"getTextureLayersMap",value:function(){return Ja()(this,su)}},{key:"getTextureLayerByZIndex",value:function(e){return ys(this,bu,Yu).call(this,e)}},{key:"getUsedBuffersCount",value:function(){var e,t=0,r=gs(Ja()(this,su));try{for(r.s();!(e=r.n()).done;){var i=O()(e.value,2),a=(i[0],i[1]);a&&a.getTextureBufferGroup()&&a.getTextureBufferGroup().buffer&&t++}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"consumePendingGPUEvents",value:function(){if(Ja()(this,Ws)){var e=ys(this,bu,Yu).call(this,Si.w.WATERMARK).getRawData();e&&this.updateWatermark(Ja()(this,Hs),Ja()(this,js),e.data)}}},{key:"resizeCanvasTo",value:function(e,t){Ja()(this,Us)&&(Ja()(this,Us).width=e,Ja()(this,Us).height=t)}}]),e}();function cd(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return ld(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ld(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function ld(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function hd(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}var fd=new WeakMap,pd=new WeakMap,vd=new WeakMap,md=new WeakMap,gd=new WeakMap,_d=function(){function e(t,r,i){l()(this,e),hd(this,fd,{writable:!0,value:0}),hd(this,pd,{writable:!0,value:null}),hd(this,vd,{writable:!0,value:null}),hd(this,md,{writable:!0,value:Si.t.AVAILABLE}),hd(this,gd,{writable:!0,value:null}),$a()(this,fd,t),$a()(this,md,r),$a()(this,gd,i),$a()(this,pd,[]),$a()(this,vd,[])}return f()(e,[{key:"initPool",value:function(e){if(e>Ja()(this,fd))throw new Error("initSize=".concat(e," is larger than maxSize=").concat(Ja()(this,fd),", invalid!"));if(e<0)throw new Error("initSize=".concat(e," is smaller than 0, invalid!"));for(var t=0;t<e;t++){var r=new dd(t,Ja()(this,gd));Ja()(this,pd).push(r)}}},{key:"expandPool",value:function(e){if(!(Ja()(this,pd).length>=Ja()(this,fd))){var t=0;if(Ja()(this,pd).length+e>=Ja()(this,fd)&&(t=Ja()(this,fd)-Ja()(this,pd).length),t>0)for(var r=Ja()(this,pd).length,i=0;i<t;i++){var a=new dd(i+r,Ja()(this,gd));Ja()(this,pd).push(a)}}}},{key:"pop",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e&&this.isPoolEmpty()&&this.expandPool(4);var t=Ja()(this,pd).pop();return t&&(t.markRenderingStatePending(),Ja()(this,vd).push(t)),t}},{key:"recycle",value:function(e,t){if(Ja()(this,pd).length<Ja()(this,fd)){e.recycle(t),Ja()(this,pd).push(e);var r=Ja()(this,vd).indexOf(e);-1!=r&&Ja()(this,vd).splice(r,1)}}},{key:"clear",value:function(e){if(Ja()(this,pd)){var t,r=cd(Ja()(this,pd));try{for(r.s();!(t=r.n()).done;){var i=t.value;i&&i.clear(e)}}catch(e){r.e(e)}finally{r.f()}Ja()(this,pd).length=0}}},{key:"cleanup",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Ja()(this,pd).forEach((function(r){r.cleanup(e,t)})),Ja()(this,vd).forEach((function(r){r.cleanup(e,t)})),$a()(this,pd,[]),$a()(this,vd,[])}},{key:"isPoolEmpty",value:function(){return 0==Ja()(this,pd).length}},{key:"getInUseRenderDisplays",value:function(){return Ja()(this,vd)}},{key:"getAllRenderDisplays",value:function(){return Ja()(this,pd)}},{key:"isServeForVideoRendering",value:function(){return Ja()(this,md)===Si.t.VIDEO}},{key:"isServeForShareRendering",value:function(){return Ja()(this,md)===Si.t.SHARE}},{key:"isServingForNow",value:function(e){return Ja()(this,md)===e}}]),e}();function Sd(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Ed(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ed(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function Ed(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function bd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=R()(e);if(t){var a=R()(this).constructor;r=Reflect.construct(i,arguments,a)}else r=i.apply(this,arguments);return C()(this,r)}}function yd(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}var Cd=new WeakMap,Ad=new WeakMap,Rd=new WeakMap,Id=new WeakMap,wd=function(){function e(){l()(this,e),yd(this,Cd,{writable:!0,value:null}),yd(this,Ad,{writable:!0,value:null}),yd(this,Rd,{writable:!0,value:null}),yd(this,Id,{writable:!0,value:null})}return f()(e,[{key:"setGPUResourceMgr",value:function(e){$a()(this,Id,e)}},{key:"getWebGLRenderDisplayMgr",value:function(){return Ja()(this,Cd)||$a()(this,Cd,new Dd),Ja()(this,Cd)}},{key:"getWebGL2RenderDisplayMgr",value:function(){return Ja()(this,Ad)||$a()(this,Ad,new Md),Ja()(this,Ad)}},{key:"getWebGPURenderDisplayMgr",value:function(){return Ja()(this,Rd)||($a()(this,Rd,new Vd),Ja()(this,Rd).setGPUResourceMgr(Ja()(this,Id))),Ja()(this,Rd)}},{key:"getVideoRenderDisplay",value:function(e,t,r,i,a){var n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=null;return e===Si.j.WEBGL?(Ja()(this,Cd)||$a()(this,Cd,new Dd),s=Ja()(this,Cd).getVideoRenderDisplay(t,r,i,a,o)):e===Si.j.WEBGL_2?(Ja()(this,Ad)||$a()(this,Ad,new Md),s=Ja()(this,Ad).getVideoRenderDisplay(t,r,i,a,o)):e===Si.j.WEBGPU&&(Ja()(this,Rd)||($a()(this,Rd,new Vd),Ja()(this,Rd).setGPUResourceMgr(Ja()(this,Id))),(s=Ja()(this,Rd).getVideoRenderDisplay(t,r,i,a)).addRenderer(n),s.attachCanvas(t)),s}},{key:"getSharingRenderDisplay",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=null;return e===Si.j.WEBGL?(Ja()(this,Cd)||$a()(this,Cd,new Dd),n=Ja()(this,Cd).getSharingRenderDisplay(t,r,a)):e===Si.j.WEBGL_2?(Ja()(this,Ad)||$a()(this,Ad,new Md),n=Ja()(this,Ad).getSharingRenderDisplay(t,r,a)):e===Si.j.WEBGPU&&(Ja()(this,Rd)||($a()(this,Rd,new Vd),Ja()(this,Rd).setGPUResourceMgr(Ja()(this,Id))),(n=Ja()(this,Rd).getSharingRenderDisplay(t,r,a)).addRenderer(i),n.attachCanvas(t),n.setGPUResMgr(Ja()(this,Id))),n}},{key:"createVideoRenderDisplay",value:function(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=null;return e==Si.j.WEBGL?(Ja()(this,Cd)||$a()(this,Cd,new Dd),o=Ja()(this,Cd).createVideoRenderDisplay(t,r,i,a,n)):e==Si.j.WEBGL_2?(Ja()(this,Ad)||$a()(this,Ad,new Md),o=Ja()(this,Ad).createVideoRenderDisplay(t,r,i,a,n)):e==Si.j.WEBGPU&&(Ja()(this,Rd)||($a()(this,Rd,new Vd),Ja()(this,Rd).setGPUResourceMgr(Ja()(this,Id))),(o=Ja()(this,Rd).createVideoRenderDisplay(t,r,i,a,n)).addRenderer(a),o.attachCanvas(t),o.setGPUResMgr(Ja()(this,Id))),o}},{key:"recycleRenderDisplay",value:function(e,t,r,i){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e===Si.j.WEBGPU?Ja()(this,Rd)&&Ja()(this,Rd).recycleRenderDisplay(r,i,a):e===Si.j.WEBGL?Ja()(this,Cd)&&Ja()(this,Cd).recycleRenderDisplay(t,r,a):e===Si.j.WEBGL_2&&Ja()(this,Ad)&&Ja()(this,Ad).recycleRenderDisplay(t,r,a)}},{key:"collectInUseRenderDisplays",value:function(e,t){var r=null;return e===Si.j.WEBGPU&&Ja()(this,Rd)&&(r=Ja()(this,Rd).collectInUseRenderDisplays(t)),r}},{key:"collectInUseRenderDisplaysByCanvas",value:function(e,t,r){var i=null;return e===Si.j.WEBGPU&&Ja()(this,Rd)&&(i=Ja()(this,Rd).collectInUseRenderDisplaysByCanvas(t,r)),i}},{key:"getRenderDisplayMap",value:function(e,t){if(e===Si.j.WEBGL){if(Ja()(this,Cd))return Ja()(this,Cd).getRenderDisplayMap()}else if(e===Si.j.WEBGPU){if(Ja()(this,Rd))return Ja()(this,Rd).getRenderDisplayMap(t)}else if(e===Si.j.WEBGL_2&&Ja()(this,Ad))return Ja()(this,Ad).getRenderDisplayMap(t);return null}},{key:"onRestoredFromContextLost",value:function(e,t,r,i,a){var n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return Ja()(this,Cd)?Ja()(this,Cd).onRestoredFromContextLost(e,t,r,i,a,n):Ja()(this,Ad)?Ja()(this,Ad).onRestoredFromContextLost(e,t,r,i,a,n):null}},{key:"cleanup",value:function(e,t,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];null!==Ja()(this,Cd)&&Ja()(this,Cd).cleanup(e,t),Ja()(this,Ad)&&Ja()(this,Ad).cleanup(e,t),null!==Ja()(this,Rd)&&Ja()(this,Rd).cleanup(t,r,i)}},{key:"cleanupByCanvas",value:function(e,t){null!==Ja()(this,Cd)&&Ja()(this,Cd).cleanupByCanvas(e),null!==Ja()(this,Ad)&&Ja()(this,Ad).cleanupByCanvas(e),null!==Ja()(this,Rd)&&Ja()(this,Rd).cleanupByCanvas(e,t)}}]),e}(),Td=function(){function e(){l()(this,e)}return f()(e,[{key:"getVideoRenderDisplay",value:function(e,t,r,i){throw new Error("getVideoRenderDisplay() should be implemented by subclass.")}},{key:"getSharingRenderDisplay",value:function(e,t,r){throw new Error("getSharingRenderDisplay() should be implemented by subclass.")}},{key:"createVideoRenderDisplay",value:function(e,t,r){throw new Error("createVideoRenderDisplay() should be implemented by subclass.")}}]),e}(),kd=new WeakMap,Dd=function(e){b()(r,e);var t=bd(r);function r(){var e;return l()(this,r),e=t.call(this),yd(S()(e),kd,{writable:!0,value:new Map}),e}return f()(r,[{key:"createVideoRenderDisplay",value:function(e,t,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=null,n=null,o=null,s=!1;return i&&(a=i.forceNoGL,n=i.contextOptions,o=i.webGLResources,s=i.initMask),new zi(e,t,r,a,n,o,s)}},{key:"getVideoRenderDisplay",value:function(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=Ja()(this,kd).get(e);if(!n){var o=[],s=[];n=[o,s],Ja()(this,kd).set(e,n);var u=new zi(e,t,0,void 0,void 0);u.setMultiView(!0),a&&a.set(e,u);for(var d=1;d<=r;d++){var c=new zi(e,t,d,void 0,void 0,{program:u.shaderProgram,contextgl:u.contextGL,vBuffer:u.vertexPosBuffer,tBuffer:u.texturePosBuffer,waterMarkTextureRef:u.waterMarkTextureRef,repeatedWaterMarkTextureRef:u.repeatedWaterMarkTextureRef});c.setMultiView(!0),o.push(c)}}var l,h=Ja()(this,kd).get(e),f=h[0],p=h[1];if(h&&(f[0]&&(l=f.shift()),p.push(l)),!l){var v=h?"".concat(h.length):"undefined",m=f?"".concat(f.length):"undefined";i("No Display obtained from VideoRender.Get_Display. canvasRenderArray:".concat(v," unusedRenderArray:").concat(m))}return l}},{key:"getSharingRenderDisplay",value:function(e,t,r){return new zi(e,t,0,void 0,r.contextOptions)}},{key:"recycleRenderDisplay",value:function(e,t,r){t.setWatermarkFlag(0),t.setVideoMode(x.T),t.clear(r);var i=Ja()(this,kd).get(e);if(i){var a=i[0],n=i[1];n&&n.some((function(e,r){if(e===t)return n.splice(r,1),!0})),a.push(t)}}},{key:"onRestoredFromContextLost",value:function(e,t,r,i,a){var n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=Ja()(this,kd).get(r);(!o||o.length<2)&&a("canvasRenderArray:".concat(o,", length:").concat(null==o?void 0:o.length));var s=n.get(t);if(s){s.reinit();for(var u=0;u<(null==o?void 0:o.length);u++)o[u].forEach((function(e){null==e||e.reinit({program:s.shaderProgram,contextgl:s.contextGL,vBuffer:s.vertexPosBuffer,tBuffer:s.texturePosBuffer,waterMarkTextureRef:s.waterMarkTextureRef,repeatedWaterMarkTextureRef:s.repeatedWaterMarkTextureRef})}));return r!==t&&(Ja()(this,kd).delete(r),Ja()(this,kd).set(t,o),n&&(n.delete(r),n.set(t,s))),null}}},{key:"getRenderDisplayMap",value:function(){return Ja()(this,kd)}},{key:"cleanup",value:function(e,t){var r;null==t||null===(r=t.cleanup)||void 0===r||r.call(t,null);var i,a=Sd(Ja()(this,kd));try{for(a.s();!(i=a.n()).done;){var n,o=O()(i.value,2),s=(o[0],o[1]),u=s[0],d=s[1],c=Sd(u);try{for(c.s();!(n=c.n()).done;){n.value.cleanup()}}catch(e){c.e(e)}finally{c.f()}var l,h=Sd(d);try{for(h.s();!(l=h.n()).done;){l.value.cleanup()}}catch(e){h.e(e)}finally{h.f()}}}catch(e){a.e(e)}finally{a.f()}$a()(this,kd,new Map)}},{key:"cleanupByCanvas",value:function(e){if(Ja()(this,kd).get(e)){var t=Ja()(this,kd).get(e);if(t){var r=t[0],i=t[1];i.forEach((function(e){var t;null==e||null===(t=e.cleanup)||void 0===t||t.call(e)})),r.forEach((function(e){var t;null==e||null===(t=e.cleanup)||void 0===t||t.call(e)})),r=[],i=[],Ja()(this,kd).delete(e)}}}}]),r}(Td),Od=new WeakMap,Md=function(e){b()(r,e);var t=bd(r);function r(){var e;return l()(this,r),e=t.call(this),yd(S()(e),Od,{writable:!0,value:new Map}),e}return f()(r,[{key:"createVideoRenderDisplay",value:function(e,t,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=null,n=null,o=null,s=!1;return i&&(a=i.forceNoGL,n=i.contextOptions,o=i.webGLResources,s=i.initMask),new ra(e,t,r,a,n,o,s)}},{key:"getVideoRenderDisplay",value:function(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=Ja()(this,Od).get(e);if(!n){var o=[],s=[];n=[o,s],Ja()(this,Od).set(e,n);var u=new ra(e,t,0,void 0,void 0);u.setMultiView(!0),a&&a.set(e,u);for(var d=1;d<=r;d++){var c=new ra(e,t,d,void 0,void 0,{program:u.shaderProgram,contextgl:u.contextGL,vBuffer:u.vertexPosBuffer,tBuffer:u.texturePosBuffer,waterMarkTextureRef:u.waterMarkTextureRef,repeatedWaterMarkTextureRef:u.repeatedWaterMarkTextureRef});c.setMultiView(!0),o.push(c)}}var l,h=Ja()(this,Od).get(e),f=h[0],p=h[1];if(h&&(f[0]&&(l=f.shift()),p.push(l)),!l){var v=h?"".concat(h.length):"undefined",m=f?"".concat(f.length):"undefined";i("No Display obtained from VideoRender.Get_Display. canvasRenderArray:".concat(v," unusedRenderArray:").concat(m))}return l}},{key:"getSharingRenderDisplay",value:function(e,t,r){return new ra(e,t,0,void 0,r.contextOptions)}},{key:"recycleRenderDisplay",value:function(e,t,r){t.setWatermarkFlag(0),t.setVideoMode(x.T),t.clear(r);var i=Ja()(this,Od).get(e);if(i){var a=i[0],n=i[1];n&&n.some((function(e,r){if(e===t)return n.splice(r,1),!0})),a.push(t)}}},{key:"onRestoredFromContextLost",value:function(e,t,r,i,a){var n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=Ja()(this,Od).get(r);(!o||o.length<2)&&a("canvasRenderArray:".concat(o,", length:").concat(null==o?void 0:o.length));var s=n.get(t);if(s){s.reinit();for(var u=0;u<(null==o?void 0:o.length);u++)o[u].forEach((function(e){null==e||e.reinit({program:s.shaderProgram,contextgl:s.contextGL,vBuffer:s.vertexPosBuffer,tBuffer:s.texturePosBuffer,waterMarkTextureRef:s.waterMarkTextureRef,repeatedWaterMarkTextureRef:s.repeatedWaterMarkTextureRef})}));return r!==t&&(Ja()(this,Od).delete(r),Ja()(this,Od).set(t,o),n&&(n.delete(r),n.set(t,s))),null}}},{key:"getRenderDisplayMap",value:function(){return Ja()(this,Od)}},{key:"cleanup",value:function(e,t){var r;null==t||null===(r=t.cleanup)||void 0===r||r.call(t);var i,a=Sd(Ja()(this,Od));try{for(a.s();!(i=a.n()).done;){var n,o=O()(i.value,2),s=(o[0],o[1]),u=s[0],d=s[1],c=Sd(u);try{for(c.s();!(n=c.n()).done;){n.value.cleanup()}}catch(e){c.e(e)}finally{c.f()}var l,h=Sd(d);try{for(h.s();!(l=h.n()).done;){l.value.cleanup()}}catch(e){h.e(e)}finally{h.f()}}}catch(e){a.e(e)}finally{a.f()}$a()(this,Od,new Map)}},{key:"cleanupByCanvas",value:function(e){if(Ja()(this,Od).get(e)){var t=Ja()(this,Od).get(e);if(t){var r=t[0],i=t[1];i.forEach((function(e){var t;null==e||null===(t=e.cleanup)||void 0===t||t.call(e)})),r.forEach((function(e){var t;null==e||null===(t=e.cleanup)||void 0===t||t.call(e)})),r=[],i=[],Ja()(this,Od).delete(e)}}}}]),r}(Td),xd=new WeakMap,Pd=new WeakMap,Nd=new WeakMap,Vd=function(e){b()(r,e);var t=bd(r);function r(){var e;return l()(this,r),e=t.call(this),yd(S()(e),xd,{writable:!0,value:new Map}),yd(S()(e),Pd,{writable:!0,value:new Map}),yd(S()(e),Nd,{writable:!0,value:null}),e}return f()(r,[{key:"setGPUResourceMgr",value:function(e){$a()(this,Nd,e)}},{key:"getVideoRenderDisplay",value:function(e,t,r,i){var a=Ja()(this,xd).get(e);a||((a=new _d(r,Si.t.VIDEO,Ja()(this,Nd))).initPool(r),Ja()(this,xd).set(e,a));var n=a.pop();return n?(n.setMultiView(!0),n):null}},{key:"getSharingRenderDisplay",value:function(e,t,r){r&&r.clearCache&&Ja()(this,Pd).clear();var i=Ja()(this,Pd).get(e);return i||((i=new _d(1,Si.t.SHARE,Ja()(this,Nd))).initPool(1),Ja()(this,Pd).set(e,i)),i.pop()}},{key:"createVideoRenderDisplay",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=new dd(r,Ja()(this,Nd));return a.addRenderer(i),a.attachCanvas(e),a}},{key:"getInUseCanvasRenderDisplayList",value:function(e){var t=[],r=null;if(e==Si.t.VIDEO?r=Ja()(this,xd):e==Si.t.SHARE&&(r=Ja()(this,Pd)),r){var i,a=Sd(r);try{for(a.s();!(i=a.n()).done;){var n=O()(i.value,2),o=n[0],s=n[1],u={};u.canvas=o,u.renderDisplays=s.getInUseRenderDisplays(),u.renderDisplays.length>0&&t.push(u)}}catch(e){a.e(e)}finally{a.f()}}return t}},{key:"recycleRenderDisplay",value:function(e,t,r){if(e){var i=e.getAttachedCanvas();if(i){var a=Ja()(this,xd).get(i);a&&(e.setWatermarkFlag(0),e.setVideoMode(x.T),a.recycle(e,t));var n=Ja()(this,Pd).get(i);n&&(e.setWatermarkFlag(0),e.setVideoMode(x.T),n.recycle(e,t))}}}},{key:"cleanup",value:function(e,t){var r,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];null==e||null===(r=e.cleanup)||void 0===r||r.call(e,t,i);var a,n=Sd(Ja()(this,xd));try{for(n.s();!(a=n.n()).done;){var o=O()(a.value,2),s=(o[0],o[1]);s.cleanup(t,i)}}catch(e){n.e(e)}finally{n.f()}var u,d=Sd(Ja()(this,Pd));try{for(d.s();!(u=d.n()).done;){var c=O()(u.value,2),l=(c[0],c[1]);l.cleanup(t,i)}}catch(e){d.e(e)}finally{d.f()}}},{key:"cleanupByCanvas",value:function(e,t){var r=Ja()(this,xd).get(e);r&&(r.cleanup(t),Ja()(this,xd).delete(e));var i=Ja()(this,Pd).get(e);i&&(i.cleanup(t),Ja()(this,Pd).delete(e))}},{key:"collectInUseRenderDisplays",value:function(e){return this.getInUseCanvasRenderDisplayList(e)}},{key:"collectInUseRenderDisplaysByCanvas",value:function(e,t){var r=null;if(e)if(t==Si.t.VIDEO)r=Ja()(this,xd).get(e).getInUseRenderDisplays();else if(t==Si.t.SHARE){r=Ja()(this,Pd).get(e).getInUseRenderDisplays()}return r}},{key:"getRenderDisplayMap",value:function(e){var t=null;return e==Si.t.VIDEO?t=Ja()(this,xd):e==Si.t.SHARE&&(t=Ja()(this,Pd)),t}}]),r}(Td),Ud=wd;function Ld(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Wd(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Wd(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function Wd(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function Bd(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}var Gd=new WeakMap,Fd=new WeakMap,Hd=new WeakMap,jd=new WeakMap,Kd=new WeakMap,qd=new WeakMap,Xd=new WeakMap,Yd=function(){function e(t){l()(this,e),Bd(this,Gd,{writable:!0,value:Si.f.VERTEX_BUFFER}),Bd(this,Fd,{writable:!0,value:{}}),Bd(this,Hd,{writable:!0,value:null}),Bd(this,jd,{writable:!0,value:0}),Bd(this,Kd,{writable:!0,value:0}),Bd(this,qd,{writable:!0,value:[]}),Bd(this,Xd,{writable:!0,value:new Map}),$a()(this,Hd,t)}return f()(e,[{key:"acquireBuffer",value:function(e,t,r){var i,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return n?Ja()(this,Xd).has(e)?i=Ja()(this,Xd).get(e):Ja()(this,qd).length>0?(i=Ja()(this,qd).pop(),Ja()(this,Xd).set(e,i)):(i=Ja()(this,Hd).createBuffer({size:r,usage:t,mappedAtCreation:a}),Ja()(this,Xd).set(e,i)):i=Ja()(this,Hd).createBuffer({size:r,usage:t,mappedAtCreation:a}),i}},{key:"releaseBuffer",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(Ja()(this,Xd).has(e)){var i=Ja()(this,Xd).get(e);r?Ja()(this,qd).push(i):i.destroy(),Ja()(this,Xd).delete(e)}else r||-1!=Ja()(this,qd).indexOf(t)&&(Ja()(this,qd)[index]=Ja()(this,qd)[Ja()(this,qd).length-1],Ja()(this,qd).pop(),t.destroy())}},{key:"getNumUsedBuffers",value:function(){return Ja()(this,jd)}},{key:"getNumFreeBuffers",value:function(){return Ja()(this,Kd)}},{key:"cleanup",value:function(){Ja()(this,qd).forEach((function(e,t){e.forEach((function(e){e.destroy()}))})),Ja()(this,Xd).forEach((function(e,t){e.forEach((function(e){e.destroy()}))})),Ja()(this,qd).length=0,Ja()(this,Xd).clear(),$a()(this,jd,0),$a()(this,Kd,0)}},{key:"release",value:function(e){e==Si.n.OVERUSE&&(Ja()(this,qd).forEach((function(e,t){e.forEach((function(e){e.destroy()}))})),Ja()(this,qd).length=0,$a()(this,Kd,0))}},{key:"getResourceType",value:function(){return Ja()(this,Gd)}},{key:"collectResourceInfo",value:function(){var e,t=0,r=0,i="",a=Ld(Ja()(this,Xd));try{for(a.s();!(e=a.n()).done;){var n=O()(e.value,2),o=n[0],s=n[1];t++,r+=s.size,i+="[GPUBufferMgr] entry{key:".concat(o,", buffer:{label:").concat(s.label," size:").concat(s.size,"}}\n")}}catch(e){a.e(e)}finally{a.f()}var u,d=Ld(Ja()(this,qd));try{for(d.s();!(u=d.n()).done;){var c=u.value;t++,r+=c.size}}catch(e){d.e(e)}finally{d.f()}return i+="[GPUBufferMgr] freeBuffers{size:".concat(Ja()(this,qd).length,"}\n"),i+="[GPUBufferMgr] total: count:".concat(t," usedBytes:").concat(r,"\n"),Ja()(this,Fd).type=Ja()(this,Gd),Ja()(this,Fd).count=t,Ja()(this,Fd).usedBytes=r,Ja()(this,Fd).output=i,Ja()(this,Fd)}},{key:"onOccupancyLevelEvaluated",value:function(e){console.log("[GPUBufferManager] onOccupancyLevelEvaluated() level:".concat(e)),Object(bi.d)("[GPUBufferManager] onOccupancyLevelEvaluated() level:".concat(e)),this.release(e)}}]),e}();function zd(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Qd(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qd(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function Qd(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function Jd(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}var Zd=new WeakMap,$d=new WeakMap,ec=new WeakMap,tc=function(){function e(){l()(this,e),Jd(this,Zd,{writable:!0,value:Si.f.TEXTURE}),Jd(this,$d,{writable:!0,value:[]}),Jd(this,ec,{writable:!0,value:[]})}return f()(e,[{key:"acquire",value:function(e){var t=null,r=Ja()(this,$d).findIndex((function(t){return t&&t.width==e.w&&t.height==e.h&&t.format==e.format&&t.usage==e.usage}));return r>-1&&(t=Ja()(this,$d).splice(r,1)[0]),t&&Ja()(this,ec).push(t),t}},{key:"recycle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ja()(this,ec).indexOf(e);-1!=r&&Ja()(this,ec).splice(r,1),t?e.destroy():(Ja()(this,$d).push(e),e.label="")}},{key:"pushToAvailablePool",value:function(e){e&&Ja()(this,$d).push(e)}},{key:"pushToInUsePool",value:function(e){e&&Ja()(this,ec).push(e)}},{key:"release",value:function(e){if(e==Si.n.OVERUSE&&Ja()(this,$d).length>0){var t,r=zd(Ja()(this,$d));try{for(r.s();!(t=r.n()).done;){t.value.destroy()}}catch(e){r.e(e)}finally{r.f()}Ja()(this,$d).length=0}}},{key:"cleanup",value:function(){var e,t=zd(Ja()(this,$d));try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(e){t.e(e)}finally{t.f()}var r,i=zd(Ja()(this,ec));try{for(i.s();!(r=i.n()).done;){r.value.destroy()}}catch(e){i.e(e)}finally{i.f()}Ja()(this,$d).length=0,Ja()(this,ec).length=0}},{key:"getAvailablePool",value:function(){return Ja()(this,$d)}},{key:"getInUsedPool",value:function(){return Ja()(this,ec)}},{key:"getResourceType",value:function(){return Ja()(this,Zd)}}]),e}();function rc(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return ic(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ic(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function ic(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function ac(e,t){oc(e,t),t.add(e)}function nc(e,t,r){oc(e,t),t.set(e,r)}function oc(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function sc(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}var uc=new WeakMap,dc=new WeakMap,cc=new WeakMap,lc=new WeakMap,hc=new WeakSet,fc=new WeakSet,pc=new WeakSet,vc=new WeakSet,mc=new WeakSet;function gc(e){var t=Ja()(this,cc).get(e.level),r=null;return t?(r=t.acquire(e))||((r=sc(this,pc,Sc).call(this,e))?t.pushToInUsePool(r):(console.error("acquireTexture() cannot create an available tex. texConfig=".concat(JSON.stringify(e))),Object(bi.d)("[GPUTextureMgr] acquireTexture() failed! texConfig:".concat(JSON.stringify(e))))):(r=sc(this,pc,Sc).call(this,e))?((t=new tc).pushToInUsePool(r),Ja()(this,cc).set(e.level,t)):(console.error("acquireTexture() cannot create an available tex. texConfig=".concat(JSON.stringify(e))),Object(bi.d)("[GPUTextureMgr] acquireTexture() failed! texConfig:".concat(JSON.stringify(e)))),r}function _c(e){var t=e.zOrder,r=Ja()(this,lc).get(t);return r?(e.w>r.width||e.h>r.height)&&(r.destroy(),r=sc(this,pc,Sc).call(this,e),Ja()(this,lc).set(t,r)):(r=sc(this,pc,Sc).call(this,e),Ja()(this,lc).set(t,r)),r}function Sc(e){if(!Ja()(this,uc))return null;if(0==e.w||0==e.h)return null;var t={size:{width:e.w,height:e.h},format:e.format,usage:e.usage};return e.sampleCount>0&&(t.sampleCount=e.sampleCount),Ja()(this,uc).createTexture(t)}function Ec(e){for(var t=Si.u[Si.u.length-1],r=0;r<Si.u.length;++r)if(e<=Si.u[r]){t=Si.u[r];break}return t}function bc(e){return e&&e.zOrder&&e.zOrder==TEX_LAYER_Z_IDX.WATERMARK}var yc=function(){function e(t){l()(this,e),ac(this,mc),ac(this,vc),ac(this,pc),ac(this,fc),ac(this,hc),nc(this,uc,{writable:!0,value:null}),nc(this,dc,{writable:!0,value:{}}),nc(this,cc,{writable:!0,value:new Map}),nc(this,lc,{writable:!0,value:new Map}),$a()(this,uc,t)}return f()(e,[{key:"assembleTextureConfig",value:function(e,t,r,i,a){return{w:e,h:t,usage:r,format:i,sampleCount:a,level:sc(this,vc,Ec).call(this,t)}}},{key:"isSameTextureConfig",value:function(e,t){return!(!e||!t)&&(e.w==t.w&&e.h==t.h&&e.usage==t.usage&&e.format==t.format&&e.sampleCount==t.sampleCount)}},{key:"evalTexConfig",value:function(e){if(!e)throw new Error("hasSameTextureConfig() invalid input!");var t,r=e,i=rc(Ja()(this,cc).keys());try{for(i.s();!(t=i.n()).done;){var a=t.value;if(this.isSameTextureConfig(a,e)){r=a;break}}}catch(e){i.e(e)}finally{i.f()}return r}},{key:"needNewTexturesMapEntry",value:function(e,t){return!!t&&(!e||(e.w!=t.w||e.h!=t.h||e.usage!=t.usage||e.format!=t.format||e.sampleCount!=t.sampleCount))}},{key:"acquireTexture",value:function(e){if(!e||e.w<=0||e.h<=0)return console.error("[GPUTextureMgr] acquireTexture() texConfig is invalid"),null;return sc(this,mc,bc).call(this,e)?sc(this,fc,_c).call(this,e):sc(this,hc,gc).call(this,e)}},{key:"recycleTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){var r=this.assembleTextureConfig(e.width,e.height,e.usage,e.format,e.sampleCount),i=Ja()(this,cc).get(r.level);if(i)i.recycle(e,t);else if(console.warn("recycleTexture(".concat(e.label,") texture is not found in the map!, destroy:").concat(t)),t)e.destroy();else{var a=new tc;a.pushToAvailablePool(e),Ja()(this,cc).set(r.level,a)}}}},{key:"cleanup",value:function(){var e,t=rc(Ja()(this,cc));try{for(t.s();!(e=t.n()).done;){var r=O()(e.value,2),i=(r[0],r[1]);i&&i.cleanup()}}catch(e){t.e(e)}finally{t.f()}Ja()(this,cc).clear()}},{key:"collectResourceInfo",value:function(){var e,t=0,r=0,i="",a=rc(Ja()(this,cc));try{for(a.s();!(e=a.n()).done;){var n=O()(e.value,2),o=n[0],s=n[1];if(s){var u,d=s.getAvailablePool(),c=rc(d);try{for(c.s();!(u=c.n()).done;){var l=u.value;t++,"r8unorm"==l.format?r+=l.width*l.height:"rgba8unorm"==l.format&&(r+=l.width*l.height*Uint32Array.BYTES_PER_ELEMENT)}}catch(e){c.e(e)}finally{c.f()}var h,f=s.getInUsedPool(),p=rc(f);try{for(p.s();!(h=p.n()).done;){var v=h.value;t++,"r8unorm"==v.format?r+=v.width*v.height:"rgba8unorm"==v.format&&(r+=v.width*v.height*Uint32Array.BYTES_PER_ELEMENT)}}catch(e){p.e(e)}finally{p.f()}(d.length>0||f.length>0)&&(i+="[GPUTexturePool] level:".concat(o," pool:{ava_count:").concat(d.length," in_used_count:").concat(f.length,"}\n"))}}}catch(e){a.e(e)}finally{a.f()}return i+="[GPUTexturePool] total: count:".concat(t," usedBytes:").concat(r,"\n"),Ja()(this,dc).type=Si.f.TEXTURE,Ja()(this,dc).count=t,Ja()(this,dc).usedBytes=r,Ja()(this,dc).output=i,Ja()(this,dc)}},{key:"onOccupancyLevelEvaluated",value:function(e){if(console.log("[GPUTextureManager] onOccupancyLevelEvaluated() level:".concat(e)),Object(bi.d)("[GPUTextureManager] onOccupancyLevelEvaluated() level:".concat(e)),e==Si.n.OVERUSE){var t,r=rc(Ja()(this,cc));try{for(r.s();!(t=r.n()).done;){var i=O()(t.value,2),a=(i[0],i[1]);a&&a.release(e)}}catch(e){r.e(e)}finally{r.f()}}}}]),e}();function Cc(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Ac(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ac(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function Ac(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function Rc(e,t){wc(e,t),t.add(e)}function Ic(e,t,r){wc(e,t),t.set(e,r)}function wc(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Tc(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}var kc=new WeakMap,Dc=new WeakMap,Oc=new WeakMap,Mc=new WeakMap,xc=new WeakSet,Pc=new WeakSet;function Nc(e,t,r){var i=this;if(Ja()(this,Oc).set(e,t),r){var a=Array.from(Ja()(this,Oc).entries());a.sort((function(e,t){return e[0]-t[0]})),Ja()(this,Oc).clear(),a.forEach((function(e){var t=O()(e,2),r=t[0],a=t[1];Ja()(i,Oc).set(r,a)}))}}function Vc(e,t){if(!e||0==e.length)return null;var r,i=0,a=0,n=null,o=Cc(e);try{for(o.s();!(r=o.n()).done;){var s=r.value;"mapped"==s.mapState?(i+=1,n||s.size>=t&&(n=s)):a+=1}}catch(e){o.e(e)}finally{o.f()}if(i>0&&0==a||i>=2&&0!=a){if(n){var u=e.indexOf(n);-1!=u&&e.splice(u,1)}return n}return null}var Uc=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;l()(this,e),Rc(this,Pc),Rc(this,xc),Ic(this,kc,{writable:!0,value:Si.f.TEXTURE_BUFFER}),Ic(this,Dc,{writable:!0,value:0}),Ic(this,Oc,{writable:!0,value:new Map}),Ic(this,Mc,{writable:!0,value:0}),$a()(this,Dc,t),$a()(this,Mc,r)}return f()(e,[{key:"isUpToThreshold",value:function(e,t){if(e!=Ja()(this,Dc)||t<=0)return!1;if(0==Ja()(this,Mc))return!1;var r=Ja()(this,Oc).get(t);return!!r&&r.length>=Ja()(this,Mc)}},{key:"push",value:function(e,t,r){if(e!=Ja()(this,Dc)||!r||t<=0)return!1;var i=null,a=!1;if(Ja()(this,Oc).has(t)){if((i=Ja()(this,Oc).get(t))||(i=[],a=!0),!(i.length<Ja()(this,Mc)))return!1;i.push(r)}else(i=[]).push(r),a=!0;return a&&Tc(this,xc,Nc).call(this,t,i,a),!0}},{key:"acquire",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;var r=e.level,i=e.bytesPerRow,a=e.size;if(r!=Ja()(this,Dc)||i<=0)return console.error("[GPUBufferPoolEntry] acquire() level(".concat(r,") or bpr=").concat(i," is invalid!")),null;var n=null,o=!1;if(Ja()(this,Oc).has(i)){var s=Ja()(this,Oc).get(i);if(s){var u=s.findIndex((function(e){return"mapped"==e.mapState&&e.size>=a}));u>-1?n=s.splice(u,1)[0]:o=!0}else o=!0}else o=!0;if(o&&!n&&!t){var d=2,c=!1;r>=Si.m[Si.h]&&(c=!0);var l,h=Cc(Ja()(this,Oc));try{for(h.s();!(l=h.n()).done;){var f=O()(l.value,2),p=f[0],v=f[1];if((d>0||c)&&p>i){if(n=Tc(this,Pc,Vc).call(this,v,a)){e.bytesPerRow=p;break}d--}}}catch(e){h.e(e)}finally{h.f()}}return n}},{key:"recycle",value:function(e,t,r){if(e!=Ja()(this,Dc)||t<=0||!r)return!1;var i=!1;if(Ja()(this,Oc).has(t)){var a=!1,n=Ja()(this,Oc).get(t);n||(n=[],a=!0),n.push(r),a&&Tc(this,xc,Nc).call(this,t,n,a),i=!0}else i=this.push(e,t,r);return i}},{key:"release",value:function(e){if(e==Si.n.OVERUSE){var t,r=Cc(Ja()(this,Oc));try{for(r.s();!(t=r.n()).done;){var i=O()(t.value,2),a=(i[0],i[1]);if(a){var n,o=Cc(a);try{for(o.s();!(n=o.n()).done;){var s=n.value;"mapped"!=s.mapState&&"unmapped"!=s.mapState||s.destroy()}}catch(e){o.e(e)}finally{o.f()}a.length=0}}}catch(e){r.e(e)}finally{r.f()}Ja()(this,Oc).clear()}}},{key:"cleanup",value:function(){var e,t=Cc(Ja()(this,Oc));try{for(t.s();!(e=t.n()).done;){var r=O()(e.value,2),i=(r[0],r[1]);if(i){var a,n=Cc(i);try{for(n.s();!(a=n.n()).done;){var o=a.value;"mapped"!=o.mapState&&"unmapped"!=o.mapState||o.destroy()}}catch(e){n.e(e)}finally{n.f()}i.length=0}}}catch(e){t.e(e)}finally{t.f()}Ja()(this,Oc).clear()}},{key:"getPool",value:function(){return Ja()(this,Oc)}},{key:"hasBytesPerRowAsKey",value:function(e){return Ja()(this,Oc).has(e)}},{key:"getResourceType",value:function(){return Ja()(this,kc)}},{key:"getPoolThreshold",value:function(){return Ja()(this,Mc)}},{key:"canLendBufferCrossLevel",value:function(e,t){var r=!0;if(Ja()(this,Oc).has(t)){var i=Ja()(this,Oc).get(t);if(i){var a,n=0,o=0,s=Cc(i);try{for(s.s();!(a=s.n()).done;){"mapped"==a.value.mapState?n+=1:o+=1}}catch(e){s.e(e)}finally{s.f()}if(e>=Si.m[Si.h])r=n>0;else r=n>0&&0==o||n>=2&&0!=o}}else r=!1;return r}}]),e}();function Lc(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Wc(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Wc(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function Wc(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function Bc(e,t){Fc(e,t),t.add(e)}function Gc(e,t,r){Fc(e,t),t.set(e,r)}function Fc(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Hc(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}var jc=new WeakMap,Kc=new WeakMap,qc=new WeakMap,Xc=new WeakMap,Yc=new WeakMap,zc=new WeakMap,Qc=new WeakSet,Jc=new WeakSet,Zc=new WeakSet,$c=new WeakSet,el=new WeakSet,tl=new WeakSet,rl=new WeakSet;function il(e){if(e){var t=e.colorFormat;if("rgba"==t){var r=Hc(this,Jc,al).call(this,e.height);r>0&&r<Si.m[Si.h]&&(e.size=e.width*r,e.height=r),e.level=r,e.bytesPerRow=e.width}else if("i420"==t){var i=Hc(this,Jc,al).call(this,e.yPlane.height);i>0&&i<Si.m[Si.h]&&(e.size=e.yPlane.width*i+e.uvPlane.width*i,e.yPlane.height=i,e.uvPlane.height=i/2),e.level=i,e.bytesPerRow=e.yPlane.width}else if("nv12"==t){var a=Hc(this,Jc,al).call(this,e.yPlane.height);a>0&&a<Si.m[Si.h]&&(e.size=e.yPlane.width*a+e.uvPlane.width*a/2,e.yPlane.height=a,e.uvPlane.height=a/2),e.level=a,e.bytesPerRow=e.yPlane.width}}}function al(e){if(e<=0)return 0;for(var t=Si.m[Si.h],r=0;r<Si.m.length;++r)if(e<=Si.m[r]){t=Si.m[r];break}return t}function nl(e){var t=Si.m.indexOf(e);return t>-1&&t+1<=Si.m.length-1?Si.m[t+1]:e}function ol(e){if(!e)return 0;var t=0,r=e.colorFormat;if("rgba"==r?t=e.height:"i420"!=r&&"nv12"!=r||(t=e.yPlane.height),0==t)return 0;return t<=Si.m[2]?90:t>Si.m[2]&&t<=Si.m[5]?60:15}function sl(e){return e.mapAsync(GPUMapMode.WRITE,0,e.size)}function ul(e,t){var r=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(Ja()(this,Yc).set(e,t),i){var a=Array.from(Ja()(this,Yc).entries());a.sort((function(e,t){return e[0]-t[0]})),Ja()(this,Yc).clear(),a.forEach((function(e){var t=O()(e,2),i=t[0],a=t[1];Ja()(r,Yc).set(i,a)}))}}function dl(e){if(!e)return null;var t=e.level,r=e.bytesPerRow,i=(e.size,Hc(this,Zc,nl).call(this,t));if(i<=t)return null;if(!Ja()(this,Yc).has(i))return null;var a=Ja()(this,Yc).get(i);if(!a)return null;if(!a.hasBytesPerRowAsKey(r))return null;if(!a.canLendBufferCrossLevel(t,r))return null;var n={};Object.assign(n,e),n.level=i;var o=a.acquire(n,!0);return o&&(e.level=i,e.bytesPerRow=n.bytesPerRow),o}var cl=function(){function e(t){l()(this,e),Bc(this,rl),Bc(this,tl),Bc(this,el),Bc(this,$c),Bc(this,Zc),Bc(this,Jc),Bc(this,Qc),Gc(this,jc,{writable:!0,value:Si.f.TEXTURE_BUFFER}),Gc(this,Kc,{writable:!0,value:{}}),Gc(this,qc,{writable:!0,value:null}),Gc(this,Xc,{writable:!0,value:[]}),Gc(this,Yc,{writable:!0,value:new Map}),Gc(this,zc,{writable:!0,value:0}),$a()(this,qc,t)}return f()(e,[{key:"acquire",value:function(e){if(!e)throw new Error("acquire() bufferConfig is invalid!");Hc(this,Qc,il).call(this,e);var t=null,r=null;if(0==Ja()(this,Yc).size){if(Ja()(this,qc)){var i=Ja()(this,qc).createBuffer({label:e.label,size:e.size,usage:e.usage,mappedAtCreation:!0}),a=!1;if(!r){var n=Hc(this,$c,ol).call(this,e);r=new Uc(e.level,n),a=!0}i&&($a()(this,zc,Ja()(this,zc)+1),(t=i).label="".concat(e.label,"-").concat(Ja()(this,zc))),Hc(this,tl,ul).call(this,e.level,r,a)}}else if(Ja()(this,Yc).has(e.level)){var o=!1;if(!(r=Ja()(this,Yc).get(e.level))){var s=Hc(this,$c,ol).call(this,e);r=new Uc(e.level,s),o=!0}if(t=r.acquire(e))t.label="".concat(e.label,"-").concat(Ja()(this,zc));else if(!(t=Hc(this,rl,dl).call(this,e)))if(r.isUpToThreshold(e.level,e.bytesPerRow))console.log("[GPUBufferPool]acquire() next level cant help and pool is up to threshold! Only to wait for a while...");else{var u=Ja()(this,qc).createBuffer({label:e.label,size:e.size,usage:e.usage,mappedAtCreation:!0});u&&($a()(this,zc,Ja()(this,zc)+1),(t=u).label="".concat(e.label,"-").concat(Ja()(this,zc)))}o&&Hc(this,tl,ul).call(this,e.level,r,o)}else{var d=!1;if(t=Hc(this,rl,dl).call(this,e))t.label="".concat(e.label,"-").concat(Ja()(this,zc));else{var c=Ja()(this,qc).createBuffer({label:e.label,size:e.size,usage:e.usage,mappedAtCreation:!0});if(!r){var l=Hc(this,$c,ol).call(this,e);r=new Uc(e.level,l),d=!0}c&&($a()(this,zc,Ja()(this,zc)+1),(t=c).label="".concat(e.label,"-").concat(Ja()(this,zc)))}d&&Hc(this,tl,ul).call(this,e.level,r,d)}return t&&Ja()(this,Xc).push(t),t}},{key:"recycle",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e){var i=Ja()(this,Xc).indexOf(e);if(-1!=i?Ja()(this,Xc).splice(i,1):(console.error("[BufferPool] buffer can't be recycled. bufferConfig:".concat(JSON.stringify(t),", needToRecycle=").concat(r)),Object(bi.d)("[BufferPool] buffer can't be recycled. bufferConfig:".concat(JSON.stringify(t),", needToRecycle=").concat(r))),t)if(r){"unmapped"!=e.mapState&&e.unmap(),"unmapped"==e.mapState&&Hc(this,el,sl).call(this,e).then((function(){})).catch((function(t){console.warn("mapAsyncBuffer() error:".concat(t)),e.destroy(),e=null}));var a=Ja()(this,Yc).get(t.level);a&&a.recycle(t.level,t.bytesPerRow,e),e.label=""}else e.destroy(),e=null;else e.destroy()}}},{key:"recycleInUsedGPUBuffers",value:function(e,t){var r,i=Lc(e);try{for(i.s();!(r=i.n()).done;){var a,n=O()(r.value,2),o=(n[0],Lc(n[1]));try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s){var u=s.getTextureBufferGroup();u&&u.buffer&&(u.bufferArray&&(u.bufferArray=null),this.recycle(u.buffer,u.bufferConfig)),s.destroyTextureBufferGroup(t)}}}catch(e){o.e(e)}finally{o.f()}}}catch(e){i.e(e)}finally{i.f()}}},{key:"recycleTextureBufferGroup",value:function(e,t){if(e&&t){var r=t.acquireGPUBufferPool();if(r){var i=e.getTextureBufferGroup();i&&i.buffer&&(i.bufferArray&&(i.bufferArray=null),r.recycle(i.buffer,i.bufferConfig),e.destroyTextureBufferGroup(t))}}}},{key:"cleanup",value:function(){var e,t=Lc(Ja()(this,Xc));try{for(t.s();!(e=t.n()).done;){var r=e.value;"unmapped"!=r.mapState&&r.unmap(),r.destroy()}}catch(e){t.e(e)}finally{t.f()}Ja()(this,Xc).length=0;var i,a=Lc(Ja()(this,Yc));try{for(a.s();!(i=a.n()).done;){var n=O()(i.value,2),o=(n[0],n[1]);o&&o.cleanup()}}catch(e){a.e(e)}finally{a.f()}Ja()(this,Yc).clear()}},{key:"release",value:function(e){if(e==Si.n.OVERUSE){var t,r=Lc(Ja()(this,Yc));try{for(r.s();!(t=r.n()).done;){var i=O()(t.value,2),a=(i[0],i[1]);a&&a.release(e)}}catch(e){r.e(e)}finally{r.f()}Ja()(this,Yc).clear()}}},{key:"getResourceType",value:function(){return Ja()(this,jc)}},{key:"collectResourceInfo",value:function(){var e,t=0,r=0,i="",a=Lc(Ja()(this,Yc));try{for(a.s();!(e=a.n()).done;){var n=O()(e.value,2),o=n[0],s=n[1];if(s){var u,d=Lc(s.getPool());try{for(d.s();!(u=d.n()).done;){var c=O()(u.value,2),l=c[0],h=c[1];t+=h.length;var f,p=0,v=0,m=Lc(h);try{for(m.s();!(f=m.n()).done;){var g=f.value;r+=g.size,"mapped"==g.mapState?p+=1:v+=1}}catch(e){m.e(e)}finally{m.f()}i+="[GPUBufferPool] level:".concat(o," bpr:").concat(l," threshold:").concat(s.getPoolThreshold()," pool:{len:").concat(h.length," ava_count:").concat(p," pending_count:").concat(v,"}\n")}}catch(e){d.e(e)}finally{d.f()}}}}catch(e){a.e(e)}finally{a.f()}var _,S=0,E=Lc(Ja()(this,Xc));try{for(E.s();!(_=E.n()).done;){var b=_.value;t+=1,r+=b.size,S+=1}}catch(e){E.e(e)}finally{E.f()}return i+="[GPUBufferPool] in_used_count:".concat(S,"\n"),i+="[GPUBufferPool] total: count:".concat(t," usedBytes:").concat(r,"\n"),Ja()(this,Kc).type=Ja()(this,jc),Ja()(this,Kc).count=t,Ja()(this,Kc).usedBytes=r,Ja()(this,Kc).output=i,Ja()(this,Kc)}},{key:"onOccupancyLevelEvaluated",value:function(e){Object(bi.d)("[GPUBufferPool] onOccupancyLevelEvaluated() level:".concat(e)),console.log("[GPUBufferPool] onOccupancyLevelEvaluated() level:".concat(e)),this.release(e)}},{key:"getInUsedPoolCount",value:function(){return Ja()(this,Xc).length}}]),e}();function ll(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}var hl=new WeakMap,fl=new WeakMap,pl=function(){function e(t){l()(this,e),ll(this,hl,{writable:!0,value:null}),ll(this,fl,{writable:!0,value:null}),$a()(this,hl,t),t&&$a()(this,fl,t.features)}return f()(e,[{key:"getAdapterFeatures",value:function(){return Ja()(this,fl)}},{key:"getAdapterLimits",value:function(){return Ja()(this,hl)?Ja()(this,hl).limits:null}},{key:"queryMaxTextureDimension2D",value:function(){var e=this.getAdapterLimits();return e?e.maxTextureDimension2D:0}},{key:"queryMaxBufferSize",value:function(){var e=this.getAdapterLimits();return e?e.maxBufferSize:0}},{key:"queryAdapterFeature",value:function(e){return!(!Ja()(this,fl)||!e)&&Ja()(this,fl).has(e)}},{key:"isTimestampQuerySupported",value:function(){return this.queryAdapterFeature("timestamp-query")}},{key:"getGPUAdapter",value:function(){return Ja()(this,hl)}},{key:"cleanup",value:function(){$a()(this,hl,null),$a()(this,fl,null)}}]),e}();function vl(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return ml(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ml(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function ml(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function gl(e,t){Sl(e,t),t.add(e)}function _l(e,t,r){Sl(e,t),t.set(e,r)}function Sl(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function El(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}var bl=new WeakMap,yl=new WeakMap,Cl=new WeakMap,Al=new WeakMap,Rl=new WeakSet,Il=new WeakSet,wl=new WeakSet;function Tl(){var e=Si.n.LOW,t="---WatchDog(".concat(Ja()(this,Al),") starts analyzing---\n");console.log("".concat(t));var r,i=vl(Ja()(this,yl));try{for(i.s();!(r=i.n()).done;){var a=r.value,n=a.collectResourceInfo();console.log("".concat(n.output)),Object(bi.d)("[WatchDog#onObserved()] resInfo:".concat(n.output));var o=El(this,Il,kl).call(this,n);a.onOccupancyLevelEvaluated(o),o>e&&(e=o)}}catch(e){i.e(e)}finally{i.f()}var s=El(this,wl,Dl).call(this,e);s!=Ja()(this,bl)&&(clearInterval(Ja()(this,Cl)),$a()(this,Cl,null),$a()(this,bl,s),this.monitor())}function kl(e){var t=Si.n.LOW;return e.type==Si.f.TEXTURE?t=e.usedBytes<=31457280?Si.n.LOW:e.usedBytes<=94371840?Si.n.MEDIUM:e.usedBytes<=157286400?Si.n.HIGH:Si.n.OVERUSE:e.type==Si.f.VERTEX_BUFFER?t=e.usedBytes<=5242880?Si.n.LOW:e.usedBytes<=10485760?Si.n.MEDIUM:e.usedBytes<=15728640?Si.n.HIGH:Si.n.OVERUSE:e.type==Si.f.TEXTURE_BUFFER&&(t=e.usedBytes<=52428800?Si.n.LOW:e.usedBytes<=104857600?Si.n.MEDIUM:e.usedBytes<=209715200?Si.n.HIGH:Si.n.OVERUSE),t}function Dl(e){var t=0;switch(e){case Si.n.LOW:t=Si.o.LOW;break;case Si.n.MEDIUM:t=Si.o.MEDIUM;break;case Si.n.HIGH:t=Si.o.HIGH;break;case Si.n.OVERUSE:t=Si.o.OVERUSE;break;default:t=Si.o.MEDIUM}return t}var Ol=function(){function e(t){l()(this,e),gl(this,wl),gl(this,Il),gl(this,Rl),_l(this,bl,{writable:!0,value:Si.o.HIGH}),_l(this,yl,{writable:!0,value:[]}),_l(this,Cl,{writable:!0,value:null}),_l(this,Al,{writable:!0,value:""}),$a()(this,Al,t)}return f()(e,[{key:"addObservable",value:function(e){Ja()(this,yl).push(e)}},{key:"removeObservable",value:function(e){var t=Ja()(this,yl).indexOf(e);-1!=t&&Ja()(this,yl).splice(t,1)}},{key:"removeAllObservables",value:function(){Ja()(this,yl).length=0}},{key:"monitor",value:function(){var e=this;Ja()(this,Cl)||$a()(this,Cl,setInterval((function(){El(e,Rl,Tl).call(e)}),Ja()(this,bl)))}},{key:"cleanup",value:function(){this.removeAllObservables(),clearInterval(Ja()(this,Cl)),$a()(this,Cl,null),$a()(this,bl,0)}}]),e}();function Ml(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return xl(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xl(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function xl(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function Pl(e,t,r){Nl(e,t),t.set(e,r)}function Nl(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Vl(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}var Ul=new WeakMap,Ll=new WeakMap,Wl=new WeakMap,Bl=new WeakMap,Gl=new WeakMap,Fl=new WeakMap,Hl=new WeakMap,jl=new WeakMap,Kl=new WeakMap,ql=new WeakMap,Xl=new WeakMap,Yl=new WeakSet;function zl(e){return void 0!==e&&"yPlaneTex"in e}var Ql=function(){function e(){var t,r;l()(this,e),Nl(t=this,r=Yl),r.add(t),Pl(this,Ul,{writable:!0,value:null}),Pl(this,Ll,{writable:!0,value:null}),Pl(this,Wl,{writable:!0,value:null}),Pl(this,Bl,{writable:!0,value:null}),Pl(this,Gl,{writable:!0,value:null}),Pl(this,Fl,{writable:!0,value:null}),Pl(this,Hl,{writable:!0,value:null}),Pl(this,jl,{writable:!0,value:null}),Pl(this,Kl,{writable:!0,value:null}),Pl(this,ql,{writable:!0,value:null}),Pl(this,Xl,{writable:!0,value:""})}var t;return f()(e,[{key:"addRendererProviderModule",value:function(e){$a()(this,ql,e)}},{key:"setLabel",value:function(e){$a()(this,Xl,e)}},{key:"initialize",value:(t=d()(g.a.mark((function e(){var t=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.gpu){e.next=3;break}return console.error("[WebGPUResManager] initialize() WebGPU is not supported!"),e.abrupt("return");case 3:if(Ja()(this,Ul)){e.next=15;break}return e.t0=$a.a,e.t1=this,e.t2=Ul,e.next=9,navigator.gpu.requestAdapter();case 9:if(e.t3=e.sent,(0,e.t0)(e.t1,e.t2,e.t3),Ja()(this,Ul)){e.next=15;break}return console.error("[WebGPUResManager] initialize() Couldn't request WebGPU adapter."),Object(bi.f)("WebGPU device was lost: ".concat(info.message," reason=").concat(info.reason)),e.abrupt("return");case 15:if(Ja()(this,Wl)){e.next=24;break}return e.t4=$a.a,e.t5=this,e.t6=Wl,e.next=21,Ja()(this,Ul).requestDevice();case 21:e.t7=e.sent,(0,e.t4)(e.t5,e.t6,e.t7),Ja()(this,Wl).lost.then(function(){var e=d()(g.a.mark((function e(r){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("destroyed"!=r.reason&&(console.error("WebGPU device was lost: ".concat(r.message," reason=").concat(r.reason)),Object(bi.f)("WebGPU device was lost: ".concat(r.message," reason=").concat(r.reason))),Ja()(t,ql)&&Ja()(t,ql).rendererUnconfigureGPUContext(),t.cleanup(),"destroyed"==r.reason){e.next=8;break}return $a()(t,Wl,null),e.next=7,t.initialize();case 7:Ja()(t,ql)&&Ja()(t,ql).rendererReinitialize();case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 24:if(Ja()(this,Ll)){e.next=32;break}return e.t8=$a.a,e.t9=this,e.t10=Ll,e.next=30,Ja()(this,Ul).requestAdapterInfo();case 30:e.t11=e.sent,(0,e.t8)(e.t9,e.t10,e.t11);case 32:Ja()(this,Bl)||$a()(this,Bl,navigator.gpu.getPreferredCanvasFormat()),Ja()(this,Gl)||$a()(this,Gl,new Yd(Ja()(this,Wl))),Ja()(this,Fl)||$a()(this,Fl,new yc(Ja()(this,Wl))),Ja()(this,Hl)||$a()(this,Hl,new cl(Ja()(this,Wl))),Ja()(this,jl)||$a()(this,jl,new pl(Ja()(this,Ul))),Ja()(this,Kl)||($a()(this,Kl,new Ol(Ja()(this,Xl))),Ja()(this,Kl).addObservable(Ja()(this,Gl)),Ja()(this,Kl).addObservable(Ja()(this,Fl)),Ja()(this,Kl).addObservable(Ja()(this,Hl)),Ja()(this,Kl).monitor());case 38:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"acquireGPUDevice",value:function(){return Ja()(this,Wl)}},{key:"acquireCanvasFormat",value:function(){return Ja()(this,Bl)}},{key:"acquireGPUAdapterInfo",value:function(){return Ja()(this,Ll)}},{key:"destroyGPUDevice",value:function(){Ja()(this,Wl)&&(Ja()(this,Wl).destroy(),$a()(this,Wl,null))}},{key:"acquireGPUBufferMgr",value:function(){return Ja()(this,Gl)}},{key:"acquireGPUTextureMgr",value:function(){return Ja()(this,Fl)}},{key:"acquireGPUBufferPool",value:function(){return Ja()(this,Hl)}},{key:"acquireGPUFeaturesHelper",value:function(){return Ja()(this,jl)}},{key:"cleanup",value:function(){Ja()(this,Gl)&&(Ja()(this,Gl).cleanup(),$a()(this,Gl,null)),Ja()(this,Fl)&&(Ja()(this,Fl).cleanup(),$a()(this,Fl,null)),Ja()(this,Hl)&&(Ja()(this,Hl).cleanup(),$a()(this,Hl,null)),Ja()(this,jl)&&(Ja()(this,jl).cleanup(),$a()(this,jl,null)),Ja()(this,Kl)&&(Ja()(this,Kl).cleanup(),$a()(this,Kl,null)),$a()(this,ql,null),this.destroyGPUDevice()}},{key:"recycleTextureBufferGroup",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e&&Ja()(this,Hl)){var r=e.getTextureBufferGroup();r&&r.buffer&&(r.bufferArray&&(r.bufferArray=null),Ja()(this,Hl).recycle(r.buffer,r.bufferConfig,t),e.destroyTextureBufferGroup(this))}}},{key:"recycleInUsedGPUBuffers",value:function(e){var t,r=Ml(e);try{for(r.s();!(t=r.n()).done;){var i,a=O()(t.value,2),n=(a[0],Ml(a[1]));try{for(n.s();!(i=n.n()).done;){var o=i.value;if(o){var s=o.getTextureBufferGroup();s&&s.buffer&&(s.bufferArray&&(s.bufferArray=null),Ja()(this,Hl).recycle(s.buffer,s.bufferConfig)),o.destroyTextureBufferGroup(this)}}}catch(e){n.e(e)}finally{n.f()}}}catch(e){r.e(e)}finally{r.f()}}},{key:"requestTextureBuffer",value:function(e){if(!Ja()(this,Hl))return null;if(function(e,t){if(!e||t<0)throw new Error("isBufferSizeOverMaxSize() invalid parameters. res=".concat(e,", bufferSize=").concat(t));var r=!1,i=0,a=e.acquireGPUFeaturesHelper();return a&&(i=a.queryMaxBufferSize())>0&&(r=t>i),r&&(console.log("isBufferSizeOverMaxSize() bufferSize:".concat(t," max:").concat(i)),Object(bi.d)("isBufferSizeOverMaxSize() bufferSize:".concat(t," max:").concat(i))),r}(this,e.size))return Object(bi.f)("requestTextureBuffer() a buffer size that exceeds the max size of GPUBuffer is required.(size:".concat(e.size,")")),null;var t=GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC;return e.usage=t,Ja()(this,Hl).acquire(e)}},{key:"destroyTextureGroup",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){var r=e.getTextureGroup();if(r)if(Ja()(this,Fl)){var i=e.getTextureType();r&&(i==Si.x.GPU_TEX_YUV?(Ja()(this,Fl).recycleTexture(r.yPlaneTex,t),Ja()(this,Fl).recycleTexture(r.uPlaneTex,t),r.vPlaneTex&&Ja()(this,Fl).recycleTexture(r.vPlaneTex,t)):i==Si.x.GPU_TEX_RGBA?Ja()(this,Fl).recycleTexture(r,t):Vl(this,Yl,zl).call(this,r)?(Ja()(this,Fl).recycleTexture(r.yPlaneTex,t),Ja()(this,Fl).recycleTexture(r.uPlaneTex,t),r.vPlaneTex&&Ja()(this,Fl).recycleTexture(r.vPlaneTex,t)):Ja()(this,Fl).recycleTexture(r,t),e.setTextureGroup(null))}else Object(bi.f)("destroyTextureGroup() mGPUTextureMgr is undefined!")}}}]),e}();function Jl(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}var Zl=new WeakMap,$l=new WeakMap,eh=new WeakMap,th=new WeakMap,rh=new WeakMap,ih=function(){function e(t){l()(this,e),Jl(this,Zl,{writable:!0,value:""}),Jl(this,$l,{writable:!0,value:new Ho}),Jl(this,eh,{writable:!0,value:new Ud}),Jl(this,th,{writable:!0,value:new Qo}),Jl(this,rh,{writable:!0,value:new Ql}),$a()(this,Zl,t),Ja()(this,rh).addRendererProviderModule(Ja()(this,$l)),Ja()(this,rh).setLabel(Ja()(this,Zl)),Ja()(this,eh).setGPUResourceMgr(Ja()(this,rh))}var t;return f()(e,[{key:"evalRendererType",value:(t=d()(g.a.mark((function e(t){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ja()(this,$l).evaluate(t);case 2:r=e.sent,console.log("[RenderManager] rendererType is ".concat(r));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getVideoRenderDisplay",value:function(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=Ja()(this,$l).getRendererType(),o=Ja()(this,$l).acquireRenderer(e,Ja()(this,rh));return Ja()(this,eh).getVideoRenderDisplay(n,e,t,r,i,o,a)}},{key:"createWebGLVideoRenderDisplay",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Ja()(this,$l).isWebGL2RendererType()?Ja()(this,eh).getWebGL2RenderDisplayMgr().createVideoRenderDisplay(e,t,r,null,i):Ja()(this,$l).isWebGLRendererType()?Ja()(this,eh).getWebGLRenderDisplayMgr().createVideoRenderDisplay(e,t,r,null,i):null}},{key:"createVideoRenderDisplay",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=Ja()(this,$l).getRendererType(),n=Ja()(this,$l).acquireRenderer(e,Ja()(this,rh));return Ja()(this,eh).createVideoRenderDisplay(a,e,t,r,n,i)}},{key:"getSharingRenderDisplay",value:function(e,t,r){var i=Ja()(this,$l).getRendererType(),a=Ja()(this,$l).acquireRenderer(e,Ja()(this,rh),!0);return r||(r={}),r.clearCache=!0,Ja()(this,eh).getSharingRenderDisplay(i,e,t,a,r)}},{key:"recycleRenderDisplay",value:function(e,t,r){var i=Ja()(this,$l).getRendererType();Ja()(this,eh).recycleRenderDisplay(i,e,t,Ja()(this,rh),r)}},{key:"renderFor",value:function(e){var t=this;if(Ja()(this,$l).isWebGPURendererType()){var r=Ja()(this,$l).getRendererType(),i=Ja()(this,eh).collectInUseRenderDisplays(r,e);i&&i.forEach((function(e){var r=Ja()(t,$l).acquireRenderer(e.canvas,Ja()(t,rh));Ja()(t,th).render(r,e.renderDisplays)}))}}},{key:"renderWith",value:function(e){if(Ja()(this,$l).isWebGPURendererType()){var t=e.getAttachedCanvas();if(t){var r=Ja()(this,$l).acquireRenderer(t,Ja()(this,rh)),i=[];i.push(e),Ja()(this,th).render(r,i)}}}},{key:"getRenderDisplayMap",value:function(e){var t=Ja()(this,$l).getRendererType();return Ja()(this,eh).getRenderDisplayMap(t,e)}},{key:"onRestoredFromContextLost",value:function(e,t,r,i,a){var n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return Ja()(this,$l).isWebGLRendererType()||Ja()(this,$l).isWebGL2RendererType()?Ja()(this,eh).onRestoredFromContextLost(e,t,r,i,a,n):null}},{key:"destroyUnusedVideoFrame",value:function(e){"undefined"!=typeof VideoFrame&&e instanceof VideoFrame&&Ja()(this,$l).isWebGPURendererType()&&e.close()}},{key:"getRendererProvider",value:function(){return Ja()(this,$l)}},{key:"getRenderDisplayManager",value:function(){return Ja()(this,eh)}},{key:"getWebGPUResMgr",value:function(){return Ja()(this,rh)}},{key:"cleanup",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Ja()(this,$l)&&Ja()(this,$l).cleanup(),Ja()(this,eh)&&Ja()(this,eh).cleanup(e,t,Ja()(this,rh),r),Ja()(this,rh)&&Ja()(this,rh).cleanup()}},{key:"clearOffscreenCanvas",value:function(e){Ja()(this,eh)&&Ja()(this,eh).cleanupByCanvas(e,Ja()(this,rh))}}]),e}();function ah(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return nh(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return nh(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function nh(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var oh,sh={isOnWebCodecWhitelist:function(e,t,r,i){if(""===e||void 0===e||void 0===t||""===t)return!1;if(!i){var a=e.includes("arm"),n=t.includes("intel"),o=t.includes("amd"),s=t.includes("nvidia");return"encoder"===r?!a&&!!(n||o||s):"decoder"===r&&(!a&&(!!o||(n?!this.isInRangeOfGenerations("intel",t,1e3,4e3):!s||!this.isLowerThanMinGeneration("nvidia",t,"600"))))}t=this.replaceSpacesWithUnderscores(t);for(var u=0;u<i.length;u++){var d=i[u],c="vendor"in d,l="model"in d,h="renderInfo"in d,f="blacklist"in d,p="";c&&""!==d.vendor&&(p=d.vendor.toLowerCase());var v="";l&&""!==d.model&&(v=this.replaceSpacesWithUnderscores(d.model.toLowerCase()));var m="";h&&""!==d.renderInfo&&(m=this.replaceSpacesWithUnderscores(d.renderInfo.toLowerCase()));var g=null;if(f&&d.blacklist.length>0&&(g=d.blacklist),c){if(""!==p&&e.includes(p))return""===v&&""===m&&!g||(!!(t===m||""!==m&&t.includes(m))||(""!==v&&t.includes(v)||""===v)&&(!g||!this.isHitBlacklist(e,t,r,v,g)));Y.default.log("isOnWebCodecWhitelist() vendor is not in the whitelist. vendor:".concat(vendor))}else Y.default.error("isOnWebCodecWhitelist() no vendor field in the json entry! entry:".concat(d))}return!1},isGPUProfileOnWebCodecWhitelist:function(e,t){if(!this.isOffscreenCanvasSupported())return Y.default.log("isGPUProfileOnWebCodecWhitelist() OffscreenCanvas is not supported."),!1;try{var r=this.getGPUInfo(),i=r.vendor,a=r.renderer.toLowerCase();return this.isOnWebCodecWhitelist(i,a,e,t)}catch(e){return!1}},isLowerThanMinGeneration:function(e,t,r){try{var i=e.toLowerCase(),a=t.toLowerCase(),n=parseInt(r);if("nvidia"===i){if(a.includes("geforce")){var o=a.indexOf("geforce gt ");if(parseInt(a.slice(o+11))<n)return!0}}else if("intel"===i&&a.includes("hd graphics")){var s=a.indexOf("hd graphics ");if(parseInt(a.slice(s+12))<n)return!0}return!1}catch(e){return Y.default.error(e),!1}},isInRangeOfGenerations:function(e,t,r,i){try{var a=e.toLowerCase(),n=t.toLowerCase();if("intel"===a&&n.includes("hd graphics")){var o=n.indexOf("hd graphics "),s=parseInt(n.slice(o+12));if(s>r&&s<i)return!0}return!1}catch(e){return Y.default.error(e),!1}},getGPUInfo:function(){var e=null;if(this.isOffscreenCanvasSupported()&&(e=new OffscreenCanvas(1,1)),!e)return{renderer:"",vendor:""};try{var t=e.getContext("webgl");if(t){var r=t.getExtension("WEBGL_debug_renderer_info"),i=t.getParameter(r.UNMASKED_RENDERER_WEBGL),a=t.getParameter(r.UNMASKED_VENDOR_WEBGL);return{renderer:i.toLowerCase(),vendor:a.toLowerCase()}}}catch(e){return Y.default.error(e),null}finally{e&&(e=null)}},isOffscreenCanvasSupported:function(){return"function"==typeof OffscreenCanvas},isHitBlacklist:function(e,t,r,i,a){if(!t||""===t)return Y.default.error("isHitBlacklist() targetRenderInfo is invalid"),!0;if(!a)return Y.default.error("isHitBlacklist() an invalid blacklist configuration object"),!1;if("encoder"!==r&&"decoder"!==r&&"all"!==r)return Y.default.error("isHitBlacklist() an invalid codecType(".concat(r,").")),!0;var n,o=i.toLowerCase(),s=!1,u=ah(a);try{for(u.s();!(n=u.n()).done;){var d=n.value,c="model"in d,l="codecType"in d,h="renderInfo"in d,f="minGeneration"in d,p="os"in d,v=null;c&&""!==d.model&&(v=this.replaceSpacesWithUnderscores(d.model.toLowerCase()));var m=null;if(l)if("all"===(m=d.codecType)||"encoder"===m||"decoder"===m){var g=null;h&&""!==d.renderInfo&&(g=this.replaceSpacesWithUnderscores(d.renderInfo.toLowerCase()));var _=null;f&&(_=d.minGeneration);var S=null;if(p&&""!==d.os&&(S=d.os.toLowerCase()),!c&&!h){if(!p){Y.default.warn("isHitBlacklist() invalid blacklist entry. entry:".concat(d));continue}if(this.isOnOSBlacklist(S)){s=!0;break}}if(h&&""!==g&&(t===g||t.includes(g))&&("all"===m||m===r)){if(!p){s=!0;break}if(this.isOnOSBlacklist(S)){s=!0;break}}if(v)if(""!==o){if(v!==o){Y.default.warn("isHitBlacklist() model(".concat(v,") in blacklist entry and model(").concat(o,") in whitelist should be same!"));continue}if("all"===m||m===r)if(_&&""!==_){if(this.isLowerThanMinGeneration(e,t,_)){if(!p){s=!0;break}if(this.isOnOSBlacklist(S)){s=!0;break}}}else{if(!p){s=!0;break}if(this.isOnOSBlacklist(S)){s=!0;break}}}else if(t.includes(v)&&("all"===m||m===r))if(_&&""!==_){if(this.isLowerThanMinGeneration(e,t,_)){if(!p){s=!0;break}if(this.isOnOSBlacklist(S)){s=!0;break}}}else{if(!p){s=!0;break}if(this.isOnOSBlacklist(S)){s=!0;break}}}else Y.default.error("isHitBlacklist() codecType(".concat(m,") should be all/(empty)/encoder/decoder."));else Y.default.warn("isHitBlacklist() miss codecType field in the configuration.")}}catch(e){u.e(e)}finally{u.f()}return s},isOnOSBlacklist:function(e){var t=e.toLowerCase();return!("windows"!==t||!this.isWindows())||(!("mac"!==t||!this.isMac())||(!("chromeos"!==t||!this.isChromeOS())||(!("android"!==t||!this.isAndroid())||(!("linux"!==t||!this.isLinux())||!("ios"!==t||!this.is_iOS())))))},isWindows:function(){return navigator.platform.indexOf("Win")>-1},isMac:function(){return navigator.platform.indexOf("Mac")>-1},isChromeOS:function(){try{return!!/\bCrOS\b/.test(navigator.userAgent)}catch(e){return!1}},isAndroid:function(){try{var e=navigator.userAgent||navigator.vendor||window.opera;return!!/android/i.test(e)}catch(e){return!1}},isLinux:function(){return navigator.platform.indexOf("Linux")>-1&&!this.isChromeOS()},is_iOS:function(){try{return!!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)}catch(e){return!1}},replaceSpacesWithUnderscores:function(e){if(!e||""===e)return"";var t=e.trim();return""===t?"":"_".concat(t.replace(/ /g,"_"),"_")}};function uh(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function dh(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?uh(Object(r),!0).forEach((function(t){v()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uh(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ch=null===(oh=document.currentScript)||void 0===oh?void 0:oh.src,lh=function(){function e(){l()(this,e),this._isReuseStreamEnabled=!1,this._isStreamInReuseMap=new Map,this.presetedConstraints={audioConstraints:null,videoConstraints:null,audioTimer:null,videoTimer:null},this._deprecatedStream={audio:[],video:[]},this._captureVideoDeferred=null,this.audioConstraints=null,this.audioStream=null,this.isCaptureAudioInProgress=!1,this.audioCaptureElapsedTime=0,this.videoConstraints=null,this.videoStream=null,this.videoStreamTrack=null,this.captureVideoTimer=null,this.checkVideoStreamActiveTimer=null,this.isCaptureVideoInProgress=!1,this.currentVideoResolution={width:0,height:0},this.streamProcessAbility={isSupportMediaStreamTrackProcessor:q.default.isSupportMediaStreamTrackProcessor(),isSupportVideoTrackReader:q.default.isSupportVideoTrackReader(),isSupportImageCapture:q.default.isSupportImageCapture()},this.mediaStreamTrackProcessor=null,this.reableStream=null,this.videoTrackReader=null,this.videoImageCapture=null,this.videoImageCaptureLocked=!1,this.isAppleGraphic=!1,this.isSupportFullHD=!1,this.facingMode=x.m,this.VBMFlag=!1,this.audioBridge=null}var t,r,i,a;return f()(e,[{key:"enableReuseStream",value:function(e){this._isReuseStreamEnabled=!!e}},{key:"_updateStreamInReuse",value:function(e,t){t?this._isStreamInReuseMap.set(e,!0):this._isStreamInReuseMap.delete(e)}},{key:"_isStreamInReuse",value:function(e){return!!this._isStreamInReuseMap.get(e)}},{key:"presetConstraints",value:function(e){var t=e.audioConstraints,r=e.videoConstraints;t&&(this.presetedConstraints.audioConstraints=this._getAudioConstraints(t)),r&&(this.presetedConstraints.videoConstraints=this._getVideoConstraints(r))}},{key:"_clearPresetConstraints",value:function(){this.presetedConstraints.audioConstraints=null,this.presetedConstraints.videoConstraints=null}},{key:"_getPresetAudioConstraints",value:function(){var e=this.presetedConstraints.audioConstraints;return this._clearPresetConstraints(),!(!e||this.audioStream||this.isCaptureAudioInProgress)&&e}},{key:"_getPresetVideoConstraints",value:function(){var e=this.presetedConstraints.videoConstraints;return this._clearPresetConstraints(),!(!e||this.videoStream||this.isCaptureVideoInProgress)&&e}},{key:"_pushDeprecatedStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.audioStream,r=e.videoStream;t&&this._deprecatedStream.audio.push(t),r&&this._deprecatedStream.video.push(r)}},{key:"_destoryDeprecatedStream",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.audio,i=t.video;r&&(this._deprecatedStream.audio.forEach((function(t){try{e._destoryStream(t)}catch(e){Y.default.error("Error when destroying deprecated audio stream",e)}})),this._deprecatedStream.audio=[]),i&&(this._deprecatedStream.video.forEach((function(t){try{e._destoryStream(t)}catch(e){Y.default.error("Error when destroying deprecated video stream",e)}})),this._deprecatedStream.video=[])}},{key:"setStreamProcessAbility",value:function(e){var t=e.isSupportMediaStreamTrackProcessor,r=e.isSupportVideoTrackReader,i=e.isSupportImageCapture;this.streamProcessAbility=dh(dh(dh(dh({},this.streamProcessAbility),void 0!==t?{isSupportMediaStreamTrackProcessor:t}:{}),void 0!==r?{isSupportVideoTrackReader:r}:{}),void 0!==i?{isSupportImageCapture:i}:{})}},{key:"_isFileInputAudioSource",value:function(e){return e&&(e.audio instanceof HTMLVideoElement||e.audio instanceof HTMLAudioElement)}},{key:"_getAudioConstraints",value:function(e){var t=e.audioSource,r=e.isSupportBrowserAec,i=e.disableAudioAGC,a=e.disableNoiseSuppression,n=e.enableOriginalSound,o=e.enableStereo;if(t instanceof HTMLVideoElement||t instanceof HTMLAudioElement)return{audio:t};return r?{deviceId:t?{exact:t}:q.default.browser.isChrome?{exact:"default"}:void 0,autoGainControl:!i&&!n,noiseSuppression:!a&&!n,latency:0,echoCancellation:!o,channelCount:2,sampleRate:48e3}:{deviceId:t?{exact:t}:q.default.browser.isChrome?{exact:"default"}:void 0,autoGainControl:!i&&!n,noiseSuppression:!a&&!n,latency:0,echoCancellation:r&&!o,channelCount:2,sampleRate:48e3}}},{key:"_isSameAudioConstraintsAsPrev",value:function(e){return!this._isFileInputAudioSource(e)&&(!(!this.audioConstraints||!Object(q.deepEqual)(this.audioConstraints,e))&&(!!this.audioStream&&!!this._isStreamHasAudio(this.audioStream)))}},{key:"_destoryStream",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.audioOnly,i=t.videoOnly;if(e&&!q.default.audioToMediaStreamMananger.isAudioFileStream(e)){(r?e.getAudioTracks():i?e.getVideoTracks():e.getTracks()).forEach((function(e){e.stop()}))}}},{key:"_isStreamHasAudio",value:function(e){var t=e.getAudioTracks();return t&&t.length>0}},{key:"_isStreamHasVideo",value:function(e){var t=e.getVideoTracks();return t&&t.length>0}},{key:"destoryAudioMediaStream",value:function(){this.audioStream?(this._isFileInputAudioSource(this.audioConstraints)&&q.default.audioToMediaStreamMananger.stopCapture(),this._isReuseStreamEnabled?this._updateStreamInReuse(this.audioStream,!0):(this._updateStreamInReuse(this.audioStream,!1),this._destoryStream(this.audioStream),this.audioStream=null,this.audioConstraints=null,this.audioCaptureElapsedTime=0,this._destoryDeprecatedStream({audio:!0}))):this._destoryDeprecatedStream({audio:!0}),this.enableReuseStream(!1)}},{key:"shouldCaptureAudio",value:function(){return!this.audioStream||this._isStreamInReuse(this.audioStream)}},{key:"muteUnmuteAudioMediaStream",value:function(e){this.audioStream&&(this.audioStream.getAudioTracks()||[]).forEach((function(t){t.enabled=!e}))}},{key:"_storeAudioStream",value:function(e,t,r){e&&(fh("audio stream is ok"),this.destoryAudioMediaStream(),this.audioStream=e,this.audioConstraints=t,r&&this._setPresetAudioStreamAutoStopTimer())}},{key:"_setPresetAudioStreamAutoStopTimer",value:function(){var e=this;this._clearPresetAudioStreamAutoStopTimer(),this.presetedConstraints.audioTimer=setTimeout((function(){e.destoryAudioMediaStream()}),1e4)}},{key:"_clearPresetAudioStreamAutoStopTimer",value:function(){this.presetedConstraints.audioTimer&&(clearTimeout(this.presetedConstraints.audioTimer),this.presetedConstraints.audioTimer=null)}},{key:"_handleAudioCaptureSuccess",value:function(e,t,r,i){var a=this;this._clearPresetAudioStreamAutoStopTimer(),i||this._storeAudioStream(e,t),this._updateStreamInReuse(e,!1);var n=e.getAudioTracks()[0],o=!1;n?(Q.default.add_monitor("ATRS:"+n.readyState+"-"+n.id),Q.default.add_monitor("ATMS:"+n.muted+"-"+n.id),n.onended=d()(g.a.mark((function e(){var t,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:t=e.sent,r=!1,t.forEach((function(e){"audioinput"==e.kind&&e.label==n.label&&e.deviceId==n.getSettings().deviceId&&(r=!0)})),r?(Z.default.Notify_APPUI_SAFE(M.AUDIO_STREAM_FAILED),Q.default.add_monitor("ATRS:"+n.readyState+"-"+n.id+"-L")):Q.default.add_monitor("ATRS:"+n.readyState+"-"+n.id+"-I");case 6:case"end":return e.stop()}}),e)}))),n.muted?(Z.default.Notify_APPUI_SAFE(M.AUDIO_STREAM_MUTED),this.audioBridge&&(this.audioBridge.isMutedBySystem=!0)):(Z.default.Notify_APPUI_SAFE(M.AUDIO_STREAM_UNMUTED),this.audioBridge&&(this.audioBridge.isMutedBySystem=!1)),n.onmute=function(){Q.default.add_monitor("ATMS:"+n.muted+"-"+n.id);var e=a.audioStream.getAudioTracks()[0];e&&e.id===n.id&&(a.audioBridge&&(a.audioBridge.muted||(a.audioBridge.mute(),o=!0),a.audioBridge.isMutedBySystem=!0),Z.default.Notify_APPUI_SAFE(M.AUDIO_STREAM_MUTED))},n.onunmute=function(){Q.default.add_monitor("ATMS:"+n.muted+"-"+n.id);var e=a.audioStream.getAudioTracks()[0];e&&e.id===n.id&&(a.audioBridge&&(o&&(a.audioBridge.unmute(),o=!1),a.audioBridge.isMutedBySystem=!1),Z.default.Notify_APPUI_SAFE(M.AUDIO_STREAM_UNMUTED))}):Q.default.add_monitor("TN"),r(e)}},{key:"_genAudioStream",value:function(e){try{var t=e.getAudioTracks();return 0===t.length?null:new MediaStream(t)}catch(t){return Y.default.warn("_genAudioStream",t),this._destoryStream(e,{videoOnly:!0}),e}}},{key:"_genVideoStream",value:function(e){try{var t=e.getVideoTracks();return 0===t.length?null:new MediaStream(t)}catch(t){return Y.default.warn("_genVideoStream",t),this._destoryStream(e,{audioOnly:!0}),e}}},{key:"_splitAudioStream",value:function(e,t,r,i){var a=t.audio,n=t.video;if(n&&this._isStreamHasVideo(e)){var o=this._genAudioStream(e),s=this._genVideoStream(e);return o?this._handleAudioCaptureSuccess(o,a,r):i(new Error("audio stream do not contains audio track ")),void(s&&(this.videoStream?this._pushDeprecatedStream({videoStream:s}):(this._updateStreamInReuse(s,!0),this._storeVideoStream(s,n,!0))))}this._handleAudioCaptureSuccess(e,a,r)}},{key:"_captureFileInputAudioStream",value:(a=d()(g.a.mark((function e(t){var r,i,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.audio,e.prev=1,e.next=4,new Promise((function(e,t){r.currentTime>0&&!r.paused&&!r.ended&&e(!0),r.addEventListener("timeupdate",(function t(){e(!0),r.removeEventListener("timeupdate",t)})),setTimeout((function(){return t(!1)}),1e4)}));case 4:if(e.sent){e.next=7;break}throw new Error("audio file playing failed");case 7:return i=q.default.audioToMediaStreamMananger.startCapture(r),e.abrupt("return",i);case 11:throw e.prev=11,e.t0=e.catch(1),console.error(e.t0),(a=new Error("capture stream from file input souce failed")).name="FileInputSouceError",a;case 17:case"end":return e.stop()}}),e,null,[[1,11]])}))),function(e){return a.apply(this,arguments)})},{key:"startCaptureAudio",value:(i=d()(g.a.mark((function e(t){var r,i,a,n,o,s,u,d,c,l=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.audioConstraints,i=t.successHandler,a=t.errorHandler,this.enableReuseStream(!1),n=!!r&&this._getAudioConstraints(r),o=this._isFileInputAudioSource(n),s=this._isSameAudioConstraintsAsPrev(n),u=this._getPresetVideoConstraints(),this._clearPresetAudioStreamAutoStopTimer(),!s){e.next=11;break}return this.audioCaptureElapsedTime=-2,this._handleAudioCaptureSuccess(this.audioStream,n,i,!0),e.abrupt("return");case 11:if(this.destoryAudioMediaStream(),d={audio:n,video:o?null:u},this.isCaptureAudioInProgress=!0,c=Date.now(),!q.default.isIphoneOrIpadSafari()){e.next=20;break}if(!this._captureVideoDeferred){e.next=19;break}return e.next=19,this._captureVideoDeferred.promise;case 19:this._captureVideoDeferred=new q.Deferred;case 20:Q.default.add_monitor("RGUMA"),(o?this._captureFileInputAudioStream(n):navigator.mediaDevices.getUserMedia(d)).then((function(e){if(Z.default.ComputerAudioStatus===J.a.ComputerAudio_Null)return Y.default.log("getUserMedia successfully but UI has called leave audio"),void e.getAudioTracks().forEach((function(e){e.stop()}));l.audioCaptureElapsedTime=Date.now()-c,l._splitAudioStream(e,d,i,a)})).catch((function(e){Z.default.ComputerAudioStatus!==J.a.ComputerAudio_Null?(o||ya.updateSelectedMicDevices(n.deviceId&&n.deviceId.exact||"default","getUsermedia failed",Date.now()-c,!1),a(e)):Y.default.log("getUserMedia failed but UI has called leave audio")})).finally((function(){l.isCaptureAudioInProgress=!1,l._captureVideoDeferred&&l._captureVideoDeferred.resolve()}));case 22:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_isFileInputVideoSource",value:function(e){return e&&e.video instanceof HTMLVideoElement}},{key:"isUsingFileInputVideoSource",value:function(){return this._isFileInputVideoSource(this.videoConstraints)}},{key:"_getFileInputSourceSize",value:function(e,t){var r=[90,180,360,720];return t||(t=360),t>720&&(t=720),t<90&&(t=90),-1===r.indexOf(t)&&r.some((function(e,i){return e>t&&(t=(e+r[i-1])/2<t?e:r[i-1],!0)})),{width:16/9*t,height:t}}},{key:"_getVideoConstraints",value:function(t){var r=t.videoSource,i=t.usingFacingMode,a=t.width,n=t.height,o=t.pan,s=t.tilt,u=t.zoom,d=t.fps;if(r instanceof HTMLVideoElement)return dh({video:r},a&&n?this._getFileInputSourceSize(a,n):{});var c=!1,l=d||x.P;l>x.s&&(l=x.s),l<x.t&&(l=x.P),navigator.hardwareConcurrency&&navigator.hardwareConcurrency<4&&l>x.q&&(l=x.q);var h=l,f=["user","environment","left","right"];if(e.webrtcflag)i&&f.includes(r)?c={facingMode:{exact:r},height:720,width:1280}:(c={height:720,width:1280},r&&(c.deviceId={exact:r}));else if(i)c=!r||(f.includes(r)?{facingMode:{exact:r}}:{deviceId:{exact:r}});else if(q.default.browser.isSafari)c=!r||{deviceId:{exact:r}};else{var p=this.currentVideoResolution,v=p.width,m=p.height,g=0!=v&&0!=m,_=g?v:a||640,S=g?m:n||360;_>=1920&&!q.default.get1080pcapacity()&&(_=1280,S=720),c={width:{min:_,ideal:_},height:{min:S,ideal:S},deviceId:r?{exact:r}:void 0,frameRate:h,pan:o,tilt:s,zoom:u},Z.default.monitorVideoReadyCaptureWidth=c.width,Z.default.monitorVideoReadyCaptureHeight=c.height}return c}},{key:"_updateVideoConstraints",value:function(e){return this.videoStreamTrack?this.videoStreamTrack.applyConstraints(e).catch((function(e){Y.default.error("Applying video constraints failed",e)})):Promise.reject(new Error("video stream not exist! update video constraints failed"))}},{key:"changeVideoResolution",value:function(e,t,r){var i=this;if(this.videoStreamTrack){if(e>=1920&&!this.isSupportFullHD&&(e=1280,t=720),this.videoStreamTrack.getSettings){var a=this.videoStreamTrack.getSettings();if(Math.abs(a.width-e)<50)return Promise.reject(new Error("no change for the resolution"))}Q.default.add_monitor("CCWidth"+e);var n={width:{min:e,ideal:e},height:{min:t,ideal:t},frameRate:r,aspectRatio:this.platformType==x.X.DESKTOP?{ideal:16/9}:void 0};return this._updateVideoConstraints(n).then((function(){i.currentVideoResolution={width:e,height:t}}))}return Promise.reject(new Error("video stream not exist! change video resolution failed"))}},{key:"_isSameVideoConstraintsAsPrev",value:function(e){return!this._isFileInputVideoSource(e)&&(!(!this.videoConstraints||!Object(q.deepEqual)(this.videoConstraints,e))&&(!!this.videoStream&&!!this._isStreamHasVideo(this.videoStream)))}},{key:"_clearCaptureVideoTimer",value:function(){this.captureVideoTimer&&(clearTimeout(this.captureVideoTimer),this.captureVideoTimer=null)}},{key:"destoryVideoMediaStream",value:function(){this.videoStream?(this._isFileInputVideoSource(this.videoConstraints)&&q.default.videoToMediaStreamManager.stopCapture(),this._isReuseStreamEnabled?this._updateStreamInReuse(this.videoStream,!0):(this._updateStreamInReuse(this.videoStream,!1),this._destoryStream(this.videoStream),this.videoStream=null,this.videoStreamTrack=null,this.videoConstraints=null,this._destoryDeprecatedStream({video:!0}))):this._destoryDeprecatedStream({video:!0}),this._isReuseStreamEnabled||this._clearCaptureVideoTimer(),this.enableReuseStream(!1),this.destoryVideoProcessor(),this._clearCheckVideoStreamActiveTimer()}},{key:"shouldCaptureVideo",value:function(){return!this.videoStream||this._isStreamInReuse(this.videoStream)}},{key:"_clearCheckVideoStreamActiveTimer",value:function(){this.checkVideoStreamActiveTimer&&(clearTimeout(this.checkVideoStreamActiveTimer),this.checkVideoStreamActiveTimer=null)}},{key:"checkVideoStreamActive",value:function(){var e=this;return new Promise((function(t,r){e._clearCheckVideoStreamActiveTimer(),e.checkVideoStreamActiveTimer=setTimeout((function(){e.videoStream?!1===e.videoStream.active?r(new ii("VideoMediaStram.active equals false")):t(!0):r(!1)}),1e3)}))}},{key:"destoryVideoProcessor",value:function(){if(this.videoTrackReader){try{this.videoTrackReader.stop()}catch(e){Y.default.error("Error when destroying video track reader",e)}this.videoTrackReader=null}if(this.mediaStreamTrackProcessor){if(this.mediaStreamTrackProcessor=null,Zt({command:"releaseStream"}),this.reableStream&&this.reableStream.close)try{this.reableStream.close()}catch(e){Y.default.error("Error when destroying mediaStreamTrackProcessor",e)}this.reableStream=null}this.videoImageCapture=null,this.unLockImageCapture()}},{key:"lockImageCapture",value:function(){this.videoImageCaptureLocked=!0}},{key:"unLockImageCapture",value:function(){this.videoImageCaptureLocked=!1}},{key:"isImageCaptureLocked",value:function(){return this.videoImageCaptureLocked}},{key:"_createVideoProcessor",value:function(){this.videoStreamTrack?this.streamProcessAbility.isSupportMediaStreamTrackProcessor?(this.mediaStreamTrackProcessor=new MediaStreamTrackProcessor(this.videoStreamTrack),this.reableStream=this.mediaStreamTrackProcessor.readable,Zt({command:"releaseStream"}),$t("frameStream",this.reableStream),Q.default.add_monitor("VCTP")):this.streamProcessAbility.isSupportVideoTrackReader?(this.videoTrackReader=new VideoTrackReader(this.videoStreamTrack),Q.default.add_monitor("VCTR")):this.streamProcessAbility.isSupportImageCapture&&(this.videoImageCapture=new ImageCapture(this.videoStreamTrack),Q.default.add_monitor("VCIC")):Y.default.error("Video stream track does not exist - cannot create video processor")}},{key:"_storeVideoStream",value:function(e,t,r){e&&(fh("video stream is ok"),this.destoryVideoMediaStream(),this.videoStream=e,this.videoStreamTrack=this.videoStream.getVideoTracks()[0],this.videoConstraints=t,r&&this._setPresetVideoStreamAutoStopTimer())}},{key:"_setPresetVideoStreamAutoStopTimer",value:function(){var e=this;this._clearPresetVideoStreamAutoStopTimer(),this.presetedConstraints.videoTimer=setTimeout((function(){e.destoryVideoMediaStream()}),1e4)}},{key:"_clearPresetVideoStreamAutoStopTimer",value:function(){this.presetedConstraints.videoTimer&&(clearTimeout(this.presetedConstraints.videoTimer),this.presetedConstraints.videoTimer=null)}},{key:"_handleVideoCaptureSuccess",value:function(e,t,r,i){this._clearPresetVideoStreamAutoStopTimer(),i||this._storeVideoStream(e,t),this._createVideoProcessor(),this._updateStreamInReuse(e,!1),r(e)}},{key:"getVideoCapabilities",value:function(){if(this.videoStream&&(this.videoStreamTrack||(this.videoStreamTrack=this.videoStream.getVideoTracks()[0]),this.videoStreamTrack)){if(this.videoStreamTrack.getCapabilities)return this.videoStreamTrack.getCapabilities()||{};if(this.videoStreamTrack.getSettings)return this.videoStreamTrack.getSettings()||{}}return{}}},{key:"getAudioCapabilities",value:function(){var e=null,t=null;if(this.audioStream){var r=this.audioStream.getAudioTracks()[0];r&&(e=r.getSettings().deviceId,t=r.label)}return{deviceId:e,elapsed_time:this.audioCaptureElapsedTime,deviceLabel:t}}},{key:"_splitVideoStream",value:function(e,t,r,i){var a=t.audio,n=t.video;if(a&&this._isStreamHasAudio(e)){var o=this._genVideoStream(e),s=this._genAudioStream(e);return o?this._handleVideoCaptureSuccess(o,n,r):i(new Error("video stream do not contains video track ")),void(s&&(this.audioStream?this._pushDeprecatedStream({audioStream:s}):(this._updateStreamInReuse(s,!0),this._storeAudioStream(s,a,!0))))}this._handleVideoCaptureSuccess(e,n,r)}},{key:"_captureFileInputVideoStream",value:(r=d()(g.a.mark((function e(t){var r,i,a,n,o,s;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.video,e.prev=1,e.next=4,new Promise((function(e,t){r.currentTime>0&&!r.paused&&!r.ended&&e(!0),r.addEventListener("timeupdate",(function t(){e(!0),r.removeEventListener("timeupdate",t)})),setTimeout((function(){return t(!1)}),1e4)}));case 4:if(e.sent){e.next=7;break}throw new Error("video file playing failed");case 7:return t.width&&t.height||(i=_getFileInputSourceSize(r.videoWidth,r.videoHeight),a=i.width,n=i.height,t.width=a,t.height=n),o=q.default.videoToMediaStreamManager.startCapture(r,t.width,t.height),e.abrupt("return",o);case 12:throw e.prev=12,e.t0=e.catch(1),console.error(e.t0),(s=new Error("capture stream from file input souce failed")).name="FileInputSouceError",s;case 18:case"end":return e.stop()}}),e,null,[[1,12]])}))),function(e){return r.apply(this,arguments)})},{key:"startCaptureVideo",value:(t=d()(g.a.mark((function e(t){var r,i,a,n,o,s,u,d,c,l,h,f,p,v,m,_,S,E,b;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.videoConstraints,i=t.timeout,a=t.successHandler,n=t.errorHandler,!this._captureVideoDeferred){e.next=4;break}return e.next=4,this._captureVideoDeferred.promise;case 4:if(this.enableReuseStream(!1),o=!!r&&this._getVideoConstraints(r),s=this._isFileInputVideoSource(o),u=this._isSameVideoConstraintsAsPrev(o),d=this._getPresetAudioConstraints(),this._clearPresetVideoStreamAutoStopTimer(),Q.default.add_monitor("STARTVIDEOCAPTURE:".concat(!!this._captureVideoDeferred,":").concat(u)),!u){e.next=14;break}return this._handleVideoCaptureSuccess(this.videoStream,o,a,!0),e.abrupt("return");case 14:if(this.destoryVideoMediaStream(),fh("try to getusermedia",c={audio:s?null:d,video:o}),Q.default.add_monitor("VCFC: ".concat(JSON.stringify(c))),e.prev=18,this.isCaptureVideoInProgress=!0,l=!1,this._clearCaptureVideoTimer(),i&&(this.captureVideoTimer=setTimeout((function(){if(!h){l=!0;var e=new Error("GetUserMedia timeout");n(e)}}),i)),f=Date.now(),!s){e.next=30;break}return e.next=27,this._captureFileInputVideoStream(o);case 27:h=e.sent,e.next=41;break;case 30:return e.prev=30,e.next=33,navigator.mediaDevices.getUserMedia(c);case 33:h=e.sent,e.next=41;break;case 36:return e.prev=36,e.t0=e.catch(30),e.next=40,navigator.mediaDevices.getUserMedia(Object.assign({},c,{video:!0}));case 40:h=e.sent;case 41:if(this._clearCaptureVideoTimer(),!h){e.next=56;break}if((p=h.getVideoTracks()[0])&&p.getCapabilities&&(null==(m=p.getCapabilities())||null===(v=m.width)||void 0===v?void 0:v.max)>=1920&&(this.isSupportFullHD=!0),(_=p.getSettings())&&(S=_.facingMode,this.facingMode="user"===S?x.n:"environment"===S?x.l:x.m),E=_.deviceId,b=p.label,!l){e.next=53;break}return this._destoryStream(h),ya.updateSelectedCameraDevices(E,b,_.width,_.height,_.frameRate,Date.now()-f,!1),e.abrupt("return");case 53:ya.updateSelectedCameraDevices(E,b,_.width,_.height,_.frameRate,Date.now()-f,!0),e.next=58;break;case 56:return n(new Error("GetUserMedia ret null")),e.abrupt("return");case 58:this._splitVideoStream(h,c,a,n),e.next=64;break;case 61:e.prev=61,e.t1=e.catch(18),n(e.t1);case 64:return e.prev=64,this.isCaptureVideoInProgress=!1,e.finish(64);case 67:case"end":return e.stop()}}),e,this,[[18,61,64,67],[30,36]])}))),function(e){return t.apply(this,arguments)})},{key:"playVideoStream",value:function(e){if(e){e.setAttribute("muted",""),e.setAttribute("playsinline","");try{e.srcObject=this.videoStream}catch(t){e.src=URL.createObjectURL(this.videoStream)}var t=e.play();return t?t.then((function(){})).catch((function(e){throw Y.default.error("Video element playback failed",e),e})):Promise.resolve(void 0)}return Promise.reject(new Error("video dom node not provided!"))}},{key:"destoryReuseStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.audio,r=e.video;this.enableReuseStream(!1),t&&this.destoryAudioMediaStream(),r&&this.destoryVideoMediaStream()}}]),e}();v()(lh,"webrtcflag",!1);var hh=new lh,fh=Object(X.a)("sdk"),ph=!1,vh=!1;try{vh=!1}catch(e){}var mh=0,gh=function(e){switch(window.orientation){case 0:mh=1;break;case 90:mh=2;break;case 180:mh=3;break;case-90:default:mh=0}};function _h(){return q.default.isIphoneOrIpadSafari()}function Sh(){var e=document.createElement("video");return e.setAttribute("muted",""),e.setAttribute("playsinline",""),e}!function(){try{var e,t,r;null!==(e=screen)&&void 0!==e&&e.orientation,null===(t=window)||void 0===t||t.removeEventListener("orientationchange",gh),null===(r=window)||void 0===r||r.addEventListener("orientationchange",gh),gh()}catch(e){}}(),document.addEventListener("visibilitychange",(function(){var e=q.default.getMachineCapability();document.hidden?(e.unvisibilitycount++,e.visibility=!1):e.visibility=!0}));var Eh,bh,yh,Ch,Ah,Rh,Ih,wh,Th,kh,Dh,Oh=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(fh("sdkProps",e),Q.default.reset(),this._id=(new Date).getTime()+Math.floor(performance.now()),e.parentPath){var t=e.parentPath.endsWith("/")?e.parentPath:e.parentPath+"/";r.p=t}else{var i=null==ch?void 0:ch.indexOf("js_media.min.js");i?r.p=null==ch?void 0:ch.substring(0,i):fh("could not locate parentPath")}if(this.lateLoadedAssetsHash={},e.globalTracingLogger&&Y.default.setInstance(e.globalTracingLogger),Y.default.clearHighFrequencyLogs(),this.isSupportThread="object"===("undefined"==typeof WebAssembly?"undefined":s()(WebAssembly))&&"function"==typeof Worker,!this.isSupportThread)throw new Error("Webassemly or worker is not supported on this browser");var a=Z.default.sharedBuffer;Z.default.reinit(this),a&&(Z.default.sharedBuffer=a),this.localLog=null,vh&&(this.localLog=new Ya,this.localLog.init()),ya.init(),ph||(ph=!0,navigator.mediaDevices.addEventListener("devicechange",ya.updateDeviceList.bind(ya))),this.userId="",this.selfPreviewVideotag=null,this.sharingCanvasList=[],this.audioCtx=Object(q.createAudioContext)("Main"),this.sharingAudioCtx=null,this.webrtcAudioNode=null,this.sharingWebrtcAudioNode=null,this.videoRenderArray=[],this.videoCaptureValue=null,this.audioRenderArray=[],this.audioCapture=null,this.deviceInfo=new Map,this.display=[],this.sampleRate=this.audioCtx.sampleRate,this.videoRenderIntervalHandle=null,this.audioDomNode=null,this.audioSpeakerValue=null,this.audionoderecordbuffersize=2048,this.lastresidual=null,this.currentactive=0,this.audioPlay=!1,this.sharingInterval=null,this.sharingIntervalTime=100,this.sharingDisplay=null,this.currentshareactive=0,this.activeSpeakerSsrc=0,this.videorenderinterval=30,this.waterMarkCanvas=null,this.videoCaptureHiddenCanvas=null,this.videoCaptureHiddenCanvasCtx=null,this.isSetCursor=!1,this.logon=!1,this.canvas=null,this.firstSetDelay=!0,this.isSelfViewWithVideo=!1,this.isSupportOffscreenCanvas=q.default.isSupportOffscreenCanvas(),this.isSupportImageCapture=q.default.isSupportImageCapture(),this.isSharingSupportImageCapture=this.isSupportImageCapture,this.isSupportVideoTrackReader=q.default.isSupportVideoTrackReader(),this.isSupportSharingTrackReader=this.isSupportVideoTrackReader,this.isSupportVideoShare=q.default.isSupportVideoShareReceive()&&q.default.isSupportVideoShareSend(),this.isSupportMediaStreamTrackProcessor=q.default.isSupportMediaStreamTrackProcessor(),this.isSupportVideoFrameOrBitmapCapture=q.default.isSupportVideoFrameOrBitmapCapture(),this.isMultipleCanvasForMultipleView=0,this.canISendNextSharingFrame=!0,this.isCaputureNodeConnect=!1,this.isSharingCaptureNodeConnect=!1,this.audioWorkletJsPath=null,this.isSupportChromeWideAEC=q.default.isSupportChromeWideAEC(),this.isSupport2DCanvasDrawFrame=q.default.isSupport2DCanvasDrawFrame(),this.MaskImage=null,this.BgImage=null,this.bgCanvas=null,this.bgCanvasctx=null,this.isCurrentInMaskStatus=!1,this.maskCoordinate={dx:0,dy:0,dWidth:0,dHeight:0},this.VideoMaskSettingCanvas=null,this.VideoMaskSettingCanvasctx=null,this.PrevVideoMaskSettingCanvas=null,this.VideoMaskCanvasFillMode=0,this.isMaskSettingOn=!1,this.isMaskSettingStarted=!1,this.MaskData=null,this.MaskSettingVideo=null,this.ReadyCapureWidth=640,this.ReadyCapureHeight=360,this.bgImageCroppingParams={sx:0,sy:0,sw:0,sh:0},this.VideoVBSettingCanvas=null,this.isVBSettingOn=!1,this.sMonitorCaptureFrameCount=0,this.vMonitorCaptureFrameCount=0,this.videoCaptureInterval=0,this.isStartVideoCapture=!1,this.videoCaptureWidth=0,this.videoCaptureHeight=0,this.videoCaptureContext=null,this.isCreateVideoWaterMark=!1,this.videoWaterMarkName="",this.sharingWaterMarkName="",this.isCreateSharingWaterMark=!1,this.videoWaterMarkParams={},this.sharingWaterMarkParams={},this.isStartDesktopSharing=!1,this.desktopSharingValue=null,this.desktopCaptureContext=null,this.desktopSharingMediaStram=null,this.desktopSharingCaptureWidth=0,this.desktopSharingCaptureHeight=0,this.desktopSharingSend=!1,this.isdesktopCaptureLoadedmetadata=!1,this.captureVideoOutputCanvasDomList=[],this.captureVideoOutPutVideoDom=null,this.shareTrack=null,this.isVideoCaptureLoadedmetadata=!1,this.videoloadedmetadatahandle=null,this.VALUE_CACHE_FOR_START_CAPTURE_VIDEO={},this.vMonitorCount=0,this.sMonitorCount=0,this.mMonitorCount=0,this.sharingTrackReader,this.sharingMediaStreamTrackProcessor,this.sharingFrameStream,this.isSendVideoOfflineCanvas=!1,Z.default.mediaSDKHandle=this,this._preloadMeetingParam=null,this.is32bitbrowser=!1,this.flipSend=!0,this.mtu_size=0,this.sharingImageCapture=null,this.sharingRenderCanvas=null,this.VideoRenderObj=null,this.SharingRenderObj=null,this.rtcConnectionA=null,this.rtcConnectionB=null,this.isLocalP2PSupportedPromise=q.default.checkLocalP2PConnection(),this.isSupportBrowserAec=!0,this.sharingWidthAndHeightInfo={ctiveNodeID:0,height:0,logicHeight:0,logicWidth:0,width:0},this.remoteControl=null,this.isMirrorMyVideo=!1,this.isCanvasScaled=!1,this.isInitVideoDataChannel=!1,this.isInitAudioDataChannel=!1,this.rtcPeerConnectionList=[],this.isDestroy=!1,this.destoryPromise=null,this.rwgAgentMessageListenerWrapper=this.rwgAgentMessageListener.bind(this),this.bVideoDecodeWorker2MainSABPostSuccessDeferred=new q.Deferred,this.bVideoDecodeFrameBackSABRingBufferConsumeCopyData=!1,this.bVideoDecodeUsingSAB=q.default.isSupportSharedArrayBuffer(),this.bVideoEncodeUsingSAB=q.default.isSupportSharedArrayBuffer(),this.bAudioEncodeUsingSAB=q.default.isSupportSharedArrayBuffer(),this.bAudioDecodeUsingSAB=q.default.isSupportSharedArrayBuffer(),this.audioEncodeRingBufferConsumer=null,this.audioDecodeRingBuffer=null,this.videoEncodeRingbufferConsumer=null,this.videoDecodeFrameBackSABRingBufferConsumer=null,this.bVideoEncodeMainThreadConsumerIntervalEnable=_h(),this.isSupportOffscreenCanvasForVideoDecode=q.default.isSupportOffscreenCanvas(),this.bAudioDatachannelOpen=null,this.isMultiView=!1,this.webrtcaudiodom=null,this.checkWorkletInterval=null,e.ivObj&&(Z.default.ivObj=e.ivObj),this.WebSipClient=null,this.lastRealRect={left:0,top:0,width:0,height:0},this.videodecodehardwareflag=null,this.videoencodehardwareflag=null,this.isEnableVideoDecodeHardWareThread=!1,this.hardwareflag=null,this.isEnableHardWareThread=!1,this.isTeslaMode=!1,this.useAudioBridge=!1,this.audioBridge=null,this.replaceCanvasMap={},this.hidAvalible=!1,this.enableHID=!1,this.audioInputLevel=null,this.captureAudioMuted=!1,this.setvideokk=!1,this.isStartWhiteboardSharing=!1,this.sharingDecodeRingBuffer=null,this.ZoomMonitor=Q.default.add_monitor.bind(Q.default),this.isLandScape=!1,this.captureSize=null,this.platformType=x.X.DESKTOP,this.wmscManager=null,this.webrtcConfig={userId:null,webrtcflag:!1,useSimulcast:!1,videoHD:!1},this.allpromises=[],this.RenderInMain=x.H,this.vcFlag=!1,za.isSupportComputePressure()&&(this.computePressureManager=new za),this.renderManager=new ih("JsMediaSDK"),this.rendererType=-1,this.webgpucapcity=0,this.enableVBWasmBackend=0,this.isWebGL2Enabled=0,this.mGPUBlacklist=null,this.mWebCodecConfig=null,this.isWebCodecEncoderOnWhitelist=!1,this.isWebCodecDecoderOnWhitelist=!1};Oh.buildNumber=7106,Oh.version="15.0.7106",Oh.util=q.default,Oh.fixVersion="Web-Media-6.1.0",Oh.prototype={JsMediaSDK_Log:function(e){Y.default.error("Error in JsMediaSDK",e)},JsMediaSDK_PreLoad:function(e,t,r){var i=this,a=r||{},n=a.isTeslaMode,o=a.isGoogleMeetMode,s=a.enableMultiDecodeVideoWithoutSAB,u=a.enableVirtualBackgroundWithoutSAB,d=a.enableDecoderInWorklet,c=a.enableAudioBridge,l=a.useWebRTC,h=a.useSimulcast,f=a.disableStreamingInstantiate;Z.default.decoderinworkletOP=!0,Z.default.chromeWideAEC=d,Z.default.enableStreamingInstantiate=!f,Z.default.enableMultiDecodeVideoWithoutSAB=s,Z.default.enableVirtualBackgroundWithoutSAB=u,Z.default.enableAudioBridge=c,this.isTeslaMode=!!n,Z.default.isGoogleMeetMode=o;var p={audioWorkletPath:e.audioWorkletPath,audioWorkletSIMDPath:e.audioWorkletSIMDPath,audioWorkletProcessPath:e.audioWorkletProcessPath,sharingAudioWorkletPath:e.sharingAudioWorkletPath,audioLevelWorkletPath:e.audioLevelWorkletPath,audioWasm:e.audioWasm,audioSIMDWasm:e.audioSIMDWasm};this.setPropsBeforeInit({callback:t,audioWorkletPath:p}),this._preloadMeetingParam=e,Sr(),this.handleUnloadEvent(),Q.default.add_monitor("JSPLD"),r&&r.file&&r.resourceManager&&Kr(r.file,r.resourceManager);var v=!!l;lh.webrtcflag=v,this.webrtcConfig.webrtcflag=v,this.webrtcConfig.useSimulcast=v&&h,this.computePressureManager&&this.computePressureManager.init(),q.default.isSDKSupportSIMD().then((function(e){i.isSupportVideoShare=i.isSupportVideoShare&&e}))},getWebRTCFlag:function(){return this.webrtcConfig&&this.webrtcConfig.webrtcflag},isPreviewVideotag:function(e){return this.userId&&this.userId>>10==e>>10&&q.default.isSelfPreviewRenderWithVideo()},isSelfUser:function(e){return this.userId==e},recordSharingParamInfo:function(){var e=this;z.a.on(M.SHARING_PARAM_INFO_FROM_SOCKET,(function(t,r){Object.assign(e.sharingWidthAndHeightInfo,r.body)}))},setCallback:function(e){if(!ni()(e))throw new Error("callback must be function");Z.default._Notify_APPUI=e},addCallback:function(e){if(!ni()(e))throw new Error("callback must be function");Z.default._callbackList.push(e)},removeCallback:function(e){var t=Z.default._callbackList.indexOf(e);-1!==t&&Z.default._callbackList.splice(t,1)},setPropsBeforeInit:function(e){var t=this;if(e.featureOptions){this.webgpucapcity=q.default.getOption(e.featureOptions,21,1),this.enableVBWasmBackend=q.default.getOption(e.featureOptions,27,1),this.isWebGL2Enabled=q.default.getOption(e.featureOptions,29,1),Z.default.enableEchoDetection=q.default.getOption(e.featureOptions,31,1)}if(e&&void 0!==e.webMediaBlockConfig)try{var r=JSON.parse(e.webMediaBlockConfig);this.mGPUBlacklist=null==r?void 0:r.GPUBlacklist,this.mWebCodecConfig=null==r?void 0:r.WebCodecConfig,this.mWebCodecConfig?(this.isWebCodecEncoderOnWhitelist=sh.isGPUProfileOnWebCodecWhitelist("encoder",this.mWebCodecConfig),this.isWebCodecDecoderOnWhitelist=sh.isGPUProfileOnWebCodecWhitelist("decoder",this.mWebCodecConfig)):(this.isWebCodecEncoderOnWhitelist=0===q.default.AdapterWhiteListCheckForEncoder(),this.isWebCodecDecoderOnWhitelist=sh.isGPUProfileOnWebCodecWhitelist("decoder",void 0))}catch(t){this.isWebCodecEncoderOnWhitelist=0===q.default.AdapterWhiteListCheckForEncoder(),this.isWebCodecDecoderOnWhitelist=sh.isGPUProfileOnWebCodecWhitelist("decoder",void 0),Y.default.error("failed to read props.webMediaBlockConfig! val=".concat(null==e?void 0:e.webMediaBlockConfig," encoder:").concat(this.isWebCodecEncoderOnWhitelist," decoder:").concat(this.isWebCodecDecoderOnWhitelist))}else this.isWebCodecEncoderOnWhitelist=0===q.default.AdapterWhiteListCheckForEncoder(),this.isWebCodecDecoderOnWhitelist=sh.isGPUProfileOnWebCodecWhitelist("decoder",void 0);e&&void 0!==e.rendererType&&(this.rendererType=e.rendererType,this.handleRendererTypeInProps(this.rendererType,this.mGPUBlacklist).then((function(e){Z.default.Notify_APPUI(M.SYNC_RENDERER_TYPE_RESPONSE,e),t.renderManager.getRendererProvider().setRendererType(e.rendererType),t.rendererType=e.rendererType,Y.default.log("handleRendererTypeInProps() final rendererType=".concat(e.rendererType," gpuBlacklist=").concat(JSON.stringify(t.mGPUBlacklist))),console.log("handleRendererTypeInProps() final rendererType=".concat(e.rendererType," gpuBlacklist=").concat(JSON.stringify(t.mGPUBlacklist)))}))),Q.default.add_monitor("option:".concat(e.featureOptions,":").concat(this.webgpucapcity,":").concat(this.enableVBWasmBackend,":").concat(this.isWebGL2Enabled,", \n      wcl_rendererType:").concat(this.rendererType,",\n      wcl_GPUBlacklist:").concat(JSON.stringify(this.mGPUBlacklist),",\n      wcl_WebCodecConfig:").concat(JSON.stringify(this.mWebCodecConfig),",\n      enableEchoDetection:").concat(Z.default.enableEchoDetection)),e.callback&&this.setCallback(e.callback),e.audioWorkletPath&&(this.audioWorkletJsPath=e.audioWorkletPath),e.e2eEncrypt?Z.default.e2eencrypt=!0:Z.default.e2eencrypt=!1,this._setWebtransportEnable({enable:e.enableWebtransport,webtransportPort:e.webtransportPort}),e.bandwidth?e.bandwidth.uplimit>=800?Z.default.uplimit=1e3*(e.bandwidth.uplimit-120):Z.default.uplimit=0:Z.default.uplimit||(Z.default.uplimit=0)},onRendererTypeSelected:function(){var e=this;return d()(g.a.mark((function t(){var r;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.handleRendererTypeInProps(e.rendererType,e.mGPUBlacklist);case 2:r=t.sent,e.renderManager.getRendererProvider().setRendererType(r.rendererType),e.rendererType=r.rendererType,Y.default.log("onRendererTypeSelected() final rendererType=".concat(r.rendererType)),console.log("onRendererTypeSelected() final rendererType=".concat(r.rendererType));case 7:case"end":return t.stop()}}),t)})))()},handleRendererTypeInProps:function(e){var t=arguments,r=this;return d()(g.a.mark((function i(){var a,n,o,s;return g.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=t.length>1&&void 0!==t[1]?t[1]:null,i.next=3,q.default.isRendererTypeSupported(e,r.webgpucapcity,r.isWebGL2Enabled,a);case 3:if(n=i.sent,o=0,s=e,n){i.next=11;break}return o=1,i.next=10,q.default.evaluateRendererType(r.webgpucapcity,r.isWebGL2Enabled,a);case 10:s=i.sent;case 11:return i.abrupt("return",{errNo:o,rendererType:s});case 12:case"end":return i.stop()}}),i)})))()},setRWGAgent:function(e){Z.default.rwgAgent=e,this.addEventListenerForRWGAgent(e)},updateQosSubscription:function(e,t,r){if(!this.audioBridge||t!==J.f.AUDIO_DECODE&&t!==J.f.AUDIO_ENCODE){var i=t===J.f.VIDEO_ENCODE||t===J.f.VIDEO_DECODE;if(this.webrtcConfig.webrtcflag&&i){var a;null===(a=this.wmscManager)||void 0===a||a.updateQosSubscription(e,t,r)}else{var n=!0;this.isSupportVideoShare&&(t==J.f.SHARING_DECODE&&(t=J.f.VIDEO_DECODE,n=!1),t==J.f.SHARING_ENCODE&&(t=J.f.VIDEO_ENCODE,n=!1)),Wr(t,{enable:e,workerType:t,pollingInterval:r,isVideo:n},11,!1)}}else this.audioBridge.updateQos({enable:e,workerType:t,pollingInterval:r})},addEventListenerForRWGAgent:function(e){e.on("message",this.rwgAgentMessageListenerWrapper)},rwgAgentMessageListener:function(e){if("string"==typeof e.data){var t=JSON.parse(e.data);if(!this.isDestroy)switch(t.evt){case M.EVT_TYPE_WS_VIDEO_DATACHANNEL_ANSWER:this.setRTCPeerConnectionDatachannelAnswer(t)}}},setRTCPeerConnectionDatachannelAnswer:function(e){if(e.evt===M.ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT||e.evt===M.ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT){if(fh("rwg answer",e),!e.answer)return;switch(e.answer.type){case J.h.ZOOM_CONNECTION_VIDEO:z.a.trigger(M.PUBSUB_EVT.ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT,e);break;case J.h.ZOOM_CONNECTION_AUDIO:z.a.trigger(M.PUBSUB_EVT.ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT,e)}}},initVideoDataChannel:function(e,t){var r=this;return d()(g.a.mark((function i(){var a,n,o;return g.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!r.isInitVideoDataChannel){i.next=3;break}return t&&(a=r.rtcPeerConnectionList.find((function(e){return e.connectionType===J.b.VIDEO})))&&a.checkEmptyUserIdAndResendMonitor(t),i.abrupt("return");case 3:r.isInitVideoDataChannel=!0,Q.default.add_monitor("INITVDC"),fh("initVideoDataChannel",e),n=new _i,q.default.browser.isFirefox?n.delaycloseTimeout=15e3:n.delaycloseTimeout=5e3,n.setUserid(t),n.setConnectionType(J.b.VIDEO),fh("rtc",n),o=r,n.onConnectionCreated(function(){var e=d()(g.a.mark((function e(t){var i,a,s;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.localDescription,fh("localDesc",i),!o.isDestroy){e.next=4;break}return e.abrupt("return");case 4:return Z.default.sendMessageToRwg(M.SEND_MESSAGE_TO_RWG,{evt:M.ZOOM_CONNECTION_VIDEO_OFFER_EVT,offer:{sdp:i.sdp,type:J.h.ZOOM_CONNECTION_VIDEO}},!1),e.next=7,n.waitForAnswerFromRWG(M.PUBSUB_EVT.ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT);case 7:if(a=e.sent,fh("jsEvent.PUBSUB_EVT.ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT",a),t==n.rtcPeerConnection&&!n.isDestroyed()){e.next=11;break}return e.abrupt("return");case 11:n.setRemoteDescription(a.answer),n.closeIfTimeout(),s=a.answer.sdp.match(/a=candidate:.+/)[0],fh("received candidate",s),s=s.replace(/^a=/,""),n.addIceCandidate(s),n.listenOnDataAndSend(M.VIDEO_DATA_FROM_WORKER),n.onMessage((function(e){var t=new Uint8Array(e);t[0]!=M.RWG_WCL_PDU_QOS_DATA_VIDEO&&132!=t[0]||(1&t[1])!=M.DATA_DIRECTION_FROM_RECEIVE?r.isSupportVideoShare||133!=t[0]&&132!=t[0]?r.videoDecodeRingBuffer?r.videoDecodeRingBuffer.enqueueSafe(t,!0,r.ZoomMonitor):Wr(J.f.VIDEO_DECODE,e,void 0,!0):r.sharingDecodeRingBuffer?r.sharingDecodeRingBuffer.enqueueSafe(t,!0,null):Wr(J.f.SHARING_DECODE,e,void 0,!0):Wr(J.f.VIDEO_ENCODE,e,void 0,!0)})),n.onDataChannelOpen((function(){Wr(J.f.VIDEO_DECODE,{isDataChannelOpen:!0},8,!1,!0),Wr(J.f.VIDEO_ENCODE,{isDataChannelOpen:!0},8,!1,!0),r.isSupportVideoShare||Wr(J.f.SHARING_DECODE,{isDataChannelOpen:!0},8,!1,!0)})),n.onDataChannelClose((function(){we(J.h.ZOOM_CONNECTION_VIDEO,J.d.NET_DATACHANNEL),Wr(J.f.VIDEO_DECODE,{isDataChannelOpen:!1},8),Wr(J.f.VIDEO_ENCODE,{isDataChannelOpen:!1},8),r.isSupportVideoShare||Wr(J.f.SHARING_DECODE,{isDataChannelOpen:!1},8,!1,!0)}));case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.initConnection(e).catch((function(e){fh.warn("initConnection",e),Q.default.add_monitor("INITVDCERR",e.message)})),r.rtcPeerConnectionList.push(n),r.videoDataChannel=n;case 16:case"end":return i.stop()}}),i)})))()},initAudioDataChannel:function(e,t){var r=this;return d()(g.a.mark((function i(){var a,n,o;return g.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!r.isInitAudioDataChannel){i.next=3;break}return t&&(a=r.rtcPeerConnectionList.find((function(e){return e.connectionType===J.b.AUDIO})))&&a.checkEmptyUserIdAndResendMonitor(t),i.abrupt("return");case 3:r.isInitAudioDataChannel=!0,Q.default.add_monitor("INITADC"),fh("initAudioDataChannel",e),n=new _i,q.default.browser.isFirefox?n.delaycloseTimeout=15e3:n.delaycloseTimeout=5e3,n.setUserid(t),n.setConnectionType(J.b.AUDIO),fh("rtc",n),o=r,n.onConnectionCreated(function(){var e=d()(g.a.mark((function e(t){var i,a,s;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.localDescription,!o.isDestroy){e.next=3;break}return e.abrupt("return");case 3:return fh("localDesc",i),Z.default.sendMessageToRwg(M.SEND_MESSAGE_TO_RWG,{evt:M.ZOOM_CONNECTION_VIDEO_OFFER_EVT,offer:{sdp:i.sdp,type:J.h.ZOOM_CONNECTION_AUDIO}},!1),e.next=7,n.waitForAnswerFromRWG(M.PUBSUB_EVT.ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT);case 7:if(a=e.sent,fh("answer",a),t==n.rtcPeerConnection&&!n.isDestroyed()){e.next=11;break}return e.abrupt("return");case 11:n.setRemoteDescription(a.answer),n.closeIfTimeout(),s=a.answer.sdp.match(/a=candidate:.+/)[0],fh("received candidate",s),s=s.replace(/^a=/,""),n.addIceCandidate(s),n.listenOnDataAndSendAudio(M.AUDIO_DATA_FROM_WORKER),n.onMessage((function(e){var t=new Uint8Array(e);if(t[0]==M.RWG_WCL_PDU_QOS_DATA&&t[1]==M.DATA_DIRECTION_FROM_RECEIVE)Wr(J.f.AUDIO_ENCODE,e,void 0,!0);else{var i=!(r.audioDecodeRingBuffer&&Z.default.sharedBuffer);i||r.audioDecodeRingBuffer.enqueue(t),Wr(J.f.AUDIO_DECODE,!i||e,void 0,i)}})),n.onDataChannelOpen((function(){r.bAudioDatachannelOpen=!0,Wr(J.f.AUDIO_DECODE,{isDataChannelOpen:!0},8,!1,!0),Wr(J.f.AUDIO_ENCODE,{isDataChannelOpen:!0},8,!1,!0)})),n.onDataChannelClose((function(){we(J.h.ZOOM_CONNECTION_AUDIO,J.d.NET_DATACHANNEL),r.bAudioDatachannelOpen=!1,Wr(J.f.AUDIO_DECODE,{isDataChannelOpen:!1},8),Wr(J.f.AUDIO_ENCODE,{isDataChannelOpen:!1},8)}));case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.initConnection(e,"ZoomWebclientAudioDataChannel").catch((function(e){fh.warn("initConnection",e),Q.default.add_monitor("INITADCERR",e.message)})),r.rtcPeerConnectionList.push(n),r.audioDataChannel=n;case 16:case"end":return i.stop()}}),i)})))()},init_Notify_APPUI:function(e,t){var r=Zr[t],i=e?r.success:r.fail;Z.default.Notify_APPUI(i,r.callbackDataValue)},_setWebtransportEnable:function(e){var t=e.enable,r=e.webtransportPort;t?(q.apiSupportUtility.setIsSupportWebtransport(!0),Z.default.webtransportPort=r||8802):q.apiSupportUtility.setIsSupportWebtransport(!1)},_previewInitWebtransport:function(e){var t=this,r=e.conId,i=e.meetingNumber,a=e.rwgHost,n=e.webtransportPort,o=e.workType;if(this._setWebtransportEnable({enable:!0,webtransportPort:n}),q.apiSupportUtility.getIsSupportWebtransport()){var s=o===J.f.AUDIO_ENCODE,u=o===J.f.AUDIO_DECODE,d=o===J.f.VIDEO_ENCODE,c=o===J.f.VIDEO_DECODE,l=s||u,h=l?"a":"v",f=s||d?2:1,p="https://".concat(a,":").concat(Z.default.webtransportPort,"/wc/media/").concat(i,"?type=").concat(h,"&cid=").concat(r),v="".concat(p,"&mode=").concat(f);l?ft(p):vt(p);var m=Z.default.SPECIAL_ID,g="",_=null;s?(g="localAudioEncMGR",_=ye.nameMap.CREATE_AUDIO_ENCODE_HANDLE_SUCCESS):u?(g="localAudioDecMGR",_=ye.nameMap.CREATE_AUDIO_DECODE_HANDLE_SUCCESS):d?(g="localVideoEncMGR",_=ye.nameMap.CREATE_VIDEO_ENCODE_HANDLE_SUCCESS):c&&(g="localVideoDecMGR",_=ye.nameMap.CREATE_VIDEO_DECODE_HANDLE_SUCCESS);var S=Z.default[g]&&Z.default[g].map.get(m);S?S.postMessage({command:6,webtransportURL:v,_id:this._id}):ye.enqueueMessage({name:_,handler:function(){(S=Z.default[g].map.get(m)).postMessage({command:6,webtransportURL:v,_id:t._id})},direction:ye.direction.SDK_TO_SDK})}},_previewInitMediaWebsocket:function(e){var t=e.websocketUrl,r=e.workType,i=Z.default.SPECIAL_ID,a=r===J.f.AUDIO_ENCODE,n=r===J.f.AUDIO_DECODE,o=r===J.f.VIDEO_ENCODE,s=r===J.f.VIDEO_DECODE;a||n?ht(t):pt(t);var u="",d=null,c=0;a?(c=2,u="localAudioEncMGR",d=ye.nameMap.CREATE_AUDIO_ENCODE_HANDLE_SUCCESS):n?(c=5,u="localAudioDecMGR",d=ye.nameMap.CREATE_AUDIO_DECODE_HANDLE_SUCCESS):o?(c=2,u="localVideoEncMGR",d=ye.nameMap.CREATE_VIDEO_ENCODE_HANDLE_SUCCESS):s&&(c=5,u="localVideoDecMGR",d=ye.nameMap.CREATE_VIDEO_DECODE_HANDLE_SUCCESS);var l=Z.default[u]&&Z.default[u].map.get(i);l?l.postMessage({command:5,websocket_ip_address:"".concat(t,"&mode=").concat(c)}):ye.enqueueMessage({name:d,handler:function(){(l=Z.default[u].map.get(i)).postMessage({command:5,websocket_ip_address:"".concat(t,"&mode=").concat(c)})},direction:ye.direction.SDK_TO_SDK})},previewInit:function(e){var t=this;return d()(g.a.mark((function r(){var i,a,n,o,s,u,d,c,l,h,f,p,v,m,_,S,E,b,y,C,A,R,I,w,T,k,D,O,M,x,P,N,V,U,L,W,B,G,F,H,j,K,X,Y,z,Q,$,ee,te,re,ie,ae,ne;return g.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=e.videoDecode,a=e.videoDataChannel,n=e.videoEncodeMediaWss,o=e.videoDecodeMediaWss,s=e.videoEncodeWebtransport,u=e.videoDecodeWebtransport,d=e.audioDecode,c=e.audioDataChannel,l=e.audioBridge,h=e.audioEncodeMediaWss,f=e.audioDecodeMediaWss,p=e.audioEncodeWebtransport,v=e.audioDecodeWebtransport,Te(t)){r.next=3;break}return r.abrupt("return",!1);case 3:if(!i){r.next=24;break}return m=(i||{}).urlParameters,r.next=7,q.default.isSDKSupportMultiThread();case 7:if(r.t0=r.sent,!r.t0){r.next=10;break}r.t0=!q.default.isSelfPreviewRenderWithVideo()||q.default.isAndroidBrowser()||q.default.isMobileSafariSupportVideoFrame();case 10:return _=r.t0,r.next=13,q.default.isSDKSupportSIMD();case 13:return S=r.sent,E=S&&_,r.next=17,t.onRendererTypeSelected();case 17:(b={}).rendererType=t.rendererType,t.isSupportVideoShare=t.isSupportVideoShare&&S,t.isSupportVideoShare?(b.workerJsFileUrl=m.vsmiworkerpath,b.workerWasmFileUrl=m.videoMSIMDWasm):E?(b.workerJsFileUrl=m.videoMSIMDWorkerPath,b.workerWasmFileUrl=m.videoMSIMDWasm):_?(b.workerJsFileUrl=m.videoMtWorkerPath,b.workerWasmFileUrl=m.videoMtWasm):S?(b.workerJsFileUrl=m.videoSIMDWorkerPath,b.workerWasmFileUrl=m.videoSIMDWasm):(b.workerJsFileUrl=m.videoWorkerPath,b.workerWasmFileUrl=m.videoWasm),b.integrityHelper=new q.IntegrityHelper(b.workerJsFileUrl,t.lateLoadedAssetsHash),Ce.resetVideoDecode(!0),ke(b,t);case 24:if(a&&(y=a.conId,C=a.userid,t.initVideoDataChannel(y,C),Z.default.monitorCid=y),n&&(A=n.websocketUrl,t._previewInitMediaWebsocket({websocketUrl:A,workType:J.f.VIDEO_ENCODE})),o&&(R=o.websocketUrl,t._previewInitMediaWebsocket({websocketUrl:R,workType:J.f.VIDEO_DECODE})),s&&(I=s.conId,w=s.meetingNumber,T=s.rwgHost,k=s.webtransportPort,t._previewInitWebtransport({conId:I,meetingNumber:w,rwgHost:T,webtransportPort:k,workType:J.f.VIDEO_ENCODE})),u&&(D=u.conId,O=u.meetingNumber,M=u.rwgHost,x=u.webtransportPort,t._previewInitWebtransport({conId:D,meetingNumber:O,rwgHost:M,webtransportPort:x,workType:J.f.VIDEO_DECODE})),!d){r.next=39;break}return P=(d||{}).urlParameters,N={},r.next=34,q.default.isSDKSupportSIMD();case 34:r.sent?(N.workerJsFileUrl=P.audioSIMDWorkletPath,N.workerWasmFileUrl=P.audioSIMDWasm):(N.workerJsFileUrl=P.audioWorkerPath,N.workerWasmFileUrl=P.audioWasm),N.integrityHelper=new q.IntegrityHelper(N.workerJsFileUrl,t.lateLoadedAssetsHash),Ce.resetAudioDecode(!0),xe(N,t);case 39:if(c&&(V=c.conId,U=c.userid,t.initAudioDataChannel(V,U),Z.default.monitorCid=V),!l){r.next=48;break}return t.useAudioBridge=!0,L=l.nginxHost,W=l.rwgHost,B=l.cid,G=l.abToken,F=l.isCapturingAudio,H=l.audioMode,j=l.supportLocalAB,K=l.useWebRTCOnDesktop,t.audioBridge||(X={jsPath:t.audioWorkletJsPath.audioLevelWorkletPath,wasmPath:t.audioWorkletJsPath.audioSIMDWasm},t.audioBridge=new Pa(L,W,B,!F,t.codecDoAVSync,j,K,X),hh.audioBridge=t.audioBridge),F&&t.audioBridge.setRecvOnly(!1,hh.audioStream),t.audioBridge.setCodecDoAVSync(t.codecDoAVSync),r.next=48,t.audioBridge.join(!1,G,H);case 48:h&&(Y=h.websocketUrl,t._previewInitMediaWebsocket({websocketUrl:Y,workType:J.f.AUDIO_ENCODE})),f&&(z=f.websocketUrl,t._previewInitMediaWebsocket({websocketUrl:z,workType:J.f.AUDIO_DECODE})),p&&(Q=p.conId,$=p.meetingNumber,ee=p.rwgHost,te=p.webtransportPort,t._previewInitWebtransport({conId:Q,meetingNumber:$,rwgHost:ee,webtransportPort:te,workType:J.f.AUDIO_ENCODE})),v&&(re=v.conId,ie=v.meetingNumber,ae=v.rwgHost,ne=v.webtransportPort,t._previewInitWebtransport({conId:re,meetingNumber:ie,rwgHost:ae,webtransportPort:ne,workType:J.f.AUDIO_DECODE}));case 52:case"end":return r.stop()}}),r)})))()},previewUnInitRtcConnection:function(){var e=this;Q.default.add_monitor("REINITRTC");try{this.isInitAudioDataChannel=!1,this.isInitVideoDataChannel=!1,this.rtcPeerConnectionList.forEach((function(e){e&&(e.forceClose(),e=null)})),this.rtcPeerConnectionList=[]}catch(e){fh.error("clear rtcPeerConnectionList err",e)}this.audioBridge&&(this.audioBridge.destroy(!1),this.audioBridge=null,hh.audioBridge=null);var t=Z.default.SPECIAL_ID;[Z.default.localVideoEncMGR&&Z.default.localVideoEncMGR.map.get(t),Z.default.localVideoDecMGR&&Z.default.localVideoDecMGR.map.get(t),Z.default.localAudioEncMGR&&Z.default.localAudioEncMGR.map.get(t),Z.default.localAudioDecMGR&&Z.default.localAudioDecMGR.map.get(t)].forEach((function(t){t&&(t.postMessage({command:3}),t.postMessage({command:4,_id:e._id}))}))},initVideoEncode:function(e,t,r){var i=arguments,a=this;return d()(g.a.mark((function n(){var o,s,u,d,c,l,h,f,p,v,m,_,S,E,b,y,C,A,R,I,w,T,k,D,O,M,P,N,V;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=i.length>3&&void 0!==i[3]&&i[3],s=i.length>4?i[4]:void 0,u=i.length>5?i[5]:void 0,d=i.length>6?i[6]:void 0,c=i.length>7?i[7]:void 0,l=!(i.length>8&&void 0!==i[8])||i[8],h=i.length>9?i[9]:void 0,f=i.length>10?i[10]:void 0,p=i.length>11&&void 0!==i[11]&&i[11],v=i.length>12?i[12]:void 0,a.userId=r,Te(a)){n.next=13;break}return n.abrupt("return",!1);case 13:if(!a.webrtcConfig.webrtcflag){n.next=15;break}return n.abrupt("return",a._initWMSC(t,u,J.f.VIDEO_ENCODE,r));case 15:return a.isSupportImageCapture=!c&&a.isSupportImageCapture,hh.setStreamProcessAbility({isSupportImageCapture:a.isSupportImageCapture}),a.setMultiView(d),a.isSupportVideoFrameOrBitmapCapture=a.isSupportImageCapture||a.isSupportVideoTrackReader||a.isSupportMediaStreamTrackProcessor,fh("initVideoEncode"),Q.default.add_monitor("INITVE"),ya.setUserId(r),Ce.resetVideoEncode(v),n.next=25,q.default.is32bitChrome();case 25:return a.is32bitbrowser=n.sent,n.next=28,q.default.isSDKSupportMultiThread();case 28:if(n.t0=n.sent,!n.t0){n.next=31;break}n.t0=!q.default.isSelfPreviewRenderWithVideo()||q.default.isAndroidBrowser()||q.default.isMobileSafariSupportVideoFrame();case 31:return m=n.t0,q.apiSupportUtility.setIsSupportVirtualBackground(!a.isTeslaMode&&!q.default.isAndroidBrowser()&&!c&&(m||Z.default.enableVirtualBackgroundWithoutSAB)),_=q.apiSupportUtility.getIsSupportVirtualBackground(),n.next=36,q.default.isSDKSupportSIMD();case 36:if(S=n.sent,E=S&&m,b={},y=!1,C=q.default.graphicName,A=!!C&&C.includes("amd"),a.isAppleGraphic=!!C&&((C.includes("apple m1")||C.includes("apple m2"))&&!q.default.isChromeVersionHigherThan(116)),n.t2=q.default.isIphoneOrIpadBrowser()||q.default.isIpadOS()||navigator.hardwareConcurrency&&navigator.hardwareConcurrency>7,n.t2){n.next=57;break}return n.next=47,q.default.VP9MachineDetect();case 47:if(n.t5=n.sent,!n.t5){n.next=50;break}n.t5=A;case 50:if(n.t4=n.t5,!n.t4){n.next=53;break}n.t4=navigator.hardwareConcurrency;case 53:if(n.t3=n.t4,!n.t3){n.next=56;break}n.t3=navigator.hardwareConcurrency>=4;case 56:n.t2=n.t3;case 57:if(n.t1=n.t2,!n.t1){n.next=60;break}n.t1=h;case 60:if(!n.t1){n.next=62;break}y=!0;case 62:if(q.default.isIphoneOrIpadSafari()&&!q.default.isSupportVideoFrame()&&(y=!1),a.isSupportVideoShare=a.isSupportVideoShare&&S,Q.default.add_monitor("isMT: "+m),Q.default.add_monitor("isenbaleHD: "+h),Q.default.add_monitor("ENABLE720:"+y),Q.default.add_monitor("ISVSV:"+a.isSupportVideoShare),Q.default.add_monitor("graphicname: "+C),a.is32bitbrowser&&Q.default.add_monitor("is32chrome: "+a.is32bitbrowser),R=x.Z&&f,!(m&&(h||p)&&a.isSupportMediaStreamTrackProcessor&&q.default.isChromeVersionHigherThan(95)&&a.isWebCodecEncoderOnWhitelist)){n.next=82;break}if(n.t6=x.Z,!n.t6){n.next=77;break}return n.next=76,q.default.IsSupportVideoEncodeHardwareAcceleration();case 76:n.t6=n.sent;case 77:a.videoencodehardwareflag=n.t6,a.videoencodehardwareflag&&Q.default.add_monitor("VIHD:"+a.videoencodehardwareflag),f=a.videoencodehardwareflag,n.next=84;break;case 82:a.videoencodehardwareflag=!1,f=!1;case 84:return a.isSupportVideoShare?(b.workerJsFileUrl=e.vsmiworkerpath,b.workerWasmFileUrl=e.videoMSIMDWasm):E?(b.workerJsFileUrl=e.videoMSIMDWorkerPath,b.workerWasmFileUrl=e.videoMSIMDWasm):m?(b.workerJsFileUrl=e.videoMtWorkerPath,b.workerWasmFileUrl=e.videoMtWasm):S?(b.workerJsFileUrl=e.videoSIMDWorkerPath,b.workerWasmFileUrl=e.videoSIMDWasm):(b.workerJsFileUrl=e.videoWorkerPath,b.workerWasmFileUrl=e.videoWasm),b.integrityHelper=new q.IntegrityHelper(b.workerJsFileUrl,a.lateLoadedAssetsHash),v||(I=new URL(t).searchParams.get("cid"),w=new URL(t).host,q.apiSupportUtility.getIsSupportWebtransport()&&vt("https://".concat(w,":").concat(Z.default.webtransportPort,"/wc/media/").concat(u,"?type=v&cid=").concat(I)),a.previewInit({videoDataChannel:{conId:I,userid:r}})),T=1,k=!1,D=!1,(O=_&&m)&&f?(T=3,k=!0,D=!!R):O||f?(T=2,f&&(k=!0,D=!!R)):(a.isSupportVideoShare||m)&&(T=2),M=k&&D&&y,q.default.set720pcapacity(M),Q.default.add_monitor("CAPTURE720:"+M),Q.default.add_monitor("VETNum:"+T),q.default.isAndroidBrowser()&&!q.default.isMTRAndroidWithSAB()?a.platformType=x.X.ANDROID:q.default.isIphoneOrIpadBrowser()&&(a.platformType=x.X.IPHONE),D=D&&!a.isAppleGraphic,n.next=100,a.onRendererTypeSelected();case 100:return P={log:o,confId:r,meetingid:s,meetingnumb:u,videodecodethreadnumb:d,isSupportMultiThread:m,videoencodethreadnumb:T,qoson:l,isSupportVirtualBackground:_,isSupportWebCodecEnocde:k,initWebCodecFlag:D,is360penablehw:p,enable720p:y,platformType:a.platformType,rendererType:a.rendererType,IsRenderInWorker:a.checkIsRenderInWorker()&&!q.apiSupportUtility.getIsRenderSelfVideoInEncodeWorker(!0)},n.t7=console,n.next=104,q.default.VP9MachineDetect();case 104:if(n.t8=n.sent,n.t9=q.default.isAMDGraphic(),n.t10=q.default.isGraphicShouldUseHardwareAccelerationDecode(),n.t11="isenbaleHD:"+h+" enable720p?:",n.t12=y,n.t13=M,n.t7.log.call(n.t7,"VP9?:",n.t8,"AMD?:",n.t9,"AMDdecodecheck:",n.t10,n.t11,n.t12,"capacityfor720:",n.t13),lt(t,P),N=new vi({interval:1e4,tag:"WCL_M,VERB",reportcallback:function(e,t,r,i){Q.default.add_monitor("".concat(e,",").concat(t,",").concat(r,",").concat(i))}}),Te(a)){n.next=115;break}return n.abrupt("return",!1);case 115:return n.next=117,Ae(b,a);case 117:if(Z.default.extVBPort&&a.addVbReceiver(Z.default.extVBPort),!v&&!a.isDestroy){n.next=120;break}return n.abrupt("return");case 120:return V=a,a.allpromises.push(Z.default.videoInitInstance.initSuccessPromise),n.next=124,Z.default.videoInitInstance.initSuccessPromise.then((function(e){if(!Te(V))return!1;if(e&&a.bVideoEncodeUsingSAB)if(m)z.a.on("VIDEO_ENCODE_PTR",(function(e,t){if(!V.isDestroy){var r=new ia(t.data.buffer,void 0,void 0,!0,t.offset,t.length,t.data);a.videoEncodeRingbufferConsumer=new aa(r,a.consumeVideoEncodeRingbuffer.bind(a),N.timeoutReport.bind(N)),a.bVideoEncodeMainThreadConsumerIntervalEnable&&a.videoEncodeRingbufferConsumer&&a.videoEncodeRingbufferConsumer.consume(20)}})),Wr(J.f.VIDEO_ENCODE,{bVideoEncodeMainThreadConsumerIntervalEnable:a.bVideoEncodeMainThreadConsumerIntervalEnable},"VIDEO_ENCODE_SAB",!1,!0);else if(!a.videoEncodeRingbufferConsumer){var t=ia.getStorageForCapacity(),r=new ia(t,void 0,void 0,!0);a.videoEncodeRingbufferConsumer=new aa(r,a.consumeVideoEncodeRingbuffer.bind(a),N.timeoutReport.bind(N)),a.bVideoEncodeMainThreadConsumerIntervalEnable&&a.videoEncodeRingbufferConsumer&&a.videoEncodeRingbufferConsumer.consume(20),Wr(J.f.VIDEO_ENCODE,{buffer:t,bVideoEncodeMainThreadConsumerIntervalEnable:a.bVideoEncodeMainThreadConsumerIntervalEnable},"VIDEO_ENCODE_SAB",!1,!0)}return e})).then((function(e){return Q.default.add_monitor("INITVERET-".concat(V._id,"-").concat(e&&!V.isDestroy)),!!Te(V)&&(a.init_Notify_APPUI(e,J.f.VIDEO_ENCODE),ye.subscribeMessage(ye.nameMap.INIT_VIDEO_ENCODE_SUCCESS),ve(J.f.VIDEO_ENCODE),e)}));case 124:return n.abrupt("return",n.sent);case 125:case"end":return n.stop()}}),n)})))()},_initWMSC:function(e,t,r,i){var a=this;Object(q.getWMSCModule)().then((function(n){var o=n.WMSCManager,s=function(){var e,t=(e={},v()(e,J.f.VIDEO_ENCODE,ye.nameMap.INIT_VIDEO_ENCODE_SUCCESS),v()(e,J.f.VIDEO_DECODE,ye.nameMap.INIT_VIDEO_DECODE_SUCCESS),e);a.init_Notify_APPUI(!0,r),ye.subscribeMessage(t[r])};if(!e||!t||!i)return!1;if(!a.wmscManager){var u=new URL(e).host,d=new URL(e).searchParams.get("cid"),c="wss://".concat(u,"/wc/media/").concat(t,"?type=v&cid=").concat(d,"&mode=16");a.wmscManager=new o({webRTCWebSocketUrl:c,confId:d,nodeId:i,useSimulcast:a.webrtcConfig.useSimulcast,HDVideo:a.webrtcConfig.videoHD})}return a.wmscManager.isJoinRWGSuccess?s():a.wmscManager.waitJoinRWGSuccess().then((function(){s()}))})).catch((function(e){console.error("import wmsc failed: ",e)}))},initVideoDecode:function(e,t,r){var i=arguments,a=this;return d()(g.a.mark((function n(){var o,s,u,c,l,h,f,p,v,m,_,S,E,b,y,C,A;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=i.length>3&&void 0!==i[3]&&i[3],s=i.length>4?i[4]:void 0,u=i.length>5?i[5]:void 0,c=i.length>6?i[6]:void 0,l=i.length>7&&void 0!==i[7]&&i[7],h=!(i.length>8&&void 0!==i[8])||i[8],a.userId=r,q.default.setMaxCountRender(c),Te(a)){n.next=10;break}return n.abrupt("return",!1);case 10:if(!a.webrtcConfig.webrtcflag){n.next=12;break}return n.abrupt("return",a._initWMSC(t,u,J.f.VIDEO_DECODE,r));case 12:return Ce.resetVideoDecode(!1),fh("initVideoDecode"),Q.default.add_monitor("INITVD"),a.setMultiView(c),c>1&&!Z.default.enableMultiDecodeVideoWithoutSAB&&(Object(q.IsSupportWebGLOffscreenCanvas)()||q.default.isWebGL2Supported(a.isWebGL2Enabled))?a.codecDoAVSync=!0:a.codecDoAVSync=!1,n.next=19,q.default.is32bitChrome();case 19:return a.is32bitbrowser=n.sent,n.next=22,q.default.isSDKSupportMultiThread();case 22:if(n.t0=n.sent,!n.t0){n.next=25;break}n.t0=!q.default.isSelfPreviewRenderWithVideo()||q.default.isAndroidBrowser()||q.default.isMobileSafariSupportVideoFrame();case 25:return f=n.t0,n.next=28,q.default.isSDKSupportSIMD();case 28:if(p=n.sent,v=p&&f,m={},a.isEnableVideoDecodeHardWareThread=q.default.isChromeVersionHigherThan(95),!l||!a.isEnableVideoDecodeHardWareThread){n.next=37;break}return n.next=35,q.default.IsSupportVideoDecodeHardwareAcceleration();case 35:a.videodecodehardwareflag=n.sent,l=a.videodecodehardwareflag;case 37:return a.isSupportVideoShare=a.isSupportVideoShare&&p,Q.default.add_monitor("SupportWebCodecDecode:".concat(l)),a.isSupportVideoShare?(m.workerJsFileUrl=e.vsmiworkerpath,m.workerWasmFileUrl=e.videoMSIMDWasm):v?(m.workerJsFileUrl=e.videoMSIMDWorkerPath,m.workerWasmFileUrl=e.videoMSIMDWasm):f?(m.workerJsFileUrl=e.videoMtWorkerPath,m.workerWasmFileUrl=e.videoMtWasm):p?(m.workerJsFileUrl=e.videoSIMDWorkerPath,m.workerWasmFileUrl=e.videoSIMDWasm):(m.workerJsFileUrl=e.videoWorkerPath,m.workerWasmFileUrl=e.videoWasm),m.integrityHelper=new q.IntegrityHelper(m.workerJsFileUrl,a.lateLoadedAssetsHash),_=new URL(t).searchParams.get("cid"),S=new URL(t).host,q.apiSupportUtility.getIsSupportWebtransport()&&vt("https://".concat(S,":").concat(Z.default.webtransportPort,"/wc/media/").concat(u,"?type=v&cid=").concat(_)),a.previewInit({videoDataChannel:{conId:_,userid:r}}),E=l&&a.isEnableVideoDecodeHardWareThread&&c>1&&navigator.hardwareConcurrency&&navigator.hardwareConcurrency>=4,q.default.setsub1080pcapacity(E),b=a.platformType,q.default.isAndroidBrowser()&&!q.default.isMTRAndroidWithSAB()?b=x.X.ANDROID:q.default.isIphoneOrIpadBrowser()&&(b=x.X.IPHONE),Q.default.add_monitor("deviceType:".concat(b)),n.next=52,a.onRendererTypeSelected();case 52:if(y={log:o,confId:r,meetingid:s,meetingnumb:u,videodecodethreadnumb:c,isFirefox:q.default.browser.isFirefox,isSupportMultiThread:f,isSupportVideoTrackReader:a.isSupportVideoTrackReader,isSupportOffscreenCanvas:a.isSupportOffscreenCanvas,isenablehw:l,isEnableVideoDecodeHardWareThread:a.isEnableVideoDecodeHardWareThread,qoson:h,isEnableHardWareThread:a.isEnableHardWareThread,isTeslaMode:a.isTeslaMode,platformType:b,rendererType:a.rendererType,isWebCodecDecoderOnWhitelist:a.isWebCodecDecoderOnWhitelist},lt(t,y),a.bVideoDecodeUsingSAB&&(f?z.a.on("VIDEO_DECODE_PTR",(function(e,t){a.videoDecodeRingBuffer=new ia(t.data.buffer,void 0,void 0,void 0,t.offset,t.length,t.data)})):a.videoDecodeRingBuffer||(C=ia.getStorageForCapacity(),a.videoDecodeRingBuffer=new ia(C))),Te(a)){n.next=57;break}return n.abrupt("return",!1);case 57:return n.next=59,ke(m,a);case 59:if(Te(a)){n.next=61;break}return n.abrupt("return",!1);case 61:return A=a,a.allpromises.push(Z.default.videoDecInitInstance.initSuccessPromise),n.next=65,Z.default.videoDecInitInstance.initSuccessPromise.then(function(){var e=d()(g.a.mark((function e(t){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Te(A)){e.next=2;break}return e.abrupt("return",!1);case 2:if(!t||!a.bVideoDecodeUsingSAB){e.next=8;break}return e.next=5,Wr(J.f.VIDEO_DECODE,f?null:C,"VIDEO_DECODE_SAB_FROM_DATACHANNEL",!1,!0);case 5:(r=e.sent)||(a.videoDecodeRingBuffer=null),fh("videoDatachannelSAB",r);case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){return Q.default.add_monitor("INITVDRET-".concat(A._id,"-").concat(e&&!A.isDestroy)),!!Te(A)&&(a.init_Notify_APPUI(e,J.f.VIDEO_DECODE),ye.subscribeMessage(ye.nameMap.INIT_VIDEO_DECODE_SUCCESS),ve(J.f.VIDEO_DECODE),e)}));case 65:return n.abrupt("return",n.sent);case 66:case"end":return n.stop()}}),n)})))()},initAudioEncode:function(e,t,r){var i=arguments,a=this;return d()(g.a.mark((function n(){var o,s,u,d,c,l,h,f,p,v,m,_,S;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=i.length>3&&void 0!==i[3]&&i[3],s=i.length>4?i[4]:void 0,u=i.length>5?i[5]:void 0,d=i.length>6?i[6]:void 0,c=!(i.length>7&&void 0!==i[7])||i[7],l=i.length>8?i[8]:void 0,a.userId=r,fh("initAudioEncode"),Te(a)){n.next=10;break}return n.abrupt("return",!1);case 10:return Q.default.add_monitor("INITAE"),ya.setUserId(r),Ce.resetAudioEncode(l),n.next=15,q.default.is32bitChrome();case 15:return a.is32bitbrowser=n.sent,h={},n.next=19,q.default.isSDKSupportSIMD();case 19:if(n.sent?(h.workerJsFileUrl=e.audioSIMDWorkletPath,h.workerWasmFileUrl=e.audioSIMDWasm):(h.workerJsFileUrl=e.audioWorkerPath,h.workerWasmFileUrl=e.audioWasm),h.integrityHelper=new q.IntegrityHelper(h.workerJsFileUrl,a.lateLoadedAssetsHash),l||(f=new URL(t).searchParams.get("cid"),p=new URL(t).host,q.apiSupportUtility.getIsSupportWebtransport()&&ft("https://".concat(p,":").concat(Z.default.webtransportPort,"/wc/media/").concat(u,"?type=a&cid=").concat(f)),a.previewInit({audioDataChannel:{conId:f,userid:r}})),a.audioCtx||(a.audioCtx=Object(q.createAudioContext)("Main")),v={sampleRate:a.audioCtx.sampleRate,userid:r,log:o,meetingid:s,meetingnumb:u,videodecodethreadnumb:d,qoson:c},ct(t,v),m=null,_=1500,!a.bAudioEncodeUsingSAB||l||a.audioEncodeRingBufferConsumer||(m=ia.getStorageForCapacity(100,_),a.audioEncodeRingBufferConsumer=new aa(new ia(m,_,void 0,!0),a.audioEncodeRingBufferConsumerCallback.bind(a))),Te(a)){n.next=31;break}return n.abrupt("return",!1);case 31:return n.next=33,Oe(h,a);case 33:if(!l&&!a.isDestroy){n.next=35;break}return n.abrupt("return");case 35:return S=a,a.allpromises.push(Z.default.audioEncodeInitInstance.initSuccessPromise),n.next=39,Z.default.audioEncodeInitInstance.initSuccessPromise.then((function(e){return!S.isDestroy&&(e&&null!==a.bAudioDatachannelOpen&&Wr(J.f.AUDIO_ENCODE,{isDataChannelOpen:a.bAudioDatachannelOpen},8),e&&m&&Wr(J.f.AUDIO_ENCODE,{buffer:m,bytesPerEle:_,bAudioEncodeMainThreadConsumerIntervalEnable:!1},"audioEncodeSAB",!1,!0),e)})).then((function(e){return Q.default.add_monitor("INITAERET-".concat(S._id,"-").concat(e&&!S.isDestroy)),!!Te(S)&&(a.init_Notify_APPUI(e,J.f.AUDIO_ENCODE),ve(J.f.AUDIO_ENCODE),e)}));case 39:return n.abrupt("return",n.sent);case 40:case"end":return n.stop()}}),n)})))()},initAudioDecode:function(e,t,r){var i=arguments,a=this;return d()(g.a.mark((function n(){var o,s,u,c,l,h,f,p,v,m,_,S,E;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=i.length>3&&void 0!==i[3]&&i[3],s=i.length>4?i[4]:void 0,u=i.length>5?i[5]:void 0,c=i.length>6?i[6]:void 0,l=!(i.length>7&&void 0!==i[7])||i[7],a.userId=r,Te(a)){n.next=8;break}return n.abrupt("return",!1);case 8:return Ce.resetAudioDecode(!1),fh("initAudioDecode"),ya.setUserId(r),Q.default.add_monitor("INITAD"),n.next=14,q.default.is32bitChrome();case 14:return a.is32bitbrowser=n.sent,h=new URL(t).searchParams.get("cid"),f=new URL(t).host,(p={}).workerJsFileUrl=e.audioWorkerPath,p.workerWasmFileUrl=e.audioWasm,q.apiSupportUtility.getIsSupportWebtransport()&&ft("https://".concat(f,":").concat(Z.default.webtransportPort,"/wc/media/").concat(u,"?type=a&cid=").concat(h)),a.previewInit({audioDataChannel:{conId:h,userid:r}}),m=1500,a.bAudioDecodeUsingSAB&&!a.audioDecodeRingBuffer&&(v=ia.getStorageForCapacity(100,m),a.audioDecodeRingBuffer=new ia(v,m)),n.next=26,q.default.isSDKSupportMultiThread();case 26:return _=n.sent,n.next=29,q.default.isSDKSupportSIMD();case 29:if(n.sent?(p.workerJsFileUrl=e.audioSIMDWorkletPath,p.workerWasmFileUrl=e.audioSIMDWasm):(p.workerJsFileUrl=e.audioWorkerPath,p.workerWasmFileUrl=e.audioWasm),p.integrityHelper=new q.IntegrityHelper(p.workerJsFileUrl,a.lateLoadedAssetsHash),a.audioCtx||(a.audioCtx=Object(q.createAudioContext)("Main")),S={sampleRate:a.audioCtx.sampleRate,userid:r,log:o,meetingid:s,meetingnumb:u,videodecodethreadnumb:c,isSupportMultiThread:_,qoson:l},ct(t,S),Te(a)){n.next=37;break}return n.abrupt("return",!1);case 37:return n.next=39,xe(p,a);case 39:if(Te(a)){n.next=41;break}return n.abrupt("return",!1);case 41:return E=a,a.allpromises.push(Z.default.audioDecInitInstance.initSuccessPromise),n.next=45,Z.default.audioDecInitInstance.initSuccessPromise.then(function(){var e=d()(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!E.isDestroy){e.next=2;break}return e.abrupt("return",!1);case 2:if(Q.default.add_monitor("ADIP"+!!t),!t||!v){e.next=8;break}return e.next=6,Wr(J.f.AUDIO_DECODE,{buffer:v,bytesPerEle:m},"audioDecodeSAB",!1,!0);case 6:e.sent||(a.audioDecodeRingBuffer=null);case 8:return t&&null!==a.bAudioDatachannelOpen&&Wr(J.f.AUDIO_DECODE,{isDataChannelOpen:a.bAudioDatachannelOpen},8),e.abrupt("return",t);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){return Q.default.add_monitor("INITADRET-".concat(E._id,"-").concat(e&&!E.isDestroy)),!!Te(E)&&(a.init_Notify_APPUI(e,J.f.AUDIO_DECODE),ve(J.f.AUDIO_DECODE),e)}));case 45:return n.abrupt("return",n.sent);case 46:case"end":return n.stop()}}),n)})))()},initSharingDecode:function(e,t,r){var i=arguments,a=this;return d()(g.a.mark((function n(){var o,s,u,d,c,l,h,f,p;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=i.length>3&&void 0!==i[3]&&i[3],s=i.length>4?i[4]:void 0,u=i.length>5?i[5]:void 0,i.length>6?i[6]:void 0,a.userId=r,Te(a)){n.next=7;break}return n.abrupt("return",!1);case 7:return Q.default.add_monitor("INITSD"),a.recordSharingParamInfo(),fh("initSharingDecode"),n.next=12,q.default.isSDKSupportSIMD();case 12:if(d=n.sent,a.isSupportVideoShare=a.isSupportVideoShare&&d,!a.isSupportVideoShare){n.next=22;break}return a.allpromises.push(Z.default.sharingDecInitInstance.socketSuccessPromise),c=a,n.next=19,Z.default.sharingDecInitInstance.handlerSuccessPromise;case 19:return n.next=21,Z.default.sharingDecInitInstance.socketSuccessPromise.then((function(e){return Q.default.add_monitor("INITSDRET-".concat(c._id,"-").concat(e&&!c.isDestroy)),!!Te(c)&&(a.init_Notify_APPUI(e,J.f.SHARING_DECODE),ve(J.f.SHARING_DECODE),e)}));case 21:return n.abrupt("return",n.sent);case 22:return Z.default.monitorCid=new URL(t).searchParams.get("cid"),n.next=25,q.default.is32bitChrome();case 25:return a.is32bitbrowser=n.sent,n.next=28,q.default.isSDKSupportMultiThread();case 28:return l=n.sent,n.next=31,a.onRendererTypeSelected();case 31:if(h={},d&&l?(h.workerJsFileUrl=e.sharingMSIMDWorkerPath,h.workerWasmFileUrl=e.videoMSIMDWasm):l?(h.workerJsFileUrl=e.sharingMtWorkerPath,h.workerWasmFileUrl=e.videoMtWasm):d?(h.workerJsFileUrl=e.sharingSIMDWorkerPath,h.workerWasmFileUrl=e.videoSIMDWasm):(h.workerJsFileUrl=e.sharingWorkerPath,h.workerWasmFileUrl=e.videoWasm),h.integrityHelper=new q.IntegrityHelper(h.workerJsFileUrl,a.lateLoadedAssetsHash),f={log:o,userid:r,meetingid:s,meetingnumb:u,isSupportMultiThread:l,rendererType:a.rendererType,isWebCodecDecoderOnWhitelist:a.isWebCodecDecoderOnWhitelist},dt(t,f),a.isSupportVideoShare||z.a.on("SHARING_DECODE_PTR",(function(e,t){a.sharingDecodeRingBuffer=new ia(t.data.buffer,void 0,void 0,void 0,t.offset,t.length,t.data)})),Te(a)){n.next=40;break}return n.abrupt("return",!1);case 40:return n.next=42,Ne(h,a);case 42:if(Te(a)){n.next=44;break}return n.abrupt("return",!1);case 44:return a.allpromises.push(Z.default.sharingDecInitInstance.initSuccessPromise),p=a,n.next=48,Z.default.sharingDecInitInstance.initSuccessPromise.then((function(e){return Q.default.add_monitor("INITSDRET-".concat(p._id,"-").concat(e&&!p.isDestroy)),!!Te(p)&&(a.init_Notify_APPUI(e,J.f.SHARING_DECODE),ve(J.f.SHARING_DECODE),e)}));case 48:return n.abrupt("return",n.sent);case 49:case"end":return n.stop()}}),n)})))()},initSharingEncode:function(e,t,r){var i=arguments,a=this;return d()(g.a.mark((function n(){var o,s,u,d,c,l,h,f,p;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=i.length>3&&void 0!==i[3]&&i[3],s=i.length>4?i[4]:void 0,u=i.length>5?i[5]:void 0,i.length>6?i[6]:void 0,a.userId=r,Te(a)){n.next=7;break}return n.abrupt("return",!1);case 7:return fh("initSharingEncode"),n.next=10,q.default.isSDKSupportSIMD();case 10:if(d=n.sent,a.isSupportVideoShare=a.isSupportVideoShare&&d,!a.isSupportVideoShare){n.next=20;break}return a.allpromises.push(Z.default.sharingEncInitInstance.socketSuccessPromise),c=a,n.next=17,Z.default.sharingEncInitInstance.handlerSuccessPromise;case 17:return n.next=19,Z.default.sharingEncInitInstance.socketSuccessPromise.then((function(e){return Q.default.add_monitor("INITSERET-".concat(c._id,"-").concat(e&&!c.isDestroy)),!!Te(c)&&(a.init_Notify_APPUI(e,J.f.SHARING_ENCODE),ve(J.f.SHARING_ENCODE),e)}));case 19:return n.abrupt("return",n.sent);case 20:return Q.default.add_monitor("INITSE"),n.next=23,q.default.is32bitChrome();case 23:return a.is32bitbrowser=n.sent,n.next=26,q.default.isSDKSupportMultiThread();case 26:return l=n.sent,n.next=29,a.onRendererTypeSelected();case 29:if(h={},d&&l?(h.workerJsFileUrl=e.sharingMSIMDWorkerPath,h.workerWasmFileUrl=e.videoMSIMDWasm):l?(h.workerJsFileUrl=e.sharingMtWorkerPath,h.workerWasmFileUrl=e.videoMtWasm):d?(h.workerJsFileUrl=e.sharingSIMDWorkerPath,h.workerWasmFileUrl=e.videoSIMDWasm):(h.workerJsFileUrl=e.sharingWorkerPath,h.workerWasmFileUrl=e.videoWasm),h.integrityHelper=new q.IntegrityHelper(h.workerJsFileUrl,a.lateLoadedAssetsHash),Z.default.monitorCid=new URL(t).searchParams.get("cid"),f={log:o,userid:r,meetingid:s,meetingnumb:u,isSupportMultiThread:l,rendererType:a.rendererType},dt(t,f),Te(a)){n.next=38;break}return n.abrupt("return",!1);case 38:return n.next=40,Ue(h,a);case 40:if(Te(a)){n.next=42;break}return n.abrupt("return",!1);case 42:return p=a,a.allpromises.push(Z.default.sharingEncInitInstance.initSuccessPromise),n.next=46,Z.default.sharingEncInitInstance.initSuccessPromise.then((function(e){return Q.default.add_monitor("INITSERET-".concat(p._id,"-").concat(e&&!p.isDestroy)),!!Te(p)&&(a.init_Notify_APPUI(e,J.f.SHARING_ENCODE),ve(J.f.SHARING_ENCODE),e)}));case 46:return n.abrupt("return",n.sent);case 47:case"end":return n.stop()}}),n)})))()},JsMediaSDK_UnInit:function(){br();this.videoRenderArray.length&&this.videoRenderArray.forEach((function(e){e.display&&(e.display.cleanup(),e.display=null)})),Z.default._callbackList=[],Z.default._Notify_APPUI=null},StartAudioMediaCapture:function(){var e,t,r;hh.startCaptureAudio({audioConstraints:this.audioCapture?{audioSource:this.audioCapture?this.audioCapture.AudioSelectValue:null,enableOriginalSound:"originalSound"===(null===(e=this.audioCapture)||void 0===e||null===(e=e.audioProfile)||void 0===e?void 0:e.currentSelect),enableStereo:"originalSound"===(null===(t=this.audioCapture)||void 0===t||null===(t=t.audioProfile)||void 0===t?void 0:t.currentSelect)&&(null===(r=this.audioCapture)||void 0===r||null===(r=r.audioProfile)||void 0===r||null===(r=r.originalSound)||void 0===r?void 0:r.stereo),isSupportBrowserAec:this.isSupportBrowserAec,disableAudioAGC:this.disableAudioAGC,disableNoiseSuppression:this.disableNoiseSuppression}:null,successHandler:this.handleAudioCapture.bind(this),errorHandler:this.handleAudioError.bind(this)})},StartDesktopMediaCapture:(Dh=d()(g.a.mark((function e(){var t,r,i,a,n,o,u,d,c,l,h,f,p,v,m,_,S,E;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.desktopSharingValue.audioOnly){e.next=13;break}return e.prev=2,e.next=5,navigator.mediaDevices.getUserMedia({audio:{deviceId:this.desktopSharingValue.deviceId?{exact:this.desktopSharingValue.deviceId}:q.default.browser.isChrome?{exact:"default"}:void 0,echoCancellation:this.desktopSharingValue.echoCancellation,noiseSuppression:this.desktopSharingValue.noiseSuppression,autoGainControl:this.desktopSharingValue.autoGainControl,sampleRate:this.desktopSharingValue.sampleRate||48e3}});case 5:t=e.sent,this.handleDesktopCapture(t,!0),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),this.handleCaptureError(e.t0);case 12:return e.abrupt("return");case 13:if(!this.desktopSharingValue.sourceId){e.next=26;break}return r=this.desktopSharingValue.sourceId,e.prev=15,e.next=18,navigator.mediaDevices.getUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r}}});case 18:i=e.sent,this.handleDesktopCapture(i),e.next=25;break;case 22:e.prev=22,e.t1=e.catch(15),this.handleCaptureError(e.t1);case 25:return e.abrupt("return");case 26:if(a=this.handleDesktopCapture.bind(this),n=this.handleCaptureError.bind(this),!this.desktopSharingValue.share2ndCamera){e.next=38;break}return o=this.desktopSharingValue.share2ndCameraParams||{},u=o.VideoSelectValue?{exact:o.VideoSelectValue}:void 0,d=o.frameRate?{ideal:o.frameRate}:void 0,c={deviceId:u,width:o.width||640,height:o.height||360,frameRate:d},l=!1,o.AudioSelectValue&&(l={deviceId:{exact:o.AudioSelectValue}}),h={video:c,audio:l},navigator.mediaDevices.getUserMedia(h).then(a,n),e.abrupt("return");case 38:f=this.desktopSharingValue.videoParams,p=navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints(),v=p&&!!p.displaySurface&&f&&f.displaySurface,navigator.mediaDevices.getDisplayMedia&&(m=!(!q.default.isSupportSharedArrayBuffer()||!this.desktopSharingValue.showShareAudioOption)&&{autoGainControl:!1,noiseSuppression:!1,echoCancellation:!q.default.isSupportSharingStereo()},_=this.desktopSharingValue.videoParams||!0,v&&("object"===s()(_)?_.displaySurface=f.displaySurface:"boolean"==typeof _&&(_={displaySurface:f.displaySurface})),S=this.desktopSharingValue.otherParams,E=dh({video:_,audio:m},S),navigator.mediaDevices.getDisplayMedia(E).then(a,n));case 42:case"end":return e.stop()}}),e,this,[[2,9],[15,22]])}))),function(){return Dh.apply(this,arguments)}),StartVideoMediaCapture:(kh=d()(g.a.mark((function e(){var t,r,i,a=this,n=arguments;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.length>0&&void 0!==n[0]&&n[0],r=this.videoCaptureValue,i={encode:this.isStartVideoCapture,preview:this.isMaskSettingOn||this.isVBSettingOn},Q.default.add_monitor("STARTVIDEOMEDIA:".concat(i.encode,":").concat(i.preview)),hh.startCaptureVideo({videoConstraints:this.videoCaptureValue?{videoSource:this.videoCaptureValue.VideoSelectValue,usingFacingMode:this.videoCaptureValue.usingFacingMode,width:this.videoCaptureValue.width,height:this.videoCaptureValue.height,pan:this.videoCaptureValue.pan,tilt:this.videoCaptureValue.tilt,zoom:this.videoCaptureValue.zoom,fps:this.videoCaptureValue.fps}:null,timeout:this.videoCaptureValue?this.videoCaptureValue.timeout:null,successHandler:function(){var e=d()(g.a.mark((function e(n){var o,s,u,d,c,l,h;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.videoCaptureValue=r,hh.videoConstraints&&(o=hh.videoConstraints,s=o.width,u=o.height,s&&u&&(a.videoCaptureWidth=s instanceof Object?s.ideal:s,a.videoCaptureHeight=u instanceof Object?u.ideal:u)),d=!1,e.prev=3,!a.webrtcConfig.webrtcflag){e.next=20;break}if(l=null===(c=n.getVideoTracks()[0])||void 0===c?void 0:c.getSettings(),!a.wmscManager||!l){e.next=17;break}return e.next=10,a.wmscManager.sendMessageToWMSCAsync({type:"VIDEO_STREAMS",streams:[{stream:n,width:l.width,height:l.height}]});case 10:return t&&Z.default.Notify_APPUI(M.MOBILE_CAPTURE_DEVICE_CHANGE,a.userId),a.wmscManager.selfVideoDom&&(a.wmscManager.selfVideoDom.srcObject=n,a.wmscManager.playSelfVideo("streamCaptureSuccess")),e.next=14,a.handleWebrtcVideoCapture(n);case 14:d=!0,e.next=18;break;case 17:Q.default.add_monitor("webrtc video get settings false or wmsc not init: ".concat(!!a.wmscManager));case 18:e.next=23;break;case 20:return e.next=22,a.handleWasmVideoCapture(n,i);case 22:d=!0;case 23:Q.default.add_monitor("STARTVIDEORET:".concat(d)),d&&(Q.default.add_monitor("VCMS"),Z.default.monitorVideoCapture=!0,(h=n.getVideoTracks()[0]).onended=function(){Z.default.Notify_APPUI_SAFE(M.VIDEO_STREAM_FAILED),Q.default.add_monitor("VTRS:"+h.readyState),Y.default.error("video media track ended")},h.onmute=function(){Q.default.add_monitor("VTMS:"+h.muted)},h.onunmute=function(){Q.default.add_monitor("VTMS:"+h.muted),a.webrtcConfig.webrtcflag&&a.wmscManager&&a.wmscManager.playAllVideoTag("videoTrackUnmute")}),e.next=30;break;case 27:e.prev=27,e.t0=e.catch(3),a.handleVideoError(e.t0);case 30:case"end":return e.stop()}}),e,null,[[3,27]])})));return function(t){return e.apply(this,arguments)}}(),errorHandler:function(e){a.handleVideoError(e)}});case 5:case"end":return e.stop()}}),e,this)}))),function(){return kh.apply(this,arguments)}),Start_Audio_Play:function(){this.audioPlay=!0,Z.default.AudioNode&&Z.default.AudioNode.postCMD("startPlayAudio",null),ge(!0)},Stop_Audio_Play:function(){ge(!1),Z.default.AudioNode&&Z.default.AudioNode.postCMD("stopPlayAudio",null)},Remove_Audio_Play:function(){ge(!1),this.audioPlay=!1,Z.default.AudioNode&&Z.default.AudioNode.postCMD("stopPlayAudio",null)},Meeting_Fail_Over:function(e,t){Lt(e,t)},Start_Desktop_Audio_Capture:function(){if(this.audioBridge)this.audioBridge.publishStream(this.desktopSharingMediaStram,!0);else{var e=this.desktopSharingMediaStram.getAudioTracks();if(this.desktopSharingMediaStram&&e){var t=this.sharingAudioCtx.createMediaStreamSource(this.desktopSharingMediaStram);return this.sharingWebrtcAudioNode=t,this.isSharingCaptureNodeConnect||(this.sharingWebrtcAudioNode.connect(Z.default.SharingAudioNode),Z.default.SharingAudioNode.postCMD("StartCaptureAudio",null),this.isSharingCaptureNodeConnect=!0),void(this.screenShareAudioPreviewElement&&this.screenShareAudioPreviewElement.play().catch((function(e){Y.default.error("Screenshare audio preview play failed",e)})))}}},Start_Audio_Capture:function(){if(hh.shouldCaptureAudio())this.StartAudioMediaCapture();else{var e=hh.getAudioCapabilities().deviceId;if(this.audioInputLevel)return this.audioInputLevel.setAudioStream(hh.audioStream),this.captureAudioMuted||this.audioInputLevel.start(),void(Z.default.ComputerAudioStatus===J.a.ComputerAudio_Connecting&&(Z.default.ComputerAudioStatus=J.a.ComputerAudio_Connected,Z.default.Notify_APPUI(M.JOIN_COMPUTER_AUDIO_COMPLETE,e)));if(this.audioBridge)return void this.audioBridge.publishStream(hh.audioStream).then((function(t){Z.default.ComputerAudioStatus===J.a.ComputerAudio_Connecting&&(Z.default.ComputerAudioStatus=J.a.ComputerAudio_Connected,Z.default.Notify_APPUI(M.JOIN_COMPUTER_AUDIO_COMPLETE,e))}));if(Z.default.AudioNode){this.webrtcAudioNode&&(this.webrtcAudioNode.disconnect(Z.default.AudioNode),this.webrtcAudioNode=null);var t=this.audioCtx.createMediaStreamSource(hh.audioStream);this.webrtcAudioNode=t,this.webrtcAudioNode.connect(Z.default.AudioNode),Z.default.AudioNode.postCMD("StartCaptureAudio",null),sr({command:131,value:!0}),this.isCaputureNodeConnect=!0}Z.default.ComputerAudioStatus===J.a.ComputerAudio_Connecting&&(Z.default.ComputerAudioStatus=J.a.ComputerAudio_Connected,Z.default.Notify_APPUI(M.JOIN_COMPUTER_AUDIO_COMPLETE,e))}},Stop_Audio_Capture:function(){jt(Z.default.SPECIAL_ID,M.AUDIO_STOP)},_videoloadedmetadata:function(e){var t,r,i,a=null;if(e?(a=e.target||this.videoCaptureValue.videoCtrl,Q.default.add_monitor("VIDEOLOADEDMETADATA:".concat(a==this.videoCaptureValue.videoCtrl)),this.videoloadedmetadatahandle&&a&&a.removeEventListener("loadedmetadata",this.videoloadedmetadatahandle),this.videoloadedmetadatahandle=null):Q.default.add_monitor("VIDEOLOADEDMETADATA:".concat(!0)),this.isDestroy)Y.default.error("Video capture loadedmetadata JsMediaSDK instance destroyed");else if(this.isVideoCaptureLoadedmetadata&&(Y.default.warn("Video capture isVideoCaptureLoadedmetadata is true"),a&&a!=this.videoCaptureValue.videoCtrl))Y.default.error("Video capture reLoaded metadata");else{var n;if(this.isVideoCaptureLoadedmetadata=!0,this.isSupportVideoFrameOrBitmapCapture)r=this.videoCaptureWidth,i=this.videoCaptureHeight;else r=this.videoCaptureValue.videoCtrl.videoWidth,i=this.videoCaptureValue.videoCtrl.videoHeight,this.videoCaptureWidth=r,this.videoCaptureHeight=i,null===(n=this.captureVideoOutputCanvasDomList)||void 0===n||n.forEach((function(e){e.width=r,e.height=i}));null===(t=this.VideoRenderObj)||void 0===t||t.Set_LocalVideo_SSRC(this.videoCaptureValue.ssid),Zt({command:"startVideoEncode",width:this.videoCaptureWidth,height:this.videoCaptureHeight,fps:this.videoCaptureValue.fps,ssid:this.videoCaptureValue.ssid,mtu_size:this.mtu_size,isSupportImageCapture:this.isSupportImageCapture,isSupportVideoTrackReader:this.isSupportVideoTrackReader,isSupportMediaStreamTrackProcessor:this.isSupportMediaStreamTrackProcessor,isSupport2DCanvasDrawFrame:this.isSupport2DCanvasDrawFrame,disableOriginalRatio:!!this.videoCaptureValue.disableOriginalRatio}),tr({command:"startVideoEncode",ssid:this.videoCaptureValue.ssid,disableOriginalRatio:!!this.videoCaptureValue.disableOriginalRatio}),this.isSupportVideoShare||wr({command:"startVideoEncode"}),Zt({command:"updateVideoPara",width:this.videoCaptureWidth,height:this.videoCaptureHeight,fps:this.GetVideoCaptureFps()}),this.lastRealRect.left=0,this.lastRealRect.top=0,this.lastRealRect.width=this.videoCaptureWidth,this.lastRealRect.height=this.videoCaptureHeight,Z.default.monitorVideoUserID=this.videoCaptureValue.ssid,Z.default.Notify_APPUI(M.CURRENT_CAPTURE_VIDEO_WIDTH_HEIGHT,{width:r,height:i})}},Start_Video_Capture:function(){var e=this;if(!hh.shouldCaptureVideo()){var t=this;return new Promise((function(r,i){if(t.isSupportVideoFrameOrBitmapCapture){t._videoloadedmetadata(null);try{t.videoCaptureValue&&t.videoCaptureValue.videoCtrl&&(t.videoCaptureValue.videoCtrl.srcObject=hh.videoStream),e.selfPreviewVideotag&&(e.selfPreviewVideotag.srcObject=hh.videoStream)}catch(e){Y.default.error("Error trying to set srcObject of video tag",e)}q.default.isSelfPreviewRenderWithVideo()&&q.default.isSupportVideoFrameOrBitmapCapture()&&t.videoCaptureValue.videoCtrl&&hh.playVideoStream(t.videoCaptureValue.videoCtrl),r(!0);var a=hh.getVideoCapabilities(),n=a.deviceId,o=a.pan,s=void 0===o?null:o,u=a.tilt,d=void 0===u?null:u,c=a.zoom,l=void 0===c?null:c;return Q.default.add_monitor("STARTVIDEOSUCCESS"),void Z.default.Notify_APPUI(t,M.START_VIDEO_CAPTURE_SUCCESS,{currentDeviceID:n,PTZRange:{pan:s,tilt:d,zoom:l}})}var h;t.isVideoCaptureLoadedmetadata&&(Y.default.error("Video capture isVideoCaptureLoadedmetadata is true"),t.isVideoCaptureLoadedmetadata=!1),t.videoloadedmetadatahandle=t._videoloadedmetadata.bind(t),null===(h=t.videoCaptureValue.videoCtrl)||void 0===h||h.addEventListener("loadedmetadata",t.videoloadedmetadatahandle),hh.checkVideoStreamActive().then(r).catch(i),t.videoCaptureValue.videoCtrl&&hh.playVideoStream(t.videoCaptureValue.videoCtrl);var f=hh.getVideoCapabilities(),p=f.deviceId,v=f.pan,m=void 0===v?null:v,g=f.tilt,_=void 0===g?null:g,S=f.zoom,E=void 0===S?null:S;Q.default.add_monitor("STARTVIDEOSUCCESS"),Z.default.Notify_APPUI(t,M.START_VIDEO_CAPTURE_SUCCESS,{currentDeviceID:p,PTZRange:{pan:m,tilt:_,zoom:E}})}))}this.StartVideoMediaCapture()},video_capture_for_webrtc:function(){if(!hh.shouldCaptureVideo())return new Promise((function(e,t){var r=hh.getVideoCapabilities(),i=r.deviceId,a=r.pan,n=void 0===a?null:a,o=r.tilt,s=void 0===o?null:o,u=r.zoom,d=void 0===u?null:u;Z.default.Notify_APPUI(M.START_VIDEO_CAPTURE_SUCCESS,{currentDeviceID:i,PTZRange:{pan:n,tilt:s,zoom:d}}),e(!0)}))},Stop_Video_Capture:function(){this.webrtcConfig.webrtcflag?this.Stop_Video_Capture_for_webrtc():this.Stop_Video_Capture_for_wasm(),this.isStartVideoCapture=!1,this.isVideoCaptureLoadedmetadata=!1,hh._clearCheckVideoStreamActiveTimer(),this.isMaskSettingOn||this.isVBSettingOn||this.isStartVideoCapture||(hh.destoryVideoMediaStream(),this.videoCaptureValue=null),clearInterval(this.videoCaptureInterval),this.videoCaptureInterval=0},Stop_Video_Capture_for_wasm:function(){Zt({command:"stopVideoEncode"}),tr({command:"stopVideoEncode"}),wr({command:"stopVideoEncode"}),this.videoCaptureValue&&this.videoCaptureValue.videoCtrl&&!this.isMaskSettingOn&&!this.isVBSettingOn&&(this.videoCaptureValue.videoCtrl.pause(),this.videoCaptureValue.videoCtrl.srcObject&&(this.videoCaptureValue.videoCtrl.srcObject=null),this.videoCaptureValue.videoCtrl.src&&(this.videoCaptureValue.videoCtrl.src=null),this.videoloadedmetadatahandle&&(Y.default.error("stop video capture but loadedmetadata not callback"),this.videoCaptureValue.videoCtrl.removeEventListener("loadedmetadata",this.videoloadedmetadatahandle),this.videoloadedmetadatahandle=null))},Stop_Video_Capture_for_webrtc:(Th=d()(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.wmscManager&&this.wmscManager.sendMessageToWMSCAsync({type:"VIDEO_STREAMS",streams:[]});case 1:case"end":return e.stop()}}),e,this)}))),function(){return Th.apply(this,arguments)}),Remove_Video_Capture:function(){clearInterval(this.videoCaptureInterval),this.videoCaptureInterval=0,hh.destoryVideoMediaStream(),this.videoCaptureValue=null,this.videoCaptureValue.videoCtrl&&this.videoCaptureValue.videoCtrl.pause()},Change_Video_Capture_Resolution:function(e,t){var r=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!q.default.isIpadOS()){var a=!1;if((!(q.default.isIphoneOrIpadBrowser()||q.default.isIpadOS()||q.default.isAndroidBrowser()&&!q.default.isMTRAndroidWithSAB())||(a=!0,i||(this.captureSize={width:e,height:t}),this.isLandScape||i))&&!(this.videoCaptureHiddenCanvas&&q.default.isMac()&&q.default.browser.isFirefox||e>=1920&&this.platformType!=x.X.DESKTOP)){var n=0;n=e>=1920?30:this.videoCaptureValue&&this.videoCaptureValue.fps?this.videoCaptureValue.fps:24,hh.changeVideoResolution(e,t,n).then((function(){a||(r.ReadyCapureWidth=e,r.ReadyCapureHeight=t,r.videoCaptureWidth=e,r.videoCaptureHeight=t,Z.default.Notify_APPUI(M.CURRENT_CAPTURE_VIDEO_WIDTH_HEIGHT,{width:e,height:t}),Zt({command:"updateVideoPara",width:e,height:t,fps:r.videoCaptureValue&&r.videoCaptureValue.fps?r.videoCaptureValue.fps:24}))})).catch((function(e){Y.default.warn("change video resoltuion info:",e)})),!hh.videoStreamTrack||this.isSupportVideoTrackReader||this.isSupportMediaStreamTrackProcessor||this.Process_Video()}}},Start_Whiteboard_Sharing:(wh=d()(g.a.mark((function e(){var t,r,i,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=this.desktopSharingValue.canvas,this.whiteboardCanvas=i,this.isdesktopCaptureLoadedmetadata=!0,t=i.width,r=i.height,this.desktopSharingCaptureWidth=t,this.desktopSharingCaptureHeight=r,this.desktopCaptureContext=i.getContext("2d"),Z.default.monitorSharingUserID=this.desktopSharingValue.ssid,Zt(a={command:"startSharingEncode",width:t,height:r,fps:8,ssid:this.desktopSharingValue.ssid,isSupportVideoTrackReader:!1,isSupportMediaStreamTrackProcessor:!1,isWhiteboardSharing:!0}),this.isSupportVideoShare||wr(a);case 13:case"end":return e.stop()}}),e,this)}))),function(){return wh.apply(this,arguments)}),Change_Sharing_Capture_Resolution:function(e){var t;this.shareTrack&&(console.log("change sharing capture resolution to",e),t=1==e?{video:!0,frameRate:5}:{width:1280,height:720,frameRate:24},this.shareTrack.applyConstraints(t))},Start_Desktop_Sharing:function(){if(this.desktopSharingMediaStram){var e=this;return new Promise((function(t,r){var i=function(){var t=d()(g.a.mark((function t(r){var a,n,o,s,u,d,c;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isSupportSharingTrackReader&&!e.isSupportMediaStreamTrackProcessor){t.next=6;break}o=e.desktopSharingMediaStram.getVideoTracks()[0],e.isSupportMediaStreamTrackProcessor?(e.sharingMediaStreamTrackProcessor=new MediaStreamTrackProcessor(o),e.sharingFrameStream=e.sharingMediaStreamTrackProcessor.readable,e.isSupportVideoShare?rr("sharingframeStream",e.sharingFrameStream):ir("frameStream",e.sharingFrameStream),Q.default.add_monitor("SCTP")):e.isSupportSharingTrackReader&&(e.sharingTrackReader=new VideoTrackReader(o),Q.default.add_monitor("SCTPR")),e.desktopSharingValue.video&&(a=e.desktopSharingValue.video.videoWidth,n=e.desktopSharingValue.video.videoHeight,e.desktopSharingCaptureWidth=a,e.desktopSharingCaptureHeight=n,e.desktopSharingValue.video.removeEventListener("loadedmetadata",i)),t.next=29;break;case 6:if(!e.isSharingSupportImageCapture){t.next=20;break}return o=e.desktopSharingMediaStram.getVideoTracks()[0],e.sharingImageCapture=new ImageCapture(o),Q.default.add_monitor("SCIC"),t.next=12,e.sharingImageCapture.grabFrame();case 12:s=t.sent,e.desktopSharingCaptureWidth=s.width,e.desktopSharingCaptureHeight=s.height,a=s.width,n=s.height;try{e.replaceCanvasMap.sharingPreviewCanvasId=e.desktopSharingValue.rendercanvasID,e.sharingOffscreenCanvas=e.desktopSharingValue.canvas.transferControlToOffscreen(),u=Z.default.SPECIAL_ID,Z.default.localSharingEncMGR&&(d=Z.default.localSharingEncMGR.map.get(u))&&(c={command:"newSharingPara",rendercanvasID:e.replaceCanvasMap.sharingPreviewCanvasId,data:e.sharingOffscreenCanvas,width:a,height:n,flipSend:e.flipSend,is32bitbrowser:e.is32bitbrowser},d.postMessage(c,[c.data]))}catch(t){u=Z.default.SPECIAL_ID,Z.default.localSharingEncMGR&&(d=Z.default.localSharingEncMGR.map.get(u))&&(c={command:"newSharingPara",flipSend:e.flipSend,is32bitbrowser:e.is32bitbrowser},d.postMessage(c))}t.next=29;break;case 20:e.isdesktopCaptureLoadedmetadata=!0,a=e.desktopSharingValue.video.videoWidth,n=e.desktopSharingValue.video.videoHeight,e.desktopSharingValue.canvas.width=a,e.desktopSharingValue.canvas.height=n,e.desktopSharingCaptureWidth=a,e.desktopSharingCaptureHeight=n,e.desktopCaptureContext=e.desktopSharingValue.canvas.getContext("2d"),e.desktopSharingValue.video.removeEventListener("loadedmetadata",i);case 29:Z.default.monitorSharingUserID=e.desktopSharingValue.ssid,e.isSupportVideoShare?Ir({command:"startSharingEncode",width:a,height:n,fps:8,ssid:e.desktopSharingValue.ssid,isSupportVideoTrackReader:e.isSupportSharingTrackReader,isSupportMediaStreamTrackProcessor:e.isSupportMediaStreamTrackProcessor}):wr({command:"startSharingEncode",width:a,height:n,fps:8,ssid:e.desktopSharingValue.ssid,isSupportVideoTrackReader:e.isSupportSharingTrackReader,isSupportMediaStreamTrackProcessor:e.isSupportMediaStreamTrackProcessor}),Z.default.Notify_APPUI(M.CURRENT_DESKTOP_SHARING_WIDTH_HEIGHT,{width:a,height:n}),Zt({command:"startsharingencode"});case 33:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();if(e.isSupportSharingTrackReader||e.isSupportMediaStreamTrackProcessor)e.desktopSharingValue.video.addEventListener("loadedmetadata",i);else{if(e.isSharingSupportImageCapture)return i(),e.desktopSharingValue.video.srcObject=e.desktopSharingMediaStram,e.desktopSharingValue.video.muted=!0,void t(!0);e.desktopSharingValue.video.addEventListener("loadedmetadata",i),e.desktopSharingValue.video.setAttribute("playsinline",""),e.desktopSharingValue.video.muted=!0}try{e.desktopSharingValue.video.srcObject=e.desktopSharingMediaStram,e.desktopSharingValue.video.muted=!0}catch(t){e.desktopSharingValue.video.src=URL.createObjectURL(e.desktopSharingMediaStram)}e.desktopSharingValue.video.play().catch((function(e){Y.default.error("Screenshare video preview play failed",e)})),Z.default.isGoogleMeetMode&&e.desktopSharingMediaStram.getAudioTracks().length>0&&(e.screenShareAudioPreviewElement=new Audio,e.screenShareAudioPreviewElement.srcObject=e.desktopSharingMediaStram,e.screenShareAudioPreviewElement.setSinkId(e.audioCtx.sinkId)),t(!0)}))}this.StartDesktopMediaCapture()},SharingFrameOutputCallback:function(e){var t,r,i,a=this;if(null!=e.format&&null!=e.planes)if(t=e.planes[0].stride,r=e.planes[0].rows,t==a.desktopSharingCaptureWidth&&r==a.desktopSharingCaptureHeight||(Z.default.Notify_APPUI(M.CURRENT_DESKTOP_SHARING_WIDTH_HEIGHT,{width:t,height:r}),a.desktopSharingCaptureWidth=t,a.desktopSharingCaptureHeight=r),1e3==a.sMonitorCaptureFrameCount&&(Q.default.add_monitor2("SCFOK"),a.sMonitorCaptureFrameCount=0),a.sMonitorCaptureFrameCount++,a.canISendNextSharingFrame){a.canISendNextSharingFrame=!1;var n=Z.default.SPECIAL_ID;if(Z.default.localSharingEncMGR){var o=Z.default.localSharingEncMGR.map.get(n);if(o){var s={command:"encodeSharingFrame",isSupportVideoTrackReader:a.isSupportSharingTrackReader,data:e};o.postMessage(s)}q.default.browserType.version>=90&&("close"in e?e.close():e.destroy())}}else"close"in e?e.close():e.destroy();else a.canISendNextSharingFrame?(a.canISendNextSharingFrame=!1,e.createImageBitmap().then((function(n){t=(i=n).width,r=i.height,"close"in e?e.close():e.destroy(),t==a.desktopSharingCaptureWidth&&r==a.desktopSharingCaptureHeight||(Z.default.Notify_APPUI(M.CURRENT_DESKTOP_SHARING_WIDTH_HEIGHT,{width:t,height:r}),a.desktopSharingCaptureWidth=t,a.desktopSharingCaptureHeight=r);var o=Z.default.SPECIAL_ID;if(Z.default.localSharingEncMGR){var s=Z.default.localSharingEncMGR.map.get(o);s&&s.postMessage({command:"encodeSharingFrame",isImageFromSharingFrame:!0,data:i},[i])}})).catch((function(e){Y.default.error("Converting sharing frame to image bitmap failed",e)}))):"close"in e?e.close():e.destroy()},Process_Sharing:(Ih=d()(g.a.mark((function e(){var t,r,i,a,n,o,s,u,d;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.desktopSharingValue&&this.desktopSharingSend){e.next=2;break}return e.abrupt("return");case 2:if(this.isStartWhiteboardSharing||!this.isSupportSharingTrackReader){e.next=14;break}return e.prev=4,e.next=7,this.sharingTrackReader.start(this.SharingFrameOutputCallback.bind(this));case 7:e.next=11;break;case 9:e.prev=9,e.t0=e.catch(4);case 11:return e.abrupt("return");case 14:if(this.isStartWhiteboardSharing||!this.isSharingSupportImageCapture){e.next=35;break}return e.prev=15,e.next=18,this.sharingImageCapture.grabFrame();case 18:a=e.sent,t=a.width,r=a.height,1e3==this.sMonitorCaptureFrameCount&&(Q.default.add_monitor2("SCFOK"),this.sMonitorCaptureFrameCount=0),this.sMonitorCaptureFrameCount++,n=Z.default.SPECIAL_ID,Z.default.localSharingEncMGR&&(o=Z.default.localSharingEncMGR.map.get(n))&&(s={command:"encodeSharingFrame",data:a,isImage:!0},o.postMessage(s,[s.data])),e.next=33;break;case 27:e.prev=27,e.t1=e.catch(15),Y.default.error("An error occurred when trying to encode a sharing frame using the ImageCapture API",e.t1),Q.default.add_monitor3("SICF"),n=Z.default.SPECIAL_ID,Z.default.localSharingEncMGR&&(o=Z.default.localSharingEncMGR.map.get(n))&&(s={command:"encodeSharingFrame"},o.postMessage(s));case 33:e.next=36;break;case 35:this.isStartWhiteboardSharing?(i=this.whiteboardCanvas,t=i.width,r=i.height):(i=this.desktopSharingValue.video,t=i.videoWidth,r=i.videoHeight);case 36:t==this.desktopSharingCaptureWidth&&r==this.desktopSharingCaptureHeight||(Z.default.Notify_APPUI(M.CURRENT_DESKTOP_SHARING_WIDTH_HEIGHT,{width:t,height:r}),this.desktopSharingCaptureWidth=t,this.desktopSharingCaptureHeight=r);try{this.isdesktopCaptureLoadedmetadata&&i&&(this.isStartDesktopSharing||(this.desktopSharingValue.canvas.width=t,this.desktopSharingValue.canvas.height=r),u=this.desktopCaptureContext,!this.is32bitbrowser||this.flipSend?(this.isStartWhiteboardSharing||u.drawImage(i,0,0,t,r,0,0,t,r),d=u.getImageData(0,0,t,r),1e3==this.sMonitorCaptureFrameCount&&(Q.default.add_monitor2("SCFOK"),this.sMonitorCaptureFrameCount=0),this.sMonitorCaptureFrameCount++,Et(Z.default.SPECIAL_ID,d.data,d.data.length,0,t,r),this.flipSend=!1):(this.flipSend=!0,Et(Z.default.SPECIAL_ID,null,0,0,0,0)))}catch(e){Y.default.error("An error occurred when trying to encode a sharing frame",e),Q.default.add_monitor3("GIDF"),setTimeout((function(){Et(Z.default.SPECIAL_ID,null,0,0,0,0)}),1e3)}case 38:case"end":return e.stop()}}),e,this,[[4,9],[15,27]])}))),function(){return Ih.apply(this,arguments)}),VideoFrameOutputCallback:function(e){var t,r,i,a,n=this;if(null!=e.format&&null!=e.planes){i=n.videoCaptureWidth,a=n.videoCaptureHeight,t=e.cropWidth,r=e.cropHeight,t===i&&r===a||(fh("video width/height changed old => begin",i,a,t,r),Z.default.Notify_APPUI(M.CURRENT_CAPTURE_VIDEO_WIDTH_HEIGHT,{width:t,height:r}),Zt({command:"updateVideoPara",width:t,height:r,fps:n.GetVideoCaptureFps()}),n.videoCaptureWidth=t,n.videoCaptureHeight=r),3e3==n.vMonitorCaptureFrameCount&&(Q.default.add_monitor2("VCFOK"),n.vMonitorCaptureFrameCount=0),n.vMonitorCaptureFrameCount++;var o=Z.default.SPECIAL_ID;if(Z.default.localVideoEncMGR){var s=Z.default.localVideoEncMGR.map.get(o);s&&e&&s.postMessage({command:"yuvVideoFrame",data:e}),q.default.browserType.version>=90&&("close"in e?e.close():e.destroy())}}else{var u;e.createImageBitmap().then((function(o){u=o,"close"in e?e.close():e.destroy(),i=n.videoCaptureWidth,a=n.videoCaptureHeight,t=u.width,r=u.height,t===i&&r===a||(fh("video width/height changed old => begin",i,a,t,r),Z.default.Notify_APPUI(M.CURRENT_CAPTURE_VIDEO_WIDTH_HEIGHT,{width:t,height:r}),Zt({command:"updateVideoPara",width:t,height:r,fps:n.GetVideoCaptureFps()}),n.videoCaptureWidth=t,n.videoCaptureHeight=r);var s=Z.default.SPECIAL_ID;if(Z.default.localVideoEncMGR){var d=Z.default.localVideoEncMGR.map.get(s);d&&d.postMessage({command:"ImageBitmapFromVideoFrame",data:u},[u])}})).catch((function(e){Y.default.error("Converting video frame to image bitmap failed",e)}))}},Update_Mask_Texture:function(e,t,r){if(this.VideoMaskSettingCanvas){try{"object"===s()(t)&&t.ideal&&(t=t.ideal),"object"===s()(r)&&r.ideal&&(r=r.ideal),this.bgCanvas&&this.bgCanvasctx||(this.bgCanvas=document.createElement("canvas"),this.bgCanvasctx=this.bgCanvas.getContext("2d")),this.bgCanvas.width==t&&this.bgCanvas.height==r||(this.bgCanvas.width=t,this.bgCanvas.height=r)}catch(e){globaltracing_error("Update_Mask_Texture, width=$".concat(JSON.stringify(t),", height=").concat(JSON.stringify(r),". "),e),t=this.bgCanvas.width,r=this.bgCanvas.height}if(this.bgCanvasctx.clearRect(0,0,t,r),this.MaskImage&&this.BgImage&&"blur"!==this.BgImage){if(e.dWidth>0&&e.dHeight>0&&this.VideoMaskSettingCanvas.width>0&&this.VideoMaskSettingCanvas.height>0&&t>0&&r>0){var i=e.dx/(this.VideoMaskSettingCanvas.width/t),a=e.dy/(this.VideoMaskSettingCanvas.height/r),n=e.dWidth/(this.VideoMaskSettingCanvas.width/t),o=e.dHeight/(this.VideoMaskSettingCanvas.height/r);this.bgCanvasctx.drawImage(this.MaskImage,i,a,n,o)}var u,d,c,l;this.bgCanvasctx.globalCompositeOperation="source-out",this.Crop_Mask_Bg_16V9(),u=this.bgImageCroppingParams.sx,d=this.bgImageCroppingParams.sy,c=this.bgImageCroppingParams.sw,l=this.bgImageCroppingParams.sh,this.bgCanvasctx.drawImage(this.BgImage,u,d,c,l,0,0,t,r)}}},Crop_Mask_Bg_16V9:function(){var e,t,r,i=0,a=this.BgImage.naturalWidth,n=this.BgImage.naturalHeight;16/9*n>=a?(r=a,e=0,t=(n-(i=a/(16/9)))/2):(i=n,e=(a-(r=n*(16/9)))/2,t=0),this.bgImageCroppingParams.sx=e,this.bgImageCroppingParams.sy=t,this.bgImageCroppingParams.sw=r,this.bgImageCroppingParams.sh=i},Draw_Mask_Frame:function(){if(this.VideoMaskSettingCanvas){this.VideoMaskSettingCanvasctx||(this.VideoMaskSettingCanvasctx=this.VideoMaskSettingCanvas.getContext("2d"));var e,t,r=this.VideoMaskCanvasFillMode?Ii(this.videoCaptureHiddenCanvas.width,this.videoCaptureHiddenCanvas.height,void 0,void 0,this.VideoMaskSettingCanvas.width/this.VideoMaskSettingCanvas.height):this.videoCaptureValue&&this.videoCaptureValue.disableOriginalRatio?Ii(this.videoCaptureHiddenCanvas.width,this.videoCaptureHiddenCanvas.height):null;if(this.isMirrorMyVideo)this.isCanvasScaled||(this.VideoMaskSettingCanvasctx.scale(-1,1),this.isCanvasScaled=!0),this.VideoMaskSettingCanvasctx.clearRect(0-this.VideoMaskSettingCanvas.width,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height),(e=this.VideoMaskSettingCanvasctx).drawImage.apply(e,[this.videoCaptureHiddenCanvas].concat(n()(r?[r.left,r.top,r.width,r.height]:[]),[0-this.VideoMaskSettingCanvas.width,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height]));else this.isCanvasScaled&&(this.VideoMaskSettingCanvasctx.setTransform(1,0,0,1,0,0),this.isCanvasScaled=!1),this.VideoMaskSettingCanvasctx.clearRect(0,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height),(t=this.VideoMaskSettingCanvasctx).drawImage.apply(t,[this.videoCaptureHiddenCanvas].concat(n()(r?[r.left,r.top,r.width,r.height]:[]),[0,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height]))}},GetVideoCaptureFps:function(){return this.videoCaptureValue&&this.videoCaptureValue.fps?this.videoCaptureValue.fps:x.P},Process_Video:(Rh=d()(g.a.mark((function e(){var t,r,i,a,n,o,s,u,d,c,l,h,f,p,v,m,_,S,E,b,y;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isSupportMediaStreamTrackProcessor){e.next=2;break}return e.abrupt("return");case 2:if(!this.isSupportVideoTrackReader){e.next=11;break}return e.prev=3,e.next=6,hh.videoTrackReader.start(this.VideoFrameOutputCallback.bind(this));case 6:e.next=10;break;case 8:e.prev=8,e.t0=e.catch(3);case 10:return e.abrupt("return");case 11:if(!this.isSupportImageCapture){e.next=17;break}if(!hh.isImageCaptureLocked()){e.next=16;break}return e.abrupt("return");case 16:hh.lockImageCapture();case 17:if(this.videoCaptureValue&&this.isStartVideoCapture||this.isMaskSettingOn||this.isVBSettingOn){e.next=20;break}return hh.unLockImageCapture(),e.abrupt("return");case 20:if(t=this,a=this.videoCaptureWidth,n=this.videoCaptureHeight,!this.isSupportImageCapture){e.next=41;break}return e.prev=24,e.next=27,hh.videoImageCapture.grabFrame();case 27:s=e.sent,r=s.width,i=s.height,r&&i&&(r!==a||i!==n)&&(fh("video width/height changed old => begin",a,n,r,i),Z.default.Notify_APPUI(M.CURRENT_CAPTURE_VIDEO_WIDTH_HEIGHT,{width:r,height:i}),Zt({command:"updateVideoPara",width:r,height:i,fps:this.GetVideoCaptureFps()}),3e3==this.vMonitorCaptureFrameCount&&(Q.default.add_monitor2("VCFOK"),this.vMonitorCaptureFrameCount=0),this.vMonitorCaptureFrameCount++,this.videoCaptureWidth=r,this.videoCaptureHeight=i),qr(s),e.next=39;break;case 34:e.prev=34,e.t1=e.catch(24),Y.default.error("An error occurred when trying to encode a video frame using the ImageCapture API",e.t1),Q.default.add_monitor3("VICF"),qr(null);case 39:return hh.unLockImageCapture(),e.abrupt("return");case 41:if(u=hh.isUsingFileInputVideoSource(),this.isStartVideoCapture?o=this.videoCaptureValue.videoCtrl:(this.isMaskSettingOn||this.isVBSettingOn)&&(o=this.MaskSettingVideo),Object(q.VideoStreamCanCapture)(o.srcObject)){e.next=45;break}return e.abrupt("return");case 45:if(!((this.isVideoCaptureLoadedmetadata||this.isMaskSettingOn||this.isVBSettingOn)&&o&&o.readyState>=2)){e.next=68;break}if((o.paused||o.ended)&&o.play().catch((function(e){Y.default.error("Video capture video tag play failed",e)})),!this.isSelfViewWithVideo||this.platformType!=x.X.IPHONE){e.next=55;break}return c=mh,hh.facingMode==x.l&&(2==mh?c=0:0==mh&&(c=2)),er({command:"yuvVideoFrame",data:l=new VideoFrame(o,{timestamp:0}),rotation:c},[l])||l.close(),e.abrupt("return");case 55:if(!q.default.isSupportVideoFrame()||t.isCurrentInMaskStatus||null===(d=q.default.browser)||void 0===d||!d.isSafari||q.default.isIphoneOrIpadSafari()){e.next=60;break}return h=new VideoFrame(o,{timestamp:0}),f={command:"yuvVideoFrame",data:h,rotation:mh},t.videoCaptureValue&&t.VideoRenderObj&&!t.isMultiView?(t.VideoRenderObj.Update_LocalVideo(h,mh),Zt(f),h.close()):er(f,[h])||h.close(),e.abrupt("return");case 60:r=o.videoWidth?o.videoWidth:640,i=o.videoHeight?o.videoHeight:360,r&&i&&(r!==a||i!==n)&&(fh("video width/height changed old => begin",a,n,r,i),Z.default.Notify_APPUI(M.CURRENT_CAPTURE_VIDEO_WIDTH_HEIGHT,{width:r,height:i}),this.videoCaptureWidth=r,this.videoCaptureHeight=i,Zt({command:"updateVideoPara",width:r,height:i,fps:t.GetVideoCaptureFps()})),(!(!t.isMaskSettingOn||t.videoCaptureValue&&t.videoCaptureValue.disableOriginalRatio)||t.MaskImage&&t.BgImage)&&t.isCurrentInMaskStatus?(S=r/i*t.ReadyCapureHeight,E=i/r*t.ReadyCapureWidth,S>t.ReadyCapureWidth?(p=0,v=(t.ReadyCapureHeight-E)/2):(p=(t.ReadyCapureWidth-S)/2,v=0),m=t.ReadyCapureWidth-2*p,_=t.ReadyCapureHeight-2*v,t.videoCaptureHiddenCanvas.width=t.ReadyCapureWidth,t.videoCaptureHiddenCanvas.height=t.ReadyCapureHeight):(m=r,_=i,p=0,v=0,t.videoCaptureHiddenCanvas.width=r,t.videoCaptureHiddenCanvas.height=i),u?q.default.videoToMediaStreamManager.drawCanvas(t.videoCaptureHiddenCanvas,t.videoCaptureHiddenCanvasCtx,t.videoCaptureHiddenCanvas.width,t.videoCaptureHiddenCanvas.height):t.videoCaptureHiddenCanvasCtx.drawImage(o,0,0,r,i,p,v,m,_),t.isCurrentInMaskStatus&&(t.bgCanvas?t.videoCaptureHiddenCanvasCtx.drawImage(t.bgCanvas,0,0,t.videoCaptureHiddenCanvas.width,t.videoCaptureHiddenCanvas.height):t.Update_Mask_Texture(this.maskCoordinate,t.videoCaptureHiddenCanvas.width,t.videoCaptureHiddenCanvas.height),t.VideoMaskSettingCanvas&&t.Draw_Mask_Frame()),(t.isStartVideoCapture||t.isVBSettingOn)&&(b=t.videoCaptureHiddenCanvasCtx.getImageData(0,0,t.videoCaptureHiddenCanvas.width,t.videoCaptureHiddenCanvas.height),y=b.data,t.lastRealRect.width==t.videoCaptureHiddenCanvas.width&&t.lastRealRect.height==t.videoCaptureHiddenCanvas.height||(t.lastRealRect.left=0,t.lastRealRect.top=0,t.lastRealRect.width=t.videoCaptureHiddenCanvas.width,t.lastRealRect.height=t.videoCaptureHiddenCanvas.height,Zt({command:"updateVideoPara",width:t.lastRealRect.width,height:t.lastRealRect.height,fps:t.GetVideoCaptureFps()})),t.videoCaptureValue&&t.VideoRenderObj&&!t.isMultiView&&(b.data instanceof Uint8ClampedArray&&(y=new Uint8Array(b.data.buffer)),t.videoCaptureValue&&void 0!==t.videoCaptureValue.disableOriginalRatio&&t.VideoRenderObj.Set_Cropping_Mode(!!t.videoCaptureValue.disableOriginalRatio),t.VideoRenderObj.Draw_Send_Video_Img(y,t.videoCaptureHiddenCanvas.width,t.videoCaptureHiddenCanvas.height,t.videoCaptureValue.ssid,x.W,t.lastRealRect)),3e3==t.vMonitorCaptureFrameCount&&(Q.default.add_monitor2("VCFOK"),t.vMonitorCaptureFrameCount=0),t.vMonitorCaptureFrameCount++,St(Z.default.SPECIAL_ID,y,t.videoCaptureHiddenCanvas.width,t.lastRealRect.left,t.lastRealRect.top)),t.videoCaptureHiddenCanvasCtx.clearRect(0,0,t.videoCaptureHiddenCanvas.width,t.videoCaptureHiddenCanvas.height);case 68:case"end":return e.stop()}}),e,this,[[3,8],[24,34]])}))),function(){return Rh.apply(this,arguments)}),Remove_Sharing_Audio_Capture:function(){if(!this.audioBridge||this.audioBridge.isDestroyed){if(sr({command:"changeAudioShare",isStart:!1}),Z.default.ComputerAudioStatus==J.a.ComputerAudio_Null&&et.clear(),this.sharingWebrtcAudioNode&&Z.default.SharingAudioNode){try{this.sharingWebrtcAudioNode.disconnect(Z.default.SharingAudioNode)}catch(e){this.JsMediaSDK_Log(e)}this.sharingWebrtcAudioNode=null}}else this.audioBridge.publishStream(null,!0)},Remove_Audio_Capture:function(e){if(jt(Z.default.SPECIAL_ID,M.AUDIO_REMOVE,e),Z.default.DesktopAudioStatus==J.a.DesktopAudio_Null&&et.clear(),this.firstSetDelay=!0,this.webrtcAudioNode&&Z.default.AudioNode){try{this.webrtcAudioNode.disconnect(Z.default.AudioNode)}catch(e){this.JsMediaSDK_Log(e)}this.webrtcAudioNode=null}},Start_Video_Play:function(){this.videoRenderIntervalHandle||(this.videoRenderIntervalHandle=this.JsMediaSDK_VideoRenderInterval(this.videorenderinterval))},Stop_Video_Play:function(){(this.UpdateVideoPlayStatus(!1),this.VideoRenderObj&&(this.VideoRenderObj.ClearQueue(),this.VideoRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName})),this.videoRenderIntervalHandle)&&(this.VideoRenderObj.Stop_Draw.bind(this.VideoRenderObj)(),this.videoRenderIntervalHandle=null)},Remove_Video_Play:function(){this.UpdateVideoPlayStatus(!1),this.videoRenderIntervalHandle&&(clearInterval(this.videoRenderIntervalHandle),this.videoRenderIntervalHandle=null),tr({command:"removeVideoPlay"})},UpdateVideoPlayStatus:function(e){_e(e)},EndMedia:function(){try{Z.default.rwgAgent&&Z.default.rwgAgent.off("message",this.rwgAgentMessageListenerWrapper)}catch(e){Y.default.error("rwgAgent.off error",e)}try{this.rtcPeerConnectionList.forEach((function(e){e&&(e.forceClose(),e=null)})),this.rtcPeerConnectionList=[]}catch(e){Y.default.error("clear rtcPeerConnectionList err",e)}try{hh.destoryAudioMediaStream(),this.Remove_Audio_Play(),this.Remove_Audio_Capture(),this.Remove_Sharing_Audio_Capture(),this.checkWorkletInterval&&(clearInterval(this.checkWorkletInterval),this.checkWorkletInterval=null),this.Remove_Video_Play(),this.audioCtx&&(this.audioCtx.onstatechange=null,this.audioCtx.close(),this.audioCtx=null),this.sharingAudioCtx&&(this.sharingAudioCtx.close(),this.sharingAudioCtx=null),this.audioDomNode&&(this.audioDomNode=null)}catch(e){Y.default.error("endMedia",e)}try{hh.destoryVideoMediaStream(),this.EndSharingMediaStream(),this.CloseBoringPeerConnection(),q.default.audioToMediaStreamMananger.destroy(!1)}catch(e){Y.default.error("endMedia",e)}try{kr()}catch(e){Y.default.error("endMedia",e)}try{this.remoteControl&&this.remoteControl.destroy()}catch(e){Y.default.error("endMedia",e)}},EndDesktopAudioMediaStream:function(){if(this.isStartDesktopSharing||(this.desktopSharingValue=null),this.desktopSharingMediaStram){var e=this.desktopSharingMediaStram.getAudioTracks();e.length&&e.forEach((function(e){e.stop()}))}},EndSharingMediaStream:function(){this.desktopSharingMediaStram&&(this.desktopSharingMediaStram.getTracks().forEach((function(e){e.stop()})),this.desktopSharingMediaStram=null,window.WebQrscanner&&WebQrscanner.qrScanner.stop())},StopSharingCapture:function(){this.EndSharingMediaStream(),this.desktopSharingSend=!1,this.isStartDesktopSharing&&Zt({command:"stopsharingencode"}),this.isStartDesktopSharing=!1,this.desktopSharingMediaStram=null,window.WebQrscanner&&WebQrscanner.qrScanner.stop(),this.desktopSharingValue=null},CloseBoringPeerConnection:function(){try{this.rtcConnectionB&&(this.rtcConnectionB.close(),this.rtcConnectionB=null),this.rtcConnectionA&&(this.rtcConnectionA.close(),this.rtcConnectionA=null)}catch(e){fh(e)}},UnMuteAudio:function(){jt(Z.default.SPECIAL_ID,M.AUDIO_START),this.enableHID&&this.hidAvalible&&Ga.sendReport("mute",!1)},MuteAudio:function(){this.Stop_Audio_Capture(),this.enableHID&&this.hidAvalible&&Ga.sendReport("mute",!0)},selectComputerAudioSpeaker:function(e,t){var r=q.default.isSupportChromeWideAEC(),i="default"==e?"":e,a=null;if(r&&!this.audioDomNode?this.audioCtx&&(a=this.audioCtx):this.audioDomNode&&(a=this.audioDomNode),!a||!a.setSinkId)return Q.default.add_monitor("NoAudioPlayer"),void Z.default.Notify_APPUI(M.AUDIO_SPEAKER_SET_ERROR,"no audio player or audio player dont support setSinkId. audioPlay: "+!!a);a.setSinkId(i).then((function(){ya.updateSelectedSpeakerDevices(a.sinkId||"default",Date.now()-t,!0),Z.default.Notify_APPUI(M.AUDIO_SPEAKER_SET_SUCCESS,a.sinkId||"default")})).catch((function(e){Y.default.error("An error occurred when trying to set the audio output device",e),Q.default.add_monitor("AODF"),ya.updateSelectedSpeakerDevices(i,Date.now()-t,!1),Z.default.Notify_APPUI(M.AUDIO_SPEAKER_SET_ERROR,null)}))},handleDesktopCapture:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.desktopSharingMediaStram=e;var r=this,i=this.desktopSharingMediaStram.getAudioTracks()[0];i?(t||"Tab audio"===i.label||i.label.includes("HDMI")||(Z.default.shareSystemAudio=!0),Z.default.Notify_APPUI(M.SHARING_DESKTOP_STREAM_HAVE_AUDIO,t),i.onended=function(){console.log("share audio track ended")}):Z.default.Notify_APPUI(M.SHARING_DESKTOP_STREAM_HAVE_NO_AUDIO,null),this.shareTrack=this.desktopSharingMediaStram.getVideoTracks()[0],this.shareTrack?(this.shareTrack.onended=function(){Q.default.add_monitor("SSBB"),Z.default.Notify_APPUI(M.USER_STOP_DESKTOP_SHARING,null),r.StopSharingCapture()},this.Start_Desktop_Sharing(),Z.default.Notify_APPUI(M.DESKTOP_SHARING_CAPTURE_SUCCESS,null)):Y.default.log("shareTrack is null when share screen")},handleCaptureError:function(e){this.handleGetDisplayMediaError("An error occurred when trying to capture sharing",e),this.StopSharingCapture(),Q.default.add_monitor("SCCF"),"Permission denied by system"===e.message?Z.default.Notify_APPUI(M.DESKTOP_SHARING_SYSTEM_ERROR,null):Z.default.Notify_APPUI(M.DESKTOP_SHARING_ERROR,null)},handleAudioCapture:function(){var e=hh.getAudioCapabilities(),t=e.deviceId,r=e.elapsed_time,i=e.deviceLabel;return t&&r&&i&&ya.updateSelectedMicDevices(t,i,r,!0),this.audioBridge&&!this.audioInputLevel?(this.audioBridge.publishStream(hh.audioStream).then((function(e){Z.default.ComputerAudioStatus===J.a.ComputerAudio_Connecting&&(Z.default.ComputerAudioStatus=J.a.ComputerAudio_Connected,Z.default.Notify_APPUI(M.JOIN_COMPUTER_AUDIO_COMPLETE,t))})),Y.default.log("user grante audio capture"),void Z.default.Notify_APPUI(M.USER_GRANT_CAPTURE_AUDIO,t)):this.audioCtx||this.audioInputLevel?(Y.default.log("user grante audio capture"),Z.default.Notify_APPUI(M.USER_GRANT_CAPTURE_AUDIO,t),void this.Start_Audio_Capture()):(Y.default.log("no audio context when join computer audio"),Z.default.ComputerAudioStatus=J.a.ComputerAudio_Null,Z.default.Notify_APPUI(M.JOIN_COMPUTER_AUDIO_COMPLETE,null),Z.default.Notify_APPUI(M.JOIN_COMPUTER_AUDIO_FAILURE,null),void hh.destoryAudioMediaStream())},handleWasmVideoCapture:function(e,t){var r=this;return new Promise(function(){var i=d()(g.a.mark((function i(a,n){var o,s;return g.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(e){i.next=2;break}return i.abrupt("return",n(new Error("no stream")));case 2:if(r.videoCaptureWidth?r.videoCaptureWidth=r.videoCaptureWidth:r.videoCaptureWidth=640,r.videoCaptureHeight?r.videoCaptureHeight=r.videoCaptureHeight:r.videoCaptureHeight=360,!t.encode||!r.isStartVideoCapture){i.next=19;break}return i.prev=5,i.next=8,r.Start_Video_Capture();case 8:o=i.sent,a(o),i.next=16;break;case 12:i.prev=12,i.t0=i.catch(5),Y.default.error("media stream is ok, but start video capture fail",i.t0),n(new Error("media stream is ok, but start video capture fail"));case 16:r.isMaskSettingOn&&r.MaskSettingVideo&&hh.playVideoStream(r.MaskSettingVideo),i.next=34;break;case 19:if(!t.preview||!r.isMaskSettingOn&&!r.isVBSettingOn){i.next=33;break}return i.prev=20,i.next=23,r.startMaskOrVBSettingVideoCapture(e);case 23:s=i.sent,a(s),i.next=31;break;case 27:i.prev=27,i.t1=i.catch(20),fh("startMaskOrVBSettingVideoCapture",i.t1),n(new Error("media stream is ok, but start setting video capture fail"));case 31:i.next=34;break;case 33:hh.destoryVideoMediaStream();case 34:case"end":return i.stop()}}),i,null,[[5,12],[20,27]])})));return function(e,t){return i.apply(this,arguments)}}())},handleWebrtcVideoCapture:function(e){var t=this;return new Promise(function(){var r=d()(g.a.mark((function r(i,a){var n;return g.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e){r.next=2;break}return r.abrupt("return",a(new Error("no stream")));case 2:if(!t.isStartVideoCapture){r.next=15;break}return r.prev=3,r.next=6,t.video_capture_for_webrtc();case 6:n=r.sent,i(n),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(3),a(new Error("media stream is ok, but start video capture fail"));case 13:r.next=16;break;case 15:hh.destoryVideoMediaStream();case 16:case"end":return r.stop()}}),r,null,[[3,10]])})));return function(e,t){return r.apply(this,arguments)}}())},startMaskOrVBSettingVideoCapture:function(e){var t=this;return new Promise((function(e,r){try{if(t.isVBSettingOn)if(t.MaskSettingVideo){var i=hh.playVideoStream(t.MaskSettingVideo);i&&i.then((function(){Z.default.Notify_APPUI(M.START_VIDEO_STREAM_IN_VB_SETTING_SUCCESS,null)})).catch((function(e){r(new Error("media stream is ok, but video.play() fail")),Y.default.error("An error occurred when trying to play video in Background Setting tab",e),Q.default.add_monitor("VBVPF")}))}else Z.default.Notify_APPUI(M.START_VIDEO_STREAM_IN_VB_SETTING_SUCCESS,null);else if(t.isMaskSettingOn)if(t.MaskSettingVideo){var a=hh.playVideoStream(t.MaskSettingVideo);a&&a.then((function(){Z.default.Notify_APPUI(M.START_VIDEO_STREAM_IN_MASK_SETTING_SUCCESS,null)})).catch((function(e){r(new Error("media stream is ok, but video.play() fail")),Y.default.error("An error occurred when trying to play video in Background Setting tab",e),Q.default.add_monitor("MVPF")}))}else Z.default.Notify_APPUI(M.START_VIDEO_STREAM_IN_MASK_SETTING_SUCCESS,null);t.addChannelForVideo(),Zt({command:"startvideointerval",width:t.videoCaptureValue.width,height:t.videoCaptureValue.height,ssid:t.videoCaptureValue.ssid,mtu_size:t.mtu_size,fps:t.videoCaptureValue.fps,isSupportImageCapture:t.isSupportImageCapture,isSupportVideoTrackReader:t.isSupportVideoTrackReader,isSupportMediaStreamTrackProcessor:t.isSupportMediaStreamTrackProcessor,isSupport2DCanvasDrawFrame:t.isSupport2DCanvasDrawFrame,isVBSettingOn:t.isVBSettingOn,isMaskSettingOn:t.isMaskSettingOn}),e(!0)}catch(e){Y.default.error("Starting mask or virtual background failed",e),r(e)}}))},handleGetDisplayMediaError:function(e,t){var r={AbortError:"error",InvalidStateError:"error",NotAllowedError:"warn",NotFoundError:"warn",NotReadableError:"warn",OverconstrainedError:"warn",TypeError:"error"}[t.name]||"error";Y.default[r](e,t)},handleGetUserMediaError:function(e,t){var r={NotAllowedError:"warn",NotFoundError:"warn",NotReadableError:"warn",OverconstrainedError:"warn",SecurityError:"warn",SourceUnavailableError:"warn",PermissionDeniedError:"warn",AbortError:"error",TypeError:"error"}[t.name]||"error";Y.default[r](e,t)},handleAudioError:function(e){this.handleGetUserMediaError("Error occurred when trying to capture audio",e),Q.default.add_monitor("HADF: "+(null==e?void 0:e.name)),Z.default.Notify_APPUI(M.USER_FORBIDDED_CAPTURE_AUDIO,e),Z.default.ComputerAudioStatus===J.a.ComputerAudio_Connecting&&(Z.default.ComputerAudioStatus=J.a.ComputerAudio_Null,Z.default.Notify_APPUI(M.JOIN_COMPUTER_AUDIO_COMPLETE,null),Z.default.Notify_APPUI(M.JOIN_COMPUTER_AUDIO_FAILURE,null))},handleVideoError:function(e){Z.default.monitorVideoCapture=!1,this.isMaskSettingStarted=!1,this.isCurrentInMaskStatus=!1,fh("handleVideoError",e);var t=(null==e?void 0:e.name)||"other error",r="Error ".concat((null==e?void 0:e.message)||"");Q.default.add_monitor("STARTVIDEOERR:".concat(t,"-").concat(r));e instanceof ii||e.name&&-1!==["NotReadableError","SourceUnavailableError"].indexOf(e.name)?(Q.default.add_monitor("COCPEF"),Z.default.Notify_APPUI(M.USER_CAMERA_IS_TAKEN_BY_OTHER_PROGRAMS,e)):(Q.default.add_monitor("HVDF"),Z.default.Notify_APPUI(M.USER_FORBIDDED_CAPTURE_VIDEO,e)),this.handleGetUserMediaError("Error occurred when trying to capture video",e),this.Stop_Video_Capture()},chromeAecWorkAround:(Ah=d()(g.a.mark((function e(t){var r,i,a,n,o,s,u,d,c,l;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Q.default.add_monitor("ASCAEC"),!this.rtcConnectionA&&!this.rtcConnectionB){e.next=3;break}return e.abrupt("return",!1);case 3:return r=null,i=null,a=new MediaStream,n={offerVideo:!0,offerAudio:!0,offerToReceiveAudio:!1,offerToReceiveVideo:!1},r=new RTCPeerConnection,i=new RTCPeerConnection,r.onicecandidate=function(e){return e.candidate&&i.addIceCandidate(new RTCIceCandidate(e.candidate))},i.onicecandidate=function(e){return e.candidate&&r.addIceCandidate(new RTCIceCandidate(e.candidate))},i.ontrack=function(e){e.streams[0].getTracks().forEach((function(e){a.addTrack(e)}))},r.addStream(t),e.next=15,r.createOffer(n);case 15:return o=e.sent,u=!1,d=null,c=null,l=q.default.getBrowserVersion(),e.prev=20,c=o.sdp,d=l>=104?(d=o.sdp.replace("SAVPF 111","SAVPF 100 111")).replace("a=rtpmap:111 opus/48000/2","a=rtpmap:100 L16/48000\na=rtpmap:111 opus/48000/2"):(d=o.sdp.replace("SAVPF 111","SAVPF 10 111")).replace("a=rtpmap:111 opus/48000/2","a=rtpmap:10 L16/48000\na=rtpmap:111 opus/48000/2"),o.sdp=d,e.next=26,r.setLocalDescription(o);case 26:return e.next=28,i.setRemoteDescription(o);case 28:e.next=38;break;case 30:return e.prev=30,e.t0=e.catch(20),u=!0,o.sdp=c,e.next=36,r.setLocalDescription(o);case 36:return e.next=38,i.setRemoteDescription(o);case 38:return e.next=40,i.createAnswer();case 40:return s=e.sent,u||(l>=104?(s.sdp=s.sdp.replace("SAVPF 111","SAVPF 100 111"),s.sdp=s.sdp.replace("a=rtpmap:111 opus/48000/2","a=rtpmap:100 L16/48000\na=rtpmap:111 opus/48000/2")):(s.sdp=s.sdp.replace("SAVPF 111","SAVPF 10 111"),s.sdp=s.sdp.replace("a=rtpmap:111 opus/48000/2","a=rtpmap:10 L16/48000\na=rtpmap:111 opus/48000/2"))),e.next=44,i.setLocalDescription(s);case 44:return e.next=46,r.setRemoteDescription(s);case 46:return this.rtcConnectionA=r,this.rtcConnectionB=i,e.abrupt("return",a);case 49:case"end":return e.stop()}}),e,this,[[20,30]])}))),function(e){return Ah.apply(this,arguments)}),switchCanvasForVideoCapture:function(e){var t=[].concat(e),r=t[0];if(this.captureVideoOutputCanvasDomList=t,this.videoCaptureValue.canvasCtrl=r,!this.isSupportVideoFrameOrBitmapCapture){var i=this.videoCaptureValue.videoCtrl.videoWidth,a=this.videoCaptureValue.videoCtrl.videoHeight;t.forEach((function(e){e.width=i,e.height=a})),this.videoCaptureValue.canvasCtrl.width=i,this.videoCaptureValue.canvasCtrl.height=a,this.videoCaptureContext=r.getContext("2d")}},videoDecodeFrameBackSABRingBufferConsumeCallback:function(e){var t=new na;t.setBuffer(e);var r=t.buffer2Obj();yt(r.video_ssrc,r.data,r.video_timestamp,r.video_width,r.video_height,r.rendering_x,r.rendering_y,r.rendering_w,r.rendering_h,r.rotation,r.yuv_limited),this.VideoRenderObj.JsMediaSDK_VideoRender.bind(this.VideoRenderObj)()},consumeVideoEncodeRingbuffer:function(e){this.videoDataChannel&&this.videoDataChannel.sendVideoData(e)},audioEncodeRingBufferConsumerCallback:function(e){this.audioDataChannel&&this.audioDataChannel.sendAudioData(e)},CheckCurrentActiveSSRC:function(e){this.currentactive!=e&&(this.currentactive=e,Z.default.CurrentSSRC=this.currentactive,Z.default.decoderinworklet?Z.default.AudioNode&&Z.default.AudioNode.postCMD("currentSSRC",Z.default.CurrentSSRC):or(Z.default.CurrentSSRC))},createVideoElement:function(){this.MaskSettingVideo||(this.videoCaptureValue&&this.videoCaptureValue.videoCtrl?this.MaskSettingVideo=this.videoCaptureValue.videoCtrl:(this.MaskSettingVideo=Sh(),q.default.browser.isSafari&&(this.MaskSettingVideo.setAttribute("style","position:fixed;top:-10000px;left:-10000px;"),document.body.appendChild(this.MaskSettingVideo))))},changeVideoRenderActiveSsrc:function(e){if(!this.webrtcConfig.webrtcflag)if(this.RenderInMain==x.E){var t=Z.default.SPECIAL_ID;if(Z.default.localVideoDecMGR){var r=Z.default.localVideoDecMGR.map.get(t);if(r){var i={command:"CHANGE_CURRENT_ACTIVE_SSRC",ssrc:e};r.postMessage(i)}}}else this.RenderInMain==x.D&&this.VideoRenderObj.Change_Current_SSRC(e)},addChannelForVideo:function(){if(!this.vcFlag){this.vcFlag=!0;var e=new MessageChannel;Xt(e,e)}},checkIsRenderInWorker:function(){return this.isMultiView||this.isSupportVideoFrameOrBitmapCapture||Z.default.enableVirtualBackgroundWithoutSAB},setMultiView:function(e){e>1&&(Object(q.IsSupportWebGLOffscreenCanvas)()||q.default.isWebGL2Supported(this.isWebGL2Enabled))&&(this.isMultiView=!0)},start_capture_video_wasm:function(e){if(yr(Z.default.e2eencrypt),this.addChannelForVideo(),this.videoCaptureHiddenCanvas||this.isSupportVideoFrameOrBitmapCapture||(this.videoCaptureHiddenCanvas=q.default.isSupport2dOffscreenCanvas()?new OffscreenCanvas(640,360):document.createElement("canvas"),this.videoCaptureHiddenCanvasCtx=this.videoCaptureHiddenCanvas.getContext("2d")),!Gr())return fh.warn("not isVideoEncodeHandleReady so return"),void Q.default.add_monitor("not isVideoEncodeHandleReady so return");if(Q.default.add_monitor("STARTVIDEO:".concat(this.isStartVideoCapture)),this.isStartVideoCapture)Y.default.warn("video capture is already started, do not call again.");else{if(this.VALUE_CACHE_FOR_START_CAPTURE_VIDEO=Object.assign({},e),this.isStartVideoCapture=!0,this.bVideoEncodeMainThreadConsumerIntervalEnable&&this.videoEncodeRingbufferConsumer&&this.videoEncodeRingbufferConsumer.consume(20),this.isSupportVideoTrackReader||this.isSupportMediaStreamTrackProcessor)e.canvas instanceof Array?e.canvas[0]:e.canvas,q.default.isSelfPreviewRenderWithVideo()&&q.default.isSupportVideoFrameOrBitmapCapture()?e.video?e.videoCtrl=Object(q.parseDOMParams)(e.video).dom:this.selfPreviewVideotag&&(e.videoCtrl=this.selfPreviewVideotag):this.MaskSettingVideo?e.videoCtrl=this.MaskSettingVideo:e.videoCtrl=Sh();else if(e.canvasCtrlList=[],e.canvasCtrl=this.videoCaptureHiddenCanvas,q.default.isSelfPreviewRenderWithVideo()&&(e.video||this.selfPreviewVideotag))e.video?e.videoCtrl=Object(q.parseDOMParams)(e.video).dom:this.selfPreviewVideotag&&(e.videoCtrl=this.selfPreviewVideotag),this.isSelfViewWithVideo=!0;else if(q.default.browser.isSafari)if(this.MaskSettingVideo)e.videoCtrl=this.MaskSettingVideo;else{var t=document.createElement("video");t.setAttribute("style","position:fixed;top:-10000px;left:-10000px;"),document.body.appendChild(t),e.videoCtrl=t}else this.MaskSettingVideo?e.videoCtrl=this.MaskSettingVideo:e.videoCtrl=Sh();this.ReadyCapureWidth=e.width?e.width:640,this.ReadyCapureHeight=e.width?e.height:360,this.captureVideoOutPutVideoDom=e.videoCtrl,this.videoCaptureValue=e,this.videoCaptureValue.ssid&&(Z.default.localSsrc=this.videoCaptureValue.ssid),!Z.default.rwgAgent&&(!e.fps||24==e.fps)&&navigator.hardwareConcurrency&&navigator.hardwareConcurrency>8&&this.isSupportVideoShare&&(this.videoCaptureValue.fps=30),this.Start_Video_Capture()}},start_capture_video_webrtc:function(e){this.isStartVideoCapture?Y.default.warn("video capture is already started, do not call again."):(this.VALUE_CACHE_FOR_START_CAPTURE_VIDEO=Object.assign({},e),this.isStartVideoCapture=!0,e.videoCtrl=null,this.captureVideoOutPutVideoDom=e.videoCtrl,this.videoCaptureValue=e,this.videoCaptureValue.ssid&&(Z.default.localSsrc=this.videoCaptureValue.ssid),this.Start_Video_Capture())},add_render_video_wasm:(Ch=d()(g.a.mark((function e(t){var r,a,n,o,s,u,d,c,l,h,f,p,v,m=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=0,Object.assign(t,this.videoWaterMarkParams),void 0===t.isMyself&&(t.isMyself=this.userId&&this.userId>>10==t.userId>>10),!(q.default.isSelfPreviewRenderWithVideo()&&this.videoCaptureValue&&Object(q.Get_Logical_SSrc)(parseInt(t.userId))==Object(q.Get_Logical_SSrc)(this.videoCaptureValue.ssid)&&t.videodom)){e.next=9;break}return t.videodom.srcObject=hh.videoStream,t.videodom.play(),this.selfPreviewVideotag=t.videodom,this.isSupportVideoTrackReader||this.isSupportMediaStreamTrackProcessor?q.default.isSelfPreviewRenderWithVideo()&&q.default.isSupportVideoFrameOrBitmapCapture()&&(this.videoCaptureValue.videoCtrl=this.selfPreviewVideotag):q.default.isSelfPreviewRenderWithVideo()&&(this.videoCaptureValue.videoCtrl=this.selfPreviewVideotag,this.isSelfViewWithVideo=!0),e.abrupt("return");case 9:if(t.ssrc=t.userId,t.canvas=Object(q.parseDOMParams)(t.canvas).dom,t.canvas){e.next=14;break}return Y.default.warn("ADDRENDER:".concat(t.userId,", canvas:").concat(t.canvas)),e.abrupt("return");case 14:if(t.x=Math.floor(t.x),t.y=Math.floor(t.y),t.width=Math.floor(t.width),t.height=Math.floor(t.height),this.isCreateVideoWaterMark=t.enableWaterMark,this.videoWaterMarkName=this.isCreateVideoWaterMark?t.waterMarkText:"",this.isMultiView||t.isMyself||this.CheckCurrentActiveSSRC(t.ssrc),!this.checkIsRenderInWorker()){e.next=34;break}n=q.apiSupportUtility.getIsRenderSelfVideoInEncodeWorker(Z.default.localSsrc&&Object(q.Get_Logical_SSrc)(t.ssrc)===Object(q.Get_Logical_SSrc)(Z.default.localSsrc)),o=n?Z.default.localVideoEncMGR:Z.default.localVideoDecMGR,s=Z.default.SPECIAL_ID,u=null===(a=t.canvas)||void 0===a?void 0:a.id,this.replaceCanvasMap.videoDecodeCanvasIds||(this.replaceCanvasMap.videoDecodeCanvasIds=[]),this.replaceCanvasMap.videoEncodeCanvasIds||(this.replaceCanvasMap.videoEncodeCanvasIds=[]),n?-1===this.replaceCanvasMap.videoEncodeCanvasIds.indexOf(u)&&this.replaceCanvasMap.videoEncodeCanvasIds.push(u):-1===this.replaceCanvasMap.videoDecodeCanvasIds.indexOf(u)&&this.replaceCanvasMap.videoDecodeCanvasIds.push(u);try{o&&(d=o.map.get(s))&&(c=t.canvas.transferControlToOffscreen(),l={command:"renderOfflineCanvas",ssrc:t.ssrc,rendercanvasID:u,canvas:c,isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName,waterMarkText:t.waterMarkText,watermarkOpacity:t.watermarkOpacity,watermarkRepeated:t.watermarkRepeated,watermarkPosition:t.watermarkPosition,x:t.x,y:t.y,width:t.width,height:t.height,zone:t.zone,fillMode:t.fillMode,fillModeForResolution:t.fillModeForResolution},d.postMessage(l,[c]))}catch(e){o&&(h=o.map.get(s))&&(f={command:"renderOfflineCanvas",rendercanvasID:u,ssrc:t.ssrc,videoWaterMarkName:this.videoWaterMarkName,isCreateVideoWaterMark:this.isCreateVideoWaterMark,waterMarkText:t.waterMarkText,watermarkOpacity:t.watermarkOpacity,watermarkRepeated:t.watermarkRepeated,watermarkPosition:t.watermarkPosition,x:t.x,y:t.y,width:t.width,height:t.height,zone:t.zone,fillMode:t.fillMode,fillModeForResolution:t.fillModeForResolution},h.postMessage(f))}this.RenderInMain===x.H&&(this.RenderInMain=x.E),this.currentactive&&this.changeVideoRenderActiveSsrc(this.currentactive),e.next=56;break;case 34:if(t.isMyself||tr({command:"RenderInMain"}),v=null===(p=t.canvas)||void 0===p?void 0:p.id,!this.videoRenderArray.length){e.next=44;break}r=0;case 38:if(!(r<this.videoRenderArray.length)){e.next=44;break}if(this.videoRenderArray[r].ssrc!=t.ssrc||this.videoRenderArray[r].zone!=t.zone){e.next=41;break}return e.abrupt("return");case 41:r++,e.next=38;break;case 44:t.rendercanvasID=v,this.videoRenderArray.push(t),this.VideoRenderObj||(this.VideoRenderObj=new Pi(Object.assign({},dh(dh({Notify_APPUI:Z.default.Notify_APPUI.bind(Z.default),isSupportOffscreenCanvas:!1,jsMediaEngine:i},Z.default.enableMultiDecodeVideoWithoutSAB?{videodecodethreadnumb:x.r}:{}),{},{globalTracingLogger:Y.default,monitorLoggerFn:Q.default.add_monitor,renderManager:this.renderManager})))),this.activeSpeakerSsrc&&this.VideoRenderObj.setActiveSpeakerSsrc(this.activeSpeakerSsrc),t.canvasList&&t.canvasList.forEach((function(e){m.videoRenderArray.push(Object.assign({},t,{canvas:e}))})),fh("Start_Video_Play"),this.Start_Video_Play(),this.VideoRenderObj.Set_Render_Array(this.videoRenderArray,Z.default.enableMultiDecodeVideoWithoutSAB),this.isCreateVideoWaterMark&&!this.waterMarkCanvas&&(this.waterMarkCanvas=document.createElement("canvas")),this.VideoRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName,watermarkOpacity:t.watermarkOpacity,watermarkRepeated:t.watermarkRepeated,watermarkPosition:t.watermarkPosition}),this.RenderInMain===x.H&&(this.RenderInMain=x.D),this.currentactive&&this.changeVideoRenderActiveSsrc(this.currentactive);case 56:return e.next=58,_e(!0);case 58:case"end":return e.stop()}}),e,this)}))),function(e){return Ch.apply(this,arguments)}),add_render_video_webrtc:(yh=d()(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.wmscManager&&this.wmscManager.sendMessageToWMSC({type:"NOTIFY_WMSC_VIDEO_TAG_MAPPING",data:dh(dh({},t),{},{action:"add"})});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return yh.apply(this,arguments)}),stop_render_video_wasm:(bh=d()(g.a.mark((function e(t){var r,i,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t.canvas&&(t.canvas=null===(r=t.canvas)||void 0===r?void 0:r.id),this.videoWaterMarkName="",this.isCreateVideoWaterMark=!1,t.ssrc=t.userId,(this.isMultiView||this.isSupportVideoFrameOrBitmapCapture||Z.default.enableVirtualBackgroundWithoutSAB)&&(q.apiSupportUtility.getIsRenderSelfVideoInEncodeWorker(Z.default.localSsrc&&Object(q.Get_Logical_SSrc)(t.ssrc)===Object(q.Get_Logical_SSrc)(Z.default.localSsrc))?Zt:tr)({command:"stopVideoRender",ssrc:t.ssrc,canvas:t.canvas,RGBA:t.RGBA,doNotClean:t.doNotClean,x:t.x,y:t.y,zone:t.zone}),this.videoRenderArray.length)for(i=0;i<this.videoRenderArray.length;i++)this.videoRenderArray[i].ssrc==t.ssrc&&this.videoRenderArray[i].zone==t.zone&&(a=this.videoRenderArray.splice(i,1),this.StopUserVideoRender(this.VideoRenderObj,a,t.RGBA,!t.doNotClean));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return bh.apply(this,arguments)}),stop_render_video_webrtc:function(e){this.wmscManager&&this.wmscManager.sendMessageToWMSC({type:"NOTIFY_WMSC_VIDEO_TAG_MAPPING",data:dh(dh({},e),{},{action:"remove"})})},Notify_MeidaSDK:(Eh=d()(g.a.mark((function e(t,r){var a,n,o,s,u,d,c,l,h,f,p,v,m,_,S,E,b,y,C,A,R,I,w,T,k,D,O,P,N,V,U,L,W,B,G,F,H,j,K,X,$,ee,te,re,ie,ae,ne,oe,se,ue,de,ce,le,he,fe,pe,ve,ge,_e,Se,be,ye,Ce,Ae,Re,Ie,we,Te,ke,De,Oe,Me,xe,Pe,Ne,Ve,Ue,Le,We,Be,Ge,Fe,He,je,Ke,qe,Xe,Ye,ze,Qe,Je,Ze,$e,et,tt,rt,it,at,nt,ot,st,ut,dt,ct,lt,ht,ft,pt,vt,mt,gt,_t,St,Et,bt,yt,Ct,At,Rt,It,wt,Tt,kt,Dt,Ot,Mt,xt,Pt,Nt,Vt,Ut,Lt,Wt,Bt,Gt,Ft,Xt,$t,er,rr,ir,mr=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fh(t,r),a=0,Q.default.add_monitor2("B"+t),e.t0=t,e.next=e.t0===M.START_VIDEO_VB_SETTING?6:e.t0===M.UPDATE_VIDEO_VB_BG_IMAGE?52:e.t0===M.STOP_VIDEO_VB_SETTING?72:e.t0===M.VIDEO_MASK_SETTING?80:e.t0===M.UPDATE_MASK_CANVAS_SIZE?147:e.t0===M.UPDATE_BG_IMAGE?152:e.t0===M.UPDATE_MASK_INFO?179:e.t0===M.FINISH_MASK_SETTING?216:e.t0===M.MIRROR_MY_VIDEO?228:e.t0===M.NEW_ACTIVE_SPEAKER_SSRC?231:e.t0===M.CANCEL_NEW_ACTIVE_SPEAKER_BEFORE_CALL_BACK?233:e.t0===M.SEND_RENDER_LOG?237:e.t0===M.UPDATE_VIDEO_QUALITY?239:e.t0===M.ADD_RENDER_VIDEO?243:e.t0===M.UPDATE_CANVAS_SIZE?257:e.t0===M.ZOOM_RENDER?262:e.t0===M.STOP_RENDER_VIDEO?267:e.t0===M.SWITCH_CANVAS_FOR_VIDEO_CAPTURE?278:e.t0===M.START_CAPTURE_VIDEO?284:e.t0===M.STOP_CAPTURE_VIDEO?286:e.t0===M.ADD_RENDER_AUDIO?289:e.t0===M.STOP_RENDER_AUDIO?291:e.t0===M.PAUSE_OR_RESUME_AUDIO_DECODE?293:e.t0===M.UNMUTE_AUDIO?296:e.t0===M.MUTE_AUDIO?307:e.t0===M.START_SHARING?318:e.t0===M.STOP_SHARING?327:e.t0===M.UPDATE_SHARING_DECODE_PARAM?338:e.t0===M.CHANGE_FRAME_RATE?355:e.t0===M.CHANGE_VIDEO_RESOLUTION?356:e.t0===M.CHANGE_AUDIO_SPEAKER?357:e.t0===M.AUDIO_DENOISE_SWITCH?366:e.t0===M.CHANGE_AUDIO_PROFILE?368:e.t0===M.CHANGE_VIDEO_CAPTURE_DEVICE?403:e.t0===M.CHANGE_SHARING_2ND_VIDEO_CAPTUREVIDEO_DEVICE?414:e.t0===M.SHARE_2ND_AUDIO_CAPTURE_DEVICE?420:e.t0===M.CHANGE_CURRENT_ACTIVE_SSRC?424:e.t0===M.CHANGE_CURRENT_SHARING_ACTIVE_SSRC?427:e.t0===M.LEAVE_MEETING?430:e.t0===M.MEETING_FAIL_OVER?432:e.t0===M.END_MEDIA?434:e.t0===M.CHANGE_AUDIO_MIC?439:e.t0===M.WEBRTC_RESTART?457:e.t0===M.LEAVE_COMPUTER_AUDIO?459:e.t0===M.JOIN_COMPUTER_AUDIO?500:e.t0===M.JOIN_DESKTOP_AUDIO?696:e.t0===M.LEAVE_DESKTOP_AUDIO?756:e.t0===M.START_REMOTE_CONTROL?767:e.t0===M.CANCEL_REMOTE_CONTROL?779:e.t0===M.UPDATE_REMOTE_CONTROL_PROPERTIES?781:e.t0===M.RESEND_REMOTE_CONTROL_POSITION_PDU?783:e.t0===M.START_DESKTOP_SHARING?785:e.t0===M.STOP_DESKTOP_SHARING?801:e.t0===M.PAUSE_DESKTOP_SHARING?813:e.t0===M.RESUME_DESKTOP_SHARING?822:e.t0===M.START_STOP_REMOTE_CONTROL_CHECK?832:e.t0===M.START_SHARING_WHITEBOARD?838:e.t0===M.STOP_SHARING_WHITEBOARD?852:e.t0===M.CHECK_CHROME_SHARING_EXTENSION?861:e.t0===M.COMMAND_SOCKET_MESSAGE_NOTIFY?867:e.t0===M.USER_NODE_LIST?882:e.t0===M.AUIOD_INTERPRETATION_MUTE?885:e.t0===M.AUDIO_INTERPRETATION_SELECT_LANGUAGE?887:e.t0===M.AUDIO_INTERPRETATION_LIST_INFO?889:e.t0===M.AUDIO_INTERPRETATION_ENABLE?891:e.t0===M.VIDEO_ENABLE_DECODE_HW?893:e.t0===M.VIDEO_ENABLE_ENCODE_HW?904:"update_videohd_value"===e.t0?906:"update_videofullhd_value"===e.t0?908:e.t0===M.SET_DESKTOP_VOLUME?912:e.t0===M.USER_NODE_LIST_IN_MAIN_SESSION?914:e.t0===M.UPDATE_MEDIA_PARAMS?918:e.t0===M.SHARING_ADD_REV_CHANNEL_TYPE?922:e.t0===M.SHARING_REMOVE_REV_CHANNEL_TYPE?924:e.t0===M.BUILD_MS_CHANNEL_IN_BO?926:e.t0===M.SWITCH_WATER_MARK_FLAG?928:e.t0===M.AUDIO_CC_SELECT_LANGUAGE?931:e.t0===M.BUILD_MA_CHANNEL_IN_BO?933:e.t0===M.ENABLE_SHARE_TO_BO?935:e.t0===M.ENABLE_BROADCAST_TO_BO?937:e.t0===M.WEBGL_LOST_REPLACE_CANVAS?939:e.t0===M.CHANGE_HID_ENABLE?949:e.t0===M.ENABLE_VIDEO_OBSERVER?966:e.t0===M.SWITCH_SHARING_TYPE?968:e.t0===M.SET_OTHER_AUDIO_VOLUME_LEVEL?970:e.t0===M.USER_NODE_AUDIO_STATUS_LIST?973:e.t0===M.MOVE_PTZ_CAMERA?975:e.t0===M.NOTIFY_SDK_JOIN_RWG_SUCCESS?977:e.t0===M.ENABLE_REUSE_STREAM?980:e.t0===M.PRESET_MEDIA_CONSTRAINTS?982:e.t0===M.DESTORY_REUSE_STREAM?984:e.t0===M.WHITEBOARD_JOIN_MESSAGE?986:e.t0===M.STOP_AUDIO_INCOMING?989:e.t0===M.MOBILE_ROTATE?991:e.t0===M.SAVE_LOCAL_LOG?996:e.t0===M.AUDIO_JOIN_SUCCESS?998:e.t0===M.REMOVE_EXPIRED_CANVAS?1e3:e.t0===M.UI_SUBSCRIBE_VIDEO?1004:e.t0===M.UI_UNSUBSCRIBE_VIDEO?1006:e.t0===M.ON_HOLD?1008:1021;break;case 6:if(!this.webrtcConfig.webrtcflag){e.next=8;break}return e.abrupt("return");case 8:if((n=this).isVBSettingOn=!0,n.isCurrentInMaskStatus=!1,o=r.width?r.width:640,s=r.height?r.height:360,n.videoCaptureWidth?n.videoCaptureWidth=n.videoCaptureWidth:n.videoCaptureWidth=o,n.videoCaptureHeight?n.videoCaptureHeight=n.videoCaptureHeight:n.videoCaptureHeight=s,Zt({command:"StartVBSetting"}),!r.bgdom){e.next=31;break}if(this.VBMFlag||(this.VBMFlag=!0,_r(x.N)),"blur"!=r.bgdom){e.next=24;break}Zt({command:"vbbgimagebitmap",data:r.bgdom}),e.next=31;break;case 24:if((u=Object(q.parseDOMParams)(r.bgdom).dom)&&u.naturalWidth&&u.naturalHeight){e.next=29;break}return Q.default.add_monitor("VBGF"),Z.default.Notify_APPUI(M.VIDEO_VB_SETTING_PARA_ERROR,2),e.abrupt("return");case 29:n.BgImage=u,createImageBitmap(u).then((function(e){Yr(e,"BgImage")})).catch((function(e){Q.default.add_monitor("VBCF"),Z.default.Notify_APPUI(M.VIDEO_VB_SETTING_PARA_ERROR,2)}));case 31:if(!r.canvas){e.next=39;break}if(d=Object(q.parseDOMParams)(r.canvas),c=d.id,l=d.dom,n.VideoVBSettingCanvas=l,!(!n.VideoVBSettingCanvas||n.VideoVBSettingCanvas.width<=0||n.VideoVBSettingCanvas.height<=0)){e.next=38;break}return Q.default.add_monitor("VBCAF"),Z.default.Notify_APPUI(M.VIDEO_VB_SETTING_PARA_ERROR,3),e.abrupt("return");case 38:try{Fr(n.VideoVBSettingCanvas.transferControlToOffscreen(),"VBOfflineCanvas",c)}catch(e){Fr(null,"VBOfflineCanvas",c)}case 39:if(n.isSupportVideoFrameOrBitmapCapture||(n.createVideoElement(),n.videoCaptureHiddenCanvas||(n.videoCaptureHiddenCanvas=q.default.isSupport2dOffscreenCanvas()?new OffscreenCanvas(640,360):document.createElement("canvas"),n.videoCaptureHiddenCanvasCtx=n.videoCaptureHiddenCanvas.getContext("2d"))),!hh.shouldCaptureVideo()){e.next=50;break}if(Gr()){e.next=45;break}return fh.warn("not isVideoEncodeHandleReady so return"),Q.default.add_monitor("not isVideoEncodeHandleReady so return"),e.abrupt("return");case 45:n.videoCaptureValue?n.videoCaptureValue=Object.assign(n.videoCaptureValue,r):n.videoCaptureValue=r,n.videoCaptureValue.ssid&&(Z.default.localSsrc=n.videoCaptureValue.ssid),n.StartVideoMediaCapture(),e.next=51;break;case 50:n.MaskSettingVideo&&hh.playVideoStream(n.MaskSettingVideo);case 51:return e.abrupt("break",1022);case 52:if(!this.webrtcConfig.webrtcflag){e.next=54;break}return e.abrupt("return");case 54:if(!r.bgdom){e.next=69;break}if(this.VBMFlag||(this.VBMFlag=!0,_r(x.N)),"blur"!=r.bgdom){e.next=60;break}Zt({command:"vbbgimagebitmap",data:r.bgdom}),e.next=67;break;case 60:if((h=Object(q.parseDOMParams)(r.bgdom).dom)&&h.width&&h.height){e.next=65;break}return Q.default.add_monitor("VBGF"),Z.default.Notify_APPUI(M.VIDEO_VB_SETTING_PARA_ERROR,2),e.abrupt("return");case 65:this.BgImage=h,createImageBitmap(h).then((function(e){Yr(e,"BgImage")})).catch((function(e){Q.default.add_monitor("VBCF"),Z.default.Notify_APPUI(M.VIDEO_VB_SETTING_PARA_ERROR,2)}));case 67:e.next=71;break;case 69:this.BgImage=null,Yr(null,"BgImage");case 71:return e.abrupt("break",1022);case 72:if(!this.webrtcConfig.webrtcflag){e.next=74;break}return e.abrupt("return");case 74:return this.isVBSettingOn=!1,r.isSwitch&&(this.isMaskSettingOn=!0,Zt({command:"StartMaskSetting",isSwitch:r.isSwitch,enabled:this.isSupportVideoFrameOrBitmapCapture})),Zt({command:"finishVBSetting"}),this.isStartVideoCapture||this.isMaskSettingOn||this.Stop_Video_Capture(),this.MaskSettingVideo&&this.MaskSettingVideo.pause(),e.abrupt("break",1022);case 80:if(!this.webrtcConfig.webrtcflag){e.next=82;break}return e.abrupt("return");case 82:if(!this.isMaskSettingStarted){e.next=84;break}return e.abrupt("return");case 84:if(this.isMaskSettingStarted=!0,(f=this).isCurrentInMaskStatus=!0,f.isMaskSettingOn=!0,p=r.width?r.width:640,v=r.height?r.height:360,f.ReadyCapureWidth=p,f.ReadyCapureHeight=v,f.videoCaptureWidth?f.videoCaptureWidth=f.videoCaptureWidth:f.videoCaptureWidth=p,f.videoCaptureHeight?f.videoCaptureHeight=f.videoCaptureHeight:f.videoCaptureHeight=v,m=0,_=0,!r.canvas){e.next=108;break}if(S=Object(q.parseDOMParams)(r.canvas),E=S.dom,b=S.id,f.VideoMaskSettingCanvas=E,f.PrevVideoMaskSettingCanvas=f.VideoMaskSettingCanvas,f.replaceCanvasMap.videoMaskSettingCanvasId=b,!(!f.VideoMaskSettingCanvas||f.VideoMaskSettingCanvas.width<=0||f.VideoMaskSettingCanvas.height<=0)){e.next=106;break}return Z.default.Notify_APPUI(M.MASK_SETTING_PARA_ERROR,3),e.abrupt("return");case 106:m=r.originWidth||f.VideoMaskSettingCanvas.width,_=r.originHeight||f.VideoMaskSettingCanvas.height;case 108:if(!r.maskdom){e.next=121;break}if((y=Object(q.parseDOMParams)(r.maskdom).dom)&&y.width&&y.height){e.next=113;break}return Z.default.Notify_APPUI(M.MASK_SETTING_PARA_ERROR,1),e.abrupt("return");case 113:C=1,0==m||0==_||m==f.VideoMaskSettingCanvas.width&&_==f.VideoMaskSettingCanvas.height||(C=Math.min(1*f.VideoMaskSettingCanvas.width/m,1*f.VideoMaskSettingCanvas.height/_)),f.MaskImage=y,f.maskCoordinate.dx=r.dx?Math.round(r.dx*C):f.maskCoordinate.dx,f.maskCoordinate.dy=r.dy?Math.round(r.dy*C):f.maskCoordinate.dy,f.maskCoordinate.dWidth=r.dWidth?Math.round(r.dWidth*C):f.maskCoordinate.dWidth,f.maskCoordinate.dHeight=r.dHeight?Math.round(r.dHeight*C):f.maskCoordinate.dHeight,f.isSupportVideoFrameOrBitmapCapture&&createImageBitmap(y).then((function(e){zr(e,"MaskImage",f.maskCoordinate,f.videoCaptureWidth,f.videoCaptureHeight)})).catch((function(e){Z.default.Notify_APPUI(M.MASK_SETTING_PARA_ERROR,1)}));case 121:if(!r.bgdom){e.next=129;break}if((A=Object(q.parseDOMParams)(r.bgdom).dom)&&A.naturalWidth&&A.naturalHeight){e.next=127;break}return Q.default.add_monitor("VMGF"),Z.default.Notify_APPUI(M.MASK_SETTING_PARA_ERROR,2),e.abrupt("return");case 127:f.BgImage=A,f.isSupportVideoFrameOrBitmapCapture&&createImageBitmap(A).then((function(e){Xr(e,"BgImage")})).catch((function(e){Q.default.add_monitor("VMCF"),Z.default.Notify_APPUI(M.MASK_SETTING_PARA_ERROR,2)}));case 129:if(f.isSupportVideoFrameOrBitmapCapture||f.createVideoElement(),this.VideoMaskCanvasFillMode=r.fillMode?1:0,Zt({command:"StartMaskSetting",fillMode:this.VideoMaskCanvasFillMode,enabled:this.isSupportVideoFrameOrBitmapCapture}),hh.shouldCaptureVideo()){e.next=137;break}f.MaskSettingVideo&&hh.playVideoStream(f.MaskSettingVideo),f.isMaskSettingOn&&Z.default.Notify_APPUI(M.START_VIDEO_STREAM_IN_MASK_SETTING_SUCCESS,null),e.next=145;break;case 137:if(f.videoCaptureHiddenCanvas||f.isSupportVideoFrameOrBitmapCapture||(f.videoCaptureHiddenCanvas=q.default.isSupport2dOffscreenCanvas()?new OffscreenCanvas(640,360):document.createElement("canvas"),f.videoCaptureHiddenCanvasCtx=f.videoCaptureHiddenCanvas.getContext("2d")),Gr()){e.next=142;break}return fh.warn("not isVideoEncodeHandleReady so return"),Q.default.add_monitor("not isVideoEncodeHandleReady so return"),e.abrupt("return");case 142:f.videoCaptureValue?f.videoCaptureValue=Object.assign(f.videoCaptureValue,r):f.videoCaptureValue=r,f.videoCaptureValue.ssid&&(Z.default.localSsrc=f.videoCaptureValue.ssid),f.StartVideoMediaCapture();case 145:if(f.isSupportVideoFrameOrBitmapCapture||q.default.isSupportVideoFrameOrBitmapCapture()&&q.default.isSelfPreviewRenderWithVideo())try{Fr(f.VideoMaskSettingCanvas.transferControlToOffscreen(),"MaskOfflineCanvas",f.replaceCanvasMap.videoMaskSettingCanvasId)}catch(e){Fr(null,"MaskOfflineCanvas",f.replaceCanvasMap.videoMaskSettingCanvasId)}else f.Update_Mask_Texture(f.maskCoordinate,f.videoCaptureWidth,f.videoCaptureHeight);return e.abrupt("break",1022);case 147:if(!this.webrtcConfig.webrtcflag){e.next=149;break}return e.abrupt("return");case 149:return R=Object(q.parseDOMParams)(r.canvas),I=R.id,w=R.dom,this.isSupportImageCapture||q.default.isSupportImageCapture()&&q.default.isSelfPreviewRenderWithVideo()?(T=Z.default.SPECIAL_ID,Z.default.localVideoEncMGR&&(k=Z.default.localVideoEncMGR.map.get(T))&&(D={command:"update_mask_canvas_size",rendercanvasID:I,width:r.width,height:r.height},k.postMessage(D))):(r.canvas=w,r.canvas&&(r.canvas.width=r.width,r.canvas.height=r.height)),e.abrupt("break",1022);case 152:if(!this.webrtcConfig.webrtcflag){e.next=154;break}return e.abrupt("return");case 154:if(!this.isSupportVideoFrameOrBitmapCapture){e.next=168;break}if(!r.bgdom){e.next=164;break}if((O=Object(q.parseDOMParams)(r.bgdom).dom)&&O.width&&O.height){e.next=160;break}return Z.default.Notify_APPUI(M.MASK_SETTING_PARA_ERROR,2),e.abrupt("return");case 160:this.BgImage=O,createImageBitmap(O).then((function(e){Xr(e,"BgImage")})).catch((function(e){Z.default.Notify_APPUI(M.MASK_SETTING_PARA_ERROR,2)})),e.next=166;break;case 164:this.BgImage=null,Xr(null,"BgImage");case 166:e.next=178;break;case 168:if(!r.bgdom){e.next=176;break}if((P=Object(q.parseDOMParams)(r.bgdom).dom)&&P.width&&P.height){e.next=173;break}return Z.default.Notify_APPUI(M.MASK_SETTING_PARA_ERROR,2),e.abrupt("return");case 173:this.BgImage=P,e.next=177;break;case 176:this.BgImage=null;case 177:this.Update_Mask_Texture(this.maskCoordinate,this.videoCaptureWidth,this.videoCaptureHeight);case 178:return e.abrupt("break",1022);case 179:if(!this.webrtcConfig.webrtcflag){e.next=181;break}return e.abrupt("return");case 181:if(this.maskCoordinate.dx=r.dx,this.maskCoordinate.dy=r.dy,this.maskCoordinate.dWidth=r.dWidth,this.maskCoordinate.dHeight=r.dHeight,!this.isSupportVideoFrameOrBitmapCapture){e.next=205;break}if(!r.maskdom){e.next=198;break}if((N=Object(q.parseDOMParams)(r.maskdom).dom)&&N.width&&N.height){e.next=191;break}return Z.default.Notify_APPUI(M.MASK_SETTING_PARA_ERROR,1),e.abrupt("return");case 191:this.MaskImage=N,V=this.maskCoordinate,U=this.videoCaptureWidth,L=this.videoCaptureHeight,createImageBitmap(N).then((function(e){zr(e,"MaskImage",V,U,L)})).catch((function(e){Z.default.Notify_APPUI(M.MASK_SETTING_PARA_ERROR,1)})),e.next=203;break;case 198:this.MaskImage=null,W=this.maskCoordinate,B=this.videoCaptureWidth,G=this.videoCaptureHeight,zr(null,"MaskImage",W,B,G);case 203:e.next=215;break;case 205:if(!r.maskdom){e.next=213;break}if((F=Object(q.parseDOMParams)(r.maskdom).dom)&&F.width&&F.height){e.next=210;break}return Z.default.Notify_APPUI(M.MASK_SETTING_PARA_ERROR,1),e.abrupt("return");case 210:this.MaskImage=F,e.next=214;break;case 213:this.MaskImage=null;case 214:this.Update_Mask_Texture(this.maskCoordinate,this.videoCaptureWidth,this.videoCaptureHeight);case 215:return e.abrupt("break",1022);case 216:if(!this.webrtcConfig.webrtcflag){e.next=218;break}return e.abrupt("return");case 218:return this.isMaskSettingStarted=!1,this.isMaskSettingOn=!1,this.BgImage||(this.isCurrentInMaskStatus=!1),r.isSwitch&&(this.isVBSettingOn=!0,Zt({command:"StartVBSetting",isSwitch:r.isSwitch})),this.MaskSettingVideo&&this.MaskSettingVideo.pause(),this.VideoMaskSettingCanvas&&(this.VideoMaskSettingCanvasctx&&(this.VideoMaskSettingCanvasctx.setTransform(1,0,0,1,0,0),this.VideoMaskSettingCanvasctx.clearRect(0,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height),this.VideoMaskSettingCanvasctx=null),this.VideoMaskSettingCanvas=null),this.isCanvasScaled=!1,Zt({command:"finishMaskSetting"}),this.isStartVideoCapture||this.isVBSettingOn||this.Stop_Video_Capture(),e.abrupt("break",1022);case 228:return this.isMirrorMyVideo=r.isMirrorMyVideo,this.webrtcConfig.webrtcflag?this.wmscManager&&this.wmscManager.mirrorSelfVideo(this.isMirrorMyVideo):(Zt({command:"mirrorMyVideo",isMirrorMyVideo:this.isMirrorMyVideo}),this.isSupportOffscreenCanvas?(this.VideoRenderObj&&this.VideoRenderObj.setMirrorMyVideoOption(this.isMirrorMyVideo),tr({command:"mirrorMyVideo",isMirrorMyVideo:this.isMirrorMyVideo,isSupportOffscreenCanvas:this.isSupportOffscreenCanvas})):(this.VideoRenderObj||(this.VideoRenderObj=new Pi(Object.assign({},dh(dh({Notify_APPUI:Z.default.Notify_APPUI.bind(Z.default),isSupportOffscreenCanvas:!1,jsMediaEngine:i,globalTracingLogger:Y.default,monitorLoggerFn:Q.default.add_monitor},Z.default.enableMultiDecodeVideoWithoutSAB?{videodecodethreadnumb:x.r}:{}),{},{renderManager:this.renderManager}))),this.activeSpeakerSsrc&&this.VideoRenderObj.setActiveSpeakerSsrc(this.activeSpeakerSsrc)),this.VideoRenderObj.setMirrorMyVideoOption(this.isMirrorMyVideo))),e.abrupt("break",1022);case 231:return this.webrtcConfig.webrtcflag?this.wmscManager&&this.wmscManager.sendMessageToWMSC({type:"NOTIFY_SDK_ACTIVE_VIDEO_INDICATION",data:{userId:r.ssrc}}):(Q.default.add_monitor("ACTIVESSRC:".concat(r.ssrc)),Wr(J.f.VIDEO_DECODE,{ssrc:r.ssrc},"newActiveSpeakerSsrc",!1,!0),this.RenderInMain==x.D&&(null===(H=this.VideoRenderObj)||void 0===H||H.setActiveSpeakerSsrc(r.ssrc)),this.activeSpeakerSsrc=r.ssrc),e.abrupt("break",1022);case 233:return Q.default.add_monitor("CANCELACTIVE:".concat(r.ssrc)),tr({command:"cancelNewActiveSpeakerSsrcBefreCallback",ssrc:r.ssrc,haddata:r.haddata}),this.activeSpeakerSsrc=0,e.abrupt("break",1022);case 237:return Q.default.add_monitor(r.message),e.abrupt("break",1022);case 239:if(Z.default.rwgAgent){e.next=241;break}return e.abrupt("break",1022);case 241:return this.userId!=r.userId&&Z.default.sendMessageToRwg(M.SUBSCRIBE_VIDEO,{evt:12303,seq:1,body:{subInfoList:[{id:Number(r.userId),size:Number(r.videoQuality),bOn:!1}]}}),e.abrupt("break",1022);case 243:if(Q.default.add_monitor("ADDRENDER:".concat(r.userId)),!this.webrtcConfig.webrtcflag){e.next=254;break}if(!this.videoCaptureValue||Object(q.Get_Logical_SSrc)(parseInt(r.userId))!=Object(q.Get_Logical_SSrc)(this.videoCaptureValue.ssid)){e.next=250;break}return r.videodom.srcObject=hh.videoStream,this.wmscManager&&(this.wmscManager.selfVideoDom=r.videodom,this.wmscManager.playSelfVideo("addRenderVideo")),this.webrtcConfig.userId=parseInt(r.userId),e.abrupt("return");case 250:return e.next=252,this.add_render_video_webrtc(r);case 252:e.next=256;break;case 254:return e.next=256,this.add_render_video_wasm(r);case 256:return e.abrupt("break",1022);case 257:return j=Object(q.parseDOMParams)(r.canvas),K=j.id,X=j.dom,Object(q.CheckCanvasSize)(r.width,r.height),this.isMultiView||this.isSupportVideoFrameOrBitmapCapture||Z.default.enableVirtualBackgroundWithoutSAB?(T=Z.default.SPECIAL_ID,$=null,Z.default.localVideoEncMGR&&Z.default.enableVirtualBackgroundWithoutSAB&&($=Z.default.localVideoEncMGR.map.get(T)),Z.default.localVideoDecMGR&&(k=Z.default.localVideoDecMGR.map.get(T))&&(D={command:"update_canvas_size",rendercanvasID:K,width:r.width,height:r.height},k.postMessage(D),$&&$.postMessage(D))):(r.canvas=X,r.canvas&&(r.canvas.width=r.width,r.canvas.height=r.height)),this.UpdateVideoPlayStatus(!0),e.abrupt("break",1022);case 262:if(Q.default.add_monitor("ZOOMRENDER:".concat(r.userId)),"string"!=typeof r.canvas&&(r.canvas=r.canvas.id),(this.isMultiView||this.isSupportVideoFrameOrBitmapCapture||Z.default.enableVirtualBackgroundWithoutSAB)&&(ee=q.apiSupportUtility.getIsRenderSelfVideoInEncodeWorker(Z.default.localSsrc&&Object(q.Get_Logical_SSrc)(r.userId)===Object(q.Get_Logical_SSrc)(Z.default.localSsrc)),te=Z.default.SPECIAL_ID,k=null,ee&&Z.default.localVideoEncMGR?k=Z.default.localVideoEncMGR.map.get(te):Z.default.localVideoDecMGR&&(k=Z.default.localVideoDecMGR.map.get(te)),k&&(D={command:"zoomrender",ssrc:r.userId,x:r.x,y:r.y,width:r.width,height:r.height,canvas:r.canvas,zone:r.zone,RGBA:r.RGBA},k.postMessage(D))),this.videoRenderArray.length)for(a=0;a<this.videoRenderArray.length;a++)this.videoRenderArray[a].ssrc==r.userId&&this.videoRenderArray[a].zone==r.zone&&(this.videoRenderArray[a].x=r.x,this.videoRenderArray[a].y=r.y,this.videoRenderArray[a].width=r.width,this.videoRenderArray[a].height=r.height);return e.abrupt("break",1022);case 267:if(Q.default.add_monitor("RMRENDER:".concat(r.userId)),!this.webrtcConfig.webrtcflag){e.next=275;break}if(Object(q.Get_Logical_SSrc)(parseInt(r.userId))!=Object(q.Get_Logical_SSrc)(this.webrtcConfig.userId)){e.next=272;break}return this.wmscManager&&(this.wmscManager.selfVideoDom=null),e.abrupt("return");case 272:this.stop_render_video_webrtc(r),e.next=277;break;case 275:return e.next=277,this.stop_render_video_wasm(r);case 277:return e.abrupt("break",1022);case 278:if(re=null,q.default.isSelfPreviewRenderWithVideo()&&(ie=r instanceof Array?r[0]:r,re=ie instanceof HTMLVideoElement?ie:Object(q.parseDOMParams)(ie).dom),this.videoCaptureValue){e.next=282;break}return e.abrupt("break",1022);case 282:return q.default.isSelfPreviewRenderWithVideo()&&re&&re instanceof HTMLVideoElement?(this.videoCaptureValue.videoCtrl&&this.videoloadedmetadatahandle&&this.videoCaptureValue.videoCtrl.removeEventListener("loadedmetadata",this.videoloadedmetadatahandle),this.videoCaptureValue.videoCtrl&&!this.videoCaptureValue.videoCtrl.paused&&this.videoCaptureValue.videoCtrl.pause(),this.videoCaptureValue.videoCtrl&&this.videoCaptureValue.videoCtrl.srcObject&&(this.videoCaptureValue.videoCtrl.srcObject=null),this.videoCaptureValue.videoCtrl&&this.videoCaptureValue.videoCtrl.src&&(this.videoCaptureValue.videoCtrl.src=null),this.videoCaptureValue.videoCtrl=re,this.captureVideoOutPutVideoDom=re,this.isVideoCaptureLoadedmetadata||(Y.default.warn("isVideoCaptureLoadedmetadata is false ,need to reloaded"),this.videoloadedmetadatahandle=this._videoloadedmetadata.bind(this),this.videoCaptureValue.videoCtrl.addEventListener("loadedmetadata",this.videoloadedmetadatahandle)),hh.playVideoStream(this.videoCaptureValue.videoCtrl)):(ae=[],r instanceof Array?ae=r:ae.push(r),ne=this.videoCaptureValue.canvasCtrlList,oe=ne.filter((function(e){return-1!==ae.indexOf(e.k)})).map((function(e){return e.dom})),this.switchCanvasForVideoCapture(oe)),e.abrupt("break",1022);case 284:return this.webrtcConfig.webrtcflag?this.start_capture_video_webrtc(r):this.start_capture_video_wasm(r),e.abrupt("break",1022);case 286:return se=this,e.abrupt("return",new Promise((function(e,t){try{if(hh.isCaptureVideoInProgress)return Z.default.Notify_APPUI(M.STOP_VIDEO_CAPTURE_FAILED,null),t(new Error("Too many calls : the device is opening camera now, cannot stop video capture"));se.isStartVideoCapture&&se.Stop_Video_Capture(),Z.default.Notify_APPUI(M.STOP_VIDEO_CAPTURE_SUCCESS,null),e(!0)}catch(e){Z.default.Notify_APPUI(M.STOP_VIDEO_CAPTURE_FAILED,null),t(e)}Z.default.extVBPort&&Z.default.extVBPort.postMessage({type:M.UNIFIED_VB_PAUSE})})));case 289:return 0==this.audioRenderArray.length&&(this.audioRenderArray.push(r),this.Start_Audio_Play()),e.abrupt("break",1022);case 291:if(this.audioRenderArray.length>0)for(this.Stop_Audio_Play(),a=0;a<this.audioRenderArray.length;a++)this.audioRenderArray[a].ssrc==r.ssrc&&this.audioRenderArray.splice(a,1);return e.abrupt("break",1022);case 293:return e.next=295,Wr(J.f.AUDIO_DECODE,{bPause:r.bPause},"PAUSE_OR_RESUME_AUDIO_DECODE",!1,!0);case 295:return e.abrupt("break",1022);case 296:if(this.captureAudioMuted=!1,this.audioInputLevel&&this.audioInputLevel.start(),this.useAudioBridge&&this.audioBridge&&this.audioBridge.unmute(),!r.issiphone){e.next=305;break}if(!this.WebSipClient){e.next=303;break}return this.WebSipClient.unmute(),e.abrupt("return");case 303:e.next=306;break;case 305:this.UnMuteAudio();case 306:return e.abrupt("break",1022);case 307:if(this.captureAudioMuted=!0,this.audioInputLevel&&this.audioInputLevel.stop(),this.useAudioBridge&&this.audioBridge&&this.audioBridge.mute(),!r.issiphone){e.next=316;break}if(!this.WebSipClient){e.next=314;break}return this.WebSipClient.mute(),e.abrupt("return");case 314:e.next=317;break;case 316:this.MuteAudio();case 317:return e.abrupt("break",1022);case 318:if(this.sharingCanvasList.includes(r.canvas.id)||this.sharingCanvasList.push(r.canvas.id),Object.assign(r,this.sharingWaterMarkParams),this.isSupportVideoShare?ar({command:"startSharingRender"}):nr({command:"startSharingRender"}),this.currentshareactive=r.ssrc,null==this.currentshareactive&&Q.default.add_monitor2("SSRC"),this.isCreateSharingWaterMark=r.enableWaterMark,this.sharingWaterMarkName=this.isCreateSharingWaterMark?r.waterMarkText:"",this.isSupportOffscreenCanvas){this.RenderInMain===x.H&&(this.RenderInMain=x.E);try{T=Z.default.SPECIAL_ID,this.replaceCanvasMap.sharingMainCanvasId=r.canvas.id,k=null,this.isSupportVideoShare?Z.default.localVideoDecMGR&&(k=Z.default.localVideoDecMGR.map.get(T)):Z.default.localSharingDecMGR&&(k=Z.default.localSharingDecMGR.map.get(T)),k&&(this.sharingRenderCanvas=r.canvas.transferControlToOffscreen(),Object(q.CheckCanvasSize)(r.canvas.width,r.canvas.height),D={command:"sharingRenderCanvas",canvas:this.sharingRenderCanvas,rendercanvasID:this.replaceCanvasMap.sharingMainCanvasId,ssrc:this.currentshareactive,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:r.watermarkOpacity,watermarkRepeated:r.watermarkRepeated,isFromMainSession:r.isFromMainSession,watermarkPosition:r.watermarkPosition},k.postMessage(D,[D.canvas]))}catch(e){T=Z.default.SPECIAL_ID,k=null,this.isSupportVideoShare?Z.default.localVideoDecMGR&&(k=Z.default.localVideoDecMGR.map.get(T)):Z.default.localSharingDecMGR&&(k=Z.default.localSharingDecMGR.map.get(T)),k&&(D={command:"sharingRenderCanvas",rendercanvasID:this.replaceCanvasMap.sharingMainCanvasId,ssrc:this.currentshareactive,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:r.watermarkOpacity,watermarkRepeated:r.watermarkRepeated,isFromMainSession:r.isFromMainSession,watermarkPosition:r.watermarkPosition},k.postMessage(D))}}else this.RenderInMain===x.H&&(this.RenderInMain=x.D),this.SharingRenderObj||(this.SharingRenderObj=new Wi(Object.assign({},{Notify_APPUI:Z.default.Notify_APPUI.bind(Z.default),PubSub:z.a,jsMediaEngine:i,globalTracingLogger:Y.default,renderManager:this.renderManager}))),this.renderManager.getRendererProvider().isWebGLRendererType()?this.sharingDisplay=new zi(r.canvas,r.canvas.id,0,void 0,{preserveDrawingBuffer:!1}):this.renderManager.getRendererProvider().isWebGL2RendererType()&&(this.sharingDisplay=new ra(r.canvas,r.canvas.id,0,void 0,{preserveDrawingBuffer:!1})),this.SharingRenderObj.Set_Render_Display(this.sharingDisplay),this.SharingRenderObj.Change_Current_SSRC(this.currentshareactive,r.isFromMainSession),this.isCreateSharingWaterMark&&!this.waterMarkCanvas&&(this.waterMarkCanvas=document.createElement("canvas")),this.SharingRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:r.watermarkOpacity,watermarkRepeated:r.watermarkRepeated,watermarkPosition:r.watermarkPosition}),this.sharingInterval||(this.sharingInterval=this.JsMediaSDK_SharingRenderInterval(this.sharingIntervalTime,r.isVideoShare)),Ee(!0);return e.abrupt("break",1022);case 327:if(r.canvas?-1!==(ue=this.sharingCanvasList.indexOf(r.canvas.id))&&this.sharingCanvasList.splice(ue,1):this.sharingCanvasList=[],0===this.sharingCanvasList.length){e.next=330;break}return e.abrupt("return");case 330:return Ee(!1),this.isSupportVideoShare?ar({command:"stopSharingRender"}):nr({command:"stopSharingRender"}),this.isCreateSharingWaterMark=!1,this.sharingWaterMarkName="",this.sharingInterval&&(clearInterval(this.sharingInterval),this.sharingInterval=0),this.sharingDisplay&&(this.sharingDisplay.clear(),this.sharingDisplay.cleanup(),this.sharingDisplay=null),this.SharingRenderObj&&(this.SharingRenderObj.ClearQueue(),this.SharingRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName})),e.abrupt("break",1022);case 338:if(de=r.width,ce=r.height,!(le=r.canvas)||!le.id||this.sharingCanvasList.includes(le.id)){e.next=341;break}return e.abrupt("return");case 341:if(fh("UPDATE_SHARING_DECODE_PARAM",r),this.SharingRenderObj?this.SharingRenderObj.Update_Sharing_Canvas_Size({width:de,height:ce}):this.isSupportVideoShare?ar({command:"UPDATE_SHARING_CANVAS_SIZE",width:de,height:ce}):nr({command:"UPDATE_SHARING_CANVAS_SIZE",width:de,height:ce}),!Jr()){e.next=346;break}return Object(q.CheckCanvasSize)(de,ce),e.abrupt("return",fh("isSharingNotClearChromeVersion",Jr()));case 346:if(Z.default.rwgAgent){e.next=348;break}return e.abrupt("break",1022);case 348:if(!this.isSupportVideoShare){e.next=352;break}ar({command:"SET_OFFSCREENCANVAS_WIDTH_HEIGHT",data:{width:de,height:ce}}),e.next=354;break;case 352:return e.next=354,Wr(J.f.SHARING_DECODE,{width:de,height:ce},"SET_OFFSCREENCANVAS_WIDTH_HEIGHT",!1,!0);case 354:case 355:case 356:return e.abrupt("break",1022);case 357:if(r.AudioSelectValue){e.next=360;break}return Z.default.Notify_APPUI(M.AUDIO_SPEAKER_SET_ERROR,"value.AudioSelectValue is null"),e.abrupt("return");case 360:if(he=Date.now(),!this.useAudioBridge||!this.audioBridge){e.next=364;break}return this.audioBridge.changeSpeaker(r.AudioSelectValue),e.abrupt("return");case 364:return this.selectComputerAudioSpeaker(r.AudioSelectValue,he),e.abrupt("break",1022);case 366:return ya.changeDenoiseSwitch(r.switch),e.abrupt("break",1022);case 368:if(pe=null===(fe=this.audioCapture)||void 0===fe?void 0:fe.audioProfile){e.next=371;break}return e.abrupt("break",1022);case 371:if(this.audioCapture.audioProfile=r,"backgroundNoiseSuppression"!==r.currentSelect){e.next=394;break}if("backgroundNoiseSuppression"===pe.currentSelect){e.next=383;break}if(ve={command:"original_sound_switch",enable:!1,highfidelity:!1,stereo:!1},!this.audioBridge){e.next=380;break}return e.next=378,this.audioBridge.setAudioProfile(r);case 378:e.next=381;break;case 380:sr(ve);case 381:hh.destoryAudioMediaStream(),this.Start_Audio_Capture();case 383:if(pe.highBitrate===r.highBitrate){e.next=390;break}if(!this.audioBridge){e.next=389;break}return e.next=387,this.audioBridge.setAudioProfile(r);case 387:e.next=390;break;case 389:sr({command:"highBitrate",highBitrate:r.highBitrate?1:0});case 390:ge="Zoom"===r.backgroundNoiseSuppression,ya.changeDenoiseSwitch(ge),e.next=402;break;case 394:if(Se={command:"original_sound_switch",enable:!0,highfidelity:r.originalSound.highfidelity,stereo:r.originalSound.stereo},!this.audioBridge){e.next=400;break}return e.next=398,this.audioBridge.setAudioProfile(r);case 398:e.next=401;break;case 400:sr(Se);case 401:"originalSound"===pe.currentSelect&&(null===(_e=pe.originalSound)||void 0===_e?void 0:_e.stereo)===r.originalSound.stereo||(hh.destoryAudioMediaStream(),this.Start_Audio_Capture());case 402:return e.abrupt("break",1022);case 403:if(Ae=Object.assign({},this.VALUE_CACHE_FOR_START_CAPTURE_VIDEO,r),!this.isSupportVideoTrackReader&&!this.isSupportMediaStreamTrackProcessor){if(Ae.canvasCtrlList=[],Ae.canvas instanceof Array)for(a=0;a<Ae.canvas.length;a++)Ae.canvasCtrlList.push({k:Ae.canvas[a],dom:Object(q.parseDOMParams)(Ae.canvas[a]).dom});else Ae.canvasCtrlList.push({k:Ae.canvas,dom:Object(q.parseDOMParams)(Ae.canvas).dom});Ae.canvasCtrl=Ae.canvasCtrlList[0].dom}return Ae.videoCtrl=this.captureVideoOutPutVideoDom,null!==(be=this.videoCaptureValue)&&void 0!==be&&be.videoCtrl&&this.videoloadedmetadatahandle&&this.videoCaptureValue.videoCtrl.removeEventListener("loadedmetadata",this.videoloadedmetadatahandle),this.isVideoCaptureLoadedmetadata=!1,hh.destoryVideoMediaStream(),this.videoCaptureValue=Ae,null!==(ye=this.videoCaptureValue.videoCtrl)&&void 0!==ye&&ye.srcObject&&(this.videoCaptureValue.videoCtrl.srcObject=null),null!==(Ce=this.videoCaptureValue.videoCtrl)&&void 0!==Ce&&Ce.src&&(this.videoCaptureValue.videoCtrl.src=null),this.StartVideoMediaCapture(),e.abrupt("break",1022);case 414:return r.canvas&&(r.rendercanvasID=r.canvas),Re=Object.assign({},this.desktopSharingValue,r),this.EndSharingMediaStream(),this.desktopSharingValue=Re,this.StartDesktopMediaCapture(),e.abrupt("break",1022);case 420:return this.EndSharingMediaStream(),this.desktopSharingValue=r,this.StartDesktopMediaCapture(),e.abrupt("break",1022);case 424:return this.currentactive!=r.ssrc&&(this.currentactive=r.ssrc,Z.default.CurrentSSRC=this.currentactive,this.changeVideoRenderActiveSsrc(this.currentactive)),or(Z.default.CurrentSSRC),e.abrupt("break",1022);case 427:return this.currentshareactive!=r.ssrc&&(this.currentshareactive=r.ssrc),this.isSupportOffscreenCanvas?this.isSupportVideoShare?ar({command:"CHANGE_CURRENT_SHARING_ACTIVE_SSRC",ssrc:r.ssrc,isFromMainSession:r.isFromMainSession}):(T=Z.default.SPECIAL_ID,Z.default.localSharingDecMGR&&(k=Z.default.localSharingDecMGR.map.get(T))&&(D={command:"CHANGE_CURRENT_SHARING_ACTIVE_SSRC",ssrc:r.ssrc,isFromMainSession:r.isFromMainSession},k.postMessage(D))):(this.SharingRenderObj||(this.SharingRenderObj=new Wi(Object.assign({},{Notify_APPUI:Z.default.Notify_APPUI.bind(Z.default),PubSub:z.a,jsMediaEngine:i,globalTracingLogger:Y.default,renderManager:this.renderManager}))),this.SharingRenderObj.Change_Current_SSRC(this.currentshareactive,r.isFromMainSession)),e.abrupt("break",1022);case 430:return this.Stop_Audio_Play(),e.abrupt("break",1022);case 432:return this.Meeting_Fail_Over(r.audio_websocket_address,r.video_websocket_address),e.abrupt("break",1022);case 434:return fh("jsEvent.END_MEDIA"),z.a.trigger(M.PUBSUB_EVT.END_MEDIA),this.removeVbReceiver(),this.destroy().catch((function(e){return fh.error(e)})),e.abrupt("break",1022);case 439:if(!(this.audioCapture&&r&&this.audioCtx)){e.next=454;break}if(!this.enableHID){e.next=449;break}if(!this.hidAvalible){e.next=445;break}return e.next=444,Ga.destroy();case 444:this.hidAvalible=!1;case 445:if(!r.microphoneLabel){e.next=449;break}return e.next=448,Ga.init(r.microphoneLabel,r.defaultMuted);case 448:this.hidAvalible=e.sent;case 449:hh.destoryAudioMediaStream(),sr({command:131,value:!1});try{this.isCaputureNodeConnect=!1,r.audioProfile=this.audioCapture.audioProfile,this.audioCapture=r,this.audioCtx.sampleRate!=this.sampleRate&&(this.sampleRate=this.audioCtx.sampleRate,Ht(this.sampleRate)),this.Start_Audio_Capture(),pr()}catch(e){Z.default.Notify_APPUI(M.AUDIO_MIC_SET_ERROR,e),this.JsMediaSDK_Log(e)}e.next=455;break;case 454:Z.default.Notify_APPUI(M.AUDIO_MIC_SET_ERROR,"value is null or not join computer audio before change audio mic");case 455:return e.abrupt("return");case 457:return r&&(jt(Z.default.SPECIAL_ID,M.AUDIO_START),hh.destoryAudioMediaStream(),this.Remove_Audio_Capture(),this.audioCapture=r,this.Start_Audio_Capture(),pr()),e.abrupt("break",1022);case 459:if(hh.destoryAudioMediaStream(),sr({command:131,value:!1}),this.audioCapture=null,this.captureAudioMuted=!1,!this.hidAvalible){e.next=467;break}return e.next=466,Ga.destroy();case 466:this.hidAvalible=!1;case 467:if(Z.default.ComputerAudioStatus=J.a.ComputerAudio_Null,!this.audioInputLevel){e.next=473;break}return this.audioInputLevel.destroy(),this.audioInputLevel=null,Z.default.Notify_APPUI(M.LEAVE_COMPUTER_AUDIO_COMPLETE,null),e.abrupt("return");case 473:if(!this.useAudioBridge||!this.audioBridge||this.audioBridge.isDestroyed){e.next=479;break}return this.audioBridge.isMutedBySystem=!1,this.audioBridge.enableBroadCastToBO(!1),this.audioBridge.leaveAudioWithoutDisconnect(x.bb),Z.default.Notify_APPUI(M.LEAVE_COMPUTER_AUDIO_COMPLETE,null),e.abrupt("return");case 479:if(!(r&&r.issiphone&&this.webrtcaudiodom&&this.WebSipClient)){e.next=483;break}return this.webrtcaudiodom.muted=!0,this.WebSipClient.mute(),e.abrupt("return");case 483:if(Z.default.ComputerAudioStatus!==J.a.ComputerAudio_Connecting){e.next=486;break}return Z.default.Notify_APPUI(M.LEAVE_COMPUTER_AUDIO_COMPLETE,null),e.abrupt("return");case 486:this.audioEncodeRingBufferConsumer&&this.audioEncodeRingBufferConsumer.cancelConsume(),this.Remove_Audio_Capture(),this.Remove_Audio_Play(),this.CloseBoringPeerConnection(),this.checkWorkletInterval&&(clearInterval(this.checkWorkletInterval),this.checkWorkletInterval=null);try{Z.default.AudioNode&&(Z.default.AudioNode.disconnect(),Z.default.AudioNode.postCMD("stopWorklet",!0),Z.default.AudioNode.port=null)}catch(e){fh("AudioNode.port",e)}return Z.default.AudioNode=null,Z.default.workletWasmInitSuccess=!1,this.audioCtx&&(this.audioCtx.onstatechange=null,this.audioCtx.close(),this.isCaputureNodeConnect=!1),this.audioCtx=null,this.audioPlay=!1,this.audioDomNode=null,Z.default.Notify_APPUI(M.LEAVE_COMPUTER_AUDIO_COMPLETE,null),e.abrupt("break",1022);case 500:if(this.enableHID=r.CaptureAudioInfo.enableHID,!this.enableHID){e.next=513;break}if(!r.CaptureAudioInfo.microphoneLabel){e.next=513;break}return e.prev=503,e.next=506,Ga.init(r.CaptureAudioInfo.microphoneLabel,r.CaptureAudioInfo.defaultMuted);case 506:this.hidAvalible=e.sent,e.next=513;break;case 509:e.prev=509,e.t1=e.catch(503),Y.default.log("auto connect hid fail"),Z.default.Notify_APPUI(M.AUDIO_CONNECT_HID_JOIN_FAILED,e.t1);case 513:if(Z.default.ComputerAudioStatus=J.a.ComputerAudio_Connecting,e.prev=514,!r.checkAutoplay){e.next=518;break}return e.next=518,q.default.checkAudioAutoPlay();case 518:e.next=526;break;case 520:return e.prev=520,e.t2=e.catch(514),fh.error("audio auto play",e.t2),Z.default.ComputerAudioStatus=J.a.ComputerAudio_Null,Z.default.Notify_APPUI(M.JOIN_COMPUTER_AUDIO_COMPLETE,null),e.abrupt("return",Z.default.Notify_APPUI(M.AUDIO_AUTO_PLAY_FAILED,e.t2));case 526:if(this.audioInputLevel&&(this.audioInputLevel.destroy(),this.audioInputLevel=null),!r.isPreviewMode){e.next=530;break}return r.CaptureAudio?(this.audioCapture=r.CaptureAudioInfo,this.audioInputLevel=new sa({analyserCallback:function(e){Z.default.Notify_APPUI_SAFE(M.AUDIO_LEVEL_INDICATOR,{value:e})}}),hh.shouldCaptureAudio()||Z.default.Notify_APPUI(M.USER_GRANT_CAPTURE_AUDIO,null),this.Start_Audio_Capture()):(Z.default.ComputerAudioStatus=J.a.ComputerAudio_Connected,Z.default.Notify_APPUI(M.JOIN_COMPUTER_AUDIO_COMPLETE,null)),e.abrupt("return");case 530:if(!this.isSupportVideoShare&&this.isSupportOffscreenCanvas&&Yt(Ie=new MessageChannel,Ie),this.useAudioBridge=r.useAudioBridge&&r.audioBridge,!this.useAudioBridge){e.next=544;break}return ya.setUserId(r.CaptureAudioInfo.ssrc),we=r.audioBridge,Te=we.nginxHost,ke=we.rwgHost,De=we.cid,Oe=we.abToken,Me=we.supportLocalAB,xe=we.useWebRTCOnDesktop,e.next=537,this.previewInit({audioBridge:{nginxHost:Te,rwgHost:ke,cid:De,abToken:Oe,isCapturingAudio:r.CaptureAudio,audioMode:x.bb,supportLocalAB:Me,useWebRTCOnDesktop:xe}});case 537:if(this.audioBridge){e.next=540;break}return Y.default.error("audioBridge instance is null after initialization"),e.abrupt("break",1022);case 540:return ya.setAudioBridge(this.audioBridge),r.CaptureAudio?(this.audioCapture=r.CaptureAudioInfo,null!==(Pe=r.CaptureAudioInfo)&&void 0!==Pe&&Pe.audioProfile&&this.audioBridge.setAudioProfile(r.CaptureAudioInfo.audioProfile),this.Start_Audio_Capture()):(Z.default.ComputerAudioStatus=J.a.ComputerAudio_Connected,Z.default.Notify_APPUI(M.JOIN_COMPUTER_AUDIO_COMPLETE,null)),ya.updateSelectedSpeakerDevices("default",0,!0),e.abrupt("return");case 544:if(!r.issiphone){e.next=574;break}if(!this.WebSipClient){e.next=554;break}return e.prev=546,e.next=549,this.WebSipClient.clear();case 549:this.WebSipClient=null,e.next=554;break;case 552:e.prev=552,e.t3=e.catch(546);case 554:Ne=r.sip.sipServer,Ve=r.sip.meetingnumber,Ue=r.sip.participantId;try{Le=r.sip.sipNumberList[0].number.replace(" ","")}catch(e){Le="+10000"}return We=r.sip.audio,this.webrtcaudiodom=We,this.WebSipClient=new WebSipClient(Ne,Ve,Ue,Le,"sip:zoom.wcl.sip@zoom.us",We),e.prev=562,e.next=565,this.WebSipClient.connect();case 565:return e.next=567,this.WebSipClient.call();case 567:e.next=573;break;case 569:e.prev=569,e.t4=e.catch(562),Y.default.error("Error connecting to SIP audio",e.t4),e.t4.name&&-1!=e.t4.name.indexOf("NotAllowedError")&&Z.default.Notify_APPUI(M.USER_FORBIDDED_CAPTURE_AUDIO,null);case 573:return e.abrupt("return");case 574:if(e.prev=574,this.Remove_Audio_Play(),this.Remove_Audio_Capture(),this.CloseBoringPeerConnection(),jt(Z.default.SPECIAL_ID,M.AUDIO_START),this.audioCtx&&(this.audioCtx.close(),this.isCaputureNodeConnect=!1),Be=q.default.getAudioContextConfigure(),this.audioCtx=Object(q.createAudioContext)("Main",Be),this.audioCtx.sampleRate!=this.sampleRate&&(this.sampleRate=this.audioCtx.sampleRate,Ht(this.sampleRate)),this.disableAudioAGC=r.disableAudioAGC,this.disableNoiseSuppression=r.disableNoiseSuppression,this.disableBrowserAec=r.disableBrowserAec,this.bAudioDecodeUsingSAB&&Q.default.add_monitor("ASSAB"),"suspended"===this.audioCtx.state&&this.audioCtx.resume().catch((function(e){Y.default.error("audioContext resume fail",e)})),se=this,Ge=null,Fe=null,Z.default.decoderinworklet){e.next=596;break}Ge=this.audioWorkletJsPath.audioWorkletPath,Fe=this.audioWorkletJsPath.audioWasm,e.next=600;break;case 596:return e.next=598,q.default.isSDKSupportSIMD();case 598:e.sent?(Ge=this.audioWorkletJsPath.audioWorkletSIMDPath,Fe=this.audioWorkletJsPath.audioSIMDWasm):(Ge=this.audioWorkletJsPath.audioWorkletProcessPath,Fe=this.audioWorkletJsPath.audioWasm);case 600:if(!this.isDestroy){e.next=602;break}return e.abrupt("return");case 602:return e.next=604,q.default.downloadAndCompileWebAssembly(Fe,"AudioWorklet",Q.default,!q.default.browser.isSafari&&Z.default.enableStreamingInstantiate);case 604:return He=e.sent,e.next=607,this.audioCtx.audioWorklet.addModule(Ge);case 607:if(Z.default.AudioNode=new ri(se.audioCtx,"zoomAudioWorklet",{processorOptions:{sharedBuffer:q.default.browser.isSafari&&Z.default.sharedBuffer?Z.default.sharedBuffer:null,userAgent:navigator.userAgent,audioDecodeChannelsNum:q.default.isSupportPlayStereo()?2:1,audioEncodeChannelsNum:q.default.isBrowserSupportStereo()?2:1,wasmModule:He},numberOfOutputs:1,outputChannelCount:[2]}),Z.default.AudioNode.onprocessorerror=function(e){Y.default.error("Exception thrown in AudioWorkletProcessor",e)},q.default.browser.isSafari&&!Z.default.sharedBuffer&&Z.default.AudioNode.postCMD("diableSharedArrayBuffer"),Z.default.decoderinworklet||Z.default.AudioNode.postCMD("disableDecoderinworklet"),Z.default.decoderinworklet&&(this.codecDoAVSync?Z.default.AudioNode.postCMD("codecDoAVSync",!0):Z.default.CurrentSSRC&&Z.default.AudioNode.postCMD("currentSSRC",Z.default.CurrentSSRC),Z.default.AudioNode.postCMD("initData",{userid:r.CaptureAudioInfo.ssrc,meetingnumb:Z.default.localAudioPara.meetingnumb,meetingid:Z.default.localAudioPara.meetingid,qoson:Z.default.localAudioPara.qoson}),Z.default.AudioNode.postCMD("audiowasm")),se.checkWorkletInterval&&(clearInterval(se.checkWorkletInterval),se.checkWorkletInterval=null),se.checkWorkletInterval=setInterval((function(){Z.default.AudioNode&&Z.default.AudioNode.postCMD("checkProcess",null)}),1e4),je=q.default.isSupportChromeWideAEC()&&!Z.default.shareSystemAudio,!q.default.browser.isChrome||q.default.isAndroidBrowser()||q.default.isQuestBrowser()){e.next=646;break}if(!this.disableBrowserAec){e.next=620;break}this.isSupportBrowserAec=!1,e.next=626;break;case 620:if(e.t5=je,e.t5){e.next=625;break}return e.next=624,this.isLocalP2PSupportedPromise;case 624:e.t5=e.sent;case 625:this.isSupportBrowserAec=e.t5;case 626:if(Z.default.sharedBuffer&&Z.default.AudioNode.postCMD("sharedBuffer",Z.default.sharedBuffer),this.disableBrowserAec){e.next=639;break}if(!this.isSupportBrowserAec){e.next=638;break}if(je){e.next=636;break}return qe=se.audioCtx.createMediaStreamDestination(),Z.default.AudioNode.connect(qe),Ke=qe.stream,e.next=635,se.chromeAecWorkAround(qe.stream);case 635:Ke=e.sent;case 636:e.next=639;break;case 638:Kt(Z.default.SPECIAL_ID,!1);case 639:Xe=null,Xe=r.speakerInfo&&r.speakerInfo.defaultDeviceId?r.speakerInfo.defaultDeviceId:"",Ye=Date.now(),je?Z.default.AudioNode.connect(se.audioCtx.destination):(se.audioDomNode||(se.audioDomNode=new Audio),se.audioDomNode.srcObject=Ke,se.audioDomNode.play().catch((function(e){Y.default.error("Audio play failed",e)}))),se.selectComputerAudioSpeaker(Xe,Ye),e.next=672;break;case 646:if(Z.default.sharedBuffer&&Z.default.AudioNode.postCMD("sharedBuffer",q.default.browser.isSafari?null:Z.default.sharedBuffer),!q.default.isAndroidBrowser()&&!q.default.isQuestBrowser()){e.next=671;break}if(ze=se.audioCtx.createMediaStreamDestination(),Z.default.AudioNode.connect(ze),!this.disableBrowserAec){e.next=654;break}this.isSupportBrowserAec=!1,e.next=657;break;case 654:return e.next=656,this.isLocalP2PSupportedPromise;case 656:this.isSupportBrowserAec=e.sent;case 657:if(Qe=ze.stream,this.disableBrowserAec){e.next=666;break}if(!this.isSupportBrowserAec){e.next=665;break}return e.next=662,se.chromeAecWorkAround(ze.stream);case 662:Qe=e.sent,e.next=666;break;case 665:Kt(Z.default.SPECIAL_ID,!1);case 666:se.audioDomNode||(se.audioDomNode=new Audio),se.audioDomNode.srcObject=Qe,se.audioDomNode.play().catch((function(e){Y.default.error("Audio play failed",e)})),e.next=672;break;case 671:q.default.browser.isFirefox&&q.default.isFirefoxVersionHigherThan(116)?(Je=se.audioCtx.createMediaStreamDestination(),Z.default.AudioNode.connect(Je),Ze=Je.stream,se.audioDomNode||(se.audioDomNode=new Audio),se.audioDomNode.srcObject=Ze,$e=null,et=Date.now(),$e=r.speakerInfo&&r.speakerInfo.defaultDeviceId?r.speakerInfo.defaultDeviceId:"",this.selectComputerAudioSpeaker($e,et),se.audioDomNode.play().catch((function(e){Y.default.error("Audio play failed",e)}))):(Z.default.AudioNode.connect(se.audioCtx.destination),ya.updateSelectedSpeakerDevices("default",0,!0));case 672:ur({command:"stop_audio_incoming",stopPlayAudio:!1}),sr({command:"startAudioEncode",ssid:r.CaptureAudioInfo.ssrc,audioMode:Z.default.audioMode}),Tr(Z.default.e2eencrypt),tt=new MessageChannel,rt=new MessageChannel,it=new MessageChannel,Z.default.AudioNode.port.postMessage({status:"encodeAudioPort"},[rt.port2]),Z.default.AudioNode.port.postMessage({status:"decodeAudioPort"},[tt.port1]),Z.default.AudioNode.port.postMessage({status:"sampleRate",data:se.audioCtx.sampleRate}),qt(tt,rt,"decodeAudioPort","encodeAudioPort"),Z.default.enableEchoDetection&&!Z.default.sharedBuffer&&qt(it,it,"audioWorkerPort","audioWorkerPort"),se.Start_Audio_Play(),this.isSupportOffscreenCanvasForVideoDecode&&(Jt(at=new MessageChannel),Z.default.decoderinworklet?Z.default.AudioNode.port.postMessage({status:"decodeVideoPort"},[at.port2]):zt(at)),r.CaptureAudio?(se.audioCapture=r.CaptureAudioInfo,(nt=r.CaptureAudioInfo.audioProfile)&&("backgroundNoiseSuppression"===nt.currentSelect?(ot="Zoom"===nt.backgroundNoiseSuppression,ya.changeDenoiseSwitch(ot),sr({command:"highBitrate",highBitrate:nt.highBitrate?1:0})):sr({command:"audio_profile",highfidelity:nt.originalSound.highfidlity,enable:!0})),se.Start_Audio_Capture(),this.firstSetDelay&&(this.firstSetDelay=!1,pr(),vr())):(Z.default.ComputerAudioStatus=J.a.ComputerAudio_Connected,Z.default.Notify_APPUI(M.JOIN_COMPUTER_AUDIO_COMPLETE,null)),e.next=695;break;case 688:e.prev=688,e.t6=e.catch(574),Z.default.ComputerAudioStatus=J.a.ComputerAudio_Null,Z.default.Notify_APPUI(M.JOIN_COMPUTER_AUDIO_COMPLETE,null),Z.default.Notify_APPUI(M.JOIN_COMPUTER_AUDIO_FAILURE,null),fh.error(e.t6),this.JsMediaSDK_Log(e.t6);case 695:return e.abrupt("break",1022);case 696:if(Z.default.DesktopAudioStatus===J.a.DesktopAudio_Null){e.next=699;break}return Z.default.Notify_APPUI(M.JOIN_DESKTOP_AUDIO_COMPLETE,null),e.abrupt("return");case 699:if(Z.default.DesktopAudioStatus=J.a.DesktopAudio_Connecting,this.useAudioBridge=r.useAudioBridge&&r.audioBridge,!this.useAudioBridge){e.next=711;break}return ya.setUserId(r.CaptureAudioInfo.ssrc),st=r.audioBridge,ut=st.nginxHost,dt=st.rwgHost,ct=st.cid,lt=st.abToken,ht=st.supportLocalAB,ft=st.useWebRTCOnDesktop,e.next=706,this.previewInit({audioBridge:{nginxHost:ut,rwgHost:dt,cid:ct,abToken:lt,isCapturingAudio:r.CaptureAudio,audioMode:x.eb,supportLocalAB:ht,useWebRTCOnDesktop:ft}});case 706:return ya.setAudioBridge(this.audioBridge),this.Start_Desktop_Audio_Capture(),Z.default.DesktopAudioStatus=J.a.DesktopAudio_Connected,Z.default.Notify_APPUI(M.JOIN_DESKTOP_AUDIO_COMPLETE,null),e.abrupt("return");case 711:if(e.t7=q.default.isSupportChromeWideAEC()&&Z.default.ComputerAudioStatus!=J.a.ComputerAudio_Null&&!this.audioDomNode&&Z.default.shareSystemAudio,!e.t7){e.next=716;break}return e.next=715,this.isLocalP2PSupportedPromise;case 715:e.t7=e.sent;case 716:if(!e.t7){e.next=730;break}return Z.default.AudioNode.disconnect(),pt=this.audioCtx.createMediaStreamDestination(),Z.default.AudioNode.connect(pt),vt=pt.stream,e.next=723,this.chromeAecWorkAround(pt.stream);case 723:vt=e.sent,this.audioDomNode||(this.audioDomNode=new Audio),this.audioDomNode.srcObject=vt,mt=ya.speakerId,gt=Date.now(),this.selectComputerAudioSpeaker(mt,gt),this.audioDomNode.play().catch((function(e){Y.default.error("Audio play failed",e)}));case 730:return e.prev=730,sr({command:"mute",bOn:M.AUDIO_START,sharing:!0}),this.sharingAudioCtx&&(this.sharingAudioCtx.close(),this.isSharingCaptureNodeConnect=!1),_t=q.default.getAudioContextConfigure(),this.sharingAudioCtx=Object(q.createAudioContext)("MainSharing",_t),se=this,St=this.audioWorkletJsPath.sharingAudioWorkletPath,e.next=739,this.sharingAudioCtx.audioWorklet.addModule(St);case 739:Z.default.SharingAudioNode=new ri(se.sharingAudioCtx,"zoomSharingAudioWorklet",{processorOptions:{sharingEncodeChannelsNum:q.default.isSupportSharingStereo()?2:1}}),Z.default.sharedBuffer&&Z.default.SharingAudioNode.postCMD("sharedBuffer",Z.default.sharedBuffer),Et=new MessageChannel,Z.default.SharingAudioNode.port.postMessage({status:"encodeAudioPort"},[Et.port1]),Qt(Et),sr({command:"startAudioEncode",ssid:r.CaptureAudioInfo.ssrc,samplerate:this.sharingAudioCtx.sampleRate,isSharing:!0,audioMode:Z.default.audioMode,sharingEncodeChannelsNum:q.default.isSupportSharingStereo()?2:1}),Tr(Z.default.e2eencrypt),se.Start_Desktop_Audio_Capture(),e.next=753;break;case 749:e.prev=749,e.t8=e.catch(730),fh.error(e.t8),this.JsMediaSDK_Log(e.t8);case 753:return Z.default.DesktopAudioStatus=J.a.DesktopAudio_Connected,Z.default.Notify_APPUI(M.JOIN_DESKTOP_AUDIO_COMPLETE,null),e.abrupt("break",1022);case 756:if(Z.default.DesktopAudioStatus===J.a.DesktopAudio_Connected){e.next=759;break}return Z.default.Notify_APPUI(M.LEAVE_DESKTOP_AUDIO_COMPLETE,null),e.abrupt("return");case 759:if(bt=!1,r&&r.isPause&&(bt=!0),bt||this.EndDesktopAudioMediaStream(),this.Remove_Sharing_Audio_Capture(),this.audioBridge)this.audioBridge.leaveAudioWithoutDisconnect(x.eb);else{q.default.isSupportChromeWideAEC()&&this.audioDomNode&&(Z.default.AudioNode.disconnect(),this.CloseBoringPeerConnection(),this.audioDomNode=null,yt="default"==ya.speakerId?"":ya.speakerId,Z.default.AudioNode.connect(this.audioCtx.destination),Ct=Date.now(),this.selectComputerAudioSpeaker(yt,Ct)),this.audioEncodeRingBufferConsumer&&this.audioEncodeRingBufferConsumer.cancelConsume();try{Z.default.SharingAudioNode&&(Z.default.SharingAudioNode.postCMD("stopWorklet",!0),Z.default.SharingAudioNode.port=null,Z.default.SharingAudioNode.disconnect(),Z.default.SharingAudioNode=null)}catch(e){fh("SharingAudioNode.port",e)}this.sharingAudioCtx&&(this.sharingAudioCtx.close(),this.isSharingCaptureNodeConnect=!1),this.sharingAudioCtx=null,this.screenShareAudioPreviewElement&&this.screenShareAudioPreviewElement.pause()}return Z.default.DesktopAudioStatus=J.a.DesktopAudio_Null,Z.default.Notify_APPUI(M.LEAVE_DESKTOP_AUDIO_COMPLETE,null),e.abrupt("break",1022);case 767:return fh("sdk start remote control 1"),At=this.sharingWidthAndHeightInfo,Rt=new oi.a(Object.assign({dom:document},r)),this.remoteControl=Rt,fh("sharingInfo",At),Rt.setDstWidthAndHeight(At.logicWidth,At.logicHeight),Rt.setSrcWidthAndHeight(At.logicWidth,At.logicHeight),Rt.setSrcScaleWidthAndHeight(r.scaleWidth,r.scaleHeight),Rt.setSrcOffsetXY(r.srcOffsetX,r.srcOffsetY),Rt.setRemoteOS(r.os),e.abrupt("return",Rt.start().then((function(e){return Z.default.Notify_APPUI(e?M.START_REMOTE_CONTROL_SUCCESS:M.START_REMOTE_CONTROL_FAILED),e&&(Rt.onPasteTextLengthOverflow((function(){Z.default.Notify_APPUI(M.REMOTE_CONTROL_PASTE_TEXT_LENGTH_OVERFLOW)})),Rt.onReturnCopiedText((function(e){fh(e),Z.default.Notify_APPUI(M.REMOTE_CONTROL_COPIED_TEXT_NOTIFY,e)}))),e})).catch((function(e){return fh(e),Z.default.Notify_APPUI(M.START_REMOTE_CONTROL_FAILED),Y.default.error("An error occurred when trying to start remote control",e),Q.default.add_monitor("RMCTF"),Promise.reject(e)})));case 779:return e.abrupt("return",this.remoteControl.destroy().then((function(e){return Z.default.Notify_APPUI(e?M.CANCEL_REMOTE_CONTROL_SUCCESS:M.CANCEL_REMOTE_CONTROL_FAILED),e})));case 781:return this.remoteControl&&(r.scaleWidth&&r.scaleHeight&&this.remoteControl.setSrcScaleWidthAndHeight(r.scaleWidth,r.scaleHeight),(ci()(r.srcOffsetX)||ci()(r.srcOffsetY))&&this.remoteControl.setSrcOffsetXYAndSendPDU(r.srcOffsetX,r.srcOffsetY),ui()(r.isControllerNow)&&this.remoteControl.setIsControlerNow(r.isControllerNow),ci()(r.os)&&this.remoteControl.setRemoteOS(r.os)),e.abrupt("break",1022);case 783:return this.remoteControl&&this.remoteControl.sendPostionPDU(),e.abrupt("break",1022);case 785:if(this.flipSend=!0,this.canISendNextSharingFrame=!0,r.mode?this.isSharingSupportImageCapture=q.default.isSupportImageCapture():this.isSharingSupportImageCapture=!1,this.isStartDesktopSharing){e.next=799;break}Cr(Z.default.e2eencrypt),this.isStartDesktopSharing=!0,this.desktopSharingSend=!0,It=Object(q.parseDOMParams)(r.canvas),wt=It.dom,Tt=It.id,r.canvas&&(r.rendercanvasID=Tt),this.isSupportSharingTrackReader||this.isSupportMediaStreamTrackProcessor?r.video=wt:(r.video=Object(q.parseDOMParams)(r.video).dom,r.canvas=wt),this.desktopSharingValue=r,this.Start_Desktop_Sharing(),e.next=800;break;case 799:return e.abrupt("return");case 800:return e.abrupt("break",1022);case 801:if(this.flipSend=!0,this.canISendNextSharingFrame=!0,Z.default.shareSystemAudio=!1,this.sharingTrackReader)try{this.sharingTrackReader.stop()}catch(e){}if(!this.isStartDesktopSharing){e.next=811;break}this.desktopSharingSend=!1,this.StopSharingCapture(),this.isSupportVideoShare?Ar({command:"stopsharing"}):Rr({command:"stopsharing"}),e.next=812;break;case 811:return e.abrupt("return");case 812:return e.abrupt("break",1022);case 813:if(this.flipSend=!0,this.canISendNextSharingFrame=!1,!this.isStartDesktopSharing){e.next=820;break}this.desktopSharingSend=!1,this.isSupportVideoShare?Ar({command:"pause"}):Rr({command:"pause"}),e.next=821;break;case 820:return e.abrupt("return");case 821:return e.abrupt("break",1022);case 822:if(this.flipSend=!0,this.canISendNextSharingFrame=!0,!this.isStartDesktopSharing){e.next=830;break}this.desktopSharingSend=!0,this.isSupportMediaStreamTrackProcessor||this.isSupportSharingTrackReader||this.Process_Sharing(),this.isSupportVideoShare?Ar({command:"resume"}):Rr({command:"resume"}),e.next=831;break;case 830:return e.abrupt("return");case 831:return e.abrupt("break",1022);case 832:if(window.WebQrscanner){e.next=835;break}return console.error("qrScanner not loaded"),e.abrupt("return");case 835:return Q.default.add_monitor("QRSCAN:".concat(r.enable)),r.enable&&this.desktopSharingMediaStram?WebQrscanner.qrScanner.start(this.desktopSharingValue.video,(function(e){Z.default.Notify_APPUI_SAFE(M.SEND_REMOTE_CONTROL_QR_CODE,e)}),(function(){Q.default.add_monitor("QRSCANTIMEOUT")})):WebQrscanner.qrScanner.stop(),e.abrupt("break",1022);case 838:if(this.isStartWhiteboardSharing=!0,kt=Object(q.parseDOMParams)(r.canvas),Dt=kt.dom,Ot=kt.id,r.canvas&&(r.rendercanvasID=Ot),this.isStartDesktopSharing){e.next=850;break}Cr(Z.default.e2eencrypt),r.video=r.canvas=Dt,this.isStartDesktopSharing=!0,this.desktopSharingSend=!0,this.desktopSharingValue=r,this.Start_Whiteboard_Sharing(),e.next=851;break;case 850:return e.abrupt("return");case 851:return e.abrupt("break",1022);case 852:if(this.isStartWhiteboardSharing=!1,!this.isStartDesktopSharing){e.next=859;break}this.desktopSharingSend=!1,this.isStartDesktopSharing=!1,Rr({command:"stopsharing"}),e.next=860;break;case 859:return e.abrupt("return");case 860:return e.abrupt("break",1022);case 861:return(Mt=document.createElement("img")).src="chrome-extension://kgjfgplpablkjnlkjmjdecgdpfankdle/images/trash.png",Mt.onload=function(){Z.default.Notify_APPUI(M.CHECK_CHROME_SHARING_EXTENSION_RESPONSE,!0)},Mt.onerror=function(){Z.default.Notify_APPUI(M.CHECK_CHROME_SHARING_EXTENSION_RESPONSE,!1)},e.abrupt("break",1022);case 867:if(r.evt!==M.ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT&&r.evt!==M.ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT){e.next=880;break}if(fh("rwg answer from ui",r),r.answer){e.next=871;break}return e.abrupt("return");case 871:e.t9=r.answer.type,e.next=e.t9===J.h.ZOOM_CONNECTION_VIDEO?874:e.t9===J.h.ZOOM_CONNECTION_AUDIO?876:878;break;case 874:return z.a.trigger(M.PUBSUB_EVT.ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT,r),e.abrupt("break",878);case 876:return z.a.trigger(M.PUBSUB_EVT.ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT,r),e.abrupt("break",878);case 878:e.next=881;break;case 880:r.evt===M.WS_CONF_AB_TOKEN_RES&&r.body&&r.body.token&&z.a.trigger(M.PUBSUB_EVT.AUDIO_BRIDGE_WS_TOKEN,r.body.token);case 881:return e.abrupt("break",1022);case 882:return me(r.userList),!this.setvideokk&&r.encryptKey&&(this.setvideokk=!0,Wr(J.f.VIDEO_DECODE,{KK:r.encryptKey},"MAIN_KK",!1,!0),Wr(J.f.VIDEO_ENCODE,{KK:r.encryptKey},"MAIN_KK",!1,!0)),e.abrupt("break",1022);case 885:return hr(r.mute),e.abrupt("break",1022);case 887:return lr(r.lang),e.abrupt("break",1022);case 889:return fr(r.interpreterList),e.abrupt("break",1022);case 891:return dr(r.enable),e.abrupt("break",1022);case 893:if(!r.enable||!this.isEnableVideoDecodeHardWareThread){e.next=902;break}if(null===this.videodecodehardwareflag){e.next=898;break}r.enable=this.videodecodehardwareflag,e.next=902;break;case 898:return e.next=900,q.default.IsSupportVideoDecodeHardwareAcceleration();case 900:this.videodecodehardwareflag=e.sent,r.enable=this.videodecodehardwareflag;case 902:return tr({command:"hwstatus",enable:r.enable}),e.abrupt("break",1022);case 904:return x.Z&&(r.enable&&this.videoencodehardwareflag&&!this.isAppleGraphic?r.enable=!0:r.enable=!1,Zt({command:"hwstatus",enable:r.enable})),e.abrupt("break",1022);case 906:return this.webrtcConfig.webrtcflag?(this.webrtcConfig.videoHD=!!r.videohd,this.wmscManager&&this.wmscManager.sendMessageToWMSC({type:"UPDATE_WMSC_PARAMS",data:{HDVideo:this.webrtcConfig.videoHD}})):(Q.default.add_monitor("NoVideoHD"),!r.videohd&&this.videoencodehardwareflag&&(q.default.set720pcapacity(!1),Q.default.add_monitor("CAPTURE720:"+!1),Zt({command:"videohd",videohd:r.videohd}))),e.abrupt("break",1022);case 908:return Q.default.add_monitor("UVFHD"+r.videofullhd),q.default.set1080pcapacity(r.videofullhd),Zt({command:"videofullhd",videofullhd:r.videofullhd}),e.abrupt("break",1022);case 912:return this.audioBridge?this.audioBridge.setShareVolumeLevel(r.userid,r.shareVolume,r.isFromMainSession):ur({command:"setShareVolumeLevel",userid:r.userid,shareVolume:r.shareVolume,isFromMainSession:r.isFromMainSession}),e.abrupt("break",1022);case 914:return r.mediaActionType==M.sdkIvTypeKeyEnum.SHARING_DECODE&&(this.isSupportVideoShare?Wr(J.f.VIDEO_DECODE,r,10,!1,!0):Wr(J.f.SHARING_DECODE,r,10,!1,!0)),r.mediaActionType==M.sdkIvTypeKeyEnum.SHARING_ENCODE&&(this.isSupportVideoShare?Wr(J.f.VIDEO_ENCODE,r,10,!1,!0):Wr(J.f.SHARING_ENCODE,r,10,!1,!0)),r.mediaActionType==M.sdkIvTypeKeyEnum.AUDIO_DECODE&&Wr(J.f.AUDIO_DECODE,r,10,!1,!0),e.abrupt("break",1022);case 918:return r.mediaActionType==M.sdkIvTypeKeyEnum.SHARING_DECODE&&(this.isSupportVideoShare?Wr(J.f.VIDEO_DECODE,r,9,!1,!0):Wr(J.f.SHARING_DECODE,r,9,!1,!0)),r.mediaActionType==M.sdkIvTypeKeyEnum.SHARING_ENCODE&&(this.isSupportVideoShare?Wr(J.f.VIDEO_ENCODE,r,9,!1,!0):Wr(J.f.SHARING_ENCODE,r,9,!1,!0)),r.mediaActionType==M.sdkIvTypeKeyEnum.AUDIO_DECODE&&Wr(J.f.AUDIO_DECODE,r,9,!1,!0),e.abrupt("break",1022);case 922:return this.isSupportVideoShare?Wr(J.f.VIDEO_DECODE,r,"SHARING_ADD_REV_CHANNEL_TYPE",!1,!0):Wr(J.f.SHARING_DECODE,r,"SHARING_ADD_REV_CHANNEL_TYPE",!1,!0),e.abrupt("break",1022);case 924:return this.isSupportVideoShare?ar({command:"SHARING_REMOVE_REV_CHANNEL_TYPE",data:r}):nr({command:"SHARING_REMOVE_REV_CHANNEL_TYPE",data:r}),e.abrupt("break",1022);case 926:return this.isSupportVideoShare?ar({command:"BUILD_MS_CHANNEL_IN_BO",data:r}):nr({command:"BUILD_MS_CHANNEL_IN_BO",data:r}),e.abrupt("break",1022);case 928:return(xt=r.type)?xt===J.b.VIDEO?this.SWITCH_VIDEO_WATER_MARK(r):xt===J.b.SHARING&&this.SWITCH_SHARING_WATER_MARK(r):(this.SWITCH_VIDEO_WATER_MARK(r),this.SWITCH_SHARING_WATER_MARK(r)),e.abrupt("break",1022);case 931:return this.audioBridge?this.audioBridge.set_CC_lang(r.lang):cr(r.lang),e.abrupt("break",1022);case 933:return ur({command:"BUILD_MA_CHANNEL_IN_BO",data:r}),e.abrupt("break",1022);case 935:return this.audioBridge?this.audioBridge.enableShareToBO(r.enable):sr({command:"ENABLE_SHARE_TO_BO",data:r.enable}),e.abrupt("break",1022);case 937:return this.audioBridge?this.audioBridge.enableBroadCastToBO(r.enable):sr({command:"ENABLE_BROADCAST_TO_BO",data:r.enable}),e.abrupt("break",1022);case 939:if(Pt=Object(q.parseDOMParams)(r.canvasId).dom,r.canvas&&(Pt=r.canvas),Pt){e.next=943;break}return e.abrupt("return");case 943:if(Nt=null,Vt=this.replaceCanvasMap.videoDecodeCanvasIds&&-1!==this.replaceCanvasMap.videoDecodeCanvasIds.indexOf(r.canvasId),Ut=this.replaceCanvasMap.videoEncodeCanvasIds&&-1!==this.replaceCanvasMap.videoEncodeCanvasIds.indexOf(r.canvasId),r.canvasId===this.replaceCanvasMap.videoMaskSettingCanvasId?Nt=Z.default.localVideoEncMGR:r.canvasId===this.replaceCanvasMap.sharingMainCanvasId?Nt=this.isSupportVideoShare?Z.default.localVideoDecMGR:Z.default.localSharingDecMGR:r.canvasId===this.replaceCanvasMap.sharingPreviewCanvasId?Nt=Z.default.localSharingEncMGR:(Ut||Vt)&&(Nt=Ut?Z.default.localVideoEncMGR:Z.default.localVideoDecMGR,this.lazyReplaceEncodeCanvasTimer&&(clearTimeout(this.lazyReplaceEncodeCanvasTimer),this.lazyReplaceEncodeCanvasTimer=null),this.lazyReplaceEncodeCanvasTimer=setTimeout((function(){var e=Z.default.localVideoEncMGR;if(e){var t=e.map.get(Z.default.SPECIAL_ID);t&&t.postMessage({command:"WEBGL_LOST_REPLACE_CANVAS"})}var r=Z.default.localSharingEncMGR;if(r){var i=r.map.get(Z.default.SPECIAL_ID);i&&i.postMessage({command:"WEBGL_LOST_REPLACE_CANVAS"})}if(mr.videoCaptureHiddenCanvas){var a=mr.videoCaptureHiddenCanvas,n=a.width,o=a.height;q.default.isSupport2dOffscreenCanvas()?mr.videoCaptureHiddenCanvas=new OffscreenCanvas(n,o):(mr.videoCaptureHiddenCanvas=document.createElement("canvas"),mr.videoCaptureHiddenCanvas.width=n,mr.videoCaptureHiddenCanvas.height=o),mr.videoCaptureHiddenCanvasCtx=mr.videoCaptureHiddenCanvas.getContext("2d")}if(mr.bgCanvas){var s=mr.bgCanvas,u=s.width,d=s.height;mr.bgCanvas=document.createElement("canvas"),mr.bgCanvas.width=u,mr.bgCanvas.height=d,mr.bgCanvasctx=mr.bgCanvas.getContext("2d"),!mr.VideoMaskSettingCanvas&&mr.PrevVideoMaskSettingCanvas?(mr.VideoMaskSettingCanvas=mr.PrevVideoMaskSettingCanvas,mr.Update_Mask_Texture(mr.maskCoordinate,mr.videoCaptureHiddenCanvas.width,mr.videoCaptureHiddenCanvas.height),mr.VideoMaskSettingCanvas=null):mr.Update_Mask_Texture(mr.maskCoordinate,mr.videoCaptureHiddenCanvas.width,mr.videoCaptureHiddenCanvas.height)}}),500)),Nt)try{Lt=Pt.transferControlToOffscreen(),(Wt=Nt.map.get(Z.default.SPECIAL_ID))&&Wt.postMessage({command:"WEBGL_LOST_REPLACE_CANVAS",data:{canvasId:r.canvasId,canvas:Lt}},[Lt])}catch(e){}return e.abrupt("break",1022);case 949:if(this.enableHID=r.enable,!r.enable){e.next=961;break}if(!this.hidAvalible){e.next=955;break}return e.next=954,Ga.destroy();case 954:this.hidAvalible=!1;case 955:if(!r.microphoneLabel){e.next=959;break}return e.next=958,Ga.init(r.microphoneLabel,r.defaultMuted);case 958:this.hidAvalible=e.sent;case 959:e.next=965;break;case 961:if(!this.hidAvalible){e.next=965;break}return e.next=964,Ga.destroy();case 964:this.hidAvalible=!1;case 965:return e.abrupt("break",1022);case 966:return tr({command:"ENABLE_VIDEO_OBSERVER",data:r.enable,enablefps:!r.fpsdisbale}),e.abrupt("break",1022);case 968:return Zt({command:"SWITCH_SHARING_TYPE",data:r.mode}),e.abrupt("break",1022);case 970:return this.useAudioBridge&&this.audioBridge&&this.audioBridge.setSpeechVolumeLevel(r.userId,r.volume),r.issiphone||(Z.default.decoderinworklet?Z.default.AudioNode&&Z.default.AudioNode.postCMD("setSpeechVolumeLevel",{userid:r.userId>>10,volume:r.volume}):ur({command:"setSpeechVolumeLevel",userid:r.userId>>10,volume:r.volume})),e.abrupt("break",1022);case 973:return this.audioBridge&&this.audioBridge.updateUserMuteUnmuteStatus(r),e.abrupt("break",1022);case 975:return hh._updateVideoConstraints({advanced:[r]}),e.abrupt("break",1022);case 977:return this._SaveSystemInfo(),Z.default.clearMessageToRwg(),e.abrupt("break",1022);case 980:return hh.enableReuseStream(r.enable),e.abrupt("break",1022);case 982:return hh.presetConstraints(r||{}),e.abrupt("break",1022);case 984:return hh.destoryReuseStream({audio:r&&r.audio,video:r&&r.video}),e.abrupt("break",1022);case 986:return Bt={command:"WHITEBOARD_JOIN_MESSAGE",data:r.message,nodeId:r.nodeId,encryptKey:r.encryptKey,sn:r.sn,dcsId:r.dcsId,EncodedSn:r.EncodedSn},this.isSupportVideoShare?Ir(Bt):wr(Bt),e.abrupt("break",1022);case 989:return this.audioBridge?this.audioBridge.stopIncomingAudio(r):Z.default.decoderinworklet?ur({command:"stop_audio_incoming",stopPlayAudio:r}):Z.default.AudioNode&&Z.default.AudioNode.postCMD("stop_audio_incoming",r),e.abrupt("break",1022);case 991:if(this.isLandScape=r.isLandScape,hh.videoStreamTrack){e.next=994;break}return e.abrupt("return");case 994:return this.isLandScape&&this.captureSize&&this.Change_Video_Capture_Resolution(this.captureSize.width,this.captureSize.height),e.abrupt("break",1022);case 996:return this.localLog&&this.localLog.saveAllLogFiles(),e.abrupt("break",1022);case 998:return hh&&hh.audioStream&&(Gt=hh.audioStream.getAudioTracks()[0])&&(Gt.muted||"live"!==Gt.readyState)&&Z.default.Notify_APPUI_SAFE(M.AUDIO_STREAM_FAILED),e.abrupt("break",1022);case 1e3:return Ft=Z.default.localVideoDecMGR,Xt=Z.default.SPECIAL_ID,Ft&&($t=Ft.map.get(Xt))&&(er={command:"removeExpiredCanvas",rendercanvasID:r.canvasId},$t.postMessage(er)),e.abrupt("break",1022);case 1004:return this.webrtcConfig.webrtcflag&&this.wmscManager&&Array.isArray(r)&&r.length>0&&r.forEach((function(e){mr.wmscManager.sendMessageToWMSC({type:"NOTIFY_SDK_SUBSCRIBE_VIDEO",data:e})})),e.abrupt("break",1022);case 1006:return this.webrtcConfig.webrtcflag&&this.wmscManager&&Array.isArray(r)&&r.length>0&&(Z.default.sendMessageToRwg(M.SEND_MESSAGE_TO_RWG,{evt:M.WS_VIDEO_MULTI_UNSUBSCRIBE_REQ,body:{subIDList:r}}),r.forEach((function(e){mr.wmscManager.sendMessageToWMSC({type:"NOTIFY_SDK_UNSUBSCRIBE_VIDEO",data:{userId:e.id}})}))),e.abrupt("break",1022);case 1008:return Q.default.add_monitor("HOLD:".concat(null==r?void 0:r.hold,":").concat(null==r?void 0:r.userid,":").concat(null==r?void 0:r.reinit)),!r.hold&&this.isSupportVideoShare&&(null===(rr=Z.default.sharingDecInitInstance)||void 0===rr||rr.resetHandleDeferred(),null===(ir=Z.default.sharingEncInitInstance)||void 0===ir||ir.resetHandleDeferred()),r&&!r.userid&&(r.userid=this.userId),$r(this,r),!r.hold&&r.userid&&(this.userId=r.userid),r.hold&&this.SessionHold(),Z.default.isVideoEncodePostStart=!1,Z.default.isVideoDecodePostStart=!1,Z.default.isSharingDecodePostStart=!1,Z.default.isSharingEncodePostStart=!1,Z.default.isAudioDecodePostStart=!1,Z.default.isAudioEncodePostStart=!1,e.abrupt("break",1022);case 1021:fh("CAN NOT HANDLE THE EVENT!");case 1022:case"end":return e.stop()}}),e,this,[[503,509],[514,520],[546,552],[562,569],[574,688],[730,749]])}))),function(e,t){return Eh.apply(this,arguments)}),SWITCH_VIDEO_WATER_MARK:function(e){this.videoWaterMarkParams=e;var t=e.enableWaterMark,r=e.waterMarkText,i=void 0===r?"":r,a=e.watermarkOpacity,n=e.watermarkRepeated,o=e.watermarkPosition;this.isCreateVideoWaterMark=!!t,this.videoWaterMarkName=this.isCreateVideoWaterMark?i:"",this.VideoRenderObj?(t?this.isCreateVideoWaterMark&&!this.waterMarkCanvas&&(this.waterMarkCanvas=document.createElement("canvas")):this.VideoRenderObj.Set_WaterMark_Flag(t),this.VideoRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName,watermarkOpacity:a,watermarkRepeated:n,watermarkPosition:o})):tr({command:"SWITCH_WATER_MARK_FLAG",isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName,watermarkOpacity:a,watermarkRepeated:n,watermarkPosition:o}),q.default.watermark.updateWaterMarkInfo(e)},SWITCH_SHARING_WATER_MARK:function(e){this.sharingWaterMarkParams=e;var t=e.enableWaterMark,r=e.waterMarkText,i=void 0===r?"":r,a=e.watermarkOpacity,n=e.watermarkRepeated,o=e.watermarkPosition;this.isCreateSharingWaterMark=!!t,this.sharingWaterMarkName=this.isCreateSharingWaterMark?i:"",this.SharingRenderObj?(t?this.isCreateSharingWaterMark&&!this.waterMarkCanvas&&(this.waterMarkCanvas=document.createElement("canvas")):this.SharingRenderObj.Set_WaterMark_Flag(t),this.SharingRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:a,watermarkRepeated:n,watermarkPosition:o})):this.isSupportVideoShare?ar({command:"SWITCH_SHARING_WATER_MARK_FLAG",isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:a,watermarkRepeated:n,watermarkPosition:o}):nr({command:"SWITCH_WATER_MARK_FLAG",isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:a,watermarkRepeated:n,watermarkPosition:o})},JsMediaSDK_VideoRenderInterval:function(e){return this.VideoRenderObj.Start_Draw.bind(this.VideoRenderObj)(M.SET_INTERVAL_MODE,e)},JsMediaSDK_SharingRenderInterval:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.SharingRenderObj.No_Bindthis_Interval.bind(this.SharingRenderObj),i=setInterval(r,t?20:e);return i},getShareStreamInfo:function(){if(!this.desktopSharingMediaStram)return null;var e=this.desktopSharingMediaStram.getVideoTracks();return e.length&&e[0].getSettings&&e[0].getSettings()||null},onUnload:function(e){var t=this.rendererType==Si.j.WEBGPU;Y.default.log("window.onunload:".concat(this._id,", webGPU:").concat(t)),Q.default.add_monitor("window.onunload:".concat(this._id,", webGPU:").concat(t)),t&&this.destroy().catch((function(e){}))},handleUnloadEvent:function(){this.unloadHandler=this.onUnload.bind(this),window.addEventListener("unload",this.unloadHandler)},destroy:function(){var e=this;return d()(g.a.mark((function t(){return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(fh("destroy"),window.removeEventListener("unload",e.unloadHandler),!e.destoryPromise){t.next=6;break}return t.next=5,e.destoryPromise;case 5:return t.abrupt("return");case 6:return Z.default.extVBPort&&Z.default.extVBPort.postMessage({type:M.UNIFIED_VB_PAUSE}),e.isDestroy=!0,e.destoryPromise=new Promise(function(){var t=d()(g.a.mark((function t(r,i){var a,n,o;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,Y.default.log("DelInstance:".concat(e._id)),Z.default._callbackList=[],Z.default._Notify_APPUI=null,Z.default.localVideoPara.VE=null,Z.default.localVideoPara.VD=null,Q.default.add_monitor("DelInstance:".concat(e._id)),e.wmscManager&&(e.wmscManager.destroy(),e.wmscManager=null),a=e,br(),z.a.clearAllSubscriptions(),ye.clear(),Z.default.destroyQueueMessageToRwg(),e.audioInputLevel&&(e.audioInputLevel.destroy(),e.audioInputLevel=null),e.bVideoEncodeMainThreadConsumerIntervalEnable&&e.videoEncodeRingbufferConsumer&&e.videoEncodeRingbufferConsumer.cancelConsume(),e.audioBridge&&(e.audioBridge.destroy(!1),e.audioBridge=null,hh.audioBridge=null),e.EndMedia(),e.computePressureManager&&e.computePressureManager.destroy(),n=[Z.default.localVideoDecMGR,Z.default.localVideoEncMGR,Z.default.localSharingDecMGR,Z.default.localSharingEncMGR],o=[Z.default.localAudioDecMGR,Z.default.localAudioEncMGR],Dr([Z.default.sharingDecInitInstance,Z.default.sharingEncInitInstance,Z.default.videoDecInitInstance,Z.default.videoInitInstance,Z.default.audioDecInitInstance,Z.default.audioEncodeInitInstance]),Or(n,[]),t.prev=23,t.next=26,new Promise((function(e,t){var r=setTimeout((function(){return e()}),1e3);Promise.all(a.allpromises).finally((function(){clearTimeout(r),e()}))}));case 26:t.next=31;break;case 28:t.prev=28,t.t0=t.catch(23),console.error(t.t0);case 31:return we(J.h.ZOOM_CONNECTION_AUDIO,J.d.NET_WEBTRANSPORT),we(J.h.ZOOM_CONNECTION_VIDEO,J.d.NET_WEBTRANSPORT),t.next=35,Mr(e,n,o);case 35:if(!e.WebSipClient){t.next=44;break}return t.prev=36,t.next=39,e.WebSipClient.clear();case 39:e.WebSipClient=null,t.next=44;break;case 42:t.prev=42,t.t1=t.catch(36);case 44:if(!e.hidAvalible){t.next=47;break}return t.next=47,Ga.destroy();case 47:return t.next=49,Pr(n,o);case 49:e.videoEncodeRingbufferConsumer=null,e.audioEncodeRingBufferConsumer=null,e.audioDecodeRingBuffer=null,e.videoDecodeRingBuffer=null,e.sharingDecodeRingBuffer=null,t.next=59;break;case 56:t.prev=56,t.t2=t.catch(0),Y.default.error("destroy instance ".concat(e._id," error"),t.t2);case 59:r();case 60:case"end":return t.stop()}}),t,null,[[0,56],[23,28],[36,42]])})));return function(e,r){return t.apply(this,arguments)}}()),t.next=11,e.destoryPromise;case 11:case"end":return t.stop()}}),t)})))()},isWebGPURendererType:function(){var e=this;return d()(g.a.mark((function t(){var r;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,q.default.evaluateRendererType(e.webgpucapcity,e.isWebGL2Enabled);case 2:return r=t.sent,t.abrupt("return",r==Si.j.WEBGPU);case 4:case"end":return t.stop()}}),t)})))()},addVbReceiver:function(e){Zt({command:"addExtVbReceiver"}),Z.default.extVBPort&&(Z.default.extVBPort.onmessage=null),Z.default.extVBPort=e,Z.default.frameReceived=0,Z.default.frameSent=0,e.onmessage=function(e){e.data.type===M.UNIFIED_VB_ACK&&Z.default.frameReceived++},Q.default.add_monitor("EVBA")},removeVbReceiver:function(){Zt({command:"removeExtVbReceiver"}),Z.default.extVBPort&&(Z.default.extVBPort.postMessage({type:M.UNIFIED_VB_STOP}),Z.default.extVBPort.onmessage=null,Z.default.extVBPort=null),Q.default.add_monitor("EVBR")},SessionHold:function(){if(this.VideoRenderObj)for(var e=this.VideoRenderObj.clearColor.map((function(e){return e/255}));this.videoRenderArray.length>0;){var t=this.videoRenderArray.shift();this.StopUserVideoRender(this.VideoRenderObj,[t],e,!0)}},StopUserVideoRender:function(e,t,r,i){e&&(i&&e.clearUseridRender(t,r),Z.default.enableMultiDecodeVideoWithoutSAB&&e.GiveBack_Display(t),e.Set_Render_Array(this.videoRenderArray,Z.default.enableMultiDecodeVideoWithoutSAB),0==this.videoRenderArray.length&&(tr({command:"stopVideoRender",MFlag:!0}),this.Stop_Video_Play()))},_SaveSystemInfo:function(){try{Q.default.add_monitor("JSBN:".concat(Oh.buildNumber,",").concat(Oh.fixVersion)),Q.default.add_monitor("NewInstance:".concat(this._id)),gr()}catch(e){fh(e)}}};t.default=Oh}])}));
//# sourceMappingURL=https://d1cdksi819e9z7.cloudfront.net/sourcemap/js_media.min.js-d9e6bc43b8b6622fc237.map