/*! For license information please see js_media.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("disk-file-writer")):"function"==typeof define&&define.amd?define("JsMediaSDK_Instance",["disk-file-writer"],t):"object"==typeof exports?exports.JsMediaSDK_Instance=t(require("disk-file-writer")):e.JsMediaSDK_Instance=t(e["disk-file-writer"])}(self,(e=>(()=>{var t,i,r={5689:(e,t,i)=>{"use strict";i.d(t,{n:()=>r});const r={AUDIO_BRIDGE_1:{index:1,default:15},AUDIO_BRIDGE_2:{index:2,default:1},HW_ENCODER_FOR_360P:{index:3,default:0},WEBGL_CONTEXT_LOST_OPT:{index:4,default:0},RECEIVE_720P_ON_SAFARI:{index:5,default:0},MULTI_VIEW_ON_MOBILE:{index:8,default:0},AUDIO_DENOISE:{index:11,default:1},VB_ON_FIREFOX:{index:12,default:0},ENABLE_DECODE_720P_ON_IOS:{index:15,default:1},UNIFIED_RENDER:{index:20,default:0},WEBGPU_RENDERER:{index:21,default:0},ORIGINAL_SOUND:{index:22,default:0},SEND_1080P_VIDEO:{index:24,default:0},SEND_1080P_VIDEO_SHARE:{index:25,default:0},VB_ON_SAFARI_17:{index:27,default:0},WEBGL2_RENDERER:{index:29,default:1},AUDIO_ECHO_DETECT:{index:31,default:0},UNIFIED_RENDER_ON_MOBILE:{index:34,default:0},WEBCODEC_DECODE_OPTION:{index:36,default:0},HW_WEBCODEC_ON_SAFARI:{index:37,default:1},HW_DECODE_FOR_360P:{index:38,default:0},WEBCODEC_ON_ANDROID_CHROME:{index:39,default:0},SUPPORT_ANNOTATION:{index:40,default:0},WEBCODEC_ENCODE_OPT_1ON1:{index:41,default:0},CAP_WEBCODEC_SUPPORT:{index:42,default:0},WEBRTC_STG:{index:43,default:0},WEBGL_CANVAS_OPTION_OPT:{index:44,default:1},DEFAULT_RENDERER:{index:45,default:3},WEB_TRANSPORT_CONTROL:{index:46,default:0},ENABLE_TP_RLB_WEBSOCKET:{index:47,default:0},ENABLE_TRANSFERABLE_RTC_DATACHANNEL:{index:48,default:1},ENABLE_WEBRTC_FEATURE:{index:49,default:0},WEBRTC_SMART_AUTO_STG_1:{index:50,default:0,candidates:{NO_CONFIG:0,MOB_ANDROID:1,MOB_IOS:2,DESKTOP:4,SAB_OFF_NO_OFFSCREENCANVAS_NO_GPU:8}},WEBRTC_SMART_AUTO_STG_2:{index:51,default:0,candidates:{NO_CONFIG:0,AUDIO_ON_BROWSER_32BIT:1,VIDEO_ON_BROWSER_32BIT:2,DESKTOP_LOW_PERF_DEVICE:4}},ENABLE_WEBRTC_TURN_SERVERS:{index:52,default:0},EXTRA_DEVICE_INTERVAL_ENUMERATE:{index:53,default:0,candidates:{DISABLE:0,ENABLE:1}},ENABLE_MEDIA_PROCESSOR:{index:54,default:0,candidates:{NONE:0,VIDEO_PROCESSOR:1,AUDIO_PROCESSOR:2,SHARE_PROCESSOR:4}},MOBILE_FORCE_AUTO_CHOOSE_AUDIO_DEVICE:{index:55,default:0,candidates:{DISABLE:0,IOS:1,ANDROID:2}},WEBRTC_SMART_AUTO_STG_3:{index:57,default:0,candidates:{NO_CONFIG:0,WEBCODEC_NOT_SUPPORT:1}},WEBRTC_SMART_AUTO_STG_4:{index:58,default:0,candidates:{NO_CONFIG:0}},WASM_MOBILE_30FPS:{index:59,default:0},SUPPORT_ANNOTATION_PRESENTER:{index:60,default:0}}},5475:(e,t,i)=>{"use strict";i.d(t,{A:()=>a});var r=i(5408);const a=class{static read(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!e)return r.Ay.error("[ABOptionsReader] error in read(): options(".concat(e,") is invalid")),a;const n=e.length;if(t<0||i<=0||t>n||t+i-1>n)return r.Ay.warn("[ABOptionsReader] error in read(): invalid parameters! opLen=".concat(n,", bitIndex=").concat(t,", readCount=").concat(i)),a;const s=n-t-i+1,o=n-t+1;try{const t=e.slice(s,o),i=parseInt(t,16);return isNaN(i)?a:i}catch(e){r.Ay.error("[ABOptionsReader] error in read()",e)}return a}static batchRead(e,t){const i=new Map;for(let r=0;r<t.length;r++){const{bitIndex:a,readCount:n=1,defaultVal:s=0}=t[r],o=this.read(e,a,n,s);i.set(a,o)}return i}}},701:(e,t,i)=>{"use strict";i.d(t,{Xe:()=>f,_G:()=>p,iG:()=>s,iK:()=>g,pg:()=>o});var r=i(7201),a=i.n(r),n=i(5408);function s(e){this.name="CameraOccupiedError",this.message=e,this.stack=(new Error).stack}s.prototype=new Error;const o={EXCEPTION:-1,PERMISSION_RESET:-2,LOST_ACCESS:-3},d=5e3,c=new Map;function u(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"|";return e?a()(t=e.toString()).call(t,/[,，]/g,i):""}let h=null,l=null;function p(e){h=e}function f(e){l=e}function g(e,t){var i,r;if(!function(e){const t=performance.now();return(!c.has(e)||t-c.get(e)>d)&&(c.set(e,t),!0)}(e))return;let a;try{a=u("object"==typeof t?JSON.stringify(t):t)}catch(e){a=u(t)}null===(i=l)||void 0===i||i("NEM-".concat(e,"-").concat(a)),n.Ay.error("NotifyUIError,event=".concat(e,",data=").concat(a)),null===(r=h)||void 0===r||r(e,t)}},5090:(e,t,i)=>{"use strict";i.d(t,{A:()=>d});var r=i(1265),a=i.n(r),n=i(5408),s=i(3788),o=i(5932);const d={isOnWebCodecWhitelist(e,t,i,r){if(""===e||void 0===e||void 0===t||""===t)return!1;if(!r){const r=e.includes("arm"),a=t.includes("intel"),n=t.includes("amd"),s=t.includes("nvidia");return"encoder"===i?!r&&!!(a||n||s):!("decoder"!==i||r||!n&&(a?this.isInRangeOfGenerations("intel",t,1e3,4e3):s&&this.isLowerThanMinGeneration("nvidia",t,"600")))}t=this.replaceSpacesWithUnderscores(t);for(let a=0;a<r.length;a++){const s=r[a],o="vendor"in s,d="model"in s,c="renderInfo"in s,u="blacklist"in s;let h="";o&&""!==s.vendor&&(h=s.vendor.toLowerCase());let l="";d&&""!==s.model&&(l=this.replaceSpacesWithUnderscores(s.model.toLowerCase()));let p="";c&&""!==s.renderInfo&&(p=this.replaceSpacesWithUnderscores(s.renderInfo.toLowerCase()));let f=null;if(u&&s.blacklist.length>0&&(f=s.blacklist),o){if(""!==h&&e.includes(h))return""===l&&""===p&&!f||(!!(t===p||""!==p&&t.includes(p))||(""!==l&&t.includes(l)||""===l)&&(!f||!this.isHitBlacklist(e,t,i,l,f)))}else n.Ay.error("isOnWebCodecWhitelist() no vendor field in the json entry! entry:".concat(s))}return!1},isGPUProfileOnWebCodecWhitelist(e,t,i){if(!this.isOffscreenCanvasSupported())return n.Ay.log("isGPUProfileOnWebCodecWhitelist() OffscreenCanvas is not supported."),!1;try{const r=i.vendor,a=i.renderInfo,s=this.isOnWebCodecWhitelist(r,a,e,t);return n.Ay.directReport("isGPUProfileOnWebCodecWhitelist() isOnWhitelist:".concat(s,", vendor:").concat(r,", renderInfo:").concat(a,", codecType:").concat(e,", config:").concat(JSON.stringify(t))),s}catch(e){return!1}},readWebRTCVideoCodecConfig(e){var t,i;if(!e)return null;const r=o.Ay.getOSInfo();let a=(null==r||null===(t=r.browser)||void 0===t?void 0:t.name)||"",s=(null==r||null===(i=r.browser)||void 0===i?void 0:i.version)||"",d=o.Ay.getGpuInfo();const c={os:null==r?void 0:r.os.toLowerCase(),browserName:a.toLowerCase(),browserVersion:s.toLowerCase(),vendor:d.vendor.toLowerCase(),renderInfo:d.renderInfo.toLowerCase(),isAstcSupported:d.isAstcSupported};let u=null;for(const t of e){let i=!1;if(t.os&&""!==t.os&&!c.os.includes(t.os.toLowerCase()))continue;let r=!1;if(t.browser&&t.browser.name&&""!==t.browser.name){if(!c.browserName.includes(t.browser.name.toLowerCase()))continue;if(c.browserName.includes("safari")&&(r=!0),t.browser.versions&&t.browser.versions.length>0&&!t.browser.versions.some((e=>this.isBrowserVersionHitBlacklist(c.browserVersion,e))))continue}if((!t.vendor||""===t.vendor||c.vendor.includes(t.vendor.toLowerCase())||i&&r&&"intel"===t.vendor.toLowerCase()&&!c.isAstcSupported)&&(!t.renderInfo||""===t.renderInfo||c.renderInfo===t.renderInfo.toLowerCase())){try{if(t.config){let e=!1;"true"===t.config.preferSoftwareEncoder&&(e=!0);let i=!1;if("true"===t.config.preferSoftwareDecoder&&(i=!0),u={preferSoftwareCodec:{send:e,recv:i}},t.config.maxEncodingLayers){let e=parseInt(t.config.maxEncodingLayers);u.maxEncodingLayers=e}}}catch(t){n.Ay.error("readWebRTCVideoCodecConfig() videoCodecConfig:".concat(e),t)}if(u)break}}return u},evalWebRTCStrategy(e,t,i,r){var a,o,d,c,u;let h={stg:s.BH.DISABLED,errNo:s.Qb.UNKNOWN,errMsg:""};if(!i)return h.stg=s.BH.DISABLED,h.errNo=s.Qb.BROWSER_NOT_SPT,h.errMsg="webrtc is disabled(not supported by browser).",h;if(r===s.BH.DISABLED)return h.stg=s.BH.DISABLED,h.errNo=s.Qb.SUCCEED,h;if(!e||0==e.length)return h.stg=r,h.errNo=s.Qb.SUCCEED,h;const l={os:null===(a=t.os)||void 0===a?void 0:a.toLowerCase(),browserName:null===(o=t.browserName)||void 0===o?void 0:o.toLowerCase(),browserVersion:null===(d=t.browserVersion)||void 0===d?void 0:d.toLowerCase(),vendor:null===(c=t.vendor)||void 0===c?void 0:c.toLowerCase(),renderInfo:null===(u=t.renderInfo)||void 0===u?void 0:u.toLowerCase(),isAstcSupported:t.isAstcSupported};for(const i of e){let e=0,r=!1;if(i.os&&""!==i.os){if(!l.os.includes(i.os.toLowerCase()))continue;l.os.includes("mac")&&(r=!0),e|=4096}let a=!1;if(i.browser&&i.browser.name&&""!==i.browser.name){if(!l.browserName.includes(i.browser.name.toLowerCase()))continue;if(l.browserName.includes("safari")&&(a=!0),i.browser.versions&&i.browser.versions.length>0){if(!i.browser.versions.some((e=>this.isBrowserVersionHitBlacklist(t.browserVersion,e))))continue;e|=256}else e|=256}if(i.vendor&&""!==i.vendor)if(l.vendor.includes(i.vendor.toLowerCase()))e|=16;else{if(!r||!a||"intel"!==i.vendor.toLowerCase()||l.isAstcSupported)continue;e|=16}if(i.renderInfo&&""!==i.renderInfo){if(l.renderInfo!==i.renderInfo.toLowerCase())continue;e|=1}if(e>0)return h.stg=s.BH.DISABLED,h.errNo=s.Qb.DEVICE_ON_BLACKLIST,h.errMsg="webrtc is disabled(hit blacklist).",n.Ay.log("evalWebRTCStrategy() stg:".concat(JSON.stringify(h))),h}return h.stg=r,h.errNo=s.Qb.SUCCEED,h},isOnWebRTCWhitelist(e,t){var i,r;if(!t)return{isInWhitelist:!1,blacklist:null};n.Ay.directReport("isOnWebRTCWhitelist() deviceInfo=".concat(JSON.stringify(t)));const a={os:null===(i=t.os)||void 0===i?void 0:i.toLowerCase(),browserName:null===(r=t.browserName)||void 0===r?void 0:r.toLowerCase()};if(!e){const e=[{browserName:"chrome",os:["win","mac","ios","android","chromium os"]},{browserName:"edge",os:["win"]},{browserName:"safari",os:["mac","ios"]},{browserName:"mobile safari",os:["ios"]}].some((e=>e.browserName===a.browserName&&e.os.some((e=>a.os.includes(e)))));return n.Ay.log("isOnWebRTCWhitelist() no new whitelist configured. use old whitelist. isInWhitelist:".concat(e)),{isInWhitelist:e,blacklist:null}}const s=e.find((e=>e.browser===a.browserName&&a.os.includes(e.os)));return{isInWhitelist:!!s,blacklist:(null==s?void 0:s.blacklist)||null}},isLowerThanMinGeneration(e,t,i){try{const r=e.toLowerCase(),a=t.toLowerCase(),n=parseInt(i);if("nvidia"===r){if(a.includes("geforce")){const e=a.indexOf("geforce gt ");if(parseInt(a.slice(e+11))<n)return!0}}else if("intel"===r&&a.includes("hd graphics")){const e=a.indexOf("hd graphics ");if(parseInt(a.slice(e+12))<n)return!0}return!1}catch(e){return n.Ay.error(e),!1}},isInRangeOfGenerations(e,t,i,r){try{const a=e.toLowerCase(),n=t.toLowerCase();if("intel"===a&&n.includes("hd graphics")){const e=n.indexOf("hd graphics "),t=parseInt(n.slice(e+12));if(t>i&&t<r)return!0}return!1}catch(e){return n.Ay.error(e),!1}},isOffscreenCanvasSupported:()=>"function"==typeof OffscreenCanvas,isHitBlacklist(e,t,i,r,a){if(!t||""===t)return n.Ay.error("isHitBlacklist() targetRenderInfo is invalid"),!0;if(!a)return n.Ay.error("isHitBlacklist() an invalid blacklist configuration object"),!1;if("encoder"!==i&&"decoder"!==i&&"all"!==i)return n.Ay.error("isHitBlacklist() an invalid codecType(".concat(i,").")),!0;const s=r.toLowerCase();let o=!1;for(const r of a){const a="model"in r,d="codecType"in r,c="renderInfo"in r,u="minGeneration"in r,h="os"in r;let l=null;a&&""!==r.model&&(l=this.replaceSpacesWithUnderscores(r.model.toLowerCase()));let p=null;if(!d){n.Ay.warn("isHitBlacklist() miss codecType field in the configuration.");continue}if(p=r.codecType,"all"!==p&&"encoder"!==p&&"decoder"!==p){n.Ay.error("isHitBlacklist() codecType(".concat(p,") should be all/(empty)/encoder/decoder."));continue}let f=null;c&&""!==r.renderInfo&&(f=this.replaceSpacesWithUnderscores(r.renderInfo.toLowerCase()));let g=null;u&&(g=r.minGeneration);let m=null;if(h&&""!==r.os&&(m=r.os.toLowerCase()),!a&&!c){if(!h){n.Ay.warn("isHitBlacklist() invalid blacklist entry. entry:".concat(r));continue}if(this.isOnOSBlacklist(m)){o=!0;break}}if(c&&""!==f&&(t===f||t.includes(f))&&("all"===p||p===i)){if(!h){o=!0;break}if(this.isOnOSBlacklist(m)){o=!0;break}}if(l)if(""!==s){if(l!==s){n.Ay.warn("isHitBlacklist() model(".concat(l,") in blacklist entry and model(").concat(s,") in whitelist should be same!"));continue}if("all"===p||p===i)if(g&&""!==g){if(this.isLowerThanMinGeneration(e,t,g)){if(!h){o=!0;break}if(this.isOnOSBlacklist(m)){o=!0;break}}}else{if(!h){o=!0;break}if(this.isOnOSBlacklist(m)){o=!0;break}}}else if(t.includes(l)&&("all"===p||p===i))if(g&&""!==g){if(this.isLowerThanMinGeneration(e,t,g)){if(!h){o=!0;break}if(this.isOnOSBlacklist(m)){o=!0;break}}}else{if(!h){o=!0;break}if(this.isOnOSBlacklist(m)){o=!0;break}}}return o},isOnOSBlacklist(e){const t=e.toLowerCase();return!!("windows"===t&&this.isWindows()||"mac"===t&&this.isMac()||"chromeos"===t&&this.isChromeOS()||"android"===t&&this.isAndroid()||"linux"===t&&this.isLinux()||"ios"===t&&this.is_iOS())},isWindows:()=>navigator.platform.indexOf("Win")>-1,isMac:()=>navigator.platform.indexOf("Mac")>-1,isChromeOS(){try{return!!/\bCrOS\b/.test(navigator.userAgent)}catch(e){return!1}},isAndroid(){try{var e=navigator.userAgent||navigator.vendor||window.opera;return!!/android/i.test(e)}catch(e){return!1}},isLinux(){return navigator.platform.indexOf("Linux")>-1&&!this.isChromeOS()},is_iOS(){try{return!!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)}catch(e){return!1}},replaceSpacesWithUnderscores(e){if(!e||""===e)return"";const t=a()(e).call(e);return""===t?"":"_".concat(t.replace(/ /g,"_"),"_")},isBrowserVersionHitBlacklist(e,t){if(!e||!t)return n.Ay.error("compareBrowserVersion() invalid parameters! browserVersion:".concat(e,", blacklistVersion:").concat(t)),!1;const i=t[0];let r=0;"<"==i?r=-1:"="==i?r=0:">"==i?r=1:(n.Ay.error("isBrowserVersionHitBlacklist() invalid operator! operator:".concat(i)),r=0);const a=t.slice(1),s=e.toString().split("."),o=a.toString().split("."),d=Math.min(s.length,o.length);let c=!1;for(let e=0;e<d;e++){const t=parseInt(s[e],10),i=parseInt(o[e],10);if(isNaN(t)||isNaN(i))n.Ay.error("Invalid version number detected!"),c=!1;else if(0!=r){if(-1==r){if(t<i){c=!0;break}if(t==i){c=!0;continue}c=!1;break}if(1==r){if(t>i){c=!0;break}if(t==i){c=!0;continue}c=!1;break}}else{if(t!==i){c=!1;break}c=!0}}return c}}},7243:(e,t,i)=>{"use strict";i.d(t,{A:()=>a});let r=function(){};r.prototype={threads:async()=>(async e=>{if(!WebAssembly.validate(e))return!1;try{return(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),!0}catch(e){return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),simd:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]))};const a=new r},6991:(e,t,i)=>{"use strict";i.d(t,{BX:()=>u,Go:()=>n,Tl:()=>o,Xt:()=>s,_c:()=>d,d:()=>c,is:()=>h,oB:()=>a,wd:()=>r});const r={ZOOM_CONNECTION_COMMAND:0,ZOOM_CONNECTION_AUDIO:1,ZOOM_CONNECTION_VIDEO:2,ZOOM_CONNECTION_SHARING_JPEG:3,ZOOM_CONNECTION_SHARING_VIDEO:4,ZOOM_CONNECTION_MEDIA_LOG:5,ZOOM_CONNECTION_SHARING_REMOTE_CONTROL:6,ZOOM_CONNECTION_UNKNOW:7},a={NET_WEBSOCKET:0,NET_DATACHANNEL:1,NET_WEBTRANSPORT:2},n={encode:1,decode:2},s={AUDIO:1,SHARING:2,VIDEO:3},o={UNKNOWN:0,WIN:1,MAC:2,PAD:3,MOBILE:4,CALL_IN:5,LINUX:6,WEB:7,CHROME:8},d={VIDEO_ENCODE:"0",VIDEO_DECODE:"1",AUDIO_ENCODE:"2",AUDIO_DECODE:"3",SHARING_ENCODE:"4",SHARING_DECODE:"5"},c=(()=>{const e={};for(const t in d)e[d[t]]="WCL_"+t;return e})(),u={ComputerAudio_Null:0,ComputerAudio_Connecting:1,ComputerAudio_Connected:2,DesktopAudio_Null:0,DesktopAudio_Connecting:1,DesktopAudio_Connected:2},h={[d.AUDIO_ENCODE]:"audio.encode",[d.AUDIO_DECODE]:"audio.decode",[d.VIDEO_ENCODE]:"video.encode",[d.VIDEO_DECODE]:"video.decode",[d.SHARING_ENCODE]:"share.encode",[d.SHARING_DECODE]:"share.decode"}},5408:(e,t,i)=>{"use strict";i.d(t,{Ay:()=>n,GW:()=>r,ZN:()=>a});class r{constructor(){this._highFrequencyLogs={},this.fixVersion=""}setInstance(e,t){this._instance=e,this.fixVersion=t}getMessageFromErrorOrEvent(e,t){let i=e;return t instanceof ErrorEvent?(t.filename&&(i+=" File: ".concat(t.filename)),(t.lineno||t.colno)&&(i+=" Line: ".concat(t.lineno,":").concat(t.colno)),t.message&&(i+=" Message: ".concat(t.message)),t.error&&(i+="\nStack: ".concat(t.error.stack))):t instanceof Error?(t.fileName&&(i+=" File: ".concat(t.fileName)),(t.lineNumber||t.columnNumber)&&(i+=" Line: ".concat(t.lineNumber,":").concat(t.columnNumber)),t.message&&(i+=" Message: ".concat(t.message)),t.stack&&(i+=" Stack: ".concat(t.stack)),t.name&&(i+=" Name: ".concat(t.name)),t.constraint&&(i+=" Constraint: ".concat(t.constraint))):t instanceof CloseEvent?(t.code&&(i+=" Code: ".concat(t.code)),t.reason&&(i+=" Reason: ".concat(t.reason)),i+=" wasClean: ".concat(t.wasClean)):t instanceof DOMException?(t.message&&(i+=" Message: ".concat(t.message)),t.name&&(i+=" Name: ".concat(t.name))):i+=t?t.toString():"",i}error(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e=this.getMessageFromErrorOrEvent(e,t),this._highFrequencyLogs[e]?this._highFrequencyLogs[e]+=1:this._highFrequencyLogs[e]=1;const i=a(this._highFrequencyLogs[e]);this._instance&&i&&this._instance.error(e,[this.fixVersion])}severityerror(e,t){this._instance&&this._instance.error(JSON.stringify(e),t)}directReport(e,t){var i,r;this._instance&&(t||(t=["MEDIASDK_INFO"]),null===(i=(r=this._instance).directReport)||void 0===i||i.call(r,{msg:e},t))}warn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e=this.getMessageFromErrorOrEvent(e,t),this._instance&&this._instance.warn(e)}log(e){this._instance&&this._instance.log(e)}clearHighFrequencyLogs(){this._highFrequencyLogs={}}}const a=e=>!(e&e-1),n=new r},1461:(e,t,i)=>{"use strict";i.d(t,{$8e:()=>zt,$MS:()=>_t,$qV:()=>qi,$xb:()=>Cr,A3p:()=>b,AL$:()=>Pt,AV$:()=>fr,A_T:()=>Yi,Abc:()=>kr,AeO:()=>Ke,Aew:()=>et,Ah8:()=>Ar,AjI:()=>Pe,AmQ:()=>_e,AoB:()=>Bi,BJf:()=>Xi,BSK:()=>vi,BgG:()=>Ei,BqC:()=>r,Bse:()=>rr,CIY:()=>Kt,CQt:()=>s,CXV:()=>Xe,CY1:()=>kt,CcD:()=>$t,DCT:()=>ue,DjR:()=>jt,EMK:()=>yi,EPZ:()=>Ni,ETO:()=>wi,EUC:()=>It,EWx:()=>hi,EYN:()=>ve,EcQ:()=>_r,Ewj:()=>Ut,Eym:()=>Qi,FQb:()=>tr,FjO:()=>Ir,Fxk:()=>mi,G9o:()=>zi,GT7:()=>Z,GtU:()=>se,HKK:()=>d,HL3:()=>xt,HOE:()=>xi,HjG:()=>Rr,I6S:()=>ur,I8$:()=>v,IQ_:()=>si,IV3:()=>Dr,IkA:()=>Oe,Ikw:()=>n,JoO:()=>bi,Joy:()=>Sr,K3m:()=>Ge,K9M:()=>q,KYx:()=>te,Kn7:()=>Y,KqK:()=>Ti,LL7:()=>Pi,LYk:()=>pr,L_m:()=>xr,M5B:()=>k,M5F:()=>At,M9W:()=>fi,MP_:()=>lt,Mhb:()=>_,N6$:()=>Fe,NPX:()=>Wt,Nmx:()=>Vi,ONI:()=>Fi,P79:()=>Se,PMP:()=>Ne,PSY:()=>K,PcV:()=>Le,PgM:()=>mr,Q$T:()=>St,QQs:()=>rt,Qc:()=>g,QoY:()=>a,QyH:()=>br,RJ8:()=>Ie,RmE:()=>N,SUv:()=>Re,Sed:()=>R,Shw:()=>Tt,TB5:()=>Ve,TRD:()=>ct,TSA:()=>Ze,TaW:()=>yr,UFw:()=>cr,UGN:()=>C,U_k:()=>X,Ubu:()=>Gt,UsF:()=>xe,UyE:()=>Yt,V36:()=>Ye,V5N:()=>ei,Vtx:()=>qe,VxP:()=>ce,WCu:()=>dr,WP5:()=>wr,Wcg:()=>Mt,X0s:()=>E,X10:()=>P,XDu:()=>wt,XE6:()=>f,XHL:()=>fe,XbU:()=>O,Y7X:()=>Ct,YD4:()=>I,YG0:()=>Ji,YTV:()=>F,Ya9:()=>Rt,ZFN:()=>Ki,ZIm:()=>Q,ZSj:()=>Wi,_7f:()=>we,_9I:()=>ii,_Gi:()=>o,_Nl:()=>ae,_Zs:()=>m,a$m:()=>Be,a1o:()=>Ui,a6z:()=>Jt,aE$:()=>$,aKW:()=>pi,aYB:()=>ne,ahr:()=>ir,bKC:()=>V,bSz:()=>M,bVv:()=>ft,bW9:()=>Ht,baF:()=>gt,bes:()=>ji,bjn:()=>Si,bo2:()=>di,cBD:()=>Dt,cJy:()=>G,cYb:()=>Et,cjy:()=>vt,dUL:()=>Mi,dsK:()=>Ai,eEQ:()=>S,eJx:()=>ke,ee7:()=>ge,ekh:()=>Xt,epV:()=>yt,exH:()=>h,f8O:()=>z,fAR:()=>pe,fmn:()=>at,fxd:()=>Er,g$j:()=>oe,g8Z:()=>p,g9q:()=>ti,gFh:()=>li,gh2:()=>hr,gle:()=>L,h73:()=>bt,hcn:()=>De,hd7:()=>mt,hs:()=>A,i0n:()=>be,i3D:()=>ki,i8:()=>de,i9k:()=>Qe,i9w:()=>Te,iDK:()=>J,iQY:()=>gr,j4N:()=>T,jCp:()=>me,jhI:()=>Zt,kPo:()=>dt,kQe:()=>W,kqY:()=>er,l8t:()=>$e,lA5:()=>gi,lLs:()=>Or,lOl:()=>Je,lyw:()=>H,m1Q:()=>w,m7W:()=>D,msu:()=>Pr,mxj:()=>Gi,n7n:()=>ht,nEg:()=>ui,naM:()=>it,npe:()=>Ft,oDm:()=>ci,oFc:()=>nt,oQY:()=>Ii,oUP:()=>vr,ovL:()=>ee,p4Z:()=>Lr,p8Y:()=>Vt,pHx:()=>Di,pOT:()=>u,pn7:()=>Ce,pvo:()=>Ci,px:()=>Nt,qRr:()=>Tr,qUx:()=>oi,qmK:()=>Ee,qnv:()=>re,qqH:()=>Ri,qw$:()=>$i,r2c:()=>j,r4R:()=>nr,rNn:()=>ai,rSS:()=>he,rV1:()=>Wr,rcl:()=>U,rje:()=>ze,rpL:()=>We,rt8:()=>ar,rwH:()=>He,s8N:()=>x,sCk:()=>tt,sCw:()=>Hi,sfr:()=>Br,ssE:()=>ot,t4x:()=>st,tMo:()=>Mr,tN9:()=>pt,tav:()=>y,tjY:()=>qt,tm0:()=>Ae,u1v:()=>le,uiF:()=>l,uiQ:()=>ni,uoF:()=>Li,uxR:()=>B,vd4:()=>lr,vjv:()=>Zi,wIu:()=>Ue,wYI:()=>ie,wb7:()=>Vr,wk9:()=>c,x$W:()=>Nr,x3x:()=>Qt,xQc:()=>or,xlY:()=>ut,xzH:()=>Ur,y2t:()=>je,yEo:()=>_i,yGo:()=>Ot,yHE:()=>ye,yJV:()=>Bt,zFT:()=>ri,zag:()=>sr,zds:()=>Oi,ziT:()=>Me,zj1:()=>Lt});const r=1,a=2,n=3,s=4,o=5,d=6,c=7,u=8,h=9,l=10,p=11,f=12,g=13,m=15,v=16,A=17,S=18,_=19,y=21,C=22,b=23,w=24,E=25,R=26,T=27,I=28,M=30,D=30.1,P=31,k=31.1,O=32,x=33,V=34,N=36,L=37,W=38,B=40,U=41,F=43,G=44,H=45,j=46,K=48,q=49,z=50,X=51,Y=52,Q=53,J=54,Z=55,$=57,ee=58,te=59,ie=60,re=61,ae=62,ne=63,se=64,oe=65,de=66,ce=70,ue=71,he=72,le=73,pe=74,fe=75,ge=76,me=77,ve=78,Ae=79,Se=80,_e=81,ye=82,Ce=83,be=84,we=85,Ee=86,Re=87,Te=90,Ie=91,Me=92,De=93,Pe=94,ke=96,Oe=97,xe=98,Ve=99,Ne=101,Le=100,We=102,Be=103,Ue=110,Fe=111,Ge=112,He=113,je=114,Ke=115,qe=116,ze=117,Xe=118,Ye=120,Qe=121,Je=123,Ze=124,$e=125,et=126,tt=127,it=128,rt=129,at=130,nt=132,st=133,ot=135,dt=136,ct=137,ut=138,ht=150,lt=152,pt=156,ft=158,gt=159,mt=160,vt=161,At=162,St=163,_t=1.1,yt=1.2,Ct=1.3,bt=2,wt=3,Et=6,Rt=7,Tt=8,It=9,Mt=10,Dt=11,Pt=12,kt=13,Ot=14,xt=15,Vt=16,Nt=17,Lt=18,Wt=19,Bt=20,Ut=21,Ft=23,Gt=24,Ht=25,jt=26,Kt=27,qt=28,zt=29,Xt=30,Yt=31,Qt=32,Jt=33,Zt=34,$t=35,ei=36,ti=37,ii=38,ri=39,ai=-1.1,ni=-1.2,si=-1.3,oi=-2,di=-3,ci=-4,ui=-8,hi=-9,li=-10,pi=-11,fi=-12,gi=-14,mi=-15,vi=-20,Ai=-21,Si=-22,_i=-24,yi=-28,Ci=-27,bi=-29,wi=-31,Ei=-32,Ri=-33,Ti=-34,Ii=-35,Mi=-36,Di=-37,Pi=-38,ki=-39,Oi=-40,xi=-41,Vi=-42,Ni=-43,Li=-44,Wi=-45,Bi=-51,Ui=-52,Fi=-60,Gi=-53,Hi=-70,ji=-129,Ki=-130,qi=-136,zi=-137,Xi=-138,Yi=0,Qi=1,Ji=2,Zi="SHARING_PARAM_INFO_FROM_SOCKET",$i=24321,er=24322,tr=24322,ir=24323,rr=24322,ar=4300,nr=4299,sr=7939,or=12303,dr=12305,cr=4167,ur=4355,hr={ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT:"ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT",ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT:"ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT",END_MEDIA:"END_MEDIA",DESTROY:"DESTROY",DC_COMING_MESSAGE:"DC_COMING_MESSAGE",AUDIO_BRIDGE_WS_TOKEN:"AUDIO_BRIDGE_WS_TOKEN"},lr=70,pr=170,fr=121,gr="AUDIO_QOS_DATA",mr="VIDEO_QOS_DATA",vr="VIDEOSHARE_QOS_DATA",Ar="NETWORK_QUALITY_CHANGE",Sr="NETWORK_QUALITY_CHANGE_AUDIO",_r={VIDEO_ENCODE:"0",VIDEO_DECODE:"1",AUDIO_ENCODE:"2",AUDIO_DECODE:"3",SHARING_ENCODE:"4",SHARING_DECODE:"5"},yr=66.5,Cr=66.6,br="ENABLE_REUSE_STREAM",wr="PRESET_MEDIA_CONSTRAINTS",Er="DESTORY_REUSE_STREAM",Rr={FAIL:4},Tr="AUDIO_STREAM_MUTED",Ir="AUDIO_STREAM_UNMUTED",Mr="VIDEO_STREAM_MUTED",Dr="VIDEO_STREAM_UNMUTED",Pr="EXPOSE_VB_FRAME",kr="UNIFIED_VB_FRAME",Or="UNIFIED_VB_STOP",xr="UNIFIED_VB_PAUSE",Vr="UNIFIED_VB_ACK",Nr="ANNO_UNDO_STATUS",Lr="ANNO_REDO_STATUS",Wr="ANNO_VIEWER_REQUEST_DRAW",Br={USER_DENIED:1,SYSTEM_DENIED:2,DEVICE_IN_USE:3,NO_DEVICE:4,UNKNOWN_REASON:5,OVERCONSTRAINED:6,USER_DISMISS:7},Ur={GRANTED_AUDIO_VIDEO:1,GRANTED_AUDIO:2,DENIED:3,EXCEPTION_FAILS:4,DISMISS:5}},8353:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});let r="object"==typeof localStorage&&localStorage.__islogdebug;var a=function(e,t){function i(){let e=[];return e.push(...arguments),e}!0===t&&(r=!0);var a=function(){r&&console.log(e,...i(arguments))};return["log","info","warn","error"].forEach((t=>{a[t]=function(){r&&console[t](e,...i(arguments))}})),a.isEnable=function(){return r},a};a.isEnable=function(){return r};const n=a},3404:(e,t,i)=>{"use strict";i.d(t,{Y:()=>s});var r=i(5408);class a{constructor(e){this.mediaType=e,this.firstSelect=null,this.finalSelect=null,this.webRTCProb={probTime:0,probResult:null},this.hasProcess=!1}getProbResult(){var e;const t=JSON.parse(localStorage.getItem("".concat(this.mediaType,"States")));return!1!==(null==t||null===(e=t.webRTCProb)||void 0===e?void 0:e.probResult)}updatewebRTCProbResult(e){this.webRTCProb.probTime=Date.now(),this.webRTCProb.probResult=e,this.updateLocalStorage()}updateLocalStorage(){var e,t;let i=JSON.parse(localStorage.getItem("".concat(this.mediaType,"States")))||{},a={mediaType:this.mediaType,firstSelect:this.firstSelect,finalSelect:this.finalSelect,webRTCProb:{probTime:this.webRTCProb.probTime||(null==i||null===(e=i.webRTCProb)||void 0===e?void 0:e.probTime),probResult:null===this.webRTCProb.probResult?null==i||null===(t=i.webRTCProb)||void 0===t?void 0:t.probResult:this.webRTCProb.probResult}};localStorage.setItem("".concat(this.mediaType,"States"),JSON.stringify(a)),r.Ay.directReport(a)}}class n{constructor(e){this.mediaType=e}getInfo(){try{return JSON.parse(localStorage.getItem("webcodec".concat(this.mediaType)))||{}}catch(e){return{}}}updateInfo(e,t){try{let i=this.getInfo(),{failed:r,total:a}=i.usedcount||{failed:0,total:0},{avgusedtime:n,usedmaxtime:s}=i.usedtime||{avgusedtime:0,usedmaxtime:0},{avgratio:o,maxratio:d}=i.ratio||{avgratio:0,maxratio:0},{avgdelay:c}=i.delay||{avgdelay:0};e.failed&&(r++,n=(3*n+e.elapsed)/4,s=e.elapsed>s?e.elapsed:s,i.usedtime=Object.assign(i.usedtime||{},{usedmaxtime:s,avgusedtime:n})),e.elapsed>31e3&&e.failed||a++,i.usedcount=Object.assign(i.usedcount||{},{failed:r,total:a}),e.outputIndex>3&&(c=(3*c+e.avgDelay)/4,i.delay=Object.assign(i.delay||{},{avgdelay:c})),e.inputIndex>5&&(o=(3*o+e.ratio)/4,d=e.ratio>d?e.ratio:d,i.ratio=Object.assign(i.ratio||{},{avgratio:o,maxratio:d}));let u=t.osVersion,h=t.browserVersion,l=t.sdkVersion;i.version={osVersion:u,browserVersion:h,sdbversion:l},localStorage.setItem("webcodec".concat(this.mediaType),JSON.stringify(i))}catch(e){r.Ay.error("<<< update localStorage error",e)}}}class s{constructor(){this.audioSolutionInfo=new a("audio"),this.videoEncoderInfo=new n("videoencode"),this.videoDecoderInfo=new n("videodecode")}getAudioSolutionInfo(){return this.audioSolutionInfo}getVideoEncoderInfo(){return this.videoEncoderInfo}getVideoDecoderInfo(){return this.videoDecoderInfo}}},456:(e,t,i)=>{"use strict";function r(){this.a=[],this.b=0,this.residue=null}i.d(t,{A:()=>a}),r.prototype.getLength=function(){return this.a.length-this.b},r.prototype.isEmpty=function(){return 0==this.a.length},r.prototype.enqueue=function(e){this.a.push(e)},r.prototype.dequeue=function(){if(0!=this.a.length){var e=this.a[this.b];return 2*++this.b>=this.a.length&&(this.a=this.a.slice(this.b),this.b=0),e}return null},r.prototype.peek=function(){return 0<this.a.length?this.a[this.b]:void 0},r.prototype.clear=function(){this.a=[],this.b=0};const a=r},3788:(e,t,i)=>{"use strict";i.d(t,{BH:()=>n,BJ:()=>M,D2:()=>u,G7:()=>p,Hh:()=>I,O$:()=>A,O9:()=>w,PP:()=>R,Qb:()=>s,Ur:()=>f,Vx:()=>C,W5:()=>r,Zq:()=>c,_$:()=>P,bH:()=>k,bZ:()=>g,ch:()=>m,dc:()=>y,ff:()=>b,gz:()=>o,h3:()=>a,iN:()=>E,mN:()=>l,nD:()=>d,qv:()=>S,tU:()=>_,vL:()=>h,vO:()=>O,vx:()=>D,wo:()=>T,x0:()=>v});const r={AVAILABLE:0,NOT_SUPPORTED:1,CANNOT_REQ_ADAPTER:2,CANNOT_REQ_DEVICE:3},a={AUTO:-1,UNDEFINED:0,WEBGL:1,WEBGPU:2,WEBGL_2:3},n={DISABLED:0,ENABLED:1,AUTO:2},s={SUCCEED:0,UNKNOWN:-1,INVALID_ARG:-2,BROWSER_NOT_SPT:-3,DEVICE_ON_BLACKLIST:-4,INVALID_DEVICE_INFO:-5,UNKNOWN_SELECTION:-6,OTHER_EX:-7,DEVICE_NOT_ON_WHITELIST:-8,FEATURE_OPTION_DISABLED:-9},o={AVAILABLE:0,VIDEO:1,SHARE:2},d={IDLE:0,PENDING:1,READY:2,RENDERING:3},c={UNKNOWN:-1,BASE_LAYER:0,BLEND_LAYER:1},u={UNKNOWN:-1,EXTERNAL_TEX:0,GPU_TEX_YUV:1,GPU_TEX_RGBA:2,CLEAR_COLOR:3},h=0,l=1,p=2,f=3,g=[{u:1,v:0},{u:1,v:1},{u:0,v:1},{u:1,v:0},{u:0,v:0},{u:0,v:1}],m=[{x:1,y:1},{x:1,y:-1},{x:-1,y:-1},{x:1,y:1},{x:-1,y:1},{x:-1,y:-1}],v={VS_BASE:0,CURSOR:1,WATERMARK:2,MASK:3,END:4},A=["intel","nvidia","apple","amd","qualcomm","arm"],S="\n      struct VertexOutput {\n          @builtin(position) Position: vec4<f32>,\n          @location(0) uv: vec2<f32>,\n      };\n  \n      struct FsUniforms {\n          rotation: f32,\n      };\n  \n      @group(0) @binding(0) var vfSampler: sampler;\n      @group(0) @binding(1) var vfTexture: texture_external;\n      @group(0) @binding(2) var<uniform> vertexUniforms: FsUniforms;\n      \n      @vertex\n      fn vertex_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) vtxPos: vec2<f32>,\n          @location(1) uvPos: vec2<f32>\n      ) -> VertexOutput {\n      \n          var output: VertexOutput;\n          output.Position = vec4<f32>(vtxPos, 0.0, 1.0);\n          \n          if (vertexUniforms.rotation == 0) {\n              output.uv = vec2f(uvPos.x, 1 - uvPos.y);    \n          } else if (vertexUniforms.rotation == 1) {\n              output.uv = vec2f(1 - uvPos.y, 1 - uvPos.x);\n          } else if (vertexUniforms.rotation == 2) {\n              output.uv = vec2f(uvPos.x, uvPos.y);\n          } else if (vertexUniforms.rotation == 3) {\n              output.uv = vec2f(uvPos.y, uvPos.x);\n          } else {\n              output.uv = uvPos;\n          }\n  \n          return output;\n      }\n      \n      @fragment\n      fn fragment_main(@location(0) uv : vec2<f32>) -> @location(0) vec4<f32> {\n          var color: vec4<f32> = textureSampleBaseClampToEdge(vfTexture, vfSampler, uv);\n          return color;\n      }\n  ",_="\n      struct VertexOutput {\n          @builtin(position) Position: vec4<f32>,\n          @location(0) uv: vec2<f32>,\n      };\n  \n      @group(0) @binding(6) var<uniform> vertexUniforms: FsUniforms;\n  \n      @vertex\n      fn vertex_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) vtxPos: vec2<f32>,\n          @location(1) uvPos: vec2<f32>\n      ) -> VertexOutput {\n      \n          var output: VertexOutput;\n          output.Position = vec4<f32>(vtxPos, 0.0, 1.0);\n  \n          if (vertexUniforms.rotation == 0) {\n              output.uv = vec2f(uvPos.x, 1 - uvPos.y);    \n          } else if (vertexUniforms.rotation == 1) {\n              output.uv = vec2f(1 - uvPos.y, 1 - uvPos.x);\n          } else if (vertexUniforms.rotation == 2) {\n              output.uv = vec2f(uvPos.x, uvPos.y);\n          } else if (vertexUniforms.rotation == 3) {\n              output.uv = vec2f(uvPos.y, uvPos.x);\n          } else {\n              output.uv = uvPos;\n          }\n          \n          return output;\n      }\n  \n      struct FsUniforms {\n          yuvMode: f32,\n          colorRange: f32,\n          rotation: f32,\n      };\n      \n      @group(0) @binding(0) var yPlaneSampler: sampler;\n      @group(0) @binding(1) var uvPlaneSampler: sampler;\n      @group(0) @binding(2) var yPlaneTex: texture_2d<f32>;\n      @group(0) @binding(3) var uPlaneTex: texture_2d<f32>;\n      @group(0) @binding(4) var vPlaneTex: texture_2d<f32>;\n      @group(0) @binding(5) var<uniform> uniforms: FsUniforms;\n      // @group(0) @binding(7) var<storage, read_write> outputBuffer: array<f32>;\n      \n      @fragment\n      fn fragment_main(@location(0) uv : vec2<f32>) -> @location(0) vec4<f32> {\n          let y = textureSampleBaseClampToEdge(yPlaneTex, yPlaneSampler, uv).r;\n          var u: f32;\n          var v: f32;\n          if (uniforms.yuvMode == 1) {\n              u = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).r;\n              v = textureSampleBaseClampToEdge(vPlaneTex, uvPlaneSampler, uv).r;\n          } else {\n              u = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).r;\n              v = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).a;\n          }\n  \n          const yuv2RGB_L = mat4x4(\n              1.1643835616, 0, 1.7927410714, -0.9729450750,\n              1.1643835616, -0.2132486143, -0.5329093286, 0.3014826655,\n              1.1643835616, 2.1124017857, 0, -1.1334022179,\n              0, 0, 0, 1\n          );\n  \n          const yuv2RGB_F = mat4x4(\n              1.0, 0, 1.402, -.701,\n              1.0, -.34413, -.71414, .529135,\n              1.0, 1.772, 0, -.886,\n              0, 0, 0, 1\n          );\n  \n          var color = vec4<f32>(y, u, v, 1.0);\n          if (uniforms.colorRange == 0) {\n              color = color * yuv2RGB_L;\n          } else {\n              color = color * yuv2RGB_F;\n          }\n  \n          return color;\n      }\n  ",y="\n      struct VertexOutput {\n          @builtin(position) Position: vec4<f32>,\n          @location(0) uv: vec2<f32>,\n      };\n  \n      @group(0) @binding(5) var<uniform> vertexUniforms: FsUniforms;\n      @vertex\n      fn vertex_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) vtxPos: vec2<f32>,\n          @location(1) uvPos: vec2<f32>\n      ) -> VertexOutput {\n      \n          var output: VertexOutput;\n          output.Position = vec4<f32>(vtxPos, 0.0, 1.0);\n          \n          if (vertexUniforms.rotation == 0) {\n              output.uv = vec2f(uvPos.x, 1 - uvPos.y);    \n          } else if (vertexUniforms.rotation == 1) {\n              output.uv = vec2f(1 - uvPos.y, 1 - uvPos.x);\n          } else if (vertexUniforms.rotation == 2) {\n              output.uv = vec2f(uvPos.x, uvPos.y);\n          } else if (vertexUniforms.rotation == 3) {\n              output.uv = vec2f(uvPos.y, uvPos.x);\n          } else {\n              output.uv = uvPos;\n          }\n              \n          return output;\n      }\n  \n      struct FsUniforms {\n          yuvMode: f32,\n          colorRange: f32,\n          rotation: f32,\n      };\n      \n      @group(0) @binding(0) var yPlaneSampler: sampler;\n      @group(0) @binding(1) var uvPlaneSampler: sampler;\n      @group(0) @binding(2) var yPlaneTex: texture_2d<f32>;\n      @group(0) @binding(3) var uPlaneTex: texture_2d<f32>;\n      @group(0) @binding(4) var<uniform> uniforms: FsUniforms;\n      // @group(0) @binding(5) var<storage, read_write> outputBuffer: array<f32>;\n      \n      @fragment\n      fn fragment_main(@location(0) uv : vec2<f32>) -> @location(0) vec4<f32> {\n          let y = textureSampleBaseClampToEdge(yPlaneTex, yPlaneSampler, uv).r;\n          var u: f32;\n          var v: f32;\n          u = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).r;\n          v = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).g;\n  \n          const yuv2RGB_L = mat4x4(\n              1.1643835616, 0, 1.7927410714, -0.9729450750,\n              1.1643835616, -0.2132486143, -0.5329093286, 0.3014826655,\n              1.1643835616, 2.1124017857, 0, -1.1334022179,\n              0, 0, 0, 1\n          );\n  \n          const yuv2RGB_F = mat4x4(\n              1.0, 0, 1.402, -.701,\n              1.0, -.34413, -.71414, .529135,\n              1.0, 1.772, 0, -.886,\n              0, 0, 0, 1\n          );\n  \n          var color = vec4<f32>(y, u, v, 1.0);\n          if (uniforms.colorRange == 0) {\n              color = color * yuv2RGB_L;\n          } else {\n              color = color * yuv2RGB_F;\n          }\n  \n          // outputBuffer[0] = y;\n          // outputBuffer[1] = u;\n          // outputBuffer[2] = v;\n          // outputBuffer[3] = color.r;\n          // outputBuffer[4] = color.g;\n          // outputBuffer[5] = color.b;\n          // outputBuffer[6] = color.a;\n  \n          return color;\n      }\n  ",C="\n      @group(0) @binding(0) var watermarkSampler: sampler;\n      @group(0) @binding(1) var watermarkTex: texture_2d<f32>;\n  \n      struct VertexOutput {\n          @builtin(position) Position: vec4<f32>,\n          @location(0) uv: vec2<f32>,\n      };\n  \n      @vertex\n      fn v_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) pos: vec2<f32>,\n          @location(1) uvPos: vec2<f32>\n      ) -> VertexOutput {\n  \n          var output: VertexOutput;\n          output.Position = vec4<f32>(pos, 0.0, 1.0);\n          output.uv = vec2f(uvPos.x, uvPos.y);\n          return output;\n      }\n  \n      @fragment\n      fn f_main(@location(0) uv: vec2<f32>) -> @location(0) vec4<f32> {\n          var color: vec4<f32> = textureSampleBaseClampToEdge(watermarkTex, watermarkSampler, uv);\n          if (color.r == 0 && color.g == 0 && color.b == 0) {\n              color.a = 0;\n          }\n          return color;\n      }\n  ",b="\n  \n      struct FsUniforms {\n          cursorFlag: f32,\n          cursorInfo: vec4f\n      };\n  \n      @group(0) @binding(0) var cursorSampler: sampler;\n      @group(0) @binding(1) var cursorTex: texture_2d<f32>;\n      @group(0) @binding(2) var<uniform> uniforms: FsUniforms;\n  \n      struct VertexOutput {\n          @builtin(position) Position: vec4<f32>,\n          @location(0) uv: vec2<f32>,\n      };\n  \n      @vertex\n      fn v_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) pos: vec2<f32>,\n          @location(1) uvPos: vec2<f32>\n      ) -> VertexOutput {\n  \n          var output: VertexOutput;\n          output.Position = vec4<f32>(pos, 0.0, 1.0);\n          output.uv = vec2f(uvPos.x, 1 - uvPos.y);\n          return output;\n      }\n  \n      @fragment\n      fn f_main(@location(0) uv: vec2<f32>) -> @location(0) vec4<f32> {\n          var color: vec4<f32> = textureSampleBaseClampToEdge(cursorTex, cursorSampler, uv);\n          // if (uniforms.cursorFlag == 1) {\n          //     if (uniforms.cursorInfo.z > 0.0 \n          //         && uv.x >= uniforms.cursorInfo.x\n          //         && uv.y >= uniforms.cursorInfo.y\n          //         && uv.x < uniforms.cursorInfo.x + uniforms.cursorInfo.z\n          //         && uv.y < uniforms.cursorInfo.y + uniforms.cursorInfo.w) {\n  \n          //         var cursorCoord: vec2f = uv - uniforms.cursorInfo.xy;\n          //         cursorCoord = cursorCoord / uniforms.cursorInfo.zw;\n          //         var cursorColor: vec4<f32> = textureSampleBaseClampToEdge(cursorTex, cursorSampler, cursorCoord);\n          //         color = color * (1.0 - cursorColor.a) + cursorColor * cursorColor.a;\n          //     }\n          // }\n  \n          return color;\n      }\n  ",w="\n      @vertex\n      fn v_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) vtxPos: vec2<f32>,\n      ) -> @builtin(position) vec4<f32> {\n          return vec4<f32>(vtxPos, 0.0, 1.0);\n      }\n      \n      @fragment\n      fn f_main() -> @location(0) vec4<f32> {\n          return vec4(0.0, 0.0, 0.0, 1.0);\n      }\n  ",E="\n      @vertex\n      fn v_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) vtxPos: vec2<f32>,\n      ) -> @builtin(position) vec4<f32> {\n          return vec4<f32>(vtxPos, 0.0, 1.0);\n      }\n  \n      struct ClearColorUniforms {\n          clearColor: vec4<f32>,\n      };\n  \n      @group(0) @binding(0) var<uniform> uniforms: ClearColorUniforms;\n      @fragment\n      fn f_main() -> @location(0) vec4<f32> {\n          return uniforms.clearColor;\n      }\n  ",R={TEXTURE_BUFFER:0,VERTEX_BUFFER:1,TEXTURE:2},T={LOW:0,MEDIUM:1,HIGH:2,OVERUSE:3},I={LOW:6e4,MEDIUM:45e3,HIGH:3e4,OVERUSE:15e3},M=[60,120,180,360,540,720,1080,2160],D={VIDEO_FRAME:0,YUV_I420:1,YUV_NV12:2,RGBA_WATERMARK:3,RGBA_CURSOR:4,CLEAR_COLOR:5},P=6,k=[180,360,540,720,1080,2160],O=5},9407:(e,t,i)=>{"use strict";i.d(t,{$E:()=>S,$x:()=>H,AC:()=>U,AP:()=>Fe,Ah:()=>ne,Bi:()=>R,Bm:()=>I,Cm:()=>re,D1:()=>ae,DT:()=>me,F4:()=>le,Fb:()=>m,Gg:()=>Te,H4:()=>oe,HL:()=>K,HX:()=>Me,I6:()=>Oe,Ji:()=>g,Jj:()=>be,Jo:()=>se,Jw:()=>n,KE:()=>xe,Ke:()=>De,LG:()=>y,Lm:()=>ue,M9:()=>Ve,NO:()=>Ge,Os:()=>Se,Pp:()=>Ee,QT:()=>Ae,Qt:()=>He,Rk:()=>O,Rm:()=>V,Rw:()=>p,SG:()=>N,SK:()=>ve,Sh:()=>j,T:()=>G,TE:()=>he,TK:()=>Re,UG:()=>ie,Ub:()=>$,V_:()=>Le,Vd:()=>Z,Wr:()=>T,Xd:()=>D,Xg:()=>b,Xk:()=>Q,Y:()=>ee,YQ:()=>C,YS:()=>J,Zc:()=>x,Zk:()=>ce,_Q:()=>L,aY:()=>Ne,av:()=>M,b5:()=>k,bC:()=>ke,bq:()=>v,c:()=>s,dh:()=>u,ef:()=>E,ex:()=>r,f9:()=>Y,hA:()=>B,hG:()=>de,hd:()=>Ue,iU:()=>d,jA:()=>Be,kD:()=>We,l6:()=>h,lN:()=>o,my:()=>a,nl:()=>pe,oU:()=>Ie,rl:()=>ge,s6:()=>c,s8:()=>we,sV:()=>l,sY:()=>X,sv:()=>_,tO:()=>fe,ty:()=>P,uL:()=>ye,uP:()=>Pe,uf:()=>W,v7:()=>Ce,vP:()=>z,vr:()=>A,wQ:()=>w,wo:()=>_e,x8:()=>F,xD:()=>q,xQ:()=>te,zS:()=>f});const r=1,a=2,n=3,s=4,o=7,d=8,c=9,u=10,h=11,l=12,p=14,f=15,g=16,m=18,v=20,A=21,S=22,_=23,y=24,C=26,b=27,w=30,E=31,R=35,T=36,I=37,M=38,D=42,P=47,k=48,O=50,x=51,V=52,N=53,L=56,W=57,B=60,U=61,F=62,G=66.5,H=66.6,j=67,K=68,q=69,z=71,X=72,Y=73,Q=75,J=76,Z=78,$=105,ee=106,te=107,ie=108,re=109,ae=120,ne=121,se=122,oe=123,de=124,ce=125,ue=126,he=127,le=128,pe=129,fe=132,ge=133,me=135,ve=136,Ae=137,Se=138,_e=139,ye=151,Ce=-1,be=-2,we=-3,Ee=-4,Re=-5,Te=-7,Ie=-8,Me=-9,De=-10,Pe=-11,ke=-12,Oe=-14,xe=-15,Ve=-23,Ne=-26,Le=-27,We=-28,Be=-35,Ue=-129,Fe=-130,Ge=-131,He=-135},5932:(e,t,i)=>{"use strict";i.d(t,{i1:()=>ee,cY:()=>q,XF:()=>F,gP:()=>z,Yu:()=>le,uF:()=>U,SI:()=>$,qs:()=>Z,zV:()=>J,I4:()=>P,jo:()=>ie,gd:()=>H,Bw:()=>G,Gj:()=>oe,bD:()=>X,Ay:()=>K,kA:()=>Q,OC:()=>pe,DR:()=>Y,Q9:()=>he,Tv:()=>se,e5:()=>te,iD:()=>re,h:()=>de,Sq:()=>ue});var r=i(6984),a=i.n(r),n=(i(7855),i(7201)),s=i.n(n),o=i(7243),d=i(3578),c=i(5408),u=i(9109),h=i(3788),l=i(7080),p=i(7232),f=i.n(p),g=function(e,t,i,r){return new(i||(i=Promise))((function(a,n){function s(e){try{d(r.next(e))}catch(e){n(e)}}function o(e){try{d(r.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,o)}d((r=r.apply(e,t||[])).next())}))};const m=new class{constructor(){this.sentinel=null,this.isSupport=()=>"wakeLock"in navigator&&"request"in navigator.wakeLock,this.requestWakeLock=()=>g(this,void 0,void 0,(function*(){return this.isSupport()?this.sentinel&&!this.sentinel.released?Promise.reject("wakeLock has requested"):(yield this.release(),document.addEventListener("visibilitychange",this.handleVisibilityChange),document.addEventListener("fullscreenchange",this.handleVisibilityChange),this.initWakeLock()):Promise.reject("wakeLock API not available")})),this.release=()=>g(this,void 0,void 0,(function*(){return this.isSupport()?this.sentinel?(document.removeEventListener("visibilitychange",this.handleVisibilityChange),document.removeEventListener("fullscreenchange",this.handleVisibilityChange),this.sentinel.release().then((()=>(this.sentinel=null,"WakeLock release success"))).catch((e=>(c.Ay.error("Error WakeLock release:",e),e)))):"WakeLock not exist":"wakeLock API not available"})),this.handleVisibilityChange=()=>{"visible"===document.visibilityState&&(!this.sentinel||this.sentinel&&this.sentinel.released)&&(this.sentinel=null,this.initWakeLock())},this.initWakeLock=()=>g(this,void 0,void 0,(function*(){try{return this.sentinel=yield navigator.wakeLock.request("screen"),this.sentinel}catch(e){return c.Ay.error("Error WakeLock request:",e),Promise.reject(e)}}))}};var v=i(5090),A=i(3404),S=i(5475),_=i(5689);const y={};let C=!1,b=!1;const w=function(){let e=(i={},(t=(r=navigator.userAgent.toLowerCase()).match(/rv:([\d.]+)\) like gecko/))||(t=r.match(/msie ([\d\.]+)/))?(i.ie=t[1],i.name="ie"):(t=r.match(/(?:edge|edg)\/([\d\.]+)/))?(i.edge=t[1],i.name="edge"):(t=r.match(/(?:firefox|iceweasel)\/([\d\.]+)/))?(i.firefox=t[1],i.name="firefox"):(t=r.match(/(?:opera|opr).([\d\.]+)/))?(i.opera=t[1],i.name="opera"):(t=r.match(/chrome\/([\d\.]+)/))?(i.chrome=t[1],i.name="chrome"):(t=r.match(/version\/([\d\.]+).*safari/))&&(i.safari=t[1],i.name="safari"),i);var t,i,r;return function(){return e}}(),E=function(){let e={};return function(){try{var t,i,r,a,n,s;let o=f()(navigator.userAgent),d="tablet"==(null==o||null===(t=o.device)||void 0===t?void 0:t.type)||function(){var e,t,i;if(ae())return!1;const r=((null===(e=navigator)||void 0===e?void 0:e.userAgent)||"").toLowerCase();if(/ipad|android(?!.*mobile)|tablet/i.test(r))return!0;const a=Math.min((null===(t=window)||void 0===t||null===(t=t.screen)||void 0===t?void 0:t.width)||0,(null===(i=window)||void 0===i||null===(i=i.screen)||void 0===i?void 0:i.height)||0),n="ontouchstart"in window||navigator.maxTouchPoints>0;return a>=600&&a<=1280&&n}(),c="mobile"==(null==o||null===(i=o.device)||void 0===i?void 0:i.type)||ne(),u=null==o||null===(r=o.os)||void 0===r?void 0:r.name,h=null==o||null===(a=o.os)||void 0===a?void 0:a.version,l=0;if(d?l=4:c&&(l=1),!u){const e=navigator.userAgent.match(/\(([^;]+); OpenHarmony ([\d.]+)\)/);e&&e.length>2&&(u="OpenHarmony",h=e[2],"Tablet"===e[1]?l=4:"Phone"===e[1]&&(l=1))}e.osType=l,e.os=u,e.osVersion=h,e.browser=Object.assign({},o.browser),null!==(n=u)&&void 0!==n&&n.toLowerCase().includes("mac")&&(d||c)&&(e.os="ios"),null!==(s=u)&&void 0!==s&&s.toLowerCase().includes("linux")&&(d||c)&&(e.os="android");let p=(h||"").split(".")[0];u&&navigator.userAgentData&&(u.toLowerCase().includes("win")&&"10"==p||u.toLowerCase().includes("android")||u.toLowerCase().includes("mac"))&&navigator.userAgentData.getHighEntropyValues(["platform","platformVersion"]).then((t=>{u=null==t?void 0:t.platform;const i=(u||"").toLowerCase(),r=parseInt((t.platformVersion||"").split(".")[0]);i.includes("win")?(h=r>=13?"11":r>0?"10":"7",e.os=u,e.osVersion=h):(i.includes("android")||i.includes("mac"))&&(h=t.platformVersion,e.osVersion=h)}))}catch(e){}}(),function(){return e}}(),R=(e,t)=>{const i=t.toString().split("."),r=e.toString().split("."),a=i.length,n=r.length,s=Math.min(a,n);for(let e=0;e<s;e++){const t=parseInt(i[e],10),a=parseInt(r[e],10);if(t!==a)return a>t}return n>=a},T=(e,t)=>{var i=w();if("chrome"===e||"chromium"===e){if(i.chrome||i.edge||i.opera){var r=i.chrome||i.edge||i.opera;return R(r,t)}}else if(i[e])return R(i[e],t);return!1},I=function(){return T("chrome",arguments.length>0&&void 0!==arguments[0]?arguments[0]:90)},M=e=>T("firefox",e),D=e=>T("safari",e),P=new class{constructor(){this._isSupportMultiThread=!1,this._isSupportSIMD=!1,this.inProgressPromise={checkSupportMultiThread:null,checkSupportSIMD:null},this._isSupportWebtransport=!1,this._isSupportVirtualBackground=!1}async checkIsSupportMultiThread(){if(!this.getIsSupportMultiThread())try{this.inProgressPromise.checkSupportMultiThread?await this.inProgressPromise.checkSupportMultiThread:(this.inProgressPromise.checkSupportMultiThread=o.A.threads(),this._setIsSupportMultiThread(await this.inProgressPromise.checkSupportMultiThread))}catch(e){this._setIsSupportMultiThread(!1)}}_setIsSupportMultiThread(e){this._isSupportMultiThread=e}getIsSupportMultiThread(){return this._isSupportMultiThread}async checkIsSupportSIMD(){if(!this.getIsSupportSIMD())try{this.inProgressPromise.checkSupportSIMD?await this.inProgressPromise.checkSupportSIMD:(this.inProgressPromise.checkSupportSIMD=o.A.simd(),this._setIsSupportSIMD(await this.inProgressPromise.checkSupportSIMD))}catch(e){this._setIsSupportSIMD(!1)}}_setIsSupportSIMD(e){this._isSupportSIMD=e}getIsSupportSIMD(){return this._isSupportSIMD}getIsSupportWebtransport(){return I(97)&&"function"==typeof WebTransport&&this._isSupportWebtransport}setIsSupportWebtransport(e){this._isSupportWebtransport=!!e}getIsSupportVirtualBackground(){const e=I(91)||M(89)||D(17.4);return navigator.hardwareConcurrency&&navigator.hardwareConcurrency>2&&e&&"function"==typeof OffscreenCanvas&&this._isSupportVirtualBackground}setIsSupportVirtualBackground(e){this._isSupportVirtualBackground=!!e}getIsRenderSelfVideoInEncodeWorker(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!u.A.enableMultiDecodeVideoWithoutSAB&&e&&!this.getIsSupportMultiThread()&&this.getIsSupportVirtualBackground()}};var k={capacity:void 0,capacity1080:!0,get capacityfor720(){return void 0!==this.capacity&&this.capacity},set capacityfor720(e){this.capacity=e},get capacityfor1080(){return void 0!==this.capacity1080&&this.capacity1080},set capacityfor1080(e){this.capacity1080=e}},O={capacitydeco:void 0,get capacitydecofor1080(){return void 0!==this.capacitydeco&&this.capacitydeco},set capacitydecofor1080(e){this.capacitydeco=e}};function x(e,t,i){const r=e.match(t);return r&&r.length>=i&&parseInt(r[i],10)}function V(){const{navigator:e}=window,t={browser:null,version:null};if("undefined"==typeof window||!window.navigator)return t.browser="Not a browser.",t;if(e.mozGetUserMedia)t.browser="firefox",t.version=x(e.userAgent,/Firefox\/(\d+)\./,1);else if(e.webkitGetUserMedia)t.browser="chrome",t.version=x(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=x(e.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!window.RTCPeerConnection||!e.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=x(e.userAgent,/AppleWebKit\/(\d+)\./,1)}return t}const N=V(),L=function(){let e={vendor:"",renderInfo:"",isAstcSupported:!1,isWebGLContextInvalid:!0};try{const r=document.createElement("canvas");if(!r){const e="Error: document.createElement return a null canvas!";c.Ay.error(e)}let a=r.getContext("webgl")||r.getContext("moz-webgl")||r.getContext("webkit-3d")||r.getContext("experimental-webgl");if(!a||a.isContextLost()){const e="Error: canvas.getContext fail, context:".concat(a,", lost:").concat(null==a?void 0:a.isContextLost(),", size:(").concat(r.width,",").concat(r.height,")");c.Ay.error(e)}if(a){var t,i;if(e.isWebGLContextInvalid=!1,a.isContextLost()){const e="Error: webgl context is lost, canvas(".concat(r.width,",").concat(r.height,")!");c.Ay.error(e)}let n,s;if("firefox"===N.browser)n=a.getParameter(a.RENDERER),s=a.getParameter(a.VENDOR);else{let e=a.getExtension("WEBGL_debug_renderer_info");n=a.getParameter(e.UNMASKED_RENDERER_WEBGL),s=a.getParameter(e.UNMASKED_VENDOR_WEBGL)}if(e.renderInfo=null===(t=n)||void 0===t?void 0:t.toLowerCase(),e.vendor=null===(i=s)||void 0===i?void 0:i.toLowerCase(),e.isAstcSupported=-1!==a.getSupportedExtensions().indexOf("WEBGL_compressed_texture_astc"),""==s){const e="Error: vendor is null, debug:".concat(debugInfo,", render:").concat(debugInfo.UNMASKED_RENDERER_WEBGL,", vendor:").concat(debugInfo.UNMASKED_VENDOR_WEBGL,", contextLost:").concat(a.isContextLost(),"!");c.Ay.error(e)}}}catch(e){c.Ay.error("Error while get webgl context:",e)}return e}(),W=function(){if("function"!=typeof OffscreenCanvas)return!1;let e={isSupportWebgl:!1,isSupportWebgl2:!1};try{const t=new OffscreenCanvas(1,1);(t.getContext("webgl")||t.getContext("experimental-webgl")||t.getContext("moz-webgl")||t.getContext("webkit-3d"))&&(e.isSupportWebgl=!0)}catch(e){c.Ay.error("Error while get webglcontext:",e)}try{e.isSupportWebgl&&new OffscreenCanvas(1,1).getContext("webgl2")&&(e.isSupportWebgl2=!0)}catch(e){c.Ay.error("Error while get webglcontext2:",e)}return e}();var B=function(){let e=Object.assign({},W,L);return e.cpu=navigator.hardwareConcurrency?navigator.hardwareConcurrency:0,e.VE=0,e.SE=0,e.VD=0,e.SD=0,e.SAB=null!=typeof SharedArrayBuffer,e.errorMessage=null,e.visibility=!0,e.unvisibilitycount=0,e.time=0,e}();function U(){return W.isSupportWebgl}function F(e){return e?e>>10<<10:-1}function G(){return H("Main",j.getAudioContextConfigure())}function H(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"function"!=typeof AudioContext?(c.Ay.error("Not Support AudioContext"),null):(c.Ay.log("Creating ".concat(e," AudioContext")),t=i?new AudioContext(i):new AudioContext,t.onstatechange=()=>{c.Ay.log("".concat(e," AudioContext state changed to ").concat(t.state)),l.A.add_monitor("ACSC:".concat(e,":").concat(t.state))},t.onsinkchange=()=>{"object"==typeof t.sinkId&&"none"===t.sinkId.type?c.Ay.log("".concat(e," AudioContext - Audio changed to not play on any device")):c.Ay.log("".concat(e," AudioContext - Audio output device changed to ").concat(t.sinkId))},t)}const j={getOSInfo:()=>E(),getGpuInfo:()=>L,isMTRAndroidWithSAB:()=>-1!==navigator.userAgent.indexOf("MSFT Teams Android Room")&&"undefined"!=typeof SharedArrayBuffer,isSupport2DCanvasDrawFrame:()=>"function"==typeof MediaStreamTrackProcessor&&"chrome"==N.browser&&N.version>=104&&-1==navigator.appVersion.indexOf("Mac"),checkLocalP2PConnection:()=>new Promise((async(e,t)=>{function i(e){return new Promise(((t,i)=>{e.onconnectionstatechange=i=>{"connected"===e.connectionState&&t(!0)}}))}function r(e){e&&e.close()}let a,n,s=null,o=null,d=document.createElement("canvas");try{d.width=200,d.height=200,d.getContext("2d");let t=d.captureStream();if("function"!=typeof RTCPeerConnection)return void e(!1);if(s=new RTCPeerConnection,o=new RTCPeerConnection,s.onicecandidate=e=>{e.candidate&&o.addIceCandidate(new RTCIceCandidate(e.candidate))},o.onicecandidate=e=>{e.candidate&&s.addIceCandidate(new RTCIceCandidate(e.candidate))},Promise.all([i(s),i(o)]).then((()=>{e(!0),r(s),r(o)})),"function"!=typeof s.addStream)return void e(!1);await s.addStream(t),a=await s.createOffer(),await s.setLocalDescription(a),await o.setRemoteDescription(a),n=await o.createAnswer(),await o.setLocalDescription(n),await s.setRemoteDescription(n),setTimeout((()=>{e(!1),r(s),r(o)}),200)}catch(t){c.Ay.error("Error when trying to check for local RTC peer connection",t),e(!1)}})),getDocumentHandle:e=>document.getElementById(e),browserType:N,browser:{isFirefox:"firefox"===N.browser,isChrome:"chrome"===N.browser,isSafari:"safari"===N.browser},isIphoneOrIpadSafari(){return this.isIphoneOrIpadBrowser()||this.isIpadOS()},isOpera65:()=>function(){try{var e=navigator.userAgent.match(/OPR\/(\d+)\./);return!!(e&&Number(e[1])<66)}catch(e){return!1}}(),isOpera:()=>/opera|opr\/[\d]+/i.test(navigator.userAgent),isOperaVersionHigherThan(e){try{var t=navigator.userAgent.match(/OPR\/(\d+)\./);return!!(t&&Number(t[1])>=e)}catch(e){return!1}},isAndroidBrowser:()=>function(){try{var e=navigator.userAgent||navigator.vendor||window.opera;return!!/android/i.test(e)}catch(e){return!1}}(),isAndroidVersionLessEqual(e){const t=E();if(!t.os||"android"!==t.os.toLowerCase()||!t.osVersion)return!1;const i=t.osVersion.toString().split(".");return parseInt(i[0])<=e},isSupportVideoFrame:()=>"undefined"!=typeof VideoFrame,isQuestBrowser:()=>function(){try{return/oculusbrowser/i.test(navigator.userAgent)}catch(e){return!1}}(),isMobileSafariSupportVideoFrame(){return(this.isIphoneOrIpadBrowser()||this.isIpadOS()&&u.A.rwgAgent)&&this.isSupportVideoFrame()},isSelfPreviewRenderWithVideo(){return!!this.isMobileSafariSupportVideoFrame()||!P.getIsSupportMultiThread()&&!P.getIsSupportVirtualBackground()&&this.isSupportVideoFrameOrBitmapCapture()||this.isAndroidBrowser()&&!this.isMTRAndroidWithSAB()&&!u.A.rwgAgent},isSupportNewWaitRoomFlow:()=>!0,isMacIntelSafari(){try{return!(!this.browser.isSafari||navigator.maxTouchPoints&&!(navigator.maxTouchPoints<=2)||L.isAstcSupported||!this.isMac())}catch(e){return!1}},isMacIntelChrome(){try{var e;return!!(this.browser.isChrome&&(!navigator.maxTouchPoints||navigator.maxTouchPoints<=2)&&(null===(e=L.vendor)||void 0===e?void 0:e.indexOf("intel"))>-1&&this.isMac())}catch(e){return!1}},isIphoneOrIpadBrowser(){try{return!!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)}catch(e){return!1}},isIphoneBrowser(){try{return!!/(iPhone)/g.test(navigator.userAgent)}catch(e){return!1}},isIpadOS:()=>navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&(/iPad/.test(navigator.platform)||/MacIntel/.test(navigator.platform)),isIpadOSNew:()=>navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&(/iPad/.test(navigator.platform)||/MacIntel/.test(navigator.platform)||/Intel Mac/.test(navigator.platform)),isChromeOS:()=>function(){try{return!!/\bCrOS\b/.test(navigator.userAgent)}catch(e){return!1}}(),isWindowsChrome(){const{userAgent:e}=navigator;return/windows/i.test(e)},isTeslaMode:()=>/TESLA/.test(navigator.userAgent),isMac:()=>navigator.platform.indexOf("Mac")>-1,isWindows:()=>navigator.platform.indexOf("Win")>-1,isLinux(){return navigator.platform.indexOf("Linux")>-1&&!this.isChromeOS()},isMTRAndroid:()=>/MSFT Teams Android Room/i.test(navigator.userAgent),isMTRWindows(){const e=window.meetingHost;return!!e&&("MSFT"===e.getHostState().vendorId&&!this.isMTRAndroid())},isSupportChromeWideAEC(){const e=u.A.chromeWideAEC&&this.isChromeOS()&&I(116);return(this.isMac()||this.isWindows()||this.isLinux())&&I(111)||e||u.A.isGoogleMeetMode},isSupportOpenMicWhenShareAudio(){return this.isSupportChromeWideAEC()&&!u.A.shareSystemAudio},getAudioFeatureFlags:()=>u.A.enableAudioBridge?4:12,isSupportShareMultiStream:()=>!0,isSupportVideoLTR:()=>!0,isSupportAudioBridgeAvsync:()=>!0,getAudioContextConfigure(){let e={};return function(){return T("chromium",arguments.length>0&&void 0!==arguments[0]?arguments[0]:90)}(74)&&(e={sampleRate:48e3,latencyHint:.02}),e},download(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(y[e])return y[e];let i=new Promise((async(i,r)=>{let a={};t&&(a.integrity=t);for(let t=0;t<3;t++)try{let n=await fetch(e,a);if(null!=n&&n.ok){i(n.text()),t>0&&c.Ay.error("after ".concat(t," retry download js ").concat(e," successed "));break}2==t&&r("download failed ".concat(e," ").concat(null==n?void 0:n.status))}catch(e){2==t&&r(e)}}));return y[e]=i,i},async downloadAndCompileWebAssembly(e,t,i){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a="".concat(e).concat(r);if(y[a])return y[a];let n=new Promise((async(a,n)=>{let s=null;i.add_monitor("CS".concat(t));for(let n=0;n<3;n++){try{if(r)s=await WebAssembly.compileStreaming(fetch(e,{priority:"high"}));else{const t=await fetch(e,{priority:"high"});s=await t.arrayBuffer()}i.add_monitor("CE".concat(t))}catch(a){if("TypeError"===a.name)try{const t=await fetch(e,{priority:"high"}),i=await t.arrayBuffer();s=await WebAssembly.compile(i)}catch(a){2==n&&(i.add_monitor("".concat(r?"CF":"FF").concat(t)),c.Ay.error("Failed to download WASM file using compile: ".concat(e," for worker type: ").concat(t),a))}else 2==n&&c.Ay.error("Failed to download WASM file using ".concat(r?"compileStreaming":"fetch",": ").concat(e," for worker type: ").concat(t),a)}if(s)return a(s),void(n>0&&c.Ay.error("after ".concat(n," retry download wasm ").concat(e," successed ")))}n(new Error("Unable to download and compile WASM file: ".concat(e," for worker type: ").concat(t)))}));return y[a]=n,n},readBlob:e=>new Promise(((t,i)=>{var r=new FileReader;r.onload=function(){t(r.result)},r.readAsText(e)})),readBlobAsBuffer:e=>new Promise(((t,i)=>{var r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsArrayBuffer(e)})),lengthInUtf8Bytes(e){var t=encodeURIComponent(e).match(/%[89ABab]/g);return e.length+(t?t.length:0)},isLittleEndian(){let e=new ArrayBuffer(2),t=new Uint8Array(e),i=new Uint16Array(e);return t[0]=170,t[1]=187,48042===i[0]},sleep:e=>new Promise(((t,i)=>{setTimeout((()=>{t(!0)}),e)})),isSDKSupportMultiThread:async()=>(await P.checkIsSupportMultiThread(),P.getIsSupportMultiThread()),is32bitChrome:async()=>-1!=navigator.userAgent.indexOf("WOW64")||!(!navigator.userAgentData||!navigator.userAgentData.getHighEntropyValues)&&(await navigator.userAgentData.getHighEntropyValues(["wow64"])).wow64,isAMDGraphic(){try{return this.graphicName.includes("amd")}catch(e){return!1}},graphicName:L.renderInfo,graphicvendorname:L.vendor,isGraphicShouldUseHardwareAccelerationDecode(){return!!C||!(!this.isAMDGraphic()||!this.isChromeOS())||!(this.isAMDGraphic()&&!this.isChromeOS())},VP9MachineDetect(){const e=navigator.mediaCapabilities.decodingInfo({type:"webrtc",video:{contentType:"video/vp9",bitrate:1e7,framerate:25,height:1920,width:1080}});return new Promise(((t,i)=>{e.then((e=>{e.supported||(c.Ay.log("video/vp9 codec isn't supported in software or hardware"),t(!1)),t(e.powerEfficient)})).catch((e=>{c.Ay.warn("Error when trying to determine support for VP9 codec",e),t(!1)}))}))},async IsSupportVideoDecodeHardwareAcceleration(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(C)return!0;if("function"!=typeof VideoDecoder||this.browser.isSafari&&!D("17.5"))return!1;var t={codec:"avc1.640028",description:new Uint8Array([1,100,0,31,255,225,0,14,103,100,0,51,172,27,26,17,129,64,22,201,160,16,7,0,5,104,200,66,60,48,0,5,104,82,16,207,12,0,25,104,114,16,143,24,67,17,132,56,140,84,81,8,18,22,41,3,194,98,3,5,32,122,9,140,0,5,104,36,132,51,203,0,5,104,46,132,51,195,0,25,104,54,132,35,198,16,196,97,14,35,21,20,66,4,133,138,64,240,152,128,193,72,30,130,99,0,5,104,62,132,51,203]),codedWidth:1280,codedHeight:720,optimizeForLatency:!0,hardwareAcceleration:e?"no-preference":"prefer-hardware"};try{return!!(await VideoDecoder.isConfigSupported(t)).supported}catch(e){return!1}},async IsSupportVideoEncodeHardwareAcceleration(){if(C)return!0;if("function"!=typeof VideoEncoder||this.browser.isSafari&&!D("17.5"))return!1;return!!(await VideoEncoder.isConfigSupported({codec:"avc1.640028",bitrate:15e5,width:1280,height:720,avc:{format:"annexb"},framerate:25,hardwareAcceleration:"no-preference",latencyMode:"realtime",bitrateMode:"constant",scalabilityMode:"L1T2"})).supported},isVideoEncoderPreconditionMatched(){return"function"==typeof VideoEncoder&&(!this.browser.isSafari||D("17.5"))},isVideoDecoderPreconditionMatched(){return"function"==typeof VideoDecoder&&(!this.browser.isSafari||D("17.5"))},AdapterWhiteListCheckForEncoder(){if(!U())return-1;try{var e=L.renderInfo,t=L.vendor,i=e.toLowerCase(),r=t.includes("ARM"),a=(i.includes("amd"),i.includes("intel"));return i.includes("hd graphics"),i.includes("nvidia"),i.includes("geforce"),a?0:r?-1:0}catch(e){return 0}},isChromeVersionHigherThan:I,isFirefoxVersionHigherThan:M,isSafariVersionHigherThan:D,async isSDKSupportSIMD(){if("object"!=typeof WebAssembly)return!1;if("chrome"==N.browser){if(!(N.version>=84))return!1;await P.checkIsSupportSIMD()}else await P.checkIsSupportSIMD();return P.getIsSupportSIMD()},buffer2stringSplitByComma:e=>new Uint8Array(e).join(","),stringSplitByComma2Buffer(e){try{let t=e.split(",").map((e=>parseInt(e))),i=new ArrayBuffer(t.length),r=new Uint8Array(i);for(let e=0;e<t.length;e++)r[e]=t[e];return i}catch(e){return null}},removeDuplicates(e,t){let i=[];return e.forEach((e=>{let r=!1;for(let a=0;a<i.length;a++)if(!t.call(null,i[a],e)){r=!0;break}r||i.push(e)})),i},getBrowserVersion(){let e=function(){var e=navigator.userAgent.toLowerCase();if(e.indexOf("firefox")>0)return e.match(/firefox\/[\d.]+/gi);if(e.indexOf("safari")>0&&e.indexOf("chrome")<0){var t,i="safari/unknow";return i=e.match(/safari\/[\d.]+/gi),t=e.match(/safari\/[\d.]+/gi),i&&(i=[i.toString().replace("version","safari")]),t&&(i=[t.toString().replace("version","safari")]),i}return e.indexOf("chrome")>0?e.match(/chrome\/[\d.]+/gi):"other"}();return e[0]&&e[0].match(/(\d+)/)?e[0].match(/(\d+)/)[0]:"other"},getIOSMajorVersion(){if(/iP(hone|od|ad)/.test(navigator.platform)){let e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return parseInt(e[1],10)}return null},getMacSafariMajorVersion(){if(this.browser.isSafari){const e=navigator.userAgent.match(/Version\/([\d\.]+)/);return e&&e[1]?parseFloat(e[1]):null}return null},isSupportImageCapture:()=>!1,isSupportOffscreenCanvas:()=>U(),isSupport2dOffscreenCanvas:()=>"function"==typeof OffscreenCanvas,isSupportVideoTrackReader:()=>!1,isSupportMediaStreamTrackProcessor:function(){return"function"==typeof MediaStreamTrackProcessor&&U()},isSupportVideoFrameOrBitmapCapture(){return this.isSupportMediaStreamTrackProcessor()},isSupportSharedArrayBuffer:()=>"undefined"!=typeof SharedArrayBuffer,async queryPTZPermisson(){try{return"granted"==(await navigator.permissions.query({name:"camera",panTiltZoom:!0})).state}catch(e){return c.Ay.error("Error when querying pan-tilt-zoom permission",e),!1}},isSupportCameraPan(){var e,t;return!(null===(e=navigator.mediaDevices)||void 0===e||null===(t=e.getSupportedConstraints)||void 0===t||null===(t=t.call(e))||void 0===t||!t.pan)},isSupportCameraTilt(){var e,t;return!(null===(e=navigator.mediaDevices)||void 0===e||null===(t=e.getSupportedConstraints)||void 0===t||null===(t=t.call(e))||void 0===t||!t.tilt)},isSupportCameraZoom(){var e,t;return!(null===(e=navigator.mediaDevices)||void 0===e||null===(t=e.getSupportedConstraints)||void 0===t||null===(t=t.call(e))||void 0===t||!t.zoom)},isSupportPTZ(){var e,t;const i=null===(e=navigator.mediaDevices)||void 0===e||null===(t=e.getSupportedConstraints)||void 0===t?void 0:t.call(e);return i&&i.pan&&i.tilt&&i.zoom},get720pcapacity:()=>k.capacityfor720,set720pcapacity(e){k.capacityfor720=e},get1080pcapacity:()=>k.capacity1080,set1080pcapacity(e){k.capacity1080=e},isSupportBrowserWebRTC:()=>!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&window.RTCPeerConnection),getsub1080pcapacity:()=>O.capacitydecofor1080,setsub1080pcapacity(e){O.capacitydecofor1080=e},isSupportMultiViewAPI(){var e;return U()&&(null===(e=navigator)||void 0===e?void 0:e.hardwareConcurrency)>=2&&"function"==typeof requestAnimationFrame&&"function"==typeof SharedArrayBuffer},getMaxCountRender(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return void 0===t||void 0===i||t||this.isSupportMultiViewAPI()?navigator.userAgent.match(/\(([^;]+); OpenHarmony ([\d.]+)\)/)?1:null!==(e=navigator)&&void 0!==e&&e.hardwareConcurrency?navigator.hardwareConcurrency<4||ne()?9:25:1:"object"==typeof i&&null!=i&&i.disableRenderLimits?25:"boolean"==typeof i&&i?4:1},checkAudioAutoPlay:()=>new Promise(((e,t)=>{let i=new ArrayBuffer(684),r=new Uint32Array(i);r.set([1179011410,676,1163280727,544501094,16,65539,16e3,64e3,2097156,1635017060,640],0);let n=new Blob([r],{type:"audio/wav"}),s=a().createObjectURL(n),o=new Audio(s);o.addEventListener("canplaythrough",(()=>{o.play().then((()=>{e(!0)})).catch((e=>{c.Ay.log("Unable to auto play audio",e),t(e)})).finally((()=>{a().revokeObjectURL(s)}))})),o.load&&o.load()})),isSupportSendVideoFullHD(){return this.isSupportVideoShareSend()&&navigator.hardwareConcurrency>=8},isSupportSendVideoShareFullHD:()=>!1,isSupportVideoShare:()=>!0,isSupportVideoShareSend(){let e,t=V();return"chrome"==t.browser&&(e=this.getBrowserVersion()),!!this.isSupportSharedArrayBuffer()&&!("chrome"!==t.browser||e&&e<=100||navigator.hardwareConcurrency<=2||this.isTeslaMode()||this.isAndroidBrowser()&&!this.isMTRAndroidWithSAB()||this.isIphoneOrIpadBrowser())},isSupportVideoShareReceive:()=>!0,getOption(e,t,i){try{let r=e.length;if(t>r)return 0;let a=e.slice(r-t-i+1,r-t+1);if(a)return parseInt(a,16)}catch(e){}return 0},async isSupportWebGPURender(e){const t=this.parseGPUBlacklist(e);return await this.evaluateRendererType(!0,!1,t)==h.h3.WEBGPU},getMachineCapability(){var e,t,i,r,a,n,s;return B.VE=null===u.A||void 0===u.A||null===(e=u.A.localVideoPara)||void 0===e||null===(e=e.VE)||void 0===e?void 0:e.buffer.byteLength,B.VD=null===u.A||void 0===u.A||null===(t=u.A.localVideoPara)||void 0===t||null===(t=t.VD)||void 0===t?void 0:t.buffer.byteLength,B.SE=null===u.A||void 0===u.A||null===(i=u.A.localVideoPara)||void 0===i||null===(i=i.SE)||void 0===i?void 0:i.buffer.byteLength,B.SD=null===u.A||void 0===u.A||null===(r=u.A.localVideoPara)||void 0===r||null===(r=r.SD)||void 0===r?void 0:r.buffer.byteLength,B.dt=null===u.A||void 0===u.A||null===(a=u.A.localVideoPara)||void 0===a?void 0:a.videodecodethreadnumb,B.et=null===u.A||void 0===u.A||null===(n=u.A.localVideoPara)||void 0===n?void 0:n.videoencodethreadnumb,B.MT=null===u.A||void 0===u.A||null===(s=u.A.localVideoPara)||void 0===s?void 0:s.isSupportMultiThread,B.time=performance.now(),B},watermark:(()=>{const e=new d.A,t=document.createElement("canvas"),i={enableWaterMark:!1,waterMarkText:"",watermarkOpacity:0,watermarkRepeated:!1,watermarkPosition:void 0};return{getWaterMarkData(r){let{width:a,height:n}=r;if(!i.enableWaterMark)return null;const s=a<512||n<288?16:i.watermarkPosition,o=i.watermarkRepeated&&a>306&&n>202,d=function(e,t){if(e<640&&e){const i=640/e;e=640,t=Math.round(t*i)}return{width:e,height:t}}(a,n);return a=d.width,n=d.height,o?e.Get_Repeated_WaterMarkRGBA({canvas:t,name:i.waterMarkText,width:d.width,height:d.height,opacity:i.watermarkOpacity,position:s,convertToDataUrl:!0}):e.Get_WaterMarkRGBA({canvas:t,name:i.waterMarkText,width:d.width,height:d.height,opacity:i.watermarkOpacity,position:s,convertToDataUrl:!0})},updateWaterMarkInfo(e){Object.assign(i,e)}}})(),isSupportAudioDenoise(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if("function"!=typeof AudioContext)return!1;if("chrome"==V().browser&&this.getBrowserVersion()<=100)return!1;const t=WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]));return!(!1===t||(!0!==t?(c.Ay.error("WebAssembly.validate don't return a boolean"),1):!e&&!this.isSupportSharedArrayBuffer()||navigator.hardwareConcurrency<=2||this.isTeslaMode()||this.isAndroidBrowser()&&!this.isMTRAndroidWithSAB()||this.isIphoneOrIpadBrowser()))},isSupportPlayStereo(){return!!(this.browser.isFirefox||this.browser.isSafari||this.isSupportChromeWideAEC())},isBrowserSupportStereo(){return!this.browser.isSafari},isSupportShare2ndAudioDevice(e){return!(this.browser.isSafari||this.isIphoneOrIpadBrowser()||this.isAndroidBrowser()||!e&&(this.isMac()&&!I(126)||!this.isSupportSharedArrayBuffer()))},isSupportSharingStereo:()=>!1,isSupportVideoActiveChannel:()=>!0,async evaluateRendererType(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=h.h3.WEBGL,a=null;const n=U();try{if(this.isWebGL2Supported(t)?r=h.h3.WEBGL_2:c.Ay.log("evaluateRendererType() WebGL 2 is not supported."),!this.isSupportVideoFrame())return c.Ay.log("evaluateRendererType() WebGPU is not supported. (reason: VideoFrame is not supported)"),r;if(!(this.isMac()||this.isWindows()||this.isChromeOS()||this.isLinux()))return c.Ay.log("evaluateRendererType() WebGPU is not supported. (reason: unsupported platform)"),r;if(!(this.browser.isChrome&&this.isChromeVersionHigherThan(119)||this.isOpera()&&this.isOperaVersionHigherThan(108)||this.browser.isChrome&&(this.isLinux()||this.isAndroidBrowser())&&this.isChromeVersionHigherThan(121)))return c.Ay.log("evaluateRendererType() WebGPU is not supported. (reason: unmatched browser)"),r;if(!navigator.gpu)return r;const s=await navigator.gpu.requestAdapter();if(!s)return c.Ay.log("evaluateRendererType() WebGPU is not supported. (reason: no available adapter.)"),r;if(!await s.requestDevice())return c.Ay.log("evaluateRendererType() WebGPU is not supported. (reason: no available device.)"),r;let o;if("function"==typeof s.requestAdapterInfo?o=await s.requestAdapterInfo():"info"in s&&(o=s.info),!o)return c.Ay.log("evaluateRendererType() WebGPU is not supported. (reason: no available adapter info.)"),r;c.Ay.log("evaluateRendererType() GPUAdapterInfo: arch=".concat(o.architecture,", vendor=").concat(o.vendor)),console.log("evaluateRendererType() GPUAdapterInfo: arch=".concat(o.architecture,", vendor=").concat(o.vendor));const d=this.queryDeviceProfile(o);if(!this.isGPUProfileOnWebGPUWhitelist(d,i))return r;if(n){if(a=new OffscreenCanvas(1,1),!a.getContext("webgpu"))return c.Ay.log("evaluateRendererType() WebGPU is not supported. (reason: no available GPUContext.)"),r;if(!this.isOpFeatureEnabled(e))return c.Ay.log("evaluateRendererType() WebGPU is not supported. (reason: WebGPU is not allowed for this account.)"),r;a=null,r=h.h3.WEBGPU}else c.Ay.log("evaluateRendererType() OffscreenCanvas is not supported while checking WebGPU.");return r}catch(e){return c.Ay.error("evaluateRendererType()",e),r}finally{a=null}},isOpFeatureEnabled:e=>1&e,queryDeviceProfile(e){if(e){let t={};return t.architecture=e.architecture,t.vendor=e.vendor,t}return null},isGPUProfileOnWebGPUWhitelist(e,t){if(!e)return!1;const i=e.vendor,r=e.architecture;return-1==h.O$.indexOf(i)?(c.Ay.log("isGPUProfileOnWebGPUWhitelist() vendor:".concat(i," arch:").concat(r," is not on the vendor whitelist!")),!1):null===t||!this.isHitGPUBlacklist(i,r,t)},isHitGPUBlacklist(e,t,i){if(""===e||void 0===e||void 0===t||void 0===i)return!1;for(let r=0;r<i.length;r++){const a=i[r];if(e.includes(a.vendor)&&t.includes(a.generations))return!0}return!1},parseGPUBlacklist(e){let t=null;if(e)try{const i=JSON.parse(e);t=null==i?void 0:i.GPUBlacklist}catch(t){c.Ay.error("parseGPUBlacklist() failed to read mediaBlockConfig! val=".concat(e))}return t},async getRendererTypeList(e,t){const i=this.parseGPUBlacklist(t),r=[{bitIndex:_.n.WEBGPU_RENDERER.index,readCount:1,defaultVal:_.n.WEBGPU_RENDERER.default},{bitIndex:_.n.WEBGL2_RENDERER.index,readCount:1,defaultVal:_.n.WEBGL2_RENDERER.default}],a=S.A.batchRead(e,r),n=!!a.get(_.n.WEBGPU_RENDERER.index),s=!!a.get(_.n.WEBGL2_RENDERER.index),o=await this.isWebGPUSupported(n,i),d=this.isWebGL2Supported(s),c=U(),u=[];return o&&u.push({rendererType:h.h3.WEBGPU,rendererName:"WebGPU"}),d&&u.push({rendererType:h.h3.WEBGL_2,rendererName:"WebGL2"}),c&&u.push({rendererType:h.h3.WEBGL,rendererName:"WebGL"}),u},evaluateWebRTCStrategy(e,t){var i,r;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e!==h.BH.DISABLED&&e!==h.BH.ENABLED&&e!==h.BH.AUTO&&(c.Ay.error("evaluateWebRTCStrategy() invalid webrtcSelection(".concat(e,") from caller.")),e=h.BH.AUTO);let n={shouldUseWebRTC:!1,errNo:h.Qb.UNKNOWN,errMsg:""};if(!this.isWebRTCFeatureEnabled(t))return n.shouldUseWebRTC=!1,n.errNo=h.Qb.FEATURE_OPTION_DISABLED,n.errMsg="webrtc is disabled(feature option is disabled).",n;const s=this.getOSInfo();let o=(null==s||null===(i=s.browser)||void 0===i?void 0:i.name)||"",d=(null==s||null===(r=s.browser)||void 0===r?void 0:r.version)||"",u=L;const l={os:null==s?void 0:s.os,osType:null==s?void 0:s.osType,browserName:o,browserVersion:d,vendor:u.vendor,renderInfo:u.renderInfo,isAstcSupported:u.isAstcSupported};if(e===h.BH.DISABLED)return c.Ay.log("evaluateWebRTCStrategy() WebRTC is disabled by caller."),n.shouldUseWebRTC=!1,n.errNo=h.Qb.SUCCEED,n.errMsg="webrtc is disabled(disabled by caller).",n;let p=null==a?void 0:a.VideoWhitelist;const f=this.isSupportBrowserWebRTC();try{const i=v.A.isOnWebRTCWhitelist(p,l);if(i.isInWhitelist){const r=v.A.evalWebRTCStrategy(i.blacklist,l,f,e);n.errNo=r.errNo,n.errMsg=r.errMsg,r.stg==h.BH.ENABLED?n.shouldUseWebRTC=!0:r.stg==h.BH.DISABLED?n.shouldUseWebRTC=!1:r.stg==h.BH.AUTO?n.shouldUseWebRTC=this.isDefaultToUseWebRTC(t,l):(n.shouldUseWebRTC=!1,n.errNo=h.Qb.UNKNOWN_SELECTION,n.errMsg="webrtc is disabled(unknown selection type).",c.Ay.error("evaluateWebRTCStrategy() unknown WEBRTC_STG:".concat(r.stg)))}else n.shouldUseWebRTC=!1,n.errNo=h.Qb.DEVICE_NOT_ON_WHITELIST,n.errMsg="webrtc is disabled(not on the whitelist)."}catch(e){c.Ay.error("evaluateWebRTCStrategy() error:",e),n.shouldUseWebRTC=!1,n.errNo=h.Qb.OTHER_EX,n.errMsg="webrtc is disabled(unexpected error:".concat(e.errorMessage,").")}return c.Ay.directReport("evaluateWebRTCStrategy() stg=".concat(JSON.stringify(n),", isBrowserSupportWebRTC=").concat(f,", videoWhitelist=").concat(JSON.stringify(p),", selection=").concat(e)),n},isWebRTCFeatureEnabled(e){const t=S.A.read(e,_.n.ENABLE_WEBRTC_FEATURE.index,1,_.n.ENABLE_WEBRTC_FEATURE.default);return c.Ay.log("isWebRTCFeatureEnabled() optionVal:".concat(t)),!!t},getAnnotationCapability(e){const t=S.A.read(e,_.n.SUPPORT_ANNOTATION.index,1,_.n.SUPPORT_ANNOTATION.default),i=S.A.read(e,_.n.SUPPORT_ANNOTATION_PRESENTER.index,1,_.n.SUPPORT_ANNOTATION_PRESENTER.default),r=t?i?2:1:0;return c.Ay.log("getAnnotationCapability() cap:".concat(r)),r},getWebRTCStrategyOptions(e){const t=S.A.read(e,_.n.WEBRTC_STG.index,1,_.n.WEBRTC_STG.default);c.Ay.log("getWebRTCStrategyOption() optionVal:".concat(t));const i=[];return Object.entries(h.BH).forEach((e=>{let[r,a]=e;const n={key:r,value:a,isDefault:!1};t===a&&(n.isDefault=!0),i.push(n)})),i},isDefaultToUseWebRTC(e,t){const i=[{bitIndex:_.n.WEBRTC_SMART_AUTO_STG_1.index,readCount:1,defaultVal:_.n.WEBRTC_SMART_AUTO_STG_1.default},{bitIndex:_.n.WEBRTC_SMART_AUTO_STG_2.index,readCount:1,defaultVal:_.n.WEBRTC_SMART_AUTO_STG_2.default},{bitIndex:_.n.WEBRTC_SMART_AUTO_STG_3.index,readCount:1,defaultVal:_.n.WEBRTC_SMART_AUTO_STG_3.default},{bitIndex:_.n.WEBRTC_SMART_AUTO_STG_4.index,readCount:1,defaultVal:_.n.WEBRTC_SMART_AUTO_STG_4.default}],r=S.A.batchRead(e,i),a=r.get(_.n.WEBRTC_SMART_AUTO_STG_1.index),n=r.get(_.n.WEBRTC_SMART_AUTO_STG_2.index),s=r.get(_.n.WEBRTC_SMART_AUTO_STG_3.index),o=!!(a&_.n.WEBRTC_SMART_AUTO_STG_1.candidates.SAB_OFF_NO_OFFSCREENCANVAS_NO_GPU),d=!!(n&_.n.WEBRTC_SMART_AUTO_STG_2.candidates.DESKTOP_LOW_PERF_DEVICE);if(o){if(!this.isSupportSharedArrayBuffer())return c.Ay.log("isDefaultToUseWebRTC() force WebRTC. reason: SharedArrayBuffer not support"),!0;if(!this.isSupport2dOffscreenCanvas())return c.Ay.log("isDefaultToUseWebRTC() force WebRTC. reason: OffscreenCanvas not support"),!0;if(t.renderInfo&&t.renderInfo.toLowerCase().includes("swiftshader"))return c.Ay.log("isDefaultToUseWebRTC() force WebRTC. reason: swiftshader"),!0}if(d&&0==t.osType&&this.isLowPerformanceDevice())return c.Ay.log("isDefaultToUseWebRTC() force WebRTC. reason: desktop low performance device (cores <= 4)"),!0;if(s&_.n.WEBRTC_SMART_AUTO_STG_3.candidates.WEBCODEC_NOT_SUPPORT&&!this.isVideoEncoderPreconditionMatched()&&!this.isVideoDecoderPreconditionMatched())return c.Ay.log("isDefaultToUseWebRTC() force WebRTC. reason: webcodec not support"),!0;if(n&_.n.WEBRTC_SMART_AUTO_STG_2.candidates.VIDEO_ON_BROWSER_32BIT&&b)return c.Ay.log("isDefaultToUseWebRTC() force WebRTC. reason: 32-bit os/browser for video"),!0;const u=!!(a&_.n.WEBRTC_SMART_AUTO_STG_1.candidates.MOB_ANDROID)||!!(a&_.n.WEBRTC_SMART_AUTO_STG_1.candidates.MOB_IOS),h=!!(a&_.n.WEBRTC_SMART_AUTO_STG_1.candidates.DESKTOP);return!(!u&&!h||![{os:"android",flag:_.n.WEBRTC_SMART_AUTO_STG_1.candidates.MOB_ANDROID},{os:"ios",flag:_.n.WEBRTC_SMART_AUTO_STG_1.candidates.MOB_IOS},{os:"win",flag:_.n.WEBRTC_SMART_AUTO_STG_1.candidates.DESKTOP},{os:"mac",flag:_.n.WEBRTC_SMART_AUTO_STG_1.candidates.DESKTOP},{os:"chromium os",flag:_.n.WEBRTC_SMART_AUTO_STG_1.candidates.DESKTOP}].some((e=>{var i;let{os:r,flag:n}=e;return a&n&&(null===(i=t.os)||void 0===i?void 0:i.toLowerCase().includes(r))})))&&(c.Ay.log("isDefaultToUseWebRTC() force WebRTC. reason: force WebRTC on specific OS"),!0)},isWebGL2Supported:e=>"function"==typeof OffscreenCanvas&&e&&W.isSupportWebgl2,isWebGL2SupportedWhenOpEnabled:()=>W.isSupportWebgl2,async isWebGPUSupported(e,t){if(!e)return!1;if(!this.isSupportVideoFrame())return!1;if(!(this.isMac()||this.isWindows()||this.isChromeOS()||this.isLinux()))return!1;if(!(this.browser.isChrome&&this.isChromeVersionHigherThan(119)||this.isOpera()&&this.isOperaVersionHigherThan(108)||this.browser.isChrome&&(this.isLinux()||this.isAndroidBrowser())&&this.isChromeVersionHigherThan(121)))return!1;if(!navigator.gpu)return!1;const i=await navigator.gpu.requestAdapter();if(!i)return!1;if(!await i.requestDevice())return!1;let r;if("function"==typeof i.requestAdapterInfo?r=await i.requestAdapterInfo():"info"in i&&(r=i.info),!r)return!1;const a=this.queryDeviceProfile(r);if(!this.isGPUProfileOnWebGPUWhitelist(a,t))return c.Ay.log("isWebGPUSupported() hit blacklist! profile=".concat(JSON.stringify(a),", blacklist=").concat(JSON.stringify(t))),!1;let n=new OffscreenCanvas(1,1);return n.getContext("webgpu")?(n=null,!0):(n=null,!1)},async isRendererTypeSupported(e,t,i,r){return!(e<=h.h3.UNDEFINED||e>h.h3.WEBGL_2)&&(e===h.h3.WEBGL?U():e===h.h3.WEBGL_2?this.isWebGL2Supported(i):e===h.h3.WEBGPU&&await this.isWebGPUSupported(t,r))},videoToMediaStreamManager:(()=>{let e,t,i=document.createElement("canvas"),r=i.getContext("2d"),a=640,n=360;const s=navigator.hardwareConcurrency&&navigator.hardwareConcurrency<4?10:24,o=1e3/("chrome"===N.browser?s:10);let d=null,c=0,u=null;return{_draw(){if(!e)return;this.drawCanvas(i,r,a,n);const t=performance.now();if(c){const e=t-c;e>o?this._setFasterTimer():e<.8*o&&this._clearFastTimer()}c=t},_setFasterTimer(){d||(d=setInterval((()=>{e&&e.currentTime>0&&!e.paused&&!e.ended&&performance.now()-c>=o/2&&this.drawCanvas(i,r,a,n)}),o))},_clearFastTimer(){c=0,clearInterval(d),d=null},drawCanvas(t,i,r,a){t.width=r,t.height=a;let n=0,s=0;e.videoWidth/e.videoHeight>r/a?(s=e.videoHeight,n=r/a*s):(n=e.videoWidth,s=a/r*n),i.drawImage(e,(e.videoWidth-n)/2,(e.videoHeight-s)/2,n,s,0,0,r,a)},startCapture(r,o,d){return e=r,o&&d&&o/d==16/9&&(a=o,n=d),u&&e.removeEventListener("timeupdate",u),u=this._draw.bind(this),r.addEventListener("timeupdate",u),t=i.captureStream(s),t},stopCapture(){u&&e.removeEventListener("timeupdate",u),this._clearFastTimer(),t&&(t.getVideoTracks().forEach((e=>e.stop())),t=null),e=null},isSupported:()=>"function"==typeof HTMLCanvasElement.prototype.captureStream}})(),audioToMediaStreamMananger:(()=>{let e=null,t=null,i=null,r=null,a=null;return{startCapture(n){if(t||(t=H("File")),a&&n===a)e=a;else{this.destroy(),e=n,a=e,r=t.createMediaElementSource(e);const s=t.createMediaStreamDestination();r.connect(s),i=s.stream}return"suspended"!==t.state&&"interrupted"!==t.state||t.resume().catch((e=>{c.Ay.error("File audio context resume error: ",e)})),i},stopCapture(){t&&t.suspend(),e=null},destroy(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];r&&r.disconnect(),i&&(i.getAudioTracks().forEach((e=>e.stop())),i=null),a=null,r=null,!e&&t&&(t.close(),t=null)},isAudioFileStream:e=>e===i,isSupported:()=>"undefined"!=typeof AudioContext&&"function"==typeof AudioContext.prototype.createMediaStreamDestination&&"function"==typeof AudioContext.prototype.createMediaElementSource}})(),evaluateAudioStrategy(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(this.isEnforceWasmMachine())return!1;const i=S.A.read(e,1,2),r=/iPad|iPhone|iPod/i.test(navigator.userAgent)||/Macintosh/i.test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2,a=navigator.userAgent.match(/Android/i),n=navigator.userAgent.match(/\(([^;]+); OpenHarmony ([\d.]+)\)/),s=this.isMTRAndroid()||this.isMTRWindows(),o=this.isTeslaMode();return s?8&i:o?2&i:a||n?4&i:r?1&i:!!(128&i||ce)&&this.isDefaultAudioBridgeMachine(e,i,t)},isEnforceWasmMachine(){var e;if("undefined"==typeof RTCPeerConnection)return!0;let t=this.getOSInfo();return!ne()&&((null==t||null===(e=t.browser)||void 0===e||null===(e=e.name)||void 0===e?void 0:e.toLowerCase().includes("firefox"))||this.browser.isFirefox)},isDefaultAudioBridgeMachine(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(1===i)return!0;if(0===i)return!1;if(S.A.read(e,_.n.WEBRTC_SMART_AUTO_STG_2.index,1,_.n.WEBRTC_SMART_AUTO_STG_2.default)&_.n.WEBRTC_SMART_AUTO_STG_2.candidates.AUDIO_ON_BROWSER_32BIT&&b)return!0;let r=this.getOSInfo();return r&&r.os&&r.browser?0!==r.osType?32&t:this.isSupportSharedArrayBuffer()?"Windows"!==r.os&&"Mac OS"!==r.os&&"Chromium OS"!==r.os?32&t:("Chrome"===r.browser.name||"Safari"===r.browser.name||"Edge"===r.browser.name)&&navigator.hardwareConcurrency>4?64&t:32&t:32&t:(this.isLowPerformanceDevice()||!this.isSupportSharedArrayBuffer())&&32&t},requestScreenWakeLock:()=>m.requestWakeLock(),releaseScreenWakeLock:()=>m.release(),isSupportPeerConnection:()=>"function"==typeof RTCPeerConnection,async initAsyncJob(){b=!!await this.is32bitChrome()},isSupportVideoProcessor(e){const t=!!(S.A.read(e,_.n.ENABLE_MEDIA_PROCESSOR.index,1,_.n.ENABLE_MEDIA_PROCESSOR.default)&_.n.ENABLE_MEDIA_PROCESSOR.candidates.VIDEO_PROCESSOR);return this.isSupportOffscreenCanvas()&&this.isSupportVideoFrame()&&t},isVideoProcessorEnabled:e=>!!(e&_.n.ENABLE_MEDIA_PROCESSOR.candidates.VIDEO_PROCESSOR),isMediaProcessorEnabled:e=>e>0,isSupportAudioHID:()=>!(!window.navigator.hid||!window.navigator.hid.requestDevice||ae()||navigator.userAgent.match(/Edg\/([\d.]+)/)),isLowPerformanceDevice:()=>navigator.hardwareConcurrency<=4,isMobileForceAutoChooseAudioDeviceEnable(){let e={},t=_.n.MOBILE_FORCE_AUTO_CHOOSE_AUDIO_DEVICE;return void 0!==u.A.mobileForceAutoChooseAudioDevice?(e.android=u.A.mobileForceAutoChooseAudioDevice&t.candidates.ANDROID,e.ios=u.A.mobileForceAutoChooseAudioDevice&t.candidates.IOS):(e.android=t.default&t.candidates.ANDROID,e.ios=t.default&t.candidates.IOS),!(!this.isIphoneBrowser()||!e.ios)||!(!this.isAndroidBrowser()||!e.android)}},K=j;function q(){let e=this;this.promise=new Promise((function(t,i){e.reject=i,e.resolve=t}))}class z{constructor(e,t){this.scriptURL=e,this.lateLoadedAssetsHash=t}getIntegrity(){let e=function(e){return e.split("/").pop().split("?")[0].split("#")[0]}(this.scriptURL);return this.lateLoadedAssetsHash[e]||null}}function X(e,t){if(e===t)return!0;if(r(e)&&r(t)){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var i in e)if(!X(e[i],t[i]))return!1;return!0}function r(e){return"object"==typeof e&&null!=e}}function Y(){return i.e(557).then(i.bind(i,8920))}function Q(){return i.e(208).then(i.bind(i,1822))}function J(e){const t=document.body,i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];function r(){e()}return i.forEach((e=>t.addEventListener(e,r,!1))),function(){i.forEach((e=>t.removeEventListener(e,r)))}}function Z(e){let t=null==e?void 0:e.getVideoTracks();return!(null==t||!t.length||t[0].muted)}function $(e){try{var t;let[i]=(null===(t=e.srcObject)||void 0===t?void 0:t.getVideoTracks())||[],r="VDom:".concat(e.ended,":").concat(e.paused,":").concat(e.readyState,",VTrack:").concat(null==i?void 0:i.muted,":").concat(null==i?void 0:i.readyState);l.A.add_monitor(r)}catch(e){c.Ay.error("RecordVideoState error",e)}}function ee(e,t){(e<0||t<0||e>3e3||t>3e3)&&c.Ay.directReport("CANVASSIZE:".concat(e,"x").concat(t))}function te(e){const t={dom:null,id:""};if(e)if("string"==typeof e)t.dom=document.getElementById(e),t.id=e;else if(function(e){if(!e)return!1;if(e.ownerDocument===window.document)return e instanceof HTMLElement;{var t;const i=null===(t=e.ownerDocument.defaultView)||void 0===t?void 0:t.HTMLElement;return!!i&&e instanceof i||e instanceof HTMLElement}}(e)){var i;t.dom=e,t.id=null==e||null===(i=e.getAttribute)||void 0===i?void 0:i.call(e,"id")}return t}function ie(){try{const e={safari:"15.0",firefox:"89",chrome:"91",edge:"91",opera:"77"},t={safari:"16.4",firefox:"105",chrome:"102",edge:"102",opera:"88"};let i=Object.assign({name:"",version:""},E().browser);if(-1==Object.keys(e).findIndex((e=>{if(i.name.toLowerCase().includes(e))return i.name=e,!0})))return console.error("!!!!! For a better experience, please use Chrome (version >= 102) or Safari (version >= 16.4) browser "),void c.Ay.error("unkown browser info");R(i.version,e[i.name])||(console.error("!!!! For a better experience,  \n       Chrome (version > ".concat(e.chrome," ,performance version > ").concat(t.chrome,") \n       Safari (version > ").concat(e.safari," , performance version > ").concat(t.safari,") \n       Firefox (version > ").concat(e.firefox," , performance version > ").concat(t.firefox,") \n       Edge (version > ").concat(e.edge," , performance version > ").concat(t.edge," ) \n       Opera (version > ").concat(e.opera," , performance version > ").concat(t.opera,") \n")),c.Ay.error("less than min version "))}catch(e){c.Ay.error("check browser version error",e)}}function re(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"|";return e?s()(t=e.toString()).call(t,/[,，]/g,i):""}function ae(){return/\bCrOS\b/.test(navigator.userAgent)}function ne(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||/iPad/i.test(navigator.userAgent)||/Macintosh/i.test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}function se(){try{const e=document.createElement("canvas");return!(!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}function oe(e){const t=self.ZoomTPModule;return new(t&&t.ZoomTPWebSocket?t.ZoomTPWebSocket:WebSocket)(e)}function de(){C=arguments.length>0&&void 0!==arguments[0]&&arguments[0]}let ce=!0;function ue(){try{let e=(new A.Y).getAudioSolutionInfo();ce=null==e?void 0:e.getProbResult()}catch(e){c.Ay.error("updateAudioProbResult error",e),ce=!0}}function he(){return j.isMacIntelSafari()||j.isMacIntelChrome()}function le(){try{return!("safari"!==(null==N?void 0:N.browser)||!D(15))||!("chrome"!==(null==N?void 0:N.browser)||!I(131))}catch(e){return!1}}function pe(){return j.isSupportMultiViewAPI()||u.A.enableMultiDecodeVideoWithoutSAB?26:1}ue()},4497:(e,t,i)=>{var r=i(2696).A;e.exports=r},9109:(e,t,i)=>{"use strict";i.d(t,{A:()=>m});var r=i(456),a=i(5408),n=i(5932),s=i(8353);const o=(0,s.A)("sdk.init");class d{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.name=e,this.handler=null,this.wasm=null,this.socket=null,this.defered=new n.cY,this.initSuccessPromise=this.defered.promise,this.wasmDefered=new n.cY,this.wasmSuccessPromise=this.wasmDefered.promise,this.handlerDefered=new n.cY,this.handlerSuccessPromise=this.handlerDefered.promise,this.socketDefered=new n.cY,this.socketSuccessPromise=this.socketDefered.promise,Promise.all([this.wasmSuccessPromise,this.handlerSuccessPromise,this.socketSuccessPromise]).then((e=>{let t=e.every((e=>!0===e));this.defered.resolve(t),t||o.error(this.name,{handler:this.handler,wasm:this.wasm,socket:this.socket})}))}setHanderSuccess(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.handler=e,this.handlerDefered.resolve(e)}setWasmSuccess(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.wasm=e,this.wasmDefered.resolve(e)}setSocketSuccess(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.socket=e,this.socketDefered.resolve(e)}checkInitSuccess(){return this.handler&&this.wasm&&this.socket}isSocketInitSuccess(){return this.socket}waitforInitSuccess(){return this.initSuccessPromise}resetHandleDeferred(){this.setHanderSuccess(!0),this.handlerDefered=new n.cY,this.handlerSuccessPromise=this.handlerDefered.promise}}class c extends d{constructor(e){super(e)}}class u extends d{constructor(e){super(e)}}class h extends d{constructor(e){super(e)}}var l=i(6991),p=i(7080);const f=(0,s.A)("sdk.variables");function g(){this.crashCount=0,this.crashLastTime=0,this.AEW=null,this.ADW=null,this.AEWF=null,this.ADWF=null,this.VE=null,this.VD=null,this.SE=null,this.SD=null,this.VEMTimes=0,this.VDMTimes=0,this.SEMTimes=0,this.SDMTimes=0,this.extVBPort=null,this.frameSent=0,this.frameReceived=0,this.peerConnectionCannotConnectTimes=0,this.browserFeaturedefer=new n.cY,this.browserFeature=null}g.prototype.initDB=function(){let e,t={},i=this;t.init=function(r){if(this.db_name=r.db_name,this.db_version=r.db_version,this.db_store_name=r.db_store_name,indexedDB){try{e=indexedDB.open(this.db_name,this.db_version)}catch(e){return a.Ay.error("Error opening IndexedDB",e),void(i.indexDbObject=null)}e.onerror=function(e){i.indexDbObject=null},e.onupgradeneeded=function(e){this.db=e.target.result,this.db.createObjectStore(t.db_store_name)},e.onsuccess=function(e){t.db=e.target.result,i.openIndexFlag=!0,i.indexDbObject.select("delay")}}else i.indexDbObject=null},t.put=function(e,i){try{var r=t.db.transaction(t.db_store_name,"readwrite").objectStore(t.db_store_name).put(e,i);r.onsuccess=function(){},r.onerror=function(e){a.Ay.error("Set Delay failed!",e)}}catch(e){a.Ay.error("IndexDb put Failed!",e)}},t.delete=function(i){e=t.db.transaction(t.db_store_name,"readwrite").objectStore(t.db_store_name).delete(i),e.onsuccess=function(){f("Delete the key:"+i)}},t.select=function(e){try{var r=t.db.transaction(t.db_store_name,"readwrite").objectStore(t.db_store_name);if(e)var n=r.get(e);else n=r.getAll();n.onsuccess=function(){i.audioDelay=n.result},n.onerror=function(){i.audioDelay=0}}catch(e){a.Ay.error("IndexDb Select Failed",e)}},t.clear=function(){t.db.transaction(t.db_store_name,"readwrite").objectStore(t.db_store_name).clear().onsuccess=function(){f("Clear the IndexDb Successfully")}},t.close=function(){t.db&&t.db.close()},this.indexDbObject=t,this.indexDbObject.init({db_name:"AEC",db_version:1,db_store_name:"delay"})},g.prototype.Notify_APPUI_SAFE=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];if("number"==typeof e||"string"==typeof e)i=arguments;else if(e!==this.instance)return;this._Notify_APPUI&&(f("Notify_APPUI_SAFE",i),this._Notify_APPUI.apply(this,i),this._callbackList.forEach((e=>e.apply(this,i))))},g.prototype.Notify_APPUI=g.prototype.Notify_APPUI_SAFE,g.prototype.queueMessageToRwg=function(e,t){this.rwgMessageList.push({jsEvent:e,message:t})},g.prototype.clearMessageToRwg=function(){p.A.startSend(),this.rwgConnectSuccess=!0,this.rwgMessageList.length>0&&(this.rwgAgent||this._Notify_APPUI)&&(this.rwgMessageList.forEach((e=>{let{jsEvent:t,message:i}=e;this.sendMessageToRwg(t,i,!1,!1)})),this.rwgMessageList=[])},g.prototype.destroyQueueMessageToRwg=function(){this.rwgConnectSuccess=!1,this.rwgMessageList=[]},g.prototype.sendMessageToRwg=function(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(this.rwgConnectSuccess&&(this.rwgAgent||this._Notify_APPUI)||!i){this.rwgConnectSuccess&&r&&this.clearMessageToRwg();try{this.rwgAgent?this.rwgAgent.sendMessageToRwg(t):this.Notify_APPUI_SAFE(e,t)}catch(e){a.Ay.error("Error sending message to RWG",e)}}else this.queueMessageToRwg(e,t)},g.prototype.reinit=function(e){this.instance=e,this.SPECIAL_ID=0,this._callbackList=[],this._Notify_APPUI=null,this.localAudioDecMGR=null,this.localVideoDecMGR=null,this.localAudioEncMGR=null,this.localVideoEncMGR=null,this.localSharingDecMGR=null,this.localMouseDecMGR=null,this.localSharingEncMGR=null,this.localAudioPara=null,this.localVideoPara={},this.localSharingPara=null,this.Audio_WebSocket_Ip_Address=null,this.Audio_Web_Transport_Ip_Address=null,this.Video_WebSocket_Ip_Address=null,this.Video_Web_Transport_Ip_Address=null,this.Sharing_WebSocket_Ip_Address=null,this.mediaSDKHandle=null,this.audio_pcm_queue=new r.A,this.int16Array=null,this.isInitialFailed=!1,this.isAudioEncodeWASMOK=!1,this.isAudioDecodeWASMOK=!1,this.isVideoEncodeWASMOK=!1,this.isVideoDecodeWASMOK=!1,this.isSharingDecodeWASMOK=!1,this.isSharingEncodeWASMOK=!1,this.audioEncWorkerPath="",this.audioDecWorkerPath="",this.videoDecWorkerPath="",this.videoEncWorkerPath="",this.sharingDecWorkerPath="",this.sharingEncWorkerPath="",this.audioEncodeSession=null,this.audioDecodeSession=null,this.videoDecodeSession=null,this.videoEncodeSession=null,this.sharingDecodeSession=null,this.sharingEncodeSession=null,this.isAudioEncodeThreadStart=!1,this.isAudioDecodeThreadStart=!1,this.isVideoDecodeThreadStart=!1,this.isSharingDecodeThreadStart=!1,this.isVideoEncodeThreadStart=!1,this.isSharingEncodeThreadStart=!1,this.isAudioPlayWork=!1,this.isVideoPlayWork=!1,this.isSharingPlayWork=!1,this.shareBufferSampleNumb=30,this.audioWasmInfo=null,this.initialSuccessNumb=0,this.TotalWaitEvent=0,this.audioPostInterval=null,this.sharedBuffer=null,this.decoderinworklet=null,this.decoderinworkletOP=null,this.chromeWideAEC=null,this.shareSystemAudio=!1,this.indexDbObject=null,this.audioDelay=0,this.openIndexFlag=!1,this.audioBufferSize=n.Ay.browser.isFirefox?30:15,this.monitorIntervalHandle=null,this.e2eencrypt=!1,this.AudioNode=null,this.SharingAudioNode=null,this.CurrentSSRC=0,this.CurrentSSRCTime=0,this.audioPlayTime=0,this.videoDecResponseText=null,this.videoEncResponseText=null,this.sharingDecodeResponse=null,this.sharingEncodeResponse=null,this.sharingDecInitInstance=new c(l._c.SHARING_DECODE),this.sharingEncInitInstance=new c(l._c.SHARING_ENCODE),this.videoDecInitInstance=new u(l._c.VIDEO_DECODE),this.videoInitInstance=new u(l._c.VIDEO_ENCODE),this.audioDecInitInstance=new h(l._c.AUDIO_DECODE),this.audioEncodeInitInstance=new h(l._c.AUDIO_ENCODE),this.audioDecodeResponse=null,this.audioEncodeResponse=null,this.ivObj={},this.userNodeList=[],this.rwgAgent=null,this.ComputerAudioStatus=l.BX.ComputerAudio_Null,this.DesktopAudioStatus=l.BX.DesktopAudio_Null,this.initDB(),this.resourceManager=null,this.vbarraybuffer=null,this.vbbin=null,this.vbjson=null,this.tfjsurl=null,this.afnbin=null,this.afnjson=null,this.basebin=null,this.basejson=null,this.workletMessageQueue=new r.A,this.workletWasmInitSuccess=!1,this.videoEncodeInitSuccess=null,this.vbPreloadSuccess=null,this.enableAduioBridge=!1,this.audioMode=-1,this.enableEchoDetection=0,this.enableHADecOpt=0,this.enableSafariHWCodec=0,this.enable360pHWDec=0,this.enable360pHWEnc=0,this.enableAndroidHWCodec=0,this.disableHWCodec=0,this.enableOptCopyFrame=0,this.enableTransferDataChannel=0,this.enableCanvasAlphaChannel=!0,this.enableWebrtcTurnServer=!1,this.VEMTimes=0,this.VDMTimes=0,this.SEMTimes=0,this.SDMTimes=0,this.isPreviewMode={audioEncode:!1,audioDecode:!1,videoEncode:!1,videoDecode:!1},this.rwgConnectSuccess=!1,this.rwgMessageList=[],this.localSsrc=0,this.frameSent=0,this.frameReceived=0};const m=new g},3578:(e,t,i)=>{"use strict";i.d(t,{A:()=>r});const r=class{_drawWatermarkWithShadow(e){let{ctx:t,textPos:i,opacity:r,name:a}=e;t.fillStyle="rgba(0, 0, 0, ".concat(r,")"),t.fillText(a,i.x,i.y),t.fillStyle="rgba(255, 255, 255, ".concat(r,")"),t.fillText(a,i.x+1,i.y+1)}_getTransformInfo(e){let t,{canvas:i,position:r}=e;if(1===r)t={x:i.width/2,y:0,rateRadio:0,maxWidth:i.width};else if(2===r)t={x:i.width/2,y:i.height,rateRadio:0,maxWidth:i.width};else if(4===r)t={x:0,y:i.height/2,rateRadio:Math.PI/2,maxWidth:i.height};else if(8===r)t={x:i.width,y:i.height/2,rateRadio:-Math.PI/2,maxWidth:i.height};else{const e=-21*Math.PI/180;t={x:i.width/2,y:i.height/2,rateRadio:e,maxWidth:Math.min(i.width/Math.cos(e),-i.height/Math.sin(e))}}return t.maxWidth>100&&(t.maxWidth-=50),t}_calcTextPos(e){let{position:t,ctx:i,name:r,textWidth:a}=e;const n=this._getPaddingWidth({ctx:i,position:t,name:r});return 1===t?{x:-a.width/2,y:n}:2===t||4===t||8===t?{x:-a.width/2,y:-n}:{x:-a.width/2,y:i.measureText(r[0]).width/2}}_getPaddingWidth(e){let{ctx:t,position:i,name:r}=e;return[1,2,4,8].includes(i)?32:t.measureText(r[0]).width}_setBaseLine(e){let{ctx:t,position:i}=e;t.textBaseline=1===i?"top":2===i||4===i||8===i?"bottom":"middle"}Get_WaterMarkRGBA(e){let{canvas:t,name:i,width:r,height:a,opacity:n=.15,position:s,convertToDataUrl:o}=e;if(!i||!r||!a)return;n=n||.15,r*=1,a*=1,t.width=r,t.height=a;let d=this._getTransformInfo({canvas:t,position:s});var c=t.getContext("2d");let u;if(c.clearRect(0,0,t.width,t.height),c.translate(d.x,d.y),c.rotate(d.rateRadio),this._setBaseLine({ctx:c,position:s}),c.lineWidth=1,c.imageSmoothingEnabled=!0,1==i.length){const e=d.maxWidth/i.length;c.font=e+"px  'Segoe UI'",u=c.measureText(i)}else{let e=16;for(c.font=e+"px  'Segoe UI'",u=c.measureText(i);u.width<d.maxWidth-2*this._getPaddingWidth({ctx:c,position:s,name:i});)e+=1,c.font=e+"px  'Segoe UI'",u=c.measureText(i);if(u.width>d.maxWidth-2*this._getPaddingWidth({ctx:c,position:s,name:i}))if(e>16)e-=1,c.font=e+"px  'Segoe UI'",u=c.measureText(i);else{const e=i;for(;i.length>5&&u.width>d.maxWidth-2*this._getPaddingWidth({ctx:c,position:s,name:i+"..."});)i=i.slice(0,i.length-1),u=c.measureText(i+"...");e!==i&&(i+="...")}}const h=this._calcTextPos({position:s,ctx:c,name:i,textWidth:u});var l;if(this._drawWatermarkWithShadow({ctx:c,name:i,opacity:n,textPos:h}),o)l=t.toDataURL();else{var p=c.getImageData(0,0,c.canvas.width,c.canvas.height);l=new Uint8Array(p.data.buffer)}return c.rotate(-d.rateRadio),c.translate(-d.x,-d.y),l}Get_Repeated_WaterMarkRGBA(e){let{canvas:t,name:i,width:r,height:a,opacity:n=.15,position:s,convertToDataUrl:o}=e;if(!i||!r||!a)return;n=n||.15,r*=1,a*=1,t.width=r,t.height=a;const d=t.getContext("2d");d.clearRect(0,0,t.width,t.height),d.translate(r/2,a/2),d.rotate(-21*Math.PI/180),d.imageSmoothingEnabled=!0,d.font="".concat(32,"px 'Segoe UI'"),d.textBaseline="top";const c=d.measureText(i),u=.37*c.width;let h,l=0,p=-a;do{let e=l%2==0?u-r:-r;do{d.fillStyle="rgba(0, 0, 0, ".concat(n,")"),d.fillText(i,e,p),d.fillStyle="rgba(255, 255, 255, ".concat(n,")"),d.fillText(i,e+1,p+1),e+=c.width+u}while(e<r);p+=32+u,l++}while(p<a);if(o)h=t.toDataURL();else{const e=d.getImageData(0,0,d.canvas.width,d.canvas.height);h=new Uint8Array(e.data.buffer)}return d.rotate(21*Math.PI/180),d.translate(-r/2,-a/2),h}}},7080:(e,t,i)=>{"use strict";i.d(t,{A:()=>d});var r=i(1461),a=i(9109),n=i(5408);const s={AEWF:"Audio encode WASM failed to download/compile",ADWF:"Audio decode WASM failed to download/compile",VDWF:"Video decode WASM failed to download/compile",VEWF:"Video encode WASM failed to download/compile",SEWF:"Sharing encode WASM failed to download/compile",SDWF:"Sharing decode WASM failed to download/compile",MWCGLF:"WebGL context failed to be restored",VCFF:"Captured video format is not supported",SHHF:"Initialization of sharing decode WASM failed",SDSF:"Sharing decode WebSocket failed to connect after 10 attempts",SEHF:"Initialization of sharing encode WASM failed",SESF:"Sharing encode WebSocket failed to connect after 10 attempts",ADHF:"Initialization of audio decode WASM failed",ADSF:"Audio decode WebSocket failed to connect after 10 attempts",AEHF:"Initialization of audio encode WASM failed",AESF:"Audio encode WebSocket failed to connect after 10 attempts",VDHF:"Initialization of video decode WASM failed",VDSF:"Video decode WebSocket failed to connect after 10 attempts",VEHF:"Initialization of video encode WASM failed",VESF:"Video encode WebSocket failed to connect after 10 attempts",INITVDCERR:"An error occurred when initializing video WebRTC DataChannel",INITADCERR:"An error occurred when initializing audio WebRTC DataChannel"},o=["VCAPTURE","VFCLOSE","VDCS","CPC","VDCR","ADCS","ADCR","VCFOK","VCTN","ABRTT"],d=function(){function e(){this.base_time=null,this.monitor="",this.last_get_monitor_time=0,this.checkIsNecessaryLogMap=new Map,this.highfrequencyerror=new Map,this.startSendLog=!1}return e.prototype={init:function(){this.base_time||(this.base_time=(new Date).getTime(),this.checkIsNecessaryLogMap=new Map,this.add_monitor("STARTMONITOR"+this.base_time))},need_to_flush_log:function(e){return e&&("F"==e[e.length-1]||"f"==e[e.length-1])&&this.startSendLog},append_to_monitor:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e)try{const i=2e3;this.monitor&&this.monitor.length+e.length>i&&this.send_instant_monitor(),this.monitor?this.monitor+=e:this.monitor=e,t&&this.send_instant_monitor()}catch(e){n.Ay.error("Error when adding data to the monitor log",e)}},add_monitor:function(e,t){if(this.base_time||this.init(),e&&this.checkLogValidity(e))try{if(s[e]){let i=s[e];t&&(i="".concat(i,". Additional information: ").concat(t)),n.Ay.error(i)}let i=(new Date).getTime()-this.base_time,r=e+"("+Math.ceil(i)+")",a=this.need_to_flush_log(e);this.append_to_monitor(r,a)}catch(e){n.Ay.error("Error when adding data to the monitor log",e)}},get_monitor:function(){let e=this.monitor,t=(new Date).getTime();return null!=e&&(e.length>80||t-this.last_get_monitor_time>180)?(this.last_get_monitor_time=t,this.monitor=null,"WCL_M, "+e):""},get_instant_monitor:function(){let e=this.monitor;return this.monitor=null,e?"WCL_M, "+e:null},send_instant_monitor:function(){let e=this.get_instant_monitor();e&&a.A.sendMessageToRwg(r.yGo,{evt:r.UFw,seq:1,body:{data:e}})},send_monitor_directly:function(e){e&&this.checkLogValidity(e)&&a.A.sendMessageToRwg(r.yGo,{evt:r.UFw,seq:1,body:{data:e}})},add_monitor2(e){if(this.base_time||this.init(),e&&this.checkLogValidity(e)){let t=e+"("+((new Date).getTime()-this.base_time)+")";this.append_to_monitor(t)}},add_monitor3(e){this.base_time||this.init(),e&&this.checkLogValidity(e)&&(this.highfrequencyerror[e]?this.highfrequencyerror[e]+=1:this.highfrequencyerror[e]=1,(0,n.ZN)(this.highfrequencyerror[e])&&this.add_monitor(e,"Occurred ".concat(this.highfrequencyerror[e]," times")))},checkIsNecessaryExceptionLogAndReturnRepeatTimes(e){let t=!0,i=0;try{return this.checkIsNecessaryLogMap.get(e)&&this.checkIsNecessaryLogMap.get(e)%100!=0&&(t=!1),i=this.checkIsNecessaryLogMap.get(e),{isNecessary:t,repeatNumber:void 0===i?0:i}}catch(e){return{isNecessary:!0,repeatNumber:0}}finally{let t=this.checkIsNecessaryLogMap.get(e)||0;if(this.checkIsNecessaryLogMap.set(e,t+1),this.checkIsNecessaryLogMap.size>200){let e=Array.from(this.checkIsNecessaryLogMap.keys()).slice(0,20);console.log("delete log cache keys",e),e.forEach((e=>this.checkIsNecessaryLogMap.delete(e)))}}},reset(){this.base_time=null,this.last_get_monitor_time=0,this.monitor="",this.highfrequencyerror.clear()},startSend(){this.startSendLog=!0},checkLogValidity(e){return!!this.startSendLog||!o.some((t=>-1!==e.indexOf(t)))}},new e}()},2696:(e,t,i)=>{"use strict";i.d(t,{A:()=>Fh});var r={};i.r(r),i.d(r,{Add_Audio_Decode_Thread:()=>si,Add_Video_Decode_Thread:()=>ni,AssertMediaSdkNotDestory:()=>Et,Clear_Decoded_Sharing_Frame:()=>ai,CloseMediaNetSessionToRwg:()=>wt,CreateThreadWorker:()=>mr,GetMediaSession:()=>Ar,GetWorkerTypeThread:()=>vr,Get_SSRC_Latest_Time:()=>oi,Get_Video_SSRC_Latest_Time:()=>di,JsAudioEngine_UnInit:()=>Zt,JsSharingEngine_UnInit:()=>ei,JsVideoEngine_UnInit:()=>$t,MEDIA_INIT_SUCCESS_CALLBACK_METADATA:()=>lr,Meeting_Fail_Over:()=>ci,MirrorSendVideo:()=>ur,Modify_Audio_SampleRate:()=>ui,Notify_Audio_Decode_Thread:()=>Mi,Notify_Audio_Encode_Thread:()=>Ii,Notify_Audio_Thread_AEC_Status:()=>li,Notify_Audio_Thread_CC_Set_Lang:()=>Pi,Notify_Audio_Thread_CurrentSSRC:()=>Ti,Notify_Audio_Thread_Interpretation_Enable:()=>Di,Notify_Audio_Thread_Interpretation_Mute:()=>Oi,Notify_Audio_Thread_Interpretation_Set_Interpreter:()=>xi,Notify_Audio_Thread_Interpretation_Set_Lang:()=>ki,Notify_Audio_Thread_Msg_Channel:()=>pi,Notify_Audio_Thread_Msg_Channel2:()=>mi,Notify_Audio_Thread_Msg_Channel3:()=>vi,Notify_Audio_Thread_Status:()=>hi,Notify_Audio_Video_Thread_Msg_Channel:()=>Ai,Notify_Sharing_Decode_Thread:()=>Ri,Notify_Sharing_Encode_Thread:()=>qi,Notify_Sharing_Encode_Thread_Transferable_Data:()=>wi,Notify_Sharing_Video_Decode_Thread:()=>Ei,Notify_Sharing_Video_Encode_Thread:()=>Ki,Notify_Sharing_Video_Encode_Thread_Transferable_Data:()=>bi,Notify_Video_Decode_Thread:()=>Ci,Notify_Video_Encode_Thread:()=>Si,Notify_Video_Encode_Thread_Transferable_Data:()=>_i,Notify_Video_Sharing_Msg_Channel:()=>gi,Notify_Video_Thread_Msg_Channel:()=>fi,Put_Video_Frame_Buffer:()=>ri,Reset_Aec:()=>Vi,Send_Render_Monitor_Log:()=>Bi,Set_Audio_WebSocket_Ip_Address:()=>Xt,Set_Audio_Web_Transport_Ip_Address:()=>Yt,Set_Video_WebSocket_Ip_Address:()=>Qt,Set_Video_Web_Transport_Ip_Address:()=>Jt,Sharing_Decode_Post_message:()=>kt,Sharing_Encode_Frame:()=>ii,Sharing_Encode_Post_message:()=>Ot,Start_Monitor:()=>Wi,Stop_Monitor:()=>Ui,TransferCmdMsgToWorker:()=>gr,TransoferDataToVideoEncodeThread:()=>yi,UpdateAudioPlayStatus:()=>vt,UpdateSharingPlayStatus:()=>St,UpdateVideoPlayStatus:()=>At,Update_Audio_Encrpt:()=>zi,Update_Sharing_Encode_Status:()=>ji,Update_Sharing_Encrpt:()=>Gi,Update_Sharing_Video_Encode_Status:()=>Hi,Update_Video_Encrpt:()=>Fi,Video_Encode_Frame:()=>ti,addAudioMonitorLog:()=>Ft,clearWorkerListener:()=>Qi,closeAllMedia:()=>Ji,closeAllPromiseObject:()=>Yi,destroyAllWorkers:()=>Zi,disableSocketReconnect:()=>Xi,initAudioDecode:()=>Mt,initAudioEncode:()=>It,initAudioSharedBuffer:()=>jt,initResourceManager:()=>rr,initSharingDecode:()=>Dt,initSharingEncode:()=>Pt,initVideoDecode:()=>Tt,initVideoEncode:()=>Ct,isSharingNotClearChromeVersion:()=>hr,isVideoEncodeHandleReady:()=>tr,prepareVBfile:()=>sr,preserveMessageController:()=>_t,previewController:()=>yt,pushMessageToWorker:()=>er,saveBrowserInfo:()=>Li,setAudioEngineInitProperties:()=>qt,setCachedUserNodeListToWorker:()=>gt,setMediaSessionHold:()=>pr,setSharingEngineInitProperties:()=>Kt,setUserNodeListToWorker:()=>mt,setVideoEngineInitProperties:()=>zt,transportBgImageBitMap:()=>or,transportMaskImageBitMap:()=>cr,transportSettingCanvas:()=>ir,transportVBBgImageBitMap:()=>dr});var a=i(913),n=i(3901);function s(e,t){if(null==e)return{};var i,r,s=function(e,t){if(null==e)return{};var i={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(n(t).call(t,r))continue;i[r]=e[r]}return i}(e,t);if(a){var o=a(e);for(r=0;r<o.length;r++)i=o[r],n(t).call(t,i)||{}.propertyIsEnumerable.call(e,i)&&(s[i]=e[i])}return s}var o=i(7857),d=i(6984),c=i.n(d),u=i(1461);const h=-1,l=0,p=3,f=0,g=1,m=3,v=5,A=7,S=8,_=16,y="WCL_M,isWebEnabled:1, isLocalEnabled:1, isSmartBkgnd:1, bkgType:2",C=0,b=1,w="{[WLCCONT]}",E={[f]:new Map([["useinbandfec",{value:1,operater:"add"}],["maxaveragebitrate",{value:48e3,operater:"add"}],["maxplaybackrate",{value:24e3,operater:"add"}],["sprop-maxcapturerate",{value:24e3,operater:"add"}],["sprop-stereo",{value:1,operater:"sub"}],["stereo",{value:1,operater:"sub"}]]),[g]:new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:96e3,operater:"add"}],["maxplaybackrate",{value:48e3,operater:"add"}],["sprop-maxcapturerate",{value:48e3,operater:"add"}],["sprop-stereo",{value:1,operater:"add"}],["stereo",{value:1,operater:"add"}]]),[m]:new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:96e3,operater:"add"}],["maxplaybackrate",{value:48e3,operater:"add"}],["sprop-maxcapturerate",{value:48e3,operater:"add"}],["sprop-stereo",{value:1,operater:"add"}],["stereo",{value:1,operater:"add"}]]),[v]:new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:128e3,operater:"add"}],["maxplaybackrate",{value:48e3,operater:"add"}],["sprop-maxcapturerate",{value:48e3,operater:"add"}],["sprop-stereo",{value:1,operater:"add"}],["stereo",{value:1,operater:"add"}]]),[A]:new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:128e3,operater:"add"}],["maxplaybackrate",{value:48e3,operater:"add"}],["sprop-maxcapturerate",{value:48e3,operater:"add"}],["sprop-stereo",{value:1,operater:"add"}],["stereo",{value:1,operater:"add"}]]),[S]:new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:"96000",operater:"add"}],["maxplaybackrate",{value:"48000",operater:"add"}],["sprop-maxcapturerate",{value:"48000",operater:"add"}]]),[_]:new Map([["useinbandfec",{value:1,operater:"add"}],["maxaveragebitrate",{value:64e3,operater:"add"}],["maxplaybackrate",{value:24e3,operater:"add"}],["sprop-maxcapturerate",{value:24e3,operater:"add"}],["sprop-stereo",{value:1,operater:"sub"}],["stereo",{value:1,operater:"sub"}]])},R="SHARE",T="NORMAL",I=!1;var M=i(9407),D=i(456);function P(){this.ssrcQueueMap=new Map,P.prototype.AddQueue=function(e){var t=new D.A;return this.ssrcQueueMap.set(e,t),t},P.prototype.DeleteQueue=function(e){this.ssrcQueueMap.delete(e)},P.prototype.GetQueue=function(e){return this.ssrcQueueMap.get(e)},P.prototype.GetQueueData=function(e){return this.ssrcQueueMap.get(e).dequeue()},P.prototype.PutQueueData=function(e,t){this.ssrcQueueMap.get(e).enqueue(t)},P.prototype.GetQueueLength=function(e){var t=this.ssrcQueueMap.get(e);return null!==t?t.getLength():0}}var k=function(){this.frames=0,this.ntp=new D.A};k.prototype={UpdateVideoInfo:function(e){this.frames++,this.ntp.getLength()>30&&this.ntp.dequeue(),this.ntp.enqueue(e)},GetVideoFpsInfo:function(){var e=this.ntp.getLength();if(!(e<5)){for(var t=0,i=0,r=0,a=0,n=0;n<e;n++){var s=this.ntp.dequeue();0==s&&0==r?i++:0!=s?(a=0,0==r&&(r=s),t=s):0!=r&&t!=r&&0==s&&a++}return 0==t||t==r?0:e-i-a-1!=0?(t-r)/(e-i-a-1):0}}};var O=function(){this.ssrcInfoMap=new Map};function x(){this.ssrcQueueMap=new Map,this.ssrcInfo=new O,x.prototype.AddQueue=function(e){var t=new D.A;return this.ssrcQueueMap.set(e,t),t},x.prototype.DeleteQueue=function(e){this.ssrcQueueMap.delete(e)},x.prototype.GetQueue=function(e){return this.ssrcQueueMap.get(e)},x.prototype.ClearQueue=function(){this.ssrcQueueMap.clear()},x.prototype.GetQueueData=function(e){return this.ssrcQueueMap.get(e).dequeue()},x.prototype.PutQueueData=function(e,t){this.ssrcQueueMap.get(e).enqueue(t)},x.prototype.GetQueueLength=function(e){var t=this.ssrcQueueMap.get(e);return t?t.getLength():0},x.prototype.UpdateInfo=function(e,t){this.ssrcInfo.UpdateSSRCInfo(e,t)},x.prototype.GetFpsInfo=function(e){return this.ssrcInfo.GetSSRCFpsInfo(e)}}O.prototype={UpdateSSRCInfo:function(e,t){var i=this.ssrcInfoMap.get(e);i||(i=new k,this.ssrcInfoMap.set(e,i)),i.UpdateVideoInfo(t)},GetSSRCFpsInfo:function(e){var t=this.ssrcInfoMap.get(e);return t?t.GetVideoFpsInfo():0}};var V=function(){function e(e){let{sessionid:t}=e;this.map=new Map,this.AudioQueueMGR=new P,this.timemap=new Map,this.sessionid=t||0}return e.prototype.Add=function(e,t){this.map.set(e,t),this.AudioQueueMGR.AddQueue(e)},e.prototype.Clear=function(){this.map.clear()},e.prototype.Keys=function(){return this.map.keys()},e.prototype.UpdateSSRCTimeMap=function(e){this.timemap=e},e.prototype.GetSSRCTimeMap=function(e){return this.timemap?this.timemap.get(e):null},e}();function N(e){let{sessionid:t}=e;this.sessionid=t||0,this.map=new Map,this.VideoQueueMGR=new x}N.prototype.Add=function(e,t){this.map.set(e,t)},N.prototype.Clear=function(){this.map.clear()},N.prototype.Keys=function(){return this.map.keys()};var L=function(){this.frames=0,this.ntp=new D.A};L.prototype={UpdateSharingInfo:function(e){this.frames++,this.ntp.getLength()>30&&this.ntp.dequeue(),this.ntp.enqueue(e)},GetSharingFpsInfo:function(){var e=this.ntp.getLength();if(!(e<5)){for(var t=0,i=0,r=0,a=0,n=0;n<e;n++){var s=this.ntp.dequeue();0==s&&0==r?i++:0!=s?(a=0,0==r&&(r=s),t=s):0!=r&&t!=r&&0==s&&a++}return 0==t||t==r?0:e-i-a-1!=0?(t-r)/(e-i-a-1):0}}};var W=function(){this.ssrcInfoMap=new Map};function B(){this.ssrcQueueMap=new Map,this.ssrcInfo=new W,B.prototype.AddQueue=function(e){var t=new D.A;return this.ssrcQueueMap.set(e,t),t},B.prototype.DeleteQueue=function(e){this.ssrcQueueMap.delete(e)},B.prototype.GetQueue=function(e){return this.ssrcQueueMap.get(e)},B.prototype.ClearQueue=function(){this.ssrcQueueMap.clear()},B.prototype.GetQueueData=function(e){return this.ssrcQueueMap.get(e).dequeue()},B.prototype.PutQueueData=function(e,t){this.ssrcQueueMap.get(e).enqueue(t)},B.prototype.GetQueueLength=function(e){var t=this.ssrcQueueMap.get(e);return t?t.getLength():0},B.prototype.UpdateInfo=function(e,t){this.ssrcInfo.UpdateSSRCInfo(e,t)},B.prototype.GetFpsInfo=function(e){return this.ssrcInfo.GetSSRCFpsInfo(e)}}function U(e){let{sessionid:t}=e;this.map=new Map,this.sQueue=new D.A,this.SharingQueueMGR=new B,this.sessionid=t||0}W.prototype={UpdateSSRCInfo:function(e,t){var i=this.ssrcInfoMap.get(e);i||(i=new L,this.ssrcInfoMap.set(e,i)),i.UpdateSharingInfo(t)},GetSSRCFpsInfo:function(e){var t=this.ssrcInfoMap.get(e);return t?t.GetSharingFpsInfo():0}},U.prototype.Clear=function(){this.map.clear()},U.prototype.Keys=function(){return this.map.keys()},U.prototype.Add=function(e,t){this.map.set(e,t)},U.prototype.Get=function(e){return this.map.get(e)},U.prototype.PutData=function(e){e&&this.sQueue&&this.sQueue.enqueue(e)},U.prototype.GetData=function(){if(this.sQueue)return this.sQueue.dequeue()},U.prototype.ClearBuffer=function(){this.sQueue&&(this.sQueue=new D.A)};var F=i(5932),G=i(8353),H=i(5408),j=i(3224),K=i(2193);let q=j;i.n(K)()(j)&&(q=window.PubSub);let z=function(){};z.prototype={publish(){return q.publish.apply(this,arguments)},publishSync(){return q.publishSync.apply(this,arguments)},trigger(){return this.publish.apply(this,arguments)},triggerSync(){return this.publishSync.apply(this,arguments)},emit(){return this.publish.apply(this,arguments)},subscribe(){return q.subscribe.apply(this,arguments)},on(){return this.subscribe.apply(this,arguments)},unsubscribe(){return q.unsubscribe.apply(this,arguments)},clearAllSubscriptions(){q.clearAllSubscriptions()}};const X=new z;var Y=i(7080),Q=i(6991),J=i(9109),Z={_:!1};const $=class{static isEnableCanvasCtxOptionsOpt(){return Z._}static setIsEnableCanvasCtxOptionsOpt(e){Z._=e}},ee=1,te=2,ie=7,re=129,ae=130,ne=133,se=136;function oe(e){return e[0]<<24|e[1]<<16|e[2]<<8|e[3]}const de=function(e){return 21==e[4]&&0==e[13]},ce=function(e){return 104==e[0]||16!=e[4]&&1!=e[5]?oe(e.slice(19,23)):oe(e.slice(15,19))},ue=function(e){return 103==e[0]};class he{constructor(e){let t=e||{};this.last_report_time=0,this.timeout_count=0,this.interval_report_time=t.interval||3e3,this.tag=t.tag||"monitor",this.max_timeout=0,this.min_timeout=2147483647,this.reportcallback=t.reportcallback,this._timeoutid=0}_report(){this.reportcallback&&this.reportcallback(this.tag,Math.ceil(this.max_timeout),Math.ceil(this.min_timeout),this.timeout_count),this.timeout_count=0,this.max_timeout=0,this.min_timeout=2147483647}timeoutReport(e,t){if(this.timeout_count++,e>this.max_timeout&&(this.max_timeout=e),e<this.min_timeout&&(this.min_timeout=e),this._timeoutid)return;let i=this;this._timeoutid=setTimeout((()=>{i._report(),i._timeoutid=0}),this.interval_report_time)}}class le{static getStorageForCapacity(){return new SharedArrayBuffer(8+((arguments.length>0&&void 0!==arguments[0]?arguments[0]:80)+1)*(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500))}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.byteLength,s=arguments.length>6?arguments[6]:void 0;this.offset=a,this._BYTES_PER_ELEMENT=t,this.capacity=(n-8)/t,this.usableCapacity=this.capacity-1,this.buf=e,this.write_ptr=new Uint32Array(this.buf,a,1),this.read_ptr=new Uint32Array(this.buf,a+4,1),this.storageUint8sByteOffset=a+8,this.storageUint8s=new Uint8Array(this.buf,this.storageUint8sByteOffset,n-8),this.byteLength=n,this.label=i,this.usingOneElementBuffer=r,s&&(this.wasmMemory=s),r&&(this.oneElementBuffer=new ArrayBuffer(t)),this.repushhander=0,this.repushlogcount=0,this.monitorpace=0}checkBuffer(){this.wasmMemory&&this.wasmMemory.buffer!=this.buf&&(console.log("buffer change"),this.buf=this.wasmMemory.buffer,this.storageUint8s=new Uint8Array(this.buf,this.storageUint8sByteOffset,this.byteLength-8))}enqueue(e){return this.available_write()>0&&this.push(e),{rd:Atomics.load(this.read_ptr,0),wr:Atomics.load(this.write_ptr,0)}}enqueueSafe(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;for(this.dataBuffer||(this.dataBuffer=new D.A);this.dataBuffer.getLength()>0&&this.available_write()>0;){let e=this.dataBuffer.dequeue();e&&this.push(e)}let r=this.dataBuffer.getLength();if(e){if(this.available_write()>0&&0==r)return this.push(e),!0;if(!t)return!1;this.dataBuffer.enqueue(e),++r}if(r>0&&!this.repushhander&&(this.repushhander=setTimeout((()=>{this.repushlogcount%10==0&&console.warn("<<< retry consume cache data"),this.repushlogcount++,this.repushhander=0,this.enqueueSafe(null)}),30)),r>=1e3&&(H.Ay.warn("Cached data in SAB reached critical value, will be cleared"),this.dataBuffer.clear(),i&&i("vqslclear")),r>0&&i){let e=performance.now();(!this.monitorpace||e-this.monitorpace>2e4)&&(this.monitorpace=e,i&&i("vqsl"+r))}return!0}push(e){return e instanceof Array?this._pushArray(e):this._push(e)}_pushArray(e){var t=Atomics.load(this.write_ptr,0);this.checkBuffer();let i=0;e.forEach((e=>{this.storageUint8s.set(e,t*this._BYTES_PER_ELEMENT+8+4+i),i+=e.byteLength})),new Uint32Array(this.buf,this.offset+t*this._BYTES_PER_ELEMENT+8,1)[0]=i;let r=(t+1)%this.capacity;return Atomics.store(this.write_ptr,0,r),!0}_push(e){var t=Atomics.load(this.write_ptr,0);this.checkBuffer(),this.storageUint8s.set(e,t*this._BYTES_PER_ELEMENT+8+4,e.byteLength),new Uint32Array(this.buf,this.offset+t*this._BYTES_PER_ELEMENT+8,1)[0]=e.byteLength;let i=(t+1)%this.capacity;return Atomics.store(this.write_ptr,0,i),!0}addReadPtr(){var e=Atomics.load(this.read_ptr,0);Atomics.store(this.read_ptr,0,(e+1)%this.capacity)}dequeue(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var t=Atomics.load(this.read_ptr,0);this.checkBuffer();let i,r,a,n=new Uint32Array(this.buf,this.offset+t*this._BYTES_PER_ELEMENT+8,1);if(e){i=this.oneElementBuffer?new Uint8Array(this.oneElementBuffer,0,n[0]):new Uint8Array(n[0]);let e=new Uint8Array(this.storageUint8s.buffer,t*this._BYTES_PER_ELEMENT+8+4+this.storageUint8sByteOffset,i.byteLength);i.set(e,0)}else i=this.storageUint8s.subarray(t*this._BYTES_PER_ELEMENT+8+4,t*this._BYTES_PER_ELEMENT+8+4+n[0]),r=t*this._BYTES_PER_ELEMENT+8+4+this.storageUint8sByteOffset,a=t*this._BYTES_PER_ELEMENT+8+4+n[0]+this.storageUint8sByteOffset;return e&&Atomics.store(this.read_ptr,0,(t+1)%this.capacity),e?i:{bCopyData:e,uint8s:i,begin:r,end:a}}available_read(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_read(e,t)}available_write(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_write(e,t)}is_available_write(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._is_available_write(e,t)}_available_read(e,t){return(t+this.capacity-e)%this.capacity}_available_write(e,t){return this.usableCapacity-this._available_read(e,t)}_is_available_write(e,t){return this._available_write(e,t)>0}_storage_capacity(){return this.capacity}}class pe{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:80;if(!(e instanceof le))throw new Error("RingBuffer required");this.rb=e,this.dataCallback=t,this.interval=null,this.requestID=null,this.timeout_call=i,this.tick_lasted_time=0,this.timeoutMS=r,this.maxCount=a}setDataCallback(e){this.dataCallback=e}consume(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.interval||(this.bCopyData=t,this.interval=setInterval((()=>{let e=performance.now();if(this.timeout_call){if(0!=this.tick_lasted_time){let t=e-this.tick_lasted_time;t>=this.timeoutMS&&this.timeout_call(t,e)}this.tick_lasted_time=e}this._dequeue()}),e),console.log("consume interval ".concat(this.interval)))}consumeAll(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.bCopyData=e,this._dequeue()}_dequeue(){let e=Math.min(this.rb.available_read(),this.maxCount);for(this.consoume_count=0;this.consoume_count<e;){this.consoume_count++;let e=this.rb.dequeue(this.bCopyData);this.dataCallback(e),this.bCopyData||this.rb.addReadPtr()}}_consumeForAnimationFrame(){this._dequeue(),this.requestID=requestAnimationFrame(this._consumeForAnimationFrame.bind(this))}consumeUsingRequestAnimationFrame(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.requestID||(this.bCopyData=e,this._consumeForAnimationFrame())}cancelConsume(){console.log("cancelConsume interval ".concat(this.interval," requestID ").concat(this.requestID)),this.tick_lasted_time=0,clearInterval(this.interval),this.requestID&&cancelAnimationFrame(this.requestID),this.interval=null,this.requestID=null}}class fe{constructor(){this.timeStampKey="video_timestamp",this.keysList=["video_ssrc","video_width","video_height","rendering_x","rendering_y","rendering_w","rendering_h","rotation","yuv_limited"],this.bCopyData=null,this.begin=null,this.end=null}setOBJ(e){this.obj=e,this.yuvUint8s=e.data}setBuffer(e){!1===e.bCopyData?(this.objUint8s=e.uint8s,this.bCopyData=e.bCopyData,this.begin=e.begin,this.end=e.end):(this.objUint8s=e,this.bCopyData=!0,this.begin=0,this.end=e.byteLength)}buffer2Obj(){let e=new Uint32Array(this.objUint8s.buffer,this.begin,9),t=new DataView(this.objUint8s.buffer,this.begin+40,16),i={};this.keysList.forEach(((t,r)=>{i[t]=e[r]})),i[this.timeStampKey]=Number(t.getBigUint64(0,!0));let r,a=Number(t.getBigUint64(8,!0)),n=new Uint8Array(this.objUint8s.buffer,this.begin+40+8+8,a);return this.bCopyData,r=n,i.data=r,i}obj2buffer(){let e=new Uint8Array(56),t=this.keysList,i=new Uint32Array(e.buffer,0,9),r=new DataView(e.buffer,40,16);return t.forEach(((e,t)=>{i[t]=this.obj[e]})),r.setBigUint64(0,BigInt(this.obj[this.timeStampKey]),!0),r.setBigUint64(8,BigInt(this.yuvUint8s.byteLength),!0),[e,this.yuvUint8s]}}class ge{constructor(){this.onmessage=()=>{}}addEventListener(){}close(){}}class me{constructor(e){this.transportMap={},this.netthreadworker=null,this.type=e.type,this.mgr=e,this.transportlistsChnagelinster=[]}addEventListener(e){-1==this.transportlistsChnagelinster.indexOf(e)&&this.transportlistsChnagelinster.push(e)}removeEventListener(e){let t=this.transportlistsChnagelinster.indexOf(e);-1!=t&&this.transportlistsChnagelinster.splice(t,1)}addTransport(e,t){e.id in this.transportMap||(this.transportMap[e.id]=e,this.transportlistsChnagelinster.forEach((i=>{i(e,t,1)})))}removeTransport(e){var t;let i=e.id;i in this.transportMap&&(delete this.transportMap[i],null===(t=e.sock)||void 0===t||t.close(),this.transportlistsChnagelinster.forEach((t=>{t(e,e.channel,0)})))}getTransportByType(e){for(let t in this.transportMap){let i=this.transportMap[t],r=i.target_thread==me.SELF_THREAD;if(i.type==e&&r)return i}return null}}(0,o.A)(me,"NO_THREAD",0),(0,o.A)(me,"SELF_THREAD",1);var ve=i(7201),Ae=i.n(ve);function Se(e){let t=e||{};this._samples=[],this._interval_id=0,this._lasted_update_time=0,this._lasted_group_time=0,this._enable=!1,this._interval_time=t.interval||3e4,this._customer_callback=t.report_call,this._tag=t.tag||"netreport",this._group_interval=t.group_interval||1e3,this._enable_advanced=t.advanced||!1,this._current_count=0,this._qos_report=new he({tag:"jitter",interval:3e4,reportcallback:this._qos_report_timeout.bind(this)}),this._qos_report_samples=[],this._cureen_qos_report=0}Se.prototype._qos_report_timeout=function(e,t,i,r){if(this._customer_callback){let a="".concat(e,",").concat(t,",").concat(i,",").concat(r);this._customer_callback(this._tag+"TimeOut",a)}},Se.prototype._report=function(){let e=(new Date).getTime(),t="".concat(e,"-").concat(this._samples.length,"-").concat(this._samples),i="".concat(e,"-").concat(this._qos_report_samples.length,"-").concat(this._qos_report_samples);t=Ae()(t).call(t,",","|"),i=Ae()(i).call(i,",","|"),this._customer_callback?(this._customer_callback(this._tag,t),this._enable_advanced&&this._customer_callback(this._tag+"QOS",i)):console.error("tag:".concat(this._tag,",").concat(t))},Se.prototype._group=function(){let e=performance.now();if(e>=this._lasted_group_time+1700){let t=Math.round((e-this._lasted_group_time)/1e3)-1;for(let e=0;e<t;e++)this._samples.push(-1)}this._lasted_group_time=e,this._samples.push(this._current_count),this._qos_report_samples.push(this._cureen_qos_report),this._cureen_qos_report=0,this._current_count=0,e>=this._lasted_update_time+this._interval_time&&(this._lasted_update_time=e,this._report(),this._samples=[],this._qos_report_samples=[])},Se.prototype.start=function(){this._enable||(this._lasted_update_time=performance.now(),this._lasted_group_time=this._lasted_update_time,this._samples=[],this._current_count=0,this._qos_report_samples=[],this._cureen_qos_report=0,this._interval_id=setInterval(this._group.bind(this),this._group_interval),this._enable=!0)},Se.prototype.stop=function(){this._enable&&(clearInterval(this._interval_id),this._interval_id=0,this._enable=!1)},Se.prototype.sample=function(e){if(this._enable&&(this._current_count++,this._enable_advanced)){if(de(e))return void this._cureen_qos_report++;if(ue(e)){let t=ce(e),i=performance.now();if(this._lasted_qos_ts){let e=i-this._lasted_sys_ts-(t-this._lasted_qos_ts);e>30&&this._qos_report.timeoutReport(e,i)}this._lasted_qos_ts=t,this._lasted_sys_ts=i,this._lasted_data=e}}};class _e{constructor(e,t){this.type=e,this.transportlists=[],this.transfered=!!t,this.onmessage=()=>{}}send(){}isReady(){return!1}}class ye{constructor(e,t,i,r){this.id=e,this.type=t,this.datachannel=i,this._recv_statistic=null,this.onmessageFn=null,this.disconnectedFn=null,this.connectedFn=null,this._status=ye.UNINIT,this.target_thread=r,this.transfered=!1,this._listener=null,this.transportlists=[],this._send_statistic=null,this.report_monitor_func=()=>{}}isReady(){return this._status===ye.CONNECTED}send(e){this.datachannel.send(e),this._send_statistic.sample(!1)}open(){if(this.target_thread)try{return this.target_thread.postMessage({command:134,id:this.id,type:this.type,channel:this.datachannel,transportlists:this.transportlists},[this.datachannel]),this.transfered=!0,this.datachannel=null,this._listener=this._mesagelistener.bind(this),void this.target_thread.addEventListener("message",this._listener)}catch(e){this.target_thread=null}this._addEventListener()}close(){let e=this.disconnectedFn;this.transfered&&this.target_thread&&this._listener&&(this.target_thread.removeEventListener("message",this._listener),this._listener=null,this.target_thread.postMessage({command:135,id:this.id,type:this.type})),this._status!=ye.DISCONNECT&&this._clear(),this._status=ye.DISCONNECT,null==e||e()}onmessage(e){this.onmessageFn=e}onopen(e){this.connectedFn=e}onclose(e){this.disconnectedFn=e}onerror(e){this.errorFn=e}_addEventListener(){this.datachannel.onmessage=this._onmessage.bind(this),this.datachannel.onopen=this._onopen.bind(this),this.datachannel.onclose=this._onclose.bind(this),this.datachannel.onclosing=this._onclose.bind(this),this.datachannel.onerror=this._onerror.bind(this),"open"==this.datachannel.readyState&&this._status==ye.UNINIT&&this._onopen()}_onmessage(e){this._recv_statistic.sample(!1),this.onmessageFn(e)}_onopen(e){let t=this._status;var i;this._status=ye.CONNECTED,this.transfered||(this._send_statistic||(this._send_statistic=new Se({tag:this.type==Q.Xt.VIDEO?"VDCS":"ADCS",report_call:this.report_monitor_func})),this._recv_statistic||(this._recv_statistic=new Se({tag:this.type==Q.Xt.VIDEO?"VDCR":"ADCR",report_call:this.report_monitor_func})),this._send_statistic.start(),this._recv_statistic.start()),t!=ye.CONNECTED&&(null===(i=this.connectedFn)||void 0===i||i.call(this))}_onerror(e){var t;null===(t=this.errorFn)||void 0===t||t.call(this,e),this._onclose(e)}_onclose(e){let t=this._status;this._status=ye.DISCONNECT;let i=this.disconnectedFn;this._clear(),t!=ye.DISCONNECT&&(null==i||i())}_clear(){var e,t;!this.transfered&&this.datachannel&&(this.datachannel.onmessage=null,this.datachannel.onopen=null,this.datachannel.onclose=null,this.datachannel.onclosing=null,this.datachannel.onerror=null),this.onmessageFn=null,this.connectedFn=null,this.disconnectedFn=null,this.errorFn=null;let i=this.datachannel;this.datachannel=null,null===(e=this._send_statistic)||void 0===e||e.stop(),null===(t=this._recv_statistic)||void 0===t||t.stop(),null==i||i.close()}_mesagelistener(e){let t=e.data;if(t&&t.id==this.id)switch(t.cmd){case M.Lm:this._onclose();break;case M.hG:this._onopen();break;case M.Zk:this._onerror(t.ev);break;case M.vr:this.report_monitor_func(t.tag,t.data)}}}(0,o.A)(ye,"UNINIT",0),(0,o.A)(ye,"CONNECTED",1),(0,o.A)(ye,"DISCONNECT",2);class Ce{constructor(e){let t=e||{};this.type=t.type||Ce.THREAD_MAIN,this.refs={},this.transportlists=[],this.mainThread=t.remote,this.subthreadlistner=null,this.channellists=[],this.mediadatachannel=new me(this)}_onrecvmainthreadlistener(e){let{cmd:t,transportId:i,data:r}=e.data,a=this.transportlists.find((e=>e.id===i));if(a||t==M.rl)switch(t){case M.rl:this.addRemoteTransport(e.data,null);break;case M.SK:a.setMsgPort(r||new ge);break;case M.DT:a.setSabBuffer(e.data.sender,e.data.reciver);break;case M.tO:a.remote=null,this.removeTransport(a)}}_onrecvsubthreadlistener(e,t){let{cmd:i,transportId:r,transportType:a}=t.data,n=this.transportlists.find((e=>e.id===r));switch(i){case M.rl:this.addRemoteTransport(t.data,e);break;case M.DT:this.setSabBufferInfo(n,t.data.sender,t.data.reciver);break;case M.tO:n.remote=null,this.removeTransport(n)}}createRemoteTransport(e,t){let i={cmd:M.rl,transportType:e.type,transportId:e.id};e.portInfo?(i.port=e.portInfo,t.postMessage(i,[e.portInfo])):t.postMessage(i)}closeRemoteTransport(e,t){t.postMessage({cmd:M.tO,transportType:e.type,transportId:e.id})}setRemoteTransportSABBUffer(e,t){var i,r,a,n;(null!==(i=e.sabInfo)&&void 0!==i&&i.sender||null!==(r=e.sabInfo)&&void 0!==r&&r.reciver)&&t.postMessage({cmd:M.DT,transportId:e.id,sender:null===(a=e.sabInfo)||void 0===a?void 0:a.sender,reciver:null===(n=e.sabInfo)||void 0===n?void 0:n.reciver})}addRemoteTransport(e,t){let{transportId:i,port:r,transportType:a}=e,n=this.createMsgSocketTransport(a);n.id=i,n.remote=t,n.portInfo=r,r?n.setMsgPort(n.portInfo):this.bindMessageChannel(n),this.addTransport(n)}addTransport(e){let t=this.getChannelByTransportType(e.type);if(!t)return;let i=t.target_thread||me.SELF_THREAD;e.target_thread=i,this.bindTransPortForChannel(e,t)}removeTransport(e){let t=this.transportlists.indexOf(e);-1!=t&&(this.transportlists.splice(t,1),e.remote&&this.closeRemoteTransport(e,e.remote),e.target_thread!=me.NO_THREAD&&this.unbindTransPortForChannel(e))}createMsgSocketTransport(e){let t=null;return t=new Pe({mgr:this,sock:new De,type:e,local:!0}),t}bindMessageChannel(e){if(this.type!=Ce.THREAD_MAIN)return void console.error("error this call only in main thread");let t=new MessageChannel;e.portInfo=t.port1,e.remote.postMessage({cmd:M.SK,transportId:e.id,data:t.port2},[t.port2])}setSabBufferInfo(e,t,i){this.type==Ce.THREAD_MAIN?(e.sabInfo||(e.sabInfo={}),i&&(i.useCopy=!0),t&&(t.useCopy=!0),e.sabInfo={sender:t,reciver:i},e.target_thread!=me.NO_THREAD&&(e.target_thread!=me.SELF_THREAD?this.setRemoteTransportSABBUffer(e,e.target_thread):e.setSabBuffer(t,i))):console.error("<<<<< setSabBufferInfo in sub thread")}addDataChannel(e){if(e instanceof ye){try{this.checkTransport(e)}catch(e){console.error("addDataChannel error",e)}this.channellists.push(e)}else console.error("channel must be a DataChannelWrapper")}removeDataChannel(e){if(!(e instanceof ye))return void console.error("channel must be a DataChannelWrapper");let t=this.channellists.indexOf(e);-1!==t&&this.channellists.splice(t,1)}removeTransportByRemote(e){let t=[];for(let i=0;i<this.channellists.length;i++){let r=this.channellists[i];r.remote===e&&t.push(r)}for(let e=0;e<t.length;e++)this.removeTransport(t[e])}reinit(){let e=[...this.transportlists];for(let t=0;t<e.length;t++)this.removeTransport(e[t])}getTransportByType(e){return this.mediadatachannel.getTransportByType(e)}addTransportListChangeListener(e){this.mediadatachannel.addEventListener(e)}remoteTransportListChangeListener(e){this.mediadatachannel.removeEventListener(e)}checkTransport(e){this.transportlists.forEach((t=>{if(!e.transportlists.includes(t.type))return;let i=e.target_thread||me.SELF_THREAD;i==t.target_thread||(this.type==Ce.THREAD_MAIN&&t.target_thread!=me.NO_THREAD&&t.target_thread!=i&&(this.unbindTransPortForChannel(t),this.bindMessageChannel(t)),t.target_thread=i,this.bindTransPortForChannel(t,e))}))}bindTransPortForChannel(e,t){e.channel=t;let i=e.target_thread;var r,a,n,s;i!=me.SELF_THREAD?(this.createRemoteTransport(e,i),this.setRemoteTransportSABBUffer(e,i)):(e.portInfo&&e.setMsgPort(e.portInfo),(null!==(r=e.sabInfo)&&void 0!==r&&r.sender||null!==(a=e.sabInfo)&&void 0!==a&&a.reciver)&&e.setSabBuffer(null===(n=e.sabInfo)||void 0===n?void 0:n.sender,null===(s=e.sabInfo)||void 0===s?void 0:s.reciver),this.mediadatachannel.addTransport(e,t))}unbindTransPortForChannel(e){e.target_thread!=me.SELF_THREAD?this.type==Ce.THREAD_MAIN&&this.closeRemoteTransport(e,e.target_thread):this.mediadatachannel.removeTransport(e)}getChannelByTransportType(e){for(let t=0;t<this.channellists.length;t++){let i=this.channellists[t];if(i.isReady()&&i.transportlists.includes(e))return i}return null}}(0,o.A)(Ce,"THREAD_MAIN",1),(0,o.A)(Ce,"THREAD_SUB",2);const be=1,we=2,Ee=4,Re=8,Te=16,Ie=e=>{};class Me{constructor(){this.onmessage=Ie,this.status=Me.CLOSED,this.onopen=Ie,this.onclose=Ie,this.onwer=null}send(e){}delete(){this.onmessage=Ie,this.onopen=Ie,this.onclose=Ie,this.close()}sendVideo(e,t){}sendWasm(e){}open(){this.status=Me.OPEN,this.onopen()}close(){this.status=Me.CLOSED,this.onclose()}}(0,o.A)(Me,"OPEN",1),(0,o.A)(Me,"CLOSED",2);class De extends Me{constructor(){super({}),this.sab={},this.port=null,this.onmessage=Ie,this.sender=Ie,this.videoSender=Ie,this.reciver=Ie,this.wasmSender=Ie}send(e){this.sender(e)}sendVideo(e,t){this.videoSender(e,t)}sendWasm(e){this.wasmSender(e)}delete(){try{var e,t;this.onmessage=Ie,this.sender=Ie,this.videoSender=Ie,this.reciver=Ie,this.wasmSender=Ie;let{consumer:i}=(null===(e=this.sab)||void 0===e?void 0:e.reciver)||{};null==i||i.setDataCallback(Ie),null==i||i.cancelConsume(),this.sab={},this.port&&(this.port.onmessage=Ie),null===(t=this.port)||void 0===t||t.close()}catch(e){}}open(){this.status!=Me.OPEN||this.onopen()}close(){this.status=Me.CLOSED,this.delete(),this.onclose()}_onmessage(e){let{cmd:t,data:i}=e.data;switch(t){case M.F4:this.reciver();break;case M.TE:this.onmessage(i,0);break;case M.nl:this.status=i,this.status==Me.OPEN?this.onopen():this.onclose()}}createSendAndReceive(){if(!this.port)return;let{sender:e,reciver:t}=this.sab,{sabqueue:i,interval:r}=e||{};i?r?(this.sender=e=>{i.enqueue(e)},this.wasmSender=e=>{i.enqueue(e)},this.videoSender=(e,t)=>{if(!i.enqueueSafe([e,t],!1)){let r=new Uint8Array(t.length+e.length);r.set(e,0),r.set(t,e.length),i.enqueueSafe(r)}}):(this.sender=e=>{i.enqueue(e),this.port.postMessage({cmd:M.F4})},this.wasmSender=e=>{i.enqueue(e),this.port.postMessage({cmd:M.F4})},this.videoSender=(e,t)=>{if(!i.enqueueSafe([e,t],!1)){let r=new Uint8Array(t.length+e.length);r.set(e,0),r.set(t,e.length),i.enqueueSafe(r)}this.port.postMessage({cmd:M.F4})}):(this.sender=e=>{this.port.postMessage({cmd:M.TE,data:e},[e.buffer])},this.wasmSender=e=>{let t=new Uint8Array(e.length);t.set(e,0),this.port.postMessage({cmd:M.TE,data:t},[t.buffer])},this.videoSender=(e,t)=>{let i=new Uint8Array(t.length+e.length);i.set(e,0),i.set(t,e.length),this.port.postMessage({cmd:M.TE,data:i},[i.buffer])});let{sabqueue:a,consumer:n,useCopy:s,interval:o,offset:d}=t||{};if(n&&(n.cancelConsume(),n=null),a){const e=s?e=>{this.onmessage(e,0)}:d?e=>{this.onmessage(e.uint8s,e.begin)}:e=>{this.onmessage(e.uint8s,0)};let i=null,r=Pe.dataTransportMgr.monitorlogfn;if(o&&r){var c;let e=new he({tag:"WCL_M,VDRB"+(null===(c=this.onwer)||void 0===c?void 0:c.type),interval:1e4,reportcallback:Oe});i=e.timeoutReport.bind(e)}n=new pe(a,e,i),t.consumer=n,o?n.consume(o,s):this.reciver=()=>{n.consumeAll(s)}}}setMsgPort(e){e!=this.port&&(this.port&&(this.port.onmessage=Ie,this.port.close(),this.port=null),this.port=e,this.port&&(this._listeners||(this._listeners=this._onmessage.bind(this)),this.port.onmessage=this._listeners,this.createSendAndReceive()))}setSabBuffer(e,t){if(null!=e&&e.sab){let{sab:t,useCopy:i,interval:r,offset:a,length:n,useOneElement:s}=e,o=new le(a>0?t.buffer:t,void 0,void 0,!!s,a,n,a>0?t:null);this.sab.sender={sabqueue:o,interval:r,useCopy:i,offset:a}}if(null!=t&&t.sab){var i;let{sab:e,useCopy:r,interval:a,offset:n,length:s,useOneElement:o}=t,d=new le(n>0?e.buffer:e,void 0,void 0,!!o,n,s,n>0?e:null),{consumer:c}=(null===(i=this.sab)||void 0===i?void 0:i.reciver)||{};c&&(c.cancelConsume(),this.sab.reciver.consumer=null,this.sab.reciver.sabqueue=null),this.sab.reciver={sabqueue:d,interval:a,useCopy:r,offset:n}}this.createSendAndReceive()}setStatus(e){this.port?this.status!=e&&(this.status=e,this.port.postMessage({cmd:M.nl,data:e})):console.error("MsgQueueSocket not initialized")}}class Pe{constructor(e){this.onmessage=Ie,this.onopen=Ie,this.onclose=Ie,this.connect_type=e.connect_type||Pe.UDP,this.type=e.type,this.id=e.id||Math.floor(performance.now())<<10|e.type,this.sock=e.sock||new Me,this.mgr=e.mgr,this.sock.onmessage=this._onmessage.bind(this),this.sock.onclose=this._onclose.bind(this),this.sock.onopen=this._onopen.bind(this),this.sock.onwer=this,this.remote=e.remote,this.sabInfo=null,this.portInfo=null,this.target_thread=me.NO_THREAD,this.local=!!e.local,this._create()}_create(){let e=Pe.dataTransportMgr;e.transportlists.push(this),!this.local&&e&&e.mainThread&&e.type==Ce.THREAD_SUB&&e.createRemoteTransport(this,e.mainThread)}_close(){let e=Pe.dataTransportMgr,t=e.transportlists.indexOf(this);-1!=t&&e.transportlists.splice(t,1),!this.local&&e&&e.mainThread&&e.type==Ce.THREAD_SUB&&e.closeRemoteTransport(this,e.mainThread)}_onmessage(e,t){this.onmessage(e,t)}_onclose(){this.onclose()}_onopen(){this.onopen()}isReady(){return!0}send(e){this.sock.send(e)}sendVideo(e,t){this.sock.sendVideo(e,t)}sendWasmData(e){this.sock.sendWasm(e)}setSocket(e){let t=this.sock;this.sock=e,this.sock&&(this.sock.onwer=this,this.sock.onmessage=this._onmessage.bind(this),this.sock.onclose=this._onclose.bind(this),this.sock.onopen=this._onopen.bind(this)),t&&t.delete()}open(){this.sock.open()}close(){this._close(),this.sock.close()}setMsgPort(e){if(!(this.sock instanceof De))throw new Error("tansport sock is not a MsgQueueSocket");this.sock.setMsgPort(e)}setSabBuffer(e,t){if(!(this.sock instanceof De))throw new Error("tansport sock is not a MsgQueueSocket");this.sock.setSabBuffer(e,t)}setStatus(e){this.sock instanceof De&&this.sock.setStatus(e)}}(0,o.A)(Pe,"UDP",0),(0,o.A)(Pe,"TCP",1),(0,o.A)(Pe,"RLB_UDP",2),(0,o.A)(Pe,"dataTransportMgr",null);class ke{constructor(e){this.sock=null,this.onmessage=Ie}isReady(){return!1}send(){}setStatus(e){}}function Oe(e,t,i,r){var a;null===(a=Ce.monitorlogfn)||void 0===a||a.call(Ce,e,"".concat(t,",").concat(i,",").concat(r))}function xe(e,t){try{const i="undefined"!=typeof DedicatedWorkerGlobalScope;if(!Pe.dataTransportMgr&&!i)return void console.error("not InitDataTransportModule");let r=Pe.dataTransportMgr;if(t in r.refs)return;let a=r._onrecvsubthreadlistener.bind(r,e);e.addEventListener("message",a);let n={worker:e,type:t,listener:a};r.refs[t]=n}catch(e){console.error("<<<< initTransportWorker",e)}}function Ve(e){return Pe.dataTransportMgr.getTransportByType(e)}function Ne(e){if(!Pe.dataTransportMgr)throw new Error("not InitDataTransportModule");Pe.dataTransportMgr.removeDataChannel(e)}class Le{constructor(){this._listener=this._listenerfn.bind(this),this.isSupportVideoShare=!1}addTransportListiner(){var e;e=this._listener,Pe.dataTransportMgr.addTransportListChangeListener(e)}remoteTransportListener(){var e;e=this._listener,Pe.dataTransportMgr.addTransportListChangeListener(e)}_listenerfn(e,t,i){this.connectSession(t)}setVideoShareModel(e){this.isSupportVideoShare=e}connectSession(e){const{type:t}=e;!e.transfered&&e.isReady()&&(t==Q.Xt.VIDEO&&this.connectVideoSession(e),t==Q.Xt.AUDIO&&this.connectAudioSession(e))}disconnectSession(e){const{type:t}=e;e.transfered||(t==Q.Xt.VIDEO&&this.connectVideoSession(e),t==Q.Xt.AUDIO&&this.connectAudioSession(e))}connectVideoSession(e){let t=new ke,i=Ve(Re)||t,r=Ve(Ee)||t,a=Ve(Te)||t,n=(null==e?void 0:e.isReady())?Me.OPEN:Me.CLOSED;i.setStatus(n),r.setStatus(n),this.isSupportVideoShare||a.setStatus(n),e.onmessage((e=>{var t=new Uint8Array(e.data);if((104==t[0]||132==t[0])&&0==t[1]||20==t[0]||130==t[0])i.send(t);else{if(!this.isSupportVideoShare&&(133==t[0]||132==t[0]))return void a.send(t);r.send(t)}}));const s=t=>{e.send(t)};i.onmessage=s,r.onmessage=s,a.onmessage=s}connectAudioSession(e){let t=new ke,i=Ve(we)||t,r=Ve(be)||t,a=e.isReady()?Me.OPEN:Me.CLOSED;i.setStatus(a),r.setStatus(a),e.onmessage((e=>{var t=new Uint8Array(e.data);108==t[0]&&0==t[1]?i.send(t):r.send(t)}));const n=t=>{e.send(t)};i.onmessage=n,r.onmessage=n}notifyTransportStatus(e,t){}}var We=i(701);function Be(e){Fe.instance&&Fe.instance.setTimeoutCallback(e)}function Ue(e,t){Fe.instance&&Fe.instance.registerWorker(t,e)}class Fe{constructor(){this._interval=-1,this.monitorworkers={},this.timeoutcallbackfn=(e,t)=>{}}setTimeoutCallback(e){this.timeoutcallbackfn=e}registerWorker(e,t){if(e in this.monitorworkers){let t=this.monitorworkers[e];t.worker.removeEventListener("message",t.listener),delete this.monitorworkers[e]}let i={id:e,worker:t},r=this._recvheartbeat.bind(this,i);i.listener=r,i.lastedtimestamp=Date.now(),i.timeoutcount=0,i.worker.addEventListener("message",i.listener),this.monitorworkers[e]=i}unRegisterWorker(e){if(!(e in this.monitorworkers))return;let t=this.monitorworkers[e];delete this.monitorworkers[e],t.worker.removeEventListener("message",t.listener)}_recvheartbeat(e,t){let i=t.data;i.cmd===M.QT&&(e.lastedtimestamp=i.timestamp,e.timeoutcount=0)}start(e){const t="undefined"!=typeof DedicatedWorkerGlobalScope&&e&&e instanceof DedicatedWorkerGlobalScope;if(-1!=this._interval)return;if(t)return void(this._interval=setInterval((()=>{e.postMessage({cmd:M.QT,timestamp:Date.now()})}),Fe.INTREVAL_TIME_MS));const i=()=>{this._interval=setTimeout((()=>{i();let e=Fe.instance,t=Object.keys(e.monitorworkers),r=Date.now();t.forEach((t=>{let i=e.monitorworkers[t];i.timeoutcount>5?r-i.lastedtimestamp>Fe.HEART_TIMEOUT_MS&&(e.timeoutcallbackfn(i.id,r-i.lastedtimestamp),i.lastedtimestamp=r):(i.timeoutcount++,i.worker.postMessage({command:138}))}))}),Fe.INTREVAL_TIME_MS)};i()}close(){try{this._interval&&clearTimeout(this._interval),this._interval=-1,Object.keys(this.monitorworkers).forEach((e=>{let t=this.monitorworkers[e];delete this.monitorworkers[e],t.worker.removeEventListener("message",t.listener)}))}catch(e){}}}(0,o.A)(Fe,"INTREVAL_TIME_MS",3e3),(0,o.A)(Fe,"HEART_TIMEOUT_MS",15e3),(0,o.A)(Fe,"MAX_HEART_TIMEOUT_MS",3e4),(0,o.A)(Fe,"instance",null);class Ge{constructor(){this.rotation=0,this.mirror=!1,this.fillmode=!1,this.context=null,this.canvas=null}initRender(e){this.canvas=e.canvas,this.context=this.canvas.getContext("2d",{alpha:!1}),this.canvas.width=e.width||1,this.canvas.height=e.height||1}drawFromCanvas(e,t){let i=this.context,r=this.canvas.height,a=this.canvas.width,n=t.x,s=t.y,o=t.width,d=t.height;i.drawImage(e,n,s,o,d,0,0,a,r)}draw(e,t){let i=this.context,r=this.canvas.height,a=this.canvas.width,n=0,s=0,o=t.width,d=t.height;if(1==this.rotation||3==this.rotation){let e=r;r=a,a=e}let c=a,u=r;this.fillmode?o*r>a*d?(c=Math.floor(r*o/d),n=a-c>>1):o*r<a*d&&(u=Math.floor(a*d/o),s=r-u>>1):o*r>a*d?(c=a,u=Math.floor(c*d/o),s=r-u>>1):o*r<a*d&&(u=r,c=Math.floor(u*o/d),n=a-c>>1),i.drawImage(e,n,s,c,u)}setRotation(e){this.rotation!=e&&(this.rotation=e,this._transform())}setMirror(e){let t=!!e;this.mirror!=t&&(this.mirror=t,this._transform())}setFillModel(e){let t=!!e;this.fillmode!=t&&(this.fillmode=t,this._transform())}setCanvasSize(e,t){this.canvas.width==e&&this.canvas.height==t||(this.canvas.width=e,this.canvas.height=t,this._transform())}_transform(){let e=this.context,t=this.canvas.width,i=this.canvas.height;switch(this.rotation){case 0:this.mirror?(e.setTransform(-1,0,0,1,0,0),e.translate(-t,0)):(e.setTransform(1,0,0,1,0,0),e.translate(0,0));break;case 1:this.mirror?e.setTransform(0,1,1,0,0,0):(e.setTransform(0,1,-1,0,0,0),e.translate(0,-t));break;case 2:this.mirror?(e.setTransform(1,0,0,-1,0,0),e.translate(0,-i)):(e.setTransform(-1,0,0,-1,0,0),e.translate(-t,-i));break;case 3:this.mirror?(e.setTransform(0,-1,-1,0,0,0),e.translate(-i,-t)):(e.setTransform(0,-1,1,0,0,0),e.translate(-i,0))}}}class He{constructor(){}static addRenderCanvas(e,t){He.canvasMap.get(e)==t&&null!=t||He.canvasMap.set(e,t)}static getCanvas(e){return He.canvasMap.get(e)}static rmCanvas(e){He.canvasMap.delete(e)}}(0,o.A)(He,"canvasMap",new Map);class je{constructor(e,t){this.id="screenshot_canvas_".concat(Date.now()),this.isoffscreencanvas=t,this.view=new Ge,this.view.initRender({canvas:e,width:1,height:1}),this.canvas=e,this.screenshottask=[]}_buildPNG(){return this.isoffscreencanvas?this.canvas.convertToBlob({type:"image/png"}):new Promise(((e,t)=>{try{this.canvas.toBlob((t=>{e(t)}))}catch(e){t(e)}}))}destroy(){this.view=null,this.canvas=null,this.screenshottask.forEach((e=>{e.cancel()})),this.screenshottask.clear()}async captureFromVideoTag(e,t){let i=t.width,r=t.height;return this.view.setMirror(t.mirror),this.view.setRotation(0),this.view.setCanvasSize(i,r),this.view.draw(e,t),await this._buildPNG()}async captureFromCanvas(e,t){const{displayWidth:i,displayHeight:r}=t;return this.view.setCanvasSize(i,r),this.view.setMirror(t.mirror),this.view.setRotation(t.rotation),this.view.drawFromCanvas(e,t),await this._buildPNG()}createTask(e){let t=new Ke(this);return this.screenshottask.push(t),t.run(e),t}async setTaskResult(e){let t=this.screenshottask.findIndex((t=>t.id==e.id));if(-1==t)return;let[i]=this.screenshottask.splice(t,1);try{if(!e.success)return void i.error("capture failed");let t=He.getCanvas(e.data.canvasId),r=await this.captureFromCanvas(t,e.data.options);i.setResult(r)}catch(e){i.error(e)}}}(0,o.A)(je,"target",null);class Ke{constructor(){this.resolve=null,this.reject=null,this.promise=null,this.id=Date.now(),this.ended=!1}error(e){this.ended||(this.ended=!0,this.reject(e))}cancel(){this.ended||(this.ended=!0,this.reject("cancel"))}setResult(e){this.ended||(this.ended=!0,this.resolve(e))}get(){return this.promise}run(e){let t=this;this.promise=new Promise(((i,r)=>{t.resolve=i,t.reject=r,e.call(null,t.id)}))}}function qe(){if(!je.target){let e="function"==typeof OffscreenCanvas,t=null;t=e?new OffscreenCanvas(1,1):document.createElement("canvas"),je.target=new je(t,e)}return je.target}const ze="function"!=typeof importScripts;function Xe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;ze?H.Ay.error(e,t):Ye(e,t)}function Ye(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var i,r,a,n;(t instanceof Error||t instanceof ErrorEvent)&&(e+=" Message: "+(null===(i=t)||void 0===i?void 0:i.message)+" Stack: "+(null!==(r=null===(a=t)||void 0===a||null===(a=a.error)||void 0===a?void 0:a.stack)&&void 0!==r?r:null===(n=t)||void 0===n?void 0:n.stack),t=null),postMessage({status:M.AC,errorMessage:e,errorEvent:t})}function Qe(e){postMessage({status:M.AC,errorMessage:e,level:"low"})}function Je(e){postMessage({status:M.Bi,data:e})}function Ze(e){ze?(0,We.iK)(u.AoB,e):postMessage({status:M.V_,where:e})}class $e{constructor(e){this.sharedBufferList=e}storeFlexible(e,t){let i=e.byteLength-this.sharedBufferList.bytesPerElement;if(i>0){let e=Math.floor(.1*this.sharedBufferList.bytesPerElement),r=i>e?i:e;if(r+this.sharedBufferList.bytesPerElement>t)return Promise.reject("too big, more than maxBytesPerElement");this.sharedBufferList.increaseBufferSize(r)}return this.store(e)}store(e){return this.sharedBufferList.get().then((t=>{try{return this.obj=t,t.uint8s.set(e,0),this.yuvdata=new Uint8Array(t.uint8s.buffer,0,e.byteLength),!0}catch(e){throw e}finally{this.autoRecycle()}}))}storeSync(e){let t=this.sharedBufferList.getSync();return null!==t&&(this.obj=t,t.uint8s.set(e,0),this.yuvdata=new Uint8Array(t.uint8s.buffer,0,e.byteLength),!0)}autoRecycle(){this.autoRecycleInterval=setTimeout((()=>{console.log("autoRecycle",this.obj.index),this.recycle()}),5e3)}recycle(){try{this.autoRecycleInterval&&clearInterval(this.autoRecycleInterval),this.sharedBufferList.recycle(this.obj.index)}catch(e){Ye("Error in YuvWrap.recycle: ".concat(e))}}}const et=["","MOZ_","OP_","WEBKIT_"];function tt(e,t){for(var i=0;i<et.length;++i){var r=et[i]+t,a=e.getExtension(r);if(a)return a}}new Map,new class{constructor(){this.ssrcInfoMap=new Map,this.timer=null}updateSSRCInfo(e,t){this.ssrcInfoMap.has(e)||this.ssrcInfoMap.set(e,{firstTime:0,lastTime:0,frames:0,fps:0}),this._calculateFPS(e,t),this._removeZeroFPS()}_calculateFPS(e,t){const i=this.ssrcInfoMap.get(e);if(0===i.frames?i.firstTime=t:i.lastTime=t,i.frames+=1,i.frames>2&&i.frames%5==0&&i.lastTime-i.firstTime>=1e3){const t=Math.floor(1e3/((i.lastTime-i.firstTime)/(i.frames-1)));i.fps!==t&&(this._notifyFPS(e,t),i.fps=t),i.firstTime=i.lastTime,i.frames=1}}_removeZeroFPS(){let e=Date.now();this.ssrcInfoMap.forEach(((t,i)=>{const r=this.ssrcInfoMap.get(i);r&&e-r.lastTime>2e3&&(this.ssrcInfoMap.delete(i),this._notifyFPS(i,0))}))}_notifyFPS(e,t){postMessage({status:M.$x,data:{ssrc:e,fps:t}})}_checkIfNewFrameComing(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout((()=>{this._removeZeroFPS(),this.timer=null}),2500)}};class it{constructor(e){this.featurebit=e}isSupportOffScreenCanvas(){return 1&this.featurebit}isSupportOffScreenCanvasWebgl(){return 2&this.featurebit}}const rt=["name","messageParams","direction"];function at(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function nt(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?at(Object(i),!0).forEach((function(t){(0,o.A)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):at(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const st=(0,G.A)("sdk.engine"),{HjG:ot}=u;async function dt(e,t){let i;switch(e){case Q._c.VIDEO_ENCODE:i=J.A.videoEncResponseText;break;case Q._c.VIDEO_DECODE:i=J.A.videoDecResponseText;break;case Q._c.AUDIO_ENCODE:i=J.A.audioEncodeResponse;break;case Q._c.AUDIO_DECODE:i=J.A.audioDecodeResponse;break;case Q._c.SHARING_DECODE:i=J.A.sharingDecodeResponse;break;case Q._c.SHARING_ENCODE:i=J.A.sharingEncodeResponse}i||(i=await ct(t.workerJsFileUrl,t.integrityHelper));const r="wasmUrl = '"+t.workerWasmFileUrl+"';";return i.replace(/self\.__wasmCodeDataEndFlag\s*=\s*1[;|,]/,r+"self.__wasmCodeDataEndFlag = 1;")}function ct(e,t){let i=null;return t&&(i=t.getIntegrity()),F.Ay.download(e,i)}function ut(e,t,i,r,a){return new Promise(((n,s)=>{!async function(e,t,i,r,a){if(a&&a.isDestroy)return Y.A.add_monitor("ZIDX",r),st("WorkerType:".concat(r,";The relative SDK instance is destroy, don't start relative worker, avoid multiple same workers. "));let n,s={};if(Q.d[r]&&Object.assign(s,{name:Q.d[r]}),r==Q._c.AUDIO_ENCODE?J.A.AEW&&(n=J.A.AEW):r==Q._c.AUDIO_DECODE&&J.A.ADW&&(n=J.A.ADW),n)r==Q._c.AUDIO_ENCODE?J.A.AEWF=!0:r==Q._c.AUDIO_DECODE&&(J.A.ADWF=!0);else{const t=c().createObjectURL(new Blob([await dt(r,e)]));n=new Worker(t,s),n.addEventListener("error",(e=>{if(e.message&&e.message.includes("RuntimeError:")){let e=performance.now();e-J.A.crashLastTime>3e4&&(J.A.crashCount++,J.A.crashLastTime=e,(0,We.iK)(u.oQY),pt("NOTIFY_UI_FAILOVER  ".concat(J.A.crashCount)))}})),r===Q._c.VIDEO_ENCODE&&n.postMessage({command:"WORKER_BOLB_URL",blobUrl:t}),J.A.mediaSDKHandle.is32bitbrowser&&(r==Q._c.AUDIO_ENCODE?J.A.AEW=n:r==Q._c.AUDIO_DECODE&&(J.A.ADW=n))}t&&t.call(i,n)}(e,(function(e){var a=J.A.SPECIAL_ID;t&&(Y.A.add_monitor("WAM"+r),t.Add(a,e)),e.onmessage=e=>{i(e)},n()}),this,r,a)}))}function ht(e,t){let i=t.data;i.status!==M.Os?i.status!=M.wo?[lt,ft].forEach((t=>{try{t.call(null,e,i)}catch(e){H.Ay.error("Error from allWorkersListener",e)}})):function(e){if(J.A.browserFeature)return;const t=new it(e);J.A.browserFeature=t,J.A.browserFeaturedefer.resolve(t);const i=(0,F.uF)();!t.isSupportOffScreenCanvasWebgl()&&i&&H.Ay.directReport("disable webgl in worker")}(i.data):qe().setTaskResult(i)}function lt(e,t){-1!==[Q._c.AUDIO_ENCODE,Q._c.VIDEO_ENCODE,Q._c.SHARING_ENCODE].indexOf(e)&&t.status===M._Q&&(st("allWorkersListener_AES_IV",e,t),J.A.Notify_APPUI_SAFE(u.Ewj,{workerType:e,iv:F.Ay.buffer2stringSplitByComma(t.data)}))}function pt(e){let t=F.Ay.getMachineCapability();t.errorMessage=e,H.Ay.severityerror(t,["MEDIASDK_ERROR"])}function ft(e,t){if(t.status===M.AC)if("low"==t.level)H.Ay.directReport("".concat(t.errorMessage));else{let i="Error from ".concat(e," worker: ").concat(t.errorMessage);-1!=i.indexOf("E:H")?pt(i):H.Ay.error(i,t.errorEvent)}}function gt(e){try{var t;null!==(t=J.A.userNodeList)&&void 0!==t&&t.length&&er(e,{userNodeList:J.A.userNodeList},re,!1,!1)}catch(t){H.Ay.error("Error when sending cached user node list to worker workerType "+e,t)}}function mt(e){let t=J.A.userNodeList||[],i=e.concat(t);J.A.userNodeList=F.Ay.removeDuplicates(i,((e,t)=>e.userid!==t.userid)),[Q._c.AUDIO_ENCODE,Q._c.AUDIO_DECODE,Q._c.VIDEO_ENCODE,Q._c.VIDEO_DECODE,Q._c.SHARING_ENCODE,Q._c.SHARING_DECODE].forEach((async e=>{let t;switch(e){case Q._c.AUDIO_ENCODE:t=J.A.audioEncodeInitInstance;break;case Q._c.AUDIO_DECODE:t=J.A.audioDecInitInstance;break;case Q._c.VIDEO_ENCODE:t=J.A.videoInitInstance;break;case Q._c.VIDEO_DECODE:t=J.A.videoDecInitInstance;break;case Q._c.SHARING_ENCODE:t=J.A.sharingEncInitInstance;break;case Q._c.SHARING_DECODE:t=J.A.sharingDecInitInstance}try{await t.waitforInitSuccess(),st("setUserNodeListToWorker init success",e),er(e,{userNodeList:J.A.userNodeList},re,!1,!0)}catch(e){H.Ay.error("Error when sending user node list to worker",e)}}))}function vt(e){J.A.isAudioPlayWork=e}async function At(e){J.A.isVideoPlayWork=e,await er(Q._c.VIDEO_DECODE,{isVideoPlayWork:e},"VideoPlayStatus",!1,!0)}function St(e){J.A.isSharingPlayWork=e}const _t=function(){const e={SDK_TO_WORKER:"SDK_TO_WORKER",SDK_TO_WORKER_WAIT_OK:"SDK_TO_WORKER_WAIT_OK",SDK_TO_APP:"SDK_TO_APP",SDK_TO_SDK:"SDK_TO_SDK"};return{nameMap:{INIT_VIDEO_ENCODE_SUCCESS:"INIT_VIDEO_ENCODE_SUCCESS",INIT_VIDEO_DECODE_SUCCESS:"INIT_VIDEO_DECODE_SUCCESS",CREATE_VIDEO_ENCODE_HANDLE_SUCCESS:"CREATE_VIDEO_ENCODE_HANDLE_SUCCESS",CREATE_VIDEO_DECODE_HANDLE_SUCCESS:"CREATE_VIDEO_DECODE_HANDLE_SUCCESS",CREATE_AUDIO_ENCODE_HANDLE_SUCCESS:"CREATE_AUDIO_ENCODE_HANDLE_SUCCESS",CREATE_AUDIO_DECODE_HANDLE_SUCCESS:"CREATE_AUDIO_DECODE_HANDLE_SUCCESS"},map:new Map,direction:e,clear(){this.map.clear()},subscribeMessage(t){const i=this.map.get(t);i&&(i.forEach((t=>{const{direction:i,messageParams:r,handler:a}=t;if(i===e.SDK_TO_APP)J.A.Notify_APPUI(...r);else if(i===e.SDK_TO_WORKER_WAIT_OK)er(...r);else if(i===e.SDK_TO_WORKER){const[e,t]=r,i=$i(e);i&&i.postMessage(t)}else i===e.SDK_TO_SDK&&a&&a(r)})),this.map.delete(t))},enqueueMessage(e){let{name:t,messageParams:i,direction:r}=e,a=s(e,rt);this.map.has(t)||this.map.set(t,[]),this.map.get(t).push(nt({direction:r,messageParams:i||[]},a))}}}(),yt={resetAudioEncode:e=>{!e&&J.A.isPreviewMode.audioEncode&&(J.A.audioEncodeSession=null),J.A.isPreviewMode.audioEncode=!!e},resetAudioDecode:e=>{!e&&J.A.isPreviewMode.audioDecode&&(J.A.audioDecodeSession=null),J.A.isPreviewMode.audioDecode=!!e},resetVideoEncode:e=>{!e&&J.A.isPreviewMode.videoEncode&&(J.A.videoEncodeSession=null),J.A.isPreviewMode.videoEncode=!!e},resetVideoDecode:e=>{!e&&J.A.isPreviewMode.videoDecode&&(J.A.videoDecodeSession=null),J.A.isPreviewMode.videoDecode=!!e}};async function Ct(e,t){J.A.localVideoEncMGR||(J.A.localVideoEncMGR=new N({sessionid:t._id})),bt(Q._c.VIDEO_DECODE,J.A.localVideoEncMGR.sessionid,t._id),J.A.videoEncWorkerPath=e.workerJsFileUrl;let i=await ct(e.workerJsFileUrl,e.integrityHelper);if(J.A.videoEncResponseText=i,!Et(t))return!1;if(await async function(e,t,i,r){J.A.localVideoEncMGR&&(J.A.isVideoEncodeThreadStart||(J.A.isVideoEncodeThreadStart=!0,await ut(r,J.A.localVideoEncMGR,Lt,Q._c.VIDEO_ENCODE,i)))}(0,0,t,e),!Et(t,"Add_Video_Encode_Thread"))return H.Ay.error("Add_Video_Encode_Thread Worker Not Controled"),!1;let r=vr(Q._c.VIDEO_ENCODE);xe(r,Q._c.VIDEO_ENCODE),Ue(r,Q._c.VIDEO_ENCODE),_t.subscribeMessage(_t.nameMap.CREATE_VIDEO_ENCODE_HANDLE_SUCCESS),await async function(e){if(!J.A.localVideoEncMGR)return;if(await J.A.videoInitInstance.wasmSuccessPromise,!Et(e))return;var t=J.A.localVideoEncMGR.map.get(J.A.SPECIAL_ID);let i=J.A.localVideoPara.confId||0;if(Rt(J.A.videoEncodeSession,i)&&(J.A.videoEncodeSession=null),t&&!J.A.videoEncodeSession){J.A.videoEncodeSession={type:Q._c.VIDEO_ENCODE,userId:i};var r;r="firefox"===F.Ay.browserType.browser?1080:1070,J.A.mediaSDKHandle.mtu_size=r;let a=null;J.A.ivObj&&(a=J.A.ivObj[Q._c.VIDEO_ENCODE],a=F.Ay.stringSplitByComma2Buffer(a));let n=nt(nt({command:ee,_id:e._id,websocket_ip_address:J.A.Video_WebSocket_Ip_Address?J.A.Video_WebSocket_Ip_Address+"&mode=2":void 0,confId:J.A.localVideoPara.confId,confKey:"",logon:J.A.localVideoPara.logon,sendvideo:!0,isChromeOrEdge:F.Ay.browser.isChrome,isArmSafari:F.Ay.browser.isSafari&&!F.Ay.isMacIntelSafari(),isFirefox:J.A.localVideoPara.isFirefox,mtu_size:r,meetingid:J.A.localVideoPara.meetingid,meetingnumb:J.A.localVideoPara.meetingnumb,videoencodethreadnumb:J.A.localVideoPara.videoencodethreadnumb,iv:a,videodecodethreadnumb:J.A.localVideoPara.videodecodethreadnumb,isSupportMultiThread:J.A.localVideoPara.isSupportMultiThread,isSupportVirtualBackground:J.A.localVideoPara.isSupportVirtualBackground,uplimit:J.A.uplimit,isSupportWebCodecEnocde:J.A.localVideoPara.isSupportWebCodecEnocde,initWebCodecFlag:J.A.localVideoPara.initWebCodecFlag,is360penablehwenc:J.A.enable360pHWEnc,is360penablehwdec:J.A.enable360pHWDec,enable720p:J.A.localVideoPara.enable720p,enableOptCopyFrame:J.A.enableOptCopyFrame,isPreviewMode:J.A.isPreviewMode.videoEncode},J.A.Video_Web_Transport_Ip_Address?{webtransportURL:J.A.Video_Web_Transport_Ip_Address+"&mode=2"}:{}),{},{enableAudioBridge:J.A.enableAudioBridge,platformType:J.A.localVideoPara.platformType,rendererType:J.A.localVideoPara.rendererType,graphicalname:F.Ay.graphicName,vendorname:F.Ay.graphicvendorname,enableMultiDecodeVideoWithoutSAB:!!J.A.enableMultiDecodeVideoWithoutSAB,IsRenderInWorker:J.A.localVideoPara.IsRenderInWorker,enableVBWasmBackend:e.enableVBWasmBackend,webrtcvideo:J.A.localVideoPara.webrtcvideo,isEnableCanvasAlphaChannel:J.A.enableCanvasAlphaChannel,isEnableCanvasCtxOptionsOpt:$.isEnableCanvasCtxOptionsOpt(),MaskFlag:J.A.localVideoPara.MaskFlag,isSafari:J.A.localVideoPara.isSafari,isVDIWebview:J.A.isVDIWebview,WASM_MOBILE_30FPS:!!J.A.WASM_MOBILE_30FPS});t.postMessage(n),J.A.tfjsurl&&t.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:J.A.tfjsurl,type:"js"}),J.A.vbbin&&J.A.vbjson&&t.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:J.A.vbbin,json:J.A.vbjson},index:0}),J.A.afnbin&&J.A.afnjson&&(t.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:J.A.afnbin,json:J.A.afnjson},index:1}),J.A.basebin&&J.A.basejson&&t.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:J.A.basebin,json:J.A.basejson},index:2}))}}(t)}function bt(e,t,i){let r=t==i;return r||H.Ay.error("mediasdkInstance id ".concat(i," not equal  media type ").concat(e," id ").concat(t)),r}function wt(e,t){J.A.sendMessageToRwg(u.yJV,{evt:u.ahr,body:{flag:t,type:e}},!1)}function Et(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.isDestroy&&H.Ay.log("mediasdkInstance id ".concat(e._id," is Destoryed from ").concat(t)),!e.isDestroy}function Rt(e,t){return!(!e||e.userId>>10==t>>10||(e.userId&&H.Ay.error("mediasdk user changed media type ".concat(e.type," pre id  ").concat(e.userId," now id ").concat(t)),0))}async function Tt(e,t){J.A.localVideoDecMGR||(J.A.localVideoDecMGR=new N({sessionid:t._id})),bt(Q._c.VIDEO_DECODE,J.A.localVideoDecMGR.sessionid,t._id),J.A.videoDecWorkerPath=e.workerJsFileUrl;let i=await ct(e.workerJsFileUrl,e.integrityHelper);if(!Et(t))return!1;if(J.A.videoDecResponseText=i,await ni(0,0,t,e),!Et(t,"Add_Video_Decode_Thread"))return H.Ay.error("Add_Video_Decode_Thread Worker Not Controled"),!1;let r=vr(Q._c.VIDEO_DECODE);xe(r,Q._c.VIDEO_DECODE),Ue(r,Q._c.VIDEO_DECODE),_t.subscribeMessage(_t.nameMap.CREATE_VIDEO_DECODE_HANDLE_SUCCESS),await async function(e){if(J.A.isPreviewMode.videoDecode)return;if(!J.A.localVideoDecMGR)return;if(await J.A.videoDecInitInstance.wasmSuccessPromise,!Et(e))return!1;var t=J.A.localVideoDecMGR.map.get(J.A.SPECIAL_ID);let i=J.A.localVideoPara.confId||0;if(Rt(J.A.videoDecodeSession,i)&&(J.A.videoDecodeSession=null),t&&!J.A.videoDecodeSession){J.A.videoDecodeSession={type:Q._c.VIDEO_DECODE,userId:i};let r=nt(nt({command:ee,_id:e._id,websocket_ip_address:J.A.Video_WebSocket_Ip_Address?J.A.Video_WebSocket_Ip_Address+"&mode=5":void 0,confId:J.A.localVideoPara.confId,confKey:"",logon:J.A.localVideoPara.logon,mtu_size:0,meetingid:J.A.localVideoPara.meetingid,meetingnumb:J.A.localVideoPara.meetingnumb,videoencodethreadnumb:1,videodecodethreadnumb:J.A.localVideoPara.videodecodethreadnumb,isFirefox:J.A.localVideoPara.isFirefox,isSupportMultiThread:J.A.localVideoPara.isSupportMultiThread,isSupportOffscreenCanvas:J.A.localVideoPara.isSupportOffscreenCanvas,isenablehw:J.A.localVideoPara.isenablehw,isEnableVideoDecodeHardWareThread:J.A.localVideoPara.isEnableVideoDecodeHardWareThread,isEnableHardWareThread:J.A.localVideoPara.isEnableHardWareThread,isTeslaMode:J.A.localVideoPara.isTeslaMode,enableMultiDecodeVideoWithoutSAB:!!J.A.enableMultiDecodeVideoWithoutSAB},J.A.Video_Web_Transport_Ip_Address?{webtransportURL:J.A.Video_Web_Transport_Ip_Address+"&mode=1"}:{}),{},{enableAudioBridge:J.A.enableAudioBridge,graphicalname:F.Ay.graphicName,vendorname:F.Ay.graphicvendorname,platformType:J.A.localVideoPara.platformType,rendererType:J.A.localVideoPara.rendererType,isWebCodecDecoderOnWhitelist:J.A.localVideoPara.isWebCodecDecoderOnWhitelist,decHAOption:J.A.enableHADecOpt?"no-preference":void 0,is360penablehwenc:J.A.enable360pHWEnc,is360penablehwdec:J.A.enable360pHWDec,webrtcvideo:J.A.localVideoPara.webrtcvideo,isEnableCanvasAlphaChannel:J.A.enableCanvasAlphaChannel,isEnableCanvasCtxOptionsOpt:$.isEnableCanvasCtxOptionsOpt(),isVDIWebview:J.A.isVDIWebview});t.postMessage(r)}}(t)}async function It(e,t){if(await jt(t.audioCtx.sampleRate),J.A.localAudioEncMGR||(J.A.localAudioEncMGR=new V({sessionid:t._id})),bt(Q._c.AUDIO_ENCODE,J.A.localAudioEncMGR.sessionid,t._id),J.A.audioEncWorkerPath=e.workerJsFileUrl,J.A.audioEncodeResponse=await ct(e.workerJsFileUrl,e.integrityHelper),!Et(t))return!1;if(await async function(e,t,i){J.A.isAudioEncodeThreadStart||(J.A.isAudioEncodeThreadStart=!0,await ut(i,J.A.localAudioEncMGR,Ht,Q._c.AUDIO_ENCODE,t))}(0,t,e),!Et(t,"Add_Audio_Encode_Thread"))return H.Ay.error("Add_Audio_Encode_Thread Worker Not Controled"),!1;let i=vr(Q._c.AUDIO_ENCODE);xe(i,Q._c.AUDIO_ENCODE),Ue(i,Q._c.AUDIO_ENCODE),_t.subscribeMessage(_t.nameMap.CREATE_AUDIO_ENCODE_HANDLE_SUCCESS),await async function(e){if(!J.A.localAudioEncMGR)return void H.Ay.error("jsMediaEngineVariables.localAudioEncMGR is null when call Audio_Encode_Post_message");var t=J.A.localAudioEncMGR.map.get(J.A.SPECIAL_ID);if(J.A.AEWF&&t.postMessage({command:"RIWM"}),await J.A.audioEncodeInitInstance.wasmSuccessPromise,!Et(e))return!1;let i=J.A.localAudioPara.userid||0;if(Rt(J.A.audioEncodeSession,i)&&(J.A.audioEncodeSession=null),t&&!J.A.audioEncodeSession){J.A.audioEncodeSession={type:Q._c.AUDIO_ENCODE,userId:i};let r=null;J.A.ivObj&&(r=J.A.ivObj[Q._c.AUDIO_ENCODE],r=F.Ay.stringSplitByComma2Buffer(r));let a=nt({command:ee,_id:e._id,websocket_ip_address:J.A.Audio_WebSocket_Ip_Address?J.A.Audio_WebSocket_Ip_Address+"&mode=2":void 0,sampleRate:J.A.localAudioPara.sampleRate,userid:J.A.localAudioPara.userid,encode:1,meetingid:J.A.localAudioPara.meetingid,meetingnumb:J.A.localAudioPara.meetingnumb,iv:r,shouldNotChangeSampleRate:F.Ay.browser.isFirefox||F.Ay.browser.isSafari,isPreviewMode:J.A.isPreviewMode.audioEncode,audioEncodeChannelsNum:F.Ay.isBrowserSupportStereo()?2:1,audioDecodeChannelsNum:F.Ay.isSupportPlayStereo()?2:1},J.A.Audio_Web_Transport_Ip_Address?{webtransportURL:J.A.Audio_Web_Transport_Ip_Address+"&mode=2"}:{});if(t.postMessage(a),J.A.sharedBuffer){st("post audioEnc sab");try{t.postMessage({command:"sharedBuffer",data:J.A.sharedBuffer})}catch(e){t.postMessage({command:"sharedBuffer",data:J.A.sharedBuffer},[J.A.sharedBuffer])}}}}(t)}async function Mt(e,t){var i;if(await jt(null===(i=t.audioCtx)||void 0===i?void 0:i.sampleRate),J.A.localAudioDecMGR||(J.A.localAudioDecMGR=new V({sessionid:t._id})),bt(Q._c.AUDIO_DECODE,J.A.localAudioDecMGR.sessionid,t._id),J.A.audioDecWorkerPath=e.workerJsFileUrl,J.A.audioDecodeResponse=await ct(e.workerJsFileUrl,e.integrityHelper),"string"==typeof J.A.audioDecodeResponse?Y.A.add_monitor("DAFL"+J.A.audioDecodeResponse.length):Y.A.add_monitor("DAFF"),!Et(t))return!1;if(await si(0,0,t,e),!Et(t,"Add_Audio_Decode_Thread"))return H.Ay.error("Add_Audio_Decode_Thread Worker Not Controled"),!1;let r=vr(Q._c.AUDIO_DECODE);xe(r,Q._c.AUDIO_DECODE),Ue(r,Q._c.AUDIO_DECODE),_t.subscribeMessage(_t.nameMap.CREATE_AUDIO_DECODE_HANDLE_SUCCESS),Y.A.add_monitor("ADTS"),await async function(e){if(J.A.isPreviewMode.audioDecode)return void Y.A.add_monitor("ZISA");if(!J.A.localAudioDecMGR)return void H.Ay.warn("jsMediaEngineVariables.localAudioDecMGR is null when call Audio_Decode_Post_message");var t=J.A.localAudioDecMGR.map.get(J.A.SPECIAL_ID);if(J.A.ADWF&&t.postMessage({command:"RIWM"}),await J.A.audioDecInitInstance.wasmSuccessPromise,!Et(e))return!0;let i=J.A.localAudioPara.userid||0;if(Rt(J.A.audioDecodeSession,i)&&(J.A.audioDecodeSession=null),t&&!J.A.audioDecodeSession){J.A.audioDecodeSession={type:Q._c.AUDIO_DECODE,userId:i};let r=nt({command:ee,_id:e._id,websocket_ip_address:J.A.Audio_WebSocket_Ip_Address?J.A.Audio_WebSocket_Ip_Address+"&mode=5":void 0,sampleRate:J.A.localAudioPara.sampleRate,userid:J.A.localAudioPara.userid,logon:J.A.localAudioPara.logon,decode:1,meetingid:J.A.localAudioPara.meetingid,meetingnumb:J.A.localAudioPara.meetingnumb,videodecodethreadnumb:J.A.localAudioPara.videodecodethreadnumb,isSupportMultiThread:J.A.localAudioPara.isSupportMultiThread,decoderInWorklet:J.A.decoderinworklet,audioDecodeChannelsNum:F.Ay.isSupportPlayStereo()?2:1,shouldNotChangeSampleRate:F.Ay.browser.isFirefox||F.Ay.browser.isSafari},J.A.Audio_Web_Transport_Ip_Address?{webtransportURL:J.A.Audio_Web_Transport_Ip_Address+"&mode=1"}:{});if(Y.A.add_monitor("ADSM"),t.postMessage(r),J.A.sharedBuffer){st("post audioDec sab");try{t.postMessage({command:"sharedBuffer",data:J.A.sharedBuffer})}catch(e){t.postMessage({command:"sharedBuffer",data:J.A.sharedBuffer},[J.A.sharedBuffer])}}}else Y.A.add_monitor("ADSME"+!!t+!!J.A.audioDecodeSession)}(t)}async function Dt(e,t){if(J.A.localSharingDecMGR||(J.A.localSharingDecMGR=new U({sessionid:t._id})),J.A.localMouseDecMGR||(J.A.localMouseDecMGR=new U({sessionid:t._id})),bt(Q._c.SHARING_DECODE,J.A.localSharingDecMGR.sessionid,t._id),J.A.sharingDecWorkerPath=e.workerJsFileUrl,J.A.sharingDecodeResponse=await ct(e.workerJsFileUrl,e.integrityHelper),!Et(t))return!1;if(await async function(e,t){J.A.isSharingDecodeThreadStart||(J.A.isSharingDecodeThreadStart=!0,await ut(t,J.A.localSharingDecMGR,xt,Q._c.SHARING_DECODE,e))}(t,e),!Et(t,"Add_Sharing_Decode_Thread"))return H.Ay.error("Add_Sharing_Decode_Thread Worker Not Controled"),!1;let i=vr(Q._c.SHARING_DECODE);xe(i,Q._c.SHARING_DECODE),Ue(i,Q._c.SHARING_DECODE),await kt(t)}async function Pt(e,t){return J.A.localSharingEncMGR||(J.A.localSharingEncMGR=new U({sessionid:t._id})),bt(Q._c.SHARING_ENCODE,J.A.localSharingEncMGR.sessionid,t._id),J.A.sharingEncWorkerPath=e.workerJsFileUrl,J.A.sharingEncodeResponse=await ct(e.workerJsFileUrl,e.integrityHelper),!!Et(t)&&(await async function(e,t){if(e&&e.isDestroy)return st("WorkerType:sharingEnc;The relative SDK instance is destroy, don't start relative worker, avoid multiple same workers. ");J.A.isSharingEncodeThreadStart||(J.A.isSharingEncodeThreadStart=!0,await ut(t,J.A.localSharingEncMGR,Vt,Q._c.SHARING_ENCODE,e))}(t,e),Et(t,"Add_Sharing_Encode_Thread")?(Ue(vr(Q._c.SHARING_ENCODE),Q._c.SHARING_ENCODE),void await Ot(t)):(H.Ay.error("Add_Sharing_Encode_Thread Worker Not Controled"),!1))}async function kt(e){if(await J.A.sharingDecInitInstance.wasmSuccessPromise,!Et(e))return!1;var t=J.A.localSharingDecMGR.Get(J.A.SPECIAL_ID);let i=J.A.localSharingPara.userid||0;Rt(J.A.sharingDecodeSession,i)&&(J.A.sharingDecodeSession=null),t&&!J.A.sharingDecodeSession&&(J.A.sharingDecodeSession={type:Q._c.SHARING_DECODE,userId:i},t.postMessage({command:ee,_id:e._id,websocket_ip_address:J.A.Sharing_WebSocket_Ip_Address,confId:J.A.localSharingPara.userid,confKey:"",logon:J.A.localSharingPara.logon,meetingid:J.A.localSharingPara.meetingid,meetingnumb:J.A.localSharingPara.meetingnumb,multiThreadNum:1,graphicalname:F.Ay.graphicName,vendorname:F.Ay.graphicvendorname,rendererType:J.A.localSharingPara.rendererType,isWebCodecDecoderOnWhitelist:J.A.localSharingPara.isWebCodecDecoderOnWhitelist,isEnableCanvasAlphaChannel:J.A.enableCanvasAlphaChannel,isEnableCanvasCtxOptionsOpt:$.isEnableCanvasCtxOptionsOpt()}))}async function Ot(e){if(await J.A.sharingEncInitInstance.wasmSuccessPromise,!Et(e))return!1;var t=J.A.localSharingEncMGR.Get(J.A.SPECIAL_ID);let i=J.A.localSharingPara.userid||0;if(Rt(J.A.sharingEncodeSession,i)&&(J.A.sharingEncodeSession=null),t&&!J.A.sharingEncodeSession){let r=1;Y.A.add_monitor2("STN"+r);let a=null;J.A.ivObj&&(a=J.A.ivObj[Q._c.SHARING_ENCODE],a=F.Ay.stringSplitByComma2Buffer(a)),J.A.sharingEncodeSession={type:Q._c.SHARING_ENCODE,userId:i},t.postMessage({command:ee,_id:e._id,encode:!0,websocket_ip_address:J.A.Sharing_WebSocket_Ip_Address,confId:J.A.localSharingPara.userid,confKey:"",logon:J.A.localSharingPara.logon,isChromeOrEdge:F.Ay.browser.isChrome,meetingid:J.A.localSharingPara.meetingid,meetingnumb:J.A.localSharingPara.meetingnumb,multiThreadNum:1,iv:a,uplimit:J.A.uplimit,graphicalname:F.Ay.graphicName,vendorname:F.Ay.graphicvendorname,rendererType:J.A.localSharingPara.rendererType,isEnableCanvasAlphaChannel:J.A.enableCanvasAlphaChannel,isEnableCanvasCtxOptionsOpt:$.isEnableCanvasCtxOptionsOpt()})}}function xt(e){var t=e.data;try{if(t.status===M.Rm)X.publish(u.vjv,{body:{width:t.logicWidth,height:t.logicHeight,logicWidth:t.logicWidth,logicHeight:t.logicHeight}}),J.A.Notify_APPUI(u.cYb,{body:{width:t.logicWidth,height:t.logicHeight,logicWidth:t.logicWidth,logicHeight:t.logicHeight}});else if(t.status===M.Vd)J.A.Notify_APPUI(u.jhI,t.ssrc);else if(t.status===M.SG)Y.A.add_monitor2(t.data);else if(t.status===M.xD)Y.A.add_monitor("FSF"),J.A.Notify_APPUI(u.vd4,{ssrc:t.ssrc});else if(t.status===M.Wr)!function(e,t,i,r,a,n,s,o,d,c,u,h,l){if(J.A.isSharingPlayWork){var p={yuvdata:t,ntptime:i,ssrc:e,width:r,height:a,r_x:n,r_y:s,r_w:o,r_h:d,logic_w:c,logic_h:u,yuv_limited:h,isFromMainSession:l};J.A.mediaSDKHandle.SharingRenderObj.Put_Sharing_Data_From_Queue(p,15)}}(t.sharing_ssrc,t.data,t.sharing_timestamp,t.sharing_width,t.sharing_height,t.rendering_x,t.rendering_y,t.rendering_w,t.rendering_h,t.logic_w,t.logic_h,t.yuv_limited,t.isFromMainSession);else if(t.status===M.Bm)!function(e,t,i,r,a,n,s,o,d,c){if(J.A.isSharingPlayWork){var u={buffer:t,ntptime:i,ssrc:e,width:r,height:a,r_x:n,r_y:s,mLogic_w:o,mLogic_h:d,sync_id:c};J.A.mediaSDKHandle.SharingRenderObj.Put_Mouse_Data_Into_Queue(u)}}(t.mouse_ssrc,t.data,t.mouse_timestamp,t.mouse_width,t.mouse_height,t.mouse_x,t.mouse_y,t.mLogic_w,t.mLogic_h,t.sync_id);else if(t.status===M.av)J.A.Notify_APPUI(u.zj1,{ssrc:t.ssrc,size:t.size,fps:t.size});else if(t.status===u.oUP){const e=nt({encoding:!1},t.data);J.A.Notify_APPUI_SAFE(u.oUP,e)}else if(t.status===M.sV)Y.A.add_monitor("SDWS"),J.A.isSharingDecodeWASMOK=!0,J.A.sharingDecInitInstance.setWasmSuccess();else if(t.status===M.bC)Y.A.add_monitor("SDWF",t.data),pt("SDWF"),J.A.sharingDecInitInstance.setWasmSuccess(!1);else if(t.status===M.Ji||t.status===M.x8)Y.A.add_monitor("SDHS"),J.A.sharingDecInitInstance.setHanderSuccess();else if(t.status===M.I6)Y.A.add_monitor("SHHF"),J.A.sharingDecInitInstance.setHanderSuccess(!1);else if(t.status===M.zS)Y.A.add_monitor("SDSS"),J.A.sharingDecInitInstance.setSocketSuccess();else if(t.status===M.KE)Y.A.add_monitor("SDSF"),J.A.sharingDecInitInstance.isSocketInitSuccess()&&(0,We.iK)(u.oDm,null),J.A.sharingDecInitInstance.setSocketSuccess(!1);else{if(t.status==M.vr)return void Y.A.send_monitor_directly(t.data);if(t.status===M.wQ){let e=J.A.localSharingDecMGR.map.get(J.A.SPECIAL_ID);Ut(t.url,e,Q._c.SHARING_DECODE)}else t.status==M.ef?(J.A.monitorSharingDecodeAPPInfo=t,Y.A.send_monitor_directly(J.A.monitorSharingDecodeAPPInfo.data),J.A.monitorSharingDecodeAPPInfo=null):t.status==M.Bi?Y.A.add_monitor("SD"+t.data):t.status==M.aY?(Y.A.add_monitor("MWGLF"),J.A.Notify_APPUI(u.BgG,{canvasId:t.canvasId,replaceCanvas:!!t.replaceCanvas})):t.status==M.kD?Y.A.add_monitor("MWGRF"):"WFMO"==t.status?Bt(Q._c.SHARING_DECODE):t.status==M.jA?J.A.SDMTimes++<2&&(pt(Q._c.SHARING_DECODE+" Memory Allocate Failed"),Y.A.add_monitor("SDMAF"),(0,We.iK)(u.a1o)):t.status==M.uL?J.A.mediaSDKHandle.onAnnotationPdu(t.data):t.status==M.V_?(0,We.iK)(u.AoB,t.where):ht(Q._c.SHARING_DECODE,e)}}catch(e){H.Ay.error("Error in SharingDec_Listener",e)}}function Vt(e){var t=e.data;try{if(t.status===M.sV)Y.A.add_monitor("SEWS"),J.A.isSharingEncodeWASMOK=!0,J.A.sharingEncInitInstance.setWasmSuccess();else if(t.status===M.bC)Y.A.add_monitor("SEWF",t.data),pt("SEWF"),J.A.sharingEncInitInstance.setWasmSuccess(!1);else if(t.status===M.Ji||t.status===M.x8)Y.A.add_monitor("SEHS"),J.A.sharingEncInitInstance.setHanderSuccess();else if(t.status===M.I6)Y.A.add_monitor("SEHF"),J.A.sharingEncInitInstance.setHanderSuccess(!1);else if(t.status===M.zS)Y.A.add_monitor("SESS"),J.A.sharingEncInitInstance.setSocketSuccess();else if(t.status===M.KE)Y.A.add_monitor("SESF",t.data),J.A.sharingEncInitInstance.isSocketInitSuccess()&&(0,We.iK)(u.oDm,null),J.A.sharingEncInitInstance.setSocketSuccess(!1);else if(t.status==M.f9)Y.A.add_monitor2("SCFOK");else if(t.status==M.Xk)Y.A.add_monitor("SCFF"+t.format);else if(t.status==M.bq)J.A.mediaSDKHandle.Process_Sharing();else if(t.status==M.hA)J.A.mediaSDKHandle.Process_Sharing();else if(t.status===M.HL){var i;null===(i=J.A.mediaSDKHandle)||void 0===i||i.onSharingSizeChange(t),J.A.Notify_APPUI(u.HL3,{width:t.width,height:t.height})}else{if(t.status==M.vr)return void Y.A.send_monitor_directly(t.data);if(t.status==M.wQ){let e=J.A.localSharingEncMGR.map.get(J.A.SPECIAL_ID);Ut(t.url,e)}else if(t.status===u.oUP){const e=nt({encoding:!0},t.data);J.A.Notify_APPUI_SAFE(u.oUP,e)}else t.status==M.ef?Y.A.send_monitor_directly(t.data):t.status==M.Bi?Y.A.add_monitor("SE"+t.data):t.status==M.aY?J.A.Notify_APPUI(u.BgG,{canvasId:t.canvasId,replaceCanvas:!!t.replaceCanvas}):t.status==M.D1?J.A.Notify_APPUI(u.ekh,{data:t.data}):"WFMO"==t.status?Bt(Q._c.SHARING_ENCODE):t.status==M.hd?((0,We.iK)(u.bes,M.hd),H.Ay.error("Health Check Failed: ".concat(M.hd,", ").concat(t.videoType,",").concat(t.subforme,",").concat(t.hasRTPPackets))):t.status==M.jA?J.A.SEMTimes++<2&&(pt(Q._c.SHARING_ENCODE+" Memory Allocate Failed"),Y.A.add_monitor("SEMAF"),(0,We.iK)(u.a1o)):t.status==M.uL?J.A.mediaSDKHandle.onAnnotationPdu(t.data):t.status==M.V_?(0,We.iK)(u.AoB,t.where):ht(Q._c.SHARING_ENCODE,e)}}catch(e){H.Ay.error("Error in SharingEnc_Listener",e)}}function Nt(e){var t,i=e.data,r=!0;try{if("NewActiveSpeakerFirstframeCallback"===i.status)J.A.Notify_APPUI(u.N6$,{ssrc:i.ssrc});else if(i.status===M.Rk)J.A.Notify_APPUI(u.XDu,{width:i.width,height:i.height});else if(i.status===M.LG){let e=J.A.mediaSDKHandle.videoDecodeFrameBackSABRingBufferConsumer;e&&e.consumeAll(J.A.mediaSDKHandle.bVideoDecodeFrameBackSABRingBufferConsumeCopyData)}else if(i.status===M.Zc)Y.A.add_monitor2(i.data);else if(i.status==M.aY)Y.A.add_monitor("MWGLF"),J.A.Notify_APPUI(u.BgG,{canvasId:i.canvasId,replaceCanvas:!!i.replaceCanvas});else if(i.status==M.kD)Y.A.add_monitor("MWGRF");else if(i.status==M.V_)Y.A.add_monitor("MWCGLF"),(0,We.iK)(u.AoB,i.where);else if(0===i.status)ri(i.video_ssrc,i.data,i.video_timestamp,i.video_width,i.video_height,i.rendering_x,i.rendering_y,i.rendering_w,i.rendering_h,i.rotation,i.yuv_limited);else if(i.status===M.lN)Y.A.add_monitor("VDWS"),J.A.isVideoDecodeWASMOK=!0,J.A.videoDecInitInstance.setWasmSuccess(),J.A.isPreviewMode.videoDecode&&J.A.Notify_APPUI_SAFE(u.rje);else if(i.status===M.Fb){let e=i.size;J.A.Notify_APPUI(u.Ya9,{ssrc:i.ssrc,size:e}),Y.A.add_monitor("VDMS:"+e)}else if(i.status===M.Gg)Y.A.add_monitor("VDWF",i.data),pt("VDWF"),J.A.videoDecInitInstance.setWasmSuccess(!1);else if(i.status===M.iU)Y.A.add_monitor("VDHS"),J.A.videoDecInitInstance.setHanderSuccess();else if(i.status===M.oU)Y.A.add_monitor("VDHF"),J.A.videoDecInitInstance.setHanderSuccess(!1);else if(i.status===M.s6)J.A.videoDecInitInstance.setSocketSuccess(),Y.A.add_monitor("VDSS");else if(i.status===M.HX)Y.A.add_monitor("VDSF"),J.A.videoDecInitInstance.isSocketInitSuccess()&&(0,We.iK)(u.oDm,null),J.A.videoDecInitInstance.setSocketSuccess(!1);else if(i.status===M.Ub)Y.A.add_monitor("VDWPS");else if(i.status===M.Y)Y.A.add_monitor("VDWPCLOSE"),wt(Q.wd.ZOOM_CONNECTION_VIDEO,Q.oB.NET_WEBTRANSPORT);else if(i.status===M.UG)Y.A.add_monitor("VDWSCLOSE");else if(i.status===M.xQ)Y.A.add_monitor("VDTTP:"+i.type);else if(i.status==M.vr)Y.A.send_monitor_directly(i.data),r=!1;else if(i.status==M.ef)r=!1,J.A.sendMessageToRwg(u.yGo,{evt:u.UFw,seq:1,body:{data:i.data}});else if(i.status==M.wQ){let e=J.A.localVideoDecMGR.map.get(J.A.SPECIAL_ID);Ut(i.url,e,Q._c.VIDEO_DECODE),r=!1}else if(i.status==M.Bi)r=!1,Y.A.add_monitor("VD"+i.data);else if(i.status===M.T)J.A.Notify_APPUI_SAFE(u.TaW,i.data);else if(i.status===M.$x)J.A.Notify_APPUI_SAFE(u.$xb,i.data);else if(i.status===u.PgM){const e=nt({encoding:!1},i.data);J.A.Notify_APPUI_SAFE(u.PgM,e)}else"FIRST_VIDEO_FRAME"===i.status?(J.A.Notify_APPUI_SAFE(u.Vtx),Y.A.add_monitor("FVF")):i.status===M.Ah?J.A.Notify_APPUI_SAFE(u.Ah8,{isUplink:i.isUplink,networkLevel:i.networkLevel,bwLevel:i.bwLevel}):"WFMO"==i.status?(r=!1,Bt(Q._c.VIDEO_DECODE)):i.status==M.x8?r=!0:i.status==M.jA?(r=!1,J.A.VDMTimes++<2&&(pt(Q._c.VIDEO_DECODE+" Memory Allocate Failed"),Y.A.add_monitor("VDMAF"),(0,We.iK)(u.a1o))):i.status==M.H4?fr(i.data):(i.status==M.AC&&(r=!1),ht(Q._c.VIDEO_DECODE,e))}catch(e){H.Ay.error("Error in VideoDec_Listener",e)}r&&null!==(t=J.A.mediaSDKHandle)&&void 0!==t&&t.isSupportVideoShare&&xt(e)}function Lt(e){var t,i=e.data,r=!0;if(i!==M.$E){try{if("VBPredictDone"===i.status)Y.A.add_monitor("VBPOK"+i.predictCostTime),J.A.isPreviewMode.videoEncode&&_t.enqueueMessage({name:_t.nameMap.INIT_VIDEO_ENCODE_SUCCESS,messageParams:[u.UsF,null],direction:_t.direction.SDK_TO_APP}),J.A.Notify_APPUI(u.UsF,null);else if("VBPredictAbout3s"===i.status)Y.A.add_monitor("VBP3S"),J.A.Notify_APPUI(u.eJx,null);else if("VBPredictAbout10s"===i.status)Y.A.add_monitor("VBP10S"),J.A.Notify_APPUI(u.IkA,null);else if("vbInitializeFailed"===i.status)H.Ay.error("VB tensorflow backend initialize failed"),Y.A.add_monitor("VBBEF"),J.A.Notify_APPUI(u.KqK,ot.FAIL);else if(0===i.status);else if(i.status===M.dh||i.status===M.lN)Y.A.add_monitor("VEWS"),J.A.isVideoEncodeWASMOK=!0,J.A.videoInitInstance.setWasmSuccess();else if(i.status===M.Ke)Y.A.add_monitor("VEWF",i.data),pt("VEWF"),J.A.videoInitInstance.setWasmSuccess(!1);else if(i.status===M.l6||M.iU===i.status)Y.A.add_monitor("VEHS"),J.A.videoInitInstance.setHanderSuccess();else if(i.status===M.uP||M.oU===i.status)Y.A.add_monitor("VEHF"),J.A.videoInitInstance.setHanderSuccess(!1);else if(M.s6===i.status)Y.A.add_monitor("VESS"),J.A.videoInitInstance.setSocketSuccess();else if(i.status===M.HX)Y.A.add_monitor("VESF"),J.A.videoInitInstance.isSocketInitSuccess()&&(0,We.iK)(u.oDm,null),J.A.videoInitInstance.setSocketSuccess(!1);else if(i.status===M.Ub)Y.A.add_monitor("VEWPS");else if(i.status===M.Y)Y.A.add_monitor("VEWPCLOSE");else if(i.status===M.UG)Y.A.add_monitor("VEWSCLOSE");else if(i.status===M.xQ)Y.A.add_monitor("VETTP:"+i.type);else if(i.status===M.Cm)Y.A.add_monitor("VEHORS:"+i.type);else if(i.status===M.bq)J.A.mediaSDKHandle.Process_Video();else if(i.status===M.Sh)J.A.Notify_APPUI(u.Shw,{width:i.width,height:i.height});else if(i.status===M.vP)Y.A.add_monitor("VCRC"+i.width),J.A.mediaSDKHandle.Change_Video_Capture_Resolution(i.width,i.height);else if(i.status==M.sY)Y.A.add_monitor2("VCFOK");else if(i.status==M.YS)Y.A.add_monitor("VCFF","format: ".concat(i.format));else{if(i.status==M.vr)return r=!1,void Y.A.send_monitor_directly(i.data);if(i.status==M.ef)r=!1,Y.A.send_monitor_directly(i.data);else if(i.status===M.wQ){let e=J.A.localVideoEncMGR.map.get(J.A.SPECIAL_ID);Ut(i.url,e,Q._c.VIDEO_ENCODE),r=!1}else if(i.status==M.Bi)r=!1,Y.A.add_monitor("VE"+i.data);else if(i.status==M.ty){let e=J.A.SPECIAL_ID;if(J.A.localVideoDecMGR){var a=J.A.localVideoDecMGR.map.get(e);a&&a.postMessage({command:"encodedimagebitmapwasmptr",data:i.data,wasmMemory:i.wasmMemory})}else J.A.isPreviewMode.videoEncode&&_t.enqueueMessage({name:_t.nameMap.INIT_VIDEO_DECODE_SUCCESS,messageParams:[Q._c.VIDEO_DECODE,{command:"encodedimagebitmapwasmptr",data:i.data,wasmMemory:i.wasmMemory}],direction:_t.direction.SDK_TO_WORKER})}else if(i.status===u.PgM){const e=nt({encoding:!0},i.data);J.A.Notify_APPUI_SAFE(u.PgM,e)}else if(i.status===u.oUP){const e=nt({encoding:!0},i.data);J.A.Notify_APPUI_SAFE(u.oUP,e)}else if(i.status==M.aY)Y.A.add_monitor("MWGLF"),J.A.Notify_APPUI(u.BgG,{canvasId:i.canvasId,replaceCanvas:!!i.replaceCanvas});else if(i.status==M.kD)Y.A.add_monitor("MWGRF");else if(i.status===M.Xg)J.A.mediaSDKHandle.init_Notify_APPUI(!0,Q._c.VIDEO_ENCODE);else if(i.status===M.Ah)J.A.Notify_APPUI_SAFE(u.Ah8,{isUplink:i.isUplink,networkLevel:i.networkLevel,bwLevel:i.bwLevel});else if("WFMO"==i.status)r=!1,Bt(Q._c.VIDEO_ENCODE);else if(i.status==M.AP)(0,We.iK)(u.bes,M.AP),H.Ay.error("Health Check Failed: ".concat(M.AP,", ").concat(i.videoType,",").concat(i.subforme,",").concat(i.hasRTPPackets));else if(i.status===u.msu){const{frame:e}=i,{frameSent:t,frameReceived:r}=J.A;J.A.extVBPort&&t===r?(J.A.extVBPort.postMessage({type:u.Abc,frame:e}),J.A.frameSent++):Y.A.add_monitor("EVBOF-".concat(t-r)),e.close()}else i.status==M.x8?r=!0:i.status==M.jA?(r=!1,J.A.VEMTimes++<2&&(pt(Q._c.VIDEO_ENCODE+" Memory Allocate Failed"),Y.A.add_monitor("VEMAF"),(0,We.iK)(u.a1o))):i.status==M.H4?fr(i.data):i.status==M.V_?(0,We.iK)(u.AoB,i.where):(i.status==M.AC&&(r=!1),ht(Q._c.VIDEO_ENCODE,e))}}catch(e){H.Ay.error("Error in VideoEnc_Listener",e)}r&&null!==(t=J.A.mediaSDKHandle)&&void 0!==t&&t.isSupportVideoShare&&Vt(e)}}function Wt(e,t){let i;try{i=new WebAssembly.Memory({initial:e,maximum:t,shared:!0})}catch(e){H.Ay.error("E:H Allocate WasmMemory Failed",e),(0,We.iK)(u.a1o)}return i}function Bt(e){let t,i,r=!1,a=F.Ay.isIphoneOrIpadBrowser()||F.Ay.isIpadOS()?4096:8192,n=J.A.mediaSDKHandle.is32bitbrowser||!F.Ay.isChromeVersionHigherThan(90)||F.Ay.isChromeOS();var s;if(e==Q._c.VIDEO_ENCODE)i=J.A.localVideoEncMGR.map.get(0),J.A.VE?(r=!0,t=J.A.VE):(null!==(s=J.A.mediaSDKHandle)&&void 0!==s&&s.isSupportVideoShare&&(a=32e3),t=Wt(1024,a),n&&(J.A.VE=t)),J.A.localVideoPara&&(J.A.localVideoPara.VE=t);else if(e==Q._c.VIDEO_DECODE){var o;i=J.A.localVideoDecMGR.map.get(0),J.A.VD?(r=!0,t=J.A.VD):(null!==(o=J.A.mediaSDKHandle)&&void 0!==o&&o.isSupportVideoShare&&(a=16384),t=Wt(1024,a),n&&(J.A.VD=t)),J.A.localVideoPara&&(J.A.localVideoPara.VD=t)}else e==Q._c.SHARING_ENCODE?(i=J.A.localSharingEncMGR.map.get(0),J.A.SE?(r=!0,t=J.A.SE):(t=Wt(1024,a),n&&(J.A.SE=t)),J.A.localVideoPara&&(J.A.localVideoPara.SE=t)):e==Q._c.SHARING_DECODE&&(i=J.A.localSharingDecMGR.map.get(0),J.A.SD?(r=!0,t=J.A.SD):(t=Wt(1024,a),n&&(J.A.SD=t)),J.A.localVideoPara&&(J.A.localVideoPara.SD=t));r&&new Uint8Array(t.buffer).fill(0),i.postMessage({command:"wasmMemory",data:t})}function Ut(e,t,i){F.Ay.downloadAndCompileWebAssembly(e,i,Y.A,!F.Ay.browser.isSafari&&J.A.enableStreamingInstantiate).then((e=>{t.postMessage({command:"DOWNLOAD_WASM_FROM_MAIN_THREAD_OK",data:e})})).catch((e=>{t.postMessage({command:"DOWNLOAD_WASM_FROM_MAIN_THREAD_FAILED"})}))}const Ft=function(){let e={send:null,recv:null,decrpt:null},t=null,i=/(WCL_MCM_AUDIO.*?)(\{\[SPEECHINPUT_R16\]\}),(.*?),(.*?),(.*?),(.*?),(\{\[SEND\]\}.*?)(\{\[DENOISE\]\}.*?)\{\[CAPTURE\]\},(.*?),(\{\[AEC\]\},.*?),(\{\[END\]\})/,r=/(WCL_MCM_AUDIO.*?)(\{\[SPEECHOUTPUT_R16\]\},)(.*?),(\{\[NETWORK\]\}.*?)(\{\[RECEIVE\]\}.*?)\{\[RENDER\]\},(.*?),(.*?)(\{\[END\]\})/,a=/WCL_MCM_AUDIO_RECEIVE,(.*?)$/;return{push(i){let{log:r,logSource:a}=i;if(r&&this._isLogValid(r)){if(this._checkNeedReportImmediate(r,a))return 3===a?this._sendWebRTCLog(r):this._report(r);if(a===C)e.send=r;else if(a===b){if(r.includes("WCL_MCM_AUDIO_RECEIVE"))return void(e.decrpt=r);e.recv=r}else e.recv=r;this._clearTImer(),t=setTimeout(this._checkNeedReport.bind(this),2e3)}},_isLogValid:e=>!!(e.match("WCL_MCM_AUDIO")||e.match("JITTER")||e.match("DEVICE")||e.match("ORIGINAL_SOUND")||e.match("AUDIO_CODEC_EVENT")||e.match("AUDIOEVENT")||e.match("AUDIO_DEVICE_VOLUME")),_checkNeedReportImmediate:(e,t)=>3===t||!(e.match("SPEECHOUTPUT_R16")||e.match("SPEECHINPUT_R16")||e.match("WCL_MCM_AUDIO_RECEIVE")),_checkNeedReport(){const e=this._generateLog();e&&this._report(e)},_sendWebRTCLog(e){const{denoise:t,captureCounter:i}=this._parseSend(e);this._report("WCL_AB,"+t+"{[CAPTURTE]},"+i+",{[END]}")},_generateLog(){if(!e.send&&!e.recv)return null;const{inputputPrefix:t,speechInStr:i,speechInOutStr:r,denoiseInStr:a,denoiseOutStr:n,send:s,denoise:o,captureCounter:d,aec:c}=this._parseSend(e.send),{outputPrefix:u,speechOutStr:h,network:l,renderCounter:p,others:f}=this._parseRecv(e.recv),g=this._parseDecrpt(e.decrpt);this.recordEchoLog(c);const m=t||u,v="{[SPEECH_R16]},".concat(i,",").concat(r,",").concat(h,",").concat(a,",").concat(n,",").concat(c,",").concat(l,"{[RECEIVE]}").concat(g,",").concat(f,"{[PROCESS]},").concat(d,",").concat(p,",").concat(s).concat(o,"{[END]}");return"".concat(m).concat(v)},recordEchoLog(e){let t=e.match(/-?\d+/g);t&&(parseInt(t[0])||parseInt(t[1]))&&H.Ay.directReport("echo captured: "+t[0]+": "+t[1])},_parseSend(e){const t=i.exec(e||"")||[];return{inputputPrefix:t[1]||"",speechInStr:t[3]||"",speechInOutStr:t[4]||"",denoiseInStr:t[5]||"",denoiseOutStr:t[6]||"",send:t[7]||"",denoise:t[8]||"",captureCounter:t[9]||"",aec:t[10]||""}},_parseRecv(e){const t=r.exec(e||"")||[];return{outputPrefix:t[1]||"",speechOutStr:t[3]||"",network:t[4]||"",receive:t[5]||"",renderCounter:t[6]||"",others:t[7]||""}},_parseDecrpt:e=>(a.exec(e||"")||[])[1]||"",_report(e){e&&J.A.sendMessageToRwg(u.yGo,{evt:u.UFw,seq:1,body:{data:e}})},_clearTImer(){clearTimeout(t),t=null},clear(){e={send:null,recv:null},this._clearTImer()}}}();function Gt(e){var t=e.data;try{if(0===t.status)t.time?J.A.AudioNode&&J.A.AudioNode.postData("data",{ssrc:J.A.CurrentSSRC,data:t.data,time:t.time}):J.A.AudioNode&&J.A.AudioNode.postData("data",{ssrc:J.A.CurrentSSRC,data:t.data,time:null});else if(t.status===M.c||t.status===M.ex)Y.A.add_monitor("ADWS"),J.A.isAudioDecodeWASMOK=!0,J.A.audioDecInitInstance.setWasmSuccess(),J.A.isPreviewMode.audioDecode&&J.A.Notify_APPUI_SAFE(u.CXV);else if(t.status===M.v7)Y.A.add_monitor("ADWF",t.data),pt("ADWF"),J.A.audioDecInitInstance.setWasmSuccess(!1);else if(t.status===M.my)Y.A.add_monitor("ADHS"),J.A.audioDecInitInstance.setHanderSuccess();else if(t.status===M.Jj)Y.A.add_monitor("ADHF"),J.A.audioDecInitInstance.setHanderSuccess(!1);else if(t.status===M.Jw)Y.A.add_monitor("ADSS"),J.A.audioDecInitInstance.setSocketSuccess();else if(t.status===M.s8)Y.A.add_monitor("ADSF"),J.A.audioDecInitInstance.isSocketInitSuccess()&&(0,We.iK)(u.bo2,null),J.A.audioDecInitInstance.setSocketSuccess(!1);else if(t.status===M.Ub)Y.A.add_monitor("ADWPS");else if(t.status===M.Y)Y.A.add_monitor("ADWPCLOSE"),wt(Q.wd.ZOOM_CONNECTION_AUDIO,Q.oB.NET_WEBTRANSPORT);else if(t.status===M.UG)Y.A.add_monitor("ADWSCLOSE");else if(t.status===M.xQ)Y.A.add_monitor("ADTTP:"+t.type);else if(t.status==M.vr)Y.A.send_monitor_directly(t.data);else if(t.status===M.wQ){let e=J.A.localAudioDecMGR.map.get(J.A.SPECIAL_ID);Ut(t.url,e,Q._c.AUDIO_DECODE)}else if(t.status==M.Bi)Y.A.add_monitor("AD"+t.data);else if(t.status==M.uf)t.at&&J.A.CurrentSSRCTime!==t.at&&(J.A.CurrentSSRCTime=t.at,J.A.audioPlayTime=Date.now()),t.st&&J.A.mediaSDKHandle.SharingRenderObj&&J.A.mediaSDKHandle.SharingRenderObj.SetcATimeStamp(t.st);else if("multiCurrentTime"==t.status){if(J.A.localVideoDecMGR){var i=J.A.localVideoDecMGR.map.get(J.A.SPECIAL_ID);i&&i.postMessage({command:"audioDecodeTime",data:t.data,status:1})}}else if(t.status==M.Xd);else if(t.status===M.b5)Ft.push({log:t.data,logSource:b});else if(t.status===u.iQY){const e=nt({encoding:!1},t.data);J.A.Notify_APPUI_SAFE(u.iQY,e)}else t.status===M.Jo?J.A.Notify_APPUI_SAFE(u.Joy,{isUplink:t.isUplink,networkLevel:t.networkLevel,bwLevel:t.bwLevel}):ht(Q._c.AUDIO_DECODE,e)}catch(e){H.Ay.error("Error in AudioDecodeListener",e)}}function Ht(e){if(J.A.localAudioDecMGR||J.A.isPreviewMode.audioEncode)try{let r=e.data;if(r.status===M.sv);else if(0==r.status){var t=J.A.SPECIAL_ID,i=J.A.localAudioDecMGR.map.get(t);i&&i.postMessage({command:"EncodedAudioFrame",data:r.data},[r.data.buffer])}else if(r.status==M.Xd);else if(r.status===M.c||r.status===M.ex)Y.A.add_monitor("AEWS"),J.A.isAudioEncodeWASMOK=!0,J.A.audioEncodeInitInstance.setWasmSuccess();else if(r.status===M.Pp||r.status===M.v7)Y.A.add_monitor("AEWF",r.data),pt("AEWF"),J.A.audioEncodeInitInstance.setWasmSuccess(!1);else if(r.status===M.my)Y.A.add_monitor("AEHS"),J.A.audioEncodeInitInstance.setHanderSuccess();else if(r.status===M.Jw)Y.A.add_monitor("AESS"),J.A.audioEncodeInitInstance.setSocketSuccess();else if(r.status===M.s8)Y.A.add_monitor("AESF"),J.A.audioEncodeInitInstance.isSocketInitSuccess()&&(0,We.iK)(u.bo2,null),J.A.audioEncodeInitInstance.setSocketSuccess(!1);else if(r.status===M.Jj)Y.A.add_monitor("AEHF"),J.A.audioEncodeInitInstance.setHanderSuccess(!1);else if(r.status===M.TK)J.A.Notify_APPUI_SAFE(M.TK,null);else if(r.status===M.Ub)Y.A.add_monitor("AEWPS");else if(r.status===M.Y)Y.A.add_monitor("AEWPCLOSE");else if(r.status===M.UG)Y.A.add_monitor("AEWSCLOSE");else if(r.status===M.xQ)Y.A.add_monitor("AETTP:"+r.type);else if(r.status===M.Rw)J.A.indexDbObject.put(r.delay,"delay"),J.A.openIndexFlag&&J.A.indexDbObject.select("delay");else if(r.status===M.wQ){let e=J.A.localAudioEncMGR.map.get(J.A.SPECIAL_ID);Ut(r.url,e,Q._c.AUDIO_ENCODE)}else if(r.status==M.Bi)Y.A.add_monitor("AE"+r.data);else if(r.status==M.M9);else if(r.status===M.b5)Ft.push({log:r.data,logSource:C});else if(r.status===u.iQY){const e=nt({encoding:!0},r.data);J.A.Notify_APPUI_SAFE(u.iQY,e)}else r.status===M.YQ?J.A.mediaSDKHandle.init_Notify_APPUI(!0,Q._c.AUDIO_ENCODE):r.status===u.AV$?J.A.Notify_APPUI_SAFE(u.AV$):r.status===u._9I?J.A.Notify_APPUI_SAFE(u._9I,{value:r.value}):r.status===M.Jo?J.A.Notify_APPUI_SAFE(u.Joy,{isUplink:r.isUplink,networkLevel:r.networkLevel,bwLevel:r.bwLevel}):r.status==M.NO?((0,We.iK)(u.bes,M.NO),H.Ay.error("Health Check Failed: ".concat(M.NO,", ").concat(r.videoType,",").concat(r.subforme,",").concat(r.hasRTPPackets))):ht(Q._c.AUDIO_ENCODE,e)}catch(e){H.Ay.error("Error in AudioEnc_Listener",e)}}async function jt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:48e3;const t=F.Ay.browser.isSafari&&F.Ay.getMacSafariMajorVersion()<16;if(!J.A.sharedBuffer&&F.Ay.isSupportSharedArrayBuffer()&&!t){st("LP2PSP");let t=1;(F.Ay.browser.isFirefox||48e3===F.Ay.getAudioContextConfigure().sampleRate)&&(t=48);let i=640;i=F.Ay.isChromeVersionHigherThan(74)?960:e/100*2;let r=F.Ay.isBrowserSupportStereo()?2:1,a=F.Ay.isSupportPlayStereo()?2:1,n=F.Ay.isSupportSharingStereo()?2:1;J.A.sharedBuffer={inputState:new SharedArrayBuffer(24),inputBuffer:new SharedArrayBuffer(t*i*4*4*r),sharingInputState:new SharedArrayBuffer(24),sharingInputBuffer:new SharedArrayBuffer(t*i*4*4*n),outputState:new SharedArrayBuffer(24),outputBuffer:new SharedArrayBuffer(t*i*4*4*2),rtpBuffer:new SharedArrayBuffer(120008),echoState:J.A.enableEchoDetection?new SharedArrayBuffer(24):void 0,echoBuffer:J.A.enableEchoDetection?new SharedArrayBuffer(t*i*4*4*a):void 0}}Y.A.add_monitor("INITSAB"+!!J.A.sharedBuffer),J.A.decoderinworklet=J.A.decoderinworkletOP&&!!J.A.sharedBuffer}function Kt(e,t){var i;J.A.localSharingPara?Object.assign(J.A.localSharingPara,t):J.A.localSharingPara=t,i=e,J.A.Sharing_WebSocket_Ip_Address=i}function qt(e,t){J.A.localAudioPara?Object.assign(J.A.localAudioPara,t):J.A.localAudioPara=t,Xt(e)}function zt(e,t){J.A.localVideoPara?Object.assign(J.A.localVideoPara,t):J.A.localVideoPara=t,Qt(e)}function Xt(e){J.A.Audio_WebSocket_Ip_Address=e}function Yt(e){J.A.Audio_Web_Transport_Ip_Address=e}function Qt(e){J.A.Video_WebSocket_Ip_Address=e}function Jt(e){J.A.Video_Web_Transport_Ip_Address=e}function Zt(){!function(e){if(e=J.A.SPECIAL_ID,J.A.localAudioEncMGR){var t=J.A.localAudioEncMGR.map.get(e);t&&(t.postMessage({command:te}),J.A.localAudioEncMGR.map.delete(e)),J.A.audioEncodeSession=null}}(J.A.SPECIAL_ID),function(e){if(e=J.A.SPECIAL_ID,J.A.localAudioDecMGR){var t=J.A.localAudioDecMGR.map.get(J.A.SPECIAL_ID);t&&(t.postMessage({command:te}),J.A.localAudioDecMGR.map.delete(e)),J.A.audioDecodeSession=null}}(J.A.SPECIAL_ID),J.A.localAudioDecMGR=null,J.A.localAudioEncMGR=null}function $t(){!function(e){if(e=J.A.SPECIAL_ID,J.A.localVideoDecMGR){var t=J.A.localVideoDecMGR.map.get(e);t&&(t.postMessage({command:te}),J.A.localVideoDecMGR.map.delete(e)),J.A.videoDecodeSession=null}}(J.A.SPECIAL_ID),J.A.localVideoDecMGR=null,J.A.localVideoEncMGR=null}function ei(){!function(){var e=J.A.SPECIAL_ID;if(J.A.localSharingDecMGR){var t=J.A.localSharingDecMGR.Get(e);t&&(t.postMessage({command:te}),J.A.localSharingDecMGR=null),J.A.isSharingDecodeThreadStart=!1}}()}function ti(e,t,i,r,a){if(J.A.localVideoEncMGR){var n=J.A.localVideoEncMGR.map.get(e);if(n){var s={command:"encodeVideoFrame",data:t,stride:i,x:r,y:a};n.postMessage(s,[s.data.buffer])}}}function ii(e,t,i,r,a,n){var s,o;if(o=null!==(s=J.A.mediaSDKHandle)&&void 0!==s&&s.isSupportVideoShare?J.A.localVideoEncMGR.map.get(e):J.A.localSharingEncMGR.map.get(e)){let e;t?(e={command:"encodeSharingFrame",data:t,width:a,height:n},o.postMessage(e,[e.data.buffer])):(e={command:"encodeSharingFrame"},o.postMessage(e))}}function ri(e,t,i,r,a,n,s,o,d,c,u){if(J.A.isVideoPlayWork){var h={yuvdata:t,ntptime:i,ssrc:e,width:r,height:a,r_x:n,r_y:s,r_w:o,r_h:d,rotation:c,yuv_limited:u};h.ssrc=h.ssrc>>10<<10,J.A.mediaSDKHandle.VideoRenderObj.Put_Video_Data_Queue(h,15)}}function ai(){return J.A.localSharingDecMGR?J.A.localSharingDecMGR.SharingQueueMGR.ClearQueue():J.A.localMouseDecMGR?J.A.localMouseDecMGR.SharingQueueMGR.ClearQueue():0}async function ni(e,t,i,r){J.A.isVideoDecodeThreadStart||(J.A.isVideoDecodeThreadStart=!0,await ut(r,J.A.localVideoDecMGR,Nt,Q._c.VIDEO_DECODE,i))}async function si(e,t,i,r){if(Y.A.add_monitor("AADT"),i&&i.isDestroy)return Y.A.add_monitor("ZID"),st("WorkerType:audioDec;The relative SDK instance is destroy, don't start relative worker, avoid multiple same workers. ");J.A.isAudioDecodeThreadStart||(J.A.isAudioDecodeThreadStart=!0,await ut(r,J.A.localAudioDecMGR,Gt,Q._c.AUDIO_DECODE,i))}function oi(e){if(e>>=10,J.A.localAudioDecMGR){var t=J.A.localAudioDecMGR.GetSSRCTimeMap(e);return null===t?0:t}}function di(e){return{currentSSRCTime:J.A.CurrentSSRCTime,audioPlayTime:J.A.audioPlayTime}}function ci(e,t){var i=J.A.SPECIAL_ID,r=J.A.localVideoDecMGR.map.get(i);r.postMessage({command:"failover",websocket_ip_address:t}),(r=J.A.localAudioDecMGR.map.get(i)).postMessage({command:"failover",websocket_ip_address:e})}function ui(e){for(var t,i=J.A.SPECIAL_ID,r=J.A.audio_pcm_queue.dequeue();r;)r=J.A.audio_pcm_queue.dequeue();J.A.localAudioEncMGR&&(t=J.A.localAudioEncMGR.map.get(i))&&J.A.audioEncodeSession&&t.postMessage({command:"modifySampleRate",sampleRate:e}),J.A.localAudioDecMGR&&(t=J.A.localAudioDecMGR.map.get(i))&&J.A.audioDecodeSession&&t.postMessage({command:"modifySampleRate",sampleRate:e})}function hi(e,t,i){var r;e=J.A.SPECIAL_ID,J.A.localAudioDecMGR&&(r=J.A.localAudioDecMGR.map.get(e))&&r.postMessage({command:"mute",bOn:t,fakeLeave:i}),J.A.localAudioEncMGR&&(r=J.A.localAudioEncMGR.map.get(e))&&r.postMessage({command:"mute",bOn:t,fakeLeave:i})}function li(e,t){var i;e=J.A.SPECIAL_ID,J.A.localAudioDecMGR&&(i=J.A.localAudioDecMGR.map.get(e))&&i.postMessage({command:"AecFlag",flag:t}),J.A.localAudioEncMGR&&(i=J.A.localAudioEncMGR.map.get(e))&&i.postMessage({command:"AecFlag",flag:t})}function pi(e,t,i,r){var a,n=J.A.SPECIAL_ID;J.A.localAudioDecMGR&&(a=J.A.localAudioDecMGR.map.get(n))&&a.postMessage({command:i},[e.port2]),J.A.localAudioEncMGR&&(a=J.A.localAudioEncMGR.map.get(n))&&a.postMessage({command:r},[t.port1])}function fi(e,t){var i=J.A.SPECIAL_ID;if(J.A.localVideoDecMGR){let t=J.A.localVideoDecMGR.map.get(i);t&&t.postMessage({command:"decodeVideoPort"},[e.port1])}if(J.A.localVideoEncMGR){let e=J.A.localVideoEncMGR.map.get(i);e&&e.postMessage({command:"encodeVideoPort"},[t.port2])}}function gi(e,t){var i=J.A.SPECIAL_ID;if(J.A.localVideoDecMGR){let t=J.A.localVideoDecMGR.map.get(i);t&&t.postMessage({command:"vsport"},[e.port1])}if(J.A.localSharingDecMGR){let e=J.A.localSharingDecMGR.map.get(i);e&&e.postMessage({command:"vsport"},[t.port2])}}function mi(e){var t=J.A.SPECIAL_ID;if(J.A.localAudioDecMGR){var i=J.A.localAudioDecMGR.map.get(t);i&&i.postMessage({command:"decodeAudioPort2"},[e.port2])}}function vi(e){var t=J.A.SPECIAL_ID;if(J.A.localAudioEncMGR){var i=J.A.localAudioEncMGR.map.get(t);i&&i.postMessage({command:"shareAudioDecodeAudioPort2"},[e.port2])}}function Ai(e){var t=J.A.SPECIAL_ID;if(J.A.localVideoDecMGR){var i=J.A.localVideoDecMGR.map.get(t);i&&i.postMessage({command:"decodeVideoPortWithAudio",port:e.port1},[e.port1])}}function Si(e){var t=J.A.SPECIAL_ID;if(J.A.localVideoEncMGR){var i=J.A.localVideoEncMGR.map.get(t);i&&i.postMessage(e)}}function _i(e,t){yi({command:e,data:t},[t])}function yi(e,t){let i=J.A.SPECIAL_ID;if(!J.A.localVideoEncMGR)return!1;let r=J.A.localVideoEncMGR.map.get(i);return!!r&&(r.postMessage(e,t),!0)}function Ci(e){var t=J.A.SPECIAL_ID;if(J.A.localVideoDecMGR){var i=J.A.localVideoDecMGR.map.get(t);i&&i.postMessage(e)}}function bi(e,t){var i=J.A.SPECIAL_ID;if(J.A.localVideoEncMGR){var r=J.A.localVideoEncMGR.map.get(i);r&&r.postMessage({command:e,data:t},[t])}}function wi(e,t){var i=J.A.SPECIAL_ID;if(J.A.localSharingEncMGR){var r=J.A.localSharingEncMGR.map.get(i);r&&r.postMessage({command:e,data:t},[t])}}function Ei(e){if(J.A.localVideoDecMGR){var t=J.A.localVideoDecMGR.map.get(J.A.SPECIAL_ID);t&&t.postMessage(e)}}function Ri(e){var t=J.A.SPECIAL_ID;if(J.A.localSharingDecMGR){var i=J.A.localSharingDecMGR.map.get(t);i&&i.postMessage(e)}}function Ti(e){var t=J.A.SPECIAL_ID;if(J.A.localAudioDecMGR){var i=J.A.localAudioDecMGR.map.get(t);i&&i.postMessage({command:"updateCurrentSSRC",SSRC:e})}}function Ii(e){var t=J.A.SPECIAL_ID;if(J.A.localAudioEncMGR){var i=J.A.localAudioEncMGR.map.get(t);i&&i.postMessage(e)}}function Mi(e){var t=J.A.SPECIAL_ID;if(J.A.localAudioDecMGR){var i=J.A.localAudioDecMGR.map.get(t);i&&i.postMessage(e)}}function Di(e){var t={command:"interpretation_enable",enable:e};Ii(t),J.A.decoderinworklet?J.A.workletWasmInitSuccess&&J.A.AudioNode?J.A.AudioNode.postCMD("interpretation_enable",t):J.A.workletMessageQueue.enqueue(t):Mi(t)}function Pi(e){Ii({command:"cc_set_lang",lang:e})}function ki(e){var t={command:"interpretation_set_lang",lang:e};Ii(t),J.A.decoderinworklet?J.A.workletWasmInitSuccess&&J.A.AudioNode?J.A.AudioNode.postCMD("interpretation_set_lang",t):J.A.workletMessageQueue.enqueue(t):Mi(t)}function Oi(e){var t={command:"interpretation_mute_origin",mute:e};Ii(t),J.A.decoderinworklet?J.A.workletWasmInitSuccess&&J.A.AudioNode?J.A.AudioNode.postCMD("interpretation_mute_origin",t):J.A.workletMessageQueue.enqueue(t):Mi(t)}function xi(e){var t={command:"interpretation_set_interpreter",interpreterList:e};Ii(t),J.A.decoderinworklet?J.A.workletWasmInitSuccess&&J.A.AudioNode?J.A.AudioNode.postCMD("interpretation_set_interpreter",t):J.A.workletMessageQueue.enqueue(t):Mi(t)}function Vi(){var e=J.A.SPECIAL_ID;if(J.A.localAudioEncMGR){var t=J.A.localAudioEncMGR.map.get(e);t&&t.postMessage({command:"resetAec"})}}function Ni(e){try{if(Y.A&&e){let t=["ERR:",e.message,"f"].join(""),i=Y.A.checkIsNecessaryExceptionLogAndReturnRepeatTimes(t);i.isNecessary?(st("error repeat ".concat(i.repeatNumber),t),Y.A.add_monitor(t+"(repeat:".concat(i.repeatNumber,")"))):st("error but ignore",e.message)}}catch(e){st("_listenWindowErrorEvent error",e)}}function Li(){try{var e,t;Y.A.add_monitor(["BSAGT:",navigator.userAgent].join("")),Y.A.add_monitor("BSLITEND:"+(F.Ay.isLittleEndian()?1:0)),window.navigator.hardwareConcurrency&&Y.A.add_monitor("OSCPUS:"+window.navigator.hardwareConcurrency);let i=F.Ay.getOSInfo();Y.A.add_monitor("deviceType:".concat(i.osType,"|os_name:").concat(i.os,"|os_version:").concat(i.osVersion)),Y.A.add_monitor("browser_name:".concat(null==i||null===(e=i.browser)||void 0===e?void 0:e.name,"|browser_version:").concat(null==i||null===(t=i.browser)||void 0===t?void 0:t.version)),(0,F.jo)()}catch(e){console.error("<<<<",e)}}function Wi(e){Y.A.init(),window.addEventListener("error",Ni),J.A.monitorIntervalHandle=setInterval((function(){if(!Y.A.startSendLog)return;let e=Y.A.get_monitor();e&&Y.A.send_monitor_directly(e)}),1e4)}function Bi(e){Y.A.add_monitor2(e)}function Ui(e){window.removeEventListener("error",Ni),clearInterval(J.A.monitorIntervalHandle),Y.A.send_instant_monitor()}function Fi(e){var t=J.A.SPECIAL_ID;if(J.A.localVideoEncMGR){var i=J.A.localVideoEncMGR.map.get(t);i&&i.postMessage({command:"ENCRYPT",encrypt:e})}}function Gi(e){var t=J.A.SPECIAL_ID;if(J.A.localSharingEncMGR){var i=J.A.localSharingEncMGR.Get(t);i&&i.postMessage({command:"ENCRYPT",encrypt:e})}}function Hi(e){if(J.A.localVideoEncMGR){var t=J.A.localVideoEncMGR.map.get(J.A.SPECIAL_ID);t&&t.postMessage(e)}}function ji(e){if(J.A.localSharingEncMGR){var t=J.A.localSharingEncMGR.map.get(J.A.SPECIAL_ID);t&&t.postMessage(e)}}function Ki(e){if(J.A.localVideoEncMGR){var t=J.A.localVideoEncMGR.map.get(J.A.SPECIAL_ID);t&&t.postMessage(e)}}function qi(e){if(J.A.localSharingEncMGR){var t=J.A.localSharingEncMGR.map.get(J.A.SPECIAL_ID);t&&t.postMessage(e)}}function zi(e){var t=J.A.SPECIAL_ID;if(J.A.localAudioEncMGR){var i=J.A.localAudioEncMGR.map.get(t);i&&i.postMessage({command:"ENCRYPT",encrypt:e})}}function Xi(){let e=J.A.SPECIAL_ID;[J.A.localAudioDecMGR,J.A.localAudioEncMGR,J.A.localVideoDecMGR,J.A.localVideoEncMGR,J.A.localSharingDecMGR,J.A.localSharingEncMGR].forEach((t=>{t&&t.map.get(e)&&t.map.get(e).postMessage({command:"SOCKET_RECONNECT",disable:!0})}))}function Yi(e){e.forEach((e=>{e&&(e.setHanderSuccess(!1),e.setSocketSuccess(!1),e.setWasmSuccess(!1))}))}function Qi(e,t){let i=J.A.SPECIAL_ID;e&&e.forEach((e=>{e&&e.map.get(i)&&(e.map.get(i).onmessage=null)})),t&&t.forEach((e=>{e&&e.map.get(i)&&(e.map.get(i).onmessage=null)}))}async function Ji(e,t,i){let r=J.A.SPECIAL_ID,a=t;a.forEach((t=>{t&&t.map.get(r)&&t.map.get(r).postMessage({command:te,_id:e._id})})),a=i,a.forEach((t=>{t&&t.map.get(r)&&t.map.get(r).postMessage({command:te,_id:e._id})})),await F.Ay.sleep(1e3)}async function Zi(e,t){let i=J.A.SPECIAL_ID,r=e;r.forEach((e=>{e&&e.map.get(i)&&e.map.get(i).terminate()})),r=t,await F.Ay.is32bitChrome()||r.forEach((e=>{e&&e.map.get(i)&&e.map.get(i).terminate()}))}function $i(e){let t;switch(e){case Q._c.AUDIO_DECODE:t=J.A.localAudioDecMGR;break;case Q._c.AUDIO_ENCODE:t=J.A.localAudioEncMGR;break;case Q._c.VIDEO_DECODE:t=J.A.localVideoDecMGR;break;case Q._c.VIDEO_ENCODE:t=J.A.localVideoEncMGR;break;case Q._c.SHARING_DECODE:t=J.A.localSharingDecMGR;break;case Q._c.SHARING_ENCODE:t=J.A.localSharingEncMGR}let i=J.A.SPECIAL_ID;return t&&t.map.get(i)?t.map.get(i):null}async function er(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ie,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];a&&await async function(e){switch(e){case Q._c.VIDEO_ENCODE:await J.A.videoInitInstance.initSuccessPromise;break;case Q._c.VIDEO_DECODE:await J.A.videoDecInitInstance.initSuccessPromise;break;case Q._c.AUDIO_ENCODE:await J.A.audioEncodeInitInstance.initSuccessPromise;break;case Q._c.AUDIO_DECODE:await J.A.audioDecInitInstance.initSuccessPromise;break;case Q._c.SHARING_ENCODE:await J.A.sharingEncInitInstance.initSuccessPromise;break;case Q._c.SHARING_DECODE:await J.A.sharingDecInitInstance.initSuccessPromise;break;default:H.Ay.error("No matched worker type: ".concat(e))}}(e);let n=$i(e);if(!n){if(!a)return st("worker handle not ready, drop!",e,t,i),!1;if(st.warn("worker handle not ready, waiting!",e,t,i),n=$i(e),!n)return}return r?n.postMessage({command:i,data:t},[t]):n.postMessage({command:i,data:t}),!0}function tr(){return null!==$i(Q._c.VIDEO_ENCODE)}function ir(e,t,i){var r=J.A.SPECIAL_ID;if(J.A.localVideoEncMGR){var a=J.A.localVideoEncMGR.map.get(r);a&&(e?a.postMessage({command:t,canvas:e,rendercanvasID:i},[e]):a.postMessage({command:t,canvas:e,rendercanvasID:i}))}}function rr(e){let t;return t=new e({storeOptions:{nameSpaceId:"vbFile"}}),new Promise(((e,i)=>{t.on("ready",(()=>{e(t)}))}))}function ar(e){let t=new Uint8Array(e,0,12),i=new Uint8Array(e,12,32);window.crypto.subtle.importKey("raw",i,"AES-GCM",!0,["encrypt","decrypt"]).then((r=>{let a=t.length+i.length,n=new Uint32Array(e.slice(a,a+4))[0];a+=4;let s=e.slice(a,a+n);a+=n,n=new Uint32Array(e.slice(a,a+4))[0],a+=4;let o=new Uint8Array(e,a,n);a+=n,n=new Uint32Array(e.slice(a,a+4))[0],a+=4;let d=e.slice(a,a+n);a+=n,n=new Uint32Array(e.slice(a,a+4))[0],a+=4;let c=new Uint8Array(e,a,n);J.A.basebin=s,J.A.afnbin=d,nr(c,r,t).then((e=>{J.A.afnjson=(new TextDecoder).decode(e);var t=J.A.SPECIAL_ID;if(J.A.localVideoEncMGR){var i=J.A.localVideoEncMGR.map.get(t);i&&J.A.afnbin&&J.A.afnjson&&i.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:J.A.afnbin,json:J.A.afnjson},index:1})}})),nr(o,r,t).then((e=>{J.A.basejson=(new TextDecoder).decode(e);var t=J.A.SPECIAL_ID;if(J.A.localVideoEncMGR){var i=J.A.localVideoEncMGR.map.get(t);i&&J.A.basebin&&J.A.basejson&&i.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:{bin:J.A.basebin,json:J.A.basejson},index:2})}}))}))}function nr(e,t,i){return window.crypto.subtle.decrypt({name:"AES-GCM",iv:i},t,e)}function sr(e){for(let r=0;r<e.length;r++)if("js"==e[r].type){Y.A.add_monitor("VDTF"),J.A.tfjsurl=e[r].path;var t=J.A.SPECIAL_ID;if(J.A.localVideoEncMGR){var i=J.A.localVideoEncMGR.map.get(t);i&&i.postMessage({command:"DOWNLOAD_JSON_FROM_MAIN_THREAD_OK",data:J.A.tfjsurl,type:"js"})}}else"bin"==e[r].type&&fetch(e[r].path).then((e=>{if(!e.ok)throw new Error("network issue");return e.arrayBuffer()})).then((t=>{Y.A.add_monitor("VDBIN"),J.A.vbarraybuffer=t;try{e[r].path.indexOf("dual")>=0&&ar(t)}catch(e){H.Ay.error("An error occurred when decrypting the virtual background file",e),Y.A.add_monitor("VBDECRYPTF"),J.A.Notify_APPUI(u.KqK,ot.FAIL)}})).catch((e=>{H.Ay.error("An error occurred when trying to obtain the virtual background file",e),Y.A.add_monitor("VBFF"),J.A.Notify_APPUI(u.KqK,ot.FAIL)}))}function or(e,t){var i=J.A.SPECIAL_ID;if(J.A.localVideoEncMGR){var r=J.A.localVideoEncMGR.map.get(i);r&&(e?r.postMessage({command:"maskandbgimagebitmap",imagename:t,data:e},[e]):r.postMessage({command:"maskandbgimagebitmap",imagename:t,data:e}))}}function dr(e,t){var i=J.A.SPECIAL_ID;if(J.A.localVideoEncMGR){var r=J.A.localVideoEncMGR.map.get(i);r&&(e?r.postMessage({command:"vbbgimagebitmap",imagename:t,data:e},[e]):r.postMessage({command:"vbbgimagebitmap",imagename:t,data:e}))}}function cr(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;var n=J.A.SPECIAL_ID;if(J.A.localVideoEncMGR){var s=J.A.localVideoEncMGR.map.get(n);s&&(e?s.postMessage({command:"maskandbgimagebitmap",imagename:t,data:e,maskCoordinate:i,width:r,height:a},[e]):s.postMessage({command:"maskandbgimagebitmap",imagename:t,data:e,maskCoordinate:i,width:r,height:a}))}}function ur(e){var t=J.A.SPECIAL_ID;if(J.A.localVideoDecMGR){var i=J.A.localVideoDecMGR.map.get(t);i&&i.postMessage(e)}}function hr(){try{return F.Ay.browser.isChrome&&-1!==["85","86"].indexOf(F.Ay.getBrowserVersion())}catch(e){return st(e),!1}}const lr={[Q._c.VIDEO_ENCODE]:{success:u.$MS,failed:u.rNn,callbackDataValue:Q.Go.encode},[Q._c.VIDEO_DECODE]:{success:u.$MS,failed:u.rNn,callbackDataValue:Q.Go.decode},[Q._c.AUDIO_ENCODE]:{success:u.epV,failed:u.uiQ,callbackDataValue:Q.Go.encode},[Q._c.AUDIO_DECODE]:{success:u.epV,failed:u.uiQ,callbackDataValue:Q.Go.decode},[Q._c.SHARING_DECODE]:{success:u.Y7X,failed:u.IQ_,callbackDataValue:Q.Go.decode},[Q._c.SHARING_ENCODE]:{success:u.Y7X,failed:u.IQ_,callbackDataValue:Q.Go.encode}};function pr(e,t){let i=[Q._c.AUDIO_ENCODE,Q._c.AUDIO_DECODE,Q._c.VIDEO_ENCODE,Q._c.VIDEO_DECODE];e.isSupportVideoShare||i.push(Q._c.SHARING_ENCODE,Q._c.SHARING_DECODE),i.forEach((async e=>{er(e,t,ae,!1,!0)}))}function fr(e){var t,i,r;let a=F.Ay.getOSInfo();e.cpu=(null===(t=navigator)||void 0===t?void 0:t.hardwareConcurrency)||1,e.deviceType=a.osType,e.osType=a.os;const n=F.Ay.getGpuInfo();e.gpuInfo=null==n?void 0:n.renderInfo,H.Ay.directReport(JSON.stringify(e));let s=null===J.A||void 0===J.A||null===(i=J.A.instance)||void 0===i?void 0:i.persistenceInfo;if(!s)return;let o=e.encode?s.getVideoEncoderInfo():s.getVideoDecoderInfo(),d={};d.osVersion=a.osVersion,d.browserVersion=null===(r=a.browser)||void 0===r?void 0:r.version,d.sdkVersion="10206",o.updateInfo(e,d)}function gr(e,t){var i;const r=[[],[[Q._c.AUDIO_ENCODE],[Q._c.AUDIO_DECODE],[Q._c.AUDIO_ENCODE,Q._c.AUDIO_DECODE]],[[Q._c.VIDEO_ENCODE],[Q._c.VIDEO_DECODE],[Q._c.VIDEO_ENCODE,Q._c.VIDEO_DECODE]],[],[[Q._c.SHARING_ENCODE],[Q._c.SHARING_DECODE],[Q._c.SHARING_ENCODE,Q._c.SHARING_DECODE]]];let a=null===(i=t.body)||void 0===i?void 0:i.data;if(!a)return;let n=a.type,s=a.mode;e.isSupportVideoShare&&4==n&&(n=2);let o=r[n][s];o&&0!=o.length&&o.forEach((e=>{er(e,a,ne,!1,!0)}))}function mr(e,t){let i=null,r=null;return{create:function(){return i||(i=new Promise((async(i,a)=>{try{let a=!J.A.isVDIWebview&&F.Ay.isSupportVideoShareSend()&&await F.Ay.isSDKSupportMultiThread()&&await F.Ay.isSDKSupportSIMD();const n=await fetch(e),s=await n.arrayBuffer(),o=c().createObjectURL(new Blob([s]));let d=new Worker(o,t?{name:t}:void 0);r=d,d.onmessage=e=>{d.onmessage=null,e.data[0]||(r.terminate(),r=null),i(r)},d.postMessage({command:se,data:a})}catch(e){i(null)}})),i)},destroy:function(){if(!r&&!i)return;let e=i;i=null,r=null,e&&e.then((e=>{null==e||e.terminate()}))}}}function vr(e){return $i(e)}function Ar(e){let t=null;switch(e){case Q._c.AUDIO_DECODE:t=J.A.audioDecInitInstance;break;case Q._c.AUDIO_ENCODE:t=J.A.audioEncodeInitInstance;break;case Q._c.VIDEO_DECODE:t=J.A.videoDecInitInstance;break;case Q._c.VIDEO_ENCODE:t=J.A.videoInitInstance;break;case Q._c.SHARING_DECODE:t=J.A.sharingDecInitInstance;break;case Q._c.SHARING_ENCODE:t=J.A.sharingEncInitInstance}return t}let Sr=null;if("function"==typeof AudioWorklet){class e extends AudioWorkletNode{constructor(e,t,i){super(e,t,i),this.port.onmessage=this.handleMessage.bind(this)}handleMessage(e){var t=e.data;switch(t.status){case"delay":J.A.localAudioDecMGR&&(i=J.A.localAudioDecMGR.map.get(0))&&i.postMessage({command:"delay"});break;case M.uf:t.at&&(J.A.CurrentSSRCTime=t.at,J.A.audioPlayTime=Date.now()),t.st&&J.A.mediaSDKHandle.SharingRenderObj&&J.A.mediaSDKHandle.SharingRenderObj.SetcATimeStamp(t.st);break;case M.b5:Ft.push({log:t.data,logSource:2});break;case"MONITOR_LOG":Y.A.add_monitor(t.data);break;case"UPDATE_MULTIVIEW_TIME":var i;J.A.localVideoDecMGR&&(i=J.A.localVideoDecMGR.map.get(0))&&i.postMessage({command:"audioDecodeTime",data:t.data,status:1});break;case"WASM_INIT_SUCCESS":for(Y.A.add_monitor("DIWL"+t.data.audio_handle),J.A.workletWasmInitSuccess=!0;!J.A.workletMessageQueue.isEmpty();){let e=J.A.workletMessageQueue.dequeue();this.postCMD(e.command,e)}break;case"workletMessage":"error"===t.data.level&&H.Ay.error(t.data.message,t.data.data);break;case"WASM_INIT_FAILED":Y.A.add_monitor("AWMAF"),(0,We.iK)(u.a1o);break;case"PROCESS_EXCEPTIONS":(0,We.iK)(u.mxj,t.data)}}postData(e,t){this.port.postMessage({status:e,data:t},[t.data.buffer])}postCMD(e,t){this.port.postMessage({status:e,data:t})}}Sr=e}const _r=Sr;var yr=i(1882),Cr=i.n(yr),br=i(7350),wr=i.n(br),Er=i(8023),Rr=i.n(Er),Tr=i(31),Ir=i.n(Tr);const Mr=(0,G.A)("sdk.remoteControl");function Dr(e){let t=this;this.dom=e.dom,this.socketURL=e.socketURL,this.meetingID=e.meetingID,this.condID=e.condID,this.blobSocket=null;let i=this._keyMouseEventHandler.bind(this);this.keyMouseEventHandler=function(e){t.keyMouseFilters(e).then((e=>{i(e)}))},this.keyMouseEventHandlerThrottle=wr()((function(e){t.keyMouseEventHandler(e)}),1e3/24),this.pasteOnDocument=this._pasteOnDocument.bind(this),this.copyOnDocument=this._copyOnDocument.bind(this),this.cutOnDocument=this._cutOnDocument.bind(this),this.focus=this._focus.bind(this),this.PUBSUB_SHARING_PARAM_INFO_TOKEN=null,this.preventDefault=this._preventDefault.bind(this),this.browserBlurEventHandler=this._browserBlurEventHandler.bind(this),this.positionMap={canvas:{offsetX:0,offsetY:0},src:{x:0,y:0,w:0,h:0,scaleWidth:0,scaleHeight:0},dst:{x:0,y:0,w:0,h:0}},this.blockedKeyboardEventOfPaste=[],this.keydownupMergeRemoveMap={},this.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map={},this.PASTE_MAX_BYTE_LENGTH=64e3,this.currentMousePositionProps={clientX:0,clientY:0,x2video:0,y2video:0},this.isControllerNow=!0,this.remoteOS=Q.Tl.UNKNOWN,this.localOS=this.getLocalOS(),this._blockedCopyKeyboardList=[],this.maxSleep=500}Dr.prototype={start(){return new Promise((async(e,t)=>{try{Mr("remote control start"),this.modifyDom(),this.bindEvent(),this.subscribeSharingWidthOrHeightChange(),await this.connectSocket(),this.sendPostionPDU(),this.socketBlobMessageHandler(),e(!0)}catch(e){t(e)}}))},destroy(){return new Promise(((e,t)=>{try{Mr("destroy remote control"),this.unbindEvent(),this.uncheckAndClearKeydownupMergeRemoveMap(),this.destroySocket(),X.unsubscribe(this.PUBSUB_SHARING_PARAM_INFO_TOKEN),e(!0)}catch(t){Mr(t),e(!1)}}))},modifyDom(){try{this.dom.setAttribute("tabindex","0"),this.dom.focus()}catch(e){}},_focus(){this.dom.focus()},getLocalOS(){let e=i.g.navigator.platform;return/win/i.test(e)?Q.Tl.WIN:/mac/i.test(e)?Q.Tl.MAC:Q.Tl.UNKNOWN},setIsControlerNow(e){this.isControllerNow=e},blobSocketCheckAndSend(e){this.isControllerNow&&this.blobSocket.send(e)},isKeyboardEvent:e=>!!e&&e.type&&-1!==["keydown","keyup"].indexOf(e.type.toLowerCase()),isThisKeyIgnoreCase:(e,t)=>e.key&&e.key.toLowerCase()==t.toLowerCase(),async _copyOnDocument(e){if(!this.isFocusNow())return;let t=this._blockedCopyKeyboardList;"done"!=t[t.length-1]&&(this._blockedCopyKeyboardList=[],this._blockedCopyKeyboardList.push("done"),Mr("copyOnDocument",e),this.processMonitorCtrlMetaWithKey("c"))},async _cutOnDocument(e){this.isFocusNow()&&(Mr("_cutOnDocument",e),this.processMonitorCtrlMetaWithKey("x"))},processMonitorCtrlMetaWithKey(e){let t=this.remoteOS===Q.Tl.MAC,i={t:"keydown",event_type:1,repeat:!1,alt:!1,shift:!1,capslock:!1,numlock:!0,pduType:85,ctrl:!t,super:t},r=Object.assign({},i,{charCode:0,keyCode:t?91:17,key:t?"Meta":"Control"}),a=Object.assign({},i,{charCode:e.charCodeAt(0),keyCode:e.toUpperCase().charCodeAt(0),key:e}),n=Object.assign({},r,{input_event_type:0}),s=(Object.assign({},r,{input_event_type:2}),Object.assign({},a,{input_event_type:0})),o=(Object.assign({},a,{input_event_type:2}),Object.assign({},r,{t:"keyup",ctrl:!1,super:!1,input_event_type:1})),d=Object.assign({},a,{t:"keyup",ctrl:!1,super:t,input_event_type:1});(t?[n,s,d,o]:[n,s,o,d]).forEach((e=>{this.processEvent(e)}))},isFocusNow(){return this.dom===document.activeElement},async _pasteOnDocument(e){if(this.isFocusNow()){let t=(e.clipboardData||window.clipboardData).getData("text");Mr("_pasteOnDocument",t);let i=[];for(let e=0;e<t.length;e++){let r=t[e],a=Ir().encode(r);for(let e=0;e<a.length;e++)i.push(a.charCodeAt(e))}let r=new ArrayBuffer(8+i.length),a=new Uint8Array(r),n=new DataView(r,4,4),s=new Uint8Array(r,8);a[0]=87,n.setUint32(0,i.length,!0);for(let e=0;e<i.length;e++)s[e]=i[e];i.length>this.PASTE_MAX_BYTE_LENGTH?(this.triggerPasteTextLengthOverflow(),this.dropAllEventFromBlockedKeyboardEventOfPaste()):(this.blobSocketCheckAndSend(r),this.processMonitorCtrlMetaWithKey("v"))}},onReturnCopiedText(e){!this._onReturnCopiedText_list&&(this._onReturnCopiedText_list=[]),this._onReturnCopiedText_list.push(e)},triggerReturnCopiedText(e){this._onReturnCopiedText_list&&this._onReturnCopiedText_list.forEach((t=>t(e)))},onPasteTextLengthOverflow(e){!this._onPasteTextLengthOverflow_list&&(this._onPasteTextLengthOverflow_list=[]),this._onPasteTextLengthOverflow_list.push(e)},triggerPasteTextLengthOverflow(){this._onPasteTextLengthOverflow_list&&this._onPasteTextLengthOverflow_list.forEach((e=>e()))},dropAllEventFromBlockedKeyboardEventOfPaste(){this.blockedKeyboardEventOfPaste=[]},createParamsFromKeyboardEvent:e=>({key:e.key,code:e.code,shiftKey:e.shiftKey,altKey:e.altKey,repeat:e.repeat,charCode:e.charCode,keyCode:e.keyCode,which:e.which,ctrlKey:e.ctrlKey,metaKey:e.metaKey}),sendAllEventFromBlockedKeyboardEventOfPaste(){for(Mr("blockedKeyboardEventOfPaste.length",this.blockedKeyboardEventOfPaste.length);this.blockedKeyboardEventOfPaste.length>0;){let e=this.blockedKeyboardEventOfPaste.shift();this._keyMouseEventHandler(e)}},_preventDefault(e){if(-1!==["keydown","keyup"].indexOf(e.type)){let t=["v","c","x"];for(let i=0;i<t.length;i++)if(e.ctrlKey^e.metaKey&&this.isThisKeyIgnoreCase(e,t[i]))return}e.preventDefault()},subscribeSharingWidthOrHeightChange(){let e=this;this.PUBSUB_SHARING_PARAM_INFO_TOKEN=X.on(u.vjv,((t,i)=>{Mr("subscribeSharingWidthOrHeightChange",i.body),e.positionMap.dst.w=i.body.logicWidth,e.positionMap.dst.h=i.body.logicHeight,e.positionMap.src.w=i.body.logicWidth,e.positionMap.src.h=i.body.logicHeight,e.sendPostionPDU()}))},setDstWidthAndHeight(e,t){if(!e||!t)throw new Error("the value of destination sharing video width/height are not correct");this.positionMap.dst.w=e,this.positionMap.dst.h=t},setSrcWidthAndHeight(e,t){if(!e||!t)throw new Error("the value of source sharing video width/height are not correct");this.positionMap.src.w=e,this.positionMap.src.h=t},setSrcWidthAndHeightAndSendPDU(e,t){if(!e||!t)throw new Error("the value of source sharing video width/height are not correct");this.positionMap.src.w!==e&&this.positionMap.src.h!==t&&(this.setSrcWidthAndHeight(e,t),this.sendPostionPDU())},setSrcOffsetXYAndSendPDU(e,t){e=Math.floor(e),t=Math.floor(t),this.positionMap.canvas.offsetX===e&&this.positionMap.canvas.offsetY===t||(this.setSrcOffsetXY(e,t),this.sendPostionPDU())},setSrcScaleWidthAndHeight(e,t){if(!e||!t)throw new Error("the value of source sharing video scaleWidth/scaleHeight are not correct");this.positionMap.src.scaleWidth=e,this.positionMap.src.scaleHeight=t},setSrcOffsetXY(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=Math.floor(e),r=Math.floor(t);if(!Rr()(i)&&!Rr()(r))throw new Error("the value of source offset x or y is not correct");this.positionMap.canvas.offsetX=i,this.positionMap.canvas.offsetY=r},sendPostionPDU(){let e=new ArrayBuffer(36),t=new Uint8Array(e),i=new DataView(e,4),r=new DataView(e,20);t[0]=82,i.setInt32(0,this.positionMap.src.x,!0),i.setInt32(4,this.positionMap.src.y,!0),i.setInt32(8,this.positionMap.src.w,!0),i.setInt32(12,this.positionMap.src.h,!0),r.setInt32(0,this.positionMap.dst.x,!0),r.setInt32(4,this.positionMap.dst.y,!0),r.setInt32(8,this.positionMap.dst.w,!0),r.setInt32(12,this.positionMap.dst.h,!0),Mr("send position pdu");try{this.blobSocket.send(e)}catch(e){}},unbindEvent(){let e=this,t=this.dom;t.removeEventListener("click",e.focus),t.removeEventListener("keydown",e.keyMouseEventHandler),t.removeEventListener("keyup",e.keyMouseEventHandler),document.removeEventListener("paste",e.pasteOnDocument),document.removeEventListener("copy",e.copyOnDocument),document.removeEventListener("cut",e.cutOnDocument),t.removeEventListener("contextmenu",e.preventDefault),t.removeEventListener("wheel",e.preventDefault),t.removeEventListener("dblclick",e.preventDefault),t.removeEventListener("keydown",e.preventDefault),t.removeEventListener("keyup",e.preventDefault),t.removeEventListener("dblclick",e.keyMouseEventHandler),t.removeEventListener("mousedown",e.keyMouseEventHandler),t.removeEventListener("mouseup",e.keyMouseEventHandler),t.removeEventListener("mousemove",e.keyMouseEventHandlerThrottle),t.removeEventListener("wheel",e.keyMouseEventHandler),window.removeEventListener("blur",e.browserBlurEventHandler)},bindEvent(){let e=this,t=this.dom;Mr("dom",t),t.addEventListener("click",e.focus),t.addEventListener("keydown",e.keyMouseEventHandler),t.addEventListener("keyup",e.keyMouseEventHandler),document.addEventListener("paste",e.pasteOnDocument),document.addEventListener("copy",e.copyOnDocument),document.addEventListener("cut",e.cutOnDocument),t.addEventListener("contextmenu",e.preventDefault),t.addEventListener("wheel",e.preventDefault),t.addEventListener("dblclick",e.preventDefault),t.addEventListener("keydown",e.preventDefault),t.addEventListener("keyup",e.preventDefault),t.addEventListener("dblclick",e.keyMouseEventHandler),t.addEventListener("mousedown",e.keyMouseEventHandler),t.addEventListener("mouseup",e.keyMouseEventHandler),t.addEventListener("mousemove",e.keyMouseEventHandlerThrottle),t.addEventListener("wheel",e.keyMouseEventHandler),window.addEventListener("blur",e.browserBlurEventHandler)},recordCurrentMousePosition(e){try{let t=this.positionMap,i=e.clientX,r=e.clientY;Object.assign(this.currentMousePositionProps,{clientX:i,clientY:r,x2video:i-t.canvas.offsetX,y2video:r-t.canvas.offsetY})}catch(e){}},resolvePosition(e){let t=e.clientX,i=e.clientY,r=this.positionMap;return t-=r.canvas.offsetX,i-=r.canvas.offsetY,t*=r.dst.w/r.src.scaleWidth,i*=r.dst.h/r.src.scaleHeight,t=Math.floor(t),i=Math.floor(i),{x:t,y:i}},generateBuffer(e){if(void 0!==e.key&&!/^[\x00-\x7F]*$/.test(e.key))throw new Error("params.key must only contain ascii character");let t=8;84===(e=Object.assign({v:0,x:0,y:0,dx:0,dy:0,repeat:0},e)).pduType&&(t+=4);let i=new ArrayBuffer(t),r=new Uint8Array(i),a=new DataView(i,4),n=new DataView(i,4);if(r[0]=e.pduType,r[1]=63&e.input_event_type,83===e.pduType)a.setUint16(0,e.x,!0),a.setUint16(2,e.y,!0);else if(84===e.pduType)n.setInt16(0,e.x,!0),n.setInt16(2,e.y,!0),n.setInt16(4,e.dx,!0),n.setInt16(6,e.dy,!0);else if(85===e.pduType){let t=new DataView(i,4),a=new DataView(i,6),n=new Uint8Array(i,2);t.setUint16(0,e.keyCode,!0),a.setUint16(0,e.charCode,!0);let s={shift:1,capslock:2,ctrl:4,alt:8,numlock:16,super:32},o=0;Object.keys(s).forEach((t=>{!0===e[t]&&(o+=s[t])})),n[0]=o,e.repeat&&(r[1]=32|r[1])}return i},processEvent(e){this.blobSocket&&this.blobSocketCheckAndSend(this.generateBuffer(e))},debug(e){let t=[],i={};t=85===e.pduType?["t","keyCode","charCode","key"]:["t","x","y","dx","dy","input_event_type"],t.forEach((t=>{i[t]=e[t]})),Mr("debug",JSON.stringify(i))},blockedPasteKeyboard(e){let t=this;return new Promise(((i,r)=>{t.isKeyboardEvent(e)&&t.isPasteEvent(e)?t.blockedKeyboardEventOfPaste.push(e):i(e)}))},isPasteEvent(e){let t=this.isThisKeyIgnoreCase(e,"v");return!!(e.ctrlKey^e.metaKey&&t)},isCopyEvent(e){let t=this.isThisKeyIgnoreCase(e,"c");return!!(e.ctrlKey^e.metaKey&&t)},isCutEvent(e){let t=this.isThisKeyIgnoreCase(e,"x");return!!(e.ctrlKey^e.metaKey&&t)},returnNewEventByTransformCtrlKeyOrCommandKey(e){let t=this.createParamsFromKeyboardEvent(e);switch(this.remoteOS){case Q.Tl.WIN:Object.assign(t,{ctrlKey:!0,metaKey:!1});break;case Q.Tl.MAC:Object.assign(t,{ctrlKey:!1,metaKey:!0});case Q.Tl.UNKNOWN:}return new e.constructor(e.type,t)},transformCtrlCAndCommandC(e){let t=this;return new Promise(((i,r)=>{this.isKeyboardEvent(e)&&(e.ctrlKey||e.metaKey)&&t.isThisKeyIgnoreCase(e,"c")?(t.createParamsFromKeyboardEvent(e),i(t.returnNewEventByTransformCtrlKeyOrCommandKey(e))):i(e)}))},keyMouseEventHandlerFilter_MatainKeyDownUpMergeMap(e){return new Promise(((t,i)=>{try{this.isKeyboardEvent(e)&&e.key&&("keydown"!==e.type||e.repeat||(this.keydownupMergeRemoveMap[e.key]={t:+new Date,e}),"keydown"===e.type&&e.repeat&&delete this.keydownupMergeRemoveMap[e.key],"keyup"===e.type&&delete this.keydownupMergeRemoveMap[e.key])}catch(e){Mr.error(e)}t(e)}))},_browserBlurEventHandler(){this._checkAndClearKeydownupMergeRemoveMap(this.maxSleep,!0)},checkAndClearKeydownupMergeRemoveMap(){let e=this;this.checkAndClearKeydownupMergeRemoveMapInterval=setInterval((()=>{e._checkAndClearKeydownupMergeRemoveMap(this.maxSleep)}),100)},_checkAndClearKeydownupMergeRemoveMap(e,t){let i=this.keydownupMergeRemoveMap;Object.keys(i).forEach((r=>{let a=i[r];if(+new Date-a.t>=e||t){let e=new a.e.constructor("keyup",a.e);try{this._keyMouseEventHandler(e)}catch(e){}delete this.keydownupMergeRemoveMap[r]}}))},uncheckAndClearKeydownupMergeRemoveMap(){this._checkAndClearKeydownupMergeRemoveMap(0),clearInterval(this.checkAndClearKeydownupMergeRemoveMapInterval)},keyMouseFilters(e){return new Promise(((t,i)=>{t(e)})).then((e=>this.blockedPasteKeyboard(e))).then((e=>this.blockedCopyKeyboard(e))).then((e=>this.blockedCutKeyboard(e))).then((e=>this.keyMouseEventHandlerFilter_MatainKeyDownUpMergeMap(e))).then((e=>this.blockedSomeKeyboardEventNotHaveKeydownBefore(e))).then((e=>this.keyMouseEventHandlerFilter_EVERY_KEYUP_MUST_HAVE_KEYDOWN_BEFORE(e)))},blockedSingleMetaKey(e){return new Promise(((t,i)=>{this.isKeyboardEvent(e)&&e.key&&(/command/i.test(e.key)||/meta/i.test(e.key)||/control/i.test(e.key))&&!e.shiftKey&&!e.altKey&&e.ctrlKey^e.metaKey||t(e)}))},blockedCutKeyboard(e){let t=this;return new Promise(((i,r)=>{t.isKeyboardEvent(e)&&t.isCutEvent(e)||i(e)}))},blockedCopyKeyboard(e){let t=this;return new Promise(((i,r)=>{t.isKeyboardEvent(e)&&t.isCopyEvent(e)?t._blockedCopyKeyboardList.push(e):i(e)}))},blockedSomeKeyboardEventNotHaveKeydownBefore(e){return new Promise(((t,i)=>{if(this.isKeyboardEvent(e)&&e.key){let t=!1;if(["x","c","v"].forEach((i=>{this.isThisKeyIgnoreCase(e,i)&&(t=!0)})),"keyup"===e.type&&t&&!this.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map[e.key])return}t(e)}))},keyMouseEventHandlerFilter_EVERY_KEYUP_MUST_HAVE_KEYDOWN_BEFORE(e){return new Promise(((t,i)=>{try{if(this.isKeyboardEvent(e)&&e.key&&("keydown"===e.type&&(this.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map[e.key]=e),"keyup"===e.type)){let t=!!this.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map[e.key];delete this.keyMouseEventHandlerFilter_every_keyup_must_have_keydown_before_Map[e.key];let i=!1;if(["meta"].forEach((t=>{this.isThisKeyIgnoreCase(e,t)&&(i=!0)})),!t&&!i){Mr.warn("keyup trigger, but no keydown before");let t=new e.constructor("keydown",e);this._keyMouseEventHandler(t)}}}catch(e){Mr.error(e)}t(e)}))},_keyMouseEventHandler(e){this.isKeyboardEvent(e)&&Mr("_keyMouseEventHandler keyboard",e);let t={},i={keydown:0,keyup:1,keychar:2},r={mousemove:0,mousedown:{left:1,right:4,middle:7},mouseup:{left:2,right:5,middle:8},mouseleftdbldown:3,mouserightdbldown:6,wheel:10},a=e.getModifierState?function(t){return e.getModifierState(t)}:function(e,t){return t},n=0,s=e.key&&1===e.key.length;if(-1!==["keydown","keyup"].indexOf(e.type))t.event_type=1,n=85,void 0!==i[e.type]&&(t.input_event_type=i[e.type]);else{if(-1===["mousedown","mouseup","mousemove","wheel","click","dblclick","contextmenu"].indexOf(e.type))return void Mr.warn("the event type cannot be handled");{t.event_type=0,this.recordCurrentMousePosition(e);let i=this.resolvePosition(e);if(Object.assign(t,{x:i.x,y:i.y}),n="wheel"===e.type?84:83,void 0!==r[e.type]&&(t.input_event_type=r[e.type]),-1!==["mousedown","mouseup"].indexOf(e.type)){let i;switch(e.button){case 0:default:i="left";break;case 1:i="middle";break;case 2:i="right"}t.input_event_type=r[e.type][i]}-1!==["dblclick"].indexOf(e.type)&&(t.input_event_type=r.mouseleftdbldown)}}if("wheel"===e.type){let i={deltaX:"dx",deltaY:"dy"};Object.keys(i).forEach((r=>{e[r]&&(t[i[r]]=e[r]>0?-100:100)}))}const o=this.ctrlMetaConvert({keyCode:e.keyCode,key:e.key,ctrlKey:e.ctrlKey,metaKey:e.metaKey});Object.assign(t,{t:e.type,pduType:n,keyCode:o.keyCode,charCode:s?e.key.charCodeAt(0):0,key:o.key,repeat:e.repeat,ctrl:o.ctrlKey,alt:e.altKey,super:o.metaKey,shift:e.shiftKey,capslock:a("CapsLock",!1),numlock:a("NumLock",!1)}),this.isKeyboardEvent(e)&&Mr("processEvent",JSON.stringify(t)),this.processEvent(t)},ctrlMetaConvert(e){const t=e.metaKey,i=e.ctrlKey;return(this.remoteOS===Q.Tl.MAC&&this.localOS===Q.Tl.WIN||this.remoteOS===Q.Tl.WIN&&this.localOS===Q.Tl.MAC)&&e.key&&(/Meta/i.test(e.key)?(e.ctrlKey=!0,e.keyCode=17,e.metaKey=i,e.key="Control"):/Control/i.test(e.key)&&(e.metaKey=!0,e.keyCode=91,e.ctrlKey=t,e.key="Meta")),e},isCapslock(e){var t=e.keyCode,i=e.key,r=e.shiftKey;return!!/[a-zA-Z]/.test(i)&&(i.charCodeAt(0)!==t?!r:r)},async stop(){this.blobSocket&&this.blobSocket.close(),this.blobSocket=null},async connectSocket(){var e=await this.createBlobSocket("".concat(this.socketURL,"/wc/media/").concat(this.meetingID,"?type=r&mode=2&cid=").concat(this.condID));return e.binaryType="blob",this.blobSocket=e,!0},socketBlobMessageHandler(){if(this.blobSocket){let e=this;this.blobSocket.addEventListener("message",(async function(t){let i=t.data,r=await F.Ay.readBlobAsBuffer(i,i.size),a=new Int8Array(r),n=a[0];if(88===n&&e.isControllerNow){let t=i.slice(8),r=await F.Ay.readBlob(t),n=a[4];Mr("COPY_TEXT_FROM_RWG",r,n),e.triggerReturnCopiedText({data:r,x:e.currentMousePositionProps.x2video,y:e.currentMousePositionProps.y2video})}0===n&&e.blobSocket.send(r)}))}},destroySocket(){try{this.blobSocket.close(),this.blobSocket=null}catch(e){Mr("destroySocket",e)}},createBlobSocket:e=>new Promise(((t,i)=>{var r=new WebSocket(e);r.addEventListener("open",(()=>{})),r.addEventListener("message",(e=>{try{let i=JSON.parse(e.data);0===i.evt&&i.body&&t(r)}catch(e){}})),r.addEventListener("error",(e=>{i(e)})),r.addEventListener("close",(()=>{i(new Error("socket close"))}))})),setRemoteOS(e){void 0!==e&&(this.remoteOS=e)}};const Pr=Dr;var kr=i(3812),Or=i.n(kr);const xr=(0,G.A)("sdk.rtcUtil");class Vr{constructor(e,t){this.rtcPeerConnection=null,this.dataChannel=null,this.id=Date.now()<<3|t,this.dataChannelLabel=null,this.datachannelcloselistener=null,this.datachannelopenlistener=null,this.rtcPeerConnectionCreatedListener=null,this.reconnectCount=0,this.reconnectMax=10,this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen=0,this.connectionID=null,this.pubSubTokenList=[],this.isForceClosed=!1,this.reconnectRTCPeerConnectionThrottle=wr()((()=>{this.reconnectRTCPeerConnection()}),2e3),this.timeoutThenCloseInterval=null,this.userid=null,this.connectionType=t,this.dataChannelStatus="",this.delaycloseTimeout=0,this.delaycloseid_=0,this._netWorker=null,this.dataTransportMgr=e,this.dataChannelController=null}setUserid(e){this.userid=e}isSupportDataChannel(){return!!window.RTCDataChannel}iceClosed(e){this.isForceClosed||(xr("rtcPeerConnection.iceClosed",e),this._close(!0),this._clear())}async initConnection(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ZoomWebclientVideoDataChannel";if(Y.A.add_monitor("DCCONN"),!this.isSupportDataChannel())return void Y.A.add_monitor("DCUNSUPPORT");this.dataChannelLabel=t,this.connectionID=e,this.rtcPeerConnection=new RTCPeerConnection({iceCandidatePoolSize:1}),this.rtcPeerConnection.addEventListener("iceconnectionstatechange",(e=>{if(this.isForceClosed)return;let t=this.rtcPeerConnection;if("failed"!==t.iceConnectionState&&"closed"!==t.iceConnectionState||(xr("".concat(this.dataChannelLabel," iceconnectionstatechange"),t.iceConnectionState),Y.A.add_monitor("ICECONNSTATECHANGE:"+this.dataChannelLabel),this.iceClosed(),this.delaycloseid_&&(clearTimeout(this.delaycloseid_),this.delaycloseid_=0)),"disconnected"===t.iceConnectionState&&!this.delaycloseid_){let e=this;this.delaycloseid_=setTimeout((()=>{e.delaycloseid_=0,e.iceClosed()}),e.delaycloseTimeout)}"connected"===t.iceConnectionState&&this.delaycloseid_&&(clearTimeout(this.delaycloseid_),this.delaycloseid_=0)}));let i=null;this._netWorker&&(i=await this._netWorker.create(),Ue(i,"net")),this._createDataChannel(i),await this.rtcPeerConnection.createOffer().then((async t=>(xr("original offer",JSON.stringify(t)),t.sdp=t.sdp.replace(/a=ice-ufrag:.+/g,"a=ice-ufrag:".concat(e)),xr("modified offer",t),this.rtcPeerConnection.setLocalDescription(t)))).then((()=>{this.rtcPeerConnectionCreatedListener.call(null,this.rtcPeerConnection)}))}_close(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Y.A.add_monitor("RTCPeerConnUtil.CLOSE");try{this._closeDataChannel(),this.rtcPeerConnection&&this.rtcPeerConnection.close()}catch(e){H.Ay.error("Error when closing RTCPeerConnection",e)}finally{this.dataChannel=null,this.rtcPeerConnection=null,e&&this.datachannelcloselistener&&this.datachannelcloselistener(null),this.sendDataChannelStatusMonitorLog(),this.reconnectRTCPeerConnectionThrottle()}}forceClose(){Y.A.add_monitor("DCFORCECLOSE:"+this.dataChannelLabel),xr("forceClose : "+this.dataChannelLabel),this.isForceClosed=!0,this._close(!0),this._clear()}resetDataChannelTransfered(e){this._netWorker=e,this._close(!0),this._clear()}isDestroyed(){return this.isForceClosed}_clear(){this.timeoutThenCloseInterval&&clearInterval(this.timeoutThenCloseInterval),this.timeoutThenCloseInterval=0,this.datachannelcloselistener=null,this.datachannelopenlistener=null,this.pubSubTokenList.forEach((e=>{X.unsubscribe(e)})),this.pubSubTokenList=[]}onConnectionCreated(e){this.rtcPeerConnectionCreatedListener=e}reconnectRTCPeerConnection(){this.isForceClosed||this.reconnectCount<this.reconnectMax&&this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen<this.reconnectMax&&(xr("".concat(this.dataChannelLabel," reconnect reconnectTotalCount  : ").concat(this.reconnectCount,"; reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen : ").concat(this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen,", reconnectMax : ").concat(this.reconnectMax)),this.reconnectCount+=1,this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen+=1,setTimeout((()=>{this.initConnection(this.connectionID,this.dataChannelLabel)}),1e3*Math.pow(2,this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen)))}oneSingleLineLog(e){setTimeout((()=>{Y.A.send_instant_monitor(),Y.A.add_monitor(e),Y.A.send_instant_monitor()}),0)}checkEmptyUserIdAndResendMonitor(e){e&&this.userid!=e&&(this.setUserid(e),this.sendDataChannelStatusMonitorLog())}sendDataChannelStatusMonitorLog(){this.userid&&("OPEN"===this.dataChannelStatus?(Y.A.add_monitor("DCOPEN:"+this.dataChannelLabel),this.oneSingleLineLog("".concat(w,",").concat(this.userid,",").concat(this.connectionType,",DCOPEN,").concat(w))):"CLOSED"===this.dataChannelStatus&&(Y.A.add_monitor("DCCLOSE:"+this.dataChannelLabel),this.oneSingleLineLog("".concat(w,",").concat(this.userid,",").concat(this.connectionType,",DCCLOSE,").concat(w))))}sendDataChannelController(e){this.dataChannelController=e}_closeDataChannel(){if(this.dataChannel)try{this.dataChannelStatus="CLOSED",this.dataChannel.close()}catch(e){H.Ay.error("Error when trying to close existing RTCDataChannel",e)}finally{this.dataChannel=null}}_createDataChannel(e){this._closeDataChannel();let t=this.rtcPeerConnection.createDataChannel(this.dataChannelLabel,{ordered:!1,maxRetransmits:0,reliable:!1});t.binaryType="arraybuffer";let i="".concat(this.id,"-").concat(Math.floor(performance.now())),r=new ye(i,this.connectionType,t,e);this.connectionType==Q.Xt.VIDEO?r.transportlists=[Te,Ee,Re]:r.transportlists=[be,we],r.report_monitor_func=(e,t)=>{Y.A.add_monitor("".concat(e,":").concat(t))},r.open(),r.onopen((e=>{this.dataChannelController.connectSession(r),function(e){if(!Pe.dataTransportMgr)throw new Error("not InitDataTransportModule");Pe.dataTransportMgr.addDataChannel(e)}(r),this.datachannelopenlistener&&this.datachannelopenlistener(e),this.reconnectCountBetweenCloseAndOpenAndSetTo0WhenDCOpen=0,clearInterval(this.timeoutThenCloseInterval),this.dataChannelStatus="OPEN",this.sendDataChannelStatusMonitorLog()})),r.onclose((e=>{this.dataChannelController.disconnectSession(new _e(r.type,r.transfered)),Ne(r),this._ondatachannelclosed(e)})),r.onerror((e=>{Ne(r);const t=e.error||{};H.Ay.warn("WebRTC DataChannel ".concat(this.dataChannelLabel," received error with errorDetail: ").concat(t.errorDetail),t),clearInterval(this.timeoutThenCloseInterval),Y.A.add_monitor("DCERROR","".concat(this.dataChannelLabel,": ").concat(t.message,", error detail: ").concat(t.errorDetail)),xr("dataChannel.onerror",e)})),this.dataChannel=r}_ondatachannelclosed(e){"CLOSED"!=this.dataChannelStatus&&(clearInterval(this.timeoutThenCloseInterval),xr("dataChannel.onclose",e),this.dataChannelStatus="CLOSED",this.datachannelcloselistener&&this.datachannelcloselistener(e),this._close(),this._clear())}onDataChannelClose(e){this.datachannelcloselistener=e}onDataChannelOpen(e){this.datachannelopenlistener=e}waitForAnswerFromRWG(e){let t=this;return new Promise(((i,r)=>{let a=X.on(e,((e,a)=>{t.isDestroyed()&&r(),i(a)}));this.pubSubTokenList.push(a)}))}setRemoteDescription(e){xr("setRemoteDescription",e),this.rtcPeerConnection.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e.sdp}))}closeIfTimeout(){clearInterval(this.timeoutThenCloseInterval),this.timeoutThenCloseInterval=setTimeout((()=>{xr("closeIfTimeout"),this._close()}),1e4)}addIceCandidate(e){this.rtcPeerConnection.addIceCandidate(new RTCIceCandidate({candidate:e,sdpMLineIndex:0,sdpMid:"0"}))}}var Nr=i(3788),Lr=i(3578);function Wr(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function Br(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Wr(Object(i),!0).forEach((function(t){(0,o.A)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Wr(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const Ur=function(e,t){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:16/9;if(!e||!t)return null;const r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)||0,a=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)||0;if(e/t>i){const n=t*i;return{width:n,height:t,left:Math.round((e-n)/2)+r,top:0+a}}{const n=e/i;return{width:e,height:n,left:0+r,top:Math.round((t-n)/2)+a}}};function Fr(e){this.Notify_APPUI=e.Notify_APPUI,this.isSupportOffscreenCanvas=e.isSupportOffscreenCanvas,this.jsMediaEngine=e.jsMediaEngine,this.threadNumbs=e.videodecodethreadnumb,this.globalTracingLogger=e.globalTracingLogger,this.monitorLoggerFn=e.monitorLoggerFn,this.renderManager=e.renderManager,this.waterMarkCanvas=null,this.videoRenderLevel=10,this.videoRenderLevelCount=1,this.renderPeriodTotal=100,this.renderPeriodCount=0,this.renderPeriodTotalFps=0,this.renderPeriodFpsCount=0,this.lastRenderAudioTimeStamp=0,this.videoBufEmptyCount=0,this.videoBufCount=0,this.videoRenderMaxLevel=15,this.timestamp=0,this.audioPlayTime=0,this.videoTimestamp=0,this.videoWaterMarkName="",this.isCreateVideoWaterMark=!1,this.isWaterMarkRepeatedEnable=!1,this.waterMarkOpacity=.15,this.currentactive=0,this.audioPlaySsrc=0,this.currentVideoHeight=0,this.currentVideoWidth=0,this.videoRenderArray=[],this.WaterMarkRGBA=new Lr.A,this.vMonitorCount=0,this.videoQueue=new x,this.timestart=0,this.rendingFlag=!0,this.rAFID=0,this.rAFIDBack=null,this.prevRequestAnimationTimestap=0,this.retryRequestAnimationStep=2,this.ssrcDisplayMap=new Map,this.ssrcHaddataMap=new Map,this.canvasToLocalDisplay=new Map,this.canvasIdSet=new Set,this.selfvideossrc=0,this.localVideoPtr=0,this.sabBuffer=0,this.localvideossrc=0,this.encodedVideoSharedArrayBufferUint8Array=null,this.encodedVideoSharedArrayBufferUint16Array=null,this.encodedVideoSharedArrayWasmMemory=null,this.startCaptureVideo=!1,this.clearColor=new Uint8Array(4),this.videorendercanvas=null,this.keyrender=null,this.renderIndex=0,this.activeSpeakssrc=0,this.renderMode=0,this.intervalHandle,this.croppingParams={top:0,left:0,height:1,width:1},this.coordinate={x:0,y:0,width:640,height:360},this.bWebglContextLostProtectingMap=new Map,this.ismirror=!1,this.lfTimeStamp=0,this.activeFps=0,this.lastActiveSSRC=0,this.disableOriginalRatio=!1,this.onStopDrawCallback=e.onStopDrawCallback,this.onReStoreCallback=e.onReStoreCallback,this.videoRenderWGLFSTOP=!1}Fr.prototype.clearUseridRender=function(e,t,i){let r=e[0],a=r.display;if(a)if(a.setWatermarkFlag(0),this.renderMode)a.clearCanvas(t);else{let e=r.ssrc;if(!a||!t)return;this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.height=1,this.croppingParams.width=1,this.clearColor[0]=255*t.R,this.clearColor[1]=255*t.G,this.clearColor[2]=255*t.B,this.clearColor[3]=255*t.A;const n=this.renderManager.getRendererProvider().isWebGLRendererType(),s=this.renderManager.getRendererProvider().isWebGL2RendererType();if(n||s){let e=this.canvasToLocalDisplay.get(r.canvas);if(!e)return void console.log("no clearDisplay");e.setVideoMode(l),e.colorRange=0,e.setFillMode(1,1),e.updateSelfVideoTextures(1,1,this.clearColor,this.croppingParams,!0),void 0===i&&((i={}).x=r.x,i.y=r.y,i.width=r.width,i.height=r.height),e.drawSelfVideo(i,!0)}else{if(!a)return void console.log("no clearDisplay");a.setVideoMode(l),a.setColorRange(0),a.setFillMode(1,1),a.updateSelfVideoTextures(1,1,this.clearColor,this.croppingParams,!0),void 0===i&&((i={}).x=r.x,i.y=r.y,i.width=r.width,i.height=r.height),a.drawSelfVideo(i,!0)}let o=this;this.ssrcDisplayMap.forEach((function(t,i){let r,a;i==o.Get_Logical_SSrc(o.selfvideossrc)&&(r=!0),i==o.Get_Logical_SSrc(e)&&(a=!0),t.forEach((e=>{if(!e.haddata||a)return;let t=e.display;o.coordinate.x=e.x,o.coordinate.y=e.y,o.coordinate.width=e.width,o.coordinate.height=e.height,t&&(!a||n&&s?t.getVideoMode()!=h&&(-1==[l,p].indexOf(t.getVideoMode())&&r?t.drawSelfVideo(o.coordinate,!1,o.ismirror):r?t.drawRemoteVideo(o.coordinate,o.ismirror):t.drawRemoteVideo(o.coordinate)):t.drawSelfVideo(o.coordinate,!0))}))})),this.renderManager.renderFor(Nr.gz.VIDEO)}},Fr.prototype.Set_Render_Array_rAF=function(e){if(this.videoRenderArray=e,this.ssrcDisplayMap.clear(),this.ssrcHaddataMap.clear(),this.videoRenderArray.length>0)for(let e=0;e<this.videoRenderArray.length;e++){let t=this.ssrcDisplayMap.get(this.Get_Logical_SSrc(this.videoRenderArray[e].ssrc));t?t.push(this.videoRenderArray[e]):(t=[],t.push(this.videoRenderArray[e]),this.ssrcDisplayMap.set(this.Get_Logical_SSrc(this.videoRenderArray[e].ssrc),t),this.ssrcHaddataMap.set(this.Get_Logical_SSrc(this.videoRenderArray[e].ssrc),!1))}},Fr.prototype.Set_Render_Array=function(e,t){this.renderMode?this.Set_Render_Array_IntervalMode(e,t):this.Set_Render_Array_rAF(e)},Fr.prototype.ClearQueue=function(){this.videoQueue&&this.videoQueue.ClearQueue(),this.currentVideoHeight=0,this.currentVideoWidth=0},Fr.prototype.Put_Video_Into_Buffer=function(e){if(this.videoQueue){var t=this.videoQueue.GetQueue(e.ssrc);if(t||(t=this.videoQueue.AddQueue(e.ssrc)),t.enqueue(e),this.videoQueue&&this.videoQueue.ssrcInfo){var i=e.ssrc>>10;this.videoQueue.ssrcInfo.UpdateSSRCInfo(i,e.ntptime)}for(var r=this.videoQueue.GetQueueLength(e.ssrc)-10;r>=0;)r--}},Fr.prototype.Update_RemoteVideo_Texture=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(this.Check_Request_Animation(),t)if(e&&i){let t=this.Get_Logical_SSrc(i),s=this.FindVideoRenderListFromMap(i);if(!s.length)return void this.renderManager.destroyUnusedVideoFrame(e);let o=this,d=n&&(1==r||3==r);this.ssrcHaddataMap.set(t,!0),a?(this.croppingParams.top=a.y,this.croppingParams.left=a.x,this.croppingParams.height=a.height,this.croppingParams.width=a.width):(this.croppingParams.top=e.visibleRect?0:e.cropTop,this.croppingParams.left=e.visibleRect?0:e.cropLeft,this.croppingParams.height=e.visibleRect?e.visibleRect.height:e.cropHeight,this.croppingParams.width=e.visibleRect?e.visibleRect.width:e.cropWidth);let{width:c,height:u}=e.visibleRect||{};if(c&&u||(u=this.croppingParams.height,c=this.croppingParams.width),d){let e=u;u=c,c=e,e=this.croppingParams.height,this.croppingParams.height=this.croppingParams.width,this.croppingParams.width=e}n&&(r=0),this.canvasIdSet.clear(),s&&s.forEach((t=>{t.haddata=!0;let i=t.display;o.coordinate.x=t.x,o.coordinate.y=t.y,o.coordinate.width=t.width,o.coordinate.height=t.height;let a=!(i&&i.reuse&&t.rendercanvasID&&this.canvasIdSet.has(t.rendercanvasID));i&&(i.setVideoMode(l),o.Should_Update_Watermark(i,t.width,t.height,t.width,t.height)&&o.Update_Display_Watermark(i,t.width,t.height,t.width,t.height),e&&i.updateRemoteVideoTexturesImageBitmap(c,u,e,o.croppingParams,r,a),this.canvasIdSet.add(t.rendercanvasID))}))}else this.renderManager.destroyUnusedVideoFrame(e);else{if(e&&e.ssrc){let t,i=this.Get_Logical_SSrc(e.ssrc),r=this.FindVideoRenderListFromMap(e.ssrc);if(!r.length)return e.yuvdataptr&&Module._free(e.yuvdataptr),void this.renderManager.destroyUnusedVideoFrame(e);let a=!1,n=this;this.ssrcHaddataMap.set(i,!0);let s=e;this.croppingParams.top=s.r_y,this.croppingParams.left=s.r_x,this.croppingParams.height=s.r_h,this.croppingParams.width=s.r_w,t=s,t.enableMultiDecodeVideoWithoutSAB?t.yuvdata=t.data:t.yuvdata=(self.GROWABLE_HEAP_U8?self.GROWABLE_HEAP_U8():Module.HEAPU8).subarray(t.yuvdataptr,t.yuvdataptr+t.yuvlength),!t.yuvdata.length||t.yuvdata.length!=t.width*t.height*3/2||this.croppingParams.top<0||this.croppingParams.left<0||this.croppingParams.left+this.croppingParams.width>t.width||this.croppingParams.top+this.croppingParams.height>t.height||r&&(this.canvasIdSet.clear(),r.forEach((e=>{e.haddata=!0;let i=e.display;n.coordinate.x=e.x,n.coordinate.y=e.y,n.coordinate.width=e.width,n.coordinate.height=e.height;let r=!(i&&i.reuse&&e.rendercanvasID&&this.canvasIdSet.has(e.rendercanvasID));i&&(i.setVideoMode(1),this.Should_Update_Watermark(i,e.width,e.height,e.width,e.height)&&this.Update_Display_Watermark(i,e.width,e.height,e.width,e.height),t&&i.updateRemoteVideoTextures(t.width,t.height,n.croppingParams,t.yuvdata,t.rotation,t.yuv_limited,n.coordinate,a,r),this.canvasIdSet.add(e.rendercanvasID))})))}else this.renderManager.destroyUnusedVideoFrame(e);e.yuvdataptr&&Module._free(e.yuvdataptr)}},Fr.prototype.Set_Cropping_Mode=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.disableOriginalRatio=!!e},Fr.prototype.Update_Cropping_Params=function(){if(this.disableOriginalRatio){const e=Ur(this.croppingParams.width,this.croppingParams.height,this.croppingParams.left,this.croppingParams.top);e&&(this.croppingParams=Br(Br({},this.croppingParams),e))}},Fr.prototype.Update_SelfVideo_Texture=function(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:l,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(n?(this.croppingParams.top=n.top,this.croppingParams.left=n.left,this.croppingParams.width=n.width,this.croppingParams.height=n.height):(this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.height=t,this.croppingParams.width=e),this.renderMode){let n=0;this.canvasIdSet.clear();const o=this.FindVideoRenderList(r);for(;n<o.length;n++){this.coordinate.x=o[n].x,this.coordinate.y=o[n].y,this.coordinate.width=o[n].width,this.coordinate.height=o[n].height,this.Update_Cropping_Params(),o[n].display.setVideoMode(a);const{display:r,width:d,height:c}=o[n];this.Should_Update_Watermark(r,d,c,d,c)&&this.Update_Display_Watermark(r,d,c,d,c);let u=!(r&&r.reuse&&o[n].rendercanvasID&&this.canvasIdSet.has(o[n].rendercanvasID));-1!==[l,p].indexOf(a)?(o[n].display.updateSelfVideoTextures(e,t,i,this.croppingParams,u,s),o[n].enableMultiDecodeVideoWithoutSAB?o[n].firstFrame=!0:o[n].display.drawSelfVideo(this.coordinate,!1,this.ismirror)):(o[n].display.updateRemoteVideoTextures(e,t,this.croppingParams,i,s,0,this.coordinate,!1,u),o[n].enableMultiDecodeVideoWithoutSAB?o[n].firstFrame=!0:o[n].display.drawRemoteVideo(this.coordinate,this.ismirror)),this.canvasIdSet.add(o[n].rendercanvasID)}this.renderManager.renderFor(Nr.gz.VIDEO)}else if(i&&r){let n=this.FindVideoRenderListFromMap(r);this.ssrcHaddataMap.set(r,!0);let o=this;n.length&&(this.canvasIdSet.clear(),n.forEach((r=>{r.haddata=!0,o.coordinate.x=r.x,o.coordinate.y=r.y,o.coordinate.width=r.width,o.coordinate.height=r.height,o.Update_Cropping_Params();let n=r.display,d=!(n&&n.reuse&&r.rendercanvasID&&this.canvasIdSet.has(r.rendercanvasID));n&&(n.setVideoMode(a),o.Should_Update_Watermark(n,r.width,r.height,r.width,r.height)&&o.Update_Display_Watermark(n,r.width,r.height,r.width,r.height),-1!==[l,p].indexOf(a)?n.updateSelfVideoTextures(e,t,i,o.croppingParams,d,s):n.updateRemoteVideoTextures(e,t,o.croppingParams,i,s,!0,o.coordinate,!1,d),this.canvasIdSet.add(r.rendercanvasID))})),this.renderManager.renderFor(Nr.gz.VIDEO))}},Fr.prototype.Draw_Send_Video_Img=function(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:l,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.Update_SelfVideo_Texture(t,i,e,r,a,n)},Fr.prototype.setMirrorMyVideoOption=function(e){this.ismirror=e},Fr.prototype.Start_Draw=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return this.rendingFlag=!0,this.renderMode=e,e?t?(this.intervalHandle=setInterval(this.JsMediaSDK_VideoRender_interval.bind(this),t),this.intervalHandle):null:(function(e){if(e)Kr=e}(this),this.Start_Request_Animation_Frame())},Fr.prototype.Stop_Draw=function(){this.rendingFlag=!1,this.renderMode?clearInterval(this.intervalHandle):this.Stop_Request_Animation_Frame()},Fr.prototype.contextLostCallback=function(e){let t=e.currentTarget.canvasId;Hr&&function(e){postMessage({status:M.aY,canvasId:e,replaceCanvas:!1})}(t),e.preventDefault()},Fr.prototype.contextRestoredCallback=function(e){let t=e.currentTarget,i=t.canvasId,r=t.callback;this.Restored_From_Context_Lost(t,t,i,this.Log_Error.bind(this),r),this.onReStoreCallback&&this.onReStoreCallback(this),Hr&&function(e){postMessage({status:M.kD,canvasId:e})}(i)},Fr.prototype.webGLContextLostProtect=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;t&&t!==e&&(t.contextLostHandler&&t.removeEventListener("webglcontextlost",t.contextLostHandler),t.contextRestoredHandler&&t.removeEventListener("webglcontextrestored",t.contextRestoredHandler)),e&&!this.bWebglContextLostProtectingMap.get(e)&&(e.canvasId=i,e.callback=r,this.renderMode||((t=this.bWebglContextLostProtectingMap.get(i))&&(t.removeEventListener("webglcontextlost",t.contextLostHandler),t.removeEventListener("webglcontextrestored",t.contextRestoredHandler)),this.bWebglContextLostProtectingMap.set(i,e),e.contextLostHandler=this.contextLostCallback.bind(this),e.contextRestoredHandler=this.contextRestoredCallback.bind(this),e.addEventListener("webglcontextlost",e.contextLostHandler,{capture:!1}),e.addEventListener("webglcontextrestored",e.contextRestoredHandler,{capture:!1})))},Fr.prototype._Replace_Video_Render_Array_From_Context_LOST=function(e){let{canvas:t,oldCanvas:i,newDisplayMap:r}=e;for(let e=0;e<this.videoRenderArray.length;e++)if(this.videoRenderArray[e].canvas===i||this.videoRenderArray[e].canvas===t){i!==t&&(this.videoRenderArray[e].canvas=t);const a=this.videoRenderArray[e].display.getFillMode();this.videoRenderArray[e].display=r?r.get(this.videoRenderArray[e].display.getTextureIndex()):this._Create_WebGL_Canvas({videoRenderArrayIndex:e,canvas:t,canvasId:this.videoRenderArray[e].rendercanvasID}),a&&this.videoRenderArray[e].display&&this.videoRenderArray[e].display.setFillMode(a,this.videoRenderArray[e].display.getFillModeForResolution())}},Fr.prototype.Restored_From_Context_Lost=function(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(this.renderMode)this._Replace_Video_Render_Array_From_Context_LOST({canvas:e,oldCanvas:t});else{const n=this.renderManager.onRestoredFromContextLost(i,e,t,this.threadNumbs,r,this.canvasToLocalDisplay);n&&(this.ssrcDisplayMap.forEach(((i,r)=>{i.forEach((i=>{if(i.haddata=!1,i.canvas===t){t!==e&&(i.canvas=e);let r=i.display;i.display=n.get(r.getTextureIndex())}}))})),this._Replace_Video_Render_Array_From_Context_LOST({canvas:e,oldCanvas:t,newDisplayMap:n}),null==a||a({canvas:e,oldCanvas:t,newDisplayMap:n}),this.rendingFlag&&this.Start_Request_Animation_Frame())}},Fr.prototype.Replace_Canvas=function(e,t){let i=null;this.bWebglContextLostProtectingMap.forEach(((e,r)=>{r===t&&(i=e)})),i!=e&&(this.bWebglContextLostProtectingMap.delete(t),this.webGLContextLostProtect(e,i,t),this.Restored_From_Context_Lost(e,i,t,this.Log_Error.bind(this))),this.isSupportOffscreenCanvas&&(this.waterMarkCanvas||this.videorendercanvas)&&(this.waterMarkCanvas=this.videorendercanvas=new OffscreenCanvas(640,360))},Fr.prototype.Get_Display=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const a=this.renderManager.getRendererProvider().isWebGLRendererType(),n=this.renderManager.getRendererProvider().isWebGL2RendererType();return(a||n)&&this.webGLContextLostProtect(e,null,t,r),this.renderManager.getVideoRenderDisplay(e,t,this.threadNumbs,this.Log_Error.bind(this),this.canvasToLocalDisplay)},Fr.prototype.GiveBack_Display=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=e[0];i&&i.display&&this.renderManager.recycleRenderDisplay(i.canvas,i.display,t)},Fr.prototype.Get_Logical_SSrc=function(e){return e?e>>10<<10:-1},Fr.prototype.Set_LocalVideo_Ptr=function(e){e&&(this.localVideoPtr=e)},Fr.prototype.Set_LocalVideo_Buffer=function(e){e&&(this.encodedVideoSharedArrayWasmMemory=e,this.sabBuffer=e.buffer,this.encodedVideoSharedArrayBufferUint8Array=new Uint8Array(this.sabBuffer),this.encodedVideoSharedArrayBufferUint16Array=new Uint16Array(this.sabBuffer))},Fr.prototype.Set_LocalVideo_SSRC=function(e){e&&(this.localvideossrc=e,this.selfvideossrc=e)},Fr.prototype.Draw_LocalVideo=function(){if(this.localVideoPtr&&this.sabBuffer&&this.localvideossrc){this.encodedVideoSharedArrayWasmMemory&&this.encodedVideoSharedArrayWasmMemory.buffer!=this.sabBuffer&&(this.encodedVideoSharedArrayBufferUint8Array=new Uint8Array(this.encodedVideoSharedArrayWasmMemory.buffer),this.encodedVideoSharedArrayBufferUint16Array=new Uint16Array(this.encodedVideoSharedArrayWasmMemory.buffer),this.sabBuffer=this.encodedVideoSharedArrayWasmMemory.buffer);let e=Atomics.load(this.encodedVideoSharedArrayBufferUint8Array,this.localVideoPtr),t=Atomics.load(this.encodedVideoSharedArrayBufferUint8Array,this.localVideoPtr+1),i=!0;if(e==t&&(i=!1),e-t==1&&(e=(e+1)%5),i){let t=0,i=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+8294414*e)/2],r=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+8294414*e+2)/2],a=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+8294414*e+4)/2],n=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+8294414*e+6)/2],s=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+8294414*e+8)/2],o=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+8294414*e+10)/2],d=this.encodedVideoSharedArrayBufferUint16Array[this.localVideoPtr/2+(4+8294414*e+12)/2],c=255&d,u=d>>8&255;t=c&&c!==p?i*r*3/2:i*r*4,this.croppingParams.top=a,this.croppingParams.left=n,this.croppingParams.height=o,this.croppingParams.width=s;let h=this.encodedVideoSharedArrayBufferUint8Array.subarray(this.localVideoPtr+4+8294414*e+4+8,this.localVideoPtr+4+8294414*e+4+8+t);this.Update_SelfVideo_Texture(i,r,h,this.Get_Logical_SSrc(this.localvideossrc),c,this.croppingParams,u),Atomics.store(this.encodedVideoSharedArrayBufferUint8Array,this.localVideoPtr,(e+1)%5)}}},Fr.prototype.Update_LocalVideo=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.localvideossrc;if(this.renderMode){let a=0,n=0,s=!1,o=this.FindVideoRenderList(r),d=i&&(1==t||3==t);for(;n<o.length;n++){s=!0;let r=e;this.croppingParams.top=r.visibleRect?0:r.cropTop,this.croppingParams.left=r.visibleRect?0:r.cropLeft,this.croppingParams.height=r.visibleRect?d?r.visibleRect.width:r.visibleRect.height:r.cropHeight,this.croppingParams.width=r.visibleRect?d?r.visibleRect.height:r.visibleRect.width:r.cropWidth,this.coordinate.x=o[n].x,this.coordinate.y=o[n].y,this.coordinate.width=o[n].width,this.coordinate.height=o[n].height,this.Update_Cropping_Params(),o[n].display.setVideoMode(a);const{display:c,width:u,height:h}=o[n];0!=u&&0!=h&&(this.Should_Update_Watermark(c,u,h,u,h)&&this.Update_Display_Watermark(c,u,h,u,h),-1!==[l,p].indexOf(a)&&(o[n].display.updateRemoteVideoTexturesImageBitmap(this.croppingParams.width,this.croppingParams.height,r,this.croppingParams,i?0:t),o[n].enableMultiDecodeVideoWithoutSAB?o[n].firstFrame=!0:o[n].display.drawSelfVideo(this.coordinate,!1,this.ismirror)))}s||this.renderManager.destroyUnusedVideoFrame(e)}else this.Update_RemoteVideo_Texture(e,!0,r,t,null,i)},Fr.prototype.Set_Capture_Video_Flag=function(e){this.startCaptureVideo=e},Fr.prototype.Get_Capture_Video_Flag=function(){return this.startCaptureVideo},Fr.prototype.FindVideoRender=function(e){if(!e)return null;for(let t=0;t<this.videoRenderArray.length;t++)if(this.videoRenderArray[t].ssrc&&this.videoRenderArray[t].ssrc>>10==e>>10)return this.videoRenderArray[t];return null},Fr.prototype.FindVideoRenderList=function(e){let t=this.isActiveSeakerSsrc(e),i=this.FindVideoRender(1),r=[e>>10];t&&i&&r.push(0);let a=[];for(let e=0;e<this.videoRenderArray.length;e++)this.videoRenderArray[e].ssrc&&r.includes(this.videoRenderArray[e].ssrc>>10)&&a.push(this.videoRenderArray[e]);return a},Fr.prototype.FindVideoRenderListFromMap=function(e){let t=this.isActiveSeakerSsrc(e),i=[...this.ssrcDisplayMap.get(this.Get_Logical_SSrc(e))||[]];if(t){let e=this.ssrcDisplayMap.get(this.Get_Logical_SSrc(1))||[];i.push(...e)}return i},Fr.prototype.JsMediaSDK_VideoRender_interval=function(){this.startCaptureVideo&&this.Draw_LocalVideo();let e=this.FindVideoRender(1),t=this.FindVideoRender(this.activeSpeakssrc);if(0!=this.videoRenderArray.length){for(let r=0;r<this.videoRenderArray.length;r++){const a=this.videoRenderArray[r],{display:n,canvas:s,enableMultiDecodeVideoWithoutSAB:o,ssrc:d,isMyself:c}=a;var i=null;if(a==e&&t)continue;let h=d;a!=e||t||(h=this.activeSpeakssrc);let l=[a];if(a==t&&e&&l.push(e),this.isActiveSsrcVideo(h)){let e=Date.now();if(this.jsMediaEngine){let e=this.jsMediaEngine.Get_Video_SSRC_Latest_Time();this.timestamp=e.currentSSRCTime,this.audioPlayTime=e.audioPlayTime}this.calPacingTime(e),e-this.timestart<this.pacingTime||(i=this.Get_Decoded_Video_Frame(this.Get_Logical_SSrc(h)),this.timestart=e)}else i=this.Get_Decoded_Video_Frame(this.Get_Logical_SSrc(h));if(i){let e;this.isActiveSsrcVideo(h)&&(this.videoTimestamp=i.ntptime),e=i.yuvdata instanceof $e?i.yuvdata.yuvdata:i.yuvdata,this.croppingParams.top=i.r_y,this.croppingParams.left=i.r_x,this.croppingParams.height=i.r_h,this.croppingParams.width=i.r_w;const t=i.width>i.height&&(1===i.rotation||3===i.rotation)||i.width<i.height&&1!==i.rotation&&3!==i.rotation,r=t?i.height:i.width,a=t?i.width:i.height,{width:n,height:d}=s;if(this.currentVideoHeight==this.croppingParams.height&&this.currentVideoWidth==this.croppingParams.width||(this.Notify_APPUI?this.Notify_APPUI(u.XDu,{width:this.croppingParams.width,height:this.croppingParams.height}):postMessage({status:M.Rk,width:this.croppingParams.width,height:this.croppingParams.height}),this.currentVideoHeight=this.croppingParams.height,this.currentVideoWidth=this.croppingParams.width),e.length==i.width*i.height*3/2&&i.r_x>=0&&i.r_y>=0&&i.r_x+i.r_w<=i.width&&i.r_y+i.r_h<=i.height){8400==this.vMonitorCount&&(this.jsMediaEngine?this.jsMediaEngine.Send_Render_Monitor_Log("VDGLM"):postMessage({status:M.Zc,data:"VDGLW"}),this.vMonitorCount=0),this.vMonitorCount++;let t=this;l.forEach((s=>{s.display&&(t.Should_Update_Watermark(s.display,r,a,n,d)&&t.Update_Display_Watermark(s.display,r,a,n,d),o?s.display&&(s.display.setVideoMode(1),s.display.updateRemoteVideoTextures(i.width,i.height,t.croppingParams,e,i.rotation,i.yuv_limited),s.firstFrame=!0):(s.display.setVideoMode(1),s.display.drawNextOutputPictureFrame(i.width,i.height,t.croppingParams,e,i.rotation,i.yuv_limited,s)))}))}else this.Log_Error("Invalid YUV data: ".concat(i.r_x," ").concat(i.r_y," ").concat(i.r_w," ").concat(i.r_h," ").concat(i.width," ").concat(i.height));i.yuvdata instanceof $e&&i.yuvdata.recycle()}o&&l.forEach((e=>{if(o&&e.firstFrame){const{x:t,y:i,width:r,height:a}=e,n={x:t,y:i,width:r,height:a};c?e.display.drawSelfVideo(n):e.display.drawRemoteVideo(n)}}))}this.renderManager.renderFor(Nr.gz.VIDEO)}},Fr.prototype.Get_Decoded_Video_Frame=function(e){if(this.videoQueue){var t=this.videoQueue.GetQueue(e);return t?t.dequeue():null}},Fr.prototype.Set_SSRC_Latest_Time_Stamp=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.timestamp!==e&&"number"==typeof e&&e&&(this.timestamp=e,this.audioPlaySsrc=t,this.audioPlayTime=Date.now())},Fr.prototype.Get_Decoded_Video_Buffer_Length=function(e){return this.videoQueue?this.videoQueue.GetQueueLength(e):0},Fr.prototype.Get_SSRC_VIDEO_FPS=function(e){if(e>>=10,this.videoQueue&&this.videoQueue.ssrcInfo){var t=this.videoQueue.ssrcInfo.GetSSRCFpsInfo(e);if(t)return Math.round(t)}return 0},Fr.prototype.Change_Current_SSRC=function(e){this.currentactive=e,this.ClearQueue()},Fr.prototype.Set_Render_Array_IntervalMode=function(e,t){if(this.videoRenderArray=e,this.renderMode&&this.videoRenderArray.length>0)for(let e=0;e<this.videoRenderArray.length;e++){const i=this.videoRenderArray[e];t?i.display||(i.enableMultiDecodeVideoWithoutSAB=t,i.display=this.Get_Display(i.canvas,i.canvas.id),i.display&&i.display.setFillMode(i.fillMode,i.fillModeForResolution)):(this.renderManager.getRendererProvider().isWebGPURendererType()?i.display=this.Get_Display(i.canvas,i.rendercanvasID):i.display=this._Create_WebGL_Canvas({videoRenderArrayIndex:e,canvas:i.canvas,canvasId:i.rendercanvasID}),this.webGLContextLostProtect(i.canvas,void 0,i.rendercanvasID))}},Fr.prototype._Create_WebGL_Canvas=function(e){let{videoRenderArrayIndex:t,canvas:i,canvasId:r}=e;const a={forceNoGL:void 0,contextOptions:{webglcontextlostCallback:this.webglcontextlostCallback.bind(this),webglcontextrestoredCallback:this.webglcontextrestoredCallback.bind(this),params:{videoRenderArrayIndex:t,canvas:i,canvasId:r}},webGLResources:void 0,initMask:!1};return this.renderManager.createWebGLVideoRenderDisplay(i,r,0,a)},Fr.prototype.webglcontextlostCallback=function(e,t){let{canvas:i,canvasId:r}=t;e.preventDefault()},Fr.prototype.webglcontextrestoredCallback=function(e,t){var i,r;let{videoRenderArrayIndex:a,canvas:n,canvasId:s}=t;var o;(!this.videoRenderArray||a>=(null===(i=this.videoRenderArray)||void 0===i?void 0:i.length))&&this.Log_Error("videoRenderArray:".concat(this.videoRenderArray,", length:").concat(null===(o=this.videoRenderArray)||void 0===o?void 0:o.length)),this.renderMode&&a<(null===(r=this.videoRenderArray)||void 0===r?void 0:r.length)&&(this.videoRenderArray[a].display=this._Create_WebGL_Canvas({videoRenderArrayIndex:a,canvas:n,canvasId:s}),this.Set_Render_Array(this.videoRenderArray))},Fr.prototype.ClearQueue=function(){try{let e=this.videoQueue.ssrcQueueMap;for(let[t,i]of e)for(;!i.isEmpty();){let e=i.dequeue();e.yuvdata&&e.yuvdata instanceof $e&&e.yuvdata.recycle()}}catch(e){this.Log_Error("Exception during VideoRender.ClearQueue",e)}this.videoQueue&&this.videoQueue.ClearQueue(),this.currentVideoHeight=0,this.currentVideoWidth=0},Fr.prototype.Set_WaterMark_Info=function(e){let{waterMarkCanvas:t,isCreateVideoWaterMark:i,videoWaterMarkName:r,watermarkOpacity:a,watermarkRepeated:n,watermarkPosition:s}=e;this.waterMarkCanvas=t||this.videorendercanvas,this.isCreateVideoWaterMark=i,this.videoWaterMarkName=r,void 0!==n&&(this.isWaterMarkRepeatedEnable=!!n),void 0!==a&&(this.waterMarkOpacity=a),void 0!==s&&(this.watermarkPosition=s)},Fr.prototype.Set_WaterMark_Flag=function(e){if(this.videoRenderArray.length>0)for(let t=0;t<this.videoRenderArray.length;t++){const{display:i}=this.videoRenderArray[t];i.setWatermarkFlag(e?1:0)}},Fr.prototype.Should_Watermark_Repeated=function(e,t){return this.isWaterMarkRepeatedEnable&&e>306&&t>202};const Gr=function(e,t){if(e<640&&e){const i=640/e;e=640,t=Math.round(t*i)}return{width:e,height:t}};Fr.prototype.Update_Display_Watermark=function(e,t,i,r,a){const n=this.Should_Watermark_Repeated(r,a);this.waterMarkCanvas||this.videorendercanvas||(this.videorendercanvas=this.isSupportOffscreenCanvas?new OffscreenCanvas(640,360):null);const s=r<512||a<288?16:this.watermarkPosition,o=this.waterMarkCanvas||this.videorendercanvas;if("function"==typeof OffscreenCanvas&&o instanceof OffscreenCanvas&&OffscreenCanvasRenderingContext2D&&!OffscreenCanvasRenderingContext2D.prototype.measureText)return;const d=Gr(t,i);t=d.width,i=d.height;const c=n?this.WaterMarkRGBA.Get_Repeated_WaterMarkRGBA({canvas:o,name:this.videoWaterMarkName,width:t,height:i,opacity:this.waterMarkOpacity,position:s}):this.WaterMarkRGBA.Get_WaterMarkRGBA({canvas:o,name:this.videoWaterMarkName,width:t,height:i,opacity:this.waterMarkOpacity,position:s});e.updateWatermark(t,i,c)},Fr.prototype.Should_Update_Watermark=function(e,t,i,r,a){if(!this.isCreateVideoWaterMark)return!1;let n=!1;const s=Gr(t,i);s.width===e.getWatermarkWidth()&&s.height===e.getWatermarkHeight()||(n=!0);const o=this.Should_Watermark_Repeated(r,a);e.isSetWatermark()||(n=!0),o!==e.isWatermarkRepeated()&&(n=!0,e.setWatermarkRepeated(o)),this.waterMarkOpacity&&this.waterMarkOpacity!==e.getWatermarkOpacity()&&(n=!0,e.setWatermarkOpacity(this.waterMarkOpacity));const d=t<512||i<288?16:this.watermarkPosition;return d!==e.getWatermarkPosition()&&(n=!0,e.setWatermarkPosition(d)),n},Fr.prototype.calCulateActiveFps=function(e){this.activeFps&&e>=this.lfTimeStamp?this.activeFps=500/(e-this.lfTimeStamp)+this.activeFps/2:this.lfTimeStamp&&(this.activeFps=1e3/(e-this.lfTimeStamp))},Fr.prototype.Put_Video_Data_Queue=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;if(this.videoQueue){var i=this.videoQueue.GetQueue(e.ssrc);if(i||(i=this.videoQueue.AddQueue(e.ssrc)),i.enqueue(e),(this.Get_Logical_SSrc(this.currentactive)==this.Get_Logical_SSrc(e.ssrc)||this.Get_Logical_SSrc(this.audioPlaySsrc)==this.Get_Logical_SSrc(e.ssrc))&&(this.lfTimeStamp&&this.calCulateActiveFps(e.ntptime),this.lfTimeStamp=e.ntptime),this.lastActiveSSRC!=e.ssrc&&(this.lfTimeStamp=0,this.activeFps=0),this.lastActiveSSRC=e.ssrc,this.videoQueue&&this.videoQueue.ssrcInfo){var r=e.ssrc>>10;this.videoQueue.ssrcInfo.UpdateSSRCInfo(r,e.ntptime)}for(var a=this.videoQueue.GetQueueLength(e.ssrc)-t;a>=0;){let t=this.Get_Decoded_Video_Frame(e.ssrc);t.yuvdata instanceof $e&&t.yuvdata.recycle(),a--}}else e.yuvdata&&e.yuvdata instanceof $e&&e.yuvdata.recycle()},Fr.prototype.Clear_OffScreenCanvas=function(e){this.renderManager.clearOffscreenCanvas(e),e.contextLostHandler&&(e.removeEventListener("webglcontextlost",e.contextLostHandler),e.contextLostHandler=null),e.contextRestoredHandler&&(e.removeEventListener("webglcontextrestored",e.contextRestoredHandler),e.contextRestoredHandler=null),e.width=1,e.height=1},Fr.prototype.Zoom_Render=function(e){},Fr.prototype.Decode_Ssrc=function(e){return this.ssrcDisplayMap.has(this.Get_Logical_SSrc(e))||this.Get_Logical_SSrc(e)==this.Get_Logical_SSrc(this.selfvideossrc)};const Hr="undefined"==typeof window;function jr(e){let t=Date.now(),i=Kr;if(t-qr<30)i.Start_Request_Animation_Frame(e);else if(qr=t,i.rendingFlag){try{i.startCaptureVideo&&i.localVideoPtr&&i.Draw_LocalVideo(),i.ssrcDisplayMap.forEach((function(e,r){if(r!=i.Get_Logical_SSrc(1)||!i.ssrcDisplayMap.has(i.Get_Logical_SSrc(i.activeSpeakssrc)))if(r==i.Get_Logical_SSrc(1)&&(r=i.activeSpeakssrc),i.isActiveSsrcVideo(r))if(i.calPacingTime(t),t-i.timestart<i.pacingTime);else{i.timestart=t;let e=i.Get_Decoded_Video_Frame(i.Get_Logical_SSrc(r));e&&(i.Update_RemoteVideo_Texture(e),i.videoTimestamp=e.ntptime)}else{let e=i.Get_Decoded_Video_Frame(i.Get_Logical_SSrc(r));e&&i.Update_RemoteVideo_Texture(e)}})),i._render()}catch(e){i.Log_Error("Exception while rendering video",e)}i.Start_Request_Animation_Frame(e)}else i.rAFID&&i.Stop_Request_Animation_Frame()}var Kr;Fr.prototype.Check_Request_Animation=function(){Hr&&this.rendingFlag&&this.prevRequestAnimationTimestap&&performance.now()-this.prevRequestAnimationTimestap>5e3&&!this.rAFIDBack&&(postMessage({status:M.vr,data:"WCL_M,RCIF"}),this.rAFID&&(cancelAnimationFrame(this.rAFID),this.rAFID=0),this.rAFIDBack=setInterval(jr.bind(null,!0),30))},Fr.prototype.Start_Request_Animation_Frame=function(e,t){if(!e&&this.rAFIDBack&&(console.log("Request_Animation_start"),this.Stop_Request_Animation_Frame_Backup()),!this.rAFIDBack)return t||(this.retryRequestAnimationStep=2),this.prevRequestAnimationTimestap=performance.now(),this.rAFID=requestAnimationFrame(jr),this.rAFID},Fr.prototype.Stop_Request_Animation_Frame_Backup=function(){this.rAFIDBack&&(clearInterval(this.rAFIDBack),this.rAFIDBack=null)},Fr.prototype.Stop_Request_Animation_Frame=function(){this.rAFID&&cancelAnimationFrame(this.rAFID),this.rAFID=0,this.prevRequestAnimationTimestap=0,this.retryRequestAnimationStep=2,this.Stop_Request_Animation_Frame_Backup()},Fr.prototype.Log_Error=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.globalTracingLogger?this.globalTracingLogger.error(e,t):Ye(e,t)},Fr.prototype._render=function(){let e=this;e.ssrcDisplayMap.forEach((function(t,i){const r=e.isSelfVideo(i);t.forEach((t=>{var i;let a=t.display;a&&(null!==(i=a.isAvaiable)&&void 0!==i&&i.call(a)||setTimeout((()=>{var e;null===(e=a.restoreContext)||void 0===e||e.call(a)}),5),t.haddata&&a.getVideoMode()!=h&&(e.coordinate.x=t.x,e.coordinate.y=t.y,e.coordinate.width=t.width,e.coordinate.height=t.height,r&&-1!==[l,p].indexOf(a.getVideoMode())?a.drawSelfVideo(e.coordinate,!1,e.ismirror):r?a.drawRemoteVideo(e.coordinate,e.ismirror):a.drawRemoteVideo(e.coordinate)))}))})),e.renderManager.renderFor(Nr.gz.VIDEO)},Fr.prototype._singleRender=function(){let e=this;this.videoRenderArray.forEach((t=>{const{x:i,y:r,width:a,ssrc:n,height:s,enableMultiDecodeVideoWithoutSAB:o}=t,d=t.display,c=e.isSelfVideo(n),u={x:i,y:r,width:a,height:s};o?c?d.drawSelfVideo(u):d.drawRemoteVideo(u):d.drawNextOutputPictureFrame(d.getTextureWidth(),d.getTextureHeight(),d.getCroppingParams(),null,d.getRotation(),void 0,u,!1)}))},Fr.prototype.calPacingTime=function(e){if(this.pacingTime=30,this.activeFps>=1&&this.activeFps<=40&&(this.pacingTime=1e3/this.activeFps),this.timestamp&&this.videoTimestamp){let t=this.timestamp+e-this.audioPlayTime,i=this.videoTimestamp+this.pacingTime-t,r=this.currentactive?this.currentactive:this.audioPlaySsrc,a=this.videoQueue.GetQueueLength(this.Get_Logical_SSrc(r));i>65&&i<1e4&&a>=1&&(this.pacingTime=1.5*this.pacingTime),i<-65&&(this.pacingTime=1*this.pacingTime/2)}else this.timestamp||(this.pacingTime>150?this.pacingTime=1*this.pacingTime/2:this.pacingTime=this.pacingTime-10)},Fr.prototype.getRenderManager=function(){return this.renderManager},Fr.prototype.cleanup=function(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.renderManager.cleanup(e,t,i)},Fr.prototype.setActiveSpeakerSsrc=function(e){this.activeSpeakssrc=e},Fr.prototype.getActiveSpeakerSsrc=function(e){return this.activeSpeakssrc},Fr.prototype.isActiveSeakerSsrc=function(e){return this.activeSpeakssrc&&this.activeSpeakssrc>>10==e>>10},Fr.prototype.isActiveSsrcVideo=function(e){let t=e>>10;return t==this.currentactive>>10||t==this.audioPlaySsrc>>10},Fr.prototype.clearDraw=function(e){e&&(this.clearColor[0]=255*e.R,this.clearColor[1]=255*e.G,this.clearColor[2]=255*e.B,this.clearColor[3]=255*e.A)},Fr.prototype.isSelfVideo=function(e){return this.Get_Logical_SSrc(e)==this.Get_Logical_SSrc(this.selfvideossrc)||this.isActiveSeakerSsrc(this.selfvideossrc)&&!(e>>10)},Fr.prototype.reDraw=function(){this.renderMode?this._singleRender():this._render()},Fr.prototype.getUserIdVideo=function(e){let t=null,i=1==e||this.isActiveSeakerSsrc(e);for(let r=0;r<this.videoRenderArray.length;r++){const a=this.videoRenderArray[r];if(a.ssrc>>10==e>>10||i&&1==a.ssrc){const{width:e,height:i}=a;(!t||e*i>t.width*t.height)&&(t=a)}}if(!t||!t.display)return null;const r=t.canvas,a=t.rendercanvasID;let n=t.display.getTextureWidth(),s=t.display.getTextureHeight(),o=t.display.getRotation(),d=t.display.getViewPosition();if(1==o||3==o){let e=n;n=s,s=e}const{x:c,y:u,width:h,height:l}=t;let p=h,f=l,g=Math.floor(h*d[1]),m=Math.floor(l*d[0]);p=h-2*g,f=l-2*m;let v=r.height-l-u+m,A=c+g;return s=Math.floor(Math.min(f,s)),n=Math.floor(s*p/f),{canvasId:a,canvas:r,options:{x:A,y:v,width:p,height:f,displayWidth:n,displayHeight:s}}};var qr=0;const zr=Fr;function Xr(e){this.Notify_APPUI=e.Notify_APPUI,this.PubSub=e.PubSub,this.jsMediaEngine=e.jsMediaEngine,this.globalTracingLogger=e.globalTracingLogger,this.renderManager=e.renderManager,this.currentshareactive=0,this.isFromMainSession=0,this.sharingWidthAndHeightInfo={logicHeight:0,logicWidth:0},this.currentSharingHeight=0,this.currentSharingWidth=0,this.currentSharingLogicHeight=0,this.currentSharingLogicWidth=0,this.isCreateSharingWaterMark=!1,this.sharingWaterMarkName="",this.isWaterMarkRepeatedEnable=!1,this.waterMarkOpacity=.15,this.SharingCanvasSizeInfo=null,this.Cursorx=null,this.Cursory=null,this.CursorWidth=null,this.CursorHeight=null,this.xratio=1,this.yratio=1,this.sharingDisplay=null,this.mouseQueue=new B,this.sharingQueue=new B,this.WaterMarkRGBA=new Lr.A,this.sMonitorCount=0,this.mMonitorCount=0,this.firstFrameForIOS=!1,this.timestart=0,this.asTime=0,this.rAFID=0,this.requestAnimation=!1,this.requestF=this.No_Bindthis_RAF.bind(this),this.cATimeStamp=0,this.lRTimeStamp=0,this.pacingtime=1,this.sharingFps=0,this.lfTimeStamp=0,this.maxQueueLength=0,this.vaTimeDelta=0,this.renderMode=0,this.SharingRenderInterval=0,this.RAFhealthCheckInterval=0,this.RAFLastTime=0,this.brefresh=!1,this.statisticObj=null}Xr.prototype.Start_Draw=function(){return this.requestAnimation=!0,this.Start_Request_Animation_Frame()},Xr.prototype.Stop_Draw=function(){return this.requestAnimation=!1,this.lRTimeStamp=0,this.cATimeStamp=0,this.Stop_Request_Animation_Frame()},Xr.prototype.Start_Request_Animation_Frame=function(){return this.rAFID=requestAnimationFrame(this.requestF),this.rAFID},Xr.prototype.Stop_Request_Animation_Frame=function(){this.rAFID&&(cancelAnimationFrame(this.rAFID),this.rAFID=0)},Xr.prototype.No_Bindthis_RAF=function(){let e=performance.now();this.RAFLastTime=e,this.requestAnimation?(this.calPacingTime(e),e-this.timestart>this.pacingtime&&(this.timestart=e,this.JsMediaSDK_SharingRender()),this.Start_Request_Animation_Frame()):this.Stop_Request_Animation_Frame()},Xr.prototype.No_Bindthis_Interval=function(){let e=performance.now();this.calPacingTime(e),e-this.timestart>this.pacingtime&&(this.timestart=e,this.JsMediaSDK_SharingRender())},Xr.prototype.calPacingTime=function(e){this.pacingtime=30,this.sharingFps&&this.sharingFps>0&&this.sharingFps<100&&(this.pacingtime=1e3/this.sharingFps);let t=this.Get_Current_QueueLength();if(this.cATimeStamp&&this.lRTimeStamp){let i=this.cATimeStamp+e-this.asTime;this.vaTimeDelta=this.lRTimeStamp+this.pacingtime-i,this.vaTimeDelta>65&&this.vaTimeDelta<1e4&&t>1&&(this.pacingtime=1.5*this.pacingtime),this.vaTimeDelta<-65&&(this.pacingtime=1*this.pacingtime/2)}else this.cATimeStamp||(this.pacingtime>150||t>20?this.pacingtime=1*this.pacingtime/2:this.pacingtime=this.pacingtime-10)},Xr.prototype.JsMediaSDK_SharingRender=function(){var e,t,i;if(this.sharingDisplay)if(!1!==(null===(e=(t=this.sharingDisplay).isAvaiable)||void 0===e?void 0:e.call(t))){null===(i=this.statisticObj)||void 0===i||i.sample();var r=this.Get_Decoded_Sharing_Frame(this.currentshareactive,this.isFromMainSession),a=this.Get_Decoded_Mouse_Frame(this.currentshareactive,this.isFromMainSession);if(r){let e,t;this.lRTimeStamp=r.ntptime,r.yuvdata instanceof $e?(e=r.yuvdata.yuvdata,t=r.yuvdata):(e=r.yuvdata,t=null),this.sharingWidthAndHeightInfo.logicWidth==r.logic_w&&this.sharingWidthAndHeightInfo.logicHeight==r.logic_h||(this.PubSub?PubSub.publish(u.vjv,{body:{width:r.logic_w,height:r.logic_h,logicWidth:r.logic_w,logicHeight:r.logic_h}}):(postMessage({status:M.Rm,logicWidth:r.logic_w,logicHeight:r.logic_h}),this.updateOffscreenCanvasSize(r.logic_w,r.logic_h)),this.sharingWidthAndHeightInfo.logicWidth=r.logic_w,this.sharingWidthAndHeightInfo.logicHeight=r.logic_h);var n=r.logic_h,s=r.logic_w,o=r.r_h,d=r.r_w;this.xratio=d/s,this.yratio=o/n;var c={top:r.r_x,left:r.r_y,height:r.r_h,width:r.r_w};this.currentSharingHeight==r.r_h&&this.currentSharingWidth==r.r_w&&this.currentSharingLogicHeight==r.logic_h&&this.currentSharingLogicWidth==r.logic_w||(this.Notify_APPUI?this.Notify_APPUI(u.cYb,{body:{height:r.logic_h,width:r.logic_w,logicHeight:r.logic_h,logicWidth:r.logic_w}}):(postMessage({status:M.Rm,logicWidth:r.logic_w,logicHeight:r.logic_h}),this.updateOffscreenCanvasSize(r.logic_w,r.logic_h)),this.currentSharingHeight=r.r_h,this.currentSharingWidth=r.r_w,this.currentSharingLogicHeight=r.logic_h,this.currentSharingLogicWidth=r.logic_w);const i=this.SharingCanvasSizeInfo?this.SharingCanvasSizeInfo.width:r.r_w,a=this.SharingCanvasSizeInfo?this.SharingCanvasSizeInfo.height:r.r_h;this.Should_Update_Watermark(this.sharingDisplay,i,a)&&this.Update_Display_Watermark(this.sharingDisplay,i,a),3e3==this.sMonitorCount&&(this.jsMediaEngine?this.jsMediaEngine.Send_Render_Monitor_Log("SDIMM"):postMessage({status:M.SG,data:"SDIMW"}),this.sMonitorCount=0),this.sMonitorCount++,this.sharingDisplay.drawNextOutputPictureFrame(r.width,r.height,c,e,null,r.yuv_limited),t&&t.recycle(),r.dataptr&&Module._free(r.dataptr)}else if(this.brefresh&&(this.brefresh=!1,0!=this.sharingDisplay.getTextureWidth()&&0!=this.sharingDisplay.getTextureHeight()&&0!==this.currentSharingWidth&&0!==this.currentSharingHeight)){const e=this.SharingCanvasSizeInfo?this.SharingCanvasSizeInfo.width:this.currentSharingWidth,t=this.SharingCanvasSizeInfo?this.SharingCanvasSizeInfo.height:this.currentSharingHeight;this.Should_Update_Watermark(this.sharingDisplay,e,t)&&this.Update_Display_Watermark(this.sharingDisplay,e,t),this.sharingDisplay.drawNextOutputPictureFrame(this.sharingDisplay.getTextureWidth(),this.sharingDisplay.getTextureHeight(),this.sharingDisplay.getCroppingParams(),null,this.picRotation,!0,null,!1),r=!0}a&&(this.Cursorx=a.r_x*this.xratio,this.Cursory=a.r_y*this.yratio,this.CursorWidth=a.width*this.xratio,this.CursorHeight=a.height*this.yratio,this.sharingDisplay.updateCursor(a.width,a.height,a.buffer),3e3==this.mMonitorCount&&(this.jsMediaEngine?this.jsMediaEngine.Send_Render_Monitor_Log("SDSBM"):postMessage({status:M.SG,data:"SDSBW"}),this.mMonitorCount=0),this.mMonitorCount++,this.sharingDisplay.drawCursor(1,this.Cursorx,this.Cursory,this.CursorWidth,this.CursorHeight)),r&&this.renderManager.renderFor(Nr.gz.SHARE)}else{var h,l;null===(h=(l=this.sharingDisplay).restoreContext)||void 0===h||h.call(l)}else Ye("JsMediaSDK_SharingRender error, display is null")},Xr.prototype.setOnlyAcceptUISize=function(e){this.bOnlyAcceptUISize=e},Xr.prototype.updateOffscreenCanvasSize=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.bOnlyAcceptUISize&&!i)return console.log("drop logic w/h");try{let i=this.sharingDisplay.getAttachedCanvas();i&&i instanceof OffscreenCanvas&&(i.width=e,i.height=t,this.brefresh=!0)}catch(e){this.Log_Error("Error updating OffscreenCanvas size",e)}},Xr.prototype.Set_Render_Display=function(e){this.sharingDisplay=e},Xr.prototype.Change_Current_SSRC=function(e,t){this.currentshareactive=e,this.currentSharingHeight=0,this.currentSharingWidth=0,this.currentSharingLogicHeight=0,this.currentSharingLogicWidth=0,this.isFromMainSession=t,this.firstFrameForIOS=!1,this.ClearQueue()},Xr.prototype.Set_WaterMark_Info=function(e){let{waterMarkCanvas:t,isCreateSharingWaterMark:i,sharingWaterMarkName:r,watermarkOpacity:a,watermarkRepeated:n,watermarkPosition:s}=e;i||(this.SharingCanvasSizeInfo=null),this.Replace_WaterMark_Canvas(t),this.isCreateSharingWaterMark=i,this.sharingWaterMarkName=r,void 0!==n&&(this.isWaterMarkRepeatedEnable=!!n),void 0!==a&&(this.waterMarkOpacity=a),void 0!==s&&(this.watermarkPosition=s)},Xr.prototype.Replace_WaterMark_Canvas=function(e){this.waterMarkCanvas=e},Xr.prototype.Set_WaterMark_Flag=function(e){this.sharingDisplay.setWatermarkFlag(e?1:0)},Xr.prototype.Should_Watermark_Repeated=function(e,t){return this.isWaterMarkRepeatedEnable&&e>306&&t>202};const Yr=function(e,t){if(e<640&&e){const i=640/e;e=640,t=Math.round(t*i)}return{width:e,height:t}};Xr.prototype.Update_Display_Watermark=function(e,t,i){if("function"==typeof OffscreenCanvas&&this.waterMarkCanvas instanceof OffscreenCanvas&&OffscreenCanvasRenderingContext2D&&!OffscreenCanvasRenderingContext2D.prototype.measureText)return;const r=t<512||i<288?16:this.watermarkPosition,a=this.Should_Watermark_Repeated(t,i),n=Yr(t,i);t=n.width,i=n.height;const s=a?this.WaterMarkRGBA.Get_Repeated_WaterMarkRGBA({canvas:this.waterMarkCanvas,name:this.sharingWaterMarkName,width:t,height:i,opacity:this.waterMarkOpacity,position:r}):this.WaterMarkRGBA.Get_WaterMarkRGBA({canvas:this.waterMarkCanvas,name:this.sharingWaterMarkName,width:t,height:i,opacity:this.waterMarkOpacity,position:r});e.updateWatermark(t,i,s)},Xr.prototype.Should_Update_Watermark=function(e,t,i){if(!this.isCreateSharingWaterMark)return!1;let r=!1;const a=Yr(t,i);a.width===e.getWatermarkWidth()&&a.height===e.getWatermarkHeight()||(r=!0);const n=this.Should_Watermark_Repeated(t,i);e.isSetWatermark()||(r=!0),n!==e.isWatermarkRepeated()&&(r=!0,e.setWatermarkRepeated(n)),this.waterMarkOpacity&&this.waterMarkOpacity!==e.getWatermarkOpacity()&&(r=!0,e.setWatermarkOpacity(this.waterMarkOpacity));const s=t<512||i<288?16:this.watermarkPosition;return s!==e.getWatermarkPosition()&&(r=!0,e.setWatermarkPosition(s)),r},Xr.prototype.Update_Sharing_Canvas_Size=function(e){let{width:t,height:i}=e;this.SharingCanvasSizeInfo={width:Math.round(t),height:Math.round(i)}},Xr.prototype.ClearQueue=function(){try{let e=this.sharingQueue.ssrcQueueMap;for(let[t,i]of e)for(;!i.isEmpty();){let e=i.dequeue();e.yuvdata&&e.yuvdata instanceof $e&&e.yuvdata.recycle(),e.dataptr&&Module._free(e.dataptr)}}catch(e){this.Log_Error("Exception from SharingRender.ClearQueue",e)}this.sharingQueue&&this.sharingQueue.ClearQueue(),this.mouseQueue&&this.mouseQueue.ClearQueue(),this.currentSharingHeight=0,this.currentSharingWidth=0,this.currentSharingLogicHeight=0,this.currentSharingLogicWidth=0},Xr.prototype.Get_Decoded_Sharing_Frame=function(e,t){if(!this.sharingQueue)return null;var i=this.GetLogicalSSRCPart(e,t),r=this.sharingQueue.GetQueue(i);return r?r.dequeue():null},Xr.prototype.Get_Decoded_Mouse_Frame=function(e,t){if(this.mouseQueue){var i=this.GetLogicalSSRCPart(e,t),r=this.mouseQueue.GetQueue(i);return r?r.dequeue():null}},Xr.prototype.Put_Sharing_Data_From_Queue=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;if(this.sharingQueue){var i=this.GetLogicalSSRCPart(e.ssrc,e.isFromMainSession);this.firstFrameForIOS||i!=this.currentshareactive>>10||(this.firstFrameForIOS=!0,this.Notify_APPUI?this.Notify_APPUI(u.jhI,this.currentshareactive):postMessage({status:M.Vd,ssrc:this.currentshareactive}));var r=this.sharingQueue.GetQueue(i);r||(r=this.sharingQueue.AddQueue(i)),r.enqueue(e),this.lfTimeStamp&&(this.sharingFps?this.sharingFps=500/(e.ntptime-this.lfTimeStamp)+this.sharingFps/2:this.sharingFps=1e3/(e.ntptime-this.lfTimeStamp)),this.sharingFps!=1/0&&this.sharingFps||(this.sharingFps=20),this.lfTimeStamp=e.ntptime;var a=this.sharingQueue.GetQueueLength(i)-t;for(this.maxQueueLength=t;a>=0;){let t=this.Get_Decoded_Sharing_Frame(e.ssrc,e.isFromMainSession);t.yuvdata instanceof $e&&t.yuvdata.recycle(),t.dataptr&&Module._free(t.dataptr),a--}}},Xr.prototype.Get_Current_QueueLength=function(){if(!this.sharingQueue)return;let e=this.currentshareactive;var t=this.GetLogicalSSRCPart(e,this.isFromMainSession);return this.sharingQueue.GetQueueLength(t)},Xr.prototype.Put_Mouse_Data_Into_Queue=function(e){if(this.mouseQueue){var t=this.GetLogicalSSRCPart(e.ssrc,e.isFromMainSession),i=this.mouseQueue.GetQueue(t);i||(i=this.mouseQueue.AddQueue(t)),i.enqueue(e);for(var r=this.mouseQueue.GetQueueLength(t)-10;r>=0;)this.Get_Decoded_Mouse_Frame(e.ssrc,e.isFromMainSession),r--}},Xr.prototype.GetLogicalSSRCPart=function(e,t){let i=e>>10;return t&&(i|=1<<23),i},Xr.prototype.SetcATimeStamp=function(e){this.cATimeStamp=e,this.asTime=performance.now()},Xr.prototype.Log_Error=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.globalTracingLogger?this.globalTracingLogger.error(e,t):Ye(e,t)},Xr.prototype.Log_DT=function(e){this.globalTracingLogger?this.globalTracingLogger.directReport(e):Qe(e)},Xr.prototype.setMode=function(e){this.Stop_Draw2(),this.renderMode=e},Xr.prototype.Start_Draw2=function(e){var t;null===(t=this.statisticObj)||void 0===t||t.start(),this.renderMode?(this.SharingRenderInterval&&(clearInterval(this.SharingRenderInterval),this.SharingRenderInterval=0),this.SharingRenderInterval=setInterval((()=>{this.No_Bindthis_Interval()}),20)):(this.Start_Draw(),this.startRAFHealthCheck())},Xr.prototype.Stop_Draw2=function(e){var t;null===(t=this.statisticObj)||void 0===t||t.stop(),this.renderMode?this.SharingRenderInterval&&(clearInterval(this.SharingRenderInterval),this.SharingRenderInterval=0):(this.Stop_Draw(),this.stopRAFHealthCheck())},Xr.prototype.startRAFHealthCheck=function(){this.RAFLastTime=performance.now(),this.RAFhealthCheckInterval=setInterval((()=>{let e=performance.now();!this.renderMode&&e-this.RAFLastTime>2e3&&(this.Stop_Draw2(),this.setMode(1),this.Start_Draw2(),this.Log_DT("Sharing RAF Failed"))}),2e3)},Xr.prototype.stopRAFHealthCheck=function(){this.RAFLastTime=0,this.RAFhealthCheckInterval&&clearInterval(this.RAFhealthCheckInterval)},Xr.prototype.reDraw=function(){this.brefresh=!0,this.JsMediaSDK_SharingRender()},Xr.prototype.getUserIdVideo=function(e,t){if(this.currentshareactive>>10!=e>>10||!this.sharingDisplay)return null;const i=this.sharingDisplay.getAttachedCanvas();if(!i)return null;const r=this.sharingDisplay.getCanvasId(),{width:a,height:n}=i;return{canvasId:r,canvas:i,options:{x:0,y:0,width:a,height:n,displayWidth:a,displayHeight:n}}};const Qr=Xr;function Jr(e,t){const i=Math.pow(10,t);return Math.floor(e*i)/i}function Zr(e,t){const i=Math.pow(10,t);return Math.ceil(e*i)/i}function $r(e,t,i){if(!e||t<0||i<0)throw new Error("isDimensionsOverMaxDimension2DSize() invalid parameters. res=".concat(e,", width=").concat(t,", height=").concat(i));let r=!1,a=0;const n=e.acquireGPUFeaturesHelper();return n&&(a=n.queryMaxTextureDimension2D(),a>0&&(r=t>a||i>a)),r&&(console.log("isDimensionsOverMaxDimension2DSize() w:".concat(t," h:").concat(i," max:").concat(a)),Je("WGPU isDimensionsOverMaxDimension2DSize() w:".concat(t," h:").concat(i," max:").concat(a))),r}function ea(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function ta(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ea(Object(i),!0).forEach((function(t){(0,o.A)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ea(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}let ia=new Map,ra=[];function aa(e){e.preventDefault()}function na(e,t,i,r,a,n,s){let o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.canvasElement=e,this.canvasID=t,this.contextOptions=a,this.textureindex=i||0,this.texturestride=this.textureindex?3:s?4:6,this.initmask=s||!1,this.reuse=!1,this.isEnableCanvasAlphaChannel=o,na.prototype.ROTATION_CLOCK0=0,na.prototype.ROTATION_CLOCK90=1,na.prototype.ROTATION_CLOCK180=2,na.prototype.ROTATION_CLOCK270=3,this.webGLResources=n,n||(this.initContextGL(),this.contextGL&&(this.webGLContextLostProtect(),this.contextGL.isContextLost()&&this.restoreContext())),this.reinit(n);var d=new ArrayBuffer(4);this.dummpyCursor=new Uint8Array(d),this.dummpyWaterMark=new Uint8Array(d),this.cursorWidth=0,this.cursorHeight=0,this.hasCursor=0,this.hasWaterMark=0,this.watermarkOpacity=.15,this.watermarkData=null,this.watermarkWidth=0,this.watermarkHeight=0,this.isMultiView=!1,this.hasWholeFrame=0,this.croppingParams={},this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.width=0,this.croppingParams.height=0,this.textureWidth=0,this.textureHeight=0,this.canvasWidth=0,this.canvasHeight=0,this.picRotation=-1,this.bgColor=[0,0,0],this.cx=0,this.cy=0,this.cw=0,this.ch=0,this.colorRange=-1,this.videoMode=h,this.rotation=this.ROTATION_CLOCK0,this.fillMode=0,this.fillModeForResolution=0,this.viewPostion=null}na.prototype.reinit=function(e){if(this.webGLResources=e,!this.contextGL||this.contextGL.isContextLost()||this.contextGL.glInitSucceed||this.webGLResources){if(this.webGLResources&&this.webGLResources.contextgl&&!this.webGLResources.contextgl.isContextLost()){this.contextGL=this.webGLResources.contextgl,this.shaderProgram=this.webGLResources.program,this.waterMarkTextureRef=this.webGLResources.waterMarkTextureRef,this.repeatedWaterMarkTextureRef=this.webGLResources.repeatedWaterMarkTextureRef,this.initTextures(!1),this.vertexPosBuffer=this.webGLResources.vBuffer,this.texturePosBuffer=this.webGLResources.tBuffer;let e=this.contextGL.getError();this.contextGL.glInitSucceed=e!=this.contextGL.NO_ERROR&&e!=this.contextGL.CONTEXT_LOST_WEBGL?0:1}}else{this.initProgram(),this.initmask?this.initTextures(!1):this.initTextures(!0),this.initBuffers();let e=this.contextGL.getError();this.contextGL.glInitSucceed=e!=this.contextGL.NO_ERROR&&e!=this.contextGL.CONTEXT_LOST_WEBGL?0:1}},na.prototype.webGLContextLostSimulate=function(){let e="undefined"==typeof window?self:window;e.webGLEXTSimulate=e.webGLEXTSimulate||[],e.webGLEXTSimulate.push(tt(this.contextGL,"WEBGL_lose_context"))},na.prototype.restoreContext=function(){if(this.contextGL)try{var e,t;null!==(e=this.canvasElement)&&void 0!==e&&e.loseContextExtension&&!this.canvasElement.restoreTimeoutId&&this.contextGL.isContextLost()&&(this.canvasElement.restoreTimeoutId=setTimeout((()=>{Ze("WebGLRestoreTimeout")}),1500),null===(t=this.canvasElement)||void 0===t||t.loseContextExtension.restoreContext())}catch(e){Xe("webgl restoreContext exception",e)}},na.prototype.webgGLContextLostCallback=function(e){Qe("webglcontextlost event: canvas listener size=".concat(ra.length,",  canvas id: ").concat(this.canvasID,", , ids:").concat(ra.join())),e.preventDefault(),this.contextGL.glInitSucceed=0,this.contextOptions&&this.contextOptions.webglcontextlostCallback&&this.contextOptions.webglcontextlostCallback(e,this.contextOptions.params)},na.prototype.removeEventListener=function(e,t){if(e&&t){e.restoreTimeoutId&&(clearTimeout(e.restoreTimeoutId),e.restoreTimeoutId=void 0),e.removeEventListener("webglcontextlost",t.contextLostHandler),e.removeEventListener("webglcontextrestored",t.contextRestoredHandler);const i=ra.indexOf(this.canvasID);ra.splice(i,1),ia.delete(e)}},na.prototype.webGLContextRestoredCallback=function(e){Qe("webglcontextrestored event from canvas id: ".concat(this.canvasID)),this.canvasElement.restoreTimeoutId&&(clearTimeout(this.canvasElement.restoreTimeoutId),this.canvasElement.restoreTimeoutId=void 0),this.reinit(),this.contextOptions&&this.contextOptions.webglcontextrestoredCallback&&this.contextOptions.webglcontextrestoredCallback(e,this.contextOptions.params)},na.prototype.webGLContextLostProtect=function(){this.canvasElement&&!this.canvasElement.loseContextExtension&&(this.canvasElement.loseContextExtension=tt(this.contextGL,"WEBGL_lose_context"));let e=this.canvasElement,t=ia.get(e);t&&this.removeEventListener(e,t),ia.set(e,this),this.contextLostHandler=this.webgGLContextLostCallback.bind(this),this.contextRestoredHandler=this.webGLContextRestoredCallback.bind(this),e.addEventListener("webglcontextlost",this.contextLostHandler,{capture:!1}),e.addEventListener("webglcontextrestored",this.contextRestoredHandler,{capture:!1}),-1===ra.indexOf(this.canvasID)&&(ra.push(this.canvasID),ra.length>4&&Qe("webglcanvas listener size=".concat(ra.length,", ids:").concat(ra.join())))},na.prototype.isWebGL=function(){return this.contextGL},na.prototype.isAvaiable=function(){return this.contextGL&&!this.contextGL.isContextLost()&&this.contextGL.glInitSucceed},na.prototype.initContextGL=function(){for(var e,t,i,r=this.canvasElement,a=null,n=["webgl","experimental-webgl","moz-webgl","webkit-3d"],s=0;!a&&s<n.length;){var o=n[s];try{if($.isEnableCanvasCtxOptionsOpt()){let e={depth:!1,stencil:!1,antialias:!1,alpha:this.isEnableCanvasAlphaChannel};if(this.contextOptions){let t=ta(ta({},this.contextOptions),e);a=r.getContext(o,t)}else a=r.getContext(o,e)}else a=this.contextOptions?r.getContext(o,this.contextOptions):r.getContext(o)}catch(e){a=null}a&&"function"==typeof a.getParameter||(a=null),++s}if(this.contextGL=a,!a||a.isContextLost())return Xe("Failed when trying to get WebGLContext on canvas(".concat(null===(e=this.canvasElement)||void 0===e?void 0:e.width,",").concat(null===(t=this.canvasElement)||void 0===t?void 0:t.height,"), gl=").concat(a,", lost=").concat(null===(i=a)||void 0===i?void 0:i.isContextLost())),void Ze("InitWebGLFail");a.glInitSucceed=0},na.prototype.initProgram=function(){var e=this.contextGL,t=e.createShader(e.VERTEX_SHADER);e.shaderSource(t,"\n    attribute vec4 vertexPos;\n    attribute vec4 texturePos;\n    attribute vec4 masktexturePos;\n    varying vec2 textureCoord;\n    varying vec2 masktextureCoord;\n\n    void main() {\n        gl_Position = vertexPos;\n        textureCoord = texturePos.xy;\n        masktextureCoord = masktexturePos.xy;\n    }\n  "),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||e.isContextLost()||Qe("webgl Vertex shader failed to compile: "+e.getShaderInfoLog(t));var i=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(i,"\n    precision highp float;\n    varying highp vec2 textureCoord;\n    varying highp vec2 masktextureCoord;\n    \n    uniform sampler2D ySampler;\n    uniform sampler2D uSampler;\n    uniform sampler2D vSampler;\n    uniform sampler2D cursorSampler;\n    uniform sampler2D waterMarkSampler;\n    uniform sampler2D previewVideoSampler;\n    uniform sampler2D maskSampler;\n    \n    uniform vec4 cursorInfo;\n    uniform int onlyRGBA;\n    uniform int bgraMode;\n    uniform int colorRange;\n    uniform int waterMarkFlag;\n    uniform int cursorFlag;\n    uniform int yuvmode;\n    \n    const int MAX_ELLIPSE_COUNT = 10;\n    uniform int maskFlag;                       // 0: mask disabled; 1: mask enabled;\n    uniform int maskMode;                       // 0: static mask; 1: dynamic mask;\n    uniform vec4 uEllipses[MAX_ELLIPSE_COUNT];  // each ellipse contains (cx, cy, rx, ry) 4-coords\n    uniform int uEllipseCount;                  // how many ellipses will draw\n\n    const mat4 YUV2RGB_L = mat4(\n      1.1643828125, 0, 1.59602734375, -0.87078515625,\n      1.1643828125, -0.39176171875, -0.81296875, 0.52959375,\n      1.1643828125, 2.017234375, 0, -1.081390625,\n      0, 0, 0, 1\n    );\n\n    const mat4 YUV2RGB_F = mat4(\n      1.0, 0, 1.402, -0.701,\n      1.0, -0.34413, -0.71414, 0.529135,\n      1.0, 1.772, 0, -0.886,\n      0, 0, 0, 1\n    );\n\n    void main(void) {\n      vec4 c;\n      if (waterMarkFlag != 1) {\n        if (onlyRGBA == 0) {\n          highp float y = texture2D(ySampler, textureCoord).r;\n          highp float u;\n          highp float v;\n\n          if (yuvmode == 1) {\n            u = texture2D(uSampler, textureCoord).r;\n            v = texture2D(vSampler, textureCoord).r;\n          } else {\n            u = texture2D(uSampler, textureCoord).r;\n            v = texture2D(uSampler, textureCoord).a;\n          }\n\n          if (colorRange == 0) {\n            c = vec4(y, u, v, 1) * YUV2RGB_L;\n          } else {\n            c = vec4(y, u, v, 1) * YUV2RGB_F;\n          }\n\n          if (cursorFlag == 1) {\n            if (cursorInfo.z > 0.0 && \n                textureCoord.x >= cursorInfo.x && \n                textureCoord.y >= cursorInfo.y && \n                textureCoord.x < cursorInfo.x + cursorInfo.z && \n                textureCoord.y < cursorInfo.y + cursorInfo.w) {\n              \n              vec2 cursorCoord = textureCoord - cursorInfo.xy;\n              cursorCoord /= cursorInfo.zw;\n              vec4 cursor = texture2D(cursorSampler, cursorCoord);\n              c = c * (1.0 - cursor.a) + cursor * cursor.a;\n            }\n          }\n        } else {\n          c = texture2D(previewVideoSampler, textureCoord);\n          if (bgraMode == 1) {\n            c = vec4(c.b, c.g, c.r, c.a);\n          }\n        }\n      } else {\n        c = texture2D(waterMarkSampler, textureCoord);\n        if (c.r == 0.0 && c.g == 0.0 && c.b == 0.0) {\n          c.a = 0.0;\n        }\n      }\n\n      if (maskFlag == 1 && waterMarkFlag != 1) {\n        vec4 mask = texture2D(maskSampler, masktextureCoord);\n        if (maskMode == 0) {\n          // -- handle static mask --\n          if (mask.r != 0.0 || mask.g != 0.0 || mask.b != 0.0) {\n            c = mask * mask.a + c * (1.0 - mask.a);\n          }\n        } else if (maskMode == 1) {\n          // -- handle dynamic mask -- \n          bool inEllipse = false; // variable for checking whether the pixel to be drawn hits ellipse\n          for (int i = 0; i < MAX_ELLIPSE_COUNT; i++) {\n            if (i > uEllipseCount) break;\n\n            vec2 ellipseCenter = uEllipses[i].xy;\n            vec2 ellipseRadii = uEllipses[i].zw;\n            vec2 ellipsePos = masktextureCoord - ellipseCenter;\n\n            float ellipseEq = (ellipsePos.x * ellipsePos.x) / (ellipseRadii.x * ellipseRadii.x) + \n                              (ellipsePos.y * ellipsePos.y) / (ellipseRadii.y * ellipseRadii.y);\n            if (ellipseEq <= 1.0) {\n              // the pixel in the ellipse range\n              inEllipse = true;\n              break;\n            }\n          }\n\n          if (inEllipse) {\n            c = mask * mask.a + c * (1.0 - mask.a);\n          }\n        }\n      }\n\n      if (waterMarkFlag != 1) {\n        c.a = 1.0;\n      }\n\n      gl_FragColor = c;\n    }\n"),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||e.isContextLost()||Qe("webgl Fragment shader failed to compile: "+e.getShaderInfoLog(i));var r=e.createProgram();e.attachShader(r,t),e.attachShader(r,i),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||e.isContextLost()||Qe("webgl Program failed to compile: "+e.getProgramInfoLog(r)),e.useProgram(r),this.shaderProgram=r},na.prototype.initBuffers=function(){var e=this.contextGL,t=this.shaderProgram,i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1,1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var r=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(r),e.vertexAttribPointer(r,2,e.FLOAT,!1,0,0),this.vertexPosBuffer=i;var a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1,1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var n=e.getAttribLocation(t,"texturePos");if(e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),this.initmask&&!this.masktexturePosBuffer){var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var o=e.getAttribLocation(t,"masktexturePos");e.enableVertexAttribArray(o),e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0),this.masktexturePosBuffer=s}this.texturePosBuffer=a},na.prototype.initTextures=function(e){var t=this.contextGL,i=this.shaderProgram;t.pixelStorei(t.UNPACK_ALIGNMENT,1);var r=this.initTexture();this.yTextureRef=r,this.oyTextureRef=r;var a=this.initTexture();this.uTextureRef=a,this.ouTextureRef=a;var n=this.initTexture();if(this.vTextureRef=n,this.ovTextureRef=n,e){this.BindTextures(1);var s=this.initTexture(),o=t.getUniformLocation(i,"cursorSampler");t.uniform1i(o,this.textureindex*this.texturestride+3),this.cursorTextureRef=s;var d=this.initTexture(),c=t.getUniformLocation(i,"waterMarkSampler");t.uniform1i(c,4),this.waterMarkTextureRef=d;var u=this.initTexture();this.repeatedWaterMarkTextureRef=u;var h=this.initTexture(),l=t.getUniformLocation(i,"previewVideoSampler");t.uniform1i(l,this.textureindex*this.texturestride+5),this.previewVideoTextureRef=h;var p=t.getUniformLocation(i,"cursorInfo");this.cursorInfoRef=p}if(this.initmask){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1);var f=this.initTexture(),g=t.getUniformLocation(i,"maskSampler");t.uniform1i(g,this.textureindex*this.texturestride+6),this.maskTextureRef=f}var m=t.getUniformLocation(i,"colorRange");this.colorRangeRef=m,this.onlyRGBARef=t.getUniformLocation(i,"onlyRGBA"),this.bgraModeRef=t.getUniformLocation(i,"bgraMode"),this.waterMarkFlagRef=t.getUniformLocation(i,"waterMarkFlag"),this.maskFlagRef=t.getUniformLocation(i,"maskFlag"),this.cursorFlagRef=t.getUniformLocation(i,"cursorFlag"),this.yuvmodeRef=t.getUniformLocation(i,"yuvmode")},na.prototype.BindTextures=function(e){var t=this.contextGL,i=this.shaderProgram;if(t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.activeTexture(t.TEXTURE0+0),t.bindTexture(t.TEXTURE_2D,this.yTextureRef),t.activeTexture(t.TEXTURE0+1),t.bindTexture(t.TEXTURE_2D,this.uTextureRef),t.activeTexture(t.TEXTURE0+2),t.bindTexture(t.TEXTURE_2D,this.vTextureRef),1==e){let e=t.getUniformLocation(i,"ySampler");t.uniform1i(e,0);let r=t.getUniformLocation(i,"uSampler");t.uniform1i(r,1);let a=t.getUniformLocation(i,"vSampler");t.uniform1i(a,2)}else if(this.isRGBAMode(e)){let e=t.getUniformLocation(i,"previewVideoSampler");t.uniform1i(e,0);let r=t.getUniformLocation(i,"ySampler");t.uniform1i(r,0);let a=t.getUniformLocation(i,"uSampler");t.uniform1i(a,0);let n=t.getUniformLocation(i,"vSampler");t.uniform1i(n,0)}else if(2==e){let e=t.getUniformLocation(i,"ySampler");t.uniform1i(e,0);let r=t.getUniformLocation(i,"uSampler");t.uniform1i(r,1);let a=t.getUniformLocation(i,"vSampler");t.uniform1i(a,0)}let r=t.getUniformLocation(i,"previewVideoSampler");t.uniform1i(r,0);let a=t.getUniformLocation(i,"maskSampler");this.initmask?(t.activeTexture(t.TEXTURE0+6),t.bindTexture(t.TEXTURE_2D,this.maskTextureRef),t.uniform1i(a,6)):t.uniform1i(a,0);let n=t.getUniformLocation(i,"cursorSampler");t.uniform1i(n,0);let s=t.getUniformLocation(this.shaderProgram,"waterMarkSampler");t.uniform1i(s,0)},na.prototype.initTexture=function(){var e=this.contextGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t},na.prototype.clearDisplay=function(){var e=this.contextGL;e&&(e.enable(e.BLEND),e.blendFunc(e.ZERO,e.ZERO)),this.render()},na.prototype.cleanup=function(){let e=this.canvasElement,t=ia.get(e);if(t&&this.removeEventListener(e,t),e.defaultContextLostHandler||(e.defaultContextLostHandler=aa,e.addEventListener("webglcontextlost",aa,{capture:!1})),this.isAvaiable()){var i=this.contextGL;i.deleteProgram(this.program),i.activeTexture(i.TEXTURE0+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE1+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE2+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),this.textureindex||this.initmask||(i.activeTexture(i.TEXTURE3+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE4+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(this.getRepeatedWatermarkTextureValue(i)),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE5+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null)),i.bindBuffer(i.ARRAY_BUFFER,null),i.deleteTexture(this.yTextureRef),i.deleteTexture(this.uTextureRef),i.deleteTexture(this.vTextureRef),this.textureindex||this.initmask||(i.deleteTexture(this.cursorTextureRef),i.deleteTexture(this.waterMarkTextureRef),i.deleteTexture(this.repeatedWaterMarkTextureRef),i.deleteTexture(this.previewVideoTextureRef),i.deleteBuffer(this.vertexPosBuffer),i.deleteBuffer(this.texturePosBuffer)),this.maskTextureRef&&i.deleteTexture(this.maskTextureRef),this.masktexturePosBuffer&&i.deleteBuffer(this.masktexturePosBuffer),i.glInitSucceed=0}},na.prototype.drawNextOutputPicture=function(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.contextGL?this.drawNextOutputPictureFrame(e,t,i,r,a):this.drawNextOuptutPictureRGBA(e,t,i,r)},na.prototype.updateVertexInfoForMultiView=function(e,t,i,r,a){var n,s,o,d,c=this.contextGL;if(this.isUseFillMode({width:i,height:r,rotation:a}))n=0,s=0,o=1,d=1;else{var u=a==this.ROTATION_CLOCK90||a==this.ROTATION_CLOCK270?r:i,h=a==this.ROTATION_CLOCK90||a==this.ROTATION_CLOCK270?i:r,l=u/h*t;l>e?(n=0,o=1,d=1-(s=(t-h/u*e)/2/t)):(s=0,d=1,o=1-(n=(e-l)/2/e))}n=2*n-1,o=2*o-1,s=1-2*s,d=1-2*d;var p=new Float32Array([o,s,n,s,o,d,n,d,1,1,-1,1,1,-1,-1,-1]);this.viewPostion=p,c.bindBuffer(c.ARRAY_BUFFER,this.vertexPosBuffer),c.bufferData(c.ARRAY_BUFFER,p,c.DYNAMIC_DRAW)},na.prototype.getViewPosition=function(){let e=[0,0,1,1];if(!this.viewPostion)return e;const t=this.viewPostion[0],i=this.viewPostion[1],r=this.viewPostion[2],a=this.viewPostion[5];return e[0]=(1-i)/2,e[1]=(1+r)/2,e[2]=(1-a)/2,e[3]=(1+t)/2,e},na.prototype.updateTextureInfoForMultiView=function(e,t,i,r,a,n,s){var o,d,c,u,h=this.contextGL;if(this.isUseFillMode({width:i.width,height:i.height,rotation:r})){const a=r==this.ROTATION_CLOCK90||r==this.ROTATION_CLOCK270?s/n:n/s,h=i.left||0,l=i.top||0;if(i.width/i.height>a){const r=i.height*a;o=l/t,d=(Math.round((i.width-r)/2)+h)/e,c=o+(i.height-1)/t,u=d+r/e}else{const r=i.width/a;c=(o=(Math.round((i.height-r)/2)+l)/t)+(r-1)/t,u=(d=h/e)+i.width/e}}else o=Zr(i.top/t,2),d=Zr(i.left/e,2),c=Jr((i.top+i.height-1)/t,2),u=Jr((i.width-1+i.left)/e,2);var l=[d,o,u,o,u,c,d,c];r==this.ROTATION_CLOCK90&&(l.unshift(l[6],l[7]),l=l.slice(0,8)),r==this.ROTATION_CLOCK180&&(l.unshift(l[4],l[5],l[6],l[7]),l=l.slice(0,8)),r==this.ROTATION_CLOCK270&&(l.push(l[0],l[1]),l=l.slice(2,10));var p=l[0],f=l[1];if(l[0]=l[2],l[1]=l[3],l[2]=p,l[3]=f,a)if(r==this.ROTATION_CLOCK90||r==this.ROTATION_CLOCK270){let e=l[1];l[1]=l[3],l[3]=e,e=l[5],l[5]=l[7],l[7]=e}else l[0]=1-l[0],l[2]=1-l[2],l[4]=1-l[4],l[6]=1-l[6];var g=new Float32Array([...l,1,0,0,0,1,1,0,1]);h.bindBuffer(h.ARRAY_BUFFER,this.texturePosBuffer),h.bufferData(h.ARRAY_BUFFER,g,h.DYNAMIC_DRAW)},na.prototype.drawNextOutputPictureFrame=function(e,t,i,r,a){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];if(!this.isAvaiable())return;var d=this.contextGL,c=(this.texturePosBuffer,this.yTextureRef),u=this.uTextureRef,h=this.vTextureRef;d.enable(d.BLEND),d.blendFunc(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA),a=a||this.ROTATION_CLOCK0;var l=(i=i||{top:0,left:0,width:e,height:t}).width!=this.croppingParams.width||i.height!=this.croppingParams.height,p=i.top!=this.croppingParams.top||i.left!=this.croppingParams.left,f=d.canvas.width!=this.canvasWidth||d.canvas.height!=this.canvasHeight,g=e!=this.textureWidth||t!=this.textureHeight,m=a!=this.picRotation;(l||f||m)&&function(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;var n=e.contextGL;let s=n.canvas.width,o=n.canvas.height;a&&(s=a.width,o=a.height);var d,c,u,h,l=r==e.ROTATION_CLOCK90||r==e.ROTATION_CLOCK270?i:t,p=r==e.ROTATION_CLOCK90||r==e.ROTATION_CLOCK270?t:i,f=l/p*o;f>s?(d=0,u=1,h=1-(c=(o-p/l*s)/2/o)):(c=0,h=1,u=1-(d=(s-f)/2/s)),d=2*d-1,u=2*u-1,c=1-2*c,h=1-2*h;var g=new Float32Array([u,c,d,c,u,h,d,h,u,c,d,c,u,h,d,h]);n.bindBuffer(n.ARRAY_BUFFER,e.vertexPosBuffer),n.bufferData(n.ARRAY_BUFFER,g,n.DYNAMIC_DRAW)}(this,i.width,i.height,a,s),(l||p||g||m)&&function(e,t,i,r,a){var n=e.contextGL,s=r.top/i,o=r.left/t,d=s+(r.height-1)/i,c=o+r.width/t,u=[o,s,c,s,c,d,o,d];a==e.ROTATION_CLOCK90&&(u.unshift(u[6],u[7]),u=u.slice(0,8)),a==e.ROTATION_CLOCK180&&(u.unshift(u[4],u[5],u[6],u[7]),u=u.slice(0,8)),a==e.ROTATION_CLOCK270&&(u.push(u[0],u[1]),u=u.slice(2));var h=u[0],l=u[1];u[0]=u[2],u[1]=u[3],u[2]=h,u[3]=l;var p=new Float32Array([...u,1,0,0,0,1,1,0,1]);n.bindBuffer(n.ARRAY_BUFFER,e.texturePosBuffer),n.bufferData(n.ARRAY_BUFFER,p,n.DYNAMIC_DRAW)}(this,e,t,i,a);let v=n?0:1;v!=this.colorRange&&(d.uniform1i(this.colorRangeRef,v),this.colorRange=v),s?d.viewport(s.x,s.y,s.width,s.height):d.viewport(0,0,d.canvas.width,d.canvas.height),d.uniform1i(this.onlyRGBARef,0),d.uniform1i(this.yuvmodeRef,1),Object.assign(this.croppingParams,i),this.textureWidth=e,this.textureHeight=t,this.picRotation=a,this.canvasWidth=d.canvas.width,this.canvasHeight=d.canvas.height,d.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),d.clear(d.COLOR_BUFFER_BIT);var A=r,S=e*t;if(d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,c),o){var _=A.subarray(0,S);d.texImage2D(d.TEXTURE_2D,0,d.LUMINANCE,e,t,0,d.LUMINANCE,d.UNSIGNED_BYTE,_)}var y=e/2*t/2;if(d.activeTexture(d.TEXTURE1),d.bindTexture(d.TEXTURE_2D,u),o){var C=A.subarray(S,S+y);d.texImage2D(d.TEXTURE_2D,0,d.LUMINANCE,e/2,t/2,0,d.LUMINANCE,d.UNSIGNED_BYTE,C)}var b=y;if(d.activeTexture(d.TEXTURE2),d.bindTexture(d.TEXTURE_2D,h),o){var w=A.subarray(S+y,S+y+b);d.texImage2D(d.TEXTURE_2D,0,d.LUMINANCE,e/2,t/2,0,d.LUMINANCE,d.UNSIGNED_BYTE,w)}d.activeTexture(d.TEXTURE3),d.bindTexture(d.TEXTURE_2D,this.cursorTextureRef),this.hasCursor?d.uniform1i(this.cursorFlagRef,1):o&&d.texImage2D(d.TEXTURE_2D,0,d.RGBA,1,1,0,d.RGBA,d.UNSIGNED_BYTE,this.dummpyCursor),d.uniform4f(this.cursorInfoRef,this.cx,this.cy,this.cw,this.ch),d.activeTexture(d.TEXTURE5),d.bindTexture(d.TEXTURE_2D,this.previewVideoTextureRef),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,1,1,0,d.RGBA,d.UNSIGNED_BYTE,this.dummpyWaterMark);var E=d.getUniformLocation(this.shaderProgram,"maskSampler");d.uniform1i(E,5),this.render(),this.hasWholeFrame=1},na.prototype.updateTextureBlock=function(e,t,i,r,a){if(this.isAvaiable()){var n=this.contextGL,s=a;if(!(!this.hasWholeFrame||e<=0||t<=0||i<0||r<0||i+e>this.textureWidth||r+t>this.textureHeight)&&a&&a.length==e*t*3/2){var o=this.yTextureRef,d=this.uTextureRef,c=this.vTextureRef,u=e*t,h=s.subarray(0,u);n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o),n.texSubImage2D(n.TEXTURE_2D,0,i,r,e,t,n.LUMINANCE,n.UNSIGNED_BYTE,h);var l=e/2*t/2,p=s.subarray(u,u+l);n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,d),n.texSubImage2D(n.TEXTURE_2D,0,i/2,r/2,e/2,t/2,n.LUMINANCE,n.UNSIGNED_BYTE,p);var f=l,g=s.subarray(u+l,u+l+f);n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,c),n.texSubImage2D(n.TEXTURE_2D,0,i/2,r/2,e/2,t/2,n.LUMINANCE,n.UNSIGNED_BYTE,g)}}},na.prototype.updateCursor=function(e,t,i){if(this.isAvaiable()){var r=this.contextGL;e<=0||t<=0||!i||i.length!=e*t*4||(r.activeTexture(r.TEXTURE3),r.bindTexture(r.TEXTURE_2D,this.cursorTextureRef),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,i),this.cursorWidth=e,this.cursorHeight=t,this.hasCursor=1)}},na.prototype.updateWatermark=function(e,t,i){this.isAvaiable()&&(this.contextGL,e<=0||t<=0||!i||i.length!=e*t*4||(this.watermarkData=i,this.watermarkWidth=e,this.watermarkHeight=t,this.hasWaterMark=1))},na.prototype.drawWatermark=function(){if(this.isAvaiable()){var e=this.contextGL;if(this.isSetWatermark()&&this.watermarkData&&this.watermarkWidth&&this.watermarkHeight){e.uniform1i(this.waterMarkFlagRef,1),this.isWatermarkRepeated()?(e.activeTexture(this.getRepeatedWatermarkTextureValue(e)),e.bindTexture(e.TEXTURE_2D,this.repeatedWaterMarkTextureRef)):(e.activeTexture(e.TEXTURE4),e.bindTexture(e.TEXTURE_2D,this.waterMarkTextureRef)),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.watermarkWidth,this.watermarkHeight,0,e.RGBA,e.UNSIGNED_BYTE,this.watermarkData);let t=e.getUniformLocation(this.shaderProgram,"waterMarkSampler");e.uniform1i(t,this.isWatermarkRepeated()?this.getRepeatedWatermarkUniformValue():4),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLE_STRIP,4,4)}}},na.prototype.render=function(){if(this.isAvaiable()){var e=this.contextGL;e.uniform1i(this.waterMarkFlagRef,0),e.drawArrays(e.TRIANGLE_STRIP,0,4),this.drawWatermark()}},na.prototype.drawCursor=function(e,t,i,r,a){if(this.isAvaiable()){var n=this.contextGL;if(!(!this.hasWholeFrame||e&&(r<0||a<0))){n.viewport(0,0,n.canvas.width,n.canvas.height);var s=this.yTextureRef,o=this.uTextureRef,d=this.vTextureRef,c=this.cursorTextureRef;if(n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,s),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,o),n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,d),n.activeTexture(n.TEXTURE3),n.bindTexture(n.TEXTURE_2D,c),e&&this.hasCursor){let e=t/this.croppingParams.width,s=i/this.croppingParams.height,o=r/this.croppingParams.width,d=a/this.croppingParams.height;this.cx=e,this.cy=s,this.cw=o,this.ch=d,n.uniform4f(this.cursorInfoRef,e,s,o,d)}else n.uniform4f(this.cursorInfoRef,0,0,0,0);this.render()}}},na.prototype.clear=function(){this.hasWholeFrame=0,this.hasCursor=0},na.prototype.clearCanvas=function(e){if(this.isAvaiable()){var t=this.contextGL;e?t.clearColor(e.R,e.G,e.B,e.A):t.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),t.clear(t.COLOR_BUFFER_BIT)}},na.prototype.drawNextOuptutPictureRGBA=function(e,t,i,r){if(this.isAvaiable()){var a=r,n=this.canvasElement.getContext("2d"),s=n.getImageData(0,0,e,t);s.data.set(a),n.putImageData(s,0,0)}},na.prototype.isRGBAMode=function(e){return-1!==[l,p].indexOf(e)},na.prototype.updateRemoteVideoTextures=function(e,t,i,r,a){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if(!this.isAvaiable())return;var o=this.contextGL,d=this.yTextureRef,c=this.uTextureRef,u=this.vTextureRef;o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA);const h=this.isRGBAMode(this.videoMode);if(e<=0||t<=0||!r||!r.length||r.length!=e*t*3/2&&!h||i&&(i.top<0||i.left<0||i.left+i.width>e||i.top+i.height>t))return!1;let l=n?0:1;if(this.colorRange=l,this.rotation=a,Object.assign(this.croppingParams,i),this.textureWidth=e,this.textureHeight=t,this.canvasWidth=o.canvas.width,this.canvasHeight=o.canvas.height,!s)return;if(o.bindTexture(o.TEXTURE_2D,d),h)return void o.texImage2D(o.TEXTURE_2D,0,o.RGBA,e,t,0,o.RGBA,o.UNSIGNED_BYTE,r);var p=r,f=e*t,g=p.subarray(0,f);o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,e,t,0,o.LUMINANCE,o.UNSIGNED_BYTE,g);let m=0,v=0;1==this.videoMode?(m=e/2*t/2,v=m):2==this.videoMode&&(m=e*t/2,v=0);var A=p.subarray(f,f+m);if(o.bindTexture(o.TEXTURE_2D,c),v){o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,e/2,t/2,0,o.LUMINANCE,o.UNSIGNED_BYTE,A);var S=p.subarray(f+m,f+m+v);o.bindTexture(o.TEXTURE_2D,u),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,e/2,t/2,0,o.LUMINANCE,o.UNSIGNED_BYTE,S)}else o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE_ALPHA,e/2,t/2,0,o.LUMINANCE_ALPHA,o.UNSIGNED_BYTE,A);return!0},na.prototype.updateRemoteVideoTexturesImageBitmap=function(e,t,i,r,a){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(e<=0||t<=0||!i)return;if(!this.isAvaiable())return;var s=this.contextGL;if(this.textureWidth=e,this.textureHeight=t,Number.isNaN(a)||(this.rotation=a),Object.assign(this.croppingParams,r),!n)return;s.bindTexture(s.TEXTURE_2D,this.yTextureRef);const o=s.RGBA,d=s.RGBA,c=s.UNSIGNED_BYTE;s.texImage2D(s.TEXTURE_2D,0,o,d,c,i)},na.prototype.updateSelfMaskImage=function(e,t,i){if(!(e<=0||t<=0)&&i&&i.length==e*t*4&&this.isAvaiable()){var r=this.contextGL;r.bindTexture(r.TEXTURE_2D,this.maskTextureRef),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,i)}},na.prototype.VideoFlip=function(){if(this.isAvaiable()){var e=this.contextGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1)}},na.prototype.drawRemoteVideo=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.isAvaiable())return;var i=this.contextGL;let r=this.isRGBAMode(this.videoMode)?1:0;i.uniform1i(this.colorRangeRef,this.colorRange),this.setUniformFlag(r,this.hasCursor,this.videoMode),this.initmask&&i.uniform1i(this.maskFlagRef,1),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,t,e.width,e.height),i.viewport(e.x,e.y,e.width,e.height),this.updateVertexInfoForMultiView(e.width,e.height,this.croppingParams.width,this.croppingParams.height,this.rotation),this.BindTextures(this.videoMode),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),this.render()},na.prototype.readPixelsSyncRequest=function(e,t,i,r){if(this.isAvaiable()){var a,n=this.contextGL;return this.destination&&this.destination.length==i*r*4||(this.destination=new Uint8Array(i*r*4)),a=this.destination,n.flush(),n.readPixels(e,t,i,r,n.RGBA,n.UNSIGNED_BYTE,a),a}},na.prototype.updateSelfVideoTextures=function(e,t,i,r){let a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(!(e<=0||t<=0)&&i&&i.length%4==0&&this.isAvaiable()){var s=this.contextGL;this.textureWidth=e,this.textureHeight=t,this.rotation=n,Object.assign(this.croppingParams,r),a&&(s.bindTexture(s.TEXTURE_2D,this.yTextureRef),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,t,0,s.RGBA,s.UNSIGNED_BYTE,i))}},na.prototype.drawSelfVideo=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.isAvaiable()){var r=this.contextGL;this.setUniformFlag(1,this.hasCursor,this.videoMode),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,i,e.width,e.height),r.viewport(e.x,e.y,e.width,e.height),t?(r.enable(r.BLEND),r.blendFunc(r.ZERO,r.ZERO),this.updateVertexInfoForMultiView(e.width,e.height,e.width,e.height,this.ROTATION_CLOCK0)):(r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),this.updateVertexInfoForMultiView(e.width,e.height,this.croppingParams.width,this.croppingParams.height,this.rotation)),this.BindTextures(l),this.render()}},na.prototype.isSetWatermark=function(){return this.hasWaterMark},na.prototype.recoverTextures=function(){},na.prototype.setWatermarkFlag=function(e){this.hasWaterMark=e,e||(this.setWatermarkRepeated(!1),this.setWatermarkOpacity(),this.setWatermarkPosition(16))},na.prototype.setUniformFlag=function(e,t,i){if(this.isAvaiable()){var r=this.contextGL;r.uniform1i(this.onlyRGBARef,e),r.uniform1i(this.bgraModeRef,e&&i===p?1:0),r.uniform1i(this.cursorFlagRef,t),e||r.uniform1i(this.yuvmodeRef,i)}},na.prototype.setVideoMode=function(e){this.videoMode=e},na.prototype.getVideoMode=function(e){return this.videoMode},na.prototype.setWatermarkRepeated=function(e){this.watermarkRepeated=e},na.prototype.isWatermarkRepeated=function(){return!!this.watermarkRepeated},na.prototype.setWatermarkOpacity=function(e){this.watermarkOpacity=e||.15},na.prototype.getWatermarkOpacity=function(){return this.watermarkOpacity},na.prototype.setWatermarkPosition=function(e){this.watermarkPosition=e||16},na.prototype.getWatermarkPosition=function(){return this.watermarkPosition},na.prototype.setMultiView=function(e){return this.isMultiView=e},na.prototype.getRepeatedWatermarkUniformValue=function(){return this.isMultiView?30:7},na.prototype.getRepeatedWatermarkTextureValue=function(e){return this.isMultiView?e.TEXTURE30:e.TEXTURE7},na.prototype.setFillMode=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.fillMode=e,this.fillModeForResolution=t},na.prototype.getFillMode=function(){return this.fillMode},na.prototype.getFillModeForResolution=function(){return this.fillModeForResolution},na.prototype.getTextureIndex=function(){return this.textureindex},na.prototype.getTextureWidth=function(){return this.textureWidth},na.prototype.getTextureHeight=function(){return this.textureHeight},na.prototype.getRotation=function(){return this.rotation},na.prototype.getCroppingParams=function(){return this.croppingParams},na.prototype.getIndex=function(){return this.textureindex},na.prototype.getWatermarkWidth=function(){return this.watermarkWidth},na.prototype.getWatermarkHeight=function(){return this.watermarkHeight},na.prototype.getWatermarkOpacity=function(){return this.watermarkOpacity},na.prototype.getAttachedCanvas=function(){return this.canvasElement},na.prototype.getCanvasId=function(){return this.canvasID},na.prototype.resizeCanvasTo=function(e,t){this.contextGL.canvas.width=e,this.contextGL.canvas.height=t},na.prototype.isUseFillMode=function(e){let{width:t,height:i,rotation:r}=e;if(!this.fillMode)return!1;if(!this.fillModeForResolution)return!0;if(!t||!i)return!1;const a=r===this.ROTATION_CLOCK90||r==this.ROTATION_CLOCK270?i/t:t/i;return(Array.isArray(this.fillModeForResolution)?this.fillModeForResolution:[this.fillModeForResolution]).some((e=>Math.abs(a-e)<.01))};const sa=na;function oa(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function da(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?oa(Object(i),!0).forEach((function(t){(0,o.A)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):oa(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}let ca=new Map,ua=[];function ha(e){e.preventDefault()}function la(e,t,i,r,a,n,s){let o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.canvasElement=e,this.canvasID=t,this.contextOptions=a,this.textureindex=i||0,this.texturestride=this.textureindex?3:s?4:6,this.initmask=s||!1,this.reuse=!1,this.isEnableCanvasAlphaChannel=o,la.prototype.ROTATION_CLOCK0=0,la.prototype.ROTATION_CLOCK90=1,la.prototype.ROTATION_CLOCK180=2,la.prototype.ROTATION_CLOCK270=3,this.webGLResources=n,n||(this.initContextGL(),this.contextGL&&(this.webGLContextLostProtect(),this.contextGL.isContextLost()&&this.restoreContext())),this.reinit(n);var d=new ArrayBuffer(4);this.dummpyCursor=new Uint8Array(d),this.dummpyWaterMark=new Uint8Array(d),this.cursorWidth=0,this.cursorHeight=0,this.hasCursor=0,this.hasWaterMark=0,this.watermarkOpacity=.15,this.watermarkData=null,this.watermarkWidth=0,this.watermarkHeight=0,this.isMultiView=!1,this.hasWholeFrame=0,this.croppingParams={},this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.width=0,this.croppingParams.height=0,this.textureWidth=0,this.textureHeight=0,this.canvasWidth=0,this.canvasHeight=0,this.picRotation=-1,this.bgColor=[0,0,0],this.cx=0,this.cy=0,this.cw=0,this.ch=0,this.colorRange=-1,this.videoMode=h,this.rotation=this.ROTATION_CLOCK0,this.fillMode=0,this.fillModeForResolution=0,this.viewPostion=null}la.prototype.reinit=function(e){if(this.webGLResources=e,!this.contextGL||this.contextGL.isContextLost()||this.contextGL.glInitSucceed||this.webGLResources){if(this.webGLResources&&this.webGLResources.contextgl&&!this.webGLResources.contextgl.isContextLost()){this.contextGL=this.webGLResources.contextgl,this.shaderProgram=this.webGLResources.program,this.waterMarkTextureRef=this.webGLResources.waterMarkTextureRef,this.repeatedWaterMarkTextureRef=this.webGLResources.repeatedWaterMarkTextureRef,this.initTextures(!1),this.vertexPosBuffer=this.webGLResources.vBuffer,this.texturePosBuffer=this.webGLResources.tBuffer;let e=this.contextGL.getError();this.contextGL.glInitSucceed=e!=this.contextGL.NO_ERROR&&e!=this.contextGL.CONTEXT_LOST_WEBGL?0:1}}else{this.initProgram(),this.initmask?this.initTextures(!1):this.initTextures(!0),this.initBuffers();let e=this.contextGL.getError();this.contextGL.glInitSucceed=e!=this.contextGL.NO_ERROR&&e!=this.contextGL.CONTEXT_LOST_WEBGL?0:1}},la.prototype.webGLContextLostSimulate=function(){let e="undefined"==typeof window?self:window;e.webGLEXTSimulate=e.webGLEXTSimulate||[],e.webGLEXTSimulate.push(tt(this.contextGL,"WEBGL_lose_context"))},la.prototype.restoreContext=function(){if(this.contextGL)try{var e;null!==(e=this.canvasElement)&&void 0!==e&&e.loseContextExtension&&!this.canvasElement.restoreTimeoutId&&this.contextGL.isContextLost()&&(this.canvasElement.restoreTimeoutId=setTimeout((()=>{Ze("WebGL2RestoreTimeout")}),1500),this.canvasElement.loseContextExtension.restoreContext())}catch(e){Xe("webgl restoreContext exception2",e)}},la.prototype.webgGLContextLostCallback=function(e){Qe("webglcontextlost2 event: canvas listener size=".concat(ua.length,",  canvas id: ").concat(this.canvasID,", , ids:").concat(ua.join())),e.preventDefault(),this.contextGL.glInitSucceed=0,this.contextOptions&&this.contextOptions.webglcontextlostCallback&&this.contextOptions.webglcontextlostCallback(e,this.contextOptions.params)},la.prototype.removeEventListener=function(e,t){if(e&&t){e.restoreTimeoutId&&(clearTimeout(e.restoreTimeoutId),e.restoreTimeoutId=void 0),e.removeEventListener("webglcontextlost",t.contextLostHandler),e.removeEventListener("webglcontextrestored",t.contextRestoredHandler);const i=ua.indexOf(this.canvasID);ua.splice(i,1),ca.delete(e)}},la.prototype.webGLContextRestoredCallback=function(e){Qe("webglcontextrestored2 event from canvas id: ".concat(this.canvasID)),this.canvasElement.restoreTimeoutId&&(clearTimeout(this.canvasElement.restoreTimeoutId),this.canvasElement.restoreTimeoutId=void 0),this.reinit(),this.contextOptions&&this.contextOptions.webglcontextrestoredCallback&&this.contextOptions.webglcontextrestoredCallback(e,this.contextOptions.params)},la.prototype.webGLContextLostProtect=function(){this.canvasElement&&!this.canvasElement.loseContextExtension&&(this.canvasElement.loseContextExtension=tt(this.contextGL,"WEBGL_lose_context"));let e=this.canvasElement,t=ca.get(e);t&&this.removeEventListener(e,t),ca.set(e,this),this.contextLostHandler=this.webgGLContextLostCallback.bind(this),this.contextRestoredHandler=this.webGLContextRestoredCallback.bind(this),e.addEventListener("webglcontextlost",this.contextLostHandler,{capture:!1}),e.addEventListener("webglcontextrestored",this.contextRestoredHandler,{capture:!1}),-1===ua.indexOf(this.canvasID)&&(ua.push(this.canvasID),ua.length>4&&Qe("webgl2canvas listener size=".concat(ua.length,", ids:").concat(ua.join())))},la.prototype.isWebGL2=function(){return this.contextGL},la.prototype.isAvaiable=function(){return this.contextGL&&!this.contextGL.isContextLost()&&this.contextGL.glInitSucceed},la.prototype.initContextGL=function(){for(var e,t,i,r=this.canvasElement,a=null,n=["webgl2"],s=0;!a&&s<n.length;){var o=n[s];try{if($.isEnableCanvasCtxOptionsOpt()){let e={depth:!1,stencil:!1,antialias:!1,alpha:this.isEnableCanvasAlphaChannel};if(this.contextOptions){let t=da(da({},this.contextOptions),e);a=r.getContext(o,t)}else a=r.getContext(o,e)}else a=this.contextOptions?r.getContext(o,this.contextOptions):r.getContext(o)}catch(e){a=null}a&&"function"==typeof a.getParameter||(a=null),++s}if(this.contextGL=a,!a||a.isContextLost())return Xe("Failed when trying to get WebGLContext2 on canvas(".concat(null===(e=this.canvasElement)||void 0===e?void 0:e.width,",").concat(null===(t=this.canvasElement)||void 0===t?void 0:t.height,"), gl=").concat(a,", lost=").concat(null===(i=a)||void 0===i?void 0:i.isContextLost())),void Ze("initWebGL2Fail");a.glInitSucceed=0},la.prototype.initProgram=function(){var e=this.contextGL,t=e.createShader(e.VERTEX_SHADER);e.shaderSource(t,"#version 300 es\n    in vec4 vertexPos;\n    in vec4 texturePos;\n    in vec4 masktexturePos;\n    out vec2 textureCoord;\n    out vec2 masktextureCoord;\n\n    void main() {\n      gl_Position = vertexPos;\n      textureCoord = texturePos.xy;\n      masktextureCoord = masktexturePos.xy;\n    }\n  "),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||e.isContextLost()||Qe("webgl2 Vertex shader failed to compile: "+e.getShaderInfoLog(t));var i=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(i,"#version 300 es\n    precision highp float;\n    in highp vec2 textureCoord;\n    in highp vec2 masktextureCoord;\n    uniform sampler2D ySampler;\n    uniform sampler2D uSampler;\n    uniform sampler2D vSampler;\n    uniform sampler2D cursorSampler;\n    uniform sampler2D waterMarkSampler;\n    uniform sampler2D  previewVideoSampler;\n    uniform sampler2D maskSampler;\n    uniform vec4 cursorInfo;\n    uniform int onlyRGBA;\n    uniform int bgraMode;\n    uniform int colorRange;\n    uniform int waterMarkFlag;\n    uniform int cursorFlag;\n    uniform int maskFlag;\n    uniform int yuvmode;\n\n    const mat4 YUV2RGB_L = mat4(\n      1.1643828125, 0, 1.59602734375, -.87078515625,\n      1.1643828125, -.39176171875, -.81296875, .52959375,\n      1.1643828125, 2.017234375, 0, -1.081390625,\n      0, 0, 0, 1\n    );\n    \n    const mat4 YUV2RGB_F = mat4(\n      1.0, 0, 1.402, -.701,\n      1.0, -.34413, -.71414, .529135,\n      1.0, 1.772, 0, -.886,\n      0, 0, 0, 1\n    );\n\n    out vec4 outputColor;\n  \n    void main(void) {\n      vec4 c;\n      if (waterMarkFlag != 1) {\n        if (onlyRGBA == 0) {\n          highp float y = texture(ySampler, textureCoord).r;\n          highp float u;\n          highp float v;\n          if (yuvmode == 1) {\n            u = texture(uSampler, textureCoord).r;\n            v = texture(vSampler, textureCoord).r;\n          } else {\n            u = texture(uSampler, textureCoord).r;\n            v = texture(uSampler, textureCoord).a;\n          }\n      \n          if (colorRange == 0) {\n            c = vec4(y, u, v, 1) * YUV2RGB_L;\n          } else {\n            c = vec4(y, u, v, 1) * YUV2RGB_F;\n          }\n  \n          if (cursorFlag == 1) {\n            if (cursorInfo.z > 0.0 && textureCoord.x >= cursorInfo.x && textureCoord.y >= cursorInfo.y && \n                textureCoord.x < cursorInfo.x+cursorInfo.z && textureCoord.y < cursorInfo.y+cursorInfo.w) {\n              vec2 cursorCoord = textureCoord - cursorInfo.xy;\n              cursorCoord /= cursorInfo.zw;\n              vec4 cursor = texture(cursorSampler, cursorCoord);\n              c = c*(1.0-cursor.a) + cursor*cursor.a;\n            }\n          }\n        } else {\n          c = texture(previewVideoSampler, textureCoord);\n          if (bgraMode == 1) {\n            c = vec4(c.b, c.g, c.r, c.a);\n          }\n        }\n      }\n\n      if (waterMarkFlag == 1) {\n        c = texture(waterMarkSampler, textureCoord);\n        if (c.r == 0.0 && c.g == 0.0 && c.b == 0.0) {\n          c.a = 0.0;\n        }\n      }\n\n      if (maskFlag == 1 && waterMarkFlag != 1) {\n        vec4 mask = texture(maskSampler, masktextureCoord);\n        if (mask.r != 0.0 || mask.g != 0.0 || mask.b != 0.0) {\n          c = mask* mask.a+ c*(1.0-mask.a);\n        }\n      }\n\n      if (waterMarkFlag!=1) {\n        c.a = 1.0;\n      }\n\n      outputColor = c;\n    }\n  "),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||e.isContextLost()||Qe("webgl2 Fragment shader failed to compile: "+e.getShaderInfoLog(i));var r=e.createProgram();e.attachShader(r,t),e.attachShader(r,i),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||e.isContextLost()||Qe("webgl2 Program failed to compile: "+e.getProgramInfoLog(r)),e.useProgram(r),this.shaderProgram=r},la.prototype.initBuffers=function(){var e=this.contextGL,t=this.shaderProgram,i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1,1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var r=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(r),e.vertexAttribPointer(r,2,e.FLOAT,!1,0,0),this.vertexPosBuffer=i;var a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1,1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var n=e.getAttribLocation(t,"texturePos");if(e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),this.initmask&&!this.masktexturePosBuffer){var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var o=e.getAttribLocation(t,"masktexturePos");e.enableVertexAttribArray(o),e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0),this.masktexturePosBuffer=s}this.texturePosBuffer=a},la.prototype.initTextures=function(e){var t=this.contextGL,i=this.shaderProgram;t.pixelStorei(t.UNPACK_ALIGNMENT,1);var r=this.initTexture();this.yTextureRef=r,this.oyTextureRef=r;var a=this.initTexture();this.uTextureRef=a,this.ouTextureRef=a;var n=this.initTexture();if(this.vTextureRef=n,this.ovTextureRef=n,e){this.BindTextures(1);var s=this.initTexture(),o=t.getUniformLocation(i,"cursorSampler");t.uniform1i(o,this.textureindex*this.texturestride+3),this.cursorTextureRef=s;var d=this.initTexture(),c=t.getUniformLocation(i,"waterMarkSampler");t.uniform1i(c,4),this.waterMarkTextureRef=d;var u=this.initTexture();this.repeatedWaterMarkTextureRef=u;var h=this.initTexture(),l=t.getUniformLocation(i,"previewVideoSampler");t.uniform1i(l,this.textureindex*this.texturestride+5),this.previewVideoTextureRef=h;var p=t.getUniformLocation(i,"cursorInfo");this.cursorInfoRef=p}if(this.initmask){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1);var f=this.initTexture(),g=t.getUniformLocation(i,"maskSampler");t.uniform1i(g,this.textureindex*this.texturestride+6),this.maskTextureRef=f}var m=t.getUniformLocation(i,"colorRange");this.colorRangeRef=m,this.onlyRGBARef=t.getUniformLocation(i,"onlyRGBA"),this.bgraModeRef=t.getUniformLocation(i,"bgraMode"),this.waterMarkFlagRef=t.getUniformLocation(i,"waterMarkFlag"),this.maskFlagRef=t.getUniformLocation(i,"maskFlag"),this.cursorFlagRef=t.getUniformLocation(i,"cursorFlag"),this.yuvmodeRef=t.getUniformLocation(i,"yuvmode")},la.prototype.BindTextures=function(e){var t=this.contextGL,i=this.shaderProgram;if(t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.activeTexture(t.TEXTURE0+0),t.bindTexture(t.TEXTURE_2D,this.yTextureRef),t.activeTexture(t.TEXTURE0+1),t.bindTexture(t.TEXTURE_2D,this.uTextureRef),t.activeTexture(t.TEXTURE0+2),t.bindTexture(t.TEXTURE_2D,this.vTextureRef),1==e){let e=t.getUniformLocation(i,"ySampler");t.uniform1i(e,0);let r=t.getUniformLocation(i,"uSampler");t.uniform1i(r,1);let a=t.getUniformLocation(i,"vSampler");t.uniform1i(a,2)}else if(this.isRGBAMode(e)){let e=t.getUniformLocation(i,"previewVideoSampler");t.uniform1i(e,0);let r=t.getUniformLocation(i,"ySampler");t.uniform1i(r,0);let a=t.getUniformLocation(i,"uSampler");t.uniform1i(a,0);let n=t.getUniformLocation(i,"vSampler");t.uniform1i(n,0)}else if(2==e){let e=t.getUniformLocation(i,"ySampler");t.uniform1i(e,0);let r=t.getUniformLocation(i,"uSampler");t.uniform1i(r,1);let a=t.getUniformLocation(i,"vSampler");t.uniform1i(a,0)}let r=t.getUniformLocation(i,"previewVideoSampler");t.uniform1i(r,0);let a=t.getUniformLocation(i,"maskSampler");this.initmask?(t.activeTexture(t.TEXTURE0+6),t.bindTexture(t.TEXTURE_2D,this.maskTextureRef),t.uniform1i(a,6)):t.uniform1i(a,0);let n=t.getUniformLocation(i,"cursorSampler");t.uniform1i(n,0);let s=t.getUniformLocation(this.shaderProgram,"waterMarkSampler");t.uniform1i(s,0)},la.prototype.initTexture=function(){var e=this.contextGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t},la.prototype.clearDisplay=function(){var e=this.contextGL;e&&(e.enable(e.BLEND),e.blendFunc(e.ZERO,e.ZERO)),this.render()},la.prototype.cleanup=function(){let e=this.canvasElement,t=ca.get(e);if(t&&this.removeEventListener(e,t),e.defaultContextLostHandler||(e.defaultContextLostHandler=ha,e.addEventListener("webglcontextlost",ha,{capture:!1})),this.isAvaiable()){var i=this.contextGL;i.deleteProgram(this.program),i.activeTexture(i.TEXTURE0+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE1+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE2+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),this.textureindex||this.initmask||(i.activeTexture(i.TEXTURE3+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE4+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(this.getRepeatedWatermarkTextureValue(i)),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE5+this.textureindex*this.texturestride),i.bindTexture(i.TEXTURE_2D,null)),i.bindBuffer(i.ARRAY_BUFFER,null),i.deleteTexture(this.yTextureRef),i.deleteTexture(this.uTextureRef),i.deleteTexture(this.vTextureRef),this.textureindex||this.initmask||(i.deleteTexture(this.cursorTextureRef),i.deleteTexture(this.waterMarkTextureRef),i.deleteTexture(this.repeatedWaterMarkTextureRef),i.deleteTexture(this.previewVideoTextureRef),i.deleteBuffer(this.vertexPosBuffer),i.deleteBuffer(this.texturePosBuffer)),this.maskTextureRef&&i.deleteTexture(this.maskTextureRef),this.masktexturePosBuffer&&i.deleteBuffer(this.masktexturePosBuffer),i.glInitSucceed=0}},la.prototype.drawNextOutputPicture=function(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.contextGL?this.drawNextOutputPictureFrame(e,t,i,r,a):this.drawNextOuptutPictureRGBA(e,t,i,r)},la.prototype.updateVertexInfoForMultiView=function(e,t,i,r,a){var n,s,o,d,c=this.contextGL;if(this.isUseFillMode({width:i,height:r,rotation:a}))n=0,s=0,o=1,d=1;else{var u=a==this.ROTATION_CLOCK90||a==this.ROTATION_CLOCK270?r:i,h=a==this.ROTATION_CLOCK90||a==this.ROTATION_CLOCK270?i:r,l=u/h*t;l>e?(n=0,o=1,d=1-(s=(t-h/u*e)/2/t)):(s=0,d=1,o=1-(n=(e-l)/2/e))}n=2*n-1,o=2*o-1,s=1-2*s,d=1-2*d;var p=new Float32Array([o,s,n,s,o,d,n,d,1,1,-1,1,1,-1,-1,-1]);this.viewPostion=p,c.bindBuffer(c.ARRAY_BUFFER,this.vertexPosBuffer),c.bufferData(c.ARRAY_BUFFER,p,c.DYNAMIC_DRAW)},la.prototype.updateTextureInfoForMultiView=function(e,t,i,r,a,n,s){var o,d,c,u,h=this.contextGL;if(this.isUseFillMode({width:i.width,height:i.height,rotation:r})){const a=r==this.ROTATION_CLOCK90||r==this.ROTATION_CLOCK270?s/n:n/s,h=i.left||0,l=i.top||0;if(i.width/i.height>a){const r=i.height*a;o=l/t,d=(Math.round((i.width-r)/2)+h)/e,c=o+(i.height-1)/t,u=d+r/e}else{const r=i.width/a;c=(o=(Math.round((i.height-r)/2)+l)/t)+(r-1)/t,u=(d=h/e)+i.width/e}}else o=Zr(i.top/t,2),d=Zr(i.left/e,2),c=Jr((i.top+i.height-1)/t,2),u=Jr((i.width-1+i.left)/e,2);var l=[d,o,u,o,u,c,d,c];r==this.ROTATION_CLOCK90&&(l.unshift(l[6],l[7]),l=l.slice(0,8)),r==this.ROTATION_CLOCK180&&(l.unshift(l[4],l[5],l[6],l[7]),l=l.slice(0,8)),r==this.ROTATION_CLOCK270&&(l.push(l[0],l[1]),l=l.slice(2,10));var p=l[0],f=l[1];if(l[0]=l[2],l[1]=l[3],l[2]=p,l[3]=f,a)if(r==this.ROTATION_CLOCK90||r==this.ROTATION_CLOCK270){let e=l[1];l[1]=l[3],l[3]=e,e=l[5],l[5]=l[7],l[7]=e}else l[0]=1-l[0],l[2]=1-l[2],l[4]=1-l[4],l[6]=1-l[6];var g=new Float32Array([...l,1,0,0,0,1,1,0,1]);h.bindBuffer(h.ARRAY_BUFFER,this.texturePosBuffer),h.bufferData(h.ARRAY_BUFFER,g,h.DYNAMIC_DRAW)},la.prototype.getViewPosition=function(){let e=[0,0,1,1];if(!this.viewPostion)return e;const t=this.viewPostion[0],i=this.viewPostion[1],r=this.viewPostion[2],a=this.viewPostion[5];return e[0]=(1-i)/2,e[1]=(1+r)/2,e[2]=(1-a)/2,e[3]=(1+t)/2,e},la.prototype.drawNextOutputPictureFrame=function(e,t,i,r,a){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];if(!this.isAvaiable())return;var d=this.contextGL,c=(this.texturePosBuffer,this.yTextureRef),u=this.uTextureRef,h=this.vTextureRef;d.enable(d.BLEND),d.blendFunc(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA),a=a||this.ROTATION_CLOCK0;var l=(i=i||{top:0,left:0,width:e,height:t}).width!=this.croppingParams.width||i.height!=this.croppingParams.height,p=i.top!=this.croppingParams.top||i.left!=this.croppingParams.left,f=d.canvas.width!=this.canvasWidth||d.canvas.height!=this.canvasHeight,g=e!=this.textureWidth||t!=this.textureHeight,m=a!=this.picRotation;(l||f||m)&&function(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;var n=e.contextGL;let s=n.canvas.width,o=n.canvas.height;a&&(s=a.width,o=a.height);var d,c,u,h,l=r==e.ROTATION_CLOCK90||r==e.ROTATION_CLOCK270?i:t,p=r==e.ROTATION_CLOCK90||r==e.ROTATION_CLOCK270?t:i,f=l/p*o;f>s?(d=0,u=1,h=1-(c=(o-p/l*s)/2/o)):(c=0,h=1,u=1-(d=(s-f)/2/s)),d=2*d-1,u=2*u-1,c=1-2*c,h=1-2*h;var g=new Float32Array([u,c,d,c,u,h,d,h,u,c,d,c,u,h,d,h]);n.bindBuffer(n.ARRAY_BUFFER,e.vertexPosBuffer),n.bufferData(n.ARRAY_BUFFER,g,n.DYNAMIC_DRAW)}(this,i.width,i.height,a,s),(l||p||g||m)&&function(e,t,i,r,a){var n=e.contextGL,s=r.top/i,o=r.left/t,d=s+(r.height-1)/i,c=o+r.width/t,u=[o,s,c,s,c,d,o,d];a==e.ROTATION_CLOCK90&&(u.unshift(u[6],u[7]),u=u.slice(0,8)),a==e.ROTATION_CLOCK180&&(u.unshift(u[4],u[5],u[6],u[7]),u=u.slice(0,8)),a==e.ROTATION_CLOCK270&&(u.push(u[0],u[1]),u=u.slice(2));var h=u[0],l=u[1];u[0]=u[2],u[1]=u[3],u[2]=h,u[3]=l;var p=new Float32Array([...u,1,0,0,0,1,1,0,1]);n.bindBuffer(n.ARRAY_BUFFER,e.texturePosBuffer),n.bufferData(n.ARRAY_BUFFER,p,n.DYNAMIC_DRAW)}(this,e,t,i,a);let v=n?0:1;v!=this.colorRange&&(d.uniform1i(this.colorRangeRef,v),this.colorRange=v),s?d.viewport(s.x,s.y,s.width,s.height):d.viewport(0,0,d.canvas.width,d.canvas.height),d.uniform1i(this.onlyRGBARef,0),d.uniform1i(this.yuvmodeRef,1),Object.assign(this.croppingParams,i),this.textureWidth=e,this.textureHeight=t,this.picRotation=a,this.canvasWidth=d.canvas.width,this.canvasHeight=d.canvas.height,d.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),d.clear(d.COLOR_BUFFER_BIT);var A=r,S=e*t;if(d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,c),o){var _=A.subarray(0,S);d.texImage2D(d.TEXTURE_2D,0,d.LUMINANCE,e,t,0,d.LUMINANCE,d.UNSIGNED_BYTE,_)}var y=e/2*t/2;if(d.activeTexture(d.TEXTURE1),d.bindTexture(d.TEXTURE_2D,u),o){var C=A.subarray(S,S+y);d.texImage2D(d.TEXTURE_2D,0,d.LUMINANCE,e/2,t/2,0,d.LUMINANCE,d.UNSIGNED_BYTE,C)}var b=y;if(d.activeTexture(d.TEXTURE2),d.bindTexture(d.TEXTURE_2D,h),o){var w=A.subarray(S+y,S+y+b);d.texImage2D(d.TEXTURE_2D,0,d.LUMINANCE,e/2,t/2,0,d.LUMINANCE,d.UNSIGNED_BYTE,w)}d.activeTexture(d.TEXTURE3),d.bindTexture(d.TEXTURE_2D,this.cursorTextureRef),this.hasCursor?d.uniform1i(this.cursorFlagRef,1):o&&d.texImage2D(d.TEXTURE_2D,0,d.RGBA,1,1,0,d.RGBA,d.UNSIGNED_BYTE,this.dummpyCursor),d.uniform4f(this.cursorInfoRef,this.cx,this.cy,this.cw,this.ch),d.activeTexture(d.TEXTURE5),d.bindTexture(d.TEXTURE_2D,this.previewVideoTextureRef),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,1,1,0,d.RGBA,d.UNSIGNED_BYTE,this.dummpyWaterMark);var E=d.getUniformLocation(this.shaderProgram,"maskSampler");d.uniform1i(E,5),this.render(),this.hasWholeFrame=1},la.prototype.updateTextureBlock=function(e,t,i,r,a){if(this.isAvaiable()){var n=this.contextGL,s=a;if(!(!this.hasWholeFrame||e<=0||t<=0||i<0||r<0||i+e>this.textureWidth||r+t>this.textureHeight)&&a&&a.length==e*t*3/2){var o=this.yTextureRef,d=this.uTextureRef,c=this.vTextureRef,u=e*t,h=s.subarray(0,u);n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o),n.texSubImage2D(n.TEXTURE_2D,0,i,r,e,t,n.LUMINANCE,n.UNSIGNED_BYTE,h);var l=e/2*t/2,p=s.subarray(u,u+l);n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,d),n.texSubImage2D(n.TEXTURE_2D,0,i/2,r/2,e/2,t/2,n.LUMINANCE,n.UNSIGNED_BYTE,p);var f=l,g=s.subarray(u+l,u+l+f);n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,c),n.texSubImage2D(n.TEXTURE_2D,0,i/2,r/2,e/2,t/2,n.LUMINANCE,n.UNSIGNED_BYTE,g)}}},la.prototype.updateCursor=function(e,t,i){if(this.isAvaiable()){var r=this.contextGL;e<=0||t<=0||!i||i.length!=e*t*4||(r.activeTexture(r.TEXTURE3),r.bindTexture(r.TEXTURE_2D,this.cursorTextureRef),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,i),this.cursorWidth=e,this.cursorHeight=t,this.hasCursor=1)}},la.prototype.updateWatermark=function(e,t,i){this.isAvaiable()&&(this.contextGL,e<=0||t<=0||!i||i.length!=e*t*4||(this.watermarkData=i,this.watermarkWidth=e,this.watermarkHeight=t,this.hasWaterMark=1))},la.prototype.drawWatermark=function(){if(this.isAvaiable()){var e=this.contextGL;if(this.isSetWatermark()&&this.watermarkData&&this.watermarkWidth&&this.watermarkHeight){e.uniform1i(this.waterMarkFlagRef,1),this.isWatermarkRepeated()?(e.activeTexture(this.getRepeatedWatermarkTextureValue(e)),e.bindTexture(e.TEXTURE_2D,this.repeatedWaterMarkTextureRef)):(e.activeTexture(e.TEXTURE4),e.bindTexture(e.TEXTURE_2D,this.waterMarkTextureRef)),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.watermarkWidth,this.watermarkHeight,0,e.RGBA,e.UNSIGNED_BYTE,this.watermarkData);let t=e.getUniformLocation(this.shaderProgram,"waterMarkSampler");e.uniform1i(t,this.isWatermarkRepeated()?this.getRepeatedWatermarkUniformValue():4),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLE_STRIP,4,4)}}},la.prototype.render=function(){if(this.isAvaiable()){var e=this.contextGL;e.uniform1i(this.waterMarkFlagRef,0),e.drawArrays(e.TRIANGLE_STRIP,0,4),this.drawWatermark()}},la.prototype.drawCursor=function(e,t,i,r,a){if(this.isAvaiable()){var n=this.contextGL;if(!(!this.hasWholeFrame||e&&(r<0||a<0))){n.viewport(0,0,n.canvas.width,n.canvas.height);var s=this.yTextureRef,o=this.uTextureRef,d=this.vTextureRef,c=this.cursorTextureRef;if(n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,s),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,o),n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,d),n.activeTexture(n.TEXTURE3),n.bindTexture(n.TEXTURE_2D,c),e&&this.hasCursor){let e=t/this.croppingParams.width,s=i/this.croppingParams.height,o=r/this.croppingParams.width,d=a/this.croppingParams.height;this.cx=e,this.cy=s,this.cw=o,this.ch=d,n.uniform4f(this.cursorInfoRef,e,s,o,d)}else n.uniform4f(this.cursorInfoRef,0,0,0,0);this.render()}}},la.prototype.clear=function(){this.hasWholeFrame=0,this.hasCursor=0},la.prototype.clearCanvas=function(e){if(this.isAvaiable()){var t=this.contextGL;e?t.clearColor(e.R,e.G,e.B,e.A):t.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),t.clear(t.COLOR_BUFFER_BIT)}},la.prototype.drawNextOuptutPictureRGBA=function(e,t,i,r){if(this.isAvaiable()){var a=r,n=this.canvasElement.getContext("2d"),s=n.getImageData(0,0,e,t);s.data.set(a),n.putImageData(s,0,0)}},la.prototype.isRGBAMode=function(e){return-1!==[l,p].indexOf(e)},la.prototype.updateRemoteVideoTextures=function(e,t,i,r,a){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if(!this.isAvaiable())return;var o=this.contextGL,d=this.yTextureRef,c=this.uTextureRef,u=this.vTextureRef;o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA);const h=this.isRGBAMode(this.videoMode);if(e<=0||t<=0||!r||!r.length||r.length!=e*t*3/2&&!h||i&&(i.top<0||i.left<0||i.left+i.width>e||i.top+i.height>t))return!1;let l=n?0:1;if(this.colorRange=l,this.rotation=a,Object.assign(this.croppingParams,i),this.textureWidth=e,this.textureHeight=t,this.canvasWidth=o.canvas.width,this.canvasHeight=o.canvas.height,!s)return;if(o.bindTexture(o.TEXTURE_2D,d),h)return void o.texImage2D(o.TEXTURE_2D,0,o.RGBA,e,t,0,o.RGBA,o.UNSIGNED_BYTE,r);var p=r,f=e*t,g=p.subarray(0,f);o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,e,t,0,o.LUMINANCE,o.UNSIGNED_BYTE,g);let m=0,v=0;1==this.videoMode?(m=e/2*t/2,v=m):2==this.videoMode&&(m=e*t/2,v=0);var A=p.subarray(f,f+m);if(o.bindTexture(o.TEXTURE_2D,c),v){o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,e/2,t/2,0,o.LUMINANCE,o.UNSIGNED_BYTE,A);var S=p.subarray(f+m,f+m+v);o.bindTexture(o.TEXTURE_2D,u),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,e/2,t/2,0,o.LUMINANCE,o.UNSIGNED_BYTE,S)}else o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE_ALPHA,e/2,t/2,0,o.LUMINANCE_ALPHA,o.UNSIGNED_BYTE,A);return!0},la.prototype.updateRemoteVideoTexturesImageBitmap=function(e,t,i,r,a){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(e<=0||t<=0||!i)return;if(!this.isAvaiable())return;var s=this.contextGL;if(this.textureWidth=e,this.textureHeight=t,Number.isNaN(a)||(this.rotation=a),Object.assign(this.croppingParams,r),!n)return;s.bindTexture(s.TEXTURE_2D,this.yTextureRef);const o=s.RGBA,d=s.RGBA,c=s.UNSIGNED_BYTE;s.texImage2D(s.TEXTURE_2D,0,o,d,c,i)},la.prototype.updateSelfMaskImage=function(e,t,i){if(!(e<=0||t<=0)&&i&&i.length==e*t*4&&this.isAvaiable()){var r=this.contextGL;r.bindTexture(r.TEXTURE_2D,this.maskTextureRef),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,i)}},la.prototype.VideoFlip=function(){if(this.isAvaiable()){var e=this.contextGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1)}},la.prototype.drawRemoteVideo=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.isAvaiable())return;var i=this.contextGL;let r=this.isRGBAMode(this.videoMode)?1:0;i.uniform1i(this.colorRangeRef,this.colorRange),this.setUniformFlag(r,this.hasCursor,this.videoMode),this.initmask&&i.uniform1i(this.maskFlagRef,1),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,t,e.width,e.height),i.viewport(e.x,e.y,e.width,e.height),this.updateVertexInfoForMultiView(e.width,e.height,this.croppingParams.width,this.croppingParams.height,this.rotation),this.BindTextures(this.videoMode),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),this.render()},la.prototype.readPixelsSyncRequest=function(e,t,i,r){if(this.isAvaiable()){var a,n=this.contextGL;return this.destination&&this.destination.length==i*r*4||(this.destination=new Uint8Array(i*r*4)),a=this.destination,n.flush(),n.readPixels(e,t,i,r,n.RGBA,n.UNSIGNED_BYTE,a),a}},la.prototype.updateSelfVideoTextures=function(e,t,i,r){let a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(!(e<=0||t<=0)&&i&&i.length%4==0&&this.isAvaiable()){var s=this.contextGL;this.textureWidth=e,this.textureHeight=t,this.rotation=n,Object.assign(this.croppingParams,r),a&&(s.bindTexture(s.TEXTURE_2D,this.yTextureRef),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,t,0,s.RGBA,s.UNSIGNED_BYTE,i))}},la.prototype.drawSelfVideo=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.isAvaiable()){var r=this.contextGL;this.setUniformFlag(1,this.hasCursor,this.videoMode),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,i,e.width,e.height),r.viewport(e.x,e.y,e.width,e.height),t?(r.enable(r.BLEND),r.blendFunc(r.ZERO,r.ZERO),this.updateVertexInfoForMultiView(e.width,e.height,e.width,e.height,this.ROTATION_CLOCK0)):(r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),this.updateVertexInfoForMultiView(e.width,e.height,this.croppingParams.width,this.croppingParams.height,this.rotation)),this.BindTextures(l),this.render()}},la.prototype.isSetWatermark=function(){return this.hasWaterMark},la.prototype.recoverTextures=function(){},la.prototype.setWatermarkFlag=function(e){this.hasWaterMark=e,e||(this.setWatermarkRepeated(!1),this.setWatermarkOpacity(),this.setWatermarkPosition(16))},la.prototype.setUniformFlag=function(e,t,i){if(this.isAvaiable()){var r=this.contextGL;r.uniform1i(this.onlyRGBARef,e),r.uniform1i(this.bgraModeRef,e&&i===p?1:0),r.uniform1i(this.cursorFlagRef,t),e||r.uniform1i(this.yuvmodeRef,i)}},la.prototype.setVideoMode=function(e){this.videoMode=e},la.prototype.getVideoMode=function(e){return this.videoMode},la.prototype.setWatermarkRepeated=function(e){this.watermarkRepeated=e},la.prototype.isWatermarkRepeated=function(){return!!this.watermarkRepeated},la.prototype.setWatermarkOpacity=function(e){this.watermarkOpacity=e||.15},la.prototype.getWatermarkOpacity=function(){return this.watermarkOpacity},la.prototype.setWatermarkPosition=function(e){this.watermarkPosition=e||16},la.prototype.getWatermarkPosition=function(){return this.watermarkPosition},la.prototype.setMultiView=function(e){return this.isMultiView=e},la.prototype.getRepeatedWatermarkUniformValue=function(){return this.isMultiView?30:7},la.prototype.getRepeatedWatermarkTextureValue=function(e){return this.isMultiView?e.TEXTURE30:e.TEXTURE7},la.prototype.setFillMode=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.fillMode=e,this.fillModeForResolution=t},la.prototype.getFillMode=function(){return this.fillMode},la.prototype.getFillModeForResolution=function(){return this.fillModeForResolution},la.prototype.getTextureIndex=function(){return this.textureindex},la.prototype.getIndex=function(){return this.textureindex},la.prototype.getWatermarkWidth=function(){return this.watermarkWidth},la.prototype.getWatermarkHeight=function(){return this.watermarkHeight},la.prototype.getTextureWidth=function(){return this.textureWidth},la.prototype.getTextureHeight=function(){return this.textureHeight},la.prototype.getRotation=function(){return this.rotation},la.prototype.getCroppingParams=function(){return this.croppingParams},la.prototype.getWatermarkOpacity=function(){return this.watermarkOpacity},la.prototype.getAttachedCanvas=function(){return this.canvasElement},la.prototype.getCanvasId=function(){return this.canvasID},la.prototype.resizeCanvasTo=function(e,t){this.contextGL.canvas.width=e,this.contextGL.canvas.height=t},la.prototype.isUseFillMode=function(e){let{width:t,height:i,rotation:r}=e;if(!this.fillMode)return!1;if(!this.fillModeForResolution)return!0;if(!t||!i)return!1;const a=r===this.ROTATION_CLOCK90||r==this.ROTATION_CLOCK270?i/t:t/i;return(Array.isArray(this.fillModeForResolution)?this.fillModeForResolution:[this.fillModeForResolution]).some((e=>Math.abs(a-e)<.01))};const pa=la;function fa(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}class ga{constructor(e){this.options=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?fa(Object(i),!0).forEach((function(t){(0,o.A)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):fa(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({analyserFrequent:100},e||{}),this.asnTime=performance.now(),this.audioStream=null,this.analyserNodeBufferDataArray=null,this.audioCtx=null,this.destinationNode=null,"function"==typeof AudioContext&&(this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.destinationNode=new MediaStreamAudioDestinationNode(this.audioCtx),this.initAnalyserNode()),this.lastUILevel=0}initAnalyserNode(){this.analyserNode=this.audioCtx.createAnalyser(),this.analyserNode.connect(this.destinationNode),this.analyserNode.fftSize=1024}setAudioStream(e){this.audioStream=e}start(){if(this.audioCtx)return this.getAnalyzingStatus()&&this.stop(),this.getDestroyedStatus()?Promise.reject(new Error("instance is destroyed already")):new Promise((e=>{this.setAnalyzingStatus(!0),this.sourceNode=this.audioCtx.createMediaStreamSource(this.audioStream),this.sourceNode.connect(this.analyserNode),this.resumeAudioCtx(),this.setAnalyzeInterval(),e(!0)}))}stop(){this.setAnalyzingStatus(!1),this.clearAnalyzeInterval()}destroy(){var e;this.stop(),this.analyserNode&&this.destinationNode&&this.analyserNode.disconnect(this.destinationNode),this.setDestroyedStatus(!0),null===(e=this.audioCtx)||void 0===e||e.suspend().finally((()=>{var e;return null===(e=this.audioCtx)||void 0===e?void 0:e.close()})),this.audioStream=null,this.analyserNodeBufferDataArray=null}analyserNodeIntervalCallback(){if(!this.analyserNodeBufferDataArray)return;this.analyserNode.getFloatTimeDomainData(this.analyserNodeBufferDataArray);let{sumRms:e,absMax:t}=function(e){let t=0,i=0;for(let r=0;r<e.length;r+=2){i+=e[r]*e[r];let a=Math.abs(e[r]);a>t&&(t=a)}return t=t>1?1:t,{sumRms:i/e.length/2,absMax:t}}(this.analyserNodeBufferDataArray);const i=va(t);i!==this.lastUILevel&&(this.lastUILevel=i,this.options.analyserCallback(i))}setAnalyzeInterval(){this.clearAnalyzeInterval();const e=this.analyserNode.fftSize;this.analyserNodeBufferDataArray=new Float32Array(e),this.analyserNodeTimer=window.setInterval(this.analyserNodeIntervalCallback.bind(this),this.options.analyserFrequent)}clearAnalyzeInterval(){this.analyserNodeTimer&&(window.clearInterval(this.analyserNodeTimer),this.analyserNodeTimer=null,this.analyserNodeBufferDataArray=null)}getAnalyzingStatus(){return!!this.isAnalyzing}setAnalyzingStatus(e){this.isAnalyzing=!!e}getDestroyedStatus(){return!!this.isDestroyed}setDestroyedStatus(e){this.isDestroyed=!!e}resumeAudioCtx(){"running"!==this.audioCtx.state&&this.audioCtx.resume().catch((e=>{H.Ay.error("audio-level audio context resume error: ",e)}))}}const ma=[0,1,2,3,4,4,5,5,5,5,6,6,6,6,6,7,7,7,7,8,8,8,9,9,9,9,9,9,9,9,9,9,9];function va(e){if("number"!=typeof e||e<0||e>1)return-1;let t=parseInt(32768*e/1e3);return 0==t&&e>250&&(t=1),ma[t]}const Aa=(e,t)=>Y.A.add_monitor("AB"+e);var Sa=[],_a=[];class ya{constructor(){this.levelR16LogTimer=null,this.audioStatus=-1}startLogTimer(){try{this.levelR16LogTimer||(this.levelR16LogTimer=setInterval((()=>{Sa.push("x"),_a.push("x"),Sa.length>30&&Sa.shift(),_a.length>30&&_a.shift()}),1e3)),this.audioStatus=2}catch(e){Aa("SALLTERR")}}suspendLogTimer(e){try{this.levelR16LogTimer&&(clearInterval(this.levelR16LogTimer),this.levelR16LogTimer=null),this.audioStatus=e?3:1}catch(e){Aa("PALLTERR")}}destroy(){this.suspendLogTimer(),this.levelR16LogTimer=null}}class Ca{constructor(e,t){this.workletPath=t||{},this.audioStream=null,this.audioCtx=null,this.webRTCWorkletNode=null,this.inputNode=null,this.outputNode=null,this.isDestroyed=!1,this.mutedLevelLogTimer=new ya,this.initAudioContext(),this.isCreatingWorklet=!1,this.setAudioStreamCallback=e,this.doingDenoise=!1,this.checkProcessInterval=null}initAudioContext(){if(!this.audioCtx){let e=F.Ay.getAudioContextConfigure();if(this.audioCtx=(0,F.gd)("WebRTCInput",e),!this.audioCtx)return;this.audioCtx.onstatechange=()=>{var e,t;if(H.Ay.log("WebRTCInput AudioContext state changed to ".concat(null===(e=this.audioCtx)||void 0===e?void 0:e.state)),Y.A.add_monitor("ACSC:WebRTCInput:".concat(null===(t=this.audioCtx)||void 0===t?void 0:t.state)),this.audioStream){this.setAudioStreamCallback(null,!0);const e=this.audioStream.getAudioTracks()[0];if(e){var i;const{muted:t}=e;"running"===(null===(i=this.audioCtx)||void 0===i?void 0:i.state)&&t&&(Aa("ACRM"),H.Ay.error("Audio context running when track muted"))}}},this.outputNode=this.audioCtx.createMediaStreamDestination(),this.resumeAudioCtx()}}async createWebRTCWorklet(){const{jsPath:e,wasmPath:t}=this.workletPath;if(this.audioCtx&&e&&!this.isCreatingWorklet){if(this.isCreatingWorklet=!0,!this.webRTCWorkletNode){try{await this.audioCtx.audioWorklet.addModule(e)}catch(e){return H.Ay.error("Error when add webRTC worklet module",e),void(this.isCreatingWorklet=!1)}let i;if(F.Ay.isSupportAudioDenoise(!0)&&t&&(i=await F.Ay.downloadAndCompileWebAssembly(t,"AudioWorklet",Y.A,!F.Ay.browser.isSafari&&J.A.enableStreamingInstantiate)),this.isDestroyed)return H.Ay.log("webrtc manager has been destroyed before create audio worklet node"),void this.destroy();let r=F.Ay.isBrowserSupportStereo()?2:1;this.webRTCWorkletNode=new _r(this.audioCtx,"webRTCWorklet",{processorOptions:{userAgent:navigator.userAgent,wasmModule:i,inputAudioChannel:r},numberOfOutputs:1,outputChannelCount:[2]}),this.webRTCWorkletNode.onprocessorerror=e=>{H.Ay.error("Exception thrown in WebRTC AudioWorkletProcessor",e)},this.webRTCWorkletNode.postCMD("audiowasm"),this.webRTCWorkletNode.port.addEventListener("message",(e=>{this.handleMessage(e)})),this.audioStream&&!this.inputNode&&(this.inputNode=this.audioCtx.createMediaStreamSource(this.audioStream),this.inputNode.connect(this.webRTCWorkletNode)),this.webRTCWorkletNode.connect(this.outputNode),"running"===this.audioCtx.state&&this.startCheckProcess(),H.Ay.log("create worklet successfully")}this.isCreatingWorklet=!1,this.webRTCWorkletNode.postCMD("clearBuffer"),this.resumeAudioCtx()}}handleMessage(e){var t=e.data;switch(t.status){case"AUDIO_LEVEL_R16":{var i;if(1!=(null===(i=this.mutedLevelLogTimer)||void 0===i?void 0:i.audioStatus))break;const e=t.level.toString(16);Sa.push(e),Sa.length>30&&Sa.shift()}break;case"AUDIO_LEVEL_R16_DENOISE":{var r;if(1!=(null===(r=this.mutedLevelLogTimer)||void 0===r?void 0:r.audioStatus))break;const e=t.level.toString(16);_a.push(e),_a.length>30&&_a.shift()}break;case"WASM_INIT_SUCCESS":this.changeDenoiseSwitch(this.denoiseSwitch,this.isHeadSet);break;case"audio_process_changed":H.Ay.log("denoise switch changed"+t.data),this.doingDenoise=t.data,this.setAudioStreamCallback(null,!0);break;case u._9I:null!=t.data&&J.A.Notify_APPUI_SAFE(u._9I,{value:t.data});break;case"SPEECH_LOG":Ft.push({log:t.data.log,logSource:3})}}setAudioStream(e){this.audioStream=e,this.webRTCWorkletNode&&(this.inputNode&&(this.inputNode.disconnect(),this.inputNode=null),e&&(this.inputNode=this.audioCtx.createMediaStreamSource(this.audioStream),this.inputNode.connect(this.webRTCWorkletNode)))}getAudioStream(){var e;return this.outputNode&&this.webRTCWorkletNode&&this.doingDenoise&&"running"===(null===(e=this.audioCtx)||void 0===e?void 0:e.state)?this.outputNode.stream:this.audioStream}changeDenoiseSwitch(e,t){this.denoiseSwitch=!!e,this.isHeadSet=!!t,this.webRTCWorkletNode&&this.webRTCWorkletNode.postCMD("audio_denoise_switch",{enable:this.denoiseSwitch,isHeadSet:this.isHeadSet})}getLevelR16Log(){const e=Sa.join(""),t=_a.join("");return Sa=[],_a=[],{resLevelR16Log:e,resLevelR16LogDenoise:t}}resumeAudioCtx(){var e,t,i;1!==(null===(e=this.mutedLevelLogTimer)||void 0===e?void 0:e.audioStatus)||"running"===(null===(t=this.audioCtx)||void 0===t?void 0:t.state)||"closed"===(null===(i=this.audioCtx)||void 0===i?void 0:i.state)||this.isCreatingWorklet||(this.startCheckProcess(),this.audioCtx.resume().catch((e=>{H.Ay.error("webRTC audioContext resume fail",e)})))}suspendAudioCtx(){var e;"suspended"===(null===(e=this.audioCtx)||void 0===e?void 0:e.state)||this.isCreatingWorklet||(this.stopCheckProcess(),this.audioCtx.suspend().catch((e=>{H.Ay.error("Error when suspend audio context",e)})))}changeAudioStatus(e,t){var i,r,a;t?(null===(i=this.mutedLevelLogTimer)||void 0===i||i.suspendLogTimer(!0),this.suspendAudioCtx()):e?(null===(r=this.mutedLevelLogTimer)||void 0===r||r.startLogTimer(),this.suspendAudioCtx()):(null===(a=this.mutedLevelLogTimer)||void 0===a||a.suspendLogTimer(!1),this.resumeAudioCtx())}startCheckProcess(){this.stopCheckProcess(),this.webRTCWorkletNode&&(this.webRTCWorkletNode.postCMD("clearProcess",null),this.checkProcessInterval=setInterval((()=>{this.webRTCWorkletNode&&this.webRTCWorkletNode.postCMD("checkProcess",null)}),1e4))}stopCheckProcess(){this.checkProcessInterval&&(clearInterval(this.checkProcessInterval),this.checkProcessInterval=null)}destroy(){try{this.isDestroyed=!0,this.webRTCWorkletNode&&(this.webRTCWorkletNode.disconnect(),this.webRTCWorkletNode.postCMD("stopWorklet",!0),this.webRTCWorkletNode=null),this.inputNode&&(this.inputNode.disconnect(this.audioLevelNode),this.inputNode=null),this.outputNode&&(this.outputNode.disconnect(),this.outputNode=null),this.audioCtx&&"closed"!==this.audioCtx.state&&this.audioCtx.suspend().finally((()=>{this.audioCtx.close(),this.audioCtx=null})),this.audioStream=null,this.mutedLevelLogTimer&&(this.mutedLevelLogTimer.destroy(),this.mutedLevelLogTimer=null),this.wasmModule=null,this.isCreatingWorklet=!1,Aa("DSALOK")}catch(e){Aa("DSALERR"),H.Ay.error("Error when destroy webRTC manager",e)}}}var ba=i(129),wa=i.n(ba),Ea=i(1265),Ra=i.n(Ea),Ta=["headset","pods","buds","opencomm","arctis","mpow","hyperx cloud","zone wired","aeropex by aftershokz","plt focus","xiberia","pxc 550","tk-hs001","lifechat lx","cisco 56"],Ia=[["wh-","wf-","wi-"],["1000x","ch","xb","sp","h9","c2","c5","c6","c1","h8","c4","c3"]],Ma={jabra:["evolve","pro 900","pro 920","pro 93","pro 94","talk","biz","engage","elite","uc voice","link 180","link 2","link 860","link 850","link 400","blueparrott"],plantronics:["savi","blackwire","c5","c3","c4","c6","c7","bt","audio","da","encorepro","hw111n","gamecom","apu","voyager"],logitech:["h570","h820","h650","pro x"],sennheiser:["sc","mb","pc","sd","dect","g4me1","audio"],sony:["wh","wf","mdr"],bose:["qc","quiet","soundlink","soundsport","on-ear","nc"],beats:["fit","flex","power","solo","studio","mivi"],razer:["kraken","blackshark","barracuda","nari","hammerhead","opus"],yealink:["uh","wh","yh","cp"],soundcore:["life","liberty","spirit","strike"],addasound:["sr","epic"],jbl:["tune","quantum","live","wave","t450bt","c200","everest","c310"],epos:["impact","pc 8 usb","h3","adapt"],jlab:["go","bt","epic","studio"]};var Da=i(2543);const Pa=/\(\w+:\w+\)|,/gi;function ka(e,t){return e.kind===t.kind?e.deviceId===t.deviceId?0:e.deviceId>t.deviceId?1:-1:e.kind>t.kind?1:-1}function Oa(){this._deviceList=null,this._deviceDetectTimer=null,this._lastEnumDeviceTS=null,this.addChangeListener(),this.enumDevices()}Oa.prototype.init=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.micId=null,this.micLabel=null,this.speakerId=null,this.speakerLabel=null,this.cameraId=null,this.cameraLabel=null,this.startTime=Date.now(),this.userId=0,this.videoWidth=0,this.videoHeight=0,this.audioBridge=!1,this.isUpdatingDevice=!1,this.denoiseSwitch=!1,this._onChangeCB=e.onChangeHandler},Oa.prototype.isSupportDeviceChange=function(){return!(F.Ay.isAndroidBrowser()&&!F.Ay.browser.isFirefox)},Oa.prototype.addChangeListener=function(){var e,t,i,r;this.isSupportDeviceChange()?(null===(e=navigator.mediaDevices)||void 0===e||null===(t=e.removeEventListener)||void 0===t||t.call(e,"devicechange",this.enumDevices.bind(this)),null===(i=navigator.mediaDevices)||void 0===i||null===(r=i.addEventListener)||void 0===r||r.call(i,"devicechange",this.enumDevices.bind(this))):this.enableSelfDeviceDetect()},Oa.prototype.enableSelfDeviceDetect=function(){this.disableSelfDeviceDetect(),this._deviceDetectTimer=setInterval(this.enumDevices.bind(this),3e3)},Oa.prototype.disableSelfDeviceDetect=function(){this._deviceDetectTimer&&clearInterval(this._deviceDetectTimer)},Oa.prototype.isDeviceChanged=function(e){let t=this._deviceList.slice();if(null===t)return!0;if((e=e.slice()).length!=t.length)return!0;wa()(t).call(t,ka),wa()(e).call(e,ka);let i=0,r=0;for(;!(i>=e.length||r>=t.length);){if(t[r].deviceId!=e[i].deviceId)return!0;i++,r++}return!1},Oa.prototype.enumDevices=function(){var e,t;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===(e=navigator)||void 0===e||null===(e=e.mediaDevices)||void 0===e||null===(t=e.enumerateDevices)||void 0===t?void 0:t.call(e).then((e=>{e=this.filterValidDevices(e);let t=!1;this.isSupportDeviceChange()&&i?(t=!0,this.reportAllDevicesMonitorLogs(e)):null==this._deviceList?this.reportAllDevicesMonitorLogs(e):!this.isSupportDeviceChange()&&this.isDeviceChanged(e)&&(t=!0,this.reportAllDevicesMonitorLogs(e));let r=this._deviceList;return this._deviceList=e,this._lastEnumDeviceTS=Date.now(),t&&this.onDeviceChange(r,e),this._deviceList})).catch((e=>{H.GW.error("MediaSDK catched error while enumerateDevice: ",e)}))},Oa.prototype.onDeviceChange=function(e,t){(0,Da.isFunction)(this._onChangeCB)&&this._onChangeCB(e,t)},Oa.prototype.filterValidDevices=function(e){return e.filter((e=>{let t=e.label,i=e.deviceId;return"audioinput"===e.kind?!("communications"===i||/ZoomAudioDevice/i.test(t)||/Zoom-\S*/.test(t)||/CubebAggregateDevice\S*/.test(t)||/Microsoft Teams Audio/i.test(t)):"audiooutput"!==e.kind||!F.Ay.isSafariVersionHigherThan(18.4)&&"communications"!==i&&!/ZoomAudioDevice/i.test(t)&&!/Microsoft Teams Audio/i.test(t)}))},Oa.prototype.getDeviceListAsync=async function(){return await this.enumDevices()},Oa.prototype.getDeviceListFromCache=function(){return this._deviceList},Oa.prototype.reportAllDevicesMonitorLogs=function(e){e&&e.forEach((e=>{var t;if("audioinput"==e.kind)this.sendDeviceInfo(-1,1,this.getIndex(e.label),e.deviceId,null===(t=e.label)||void 0===t||null===(t=t.replace(Pa,""))||void 0===t?void 0:Ra()(t).call(t),!0);else if("audiooutput"==e.kind){var i;this.sendDeviceInfo(-1,0,this.getIndex(e.label),e.deviceId,null===(i=e.label)||void 0===i||null===(i=i.replace(Pa,""))||void 0===i?void 0:Ra()(i).call(i),!0)}else"videoinput"===e.kind&&this.sendCameraInfo(-1,0,0,e)}))},Oa.prototype.notifyDenoiseSetting=function(){F.Ay.isSupportAudioDenoise(!!this.audioBridge)&&this.micId&&(this.audioBridge?this.audioBridge.changeDenoiseSwitch(this.denoiseSwitch,xa.isHeadSet()):Ii({command:"audio_denoise_switch",switch:this.denoiseSwitch,isHeadSet:xa.isHeadSet()}))},Oa.prototype.hasOutputDevice=async function(e){if(""===e)return!0;let t=(await this.getDeviceListAsync()).filter((e=>"audiooutput"===e.kind));return 0!==t.length&&t.filter((t=>t.deviceId===e)).length},Oa.prototype.changeDenoiseSwitch=function(e){this.denoiseSwitch=e,this.notifyDenoiseSetting()},Oa.prototype.setAudioBridge=function(e){this.audioBridge=e},Oa.prototype.hasPermission=async function(e){try{return"granted"===(await navigator.permissions.query({name:e})).state}catch(t){let i=null;if("microphone"===e)i="audioinput";else{if("camera"!==e)return!1;i="videoinput"}return(await this.getDeviceListAsync()).forEach((e=>{if(e.kind===i&&""===e.label)return!1})),!0}},Oa.prototype.setUserId=function(e){if("number"!=typeof e||Number.isNaN(e))return;const t=this.userId>>10<<10==e>>10<<10;this.userId=e,t||this.reportAllDevicesMonitorLogs(this._deviceList)},Oa.prototype.updateSelectedMicDevices=function(e,t,i,r){var a;t=null===(a=t)||void 0===a||null===(a=a.replace(Pa,""))||void 0===a?void 0:Ra()(a).call(a),r&&(this.micId=e,this.micLabel=t),this.notifyDenoiseSetting(),this.sendDeviceInfo(i,1,this.getIndex(this.micLabel),e,t,r,this.isHeadSet())},Oa.prototype.updateShareAudioDevices=function(e,t){this.sendDeviceInfo(0,2,0,e,t,!0,!1)},Oa.prototype.updateSelectedSpeakerDevices=async function(e,t,i){e=e||"default";let r="default";(await this.getDeviceListAsync()).forEach((t=>{var i;"audiooutput"===t.kind&&t.deviceId===e&&(r=null===(i=t.label)||void 0===i||null===(i=i.replace(Pa,""))||void 0===i?void 0:Ra()(i).call(i))})),i&&(this.speakerId=e,this.speakerLabel=r),this.sendDeviceInfo(t,0,this.getIndex(this.speakerLabel),e,r,i,this.isHeadSet(!1))},Oa.prototype.updateSelectedCameraDevices=function(e,t,i,r,a,n,s){var o;this.cameraId=e,this.cameraLabel=null==t||null===(o=t.replace(Pa,""))||void 0===o?void 0:Ra()(o).call(o),this.videoWidth=i,this.videoHeight=r,this.videoFrameRate=a,this.sendCameraInfo(n,s,a)},Oa.prototype.isHeadSet=function(){let e=null;return e=arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?this.speakerLabel:this.micLabel,function(e){if("string"!=typeof e)return!1;let t=e.toLowerCase();for(let e=0;e<Ta.length;e++){let i=Ta[e];if(t.includes(i))return!0}let i=Object.keys(Ma);for(let e=0;e<i.length;e++){let r=i[e];if(t.includes(r)){let e=Ma[r];for(let i=0;i<e.length;i++)if(t.includes(e[i]))return!0}}let r=Ia[0],a=Ia[1],n=!1;for(let e=0;e<r.length;e++)if(t.includes(r[e])){n=!0;break}if(n)for(let e=0;e<a.length;e++)if(t.includes(a[e]))return!0;return!1}(e)},Oa.prototype.getIndex=function(e){return"default"==e?-1:"communications"==e?F.Ay.isMac()?0:-2:0},Oa.prototype.sendDeviceInfo=function(e,t,i,r,a,n,s){if(!this.userId)return;let o=null,d=Date.now()-this.startTime;o=-1==e?"WCL_AUDIOD-ALL,"+this.userId+","+t+","+i+","+a+","+r+","+n+","+e+",7,"+d+",1":"WCL_AUDIOD,"+this.userId+","+t+","+i+","+a+","+r+","+n+","+e+",7,"+d+",1,"+(n?1:0)+","+s,J.A.sendMessageToRwg(u.yGo,{evt:u.UFw,seq:1,body:{data:o}})},Oa.prototype.sendCameraInfo=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!this.userId||this.isUpdatingDevice)return;let a=null;a=-1===e?"WCL_CAMERA-ALL,"+this.userId+",0,"+r.label+","+t+","+e+",-1,0,0,-1,"+i+",-1,"+r.deviceId:"WCL_CAMERA,"+this.userId+",0,"+this.cameraLabel+","+t+","+e+",-1,"+this.videoWidth+","+this.videoHeight+",-1,"+i+","+-1,J.A.sendMessageToRwg(u.yGo,{evt:u.UFw,seq:1,body:{data:a}})},Oa.prototype.getMicId=function(){return this.micId},Oa.prototype.getMicLabel=function(){return this.micLabel},Oa.prototype.getSpeakerId=function(){return this.speakerId};let xa=new Oa;const Va=xa;function Na(e,t){return"number"!=typeof e?0:parseFloat(e.toFixed(t)).toString()}class La{static getReportKeyFromSSRC(e,t){if(e)return t.ssrc.toString()===e?T:R}static isAudioSharing(e){return 2&e}static remoteInboundRTPStatisticParse(e,t,i,r,a){let n=this.getReportKeyFromSSRC(e,t);n&&(n!=R||this.isAudioSharing(i))&&void 0!==t.roundTripTime&&(r[n]||(r[n]={}),r[n].rtt=Math.floor(1e3*t.roundTripTime))}static outboundRTPStatisticsParse(e,t,i,r,a){let n=this.getReportKeyFromSSRC(e,t);if(!n)return;if(n==R&&!this.isAudioSharing(i))return;r[n]||(r[n]={});const{timestamp:s,bytesSent:o,packetsSent:d,nackCount:c,retransmittedBytesSent:u,retransmittedPacketsSent:h,targetBitrate:l,totalPacketSendDelay:p}=t;a[n]||(a[n]={lastBytesSent:o,lastTimeStamp:s});const{lastTimeStamp:f,lastBytesSent:g}=a[n];r[n].bytesSentPerSecond=Math.floor(s-f?1e3*(o-g)/(s-f):0),r[n].packetsSent=d,r[n].nackCount=c,r[n].retransmittedBytesSent=u,r[n].retransmittedPacketsSent=h,r[n].targetBitrate=l/1e3+"k",Object.assign(a[n],{lastBytesSent:o,lastTimeStamp:s})}static outboundBitrateQosParse(e,t){let i=0;e.forEach((e=>{if("outbound-rtp"===e.type){const{bytesSent:r,timestamp:a}=e,{lastBytesSent:n,lastTimestamp:s}=t[e.ssrc]||{};r&&a&&n&&s&&(i+=this.calculateBitrates(n,s,r,a)),t[e.ssrc]={lastBytesSent:r,lastTimestamp:a}}})),t.bitrate=i.toFixed(1)}static inboundBitrateQosParse(e,t){let i=0;e.forEach((e=>{if("inbound-rtp"===e.type){const{bytesReceived:r,timestamp:a}=e,{lastBytesReceived:n,lastTimestamp:s}=t[e.ssrc]||{};r&&a&&n&&s&&(i+=this.calculateBitrates(n,s,r,a)),t[e.ssrc]={lastBytesReceived:r,lastTimestamp:a}}})),t.bitrate=i.toFixed(1)}static calculateBitrates(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return e===i||parseInt(t)===parseInt(r)?0:8e3*(i-e)/(r-t)}static mediaSourceStatisticsParse(e,t,i,r,a){var n;let s=t.trackIdentifier==(null==e||null===(n=e.getAudioTracks()[0])||void 0===n?void 0:n.id)?"NORMAL":"SHARE";if(!s)return;if(s==R&&!this.isAudioSharing(i))return;r[s]||(r[s]={});const{audioLevel:o,echoReturnLoss:d,echoReturnLossEnhancement:c,totalAudioEnergy:u,totalSamplesDuration:h}=t;r[s].audioLevel=Na(o,2),r[s].echoReturnLoss=d,r[s].echoReturnLossEnhancement=Na(c,2),r[s].totalAudioEnergy=Na(u,2),r[s].totalSamplesDuration=Na(h,1)}static networkInfoStatisticsParse(e,t,i,r){let a=0,n=null,s=null;if("candidate-pair"===t.type){const i=e.get(t.remoteCandidateId);t.selected&&i&&(a=i.port,n=i.protocol);const r=e.get(t.localCandidateId);t.selected&&r&&(s=r.candidateType)}else if("transport"===t.type&&t.selectedCandidatePairId){let i=e.get(t.selectedCandidatePairId);const r=e.get(i.remoteCandidateId);r&&(a=r.port,n=r.protocol);const o=e.get(i.localCandidateId);o&&(s=o.candidateType)}a&&n&&(a!==i.port||n!=i.protocol||s!=i.candidateType)&&(i.port=a,i.protocol=n,i.candidateType=s,H.Ay.directReport("".concat(r," port:").concat(a,", ").concat(r," protocol:").concat(n,", ").concat(r," localcandidateType:").concat(s)))}}const Wa=(e,t)=>Y.A.add_monitor("AB"+e);class Ba{constructor(e,t,i,r){this.audioId=e,this.audioTag=document.createElement("audio"),this.audioTag.id=e,this.audioTag.srcObject=t,this.audioTag.autoplay=!0,this.audioTag.controls=!1,this.pauseCB=r,this._listenHandlePlaying=this._listenHandlePlaying.bind(this),this._listenHandlePause=this._listenHandlePause.bind(this),this._listenHandleCanPlay=this._listenHandleCanPlay.bind(this),this._listenHandleError=this._listenHandleError.bind(this),this._addListener(),document.documentElement.appendChild(this.audioTag),this.setSpeakerDevicePromise(i).catch((e=>{}))}destroy(){this._removeListener(),this.pause(),this.setStream(null),this.audioTag&&(this.audioTag.remove(),this.audioTag=null)}_addListener(){this.audioTag&&(this.audioTag.addEventListener("playing",this._listenHandlePlaying),this.audioTag.addEventListener("pause",this._listenHandlePause),this.audioTag.addEventListener("canplay",this._listenHandleCanPlay),this.audioTag.addEventListener("error",this._listenHandleError))}_removeListener(){this.audioTag&&(this.audioTag.removeEventListener("playing",this._listenHandlePlaying),this.audioTag.removeEventListener("pause",this._listenHandlePause),this.audioTag.removeEventListener("canplay",this._listenHandleCanPlay),this.audioTag.removeEventListener("error",this._listenHandleError))}_listenHandlePlaying(){Wa("ASP:"+this.audioId)}_listenHandlePause(){Wa("APP:"+this.audioId),"function"==typeof this.pauseCB&&this.pauseCB.call()}_listenHandleCanPlay(){Wa("ACP:"+this.audioId)}_listenHandleError(e){(0,We.iK)(u.BJf),H.Ay.error("RTCAudioPlayer tag error:".concat(null==e?void 0:e.code,",").concat(null==e?void 0:e.message))}isPaused(){return this.audioTag?this.audioTag.paused:void 0}isMuted(){return this.audioTag?this.audioTag.muted:void 0}isSupportSetSpeakerDevice(){var e;return!(null===(e=this.audioTag)||void 0===e||!e.setSinkId)}setStream(e){this.audioTag&&this.audioTag.srcObject!=e&&(this.audioTag.srcObject=e)}play(){return this.audioTag&&this.audioTag.play()}pause(){return this.audioTag&&this.audioTag.pause()}mute(){this.audioTag&&(this.audioTag.muted=!0)}unmute(){this.audioTag&&(this.audioTag.muted=!1)}setVolume(e){0===e?this.mute():this.unmute();const t=Math.min(Math.max(0,e),100)/100;this.audioTag&&(this.audioTag.volume=t)}setSpeakerDevicePromise(e){return new Promise(((t,i)=>this.audioTag&&this.isSupportSetSpeakerDevice()&&e?this.audioTag.sinkId==e?t():void this.audioTag.setSinkId(e).then(t).catch((e=>{H.Ay.error("Error when setting sink of audio player",e),i(e)})):t()))}}const Ua=(e,t)=>Y.A.add_monitor("AB"+e),Fa=(()=>{let e=[],t={},i=Date.now();return r=>{if(r.onlyAudioLevel)t[r.key]||(t[r.key]=[]),t[r.key].push(r.audioLevel);else if(Object.keys(t).forEach((e=>{r.ssrcMap[e]&&(r.ssrcMap[e].zoomAudioLevel=t[e])})),t={},e.push(r),Date.now()-i>14e3){let r=e.reduce(((t,i,r)=>{const{rtt:a,ssrcMap:n}=i;let s="";return Object.keys(n).forEach(((t,i,o)=>{const{aveAudioLevel:d,audioLevel:c,jitter:u,zoomAudioLevel:h,jitterBufferMinimumDelay:l,concealedSamples:p,concealmentEvents:f,insertedSamplesForDeceleration_in_5s:g,removedSamplesForAcceleration:m,silentConcealedSamples:v,audioPlayerStatus:A,totalAudioEnergy:S,aveJitterBufferDelay_ms:_,aveJitterBuffeTargetrDelay_ms:y,avePacketsReceived_in_s:C,aveBytesReceived_in_s:b,totalProcessingDelay_in_5s:w,packetsDiscarded_in_5s:E,packetsLost_in_5s:R}=n[t];s+="".concat(void 0===a?"":a,"|{[SSRCLOG]}|{").concat(t,"}|").concat(A,"|").concat(S.toFixed(4),"|").concat(h.join(""),"|").concat(va(Number(c)),"|").concat(va(Number(d)),"|").concat(1e3*u,"|").concat(_,"|").concat(y,"|").concat(R,"|").concat(C,"|").concat(b,"|").concat(l,"|").concat(E,"|").concat(p,"|").concat(f,"|").concat(g,"|").concat(m,"|").concat(v,"|").concat(w),r===e.length-1&&i===o.length-1||(s+="#")})),t+s}),"WCL_AB,{[DOWNLINK]},");i=Date.now(),r+=",{[END]}",J.A.sendMessageToRwg(u.yGo,{evt:u.UFw,seq:1,body:{data:r}}),t={},e=[]}}})(),Ga=(()=>{let e=[],t=Date.now();return i=>{if(e.push(i),Date.now()-t>14e3){let i="",r="";const a=e.reduce(((t,a,n)=>{let s="";return Object.keys(a).forEach(((e,t,n)=>{const{rtt:o="",bytesSentPerSecond:d,packetsSent:c,audioLevelR16Str:u="",audioLevelR16DenoiseStr:h="",targetBitrate:l="",nackCount:p="",retransmittedBytesSent:f="",retransmittedPacketsSent:g="",audioLevel:m="",echoReturnLoss:v="",echoReturnLossEnhancement:A="",totalAudioEnergy:S="",totalSamplesDuration:_=""}=a[e];i+=u,r+=h||u,s+="{".concat(e,"}").concat(o,"|").concat(d,"|").concat(c,"|").concat(l,"|").concat(p,"|").concat(f,"|").concat(g,"|").concat(m,"|").concat(v,"|").concat(A,"|").concat(S,"|").concat(_)})),n===e.length-1?s+=",{[SPEECH_R16]},".concat(i,",").concat(r,",{[END]}"):s+="#",t+s}),"WCL_AB,{[UPLINK]},");t=Date.now(),J.A.sendMessageToRwg(u.yGo,{evt:u.UFw,seq:1,body:{data:a}}),e=[]}}})(),Ha={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",iceServers:[],iceTransportPolicy:"all"};class ja{constructor(e,t,i,r,a,n,s,o){this.callback=s,this.onlyCheck=o,this.publisherCandidate=[],this.subscriberCandidate=[],this.retry=0,this.retryPublish=0,this.cid=e,this.wsUrl=t,this.audioPlayerMap=new Map,this.isRetrying=!1,this.recvOnly=!!i,this.audioStream=null,this.shareAudioStream=null,this.monitorTimer=null,this.audioReportCount=0,this.monitorTimerDuration=1e3,this.monitorInfo={subscriber:{},publisher:{}},this.bitrateInfo={subscriber:{},publisher:{}},this.muted=!1,this.audioMuteStatus=new Map,this.ssrcUserIdMap=new Map,this.published=!1,this.joinAudioAfterConnect=!1,this.audioMode=0,this.codecDoAVSync=!!r,this.normalAudioMap=new Map,this.shareAudioMap=new Map,this.audioProfile=0,this.syncTimer=null,n&&!this.onlyCheck&&(this.webRTCWorkletManager=new Ca(this.setNormalAudioStream.bind(this),n)),this.hasPaused=!1,this.recoverAfter1s=null,this.useWebRTCOnDesktop=a,this.receiveAudioStatus=new Map,document.addEventListener("visibilitychange",(()=>{"visible"===document.visibilityState&&this.playAllRemoteAudio()})),this.isMutedBySystem=!1,this.leaveTime=0,this.noPacketsCount=0,this.lastSentPackets=0,this.useIceServers=!1,this.iceServers=[],this.isAudioSentBytesZero=!1,this.healthCheckFailed=!1,this.audioSpeakerSetErrorCnt=0}setIceServers(e){this.iceServers=e||[]}setUseIceServers(e){this.useIceServers=e}playAllRemoteAudio(){if(this.isMutedBySystem)return;if(!this.hasPaused||!this.audioMode)return;let e=Array.from(this.audioPlayerMap.values()).map((e=>{if(e.isPaused())return e.play()}));Promise.all(e).then((()=>{this.hasPaused=!1})).catch((e=>{this.hasPaused=!0,Ua("REA"),this.notifyUIMessage(u.uoF),H.Ay.error("Error when playAllRemoteAudio: ",e)}))}async reconnect(e){if(!this.isRetrying&&!this.isDestroyed){if(this.stopAVSyncTimer(),this.stopAudioQualityMonitorTimer(),this.destroySocketAndWebRtcConnect(!0),this.retry>=3)return this.isRetrying=!1,H.Ay.error("Audio Bridge failed to reconnect",e),void this.notifyUIMessage(u.EMK);this.isRetrying=!0,await F.Ay.sleep(3e3),this.isDestroyed||(Ua("JOIN"+this.retry),this.retry++,this.notifyUIMessage(u.JoO),await this.join(!0),this.isRetrying=!1)}}async join(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(1===i)try{var r,a,n;this.cleanUserEventListener||(this.cleanUserEventListener=(0,F.zV)(this.playAllRemoteAudio.bind(this))),null===(r=this.webRTCWorkletManager)||void 0===r||r.createWebRTCWorklet(this.workletPath),null===(a=this.webRTCWorkletManager)||void 0===a||a.changeAudioStatus(!1,!1),null===(n=this.webRTCWorkletManager)||void 0===n||n.startCheckProcess()}catch(e){H.Ay.error("Error when creating webRTCWorklet",e)}var s;if(this.audioMode=this.audioMode|i,this.signal)return 0!=i&&(this.startAVSyncTimer(),this.startAudioQualityMonitorTimer(),(null===(s=this.signal.socket)||void 0===s?void 0:s.readyState)===WebSocket.OPEN&&this.signal.notify("audiostatus",{status:this.audioMode})),void(1===i&&this.unmuteAllRemoteAudio());if(!e&&this.isRetrying)return void this.destroySocketAndWebRtcConnect(e);this.destroySocketAndWebRtcConnect(e),this.signal=new qa,this.audioMode&&this.startAVSyncTimer();try{let e;t?e=t:(Ua("RTK"),J.A.sendMessageToRwg(u.NPX,{evt:u.rt8},!1),e=await this.waitForTokenFromRWG(u.gh2.AUDIO_BRIDGE_WS_TOKEN),Ua("TK")),this.signal.init("".concat(this.wsUrl,"&token=").concat(e,"&").concat(this.onlyCheck?"prob=1":"prob=0"))}catch(e){this.reconnect(e)}this.signal.onopen((async e=>{this.audioMode&&(this.signal.notify("audiostatus",{status:this.audioMode}),this.startAudioQualityMonitorTimer()),this.isOpen=!0,this.retryPublish=0,this.clearAudioPlayerMap(),await this.publish(),this.retry=0,this.audioMode&&this.notifyUIMessage(u.ETO)})),this.signal.onclose((e=>{!this.audioMode&&Date.now()-this.leaveTime>=15e3?(this.signal.destroy(),this.signal=null,this.reconnect(e)):(H.Ay.error("socket close, notify UI failover: 102"),this.notifyUIMessage(u.oQY,"102"))})),this.signal.onerror((e=>{this.isOpen||H.Ay.error("Audio Bridge WebSocket open error"),!this.audioMode&&Date.now()-this.leaveTime>=15e3?(this.signal.destroy(),this.signal=null,this.reconnect(e)):(H.Ay.error("socket error, notify UI failover: 101"),(0,We.iK)(u.oQY,"101"))})),this.signal.onmessage((e=>{if("closing"===e.method){let t=e.params.reason;return 3===t?(t="0"+(this.publisher.firstConnected?"1":"0"),J.A.peerConnectionCannotConnectTimes++):107===t&&(t="1"+(this.subscriber.firstConnected?"1":"0"),J.A.peerConnectionCannotConnectTimes++),"00"!==t&&"10"!==t||!this.iceServers.length||this.useIceServers?(H.Ay.error("received closing from audioBridge, notify UI failover: "+t),J.A.peerConnectionCannotConnectTimes<=5?this.notifyUIMessage(u.oQY,t):H.Ay.error("peerConnection cannot connect to audioBridge over 5 times"),this.callback("updateConnectionResult","00"!==t&&"10"!==t),this.callback("destroy"),!0):(this.setUseIceServers(!0),this.reconnect(t),!0)}if("qos"===e.method){let t=e.params;return t.encoding=t.encoding===parseInt(Q._c.AUDIO_ENCODE),t.sample_rate=48,t.rate=t.encoding?this.bitrateInfo.publisher.bitrate:this.bitrateInfo.subscriber.bitrate,this.notifyUIMessage(u.iQY,t),!0}return!1})),this.signal.notifyUImessage(this.notifyUIMessage.bind(this)),this.signal.on_notify("command",(e=>{const{data:t}=e||{};if(t)try{const e=JSON.parse(t),{evt:i}=e||{};i===u.zag&&this.destroy(!1)}catch(e){}})),this.signal.UpdateNTP=(e,t,i,r)=>{if(this.useWebRTCOnDesktop&&this.codecDoAVSync){let t=new ArrayBuffer(16),r=e.toString(2),a=parseInt(r.substring(0,r.length-32),2),n=parseInt(r.substring(r.length-32,r.length),2),s=new DataView(t);s.setUint32(0,i,!0),s.setUint32(4,n,!0),s.setUint32(8,a,!0),s.setUint32(12,Date.now(),!0),Ci({command:"audioDecodeTime",status:1,data:new Uint8Array(t)})}else 512&i?this.shareAudioMap.set(i>>10,{ntptime:e,rtptime:t,abssrc:r}):this.normalAudioMap.set(i>>10,{ntptime:e,rtptime:t,abssrc:r})},this.publisher&&this.removeAudioSender();let o=Object.assign({},Ha);this.useIceServers&&(H.Ay.directReport("AB_USE_TURN"),o.iceServers=this.iceServers),this.publisher=new RTCPeerConnection(o),this.subscriber=new RTCPeerConnection(o),this.normalAudioSender=null,this.shareAudioSender=null,this.publisher.addTransceiver("audio",{direction:"sendrecv"}),this.publisher.addTransceiver("audio",{direction:"sendrecv"}),this.signal.onOffer=async e=>{Ua("RERSDP"),this.updateSsrcUserIdMap(e),await this.subscriber.setRemoteDescription(e),this.subscriberCandidate.forEach((e=>this.subscriber.addIceCandidate(e))),this.subscriberCandidate=[];const t=await this.subscriber.createAnswer();t.sdp=this.updateSdpCodecParameters(t.sdp,"opus",new Map([["stereo",{value:1,operater:"add"}]])),await this.subscriber.setLocalDescription(t),Ua("RELSDP"),await this.rpc("answer",{desc:t})},this.signal.onTrickle=async(e,t)=>{0==t?null!=this.subscriber.remoteDescription?(Ua("RERICE"),this.subscriber.addIceCandidate(e)):(Ua("RERICEF"),this.subscriberCandidate.push(e)):1==t?null!=this.publisher.remoteDescription?(Ua("SERICE"),this.publisher.addIceCandidate(e)):(Ua("SERICEF"),this.publisherCandidate.push(e)):H.Ay.error("Audio Bridge onTrickle error: role: ".concat(t,", candidate: ").concat(e))},this.publisher.onicecandidate=e=>{let{candidate:t}=e;Ua("SELICE"),this.signal.notify("trickle",{candidate:t,role:1})},this.publisher.onconnectionstatechange=async()=>{if(Ua("PCSC:"+this.publisher.connectionState),this.publisher)if("disconnected"===this.publisher.connectionState)setTimeout((()=>{this.publisher&&"disconnected"===this.publisher.connectionState&&((0,We.iK)(u.ZSj,{mediaType:"audio"}),this.publish(!0))}),5e3);else if("connected"===this.publisher.connectionState&&(J.A.peerConnectionCannotConnectTimes=0,this.changeSDPAfterConnect&&(this.changeSDPAfterConnect=!1,this.resetOfferandAnswer()),this.notifyUIMessage(u.LYk,{mediaType:"audio"}),!this.publisher.firstConnected)){this.publisher.firstConnected=!0,this.notifyUIMessage(u.AeO),this.callback("updateConnectionResult",!0);const e=await this.publisher.getStats(),{publisher:t}=this.monitorInfo;e.forEach((i=>{La.networkInfoStatisticsParse(e,i,t,"publisher")}))}},this.subscriber.onicecandidate=e=>{let{candidate:t}=e;Ua("RELICE"),this.signal.notify("trickle",{candidate:t,role:0})},this.subscriber.ontrack=e=>{Ua("REVT");const t=e.streams[0],i=decodeURIComponent(t.id),r="ab-audio-"+i;e.track.onunmute=()=>{this.hasPaused=!0;let e=this.audioPlayerMap.get(i);e?e.setStream(t):(e=new Ba(r,t,Va.speakerId,(()=>{this.hasPaused=!0,"visible"===document.visibilityState&&null===this.recoverAfter1s&&(this.recoverAfter1s=setTimeout((()=>{this.recoverAfter1s=null,this.playAllRemoteAudio()}),1e3))})),this.audioPlayerMap.set(i,e)),"visible"===document.visibilityState&&null===this.recoverAfter1s&&(this.recoverAfter1s=setTimeout((()=>{this.recoverAfter1s=null,this.playAllRemoteAudio()}),1e3)),this.receiveAudioStatus.forEach(((e,t)=>{this.setShareVolumeLevel(t/10,e.volume,e.isFromMainSession,!1)})),this.isDestroyed&&e.mute(),Ua("REVTP")},e.track.onmute=()=>{Ua("REVTM");const e=this.audioPlayerMap.get(i);e&&e.destroy(),this.audioPlayerMap.delete(i)}},this.subscriber.onconnectionstatechange=async()=>{var e;if(Ua("SCSC:"+this.subscriber.connectionState),"connected"===(null===(e=this.subscriber)||void 0===e?void 0:e.connectionState)&&(J.A.peerConnectionCannotConnectTimes=0,this.notifyUIMessage(u.LYk,{mediaType:"audio"}),!this.subscriber.firstConnected)){this.subscriber.firstConnected=!0,this.notifyUIMessage(u.y2t),this.callback("updateConnectionResult",!0);const e=await this.subscriber.getStats(),{subscriber:t}=this.monitorInfo;e.forEach((i=>{La.networkInfoStatisticsParse(e,i,t,"subscriber")}))}}}notifyUIMessage(e,t){!this.onlyCheck&&J.A.Notify_APPUI&&J.A.Notify_APPUI(e,t)}async enableShareToBO(e){let t=null;try{t=await this.rpc("Enable_Share_To_BO",{enable:e})}catch(e){H.Ay.error("Error when enable share to BO",e)}t&&2==t.length?this.notifyUIMessage(u.CcD,{enable:t[1].enable}):this.notifyUIMessage(u.zds,{enable:e})}async enableBroadCastToBO(e){let t=null;try{t=await this.rpc("Enable_Broadcast_To_BO",{enable:e})}catch(e){H.Ay.error("Error when enable broadcast to bo",e)}t&&2==t.length?this.notifyUIMessage(u.g9q,{enable:t[1].enable}):this.notifyUIMessage(u.LL7,{enable:e})}leaveAudioWithoutDisconnect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;var t,i;this.audioMode=this.audioMode&~e,this.signal&&this.signal.notify("audiostatus",{status:this.audioMode}),1===e?(this.setNormalAudioStream(null),this.muteAllRemoteAudio(),this.cleanUserEventListener&&(this.cleanUserEventListener(),this.cleanUserEventListener=null),this.muted=!1,null===(t=this.webRTCWorkletManager)||void 0===t||t.changeAudioStatus(!1,!0),null===(i=this.webRTCWorkletManager)||void 0===i||i.stopCheckProcess()):2===e&&this.setShareAudioStream(null),0===this.audioMode&&(this.leaveTime=Date.now(),this.stopAudioQualityMonitorTimer(),this.stopAVSyncTimer())}async rpc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(this.isDestroyed)return H.Ay.error("audioBridge instance is destroyed, method ".concat(e)),"";try{return this.signal?this.signal.call(e,t):(H.Ay.error("Audio Bridge RPC error: signal is not available,method: ".concat(e)),"")}catch(i){return H.Ay.error("Audio Bridge RPC error: method: ".concat(e,", params: ").concat(t),i),""}}async publish(e){if(!this.publisher||!this.isOpen)return;if(e){if(this.retryPublish>=3)return;this.retryPublish++}if(!e){if(this.published)return;this.published=!0}let t=await this.publisher.createOffer({iceRestart:!!e});t.sdp=this.changeOfferSDP(t.sdp),await this.publisher.setLocalDescription(t),this.uid||e||(this.uid=Ka()),Ua("SELSDP");const i=await(e?this.rpc("offer",{desc:this.publisher.localDescription}):this.rpc("join",{uid:this.uid,offer:this.publisher.localDescription}));if(i&&2===i.length){const e=i[1];if("answer"===e.type){Ua("SERSDP"),e.sdp=this.changeOfferSDP(e.sdp),this.publisherAnswer=e,await this.publisher.setRemoteDescription(e);let t=this.publisher.getTransceivers();1===t.length?this.normalAudioSender=t[0].sender:2==t.length&&(t[0].mid<t[1].mid?(this.normalAudioSender=t[0].sender,this.shareAudioSender=t[1].sender):(this.normalAudioSender=t[1].sender,this.shareAudioSender=t[0].sender)),this.setNormalAudioStream(this.audioStream),this.setShareAudioStream(this.shareAudioStream),this.publisherCandidate.forEach((e=>{this.publisher.addIceCandidate(e),Ua("SERICE")})),this.publisherCandidate=[]}}}async resetOfferandAnswer(){let e=await this.publisher.createOffer();if(e.sdp=this.changeOfferSDP(e.sdp),this.publisherAnswer)return await this.publisher.setLocalDescription(e),this.publisherAnswer.sdp=this.changeOfferSDP(this.publisherAnswer.sdp),await this.publisher.setRemoteDescription(this.publisherAnswer),void this.rpc("Set_AudioProfile",{audioProfile:this.audioProfile});H.Ay.log("publisher answer is null when reset offer and answer")}waitForTokenFromRWG(e){return new Promise(((t,i)=>{X.on(e,((e,i)=>{t(i)}))}))}updateSdpCodecParameters(e,t,i){try{let r=[];const a=e.split("\r\n"),n=new RegExp("^a=rtpmap:([0-9]+) ".concat(t,"/"));for(let e=0;e<a.length;e++){let t=a[e].match(n);t&&r.push(t[1])}if(r.length)for(let e=0;e<a.length;e++){let t=r.reduce(((t,i)=>a[e].match(new RegExp("^a=fmtp:".concat(i," (.*)")))||t),null);if(t){const r=new Map(t[1].split(";").map((e=>e.split("="))));i.forEach(((e,t)=>{"add"===e.operater?r.set(t,e.value):"sub"===e.operater&&r.delete(t)}));let n=a[e].match(/a=fmtp:(\d+)/)[0]+" ";for(const[e,t]of r)n+="".concat(e,"=").concat(t,";");n=n.slice(0,n.length-1),a[e]=n}}return a.join("\r\n")}catch(t){return H.Ay.error("Error when updateSdpCodecParameters",t),e}}changeOfferSDP(e){try{let t=e.split("m="),i=0,r=[];for(let e=1;e<t.length;e++){if(0===t[e].indexOf("audio")){i++;let a=t[e].match(/a=mid:(\d+)/);a&&r.push(a[1])}t[e]="m="+t[e]}if(1===i)return this.updateSdpCodecParameters(e,"opus",E[this.audioProfile]);if(2!==i||2!=r.length)return H.Ay.error("Audio line invalid: "+i),H.Ay.error("mid line length invalid: "+r.length),e;let a="";for(let e=0;e<t.length;e++){if(t[e].startsWith("m=audio"))if(-1!=t[e].indexOf("mid:"+Math.min(r[0],r[1]))){if(t[e]=this.updateSdpCodecParameters(t[e],"opus",E[this.audioProfile]),-1===t[e].indexOf("cname:Normal")){t[e]=t[e].replace(/a=ssrc:(.+) cname:/,"a=ssrc:$1 cname:Normal+");let i=t[e].match(/a=ssrc:(.+) cname:/);i&&i[1]&&(this.normalAudioSSRC=i[1])}}else t[e].indexOf("mid:"+Math.min(r[0],r[1]))&&(t[e]=this.updateSdpCodecParameters(t[e],"opus",E[8]),-1===t[e].indexOf("cname:Share")&&(t[e]=t[e].replace(/a=ssrc:(.+) cname:/,"a=ssrc:$1 cname:Share+")));a+=t[e]}return a}catch(t){return H.Ay.error("Error when changeOfferSDP",t),e}}setRecvOnly(e,t){this.recvOnly=!!e,this.recvOnly?this.setNormalAudioStream(null):t&&this.setNormalAudioStream(t)}setCodecDoAVSync(e){this.codecDoAVSync=e}setNormalAudioStream(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]||(this.recvOnly?this.audioStream=null:this.audioStream=e,this.webRTCWorkletManager&&this.webRTCWorkletManager.setAudioStream(this.audioStream));let t=e;this.webRTCWorkletManager&&(t=this.webRTCWorkletManager.getAudioStream()),e&&(this.muted?this.mute():this.unmute()),this.publishAudioStream(t,this.normalAudioSender,"PAT")}setShareAudioStream(e){this.shareAudioStream=e,this.publishAudioStream(this.shareAudioStream,this.shareAudioSender,"PAST")}publishAudioStream(e,t,i){this.isDestroyed||(t?e?e.getAudioTracks().forEach((e=>{H.Ay.log("publish track label: "+e.label),Ua("".concat(i,"-").concat(e.id)),t.replaceTrack(e).catch((t=>{Ua("".concat(i,"-Failed-").concat(e.id)),H.Ay.error("error publishing audio stream",t)}))})):(t.replaceTrack(null),Ua("".concat(i,"-null"))):Ua(i+"SE "))}mute(){var e;this.muted=!0,this.audioStream&&(Ua("SEVTP"),this.audioStream.getAudioTracks().forEach((e=>{e.enabled=!1})),null===(e=this.webRTCWorkletManager)||void 0===e||e.changeAudioStatus(!0,!1))}unmute(){var e;this.muted=!1,this.audioStream&&(Ua("SEVTM"),this.audioStream.getAudioTracks().forEach((e=>{e.enabled=!0})),null===(e=this.webRTCWorkletManager)||void 0===e||e.changeAudioStatus(!1,!1))}stopIncomingAudio(e){e?this.muteAllRemoteAudio():this.unmuteAllRemoteAudio()}muteAllRemoteAudio(){for(const[e,t]of this.audioPlayerMap)t.mute()}unmuteAllRemoteAudio(){for(const[e,t]of this.audioPlayerMap)t.unmute();this.playAllRemoteAudio()}setSpeechVolumeLevel(e,t){for(const[i,r]of this.audioPlayerMap){if(-1!==i.indexOf("OS"))continue;const a=Number(i.split("+")[0]||"0"),n=Number.isNaN(a)||!a?null:a>>10<<10;if(n&&n===e>>10<<10){r.setVolume(t);break}}}async changeSpeaker(e){let t=!0,i="",r=Date.now(),a=[];for(const[r,n]of this.audioPlayerMap){if(!1===n.isSupportSetSpeakerDevice()){t=!1,i="audioplayer.setSinkId is not supported on your device";break}let r=n.setSpeakerDevicePromise(e);a.push(r)}try{await Promise.all(a)}catch(e){t=!1,i="Error when setting sink of audio player: "+e.message}if(t)this.audioSpeakerSetErrorCnt=0,this.notifyUIMessage(u.a6z,e||"default");else{this.audioSpeakerSetErrorCnt++;let e=Va.getSpeakerId();H.Ay.error("setSinkId failed ".concat(this.audioSpeakerSetErrorCnt," times, current speaker ").concat(e,", reason = ").concat(i)),this.audioSpeakerSetErrorCnt<=3&&this.notifyUIMessage(u.dsK,{reason:i,currentSink:e})}Va.updateSelectedSpeakerDevices(e,Date.now()-r,t)}setShareVolumeLevel(e,t,i){(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])&&this.receiveAudioStatus.set(10*e+(i?1:0),{volume:t,isFromMainSession:i});let r=i?/(\d+)\+OS/:/(\d+)\+CS/;for(const[i,a]of this.audioPlayerMap){let n=i.match(r);n&&n.length>=2&&n[1]>>10===e&&512&n[1]&&(t?a.unmute():a.mute())}}async set_CC_lang(e){let t=null;try{t=await this.rpc("set_CC_lang",{lang:e})}catch(e){H.Ay.error("error when setting language",e)}t&&2===t.length?this.notifyUIMessage(u.V5N,t[1].lang):this.notifyUIMessage(u.i3D,e)}updateSsrcUserIdMap(e){if(e){const{sdp:t=""}=e,i=t.match(/a=ssrc:(.+) cname:(.+)/g);i&&i.forEach((e=>{const t=e.match(/a=ssrc:(.+) cname:(.+)/);if(t&&t[1]&&t[2]){const e=Number(t[2].split("+")[0]||"0"),i=Number.isNaN(e)||!e?null:e>>10<<10,r=Number(t[1]);this.ssrcUserIdMap.set(r,i)}}))}}updateUserMuteUnmuteStatus(e){const{update:t,remove:i}=e;t&&t.length>0&&t.forEach((e=>{const{userId:t,muted:i}=e;t&&this.audioMuteStatus.set(t>>10<<10,!!i)})),i&&i.length>0&&i.forEach((e=>{const{userId:t}=e;t&&this.audioMuteStatus.set(t>>10<<10,!0)}))}isUserMuted(e){const t=this.ssrcUserIdMap.get(e);if(!t)return!1;const i=this.audioMuteStatus.get(t);return void 0!==i&&!!i}async setAudioProfile(e){if(1!==this.audioMode&&3!=this.audioMode)return;let t=this.audioProfile;"backgroundNoiseSuppression"===e.currentSelect?(e.highBitrate?this.audioProfile=16:this.audioProfile=0,Va.changeDenoiseSwitch("Zoom"===e.backgroundNoiseSuppression)):(Va.changeDenoiseSwitch(!1),e.originalSound.highfidelity&&e.originalSound.stereo?this.audioProfile=7:e.originalSound.highfidelity?this.audioProfile=5:e.originalSound.stereo?this.audioProfile=3:this.audioProfile=1),t!==this.audioProfile&&(this.publisher&&"connected"===this.publisher.connectionState?await this.resetOfferandAnswer():this.changeSDPAfterConnect=!0)}clearAudioPlayerMap(){this.muteAllRemoteAudio();for(const[e,t]of this.audioPlayerMap)t.destroy();this.audioPlayerMap.clear(),this.audioMuteStatus.clear()}getAudioPlayer(e){let t=(2+(parseInt(e)>>10<<10)).toString();if(t)for(const[e,i]of this.audioPlayerMap)if(e.includes(t))return this.audioPlayerMap.get(e)}removeAudioSender(){this.normalAudioSender&&(this.publisher.removeTrack(this.normalAudioSender),this.normalAudioSender=null),this.shareAudioSender&&(this.publisher.removeTrack(this.shareAudioSender),this.shareAudioSender=null)}destroySocketAndWebRtcConnect(e){this.published=!1;try{this.removeAudioSender()}catch(e){}this.publisher&&(this.publisher.close(),this.publisher=null),this.subscriber&&(this.subscriber.close(),this.subscriber=null),this.isOpen=!1,e||(this.retry=0),this.retryPublish=0,this.signal&&(this.signal.destroy(),this.signal=null),this.ssrcUserIdMap.clear()}destroy(){Ua("DS"),this.isDestroyed=!0,this.cleanUserEventListener&&(this.cleanUserEventListener(),this.cleanUserEventListener=null),this.stopAudioQualityMonitorTimer(),this.stopAVSyncTimer(),this.webRTCWorkletManager&&(this.webRTCWorkletManager.destroy(),this.webRTCWorkletManager=null),this.setNormalAudioStream(null),this.setShareAudioStream(null),this.clearAudioPlayerMap(),this.destroySocketAndWebRtcConnect(),this.recvOnly=!1}startAudioQualityMonitorTimer(){this.audioReportCount=0,this.stopAudioQualityMonitorTimer(),this.monitorTimer=setInterval((()=>{this._publisherStatsParse(this.audioReportCount),this._subscriberStatsParse(this.audioReportCount),this.audioReportCount++}),this.monitorTimerDuration)}stopAudioQualityMonitorTimer(){var e,t,i,r,a,n;this.monitorTimer&&(clearInterval(this.monitorTimer),this.monitorTimer=null,this.audioReportCount=0,this.monitorInfo={subscriber:{port:null===(e=this.monitorInfo)||void 0===e||null===(e=e.subscriber)||void 0===e?void 0:e.port,protocol:null===(t=this.monitorInfo)||void 0===t||null===(t=t.subscriber)||void 0===t?void 0:t.protocol,candidateType:null===(i=this.monitorInfo)||void 0===i||null===(i=i.subscriber)||void 0===i?void 0:i.candidateType},publisher:{port:null===(r=this.monitorInfo)||void 0===r||null===(r=r.publisher)||void 0===r?void 0:r.port,protocol:null===(a=this.monitorInfo)||void 0===a||null===(a=a.publisher)||void 0===a?void 0:a.protocol,candidateType:null===(n=this.monitorInfo)||void 0===n||null===(n=n.publisher)||void 0===n?void 0:n.candidateType}},this.bitrateInfo={publisher:{},subscriber:{}})}publishStream(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.setShareAudioStream(e):this.setNormalAudioStream(e),new Promise(((e,t)=>{this.published?e(!0):this.publish().then((()=>{e(!1)}))}))}stopAVSyncTimer(){this.syncTimer&&(clearInterval(this.syncTimer),this.syncTimer=null)}syncSingleView(e,t){let i=0;if(t){let e=parseInt(t).toString(2),r=e.substring(0,e.length-32),a=e.substring(e.length-32,e.length);r=parseInt(r,2),a=parseInt(a,2),i=1e3*r+232.8*a/1e9}0==J.A.mediaSDKHandle.RenderInMain?e?Ri({command:"audioTimestamp",data:i}):Ci({command:"audioDecodeTime",status:0,data:i}):e?J.A.mediaSDKHandle.SharingRenderObj&&J.A.mediaSDKHandle.SharingRenderObj.SetcATimeStamp(i):J.A.CurrentSSRCTime!=i&&(J.A.CurrentSSRCTime=i,J.A.audioPlayTime=Date.now())}startAVSyncTimer(){this.stopAVSyncTimer(),this.syncTimer=setInterval((()=>{if(!this.subscriber)return;let e=0;this.subscriber.getReceivers().forEach((t=>{t.getSynchronizationSources().forEach((t=>{e++;let i=this.ssrcUserIdMap.get(t.source),r=null,a=!1;if(r=this.shareAudioMap.get(i>>10),r&&r.abssrc===t.source?a=!0:r=this.normalAudioMap.get(i>>10),r){let e=r.ntptime,n=r.rtptime,s=e+(t.rtpTimestamp-n)*Math.pow(2,32)/48e3;this.codecDoAVSync||i>>10!=J.A.CurrentSSRC>>10&&!a||t.source===r.abssrc&&this.syncSingleView(a,s)}}))})),0===e&&(this.syncSingleView(!1,0),this.syncSingleView(!0,0))}),500)}async _publisherStatsParse(e){var t,i;const r=!(e%5),a=this.showQos&&!(e%1);if(!this.publisher)return;if(!r&&!a)return;const n=await this.publisher.getStats();if(!n)return;if(a&&La.outboundBitrateQosParse(n,this.bitrateInfo.publisher),!r)return;let s={};const{publisher:o}=this.monitorInfo;if(n.forEach((e=>{if("remote-inbound-rtp"===e.type)La.remoteInboundRTPStatisticParse(this.normalAudioSSRC,e,this.audioMode,s,o);else if("outbound-rtp"===e.type)La.outboundRTPStatisticsParse(this.normalAudioSSRC,e,this.audioMode,s,o);else if("media-source"===e.type){var t;let i=(null===(t=this.webRTCWorkletManager)||void 0===t?void 0:t.getAudioStream())||this.audioStream;La.mediaSourceStatisticsParse(i,e,this.audioMode,s,o)}})),this.handleNetworkQuality(0,null===(t=s[T])||void 0===t?void 0:t.rtt),this.handleNoAudioPackets(null===(i=s[T])||void 0===i?void 0:i.packetsSent),this.webRTCWorkletManager&&s.NORMAL){const{resLevelR16Log:e,resLevelR16LogDenoise:t}=this.webRTCWorkletManager.getLevelR16Log();s.NORMAL.audioLevelR16Str=e,s.NORMAL.audioLevelR16DenoiseStr=t}Ga(s)}async _subscriberStatsParse(e){var t;if(!this.subscriber)return;const i=!(e%5),r=!(e%1),a=this.showQos&&!(e%1),n=await this.subscriber.getStats();if(!n)return;let s={ssrcMap:{}};a&&La.inboundBitrateQosParse(n,null===(t=this.bitrateInfo)||void 0===t?void 0:t.subscriber);let o=!1;const{subscriber:d}=this.monitorInfo;n.forEach((e=>{i&&(this._subscriberCandidatePairParse(e,s),o=!0),o=this._subscriberInboundRTPParse(e,s,d,r&&!i)||o})),i&&this.handleNetworkQuality(1,s.rtt),o&&Fa(s)}_subscriberCandidatePairParse(e,t){const{subscriber:i}=this.monitorInfo,{totalRoundTripTime:r,responsesReceived:a,type:n,state:s,nominated:o}=e;if("candidate-pair"===n&&"succeeded"===s&&o){i.prevStatInfo||(i.prevStatInfo={responsesReceived:a,totalRoundTripTime:r},i.ssrcMap={});const{prevStatInfo:e}=i;Object.assign(t,{rtt:Math.floor(1e3*(a===e.responsesReceived?0:(r-e.totalRoundTripTime)/(a-e.responsesReceived)))}),Object.assign(i.prevStatInfo,{totalRoundTripTime:r,responsesReceived:a})}}_subscriberInboundRTPParse(e,t,i,r){const{type:a}=e;let n;if("inbound-rtp"===a){const{totalAudioEnergy:a,timestamp:o,jitterBufferDelay:d,jitterBufferEmittedCount:c,jitterBufferMinimumDelay:u,jitterBufferTargetDelay:h,ssrc:l,jitter:p,audioLevel:f,packetsLost:g,packetsDiscarded:m,packetsReceived:v,bytesReceived:A,concealedSamples:S,concealmentEvents:_,insertedSamplesForDeceleration:y,removedSamplesForAcceleration:C,silentConcealedSamples:b,totalProcessingDelay:w}=e,E=this.ssrcUserIdMap.get(l);if(Fa({key:"".concat(l,"-").concat(E),audioLevel:va(f),onlyAudioLevel:!0}),r)return!1;i.ssrcMap||(i.ssrcMap={});let R=i.ssrcMap[l];if(R){if(E){var s;n=!0;const e=Math.sqrt((a-R.totalAudioEnergy)/(o-R.timestamp)).toFixed(4);let i=-1;"number"==typeof f&&(i=f.toFixed(4));const r=this.calculateRate(R.jitterBufferDelay,R.jitterBufferEmittedCount,d,c,1),T=this.calculateRate(R.jitterBufferTargetDelay,R.jitterBufferEmittedCount,h,c,1),I=this.calculateRate(R.packetsReceived,R.timestamp,v,o),M=this.calculateRate(R.bytesReceived,R.timestamp,A,o),D=this.calculateRate(R.totalProcessingDelay,0,w,1,1),P=this.calculateRate(R.packetsDiscarded,0,m,1,1),k=this.calculateRate(R.insertedSamplesForDeceleration,0,y,1,1),O=this.calculateRate(R.packetsLost,0,g,1,1);t.ssrcMap["".concat(l,"-").concat(E)]=Object.assign(t.ssrcMap["".concat(l,"-").concat(E)]||{},{aveAudioLevel:e<1e-4?0:e,audioLevel:i<1e-4?0:i,jitter:p,jitterBufferMinimumDelay:u,concealedSamples:S,concealmentEvents:_,insertedSamplesForDeceleration_in_5s:k,removedSamplesForAcceleration:C,silentConcealedSamples:b,audioPlayerStatus:null!==(s=this.getAudioPlayer(E))&&void 0!==s&&s.isPaused()?0:1,totalAudioEnergy:a,aveJitterBufferDelay_ms:r,aveJitterBuffeTargetrDelay_ms:T,avePacketsReceived_in_s:I,aveBytesReceived_in_s:M,totalProcessingDelay_in_5s:D,packetsDiscarded_in_5s:P,packetsLost_in_5s:O})}}else R=i.ssrcMap[l]={},n=!1;this.isUserMuted(l)||!this.ssrcUserIdMap.has(l)?i.ssrcMap[l]=null:Object.assign(R,{totalAudioEnergy:a,timestamp:o,jitterBufferDelay:d,jitterBufferEmittedCount:c,packetsLost:g,packetsReceived:v,bytesReceived:A,jitterBufferTargetDelay:h,totalProcessingDelay:w,insertedSamplesForDeceleration:y,packetsDiscarded:m})}return n}getHealthCheckFailedAndReset(){return!!this.healthCheckFailed&&(this.healthCheckFailed=!1,!0)}handleNoAudioPackets(e){1!=this.audioMode||!this.audioStream||this.muted||(e||0)-this.lastSentPackets!=0||this.isMutedBySystem?(1==this.audioMode&&this.audioStream&&1==this.isAudioSentBytesZero&&(e||0)-this.lastSentPackets>0&&(Ua("HEALTH_CHECK_RESTORED"),J.A.Notify_APPUI_SAFE(u.FjO)),this.isAudioSentBytesZero=!1,this.noPacketsCount=0,this.lastSentPackets=e||0):(this.noPacketsCount++,2===this.noPacketsCount&&0==this.isAudioSentBytesZero&&(Ua("HEALTH_CHECK_FAILED"),(0,We.iK)(u.$qV,I),this.healthCheckFailed=!0,this.isAudioSentBytesZero=!0,this.noPacketsCount=0))}handleNetworkQuality(e,t){1==this.audioMode&&this.audioStream&&t&&(t>5e3?J.A.Notify_APPUI_SAFE(u.Joy,{isUplink:0===e,networkLevel:0,bwLevel:0}):t>2e3&&J.A.Notify_APPUI_SAFE(u.Joy,{isUplink:0===e,networkLevel:1,bwLevel:1}))}calculateRate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e3;return e===i||t===r?0:Math.floor(a*(i-e)/(r-t))}changeDenoiseSwitch(e,t){var i;this.denoiseSwitch=e,this.isHeadSet=t,null===(i=this.webRTCWorkletManager)||void 0===i||i.changeDenoiseSwitch(e,t)}updateQos(e){this.showQos=e.enable,this.signal&&this.signal.notify("qos",{enable:e.enable,encoding:parseInt(e.workerType),pollingInterval:e.pollingInterval})}}function Ka(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function qa(){this.onOffer,this.isDestroyed=!1,this.heartBeatDetection=null,this.onopen=function(e){this._onopen=e},this.onclose=function(e){this._onclose=e},this.onerror=function(e){this._onerror=e},this.onmessage=function(e){this._onmessage=e},this.notifyUImessage=function(e){this.notifyUIMessage=e},this.init=function(e){Ua("INIT: ".concat(e)),this.socket=window.audioBridgeSignal=(0,F.Gj)(e),this._notifyhandlers={},this.socket.addEventListener("open",(()=>{Ua("WSO"),this.lastMessageTimeStamp=performance.now(),this.socket.isRlb||(this.ping(),this.heartBeatDetection&&(clearTimeout(this.heartBeatDetection),this.heartBeatDetection=null),this.heartBeatDetection=setTimeout(function e(){var t;if(this.isDestroyed||1!==(null===(t=this.socket)||void 0===t?void 0:t.readyState))return;let i=performance.now()-this.lastMessageTimeStamp;i>32e3?(Ua("WST"),H.Ay.error("didn't reveive message from websocket in the last 30s, notify UI failover, duration:  "+i),(0,We.iK)(u.oQY,"100")):this.heartBeatDetection=setTimeout(e.bind(this),2e3)}.bind(this),2e3)),this._onopen&&this._onopen()})),this.socket.addEventListener("error",(e=>{this.isDestroyed||(H.Ay.directReport("Audio Bridge WebSocket received error"),Ua("WSE"),this._onerror&&this._onerror(e||!0))})),this.socket.addEventListener("close",(e=>{this.isDestroyed||(H.Ay.directReport("Audio Bridge WebSocket close"),Ua("WSC"),this._onclose&&this._onclose(e||!0))})),this.socket.addEventListener("message",(async e=>{this.lastMessageTimeStamp=performance.now();const t=JSON.parse(e.data);let i=!1;if(this._onmessage&&(i=this._onmessage(t)),!i)if("offer"===t.method)this.onOffer&&this.onOffer(t.params);else if("trickle"===t.method)this.onTrickle&&this.onTrickle(t.params.candidate,t.params.role);else if("rtcpsr"===t.method)this.UpdateNTP(t.params.ntptime,t.params.rtptime,t.params.ssrc,t.params.abssrc);else if("pong"===t.result){let e=parseInt(performance.now())-t.id;Ua("RTT: "+e)}else{const e=this._notifyhandlers[t.method];e&&e(t.params)}}))},this.on_notify=function(e,t){this._notifyhandlers[e]=t},this.notify=function(e,t,i){var r;this.isDestroyed?H.Ay.error("audioBridge instance is destroyed, method ".concat(e)):this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(JSON.stringify({method:e,params:t,id:i})):H.Ay.error("Websocket is not open: ".concat(this.socket.readyState,", ").concat(null===(r=this.socket)||void 0===r?void 0:r.url))},this.call=async function(e,t){const i=Ka();var r;if(this.socket&&this.socket.readyState===WebSocket.OPEN)return this.socket.send(JSON.stringify({method:e,params:t,id:i})),new Promise(((e,t)=>{const r=t=>{const a=JSON.parse(t.data);a.id===i&&(a.error?e(a):e(a.result),this.socket.removeEventListener("message",r))};this.socket.addEventListener("message",r)}));H.Ay.error("Websocket is not open: ".concat(this.socket.readyState,", ").concat(null===(r=this.socket)||void 0===r?void 0:r.url))},this.ping=()=>{this.notify("ping",{},parseInt(performance.now())),this.pingTimeout&&clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout((()=>{this.ping()}),1e4)},this.destroy=()=>{this.isDestroyed=!0,this.pingTimeout&&(clearTimeout(this.pingTimeout),this.pingTimeout=null),this.heartBeatDetection&&(clearTimeout(this.heartBeatDetection),this.heartBeatDetection=null),this.socket&&this.socket.close&&this.socket.close(3456,"close socket when destroy signal")}}class za{static async init(e,t){if(!window.navigator.hid||!window.navigator.hid.requestDevice)return!1;const i=this.webHid=new Xa((e=>{switch(e.eventName){case"ondevicehookswitch":J.A.Notify_APPUI_SAFE(u.$8e,"on"===e.hookStatus);break;case"ondevicemuteswitch":J.A.Notify_APPUI_SAFE(u.tjY,e.isMute)}}));return await i.open({label:e,muted:t,hookStatus:"off"})}static sendReport(e,t){switch(e){case"hookswitch":this.webHid.sendDeviceReport({command:t?"offHook":"onHook"});break;case"mute":this.webHid.sendDeviceReport({command:t?"muteOn":"muteOff"})}}static async destroy(){await this.webHid.close()}}class Xa{constructor(e){this.deviceUsage={mute:{usageId:524297,usageName:"Mute"},offHook:{usageId:524311,usageName:"Off Hook"},ring:{usageId:524312,usageName:"Ring"},hookSwitch:{usageId:720928,usageName:"Hook Switch"},phoneMute:{usageId:720943,usageName:"Phone Mute"}},this.deviceCommand={outputReport:{mute:{reportId:0,usageOffset:-1},offHook:{reportId:0,usageOffset:-1},ring:{reportId:0,itemIndex:-1}},inputReport:{hookSwitch:{reportId:0,usageOffset:-1,isAbsolute:!1},phoneMute:{reportId:0,usageOffset:-1,isAbsolute:!1}}},this.device=null,this.inputReportRetFunc=e}getHexByte(e){let t=Number(e).toString(16);for(;t.length<2;)t="0"+t;return t}getHexByteStr(e){let t="";for(let i=0;i<e.byteLength;++i)t+=this.getHexByte(e.getUint8(i))+" ";return t}parseDeviceDescriptors(){try{if(this.outputEventGenerators=new Map,!this.device||!this.device.collections)return;let e=this.device.collections.find((e=>11===e.usagePage));if(!e||0===Object.keys(e).length)return;if(e.inputReports&&!this.parseInputReports(e.inputReports))return!1;if(e.outputReports)return!!this.parseOutputReports(e.outputReports)}catch(e){console.error("parseDeviceDescriptors error:"+JSON.stringify(e,null,"    "))}}parseInputReports(e){return e.forEach((e=>{if(!e.items.length||void 0===e.reportId)return;let t=0;e.items.forEach((i=>{void 0!==i.usages&&void 0!==i.reportSize&&void 0!==i.reportCount&&void 0!==i.isAbsolute&&(i.usages.forEach(((r,a)=>{switch(r){case this.deviceUsage.hookSwitch.usageId:this.deviceCommand.inputReport.hookSwitch={reportId:e.reportId,usageOffset:t+a*i.reportSize,isAbsolute:i.isAbsolute};break;case this.deviceUsage.phoneMute.usageId:this.deviceCommand.inputReport.phoneMute={reportId:e.reportId,usageOffset:t+a*i.reportSize,isAbsolute:i.isAbsolute}}})),t+=i.reportCount*i.reportSize)}))})),0!==this.deviceCommand.inputReport.phoneMute.reportData&&0!==this.deviceCommand.inputReport.hookSwitch}parseOutputReports(e){let t,i,r;e.forEach((e=>{if(!e.items.length||void 0===e.reportId)return;let t=0,i=new Map;e.items.forEach((r=>{void 0!==r.usages&&void 0!==r.reportSize&&void 0!==r.reportCount&&(r.usages.forEach(((a,n)=>{switch(a){case this.deviceUsage.mute.usageId:this.deviceCommand.outputReport.mute={reportId:e.reportId,usageOffset:t+n*r.reportSize},i.set(a,t+n*r.reportSize);break;case this.deviceUsage.offHook.usageId:this.deviceCommand.outputReport.offHook={reportId:e.reportId,usageOffset:t+n*r.reportSize},i.set(a,t+n*r.reportSize);break;case this.deviceUsage.ring.usageId:this.deviceCommand.outputReport.ring={reportId:e.reportId,usageOffset:t+n*r.reportSize},i.set(a,t+n*r.reportSize)}})),t+=r.reportCount*r.reportSize)}));let r=t;for(let[e,t]of i)this.outputEventGenerators[e]=e=>{let i=new Uint8Array(r/8);if(t>=0&&e){let e=Math.trunc(t/8),r=t%8;i[e]=1<<r}return i}}));for(let e in this.outputEventGenerators){let a=this.getHexByte(e);a="0x0"+a,this.deviceUsage.mute.usageId===Number(a)?t=this.outputEventGenerators[this.deviceUsage.mute.usageId]:this.deviceUsage.offHook.usageId===Number(a)?r=this.outputEventGenerators[this.deviceUsage.offHook.usageId]:this.deviceUsage.ring.usageId===Number(a)&&(i=this.outputEventGenerators[this.deviceUsage.ring.usageId])}return!!(t||i||r)}async open(e){const t=await navigator.hid.getDevices();if(t.length&&(this.device=t.find((t=>e.label.includes(t.productName)))),!this.device){let t=[];try{t=await navigator.hid.requestDevice({filters:[{usagePage:11}]})}catch(e){H.Ay.error("hid requestDevice error")}t.length&&(this.device=t.find((t=>e.label.includes(t.productName))))}if(!this.device)return!1;try{return this.device.opened&&await this.device.close(),await this.device.open(),!!this.parseDeviceDescriptors()&&(this.device.oninputreport=await this.handleInputReport.bind(this),this.resetState({muted:e.muted,hookStatus:e.hookStatus}),!0)}catch(e){console.error("error content:"+e)}}async close(){try{if(this.resetState({muted:!1,hookStatus:"on"}),!this.device)return;this.device&&this.device.opened&&await this.device.close(),this.device.oninputreport=null,this.device=null}catch(e){console.error(e)}}resetState(e){let{muted:t,hookStatus:i}=e;this.device&&this.device.opened&&(this.device.hookStatus=i,this.device.muted=t,this.device.ring=!1,this.sendDeviceReport({command:"off"===i?"offHook":"onHook"}),this.sendDeviceReport({command:t?"muteOn":"muteOff"}))}async sendDeviceReport(e){if(!(e&&e.command&&this.device&&this.device.opened))return;if("muteOn"===e.command||"muteOff"===e.command){if(!this.outputEventGenerators[this.deviceUsage.mute.usageId])return}else if("onHook"===e.command||"offHook"===e.command){if(!this.outputEventGenerators[this.deviceUsage.offHook.usageId])return}else if(("onRing"===e.command||"offRing"===e.command)&&!this.outputEventGenerators[this.deviceUsage.ring.usageId])return;let t,i,r,a,n,s,o,d,c,u=0,h=null;switch(e.command){case"muteOn":case"muteOff":u=this.deviceCommand.outputReport.mute.reportId;break;case"onHook":case"offHook":u=this.deviceCommand.outputReport.offHook.reportId;break;case"onRing":case"offRing":u=this.deviceCommand.outputReport.ring.reportId;break;default:return}if(0!=u){if(i=this.device.muted,"off"===this.device.hookStatus)t=!0;else{if("on"!==this.device.hookStatus)return;t=!1}switch(r=this.device.ring,e.command){case"muteOn":n=!0;break;case"muteOff":n=!1;break;case"onHook":a=!1;break;case"offHook":a=!0;break;case"onRing":s=!0;break;case"offRing":s=!1;break;default:return}if(this.outputEventGenerators[this.deviceUsage.mute.usageId]&&(d=void 0===n?this.outputEventGenerators[this.deviceUsage.mute.usageId](i):this.outputEventGenerators[this.deviceUsage.mute.usageId](n)),this.outputEventGenerators[this.deviceUsage.offHook.usageId]&&(o=void 0===a?this.outputEventGenerators[this.deviceUsage.offHook.usageId](t):this.outputEventGenerators[this.deviceUsage.offHook.usageId](a)),this.outputEventGenerators[this.deviceUsage.ring.usageId]&&(c=void 0===s?this.outputEventGenerators[this.deviceUsage.ring.usageId](r):this.outputEventGenerators[this.deviceUsage.ring.usageId](s)),u===this.deviceCommand.outputReport.mute.reportId)if(null===h)h=new Uint8Array(d);else for(const[e,t]of d.entries())h[e]|=t;if(u===this.deviceCommand.outputReport.offHook.reportId)if(null===h)h=new Uint8Array(o);else for(const[e,t]of o.entries())h[e]|=t;if(u===this.deviceCommand.outputReport.ring.reportId)if(null===h)h=new Uint8Array(c);else for(const[e,t]of c.entries())h[e]|=t;switch(await this.device.sendReport(u,h),e.command){case"muteOn":this.device.muted=!0;break;case"muteOff":this.device.muted=!1;break;case"onHook":this.device.hookStatus="on";break;case"offHook":this.device.hookStatus="off";break;case"onRing":this.device.ring=!0;break;case"offRing":this.device.ring=!1}}}async sendReplyReport(e,t,i){let r,a,n,s,o=0;if(this.deviceCommand.outputReport.offHook.reportId===this.deviceCommand.outputReport.mute.reportId||e===this.deviceCommand.inputReport.hookSwitch.reportId?o=this.deviceCommand.outputReport.offHook.reportId:e===this.deviceCommand.inputReport.phoneMute.reportId&&(o=this.deviceCommand.outputReport.mute.reportId),this.device&&this.device.opened&&0!==o&&void 0!==t&&void 0!==i){if(this.deviceCommand.outputReport.offHook.reportId===this.deviceCommand.outputReport.mute.reportId){a=this.outputEventGenerators[this.deviceUsage.mute.usageId](i),n=this.outputEventGenerators[this.deviceUsage.offHook.usageId](t),r=new Uint8Array(n);for(const[e,t]of a.entries())r[e]|=t}else o===this.deviceCommand.outputReport.offHook.reportId?(n=this.outputEventGenerators[this.deviceUsage.offHook.usageId](t),r=new Uint8Array(n)):o===this.deviceCommand.outputReport.mute.reportId?(a=this.outputEventGenerators[this.deviceUsage.mute.usageId](i),r=new Uint8Array(a)):o===this.deviceCommand.outputReport.ring.reportId&&(s=this.outputEventGenerators[this.deviceUsage.mute.usageId](i),r=new Uint8Array(s));await this.device.sendReport(o,r)}}handleInputReport(e){let t=this;try{const{data:i,device:r,reportId:a}=e;if(0===a)return;let n=t.deviceCommand.inputReport;if(a!==n.hookSwitch.reportId&&a!==n.phoneMute.reportId)return;let s=!1,o=!1,d=new Uint8Array(i.buffer),c=!0;if(a===n.hookSwitch.reportId){let e=n.hookSwitch,r=Math.trunc(e.usageOffset/8),a=e.usageOffset%8,o=!!(i.getUint8(r)&1<<a);n.hookSwitch.isAbsolute?"on"===t.device.hookStatus&&o?(t.device.hookStatus="off",s=!0):"off"!==t.device.hookStatus||o||(t.device.hookStatus="on",s=!0):o&&(t.device.hookStatus="off"===t.device.hookStatus?"on":"off",s=!0)}if(t.device.muted,a===n.phoneMute.reportId){let e=n.phoneMute,r=Math.trunc(e.usageOffset/8),a=e.usageOffset%8,s=!!(i.getUint8(r)&1<<a);n.phoneMute.isAbsolute?t.device.muted!=s&&(t.device.muted=s,o=!0):s&&(t.device.muted=!t.device.muted,o=!0)}let u={productName:r.productName,reportId:t.getHexByte(a),reportData:d};if(s&&(u.eventName="ondevicehookswitch",u.hookStatus=t.device.hookStatus),o&&(u.eventName="ondevicemuteswitch",u.isMute=t.device.muted),t.inputReportRetFunc&&t.inputReportRetFunc(u),c&&(s||o)){let e;if("off"===this.device.hookStatus)e=!0;else{if("on"!==this.device.hookStatus)return;e=!1}t.sendReplyReport(a,e,t.device.muted)}}catch(e){console.error(e)}}}var Ya=i(6206),Qa=i.n(Ya);const Ja={[Q._c.AUDIO_ENCODE]:"audioEncodeInitInstance",[Q._c.AUDIO_DECODE]:"audioDecInitInstance",[Q._c.VIDEO_ENCODE]:"videoInitInstance",[Q._c.VIDEO_DECODE]:"videoDecInitInstance",[Q._c.SHARING_ENCODE]:"sharingEncInitInstance",[Q._c.SHARING_DECODE]:"sharingDecInitInstance"};class Za{constructor(){this.logWriterMap=window.logWriterMap=new Map,this.inited=!1}async init(){this.inited||(this.inited=!0,Object.values(Q._c).forEach((async e=>{const t=await async function(){const e=new Ya.FileWriter({maxDaysToKeepFile:1,fileSizeQuota:10485760});return new Promise((t=>{e.on("initOK",(()=>{t(e)}))}))}();this.logWriterMap.set(e,t),await J.A[Ja[e]].waitforInitSuccess();const i=t.createMessagePort();er(e,i,"local_log_port",!0,!0),t.startWriteNormalLogFile({filenamePrefix:Q.is[e],filenameExtension:".log",timestamp:!1,newLine:!1}),t.on("startWriteNormalLogFileReady",(()=>{er(e,null,"local_log_ready",!1,!0)}))})))}saveLogFileByWorkerType(e){const t=this.logWriterMap.get(e);t&&t.saveLog()}saveAllLogFiles(){Qa().selectSaveDir().then((()=>{Object.values(Q._c).forEach((e=>{Qa().saveLog({filenamePrefix:Q.is[e],filenameExtension:".log"})}))}))}}class $a{constructor(){this.timeMap=new Map,this.baseTime=0,this.totalTime=0}flushTimeMap(){const e=performance.now(),t=this.timeMap.get(this.status)||0,i=e-this.baseTime;this.timeMap.set(this.status,t+i),this.baseTime=e,this.totalTime+=i}start(e){this.status=e,this.baseTime=performance.now()}update(e){e!==this.status&&(this.flushTimeMap(),this.status=e)}end(){this.flushTimeMap();const e={};for(const[t,i]of this.timeMap)e[String(t)]=Number((i/this.totalTime*100).toFixed(2));return e}}class en{constructor(){this.pressureLevel={nominal:0,fair:1,serious:2,critical:3},this.pressureStatisticHelper=new $a,this.observer=new PressureObserver((e=>{this.result=this.pressureLevel[e[0].state],Y.A.add_monitor("CPC:"+this.result),this.pressureStatisticHelper.update(e[0].state)}))}init(){this.initPromise=this.observer.observe("cpu").then((()=>{this.pressureStatisticHelper.start("nominal")})).catch((e=>{(F.Ay.isWindows()||F.Ay.isMac()||F.Ay.isChromeOS())&&H.Ay.warn("ComputePressure observe error: ",e)})).finally((()=>{this.initPromise=null}))}destroy(){if(this.initPromise)this.initPromise.then((()=>{this.observer.unobserve("cpu");const e=this.pressureStatisticHelper.end();H.Ay.log("CPU pressure report: ".concat(JSON.stringify(e)))}));else{this.observer.unobserve("cpu");const e=this.pressureStatisticHelper.end();H.Ay.log("CPU pressure report: ".concat(JSON.stringify(e)))}}}function tn(e,t,i){rn(e,t),t.set(e,i)}function rn(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function an(e,t){return e.get(sn(e,t))}function nn(e,t,i){return e.set(sn(e,t),i),i}function sn(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}(0,o.A)(en,"isSupportComputePressure",(()=>"function"==typeof PressureObserver));var on=new WeakMap,dn=new WeakMap,cn=new WeakMap,un=new WeakMap,hn=new WeakMap,ln=new WeakMap,pn=new WeakMap,fn=new WeakMap,gn=new WeakMap,mn=new WeakMap,vn=new WeakMap,An=new WeakMap,Sn=new WeakMap,_n=new WeakMap,yn=new WeakMap,Cn=new WeakMap,bn=new WeakMap,wn=new WeakMap,En=new WeakMap,Rn=new WeakMap,Tn=new WeakMap,In=new WeakMap,Mn=new WeakMap,Dn=new WeakMap,Pn=new WeakMap,kn=new WeakSet;function On(e){e&&e.forEach((e=>{e.markRenderingStatePending()}));const t=sn(kn,this,zn).call(this,e);if(an(fn,this)&&an(pn,this)&&an(vn,this))if(an(on,this)&&0!=an(on,this).width&&0!=an(on,this).height&&an(pn,this)&&an(pn,this).getCurrentTexture()&&0!=an(pn,this).getCurrentTexture().width&&0!=an(pn,this).getCurrentTexture().height)try{if(!an(_n,this)){const e=an(Pn,this).byteLength,t=e;nn(_n,this,an(vn,this).acquireBuffer(t,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE,e,!0,!1)),new Float32Array(an(_n,this).getMappedRange()).set(an(Pn,this)),an(_n,this).unmap()}const e=sn(kn,this,Bn).call(this);for(const[i,r]of t)sn(kn,this,Yn).call(this,i,r,e);const i=sn(kn,this,qn).call(this,an(pn,this).getCurrentTexture().createView()),r=e.beginRenderPass(i);r.setVertexBuffer(0,an(_n,this));for(const[e,i]of t)if(i&&0!=i.length)for(const e of i){if(e.unlock(),e.getTextureLayerType()==Nr.Zq.UNKNOWN)continue;const t=e.getTextureType();let i=e.getUVCoords();if(t!==Nr.D2.CLEAR_COLOR&&!i)continue;const a=an(on,this).width,n=an(on,this).height;let s=e.getViewport();if(!s||Number.isNaN(s.x)||Number.isNaN(s.y)||Number.isNaN(s.w)||Number.isNaN(s.h)||s.x<0||s.y<0)continue;if(s.x+s.w>a){let e=s.x+s.w-a;if(!(e>0&&e<=Nr.vO))continue;s.w-=e,s.w<=0&&(s.w=1)}if(s.y+s.h>n){let e=s.y+s.h-n;if(!(e>0&&e<=Nr.vO))continue;s.h-=e,s.h<=0&&(s.h=1)}const o=sn(kn,this,Xn).call(this,e);if(!o)continue;if(o.pipelineType!==Nr.vx.CLEAR_COLOR){let t=e.getUVCoordsBuffer();if(!t){const r=i.byteLength;t=an(vn,this).acquireBuffer(r,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,i.byteLength,!1,!1),e.setUVCoordsBuffer(t)}an(fn,this).queue.writeBuffer(t,0,i,0,i.length),r.setVertexBuffer(1,t)}r.setViewport(s.x,s.y,s.w,s.h,s.minDepth,s.maxDepth);const d=o.pipeline;r.setPipeline(d);const c=an(fn,this).createBindGroup({layout:d.getBindGroupLayout(0),entries:o.entries});r.setBindGroup(0,c),r.draw(6,1,0,0)}r.end(),sn(kn,this,Un).call(this)}catch(e){Ye("[WebGUPRenderer] renderNoMsaa() error:".concat(e.message))}finally{an(ln,this).recycleInUsedGPUBuffers(t)}else an(ln,this).recycleInUsedGPUBuffers(t);else an(ln,this).recycleInUsedGPUBuffers(t)}function xn(e){if(!an(fn,this)||!an(pn,this))return;const t=an(fn,this).createBuffer({label:"VertexBuffer",size:an(Pn,this).byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE,mappedAtCreation:!0});new Float32Array(t.getMappedRange()).set(an(Pn,this)),t.unmap();const i=sn(kn,this,Bn).call(this),r=sn(kn,this,zn).call(this,e);for(const[e,t]of r)sn(kn,this,Yn).call(this,e,t,i);const a=sn(kn,this,Zn).call(this,an(on,this)),n=sn(kn,this,Kn).call(this,0,a.createView(),an(pn,this).getCurrentTexture().createView()),s=i.beginRenderPass(n);s.setVertexBuffer(0,t);for(const[e,t]of r)if(t&&0!=t.length)for(const e of t){if(e.unlock(),e.getTextureLayerType()==Nr.Zq.UNKNOWN)continue;let t=e.getUVCoords();if(!t)continue;let i=e.getUVCoordsBuffer();if(!i){const r=t.byteLength;i=an(vn,this).acquireBuffer(r,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,t.byteLength,!1,!0),e.setUVCoordsBuffer(i)}an(fn,this).queue.writeBuffer(i,0,t,0,t.length),s.setVertexBuffer(1,i);const r=an(on,this).width,a=an(on,this).height;let n=e.getViewport();if(!n||Number.isNaN(n.x)||Number.isNaN(n.y)||Number.isNaN(n.w)||Number.isNaN(n.h)||n.x<0||n.y<0||n.x+n.w>r||n.y+n.h>a)continue;const o=sn(kn,this,Xn).call(this,e,!0);if(!o)continue;s.setViewport(n.x,n.y,n.w,n.h,n.minDepth,n.maxDepth);const d=o.pipeline;s.setPipeline(d);const c=an(fn,this).createBindGroup({layout:d.getBindGroupLayout(0),entries:o.entries});s.setBindGroup(0,c),s.draw(6,1,0,0)}s.end(),sn(kn,this,Un).call(this),e.forEach((e=>{e.markRenderingStatePending()}))}function Vn(e){if(!Array.isArray(e))return;let t=[];for(let i=0;i<e.length;++i){let r=e[i];t.push(r.x),t.push(r.y)}an(Pn,this).set(t,0)}function Nn(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=e.getTextureBufferGroup();if(!an(fn,this))return console.warn("[evalYuvTextureGroup] GPUDevice is not ready!"),r&&r.buffer&&r.buffer.unmap(),null;if(!t)return console.warn("[evalYuvTextureGroup] command encoder is invalid!"),r&&r.buffer&&r.buffer.unmap(),null;if(!r)return i||null;"unmapped"!=r.buffer.mapState&&r.buffer.unmap();let a=null,n=null,s=null;const o=e.getWidth(),d=e.getHeight(),c=null!=i&&(o!=i.yPlaneTex.width||d!=i.yPlaneTex.height);let u=!0;i&&(c?(an(ln,this).destroyTextureGroup(e),u=!0):(a=i.yPlaneTex,n=i.uPlaneTex,s=i.vPlaneTex,u=!1));let h=!1,l="r8unorm";if(r&&r.bufferConfig&&"nv12"==r.bufferConfig.colorFormat&&(l="rg8unorm",h=!0),u){const t=e.getIndex(),i=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC,r=an(Sn,this).assembleTextureConfig(o,d,i,"r8unorm",1),c=an(Sn,this).assembleTextureConfig(o/2,d/2,i,l,1);a=an(Sn,this).acquireTexture(r),a&&(a.label="RD(".concat(t,")-YPlaneTexture")),h?(n=an(Sn,this).acquireTexture(c),n&&(n.label="RD(".concat(t,")-UVPlaneTexture"))):(n=an(Sn,this).acquireTexture(c),n&&(n.label="RD(".concat(t,")-UPlaneTexture")),s=an(Sn,this).acquireTexture(c),s&&(s.label="RD(".concat(t,")-VPlaneTexture")))}t.copyBufferToTexture({buffer:r.buffer,offset:r.yPlaneBuffer.offset,bytesPerRow:r.yPlaneBuffer.bytesPerRow,rowsPerImage:r.yPlaneBuffer.rowsPerImage},{texture:a},[o,d,1]),t.copyBufferToTexture({buffer:r.buffer,offset:r.uPlaneBuffer.offset,bytesPerRow:r.uPlaneBuffer.bytesPerRow,rowsPerImage:r.uPlaneBuffer.rowsPerImage},{texture:n},[o/2,d/2,1]),r.vPlaneBuffer.offset>0&&!h&&t.copyBufferToTexture({buffer:r.buffer,offset:r.vPlaneBuffer.offset,bytesPerRow:r.vPlaneBuffer.bytesPerRow,rowsPerImage:r.vPlaneBuffer.rowsPerImage},{texture:s},[o/2,d/2,1]);let p={};return p.yPlaneTex=a,p.uPlaneTex=n,p.vPlaneTex=s,p}function Ln(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=e.getTextureBufferGroup();if(!an(fn,this))return console.warn("[evalRgbaTexture] GPUDevice is not ready!"),r&&r.buffer&&r.buffer.unmap(),null;if(!t)return console.warn("[evalRgbaTexture] command encoder is invalid!"),r&&r.buffer&&r.buffer.unmap(),null;if(!r)return i||null;"unmapped"!=r.buffer.mapState&&r.buffer.unmap();const a=e.getIndex(),n=e.getWidth(),s=e.getHeight(),o=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;let d=null;const c=null!=i&&(n!=i.width||s!=i.height);let u=!0;if(i&&(c?(an(ln,this).destroyTextureGroup(e),u=!0):(d=i,u=!1)),u){const e=an(Sn,this).assembleTextureConfig(n,s,o,"rgba8unorm",1);d=an(Sn,this).acquireTexture(e),d&&(d.label="RD(".concat(a,")-rgbaTexture"))}return t.copyBufferToTexture({buffer:r.buffer,offset:0,bytesPerRow:r.bytesPerRow,rowsPerImage:r.rowsPerImage},{texture:d},[n,s,1]),d}function Wn(e,t){return Math.ceil(e/t)*t}function Bn(){return an(fn,this)?(an(mn,this)||nn(mn,this,an(fn,this).createCommandEncoder()),an(mn,this)):(Ye("GPUDevice is not ready! No available command encoder."),null)}function Un(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;an(mn,this)&&e?an(fn,this).queue.submit([an(mn,this).finish(),e.finish()]):an(mn,this)?an(fn,this).queue.submit([an(mn,this).finish()]):e&&an(fn,this).queue.submit([e.finish()]),nn(mn,this,null)}function Fn(e,t){if(!an(fn,this))return null;if(!an(In,this)){let i=an(fn,this).createBindGroupLayout({label:"CursorTexBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]});if(!i)return null;const r=an(fn,this).createPipelineLayout({label:"CursorTexPipelineLayout(".concat(e,")"),bindGroupLayouts:[i]}),a={label:"CursorTexRenderPipeline(".concat(e,")"),layout:r,vertex:{module:an(fn,this).createShaderModule({code:Nr.ff}),entryPoint:"v_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:an(fn,this).createShaderModule({code:Nr.ff}),entryPoint:"f_main",targets:[{format:an(gn,this),blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"}};t&&(a.multisample={count:4}),nn(In,this,an(fn,this).createRenderPipeline(a))}return an(In,this)}function Gn(e,t){if(!an(fn,this))return null;if(!an(Tn,this)){let i=an(fn,this).createBindGroupLayout({label:"WatermarkTexBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}}]});if(!i)return null;const r=an(fn,this).createPipelineLayout({label:"WatermarkTexPipelineLayout(".concat(e,")"),bindGroupLayouts:[i]}),a={label:"WatermarkTexRenderPipeline(".concat(e,")"),layout:r,vertex:{module:an(fn,this).createShaderModule({code:Nr.Vx}),entryPoint:"v_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:an(fn,this).createShaderModule({code:Nr.Vx}),entryPoint:"f_main",targets:[{format:an(gn,this),blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"}};t&&(a.multisample={count:4}),nn(Tn,this,an(fn,this).createRenderPipeline(a))}return an(Tn,this)}function Hn(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!an(fn,this)||!e)return null;if(!an(wn,this)){const i=an(fn,this).createBindGroupLayout({label:"YuvBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:4,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:5,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:6,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),r={label:"YuvRenderPipeline",layout:an(fn,this).createPipelineLayout({label:"YuvPipelineLayout",bindGroupLayouts:[i]}),vertex:{module:an(fn,this).createShaderModule({code:e}),entryPoint:"vertex_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:an(fn,this).createShaderModule({code:e}),entryPoint:"fragment_main",targets:[{format:an(gn,this)}]},primitive:{topology:"triangle-list"}};t&&(r.multisample={count:4}),nn(wn,this,an(fn,this).createRenderPipeline(r))}return an(wn,this)}function jn(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!an(fn,this)||!e)return null;if(!an(En,this)){const i=an(fn,this).createBindGroupLayout({label:"YuvBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:4,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:5,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),r={label:"YuvRenderPipeline",layout:an(fn,this).createPipelineLayout({label:"YuvPipelineLayout",bindGroupLayouts:[i]}),vertex:{module:an(fn,this).createShaderModule({code:e}),entryPoint:"vertex_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:an(fn,this).createShaderModule({code:e}),entryPoint:"fragment_main",targets:[{format:an(gn,this)}]},primitive:{topology:"triangle-list"}};t&&(r.multisample={count:4}),nn(En,this,an(fn,this).createRenderPipeline(r))}return an(En,this)}function Kn(e,t,i){return{label:"renderPass - ".concat(e),colorAttachments:[{view:t,resolveTarget:i,loadOp:"clear",storeOp:"discard"}]}}function qn(e){return e&&(e.label="canvas-texture-view"),{label:"RenderPassNoMsaa",colorAttachments:[{view:e,loadOp:"clear",storeOp:"store"}]}}function zn(e){let t=new Map;for(let i=0;i<e.length;++i){const r=e[i].getTextureLayersMap();for(let e=Nr.x0.VS_BASE;e<Nr.x0.END;++e)if(r.has(e)){const i=r.get(e);if(i){let r=t.get(e);r||(r=[]),r.push(i),t.set(e,r)}}}return t}function Xn(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=null,r=null,a=null,n=null;const s=e.getZIndex(),o=e.getTextureType(),d=e.getColorFormat();if(s==Nr.x0.VS_BASE){if(o==Nr.D2.EXTERNAL_TEX){n=Nr.vx.VIDEO_FRAME,i=this.acquireVideoFrameRenderPipeline(Nr.qv,t),r=this.acquireVideoFrameSampler();const s=e.getPendingVideoFrame();if(!s||0==s.codedWidth||0==s.codedHeight||!s.format)return e.setPendingVideoFrame(null),null;const o=e.getUniformBuffer();if(!o)return null;a=[{binding:0,resource:r},{binding:1,resource:an(fn,this).importExternalTexture({source:s})},{binding:2,resource:{buffer:o}}]}else if(o==Nr.D2.CLEAR_COLOR){n=Nr.vx.CLEAR_COLOR,i=this.acquireClearColorRenderPipeline(Nr.iN);const t=e.getClearColorUniformBuffer();if(!t)return null;a=[{binding:0,resource:{buffer:t}}]}else if(o==Nr.D2.GPU_TEX_YUV){"i420"==d?(n=Nr.vx.YUV_I420,i=sn(kn,this,Hn).call(this,Nr.tU,t)):"nv12"==d&&(n=Nr.vx.YUV_NV12,i=sn(kn,this,jn).call(this,Nr.dc,t)),r=this.acquireYuvTexturesSamplers();const s=e.getUniformBuffer();if(!s)return null;const o=e.getTextureGroup();o&&("i420"==d?a=[{binding:0,resource:r[0]},{binding:1,resource:r[1]},{binding:2,resource:o.yPlaneTex.createView()},{binding:3,resource:o.uPlaneTex.createView()},{binding:4,resource:o.vPlaneTex.createView()},{binding:5,resource:{buffer:s}},{binding:6,resource:{buffer:s}}]:"nv12"==d&&(a=[{binding:0,resource:r[0]},{binding:1,resource:r[1]},{binding:2,resource:o.yPlaneTex.createView()},{binding:3,resource:o.uPlaneTex.createView()},{binding:4,resource:{buffer:s}},{binding:5,resource:{buffer:s}}]))}}else if(s==Nr.x0.WATERMARK||s==Nr.x0.MASK){n=Nr.vx.RGBA_WATERMARK,i=sn(kn,this,Gn).call(this,s,t),r=this.acquireBlendTextureSampler();const o=e.getTextureGroup();o&&(a=[{binding:0,resource:r},{binding:1,resource:o.createView()}])}else if(s==Nr.x0.CURSOR){n=Nr.vx.RGBA_CURSOR,i=sn(kn,this,Fn).call(this,s,t),r=this.acquireBlendTextureSampler();const o=e.getUniformBuffer();if(!o)return null;const d=e.getTextureGroup();d&&(a=[{binding:0,resource:r},{binding:1,resource:d.createView()},{binding:2,resource:{buffer:o}}])}if(n===Nr.vx.CLEAR_COLOR){if(!i||!a)return null}else if(!i||!r||!a||null==n)return null;return{pipelineType:n,pipeline:i,entries:a}}function Yn(e,t,i){for(const r of t){const t=r.getTextureType();t!=Nr.D2.EXTERNAL_TEX&&t!=Nr.D2.CLEAR_COLOR&&(e==Nr.x0.VS_BASE?sn(kn,this,Qn).call(this,r,i):e!=Nr.x0.CURSOR&&e!=Nr.x0.WATERMARK&&e!=Nr.x0.MASK||sn(kn,this,Jn).call(this,r,i))}}function Qn(e,t){let i=e.getTextureGroup();i?e.isNew()&&(i=sn(kn,this,Nn).call(this,e,t,i),e.setIsNew(!1)):(i=sn(kn,this,Nn).call(this,e,t,null),e.setIsNew(!1)),i&&e.setTextureGroup(i)}function Jn(e,t){let i=e.getTextureGroup();i?e.isNew()&&(i=sn(kn,this,Ln).call(this,e,t,i),e.setIsNew(!1)):(i=sn(kn,this,Ln).call(this,e,t,null),e.setIsNew(!1)),i&&e.setTextureGroup(i)}function Zn(e){if(!e||!an(fn,this))return an(Dn,this)?an(Dn,this):null;if(an(Dn,this)){if(an(Dn,this).width!=e.width||an(Dn,this).height!=e.height){const t=an(Sn,this).assembleTextureConfig(e.width,e.height,GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT,an(gn,this),4);nn(Dn,this,an(Sn,this).acquireTexture(t))}}else{const t=an(Sn,this).assembleTextureConfig(e.width,e.height,GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT,an(gn,this),4);nn(Dn,this,an(Sn,this).acquireTexture(t))}return an(Dn,this)}const $n=class{constructor(e,t){var i;if(rn(this,i=kn),i.add(this),tn(this,on,null),tn(this,dn,0),tn(this,cn,0),tn(this,un,!1),tn(this,hn,!1),tn(this,ln,null),tn(this,pn,null),tn(this,fn,null),tn(this,gn,null),tn(this,mn,null),tn(this,vn,null),tn(this,An,null),tn(this,Sn,null),tn(this,_n,null),tn(this,yn,null),tn(this,Cn,null),tn(this,bn,null),tn(this,wn,null),tn(this,En,null),tn(this,Rn,null),tn(this,Tn,null),tn(this,In,null),tn(this,Mn,null),tn(this,Dn,null),tn(this,Pn,new Float32Array(12)),!t)throw new Error("[WebGPURenderer] resMgr is an invalid param! ".concat(t));nn(on,this,e),nn(ln,this,t),this.initialize(e)}switchMsaa(e){nn(hn,this,e)}isMsaaEnabled(){return an(hn,this)}setCanvas(e){e&&nn(on,this,e)}setDevice(e){e&&nn(fn,this,e)}setRenderArgs(e,t){nn(dn,this,e||0),nn(cn,this,an(dn,this)?3:t?4:6),nn(un,this,t||!1)}setTextureIndex(e){nn(dn,this,e||0)}initialize(e){an(fn,this)||(nn(fn,this,an(ln,this).acquireGPUDevice()),an(fn,this))?(an(gn,this)||nn(gn,this,an(ln,this).acquireCanvasFormat()),an(vn,this)||nn(vn,this,an(ln,this).acquireGPUBufferMgr()),an(An,this)||nn(An,this,an(ln,this).acquireGPUBufferPool()),an(Sn,this)||nn(Sn,this,an(ln,this).acquireGPUTextureMgr()),this.configureGPUContext(e),sn(kn,this,Vn).call(this,Nr.ch)):Ye("[WebGPURenderer] initialize() device is not ready!")}isGPUDeviceReady(){return null!=an(fn,this)}render(e){an(hn,this)?sn(kn,this,xn).call(this,e):sn(kn,this,On).call(this,e)}updateVertexCoords(e){sn(kn,this,Vn).call(this,e)}createRGBATexture(e,t,i,r,a){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(t<0)return Ye("[createRGBATexture] ".concat(t," is an invalid index!")),null;if(!an(vn,this))return console.warn("[createRGBATexture] buffer manager is not ready!"),null;if(!an(fn,this))return console.warn("[createRGBATexture] GPUDevice is not ready!"),null;if(null==a||void 0===a)return console.warn("[createRGBATexture] rgbaData is invalid!"),null;if(!e)return console.warn("[createRGBATexture] command encoder is invalid!"),null;const s=sn(kn,this,Wn).call(this,Uint32Array.BYTES_PER_ELEMENT*i,256),o=GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC,d=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;let c=null;const u=null!=n&&(i!=n.width||r!=n.height);let h=!0;if(n&&(u?(an(Sn,this).recycleTexture(n),h=!0):(c=n,h=!1)),h){const e=an(Sn,this).assembleTextureConfig(i,r,d,"rgba8unorm",1);c=an(Sn,this).acquireTexture(e),c&&(c.label="RD(".concat(t,")-rgbaTexture"))}const l=an(vn,this).acquireBuffer("".concat(t,"_Y"),o,s*r,!0,!1),p=new Uint8Array(l.getMappedRange()),f=i*Uint32Array.BYTES_PER_ELEMENT;for(let e=0;e<r;++e)p.set(a.subarray(e*f,(e+1)*f),e*s);return l.unmap(),e.copyBufferToTexture({buffer:l,offset:0,bytesPerRow:s,rowsPerImage:r},{texture:c},[i,r,1]),c}writeToYuvTexturesBufferGroup(e,t){if(!(an(vn,this)&&e&&t&&t.buffer&&t.bufferConfig&&"mapped"==t.buffer.mapState))return null;let i=e.yPlane,r=e.cbPlane,a=e.crPlane;const n=sn(kn,this,Wn).call(this,Uint8Array.BYTES_PER_ELEMENT*i.width,256);let s=Uint8Array.BYTES_PER_ELEMENT;"nv12"==t.bufferConfig.colorFormat&&(s=Uint16Array.BYTES_PER_ELEMENT);const o=sn(kn,this,Wn).call(this,s*r.width,256),d=n*i.height;let c=0,u=n*i.height+o*r.height;a&&a.buffer&&(u+=o*a.height,c=0+d+o*r.height);let h=t.buffer,l=t.bufferArray;l||(l=h.getMappedRange(0,u),t.bufferArray=l);const p=new Uint8Array(l),f=i.width*Uint8Array.BYTES_PER_ELEMENT;if(0+i.height*n>=p.length)return console.error("[WebGPURenderer] write yPlane is out of range! yPlaneOffset=".concat(0,", yPlane.height=").concat(i.height,", yPlaneBytesPerRow=").concat(n,", mappedArray.len=").concat(p.length)),null;for(let e=0;e<i.height;++e)p.set(i.buffer.subarray(e*f,(e+1)*f),0+e*n);let g=f/2;if(0==c&&(g=r.width*Uint16Array.BYTES_PER_ELEMENT),d+r.height*o>p.length)return null;for(let e=0;e<r.height;++e)p.set(r.buffer.subarray(e*g,(e+1)*g),d+e*o);if(c>0){if(c+a.height*o>p.length)return null;for(let e=0;e<a.height;++e)p.set(a.buffer.subarray(e*g,(e+1)*g),c+e*o)}return t.buffer=h,t.yPlaneBuffer={bytesPerRow:n,rowsPerImage:i.height,offset:0},t.uPlaneBuffer={bytesPerRow:o,rowsPerImage:r.height,offset:d},t.vPlaneBuffer={bytesPerRow:o,rowsPerImage:a.height,offset:c},t}writeToRgbaTextureBuffer(e,t,i,r,a){if(!(an(vn,this)&&r&&a&&a.buffer))return null;const n=sn(kn,this,Wn).call(this,Uint32Array.BYTES_PER_ELEMENT*t,256),s=a.buffer;let o=a.bufferArray;o||(o=s.getMappedRange(),a.bufferArray=o);const d=new Uint8Array(o),c=t*Uint32Array.BYTES_PER_ELEMENT;for(let e=0;e<i;++e)d.set(r.subarray(e*c,(e+1)*c),e*n);return a.buffer=s,a.bytesPerRow=n,a.rowsPerImage=i,a}produceVideoFrame(e,t){return new VideoFrame(e,t)}writeUniformBuffer(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!an(fn,this))return Ye("writeUniformBuffer() GPUDevice is not ready yet."),null;if(!t||0==t.length)return null;let r=i;return r||(r=an(fn,this).createBuffer({label:e,size:t.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})),an(fn,this).queue.writeBuffer(r,0,t,0,t.length),r}acquireBlendTextureSampler(){return an(fn,this)?(an(Mn,this)||nn(Mn,this,an(fn,this).createSampler({})),an(Mn,this)):null}configureGPUContext(e){an(pn,this)||(nn(pn,this,e.getContext("webgpu")),an(pn,this)?an(pn,this).configure({device:an(fn,this),format:an(gn,this),alphaMode:"premultiplied"}):Ye("configureGPUContext() webgpuContext is invalid! canvas=".concat(e)))}unconfigureGPUContext(){an(pn,this)&&(an(pn,this).unconfigure(),nn(pn,this,null))}acquireVideoFrameRenderPipeline(e,t){if(!an(fn,this)||!e)return null;if(!an(yn,this)){const i=an(fn,this).createBindGroupLayout({label:"VideoFrameBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,externalTexture:{}},{binding:2,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),r={label:"VideoFrameRenderPipeline",layout:an(fn,this).createPipelineLayout({label:"VideoFramePipelineLayout",bindGroupLayouts:[i]}),vertex:{module:an(fn,this).createShaderModule({code:e}),entryPoint:"vertex_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:an(fn,this).createShaderModule({code:e}),entryPoint:"fragment_main",targets:[{format:an(gn,this)}]},primitive:{topology:"triangle-list"}};t&&(r.multisample={count:4}),nn(yn,this,an(fn,this).createRenderPipeline(r))}return an(yn,this)}acquireClearColorRenderPipeline(e){if(!an(fn,this)||!e)return null;if(!an(Cn,this)){const t=an(fn,this).createBindGroupLayout({label:"ClearColorBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]}),i={label:"ClearColorRenderPipeline",layout:an(fn,this).createPipelineLayout({label:"ClearColorPipelineLayout",bindGroupLayouts:[t]}),vertex:{module:an(fn,this).createShaderModule({code:e}),entryPoint:"v_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]}]},fragment:{module:an(fn,this).createShaderModule({code:e}),entryPoint:"f_main",targets:[{format:an(gn,this)}]},primitive:{topology:"triangle-list"}};nn(Cn,this,an(fn,this).createRenderPipeline(i))}return an(Cn,this)}acquireVideoFrameSampler(){return an(fn,this)?(an(bn,this)||nn(bn,this,an(fn,this).createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"})),an(bn,this)):null}acquireYuvTexturesSamplers(){if(!an(fn,this))return null;if(!an(Rn,this)){nn(Rn,this,[]);const e=an(fn,this).createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"}),t=an(fn,this).createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"});an(Rn,this).push(e),an(Rn,this).push(t)}return an(Rn,this)}clearAttachedCanvas(){if(!an(fn,this)||!an(pn,this)||!an(_n,this))return;if(!an(on,this)||0==an(on,this).width||0==an(on,this).height)return;const e=an(fn,this).createCommandEncoder(),t=e.beginRenderPass({colorAttachments:[{view:an(pn,this).getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]}),i=an(fn,this).createRenderPipeline({layout:"auto",vertex:{module:an(fn,this).createShaderModule({code:Nr.O9}),entryPoint:"v_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]}]},fragment:{module:an(fn,this).createShaderModule({code:Nr.O9}),entryPoint:"f_main",targets:[{format:an(gn,this)}]},primitive:{topology:"triangle-list"}});t.setVertexBuffer(0,an(_n,this)),t.setPipeline(i),t.draw(6),t.end(),an(fn,this).queue.submit([e.finish()])}clear(){console.log("WebGPURender.clear")}cleanup(){this.unconfigureGPUContext(),nn(on,this,null),nn(gn,this,null),nn(mn,this,null),nn(_n,this,null),nn(yn,this,null),nn(Cn,this,null),nn(bn,this,null),nn(wn,this,null),nn(En,this,null),nn(Rn,this,null),nn(Tn,this,null),nn(In,this,null),nn(Mn,this,null),nn(Dn,this,null),an(vn,this)&&nn(vn,this,null),an(fn,this)&&nn(fn,this,null)}};function es(e,t,i){ts(e,t),t.set(e,i)}function ts(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function is(e,t,i){return e.set(as(e,t),i),i}function rs(e,t){return e.get(as(e,t))}function as(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}var ns=new WeakMap,ss=new WeakMap,os=new WeakMap,ds=new WeakMap,cs=new WeakSet;function us(){return!0}function hs(){if(rs(os,this)){let e={};return e.architecture=rs(os,this).architecture,e.vendor=rs(os,this).vendor,e}return null}async function ls(){if(!navigator.gpu)return is(ns,this,Nr.W5.NOT_SUPPORTED),!1;const e=await navigator.gpu.requestAdapter();return e?await e.requestDevice()?("function"==typeof e.requestAdapterInfo?(is(os,this,await e.requestAdapterInfo()),rs(os,this)&&console.log("adapter info: ".concat(rs(os,this).architecture,", ").concat(rs(os,this).vendor))):"info"in e&&is(os,this,e.info),is(ns,this,Nr.W5.AVAILABLE),!0):(is(ns,this,Nr.W5.CANNOT_REQ_DEVICE),!1):(is(ns,this,Nr.W5.CANNOT_REQ_ADAPTER),!1)}function ps(e){if(!e)return!1;const t=e.vendor;return-1!==Nr.O$.indexOf(t)}function fs(e,t,i){return gs.produce(e,t,i)}class gs{static produce(e,t,i){let r=null;return e===Nr.h3.WEBGPU&&(r=new $n(t,i)),r}}const ms=class{constructor(){var e;ts(this,e=cs),e.add(this),es(this,ns,Nr.W5.AVAILABLE),es(this,ss,Nr.h3.WEBGL),es(this,os,null),es(this,ds,new Map)}async evaluate(e){if(is(ss,this,Nr.h3.WEBGL),!as(cs,this,us).call(this))return rs(ss,this);if(!e.allowedOnTargetPlatforms)return rs(ss,this);if(!e.allowedOnTargetBrowsers)return rs(ss,this);if(!await as(cs,this,ls).call(this))return rs(ss,this);const t=as(cs,this,hs).call(this);if(!as(cs,this,ps).call(this,t))return rs(ss,this);let i=new OffscreenCanvas(1,1);return i.getContext("webgpu")?(i=null,is(ss,this,Nr.h3.WEBGPU),rs(ss,this)):(i=null,rs(ss,this))}acquireRenderer(e,t){let i=null;return arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&rs(ds,this).clear(),rs(ds,this).has(e)&&(i=rs(ds,this).get(e),i&&(e&&(i.setCanvas(e),i.initialize(e)),t&&i.setDevice(t.acquireGPUDevice()))),null==i&&(i=as(cs,this,fs).call(this,rs(ss,this),e,t),i&&rs(ds,this).set(e,i)),i}rendererReinitialize(){if(rs(ds,this))for(const[e,t]of rs(ds,this))t&&t.initialize(e)}rendererUnconfigureGPUContext(){if(rs(ds,this))for(const[e,t]of rs(ds,this))t&&t.unconfigureGPUContext()}getRendererType(){return rs(ss,this)}setRendererType(e){is(ss,this,e)}isWebGPURendererType(){return rs(ss,this)===Nr.h3.WEBGPU}isWebGLRendererType(){return rs(ss,this)===Nr.h3.WEBGL}isWebGL2RendererType(){return rs(ss,this)===Nr.h3.WEBGL_2}cleanup(){for(const[e,t]of rs(ds,this))t&&t.cleanup();rs(ds,this).clear()}};function vs(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}var As=new WeakSet;function Ss(e){e.forEach((e=>{e.consumePendingGPUEvents()}))}function _s(e){return!e||0==e.length||-1==e.findIndex((e=>!!e&&(!!e.getTextureLayerByZIndex(Nr.x0.VS_BASE)&&e.isRenderingStateReady())))}const ys=class{constructor(){var e,t;(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e=this,t=As),t.add(e)}render(e,t){return e?e.isGPUDeviceReady()?t&&0!=t.length?(vs(As,this,Ss).call(this,t),void(vs(As,this,_s).call(this,t)||e.render(t))):(console.warn("[RendererController] render displays are not available!"),void Je("WGPU RendererController_render() displays are not available!")):(console.log("[RendererController] GPU device is not ready!"),void Je("WGPU RendererController_render() GPU device is not ready!")):(console.warn("[RendererController] renderer is not attached!"),void Je("WGPU RendererController_render() renderer is not attached!"))}};function Cs(e,t,i){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,i)}function bs(e,t){return e.get(Es(e,t))}function ws(e,t,i){return e.set(Es(e,t),i),i}function Es(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}var Rs=new WeakMap,Ts=new WeakMap,Is=new WeakMap,Ms=new WeakMap,Ds=new WeakMap,Ps=new WeakMap,ks=new WeakMap,Os=new WeakMap,xs=new WeakMap,Vs=new WeakMap,Ns=new WeakMap,Ls=new WeakMap,Ws=new WeakMap,Bs=new WeakMap,Us=new WeakMap,Fs=new WeakMap,Gs=new WeakMap,Hs=new WeakMap;const js=class{constructor(e,t){Cs(this,Rs,0),Cs(this,Ts,-1),Cs(this,Is,0),Cs(this,Ms,0),Cs(this,Ds,-1),Cs(this,Ps,null),Cs(this,ks,-1),Cs(this,Os,null),Cs(this,xs,null),Cs(this,Vs,null),Cs(this,Ns,!1),Cs(this,Ls,null),Cs(this,Ws,null),Cs(this,Bs,null),Cs(this,Us,null),Cs(this,Fs,null),Cs(this,Gs,!1),Cs(this,Hs,""),ws(Rs,this,e),ws(Ts,this,t)}getIndex(){return bs(Rs,this)}lock(){ws(Ns,this,!0)}unlock(){ws(Ns,this,!1)}isLocked(){return bs(Ns,this)}getZIndex(){return bs(Ts,this)}setWidth(e){ws(Is,this,e)}setHeight(e){ws(Ms,this,e)}getWidth(){return bs(Is,this)}getHeight(){return bs(Ms,this)}getRawData(){return bs(Ps,this)}setRawData(e){ws(Ps,this,e)}setIsNew(e){ws(Gs,this,e)}isNew(){return bs(Gs,this)}setColorFormat(e){ws(Hs,this,e)}getColorFormat(){return bs(Hs,this)}setPendingVideoFrame(e){bs(Ls,this)&&(bs(Ls,this).close(),ws(Ls,this,null)),ws(Ls,this,e)}clearPendingVideoFrame(){bs(Ls,this)&&(bs(Ls,this).close(),ws(Ls,this,null))}setTextureLayerType(e){ws(Ds,this,e)}getTextureLayerType(){return bs(Ds,this)}setTextureType(e){ws(ks,this,e)}getTextureType(){return bs(ks,this)}getPendingVideoFrame(){return bs(Ls,this)}getUVCoords(){return bs(xs,this)}setUVCoords(e){ws(xs,this,e)}getUVCoordsBuffer(){return bs(Us,this)}setUVCoordsBuffer(e){ws(Us,this,e)}evalViewport(e,t,i,r,a){bs(Vs,this)||ws(Vs,this,{}),bs(Vs,this).x=Math.floor(e),bs(Vs,this).w=Math.floor(i),bs(Vs,this).h=Math.floor(r),bs(Ds,this)==Nr.Zq.BASE_LAYER?bs(Vs,this).y=Math.floor(a-(t+r)):bs(Vs,this).y=Math.floor(t),bs(Vs,this).x<0&&(bs(Vs,this).x=0),bs(Vs,this).y<0&&(bs(Vs,this).y=0),bs(Vs,this).minDepth=0,bs(Vs,this).maxDepth=1}setViewport(e){ws(Vs,this,e)}getViewport(){return bs(Vs,this)}getTextureGroup(){return bs(Os,this)}setTextureGroup(e){ws(Os,this,e)}setUniformBuffer(e){ws(Ws,this,e)}getUniformBuffer(){return bs(Ws,this)}setClearColorUniformBuffer(e){ws(Bs,this,e)}getClearColorUniformBuffer(){return bs(Bs,this)}setTextureBufferGroup(e){ws(Fs,this,e)}getTextureBufferGroup(){return bs(Fs,this)}destroyTextureBufferGroup(){bs(Fs,this)&&ws(Fs,this,null)}recycle(e){this.destroyTextureBufferGroup(),e&&e.destroyTextureGroup(this),bs(Ls,this)&&(bs(Ls,this).close(),ws(Ls,this,null)),bs(Ws,this)&&(bs(Ws,this).destroy(),ws(Ws,this,null)),bs(Bs,this)&&(bs(Bs,this).destroy(),ws(Bs,this,null)),ws(Rs,this,-1),ws(Ts,this,-1),ws(Ds,this,Nr.Zq.UNKNOWN),ws(Ps,this,null),ws(ks,this,Nr.D2.UNKNOWN),ws(xs,this,null),ws(Vs,this,null),ws(Ns,this,!1),ws(Gs,this,!1),ws(Hs,this,"")}};function Ks(e,t,i){qs(e,t),t.set(e,i)}function qs(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function zs(e,t){return e.get(Ys(e,t))}function Xs(e,t,i){return e.set(Ys(e,t),i),i}function Ys(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}var Qs=new WeakMap,Js=new WeakMap,Zs=new WeakMap,$s=new WeakMap,eo=new WeakMap,to=new WeakMap,io=new WeakMap,ro=new WeakMap,ao=new WeakMap,no=new WeakMap,so=new WeakMap,oo=new WeakMap,co=new WeakMap,uo=new WeakMap,ho=new WeakMap,lo=new WeakMap,po=new WeakMap,fo=new WeakMap,go=new WeakMap,mo=new WeakMap,vo=new WeakMap,Ao=new WeakMap,So=new WeakMap,_o=new WeakMap,yo=new WeakMap,Co=new WeakMap,bo=new WeakMap,wo=new WeakMap,Eo=new WeakMap,Ro=new WeakMap,To=new WeakMap,Io=new WeakMap,Mo=new WeakMap,Do=new WeakMap,Po=new WeakMap,ko=new WeakMap,Oo=new WeakMap,xo=new WeakMap,Vo=new WeakMap,No=new WeakMap,Lo=new WeakMap,Wo=new WeakMap,Bo=new WeakSet;function Uo(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Ys(Bo,this,Jo).call(this),!zs(uo,this)||!zs(ho,this)||!zs(uo,this).isGPUDeviceReady())return void(i instanceof VideoFrame&&i.close());const a=Nr.x0.VS_BASE,n=Ys(Bo,this,$o).call(this,a);if(n.isLocked()){const a=n.getPendingVideoFrame();!a||a.codedWidth==e&&a.codedHeight==t?i instanceof VideoFrame&&i.close():i instanceof VideoFrame?n.setPendingVideoFrame(i):(r&&Ys(Bo,this,Go).call(this,n,e,t,i),Ye("updateVideoFrameBaseTextureLayer() an unexpected case!"),console.error("updateVideoFrameBaseTextureLayer() an unexpected case!"))}else i instanceof VideoFrame?n.getPendingVideoFrame()!=i&&n.setPendingVideoFrame(i):(r&&Ys(Bo,this,Go).call(this,n,e,t,i),Ye("updateVideoFrameBaseTextureLayer() an unexpected case!"),console.error("updateVideoFrameBaseTextureLayer() an unexpected case!")),n.setTextureLayerType(Nr.Zq.BASE_LAYER),n.setTextureType(Nr.D2.EXTERNAL_TEX),n.lock();this.markRenderingStateReady()}function Fo(e,t,i,r,a,n){Ys(Bo,this,Jo).call(this);const s=Nr.x0.VS_BASE,o=Ys(Bo,this,$o).call(this,s);if(o.setTextureLayerType(Nr.Zq.BASE_LAYER),o.setTextureType(Nr.D2.GPU_TEX_YUV),o.clearPendingVideoFrame(),o.isLocked()){const e=o.getWidth(),r=o.getHeight();e==t&&r==i||(o.setWidth(t),o.setHeight(i),o.setIsNew(!0))}else o.setWidth(t),o.setHeight(i),o.setIsNew(!0),o.lock();const d=Ys(Bo,this,cd).call(this,r,t,i,n),c=zs(uo,this).writeToYuvTexturesBufferGroup(d,a);o.setTextureBufferGroup(c)}function Go(e,t,i,r){const a=Ys(Bo,this,hd).call(this,t,i);a.label="RgbaTexBuffer(".concat(e.getIndex(),")-").concat(a.size);let n=e.getTextureBufferGroup();if(n=Ys(Bo,this,ld).call(this,e,n,a),!n||!n.buffer)return console.warn("[updateRgbaBaseTexLayer()] texLayer(".concat(e.getIndex(),") cannot apply a GPU buffer!")),void this.markRenderingStatePending();Ys(Bo,this,Ko).call(this,zs(Qs,this),t,i,r,n),this.markRenderingStateReady()}function Ho(e,t,i,r,a){const n=Nr.x0.CURSOR,s=Ys(Bo,this,$o).call(this,n);if(s.setTextureLayerType(Nr.Zq.BLEND_LAYER),s.setTextureType(Nr.D2.GPU_TEX_RGBA),s.isLocked()){const e=s.getWidth(),r=s.getHeight();e==t&&r==i||(s.setWidth(t),s.setHeight(i),s.setIsNew(!0))}else s.setWidth(t),s.setHeight(i),s.setIsNew(!0),s.lock();const o=zs(uo,this).writeToRgbaTextureBuffer(e,t,i,r,a);s.setTextureBufferGroup(o)}function jo(e,t,i,r,a){const n=Nr.x0.WATERMARK,s=Ys(Bo,this,$o).call(this,n);if(s.setTextureLayerType(Nr.Zq.BLEND_LAYER),s.setTextureType(Nr.D2.GPU_TEX_RGBA),s.isLocked()){const e=s.getWidth(),r=s.getHeight();e==t&&r==i||(s.setWidth(t),s.setHeight(i),s.setIsNew(!0))}else s.setWidth(t),s.setHeight(i),s.setIsNew(!0),s.lock();const o=zs(uo,this).writeToRgbaTextureBuffer(e,t,i,r,a);s.setTextureBufferGroup(o)}function Ko(e,t,i,r,a){const n=Nr.x0.VS_BASE,s=Ys(Bo,this,$o).call(this,n);if(s.setTextureLayerType(Nr.Zq.BASE_LAYER),s.setTextureType(Nr.D2.GPU_TEX_RGBA),s.isLocked()){const e=s.getWidth(),r=s.getHeight();e==t&&r==i||(s.setWidth(t),s.setHeight(i),s.setIsNew(!0))}else s.setWidth(t),s.setHeight(i),s.setIsNew(!0),s.lock();const o=zs(uo,this).writeToRgbaTextureBuffer(e,t,i,r,a);s.setTextureBufferGroup(o)}function qo(e,t,i){if(!Ys(Bo,this,fd).call(this,e))return;if(!zs(ho,this))return void console.log("drawVideoFrameBaseTextureLayer() canvas is invalid? canvas=".concat(zs(ho,this)));const r=Nr.x0.VS_BASE,a=Ys(Bo,this,$o).call(this,r);let n=a.getUVCoords(),s=Ys(Bo,this,Xo).call(this,zs($s,this),zs(eo,this),zs(Zs,this),zs(ao,this),i,e.width,e.height);n||(n=new Float32Array(12)),n.set(s,0),a.setUVCoords(n);const o=zs(Zs,this).width>zs(Zs,this).height,d=zs(ho,this).width>e.width,c=zs(ho,this).height>e.height;let u=d?e.width:zs(ho,this).width,h=c?e.height:zs(ho,this).height;if(o){const i=Math.abs(t.left)*u,r=Math.abs(t.top)*h,n=e.x+(e.width-i)/2;let s=0;s=e.y>=0?e.y+(e.height-r)/2:0,a.evalViewport(n,s,i,r,zs(ho,this).height)}else{let t=e.height*zs(Zs,this).width/zs(Zs,this).height;t>e.width&&(t=e.width);let i=zs(Zs,this).height/zs(Zs,this).width*t;const r=e.x+e.width/2-t/2;let n=0;n=e.y>0?e.y+(e.height-i)/2:0===e.y&&e.height>i?(e.height-i)/2:0,a.evalViewport(r,n,t,i,zs(ho,this).height)}const l=Ys(Bo,this,td).call(this);l&&l.buffer&&a.setUniformBuffer(l.buffer)}function zo(e,t,i){const r=Nr.x0.VS_BASE,a=Ys(Bo,this,$o).call(this,r);let n=a.getUVCoords(),s=Ys(Bo,this,Xo).call(this,zs($s,this),zs(eo,this),zs(Zs,this),zs(ao,this),i,e.width,e.height);n||(n=new Float32Array(12)),n.set(s,0),a.setUVCoords(n);const o=zs(Zs,this).width>zs(Zs,this).height,d=zs(ho,this).width>e.width,c=zs(ho,this).height>e.height;let u=d?e.width:zs(ho,this).width,h=c?e.height:zs(ho,this).height;if(o){const i=Math.abs(t.left)*u,r=Math.abs(t.top)*h,n=e.x+(e.width-i)/2;let s=0;s=e.y>=0?e.y+(e.height-r)/2:0,a.evalViewport(n,s,i,r,zs(ho,this).height)}else{let t=e.height*zs(Zs,this).width/zs(Zs,this).height;t>e.width&&(t=e.width);let i=zs(Zs,this).height/zs(Zs,this).width*t;const r=e.x+e.width/2-t/2;let n=0;n=e.y>0?e.y+(e.height-i)/2:0===e.y&&e.height>i?(e.height-i)/2:0,a.evalViewport(r,n,t,i,zs(ho,this).height)}let l=null;l=a.getTextureType()==Nr.D2.EXTERNAL_TEX?Ys(Bo,this,td).call(this):Ys(Bo,this,id).call(this,zs(ao,this)),l&&l.buffer&&a.setUniformBuffer(l.buffer)}function Xo(e,t,i,r,a,n,s){return function(e,t,i,r,a,n){let s=0,o=0,d=0,c=0;if(e){const e=a==Nr.mN||a==Nr.Ur?t.height/t.width:t.width/t.height,n=r.left||0,u=r.top||0;if(r.width/r.height>e){const t=r.height*e;s=u/i.height,o=(Math.round((r.width-t)/2)+n)/i.width,c=s+(r.height-1)/i.height,d=o+t/i.width}else{const t=r.width/e;s=(Math.round((r.height-t)/2)+u)/i.height,o=n/i.width,c=s+(t-1)/i.height,d=o+r.width/i.width}a==Nr.vL?(s=1-(s+(r.height-1)/i.height),o=r.left/i.width,c=1-r.top/i.height,d=o+r.width/i.width):a==Nr.mN?(o=1-(s+(r.height-1)/i.height),d=1-r.top/i.height,s=r.left/i.width,c=o+r.width/i.width):a==Nr.G7?(s=r.top/i.height,o=r.left/i.width,c=s+(r.height-1)/i.height,d=o+r.width/i.width):a==Nr.Ur&&(o=r.top/i.height,d=s+(r.height-1)/i.height,s=r.left/i.width,c=o+r.width/i.width)}else{const e=r.width/r.height;let t=r.width,n=r.height;if(r.width>i.width||r.height>i.height){const e=i.width/r.width,a=i.height/r.height,s=Math.min(e,a);t*=s,n*=s}let u=0,h=0;i.width/i.height>e?(h=Math.floor(i.height/n)*n,u=Math.floor(h*e/t)*t,u>i.width&&(u=Math.floor(i.width/t)*t,h=Math.floor(u/e/n)*n)):(u=Math.floor(i.width/t)*t,h=Math.floor(u/e/n)*n,h>i.height&&(h=Math.floor(i.height/n)*n,u=Math.floor(h*e/t)*t)),a==Nr.vL?(s=1-(s+(n-1)/i.height),o=r.left/i.width,c=1-r.top/i.height,d=o+t/i.width,r.height>r.width&&(o=Zr(o,2),d=Jr(d,2))):a==Nr.mN?(o=1-(s+(n-1)/i.height),d=1-r.top/i.height,s=r.left/i.width,c=o+t/i.width):a==Nr.G7?(s=r.top/i.height,o=r.left/i.width,c=s+(n-1)/i.height,d=o+t/i.width):a==Nr.Ur&&(o=r.top/i.height,d=s+(n-1)/i.height,s=r.left/i.width,c=o+t/i.width)}let u=[],h=[{x:d,y:c},{x:d,y:s},{x:o,y:s},{x:d,y:c},{x:o,y:c},{x:o,y:s}];for(let e=0;e<h.length;++e){let t=null;if(n){let i=-1*Math.abs(h[e].x);h[e].x=i,t={u:h[e].x+1,v:h[e].y}}else t={u:h[e].x,v:h[e].y};u.push(t)}let l=[];for(let e=0;e<u.length;++e){let t=u[e];l.push(t.u),l.push(t.v)}return l}(this.isUseFillMode({w:i.width,h:i.height,rotation:r}),{width:n,height:s},{width:e,height:t},i,r,a)}function Yo(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=e.width,s=e.height;a&&(n=a.width,s=a.height);let o,d,c,u,h=r==Nr.mN||r==Nr.Ur?i:t,l=r==Nr.mN||r==Nr.Ur?t:i,p=h/l*s;p>n?(o=0,c=1,d=(s-l/h*n)/2/s,u=1-d):(d=0,u=1,o=(n-p)/2/n,c=1-o),o=2*o-1,c=2*c-1,d=1-2*d,u=1-2*u;let f=[{x:c,y:d},{x:c,y:u},{x:o,y:u},{x:c,y:d},{x:o,y:d},{x:o,y:u}];zs(uo,this)&&zs(uo,this).updateVertexCoords(f)}function Qo(e,t,i,r,a){var n,s,o,d;if(this.isUseFillMode({w:i,h:r,rotation:a}))n=0,s=0,o=1,d=1;else{var c=a==Nr.mN||a==Nr.Ur?r:i,u=a==Nr.mN||a==Nr.Ur?i:r,h=c/u*t;h>e?(n=0,o=1,d=1-(s=(t-u/c*e)/2/t)):(s=0,d=1,o=1-(n=(e-h)/2/e))}const l={top:s=1-2*s,left:n=2*n-1,right:o=2*o-1,bottom:d=1-2*d};return Xs(Lo,this,l),l}function Jo(){zs(uo,this)||Ye("[WebGPURenderDisplay] renderer is not attached!")}function Zo(e){if(e<0)throw new Error("[hasZIndexTexLayer] ".concat(e," is an invalid parameter!"));return zs(Vo,this).has(e)}function $o(e){let t=null;return Ys(Bo,this,Zo).call(this,e)?t=zs(Vo,this).get(e):(t=new js(zs(Qs,this),e),zs(Vo,this).set(e,t)),t}function ed(e,t,i){zs(ho,this)&&(Xs(Ro,this,e),Xs(Do,this,e&&i===p?1:0),Xs(Po,this,t),e||Xs(To,this,i))}function td(){const e={rotation:zs(ao,this)};let t=null,i=zs(xo,this).get(Nr.x0.VS_BASE);if(i){let r=i.buffer,a=i.uniform;if(a)if("yuvMode"in a)r&&r.destroy(),i=null;else if("rotation"in a){if(a.rotation!=e.rotation){const i=Ys(Bo,this,nd).call(this,e);t=zs(uo,this).writeUniformBuffer("VideoFrameTexLayerUniformBuffer(idx=".concat(zs(Qs,this),")"),i,r)}}else r&&r.destroy(),i=null}if(!i){const i=Ys(Bo,this,nd).call(this,e);t=zs(uo,this).writeUniformBuffer("VideoFrameTexLayerUniformBuffer(idx=".concat(zs(Qs,this),")"),i)}return t?(i||(i={}),i.uniform=e,i.buffer=t,zs(xo,this).set(Nr.x0.VS_BASE,i),i):null}function id(e){if(-1==zs(Io,this))return null;const t={yuvMode:1,colorRange:zs(Io,this),rotation:e};let i=null,r=zs(xo,this).get(Nr.x0.VS_BASE);if(r){const e=r.uniform;if(i=r.buffer,e.yuvMode!=t.yuvMode||e.colorRange!=t.colorRange||e.rotation!=t.rotation){const e=Ys(Bo,this,sd).call(this,t);i=zs(uo,this).writeUniformBuffer("YuvTexLayerUniformBuffer(idx=".concat(zs(Qs,this),")"),e,i)}}else{r={};const e=Ys(Bo,this,sd).call(this,t);i=zs(uo,this).writeUniformBuffer("YuvTexLayerUniformBuffer(idx=".concat(zs(Qs,this),")"),e)}return i?(r.uniform=t,r.buffer=i,zs(xo,this).set(Nr.x0.VS_BASE,r),r):null}function rd(){if(!zs(Oo,this))return null;const e={cursorFlag:zs(Po,this),cursorInfo:zs(Oo,this)};let t=null,i=zs(xo,this).get(Nr.x0.CURSOR);if(i){const r=i.uniform;if(t=i.buffer,r.cursorFlag!=e.cursorFlag||r.cursorInfo!=e.cursorInfo){const i=Ys(Bo,this,od).call(this,e);t=zs(uo,this).writeUniformBuffer("CursorTexLayerUniformBuffer(idx=".concat(zs(Qs,this),")"),i,t)}}else{i={};const r=Ys(Bo,this,od).call(this,e);t=zs(uo,this).writeUniformBuffer("CursorTexLayerUniformBuffer(idx=".concat(zs(Qs,this),")"),r)}return t?(i.uniform=e,i.buffer=t,zs(xo,this).set(Nr.x0.CURSOR,i),i):null}function ad(e,t){return Math.ceil(e/t)*t}function nd(e){const t=Ys(Bo,this,ad).call(this,1*Float32Array.BYTES_PER_ELEMENT,16),i=new Float32Array(t/Float32Array.BYTES_PER_ELEMENT);return i[0]=e.rotation,i}function sd(e){const t=Ys(Bo,this,ad).call(this,3*Float32Array.BYTES_PER_ELEMENT,16),i=new Float32Array(t/Float32Array.BYTES_PER_ELEMENT);return i[0]=e.yuvMode,i[1]=e.colorRange,i[2]=e.rotation,i}function od(e){const t=Ys(Bo,this,ad).call(this,5*Float32Array.BYTES_PER_ELEMENT,16),i=new Float32Array(t/Float32Array.BYTES_PER_ELEMENT);return i[0]=e.cursorFlag,i[1]=e.cursorInfo.x,i[2]=e.cursorInfo.y,i[3]=e.cursorInfo.w,i[4]=e.cursorInfo.h,i}function dd(e){if(!e||0==e.length)return null;const t=Ys(Bo,this,ad).call(this,4*Float32Array.BYTES_PER_ELEMENT,16),i=new Float32Array(t/Float32Array.BYTES_PER_ELEMENT);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function cd(e,t,i,r){let a=t*i,n=e.subarray(0,a),s=0,o=0;1==r?(o=t/2*i/2,s=o):2==r&&(o=t*i/2,s=0);let d=e.subarray(a,a+o);return{yPlane:{buffer:n,width:t,height:i},crPlane:{buffer:0!=s?e.subarray(a+o,a+o+s):null,width:t/2,height:i/2},cbPlane:{buffer:d,width:t/2,height:i/2}}}function ud(e,t,i){let r="",a=0,n=0,s=0;1==i?(a=e/2*t/2,n=a,r="i420",s=Uint8Array.BYTES_PER_ELEMENT):2==i&&(a=e*t/2,n=0,r="nv12",s=Uint16Array.BYTES_PER_ELEMENT);const o=Ys(Bo,this,ad).call(this,Uint8Array.BYTES_PER_ELEMENT*e,256),d=Ys(Bo,this,ad).call(this,s*e/2,256);let c=o*t+d*t/2;return n>0&&(c+=d*t/2),{colorFormat:r,size:c,yPlane:{width:o,height:t},uvPlane:{width:d,height:t/2}}}function hd(e,t){const i=Ys(Bo,this,ad).call(this,Uint32Array.BYTES_PER_ELEMENT*e,256);return{colorFormat:"rgba",width:i,height:t,size:i*t}}function ld(e,t,i){return t?t.buffer?i.size>t.buffer.size?(zs(Eo,this).recycleTextureBufferGroup(e),t.buffer=zs(Eo,this).requestTextureBuffer(i),t.bufferConfig=i):"mapped"==t.buffer.mapState?t.bufferArray&&t.bufferArray.byteLength<i.size&&(zs(Eo,this).recycleTextureBufferGroup(e),t.buffer=zs(Eo,this).requestTextureBuffer(i),t.bufferConfig=i):(zs(Eo,this).recycleTextureBufferGroup(e),t.buffer=zs(Eo,this).requestTextureBuffer(i),t.bufferConfig=i):(t.buffer=zs(Eo,this).requestTextureBuffer(i),t.bufferConfig=i):((t={}).buffer=zs(Eo,this).requestTextureBuffer(i),t.bufferConfig=i),t}function pd(){const e=[];for(let t=0;t<Nr.bZ.length;++t){let i=Nr.bZ[t];e.push(i.u),e.push(i.v)}return e}function fd(e){return e&&0!=e.width&&0!=e.height}function gd(){if(zs(Eo,this))for(const[e,t]of zs(Vo,this))t&&(zs(Eo,this).recycleTextureBufferGroup(t,!1),zs(Eo,this).destroyTextureGroup(t,!0));else Ye("clearTexLayerResources() GPUResManager is not attached!")}const md=class{constructor(e,t){var i;qs(this,i=Bo),i.add(this),Ks(this,Qs,0),Ks(this,Js,0),Ks(this,Zs,{}),Ks(this,$s,0),Ks(this,eo,0),Ks(this,to,0),Ks(this,io,0),Ks(this,ro,-1),Ks(this,ao,Nr.vL),Ks(this,no,h),Ks(this,so,0),Ks(this,oo,0),Ks(this,co,!1),Ks(this,uo,null),Ks(this,ho,null),Ks(this,lo,!1),Ks(this,po,0),Ks(this,fo,!1),Ks(this,go,0),Ks(this,mo,0),Ks(this,vo,0),Ks(this,Ao,0),Ks(this,So,Nr.nD.IDLE),Ks(this,_o,0),Ks(this,yo,0),Ks(this,Co,0),Ks(this,bo,!1),Ks(this,wo,0),Ks(this,Eo,null),Ks(this,Ro,0),Ks(this,To,h),Ks(this,Io,-1),Ks(this,Mo,0),Ks(this,Do,0),Ks(this,Po,0),Ks(this,ko,0),Ks(this,Oo,null),Ks(this,xo,new Map),Ks(this,Vo,new Map),Ks(this,No,{top:0,left:0,bottom:0,right:0}),Ks(this,Lo,null),Ks(this,Wo,null),(0,o.A)(this,"reuse",!1),Xs(Qs,this,e),Xs(Eo,this,t),Xs(Js,this,e||0),zs(Zs,this).top=0,zs(Zs,this).left=0,zs(Zs,this).width=0,zs(Zs,this).height=0,Xs($s,this,0),Xs(eo,this,0),Xs(to,this,0),Xs(io,this,0),Xs(no,this,h),Xs(so,this,0),Xs(oo,this,0),this.markRenderingStateIdle()}addRenderer(e){Xs(uo,this,e)}removeRenderer(){Xs(uo,this,null)}setGPUResMgr(e){Xs(Eo,this,e)}removeGPUResMgr(){Xs(Eo,this,null)}attachCanvas(e,t){Xs(ho,this,e),Xs(Wo,this,t)}getAttachedCanvas(){return zs(ho,this)}getCanvasId(){return zs(Wo,this)}detachCanvas(){Xs(ho,this,null),Xs(Wo,this,null)}bindSsrc(e){Xs(wo,this,e)}unbindSsrc(){Xs(wo,this,0)}drawSelfVideo(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!Ys(Bo,this,fd).call(this,e))return;Ys(Bo,this,Jo).call(this),Ys(Bo,this,ed).call(this,1,zs(bo,this),zs(no,this));let r=null;r=t?Ys(Bo,this,Qo).call(this,e.width,e.height,e.width,e.height,Nr.vL):Ys(Bo,this,Qo).call(this,e.width,e.height,zs(Zs,this).width,zs(Zs,this).height,zs(ao,this)),Ys(Bo,this,qo).call(this,e,r,i)}drawRemoteVideo(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!zs(ho,this))return;if(!Ys(Bo,this,fd).call(this,e))return;Ys(Bo,this,Jo).call(this);const i=this.isRgbaMode(zs(no,this))?1:0;Ys(Bo,this,ed).call(this,i,zs(bo,this),zs(no,this));const r=Ys(Bo,this,Qo).call(this,e.width,e.height,zs(Zs,this).width,zs(Zs,this).height,zs(ao,this));Ys(Bo,this,zo).call(this,e,r,t)}drawCursor(e,t,i,r,a){if(!zs(_o,this)||e&&(r<0||a<0))return;const n=Nr.x0.CURSOR,s=Ys(Bo,this,$o).call(this,n),o=Ys(Bo,this,$o).call(this,Nr.x0.VS_BASE);if(s.setUVCoords(o.getUVCoords()),s.evalViewport(t,i,r,a,zs(ho,this).height),e&&zs(bo,this)){const e=t/zs(Zs,this).width,n=i/zs(Zs,this).height,s=r/zs(Zs,this).width,o=a/zs(Zs,this).height;Xs(Oo,this,{x:e,y:n,w:s,h:o})}else Xs(Oo,this,{x:0,y:0,w:0,h:0});const d=Ys(Bo,this,rd).call(this);d&&d.buffer&&s.setUniformBuffer(d.buffer)}setMultiView(e){Xs(lo,this,e)}setFillMode(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Xs(so,this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:0),Xs(oo,this,e)}getFillMode(){return zs(so,this)}setColorRange(e){Xs(Io,this,e)}getFillModeForResolution(){return zs(oo,this)}getTextureIndex(){return zs(Js,this)}isUseFillMode(e){let{w:t,h:i,rotation:r}=e;if(!zs(so,this))return!1;if(!zs(oo,this))return!0;if(!t||!i)return!1;const a=r===Nr.mN||r===Nr.mN?i/t:t/i;return(Array.isArray(zs(oo,this))?zs(oo,this):[zs(oo,this)]).some((e=>Math.abs(a-e)<.01))}setVideoMode(e){Xs(no,this,e)}getVideoMode(){return zs(no,this)}setWatermarkFlag(e){Xs(po,this,e),e||(this.setWatermarkRepeated(!1),this.setWatermarkOpacity(),this.setWatermarkPosition(16))}setWatermarkRepeated(e){Xs(fo,this,e)}isWatermarkRepeated(){return!!zs(fo,this)}setWatermarkOpacity(e){Xs(go,this,e||.15)}getWatermarkOpacity(){return zs(go,this)}setWatermarkPosition(e){Xs(mo,this,e||16)}getWatermarkPosition(){return zs(mo,this)}isSetWatermark(){return zs(po,this)}isRgbaMode(e){return-1!==[l,p].indexOf(e)}getTextureWidth(){return zs($s,this)}getTextureHeight(){return zs(eo,this)}getRotation(){return zs(ao,this)}getCroppingParams(){return zs(Zs,this)}getViewPosition(){let e=[0,0,1,1];if(!zs(Lo,this))return e;const{top:t,left:i,bottom:r,right:a}=zs(Lo,this);return e[0]=(1-t)/2,e[1]=(1+i)/2,e[2]=(1-r)/2,e[3]=(1+a)/2,e}recoverTextures(){}updateWatermark(e,t,i){const r=Nr.x0.WATERMARK,a=Ys(Bo,this,$o).call(this,r);if(!zs(ho,this)||!zs(uo,this))return Ys(Bo,this,gd).call(this),void this.markRenderingStatePending();if(e<=0||t<=0||!i||i.length!=e*t*4)return zs(Eo,this).recycleTextureBufferGroup(a),void this.markRenderingStatePending();if($r(zs(Eo,this),e,t))return zs(Eo,this).recycleTextureBufferGroup(a),void this.markRenderingStatePending();if(Xs(vo,this,e),Xs(Ao,this,t),Xs(po,this,1),Xs(Mo,this,1),!Ys(Bo,this,Zo).call(this,Nr.x0.VS_BASE)){console.log("[updateWatermark] base layer is not ready, set data to the texture layer for creating texture later."),zs(Eo,this).recycleTextureBufferGroup(a),this.markRenderingStatePending();const r={index:zs(Qs,this),width:e,height:t,data:i};return void a.setRawData(r)}const n=Ys(Bo,this,$o).call(this,Nr.x0.VS_BASE).getViewport();if(n)try{const r=Ys(Bo,this,hd).call(this,e,t);r.label="WatermarkTexBuffer(".concat(a.getIndex(),")-").concat(r.size);let s=a.getTextureBufferGroup();if(s=Ys(Bo,this,ld).call(this,a,s,r),!s||!s.buffer)return console.warn("[updateWatermark()] texLayer(".concat(a.getIndex(),") cannot apply a GPU buffer!")),void this.markRenderingStatePending();Ys(Bo,this,jo).call(this,zs(Qs,this),e,t,i,s),n&&a.setViewport(n);let o=a.getUVCoords(),d=Ys(Bo,this,pd).call(this);o||(o=new Float32Array(12)),o.set(d,0),a.setUVCoords(o),a.setRawData(null),this.markRenderingStateReady()}catch(e){console.error("[WebGPURenderDisplay] updateWatermark() error:".concat(e.message)),Je("WGPU WebGPURenderDisplay_updateWatermark() error:".concat(e.message)),zs(Eo,this).recycleTextureBufferGroup(a),this.markRenderingStatePending()}else{console.log("[updateWatermark] base layer's viewport is not ready, set data to the texture layer for creating texture later."),zs(Eo,this).recycleTextureBufferGroup(a),this.markRenderingStatePending();const r={index:zs(Qs,this),width:e,height:t,data:i};a.setRawData(r)}}updateCursor(e,t,i){const r=Nr.x0.CURSOR,a=Ys(Bo,this,$o).call(this,r);if(!zs(ho,this)||!zs(uo,this))return Ys(Bo,this,gd).call(this),void this.markRenderingStatePending();if(e<=0||t<=0||!i||i.length!=e*t*4)return zs(Eo,this).recycleTextureBufferGroup(a),void this.markRenderingStatePending();Xs(yo,this,e),Xs(Co,this,t),Xs(bo,this,1);try{const r=Ys(Bo,this,hd).call(this,e,t);r.label="CursorTexBuffer(".concat(a.getIndex(),")-").concat(r.size);let n=a.getTextureBufferGroup();if(n=Ys(Bo,this,ld).call(this,a,n,r),!n||!n.buffer)return void console.warn("[updateCursor()] texLayer(".concat(a.getIndex(),") cannot apply a GPU buffer!"));if("mapped"!=n.buffer.mapState)return void console.error("updateCursor() why buffer state is not mapped!");Ys(Bo,this,Ho).call(this,zs(Qs,this),e,t,i,n),this.markRenderingStateReady()}catch(e){console.error("[WebGPURenderDisplay] updateCursor() error:".concat(e.message)),Je("WGPU WebGPURenderDisplay_updateCursor() error:".concat(e.message)),zs(Eo,this).recycleTextureBufferGroup(a),this.markRenderingStatePending()}}updateSelfVideoTextures(e,t,i,r){let a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;Ys(Bo,this,Jo).call(this);const s=Ys(Bo,this,$o).call(this,Nr.x0.VS_BASE);if(!zs(ho,this)||!zs(uo,this))return i&&i instanceof VideoFrame&&i.close(),Ys(Bo,this,gd).call(this),void this.markRenderingStatePending();if(e<=0||t<=0||!i||i.length%4!=0)return i&&i instanceof VideoFrame&&i.close(),void this.markRenderingStatePending();if(1!=e||1!=t){if(Xs($s,this,e),Xs(eo,this,t),Xs(ao,this,n),Object.assign(zs(Zs,this),r),!a)return i&&i instanceof VideoFrame&&i.close(),void this.markRenderingStatePending();try{Ys(Bo,this,Uo).call(this,e,t,i),this.markRenderingStateReady()}catch(e){console.log("[WebGPURenderDisplay] updateSelfVideoTextures() error:".concat(e.message)),Je("WGPU WebGPURenderDisplay_updateSelfVideoTextures() error:".concat(e.message)),this.markRenderingStatePending(),i instanceof VideoFrame&&i.close(),Ys(Bo,this,$o).call(this,Nr.x0.VS_BASE).setPendingVideoFrame(null)}}else{s.setPendingVideoFrame(null),Ys(Bo,this,gd).call(this),i&&i instanceof VideoFrame&&i.close();const e=Ys(Bo,this,dd).call(this,i);if(e)if(zs(uo,this)){let t=s.getClearColorUniformBuffer();t=zs(uo,this).writeUniformBuffer("ClearColorUniformBuffer",e,t),s.setClearColorUniformBuffer(t),s.setTextureType(Nr.D2.CLEAR_COLOR)}else console.warn("updateSelfVideoTextures() renderer is not attached!");else Ye("updateSelfVideoTextures() cannot create the uniform buffer array.");this.markRenderingStateReady()}}updateRemoteVideoTexturesImageBitmap(e,t,i,r,a){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const s=Ys(Bo,this,$o).call(this,Nr.x0.VS_BASE);if(!zs(uo,this)||!zs(ho,this))return i&&i instanceof VideoFrame&&i.close(),Ys(Bo,this,gd).call(this),void this.markRenderingStatePending();if(e<=0||t<=0||!i)return i&&i instanceof VideoFrame&&i.close(),void this.markRenderingStatePending();if(Xs($s,this,e),Xs(eo,this,t),Number.isNaN(a)||Xs(ao,this,a),Object.assign(zs(Zs,this),r),!n)return i&&i instanceof VideoFrame&&i.close(),void this.markRenderingStatePending();try{Ys(Bo,this,Uo).call(this,e,t,i),this.markRenderingStateReady()}catch(e){console.log("[WebGPURenderDisplay] updateRemoteVideoTexturesImageBitmap() error:".concat(e.message)),Je("WGPU WebGPURenderDisplay_updateRemoteVideoTexturesImageBitmap() error:".concat(e.message)),this.markRenderingStatePending(),i instanceof VideoFrame&&i.close(),s.setPendingVideoFrame(null)}}updateRemoteVideoTextures(e,t,i,r,a){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6?arguments[6]:void 0;const o=Nr.x0.VS_BASE,d=Ys(Bo,this,$o).call(this,o);if(!zs(ho,this)||!zs(uo,this))return Ys(Bo,this,gd).call(this),void this.markRenderingStatePending();if(!Ys(Bo,this,fd).call(this,s))return zs(Eo,this).recycleTextureBufferGroup(d),void this.markRenderingStatePending();Ys(Bo,this,Jo).call(this);const c=this.isRgbaMode(zs(no,this));if(e<=0||t<=0||!r||!r.length||r.length!=e*t*3/2&&!c||i&&(i.top<0||i.left<0||i.left+i.width>e||i.top+i.height>t))return zs(Eo,this).recycleTextureBufferGroup(d),void this.markRenderingStatePending();if(c)try{Ys(Bo,this,Uo).call(this,e,t,r,!0),Xs(Io,this,n?0:1),Xs(ao,this,a),Object.assign(zs(Zs,this),i),Xs($s,this,e),Xs(eo,this,t),Xs(to,this,zs(ho,this).width),Xs(io,this,zs(ho,this).height)}catch(e){console.error("[WebGPURenderDisplay] updateRemoteVideoTextures() error:".concat(e.message)),Je("WGPU WebGPURenderDisplay_updateRemoteVideoTextures() error:".concat(e.message)),d.setPendingVideoFrame(null),this.markRenderingStatePending()}finally{zs(Eo,this).recycleTextureBufferGroup(d)}else try{const s=Ys(Bo,this,ud).call(this,e,t,zs(no,this));s.label="YuvVideoTexBuffer(".concat(d.getIndex(),")-").concat(s.size),d.setColorFormat(s.colorFormat);let o=d.getTextureBufferGroup();if(o=Ys(Bo,this,ld).call(this,d,o,s),!o||!o.buffer)return console.warn("[updateRemoteVideoTextures()] texLayer(".concat(d.getIndex(),") cannot apply a GPUBuffer!")),void this.markRenderingStatePending();Xs(Io,this,n?0:1),Xs(ao,this,a),Object.assign(zs(Zs,this),i),Xs($s,this,e),Xs(eo,this,t),Xs(to,this,zs(ho,this).width),Xs(io,this,zs(ho,this).height),Ys(Bo,this,Fo).call(this,zs(Qs,this),e,t,r,o,zs(no,this)),this.markRenderingStateReady()}catch(e){console.error("[WebGPURenderDisplay] updateRemoteVideoTextures() error:".concat(e.message," cs:").concat(e.stack)),Je("WGPU WebGPURenderDisplay_updateRemoteVideoTextures() error:".concat(e.message)),zs(Eo,this).recycleTextureBufferGroup(d),this.markRenderingStatePending()}}drawNextOutputPictureFrame(e,t,i,r,a){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const d=Nr.x0.VS_BASE,c=Ys(Bo,this,$o).call(this,d);if(!zs(ho,this)||!zs(uo,this))return Ys(Bo,this,gd).call(this),void this.markRenderingStatePending();if($r(zs(Eo,this),e,t))return zs(Eo,this).recycleTextureBufferGroup(c),void this.markRenderingStatePending();a=a||Nr.vL;let u=(i=i||{top:0,left:0,width:e,height:t}).width!=zs(Zs,this).width||i.height!=zs(Zs,this).height,h=i.top!=zs(Zs,this).top||i.left!=zs(Zs,this).left,l=zs(ho,this).width!=zs(to,this)||zs(ho,this).height!=zs(io,this),p=e!=zs($s,this)||t!=zs(eo,this),f=a!=zs(ro,this);if((u||l||f)&&Ys(Bo,this,Yo).call(this,zs(ho,this),i.width,i.height,a,s),s){const e=function(e,t){if(!e||null==t)throw new Error("evalCroppingRect() invalid parameters!");return t===Nr.mN||t===Nr.Ur?{top:e.top,left:e.left,width:e.height,height:e.width}:e}(i,a),t=function(e,t){let i=0,r=0,a=0,n=0;const s=t.width/t.height;return e.width/e.height>s?(r=e.height,i=r*s,a=(e.width-i)/2,n=0):(i=e.width,r=i/s,a=0,n=(e.height-r)/2),i<=e.canvas.width&&(a=(e.canvas.width-i)/2),r<=e.canvas.height&&(n=(e.canvas.height-r)/2),{x:a,y:n,width:i,height:r}}(s,e);c.evalViewport(t.x,t.y,t.width,t.height,zs(ho,this).height)}else c.evalViewport(0,0,zs(ho,this).width,zs(ho,this).height,zs(ho,this).height);if(u||h||p||f||!c.getUVCoords()){let r=function(e,t,i,r){if(!e||!t||!i)return null;const a=t.width/t.height;let n=t.width,s=t.height;if(t.width>e.width||t.height>e.height){const i=e.width/t.width,r=e.height/t.height,a=Math.min(i,r);n*=a,s*=a}let o=0,d=0;e.width/e.height>a?(d=Math.floor(e.height/s)*s,o=Math.floor(d*a/n)*n,o>e.width&&(o=Math.floor(e.width/n)*n,d=Math.floor(o/a/s)*s)):(o=Math.floor(e.width/n)*n,d=Math.floor(o/a/s)*s,d>e.height&&(d=Math.floor(e.height/s)*s,o=Math.floor(d*a/n)*n));let c=0,u=0,h=0,l=0;r==Nr.vL?(c=1-(c+(s-1)/e.height),u=t.left/e.width,l=1-t.top/e.height,h=u+n/e.width):r==Nr.mN?(u=1-(c+(s-1)/e.height),h=1-t.top/e.height,c=t.left/e.width,l=u+n/e.width):r==Nr.G7?(c=t.top/e.height,u=t.left/e.width,l=c+(s-1)/e.height,h=u+n/e.width):r==Nr.Ur&&(u=t.top/e.height,h=c+(s-1)/e.height,c=t.left/e.width,l=u+n/e.width);let p=[],f=[{x:h,y:l},{x:h,y:c},{x:u,y:c},{x:h,y:l},{x:u,y:l},{x:u,y:c}];for(let e=0;e<f.length;++e){let t={u:f[e].x,v:f[e].y};p.push(t)}let g=[];for(let e=0;e<p.length;++e){let t=p[e];g.push(t.u),g.push(t.v)}return g}({width:e,height:t},i,zs(ho,this),a),n=c.getUVCoords();n||(n=new Float32Array(12)),n.set(r),c.setUVCoords(n)}let g=n?0:1;g!=zs(Io,this)&&Xs(Io,this,g),Xs(Ro,this,0),Xs(To,this,1),Object.assign(zs(Zs,this),i),Xs($s,this,e),Xs(eo,this,t),Xs(ro,this,a),Xs(to,this,zs(ho,this).width),Xs(io,this,zs(ho,this).height),c.setColorFormat("i420");try{const i=Ys(Bo,this,ud).call(this,e,t,1);if(i.label="YuvShareTexBuffer(".concat(c.getIndex(),")-").concat(i.size),o){let a=c.getTextureBufferGroup();if(a=Ys(Bo,this,ld).call(this,c,a,i),!a||!a.buffer)return console.warn("[drawNextOutputPictureFrame()] texLayer(".concat(c.getIndex(),") cannot apply a GPU buffer!")),void this.markRenderingStatePending();Ys(Bo,this,Fo).call(this,zs(Qs,this),e,t,r,a,1);const n=Ys(Bo,this,id).call(this,zs(ro,this));n&&n.buffer&&c.setUniformBuffer(n.buffer)}zs(bo,this)?Xs(Po,this,1):Xs(Po,this,0),Xs(_o,this,1),this.markRenderingStateReady()}catch(e){console.error("[WebGPURenderDisplay] drawNextOutputPictureFrame() error:".concat(e.message)),Je("WGPU WebGPURenderDisplay_drawNextOutputPictureFrame() error:".concat(e.message)),zs(Eo,this).recycleTextureBufferGroup(c),this.markRenderingStatePending()}}clearCanvas(e){zs(uo,this)&&zs(uo,this).clearAttachedCanvas()}updateSelfMaskImage(e,t,i){const r=Nr.x0.MASK,a=Ys(Bo,this,$o).call(this,r);if(!zs(ho,this))return zs(Eo,this).recycleTextureBufferGroup(a),void this.markRenderingStatePending();if(e<=0||t<=0||!i||i.length!=e*t*4)return zs(Eo,this).recycleTextureBufferGroup(a),void this.markRenderingStatePending();if(!Ys(Bo,this,Zo).call(this,Nr.x0.VS_BASE))return console.log("[updateSelfMaskImage] base layer is not ready."),zs(Eo,this).recycleTextureBufferGroup(a),void this.markRenderingStatePending();try{const r=Ys(Bo,this,hd).call(this,e,t);let n=a.getTextureBufferGroup();if(n=Ys(Bo,this,ld).call(this,a,n,r),!n||!n.buffer)return console.warn("[updateSelfMaskImage()] texLayer(".concat(a.getIndex(),") cannot apply a GPU buffer!")),void this.markRenderingStatePending();if(n.buffer.label="SelfMaskImageTexBuffer(".concat(a.getIndex(),")-").concat(r.size),a.setTextureLayerType(Nr.Zq.BLEND_LAYER),a.setTextureType(Nr.D2.GPU_TEX_RGBA),a.isLocked()){const i=a.getWidth(),r=a.getHeight();i==e&&r==t||(a.setWidth(e),a.setHeight(t),a.setIsNew(!0))}else a.setWidth(e),a.setHeight(t),a.setIsNew(!0),a.lock();const s=zs(uo,this).writeToRgbaTextureBuffer(zs(Qs,this),e,t,i,n);a.setTextureBufferGroup(s);const o=Ys(Bo,this,$o).call(this,Nr.x0.VS_BASE),d=o.getViewport();d&&a.setViewport(d),a.setUVCoords(o.getUVCoords()),this.isSetWatermark()&&zs(vo,this)&&zs(Ao,this),this.markRenderingStateReady()}catch(e){console.error("[WebGPURenderDisplay] updateSelfMaskImage() error:".concat(e.message)),Je("WGPU WebGPURenderDisplay_updateSelfMaskImage() error:".concat(e.message)),zs(Eo,this).recycleTextureBufferGroup(a),this.markRenderingStatePending()}}readPixelsSyncRequest(e,t,i,r){}isAvaiable(){return!0}markRenderingStateReady(){Xs(So,this,Nr.nD.READY)}markRenderingStateRendering(){Xs(So,this,Nr.nD.RENDERING)}markRenderingStatePending(){Xs(So,this,Nr.nD.PENDING)}markRenderingStateIdle(){Xs(So,this,Nr.nD.IDLE)}isRenderingStateReady(){return zs(So,this)===Nr.nD.READY}isInTargetRenderingState(e){return zs(So,this)===e}getWatermarkWidth(){return zs(vo,this)}getWatermarkHeight(){return zs(Ao,this)}getIndex(){return zs(Qs,this)}getRenderingState(){return zs(So,this)}recycle(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const[t,i]of zs(Vo,this))i&&(zs(Eo,this).recycleTextureBufferGroup(i,e),i.recycle(zs(Eo,this)));Xs(No,this,{top:0,left:0,bottom:0,right:0}),this.markRenderingStateIdle(),zs(Vo,this).clear(),zs(xo,this).clear(),this.unbindSsrc()}cleanup(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.recycle(e),this.removeRenderer(),this.detachCanvas(),this.removeGPUResMgr()}clear(){console.log("WebGPURenderDisplay.clear"),this.clearCanvas(),Xs(_o,this,0),Xs(bo,this,0),this.recycle()}clearDisplay(){console.log("WebGPURenderDisplay.clearDisplay"),this.clearCanvas()}getTextureLayersMap(){return zs(Vo,this)}getTextureLayerByZIndex(e){return Ys(Bo,this,$o).call(this,e)}getUsedBuffersCount(){let e=0;for(const[t,i]of zs(Vo,this))i&&i.getTextureBufferGroup()&&i.getTextureBufferGroup().buffer&&e++;return e}consumePendingGPUEvents(){if(zs(po,this)){const e=Ys(Bo,this,$o).call(this,Nr.x0.WATERMARK).getRawData();e&&this.updateWatermark(zs(vo,this),zs(Ao,this),e.data)}}resizeCanvasTo(e,t){zs(ho,this)&&(zs(ho,this).width=e,zs(ho,this).height=t)}};function vd(e,t,i){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,i)}function Ad(e,t){return e.get(_d(e,t))}function Sd(e,t,i){return e.set(_d(e,t),i),i}function _d(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}var yd=new WeakMap,Cd=new WeakMap,bd=new WeakMap,wd=new WeakMap,Ed=new WeakMap;const Rd=class{constructor(e,t,i){vd(this,yd,0),vd(this,Cd,null),vd(this,bd,null),vd(this,wd,Nr.gz.AVAILABLE),vd(this,Ed,null),Sd(yd,this,e),Sd(wd,this,t),Sd(Ed,this,i),Sd(Cd,this,[]),Sd(bd,this,[])}initPool(e){if(e>Ad(yd,this))throw new Error("initSize=".concat(e," is larger than maxSize=").concat(Ad(yd,this),", invalid!"));if(e<0)throw new Error("initSize=".concat(e," is smaller than 0, invalid!"));for(let t=0;t<e;t++){const e=new md(t,Ad(Ed,this));Ad(Cd,this).push(e)}}expandPool(e){if(Ad(Cd,this).length>=Ad(yd,this))return;let t=0;if(Ad(Cd,this).length+e>=Ad(yd,this)&&(t=Ad(yd,this)-Ad(Cd,this).length),t>0){const e=Ad(Cd,this).length;for(let i=0;i<t;i++){const t=new md(i+e,Ad(Ed,this));Ad(Cd,this).push(t)}}}pop(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.isPoolEmpty()&&this.expandPool(4);const e=Ad(Cd,this).pop();return e&&(e.markRenderingStatePending(),Ad(bd,this).push(e)),e}recycle(e){if(Ad(Cd,this).length<Ad(yd,this)){e.recycle(),Ad(Cd,this).push(e);const t=Ad(bd,this).indexOf(e);-1!=t&&Ad(bd,this).splice(t,1)}}clear(){if(Ad(Cd,this)){for(const e of Ad(Cd,this))e&&e.clear();Ad(Cd,this).length=0}}cleanup(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Ad(Cd,this).forEach((t=>{t.cleanup(e)})),Ad(bd,this).forEach((t=>{t.cleanup(e)})),Sd(Cd,this,[]),Sd(bd,this,[])}isPoolEmpty(){return 0==Ad(Cd,this).length}getInUseRenderDisplays(){return Ad(bd,this)}getAllRenderDisplays(){return Ad(Cd,this)}isServeForVideoRendering(){return Ad(wd,this)===Nr.gz.VIDEO}isServeForShareRendering(){return Ad(wd,this)===Nr.gz.SHARE}isServingForNow(e){return Ad(wd,this)===e}};function Td(e,t,i){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,i)}function Id(e,t){return e.get(Dd(e,t))}function Md(e,t,i){return e.set(Dd(e,t),i),i}function Dd(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}var Pd=new WeakMap,kd=new WeakMap,Od=new WeakMap,xd=new WeakMap,Vd=new WeakMap;class Nd{getVideoRenderDisplay(e,t,i,r){throw new Error("getVideoRenderDisplay() should be implemented by subclass.")}getSharingRenderDisplay(e,t,i){throw new Error("getSharingRenderDisplay() should be implemented by subclass.")}createVideoRenderDisplay(e,t,i){throw new Error("createVideoRenderDisplay() should be implemented by subclass.")}}var Ld=new WeakMap,Wd=new WeakMap;class Bd extends Nd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super(),Td(this,Ld,new Map),Td(this,Wd,!1),Md(Wd,this,e)}setCanvasAlphaChannelEnability(e){Md(Wd,this,e)}createVideoRenderDisplay(e,t,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=null,n=null,s=null,o=!1;return r&&(a=r.forceNoGL,n=r.contextOptions,s=r.webGLResources,o=r.initMask),new sa(e,t,i,a,n,s,o,Id(Wd,this))}getVideoRenderDisplay(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=Id(Ld,this).get(e);if(!n){let r=[];n=[r,[]],Id(Ld,this).set(e,n);let s=new sa(e,t,0,void 0,void 0,void 0,void 0,Id(Wd,this));s.setMultiView(!0),a&&a.set(e,s);let o=1;for(;o<=i;o++){const i=new sa(e,t,o,void 0,void 0,{program:s.shaderProgram,contextgl:s.contextGL,vBuffer:s.vertexPosBuffer,tBuffer:s.texturePosBuffer,waterMarkTextureRef:s.waterMarkTextureRef,repeatedWaterMarkTextureRef:s.repeatedWaterMarkTextureRef},void 0,Id(Wd,this));i.setMultiView(!0),r.push(i)}}let s,o=Id(Ld,this).get(e),d=o[0],c=o[1];if(o&&d[0]&&(s=d.pop(),c.push(s)),!s){const e=o?"".concat(o.length):"undefined",t=d?"".concat(d.length):"undefined";r("No Display obtained from VideoRender.Get_Display. canvasRenderArray:".concat(e," unusedRenderArray:").concat(t))}return s}getSharingRenderDisplay(e,t,i){return new sa(e,t,0,void 0,i.contextOptions,void 0,void 0,Id(Wd,this))}recycleRenderDisplay(e,t,i){t.setWatermarkFlag(0),t.setVideoMode(h),t.clear(i);let r=Id(Ld,this).get(e);if(r){let e=r[0],i=r[1];i&&i.some((function(e,r){if(e===t)return i.splice(r,1),!0})),e.push(t)}}onRestoredFromContextLost(e,t,i,r,a){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=Id(Ld,this).get(i);(!s||s.length<2)&&a("canvasRenderArray:".concat(s,", length:").concat(null==s?void 0:s.length));let o=n.get(t);if(o){o.reinit();for(let e=0;e<(null==s?void 0:s.length);e++)s[e].forEach((e=>{null==e||e.reinit({program:o.shaderProgram,contextgl:o.contextGL,vBuffer:o.vertexPosBuffer,tBuffer:o.texturePosBuffer,waterMarkTextureRef:o.waterMarkTextureRef,repeatedWaterMarkTextureRef:o.repeatedWaterMarkTextureRef})}));return i!==t&&(Id(Ld,this).delete(i),Id(Ld,this).set(t,s),n&&(n.delete(i),n.set(t,o))),null}}getRenderDisplayMap(){return Id(Ld,this)}cleanup(e,t){var i;null==t||null===(i=t.cleanup)||void 0===i||i.call(t,null);for(const[e,t]of Id(Ld,this)){const e=t[0],i=t[1];for(const t of e)t.cleanup();for(const e of i)e.cleanup()}Md(Ld,this,new Map)}cleanupByCanvas(e){if(Id(Ld,this).get(e)){let t=Id(Ld,this).get(e);if(t){let i=t[0],r=t[1];r.forEach((function(e){var t;null==e||null===(t=e.cleanup)||void 0===t||t.call(e)})),i.forEach((function(e){var t;null==e||null===(t=e.cleanup)||void 0===t||t.call(e)})),i=[],r=[],Id(Ld,this).delete(e)}}}}var Ud=new WeakMap,Fd=new WeakMap;class Gd extends Nd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super(),Td(this,Ud,new Map),Td(this,Fd,!1),Md(Fd,this,e)}setCanvasAlphaChannelEnability(e){Md(Fd,this,e)}createVideoRenderDisplay(e,t,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=null,n=null,s=null,o=!1;return r&&(a=r.forceNoGL,n=r.contextOptions,s=r.webGLResources,o=r.initMask),new pa(e,t,i,a,n,s,o,Id(Fd,this))}getVideoRenderDisplay(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=Id(Ud,this).get(e);if(!n){let r=[];n=[r,[]],Id(Ud,this).set(e,n);let s=new pa(e,t,0,void 0,void 0,void 0,void 0,Id(Fd,this));s.setMultiView(!0),a&&a.set(e,s);let o=1;for(;o<=i;o++){const i=new pa(e,t,o,void 0,void 0,{program:s.shaderProgram,contextgl:s.contextGL,vBuffer:s.vertexPosBuffer,tBuffer:s.texturePosBuffer,waterMarkTextureRef:s.waterMarkTextureRef,repeatedWaterMarkTextureRef:s.repeatedWaterMarkTextureRef},void 0,void 0,Id(Fd,this));i.setMultiView(!0),r.push(i)}}let s,o=Id(Ud,this).get(e),d=o[0],c=o[1];if(o&&d[0]&&(s=d.pop(),c.push(s)),!s){const e=o?"".concat(o.length):"undefined",t=d?"".concat(d.length):"undefined";r("No Display obtained from VideoRender.Get_Display. canvasRenderArray:".concat(e," unusedRenderArray:").concat(t))}return s}getSharingRenderDisplay(e,t,i){return new pa(e,t,0,void 0,i.contextOptions,void 0,void 0,Id(Fd,this))}recycleRenderDisplay(e,t,i){t.setWatermarkFlag(0),t.setVideoMode(h),t.clear(i);let r=Id(Ud,this).get(e);if(r){let e=r[0],i=r[1];i&&i.some((function(e,r){if(e===t)return i.splice(r,1),!0})),e.push(t)}}onRestoredFromContextLost(e,t,i,r,a){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=Id(Ud,this).get(i);(!s||s.length<2)&&a("canvasRenderArray:".concat(s,", length:").concat(null==s?void 0:s.length));let o=n.get(t);if(o){o.reinit();for(let e=0;e<(null==s?void 0:s.length);e++)s[e].forEach((e=>{null==e||e.reinit({program:o.shaderProgram,contextgl:o.contextGL,vBuffer:o.vertexPosBuffer,tBuffer:o.texturePosBuffer,waterMarkTextureRef:o.waterMarkTextureRef,repeatedWaterMarkTextureRef:o.repeatedWaterMarkTextureRef})}));return i!==t&&(Id(Ud,this).delete(i),Id(Ud,this).set(t,s),n&&(n.delete(i),n.set(t,o))),null}}getRenderDisplayMap(){return Id(Ud,this)}cleanup(e,t){var i;null==t||null===(i=t.cleanup)||void 0===i||i.call(t);for(const[e,t]of Id(Ud,this)){const e=t[0],i=t[1];for(const t of e)t.cleanup();for(const e of i)e.cleanup()}Md(Ud,this,new Map)}cleanupByCanvas(e){if(Id(Ud,this).get(e)){let t=Id(Ud,this).get(e);if(t){let i=t[0],r=t[1];r.forEach((function(e){var t;null==e||null===(t=e.cleanup)||void 0===t||t.call(e)})),i.forEach((function(e){var t;null==e||null===(t=e.cleanup)||void 0===t||t.call(e)})),i=[],r=[],Id(Ud,this).delete(e)}}}}var Hd=new WeakMap,jd=new WeakMap,Kd=new WeakMap;class qd extends Nd{constructor(){super(),Td(this,Hd,new Map),Td(this,jd,new Map),Td(this,Kd,null)}setGPUResourceMgr(e){Md(Kd,this,e)}getVideoRenderDisplay(e,t,i,r){let a=Id(Hd,this).get(e);a||(a=new Rd(i,Nr.gz.VIDEO,Id(Kd,this)),a.initPool(i),Id(Hd,this).set(e,a));let n=a.pop();return n?(n.setMultiView(!0),n):null}getSharingRenderDisplay(e,t,i){i&&i.clearCache&&Id(jd,this).clear();let r=Id(jd,this).get(e);return r||(r=new Rd(1,Nr.gz.SHARE,Id(Kd,this)),r.initPool(1),Id(jd,this).set(e,r)),r.pop()}createVideoRenderDisplay(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const a=new md(i,Id(Kd,this));return a.addRenderer(r),a.attachCanvas(e,t),a}getInUseCanvasRenderDisplayList(e){let t=[],i=null;if(e==Nr.gz.VIDEO?i=Id(Hd,this):e==Nr.gz.SHARE&&(i=Id(jd,this)),i)for(const[e,r]of i){let i={};i.canvas=e,i.renderDisplays=r.getInUseRenderDisplays(),i.renderDisplays.length>0&&t.push(i)}return t}recycleRenderDisplay(e,t){if(e){const t=e.getAttachedCanvas();if(t){let i=Id(Hd,this).get(t);i&&(e.setWatermarkFlag(0),e.setVideoMode(h),i.recycle(e));let r=Id(jd,this).get(t);r&&(e.setWatermarkFlag(0),e.setVideoMode(h),r.recycle(e))}}}cleanup(e){var t;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null==e||null===(t=e.cleanup)||void 0===t||t.call(e,i);for(const[e,t]of Id(Hd,this))t.cleanup(i);for(const[e,t]of Id(jd,this))t.cleanup(i)}cleanupByCanvas(e){let t=Id(Hd,this).get(e);t&&(t.cleanup(),Id(Hd,this).delete(e));let i=Id(jd,this).get(e);i&&(i.cleanup(),Id(jd,this).delete(e))}collectInUseRenderDisplays(e){return this.getInUseCanvasRenderDisplayList(e)}collectInUseRenderDisplaysByCanvas(e,t){let i=null;return e&&(t==Nr.gz.VIDEO?i=Id(Hd,this).get(e).getInUseRenderDisplays():t==Nr.gz.SHARE&&(i=Id(jd,this).get(e).getInUseRenderDisplays())),i}getRenderDisplayMap(e){let t=null;return e==Nr.gz.VIDEO?t=Id(Hd,this):e==Nr.gz.SHARE&&(t=Id(jd,this)),t}}const zd=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Td(this,Pd,null),Td(this,kd,null),Td(this,Od,null),Td(this,xd,null),Td(this,Vd,!1),Md(Vd,this,e)}setGPUResourceMgr(e){Md(xd,this,e)}isEnableCanvasAlphaChannel(){return Id(Vd,this)}setCanvasAlphaChannelEnability(e){Md(Vd,this,e),Id(Pd,this)&&Id(Pd,this).setCanvasAlphaChannelEnability(e),Id(kd,this)&&Id(kd,this).setCanvasAlphaChannelEnability(e)}getWebGLRenderDisplayMgr(){return Id(Pd,this)||Md(Pd,this,new Bd(Id(Vd,this))),Id(Pd,this)}getWebGL2RenderDisplayMgr(){return Id(kd,this)||Md(kd,this,new Gd(Id(Vd,this))),Id(kd,this)}getWebGPURenderDisplayMgr(){return Id(Od,this)||(Md(Od,this,new qd),Id(Od,this).setGPUResourceMgr(Id(xd,this))),Id(Od,this)}getVideoRenderDisplay(e,t,i,r,a){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=null;return e===Nr.h3.WEBGL?(Id(Pd,this)||Md(Pd,this,new Bd(Id(Vd,this))),o=Id(Pd,this).getVideoRenderDisplay(t,i,r,a,s)):e===Nr.h3.WEBGL_2?(Id(kd,this)||Md(kd,this,new Gd(Id(Vd,this))),o=Id(kd,this).getVideoRenderDisplay(t,i,r,a,s)):e===Nr.h3.WEBGPU&&(Id(Od,this)||(Md(Od,this,new qd),Id(Od,this).setGPUResourceMgr(Id(xd,this))),o=Id(Od,this).getVideoRenderDisplay(t,i,r,a),o&&(o.addRenderer(n),o.attachCanvas(t,i),o.setGPUResMgr(Id(xd,this)))),o}getSharingRenderDisplay(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=null;return e===Nr.h3.WEBGL?(Id(Pd,this)||Md(Pd,this,new Bd(Id(Vd,this))),n=Id(Pd,this).getSharingRenderDisplay(t,i,a)):e===Nr.h3.WEBGL_2?(Id(kd,this)||Md(kd,this,new Gd(Id(Vd,this))),n=Id(kd,this).getSharingRenderDisplay(t,i,a)):e===Nr.h3.WEBGPU&&(Id(Od,this)||(Md(Od,this,new qd),Id(Od,this).setGPUResourceMgr(Id(xd,this))),n=Id(Od,this).getSharingRenderDisplay(t,i,a),n&&(n.addRenderer(r),n.attachCanvas(t,i),n.setGPUResMgr(Id(xd,this)))),n}createVideoRenderDisplay(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=null;return e==Nr.h3.WEBGL?(Id(Pd,this)||Md(Pd,this,new Bd(Id(Vd,this))),s=Id(Pd,this).createVideoRenderDisplay(t,i,r,a,n)):e==Nr.h3.WEBGL_2?(Id(kd,this)||Md(kd,this,new Gd(Id(Vd,this))),s=Id(kd,this).createVideoRenderDisplay(t,i,r,a,n)):e==Nr.h3.WEBGPU&&(Id(Od,this)||(Md(Od,this,new qd),Id(Od,this).setGPUResourceMgr(Id(xd,this))),s=Id(Od,this).createVideoRenderDisplay(t,i,r,a,n),s.addRenderer(a),s.attachCanvas(t,i),s.setGPUResMgr(Id(xd,this))),s}recycleRenderDisplay(e,t,i,r){let a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e===Nr.h3.WEBGPU?Id(Od,this)&&Id(Od,this).recycleRenderDisplay(i,r,a):e===Nr.h3.WEBGL?Id(Pd,this)&&Id(Pd,this).recycleRenderDisplay(t,i,a):e===Nr.h3.WEBGL_2&&Id(kd,this)&&Id(kd,this).recycleRenderDisplay(t,i,a)}collectInUseRenderDisplays(e,t){let i=null;return e===Nr.h3.WEBGPU&&Id(Od,this)&&(i=Id(Od,this).collectInUseRenderDisplays(t)),i}collectInUseRenderDisplaysByCanvas(e,t,i){let r=null;return e===Nr.h3.WEBGPU&&Id(Od,this)&&(r=Id(Od,this).collectInUseRenderDisplaysByCanvas(t,i)),r}getRenderDisplayMap(e,t){if(e===Nr.h3.WEBGL){if(Id(Pd,this))return Id(Pd,this).getRenderDisplayMap()}else if(e===Nr.h3.WEBGPU){if(Id(Od,this))return Id(Od,this).getRenderDisplayMap(t)}else if(e===Nr.h3.WEBGL_2&&Id(kd,this))return Id(kd,this).getRenderDisplayMap(t);return null}onRestoredFromContextLost(e,t,i,r,a){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return Id(Pd,this)?Id(Pd,this).onRestoredFromContextLost(e,t,i,r,a,n):Id(kd,this)?Id(kd,this).onRestoredFromContextLost(e,t,i,r,a,n):null}cleanup(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];null!==Id(Pd,this)&&Id(Pd,this).cleanup(e,t),Id(kd,this)&&Id(kd,this).cleanup(e,t),null!==Id(Od,this)&&Id(Od,this).cleanup(t,i)}cleanupByCanvas(e){null!==Id(Pd,this)&&Id(Pd,this).cleanupByCanvas(e),null!==Id(kd,this)&&Id(kd,this).cleanupByCanvas(e),null!==Id(Od,this)&&Id(Od,this).cleanupByCanvas(e)}};function Xd(e,t,i){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,i)}function Yd(e,t){return e.get(Jd(e,t))}function Qd(e,t,i){return e.set(Jd(e,t),i),i}function Jd(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}var Zd=new WeakMap,$d=new WeakMap,ec=new WeakMap,tc=new WeakMap,ic=new WeakMap,rc=new WeakMap,ac=new WeakMap;const nc=class{constructor(e){Xd(this,Zd,Nr.PP.VERTEX_BUFFER),Xd(this,$d,{}),Xd(this,ec,null),Xd(this,tc,0),Xd(this,ic,0),Xd(this,rc,[]),Xd(this,ac,new Map),Qd(ec,this,e)}acquireBuffer(e,t,i){let r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return arguments.length>4&&void 0!==arguments[4]&&!arguments[4]?r=Yd(ec,this).createBuffer({size:i,usage:t,mappedAtCreation:a}):Yd(ac,this).has(e)?r=Yd(ac,this).get(e):Yd(rc,this).length>0?(r=Yd(rc,this).pop(),Yd(ac,this).set(e,r)):(r=Yd(ec,this).createBuffer({size:i,usage:t,mappedAtCreation:a}),Yd(ac,this).set(e,r)),r}releaseBuffer(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(Yd(ac,this).has(e)){const t=Yd(ac,this).get(e);i?Yd(rc,this).push(t):t.destroy(),Yd(ac,this).delete(e)}else i||-1!=Yd(rc,this).indexOf(t)&&(Yd(rc,this)[index]=Yd(rc,this)[Yd(rc,this).length-1],Yd(rc,this).pop(),t.destroy())}getNumUsedBuffers(){return Yd(tc,this)}getNumFreeBuffers(){return Yd(ic,this)}cleanup(){Yd(rc,this).forEach(((e,t)=>{e.forEach((e=>{e.destroy()}))})),Yd(ac,this).forEach(((e,t)=>{e.forEach((e=>{e.destroy()}))})),Yd(rc,this).length=0,Yd(ac,this).clear(),Qd(tc,this,0),Qd(ic,this,0)}release(e){e==Nr.wo.OVERUSE&&(Yd(rc,this).forEach(((e,t)=>{e.forEach((e=>{e.destroy()}))})),Yd(rc,this).length=0,Qd(ic,this,0))}getResourceType(){return Yd(Zd,this)}collectResourceInfo(){let e=0,t=0,i="";for(const[r,a]of Yd(ac,this))e++,t+=a.size,i+="[GPUBufferMgr] entry{key:".concat(r,", buffer:{label:").concat(a.label," size:").concat(a.size,"}}\n");for(const i of Yd(rc,this))e++,t+=i.size;return i+="[GPUBufferMgr] freeBuffers{size:".concat(Yd(rc,this).length,"}\n"),i+="[GPUBufferMgr] total: count:".concat(e," usedBytes:").concat(t,"\n"),Yd($d,this).type=Yd(Zd,this),Yd($d,this).count=e,Yd($d,this).usedBytes=t,Yd($d,this).output=i,Yd($d,this)}onOccupancyLevelEvaluated(e){console.log("[GPUBufferManager] onOccupancyLevelEvaluated() level:".concat(e)),Je("WGPU GPUBufferManager_onOccupancyLevelEvaluated() level:".concat(e)),this.release(e)}};function sc(e,t,i){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,i)}function oc(e,t){return e.get(function(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}(e,t))}var dc=new WeakMap,cc=new WeakMap,uc=new WeakMap;const hc=class{constructor(){sc(this,dc,Nr.PP.TEXTURE),sc(this,cc,[]),sc(this,uc,[])}acquire(e){let t=null;const i=oc(cc,this).findIndex((t=>t&&t.width==e.w&&t.height==e.h&&t.format==e.format&&t.usage==e.usage));return i>-1&&(t=oc(cc,this).splice(i,1)[0]),t&&oc(uc,this).push(t),t}recycle(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=oc(uc,this).indexOf(e);-1!=i&&oc(uc,this).splice(i,1),t?e.destroy():(oc(cc,this).push(e),e.label="")}pushToAvailablePool(e){e&&oc(cc,this).push(e)}pushToInUsePool(e){e&&oc(uc,this).push(e)}release(e){if(e==Nr.wo.OVERUSE&&oc(cc,this).length>0){for(const e of oc(cc,this))e.destroy();oc(cc,this).length=0}}cleanup(){for(const e of oc(cc,this))e.destroy();for(const e of oc(uc,this))e.destroy();oc(cc,this).length=0,oc(uc,this).length=0}getAvailablePool(){return oc(cc,this)}getInUsedPool(){return oc(uc,this)}getResourceType(){return oc(dc,this)}};function lc(e,t,i){pc(e,t),t.set(e,i)}function pc(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function fc(e,t){return e.get(gc(e,t))}function gc(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}var mc=new WeakMap,vc=new WeakMap,Ac=new WeakMap,Sc=new WeakMap,_c=new WeakSet;function yc(e){let t=fc(Ac,this).get(e.level),i=null;return t?(i=t.acquire(e),i||(i=gc(_c,this,bc).call(this,e),i?t.pushToInUsePool(i):console.error("acquireTexture() cannot create an available tex. texConfig=".concat(JSON.stringify(e))))):(i=gc(_c,this,bc).call(this,e),i?(t=new hc,t.pushToInUsePool(i),fc(Ac,this).set(e.level,t)):console.error("acquireTexture() cannot create an available tex. texConfig=".concat(JSON.stringify(e)))),i}function Cc(e){const t=e.zOrder;let i=fc(Sc,this).get(t);return i?(e.w>i.width||e.h>i.height)&&(i.destroy(),i=gc(_c,this,bc).call(this,e),fc(Sc,this).set(t,i)):(i=gc(_c,this,bc).call(this,e),fc(Sc,this).set(t,i)),i}function bc(e){if(!fc(mc,this))return null;if(0==e.w||0==e.h)return null;const t={size:{width:e.w,height:e.h},format:e.format,usage:e.usage};return e.sampleCount>0&&(t.sampleCount=e.sampleCount),fc(mc,this).createTexture(t)}function wc(e){let t=Nr.bH[Nr.bH.length-1];for(let i=0;i<Nr.bH.length;++i)if(e<=Nr.bH[i]){t=Nr.bH[i];break}return t}function Ec(e){return e&&e.zOrder&&e.zOrder==TEX_LAYER_Z_IDX.WATERMARK}const Rc=class{constructor(e){var t;pc(this,t=_c),t.add(this),lc(this,mc,null),lc(this,vc,{}),lc(this,Ac,new Map),lc(this,Sc,new Map),function(e,t,i){e.set(gc(e,t),i)}(mc,this,e)}assembleTextureConfig(e,t,i,r,a){return{w:e,h:t,usage:i,format:r,sampleCount:a,level:gc(_c,this,wc).call(this,t)}}isSameTextureConfig(e,t){return!(!e||!t)&&e.w==t.w&&e.h==t.h&&e.usage==t.usage&&e.format==t.format&&e.sampleCount==t.sampleCount}evalTexConfig(e){if(!e)throw new Error("hasSameTextureConfig() invalid input!");const t=fc(Ac,this).keys();let i=e;for(const r of t)if(this.isSameTextureConfig(r,e)){i=r;break}return i}needNewTexturesMapEntry(e,t){return!(!t||e&&e.w==t.w&&e.h==t.h&&e.usage==t.usage&&e.format==t.format&&e.sampleCount==t.sampleCount)}acquireTexture(e){if(!e||e.w<=0||e.h<=0)return console.error("[GPUTextureMgr] acquireTexture() texConfig is invalid"),null;let t=null;return t=gc(_c,this,Ec).call(this,e)?gc(_c,this,Cc).call(this,e):gc(_c,this,yc).call(this,e),t}recycleTexture(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return;const i=this.assembleTextureConfig(e.width,e.height,e.usage,e.format,e.sampleCount);let r=fc(Ac,this).get(i.level);if(r)r.recycle(e,t);else if(console.warn("recycleTexture(".concat(e.label,") texture is not found in the map!, destroy:").concat(t)),t)e.destroy();else{const t=new hc;t.pushToAvailablePool(e),fc(Ac,this).set(i.level,t)}}cleanup(){for(const[e,t]of fc(Ac,this))t&&t.cleanup();fc(Ac,this).clear()}collectResourceInfo(){let e=0,t=0,i="";for(const[r,a]of fc(Ac,this))if(a){const n=a.getAvailablePool();for(const i of n)e++,"r8unorm"==i.format?t+=i.width*i.height:"rgba8unorm"==i.format&&(t+=i.width*i.height*Uint32Array.BYTES_PER_ELEMENT);const s=a.getInUsedPool();for(const i of s)e++,"r8unorm"==i.format?t+=i.width*i.height:"rgba8unorm"==i.format&&(t+=i.width*i.height*Uint32Array.BYTES_PER_ELEMENT);(n.length>0||s.length>0)&&(i+="[GPUTexturePool] level:".concat(r," pool:{ava_count:").concat(n.length," in_used_count:").concat(s.length,"}\n"))}return i+="[GPUTexturePool] total: count:".concat(e," usedBytes:").concat(t,"\n"),fc(vc,this).type=Nr.PP.TEXTURE,fc(vc,this).count=e,fc(vc,this).usedBytes=t,fc(vc,this).output=i,fc(vc,this)}onOccupancyLevelEvaluated(e){if(console.log("[GPUTextureManager] onOccupancyLevelEvaluated() level:".concat(e)),Je("WGPU GPUTextureManager_onOccupancyLevelEvaluated() level:".concat(e)),e==Nr.wo.OVERUSE)for(const[t,i]of fc(Ac,this))i&&i.release(e)}};function Tc(e,t,i){Ic(e,t),t.set(e,i)}function Ic(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Mc(e,t){return e.get(Pc(e,t))}function Dc(e,t,i){return e.set(Pc(e,t),i),i}function Pc(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}var kc=new WeakMap,Oc=new WeakMap,xc=new WeakMap,Vc=new WeakMap,Nc=new WeakSet;function Lc(e,t,i){if(Mc(xc,this).set(e,t),i){let e=Array.from(Mc(xc,this).entries());wa()(e).call(e,((e,t)=>e[0]-t[0])),Mc(xc,this).clear(),e.forEach((e=>{let[t,i]=e;Mc(xc,this).set(t,i)}))}}function Wc(e,t){if(!e||0==e.length)return null;let i=0,r=0,a=null;for(const n of e)"mapped"==n.mapState?(i+=1,a||n.size>=t&&(a=n)):r+=1;if(i>0&&0==r||i>=2&&0!=r){if(a){const t=e.indexOf(a);-1!=t&&e.splice(t,1)}return a}return null}const Bc=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;var i;Ic(this,i=Nc),i.add(this),Tc(this,kc,Nr.PP.TEXTURE_BUFFER),Tc(this,Oc,0),Tc(this,xc,new Map),Tc(this,Vc,0),Dc(Oc,this,e),Dc(Vc,this,t)}isUpToThreshold(e,t){if(e!=Mc(Oc,this)||t<=0)return!1;if(0==Mc(Vc,this))return!1;const i=Mc(xc,this).get(t);return!!i&&i.length>=Mc(Vc,this)}push(e,t,i){if(e!=Mc(Oc,this)||!i||t<=0)return!1;let r=null,a=!1;if(Mc(xc,this).has(t)){if(r=Mc(xc,this).get(t),r||(r=[],a=!0),!(r.length<Mc(Vc,this)))return!1;r.push(i)}else r=[],r.push(i),a=!0;return a&&Pc(Nc,this,Lc).call(this,t,r,a),!0}acquire(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;let i=e.level,r=e.bytesPerRow,a=e.size;if(i!=Mc(Oc,this)||r<=0)return console.error("[GPUBufferPoolEntry] acquire() level(".concat(i,") or bpr=").concat(r," is invalid!")),null;let n=null,s=!1;if(Mc(xc,this).has(r)){let e=Mc(xc,this).get(r);if(e){const t=e.findIndex((e=>"mapped"==e.mapState&&e.size>=a));t>-1?n=e.splice(t,1)[0]:s=!0}else s=!0}else s=!0;if(s&&!n&&!t){let t=2,s=!1;i>=Nr.BJ[Nr._$]&&(s=!0);for(const[i,o]of Mc(xc,this))if((t>0||s)&&i>r){if(n=Pc(Nc,this,Wc).call(this,o,a),n){e.bytesPerRow=i;break}t--}}return n}recycle(e,t,i){if(e!=Mc(Oc,this)||t<=0||!i)return!1;let r=!1;if(Mc(xc,this).has(t)){let e=!1,a=Mc(xc,this).get(t);a||(a=[],e=!0),a.push(i),e&&Pc(Nc,this,Lc).call(this,t,a,e),r=!0}else r=this.push(e,t,i);return r}release(e){if(e==Nr.wo.OVERUSE){for(const[e,t]of Mc(xc,this))if(t){for(const e of t)"mapped"!=e.mapState&&"unmapped"!=e.mapState||e.destroy();t.length=0}Mc(xc,this).clear()}}cleanup(){for(const[e,t]of Mc(xc,this))if(t){for(const e of t)"mapped"!=e.mapState&&"unmapped"!=e.mapState||e.destroy();t.length=0}Mc(xc,this).clear()}getPool(){return Mc(xc,this)}hasBytesPerRowAsKey(e){return Mc(xc,this).has(e)}getResourceType(){return Mc(kc,this)}getPoolThreshold(){return Mc(Vc,this)}canLendBufferCrossLevel(e,t){let i=!0;if(Mc(xc,this).has(t)){const r=Mc(xc,this).get(t);if(r){let t=0,a=0;for(const e of r)"mapped"==e.mapState?t+=1:a+=1;i=e>=Nr.BJ[Nr._$]?t>0:t>0&&0==a||t>=2&&0!=a}}else i=!1;return i}};function Uc(e,t,i){Fc(e,t),t.set(e,i)}function Fc(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Gc(e,t){return e.get(jc(e,t))}function Hc(e,t,i){return e.set(jc(e,t),i),i}function jc(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}var Kc=new WeakMap,qc=new WeakMap,zc=new WeakMap,Xc=new WeakMap,Yc=new WeakMap,Qc=new WeakMap,Jc=new WeakSet;function Zc(e){if(!e)return;const t=e.colorFormat;if("rgba"==t){const t=jc(Jc,this,$c).call(this,e.height);t>0&&t<Nr.BJ[Nr._$]&&(e.size=e.width*t,e.height=t),e.level=t,e.bytesPerRow=e.width}else if("i420"==t){const t=jc(Jc,this,$c).call(this,e.yPlane.height);t>0&&t<Nr.BJ[Nr._$]&&(e.size=e.yPlane.width*t+e.uvPlane.width*t,e.yPlane.height=t,e.uvPlane.height=t/2),e.level=t,e.bytesPerRow=e.yPlane.width}else if("nv12"==t){const t=jc(Jc,this,$c).call(this,e.yPlane.height);t>0&&t<Nr.BJ[Nr._$]&&(e.size=e.yPlane.width*t+e.uvPlane.width*t/2,e.yPlane.height=t,e.uvPlane.height=t/2),e.level=t,e.bytesPerRow=e.yPlane.width}}function $c(e){if(e<=0)return 0;let t=Nr.BJ[Nr._$];for(let i=0;i<Nr.BJ.length;++i)if(e<=Nr.BJ[i]){t=Nr.BJ[i];break}return t}function eu(e){const t=Nr.BJ.indexOf(e);return t>-1&&t+1<=Nr.BJ.length-1?Nr.BJ[t+1]:e}function tu(e){if(!e)return 0;let t=0;const i=e.colorFormat;if("rgba"==i?t=e.height:"i420"!=i&&"nv12"!=i||(t=e.yPlane.height),0==t)return 0;let r=0;return r=t<=Nr.BJ[2]?90:t>Nr.BJ[2]&&t<=Nr.BJ[5]?60:15,r}function iu(e){return e.mapAsync(GPUMapMode.WRITE,0,e.size)}function ru(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(Gc(Yc,this).set(e,t),i){let e=Array.from(Gc(Yc,this).entries());wa()(e).call(e,((e,t)=>e[0]-t[0])),Gc(Yc,this).clear(),e.forEach((e=>{let[t,i]=e;Gc(Yc,this).set(t,i)}))}}function au(e){if(!e)return null;let t=e.level,i=e.bytesPerRow;e.size;const r=jc(Jc,this,eu).call(this,t);if(r<=t)return null;if(!Gc(Yc,this).has(r))return null;const a=Gc(Yc,this).get(r);if(!a)return null;if(!a.hasBytesPerRowAsKey(i))return null;if(!a.canLendBufferCrossLevel(t,i))return null;const n={};Object.assign(n,e),n.level=r;const s=a.acquire(n,!0);return s&&(e.level=r,e.bytesPerRow=n.bytesPerRow),s}const nu=class{constructor(e){var t;Fc(this,t=Jc),t.add(this),Uc(this,Kc,Nr.PP.TEXTURE_BUFFER),Uc(this,qc,{}),Uc(this,zc,null),Uc(this,Xc,[]),Uc(this,Yc,new Map),Uc(this,Qc,0),Hc(zc,this,e)}acquire(e){if(!e)throw new Error("acquire() bufferConfig is invalid!");jc(Jc,this,Zc).call(this,e);let t=null,i=null;if(0==Gc(Yc,this).size){if(Gc(zc,this)){const r=Gc(zc,this).createBuffer({label:e.label,size:e.size,usage:e.usage,mappedAtCreation:!0});let a=!1;if(!i){const t=jc(Jc,this,tu).call(this,e);i=new Bc(e.level,t),a=!0}r&&(Hc(Qc,this,Gc(Qc,this)+1),t=r,t.label="".concat(e.label,"-").concat(Gc(Qc,this))),jc(Jc,this,ru).call(this,e.level,i,a)}}else if(Gc(Yc,this).has(e.level)){i=Gc(Yc,this).get(e.level);let r=!1;if(!i){const t=jc(Jc,this,tu).call(this,e);i=new Bc(e.level,t),r=!0}if(t=i.acquire(e),t)t.label="".concat(e.label,"-").concat(Gc(Qc,this));else if(t=jc(Jc,this,au).call(this,e),!t)if(i.isUpToThreshold(e.level,e.bytesPerRow))console.log("[GPUBufferPool]acquire() next level cant help and pool is up to threshold! Only to wait for a while...");else{const i=Gc(zc,this).createBuffer({label:e.label,size:e.size,usage:e.usage,mappedAtCreation:!0});i&&(Hc(Qc,this,Gc(Qc,this)+1),t=i,t.label="".concat(e.label,"-").concat(Gc(Qc,this)))}r&&jc(Jc,this,ru).call(this,e.level,i,r)}else{let r=!1;if(t=jc(Jc,this,au).call(this,e),t)t.label="".concat(e.label,"-").concat(Gc(Qc,this));else{const a=Gc(zc,this).createBuffer({label:e.label,size:e.size,usage:e.usage,mappedAtCreation:!0});if(!i){const t=jc(Jc,this,tu).call(this,e);i=new Bc(e.level,t),r=!0}a&&(Hc(Qc,this,Gc(Qc,this)+1),t=a,t.label="".concat(e.label,"-").concat(Gc(Qc,this)))}r&&jc(Jc,this,ru).call(this,e.level,i,r)}return t&&Gc(Xc,this).push(t),t}recycle(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e)return;const r=Gc(Xc,this).indexOf(e);if(-1!=r?Gc(Xc,this).splice(r,1):(console.error("[BufferPool] buffer can't be recycled. bufferConfig:".concat(JSON.stringify(t),", needToRecycle=").concat(i)),Je("[BufferPool] buffer can't be recycled. bufferConfig:".concat(JSON.stringify(t),", needToRecycle=").concat(i))),t)if(i){"unmapped"!=e.mapState&&e.unmap(),"unmapped"==e.mapState&&jc(Jc,this,iu).call(this,e).then((()=>{})).catch((t=>{console.warn("mapAsyncBuffer() error:".concat(t)),e.destroy(),e=null}));let i=Gc(Yc,this).get(t.level);i&&i.recycle(t.level,t.bytesPerRow,e),e.label=""}else e.destroy(),e=null;else e.destroy()}recycleInUsedGPUBuffers(e,t){for(const[i,r]of e)for(const e of r)if(e){const i=e.getTextureBufferGroup();i&&i.buffer&&(i.bufferArray&&(i.bufferArray=null),this.recycle(i.buffer,i.bufferConfig)),e.destroyTextureBufferGroup(t)}}recycleTextureBufferGroup(e,t){if(e&&t){const i=t.acquireGPUBufferPool();if(i){const r=e.getTextureBufferGroup();r&&r.buffer&&(r.bufferArray&&(r.bufferArray=null),i.recycle(r.buffer,r.bufferConfig),e.destroyTextureBufferGroup(t))}}}cleanup(){for(const e of Gc(Xc,this))"unmapped"!=e.mapState&&e.unmap(),e.destroy();Gc(Xc,this).length=0;for(const[e,t]of Gc(Yc,this))t&&t.cleanup();Gc(Yc,this).clear()}release(e){if(e==Nr.wo.OVERUSE){for(const[t,i]of Gc(Yc,this))i&&i.release(e);Gc(Yc,this).clear()}}getResourceType(){return Gc(Kc,this)}collectResourceInfo(){let e=0,t=0,i="";for(const[r,a]of Gc(Yc,this))if(a){const n=a.getPool();for(const[s,o]of n){e+=o.length;let n=0,d=0;for(const e of o)t+=e.size,"mapped"==e.mapState?n+=1:d+=1;i+="[GPUBufferPool] level:".concat(r," bpr:").concat(s," threshold:").concat(a.getPoolThreshold()," pool:{len:").concat(o.length," ava_count:").concat(n," pending_count:").concat(d,"}\n")}}let r=0;for(const i of Gc(Xc,this))e+=1,t+=i.size,r+=1;return i+="[GPUBufferPool] in_used_count:".concat(r,"\n"),i+="[GPUBufferPool] total: count:".concat(e," usedBytes:").concat(t,"\n"),Gc(qc,this).type=Gc(Kc,this),Gc(qc,this).count=e,Gc(qc,this).usedBytes=t,Gc(qc,this).output=i,Gc(qc,this)}onOccupancyLevelEvaluated(e){Je("WGPU GPUBufferPool_onOccupancyLevelEvaluated() level:".concat(e)),console.log("[GPUBufferPool] onOccupancyLevelEvaluated() level:".concat(e)),this.release(e)}getInUsedPoolCount(){return Gc(Xc,this).length}};function su(e,t,i){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,i)}function ou(e,t){return e.get(cu(e,t))}function du(e,t,i){return e.set(cu(e,t),i),i}function cu(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}var uu=new WeakMap,hu=new WeakMap;const lu=class{constructor(e){su(this,uu,null),su(this,hu,null),du(uu,this,e),e&&du(hu,this,e.features)}getAdapterFeatures(){return ou(hu,this)}getAdapterLimits(){return ou(uu,this)?ou(uu,this).limits:null}queryMaxTextureDimension2D(){const e=this.getAdapterLimits();return e?e.maxTextureDimension2D:0}queryMaxBufferSize(){const e=this.getAdapterLimits();return e?e.maxBufferSize:0}queryAdapterFeature(e){return!(!ou(hu,this)||!e)&&ou(hu,this).has(e)}isTimestampQuerySupported(){return this.queryAdapterFeature("timestamp-query")}getGPUAdapter(){return ou(uu,this)}cleanup(){du(uu,this,null),du(hu,this,null)}};function pu(e,t,i){fu(e,t),t.set(e,i)}function fu(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function gu(e,t){return e.get(vu(e,t))}function mu(e,t,i){return e.set(vu(e,t),i),i}function vu(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}var Au=new WeakMap,Su=new WeakMap,_u=new WeakMap,yu=new WeakMap,Cu=new WeakSet;function bu(){let e=Nr.wo.LOW;const t="---WatchDog(".concat(gu(yu,this),") starts analyzing---\n");console.log("".concat(t));for(const t of gu(Su,this)){const i=t.collectResourceInfo();console.log("".concat(i.output));const r=vu(Cu,this,wu).call(this,i);t.onOccupancyLevelEvaluated(r),r>e&&(e=r)}const i=vu(Cu,this,Eu).call(this,e);i!=gu(Au,this)&&(clearInterval(gu(_u,this)),mu(_u,this,null),mu(Au,this,i),this.monitor())}function wu(e){let t=Nr.wo.LOW;return e.type==Nr.PP.TEXTURE?t=e.usedBytes<=31457280?Nr.wo.LOW:e.usedBytes<=94371840?Nr.wo.MEDIUM:e.usedBytes<=157286400?Nr.wo.HIGH:Nr.wo.OVERUSE:e.type==Nr.PP.VERTEX_BUFFER?t=e.usedBytes<=5242880?Nr.wo.LOW:e.usedBytes<=10485760?Nr.wo.MEDIUM:e.usedBytes<=15728640?Nr.wo.HIGH:Nr.wo.OVERUSE:e.type==Nr.PP.TEXTURE_BUFFER&&(t=e.usedBytes<=52428800?Nr.wo.LOW:e.usedBytes<=104857600?Nr.wo.MEDIUM:e.usedBytes<=209715200?Nr.wo.HIGH:Nr.wo.OVERUSE),t}function Eu(e){let t=0;switch(e){case Nr.wo.LOW:t=Nr.Hh.LOW;break;case Nr.wo.MEDIUM:t=Nr.Hh.MEDIUM;break;case Nr.wo.HIGH:t=Nr.Hh.HIGH;break;case Nr.wo.OVERUSE:t=Nr.Hh.OVERUSE;break;default:t=Nr.Hh.MEDIUM}return t}const Ru=class{constructor(e){var t;fu(this,t=Cu),t.add(this),pu(this,Au,Nr.Hh.HIGH),pu(this,Su,[]),pu(this,_u,null),pu(this,yu,""),mu(yu,this,e)}addObservable(e){gu(Su,this).push(e)}removeObservable(e){const t=gu(Su,this).indexOf(e);-1!=t&&gu(Su,this).splice(t,1)}removeAllObservables(){gu(Su,this).length=0}monitor(){gu(_u,this)||mu(_u,this,setInterval((()=>{vu(Cu,this,bu).call(this)}),gu(Au,this)))}cleanup(){this.removeAllObservables(),clearInterval(gu(_u,this)),mu(_u,this,null),mu(Au,this,0)}};function Tu(e,t,i){Iu(e,t),t.set(e,i)}function Iu(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Mu(e,t){return e.get(Pu(e,t))}function Du(e,t,i){return e.set(Pu(e,t),i),i}function Pu(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}var ku=new WeakMap,Ou=new WeakMap,xu=new WeakMap,Vu=new WeakMap,Nu=new WeakMap,Lu=new WeakMap,Wu=new WeakMap,Bu=new WeakMap,Uu=new WeakMap,Fu=new WeakMap,Gu=new WeakMap,Hu=new WeakSet;function ju(e){return void 0!==e&&"yPlaneTex"in e}const Ku=class{constructor(){var e;Iu(this,e=Hu),e.add(this),Tu(this,ku,null),Tu(this,Ou,null),Tu(this,xu,null),Tu(this,Vu,null),Tu(this,Nu,null),Tu(this,Lu,null),Tu(this,Wu,null),Tu(this,Bu,null),Tu(this,Uu,null),Tu(this,Fu,null),Tu(this,Gu,"")}addRendererProviderModule(e){Du(Fu,this,e)}setLabel(e){Du(Gu,this,e)}async initialize(){if(navigator.gpu){if(!Mu(ku,this)&&(Du(ku,this,await navigator.gpu.requestAdapter()),!Mu(ku,this)))return console.error("[WebGPUResManager] initialize() Couldn't request WebGPU adapter."),Ye("WebGPU device was lost: ".concat(info.message," reason=").concat(info.reason)),void Ze("WebGPUDeviceLost");Mu(xu,this)||(Du(xu,this,await Mu(ku,this).requestDevice()),Mu(xu,this).lost.then((async e=>{"destroyed"!=e.reason&&(console.error("WebGPU device was lost: ".concat(e.message," reason=").concat(e.reason)),Ye("WebGPU device was lost: ".concat(e.message," reason=").concat(e.reason)),Ze("WebGPUDeviceLost")),Mu(Fu,this)&&Mu(Fu,this).rendererUnconfigureGPUContext(),this.cleanup(),"destroyed"!=e.reason&&(Du(xu,this,null),await this.initialize(),Mu(Fu,this)&&Mu(Fu,this).rendererReinitialize())}))),Mu(Ou,this)||("function"==typeof Mu(ku,this).requestAdapterInfo?Du(Ou,this,await Mu(ku,this).requestAdapterInfo()):"info"in Mu(ku,this)&&Du(Ou,this,Mu(ku,this).info)),Mu(Vu,this)||Du(Vu,this,navigator.gpu.getPreferredCanvasFormat()),Mu(Nu,this)||Du(Nu,this,new nc(Mu(xu,this))),Mu(Lu,this)||Du(Lu,this,new Rc(Mu(xu,this))),Mu(Wu,this)||Du(Wu,this,new nu(Mu(xu,this))),Mu(Bu,this)||Du(Bu,this,new lu(Mu(ku,this))),Mu(Uu,this)||(Du(Uu,this,new Ru(Mu(Gu,this))),Mu(Uu,this).addObservable(Mu(Nu,this)),Mu(Uu,this).addObservable(Mu(Lu,this)),Mu(Uu,this).addObservable(Mu(Wu,this)),Mu(Uu,this).monitor())}else console.error("[WebGPUResManager] initialize() WebGPU is not supported!")}acquireGPUDevice(){return Mu(xu,this)}acquireCanvasFormat(){return Mu(Vu,this)}acquireGPUAdapterInfo(){return Mu(Ou,this)}destroyGPUDevice(){Mu(xu,this)&&(Mu(xu,this).destroy(),Du(xu,this,null))}acquireGPUBufferMgr(){return Mu(Nu,this)}acquireGPUTextureMgr(){return Mu(Lu,this)}acquireGPUBufferPool(){return Mu(Wu,this)}acquireGPUFeaturesHelper(){return Mu(Bu,this)}cleanup(){Mu(Nu,this)&&(Mu(Nu,this).cleanup(),Du(Nu,this,null)),Mu(Lu,this)&&(Mu(Lu,this).cleanup(),Du(Lu,this,null)),Mu(Wu,this)&&(Mu(Wu,this).cleanup(),Du(Wu,this,null)),Mu(Bu,this)&&(Mu(Bu,this).cleanup(),Du(Bu,this,null)),Mu(Uu,this)&&(Mu(Uu,this).cleanup(),Du(Uu,this,null)),Du(Fu,this,null),this.destroyGPUDevice()}recycleTextureBufferGroup(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e&&Mu(Wu,this)){const i=e.getTextureBufferGroup();i&&i.buffer&&(i.bufferArray&&(i.bufferArray=null),Mu(Wu,this).recycle(i.buffer,i.bufferConfig,t),e.destroyTextureBufferGroup(this))}}recycleInUsedGPUBuffers(e){for(const[t,i]of e)for(const e of i)if(e){const t=e.getTextureBufferGroup();t&&t.buffer&&(t.bufferArray&&(t.bufferArray=null),Mu(Wu,this).recycle(t.buffer,t.bufferConfig)),e.destroyTextureBufferGroup(this)}}requestTextureBuffer(e){if(!Mu(Wu,this))return null;if(function(e,t){if(!e||t<0)throw new Error("isBufferSizeOverMaxSize() invalid parameters. res=".concat(e,", bufferSize=").concat(t));let i=!1,r=0;const a=e.acquireGPUFeaturesHelper();return a&&(r=a.queryMaxBufferSize(),r>0&&(i=t>r)),i&&(console.log("isBufferSizeOverMaxSize() bufferSize:".concat(t," max:").concat(r)),Je("isBufferSizeOverMaxSize() bufferSize:".concat(t," max:").concat(r))),i}(this,e.size))return Ye("requestTextureBuffer() a buffer size that exceeds the max size of GPUBuffer is required.(size:".concat(e.size,")")),null;const t=GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC;return e.usage=t,Mu(Wu,this).acquire(e)}destroyTextureGroup(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return;const i=e.getTextureGroup();if(!i)return;if(!Mu(Lu,this))return void Ye("destroyTextureGroup() mGPUTextureMgr is undefined!");const r=e.getTextureType();i&&(r==Nr.D2.GPU_TEX_YUV?(Mu(Lu,this).recycleTexture(i.yPlaneTex,t),Mu(Lu,this).recycleTexture(i.uPlaneTex,t),i.vPlaneTex&&Mu(Lu,this).recycleTexture(i.vPlaneTex,t)):r==Nr.D2.GPU_TEX_RGBA?Mu(Lu,this).recycleTexture(i,t):Pu(Hu,this,ju).call(this,i)?(Mu(Lu,this).recycleTexture(i.yPlaneTex,t),Mu(Lu,this).recycleTexture(i.uPlaneTex,t),i.vPlaneTex&&Mu(Lu,this).recycleTexture(i.vPlaneTex,t)):Mu(Lu,this).recycleTexture(i,t),e.setTextureGroup(null))}};function qu(e,t,i){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,i)}function zu(e,t){return e.get(Xu(e,t))}function Xu(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}var Yu=new WeakMap,Qu=new WeakMap,Ju=new WeakMap,Zu=new WeakMap,$u=new WeakMap;const eh=class{constructor(e){var t,i;qu(this,Yu,""),qu(this,Qu,new ms),qu(this,Ju,new zd),qu(this,Zu,new ys),qu(this,$u,new Ku),i=e,(t=Yu).set(Xu(t,this),i),zu($u,this).addRendererProviderModule(zu(Qu,this)),zu($u,this).setLabel(zu(Yu,this)),zu(Ju,this).setGPUResourceMgr(zu($u,this))}isEnableCanvasAlphaChannel(){return zu(Ju,this).isEnableCanvasAlphaChannel()}setCanvasAlphaChannelEnability(e){zu(Ju,this).setCanvasAlphaChannelEnability(e)}async evalRendererType(e){const t=await zu(Qu,this).evaluate(e);console.log("[RenderManager] rendererType is ".concat(t))}getVideoRenderDisplay(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const n=zu(Qu,this).getRendererType(),s=zu(Qu,this).acquireRenderer(e,zu($u,this));return zu(Ju,this).getVideoRenderDisplay(n,e,t,i,r,s,a)}createWebGLVideoRenderDisplay(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return zu(Qu,this).isWebGL2RendererType()?zu(Ju,this).getWebGL2RenderDisplayMgr().createVideoRenderDisplay(e,t,i,null,r):zu(Qu,this).isWebGLRendererType()?zu(Ju,this).getWebGLRenderDisplayMgr().createVideoRenderDisplay(e,t,i,null,r):null}createVideoRenderDisplay(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const a=zu(Qu,this).getRendererType(),n=zu(Qu,this).acquireRenderer(e,zu($u,this));return zu(Ju,this).createVideoRenderDisplay(a,e,t,i,n,r)}getSharingRenderDisplay(e,t,i){const r=zu(Qu,this).getRendererType(),a=zu(Qu,this).acquireRenderer(e,zu($u,this),!0);return i||(i={}),i.clearCache=!0,zu(Ju,this).getSharingRenderDisplay(r,e,t,a,i)}recycleRenderDisplay(e,t,i){const r=zu(Qu,this).getRendererType();zu(Ju,this).recycleRenderDisplay(r,e,t,zu($u,this),i)}renderFor(e){if(zu(Qu,this).isWebGPURendererType()){const t=zu(Qu,this).getRendererType(),i=zu(Ju,this).collectInUseRenderDisplays(t,e);i&&i.forEach((e=>{const t=zu(Qu,this).acquireRenderer(e.canvas,zu($u,this));zu(Zu,this).render(t,e.renderDisplays)}))}}renderWith(e){if(zu(Qu,this).isWebGPURendererType()){const t=e.getAttachedCanvas();if(t){const i=zu(Qu,this).acquireRenderer(t,zu($u,this)),r=[];r.push(e),zu(Zu,this).render(i,r)}}}getRenderDisplayMap(e){const t=zu(Qu,this).getRendererType();return zu(Ju,this).getRenderDisplayMap(t,e)}onRestoredFromContextLost(e,t,i,r,a){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return zu(Qu,this).isWebGLRendererType()||zu(Qu,this).isWebGL2RendererType()?zu(Ju,this).onRestoredFromContextLost(e,t,i,r,a,n):null}destroyUnusedVideoFrame(e){"undefined"!=typeof VideoFrame&&e instanceof VideoFrame&&zu(Qu,this).isWebGPURendererType()&&e.close()}getRendererProvider(){return zu(Qu,this)}getRenderDisplayManager(){return zu(Ju,this)}getWebGPUResMgr(){return zu($u,this)}cleanup(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];zu(Qu,this)&&zu(Qu,this).cleanup(),zu(Ju,this)&&zu(Ju,this).cleanup(e,t,zu($u,this),i),i||zu($u,this)&&zu($u,this).cleanup()}clearOffscreenCanvas(e){zu(Ju,this)&&zu(Ju,this).cleanupByCanvas(e)}};var th,ih=i(5090),rh=i(5475),ah=i(5689);!function(e){e.VB_INIT_SUCCESS="VB_INIT_SUCCESS",e.VB_INIT_FAILED="VB_INIT_FAILED",e.VB_GENERATED_FRAME="VB_GENERATED_FRAME",e.VB_SEND_FRAME="VB_SEND_FRAME",e.VB_UPDATE_BG="VB_UPDATE_BG",e.VB_PREDICT_DONE="VB_PREDICT_DONE",e.VB_MODEL_READY="VB_MODEL_READY",e.VB_FREE_MEMORY="VB_FREE_MEMORY",e.VB_VIDEO_FORMAT_UNSUPPORTED="VB_VIDEO_FORMAT_UNSUPPORTED",e.VB_WORKER_INIT="VB_WORKER_INIT",e.VB_WORKER_ERROR="VB_WORKER_ERROR",e.VB_RENDER_CANVAS="VB_RENDER_CANVAS",e.VB_RENDER_FRAME="VB_RENDER_FRAME",e.VB_START="VB_START",e.VB_REQUEST_FRAME="VB_REQUEST_FRAME",e.VB_TOGGLE_VB="VB_TOGGLE_VB",e.VB_STOP="VB_STOP",e.VB_MIRROR="VB_MIRROR",e.VB_GENERATE_STREAM="VB_GENERATE_STREAM",e.VB_STOP_STREAM="VB_STOP_STREAM",e.VB_CHANGE_STREAM_CANVAS_SIZE="VB_CHANGE_STREAM_CANVAS_SIZE",e.VB_GENERATE_FIRST_FRAME="VB_GENERATE_FIRST_FRAME",e.VB_UPDATE_STATS="VB_UPDATE_STATS",e.VB_UPDATE_NEED_FRAME="VB_UPDATE_NEED_FRAME",e.VB_UPDATE_FRAME_RATE="VB_UPDATE_FRAME_RATE",e.VB_RESOLUTION_CHANGE="VB_RESOLUTION_CHANGE"}(th||(th={}));var nh=i(7243);class sh{constructor(e,t){this.isMirror=!1,this.display=new sa(e,t,0,void 0,{preserveDrawingBuffer:!1},void 0,!1,!1)}renderFrame(e,t,i,r){if(this.display){let a={x:0,y:0,width:this.display.canvasElement.width,height:this.display.canvasElement.height};this.display.updateRemoteVideoTextures(e,t,r,i,0,!0,a,!1),this.display.drawRemoteVideo(a,this.isMirror)}}render(e){return t=this,i=void 0,a=function*(){let t=l;if("data_ptr"in e){const{data:t,format_width:i,format_height:r,valid_x:a,valid_y:n,valid_width:s,valid_height:o}=e;let d={top:n,left:a,width:s,height:o};this.display.setVideoMode(1),this.renderFrame(i,r,t,d)}else if(self.VideoFrame&&e instanceof VideoFrame){const{format:i,visibleRect:r}=e;if(i&&r){if("I420"===i||"I420A"===i)t=1;else if("NV12"===i)t=2;else{if("BGRA"!==i)return void(this.onUnsupportedFrame&&this.onUnsupportedFrame(i));t=p}const{width:a,height:n}=r,s=new Uint8Array(e.allocationSize()),o={top:0,left:0,width:a,height:n};this.display.setVideoMode(t);try{yield e.copyTo(s),this.renderFrame(a,n,s,o)}catch(e){}e.close()}}else if(e instanceof ImageData){const{width:t,height:i}=e,r={top:0,left:0,width:t,height:i};this.display.setVideoMode(l),this.renderFrame(t,i,e.data,r)}},new((r=void 0)||(r=Promise))((function(e,n){function s(e){try{d(a.next(e))}catch(e){n(e)}}function o(e){try{d(a.throw(e))}catch(e){n(e)}}function d(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(s,o)}d((a=a.apply(t,i||[])).next())}));var t,i,r,a}updateSize(e,t){this.display.canvasElement.width=e,this.display.canvasElement.height=t}setMirror(e){this.isMirror=e}}class oh{constructor(){this.timer3s=null,this.timer10s=null,this.isVBPredictDone=!1,this.inited=!1}start(){this.inited=!0,this.clear(),this.timer3s=setTimeout((()=>{this.isVBPredictDone||this.ontimeout3s()}),3e3),this.timer10s=setTimeout((()=>{this.isVBPredictDone||this.ontimeout10s()}),1e4)}clear(){clearTimeout(this.timer3s),clearTimeout(this.timer10s),this.timer3s=null,this.timer10s=null}}var dh=function(e,t,i,r){return new(i||(i=Promise))((function(a,n){function s(e){try{d(r.next(e))}catch(e){n(e)}}function o(e){try{d(r.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,o)}d((r=r.apply(e,t||[])).next())}))};class ch{constructor(e){this.isVBReady=!1,this.videoStream=null,this.isVBInitializing=!1,this.receiveTimer=null,this.msgChannel=null,this.isEnabled=!0,this.trackProcessor=null,this.isVBRunning=!1,this.frameRate=24,this.isStreamEnabled=!1,this.destoryed=!1,this._needFrame=!1,this._backend="",this.isMetadataLoaded=!1,this.isCapturing=!1,this.isReportVideoFrameError=!1;const t=e||{},{canvas:i,canvasID:r,bgImage:a,cdnPath:n}=t,s=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(i[r[a]]=e[r[a]])}return i}(t,["canvas","canvasID","bgImage","cdnPath"]);if(this.cdnPath=n||ch.cdnPath,!this.cdnPath)throw new Error("VB module: cdnPath is not provided");this.vbWorkerUrl="".concat(this.cdnPath,"/vb_worker.min.js"),this.initParam=s,this._needFrame=s.needFrame,i&&(this.cvsEle="string"==typeof i?document.querySelector("#".concat(i)):i),a&&(this.bgImage=a),this.handle_message_from_vb_worker=this.handle_message_from_vb_worker.bind(this);const o=navigator.userAgent.toLocaleLowerCase();this.isSafari=o.includes("safari")&&!o.includes("chrome")&&!o.includes("chromium"),this.vbLoadingTimer=new oh,this.handleLoadMetadata=this.handleLoadMetadata.bind(this),this.stats={fps:0,receivingFps:0,receivedFrames:0,generatedFrames:0,width:0,height:0}}set needFrame(e){this._needFrame=e,this.postMessage({cmd:th.VB_UPDATE_NEED_FRAME,payload:e})}get needFrame(){return this._needFrame}get backend(){return this._backend}set ontimeout3s(e){this.vbLoadingTimer.ontimeout3s=e}set ontimeout10s(e){this.vbLoadingTimer.ontimeout10s=e}static isSupportVB(){return dh(this,void 0,void 0,(function*(){try{const e=yield nh.A.simd();return navigator.hardwareConcurrency&&navigator.hardwareConcurrency>2&&e&&"function"==typeof OffscreenCanvas}catch(e){return!1}}))}sendCanvas(){if(this.cvsEle){const e=this.cvsEle.transferControlToOffscreen();this.postMessage({cmd:th.VB_RENDER_CANVAS,payload:e},[e])}}generateVBStream(){if(this.vbTrackGenerator){const e=this.vbTrackGenerator.writable;this.postMessage({cmd:th.VB_GENERATE_STREAM,payload:e},[e])}else if(this.streamCanvas)if(this.isSafari){const e=this.streamCanvas.transferControlToOffscreen();this.postMessage({cmd:th.VB_GENERATE_STREAM,payload:e},[e])}else this.streamRender=new sh(this.streamCanvas,ch.VB_STREAM_CANVAS),this.postMessage({cmd:th.VB_GENERATE_STREAM})}initialize(){return this.isVBReady?Promise.resolve():(this.isVBInitializing||(this.isVBInitializing=!0,this.vbLoadingTimer.isVBPredictDone=!1,this.initPromise=new Promise(((e,t)=>dh(this,void 0,void 0,(function*(){this.initReject=t,this.initResolve=e;try{const e=yield fetch(this.vbWorkerUrl);if(e.ok){const t=yield e.arrayBuffer();if(this.destoryed)return;const i=c().createObjectURL(new Blob([t]));this.worker=new Worker(i,{name:ch.VB_WORKER_NAME}),this.worker.addEventListener("message",this.handle_message_from_vb_worker),this.postMessage({cmd:th.VB_WORKER_INIT,payload:Object.assign(Object.assign({},this.initParam),{cdnPath:this.cdnPath})}),this.sendCanvas(),c().revokeObjectURL(i)}else{const{url:i,status:r}=e;this.isVBInitializing=!1,t("Fetch worker file failed. url: ".concat(i,", status: ").concat(r))}}catch(e){this.isVBInitializing=!1,t(e)}}))))),this.initPromise)}send_frame(e){this.isVBReady&&("format"in e?this.postMessage({cmd:th.VB_SEND_FRAME,payload:e},[e]):this.postMessage({cmd:th.VB_SEND_FRAME,payload:e},[e.data.buffer]))}Crop_Mask_Bg_16V9(){let e,t,i,r=0,a=16/9,n=this.bgImage.width,s=this.bgImage.height;return a*s>=n?(i=n,r=n/a,e=0,t=(s-r)/2):(i=s*a,r=s,e=(n-i)/2,t=0),{sx:e,sy:t,sw:i,sh:r}}set_background_image(e){if(this.bgImage=e,!this.isVBReady)return!1;const t=this.Crop_Mask_Bg_16V9();let i,r,a,n,s,o;i=t.sx,r=t.sy,a=t.sw,n=t.sh,a>1920?(s=1920,o=1080):(s=a,o=n),this.bgConvertCanvas||(this.bgConvertCanvas=new OffscreenCanvas(s,o)),this.bgConvertCanvas.width=s,this.bgConvertCanvas.height=o;let d=null;try{d=this.bgConvertCanvas.getContext("2d",{willReadFrequently:!0})}catch(e){}finally{d||(d=this.bgConvertCanvas.getContext("2d"))}if(!d)return!1;d.drawImage(e,i,r,a,n,0,0,this.bgConvertCanvas.width,this.bgConvertCanvas.height);let c=d.getImageData(0,0,this.bgConvertCanvas.width,this.bgConvertCanvas.height);return this.postMessage({cmd:th.VB_UPDATE_BG,payload:c}),"close"in e&&e.close(),!0}set_background_blur(){this.isVBReady&&this.postMessage({cmd:th.VB_UPDATE_BG,payload:"blur"})}handle_message_from_vb_worker(e){const{cmd:t}=e.data;switch(ch.EXTERNAL_EVENTS.has(t)&&(t!==th.VB_GENERATED_FRAME||this._needFrame)&&this.callback&&this.callback(e.data),t){case th.VB_MODEL_READY:this.vbLoadingTimer.start();break;case th.VB_PREDICT_DONE:{const{payload:t}=e.data;this.vbLoadingTimer.isVBPredictDone=!0,this.vbLoadingTimer.clear(),this._backend=t;break}case th.VB_INIT_FAILED:{const{payload:t}=e.data;this.isVBInitializing=!1,this.initReject(t);break}case th.VB_INIT_SUCCESS:this.isVBReady=!0,this.isVBInitializing=!1,this.bgImage&&this.set_background_image(this.bgImage),this.generateVBStream(),this.initResolve();break;case th.VB_REQUEST_FRAME:if(this.updateConstraints(),this.captureVideoEle&&this.isVideoPlaying(this.captureVideoEle))if(window.VideoFrame){if(this.isMetadataLoaded)try{const e=new VideoFrame(this.captureVideoEle,{timestamp:1e3*performance.now()});this.send_frame(e),e.close()}catch(e){this.callback&&!this.isReportVideoFrameError&&(this.callback({cmd:th.VB_WORKER_ERROR,payload:e}),this.isReportVideoFrameError=!0)}}else if(this.captureCtx){this.captureCtx.drawImage(this.captureVideoEle,0,0);const e=this.captureCtx.getImageData(0,0,this.captureVideoEle.videoWidth,this.captureVideoEle.videoHeight);this.streamRender&&this.isStreamEnabled&&!this.isEnabled&&this.streamRender.render(e),this.send_frame(e)}break;case th.VB_GENERATED_FRAME:{const t=e.data.payload,{data_ptr:i}=t;this.streamRender&&this.isStreamEnabled&&this.streamRender.render(t),i&&this.freeMemory(i);break}case th.VB_UPDATE_STATS:this.stats=e.data.payload;break;case th.VB_RESOLUTION_CHANGE:{const{width:t,height:i}=e.data.payload;this.stats.width=t,this.stats.height=i}}}onMessage(e){this.callback=e}createCaptureEle(){window.MediaStreamTrackProcessor||(this.captureVideoEle=document.querySelector("#".concat(ch.VB_CAPTURE_VIDEO)),this.captureVideoEle||(this.captureVideoEle=document.createElement("video"),this.captureVideoEle.autoplay=!0,this.captureVideoEle.playsInline=!0,this.captureVideoEle.id=ch.VB_CAPTURE_VIDEO,this.captureVideoEle.style.position="fixed",this.captureVideoEle.style.width="1px",this.captureVideoEle.style.height="1px",this.captureVideoEle.style.bottom="0px",this.captureVideoEle.style.right="0px",this.captureVideoEle.muted=!0,document.body.appendChild(this.captureVideoEle)),this.captureCanvas||window.VideoFrame||(this.captureCanvas=document.createElement("canvas"),this.captureCtx=this.captureCanvas.getContext("2d")))}isVideoPlaying(e){return(e.paused||e.ended)&&e.play(),e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2}postMessage(e,t){var i,r;t?null===(i=this.worker)||void 0===i||i.postMessage(e,t):null===(r=this.worker)||void 0===r||r.postMessage(e)}updateStreamCanvasSize(e,t){this.streamCanvas&&(this.isSafari?this.postMessage({cmd:th.VB_CHANGE_STREAM_CANVAS_SIZE,payload:{width:e,height:t}}):(this.streamCanvas.width=e,this.streamCanvas.height=t))}updateConstraints(){const e=this.videoStream.getVideoTracks()[0],{width:t,height:i,frameRate:r}=e.getSettings();t&&i&&(!this.streamCanvas||t===this.streamCanvas.width&&i===this.streamCanvas.height||this.updateStreamCanvasSize(t,i),this.captureCanvas&&(t!==this.captureCanvas.width&&(this.captureCanvas.width=t),i!==this.captureCanvas.height&&(this.captureCanvas.height=i))),r&&this.frameRate!=Math.min(r,24)&&(this.frameRate=Math.min(r,24),this.postMessage({cmd:th.VB_UPDATE_FRAME_RATE,payload:this.frameRate}))}captureVideo(e){return dh(this,void 0,void 0,(function*(){if(this.isVBReady||this.isVBInitializing?this.isVBInitializing&&(yield this.initPromise):yield this.initialize(),this.isCapturing)return Promise.reject("Capture is already started");let t=!0;if("id"in e){if(!e.active)return Promise.reject("stream is not active");this.videoStream&&this.videoStream.id===e.id?t=!1:(this.stopCapture(),this.videoStream=e)}else if(this.videoStream&&this.captureConf===e)t=!1;else{this.stopCapture(),this.isCapturing=!0;try{this.videoStream=yield navigator.mediaDevices.getUserMedia(Object.assign(Object.assign({},e),{audio:!1})),this.captureConf=e,this.isCapturing=!1}catch(e){return this.isCapturing=!1,Promise.reject(e)}}if(this.createCaptureEle(),t){let e;if(!(e=this.videoStream.getVideoTracks()[0]))return Promise.reject("No video track in stream");{const t=e.getSettings(),{width:i=0,height:r=0,frameRate:a=24}=t;if(this.updateStreamCanvasSize(i,r),this.frameRate=Math.min(a,24),window.MediaStreamTrackProcessor){this.trackProcessor=new window.MediaStreamTrackProcessor({track:e});const t=this.trackProcessor.readable;this.postMessage({cmd:th.VB_START,payload:{videoStream:t,frameRate:this.frameRate}},[t])}else this.captureVideoEle&&(this.isMetadataLoaded=!1,this.captureVideoEle.addEventListener("loadedmetadata",this.handleLoadMetadata),this.captureVideoEle.srcObject=this.videoStream,this.captureVideoEle.play(),this.captureCanvas&&(this.captureCanvas.width=i,this.captureCanvas.height=r),this.postMessage({cmd:th.VB_START,payload:{frameRate:this.frameRate}}))}}else{if(this.isVBRunning)return;this.videoStream.getVideoTracks()[0].enabled=!0,this.captureVideoEle&&this.captureVideoEle.play(),this.postMessage({cmd:th.VB_START})}this.isVBRunning=!0}))}stopCapture(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.postMessage({cmd:th.VB_STOP,payload:e}),this.captureVideoEle&&this.captureVideoEle.pause(),this.videoStream&&e&&(this.videoStream.getTracks().forEach((e=>{e.stop()})),this.videoStream=null),this.isVBRunning=!1}setMirror(e){this.postMessage({cmd:th.VB_MIRROR,payload:e})}freeMemory(e){this.isVBReady&&this.postMessage({cmd:th.VB_FREE_MEMORY,payload:e})}startReceiveMode(e){return e&&(this.captureConf=e),this.msgChannel||(this.msgChannel=new MessageChannel,this.msgChannel.port1.onmessage=e=>{var t;const{type:i,frame:r}=e.data;this.receiveTimer&&clearTimeout(this.receiveTimer),i===u.Abc&&r?(null===(t=this.msgChannel)||void 0===t||t.port1.postMessage({type:u.wb7}),this.isEnabled?(this.isVBRunning&&this.stopCapture(),this.renderFrame(r)):r.close(),this.isSafari||(this.receiveTimer=setTimeout((()=>{this.captureConf&&!this.isVBRunning&&this.captureVideo(this.captureConf)}),1e3))):i!==u.L_m&&i!==u.lLs||(this.captureConf&&!this.isVBRunning&&this.captureVideo(this.captureConf),i===u.lLs&&this.msgChannel&&(this.msgChannel.port1.onmessage=null,this.msgChannel=null))}),this.msgChannel.port2}enable(){this.postMessage({cmd:th.VB_TOGGLE_VB,payload:!0}),this.isEnabled=!0}disable(){this.postMessage({cmd:th.VB_TOGGLE_VB,payload:!1}),this.isEnabled=!1,!this.isVBRunning&&this.msgChannel&&this.captureConf&&(this.captureVideo(this.captureConf).catch((e=>{})),clearTimeout(this.receiveTimer))}renderFrame(e){return dh(this,void 0,void 0,(function*(){this.postMessage({cmd:th.VB_RENDER_FRAME,payload:e}),"close"in e&&e.close()}))}destory(){this.destoryed=!0,this.stopCapture(),this.vbLoadingTimer.clear(),this.msgChannel&&(this.msgChannel.port2.onmessage=null),this.captureVideoEle&&document.body.removeChild(this.captureVideoEle),this.worker&&(this.worker.removeEventListener("message",this.handle_message_from_vb_worker),this.worker.terminate())}createStream(){if(this.isStreamEnabled=!0,this.vbStream)return this.postMessage({cmd:th.VB_GENERATE_STREAM}),this.vbStream;if(window.MediaStreamTrackGenerator)this.vbTrackGenerator=new MediaStreamTrackGenerator({kind:"video"}),this.vbStream=new MediaStream([this.vbTrackGenerator]);else{if(this.streamCanvas=document.createElement("canvas"),this.videoStream){const e=this.videoStream.getVideoTracks()[0];if(e){const{width:t=0,height:i=0}=e.getSettings();this.streamCanvas.width=t,this.streamCanvas.height=i}}this.vbStream=this.streamCanvas.captureStream(24)}const e=this.vbStream.getVideoTracks()[0];return e&&(e.getStats=()=>this.stats),this.isVBReady&&this.generateVBStream(),this.vbStream}stopStream(){this.vbStream&&(this.isStreamEnabled=!1,this.postMessage({cmd:th.VB_STOP_STREAM}))}handleLoadMetadata(){this.isMetadataLoaded=!0,this.captureVideoEle.removeEventListener("loadedmetadata",this.handleLoadMetadata)}}ch.VB_WORKER_NAME="vb_worker",ch.VB_CAPTURE_VIDEO="VB_CAPTURE_VIDEO",ch.VB_STREAM_CANVAS="VB_STREAM_CANVAS",ch.EXTERNAL_EVENTS=new Set([th.VB_GENERATED_FRAME,th.VB_INIT_FAILED,th.VB_INIT_SUCCESS,th.VB_MODEL_READY,th.VB_PREDICT_DONE,th.VB_VIDEO_FORMAT_UNSUPPORTED,th.VB_WORKER_ERROR,th.VB_GENERATE_FIRST_FRAME,th.VB_RESOLUTION_CHANGE]);const uh=ch;if(document){const e=document.currentScript;if(e){const t=e.src;if(t){let e=t.indexOf("/vb.min.js");-1!==e&&(ch.cdnPath=t.substring(0,e))}}}var hh,lh,ph,fh=i(3404);function gh(e){if(!(0,F.Yu)()||!J.A.enableTransferDataChannel||!e)return null;if("undefined"!=typeof DedicatedWorkerGlobalScope)return null;let t=Pe.dataTransportMgr;return null==t.mediadatachannel.netthreadworker&&(t.mediadatachannel.netthreadworker=mr(e,"net"),H.Ay.directReport("transferdatachannel supported")),t.mediadatachannel.netthreadworker}!function(e){e.ADD_VIDEO_PORT="add_video_port",e.ADD_SHADOW_PORT="add_shadow_port",e.ADD_VIDEO_PROCESSOR="add_video_processor",e.PROCESSOR_READY="processor_ready",e.PROCESSOR_ERROR="processor_error"}(hh||(hh={})),function(e){e.INIT_PROCESSOR="init_processor",e.UNINIT_PROCESSOR="uninit_processor",e.INIT_OUTPUT_CANVAS="init_output_canvas",e.OUTPUT_WRITABLE_STREAM="output_writable_stream",e.INPUT_READABLE_STREAM="input_readable_stream",e.FRAME_DATA="frame_data",e.START_REQUEST_FRAME="start_request_frame",e.STOP_REQUEST_FRAME="stop_request_frame",e.REQUEST_FRAME="request_frame",e.FRAME_CALLBACK="frame_callback",e.RESOLUTION_CHANGE="RESOLUTION_CHANGE",e.PROCESSOR_WORKER_ERROR="PROCESSOR_WORKER_ERROR"}(lh||(lh={})),ph||(ph={});class mh{constructor(e,t,i){this.port=e,this.name=t,this.VideoFrameNeeded=i}setStream(e){const t=e.getVideoTracks()[0],i=t.getSettings(),{frameRate:r=24}=i;this.trackProcessor=new MediaStreamTrackProcessor({track:t});const a=this.trackProcessor.readable;this.port.postMessage({cmd:lh.INPUT_READABLE_STREAM,frameRate:Math.min(r,24),readableStream:a,processorName:this.name},[a]),this.port.postMessage({cmd:lh.START_REQUEST_FRAME,frameRate:r,processorName:this.name,VideoFrameNeeded:this.VideoFrameNeeded})}removeStream(){this.port.postMessage({cmd:lh.STOP_REQUEST_FRAME,processorName:this.name})}}class vh{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.port=e,this.name=t,this.isIOSDevice=i,this.VideoFrameNeeded=r,this.onMessage=e=>{if(e.data.cmd===lh.REQUEST_FRAME&&this.captureVideoEleLoaded){let e=this.captureVideoEle.videoWidth,t=this.captureVideoEle.videoHeight;if(e<=0||t<=0)return;this.isIOSDevice&&(this.captureCanvasEle.width=e,this.captureCanvasEle.height=t,this.captureCanvasEleCtx.drawImage(this.captureVideoEle,0,0,e,t));const i=new VideoFrame(this.isIOSDevice?this.captureCanvasEle:this.captureVideoEle,{timestamp:1e3*performance.now()});this.port.postMessage({cmd:lh.FRAME_DATA,frame:i,processorName:this.name}),i.close()}},this.port.addEventListener("message",this.onMessage)}createCaptureVideoElement(e){this.captureVideoEle=document.querySelector("#video-processor-video"),this.captureVideoEle||(this.captureVideoEle=document.createElement("video"),this.captureVideoEle.autoplay=!0,this.captureVideoEle.playsInline=!0,this.captureVideoEle.id="video-processor-video",this.captureVideoEle.style.position="fixed",this.captureVideoEle.style.width="1px",this.captureVideoEle.style.height="1px",this.captureVideoEle.style.bottom="0px",this.captureVideoEle.style.right="0px",this.captureVideoEle.muted=!0,document.body.appendChild(this.captureVideoEle)),this.isIOSDevice&&!this.captureCanvasEle&&(this.captureCanvasEle=document.createElement("canvas"),this.captureCanvasEleCtx=this.captureCanvasEle.getContext("2d")),this.captureVideoEle.srcObject=e,this.captureVideoEle.addEventListener("loadedmetadata",(()=>{this.captureVideoEleLoaded=!0})),this.captureVideoEle.play()}setStream(e){const t=e.getVideoTracks()[0].getSettings(),{frameRate:i=24}=t;this.createCaptureVideoElement(e),this.port.postMessage({cmd:lh.START_REQUEST_FRAME,frameRate:Math.min(i,24),processorName:this.name,VideoFrameNeeded:this.VideoFrameNeeded})}removeStream(){this.port.postMessage({cmd:lh.STOP_REQUEST_FRAME,processorName:this.name})}destroy(){this.port.removeEventListener("message",this.onMessage)}}class Ah{constructor(e,t){this.trackGenerator=new MediaStreamTrackGenerator({kind:"video"});const i=this.trackGenerator.writable;e.postMessage({cmd:lh.OUTPUT_WRITABLE_STREAM,writableStream:i,processorName:t},[i]),this.stream=new MediaStream([this.trackGenerator])}getStream(){return this.stream}}class Sh{constructor(e,t){this.canvas=document.createElement("canvas"),this.canvas.width=1,this.canvas.height=1,this.offScreenCanvas=this.canvas.transferControlToOffscreen(),this.stream=this.canvas.captureStream(24)}getOutputCanvas(){return this.offScreenCanvas}getStream(){return this.stream}}class _h{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.processorName=e,this.port=t,this.isIOSDevice=i,this.VideoFrameNeeded=r,this.frameCallback=null,this.callback=null,this.onMessage=e=>{var t,i;e.data.cmd===lh.FRAME_CALLBACK?null===(t=this.frameCallback)||void 0===t||t.call(this,e.data.frame):null===(i=this.callback)||void 0===i||i.call(this,e.data.cmd,e.data.data)},this.port.start(),this.port.addEventListener("message",this.onMessage);const a=this.getOutPutCanvas();a?this.port.postMessage({cmd:lh.INIT_OUTPUT_CANVAS,canvas:a,processorName:e},[a]):this.port.postMessage({cmd:lh.INIT_OUTPUT_CANVAS,processorName:e})}init(){this.port.postMessage({cmd:lh.INIT_PROCESSOR,processorName:this.processorName})}addCallback(e){this.callback=e}removeCallback(){this.callback=null}uninit(){this.port.postMessage({cmd:lh.UNINIT_PROCESSOR,processorName:this.processorName}),this.port.removeEventListener("message",this.onMessage)}getOutPutCanvas(){return null}getStream(){throw new Error("Method not implemented.")}setStream(e){throw new Error("Method not implemented.")}removeStream(){}onFrame(e){throw new Error("Method not implemented.")}addFrameCallback(e){throw new Error("Method not implemented.")}removeFrameCallback(){}}class yh extends _h{constructor(e,t){super(e,t),this.processorName=e,this.port=t}onFrame(e){this.port.postMessage({cmd:lh.FRAME_DATA,frame:e,processorName:this.processorName})}addFrameCallback(e){this.frameCallback=e}removeFrameCallback(){this.frameCallback=null}}class Ch extends yh{constructor(e,t){super(e,t),this.processorName=e,this.port=t}onFrame(e){}}class bh extends _h{constructor(e,t,i,r){super(e,t,i,r),this.processorName=e,this.port=t,this.isIOSDevice=i,this.VideoFrameNeeded=r,this.initGenerator()}initGenerator(){this.originGenerator||(this.originGenerator="function"==typeof MediaStreamTrackProcessor?new mh(this.port,this.processorName,this.VideoFrameNeeded):new vh(this.port,this.processorName,this.isIOSDevice,this.VideoFrameNeeded)),this.targetGenerator||(this.targetGenerator="function"==typeof MediaStreamTrackGenerator?new Ah(this.port,this.processorName):new Sh(this.port,this.processorName))}uninit(){var e,t,i,r;null===(t=null===(e=this.originGenerator)||void 0===e?void 0:e.destroy)||void 0===t||t.call(e),null===(r=null===(i=this.targetGenerator)||void 0===i?void 0:i.destroy)||void 0===r||r.call(i),super.uninit()}getOutPutCanvas(){var e,t;return this.initGenerator(),null===(t=(e=this.targetGenerator).getOutputCanvas)||void 0===t?void 0:t.call(e)}getStream(){return this.targetGenerator.getStream()}setStream(e){this.originGenerator.setStream(e)}removeStream(){this.originGenerator.removeStream()}addFrameCallback(e){this.frameCallback=e}}class wh{static hasProcessor(){return this.videoProcessorAgentMap.size>0}static hasMediaStreamFrameProcessor(){return[...this.videoProcessorAgentMap.values()].some((e=>e instanceof bh))}static addFrameCallback(e,t){this.frameCallbackMap.set(e,t),this.getProcessor(e)&&this.getProcessor(e).addFrameCallback(t)}static addCallback(e,t){this.callbackMap.set(e,t),this.getProcessor(e)&&this.getProcessor(e).addCallback(t)}static onFrame(e){for(const t of this.videoProcessorAgentMap.values())t.onFrame(e)}static getStream(){return[...this.videoProcessorAgentMap.values()].pop().getStream()}static setStream(e){for(const t of this.videoProcessorAgentMap.values())t.setStream(e)}static removeStream(){for(const e of this.videoProcessorAgentMap.values())e.removeStream()}static getProcessor(e){return this.videoProcessorAgentMap.get(e)}static startProcessor(e,t){t.init();const i=this.frameCallbackMap.get(e);i&&t.addFrameCallback(i);const r=this.callbackMap.get(e);r&&t.addCallback(r),this.videoProcessorAgentMap.set(e,t)}static stopProcessor(e){const t=this.getProcessor(e);t&&(t.removeFrameCallback(),t.removeCallback(),this.frameCallbackMap.delete(e),this.callbackMap.delete(e),t.removeStream(),t.uninit()),this.videoProcessorAgentMap.delete(e)}static resetProcessorManager(){for(const e of this.videoProcessorAgentMap.keys())this.stopProcessor(e)}}wh.videoProcessorAgentMap=new Map,wh.frameCallbackMap=new Map,wh.callbackMap=new Map;class Eh{static checkCaptureNeedDeviceFallback(e,t){return!(!F.Ay.isMobileForceAutoChooseAudioDeviceEnable()||!e||!e.audioSource||"NotAllowedError"!=t.name||"No AVAudioSessionCaptureDevice device"!=t.message||(e.audioSource=null,0))}static draftAudioConstraints(e){var t,i,r;let a=e.audioCapture?{audioSource:e.audioCapture?e.audioCapture.AudioSelectValue:null,enableOriginalSound:"originalSound"===(null===(t=e.audioCapture)||void 0===t||null===(t=t.audioProfile)||void 0===t?void 0:t.currentSelect),enableStereo:"originalSound"===(null===(i=e.audioCapture)||void 0===i||null===(i=i.audioProfile)||void 0===i?void 0:i.currentSelect)&&(null===(r=e.audioCapture)||void 0===r||null===(r=r.audioProfile)||void 0===r||null===(r=r.originalSound)||void 0===r?void 0:r.stereo),isSupportBrowserAec:e.isSupportBrowserAec,disableAudioAGC:e.disableAudioAGC,disableNoiseSuppression:e.disableNoiseSuppression}:null,n=this.checkForceChangeMicDeviceIdRequired();return n&&(a||(a={}),a.audioSource=n.deviceId),a}static checkForceChangeMicDeviceIdRequired(){if(!F.Ay.isMobileForceAutoChooseAudioDeviceEnable())return null;if(F.Ay.isIphoneBrowser()){const e=Va.getDeviceListFromCache().filter((e=>"audioinput"==e.kind));return e.length>1?{deviceId:e.filter((e=>!e.label.match(/iPhone/))).pop().deviceId}:{deviceId:void 0}}return F.Ay.isAndroidBrowser()?{deviceId:void 0}:null}static isMobileNeedRecaptureAfterDeviceChange(e,t,i){if(F.Ay.isMobileForceAutoChooseAudioDeviceEnable()){if(F.Ay.isAndroidBrowser()&&t.filter((e=>"audioinput"==e.kind)).length!=i.filter((e=>"audioinput"==e.kind)).length)return{result:!0,reason:"android recapture"};if(F.Ay.isIphoneBrowser()){if(!this.isCaptureHealthy(e.getMediaStreamController()))return{result:!0,reason:"capture not healthy"};if(t.filter((e=>"audioinput"==e.kind&&""==e.label)).length)return{result:!0,reason:"permission grant"};if(t.filter((e=>"audioinput"==e.kind)).length>i.filter((e=>"audioinput"==e.kind)).length)return{result:!0,reason:"device disconnect"}}}return{result:!1}}static isCaptureHealthy(e){let t=e.getAudioStream();if(t){let e=t.getAudioTracks();if(e.length&&"live"==e[0].readyState&&0==e[0].muted)return!0}return!1}static async isSelectedDeviceExistAsync(){let e=!1;return(await Va.getDeviceListAsync()).forEach((t=>{var i;"audioinput"==t.kind&&(null===(i=t.label)||void 0===i||null===(i=i.replace(/\(\w+:\w+\)|,/gi,""))||void 0===i?void 0:Ra()(i).call(i))==Va.getMicLabel()&&t.deviceId==Va.getMicId()&&(e=!0)})),e}}async function Rh(e,t){let i=e;if(i.audioCapture&&t){i.enableHID&&(i.hidAvalible&&(await za.destroy(),i.hidAvalible=!1),t.microphoneLabel&&(i.hidAvalible=await za.init(t.microphoneLabel,t.defaultMuted))),i.getMediaStreamController().destoryAudioMediaStream(),Ii({command:132,value:!1});try{i.isCaputureNodeConnect=!1,J.A.ComputerAudioStatus=Q.BX.ComputerAudio_Connecting,t.audioProfile=i.audioCapture.audioProfile,i.audioCapture=t,i.audioCtx&&i.audioCtx.sampleRate!=i.sampleRate&&(i.sampleRate=i.audioCtx.sampleRate,ui(i.sampleRate)),i.Start_Audio_Capture(),Vi(),i.audioMicSetErrorCnt=0}catch(e){i.notifyUISetMicError({currentMic:Va.getMicId(),reason:"".concat(e.message)}),i.JsMediaSDK_Log(e)}}}const Th=1e3,Ih=["video"];var Mh;function Dh(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function Ph(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Dh(Object(i),!0).forEach((function(t){(0,o.A)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Dh(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const kh=null===(Mh=document.currentScript)||void 0===Mh?void 0:Mh.src,Oh=new class{constructor(){this._isReuseStreamEnabled=!1,this._isStreamInReuseMap=new Map,this.presetedConstraints={audioConstraints:null,videoConstraints:null,audioTimer:null,videoTimer:null},this._deprecatedStream={audio:[],video:[]},this._captureVideoDeferred=null,this.audioConstraints=null,this.audioStream=null,this.isCaptureAudioInProgress=!1,this.audioCaptureElapsedTime=0,this.videoConstraints=null,this.videoStream=null,this.videoStreamTrack=null,this.captureVideoTimer=null,this.checkVideoStreamActiveTimer=null,this.isCaptureVideoInProgress=!1,this.isCapturingAudioFromDefault=!1,this.currentVideoResolution={width:0,height:0},this.streamProcessAbility={isSupportMediaStreamTrackProcessor:F.Ay.isSupportMediaStreamTrackProcessor()},this.mediaStreamTrackProcessor=null,this.reableStream=null,this.isAppleGraphic=!1,this.isSupportFullHD=!1,this.facingMode=-1,this.VBMFlag=!1,this.audioBridge=null,this.webrtcFlag=!1,this.vbStream=null,this.vb=null,this.isVBEnabled=!1,this.updateVideoStream=null,this.isCaptureAudioFromFile=!1,this.blockUpgradeCapture={},this.videoCaptureSuccessHandler=null,this.videoCaptureFailedHandler=null,this.receivedVideoConstraints=null,this.onVBResolutionChange=null}enableReuseStream(e){this._isReuseStreamEnabled=!!e}_updateStreamInReuse(e,t){t?this._isStreamInReuseMap.set(e,!0):this._isStreamInReuseMap.delete(e)}_isStreamInReuse(e){return!!this._isStreamInReuseMap.get(e)}presetConstraints(e){let{audioConstraints:t,videoConstraints:i}=e;t&&(this.presetedConstraints.audioConstraints=this._getAudioConstraints(t)),i&&(this.presetedConstraints.videoConstraints=this._getVideoConstraints(i))}_clearPresetConstraints(){this.presetedConstraints.audioConstraints=null,this.presetedConstraints.videoConstraints=null}_getPresetAudioConstraints(){const{audioConstraints:e}=this.presetedConstraints;return this._clearPresetConstraints(),!(!e||this.audioStream||this.isCaptureAudioInProgress)&&e}_getPresetVideoConstraints(){const{videoConstraints:e}=this.presetedConstraints;return this._clearPresetConstraints(),!(!e||this.videoStream||this.isCaptureVideoInProgress)&&e}_pushDeprecatedStream(){let{audioStream:e,videoStream:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e&&this._deprecatedStream.audio.push(e),t&&this._deprecatedStream.video.push(t)}_destoryDeprecatedStream(){let{audio:e,video:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e&&(this._deprecatedStream.audio.forEach((e=>{try{this._destoryStream(e)}catch(e){H.Ay.error("Error when destroying deprecated audio stream",e)}})),this._deprecatedStream.audio=[]),t&&(this._deprecatedStream.video.forEach((e=>{try{this._destoryStream(e)}catch(e){H.Ay.error("Error when destroying deprecated video stream",e)}})),this._deprecatedStream.video=[])}setStreamProcessAbility(e){let{isSupportMediaStreamTrackProcessor:t}=e;this.streamProcessAbility=Ph(Ph({},this.streamProcessAbility),void 0!==t?{isSupportMediaStreamTrackProcessor:t}:{})}_isFileInputAudioSource(e){return e&&(e.audio instanceof HTMLVideoElement||e.audio instanceof HTMLAudioElement)}_getAudioConstraints(e){let{audioSource:t,isSupportBrowserAec:i,disableAudioAGC:r,disableNoiseSuppression:a,enableOriginalSound:n,enableStereo:s}=e;if(t instanceof HTMLVideoElement||t instanceof HTMLAudioElement)return{audio:t};let o=!1,d=F.Ay.getOSInfo();return o=i?{deviceId:t?{exact:t}:F.Ay.browser.isChrome&&"OpenHarmony"!=d.os?{exact:"default"}:void 0,autoGainControl:!r&&!n,noiseSuppression:!a&&!n,latency:0,echoCancellation:!s,channelCount:2,sampleRate:48e3}:{deviceId:t?{exact:t}:F.Ay.browser.isChrome&&"OpenHarmony"!=d.os?{exact:"default"}:void 0,autoGainControl:!r&&!n,noiseSuppression:!a&&!n,latency:0,echoCancellation:i&&!s,channelCount:2,sampleRate:48e3},o}_isSameAudioConstraintsAsPrev(e){return!(this._isFileInputAudioSource(e)||!this.audioConstraints||!(0,F.bD)(this.audioConstraints,e)||!this.audioStream||!this._isStreamHasAudio(this.audioStream))}_destoryStream(e){let{audioOnly:t,videoOnly:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&!F.Ay.audioToMediaStreamMananger.isAudioFileStream(e)){let r=[];r=t?e.getAudioTracks():i?e.getVideoTracks():e.getTracks(),r.forEach((e=>{e.stop()}))}}_isStreamHasAudio(e){const t=e.getAudioTracks();return t&&t.length>0}_isStreamHasVideo(e){const t=e.getVideoTracks();return t&&t.length>0}destoryAudioMediaStream(){this.audioStream?(this._isFileInputAudioSource(this.audioConstraints)&&F.Ay.audioToMediaStreamMananger.stopCapture(),this._isReuseStreamEnabled?this._updateStreamInReuse(this.audioStream,!0):(this._updateStreamInReuse(this.audioStream,!1),this._destoryStream(this.audioStream),this.audioStream=null,this.audioConstraints=null,this.audioCaptureElapsedTime=0,this._destoryDeprecatedStream({audio:!0}))):this._destoryDeprecatedStream({audio:!0}),this.enableReuseStream(!1)}shouldCaptureAudio(){return!this.audioStream||this._isStreamInReuse(this.audioStream)}muteUnmuteAudioMediaStream(e){this.audioStream&&(this.audioStream.getAudioTracks()||[]).forEach((t=>{t.enabled=!e}))}_storeAudioStream(e,t,i){e&&(xh("audio stream is ok"),this.destoryAudioMediaStream(),this.audioStream=e,this.audioConstraints=t,i&&this._setPresetAudioStreamAutoStopTimer())}_setPresetAudioStreamAutoStopTimer(){this._clearPresetAudioStreamAutoStopTimer(),this.presetedConstraints.audioTimer=setTimeout((()=>{this.destoryAudioMediaStream()}),1e4)}_clearPresetAudioStreamAutoStopTimer(){this.presetedConstraints.audioTimer&&(clearTimeout(this.presetedConstraints.audioTimer),this.presetedConstraints.audioTimer=null)}addAudioTrackSettingsMonitor(e,t){const i=null==e?void 0:e.getSettings();Y.A.add_monitor(t+":"+(null==i?void 0:i.channelCount)+":"+(null==i?void 0:i.echoCancellation)+":"+(null==i?void 0:i.autoGainControl)+":"+(null==i?void 0:i.noiseSuppression))}_handleAudioCaptureSuccess(e,t,i,r){this._clearPresetAudioStreamAutoStopTimer(),r||this._storeAudioStream(e,t),this._updateStreamInReuse(e,!1);let a=e.getAudioTracks()[0];a?(Y.A.add_monitor("ATRS:"+a.readyState+":"+a.id),Y.A.add_monitor("ATMS:"+a.muted+":"+a.id),this.addAudioTrackSettingsMonitor(a,"NormalAudioCapture"),a.onended=async()=>{if(!await Va.hasPermission("microphone"))return Y.A.add_monitor("ATRS:"+a.readyState+":"+a.id+":-R"),void(0,We.iK)(u.UyE,We.pg.PERMISSION_RESET);await Eh.isSelectedDeviceExistAsync()?((0,We.iK)(u.UyE,We.pg.EXCEPTION),Y.A.add_monitor("ATRS:"+a.readyState+":"+a.id+":-L")):Y.A.add_monitor("ATRS:"+a.readyState+":"+a.id+":-I")},a.muted?(J.A.Notify_APPUI_SAFE(u.qRr,!0),this.audioBridge&&(this.audioBridge.isMutedBySystem=!0)):(J.A.Notify_APPUI_SAFE(u.FjO),this.audioBridge&&(this.audioBridge.isMutedBySystem=!1)),a.onmute=()=>{Y.A.add_monitor("ATMS:"+a.muted+":"+a.id);const e=this.audioStream.getAudioTracks()[0];e&&e.id===a.id&&(this.audioBridge&&(this.audioBridge.isMutedBySystem=!0),J.A.Notify_APPUI_SAFE(u.qRr,I))},a.onunmute=()=>{Y.A.add_monitor("ATMS:"+a.muted+":"+a.id);const e=this.audioStream.getAudioTracks()[0];e&&e.id===a.id&&(this.audioBridge&&(this.audioBridge.muted||this.audioBridge.unmute(),this.audioBridge.isMutedBySystem=!1),J.A.Notify_APPUI_SAFE(u.FjO))}):Y.A.add_monitor("TN"),i(e)}_genAudioStream(e){try{const t=e.getAudioTracks();return 0===t.length?null:new MediaStream(t)}catch(t){return H.Ay.warn("_genAudioStream",t),this._destoryStream(e,{videoOnly:!0}),e}}_genVideoStream(e){try{const t=e.getVideoTracks();return 0===t.length?null:new MediaStream(t)}catch(t){return H.Ay.warn("_genVideoStream",t),this._destoryStream(e,{audioOnly:!0}),e}}_splitAudioStream(e,t,i,r){const{audio:a,video:n}=t;if(n&&this._isStreamHasVideo(e)){const t=this._genAudioStream(e),s=this._genVideoStream(e);return t?this._handleAudioCaptureSuccess(t,a,i):r(new Error("audio stream do not contains audio track ")),void(s&&(this.videoStream?this._pushDeprecatedStream({videoStream:s}):(this._updateStreamInReuse(s,!0),this._storeVideoStream(s,n,!0))))}this._handleAudioCaptureSuccess(e,a,i)}async _captureFileInputAudioStream(e){const{audio:t}=e;try{if(!await new Promise(((e,i)=>{t.currentTime>0&&!t.paused&&!t.ended&&e(!0);const r=()=>{e(!0),t.removeEventListener("timeupdate",r)};t.addEventListener("timeupdate",r),setTimeout((()=>i(!1)),1e4)})))throw new Error("audio file playing failed");return F.Ay.audioToMediaStreamMananger.startCapture(t)}catch(e){console.error(e);const t=new Error("capture stream from file input souce failed");throw t.name="FileInputSouceError",t}}async startCaptureAudio(e){var t,i;let{audioConstraints:r,successHandler:a,errorHandler:n}=e;this.enableReuseStream(!1);const s=!!r&&this._getAudioConstraints(r),o=this._isFileInputAudioSource(s);this.isCaptureAudioFromFile=o;const d=this._isSameAudioConstraintsAsPrev(s),c=this._getPresetVideoConstraints();if(this._clearPresetAudioStreamAutoStopTimer(),d)return this.audioCaptureElapsedTime=-2,void this._handleAudioCaptureSuccess(this.audioStream,s,a,!0);const u={audio:s,video:o?null:c};this.isCaptureAudioInProgress=!0;let h=Date.now();F.Ay.isIphoneOrIpadSafari()&&(this._captureVideoDeferred&&await this._captureVideoDeferred.promise,this._captureVideoDeferred=new F.cY),this.destoryAudioMediaStream(),Y.A.add_monitor("RGUMA"),document.removeEventListener("visibilitychange",Vh),this.isCapturingAudioFromDefault="default"===(null==u||null===(t=u.audio)||void 0===t?void 0:t.deviceId)||!(null!=u&&null!==(i=u.audio)&&void 0!==i&&i.deviceId),(o?this._captureFileInputAudioStream(s):navigator.mediaDevices.getUserMedia(u)).then((e=>{if(J.A.ComputerAudioStatus===Q.BX.ComputerAudio_Null)return H.Ay.log("getUserMedia successfully but UI has called leave audio"),void e.getAudioTracks().forEach((e=>{e.stop()}));this.audioCaptureElapsedTime=Date.now()-h,this._splitAudioStream(e,u,a,n)})).catch((e=>{J.A.ComputerAudioStatus!==Q.BX.ComputerAudio_Null?(o||Va.updateSelectedMicDevices(s.deviceId&&s.deviceId.exact||"default","getUsermedia failed",Date.now()-h,!1),n(e)):H.Ay.log("getUserMedia failed but UI has called leave audio")})).finally((()=>{this.isCaptureAudioInProgress=!1,this._captureVideoDeferred&&this._captureVideoDeferred.resolve()}))}_isFileInputVideoSource(e){return e&&e.video instanceof HTMLVideoElement}isUsingFileInputVideoSource(){return this._isFileInputVideoSource(this.videoConstraints)}_getFileInputSourceSize(e,t){const i=[90,180,360,720];return t||(t=360),t>720&&(t=720),t<90&&(t=90),-1===i.indexOf(t)&&i.some(((e,r)=>e>t&&(t=(e+i[r-1])/2<t?e:i[r-1],!0))),{width:16/9*t,height:t}}_getVideoConstraints(e){let{videoSource:t,usingFacingMode:i,width:r,height:a,pan:n,tilt:s,zoom:o,fps:d}=e;if(t instanceof HTMLVideoElement)return Ph({video:t},r&&a?this._getFileInputSourceSize(r,a):{});let c=!1,u=d||24;u>30&&(u=30),u<1&&(u=24),navigator.hardwareConcurrency&&navigator.hardwareConcurrency<4&&u>10&&(u=10);const h=u;if(i)c=["user","environment","left","right"].includes(t)?{facingMode:{exact:t}}:!t||{deviceId:{exact:t}};else{const{width:e,height:i}=this.currentVideoResolution,d=0!=e&&0!=i;let u=d?e:r||640,l=d?i:a||360;(u>=1920&&!F.Ay.get1080pcapacity()||this.webrtcFlag&&u>=1280)&&(u=1280,l=720),c={width:{min:u,ideal:u},height:{min:l,ideal:l},deviceId:t?{exact:t}:void 0,frameRate:h,pan:n,tilt:s,zoom:o}}return c}_getVideoIdealWidthHeight(e){let{videoSource:t,usingFacingMode:i,width:r,height:a}=e;const n=[[1280,720],[640,360],[320,180]];if(t instanceof HTMLVideoElement)return!0;if(i)return!0;{const{width:e,height:t}=this.currentVideoResolution||{},i=0!=e&&0!=t;let s=i?e:r||640,o=i?t:a||360,d=n.find((e=>320==e[0]||e[0]<s));return s=d[0],o=d[1],{width:{ideal:s},height:{ideal:o}}}}_updateVideoConstraints(e){return this.videoStreamTrack?this.videoStreamTrack.applyConstraints(e).catch((t=>{const{readyState:i}=this.videoStreamTrack;if(H.Ay.error("Applying video constraints failed "+i+JSON.stringify(e),t),"ended"===i){const{width:e,height:t}=this.currentVideoResolution,{deviceId:i}=this.videoStreamTrack.getSettings();this.blockUpgradeCapture[i]=!0,this.destoryVideoMediaStream();const r=Ph({},this.receivedVideoConstraints);e&&(r.width=e),t&&(r.height=t),this.startCaptureVideo({videoConstraints:r,timeout:null}).catch((e=>{H.Ay.error("Recapture video failed: ",e),Y.A.add_monitor("RECPF")}))}return Promise.reject(t)})):Promise.reject(new Error("video stream not exist! update video constraints failed"))}changeVideoResolution(e,t,i){if(this.isUsingFileInputVideoSource())return Promise.reject(new Error("Reject upgrade caputre, reason: using file input video source"));if(this.videoStreamTrack){if(e>=1920&&!this.isSupportFullHD&&(e=1280,t=720),this.videoStreamTrack.getSettings){let r=this.videoStreamTrack.getSettings();if(Math.abs(r.width-e)<50)return Promise.reject(new Error("Reject upgrade caputre, reason: width change less than 50"));if((e>r.width||t>r.height||i>r.frameRate)&&this.blockUpgradeCapture[r.deviceId])return Promise.reject(new Error("Reject upgrade caputre, reason: block upgrade capture"))}Y.A.add_monitor("CCWidth"+e);const r={width:{min:e,ideal:e},height:{min:t,ideal:t},frameRate:{max:30,ideal:i},aspectRatio:0==this.platformType?{ideal:16/9}:void 0};return this._updateVideoConstraints(r).then((()=>{if(this.currentVideoResolution={width:e,height:t},this.webrtcFlag&&this.isVideoStreamProcessed()){const e=this.videoStream.getVideoTracks()[0];if(e){const{width:t,height:i}=e.getSettings();return new Promise(((e,r)=>{const a=setTimeout((()=>{this.onVBResolutionChange=null,r()}),150);this.onVBResolutionChange=r=>{r.width===t&&r.height===i&&(clearTimeout(a),this.onVBResolutionChange=null,e())}}))}}}))}return Promise.reject(new Error("video stream not exist! change video resolution failed"))}_isSameVideoConstraintsAsPrev(e){return!(this._isFileInputVideoSource(e)||!this.videoConstraints||!(0,F.bD)(this.videoConstraints,e)||!this.videoStream||!this._isStreamHasVideo(this.videoStream))}_clearCaptureVideoTimer(){this.captureVideoTimer&&(clearTimeout(this.captureVideoTimer),this.captureVideoTimer=null)}destoryVideoMediaStream(){this.videoStream?(this._isFileInputVideoSource(this.videoConstraints)&&F.Ay.videoToMediaStreamManager.stopCapture(),this.vbStream&&this.stopVBStream(),this.processedStream=null,this._isReuseStreamEnabled?this._updateStreamInReuse(this.videoStream,!0):(this._updateStreamInReuse(this.videoStream,!1),this._destoryStream(this.videoStream),this.videoStream=null,this.videoStreamTrack=null,this.videoConstraints=null,this._destoryDeprecatedStream({video:!0}))):this._destoryDeprecatedStream({video:!0}),this._isReuseStreamEnabled||this._clearCaptureVideoTimer(),this.enableReuseStream(!1),this.destoryVideoProcessor(),this._clearCheckVideoStreamActiveTimer()}shouldCaptureVideo(){return!this.videoStream||this._isStreamInReuse(this.videoStream)}_clearCheckVideoStreamActiveTimer(){this.checkVideoStreamActiveTimer&&(clearTimeout(this.checkVideoStreamActiveTimer),this.checkVideoStreamActiveTimer=null)}checkVideoStreamActive(){return new Promise(((e,t)=>{this._clearCheckVideoStreamActiveTimer(),this.checkVideoStreamActiveTimer=setTimeout((()=>{this.videoStream?!1===this.videoStream.active?t(new We.iG("VideoMediaStram.active equals false")):e(!0):t(!1)}),1e3)}))}destoryVideoProcessor(){if(this.mediaStreamTrackProcessor){if(this.mediaStreamTrackProcessor=null,Si({command:"releaseStream"}),this.reableStream&&this.reableStream.close)try{this.reableStream.close()}catch(e){H.Ay.error("Error when destroying mediaStreamTrackProcessor",e)}this.reableStream=null}}_createVideoProcessor(){this.videoStreamTrack?this.streamProcessAbility.isSupportMediaStreamTrackProcessor&&(this.mediaStreamTrackProcessor=new MediaStreamTrackProcessor(this.videoStreamTrack),this.reableStream=this.mediaStreamTrackProcessor.readable,Si({command:"releaseStream"}),_i("frameStream",this.reableStream),Y.A.add_monitor("VCTP")):H.Ay.error("Video stream track does not exist - cannot create video processor")}_storeVideoStream(e,t,i){e&&(xh("video stream is ok"),this.destoryVideoMediaStream(),this.videoStream=e,this.videoStreamTrack=this.videoStream.getVideoTracks()[0],this.videoConstraints=t,i&&this._setPresetVideoStreamAutoStopTimer())}_setPresetVideoStreamAutoStopTimer(){this._clearPresetVideoStreamAutoStopTimer(),this.presetedConstraints.videoTimer=setTimeout((()=>{this.destoryVideoMediaStream()}),1e4)}_clearPresetVideoStreamAutoStopTimer(){this.presetedConstraints.videoTimer&&(clearTimeout(this.presetedConstraints.videoTimer),this.presetedConstraints.videoTimer=null)}_handleVideoCaptureSuccess(e,t,i,r){this._clearPresetVideoStreamAutoStopTimer(),r||this._storeVideoStream(e,t),this.webrtcFlag||this._createVideoProcessor(),this._updateStreamInReuse(e,!1),this.isVBEnabled?this.startVBStream().then((()=>{i(e)})).catch((()=>{})):i(e)}getVideoCapabilities(){if(this.videoStream&&(this.videoStreamTrack||(this.videoStreamTrack=this.videoStream.getVideoTracks()[0]),this.videoStreamTrack)){if(this.videoStreamTrack.getCapabilities)return this.videoStreamTrack.getCapabilities()||{};if(this.videoStreamTrack.getSettings)return this.videoStreamTrack.getSettings()||{}}return{}}getAudioCapabilities(){let e=null,t=null;if(this.audioStream){let i=this.audioStream.getAudioTracks()[0];i&&(e=i.getSettings().deviceId,t=i.label)}return{deviceId:e,elapsed_time:this.audioCaptureElapsedTime,deviceLabel:t}}getAudioDeviceId(){return this.isCapturingAudioFromDefault?null:this.getAudioCapabilities().deviceId}_splitVideoStream(e,t,i,r){const{audio:a,video:n}=t;if(a&&this._isStreamHasAudio(e)){const t=this._genVideoStream(e),s=this._genAudioStream(e);return t?this._handleVideoCaptureSuccess(t,n,i):r(new Error("video stream do not contains video track ")),void(s&&(this.audioStream?this._pushDeprecatedStream({audioStream:s}):(this._updateStreamInReuse(s,!0),this._storeAudioStream(s,a,!0))))}this._handleVideoCaptureSuccess(e,n,i)}async _captureFileInputVideoStream(e){const{video:t}=e;try{if(!await new Promise(((e,i)=>{t.currentTime>0&&!t.paused&&!t.ended&&e(!0);const r=()=>{e(!0),t.removeEventListener("timeupdate",r)};t.addEventListener("timeupdate",r),setTimeout((()=>i(!1)),1e4)})))throw new Error("video file playing failed");if(!e.width||!e.height){const{width:i,height:r}=_getFileInputSourceSize(t.videoWidth,t.videoHeight);e.width=i,e.height=r}return F.Ay.videoToMediaStreamManager.startCapture(t,e.width,e.height)}catch(e){console.error(e);const t=new Error("capture stream from file input souce failed");throw t.name="FileInputSouceError",t}}async startCaptureVideo(e){let{videoConstraints:t,timeout:i,successHandler:r=this.videoCaptureSuccessHandler,errorHandler:a=this.videoCaptureFailedHandler}=e;this.videoCaptureSuccessHandler=r,this.videoCaptureFailedHandler=a,this.receivedVideoConstraints=t,this._captureVideoDeferred&&await this._captureVideoDeferred.promise,this.enableReuseStream(!1);const n=!!t&&this._getVideoConstraints(t),s=this._isFileInputVideoSource(n),o=this._isSameVideoConstraintsAsPrev(n),d=this._getPresetAudioConstraints();if(this._clearPresetVideoStreamAutoStopTimer(),Y.A.add_monitor("STARTVIDEOCAPTURE:".concat(!!this._captureVideoDeferred,":").concat(o)),o)return void this._handleVideoCaptureSuccess(this.videoStream,n,r,!0);this.destoryVideoMediaStream();const c={audio:s?null:d,video:n};xh("try to getusermedia",c),Y.A.add_monitor("VCFC: ".concat((0,F.iD)(JSON.stringify(c)),"|isFileInputVideoSource:").concat(s));try{this.isCaptureVideoInProgress=!0;let e,o=!1;this._clearCaptureVideoTimer();const d=i||3e4;d&&(this.captureVideoTimer=setTimeout((async()=>{if(!e){const e=await Va.hasPermission("camera");if(e&&(Y.A.add_monitor("CAMERANORES"),(0,We.iK)(u.x3x,We.pg.EXCEPTION)),i||e){o=!0;const e=new Error("GetUserMedia timeout");a(e)}}}),d));let l=Date.now();if(s)e=await this._captureFileInputVideoStream(n);else try{e=await navigator.mediaDevices.getUserMedia(c)}catch(i){let r=!0;if(i instanceof OverconstrainedError){r=this._getVideoIdealWidthHeight(t),r instanceof Object&&(r=Object.assign({},c.video,r));try{e=await navigator.mediaDevices.getUserMedia(Object.assign({},c,{video:r})),a(i,!0)}catch(e){a(e)}}else a(i)}if(this._clearCaptureVideoTimer(),!e)return;{let t=e.getVideoTracks()[0];if(t&&t.getCapabilities){var h;let e=t.getCapabilities();(null==e||null===(h=e.width)||void 0===h?void 0:h.max)>=1920&&(this.isSupportFullHD=!0)}let i=t.getSettings();const{width:r,height:a,frameRate:n,facingMode:s,deviceId:d}=i||{};this.facingMode="user"===s?0:"environment"===s?1:-1;const c={width:r,height:a,frameRate:n,facingMode:s};Y.A.add_monitor("CapturedVT: ".concat((0,F.iD)(JSON.stringify(c))));let u=t.label;if(o)return this._destoryStream(e),void Va.updateSelectedCameraDevices(d,u,r,a,n,Date.now()-l,!1);Va.updateSelectedCameraDevices(d,u,r,a,n,Date.now()-l,!0)}this._splitVideoStream(e,c,r,a)}catch(e){a(e)}finally{this.isCaptureVideoInProgress=!1}}playVideoStream(e){if(e){e.setAttribute("muted",""),e.setAttribute("playsinline","");try{e.srcObject=this.getVideoStream()}catch(t){e.src=c().createObjectURL(this.getVideoStream())}const t=e.play();return t?t.then((()=>{})).catch((e=>{if(!e.message.includes("The play() request was interrupted")&&!e.message.includes("The fetching process for the media resource was aborted"))throw H.Ay.warn("Video element playback failed",e),e})):Promise.resolve(void 0)}return Promise.reject(new Error("video dom node not provided!"))}removeVideoStream(e){e&&(!e.paused&&e.pause(),e.srcObject&&(e.srcObject=null),e.src&&(e.src=null))}destoryReuseStream(){let{audio:e,video:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.enableReuseStream(!1),e&&this.destoryAudioMediaStream(),t&&this.destoryVideoMediaStream()}async initVB(e){if(!this.vb){const e=kh.substring(0,kh.lastIndexOf("/"));let t;this.vb=new uh({cdnPath:e}),this.vb.ontimeout3s=()=>{Y.A.add_monitor("VBP3S"),J.A.Notify_APPUI(u.eJx,null)},this.vb.ontimeout10s=()=>{Y.A.add_monitor("VBP10S"),J.A.Notify_APPUI(u.IkA,null)},this.vb.onMessage((e=>{const{cmd:i,payload:r}=e;if(i===th.VB_MODEL_READY)t=performance.now();else if(i===th.VB_PREDICT_DONE){const i=performance.now()-t;Y.A.add_monitor("VBPOK"+i),Y.A.add_monitor("TFBE-"+e.payload)}else i===th.VB_GENERATE_FIRST_FRAME&&this.isVBEnabled&&this.updateVideoStream?this.updateVideoStream(this.vbStream):i===th.VB_WORKER_ERROR?("VB_VIDEOFRAME_COPYTO_ERROR"===r.message&&(0,We.iK)(u.sCw),H.Ay.error("VB module error: ",r)):i===th.VB_RESOLUTION_CHANGE&&this.onVBResolutionChange&&this.onVBResolutionChange(r)})),Y.A.add_monitor("CWMSCVB")}this.updateVideoStream=e;try{await this.vb.initialize(),J.A.Notify_APPUI(u.UsF,null)}catch(e){H.Ay.error("VB initialize failed",e),Y.A.add_monitor("VBBEF");const{HjG:t}=u;J.A.Notify_APPUI(u.KqK,t.FAIL)}}async changeVBImage(e){if(this.isVBEnabled=!0,"blur"===e?this.vb.set_background_blur():this.vb.set_background_image(e)||H.Ay.error("WebRTC change VB background failed"),!this.vbStream&&this.videoStream)try{await this.startVBStream()}catch(e){H.Ay.error("WebRTC startVBStream failed",e)}}startVBStream(){return this.videoStream.getVideoTracks()[0]?(this.vbStream=this.vb.createStream(),this.vb.captureVideo(this.videoStream)):Promise.reject("start vb stream fail")}stopVBStream(){this.vbStream=null,this.vb.stopCapture(!1)}disableVB(){this.isVBEnabled=!1,this.updateVideoStream&&this.updateVideoStream(this.videoStream),this.stopVBStream()}getVideoStream(){return this.processedStream?this.processedStream:this.isVBEnabled?this.vbStream:this.videoStream}isVideoStreamProcessed(){return this.getVideoStream()!=this.videoStream}getAudioStream(){return this.audioStream}isAudioCaptureProgressing(){return this.isCaptureAudioInProgress}async adjustShareResUnder2K(e){const{height:t,width:i}=e.getSettings(),r=t>=i;if((r?i:t)>1440||(r?t:i)>2560){const t=e.getConstraints();t.height=r?2560:1440,t.width=r?1440:2560;try{await e.applyConstraints(t)}catch(t){xh.error("browser does not support applyConstraints",t),Y.A.add_monitor("SVSTACF: ".concat(e.readyState))}}}getScaledResolution(e,t){if(e>t&&e>2560){let i=e/2560,r=t/1440;return i>r?{w:2560,h:Math.floor(t/i)}:{w:Math.floor(e/r),h:1440}}return{w:e,h:t}}},xh=(0,G.A)("sdk");function Vh(){document.hidden||(Y.A.add_monitor("RE-CAPTURE"),J.A.Notify_APPUI_SAFE(u.hd7),document.removeEventListener("visibilitychange",Vh))}let Nh=!1;try{Nh=!1}catch(e){}var Lh=0;const Wh=e=>{switch(window.orientation){case 0:Lh=1;break;case 90:Lh=2;break;case 180:Lh=3;break;default:Lh=0}};function Bh(e){let t=u.sfr.UNKNOWN_REASON,i="Unknown reason";return"NotAllowedError"===(null==e?void 0:e.name)?"Permission denied by system"===(null==e?void 0:e.message)?(t=u.sfr.SYSTEM_DENIED,i="Permission denied by system"):"Permission denied"===(null==e?void 0:e.message)||null!=e&&e.message.includes("The request is not allowed by the user agent or the platform in the current context")?(t=u.sfr.USER_DENIED,i="Permission denied by user"):"Permission dismissed"===e.message?(t=u.sfr.USER_DISMISS,i="Permission dismissed by user"):"No AVAudioSessionCaptureDevice device"===e.message&&(t=u.sfr.SYSTEM_DENIED,i="Device access denied by system or browser"):"NotFoundError"===(null==e?void 0:e.name)?"The object can not be found here."===e.message?(t=u.sfr.SYSTEM_DENIED,i="Permission denied by system"):"Requested device not found"===e.message&&(t=u.sfr.NO_DEVICE,i="No device found"):"NotReadableError"!==(null==e?void 0:e.name)&&"TrackStartError"!==(null==e?void 0:e.name)||"Device in use"!==(null==e?void 0:e.message)?"OverconstrainedError"===(null==e?void 0:e.name)&&(t=u.sfr.OVERCONSTRAINED,i="Constraint violation"):(t=u.sfr.DEVICE_IN_USE,i="Device in use"),{errorCode:t,errorMessage:i,error:e}}!function(){try{var e,t,i;null!==(e=screen)&&void 0!==e&&e.orientation,null===(t=window)||void 0===t||t.removeEventListener("orientationchange",Wh),null===(i=window)||void 0===i||i.addEventListener("orientationchange",Wh),Wh()}catch(e){}}(),document.addEventListener("visibilitychange",(()=>{let e=F.Ay.getMachineCapability();Y.A.add_monitor("page_visibility:".concat(document.visibilityState)),document.hidden?(e.unvisibilitycount++,e.visibility=!1):e.visibility=!0})),function(){try{const e="undefined"!=typeof DedicatedWorkerGlobalScope;if(Pe.dataTransportMgr)return;let t=new Ce({type:e?Ce.THREAD_SUB:Ce.THREAD_MAIN,remote:e?self:null});Pe.dataTransportMgr=t,t.monitorlogfn=void 0,e&&self.addEventListener("message",t._onrecvmainthreadlistener.bind(t))}catch(e){console.error("<<<< InitDataTransportModule",e)}}();var Uh=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(xh("sdkProps",t),Y.A.reset(),Oh.webrtcFlag=!1,this._id=(new Date).getTime()+Math.floor(performance.now()),t.parentPath){const e=t.parentPath.endsWith("/")?t.parentPath:t.parentPath+"/";i.p=e}else{const e=null==kh?void 0:kh.indexOf("js_media.min.js");e?i.p=null==kh?void 0:kh.substring(0,e):xh("could not locate parentPath")}if(this.lateLoadedAssetsHash={},t.globalTracingLogger&&H.Ay.setInstance(t.globalTracingLogger,Uh.fixVersion),H.Ay.clearHighFrequencyLogs(),this.isSupportThread="object"==typeof WebAssembly&&"function"==typeof Worker,!this.isSupportThread)throw new Error("Webassemly or worker is not supported on this browser");let r=J.A.sharedBuffer;J.A.reinit(this),r&&(J.A.sharedBuffer=r),this.localLog=null,Nh&&(this.localLog=new Za,this.localLog.init()),Va.init({onChangeHandler:this.deviceChangeHandler.bind(this)}),this.userId="",this.selfPreviewVideotagList=[],this.sharingCanvasList=[],this.mainSharingCanvas=null,this.annoCanvas=null,this.annoPresenterCanvas=null,this.localShareCanvas=null,this.localShareVideoTag=null,this.localShareCanvasExt=null,this.audioCtx=null,this.sharePreviewVideo=null,this.sharePreviewCanvas=null,this.localShareCanvasWaiting=!1,this.sharingAudioCtx=null,this.webrtcAudioNode=null,this.sharingWebrtcAudioNode=null,this.videoRenderArray=[],this.videoCaptureValue=null,this.audioRenderArray=[],this.audioCapture=null,this.deviceInfo=new Map,this.display=[],this.sampleRate=null===(e=this.audioCtx)||void 0===e?void 0:e.sampleRate,this.videoRenderIntervalHandle=null,this.audioDomNode=null,this.audioSpeakerValue=null,this.audioSpeakerSetErrorCnt=0,this.audioMicSetErrorCnt=0,this.audionoderecordbuffersize=2048,this.lastresidual=null,this.currentactive=0,this.audioPlay=!1,this.sharingInterval=null,this.sharingIntervalTime=100,this.sharingDisplay=null,this.currentshareactive=0,this.activeSpeakerSsrc=0,this.videorenderinterval=30,this.waterMarkCanvas=null,this.videoCaptureHiddenCanvas=null,this.videoCaptureHiddenCanvasCtx=null,this.isSetCursor=!1,this.logon=!1,this.canvas=null,this.firstSetDelay=!0,this.isSelfViewWithVideo=!1,this.isSupportOffscreenCanvas=F.Ay.isSupportOffscreenCanvas(),this.isSupportVideoShare=F.Ay.isSupportVideoShareReceive()&&F.Ay.isSupportVideoShareSend(),this.isSupportMediaStreamTrackProcessor=F.Ay.isSupportMediaStreamTrackProcessor(),this.isSupportVideoFrameOrBitmapCapture=F.Ay.isSupportVideoFrameOrBitmapCapture(),this.isMultipleCanvasForMultipleView=0,this.isCaputureNodeConnect=!1,this.isSharingCaptureNodeConnect=!1,this.audioWorkletJsPath=null,this.isSupportChromeWideAEC=F.Ay.isSupportChromeWideAEC(),this.isSupport2DCanvasDrawFrame=F.Ay.isSupport2DCanvasDrawFrame(),this.MaskImage=null,this.BgImage=null,this.bgCanvas=null,this.bgCanvasctx=null,this.isCurrentInMaskStatus=!1,this.isCurrentInNoVBPreviewStatus=!1,this.videoNoVBPreviewCanvas=null,this.videoNoVBPreviewCanvasctx=null,this.isVideoNoVBPreviewCanvasScaled=!1,this.maskCoordinate={dx:0,dy:0,dWidth:0,dHeight:0},this.VideoMaskSettingCanvas=null,this.VideoMaskSettingCanvasctx=null,this.PrevVideoMaskSettingCanvas=null,this.VideoMaskCanvasFillMode=0,this.isMaskSettingOn=!1,this.isMaskSettingStarted=!1,this.MaskData=null,this.MaskSettingVideo=null,this.ReadyCapureWidth=640,this.ReadyCapureHeight=360,this.bgImageCroppingParams={sx:0,sy:0,sw:0,sh:0},this.VideoVBSettingCanvas=null,this.isVBSettingOn=!1,this.sMonitorCaptureFrameCount=0,this.vMonitorCaptureFrameCount=0,this.videoCaptureInterval=0,this.isStartVideoCapture=!1,this.videoCaptureWidth=0,this.videoCaptureHeight=0,this.videoCaptureContext=null,this.isCreateVideoWaterMark=!1,this.videoWaterMarkName="",this.sharingWaterMarkName="",this.isCreateSharingWaterMark=!1,this.videoWaterMarkParams={},this.sharingWaterMarkParams={},this.isStartDesktopSharing=!1,this.desktopSharingValue=null,this.desktopCaptureContext=null,this.desktopSharingMediaStram=null,this.desktopSharingMediaStramRaw=null,this.desktopSharingCaptureWidth=0,this.desktopSharingCaptureHeight=0,this.sharingCodecInfo={width:0,height:0},this.desktopSharingSend=!1,this.isdesktopCaptureLoadedmetadata=!1,this.captureVideoOutputCanvasDomList=[],this.captureVideoOutPutVideoDom=null,this.shareTrack=null,this.drawLocalShareInterval=200,this.drawLocalShareIntervalId=null,this.isVideoCaptureLoadedmetadata=!1,this.videoloadmetadataListener=null,this.videoloadedmetadatamonitor=null,this.loadedmetadatamtimeoutcount=0,this.mountoadedmetadatatime=0,this.VALUE_CACHE_FOR_START_CAPTURE_VIDEO={},this.vMonitorCount=0,this.sMonitorCount=0,this.mMonitorCount=0,this.sharingMediaStreamTrackProcessor,this.sharingFrameStream,this.isSendVideoOfflineCanvas=!1,J.A.mediaSDKHandle=this,this._preloadMeetingParam=null,this.is32bitbrowser=!1,this.flipSend=!0,this.mtu_size=0,this.sharingImageCapture=null,this.sharingRenderCanvas=null,this.VideoRenderObj=null,this.SharingRenderObj=null,this.rtcConnectionA=null,this.rtcConnectionB=null,this.isLocalP2PSupportedPromise=F.Ay.checkLocalP2PConnection(),this.isSupportBrowserAec=!0,this.sharingWidthAndHeightInfo={ctiveNodeID:0,height:0,logicHeight:0,logicWidth:0,width:0},this.remoteControl=null,this.isMirrorMyVideo=!1,this.isCanvasScaled=!1,this.isDestroy=!1,this.destoryPromise=null,this.rwgAgentMessageListenerWrapper=this.rwgAgentMessageListener.bind(this),this.bVideoDecodeUsingSAB=F.Ay.isSupportSharedArrayBuffer(),this.bVideoEncodeUsingSAB=F.Ay.isSupportSharedArrayBuffer(),this.bAudioEncodeUsingSAB=F.Ay.isSupportSharedArrayBuffer(),this.bAudioDecodeUsingSAB=F.Ay.isSupportSharedArrayBuffer(),this.videoDecodeRingBuffer=null,this.videoEncodeRingBuffer=null,this.audioDecodeRingBuffer=null,this.audioEncodeRingBuffer=null,this.bVideoEncodeMainThreadConsumerIntervalEnable=F.Ay.isIphoneOrIpadSafari(),this.isSupportOffscreenCanvasForVideoDecode=F.Ay.isSupportOffscreenCanvas(),this.isMultiView=!1,this.checkWorkletInterval=null,this.persistenceInfo=new fh.Y,this.audioPersistenceInfo=this.persistenceInfo.getAudioSolutionInfo("audio"),t.ivObj&&(J.A.ivObj=t.ivObj),this.lastRealRect={left:0,top:0,width:0,height:0},this.videodecodehardwareflag=null,this.videoencodehardwareflag=null,this.isEnableVideoDecodeHardWareThread=!1,this.hardwareflag=null,this.isEnableHardWareThread=!1,this.isTeslaMode=!1,this.useAudioBridge=!1,this.audioBridge=null,this.replaceCanvasMap={},this.hidAvalible=!1,this.enableHID=!1,this.audioInputLevel=null,this.captureAudioMuted=!1,this.setvideokk=!1,this.isStartWhiteboardSharing=!1,this.ZoomMonitor=Y.A.add_monitor.bind(Y.A),this.isLandScape=!1,this.captureSize=null,this.platformType=0,(0,We.Xe)(this.ZoomMonitor),this.wmscManager=null,this.webrtcConfig={userId:null,webrtcflag:!1,subscribeQosParamsData:{},currentReloadTimes:0,maxReloadTimes:6},this.allpromises=[],this.RenderInMain=-1,this.vcFlag=!1,this.waitingVcChannelReady=!1,en.isSupportComputePressure()&&(this.computePressureManager=new en),this.renderManager=new eh("JsMediaSDK"),this.rendererType=-1,this.defaultRendererType=0,this.isWebGPUFeatureEnabled=!1,this.enableVBWasmBackend=0,this.isWebGL2FeatureEnabled=!1,this.isWebTransportAllowed=!0,this.mGPUBlacklist=null,this.mWebCodecConfig=null,this.webrtcVideoCodecConfig=null,this.isWebCodecEncoderOnWhitelist=!1,this.isWebCodecDecoderOnWhitelist=!1,this.mediaProcessorConfig=0,this.mediaFeatureOptions="",this.isAnnotationEnabled=!1,this.isAnnotationPMEnabled=!1,this.shareAnnotationInited=!1,this.isVideoHD=!1,this.vbResource=null,this.vbSettingDomMap={},this.annotationModule=null,this.annotationMgr=null,this.localAnnoStarted=!1,this.fileAudioPlaybackTag=null,this.initVEPara=null,this.resolveVEwebrtcpromise=null,this.webrtcpromise=new Promise(((e,t)=>{this.resolveVEwebrtcpromise=e})),this.initVDPara=null,this.resolveVDwebrtcpromise=null,this.webrtcVDpromise=new Promise(((e,t)=>{this.resolveVDwebrtcpromise=e})),this.hadsetpropsbeforeinit=!1,this.networkerpath=null,this.dataChannelController=new Le,this.dataChannelController.addTransportListiner(),Fe.instance||(Fe.instance=new Fe),Fe.instance.start(this),Be(this.workrtHealthCheckReport.bind(this)),this.processorMessagePort=null,this.shadowProcessorMessagePort=null};Uh.buildNumber="10206",Uh.version="15.0.10206",Uh.util=F.Ay,Uh.util.getDeviceListAsync=Va.getDeviceListAsync.bind(Va),Uh.fixVersion="Web-Media-EP-6.3.10",Uh.prototype={JsMediaSDK_Log:function(e){H.Ay.error("Error in JsMediaSDK",e)},JsMediaSDK_PreLoad:function(e,t,i){var r,a;const{isTeslaMode:n,isGoogleMeetMode:s,enableMultiDecodeVideoWithoutSAB:o,enableVirtualBackgroundWithoutSAB:d,enableDecoderInWorklet:c,enableAudioBridge:u,onDesktop:h,disableStreamingInstantiate:l,isVDIWebview:p}=i||{};J.A.decoderinworkletOP=!0,J.A.onDesktop=h,J.A.chromeWideAEC=c,J.A.enableStreamingInstantiate=!l,J.A.enableMultiDecodeVideoWithoutSAB=o,J.A.enableVirtualBackgroundWithoutSAB=d,J.A.enableAudioBridge=u,this.isTeslaMode=!!n,J.A.isGoogleMeetMode=s,J.A.isVDIWebview=p,p&&(this.isSupportVideoShare=!1),e.basePath&&(this.getFilePath=this.makFilePath(e.basePath));let f={audioWorkletPath:(e=(null===(r=this.getFilePath)||void 0===r?void 0:r.call(this))||e).audioWorkletPath,audioWorkletSIMDPath:e.audioWorkletSIMDPath,audioWorkletProcessPath:e.audioWorkletProcessPath,sharingAudioWorkletPath:e.sharingAudioWorkletPath,audioLevelWorkletPath:e.audioLevelWorkletPath,audioWasm:e.audioWasm,audioSIMDWasm:e.audioSIMDWasm};this.networkerpath=null===(a=e)||void 0===a?void 0:a.netThreadPath,this.setPropsBeforeInit({callback:t,audioWorkletPath:f,fromPreload:!0}),this._preloadMeetingParam=e,Wi(),this.handleUnloadEvent(),Y.A.add_monitor("JSPLD"),this.vbResource=i,this.computePressureManager&&this.computePressureManager.init(),this.mediasdkConfig=null,this.iceServers=[]},getWebRTCFlag(){return this.webrtcConfig&&this.webrtcConfig.webrtcflag},makFilePath(e){let t=e;return function(){return t?{audioWorkerPath:"".concat(t,"/js_audio_process.min.js"),audioWorkletPath:"".concat(t,"/js_audio_worklet.min.js"),audioWorkletSIMDPath:"".concat(t,"/js_audio_worklet_simd.min.js"),audioWorkletProcessPath:"".concat(t,"/js_audio_worklet_process.min.js"),audioWasm:"".concat(t,"/audio.encode.wasm"),videoWorkerPath:"".concat(t,"/video_s.min.js"),videoMtWorkerPath:"".concat(t,"/video_m.min.js"),videoWasm:"".concat(t,"/video.decode.wasm"),videoMtWasm:"".concat(t,"/video.mt.wasm"),sharingWorkerPath:"".concat(t,"/sharing_s.min.js"),sharingMtWorkerPath:"".concat(t,"/sharing_m.min.js"),videoSIMDWorkerPath:"".concat(t,"/video_simd.min.js"),videoSIMDWasm:"".concat(t,"/video.simd.wasm"),sharingSIMDWorkerPath:"".concat(t,"/sharing_simd.min.js"),videoMSIMDWasm:"".concat(t,"/video.mtsimd.wasm"),sharingMSIMDWorkerPath:"".concat(t,"/sharing_mtsimd.min.js"),videoMSIMDWorkerPath:"".concat(t,"/video_mtsimd.min.js"),audioSIMDWorkletPath:"".concat(t,"/audio_simd.min.js"),audioSIMDWasm:"".concat(t,"/audio.simd.wasm"),vsmiworkerpath:"".concat(t,"/video_share_mtsimd.min.js"),sharingAudioWorkletPath:"".concat(t,"/js_sharing_audio_worklet.min.js"),audioLevelWorkletPath:"".concat(t,"/js_audio_level_worklet_process.min.js"),netThreadPath:"".concat(t,"/net_thread.min.js")}:void 0}},isPreviewVideotag(e){return this.userId&&this.userId>>10==e>>10&&F.Ay.isSelfPreviewRenderWithVideo()},isSharePreviewVideotag(e){return this.userId&&this.userId>>10==e>>10},isSelfUser(e){return this.userId==e},recordSharingParamInfo(){let e=this;X.on(u.vjv,((t,i)=>{var r;Object.assign(e.sharingWidthAndHeightInfo,i.body),null===(r=e.annotationMgr)||void 0===r||r.updateRemoteSizeInfo(i.body)}))},setCallback(e){if(!Cr()(e))throw new Error("callback must be function");J.A._Notify_APPUI=e,(0,We._G)(J.A.Notify_APPUI_SAFE.bind(J.A))},addCallback(e){if(!Cr()(e))throw new Error("callback must be function");J.A._callbackList.push(e)},removeCallback(e){const t=J.A._callbackList.indexOf(e);-1!==t&&J.A._callbackList.splice(t,1)},setPropsBeforeInit(e){this.hadsetpropsbeforeinit|=!e.fromPreload;let t=e.featureOptions;if(e.mediaFeatureOptions&&(t=e.mediaFeatureOptions),this.mediaFeatureOptions=t,t){const e=[{bitIndex:ah.n.HW_ENCODER_FOR_360P.index,readCount:1,defaultVal:ah.n.HW_ENCODER_FOR_360P.default},{bitIndex:ah.n.WEBGPU_RENDERER.index,readCount:1,defaultVal:ah.n.WEBGPU_RENDERER.default},{bitIndex:ah.n.VB_ON_SAFARI_17.index,readCount:1,defaultVal:ah.n.VB_ON_SAFARI_17.default},{bitIndex:ah.n.WEBGL2_RENDERER.index,readCount:1,defaultVal:ah.n.WEBGL2_RENDERER.default},{bitIndex:ah.n.AUDIO_ECHO_DETECT.index,readCount:1,defaultVal:ah.n.AUDIO_ECHO_DETECT.default},{bitIndex:ah.n.WEBCODEC_DECODE_OPTION.index,readCount:1,defaultVal:ah.n.WEBCODEC_DECODE_OPTION.default},{bitIndex:ah.n.HW_WEBCODEC_ON_SAFARI.index,readCount:1,defaultVal:ah.n.HW_WEBCODEC_ON_SAFARI.default},{bitIndex:ah.n.HW_DECODE_FOR_360P.index,readCount:1,defaultVal:ah.n.HW_DECODE_FOR_360P.default},{bitIndex:ah.n.WEBCODEC_ON_ANDROID_CHROME.index,readCount:1,defaultVal:ah.n.WEBCODEC_ON_ANDROID_CHROME.default},{bitIndex:ah.n.WEBCODEC_ENCODE_OPT_1ON1.index,readCount:1,defaultVal:ah.n.WEBCODEC_ENCODE_OPT_1ON1.default},{bitIndex:ah.n.CAP_WEBCODEC_SUPPORT.index,readCount:1,defaultVal:ah.n.CAP_WEBCODEC_SUPPORT.default},{bitIndex:ah.n.WEBGL_CANVAS_OPTION_OPT.index,readCount:1,defaultVal:ah.n.WEBGL_CANVAS_OPTION_OPT.default},{bitIndex:ah.n.DEFAULT_RENDERER.index,readCount:1,defaultVal:ah.n.DEFAULT_RENDERER.default},{bitIndex:ah.n.WEB_TRANSPORT_CONTROL.index,readCount:1,defaultVal:ah.n.WEB_TRANSPORT_CONTROL.default},{bitIndex:ah.n.ENABLE_TP_RLB_WEBSOCKET.index,readCount:1,defaultVal:ah.n.ENABLE_TP_RLB_WEBSOCKET.default},{bitIndex:ah.n.ENABLE_TRANSFERABLE_RTC_DATACHANNEL.index,readCount:1,defaultVal:ah.n.ENABLE_TRANSFERABLE_RTC_DATACHANNEL.default},{bitIndex:ah.n.ENABLE_WEBRTC_TURN_SERVERS.index,readCount:1,defaultVal:ah.n.ENABLE_WEBRTC_TURN_SERVERS.default},{bitIndex:ah.n.EXTRA_DEVICE_INTERVAL_ENUMERATE.index,readCount:1,defaultVal:ah.n.EXTRA_DEVICE_INTERVAL_ENUMERATE.default},{bitIndex:ah.n.ENABLE_MEDIA_PROCESSOR.index,readCount:1,defaultVal:ah.n.ENABLE_MEDIA_PROCESSOR.default},{bitIndex:ah.n.MOBILE_FORCE_AUTO_CHOOSE_AUDIO_DEVICE.index,readCount:1,defaultVal:ah.n.MOBILE_FORCE_AUTO_CHOOSE_AUDIO_DEVICE.default},{bitIndex:ah.n.SUPPORT_ANNOTATION.index,readCount:1,defaultVal:ah.n.SUPPORT_ANNOTATION.default},{bitIndex:ah.n.SUPPORT_ANNOTATION_PRESENTER.index,readCount:1,defaultVal:ah.n.SUPPORT_ANNOTATION_PRESENTER.default},{bitIndex:ah.n.WASM_MOBILE_30FPS.index,readCount:1,defaultVal:ah.n.WASM_MOBILE_30FPS.default}],i=rh.A.batchRead(t,e);this.isWebGPUFeatureEnabled=!!i.get(ah.n.WEBGPU_RENDERER.index),this.enableVBWasmBackend=i.get(ah.n.VB_ON_SAFARI_17.index),this.isWebGL2FeatureEnabled=!!i.get(ah.n.WEBGL2_RENDERER.index),this.defaultRendererType=i.get(ah.n.DEFAULT_RENDERER.index),this.isWebTransportAllowed=!!i.get(ah.n.WEB_TRANSPORT_CONTROL.index),this.isAnnotationEnabled=!!i.get(ah.n.SUPPORT_ANNOTATION.index),this.isAnnotationPMEnabled=!!i.get(ah.n.SUPPORT_ANNOTATION_PRESENTER.index)&&this.isAnnotationEnabled,J.A.enable360pHWEnc=i.get(ah.n.HW_ENCODER_FOR_360P.index),J.A.enableEchoDetection=i.get(ah.n.AUDIO_ECHO_DETECT.index),J.A.enableHADecOpt=i.get(ah.n.WEBCODEC_DECODE_OPTION.index),J.A.enableSafariHWCodec=i.get(ah.n.HW_WEBCODEC_ON_SAFARI.index),J.A.enable360pHWDec=i.get(ah.n.HW_DECODE_FOR_360P.index),J.A.enableAndroidHWCodec=i.get(ah.n.WEBCODEC_ON_ANDROID_CHROME.index),J.A.enableOptCopyFrame=i.get(ah.n.WEBCODEC_ENCODE_OPT_1ON1.index),J.A.disableHWCodec=i.get(ah.n.CAP_WEBCODEC_SUPPORT.index);let r=i.get(ah.n.WEBGL_CANVAS_OPTION_OPT.index);J.A.enableTransferDataChannel=i.get(ah.n.ENABLE_TRANSFERABLE_RTC_DATACHANNEL.index),J.A.enableWebrtcTurnServer=i.get(ah.n.ENABLE_WEBRTC_TURN_SERVERS.index),J.A.mobileForceAutoChooseAudioDevice=i.get(ah.n.MOBILE_FORCE_AUTO_CHOOSE_AUDIO_DEVICE.index),J.A.WASM_MOBILE_30FPS=i.get(ah.n.WASM_MOBILE_30FPS.index),$.setIsEnableCanvasCtxOptionsOpt(r),this.mediaProcessorConfig=i.get(ah.n.ENABLE_MEDIA_PROCESSOR.index),F.Ay.isAndroidBrowser()&&(J.A.enable360pHWDec=J.A.enableAndroidHWCodec);const a=F.Ay.getOSInfo();H.Ay.directReport("setPropsBeforeInit, os:".concat(a.os,", version:").concat(a.osVersion,", enableSafariHWCodec:").concat(J.A.enableSafariHWCodec,", enable360pHWDec:").concat(J.A.enable360pHWDec,", enable360pHWEnc:").concat(J.A.enable360pHWEnc,", enableAndroidHWCodec:").concat(J.A.enableAndroidHWCodec,",disableHWCodec:").concat(J.A.disableHWCodec,",  enableOptCopyFrame:").concat(J.A.enableOptCopyFrame))}const i=F.Ay.getGpuInfo();if(e&&e.webMediaBlockConfig)try{var r;const t=JSON.parse(e.webMediaBlockConfig);this.mGPUBlacklist=null==t?void 0:t.GPUBlacklist,this.mWebCodecConfig=null==t?void 0:t.WebCodecConfig,this.webrtcVideoCodecConfig=ih.A.readWebRTCVideoCodecConfig(null==t||null===(r=t.WebRTCConfig)||void 0===r?void 0:r.VideoCodecConfig),this.mWebCodecConfig?(this.isWebCodecEncoderOnWhitelist=ih.A.isGPUProfileOnWebCodecWhitelist("encoder",this.mWebCodecConfig,i),this.isWebCodecDecoderOnWhitelist=ih.A.isGPUProfileOnWebCodecWhitelist("decoder",this.mWebCodecConfig,i)):(this.isWebCodecEncoderOnWhitelist=0===F.Ay.AdapterWhiteListCheckForEncoder(),this.isWebCodecDecoderOnWhitelist=ih.A.isGPUProfileOnWebCodecWhitelist("decoder",void 0,i))}catch(t){this.isWebCodecEncoderOnWhitelist=0===F.Ay.AdapterWhiteListCheckForEncoder(),this.isWebCodecDecoderOnWhitelist=ih.A.isGPUProfileOnWebCodecWhitelist("decoder",void 0,i),""===e.webMediaBlockConfig?H.Ay.log("cannot read empty props.webMediaBlockConfig. encoder:".concat(this.isWebCodecEncoderOnWhitelist," decoder:").concat(this.isWebCodecDecoderOnWhitelist)):H.Ay.error("failed to read props.webMediaBlockConfig! config=".concat(null==e?void 0:e.webMediaBlockConfig," encoder:").concat(this.isWebCodecEncoderOnWhitelist," decoder:").concat(this.isWebCodecDecoderOnWhitelist))}else this.isWebCodecEncoderOnWhitelist=0===F.Ay.AdapterWhiteListCheckForEncoder(),this.isWebCodecDecoderOnWhitelist=ih.A.isGPUProfileOnWebCodecWhitelist("decoder",void 0,i);e&&void 0!==e.rendererType&&(this.rendererType=e.rendererType,this.handleRendererTypeInProps(this.rendererType,this.defaultRendererType,this.mGPUBlacklist).then((e=>{J.A.Notify_APPUI(u.zFT,e),this.renderManager.getRendererProvider().setRendererType(e.rendererType),this.rendererType=e.rendererType,H.Ay.log("handleRendererTypeInProps() final rendererType=".concat(e.rendererType," gpuBlacklist=").concat(JSON.stringify(this.mGPUBlacklist))),console.log("handleRendererTypeInProps() final rendererType=".concat(e.rendererType," gpuBlacklist=").concat(JSON.stringify(this.mGPUBlacklist)))}))),Y.A.add_monitor("props:".concat(t,":").concat(this.isWebGPUFeatureEnabled,":").concat(this.enableVBWasmBackend,":").concat(this.isWebGL2FeatureEnabled,":").concat(this.rendererType,":").concat(J.A.enableEchoDetection)),e.callback&&this.setCallback(e.callback),e.audioWorkletPath&&(this.audioWorkletJsPath=e.audioWorkletPath),e.e2eEncrypt?J.A.e2eencrypt=!0:J.A.e2eencrypt=!1;let a=e.enableWebtransport;if(this.isWebTransportAllowed||(a=!1),this._setWebtransportEnable({enable:a,webtransportPort:e.webtransportPort}),e.bandwidth?e.bandwidth.uplimit>=800?J.A.uplimit=1e3*(e.bandwidth.uplimit-120):J.A.uplimit=0:J.A.uplimit||(J.A.uplimit=0),e&&void 0!==e.useWebRTC){const t=!!e.useWebRTC;Oh.webrtcFlag=t,this.webrtcConfig.webrtcflag=t,(0,F.h)(t),!1===t&&this.wmscManager&&Y.A.add_monitor("WMSC_Not_Destory_ERROR")}if(!e.fromPreload&&this.vbResource){const{file:e}=this.vbResource;e&&(this.webrtcConfig.webrtcflag?Oh.initVB(this.updateWebRTCVideoStream.bind(this)):sr(e))}var n,s;e&&!1===e.isSessionBranding&&(J.A.enableCanvasAlphaChannel=!1),this.renderManager.setCanvasAlphaChannelEnability(J.A.enableCanvasAlphaChannel),null!=e&&e.mediasdkConfig&&J.A.enableWebrtcTurnServer&&(this.mediasdkConfig=e.mediasdkConfig,this.iceServers=(null===(n=this.mediasdkConfig)||void 0===n?void 0:n.iceServers)||[],null===(s=this.audioBridge)||void 0===s||s.setIceServers(this.iceServers))},async onRendererTypeSelected(){const e=await this.handleRendererTypeInProps(this.rendererType,this.defaultRendererType,this.mGPUBlacklist);this.renderManager.getRendererProvider().setRendererType(e.rendererType),this.rendererType=e.rendererType},async handleRendererTypeInProps(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e!==Nr.h3.AUTO&&e!==Nr.h3.UNDEFINED&&e!==Nr.h3.WEBGL&&e!==Nr.h3.WEBGL_2&&e!==Nr.h3.WEBGPU&&(e=Nr.h3.AUTO);let r=e,a=0;return e!==Nr.h3.AUTO&&e!==Nr.h3.UNDEFINED||(r=t),await F.Ay.isRendererTypeSupported(r,this.isWebGPUFeatureEnabled,this.isWebGL2FeatureEnabled,i)||(a=1,r=await F.Ay.evaluateRendererType(this.isWebGPUFeatureEnabled,this.isWebGL2FeatureEnabled,i)),{errNo:a,rendererType:r}},setRWGAgent(e){J.A.rwgAgent=e,this.addEventListenerForRWGAgent(e)},updateQosSubscription:function(e,t,i){var r;if(this.useAudioBridge&&(t===Q._c.AUDIO_DECODE||t===Q._c.AUDIO_ENCODE))return void(null===(r=this.audioBridge)||void 0===r||r.updateQos({enable:e,workerType:t,pollingInterval:i}));const a=t===Q._c.VIDEO_ENCODE||t===Q._c.VIDEO_DECODE;if(this.webrtcConfig.webrtcflag&&a){var n;this.wmscManager&&null!==(n=this.wmscManager)&&void 0!==n&&n.isJoinRWGSuccess?this.wmscManager.updateQosSubscription(e,t,i):this.webrtcConfig.subscribeQosParamsData[t]=[e,t,i]}else{let r=!0;this.isSupportVideoShare&&(t==Q._c.SHARING_DECODE&&(t=Q._c.VIDEO_DECODE,r=!1),t==Q._c.SHARING_ENCODE&&(t=Q._c.VIDEO_ENCODE,r=!1)),er(t,{enable:e,workerType:t,pollingInterval:i,isVideo:r},11,!1)}},addEventListenerForRWGAgent(e){e.on("message",this.rwgAgentMessageListenerWrapper)},rwgAgentMessageListener(e){if("string"!=typeof e.data)return;let t=JSON.parse(e.data);this.isDestroy||t.evt!==u.Bse||this.setRTCPeerConnectionDatachannelAnswer(t)},setRTCPeerConnectionDatachannelAnswer(e){if(e.evt===u.kqY||e.evt===u.FQb){if(xh("rwg answer",e),!e.answer)return;switch(e.answer.type){case Q.wd.ZOOM_CONNECTION_VIDEO:X.trigger(u.gh2.ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT,e);break;case Q.wd.ZOOM_CONNECTION_AUDIO:X.trigger(u.gh2.ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT,e)}}},async initVideoDataChannel(e,t,i){var r;if((null===(r=this.videoDataChannel)||void 0===r?void 0:r.connectionID)==e)return void(t&&this.videoDataChannel.checkEmptyUserIdAndResendMonitor(t));this.isInitVideoDataChannel=!1,this.videoDataChannel&&(this.videoDataChannel.forceClose(),H.Ay.error("video datachannel cid changed")),this.videoDataChannel=null;let a=gh(i);Y.A.add_monitor("INITVDC"),xh("initVideoDataChannel",e);let n=new Vr(this.dataTransportMgr,Q.Xt.VIDEO);n.sendDataChannelController(this.dataChannelController),n._netWorker=a,F.Ay.browser.isFirefox?n.delaycloseTimeout=15e3:n.delaycloseTimeout=5e3,n.setUserid(t),xh("rtc",n);let s=this;n.onConnectionCreated((async e=>{let t=e.localDescription;if(xh("localDesc",t),s.isDestroy)return;J.A.sendMessageToRwg(u.yJV,{evt:u.qw$,offer:{sdp:t.sdp,type:Q.wd.ZOOM_CONNECTION_VIDEO}},!1);let i=await n.waitForAnswerFromRWG(u.gh2.ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT);if(xh("jsEvent.PUBSUB_EVT.ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT",i),e!=n.rtcPeerConnection||n.isDestroyed())return;n.setRemoteDescription(i.answer),n.closeIfTimeout();let r=i.answer.sdp.match(/a=candidate:.+/)[0];xh("received candidate",r),r=r.replace(/^a=/,""),n.addIceCandidate(r),n.onDataChannelOpen((()=>{})),n.onDataChannelClose((()=>{wt(Q.wd.ZOOM_CONNECTION_VIDEO,Q.oB.NET_DATACHANNEL)}))})),n.initConnection(e).catch((e=>{xh.warn("initConnection",e),Y.A.add_monitor("INITVDCERR",e.message)})),this.videoDataChannel=n},async initAudioDataChannel(e,t,i){var r,a;if((null===(r=this.audioDataChannel)||void 0===r?void 0:r.connectionID)==e)return void(t&&this.audioDataChannel.checkEmptyUserIdAndResendMonitor(t));this.isInitAudioDataChannel=!1,this.audioDataChannel&&(null===(a=this.audioDataChannel)||void 0===a||a.forceClose(),H.Ay.error("audio datachannel cid changed")),this.audioDataChannel=null;let n=gh(i);Y.A.add_monitor("INITADC"),xh("initAudioDataChannel",e);let s=new Vr(this.dataTransportMgr,Q.Xt.AUDIO);s.sendDataChannelController(this.dataChannelController),s._netWorker=n,F.Ay.browser.isFirefox?s.delaycloseTimeout=15e3:s.delaycloseTimeout=5e3,s.setUserid(t),xh("rtc",s);let o=this;s.onConnectionCreated((async e=>{let t=e.localDescription;if(o.isDestroy)return;xh("localDesc",t),J.A.sendMessageToRwg(u.yJV,{evt:u.qw$,offer:{sdp:t.sdp,type:Q.wd.ZOOM_CONNECTION_AUDIO}},!1);let i=await s.waitForAnswerFromRWG(u.gh2.ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT);if(xh("answer",i),e!=s.rtcPeerConnection||s.isDestroyed())return;s.setRemoteDescription(i.answer),s.closeIfTimeout();let r=i.answer.sdp.match(/a=candidate:.+/)[0];xh("received candidate",r),r=r.replace(/^a=/,""),s.addIceCandidate(r),s.onDataChannelOpen((()=>{})),s.onDataChannelClose((()=>{wt(Q.wd.ZOOM_CONNECTION_AUDIO,Q.oB.NET_DATACHANNEL)}))})),s.initConnection(e,"ZoomWebclientAudioDataChannel").catch((e=>{xh.warn("initConnection",e),Y.A.add_monitor("INITADCERR",e.message)})),this.audioDataChannel=s},init_Notify_APPUI(e,t){let i=lr[t],r=e?i.success:i.fail;J.A.Notify_APPUI(r,i.callbackDataValue)},_setWebtransportEnable(e){let{enable:t,webtransportPort:i}=e;t?(F.I4.setIsSupportWebtransport(!0),J.A.webtransportPort=i||8802):F.I4.setIsSupportWebtransport(!1)},_previewInitWebtransport(e){let{conId:t,meetingNumber:i,rwgHost:r,webtransportPort:a,workType:n}=e;if(this._setWebtransportEnable({enable:!0,webtransportPort:a}),F.I4.getIsSupportWebtransport()){const e=n===Q._c.AUDIO_ENCODE,a=n===Q._c.AUDIO_DECODE,s=n===Q._c.VIDEO_ENCODE,o=n===Q._c.VIDEO_DECODE,d=e||a,c=d?"a":"v",u=e||s?2:1,h="https://".concat(r,":").concat(J.A.webtransportPort,"/wc/media/").concat(i,"?type=").concat(c,"&cid=").concat(t),l="".concat(h,"&mode=").concat(u);d?Yt(h):Jt(h);const p=J.A.SPECIAL_ID;let f="",g=null;e?(f="localAudioEncMGR",g=_t.nameMap.CREATE_AUDIO_ENCODE_HANDLE_SUCCESS):a?(f="localAudioDecMGR",g=_t.nameMap.CREATE_AUDIO_DECODE_HANDLE_SUCCESS):s?(f="localVideoEncMGR",g=_t.nameMap.CREATE_VIDEO_ENCODE_HANDLE_SUCCESS):o&&(f="localVideoDecMGR",g=_t.nameMap.CREATE_VIDEO_DECODE_HANDLE_SUCCESS);let m=J.A[f]&&J.A[f].map.get(p);m?m.postMessage({command:6,webtransportURL:l,_id:this._id}):_t.enqueueMessage({name:g,handler:()=>{m=J.A[f].map.get(p),m.postMessage({command:6,webtransportURL:l,_id:this._id})},direction:_t.direction.SDK_TO_SDK})}},_previewInitMediaWebsocket(e){let{websocketUrl:t,workType:i}=e;const r=J.A.SPECIAL_ID,a=i===Q._c.AUDIO_ENCODE,n=i===Q._c.AUDIO_DECODE,s=i===Q._c.VIDEO_ENCODE,o=i===Q._c.VIDEO_DECODE;a||n?Xt(t):Qt(t);let d="",c=null,u=0;a?(u=2,d="localAudioEncMGR",c=_t.nameMap.CREATE_AUDIO_ENCODE_HANDLE_SUCCESS):n?(u=5,d="localAudioDecMGR",c=_t.nameMap.CREATE_AUDIO_DECODE_HANDLE_SUCCESS):s?(u=2,d="localVideoEncMGR",c=_t.nameMap.CREATE_VIDEO_ENCODE_HANDLE_SUCCESS):o&&(u=5,d="localVideoDecMGR",c=_t.nameMap.CREATE_VIDEO_DECODE_HANDLE_SUCCESS);let h=J.A[d]&&J.A[d].map.get(r);h?h.postMessage({command:5,websocket_ip_address:"".concat(t,"&mode=").concat(u)}):_t.enqueueMessage({name:c,handler:()=>{h=J.A[d].map.get(r),h.postMessage({command:5,websocket_ip_address:"".concat(t,"&mode=").concat(u)})},direction:_t.direction.SDK_TO_SDK})},async previewInit(e){let{videoDecode:t,videoDataChannel:i,videoEncodeMediaWss:r,videoDecodeMediaWss:a,videoEncodeWebtransport:n,videoDecodeWebtransport:s,audioDecode:o,audioDataChannel:d,audioBridge:c,audioEncodeMediaWss:u,audioDecodeMediaWss:h,audioEncodeWebtransport:l,audioDecodeWebtransport:p}=e,f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Et(this))return!1;if(t){var g;let{urlParameters:e}=t||{};e=(null===(g=this.getFilePath)||void 0===g?void 0:g.call(this))||e;let i=await F.Ay.isSDKSupportMultiThread(),r=await F.Ay.isSDKSupportSIMD(),a=r&&i;await this.onRendererTypeSelected();let n={};n.rendererType=this.rendererType,this.isSupportVideoShare&=a,this.dataChannelController.setVideoShareModel(this.isSupportVideoShare),this.isSupportVideoShare?(n.workerJsFileUrl=e.vsmiworkerpath,n.workerWasmFileUrl=e.videoMSIMDWasm):a?(n.workerJsFileUrl=e.videoMSIMDWorkerPath,n.workerWasmFileUrl=e.videoMSIMDWasm):i?(n.workerJsFileUrl=e.videoMtWorkerPath,n.workerWasmFileUrl=e.videoMtWasm):r?(n.workerJsFileUrl=e.videoSIMDWorkerPath,n.workerWasmFileUrl=e.videoSIMDWasm):(n.workerJsFileUrl=e.videoWorkerPath,n.workerWasmFileUrl=e.videoWasm),n.integrityHelper=new F.gP(n.workerJsFileUrl,this.lateLoadedAssetsHash),yt.resetVideoDecode(!0),Tt(n,this)}if(i&&(f||this.hadsetpropsbeforeinit)){const{conId:e,userid:t}=i;this.initVideoDataChannel(e,t,this.networkerpath)}if(r){const{websocketUrl:e}=r;this._previewInitMediaWebsocket({websocketUrl:e,workType:Q._c.VIDEO_ENCODE})}if(a){const{websocketUrl:e}=a;this._previewInitMediaWebsocket({websocketUrl:e,workType:Q._c.VIDEO_DECODE})}if(n){const{conId:e,meetingNumber:t,rwgHost:i,webtransportPort:r}=n;this._previewInitWebtransport({conId:e,meetingNumber:t,rwgHost:i,webtransportPort:r,workType:Q._c.VIDEO_ENCODE})}if(s){const{conId:e,meetingNumber:t,rwgHost:i,webtransportPort:r}=s;this._previewInitWebtransport({conId:e,meetingNumber:t,rwgHost:i,webtransportPort:r,workType:Q._c.VIDEO_DECODE})}if(o){var m;let{urlParameters:e}=o||{};e=(null===(m=this.getFilePath)||void 0===m?void 0:m.call(this))||e;let t={};await F.Ay.isSDKSupportSIMD()?(t.workerJsFileUrl=e.audioSIMDWorkletPath,t.workerWasmFileUrl=e.audioSIMDWasm):(t.workerJsFileUrl=e.audioWorkerPath,t.workerWasmFileUrl=e.audioWasm),t.integrityHelper=new F.gP(t.workerJsFileUrl,this.lateLoadedAssetsHash),yt.resetAudioDecode(!0),Mt(t,this)}if(d&&(f||this.hadsetpropsbeforeinit)){const{conId:e,userid:t}=d;this.initAudioDataChannel(e,t,this.networkerpath)}if(c){if(this.useAudioBridge=!0,!F.Ay.isSupportPeerConnection())return void H.Ay.error("no support peer connection");const{nginxHost:e,rwgHost:t,cid:i,abToken:r,isCapturingAudio:a,audioMode:n,supportLocalAB:s,useWebRTCOnDesktop:o}=c;J.A.audioSolution="WEBRTC";let d="wss://".concat(s?t:e,"/ab/signal?rwg=").concat(t,"&cid=").concat(i);if(!this.audioBridge||this.audioBridge.cid!=i){if(this.audioBridge)try{this.audioBridge.destroy(!1),this.audioBridge=null,Oh.audioBridge=null}catch(e){H.Ay.error("destory webrtc audio error",e)}let e={jsPath:this.audioWorkletJsPath.audioLevelWorkletPath,wasmPath:this.audioWorkletJsPath.audioSIMDWasm};this.audioBridge=new ja(i,d,!a,this.codecDoAVSync,o||J.A.onDesktop,e,((e,t)=>{var i,r;switch(e){case"destroy":null===(i=this.audioBridge)||void 0===i||i.destroy(),this.audioBridge=null;break;case"updateConnectionResult":null===(r=this.audioPersistenceInfo)||void 0===r||r.updatewebRTCProbResult(t)}})),this.audioBridge.setIceServers(this.iceServers),Oh.audioBridge=this.audioBridge}a&&this.audioBridge.setRecvOnly(!1,Oh.audioStream),this.audioBridge.setCodecDoAVSync(this.codecDoAVSync),await this.audioBridge.join(!1,r,n)}if(u){const{websocketUrl:e}=u;this._previewInitMediaWebsocket({websocketUrl:e,workType:Q._c.AUDIO_ENCODE})}if(h){const{websocketUrl:e}=h;this._previewInitMediaWebsocket({websocketUrl:e,workType:Q._c.AUDIO_DECODE})}if(l){const{conId:e,meetingNumber:t,rwgHost:i,webtransportPort:r}=l;this._previewInitWebtransport({conId:e,meetingNumber:t,rwgHost:i,webtransportPort:r,workType:Q._c.AUDIO_ENCODE})}if(p){const{conId:e,meetingNumber:t,rwgHost:i,webtransportPort:r}=p;this._previewInitWebtransport({conId:e,meetingNumber:t,rwgHost:i,webtransportPort:r,workType:Q._c.AUDIO_DECODE})}f||this.hadsetpropsbeforeinit||H.Ay.directReport("previewinit before setprops")},previewUnInitRtcConnection(){Y.A.add_monitor("REINITRTC");try{var e,t;null===(e=this.videoDataChannel)||void 0===e||e.forceClose(),null===(t=this.audioDataChannel)||void 0===t||t.forceClose()}catch(e){xh.error("clear rtcPeerConnectionList err",e)}this.audioBridge&&(this.audioBridge.destroy(!1),this.audioBridge=null,Oh.audioBridge=null);const i=J.A.SPECIAL_ID;[J.A.localVideoEncMGR&&J.A.localVideoEncMGR.map.get(i),J.A.localVideoDecMGR&&J.A.localVideoDecMGR.map.get(i),J.A.localAudioEncMGR&&J.A.localAudioEncMGR.map.get(i),J.A.localAudioDecMGR&&J.A.localAudioDecMGR.map.get(i)].forEach((e=>{e&&(e.postMessage({command:3}),e.postMessage({command:4,_id:this._id}))}))},doesSafariSupportWebcodec:()=>!F.Ay.isMacIntelSafari()&&F.Ay.isSafariVersionHigherThan("17.5")&&J.A.enableSafariHWCodec,_enableHardWareDecode(){return!(2&J.A.disableHWCodec)&&(F.Ay.isAndroidBrowser()?F.Ay.isChromeVersionHigherThan(124)&&J.A.enableAndroidHWCodec:F.Ay.isChromeVersionHigherThan(95)||this.doesSafariSupportWebcodec())},async initVideoEncode(e,t,i){var r,a;let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,d=arguments.length>6?arguments[6]:void 0,u=arguments.length>7?arguments[7]:void 0,h=arguments.length>9?arguments[9]:void 0,l=arguments.length>10?arguments[10]:void 0,p=arguments.length>11&&void 0!==arguments[11]&&arguments[11],f=arguments.length>12?arguments[12]:void 0,g=arguments.length>13&&void 0!==arguments[13]&&arguments[13];if((F.Ay.isAndroidBrowser()&&!F.Ay.isMTRAndroid()||F.Ay.isIphoneOrIpadBrowser())&&(p=!0,void 0===l&&(l=!0)),F.Ay.isAndroidBrowser()&&!F.Ay.isMTRAndroidWithSAB()?this.platformType=2:F.Ay.isIphoneOrIpadBrowser()&&(this.platformType=3),d=(0,F.OC)(),this.userId=i,!Et(this))return!1;if(Y.A.add_monitor("INITVE"),this.webrtcConfig.webrtcflag&&!g)return this.initVEPara=arguments,this.resolveVEwebrtcpromise(!0),Y.A.add_monitor("WMSC_INITVE"),this._initWMSC(t,o,Q._c.VIDEO_ENCODE,i);this.setMultiView(d,J.A.enableMultiDecodeVideoWithoutSAB),this.isSupportVideoFrameOrBitmapCapture=this.isSupportMediaStreamTrackProcessor,xh("initVideoEncode"),Va.setUserId(i),yt.resetVideoEncode(f),this.is32bitbrowser=await F.Ay.is32bitChrome();let m=await F.Ay.isSDKSupportMultiThread();F.I4.setIsSupportVirtualBackground(!this.isTeslaMode&&!F.Ay.isAndroidBrowser()&&!u&&(m||J.A.enableVirtualBackgroundWithoutSAB));const v=F.I4.getIsSupportVirtualBackground()&&!this.webrtcConfig.webrtcflag;let A=await F.Ay.isSDKSupportSIMD(),S=A&&m,_={},y=!1,C=F.Ay.graphicName,b=!!C&&C.includes("amd");this.isAppleGraphic=!!C&&(C.includes("apple m1")||C.includes("apple m2")),(F.Ay.isIphoneOrIpadBrowser()||F.Ay.isIpadOS()||navigator.hardwareConcurrency&&navigator.hardwareConcurrency>7||await F.Ay.VP9MachineDetect()&&b&&navigator.hardwareConcurrency&&navigator.hardwareConcurrency>=4)&&h&&(y=!0),(F.Ay.isIphoneOrIpadSafari()&&!F.Ay.isSupportVideoFrame()||F.Ay.isAndroidBrowser()&&F.Ay.isAndroidVersionLessEqual(10))&&(y=!1),this.isSupportVideoShare&=S,Y.A.add_monitor("isMT: "+m),Y.A.add_monitor("isenbaleHD: "+h),Y.A.add_monitor("ENABLE720:"+y),Y.A.add_monitor("ISVSV:"+this.isSupportVideoShare),Y.A.add_monitor("graphicname: "+C),this.is32bitbrowser&&Y.A.add_monitor("is32chrome: "+this.is32bitbrowser);let w=!(1&J.A.disableHWCodec),E=w&&l;if(m&&(h||p)&&(this.isSupportMediaStreamTrackProcessor&&F.Ay.isChromeVersionHigherThan(95)&&(!F.Ay.isAndroidBrowser()||J.A.enableAndroidHWCodec)||this.doesSafariSupportWebcodec())&&this.isWebCodecEncoderOnWhitelist?(this.videoencodehardwareflag=w&&await F.Ay.IsSupportVideoEncodeHardwareAcceleration(),l=this.videoencodehardwareflag):(this.videoencodehardwareflag=!1,l=!1),Y.A.add_monitor("EOWL:"+this.isWebCodecEncoderOnWhitelist),Y.A.add_monitor("VIHD:"+this.videoencodehardwareflag),Y.A.add_monitor("enableHW: "+l),e=(null===(r=this.getFilePath)||void 0===r?void 0:r.call(this))||e,this.isSupportVideoShare?(_.workerJsFileUrl=e.vsmiworkerpath,_.workerWasmFileUrl=e.videoMSIMDWasm):S?(_.workerJsFileUrl=e.videoMSIMDWorkerPath,_.workerWasmFileUrl=e.videoMSIMDWasm):m?(_.workerJsFileUrl=e.videoMtWorkerPath,_.workerWasmFileUrl=e.videoMtWasm):A?(_.workerJsFileUrl=e.videoSIMDWorkerPath,_.workerWasmFileUrl=e.videoSIMDWasm):(_.workerJsFileUrl=e.videoWorkerPath,_.workerWasmFileUrl=e.videoWasm),_.integrityHelper=new F.gP(_.workerJsFileUrl,this.lateLoadedAssetsHash),!f){let e=new(c())(t).searchParams.get("cid"),r=new(c())(t).host;F.I4.getIsSupportWebtransport()&&Jt("https://".concat(r,":").concat(J.A.webtransportPort,"/wc/media/").concat(o,"?type=v&cid=").concat(e)),this.previewInit({videoDataChannel:{conId:e,userid:i}},!0)}let R=1,T=!1,I=!1;const M=v&&m;M&&l?(R=3,T=!0,I=!!E):M||l?(R=2,l&&(T=!0,I=!!E)):(this.isSupportVideoShare||m)&&(R=2);let D=T&&I&&y;F.Ay.set720pcapacity(D),Y.A.add_monitor("CAPTURE720:"+D),Y.A.add_monitor("VETNum:"+R),I=I&&(!this.isAppleGraphic||F.Ay.isChromeVersionHigherThan(116)&&(!F.Ay.isAndroidBrowser()||J.A.enableAndroidHWCodec)||this.doesSafariSupportWebcodec()),await this.onRendererTypeSelected(),Y.A.add_monitor("SupportWebCodecEncode: "+I);let P={log:n,confId:i,meetingid:s,meetingnumb:o,videodecodethreadnumb:d,isSupportMultiThread:m,videoencodethreadnumb:R,isSupportVirtualBackground:v,isSupportWebCodecEnocde:T,initWebCodecFlag:I,is360penablehwenc:p,enable720p:y,platformType:this.platformType,rendererType:this.rendererType,IsRenderInWorker:this.checkIsRenderInWorker()&&!F.I4.getIsRenderSelfVideoInEncodeWorker(!0),webrtcvideo:this.webrtcConfig.webrtcflag,MaskFlag:!!J.A.rwgAgent,isSafari:null===(a=F.Ay.browser)||void 0===a?void 0:a.isSafari};if(console.log("VP9?:",await F.Ay.VP9MachineDetect(),"AMD?:",F.Ay.isAMDGraphic(),"AMDdecodecheck:",F.Ay.isGraphicShouldUseHardwareAccelerationDecode(),"isenbaleHD:"+h+" enable720p?:",y,"capacityfor720:",D),zt(t,P),!Et(this))return!1;if(await Ct(_,this),J.A.extVBPort&&this.addVbReceiver(J.A.extVBPort),this.dataChannelController.setVideoShareModel(this.isSupportVideoShare),f||this.isDestroy)return;let k=this;this.allpromises.push(J.A.videoInitInstance.initSuccessPromise);let O=null;return this.bVideoDecodeUsingSAB&&!this.videoEncodeRingBuffer&&(m?(O=!0,this.videoEncodeRingBuffer=!0):(O=le.getStorageForCapacity(),this.videoEncodeRingBuffer=O)),await J.A.videoInitInstance.initSuccessPromise.then((e=>!!Et(k)&&(e&&this.bVideoEncodeUsingSAB&&O&&er(Q._c.VIDEO_ENCODE,{interval:this.bVideoEncodeMainThreadConsumerIntervalEnable,data:m?null:{buffer:O,offset:0,length:O.byteLength}},"VIDEO_ENCODE_SAB",!1,!0),e))).then((e=>(Y.A.add_monitor("INITVERET-".concat(k._id,"-").concat(e&&!k.isDestroy)),!!Et(k)&&(g||this.init_Notify_APPUI(e,Q._c.VIDEO_ENCODE),_t.subscribeMessage(_t.nameMap.INIT_VIDEO_ENCODE_SUCCESS),gt(Q._c.VIDEO_ENCODE),k.waitingVcChannelReady&&k.addChannelForVideo(),e))))},async _initWMSC(e,t,i,r){const a=new Date;return(0,F.DR)().then((n=>{let{WMSCManager:s}=n;if(this.webrtcConfig.currentReloadTimes=0,!e||!t||!r||this.isDestroy)return void Y.A.add_monitor("WMSC_Stop_Init: ".concat(this.isDestroy));const o=()=>{const e={[Q._c.VIDEO_ENCODE]:_t.nameMap.INIT_VIDEO_ENCODE_SUCCESS,[Q._c.VIDEO_DECODE]:_t.nameMap.INIT_VIDEO_DECODE_SUCCESS};this.init_Notify_APPUI(!0,i),_t.subscribeMessage(e[i]),Y.A.add_monitor("WMSC_".concat(e[i]))};if(!this.wmscManager){const i=new Date;Y.A.add_monitor("WMSC_Load_Time: ".concat(i-a));const n=new(c())(e).host,o=new(c())(e).searchParams.get("cid"),d="wss://".concat(n,"/wc/media/").concat(t,"?type=v&cid=").concat(o,"&mode=16"),u="WMSC_WSS_URL: rwgHost:".concat(n,"|cid: ").concat(o);Y.A.add_monitor(u),this.wmscManager=new s({webRTCWebSocketUrl:d,confId:o,nodeId:r,HDVideo:this.isVideoHD,mediaStreamController:Oh,iceServers:this.iceServers,videoCodecConfig:this.webrtcVideoCodecConfig})}var d;return this.isDestroy?(Y.A.add_monitor("WMSC_Destory_Init: ".concat(this.isDestroy)),void(null===(d=this.wmscManager)||void 0===d||d.destroy())):this.wmscManager.isJoinRWGSuccess?o():this.wmscManager.waitJoinRWGSuccess().then((()=>{if(o(),"{}"!==JSON.stringify(this.webrtcConfig.subscribeQosParamsData)){Y.A.add_monitor("WMSC_Update_Qos_Subscription_Async");for(const e in this.webrtcConfig.subscribeQosParamsData){const t=this.webrtcConfig.subscribeQosParamsData[e];this.wmscManager.updateQosSubscription(...t)}this.webrtcConfig.subscribeQosParamsData={}}}))})).catch((a=>{const{currentReloadTimes:n,maxReloadTimes:s}=this.webrtcConfig;if(n>=s)return H.Ay.error("WMSC_JS_LOAD_FAIL_FAILOVER"),void J.A.Notify_APPUI(u.EPZ);setTimeout((()=>(H.Ay.error("WMSCf_IMPORT_FAIL ".concat(this.webrtcConfig.currentReloadTimes),a),this.webrtcConfig.currentReloadTimes+=1,this._initWMSC(e,t,i,r))),1e3)}))},async initVideoDecode(e,t,i){var r;let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0,u=arguments.length>9&&void 0!==arguments[9]&&arguments[9];if((F.Ay.isAndroidBrowser()&&!F.Ay.isMTRAndroid()||F.Ay.isIphoneOrIpadBrowser())&&void 0===d&&(d=!0),this.userId=i,o=(0,F.OC)(),!Et(this))return!1;let h=!1;if(this.webrtcConfig.webrtcflag&&!u)return Y.A.add_monitor("WMSC_INITVD"),this.initVDPara=arguments,this.resolveVDwebrtcpromise(!0),this._initWMSC(t,s,Q._c.VIDEO_DECODE,i).then((()=>{J.A.webrtcVideoInited=!0}));this.webrtcConfig.webrtcflag||u||!J.A.webrtcVideoInited||(J.A.webrtcVideoInited=!1,h=!0),yt.resetVideoDecode(!1),xh("initVideoDecode"),Y.A.add_monitor("INITVD"),Y.A.add_monitor("DOWL:"+this.isWebCodecDecoderOnWhitelist),this.setMultiView(o,J.A.enableMultiDecodeVideoWithoutSAB),o>1&&!J.A.enableMultiDecodeVideoWithoutSAB&&((0,F.uF)()||F.Ay.isWebGL2Supported(this.isWebGL2FeatureEnabled))?this.codecDoAVSync=!0:this.codecDoAVSync=!1,this.is32bitbrowser=await F.Ay.is32bitChrome();let l=await F.Ay.isSDKSupportMultiThread(),p=await F.Ay.isSDKSupportSIMD(),f=p&&l,g={};this.isEnableVideoDecodeHardWareThread=l&&this._enableHardWareDecode(),d&&this.isEnableVideoDecodeHardWareThread?(this.videodecodehardwareflag=await F.Ay.IsSupportVideoDecodeHardwareAcceleration(J.A.enableHADecOpt),d=this.videodecodehardwareflag):d=!1,this.isSupportVideoShare&=f,Y.A.add_monitor("isMT:"+l),Y.A.add_monitor("SIMD:"+p),Y.A.add_monitor("VDHT:"+this.isEnableVideoDecodeHardWareThread),Y.A.add_monitor("VDHW:"+this.videodecodehardwareflag),Y.A.add_monitor("SupportWebCodecDecode:".concat(d)),e=(null===(r=this.getFilePath)||void 0===r?void 0:r.call(this))||e,this.dataChannelController.setVideoShareModel(this.isSupportVideoShare),this.isSupportVideoShare?(g.workerJsFileUrl=e.vsmiworkerpath,g.workerWasmFileUrl=e.videoMSIMDWasm):f?(g.workerJsFileUrl=e.videoMSIMDWorkerPath,g.workerWasmFileUrl=e.videoMSIMDWasm):l?(g.workerJsFileUrl=e.videoMtWorkerPath,g.workerWasmFileUrl=e.videoMtWasm):p?(g.workerJsFileUrl=e.videoSIMDWorkerPath,g.workerWasmFileUrl=e.videoSIMDWasm):(g.workerJsFileUrl=e.videoWorkerPath,g.workerWasmFileUrl=e.videoWasm),g.integrityHelper=new F.gP(g.workerJsFileUrl,this.lateLoadedAssetsHash);let m=new(c())(t).searchParams.get("cid"),v=new(c())(t).host;F.I4.getIsSupportWebtransport()&&Jt("https://".concat(v,":").concat(J.A.webtransportPort,"/wc/media/").concat(s,"?type=v&cid=").concat(m)),this.previewInit({videoDataChannel:{conId:m,userid:i}},!0);let A=d&&this.isEnableVideoDecodeHardWareThread&&o>1&&navigator.hardwareConcurrency&&navigator.hardwareConcurrency>=4;F.Ay.setsub1080pcapacity(A);let S=this.platformType;if(F.Ay.isAndroidBrowser()&&!F.Ay.isMTRAndroidWithSAB()?S=2:F.Ay.isIphoneOrIpadBrowser()&&(S=3),await this.onRendererTypeSelected(),zt(t,{log:a,confId:i,meetingid:n,meetingnumb:s,videodecodethreadnumb:o,isFirefox:F.Ay.browser.isFirefox,isSupportMultiThread:l,isSupportOffscreenCanvas:this.isSupportOffscreenCanvas,isenablehw:d,isEnableVideoDecodeHardWareThread:this.isEnableVideoDecodeHardWareThread,isEnableHardWareThread:this.isEnableHardWareThread,isTeslaMode:this.isTeslaMode,platformType:S,rendererType:this.rendererType,isWebCodecDecoderOnWhitelist:this.isWebCodecDecoderOnWhitelist,webrtcvideo:this.webrtcConfig.webrtcflag}),!Et(this))return!1;if(await Tt(g,this),!Et(this))return!1;let _=this;this.allpromises.push(J.A.videoDecInitInstance.initSuccessPromise);let y=null;return this.bVideoDecodeUsingSAB&&!this.videoDecodeRingBuffer&&(l?(y=!0,this.videoDecodeRingBuffer=!0):(y=le.getStorageForCapacity(),this.videoDecodeRingBuffer=y)),await J.A.videoDecInitInstance.initSuccessPromise.then((async e=>!!Et(_)&&(e&&this.bVideoDecodeUsingSAB&&y&&er(Q._c.VIDEO_DECODE,l?null:{buffer:y,offset:0,length:y.byteLength},"VIDEO_DECODE_SAB_FROM_DATACHANNEL",!1,!0),e))).then((e=>(Y.A.add_monitor("INITVDRET-".concat(_._id,"-").concat(e&&!_.isDestroy)),!!Et(_)&&(u||this.init_Notify_APPUI(e,Q._c.VIDEO_DECODE),_t.subscribeMessage(_t.nameMap.INIT_VIDEO_DECODE_SUCCESS),gt(Q._c.VIDEO_DECODE),_.waitingVcChannelReady&&_.addChannelForVideo(),e&&h&&H.Ay.directReport("video fallback to wasm successfully"),e))))},async initAudioEncode(e,t,i){var r;let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,d=arguments.length>8?arguments[8]:void 0;if(this.userId=i,xh("initAudioEncode"),!Et(this))return!1;Y.A.add_monitor("INITAE"),Va.setUserId(i),yt.resetAudioEncode(d),this.is32bitbrowser=await F.Ay.is32bitChrome();let u={},h=await F.Ay.isSDKSupportSIMD();if(e=(null===(r=this.getFilePath)||void 0===r?void 0:r.call(this))||e,h?(u.workerJsFileUrl=e.audioSIMDWorkletPath,u.workerWasmFileUrl=e.audioSIMDWasm):(u.workerJsFileUrl=e.audioWorkerPath,u.workerWasmFileUrl=e.audioWasm),u.integrityHelper=new F.gP(u.workerJsFileUrl,this.lateLoadedAssetsHash),!d){let e=new(c())(t).searchParams.get("cid"),r=new(c())(t).host;F.I4.getIsSupportWebtransport()&&Yt("https://".concat(r,":").concat(J.A.webtransportPort,"/wc/media/").concat(s,"?type=a&cid=").concat(e)),this.previewInit({audioDataChannel:{conId:e,userid:i}},!0)}if(this.audioCtx||(this.audioCtx=(0,F.Bw)()),qt(t,{sampleRate:this.audioCtx.sampleRate,userid:i,log:a,meetingid:n,meetingnumb:s,videodecodethreadnumb:o}),!Et(this))return!1;if(await It(u,this),d||this.isDestroy)return;let l=this;this.allpromises.push(J.A.audioEncodeInitInstance.initSuccessPromise);let p=null;return this.bAudioDecodeUsingSAB&&!this.audioEncodeRingBuffer&&(p=le.getStorageForCapacity(100),this.audioEncodeRingBuffer=p),await J.A.audioEncodeInitInstance.initSuccessPromise.then((e=>!l.isDestroy&&(e&&this.bAudioEncodeUsingSAB&&p&&er(Q._c.AUDIO_ENCODE,{buffer:p,offset:0,length:p.byteLength,bAudioEncodeMainThreadConsumerIntervalEnable:!1},"audioEncodeSAB",!1,!0),e))).then((e=>(Y.A.add_monitor("INITAERET-".concat(l._id,"-").concat(e&&!l.isDestroy)),!!Et(l)&&(this.init_Notify_APPUI(e,Q._c.AUDIO_ENCODE),gt(Q._c.AUDIO_ENCODE),e))))},async initAudioDecode(e,t,i){var r;let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;if(this.userId=i,!Et(this))return!1;yt.resetAudioDecode(!1),xh("initAudioDecode"),Va.setUserId(i);let d=!1;"WEBRTC"===J.A.audioSolution&&(d=!0),J.A.audioSolution="WASM",Y.A.add_monitor("INITAD"),this.is32bitbrowser=await F.Ay.is32bitChrome();let u=new(c())(t).searchParams.get("cid"),h=new(c())(t).host,l={};e=(null===(r=this.getFilePath)||void 0===r?void 0:r.call(this))||e,l.workerJsFileUrl=e.audioWorkerPath,l.workerWasmFileUrl=e.audioWasm,F.I4.getIsSupportWebtransport()&&Yt("https://".concat(h,":").concat(J.A.webtransportPort,"/wc/media/").concat(s,"?type=a&cid=").concat(u)),this.previewInit({audioDataChannel:{conId:u,userid:i}},!0);let p=await F.Ay.isSDKSupportMultiThread();if(await F.Ay.isSDKSupportSIMD()?(l.workerJsFileUrl=e.audioSIMDWorkletPath,l.workerWasmFileUrl=e.audioSIMDWasm):(l.workerJsFileUrl=e.audioWorkerPath,l.workerWasmFileUrl=e.audioWasm),l.integrityHelper=new F.gP(l.workerJsFileUrl,this.lateLoadedAssetsHash),this.audioCtx||(this.audioCtx=(0,F.Bw)()),qt(t,{sampleRate:this.audioCtx.sampleRate,userid:i,log:a,meetingid:n,meetingnumb:s,videodecodethreadnumb:o,isSupportMultiThread:p}),!Et(this))return!1;if(await Mt(l,this),!Et(this))return!1;let f=this;this.allpromises.push(J.A.audioDecInitInstance.initSuccessPromise);let g=null;return this.bAudioDecodeUsingSAB&&!this.audioDecodeRingBuffer&&(g=le.getStorageForCapacity(100),this.audioDecodeRingBuffer=g),await J.A.audioDecInitInstance.initSuccessPromise.then((async e=>!f.isDestroy&&(Y.A.add_monitor("ADIP"+!!e),e&&this.bAudioDecodeUsingSAB&&g&&await er(Q._c.AUDIO_DECODE,{buffer:g,offset:0,length:g.byteLength},"audioDecodeSAB",!1,!0),e))).then((e=>(Y.A.add_monitor("INITADRET-".concat(f._id,"-").concat(e&&!f.isDestroy)),!!Et(f)&&(e&&d&&H.Ay.directReport("fallback to wasm solution successfully"),this.init_Notify_APPUI(e,Q._c.AUDIO_DECODE),gt(Q._c.AUDIO_DECODE),e))))},async initSharingDecode(e,t,i){var r;let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0;if(!Et(this))return!1;Y.A.add_monitor("INITSD");let o=await F.Ay.isSDKSupportSIMD(),d=await F.Ay.isSDKSupportMultiThread(),c=o&&d;if(this.isSupportVideoShare&=c,this.isSupportVideoShare&&this.webrtcConfig.webrtcflag)try{await this.webrtcVDpromise,await this.initVideoDecode(...this.initVDPara,!0)}catch(e){Y.A.add_monitor("INITVDSDF")}if(this.userId=i,this.recordSharingParamInfo(),this.isSupportVideoShare){this.allpromises.push(J.A.sharingDecInitInstance.socketSuccessPromise);let e=this;return await J.A.sharingDecInitInstance.handlerSuccessPromise,await J.A.sharingDecInitInstance.socketSuccessPromise.then((t=>(Y.A.add_monitor("INITSDRET-".concat(e._id,"-").concat(t&&!e.isDestroy)),!!Et(e)&&(this.init_Notify_APPUI(t,Q._c.SHARING_DECODE),gt(Q._c.SHARING_DECODE),t))))}this.dataChannelController.setVideoShareModel(this.isSupportVideoShare),this.is32bitbrowser=await F.Ay.is32bitChrome(),await this.onRendererTypeSelected(),e=(null===(r=this.getFilePath)||void 0===r?void 0:r.call(this))||e;let u={};if(c?(u.workerJsFileUrl=e.sharingMSIMDWorkerPath,u.workerWasmFileUrl=e.videoMSIMDWasm):d?(u.workerJsFileUrl=e.sharingMtWorkerPath,u.workerWasmFileUrl=e.videoMtWasm):o?(u.workerJsFileUrl=e.sharingSIMDWorkerPath,u.workerWasmFileUrl=e.videoSIMDWasm):(u.workerJsFileUrl=e.sharingWorkerPath,u.workerWasmFileUrl=e.videoWasm),u.integrityHelper=new F.gP(u.workerJsFileUrl,this.lateLoadedAssetsHash),Kt(t,{log:a,userid:i,meetingid:n,meetingnumb:s,isSupportMultiThread:d,rendererType:this.rendererType,isWebCodecDecoderOnWhitelist:this.isWebCodecDecoderOnWhitelist}),!Et(this))return!1;if(await Dt(u,this),!Et(this))return!1;this.allpromises.push(J.A.sharingDecInitInstance.initSuccessPromise);let h=this;return await J.A.sharingDecInitInstance.initSuccessPromise.then((e=>(Y.A.add_monitor("INITSDRET-".concat(h._id,"-").concat(e&&!h.isDestroy)),!!Et(h)&&(this.init_Notify_APPUI(e,Q._c.SHARING_DECODE),gt(Q._c.SHARING_DECODE),e))))},async initSharingEncode(e,t,i){var r;let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0;Y.A.add_monitor("INITSE");let o=await F.Ay.isSDKSupportSIMD(),d=await F.Ay.isSDKSupportMultiThread(),c=o&&d;if(this.isSupportVideoShare&=c,this.isSupportVideoShare&&this.webrtcConfig.webrtcflag)try{await this.webrtcpromise,11==this.initVEPara.length?await this.initVideoEncode(...this.initVEPara,!1,!1,!0):await this.initVideoEncode(...this.initVEPara,!0)}catch(e){Y.A.add_monitor("INITVESEF")}if(this.userId=i,!Et(this))return!1;if(this.isSupportVideoShare){this.allpromises.push(J.A.sharingEncInitInstance.socketSuccessPromise);let e=this;return await J.A.sharingEncInitInstance.handlerSuccessPromise,await J.A.sharingEncInitInstance.socketSuccessPromise.then((t=>(Y.A.add_monitor("INITSERET-".concat(e._id,"-").concat(t&&!e.isDestroy)),!!Et(e)&&(this.init_Notify_APPUI(t,Q._c.SHARING_ENCODE),gt(Q._c.SHARING_ENCODE),F.Ay.getGpuInfo().isWebGLContextInvalid&&(0,We.iK)(u.AoB,{reason:"WebGLContextInvalid"}),t))))}e=(null===(r=this.getFilePath)||void 0===r?void 0:r.call(this))||e,this.is32bitbrowser=await F.Ay.is32bitChrome(),await this.onRendererTypeSelected();let h={};if(c?(h.workerJsFileUrl=e.sharingMSIMDWorkerPath,h.workerWasmFileUrl=e.videoMSIMDWasm):d?(h.workerJsFileUrl=e.sharingMtWorkerPath,h.workerWasmFileUrl=e.videoMtWasm):o?(h.workerJsFileUrl=e.sharingSIMDWorkerPath,h.workerWasmFileUrl=e.videoSIMDWasm):(h.workerJsFileUrl=e.sharingWorkerPath,h.workerWasmFileUrl=e.videoWasm),h.integrityHelper=new F.gP(h.workerJsFileUrl,this.lateLoadedAssetsHash),Kt(t,{log:a,userid:i,meetingid:n,meetingnumb:s,isSupportMultiThread:d,rendererType:this.rendererType}),!Et(this))return!1;if(await Pt(h,this),!Et(this))return!1;let l=this;return this.allpromises.push(J.A.sharingEncInitInstance.initSuccessPromise),await J.A.sharingEncInitInstance.initSuccessPromise.then((e=>(Y.A.add_monitor("INITSERET-".concat(l._id,"-").concat(e&&!l.isDestroy)),!!Et(l)&&(this.init_Notify_APPUI(e,Q._c.SHARING_ENCODE),gt(Q._c.SHARING_ENCODE),e))))},JsMediaSDK_UnInit:function(){Ui(),this.videoRenderArray.length&&this.videoRenderArray.forEach((function(e){e.display&&(e.display.cleanup(),e.display=null)})),J.A._callbackList=[],J.A._Notify_APPUI=null,(0,We._G)(null)},StartAudioMediaCapture:function(){let e=Eh.draftAudioConstraints(this);Oh.startCaptureAudio({audioConstraints:e,successHandler:this.handleAudioCapture.bind(this),errorHandler:t=>{Eh.checkCaptureNeedDeviceFallback(e,t)?(H.Ay.error("[Audio] checkCaptureNeedDeviceFallback, retrying..."),Oh.startCaptureAudio({audioConstraints:e,successHandler:this.handleAudioCapture.bind(this),errorHandler:this.handleAudioError.bind(this)})):this.handleAudioError(t)}})},StartDesktopMediaCapture:async function(){if(this.desktopSharingValue.audioOnly){try{const e=await navigator.mediaDevices.getUserMedia({audio:{deviceId:this.desktopSharingValue.deviceId?{exact:this.desktopSharingValue.deviceId}:F.Ay.browser.isChrome?{exact:"default"}:void 0,echoCancellation:this.desktopSharingValue.echoCancellation,noiseSuppression:this.desktopSharingValue.noiseSuppression,autoGainControl:this.desktopSharingValue.autoGainControl,sampleRate:this.desktopSharingValue.sampleRate||48e3}});this.handleDesktopCapture(e,!0)}catch(e){this.handleCaptureError(e)}return}if(this.desktopSharingValue.sourceId){const e=this.desktopSharingValue.sourceId;try{const t=await navigator.mediaDevices.getUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e}}});this.handleDesktopCapture(t)}catch(e){this.handleCaptureError(e)}return}const e=this.handleDesktopCapture.bind(this),t=this.handleCaptureError.bind(this);if(this.desktopSharingValue.share2ndCamera){const i=this.desktopSharingValue.share2ndCameraParams||{},r=i.VideoSelectValue?{exact:i.VideoSelectValue}:void 0,a=i.frameRate?{ideal:i.frameRate}:void 0,n={deviceId:r,width:i.width||640,height:i.height||360,frameRate:a};let s=!1;i.AudioSelectValue&&(s={noiseSuppression:null==i?void 0:i.noiseSuppression,autoGainControl:null==i?void 0:i.autoGainControl,echoCancellation:null==i?void 0:i.echoCancellation,sampleRate:i.sampleRate||48e3,deviceId:{exact:i.AudioSelectValue}});const o={video:n,audio:s};return void navigator.mediaDevices.getUserMedia(o).then(e,t)}const i=this.desktopSharingValue.videoParams,r=navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints(),a=r&&!!r.displaySurface&&i&&i.displaySurface;if(navigator.mediaDevices.getDisplayMedia){let r=!(!F.Ay.isSupportSharedArrayBuffer()&&!this.audioBridge||!this.desktopSharingValue.showShareAudioOption)&&{autoGainControl:!1,noiseSuppression:!1,echoCancellation:!F.Ay.isSupportSharingStereo()},n=this.desktopSharingValue.videoParams||!0;a&&("object"==typeof n?n.displaySurface=i.displaySurface:"boolean"==typeof n&&(n={displaySurface:i.displaySurface}));let s=Ph({video:n,audio:r},this.desktopSharingValue.otherParams);navigator.mediaDevices.getDisplayMedia(s).then(e,t)}},StartVideoMediaCapture:async function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const i=this.videoCaptureValue,r={encode:this.isStartVideoCapture,preview:this.isMaskSettingOn||this.isVBSettingOn};Y.A.add_monitor("STARTVIDEOMEDIA:".concat(r.encode,":").concat(r.preview)),Oh.startCaptureVideo({videoConstraints:this.videoCaptureValue?{videoSource:this.videoCaptureValue.VideoSelectValue,usingFacingMode:this.videoCaptureValue.usingFacingMode,width:this.videoCaptureValue.width,height:this.videoCaptureValue.height,pan:this.videoCaptureValue.pan,tilt:this.videoCaptureValue.tilt,zoom:this.videoCaptureValue.zoom,fps:this.videoCaptureValue.fps}:null,timeout:this.videoCaptureValue?this.videoCaptureValue.timeout:null,successHandler:async e=>{var a;if(wh.hasMediaStreamFrameProcessor()){wh.removeStream(),wh.setStream(e);const t=wh.getStream();Oh.processedStream=t}if(!Et(this,"videocapture"))return Oh.enableReuseStream(!1),Oh.destoryVideoMediaStream(),void H.Ay.error("VideoCaptureException successed sdkinstance has destroyed");if((null===(a=this.videoCaptureValue)||void 0===a?void 0:a.videoCtrl)===(null==i?void 0:i.videoCtrl)&&(this.videoCaptureValue=i),Oh.videoConstraints){const{width:e,height:t}=Oh.videoConstraints;e&&t&&(this.videoCaptureWidth=e instanceof Object?e.ideal:e,this.videoCaptureHeight=t instanceof Object?t.ideal:t)}let n=!1;try{var s;const i=e.getVideoTracks()[0]||{};if(Y.A.add_monitor("WMSC_Stream_ Capture_Success: ".concat(null==i?void 0:i.muted,"|").concat(null==i?void 0:i.readyState,"|").concat(!(null===(s=this.videoCaptureValue)||void 0===s||!s.videoCtrl))),this.webrtcConfig.webrtcflag)if(this.wmscManager){var o;t&&J.A.Notify_APPUI(u.ssE,this.userId);const e=Oh.getVideoStream();null!==(o=this.wmscManager)&&void 0!==o&&o.vbSettingVideoDom&&(this.wmscManager.vbSettingVideoDom.srcObject=e),await this.handleWebRTCStream("streamCaptureSuccess",e),await this.handleWebrtcVideoCapture(e),n=!0}else{const e="WMSC_Capture_Success_Handle_Fail:".concat(!!this.wmscManager,"|").concat(this.isStartVideoCapture,"|streamCaptureSuccess");Y.A.add_monitor(e),H.Ay.error(e)}else await this.handleWasmVideoCapture(e,r),n=!0;if(Y.A.add_monitor("STARTVIDEORET:".concat(n,"|").concat(null==i?void 0:i.muted)),n){Y.A.add_monitor("VCMS"),i.onended=async()=>{if(!await Va.hasPermission("camera"))return Y.A.add_monitor("VTRS:"+i.readyState+"R"),void(0,We.iK)(u.x3x,We.pg.PERMISSION_RESET);let e=await Va.getDeviceListAsync(),t=!1;e.forEach((e=>{"videoinput"===e.kind&&e.label===i.label&&e.deviceId===i.getSettings().deviceId&&(t=!0)})),t?(Y.A.add_monitor("VTRS:"+i.readyState+"I"),(0,We.iK)(u.x3x,We.pg.EXCEPTION)):Y.A.add_monitor("VTRS:"+i.readyState+"L"),Si({command:"healthCheck",op:2,type:0}),H.Ay.error("video media track ended")},i.onmute=async()=>{Y.A.add_monitor("VTMS:"+i.muted),H.Ay.directReport("NotifyUIError,event=".concat(u.tMo,",data=").concat(!!this.videoCaptureValue)),this.videoCaptureValue&&(this.videoMuteTimeoutId=setTimeout((()=>{J.A.Notify_APPUI_SAFE(u.tMo),this.videoMuteTimeoutId=0}),3e3),J.A.rwgAgent||Si({command:"healthCheck",op:0,type:0})),await Va.hasPermission("camera")||(0,We.iK)(u.ONI,We.pg.LOST_ACCESS)},i.onunmute=()=>{Y.A.add_monitor("VTMS:"+i.muted),H.Ay.directReport("NotifyUIError,event=".concat(u.IV3)),this.webrtcConfig.webrtcflag&&this.wmscManager&&this.wmscManager.playAllVideoTag("videoTrackUnmute"),this.videoMuteTimeoutId?(clearTimeout(this.videoMuteTimeoutId),this.videoMuteTimeoutId=0):J.A.Notify_APPUI_SAFE(u.IV3),J.A.rwgAgent||Si({command:"healthCheck",op:1,type:0})},i.muted?(Y.A.add_monitor("VTMS:"+i.muted),J.A.Notify_APPUI_SAFE(u.tMo)):(Y.A.add_monitor("VTMS:"+i.muted),J.A.Notify_APPUI_SAFE(u.IV3));try{let{width:e,height:t}=Oh.currentVideoResolution||{};if((F.Ay.browser.isSafari||F.Ay.isAndroidBrowser())&&e&&t){let r=e instanceof Object?e.ideal:e,a=t instanceof Object?t.ideal:t;const{width:n}=i.getSettings()||{};r&&a&&n&&Math.abs(n-r)>50&&this.Change_Video_Capture_Resolution(r,a,!0)}}catch(e){}}}catch(e){this.handleVideoError(e)}},errorHandler:function(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.handleVideoError(t,i)}})},Start_Audio_Play:function(){this.audioPlay=!0,J.A.AudioNode&&J.A.AudioNode.postCMD("startPlayAudio",null),vt(!0)},Stop_Audio_Play:function(){vt(!1),J.A.AudioNode&&J.A.AudioNode.postCMD("stopPlayAudio",null)},Remove_Audio_Play:function(){vt(!1),this.audioPlay=!1,J.A.AudioNode&&J.A.AudioNode.postCMD("stopPlayAudio",null)},Meeting_Fail_Over:function(e,t){ci(e,t)},Start_Desktop_Audio_Capture:function(){let e=this.desktopSharingMediaStramRaw||this.desktopSharingMediaStram;if(this.useAudioBridge){var t;null===(t=this.audioBridge)||void 0===t||t.publishStream(e,!0)}else{let t=e.getAudioTracks();if(e&&t){var i=this.sharingAudioCtx.createMediaStreamSource(e);return this.sharingWebrtcAudioNode=i,this.isSharingCaptureNodeConnect||(this.sharingWebrtcAudioNode.connect(J.A.SharingAudioNode),J.A.SharingAudioNode.postCMD("StartCaptureAudio",null),this.isSharingCaptureNodeConnect=!0),void(this.screenShareAudioPreviewElement&&this.screenShareAudioPreviewElement.play().catch((e=>{H.Ay.error("Screenshare audio preview play failed",e)})))}}},Start_Audio_Capture:function(){if(Oh.shouldCaptureAudio())this.StartAudioMediaCapture();else{if(Oh.getAudioCapabilities().deviceId,this.audioInputLevel)return this.audioInputLevel.setAudioStream(Oh.audioStream),this.captureAudioMuted||this.audioInputLevel.start(),void(J.A.ComputerAudioStatus===Q.BX.ComputerAudio_Connecting&&(J.A.ComputerAudioStatus=Q.BX.ComputerAudio_Connected,J.A.Notify_APPUI(u.Ubu,Oh.getAudioDeviceId())));var e;if(this.useAudioBridge)return void(null===(e=this.audioBridge)||void 0===e||e.publishStream(Oh.audioStream).then((e=>{J.A.ComputerAudioStatus===Q.BX.ComputerAudio_Connecting&&(J.A.ComputerAudioStatus=Q.BX.ComputerAudio_Connected,J.A.Notify_APPUI(u.Ubu,Oh.getAudioDeviceId()))})));if(J.A.AudioNode){this.webrtcAudioNode&&(this.webrtcAudioNode.disconnect(J.A.AudioNode),this.webrtcAudioNode=null);var t=this.audioCtx.createMediaStreamSource(Oh.audioStream);this.webrtcAudioNode=t,this.webrtcAudioNode.connect(J.A.AudioNode),J.A.AudioNode.postCMD("StartCaptureAudio",null),Ii({command:132,value:!0}),this.isCaputureNodeConnect=!0}J.A.ComputerAudioStatus===Q.BX.ComputerAudio_Connecting&&(J.A.ComputerAudioStatus=Q.BX.ComputerAudio_Connected,J.A.Notify_APPUI(u.Ubu,Oh.getAudioDeviceId()))}},Stop_Audio_Capture:function(){hi(J.A.SPECIAL_ID,u.A_T)},_startVideoLoadedmetadataMonitor:function(e,t){var i;null!==(i=this.videoloadedmetadatamonitor)&&void 0!==i&&i.stop&&this.videoloadedmetadatamonitor.stop();let r=Math.min(1e4+5e3*this.loadedmetadatamtimeoutcount,3e4),a=setTimeout((()=>{var i;(null===(i=this.videoloadedmetadatamonitor)||void 0===i?void 0:i.id)!=t||this.isDestroy||((0,F.SI)(e),this.loadedmetadatamtimeoutcount++,this.videoloadedmetadatamonitor=null,e.readyState>=2?(this._videoloadedmetadata(t,{}),H.Ay.directReport("video is ready state no loadedmetadata callback")):(Y.A.add_monitor("loadmetadatamtimeout:".concat(this.loadedmetadatamtimeoutcount)),this.handleVideoError(new Error("Video loadedmetadata timeout ".concat(this.loadedmetadatamtimeoutcount)))))}),r);this.videoloadedmetadatamonitor={id:t,stop:()=>{clearTimeout(a)}}},_addVideoLoadedmetadataListener:function(e){var t;if(!e)return void H.Ay.error("videodom is null");this.mountoadedmetadatatime=performance.now(),null!==(t=this.videoloadmetadataListener)&&void 0!==t&&t.remove&&(this.videoloadmetadataListener.remove(),this.videoloadmetadataListener=null);let i=Date.now();const r=this._videoloadedmetadata.bind(this,i);e.addEventListener("loadedmetadata",r),this.videoloadmetadataListener={id:i,remove:()=>{e.removeEventListener("loadedmetadata",r)}},this._startVideoLoadedmetadataMonitor(e,i)},_videoloadedmetadata:function(e,t){var i,r;if(this.videoloadmetadataListener){if(this.videoloadmetadataListener.id!=e)return;var a;null===(a=this.videoloadmetadataListener)||void 0===a||a.remove(),this.videoloadmetadataListener=null}let n,s;null!==(i=this.videoloadedmetadatamonitor)&&void 0!==i&&i.stop&&(this.videoloadedmetadatamonitor.stop(),this.videoloadedmetadatamonitor=null);let o=this,d=null;if(t?(d=t.target||o.videoCaptureValue.videoCtrl,Y.A.add_monitor("VIDEOLOADEDMETADATA:".concat(d==o.videoCaptureValue.videoCtrl))):Y.A.add_monitor("VIDEOLOADEDMETADATA:".concat(!0)),!Et(o,"loadedmetadata"))return H.Ay.error("VideoCaptureException loadedmetadata JsMediaSDK instance destroyed"),Oh.enableReuseStream(!1),void Oh.destoryVideoMediaStream();var c;o.isVideoCaptureLoadedmetadata&&H.Ay.warn("Video capture isVideoCaptureLoadedmetadata is true"),o.isVideoCaptureLoadedmetadata=!0,o.isSupportVideoFrameOrBitmapCapture?(n=o.videoCaptureWidth,s=o.videoCaptureHeight):(n=o.videoCaptureValue.videoCtrl.videoWidth,s=o.videoCaptureValue.videoCtrl.videoHeight,o.videoCaptureWidth=n,o.videoCaptureHeight=s,null===(c=o.captureVideoOutputCanvasDomList)||void 0===c||c.forEach((function(e){e.width=n,e.height=s}))),t&&this.startVideoCaptureSuccess(),null===(r=o.VideoRenderObj)||void 0===r||r.Set_LocalVideo_SSRC(o.videoCaptureValue.ssid),o.webrtcConfig.webrtcflag||(Si({command:"startVideoEncode",width:o.videoCaptureWidth,height:o.videoCaptureHeight,fps:o.videoCaptureValue.fps,ssid:o.videoCaptureValue.ssid,mtu_size:o.mtu_size,isSupportMediaStreamTrackProcessor:o.isSupportMediaStreamTrackProcessor,isSupport2DCanvasDrawFrame:o.isSupport2DCanvasDrawFrame,disableOriginalRatio:!!o.videoCaptureValue.disableOriginalRatio}),Ci({command:"startVideoEncode",ssid:o.videoCaptureValue.ssid,disableOriginalRatio:!!o.videoCaptureValue.disableOriginalRatio}),o.isSupportVideoShare||qi({command:"startVideoEncode"}),Si({command:"updateVideoPara",width:o.videoCaptureWidth,height:o.videoCaptureHeight,fps:o.GetVideoCaptureFps()})),o.lastRealRect.left=0,o.lastRealRect.top=0,o.lastRealRect.width=o.videoCaptureWidth,o.lastRealRect.height=o.videoCaptureHeight,J.A.Notify_APPUI(u.Shw,{width:n,height:s})},startVideoCaptureSuccess:function(){const{deviceId:e,pan:t=null,tilt:i=null,zoom:r=null,facingMode:a=null}=Oh.getVideoCapabilities(),n={currentDeviceID:e,PTZRange:{pan:t,tilt:i,zoom:r}},{usingFacingMode:s=!1}=this.VALUE_CACHE_FOR_START_CAPTURE_VIDEO;s&&(null==a?void 0:a.length)>0&&(n.usingFacingMode=!0,n.VideoSelectValue=a),Y.A.add_monitor("START_VIDEO_CAPTURE_SUCCESS_Response:".concat((0,F.iD)(JSON.stringify(n)))),J.A.Notify_APPUI(u.EUC,n)},handleWebRTCStream:async function(e,t){if(!this.webrtcConfig.webrtcflag)return void Y.A.add_monitor("WMSC_WebRTC_Flag_Error:".concat(e));const i=t||Oh.getVideoStream();if(this.videoCaptureValue&&this.videoCaptureValue.videoCtrl&&(this.videoCaptureValue.videoCtrl.srcObject=i,Oh.playVideoStream(this.videoCaptureValue.videoCtrl)),this.wmscManager&&i){var r;this.wmscManager.selfVideoDomMap.size>0&&this.wmscManager.selfVideoDomMap.forEach((t=>{t.srcObject=i,this.wmscManager.playSelfVideo(e,t)}));const t=null===(r=i.getVideoTracks()[0])||void 0===r?void 0:r.getSettings(),a=[{stream:i,width:(null==t?void 0:t.width)||640,height:(null==t?void 0:t.height)||360}];Oh.isVideoStreamProcessed()&&a.push({stream:Oh.videoStream}),Y.A.add_monitor("WMSC_Prepare_Send_streams:".concat(e,"|").concat(this.isStartVideoCapture)),this.isStartVideoCapture&&await this.wmscManager.sendMessageToWMSCAsync({type:"VIDEO_STREAMS",streams:a})}else{var a;Y.A.add_monitor("WMSC_Send_Stream_Fail:".concat(!!this.wmscManager,"|").concat(!!i,"|").concat(!(null===(a=this.videoCaptureValue)||void 0===a||!a.videoCtrl),"|").concat(e))}},render_self_video_wasm:function(){try{this.videoCaptureValue&&this.videoCaptureValue.videoCtrl&&!this.webrtcConfig.webrtcflag&&Oh.playVideoStream(this.videoCaptureValue.videoCtrl),this.selfPreviewVideotagList&&this.selfPreviewVideotagList.length>0&&this.selfPreviewVideotagList.forEach((e=>{e&&Oh.playVideoStream(e)}))}catch(e){H.Ay.error("Error trying to set srcObject of video tag",e)}},Start_Video_Capture:function(){if(!Oh.shouldCaptureVideo()){var e=this;return new Promise(((t,i)=>{if(e.isSupportVideoFrameOrBitmapCapture?(e._videoloadedmetadata(null),e.render_self_video_wasm(),F.Ay.isSelfPreviewRenderWithVideo()&&F.Ay.isSupportVideoFrameOrBitmapCapture()&&e.videoCaptureValue.videoCtrl&&!this.webrtcConfig.webrtcflag&&Oh.playVideoStream(e.videoCaptureValue.videoCtrl),t(!0)):(e.isVideoCaptureLoadedmetadata&&(H.Ay.error("Video capture isVideoCaptureLoadedmetadata is true"),e.isVideoCaptureLoadedmetadata=!1),this._addVideoLoadedmetadataListener(e.videoCaptureValue.videoCtrl),Oh.checkVideoStreamActive().then(t).catch(i),e.videoCaptureValue.videoCtrl&&!this.webrtcConfig.webrtcflag&&Oh.playVideoStream(e.videoCaptureValue.videoCtrl)),this.webrtcConfig.webrtcflag)if(Y.A.add_monitor("WMSC_Start_CAPTURE_REUSE_STREAM"),this.wmscManager)this.handleWebRTCStream("reuseCaptureStream");else{const e="WMSC_Resuse_Stream_Fail:".concat(!!this.wmscManager,"|").concat(this.isStartVideoCapture,"|reuseCaptureStream");Y.A.add_monitor(e),H.Ay.error(e)}Y.A.add_monitor("STARTVIDEOSUCCESS"),(e.isSupportVideoFrameOrBitmapCapture||!e.isSupportedVideoFrameOrBitmapCapture&&this.webrtcConfig.webrtcflag)&&this.startVideoCaptureSuccess()}))}this.StartVideoMediaCapture()},video_capture_for_webrtc:function(){if(!Oh.shouldCaptureVideo())return new Promise((e=>{this.startVideoCaptureSuccess(),e(!0)}))},Stop_Video_Capture:function(){this.webrtcConfig.webrtcflag?(Y.A.add_monitor("WMSC_Stop_Video_CAPTURE"),this.Stop_Video_Capture_for_webrtc()):this.Stop_Video_Capture_for_wasm(),this.isStartVideoCapture=!1,this.isVideoCaptureLoadedmetadata=!1,Oh._clearCheckVideoStreamActiveTimer(),this.isMaskSettingOn||this.isVBSettingOn||this.isStartVideoCapture||(Oh.destoryVideoMediaStream(),this.videoCaptureValue=null),clearInterval(this.videoCaptureInterval),this.videoCaptureInterval=0},Stop_Video_Capture_for_wasm:function(){if(Si({command:"stopVideoEncode"}),Ci({command:"stopVideoEncode"}),qi({command:"stopVideoEncode"}),this.videoCaptureValue&&this.videoCaptureValue.videoCtrl&&!this.isMaskSettingOn&&!this.isVBSettingOn){var e,t;let i=!1;if(this.videoloadmetadataListener&&(0,F.SI)(this.videoCaptureValue.videoCtrl),this.selfPreviewVideotagList.length&&this.selfPreviewVideotagList.forEach((e=>{e===this.videoCaptureValue.videoCtrl&&(i=!0),Oh.removeVideoStream(e)})),i||Oh.removeVideoStream(this.videoCaptureValue.videoCtrl),null!==(e=this.videoloadedmetadatamonitor)&&void 0!==e&&e.stop&&(this.videoloadedmetadatamonitor.stop(),this.videoloadedmetadatamonitor=null),null!==(t=this.videoloadmetadataListener)&&void 0!==t&&t.remove){this.videoloadmetadataListener.remove(),this.videoloadmetadataListener=null;let e=performance.now();e-this.mountoadedmetadatatime>5e3&&H.Ay.error("stop video capture but loadedmetadata not callback after ".concat(Math.round(e-this.mountoadedmetadatatime)," ms"))}}},Stop_Video_Capture_for_webrtc:async function(){var e;null!==(e=this.videoCaptureValue)&&void 0!==e&&e.videoCtrl&&Oh.removeVideoStream(this.videoCaptureValue.videoCtrl),this.wmscManager&&(this.wmscManager.captureFramerate=void 0,await this.wmscManager.sendMessageToWMSCAsync({type:"VIDEO_STREAMS",streams:[]}))},Remove_Video_Capture:function(){clearInterval(this.videoCaptureInterval),this.videoCaptureInterval=0,Oh.destoryVideoMediaStream(),this.videoCaptureValue=null,this.videoCaptureValue.videoCtrl&&this.videoCaptureValue.videoCtrl.pause()},Change_Video_Capture_Resolution:function(e,t){var i;let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=null===J.A||void 0===J.A||null===(i=J.A.localVideoPara)||void 0===i?void 0:i.isSupportWebCodecEnocde;if(F.Ay.isIpadOS()&&!a)return;let n=!1;if((F.Ay.isIphoneOrIpadBrowser()||F.Ay.isIpadOS()||F.Ay.isAndroidBrowser()&&!F.Ay.isMTRAndroidWithSAB())&&(n=!0,r||(this.captureSize={width:e,height:t}),!this.isLandScape&&!a&&!r))return;if(e>=1920&&0!=this.platformType)return;let s=0;e>=1920?s=30:(s=this.videoCaptureValue&&this.videoCaptureValue.fps?this.videoCaptureValue.fps:24,0!=this.platformType&&null!==J.A&&void 0!==J.A&&J.A.WASM_MOBILE_30FPS&&(s=30)),Oh.changeVideoResolution(e,t,s).then((()=>{n||(this.ReadyCapureWidth=e,this.ReadyCapureHeight=t,this.videoCaptureWidth=e,this.videoCaptureHeight=t,J.A.Notify_APPUI(u.Shw,{width:e,height:t}),Si({command:"updateVideoPara",width:e,height:t,fps:this.videoCaptureValue&&this.videoCaptureValue.fps?this.videoCaptureValue.fps:24}))})).catch((e=>{H.Ay.warn("change video resoltuion info:",e)})),!Oh.videoStreamTrack||this.isSupportMediaStreamTrackProcessor||this.webrtcConfig.webrtcflag||this.Process_Video()},Start_Whiteboard_Sharing:async function(){let e,t;const i=this.desktopSharingValue.canvas;this.whiteboardCanvas=i,this.isdesktopCaptureLoadedmetadata=!0,e=i.width,t=i.height,this.desktopSharingCaptureWidth=e,this.desktopSharingCaptureHeight=t,this.desktopCaptureContext=i.getContext("2d");let r={command:"startSharingEncode",width:e,height:t,fps:8,ssid:this.desktopSharingValue.ssid,isSupportMediaStreamTrackProcessor:!1,isWhiteboardSharing:!0};Si(r),this.isSupportVideoShare||qi(r)},Change_Sharing_Capture_Resolution:function(e){if(this.shareTrack){let t;console.log("change sharing capture resolution to",e),t=1==e?{video:!0,frameRate:5}:{width:1280,height:720,frameRate:24},this.shareTrack.applyConstraints(t)}},Start_Desktop_Sharing:function(){if(this.desktopSharingMediaStram){var e=this;return new Promise(((t,i)=>{let r=async function(t){let i,a;var n=e.desktopSharingMediaStram.getVideoTracks()[0];e.isAnnotationPMEnabled||await Oh.adjustShareResUnder2K(n),e.isSupportMediaStreamTrackProcessor?(e.isSupportMediaStreamTrackProcessor&&(e.sharingMediaStreamTrackProcessor=new MediaStreamTrackProcessor(n),e.sharingFrameStream=e.sharingMediaStreamTrackProcessor.readable,e.isSupportVideoShare?bi("sharingframeStream",e.sharingFrameStream):wi("frameStream",e.sharingFrameStream),Y.A.add_monitor("SCTP")),e.desktopSharingValue.video&&(i=e.desktopSharingValue.video.videoWidth,a=e.desktopSharingValue.video.videoHeight,e.desktopSharingCaptureWidth=i,e.desktopSharingCaptureHeight=a,e.desktopSharingValue.video.removeEventListener("loadedmetadata",r))):(e.isdesktopCaptureLoadedmetadata=!0,i=e.desktopSharingValue.video.videoWidth,a=e.desktopSharingValue.video.videoHeight,e.desktopSharingValue.canvas.width=i,e.desktopSharingValue.canvas.height=a,e.desktopSharingCaptureWidth=i,e.desktopSharingCaptureHeight=a,e.desktopCaptureContext=e.desktopSharingValue.canvas.getContext("2d"),e.desktopSharingValue.video.removeEventListener("loadedmetadata",r)),e.isSupportVideoShare?Ki({command:"startSharingEncode",width:i,height:a,fps:8,ssid:e.desktopSharingValue.ssid,isSupportMediaStreamTrackProcessor:e.isSupportMediaStreamTrackProcessor}):qi({command:"startSharingEncode",width:i,height:a,fps:8,ssid:e.desktopSharingValue.ssid,isSupportMediaStreamTrackProcessor:e.isSupportMediaStreamTrackProcessor}),J.A.Notify_APPUI(u.HL3,{width:i,height:a}),Si({command:"startsharingencode"})};if(e.isSupportMediaStreamTrackProcessor?e.desktopSharingValue.video.addEventListener("loadedmetadata",r):(e.desktopSharingValue.video.addEventListener("loadedmetadata",r),e.desktopSharingValue.video.setAttribute("playsinline",""),e.desktopSharingValue.video.muted=!0),e.desktopSharingValue.video){try{e.desktopSharingValue.video.srcObject=e.desktopSharingMediaStram,e.desktopSharingValue.video.muted=!0}catch(t){e.desktopSharingValue.video.src=c().createObjectURL(e.desktopSharingMediaStram)}e.desktopSharingValue.video.play().catch((e=>{H.Ay.error("Screenshare video preview play failed",e)}))}J.A.isGoogleMeetMode&&e.desktopSharingMediaStram.getAudioTracks().length>0&&(e.screenShareAudioPreviewElement=new Audio,e.screenShareAudioPreviewElement.srcObject=e.desktopSharingMediaStram,e.screenShareAudioPreviewElement.setSinkId(e.audioCtx.sinkId)),t(!0)}))}this.StartDesktopMediaCapture()},Process_Sharing:async function(){if(!this.desktopSharingValue||!this.desktopSharingSend)return;let e,t,i,r,a=!(!this.isAnnotationPMEnabled||!this.localShareCanvas);var n;this.isStartWhiteboardSharing?(i=this.whiteboardCanvas,e=i.width,t=i.height):(i=this.desktopSharingValue.video,a?(r=null===(n=this.localShareCanvas)||void 0===n?void 0:n.getContext("2d"),e=this.localShareCanvas.width,t=this.localShareCanvas.height):(e=i.videoWidth,t=i.videoHeight));let s=Oh.getScaledResolution(e,t);e=s.w,t=s.h,!a||this.localShareCanvas.width===e&&this.localShareCanvas.height===t||(this.localShareCanvas.width=e,this.localShareCanvas.height=t,this.annotationMgr.updateRemoteSizeInfo({width:e,height:t})),e==this.desktopSharingCaptureWidth&&t==this.desktopSharingCaptureHeight||(J.A.Notify_APPUI(u.HL3,{width:e,height:t}),this.desktopSharingCaptureWidth=e,this.desktopSharingCaptureHeight=t);try{if(this.isdesktopCaptureLoadedmetadata&&i){this.isStartWhiteboardSharing||(this.desktopSharingValue.canvas.width=e,this.desktopSharingValue.canvas.height=t);var o,d=this.desktopCaptureContext;!this.is32bitbrowser||this.flipSend?(this.isStartWhiteboardSharing||d.drawImage(i,0,0,e,t),o=r?r.getImageData(0,0,e,t):d.getImageData(0,0,e,t),1e3==this.sMonitorCaptureFrameCount&&(Y.A.add_monitor2("SCFOK"),this.sMonitorCaptureFrameCount=0),this.sMonitorCaptureFrameCount++,ii(J.A.SPECIAL_ID,o.data,o.data.length,0,e,t),this.flipSend=!1):(this.flipSend=!0,ii(J.A.SPECIAL_ID,null,0,0,0,0))}}catch(e){H.Ay.error("An error occurred when trying to encode a sharing frame",e),Y.A.add_monitor3("GIDF"),setTimeout((function(){ii(J.A.SPECIAL_ID,null,0,0,0,0)}),1e3)}},Update_Mask_Texture:function(e,t,i){if(this.VideoMaskSettingCanvas){try{"object"==typeof t&&t.ideal&&(t=t.ideal),"object"==typeof i&&i.ideal&&(i=i.ideal),this.bgCanvas&&this.bgCanvasctx||(this.bgCanvas=document.createElement("canvas"),this.bgCanvasctx=this.bgCanvas.getContext("2d")),this.bgCanvas.width==t&&this.bgCanvas.height==i||(this.bgCanvas.width=t,this.bgCanvas.height=i)}catch(e){globaltracing_error("Update_Mask_Texture, width=$".concat(JSON.stringify(t),", height=").concat(JSON.stringify(i),". "),e),t=this.bgCanvas.width,i=this.bgCanvas.height}if(this.bgCanvasctx.clearRect(0,0,t,i),this.MaskImage&&this.BgImage&&"blur"!==this.BgImage){if(e.dWidth>0&&e.dHeight>0&&this.VideoMaskSettingCanvas.width>0&&this.VideoMaskSettingCanvas.height>0&&t>0&&i>0){let r=e.dx/(this.VideoMaskSettingCanvas.width/t),a=e.dy/(this.VideoMaskSettingCanvas.height/i),n=e.dWidth/(this.VideoMaskSettingCanvas.width/t),s=e.dHeight/(this.VideoMaskSettingCanvas.height/i);this.bgCanvasctx.drawImage(this.MaskImage,r,a,n,s)}let r,a,n,s;this.bgCanvasctx.globalCompositeOperation="source-out",this.Crop_Mask_Bg_16V9(),r=this.bgImageCroppingParams.sx,a=this.bgImageCroppingParams.sy,n=this.bgImageCroppingParams.sw,s=this.bgImageCroppingParams.sh,this.bgCanvasctx.drawImage(this.BgImage,r,a,n,s,0,0,t,i)}}},Crop_Mask_Bg_16V9:function(){let e,t,i,r=0,a=16/9,n=this.BgImage.naturalWidth,s=this.BgImage.naturalHeight;a*s>=n?(i=n,r=n/a,e=0,t=(s-r)/2):(i=s*a,r=s,e=(n-i)/2,t=0),this.bgImageCroppingParams.sx=e,this.bgImageCroppingParams.sy=t,this.bgImageCroppingParams.sw=i,this.bgImageCroppingParams.sh=r},Draw_Mask_Frame:function(){if(!this.VideoMaskSettingCanvas)return;this.VideoMaskSettingCanvasctx||(this.VideoMaskSettingCanvasctx=this.VideoMaskSettingCanvas.getContext("2d"));const e=this.VideoMaskCanvasFillMode?Ur(this.videoCaptureHiddenCanvas.width,this.videoCaptureHiddenCanvas.height,void 0,void 0,this.VideoMaskSettingCanvas.width/this.VideoMaskSettingCanvas.height):this.videoCaptureValue&&this.videoCaptureValue.disableOriginalRatio?Ur(this.videoCaptureHiddenCanvas.width,this.videoCaptureHiddenCanvas.height):null;this.isMirrorMyVideo?(this.isCanvasScaled||(this.VideoMaskSettingCanvasctx.scale(-1,1),this.isCanvasScaled=!0),this.VideoMaskSettingCanvasctx.clearRect(0-this.VideoMaskSettingCanvas.width,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height),this.VideoMaskSettingCanvasctx.drawImage(this.videoCaptureHiddenCanvas,...e?[e.left,e.top,e.width,e.height]:[],0-this.VideoMaskSettingCanvas.width,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height)):(this.isCanvasScaled&&(this.VideoMaskSettingCanvasctx.setTransform(1,0,0,1,0,0),this.isCanvasScaled=!1),this.VideoMaskSettingCanvasctx.clearRect(0,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height),this.VideoMaskSettingCanvasctx.drawImage(this.videoCaptureHiddenCanvas,...e?[e.left,e.top,e.width,e.height]:[],0,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height))},Draw_No_VB_Preview_Frame:function(){if(!this.videoNoVBPreviewCanvas)return;this.videoNoVBPreviewCanvasctx||(this.videoNoVBPreviewCanvasctx=this.videoNoVBPreviewCanvas.getContext("2d"));const e=this.videoCaptureHiddenCanvas,t=this.videoNoVBPreviewCanvas.width,i=this.videoNoVBPreviewCanvas.height,r=e.width,a=e.height;let n,s,o;r/a>t/i?(n=t/r,s=0,o=(i-a*n)/2):(n=i/a,s=(t-r*n)/2,o=0),this.isMirrorMyVideo?(this.isVideoNoVBPreviewCanvasScaled||(this.videoNoVBPreviewCanvasctx.scale(-1,1),this.isVideoNoVBPreviewCanvasScaled=!0),this.videoNoVBPreviewCanvasctx.clearRect(0-this.videoNoVBPreviewCanvas.width,0,this.videoNoVBPreviewCanvas.width,this.videoNoVBPreviewCanvas.height),this.videoNoVBPreviewCanvasctx.drawImage(e,0,0,r,a,-s-r*n,o,r*n,a*n)):(this.isVideoNoVBPreviewCanvasScaled&&(this.videoNoVBPreviewCanvasctx.setTransform(1,0,0,1,0,0),this.isVideoNoVBPreviewCanvasScaled=!1),this.videoNoVBPreviewCanvasctx.clearRect(0,0,this.videoNoVBPreviewCanvas.width,this.videoNoVBPreviewCanvas.height),this.videoNoVBPreviewCanvasctx.drawImage(e,0,0,r,a,s,o,r*n,a*n))},DrawNoVBPreviewFromVideo:function(e){if(!this.videoNoVBPreviewCanvas)return;this.videoNoVBPreviewCanvasctx||(this.videoNoVBPreviewCanvasctx=this.videoNoVBPreviewCanvas.getContext("2d"));const t=e.videoWidth?e.videoWidth:640,i=e.videoHeight?e.videoHeight:360,r=this.videoNoVBPreviewCanvas.width,a=this.videoNoVBPreviewCanvas.height;let n,s,o;t/i>r/a?(n=r/t,s=0,o=(a-i*n)/2):(n=a/i,s=(r-t*n)/2,o=0),this.isMirrorMyVideo?(this.isVideoNoVBPreviewCanvasScaled||(this.videoNoVBPreviewCanvasctx.scale(-1,1),this.isVideoNoVBPreviewCanvasScaled=!0),this.videoNoVBPreviewCanvasctx.clearRect(0-this.videoNoVBPreviewCanvas.width,0,this.videoNoVBPreviewCanvas.width,this.videoNoVBPreviewCanvas.height),this.videoNoVBPreviewCanvasctx.drawImage(e,0,0,t,i,-s-t*n,o,t*n,i*n)):(this.isVideoNoVBPreviewCanvasScaled&&(this.videoNoVBPreviewCanvasctx.setTransform(1,0,0,1,0,0),this.isVideoNoVBPreviewCanvasScaled=!1),this.videoNoVBPreviewCanvasctx.clearRect(0,0,this.videoNoVBPreviewCanvas.width,this.videoNoVBPreviewCanvas.height),this.videoNoVBPreviewCanvasctx.drawImage(e,0,0,t,i,s,o,t*n,i*n))},GetVideoCaptureFps:function(){return this.videoCaptureValue&&this.videoCaptureValue.fps?this.videoCaptureValue.fps:24},Process_Video:async function(){if(this.isSupportMediaStreamTrackProcessor)return;if(!(this.videoCaptureValue&&this.isStartVideoCapture||this.isMaskSettingOn||this.isVBSettingOn))return;let e,t,i,r,a,n=this;i=this.videoCaptureWidth,r=this.videoCaptureHeight;const s=Oh.isUsingFileInputVideoSource();if(this.isStartVideoCapture?a=this.videoCaptureValue.videoCtrl:(this.isMaskSettingOn||this.isVBSettingOn)&&(a=this.MaskSettingVideo),(0,F.qs)(a.srcObject)&&(this.isVideoCaptureLoadedmetadata||this.isMaskSettingOn||this.isVBSettingOn)&&a&&a.readyState>=2){var o,d;if((a.paused||a.ended)&&a.play().catch((e=>{H.Ay.error("Video capture video tag play failed",e)})),this.isSelfViewWithVideo&&3==this.platformType){let e=Lh;1==Oh.facingMode&&(2==Lh?e=0:0==Lh&&(e=2)),Oh.isUsingFileInputVideoSource()&&(e=0);let t=new VideoFrame(a,{timestamp:1e3*performance.now()});return void(yi({command:"yuvVideoFrame",data:t,rotation:e},[t])||t.close())}if(F.Ay.isSupportVideoFrame()&&!n.isCurrentInMaskStatus&&(null!==(o=F.Ay.browser)&&void 0!==o&&o.isSafari||null!==(d=F.Ay.browser)&&void 0!==d&&d.isFirefox)){let e=new VideoFrame(a,{timestamp:1e3*performance.now()}),t=Lh;1==Oh.facingMode&&(2==Lh?t=0:0==Lh&&(t=2)),Oh.isUsingFileInputVideoSource()&&(t=0);let i={command:"yuvVideoFrame",data:e,rotation:t};return n.videoCaptureValue&&n.VideoRenderObj?(wh.hasProcessor()||n.VideoRenderObj.Update_LocalVideo(e,t,!0),Si(i),e.close()):yi(i,[e])||e.close(),void(n.isVBSettingOn&&n.isCurrentInNoVBPreviewStatus&&n.DrawNoVBPreviewFromVideo(a))}let h,p,f,g;if(e=a.videoWidth?a.videoWidth:640,t=a.videoHeight?a.videoHeight:360,e&&t&&(e!==i||t!==r)&&(xh("video width/height changed old => begin",i,r,e,t),J.A.Notify_APPUI(u.Shw,{width:e,height:t}),this.videoCaptureWidth=e,this.videoCaptureHeight=t,Si({command:"updateVideoPara",width:e,height:t,fps:n.GetVideoCaptureFps()})),(!(!n.isMaskSettingOn||n.videoCaptureValue&&n.videoCaptureValue.disableOriginalRatio)||n.MaskImage&&n.BgImage)&&n.isCurrentInMaskStatus&&n.isCurrentInNoVBPreviewStatus){let i=e/t*n.ReadyCapureHeight,r=t/e*n.ReadyCapureWidth;i>n.ReadyCapureWidth?(h=0,p=(n.ReadyCapureHeight-r)/2):(h=(n.ReadyCapureWidth-i)/2,p=0),f=n.ReadyCapureWidth-2*h,g=n.ReadyCapureHeight-2*p,n.videoCaptureHiddenCanvas.width=n.ReadyCapureWidth,n.videoCaptureHiddenCanvas.height=n.ReadyCapureHeight}else f=e,g=t,h=0,p=0,n.videoCaptureHiddenCanvas.width=e,n.videoCaptureHiddenCanvas.height=t;if(s?F.Ay.videoToMediaStreamManager.drawCanvas(n.videoCaptureHiddenCanvas,n.videoCaptureHiddenCanvasCtx,n.videoCaptureHiddenCanvas.width,n.videoCaptureHiddenCanvas.height):n.videoCaptureHiddenCanvasCtx.drawImage(a,0,0,e,t,h,p,f,g),n.isCurrentInMaskStatus&&(n.bgCanvas?n.videoCaptureHiddenCanvasCtx.drawImage(n.bgCanvas,0,0,n.videoCaptureHiddenCanvas.width,n.videoCaptureHiddenCanvas.height):n.Update_Mask_Texture(this.maskCoordinate,n.videoCaptureHiddenCanvas.width,n.videoCaptureHiddenCanvas.height),n.VideoMaskSettingCanvas&&n.Draw_Mask_Frame()),n.isCurrentInNoVBPreviewStatus&&n.videoNoVBPreviewCanvas&&n.Draw_No_VB_Preview_Frame(),n.isStartVideoCapture||n.isVBSettingOn){var c=n.videoCaptureHiddenCanvasCtx.getImageData(0,0,n.videoCaptureHiddenCanvas.width,n.videoCaptureHiddenCanvas.height);let e=c.data;n.lastRealRect.width==n.videoCaptureHiddenCanvas.width&&n.lastRealRect.height==n.videoCaptureHiddenCanvas.height||(n.lastRealRect.left=0,n.lastRealRect.top=0,n.lastRealRect.width=n.videoCaptureHiddenCanvas.width,n.lastRealRect.height=n.videoCaptureHiddenCanvas.height,Si({command:"updateVideoPara",width:n.lastRealRect.width,height:n.lastRealRect.height,fps:n.GetVideoCaptureFps()})),n.videoCaptureValue&&n.VideoRenderObj&&!n.isMultiView&&(c.data instanceof Uint8ClampedArray&&(e=new Uint8Array(c.data.buffer)),n.videoCaptureValue&&void 0!==n.videoCaptureValue.disableOriginalRatio&&n.VideoRenderObj.Set_Cropping_Mode(!!n.videoCaptureValue.disableOriginalRatio),n.VideoRenderObj.Draw_Send_Video_Img(e,n.videoCaptureHiddenCanvas.width,n.videoCaptureHiddenCanvas.height,n.videoCaptureValue.ssid,l,n.lastRealRect)),3e3==n.vMonitorCaptureFrameCount&&(Y.A.add_monitor2("VCFOK"),n.vMonitorCaptureFrameCount=0),n.vMonitorCaptureFrameCount++,ti(J.A.SPECIAL_ID,e,n.videoCaptureHiddenCanvas.width,n.lastRealRect.left,n.lastRealRect.top)}n.videoCaptureHiddenCanvasCtx.clearRect(0,0,n.videoCaptureHiddenCanvas.width,n.videoCaptureHiddenCanvas.height)}},Remove_Sharing_Audio_Capture:function(){var e;if(this.useAudioBridge)null===(e=this.audioBridge)||void 0===e||e.publishStream(null,!0);else if(Ii({command:"changeAudioShare",isStart:!1}),J.A.ComputerAudioStatus==Q.BX.ComputerAudio_Null&&Ft.clear(),this.sharingWebrtcAudioNode&&J.A.SharingAudioNode){try{this.sharingWebrtcAudioNode.disconnect(J.A.SharingAudioNode)}catch(e){this.JsMediaSDK_Log(e)}this.sharingWebrtcAudioNode=null}},Remove_Audio_Capture:function(e){if(hi(J.A.SPECIAL_ID,u.YG0,e),J.A.DesktopAudioStatus==Q.BX.DesktopAudio_Null&&Ft.clear(),this.firstSetDelay=!0,this.webrtcAudioNode&&J.A.AudioNode){try{this.webrtcAudioNode.disconnect(J.A.AudioNode)}catch(e){this.JsMediaSDK_Log(e)}this.webrtcAudioNode=null}},Start_Video_Play:function(){this.videoRenderIntervalHandle||(this.videoRenderIntervalHandle=this.JsMediaSDK_VideoRenderInterval(this.videorenderinterval))},Stop_Video_Play:function(){this.UpdateVideoPlayStatus(!1),this.VideoRenderObj&&(this.VideoRenderObj.ClearQueue(),this.VideoRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName})),this.videoRenderIntervalHandle&&(this.VideoRenderObj.Stop_Draw.bind(this.VideoRenderObj)(),this.videoRenderIntervalHandle=null)},Remove_Video_Play:function(){this.UpdateVideoPlayStatus(!1),this.videoRenderIntervalHandle&&(clearInterval(this.videoRenderIntervalHandle),this.videoRenderIntervalHandle=null),Ci({command:"removeVideoPlay"})},UpdateVideoPlayStatus(e){At(e)},EndMedia:function(){try{J.A.rwgAgent&&J.A.rwgAgent.off("message",this.rwgAgentMessageListenerWrapper)}catch(e){H.Ay.error("rwgAgent.off error",e)}try{var e,t;null===(e=this.videoDataChannel)||void 0===e||e.forceClose(),null===(t=this.audioDataChannel)||void 0===t||t.forceClose()}catch(e){H.Ay.error("clear rtcPeerConnectionList err",e)}try{Oh.enableReuseStream(!1),Oh.destoryAudioMediaStream(),this.Remove_Audio_Play(),this.Remove_Audio_Capture(),this.Remove_Sharing_Audio_Capture(),this.checkWorkletInterval&&(clearInterval(this.checkWorkletInterval),this.checkWorkletInterval=null),this.Remove_Video_Play(),this.audioCtx&&(this.audioCtx.onstatechange=null,this.audioCtx.close(),this.audioCtx.onerror&&(this.audioCtx.onerror=null),this.audioCtx=null),this.sharingAudioCtx&&(this.sharingAudioCtx.close(),this.sharingAudioCtx=null),this.audioDomNode&&(this.audioDomNode=null)}catch(e){H.Ay.error("endMedia",e)}try{Oh.enableReuseStream(!1),Oh.destoryVideoMediaStream(),this.EndSharingMediaStream(),this.CloseBoringPeerConnection(),F.Ay.audioToMediaStreamMananger.destroy(!1)}catch(e){H.Ay.error("endMedia",e)}try{Xi()}catch(e){H.Ay.error("endMedia",e)}try{this.remoteControl&&this.remoteControl.destroy()}catch(e){H.Ay.error("endMedia",e)}},EndDesktopAudioMediaStream:function(){let e=this.desktopSharingMediaStramRaw||this.desktopSharingMediaStram;if(e){var t,i;let r=e.getAudioTracks();r.length&&r.forEach((function(e){e.stop()})),!this.desktopSharingValue.audioOnly||null!==(t=this.desktopSharingMediaStram)&&void 0!==t&&t.getVideoTracks().length||(this.desktopSharingMediaStram=null),!this.desktopSharingValue.audioOnly||null!==(i=this.desktopSharingMediaStramRaw)&&void 0!==i&&i.getVideoTracks().length||(this.desktopSharingMediaStramRaw=null)}this.isStartDesktopSharing||(this.desktopSharingValue=null)},EndSharingMediaStream:function(){this.desktopSharingMediaStram&&(this.desktopSharingMediaStram.getTracks().forEach((function(e){e.stop()})),this.desktopSharingMediaStram=null,window.WebQrscanner&&WebQrscanner.qrScanner.stop()),this.desktopSharingMediaStramRaw&&(this.desktopSharingMediaStramRaw.getTracks().forEach((function(e){e.stop()})),this.desktopSharingMediaStramRaw=null)},StopSharingCapture:function(){clearInterval(this.drawLocalShareIntervalId),this.EndSharingMediaStream(),this.desktopSharingSend=!1,this.isStartDesktopSharing&&Si({command:"stopsharingencode"}),this.isStartDesktopSharing=!1,this.desktopSharingMediaStram=null,window.WebQrscanner&&WebQrscanner.qrScanner.stop(),this.desktopSharingValue=null},CloseBoringPeerConnection:function(){try{this.rtcConnectionB&&(this.rtcConnectionB.close(),this.rtcConnectionB=null),this.rtcConnectionA&&(this.rtcConnectionA.close(),this.rtcConnectionA=null)}catch(e){xh(e)}},UnMuteAudio:function(){hi(J.A.SPECIAL_ID,u.Eym),this.enableHID&&this.hidAvalible&&za.sendReport("mute",!1)},MuteAudio:function(){this.Stop_Audio_Capture(),this.enableHID&&this.hidAvalible&&za.sendReport("mute",!0)},async selectComputerAudioSpeaker(e,t){var i;let r=F.Ay.isSupportChromeWideAEC(),a="default"==e?"":e,n=null;var s;if(r&&!this.audioDomNode?this.audioCtx&&(n=this.audioCtx):this.audioDomNode&&(n=this.audioDomNode),!await Va.hasOutputDevice(a))return Va.updateSelectedSpeakerDevices(a,0,!1),H.Ay.error("Selected output device ID is not available: ".concat(a)),void this.notifyUISetSpeakerError({currentSink:(null===(s=n)||void 0===s?void 0:s.sinkId)||"default",reason:"sinkId not exists"});if(null!==(i=this.fileAudioPlaybackTag)&&void 0!==i&&i.setSinkId&&this.fileAudioPlaybackTag.setSinkId(a).catch((e=>{H.Ay.error("set audio tag setSinkId error",e)})),this.useAudioBridge){var o;null===(o=this.audioBridge)||void 0===o||o.changeSpeaker(e)}else{var d;if(!n)return Y.A.add_monitor("NoAudioPlayer"),void this.notifyUISetSpeakerError({currentSink:(null===(d=n)||void 0===d?void 0:d.sinkId)||"default",reason:"audioPlayer not exists"});n.setSinkId?n.setSinkId(a).then((()=>{var e,i;Va.updateSelectedSpeakerDevices((null===(e=n)||void 0===e?void 0:e.sinkId)||"default",Date.now()-t,!0),"suspended"===n.state&&(Y.A.add_monitor("AUDIOCONTEXT:RESUME"),n.resume().catch((e=>{H.Ay.error("resume audio context failed when setSinkId",e)}))),J.A.Notify_APPUI(u.a6z,(null===(i=n)||void 0===i?void 0:i.sinkId)||"default"),this.audioSpeakerSetErrorCnt=0})).catch((e=>{var i;H.Ay.error("An error occurred when trying to set the audio output device",e),Y.A.add_monitor("AODF"),Va.updateSelectedSpeakerDevices(a,Date.now()-t,!1),this.notifyUISetSpeakerError({currentSink:(null===(i=n)||void 0===i?void 0:i.sinkId)||"default",reason:"setSinkId failed, error = ".concat(e.message)})})):H.Ay.error("setSinkId is not supported")}},handleDesktopCapture:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.desktopSharingMediaStram=e,this.sharingCodecInfo={width:0,height:0};let i=this.desktopSharingMediaStram.getAudioTracks()[0];if(i?(Oh.addAudioTrackSettingsMonitor(i,"DesktopAudioCapture"),t||"Tab audio"===i.label||i.label.includes("HDMI")||(J.A.shareSystemAudio=!0),Va.updateShareAudioDevices(i.id,i.label),J.A.Notify_APPUI(u.npe,t),i.onended=function(){Y.A.add_monitor("ATRS:"+i.readyState+":"+i.id+":-S")},i.onmute=function(){Y.A.add_monitor("ATMS:"+i.muted+":"+i.id+":-S")},i.onunmute=function(){Y.A.add_monitor("ATMS:"+i.muted+":"+i.id+":-S")}):J.A.Notify_APPUI(u.pvo,null),!this.localShareCanvasWaiting)if(this.shareTrack=this.desktopSharingMediaStram.getVideoTracks()[0],this.shareTrack){Y.A.add_monitor("OSTS"),this.shareTrack.onended=this.onShareStreamEnded.bind(this),this.Start_Desktop_Sharing();const{width:e,height:t,displaySurface:i}=this.shareTrack.getSettings();J.A.Notify_APPUI(u.p8Y,{width:e,height:t,displaySurface:i})}else H.Ay.log("shareTrack is null when share screen")},handleCaptureError:function(e){this.isDestroy||(this.handleGetDisplayMediaError("An error occurred when trying to capture sharing",e),this.StopSharingCapture(),Y.A.add_monitor("SCCF"),"Permission denied by system"===e.message?J.A.Notify_APPUI(u.bjn,null):J.A.Notify_APPUI(u.BSK,null))},handleAudioCapture:function(){if(this.isDestroy)return;let{deviceId:e,elapsed_time:t,deviceLabel:i}=Oh.getAudioCapabilities();var r;return e&&t&&i&&Va.updateSelectedMicDevices(e,i,t,!0),this.updateFileAudioPlaybackStream(Oh.audioStream),this.useAudioBridge&&!this.audioInputLevel?(null===(r=this.audioBridge)||void 0===r||r.publishStream(Oh.audioStream).then((e=>{J.A.ComputerAudioStatus===Q.BX.ComputerAudio_Connecting&&(J.A.ComputerAudioStatus=Q.BX.ComputerAudio_Connected,J.A.Notify_APPUI(u.Ubu,Oh.getAudioDeviceId()))})),H.Ay.log("user grante audio capture"),void J.A.Notify_APPUI(u.h73,e)):this.audioCtx||this.audioInputLevel?(H.Ay.log("user grante audio capture"),J.A.Notify_APPUI(u.h73,e),void this.Start_Audio_Capture()):(H.Ay.log("no audio context when join computer audio"),J.A.ComputerAudioStatus=Q.BX.ComputerAudio_Null,J.A.Notify_APPUI(u.Ubu,null),J.A.Notify_APPUI(u.pHx,null),void Oh.destoryAudioMediaStream())},handleWasmVideoCapture:function(e,t){let i=this;return new Promise((async(r,a)=>{if(!e)return a(new Error("no stream"));if(i.videoCaptureWidth?i.videoCaptureWidth=i.videoCaptureWidth:i.videoCaptureWidth=640,i.videoCaptureHeight?i.videoCaptureHeight=i.videoCaptureHeight:i.videoCaptureHeight=360,t.encode&&i.isStartVideoCapture){try{r(await i.Start_Video_Capture())}catch(e){H.Ay.error("media stream is ok, but start video capture fail",e),a(new Error("media stream is ok, but start video capture fail"))}i.isMaskSettingOn&&i.MaskSettingVideo&&Oh.playVideoStream(i.MaskSettingVideo)}else if(t.preview&&(i.isMaskSettingOn||i.isVBSettingOn))try{r(await i.startMaskOrVBSettingVideoCapture(e))}catch(e){xh("startMaskOrVBSettingVideoCapture",e),a(new Error("media stream is ok, but start setting video capture fail"))}else i.isStartVideoCapture||Oh.destoryVideoMediaStream()}))},handleWebrtcVideoCapture:function(e){let t=this;return new Promise((async(i,r)=>{if(!e)return r(new Error("no stream"));if(t.isStartVideoCapture)try{i(await t.video_capture_for_webrtc())}catch(e){r(new Error("media stream is ok, but start video capture fail"))}else if(t.isMaskSettingOn||t.isVBSettingOn)try{i(await t.startMaskOrVBSettingVideoCapture(e))}catch(e){xh("startMaskOrVBSettingVideoCapture",e),r(new Error("media stream is ok, but start setting video capture fail"))}else Oh.destoryVideoMediaStream()}))},startMaskOrVBSettingVideoCapture:function(e){return new Promise(((e,t)=>{try{if(this.isVBSettingOn)if(this.MaskSettingVideo){const e=Oh.playVideoStream(this.MaskSettingVideo);e&&e.then((function(){J.A.Notify_APPUI(u.AjI,null)})).catch((function(e){t(new Error("media stream is ok, but video.play() fail")),H.Ay.error("An error occurred when trying to play video in Background Setting tab",e),Y.A.add_monitor("VBVPF")}))}else J.A.Notify_APPUI(u.AjI,null);else if(this.isMaskSettingOn)if(this.MaskSettingVideo){const e=Oh.playVideoStream(this.MaskSettingVideo);e&&e.then((function(){J.A.Notify_APPUI(u.i8,null)})).catch((function(e){t(new Error("media stream is ok, but video.play() fail")),H.Ay.error("An error occurred when trying to play video in Background Setting tab",e),Y.A.add_monitor("MVPF")}))}else J.A.Notify_APPUI(u.i8,null);this.webrtcConfig.webrtcflag||(this.addChannelForVideo(),Si({command:"startvideointerval",width:this.videoCaptureValue.width,height:this.videoCaptureValue.height,ssid:this.videoCaptureValue.ssid,mtu_size:this.mtu_size,fps:this.videoCaptureValue.fps,isSupportMediaStreamTrackProcessor:this.isSupportMediaStreamTrackProcessor,isSupport2DCanvasDrawFrame:this.isSupport2DCanvasDrawFrame,isVBSettingOn:this.isVBSettingOn,isMaskSettingOn:this.isMaskSettingOn})),e(!0)}catch(e){H.Ay.error("Starting mask or virtual background failed",e),t(e)}}))},handleGetDisplayMediaError:function(e,t){const{name:i}=t,r={AbortError:"error",InvalidStateError:"error",NotAllowedError:"warn",NotFoundError:"warn",NotReadableError:"warn",OverconstrainedError:"warn",TypeError:"error"}[i]||"error";H.Ay[r](e,t)},handleGetUserMediaError:function(e,t){const{name:i}=t,r={NotAllowedError:"warn",NotFoundError:"warn",NotReadableError:"warn",OverconstrainedError:"warn",SecurityError:"warn",SourceUnavailableError:"warn",PermissionDeniedError:"warn",AbortError:"error",TypeError:"error"}[i]||"error";H.Ay[r](e,t)},analyserCaptureReason:function(e){let t=Bh(e);J.A.Notify_APPUI(u.qUx,t),"NotAllowedError"===(null==e?void 0:e.name)&&"hidden"===document.visibilityState&&(document.removeEventListener("visibilitychange",Vh),document.addEventListener("visibilitychange",Vh)),Y.A.add_monitor("HADF: "+(null==e?void 0:e.name)+"-"+(null==t?void 0:t.errorCode))},handleAudioError:function(e){this.handleGetUserMediaError("Error occurred when trying to capture audio",e),this.analyserCaptureReason(e),J.A.ComputerAudioStatus===Q.BX.ComputerAudio_Connecting&&(J.A.ComputerAudioStatus=Q.BX.ComputerAudio_Null,J.A.Notify_APPUI(u.Ubu,null),J.A.Notify_APPUI(u.pHx,null))},handleVideoError:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Et(this,"videocaptureerror"))return void H.Ay.error("VideoCaptureException VideoError, JsMediaSDK instance destroyed");if(t)return Y.A.add_monitor("GUMF"),void this.handleGetUserMediaError("Error occurred when trying to capture video with normal constraints",e);this.isMaskSettingStarted=!1,this.isCurrentInMaskStatus=!1,this.isCurrentInNoVBPreviewStatus=!1,xh("handleVideoError",e);let i=(null==e?void 0:e.name)||"other error",r="Error ".concat((null==e?void 0:e.message)||"");Y.A.add_monitor("STARTVIDEOERR:".concat(i,"-").concat(r)),e instanceof We.iG||e.name&&-1!==["NotReadableError","SourceUnavailableError"].indexOf(e.name)?(Y.A.add_monitor("COCPEF"),J.A.Notify_APPUI(u.EWx,e)):(Y.A.add_monitor("HVDF"),J.A.Notify_APPUI(u.nEg,e)),this.handleGetUserMediaError("Error occurred when trying to capture video",e),this.Stop_Video_Capture()},chromeAecWorkAround:async function(e){if(Y.A.add_monitor("ASCAEC"),this.rtcConnectionA||this.rtcConnectionB)return!1;let t,i,r=null,a=null,n=new MediaStream;r=new RTCPeerConnection,a=new RTCPeerConnection,r.onicecandidate=e=>e.candidate&&a.addIceCandidate(new RTCIceCandidate(e.candidate)),a.onicecandidate=e=>e.candidate&&r.addIceCandidate(new RTCIceCandidate(e.candidate)),a.ontrack=e=>{e.streams[0].getTracks().forEach((e=>{n.addTrack(e)}))},r.addStream(e),t=await r.createOffer({offerVideo:!0,offerAudio:!0,offerToReceiveAudio:!1,offerToReceiveVideo:!1});let s=!1,o=null,d=null,c=F.Ay.getBrowserVersion();try{d=t.sdp,c>=104?(o=t.sdp.replace("SAVPF 111","SAVPF 100 111"),o=o.replace("a=rtpmap:111 opus/48000/2","a=rtpmap:100 L16/48000\na=rtpmap:111 opus/48000/2")):(o=t.sdp.replace("SAVPF 111","SAVPF 10 111"),o=o.replace("a=rtpmap:111 opus/48000/2","a=rtpmap:10 L16/48000\na=rtpmap:111 opus/48000/2")),t.sdp=o,await r.setLocalDescription(t),await a.setRemoteDescription(t)}catch(e){s=!0,t.sdp=d,await r.setLocalDescription(t),await a.setRemoteDescription(t)}return i=await a.createAnswer(),s||(c>=104?(i.sdp=i.sdp.replace("SAVPF 111","SAVPF 100 111"),i.sdp=i.sdp.replace("a=rtpmap:111 opus/48000/2","a=rtpmap:100 L16/48000\na=rtpmap:111 opus/48000/2")):(i.sdp=i.sdp.replace("SAVPF 111","SAVPF 10 111"),i.sdp=i.sdp.replace("a=rtpmap:111 opus/48000/2","a=rtpmap:10 L16/48000\na=rtpmap:111 opus/48000/2"))),await a.setLocalDescription(i),await r.setRemoteDescription(i),this.rtcConnectionA=r,this.rtcConnectionB=a,n},switchCanvasForVideoCapture:function(e){var t=[].concat(e),i=t[0];if(this.captureVideoOutputCanvasDomList=t,this.videoCaptureValue.canvasCtrl=i,!this.isSupportVideoFrameOrBitmapCapture){var r=this.videoCaptureValue.videoCtrl.videoWidth,a=this.videoCaptureValue.videoCtrl.videoHeight;t.forEach((function(e){e.width=r,e.height=a})),this.videoCaptureValue.canvasCtrl.width=r,this.videoCaptureValue.canvasCtrl.height=a,this.videoCaptureContext=i.getContext("2d")}},switchVideoTagForVideoCapture:function(e){var t;if(!this.videoCaptureValue)return;if(e===this.videoCaptureValue.videoCtrl)return;null!==(t=this.videoloadmetadataListener)&&void 0!==t&&t.remove&&(this.videoloadmetadataListener.remove(),this.videoloadmetadataListener=null);const i=this.videoCaptureValue.videoCtrl;i&&!this.selfPreviewVideotagList.includes(i)&&Oh.removeVideoStream(i),this.videoCaptureValue.videoCtrl=e,this.captureVideoOutPutVideoDom=e,this.isVideoCaptureLoadedmetadata||(H.Ay.warn("isVideoCaptureLoadedmetadata is false ,need to reloaded"),this._addVideoLoadedmetadataListener(e)),Oh.playVideoStream(e)},videoDecodeFrameBackSABRingBufferConsumeCallback(e){let t=new fe;t.setBuffer(e);let i=t.buffer2Obj();ri(i.video_ssrc,i.data,i.video_timestamp,i.video_width,i.video_height,i.rendering_x,i.rendering_y,i.rendering_w,i.rendering_h,i.rotation,i.yuv_limited),this.VideoRenderObj.JsMediaSDK_VideoRender.bind(this.VideoRenderObj)()},CheckCurrentActiveSSRC(e){this.currentactive!=e&&(this.currentactive=e,J.A.CurrentSSRC=this.currentactive,J.A.decoderinworklet?J.A.AudioNode&&J.A.AudioNode.postCMD("currentSSRC",J.A.CurrentSSRC):Ti(J.A.CurrentSSRC))},createVideoElement(){this.MaskSettingVideo||(this.videoCaptureValue&&this.videoCaptureValue.videoCtrl?this.MaskSettingVideo=this.videoCaptureValue.videoCtrl:(this.MaskSettingVideo=function(){let e=document.createElement("video");return e.setAttribute("muted",""),e.setAttribute("playsinline",""),e}(),F.Ay.browser.isSafari&&(this.MaskSettingVideo.setAttribute("style","position:fixed;top:-10000px;left:-10000px;"),document.body.appendChild(this.MaskSettingVideo))))},changeVideoRenderActiveSsrc(e){if(!this.webrtcConfig.webrtcflag)if(0==this.RenderInMain){var t=J.A.SPECIAL_ID;if(J.A.localVideoDecMGR){var i=J.A.localVideoDecMGR.map.get(t);if(i){var r={command:"CHANGE_CURRENT_ACTIVE_SSRC",ssrc:e};i.postMessage(r)}}}else 1==this.RenderInMain&&this.VideoRenderObj.Change_Current_SSRC(e)},addChannelForVideo(){var e,t;if(this.vcFlag)return;this.waitingVcChannelReady=!0;let i=J.A.SPECIAL_ID;if(null!==(e=J.A.localVideoDecMGR)&&void 0!==e&&e.map.get(i)&&null!==(t=J.A.localVideoEncMGR)&&void 0!==t&&t.map.get(i)){this.waitingVcChannelReady=!1,this.vcFlag=!0;var r=new MessageChannel;fi(r,r)}},checkIsRenderInWorker(){return this.isMultiView||this.isSupportVideoFrameOrBitmapCapture||J.A.enableVirtualBackgroundWithoutSAB||(0,F.uF)()&&"undefined"!=typeof SharedArrayBuffer&&F.Ay.isSafariVersionHigherThan("17.5")},setMultiView(e,t){const i=e>1,r=(0,F.uF)(),a=!!F.Ay.isWebGL2Supported(this.isWebGL2FeatureEnabled),n="function"==typeof OffscreenCanvas;this.isMultiView=i&&(r||a),H.Ay.directReport("JsMediaSDK-SetMultiView() isMultiView:".concat(this.isMultiView||t,",\n      docodeThreadNumber:").concat(e,",\n      isWebGLSupported:").concat(r,",\n      isWebGL2Supported:").concat(a,",\n      isOffscreenCanvasSupported:").concat(n,",\n      enableMultiDecodeVideoWithoutSAB:").concat(t))},start_capture_video_wasm:function(e){if(Fi(J.A.e2eencrypt),this.addChannelForVideo(),this.videoCaptureHiddenCanvas||this.isSupportVideoFrameOrBitmapCapture||(this.videoCaptureHiddenCanvas=F.Ay.isSupport2dOffscreenCanvas()?new OffscreenCanvas(640,360):document.createElement("canvas"),this.videoCaptureHiddenCanvasCtx=this.videoCaptureHiddenCanvas.getContext("2d")),!tr())return xh.warn("not isVideoEncodeHandleReady so return"),void Y.A.add_monitor("not isVideoEncodeHandleReady so return");if(Y.A.add_monitor("STARTVIDEO:".concat(this.isStartVideoCapture)),this.isStartVideoCapture)H.Ay.warn("video capture is already started, do not call again.");else{if(this.VALUE_CACHE_FOR_START_CAPTURE_VIDEO=Object.assign({},e),this.isStartVideoCapture=!0,this.isSupportMediaStreamTrackProcessor){let t;t=e.canvas instanceof Array?e.canvas[0]:e.canvas,F.Ay.isSelfPreviewRenderWithVideo()&&F.Ay.isSupportVideoFrameOrBitmapCapture()?(e.video?e.videoCtrl=(0,F.e5)(e.video).dom:this.selfPreviewVideotagList.length&&(e.videoCtrl=this.selfPreviewVideotagList[this.selfPreviewVideotagList.length-1]),this.isSelfViewWithVideo=!0):(this.MaskSettingVideo||this.createVideoElement(),e.videoCtrl=this.MaskSettingVideo)}else e.canvasCtrlList=[],e.canvasCtrl=this.videoCaptureHiddenCanvas,F.Ay.isSelfPreviewRenderWithVideo()&&(e.video||this.selfPreviewVideotagList.length)?(e.video?e.videoCtrl=(0,F.e5)(e.video).dom:this.selfPreviewVideotagList.length&&(e.videoCtrl=this.selfPreviewVideotagList[this.selfPreviewVideotagList.length-1]),this.isSelfViewWithVideo=!0):(F.Ay.browser.isSafari,this.MaskSettingVideo||this.createVideoElement(),e.videoCtrl=this.MaskSettingVideo);this.ReadyCapureWidth=e.width?e.width:640,this.ReadyCapureHeight=e.width?e.height:360,this.captureVideoOutPutVideoDom=e.videoCtrl,this.videoCaptureValue=e,this.videoCaptureValue.ssid&&(J.A.localSsrc=this.videoCaptureValue.ssid),!J.A.rwgAgent&&(!e.fps||24==e.fps)&&navigator.hardwareConcurrency&&navigator.hardwareConcurrency>8&&this.isSupportVideoShare&&(this.videoCaptureValue.fps=30),this.Start_Video_Capture()}},start_capture_video_webrtc:function(e){const{video:t=null}=e,i=s(e,Ih);Y.A.add_monitor("WMSC_Start_CAPTURE: ".concat((0,F.iD)(JSON.stringify(i)),"|").concat(!!t)),this.isStartVideoCapture?H.Ay.warn("video capture is already started, do not call again."):(this.VALUE_CACHE_FOR_START_CAPTURE_VIDEO=Object.assign({},e),this.isStartVideoCapture=!0,e.videoCtrl=e.video?(0,F.e5)(e.video).dom:null,this.captureVideoOutPutVideoDom=e.videoCtrl,this.videoCaptureValue=e,this.videoCaptureValue.ssid&&(J.A.localSsrc=this.videoCaptureValue.ssid),this.wmscManager&&(this.wmscManager.captureFramerate=this.videoCaptureValue.fps),this.Start_Video_Capture())},add_render_video_wasm:async function(e){var t=0;if(Object.assign(e,this.videoWaterMarkParams),void 0===e.isMyself&&(e.isMyself=this.userId&&this.userId>>10==e.userId>>10),F.Ay.isSelfPreviewRenderWithVideo()&&this.videoCaptureValue&&(0,F.XF)(parseInt(e.userId))==(0,F.XF)(this.videoCaptureValue.ssid)&&e.videodom)return Oh.playVideoStream(e.videodom),this.selfPreviewVideotagList.includes(e.videodom)||this.selfPreviewVideotagList.push(e.videodom),void(this.isSupportMediaStreamTrackProcessor?F.Ay.isSelfPreviewRenderWithVideo()&&F.Ay.isSupportVideoFrameOrBitmapCapture()&&(this.videoCaptureValue.videoCtrl=e.videodom,this.isSelfViewWithVideo=!0):F.Ay.isSelfPreviewRenderWithVideo()&&(this.videoCaptureValue.videoCtrl=e.videodom,this.isSelfViewWithVideo=!0));if(e.ssrc=e.userId,e.canvas=(0,F.e5)(e.canvas).dom,!e.canvas)return void H.Ay.error("ADDRENDERERR :".concat(e.userId,", canvas:").concat(e.canvas));const i=J.A.browserFeature;if(i){if(He.addRenderCanvas(e.canvas.id,e.canvas),e.x=Math.floor(e.x),e.y=Math.floor(e.y),e.width=Math.floor(e.width),e.height=Math.floor(e.height),this.isCreateVideoWaterMark=e.enableWaterMark,this.videoWaterMarkName=this.isCreateVideoWaterMark?e.waterMarkText:"",this.isMultiView||e.isMyself||this.CheckCurrentActiveSSRC(e.ssrc),this.checkIsRenderInWorker()&&i.isSupportOffScreenCanvasWebgl()){var a;const t=F.I4.getIsRenderSelfVideoInEncodeWorker(J.A.localSsrc&&(0,F.XF)(e.ssrc)===(0,F.XF)(J.A.localSsrc)),i=t?J.A.localVideoEncMGR:J.A.localVideoDecMGR,r=J.A.SPECIAL_ID,n=null===(a=e.canvas)||void 0===a?void 0:a.id;this.replaceCanvasMap.videoDecodeCanvasIds||(this.replaceCanvasMap.videoDecodeCanvasIds=[]),this.replaceCanvasMap.videoEncodeCanvasIds||(this.replaceCanvasMap.videoEncodeCanvasIds=[]),t?-1===this.replaceCanvasMap.videoEncodeCanvasIds.indexOf(n)&&this.replaceCanvasMap.videoEncodeCanvasIds.push(n):-1===this.replaceCanvasMap.videoDecodeCanvasIds.indexOf(n)&&this.replaceCanvasMap.videoDecodeCanvasIds.push(n);try{if(i){const t=i.map.get(r);if(t){const i=e.canvas.transferControlToOffscreen(),r={command:"renderOfflineCanvas",ssrc:e.ssrc,rendercanvasID:n,canvas:i,isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName,waterMarkText:e.waterMarkText,watermarkOpacity:e.watermarkOpacity,watermarkRepeated:e.watermarkRepeated,watermarkPosition:e.watermarkPosition,x:e.x,y:e.y,width:e.width,height:e.height,zone:e.zone,fillMode:e.fillMode,fillModeForResolution:e.fillModeForResolution};t.postMessage(r,[i])}}}catch(t){if(i){const t=i.map.get(r);if(t){const i={command:"renderOfflineCanvas",rendercanvasID:n,ssrc:e.ssrc,videoWaterMarkName:this.videoWaterMarkName,isCreateVideoWaterMark:this.isCreateVideoWaterMark,waterMarkText:e.waterMarkText,watermarkOpacity:e.watermarkOpacity,watermarkRepeated:e.watermarkRepeated,watermarkPosition:e.watermarkPosition,x:e.x,y:e.y,width:e.width,height:e.height,zone:e.zone,fillMode:e.fillMode,fillModeForResolution:e.fillModeForResolution};t.postMessage(i)}}}-1===this.RenderInMain&&(this.RenderInMain=0),this.currentactive&&this.changeVideoRenderActiveSsrc(this.currentactive)}else{var n;e.isMyself||Ci({command:"RenderInMain"});const i=null===(n=e.canvas)||void 0===n?void 0:n.id;if(this.videoRenderArray.length)for(t=0;t<this.videoRenderArray.length;t++)if(this.videoRenderArray[t].ssrc==e.ssrc&&this.videoRenderArray[t].zone==e.zone)return;var s,o;e.rendercanvasID=i,this.videoRenderArray.push(e),this.VideoRenderObj||(this.VideoRenderObj=new zr(Object.assign({},Ph(Ph({Notify_APPUI:J.A.Notify_APPUI.bind(J.A),isSupportOffscreenCanvas:!1,jsMediaEngine:r},J.A.enableMultiDecodeVideoWithoutSAB?{videodecodethreadnumb:25}:{videodecodethreadnumb:(0,F.OC)()}),{},{globalTracingLogger:H.Ay,monitorLoggerFn:Y.A.add_monitor,renderManager:this.renderManager}))),null!=this&&null!==(s=this.videoCaptureValue)&&void 0!==s&&s.ssid&&(null===(o=this.VideoRenderObj)||void 0===o||o.Set_LocalVideo_SSRC(this.videoCaptureValue.ssid))),this.activeSpeakerSsrc&&this.VideoRenderObj.setActiveSpeakerSsrc(this.activeSpeakerSsrc),e.canvasList&&e.canvasList.forEach((t=>{this.videoRenderArray.push(Object.assign({},e,{canvas:t}))})),xh("Start_Video_Play"),this.Start_Video_Play();const a=J.A.enableMultiDecodeVideoWithoutSAB||F.Ay.isSupportMultiViewAPI();this.VideoRenderObj.Set_Render_Array(this.videoRenderArray,a),this.isCreateVideoWaterMark&&!this.waterMarkCanvas&&(this.waterMarkCanvas=document.createElement("canvas")),this.VideoRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName,watermarkOpacity:e.watermarkOpacity,watermarkRepeated:e.watermarkRepeated,watermarkPosition:e.watermarkPosition}),-1===this.RenderInMain&&(this.RenderInMain=1),this.currentactive&&this.changeVideoRenderActiveSsrc(this.currentactive)}await At(!0)}else H.Ay.error("video decode init not completed")},add_render_video_webrtc:async function(e){this.wmscManager&&this.wmscManager.sendMessageToWMSC({type:"NOTIFY_WMSC_VIDEO_TAG_MAPPING",data:Ph(Ph({},e),{},{action:"add"})})},stop_render_video_wasm:async function(e){if(F.Ay.isSelfPreviewRenderWithVideo()&&e.videodom){const t=this.selfPreviewVideotagList.indexOf(e.videodom);t>=0&&(this.selfPreviewVideotagList.splice(t,1),this.videoCaptureValue&&this.videoCaptureValue.videoCtrl===e.videodom&&this.selfPreviewVideotagList.length?this.switchVideoTagForVideoCapture(this.selfPreviewVideotagList[this.selfPreviewVideotagList.length-1]):this.isStartVideoCapture||Oh.removeVideoStream(e.videodom))}var t;"string"!=typeof e.canvas&&(e.canvas=null===(t=e.canvas)||void 0===t?void 0:t.id),this.videoWaterMarkName="",this.isCreateVideoWaterMark=!1,e.ssrc=e.userId;const i=J.A.browserFeature;if(i){if(this.checkIsRenderInWorker()&&i.isSupportOffScreenCanvasWebgl()&&(F.I4.getIsRenderSelfVideoInEncodeWorker(J.A.localSsrc&&(0,F.XF)(e.ssrc)===(0,F.XF)(J.A.localSsrc))?Si:Ci)({command:"stopVideoRender",ssrc:e.ssrc,canvas:e.canvas,RGBA:e.RGBA,doNotClean:e.doNotClean,x:e.x,y:e.y,zone:e.zone}),this.videoRenderArray.length)for(let t=0;t<this.videoRenderArray.length;t++)if(this.videoRenderArray[t].ssrc==e.ssrc&&this.videoRenderArray[t].zone==e.zone){let i=this.videoRenderArray.splice(t,1);this.StopUserVideoRender(this.VideoRenderObj,i,e.RGBA,!e.doNotClean)}}else H.Ay.error("video decode init not completed")},stop_render_video_webrtc:function(e){this.wmscManager&&this.wmscManager.sendMessageToWMSC({type:"NOTIFY_WMSC_VIDEO_TAG_MAPPING",data:Ph(Ph({},e),{},{action:"remove"})})},Notify_MeidaSDK:async function(e,t){xh(e,t);var i=0;switch(Y.A.add_monitor2("B"+e),e){case u.RJ8:{t.id&&this.vbSettingDomMap[t.id]&&Object.assign(t,this.vbSettingDomMap[t.id]);let e=this;var a,n;if(e.isVBSettingOn=!0,e.isCurrentInMaskStatus=!1,a=t.width?t.width:640,n=t.height?t.height:360,e.videoCaptureWidth?e.videoCaptureWidth=e.videoCaptureWidth:e.videoCaptureWidth=a,e.videoCaptureHeight?e.videoCaptureHeight=e.videoCaptureHeight:e.videoCaptureHeight=n,this.webrtcConfig.webrtcflag?t.videodom&&this.wmscManager&&(this.wmscManager.vbSettingVideoDom=t.videodom):Si({command:"StartVBSetting"}),Y.A.add_monitor(t.bgdom?"VBON":"VBOFF"),t.bgdom)if(this.VBMFlag||(this.VBMFlag=!0,Y.A.send_monitor_directly(y)),"blur"==t.bgdom)this.webrtcConfig.webrtcflag?Oh.changeVBImage("blur"):Si({command:"vbbgimagebitmap",data:t.bgdom});else{let i=(0,F.e5)(t.bgdom).dom;if(!i||!i.naturalWidth||!i.naturalHeight)return Y.A.add_monitor("VBGF"),void J.A.Notify_APPUI(u.KqK,2);e.BgImage=i,createImageBitmap(i).then((e=>{this.webrtcConfig.webrtcflag?Oh.changeVBImage(e):dr(e,"BgImage")})).catch((e=>{Y.A.add_monitor("VBCF"),J.A.Notify_APPUI(u.KqK,2)}))}else this.webrtcConfig.webrtcflag?Oh.isVBEnabled&&Oh.disableVB():dr(null,"BgImage");if(t.canvas){const{id:i,dom:r}=(0,F.e5)(t.canvas);if(this.webrtcConfig.webrtcflag)this.wmscManager&&(this.wmscManager.vbSettingVideoDom=r);else if(!F.Ay.isSupportOffscreenCanvas()||F.Ay.browser.isSafari&&!F.Ay.isSafariVersionHigherThan("17.4"))e.isCurrentInNoVBPreviewStatus=!0,e.videoNoVBPreviewCanvas=r;else{if(e.VideoVBSettingCanvas=r,!e.VideoVBSettingCanvas||e.VideoVBSettingCanvas.width<=0||e.VideoVBSettingCanvas.height<=0)return Y.A.add_monitor("VBCAF"),void J.A.Notify_APPUI(u.KqK,3);try{ir(e.VideoVBSettingCanvas.transferControlToOffscreen(),"VBOfflineCanvas",i)}catch(e){ir(null,"VBOfflineCanvas",i)}}}if(e.isSupportVideoFrameOrBitmapCapture||(e.createVideoElement(),e.videoCaptureHiddenCanvas||(e.videoCaptureHiddenCanvas=F.Ay.isSupport2dOffscreenCanvas()?new OffscreenCanvas(640,360):document.createElement("canvas"),e.videoCaptureHiddenCanvasCtx=e.videoCaptureHiddenCanvas.getContext("2d"))),Oh.shouldCaptureVideo()){if(!tr()&&!this.webrtcConfig.webrtcflag)return xh.warn("not isVideoEncodeHandleReady so return"),void Y.A.add_monitor("not isVideoEncodeHandleReady so return");e.videoCaptureValue?e.videoCaptureValue=Object.assign(e.videoCaptureValue,t):e.videoCaptureValue=t,e.videoCaptureValue.ssid&&(J.A.localSsrc=e.videoCaptureValue.ssid),e.StartVideoMediaCapture()}else e.MaskSettingVideo&&Oh.playVideoStream(e.MaskSettingVideo)}break;case u.ziT:if(Y.A.add_monitor(t.bgdom?"VBON":"VBOFF"),t.bgdom)if(this.VBMFlag||(this.VBMFlag=!0,Y.A.send_monitor_directly(y)),"blur"==t.bgdom)this.webrtcConfig.webrtcflag?Oh.changeVBImage("blur"):Si({command:"vbbgimagebitmap",data:t.bgdom});else{let e=(0,F.e5)(t.bgdom).dom;if(!e||!e.width||!e.height)return Y.A.add_monitor("VBGF"),void J.A.Notify_APPUI(u.KqK,2);this.BgImage=e,createImageBitmap(e).then((e=>{this.webrtcConfig.webrtcflag?Oh.changeVBImage(e):dr(e,"BgImage")})).catch((e=>{Y.A.add_monitor("VBCF"),J.A.Notify_APPUI(u.KqK,2)}))}else this.BgImage=null,this.webrtcConfig.webrtcflag?Oh.isVBEnabled&&Oh.disableVB():dr(null,"BgImage");break;case u.hcn:if((!F.Ay.isSupportOffscreenCanvas()||F.Ay.browser.isSafari&&!F.Ay.isSafariVersionHigherThan("17.4"))&&(this.isCurrentInNoVBPreviewStatus=!1,this.videoNoVBPreviewCanvas&&(this.videoNoVBPreviewCanvasctx&&(this.videoNoVBPreviewCanvasctx.setTransform(1,0,0,1,0,0),this.videoNoVBPreviewCanvasctx.clearRect(0,0,this.videoNoVBPreviewCanvas.width,this.videoNoVBPreviewCanvas.height),this.videoNoVBPreviewCanvasctx=null),this.videoNoVBPreviewCanvas=null),this.isVideoNoVBPreviewCanvasScaled=!1),this.isVBSettingOn=!1,t.isSwitch&&(this.isMaskSettingOn=!0,this.webrtcConfig.webrtcflag||Si({command:"StartMaskSetting",isSwitch:t.isSwitch,enabled:this.isSupportVideoFrameOrBitmapCapture})),this.webrtcConfig.webrtcflag){if(this.wmscManager){const{isConnected:e}=this.wmscManager.vbSettingVideoDom||{};e&&(this.wmscManager.vbSettingVideoDom.srcObject=null),this.wmscManager.vbSettingVideoDom=null}}else Si({command:"finishVBSetting"});this.isStartVideoCapture||this.isMaskSettingOn||this.Stop_Video_Capture(),this.MaskSettingVideo&&this.MaskSettingVideo.pause();break;case u.rpL:{const{id:e,canvas:i,videodom:r}=t;this.vbSettingDomMap[e]={canvas:i,videodom:r}}break;case u.a$m:{const{id:e,canvas:i,videodom:r}=t;delete this.vbSettingDomMap[e]}break;case u._Nl:{if(this.webrtcConfig.webrtcflag)return;if(this.isMaskSettingStarted)return;this.isMaskSettingStarted=!0;let e=this,i=0,r=0;e.isCurrentInMaskStatus=!0,e.isMaskSettingOn=!0,i=t.width?t.width:640,r=t.height?t.height:360,e.ReadyCapureWidth=i,e.ReadyCapureHeight=r,e.videoCaptureWidth?e.videoCaptureWidth=e.videoCaptureWidth:e.videoCaptureWidth=i,e.videoCaptureHeight?e.videoCaptureHeight=e.videoCaptureHeight:e.videoCaptureHeight=r;let a=0,n=0;if(t.canvas){const{dom:i,id:r}=(0,F.e5)(t.canvas);if(e.VideoMaskSettingCanvas=i,e.PrevVideoMaskSettingCanvas=e.VideoMaskSettingCanvas,e.replaceCanvasMap.videoMaskSettingCanvasId=r,!e.VideoMaskSettingCanvas||e.VideoMaskSettingCanvas.width<=0||e.VideoMaskSettingCanvas.height<=0)return void J.A.Notify_APPUI(u.qqH,3);a=t.originWidth||e.VideoMaskSettingCanvas.width,n=t.originHeight||e.VideoMaskSettingCanvas.height}if(t.maskdom){let i=(0,F.e5)(t.maskdom).dom;if(!i||!i.width||!i.height)return void J.A.Notify_APPUI(u.qqH,1);let r=1;0==a||0==n||a==e.VideoMaskSettingCanvas.width&&n==e.VideoMaskSettingCanvas.height||(r=Math.min(1*e.VideoMaskSettingCanvas.width/a,1*e.VideoMaskSettingCanvas.height/n)),e.MaskImage=i,e.maskCoordinate.dx=t.dx?Math.round(t.dx*r):e.maskCoordinate.dx,e.maskCoordinate.dy=t.dy?Math.round(t.dy*r):e.maskCoordinate.dy,e.maskCoordinate.dWidth=t.dWidth?Math.round(t.dWidth*r):e.maskCoordinate.dWidth,e.maskCoordinate.dHeight=t.dHeight?Math.round(t.dHeight*r):e.maskCoordinate.dHeight,e.isSupportVideoFrameOrBitmapCapture&&createImageBitmap(i).then((function(t){cr(t,"MaskImage",e.maskCoordinate,e.videoCaptureWidth,e.videoCaptureHeight)})).catch((e=>{J.A.Notify_APPUI(u.qqH,1)}))}if(t.bgdom){let i=(0,F.e5)(t.bgdom).dom;if(!i||!i.naturalWidth||!i.naturalHeight)return Y.A.add_monitor("VMGF"),void J.A.Notify_APPUI(u.qqH,2);e.BgImage=i,e.isSupportVideoFrameOrBitmapCapture&&createImageBitmap(i).then((function(e){or(e,"BgImage")})).catch((e=>{Y.A.add_monitor("VMCF"),J.A.Notify_APPUI(u.qqH,2)}))}if(e.isSupportVideoFrameOrBitmapCapture||e.createVideoElement(),this.VideoMaskCanvasFillMode=t.fillMode?1:0,Si({command:"StartMaskSetting",fillMode:this.VideoMaskCanvasFillMode,enabled:this.isSupportVideoFrameOrBitmapCapture}),Oh.shouldCaptureVideo()){if(e.videoCaptureHiddenCanvas||e.isSupportVideoFrameOrBitmapCapture||(e.videoCaptureHiddenCanvas=F.Ay.isSupport2dOffscreenCanvas()?new OffscreenCanvas(640,360):document.createElement("canvas"),e.videoCaptureHiddenCanvasCtx=e.videoCaptureHiddenCanvas.getContext("2d")),!tr())return xh.warn("not isVideoEncodeHandleReady so return"),void Y.A.add_monitor("not isVideoEncodeHandleReady so return");e.videoCaptureValue?e.videoCaptureValue=Object.assign(e.videoCaptureValue,t):e.videoCaptureValue=t,e.videoCaptureValue.ssid&&(J.A.localSsrc=e.videoCaptureValue.ssid),e.StartVideoMediaCapture()}else e.MaskSettingVideo&&Oh.playVideoStream(e.MaskSettingVideo),e.isMaskSettingOn&&J.A.Notify_APPUI(u.i8,null);if(e.isSupportVideoFrameOrBitmapCapture||F.Ay.isSupportVideoFrameOrBitmapCapture()&&F.Ay.isSelfPreviewRenderWithVideo())try{ir(e.VideoMaskSettingCanvas.transferControlToOffscreen(),"MaskOfflineCanvas",e.replaceCanvasMap.videoMaskSettingCanvasId)}catch(t){ir(null,"MaskOfflineCanvas",e.replaceCanvasMap.videoMaskSettingCanvasId)}else e.Update_Mask_Texture(e.maskCoordinate,e.videoCaptureWidth,e.videoCaptureHeight)}break;case u.Kn7:{if(this.webrtcConfig.webrtcflag)return;const{id:e,dom:i}=(0,F.e5)(t.canvas);if(this.isSupportVideoFrameOrBitmapCapture||F.Ay.isSupportVideoFrameOrBitmapCapture()&&F.Ay.isSelfPreviewRenderWithVideo()){var s=J.A.SPECIAL_ID;if(J.A.localVideoEncMGR&&(p=J.A.localVideoEncMGR.map.get(s))){var o={command:"update_mask_canvas_size",rendercanvasID:e,width:t.width,height:t.height};p.postMessage(o)}}else t.canvas=i,t.canvas&&(t.canvas.width=t.width,t.canvas.height=t.height);break}case u.aYB:if(this.webrtcConfig.webrtcflag)return;if(this.isSupportVideoFrameOrBitmapCapture)if(t.bgdom){let e=(0,F.e5)(t.bgdom).dom;if(!e||!e.width||!e.height)return void J.A.Notify_APPUI(u.qqH,2);this.BgImage=e,createImageBitmap(e).then((function(e){or(e,"BgImage")})).catch((e=>{J.A.Notify_APPUI(u.qqH,2)}))}else this.BgImage=null,or(null,"BgImage");else{if(t.bgdom){let e=(0,F.e5)(t.bgdom).dom;if(!e||!e.width||!e.height)return void J.A.Notify_APPUI(u.qqH,2);this.BgImage=e}else this.BgImage=null;this.Update_Mask_Texture(this.maskCoordinate,this.videoCaptureWidth,this.videoCaptureHeight)}break;case u.GtU:if(this.webrtcConfig.webrtcflag)return;if(this.maskCoordinate.dx=t.dx,this.maskCoordinate.dy=t.dy,this.maskCoordinate.dWidth=t.dWidth,this.maskCoordinate.dHeight=t.dHeight,this.isSupportVideoFrameOrBitmapCapture)if(t.maskdom){let e=(0,F.e5)(t.maskdom).dom;if(!e||!e.width||!e.height)return void J.A.Notify_APPUI(u.qqH,1);this.MaskImage=e;let i=this.maskCoordinate,r=this.videoCaptureWidth,a=this.videoCaptureHeight;createImageBitmap(e).then((function(e){cr(e,"MaskImage",i,r,a)})).catch((e=>{J.A.Notify_APPUI(u.qqH,1)}))}else this.MaskImage=null,cr(null,"MaskImage",this.maskCoordinate,this.videoCaptureWidth,this.videoCaptureHeight);else{if(t.maskdom){let e=(0,F.e5)(t.maskdom).dom;if(!e||!e.width||!e.height)return void J.A.Notify_APPUI(u.qqH,1);this.MaskImage=e}else this.MaskImage=null;this.Update_Mask_Texture(this.maskCoordinate,this.videoCaptureWidth,this.videoCaptureHeight)}break;case u.g$j:if(this.webrtcConfig.webrtcflag)return;this.isMaskSettingStarted=!1,this.isMaskSettingOn=!1,this.BgImage||(this.isCurrentInMaskStatus=!1),t.isSwitch&&(this.isVBSettingOn=!0,Si({command:"StartVBSetting",isSwitch:t.isSwitch})),this.MaskSettingVideo&&this.MaskSettingVideo.pause(),this.VideoMaskSettingCanvas&&(this.VideoMaskSettingCanvasctx&&(this.VideoMaskSettingCanvasctx.setTransform(1,0,0,1,0,0),this.VideoMaskSettingCanvasctx.clearRect(0,0,this.VideoMaskSettingCanvas.width,this.VideoMaskSettingCanvas.height),this.VideoMaskSettingCanvasctx=null),this.VideoMaskSettingCanvas=null),this.isCanvasScaled=!1,Si({command:"finishMaskSetting"}),this.isStartVideoCapture||this.isVBSettingOn||this.Stop_Video_Capture();break;case u.XHL:this.isMirrorMyVideo=t.isMirrorMyVideo,this.webrtcConfig.webrtcflag?this.wmscManager&&this.wmscManager.mirrorSelfVideo(this.isMirrorMyVideo):(Si({command:"mirrorMyVideo",isMirrorMyVideo:this.isMirrorMyVideo}),this.isSupportOffscreenCanvas?(this.VideoRenderObj&&this.VideoRenderObj.setMirrorMyVideoOption(this.isMirrorMyVideo),Ci({command:"mirrorMyVideo",isMirrorMyVideo:this.isMirrorMyVideo,isSupportOffscreenCanvas:this.isSupportOffscreenCanvas})):(this.VideoRenderObj||(this.VideoRenderObj=new zr(Object.assign({},Ph(Ph({Notify_APPUI:J.A.Notify_APPUI.bind(J.A),isSupportOffscreenCanvas:!1,jsMediaEngine:r,globalTracingLogger:H.Ay,monitorLoggerFn:Y.A.add_monitor},J.A.enableMultiDecodeVideoWithoutSAB?{videodecodethreadnumb:25}:{}),{},{renderManager:this.renderManager}))),this.activeSpeakerSsrc&&this.VideoRenderObj.setActiveSpeakerSsrc(this.activeSpeakerSsrc)),this.VideoRenderObj.setMirrorMyVideoOption(this.isMirrorMyVideo)));break;case u.wIu:var d,c;if(this.webrtcConfig.webrtcflag)null===(d=this.wmscManager)||void 0===d||d.onActiveSpeakerChange(t.ssrc);else Y.A.add_monitor("ACTIVESSRC:".concat(t.ssrc)),er(Q._c.VIDEO_DECODE,{ssrc:t.ssrc},"newActiveSpeakerSsrc",!1,!0),1==this.RenderInMain&&(null===(c=this.VideoRenderObj)||void 0===c||c.setActiveSpeakerSsrc(t.ssrc)),this.activeSpeakerSsrc=t.ssrc;break;case u.K3m:Y.A.add_monitor("CANCELACTIVE:".concat(t.ssrc)),Ci({command:"cancelNewActiveSpeakerSsrcBefreCallback",ssrc:t.ssrc,haddata:t.haddata}),this.activeSpeakerSsrc=0;break;case u.tm0:Y.A.add_monitor(t.message);break;case u.EYN:if(!J.A.rwgAgent)break;this.userId!=t.userId&&J.A.sendMessageToRwg(u.fmn,{evt:12303,seq:1,body:{subInfoList:[{id:Number(t.userId),size:Number(t.videoQuality),bOn:!1}]}});break;case u.BqC:if(Y.A.add_monitor("ADDRENDER:".concat(t.userId)),this.webrtcConfig.webrtcflag){var h;const e=parseInt(t.userId),i=null===(h=this.wmscManager)||void 0===h?void 0:h.isSelfVideo(e);if(1===e&&this.wmscManager&&(this.wmscManager.activeSpeakerVideoDom=t.videodom),this.videoCaptureValue&&i)return wh.hasMediaStreamFrameProcessor()&&Oh.processedStream?t.videodom.srcObject=Oh.processedStream:Oh.isVBEnabled?t.videodom.srcObject=Oh.vbStream:t.videodom.srcObject=Oh.videoStream,this.wmscManager?(this.wmscManager.selfVideoDomMap.set(t.zone,t.videodom),this.wmscManager.mirrorVideoEle(t.videodom,this.wmscManager.isMirror),this.wmscManager.playSelfVideo("addRenderVideo",t.videodom)):(H.Ay.error("WMSC_Self_Add_Render, ".concat(t.userId)),t.videodom.play().catch((()=>{H.Ay.error("WMSC_SV_ARP_F: ".concat(t.userId))}))),void(this.webrtcConfig.userId=parseInt(t.userId));await this.add_render_video_webrtc(t)}else await this.add_render_video_wasm(t);break;case u.r2c:{const{id:e,dom:i}=(0,F.e5)(t.canvas),r=J.A.browserFeature;if(!r){H.Ay.error("video decode init not completed");break}if((0,F.i1)(t.width,t.height),this.checkIsRenderInWorker()&&r.isSupportOffScreenCanvasWebgl()){s=J.A.SPECIAL_ID;var l=null;J.A.localVideoEncMGR&&J.A.enableVirtualBackgroundWithoutSAB&&(l=J.A.localVideoEncMGR.map.get(s)),J.A.localVideoDecMGR&&(p=J.A.localVideoDecMGR.map.get(s))&&(o={command:"update_canvas_size",rendercanvasID:e,width:t.width,height:t.height},p.postMessage(o),l&&l.postMessage(o))}else t.canvas=i,t.canvas&&(t.canvas.width=t.width,t.canvas.height=t.height);this.UpdateVideoPlayStatus(!0)}break;case u.PSY:{Y.A.add_monitor("ZOOMRENDER:".concat(t.userId)),"string"!=typeof t.canvas&&(t.canvas=t.canvas.id);const e=J.A.browserFeature;if(!e){H.Ay.error("video decode init not completed");break}if(this.checkIsRenderInWorker()&&e.isSupportOffScreenCanvasWebgl()){const e=F.I4.getIsRenderSelfVideoInEncodeWorker(J.A.localSsrc&&(0,F.XF)(t.userId)===(0,F.XF)(J.A.localSsrc));let i=J.A.SPECIAL_ID;var p=null;e&&J.A.localVideoEncMGR?p=J.A.localVideoEncMGR.map.get(i):J.A.localVideoDecMGR&&(p=J.A.localVideoDecMGR.map.get(i)),p&&(o={command:"zoomrender",ssrc:t.userId,x:t.x,y:t.y,width:t.width,height:t.height,canvas:t.canvas,zone:t.zone,RGBA:t.RGBA},p.postMessage(o))}if(this.videoRenderArray.length)for(i=0;i<this.videoRenderArray.length;i++)this.videoRenderArray[i].ssrc==t.userId&&this.videoRenderArray[i].zone==t.zone&&(this.videoRenderArray[i].x=t.x,this.videoRenderArray[i].y=t.y,this.videoRenderArray[i].width=t.width,this.videoRenderArray[i].height=t.height)}break;case u.QoY:if(Y.A.add_monitor("RMRENDER:".concat(t.userId)),this.webrtcConfig.webrtcflag){var f;const e=parseInt(t.userId),i=null===(f=this.wmscManager)||void 0===f?void 0:f.isSelfVideo(e);if(1===e&&this.wmscManager&&(this.wmscManager.activeSpeakerVideoDom=null),i)return void(this.wmscManager&&this.wmscManager.selfVideoDomMap.has(t.zone)&&this.wmscManager.selfVideoDomMap.delete(t.zone));this.stop_render_video_webrtc(t)}else await this.stop_render_video_wasm(t);break;case u.X0s:var g=null;if(F.Ay.isSelfPreviewRenderWithVideo()){let e;e=t instanceof Array?t[0]:t,g=e instanceof HTMLVideoElement?e:(0,F.e5)(e).dom}if(!this.videoCaptureValue)break;if(F.Ay.isSelfPreviewRenderWithVideo()&&g&&g instanceof HTMLVideoElement)this.switchVideoTagForVideoCapture(g);else{var m=[];t instanceof Array?m=t:m.push(t);var v=this.videoCaptureValue.canvasCtrlList.filter((function(e){return-1!==m.indexOf(e.k)})).map((function(e){return e.dom}));this.switchCanvasForVideoCapture(v)}break;case u.Ikw:this.webrtcConfig.webrtcflag?this.start_capture_video_webrtc(t):this.start_capture_video_wasm(t);break;case u.CQt:var A=this;return new Promise(((e,t)=>{try{if(Oh.isCaptureVideoInProgress)return J.A.Notify_APPUI(u.gFh,null),t(new Error("Too many calls : the device is opening camera now, cannot stop video capture"));A.isStartVideoCapture&&A.Stop_Video_Capture(),J.A.Notify_APPUI(u.Wcg,null),e(!0)}catch(e){J.A.Notify_APPUI(u.gFh,null),t(e)}J.A.extVBPort&&J.A.extVBPort.postMessage({type:u.L_m})}));case u._Gi:0==this.audioRenderArray.length&&(this.audioRenderArray.push(t),this.Start_Audio_Play());break;case u.HKK:if(this.audioRenderArray.length>0)for(this.Stop_Audio_Play(),i=0;i<this.audioRenderArray.length;i++)this.audioRenderArray[i].ssrc==t.ssrc&&this.audioRenderArray.splice(i,1);break;case u.lyw:await er(Q._c.AUDIO_DECODE,{bPause:t.bPause},"PAUSE_OR_RESUME_AUDIO_DECODE",!1,!0);break;case u.wk9:var S;this.captureAudioMuted=!1,this.audioInputLevel&&this.audioInputLevel.start(),this.useAudioBridge&&(null===(S=this.audioBridge)||void 0===S||S.unmute()),this.UnMuteAudio();break;case u.pOT:var _;this.captureAudioMuted=!0,this.audioInputLevel&&this.audioInputLevel.stop(),this.useAudioBridge&&(null===(_=this.audioBridge)||void 0===_||_.mute()),this.MuteAudio();break;case u.n7n:this.startAnnotation(t,!0);break;case u.tN9:this.stopAnnotation(t);break;case u.MP_:var C;null===(C=this.annotationMgr)||void 0===C||C.onAnnotationActions(t);break;case u.A3p:var b;if(this.loadAnnotationModule(),this.sharingCanvasList.includes(t.canvas.id)||this.sharingCanvasList.push(t.canvas.id),this.mainSharingCanvas=t.canvas,this.annoCanvas=t.annoCanvas,this.annoPresenterCanvas=t.annoPresenterCanvas||this.annoPresenterCanvas,this.localShareCanvas=t.localShareCanvas||this.localShareCanvas,null===(b=this.annotationMgr)||void 0===b||b.updateCanvas({sharingMainCanvas:this.mainSharingCanvas,annoCanvas:this.annoCanvas}),Object.assign(t,this.sharingWaterMarkParams),this.isSupportVideoShare?Ei({command:"startSharingRender"}):Ri({command:"startSharingRender"}),this.currentshareactive=t.ssrc,null==this.currentshareactive&&Y.A.add_monitor2("SSRC"),this.isCreateSharingWaterMark=t.enableWaterMark,this.sharingWaterMarkName=this.isCreateSharingWaterMark?t.waterMarkText:"",He.addRenderCanvas(t.canvas.id,t.canvas),this.isSupportOffscreenCanvas){-1===this.RenderInMain&&(this.RenderInMain=0);try{s=J.A.SPECIAL_ID,this.replaceCanvasMap.sharingMainCanvasId=t.canvas.id,p=null,this.isSupportVideoShare?J.A.localVideoDecMGR&&(p=J.A.localVideoDecMGR.map.get(s)):J.A.localSharingDecMGR&&(p=J.A.localSharingDecMGR.map.get(s)),p&&(this.sharingRenderCanvas=t.canvas.transferControlToOffscreen(),(0,F.i1)(t.canvas.width,t.canvas.height),o={command:"sharingRenderCanvas",canvas:this.sharingRenderCanvas,rendercanvasID:this.replaceCanvasMap.sharingMainCanvasId,ssrc:this.currentshareactive,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:t.watermarkOpacity,watermarkRepeated:t.watermarkRepeated,isFromMainSession:t.isFromMainSession,watermarkPosition:t.watermarkPosition},p.postMessage(o,[o.canvas]))}catch(e){s=J.A.SPECIAL_ID,p=null,this.isSupportVideoShare?J.A.localVideoDecMGR&&(p=J.A.localVideoDecMGR.map.get(s)):J.A.localSharingDecMGR&&(p=J.A.localSharingDecMGR.map.get(s)),p&&(o={command:"sharingRenderCanvas",rendercanvasID:this.replaceCanvasMap.sharingMainCanvasId,ssrc:this.currentshareactive,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:t.watermarkOpacity,watermarkRepeated:t.watermarkRepeated,isFromMainSession:t.isFromMainSession,watermarkPosition:t.watermarkPosition},p.postMessage(o))}}else-1===this.RenderInMain&&(this.RenderInMain=1),this.SharingRenderObj||(this.SharingRenderObj=new Qr(Object.assign({},{Notify_APPUI:J.A.Notify_APPUI.bind(J.A),PubSub:X,jsMediaEngine:r,globalTracingLogger:H.Ay,renderManager:this.renderManager}))),this.renderManager.getRendererProvider().isWebGLRendererType()?this.sharingDisplay=new sa(t.canvas,t.canvas.id,0,void 0,{preserveDrawingBuffer:!1},void 0,void 0,J.A.enableCanvasAlphaChannel):this.renderManager.getRendererProvider().isWebGL2RendererType()&&(this.sharingDisplay=new pa(t.canvas,t.canvas.id,0,void 0,{preserveDrawingBuffer:!1},void 0,void 0,J.A.enableCanvasAlphaChannel)),this.SharingRenderObj.Set_Render_Display(this.sharingDisplay),this.SharingRenderObj.Change_Current_SSRC(this.currentshareactive,t.isFromMainSession),this.isCreateSharingWaterMark&&!this.waterMarkCanvas&&(this.waterMarkCanvas=document.createElement("canvas")),this.SharingRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:t.watermarkOpacity,watermarkRepeated:t.watermarkRepeated,watermarkPosition:t.watermarkPosition}),this.sharingInterval||(this.sharingInterval=this.JsMediaSDK_SharingRenderInterval(this.sharingIntervalTime,t.isVideoShare)),St(!0);break;case u.m1Q:if(t.canvas){const e=this.sharingCanvasList.indexOf(t.canvas.id);-1!==e&&this.sharingCanvasList.splice(e,1)}else this.sharingCanvasList=[];if(0!==this.sharingCanvasList.length)return;this.mainSharingCanvas=null,this.annoCanvas=null,St(!1),this.isSupportVideoShare?Ei({command:"stopSharingRender"}):Ri({command:"stopSharingRender"}),this.isCreateSharingWaterMark=!1,this.sharingWaterMarkName="",this.sharingInterval&&(clearInterval(this.sharingInterval),this.sharingInterval=0),this.sharingDisplay&&(this.sharingDisplay.clear(),this.sharingDisplay.cleanup(),this.sharingDisplay=null),this.SharingRenderObj&&(this.SharingRenderObj.ClearQueue(),this.SharingRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName}));break;case u.cJy:{var w;let{width:e,height:i,canvas:r}=t;if(r&&r.id&&!this.sharingCanvasList.includes(r.id)&&this.mainSharingCanvas!==r)return;if(xh("UPDATE_SHARING_DECODE_PARAM",t),this.SharingRenderObj?this.SharingRenderObj.Update_Sharing_Canvas_Size({width:e,height:i}):this.isSupportVideoShare?Ei({command:"UPDATE_SHARING_CANVAS_SIZE",width:e,height:i}):Ri({command:"UPDATE_SHARING_CANVAS_SIZE",width:e,height:i}),hr())return(0,F.i1)(e,i),xh("isSharingNotClearChromeVersion",hr());if(null===(w=this.annotationMgr)||void 0===w||w.updateAnnoCanvasSize({width:e,height:i}),!J.A.rwgAgent)break;this.isSupportVideoShare?Ei({command:"SET_OFFSCREENCANVAS_WIDTH_HEIGHT",data:{width:e,height:i}}):await er(Q._c.SHARING_DECODE,{width:e,height:i},"SET_OFFSCREENCANVAS_WIDTH_HEIGHT",!1,!0);break}case u.exH:case u.uiF:break;case u.g8Z:{if(!t.AudioSelectValue)return void J.A.Notify_APPUI(u.G9o,u.g8Z);let e=Date.now();var E;if(this.useAudioBridge)return void(null===(E=this.audioBridge)||void 0===E||E.changeSpeaker(t.AudioSelectValue));this.selectComputerAudioSpeaker(t.AudioSelectValue,e)}break;case u.i9k:Va.changeDenoiseSwitch(t.switch);break;case u.Aew:{var R;let e=null===(R=this.audioCapture)||void 0===R?void 0:R.audioProfile;if(!e)break;if(this.audioCapture.audioProfile=t,"backgroundNoiseSuppression"===t.currentSelect){if("backgroundNoiseSuppression"!==e.currentSelect){let e={command:"original_sound_switch",enable:!1,highfidelity:!1,stereo:!1};var T;this.useAudioBridge?await(null===(T=this.audioBridge)||void 0===T?void 0:T.setAudioProfile(t)):Ii(e),Oh.destoryAudioMediaStream(),this.Start_Audio_Capture()}var I;e.highBitrate!==t.highBitrate&&(this.useAudioBridge?await(null===(I=this.audioBridge)||void 0===I?void 0:I.setAudioProfile(t)):Ii({command:"highBitrate",highBitrate:t.highBitrate?1:0}));let i="Zoom"===t.backgroundNoiseSuppression;Va.changeDenoiseSwitch(i)}else{var M;let i={command:"original_sound_switch",enable:!0,highfidelity:t.originalSound.highfidelity,stereo:t.originalSound.stereo};var D;this.useAudioBridge?await(null===(D=this.audioBridge)||void 0===D?void 0:D.setAudioProfile(t)):Ii(i),"originalSound"===e.currentSelect&&(null===(M=e.originalSound)||void 0===M?void 0:M.stereo)===t.originalSound.stereo||(Oh.destoryAudioMediaStream(),this.Start_Audio_Capture())}}break;case u.XE6:{var P;let e=Object.assign({},this.VALUE_CACHE_FOR_START_CAPTURE_VIDEO,t);if(!this.isSupportMediaStreamTrackProcessor){if(e.canvasCtrlList=[],e.canvas instanceof Array)for(i=0;i<e.canvas.length;i++)e.canvasCtrlList.push({k:e.canvas[i],dom:(0,F.e5)(e.canvas[i]).dom});else e.canvasCtrlList.push({k:e.canvas,dom:(0,F.e5)(e.canvas).dom});e.canvasCtrl=e.canvasCtrlList[0].dom}e.videoCtrl=this.captureVideoOutPutVideoDom,null!==(P=this.videoloadmetadataListener)&&void 0!==P&&P.remove&&(this.videoloadmetadataListener.remove(),this.videoloadmetadataListener=null),this.isVideoCaptureLoadedmetadata=!1,Oh.destoryVideoMediaStream(),this.videoCaptureValue=e,Oh.removeVideoStream(this.videoCaptureValue.videoCtrl),this.StartVideoMediaCapture()}break;case u.K9M:{t.canvas&&(t.rendercanvasID=t.canvas);let e=Object.assign({},this.desktopSharingValue,t);this.EndSharingMediaStream(),this.desktopSharingValue=e,this.StartDesktopMediaCapture()}break;case u.QQs:this.EndSharingMediaStream(),this.desktopSharingValue=t,this.StartDesktopMediaCapture();break;case u.Qc:this.currentactive!=t.ssrc&&(this.currentactive=t.ssrc,J.A.CurrentSSRC=this.currentactive,this.changeVideoRenderActiveSsrc(this.currentactive)),Ti(J.A.CurrentSSRC);break;case u.RmE:this.currentshareactive!=t.ssrc&&(this.currentshareactive=t.ssrc),this.isSupportOffscreenCanvas?this.isSupportVideoShare?Ei({command:"CHANGE_CURRENT_SHARING_ACTIVE_SSRC",ssrc:t.ssrc,isFromMainSession:t.isFromMainSession}):(s=J.A.SPECIAL_ID,J.A.localSharingDecMGR&&(p=J.A.localSharingDecMGR.map.get(s))&&(o={command:"CHANGE_CURRENT_SHARING_ACTIVE_SSRC",ssrc:t.ssrc,isFromMainSession:t.isFromMainSession},p.postMessage(o))):(this.SharingRenderObj||(this.SharingRenderObj=new Qr(Object.assign({},{Notify_APPUI:J.A.Notify_APPUI.bind(J.A),PubSub:X,jsMediaEngine:r,globalTracingLogger:H.Ay,renderManager:this.renderManager}))),this.SharingRenderObj.Change_Current_SSRC(this.currentshareactive,t.isFromMainSession));break;case u._Zs:this.Stop_Audio_Play();break;case u.I8$:this.Meeting_Fail_Over(t.audio_websocket_address,t.video_websocket_address);break;case u.hs:xh("jsEvent.END_MEDIA"),X.trigger(u.gh2.END_MEDIA),this.removeVbReceiver(),this.destroy().catch((e=>xh.error(e)));break;case u.eEQ:!async function(e,t,i){switch(t){case u.eEQ:{const{result:t,reason:r}=function(e){if(F.Ay.isMobileForceAutoChooseAudioDeviceEnable()){var t;if(e.getMediaStreamController().isAudioCaptureProgressing())return{result:!0,reason:"capture processing"};if(null!=e&&null!==(t=e.audioBridge)&&void 0!==t&&t.getHealthCheckFailedAndReset())return{result:!1,reason:"health check failed"};if(Eh.isCaptureHealthy(e.getMediaStreamController()))return{result:!0,reason:"capture healthy"}}return{result:!1}}(e);if(r&&H.Ay.log("[Audio] CHANGE_AUDIO_MIC ignored result=".concat(t,",").concat(r)),t)break;if(!i){J.A.Notify_APPUI(u.G9o,u.eEQ);break}await Rh(e,i);break}}}(this,e,t);break;case u.Mhb:t&&(hi(J.A.SPECIAL_ID,u.Eym),Oh.destoryAudioMediaStream(),this.Remove_Audio_Capture(),this.audioCapture=t,this.Start_Audio_Capture(),Vi());break;case u.tav:if(Oh.destoryAudioMediaStream(),document.removeEventListener("visibilitychange",Vh),this.setFileAudioPlaybackSwitch(!1),Ii({command:132,value:!1}),this.audioCapture=null,this.captureAudioMuted=!1,this.hidAvalible&&(await za.destroy(),this.hidAvalible=!1),J.A.ComputerAudioStatus=Q.BX.ComputerAudio_Null,this.audioInputLevel)return this.audioInputLevel.destroy(),this.audioInputLevel=null,void J.A.Notify_APPUI(u.DjR,null);if(this.useAudioBridge)return this.audioBridge&&(this.audioBridge.isMutedBySystem=!1,this.audioBridge.enableBroadCastToBO(!1),this.audioBridge.leaveAudioWithoutDisconnect(1)),void J.A.Notify_APPUI(u.DjR,null);if(J.A.ComputerAudioStatus===Q.BX.ComputerAudio_Connecting)return void J.A.Notify_APPUI(u.DjR,null);this.Remove_Audio_Capture(),this.Remove_Audio_Play(),this.CloseBoringPeerConnection(),this.checkWorkletInterval&&(clearInterval(this.checkWorkletInterval),this.checkWorkletInterval=null);try{J.A.AudioNode&&(J.A.AudioNode.disconnect(),J.A.AudioNode.postCMD("stopWorklet",!0),J.A.AudioNode.port=null)}catch(e){xh("AudioNode.port",e)}J.A.AudioNode=null,J.A.workletWasmInitSuccess=!1,this.audioCtx&&(this.audioCtx.onstatechange=null,this.audioCtx.onerror&&(this.audioCtx.onerror=null),this.audioCtx.close(),this.isCaputureNodeConnect=!1),this.audioCtx=null,this.audioPlay=!1,this.audioDomNode=null,J.A.Notify_APPUI(u.DjR,null);break;case u.UGN:if(Y.A.add_monitor("JCAA:"+t.checkAutoplay),this.enableHID=t.CaptureAudioInfo.enableHID,this.enableHID&&t.CaptureAudioInfo.microphoneLabel)try{this.hidAvalible=await za.init(t.CaptureAudioInfo.microphoneLabel,t.CaptureAudioInfo.defaultMuted)}catch(e){H.Ay.log("auto connect hid fail"),J.A.Notify_APPUI(u.dUL,e)}J.A.ComputerAudioStatus=Q.BX.ComputerAudio_Connecting;try{t.checkAutoplay&&await F.Ay.checkAudioAutoPlay()}catch(e){return xh.error("audio auto play",e),H.Ay.error("check auto play fail",e),J.A.ComputerAudioStatus=Q.BX.ComputerAudio_Null,J.A.Notify_APPUI(u.Ubu,null),J.A.Notify_APPUI(u.yEo,e)}if(this.audioInputLevel&&(this.audioInputLevel.destroy(),this.audioInputLevel=null),t.isPreviewMode)return void(t.CaptureAudio?(this.audioCapture=t.CaptureAudioInfo,this.audioInputLevel=new ga({analyserCallback:e=>{J.A.Notify_APPUI_SAFE(u._9I,{value:e})}}),Oh.shouldCaptureAudio()||J.A.Notify_APPUI(u.h73,null),this.Start_Audio_Capture()):(J.A.ComputerAudioStatus=Q.BX.ComputerAudio_Connected,J.A.Notify_APPUI(u.Ubu,null)));if(!this.isSupportVideoShare&&this.isSupportOffscreenCanvas){var k=new MessageChannel;gi(k,k)}if(this.useAudioBridge=!!t.audioBridge,this.useAudioBridge){Va.setUserId(t.CaptureAudioInfo.ssrc);const{nginxHost:e,rwgHost:i,cid:r,abToken:a,supportLocalAB:n,useWebRTCOnDesktop:s}=t.audioBridge;if(await this.previewInit({audioBridge:{nginxHost:e,rwgHost:i,cid:r,abToken:a,isCapturingAudio:t.CaptureAudio,audioMode:1,supportLocalAB:n,useWebRTCOnDesktop:s}}),!this.audioBridge){H.Ay.error("audioBridge instance is null after initialization");break}var O;if(Va.setAudioBridge(this.audioBridge),t.CaptureAudio?(this.audioCapture=t.CaptureAudioInfo,null!==(O=t.CaptureAudioInfo)&&void 0!==O&&O.audioProfile&&this.audioBridge.setAudioProfile(t.CaptureAudioInfo.audioProfile),this.Start_Audio_Capture()):(J.A.ComputerAudioStatus=Q.BX.ComputerAudio_Connected,J.A.Notify_APPUI(u.Ubu,null)),F.Ay.isAndroidBrowser()||F.Ay.isQuestBrowser()||!F.Ay.browser.isChrome&&!F.Ay.isFirefoxVersionHigherThan(116))Va.updateSelectedSpeakerDevices("default",0,!0);else{var x,V;let e=null!==(x=t.speakerInfo)&&void 0!==x&&x.defaultDeviceId?null===(V=t.speakerInfo)||void 0===V?void 0:V.defaultDeviceId:"";this.selectComputerAudioSpeaker(e,Date.now())}return}try{this.Remove_Audio_Play(),this.Remove_Audio_Capture(),this.CloseBoringPeerConnection(),hi(J.A.SPECIAL_ID,u.Eym),this.audioCtx&&(this.audioCtx.close(),this.audioCtx.onerror&&(this.audioCtx.onerror=null),this.audioCtx=null,this.isCaputureNodeConnect=!1),this.audioCtx=(0,F.Bw)(),F.Ay.isChromeVersionHigherThan(129)&&!this.audioCtx.onerror&&(this.audioCtx.onerror=()=>{Y.A.add_monitor("AUDIOCONTEXT:ERROR")}),this.audioCtx.sampleRate!=this.sampleRate&&(this.sampleRate=this.audioCtx.sampleRate,ui(this.sampleRate)),this.disableAudioAGC=t.disableAudioAGC,this.disableNoiseSuppression=t.disableNoiseSuppression,this.disableBrowserAec=t.disableBrowserAec,this.bAudioDecodeUsingSAB&&Y.A.add_monitor("ASSAB"),"suspended"===this.audioCtx.state&&this.audioCtx.resume().catch((e=>{H.Ay.error("audioContext resume fail",e)})),A=this;let e=null,i=null;if(J.A.decoderinworklet?await F.Ay.isSDKSupportSIMD()?(e=this.audioWorkletJsPath.audioWorkletSIMDPath,i=this.audioWorkletJsPath.audioSIMDWasm):(e=this.audioWorkletJsPath.audioWorkletProcessPath,i=this.audioWorkletJsPath.audioWasm):e=this.audioWorkletJsPath.audioWorkletPath,this.isDestroy)return;let r=null;i&&(r=await F.Ay.downloadAndCompileWebAssembly(i,"AudioWorklet",Y.A,!F.Ay.browser.isSafari&&J.A.enableStreamingInstantiate)),await this.audioCtx.audioWorklet.addModule(e),J.A.AudioNode=new _r(A.audioCtx,"zoomAudioWorklet",{processorOptions:{sharedBuffer:F.Ay.browser.isSafari&&J.A.sharedBuffer?J.A.sharedBuffer:null,userAgent:navigator.userAgent,audioDecodeChannelsNum:F.Ay.isSupportPlayStereo()?2:1,audioEncodeChannelsNum:F.Ay.isBrowserSupportStereo()?2:1,wasmModule:r},numberOfOutputs:1,outputChannelCount:[2]}),J.A.AudioNode.onprocessorerror=e=>{Y.A.add_monitor("CWFIP"),H.Ay.error("Exception thrown in AudioWorkletProcessor",e)},F.Ay.browser.isSafari&&!J.A.sharedBuffer&&J.A.AudioNode.postCMD("diableSharedArrayBuffer"),J.A.decoderinworklet||J.A.AudioNode.postCMD("disableDecoderinworklet"),J.A.decoderinworklet&&(this.codecDoAVSync?J.A.AudioNode.postCMD("codecDoAVSync",!0):J.A.CurrentSSRC&&J.A.AudioNode.postCMD("currentSSRC",J.A.CurrentSSRC),J.A.AudioNode.postCMD("initData",{userid:t.CaptureAudioInfo.ssrc,meetingnumb:J.A.localAudioPara.meetingnumb,meetingid:J.A.localAudioPara.meetingid}),J.A.AudioNode.postCMD("audiowasm")),A.checkWorkletInterval&&(clearInterval(A.checkWorkletInterval),A.checkWorkletInterval=null),A.checkWorkletInterval=setInterval((()=>{J.A.AudioNode&&J.A.AudioNode.postCMD("checkProcess",null)}),1e4);let a=F.Ay.isSupportChromeWideAEC()&&!J.A.shareSystemAudio;if(!F.Ay.browser.isChrome||F.Ay.isAndroidBrowser()||F.Ay.isQuestBrowser())if(J.A.sharedBuffer&&J.A.AudioNode.postCMD("sharedBuffer",F.Ay.browser.isSafari?null:J.A.sharedBuffer),F.Ay.isAndroidBrowser()||F.Ay.isQuestBrowser()){let e=A.audioCtx.createMediaStreamDestination();J.A.AudioNode.connect(e),this.disableBrowserAec?this.isSupportBrowserAec=!1:this.isSupportBrowserAec=await this.isLocalP2PSupportedPromise;let t=e.stream;this.disableBrowserAec||(this.isSupportBrowserAec?t=await A.chromeAecWorkAround(e.stream):li(J.A.SPECIAL_ID,!1)),A.audioDomNode||(A.audioDomNode=new Audio),A.audioDomNode.srcObject=t,A.audioDomNode.play().catch((e=>{H.Ay.error("Audio play failed",e)}))}else if(F.Ay.browser.isFirefox&&F.Ay.isFirefoxVersionHigherThan(116)){let e=A.audioCtx.createMediaStreamDestination();J.A.AudioNode.connect(e);let i=e.stream;A.audioDomNode||(A.audioDomNode=new Audio),A.audioDomNode.srcObject=i;let r=null,a=Date.now();r=t.speakerInfo&&t.speakerInfo.defaultDeviceId?t.speakerInfo.defaultDeviceId:"",this.selectComputerAudioSpeaker(r,a),A.audioDomNode.play().catch((e=>{H.Ay.error("Audio play failed",e)}))}else J.A.AudioNode.connect(A.audioCtx.destination),Va.updateSelectedSpeakerDevices("default",0,!0);else{let e;if(this.disableBrowserAec?this.isSupportBrowserAec=!1:this.isSupportBrowserAec=a||await this.isLocalP2PSupportedPromise,J.A.sharedBuffer&&J.A.AudioNode.postCMD("sharedBuffer",J.A.sharedBuffer),!this.disableBrowserAec)if(this.isSupportBrowserAec){if(!a){let t=A.audioCtx.createMediaStreamDestination();J.A.AudioNode.connect(t),e=t.stream,e=await A.chromeAecWorkAround(t.stream)}}else li(J.A.SPECIAL_ID,!1);let i=null;i=t.speakerInfo&&t.speakerInfo.defaultDeviceId?t.speakerInfo.defaultDeviceId:"";let r=Date.now();a?J.A.AudioNode.connect(A.audioCtx.destination):(A.audioDomNode||(A.audioDomNode=new Audio),A.audioDomNode.srcObject=e,A.audioDomNode.play().catch((e=>{H.Ay.error("Audio play failed",e)}))),A.selectComputerAudioSpeaker(i,r)}Mi({command:"stop_audio_incoming",stopPlayAudio:!1}),Ii({command:"startAudioEncode",ssid:t.CaptureAudioInfo.ssrc,audioMode:J.A.audioMode}),zi(J.A.e2eencrypt);var N=new MessageChannel,L=new MessageChannel,W=new MessageChannel;if(J.A.AudioNode.port.postMessage({status:"encodeAudioPort"},[L.port2]),J.A.AudioNode.port.postMessage({status:"decodeAudioPort"},[N.port1]),J.A.AudioNode.port.postMessage({status:"sampleRate",data:A.audioCtx.sampleRate}),pi(N,L,"decodeAudioPort","encodeAudioPort"),J.A.enableEchoDetection&&!J.A.sharedBuffer&&pi(W,W,"audioWorkerPort","audioWorkerPort"),A.Start_Audio_Play(),this.isSupportOffscreenCanvasForVideoDecode){var B=new MessageChannel;Ai(B),J.A.decoderinworklet?J.A.AudioNode.port.postMessage({status:"decodeVideoPort"},[B.port2]):mi(B)}if(t.CaptureAudio){A.audioCapture=t.CaptureAudioInfo;let e=t.CaptureAudioInfo.audioProfile;if(e)if("backgroundNoiseSuppression"===e.currentSelect){let t="Zoom"===e.backgroundNoiseSuppression;Va.changeDenoiseSwitch(t),Ii({command:"highBitrate",highBitrate:e.highBitrate?1:0})}else{var U,G;let t={command:"original_sound_switch",enable:!0,highfidelity:null===(U=e.originalSound)||void 0===U?void 0:U.highfidelity,stereo:null===(G=e.originalSound)||void 0===G?void 0:G.stereo};var j;this.useAudioBridge?await(null===(j=this.audioBridge)||void 0===j?void 0:j.setAudioProfile(e)):Ii(t)}A.Start_Audio_Capture(),this.firstSetDelay&&(this.firstSetDelay=!1,Vi())}else J.A.ComputerAudioStatus=Q.BX.ComputerAudio_Connected,J.A.Notify_APPUI(u.Ubu,null)}catch(e){H.Ay.error("join audio failed",e),J.A.ComputerAudioStatus=Q.BX.ComputerAudio_Null,J.A.Notify_APPUI(u.Ubu,null),J.A.Notify_APPUI(u.pHx,null),xh.error(e),this.JsMediaSDK_Log(e)}break;case u.rSS:if(J.A.DesktopAudioStatus!==Q.BX.DesktopAudio_Null)return void J.A.Notify_APPUI(u.bW9,null);if(J.A.DesktopAudioStatus=Q.BX.DesktopAudio_Connecting,this.useAudioBridge=!!t.audioBridge,this.useAudioBridge){Va.setUserId(t.CaptureAudioInfo.ssrc);const{nginxHost:e,rwgHost:i,cid:r,abToken:a,supportLocalAB:n,useWebRTCOnDesktop:s}=t.audioBridge;return await this.previewInit({audioBridge:{nginxHost:e,rwgHost:i,cid:r,abToken:a,isCapturingAudio:t.CaptureAudio,audioMode:2,supportLocalAB:n,useWebRTCOnDesktop:s}}),Va.setAudioBridge(this.audioBridge),this.Start_Desktop_Audio_Capture(),J.A.DesktopAudioStatus=Q.BX.DesktopAudio_Connected,void J.A.Notify_APPUI(u.bW9,null)}if(F.Ay.isSupportChromeWideAEC()&&J.A.ComputerAudioStatus!=Q.BX.ComputerAudio_Null&&!this.audioDomNode&&J.A.shareSystemAudio&&await this.isLocalP2PSupportedPromise){J.A.AudioNode.disconnect();let e=this.audioCtx.createMediaStreamDestination();J.A.AudioNode.connect(e);let t=e.stream;t=await this.chromeAecWorkAround(e.stream),this.audioDomNode||(this.audioDomNode=new Audio),this.audioDomNode.srcObject=t;let i=Va.speakerId,r=Date.now();this.selectComputerAudioSpeaker(i,r),this.audioDomNode.play().catch((e=>{H.Ay.error("Audio play failed",e)}))}try{Ii({command:"mute",bOn:u.Eym,sharing:!0}),this.sharingAudioCtx&&(this.sharingAudioCtx.close(),this.isSharingCaptureNodeConnect=!1);let e=F.Ay.getAudioContextConfigure();this.sharingAudioCtx=(0,F.gd)("MainSharing",e),A=this;let i=this.audioWorkletJsPath.sharingAudioWorkletPath;await this.sharingAudioCtx.audioWorklet.addModule(i),J.A.SharingAudioNode=new _r(A.sharingAudioCtx,"zoomSharingAudioWorklet",{processorOptions:{sharingEncodeChannelsNum:F.Ay.isSupportSharingStereo()?2:1}}),J.A.sharedBuffer&&J.A.SharingAudioNode.postCMD("sharedBuffer",J.A.sharedBuffer);let r=new MessageChannel;J.A.SharingAudioNode.port.postMessage({status:"encodeAudioPort"},[r.port1]),vi(r),Ii({command:"startAudioEncode",ssid:t.CaptureAudioInfo.ssrc,samplerate:this.sharingAudioCtx.sampleRate,isSharing:!0,audioMode:J.A.audioMode,sharingEncodeChannelsNum:F.Ay.isSupportSharingStereo()?2:1}),zi(J.A.e2eencrypt),A.Start_Desktop_Audio_Capture()}catch(e){xh.error(e),this.JsMediaSDK_Log(e)}J.A.DesktopAudioStatus=Q.BX.DesktopAudio_Connected,J.A.Notify_APPUI(u.bW9,null);break;case u.u1v:{if(J.A.DesktopAudioStatus!==Q.BX.DesktopAudio_Connected)return void J.A.Notify_APPUI(u.CIY,null);let e=!1;if(t&&t.isPause&&(e=!0),e||this.EndDesktopAudioMediaStream(),this.Remove_Sharing_Audio_Capture(),this.useAudioBridge){var K;null===(K=this.audioBridge)||void 0===K||K.leaveAudioWithoutDisconnect(2)}else{if(F.Ay.isSupportChromeWideAEC()&&this.audioDomNode){J.A.AudioNode.disconnect(),this.CloseBoringPeerConnection(),this.audioDomNode=null;let e="default"==Va.speakerId?"":Va.speakerId;J.A.AudioNode.connect(this.audioCtx.destination);let t=Date.now();this.selectComputerAudioSpeaker(e,t)}try{J.A.SharingAudioNode&&(J.A.SharingAudioNode.postCMD("stopWorklet",!0),J.A.SharingAudioNode.port=null,J.A.SharingAudioNode.disconnect(),J.A.SharingAudioNode=null)}catch(e){xh("SharingAudioNode.port",e)}this.sharingAudioCtx&&(this.sharingAudioCtx.close(),this.isSharingCaptureNodeConnect=!1),this.sharingAudioCtx=null,this.screenShareAudioPreviewElement&&this.screenShareAudioPreviewElement.pause()}J.A.DesktopAudioStatus=Q.BX.DesktopAudio_Null,J.A.Notify_APPUI(u.CIY,null)}break;case u.Sed:{xh("sdk start remote control 1");let e=this.sharingWidthAndHeightInfo,i=new Pr(Object.assign({dom:document},t));return this.remoteControl=i,xh("sharingInfo",e),i.setDstWidthAndHeight(e.logicWidth,e.logicHeight),i.setSrcWidthAndHeight(e.logicWidth,e.logicHeight),i.setSrcScaleWidthAndHeight(t.scaleWidth,t.scaleHeight),i.setSrcOffsetXY(t.srcOffsetX,t.srcOffsetY),i.setRemoteOS(t.os),i.start().then((e=>(J.A.Notify_APPUI(e?u.cBD:u.aKW),e&&(i.onPasteTextLengthOverflow((function(){J.A.Notify_APPUI(u.lA5)})),i.onReturnCopiedText((e=>{xh(e),J.A.Notify_APPUI(u.CY1,e)}))),e))).catch((e=>(xh(e),J.A.Notify_APPUI(u.aKW),H.Ay.error("An error occurred when trying to start remote control",e),Y.A.add_monitor("RMCTF"),Promise.reject(e))))}case u.YD4:return this.remoteControl.destroy().then((e=>(J.A.Notify_APPUI(e?u.AL$:u.M9W),e)));case u.j4N:this.remoteControl&&(t.scaleWidth&&t.scaleHeight&&this.remoteControl.setSrcScaleWidthAndHeight(t.scaleWidth,t.scaleHeight),(Rr()(t.srcOffsetX)||Rr()(t.srcOffsetY))&&this.remoteControl.setSrcOffsetXYAndSendPDU(t.srcOffsetX,t.srcOffsetY),Or()(t.isControllerNow)&&this.remoteControl.setIsControlerNow(t.isControllerNow),Rr()(t.os)&&this.remoteControl.setRemoteOS(t.os));break;case u.rcl:this.remoteControl&&this.remoteControl.sendPostionPDU();break;case u.gle:if(this.mainSharingCanvas=t.canvas||this.mainSharingCanvas,this.annoCanvas=t.annoCanvas||this.annoCanvas,this.annoPresenterCanvas=t.annoPresenterCanvas,this.localShareCanvasExt=t.localShareCanvas,this.localShareCanvasWaiting){var q;this.isSupportSharingTrackReader||this.isSupportMediaStreamTrackProcessor?(this.sharePreviewVideo&&(this.desktopSharingValue.canvas=this.sharePreviewVideo),this.sharePreviewVideo&&(this.desktopSharingValue.video=this.sharePreviewVideo)):(this.sharePreviewCanvas&&(this.desktopSharingValue.canvas=this.sharePreviewCanvas),this.sharePreviewVideo&&(this.desktopSharingValue.video=this.sharePreviewVideo)),this.shareAnnotationInited?(this.annoPresenterCanvas.style.visibility="hidden",this.annoPresenterCanvas.width=this.localShareCanvas.width,this.annoPresenterCanvas.height=this.localShareCanvas.height,this.annoPresenterCanvas.style.zIndex="2",this.annoPresenterCanvas.style.pointerEvents="auto",this.annoCanvas&&(this.annoCanvas.style.zIndex="1"),null===(q=this.annotationMgr)||void 0===q||q.updateCanvas({sharingMainCanvas:this.localShareCanvas,annoCanvas:this.annoPresenterCanvas})):this.initShareAnnotation();const e=this.isAnnotationPMEnabled?this.desktopSharingMediaStramRaw:this.desktopSharingMediaStram;if(this.shareTrack=e.getVideoTracks()[0],this.shareTrack){this.shareTrack.onended=this.onShareStreamEnded.bind(this),this.Start_Desktop_Sharing();const{width:e,height:t,displaySurface:i}=this.shareTrack.getSettings();J.A.Notify_APPUI(u.p8Y,{width:e,height:t,displaySurface:i})}else H.Ay.log("shareTrack is null when share screen")}break;case u.kQe:this.sharePreviewVideo=null,this.sharePreviewCanvas=null;break;case u.bSz:if(this.loadAnnotationModule(),this.isSupportSharingTrackReader||this.isSupportMediaStreamTrackProcessor?(this.sharePreviewVideo&&(t.canvas=this.sharePreviewVideo),this.sharePreviewVideo&&(t.video=this.sharePreviewVideo)):(this.sharePreviewCanvas&&(t.canvas=this.sharePreviewCanvas),this.sharePreviewVideo&&(t.video=this.sharePreviewVideo)),this.isAnnotationPMEnabled&&(this.localShareCanvasWaiting=!0),this.flipSend=!0,this.isStartDesktopSharing)return;{Gi(J.A.e2eencrypt),this.isStartDesktopSharing=!0,this.desktopSharingSend=!0;const{dom:e,id:i}=(0,F.e5)(t.canvas);t.canvas&&(t.rendercanvasID=i),this.isSupportMediaStreamTrackProcessor?t.video=e:(t.video=(0,F.e5)(t.video).dom,t.canvas=e),this.desktopSharingValue=t,this.Start_Desktop_Sharing()}break;case u.X10:if(this.localShareCanvasWaiting=!1,this.flipSend=!0,J.A.shareSystemAudio=!1,!this.isStartDesktopSharing)return;var z;this.desktopSharingSend=!1,this.shareAnnotationInited=!1,this.StopSharingCapture(),this.clearCanvas(this.localShareCanvas),this.clearCanvas(this.annoPresenterCanvas),null===(z=this.annotationMgr)||void 0===z||z.stopAnnotation({presenterId:this.shareSessionId}),this.localShareVideoTag&&(this.localShareVideoTag.srcObject=null),this.isSupportVideoShare?Hi({command:"stopsharing"}):ji({command:"stopsharing"});break;case u.XbU:if(this.flipSend=!0,!this.isStartDesktopSharing)return;this.desktopSharingSend=!1,this.isSupportVideoShare?Hi({command:"pause"}):ji({command:"pause"});break;case u.s8N:if(this.flipSend=!0,!this.isStartDesktopSharing)return;this.desktopSharingSend=!0,this.isSupportMediaStreamTrackProcessor||this.Process_Sharing(),this.isSupportVideoShare?Hi({command:"resume"}):ji({command:"resume"});break;case u.iDK:if(!window.WebQrscanner)return void console.error("qrScanner not loaded");Y.A.add_monitor("QRSCAN:".concat(t.enable)),t.enable&&this.desktopSharingMediaStram?WebQrscanner.qrScanner.start(this.desktopSharingValue.video,(e=>{J.A.Notify_APPUI_SAFE(u.GT7,e)}),(()=>{Y.A.add_monitor("QRSCANTIMEOUT")})):WebQrscanner.qrScanner.stop();break;case u.m7W:{this.isStartWhiteboardSharing=!0;const{dom:e,id:i}=(0,F.e5)(t.canvas);if(t.canvas&&(t.rendercanvasID=i),this.isStartDesktopSharing)return;Gi(J.A.e2eencrypt),t.video=t.canvas=e,this.isStartDesktopSharing=!0,this.desktopSharingSend=!0,this.desktopSharingValue=t,this.Start_Whiteboard_Sharing()}break;case u.M5B:if(this.isStartWhiteboardSharing=!1,!this.isStartDesktopSharing)return;this.desktopSharingSend=!1,this.isStartDesktopSharing=!1,ji({command:"stopsharing"});break;case u.bKC:var Z=document.createElement("img");Z.src="chrome-extension://kgjfgplpablkjnlkjmjdecgdpfankdle/images/trash.png",Z.onload=function(){J.A.Notify_APPUI(u.px,!0)},Z.onerror=function(){J.A.Notify_APPUI(u.px,!1)};break;case u.uxR:if(t.evt===u.kqY||t.evt===u.FQb){if(xh("rwg answer from ui",t),!t.answer)return;switch(t.answer.type){case Q.wd.ZOOM_CONNECTION_VIDEO:X.trigger(u.gh2.ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT,t);break;case Q.wd.ZOOM_CONNECTION_AUDIO:X.trigger(u.gh2.ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT,t)}}else t.evt===u.r4R&&t.body&&t.body.token&&X.trigger(u.gh2.AUDIO_BRIDGE_WS_TOKEN,t.body.token);break;case u.YTV:mt(t.userList),!this.setvideokk&&t.encryptKey&&(this.setvideokk=!0,er(Q._c.VIDEO_DECODE,{KK:t.encryptKey},"MAIN_KK",!1,!0),er(Q._c.VIDEO_ENCODE,{KK:t.encryptKey},"MAIN_KK",!1,!0));break;case u.ovL:Oi(t.mute);break;case u.KYx:ki(t.lang);break;case u.wYI:xi(t.interpreterList);break;case u.qnv:Di(t.enable);break;case u.VxP:this.webrtcConfig.webrtcflag?this.wmscManager.sendMessageToWMSC({type:"UPDATE_WMSC_PARAMS",data:{preferSoftwareCodec:{recv:!t.enable}}}):(t.enable&&this.isEnableVideoDecodeHardWareThread&&(null!==this.videodecodehardwareflag||(this.videodecodehardwareflag=await F.Ay.IsSupportVideoDecodeHardwareAcceleration(J.A.enableHADecOpt)),t.enable=this.videodecodehardwareflag),Ci({command:"hwstatus",enable:t.enable}));break;case u.DCT:if(this.webrtcConfig.webrtcflag)this.wmscManager.sendMessageToWMSC({type:"UPDATE_WMSC_PARAMS",data:{preferSoftwareCodec:{send:!t.enable}}});else{if(1&J.A.disableHWCodec)break;t.enable&&this.videoencodehardwareflag&&(!this.isAppleGraphic||F.Ay.isChromeVersionHigherThan(116)||this.doesSafariSupportWebcodec())?t.enable=!0:t.enable=!1,Si({command:"hwstatus",enable:t.enable})}break;case"update_videohd_value":this.isVideoHD=!(null==t||!t.videohd),this.webrtcConfig.webrtcflag?this.wmscManager&&this.wmscManager.sendMessageToWMSC({type:"UPDATE_WMSC_PARAMS",data:{HDVideo:this.isVideoHD}}):(Y.A.add_monitor("NoVideoHD"),!t.videohd&&this.videoencodehardwareflag&&(F.Ay.set720pcapacity(!1),Y.A.add_monitor("CAPTURE720:"+!1),Si({command:"videohd",videohd:t.videohd})));break;case"update_videofullhd_value":Y.A.add_monitor("UVFHD"+t.videofullhd),F.Ay.set1080pcapacity(t.videofullhd),Si({command:"videofullhd",videofullhd:t.videofullhd});break;case u.fAR:var $;this.useAudioBridge?null===($=this.audioBridge)||void 0===$||$.setShareVolumeLevel(t.userid,t.shareVolume,t.isFromMainSession):Mi({command:"setShareVolumeLevel",userid:t.userid,shareVolume:t.shareVolume,isFromMainSession:t.isFromMainSession,isSecondAudio:!!t.isSecondAudio});break;case u.P79:t.mediaActionType==u.EcQ.SHARING_DECODE&&(this.isSupportVideoShare?er(Q._c.VIDEO_DECODE,t,10,!1,!0):er(Q._c.SHARING_DECODE,t,10,!1,!0)),t.mediaActionType==u.EcQ.SHARING_ENCODE&&(this.isSupportVideoShare?er(Q._c.VIDEO_ENCODE,t,10,!1,!0):er(Q._c.SHARING_ENCODE,t,10,!1,!0)),t.mediaActionType==u.EcQ.AUDIO_DECODE&&er(Q._c.AUDIO_DECODE,t,10,!1,!0);break;case u.AmQ:t.mediaActionType==u.EcQ.SHARING_DECODE&&(this.isSupportVideoShare?er(Q._c.VIDEO_DECODE,t,9,!1,!0):er(Q._c.SHARING_DECODE,t,9,!1,!0)),t.mediaActionType==u.EcQ.SHARING_ENCODE&&(this.isSupportVideoShare?er(Q._c.VIDEO_ENCODE,t,9,!1,!0):er(Q._c.SHARING_ENCODE,t,9,!1,!0)),t.mediaActionType==u.EcQ.AUDIO_DECODE&&er(Q._c.AUDIO_DECODE,t,9,!1,!0);break;case u.yHE:this.isSupportVideoShare?er(Q._c.VIDEO_DECODE,t,"SHARING_ADD_REV_CHANNEL_TYPE",!1,!0):er(Q._c.SHARING_DECODE,t,"SHARING_ADD_REV_CHANNEL_TYPE",!1,!0);break;case u.pn7:this.isSupportVideoShare?Ei({command:"SHARING_REMOVE_REV_CHANNEL_TYPE",data:t}):Ri({command:"SHARING_REMOVE_REV_CHANNEL_TYPE",data:t});break;case u.i0n:this.isSupportVideoShare?Ei({command:"BUILD_MS_CHANNEL_IN_BO",data:t}):Ri({command:"BUILD_MS_CHANNEL_IN_BO",data:t});break;case u.i9w:{const{type:e}=t;e?e===Q.Xt.VIDEO?this.SWITCH_VIDEO_WATER_MARK(t):e===Q.Xt.SHARING&&this.SWITCH_SHARING_WATER_MARK(t):(this.SWITCH_VIDEO_WATER_MARK(t),this.SWITCH_SHARING_WATER_MARK(t))}break;case u.aE$:var ee;this.useAudioBridge?null===(ee=this.audioBridge)||void 0===ee||ee.set_CC_lang(t.lang):Pi(t.lang);break;case u._7f:Mi({command:"BUILD_MA_CHANNEL_IN_BO",data:t});break;case u.qmK:var te;Y.A.add_monitor("ESTB:"+t.enable),this.useAudioBridge?null===(te=this.audioBridge)||void 0===te||te.enableShareToBO(t.enable):Ii({command:"ENABLE_SHARE_TO_BO",data:t.enable});break;case u.SUv:var ie;Y.A.add_monitor("EBTB:"+t.enable),this.useAudioBridge?null===(ie=this.audioBridge)||void 0===ie||ie.enableBroadCastToBO(t.enable):Ii({command:"ENABLE_BROADCAST_TO_BO",data:t.enable});break;case u.jCp:{let e=(0,F.e5)(t.canvasId).dom;if(t.canvas&&(e=t.canvas),!e)return;let i=null;const r=this.replaceCanvasMap.videoDecodeCanvasIds&&-1!==this.replaceCanvasMap.videoDecodeCanvasIds.indexOf(t.canvasId),a=this.replaceCanvasMap.videoEncodeCanvasIds&&-1!==this.replaceCanvasMap.videoEncodeCanvasIds.indexOf(t.canvasId);if(t.canvasId===this.replaceCanvasMap.videoMaskSettingCanvasId?i=J.A.localVideoEncMGR:t.canvasId===this.replaceCanvasMap.sharingMainCanvasId?i=this.isSupportVideoShare?J.A.localVideoDecMGR:J.A.localSharingDecMGR:t.canvasId===this.replaceCanvasMap.sharingPreviewCanvasId?i=J.A.localSharingEncMGR:(a||r)&&(i=a?J.A.localVideoEncMGR:J.A.localVideoDecMGR,this.lazyReplaceEncodeCanvasTimer&&(clearTimeout(this.lazyReplaceEncodeCanvasTimer),this.lazyReplaceEncodeCanvasTimer=null),this.lazyReplaceEncodeCanvasTimer=setTimeout((()=>{let e=J.A.localVideoEncMGR;if(e){let t=e.map.get(J.A.SPECIAL_ID);t&&t.postMessage({command:"WEBGL_LOST_REPLACE_CANVAS"})}let t=J.A.localSharingEncMGR;if(t){let e=t.map.get(J.A.SPECIAL_ID);e&&e.postMessage({command:"WEBGL_LOST_REPLACE_CANVAS"})}if(this.videoCaptureHiddenCanvas){const{width:e,height:t}=this.videoCaptureHiddenCanvas;F.Ay.isSupport2dOffscreenCanvas()?this.videoCaptureHiddenCanvas=new OffscreenCanvas(e,t):(this.videoCaptureHiddenCanvas=document.createElement("canvas"),this.videoCaptureHiddenCanvas.width=e,this.videoCaptureHiddenCanvas.height=t),this.videoCaptureHiddenCanvasCtx=this.videoCaptureHiddenCanvas.getContext("2d")}if(this.bgCanvas){const{width:e,height:t}=this.bgCanvas;this.bgCanvas=document.createElement("canvas"),this.bgCanvas.width=e,this.bgCanvas.height=t,this.bgCanvasctx=this.bgCanvas.getContext("2d"),!this.VideoMaskSettingCanvas&&this.PrevVideoMaskSettingCanvas?(this.VideoMaskSettingCanvas=this.PrevVideoMaskSettingCanvas,this.Update_Mask_Texture(this.maskCoordinate,this.videoCaptureHiddenCanvas.width,this.videoCaptureHiddenCanvas.height),this.VideoMaskSettingCanvas=null):this.Update_Mask_Texture(this.maskCoordinate,this.videoCaptureHiddenCanvas.width,this.videoCaptureHiddenCanvas.height)}}),500)),i)try{var re=e.transferControlToOffscreen(),ae=i.map.get(J.A.SPECIAL_ID);ae&&ae.postMessage({command:"WEBGL_LOST_REPLACE_CANVAS",data:{canvasId:t.canvasId,canvas:re}},[re])}catch(e){}break}case u.PcV:Y.A.add_monitor("CHIDE:"+t.enable),this.enableHID=t.enable,t.enable?(this.hidAvalible&&(await za.destroy(),this.hidAvalible=!1),t.microphoneLabel&&(this.hidAvalible=await za.init(t.microphoneLabel,t.defaultMuted))):this.hidAvalible&&(await za.destroy(),this.hidAvalible=!1);break;case u.TB5:Ci({command:"ENABLE_VIDEO_OBSERVER",data:t.enable,enablefps:!t.fpsdisbale});break;case u.PMP:this.isAnnotationPMEnabled&&(this.drawLocalShareInterval=1===t.mode?200:70,clearInterval(this.drawLocalShareIntervalId),this.drawLocalShareIntervalId=setInterval((()=>{this.drawLocalAnnotationContent()}),this.drawLocalShareInterval)),Si({command:"SWITCH_SHARING_TYPE",data:t.mode});break;case u.f8O:var ne;this.useAudioBridge&&(null===(ne=this.audioBridge)||void 0===ne||ne.setSpeechVolumeLevel(t.userId,t.volume)),J.A.decoderinworklet?J.A.AudioNode&&J.A.AudioNode.postCMD("setSpeechVolumeLevel",{userid:t.userId>>10,volume:t.volume}):Mi({command:"setSpeechVolumeLevel",userid:t.userId>>10,volume:t.volume});break;case u.U_k:var se;this.useAudioBridge&&(null===(se=this.audioBridge)||void 0===se||se.updateUserMuteUnmuteStatus(t));break;case u.ZIm:Oh._updateVideoConstraints({advanced:[t]});break;case u.rwH:this._SaveSystemInfo(),J.A.clearMessageToRwg();break;case u.QyH:Oh.enableReuseStream(t.enable);break;case u.WP5:Oh.presetConstraints(t||{});break;case u.fxd:Oh.destoryReuseStream({audio:t&&t.audio,video:t&&t.video});break;case u.V36:{let e={command:"WHITEBOARD_JOIN_MESSAGE",data:t.message,nodeId:t.nodeId,encryptKey:t.encryptKey,sn:t.sn,dcsId:t.dcsId,EncodedSn:t.EncodedSn};this.isSupportVideoShare?Ki(e):qi(e)}break;case u.lOl:var oe;this.useAudioBridge?null===(oe=this.audioBridge)||void 0===oe||oe.stopIncomingAudio(t):J.A.decoderinworklet?Mi({command:"stop_audio_incoming",stopPlayAudio:t}):J.A.AudioNode&&J.A.AudioNode.postCMD("stop_audio_incoming",t);break;case u.TSA:if(this.isLandScape=t.isLandScape,!Oh.videoStreamTrack)return;this.isLandScape&&this.captureSize&&this.Change_Video_Capture_Resolution(this.captureSize.width,this.captureSize.height);break;case u.l8t:this.localLog&&this.localLog.saveAllLogFiles();break;case u.sCk:if(Oh&&Oh.audioStream){let e=Oh.audioStream.getAudioTracks()[0];e&&(e.muted||"live"!==e.readyState)&&(0,We.iK)(u.UyE,We.pg.EXCEPTION)}break;case u.ee7:{const e=J.A.localVideoDecMGR,i=J.A.SPECIAL_ID;if(e){const r=e.map.get(i);if(r){const e={command:"removeExpiredCanvas",rendercanvasID:t.canvasId};r.postMessage(e)}}He.rmCanvas(t.canvasId)}break;case u.oFc:this.webrtcConfig.webrtcflag?(Y.A.add_monitor("WMSC_UI_S_V: ".concat((0,F.iD)(JSON.stringify(t)))),this.wmscManager&&Array.isArray(t)&&t.length>0&&this.wmscManager.sendMessageToWMSC({type:"NOTIFY_SDK_SUBSCRIBE_VIDEO",data:t})):J.A.sendMessageToRwg(u.yJV,{evt:u.xQc,body:{subInfoList:t}});break;case u.t4x:Array.isArray(t)&&t.length>0&&(this.webrtcConfig.webrtcflag&&this.wmscManager?(Y.A.add_monitor("WMSC_UI_UNS_V: ".concat((0,F.iD)(JSON.stringify(t)))),this.wmscManager.sendMessageToWMSC({type:"NOTIFY_SDK_UNSUBSCRIBE_VIDEO",data:t})):J.A.sendMessageToRwg(u.yJV,{evt:u.WCu,body:{subIDList:t}}));break;case u.kPo:var de,ce;Y.A.add_monitor("HOLD:".concat(null==t?void 0:t.hold,":").concat(null==t?void 0:t.userid,":").concat(null==t?void 0:t.reinit)),!t.hold&&this.isSupportVideoShare&&(null===(de=J.A.sharingDecInitInstance)||void 0===de||de.resetHandleDeferred(),null===(ce=J.A.sharingEncInitInstance)||void 0===ce||ce.resetHandleDeferred()),t&&!t.userid&&(t.userid=this.userId),pr(this,t),!t.hold&&t.userid&&(this.userId=t.userid),t.hold&&this.SessionHold(),J.A.videoEncodeSession=null,J.A.videoDecodeSession=null,J.A.sharingDecodeSession=null,J.A.sharingEncodeSession=null,J.A.audioDecodeSession=null,J.A.audioEncodeSession=null;break;case u.TRD:J.A.decoderinworklet?J.A.workletWasmInitSuccess&&J.A.AudioNode?J.A.AudioNode.postCMD(131,{volume:t}):J.A.workletMessageQueue.enqueue({command:131,volume:t}):Mi({command:131,volume:t});break;case u.xlY:Y.A.add_monitor("ENABLE_FILE_AUDIO_PLAYBACK_LOCALLY: ".concat(t)),this.setFileAudioPlaybackSwitch(t);break;case u.naM:gr(this,t);break;case u.cjy:await this.handlePermissionRequest();break;default:xh("CAN NOT HANDLE THE EVENT!")}},deviceChangeHandler(e,t){let{result:i,reason:r}=Eh.isMobileNeedRecaptureAfterDeviceChange(this,e,t);i&&(H.Ay.log("[deviceChangeHandler] isMobileNeedRecaptureAfterDeviceChange: ".concat(i,", ").concat(r)),Y.A.add_monitor("MOBILE_AUDIO_RECAPTURE:".concat(i,",").concat(r)),Rh(this,this.audioCapture)),J.A.Notify_APPUI_SAFE(u.baF,t)},requestPermissionCallback:function(e){J.A.Notify_APPUI_SAFE(u.M5F,e)},setFileAudioPlaybackSwitch:function(e){e?(this.fileAudioPlaybackTag||(this.fileAudioPlaybackTag=new Audio),this.updateFileAudioPlaybackStream(Oh.audioStream)):this.fileAudioPlaybackTag&&(this.fileAudioPlaybackTag.pause(),this.fileAudioPlaybackTag=null)},updateFileAudioPlaybackStream:function(e){var t;if(Oh.isCaptureAudioFromFile){if(e&&this.fileAudioPlaybackTag){this.fileAudioPlaybackTag.srcObject!==e&&(this.fileAudioPlaybackTag.srcObject=e);const t="default"===Va.speakerId||null===Va.speakerId?"":Va.speakerId;this.fileAudioPlaybackTag.setSinkId&&this.fileAudioPlaybackTag.sinkId!==t&&this.fileAudioPlaybackTag.setSinkId(t).catch((e=>{H.Ay.error("fileAudioPlaybackTag setSinkId error when update stream")})),this.fileAudioPlaybackTag.play().catch((e=>{H.Ay.error("self audio playback failed",e)}))}}else null===(t=this.fileAudioPlaybackTag)||void 0===t||t.pause()},SWITCH_VIDEO_WATER_MARK:function(e){this.videoWaterMarkParams=e;const{enableWaterMark:t,waterMarkText:i="",watermarkOpacity:r,watermarkRepeated:a,watermarkPosition:n}=e;this.isCreateVideoWaterMark=!!t,this.videoWaterMarkName=this.isCreateVideoWaterMark?i:"",this.VideoRenderObj?(t?this.isCreateVideoWaterMark&&!this.waterMarkCanvas&&(this.waterMarkCanvas=document.createElement("canvas")):this.VideoRenderObj.Set_WaterMark_Flag(t),this.VideoRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName,watermarkOpacity:r,watermarkRepeated:a,watermarkPosition:n})):Ci({command:"SWITCH_WATER_MARK_FLAG",isCreateVideoWaterMark:this.isCreateVideoWaterMark,videoWaterMarkName:this.videoWaterMarkName,watermarkOpacity:r,watermarkRepeated:a,watermarkPosition:n}),F.Ay.watermark.updateWaterMarkInfo(e)},SWITCH_SHARING_WATER_MARK:function(e){this.sharingWaterMarkParams=e;const{enableWaterMark:t,waterMarkText:i="",watermarkOpacity:r,watermarkRepeated:a,watermarkPosition:n}=e;this.isCreateSharingWaterMark=!!t,this.sharingWaterMarkName=this.isCreateSharingWaterMark?i:"",this.SharingRenderObj?(t?this.isCreateSharingWaterMark&&!this.waterMarkCanvas&&(this.waterMarkCanvas=document.createElement("canvas")):this.SharingRenderObj.Set_WaterMark_Flag(t),this.SharingRenderObj.Set_WaterMark_Info({waterMarkCanvas:this.waterMarkCanvas,isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:r,watermarkRepeated:a,watermarkPosition:n})):this.isSupportVideoShare?Ei({command:"SWITCH_SHARING_WATER_MARK_FLAG",isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:r,watermarkRepeated:a,watermarkPosition:n}):Ri({command:"SWITCH_WATER_MARK_FLAG",isCreateSharingWaterMark:this.isCreateSharingWaterMark,sharingWaterMarkName:this.sharingWaterMarkName,watermarkOpacity:r,watermarkRepeated:a,watermarkPosition:n})},JsMediaSDK_VideoRenderInterval:function(e){return this.VideoRenderObj.Start_Draw.bind(this.VideoRenderObj)(1,e)},JsMediaSDK_SharingRenderInterval:function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i=this.SharingRenderObj.No_Bindthis_Interval.bind(this.SharingRenderObj);return setInterval(i,t?20:e)},getShareStreamInfo:function(){if(!this.desktopSharingMediaStram)return null;const e=this.desktopSharingMediaStram.getVideoTracks();if(!e.length)return null;if(e[0].getSettings){let t=e[0].getSettings()||null;return t&&this.sharingCodecInfo.width&&this.sharingCodecInfo.height&&(t.width=this.sharingCodecInfo.width,t.height=this.sharingCodecInfo.height),t}return null},onUnload:function(e){const t=this.rendererType==Nr.h3.WEBGPU;H.Ay.log("window.onunload:".concat(this._id,", webGPU:").concat(t)),Y.A.add_monitor("window.onunload:".concat(this._id,", webGPU:").concat(t)),t&&this.destroy().catch((e=>{}))},handleUnloadEvent(){this.unloadHandler=this.onUnload.bind(this),window.addEventListener("unload",this.unloadHandler)},async destroy(){var e;xh("destroy"),window.removeEventListener("unload",this.unloadHandler),this.destoryPromise||(J.A.extVBPort&&J.A.extVBPort.postMessage({type:u.L_m}),null===(e=Fe.instance)||void 0===e||e.close(),Be((()=>{})),(0,F.Sq)(),document.removeEventListener("visibilitychange",Vh),this.isDestroy=!0,this.destoryPromise=new Promise((async(e,t)=>{try{var i;H.Ay.log("DelInstance:".concat(this._id)),J.A._callbackList=[],J.A._Notify_APPUI=null,J.A.localVideoPara.VE=null,J.A.localVideoPara.VD=null,Y.A.add_monitor("DelInstance:".concat(this._id)),(0,We._G)(null),this.wmscManager&&(this.wmscManager.destroy(),this.wmscManager=null),null===(i=this.annotationMgr)||void 0===i||i.destroy(),this.annotationMgr=null,this.StopSharingCapture(),clearInterval(this.drawLocalShareIntervalId);let e=this;Ui(),X.clearAllSubscriptions(),_t.clear(),J.A.destroyQueueMessageToRwg(),this.audioInputLevel&&(this.audioInputLevel.destroy(),this.audioInputLevel=null),this.audioBridge&&(this.audioBridge.destroy(!1),this.audioBridge=null,Oh.audioBridge=null),this.EndMedia(),function(){let e=Pe.dataTransportMgr;Object.keys(e.refs).forEach((t=>{let i=e.refs[t];delete e.refs[t],i.worker.removeEventListener("message",i.listener)})),e.reinit()}(),this.dataChannelController.remoteTransportListener(),function(){let e=Pe.dataTransportMgr;e.mediadatachannel.netthreadworker&&(e.mediadatachannel.netthreadworker.destroy(),e.mediadatachannel.netthreadworker=null)}(),this.computePressureManager&&this.computePressureManager.destroy();let t=[J.A.localVideoDecMGR,J.A.localVideoEncMGR,J.A.localSharingDecMGR,J.A.localSharingEncMGR],r=[J.A.localAudioDecMGR,J.A.localAudioEncMGR];Yi([J.A.sharingDecInitInstance,J.A.sharingEncInitInstance,J.A.videoDecInitInstance,J.A.videoInitInstance,J.A.audioDecInitInstance,J.A.audioEncodeInitInstance]),Qi(t,r);try{await new Promise((function(t,i){let r=setTimeout((()=>t()),1e3);Promise.all(e.allpromises).finally((()=>{clearTimeout(r),t()}))}))}catch(e){console.error(e)}wt(Q.wd.ZOOM_CONNECTION_AUDIO,Q.oB.NET_WEBTRANSPORT),wt(Q.wd.ZOOM_CONNECTION_VIDEO,Q.oB.NET_WEBTRANSPORT),await Ji(this,t,r),this.hidAvalible&&await za.destroy(),wh.resetProcessorManager(),this.processorWorker&&(this.processorWorker.onmessage=null,this.processorWorker.terminate(),this.processorWorker=null),await Zi(t,r)}catch(e){H.Ay.error("destroy instance ".concat(this._id," error"),e)}e()}))),await this.destoryPromise},async isWebGPURendererType(){return await F.Ay.evaluateRendererType(this.isWebGPUFeatureEnabled,this.isWebGL2FeatureEnabled)==Nr.h3.WEBGPU},addVbReceiver(e){Si({command:"addExtVbReceiver"}),J.A.extVBPort&&(J.A.extVBPort.onmessage=null),J.A.extVBPort=e,J.A.frameReceived=0,J.A.frameSent=0,e.onmessage=e=>{const{type:t}=e.data;t===u.wb7&&J.A.frameReceived++},Y.A.add_monitor("EVBA")},removeVbReceiver(){Si({command:"removeExtVbReceiver"}),J.A.extVBPort&&(J.A.extVBPort.postMessage({type:u.lLs}),J.A.extVBPort.onmessage=null,J.A.extVBPort=null),Y.A.add_monitor("EVBR")},SessionHold(){if(!this.VideoRenderObj)return;let e=this.VideoRenderObj.clearColor.map((e=>e/255));for(;this.videoRenderArray.length>0;){let t=this.videoRenderArray.shift();this.StopUserVideoRender(this.VideoRenderObj,[t],e,!0)}},StopUserVideoRender(e,t,i,r){if(!e)return;r&&e.clearUseridRender(t,i);const a=J.A.enableMultiDecodeVideoWithoutSAB||F.Ay.isSupportMultiViewAPI();a&&e.GiveBack_Display(t),e.Set_Render_Array(this.videoRenderArray,a),0==this.videoRenderArray.length&&(Ci({command:"stopVideoRender",MFlag:!0}),this.Stop_Video_Play())},_SaveSystemInfo:function(){try{Y.A.add_monitor("JSBN:".concat(Uh.buildNumber,",").concat(Uh.fixVersion)),Y.A.add_monitor("NewInstance:".concat(this._id)),H.Ay.directReport("MediaSDK Version:".concat(Uh.fixVersion)),Li()}catch(e){xh(e)}},async updateWebRTCVideoStream(e){var t;null!==(t=this.wmscManager)&&void 0!==t&&t.vbSettingVideoDom&&(this.wmscManager.vbSettingVideoDom.srcObject=e),this.isStartVideoCapture&&this.wmscManager.streamId!==e.id&&this.handleWebRTCStream("fromVBModule",e)},clearCanvas:function(e){e&&e.getContext("2d").clearRect(0,0,e.width,e.height)},loadAnnotationModule:function(){this.isAnnotationEnabled&&!this.annotationModule&&(0,F.kA)().then((e=>{let{AnnotationMgr:t}=e;this.annotationModule=t})).catch((e=>{xh.error("Failed to load AnnotationMgr",e)}))},onShareStreamEnded:function(){Y.A.add_monitor("SSBB"),J.A.Notify_APPUI(u.Fxk,null),this.StopSharingCapture()},initShareAnnotation:function(){if(!this.isAnnotationPMEnabled||this.shareAnnotationInited)return;const e=document.createElement("div");if(this.localShareCanvas=document.createElement("canvas"),this.localShareCanvas.style.visibility="hidden",e.appendChild(this.localShareCanvas),this.shareAnnotationInited)return;const t=this.desktopSharingMediaStram;this.localShareVideoTag=document.createElement("video");const i=t.getVideoTracks()[0],{width:r,height:a}=i.getSettings();this.localShareVideoTag.width=r,this.localShareVideoTag.height=a,this.localShareCanvas.width=r,this.localShareCanvas.height=a,this.annoPresenterCanvas.width=r,this.annoPresenterCanvas.height=a,this.annoPresenterCanvas.style.pointerEvents="auto",this.localShareVideoTag.setAttribute("autoplay","true");const n=t.getVideoTracks()[0],s=new MediaStream;s.addTrack(n),this.localShareVideoTag.srcObject=s,setTimeout((()=>{var e;this.drawLocalShareIntervalId=setInterval((()=>{this.drawLocalAnnotationContent()}),this.drawLocalShareInterval),this.annoPresenterCanvas.style.visibility="hidden",null===(e=this.annotationMgr)||void 0===e||e.updateRemoteSizeInfo({width:r,height:a})}),Th),this.desktopSharingMediaStramRaw=this.desktopSharingMediaStram;const o=this.desktopSharingMediaStramRaw.getVideoTracks()[0];o.onended=this.onShareStreamEnded.bind(this),this.desktopSharingMediaStram=this.localShareCanvas.captureStream(15),this.shareAnnotationInited=!0,this.startAnnotation({presenterId:this.shareSessionId,shareSessionId:this.shareSessionId}),this.localShareVideoTag.onresize=e=>{var t;const{width:i,height:r}=o.getSettings();this.localShareVideoTag.width=i,this.localShareVideoTag.height=r,this.localShareCanvas.width=i,this.localShareCanvas.height=r,this.annoPresenterCanvas.width=i,this.annoPresenterCanvas.height=r,null===(t=this.annotationMgr)||void 0===t||t.updateRemoteSizeInfo({width:i,height:r}),J.A.Notify_APPUI(u.p8Y,{width:i,height:r})}},startAnnotation:function(e,t){if(!this.isAnnotationEnabled)return void J.A.Notify_APPUI(u.ZFN,"Annotation feature is not enabled");const i=e.shareSessionId===e.presenterId;if(i&&!this.isAnnotationPMEnabled)return void J.A.Notify_APPUI(u.ZFN,"Annotation feature is not enabled for presenter");this.shareSessionId=e.shareSessionId,this.userName=e.userName;let r=!0;if(i||this.mainSharingCanvas&&this.annoCanvas||(r=!1),!i||this.annoPresenterCanvas&&this.localShareCanvas||(r=!1),r){if(i?(this.annoPresenterCanvas.style.zIndex="2",this.annoPresenterCanvas.style.pointerEvents="auto",this.annoCanvas&&(this.annoCanvas.style.zIndex="1"),t&&(this.localAnnoStarted=!0)):(this.annoCanvas.style.zIndex="2",this.annoCanvas.style.pointerEvents="auto",this.annoPresenterCanvas&&(this.annoPresenterCanvas.style.zIndex="1")),!i||this.shareAnnotationInited){if(this.annotationMgr){if(this.annotationMgr.getAppId()===e.shareSessionId)return this.annotationMgr.startAnnotation(e.presenterId),J.A.Notify_APPUI(u.bVv),this.annotationMgr.updateCanvas({sharingMainCanvas:i?this.localShareCanvas:this.mainSharingCanvas,annoCanvas:i?this.annoPresenterCanvas:this.annoCanvas}),void setTimeout((()=>{const e=this.getAnnoRemoteSizeInfo(i);this.annotationMgr.updateRemoteSizeInfo(e)}),Th);this.annotationMgr.destroy()}if(this.annotationMgr&&e.shareSessionId===this.annotationMgr.getAppId()&&(this.annotationMgr.destroy(),this.annotationMgr=null),!this.annotationMgr){const t={appId:this.shareSessionId,userName:this.userName,presenterId:e.presenterId,isBOSession:e.isBOSession||!1,sharingMainCanvas:i?this.localShareCanvas:this.mainSharingCanvas,annoCanvas:i?this.annoPresenterCanvas:this.annoCanvas,remoteSizeInfo:this.getAnnoRemoteSizeInfo(i)};if(!this.annotationModule)return xh.error("AnnotationMgr module was not loaded"),void J.A.Notify_APPUI(u.ZFN,"Failed to load annotation module");this.annotationMgr=new this.annotationModule(t),Y.A.add_monitor("ANNO_INIT"),J.A.Notify_APPUI(u.bVv)}this.annotationMgr.startAnnotation(e.presenterId),this.annotationMgr.updateCanvas({sharingMainCanvas:i?this.localShareCanvas:this.mainSharingCanvas,annoCanvas:i?this.annoPresenterCanvas:this.annoCanvas}),setTimeout((()=>{this.annotationMgr.updateRemoteSizeInfo(this.getAnnoRemoteSizeInfo(i))}),Th)}}else{if(i&&t)return;J.A.Notify_APPUI(u.ZFN,"Canvas is incorrect")}},stopAnnotation:function(e){var t;this.isAnnotationEnabled&&(this.shareSessionId===e.presenterId&&(this.localAnnoStarted=!1,this.annoPresenterCanvas=null,this.localShareCanvas=null),null===(t=this.annotationMgr)||void 0===t||t.stopAnnotation(e))},onAnnotationPdu:function(e){this.annotationMgr&&this.annotationMgr.onRWGMessage(e)},sendAnnotationPdu:function(e,t){this.isSupportVideoShare?t?Ki(e):Ei(e):t?qi(e):Ri(e)},drawLocalAnnotationContent(){var e;if(!this.localShareCanvas.width||!this.localShareCanvas.height){const e=this.desktopSharingMediaStramRaw.getVideoTracks()[0],{width:t,height:i}=e.getSettings();this.localShareCanvas.width=t,this.localShareCanvas.height=i}const t=null===(e=this.localShareCanvas)||void 0===e?void 0:e.getContext("2d");try{null==t||t.drawImage(this.localShareVideoTag,0,0,this.localShareCanvas.width,this.localShareCanvas.height),this.localAnnoStarted&&(null==t||t.drawImage(this.annoPresenterCanvas,0,0,this.localShareCanvas.width,this.localShareCanvas.height)),this.localShareCanvasExt&&this.localShareCanvasExt.getContext("2d").drawImage(this.localShareCanvas,0,0,this.localShareCanvasExt.width,this.localShareCanvasExt.height)}catch(e){xh.error("Failed to draw local annotation content",e)}},onAnnoRenderRequired:function(){this.annoPresenterCanvas.width&&this.annoPresenterCanvas.height&&this.drawLocalAnnotationContent()},getAnnoRemoteSizeInfo(e){let t,i;if(e){const e=this.desktopSharingMediaStramRaw.getVideoTracks()[0],r=null==e?void 0:e.getSettings();t=(null==r?void 0:r.width)||0,i=(null==r?void 0:r.height)||0}else t=this.sharingWidthAndHeightInfo.width,i=this.sharingWidthAndHeightInfo.height;return{width:t,height:i}},beforeReportToGlobalTracing:function(){this.wmscManager&&this.wmscManager.reportWMSCPeerConnectionRawStats()},workrtHealthCheckReport(e,t){var i,r;"net"==e&&(null===(i=this.audioDataChannel)||void 0===i||i.resetDataChannelTransfered(null),null===(r=this.videoDataChannel)||void 0===r||r.resetDataChannelTransfered(null),function(e){Fe.instance&&Fe.instance.unRegisterWorker(e)}(e));const a=Ar(e),n=null==a?void 0:a.checkInitSuccess();let s="WORKERZOMBIE:".concat(e,":").concat(n,":").concat(t,":").concat(document.hidden);Y.A.add_monitor(s),H.Ay.directReport(s)},onSharingSizeChange(e){this.sharingCodecInfo.width=e.width,this.sharingCodecInfo.height=e.height},isEnableAutoJoinAudio(){return!(F.Ay.isMac()&&F.Ay.browser.isSafari&&!this.audioBridge&&!F.Ay.isSafariVersionHigherThan("18.0"))},notifyUISetSpeakerError(e){this.audioSpeakerSetErrorCnt++,H.Ay.error("setSinkId failed ".concat(this.audioSpeakerSetErrorCnt," times, current speaker ").concat(e.currentSink,", reason = ").concat(e.reason)),this.audioSpeakerSetErrorCnt<=3&&J.A.Notify_APPUI(u.dsK,e)},notifyUISetMicError(e){this.audioMicSetErrorCnt++,H.Ay.error("setSinkId failed ".concat(this.audioMicSetErrorCnt," times, current mic ").concat(e.currentMic,", reason = ").concat(e.reason)),this.audioMicSetErrorCnt<=3&&J.A.Notify_APPUI(u.HOE,e)},async initVideoProcessorWorker(){if(!this.processorWorker){const r=kh.substring(0,kh.lastIndexOf("/"))+"/video_processor.min.js",a=await fetch(r),n=await a.arrayBuffer(),s=c().createObjectURL(new Blob([n],{type:"text/javascript"}));this.processorWorker=new Worker(s,{name:"video-processor"}),c().revokeObjectURL(s),this.processorWorker.addEventListener("message",(e=>{const t=e.data;t.cmd==lh.PROCESSOR_WORKER_ERROR&&Y.A.add_monitor("PCWE"+t.data)}));const o=new MessageChannel;var e,t,i;if(this.processorWorker.postMessage({command:hh.ADD_VIDEO_PORT,data:o.port1},[o.port1]),this.webrtcConfig.webrtcflag||F.Ay.isSelfPreviewRenderWithVideo())this.processorMessagePort=o.port2;else if(null===(e=J.A.localVideoEncMGR)||void 0===e||null===(e=e.map)||void 0===e||null===(t=e.get)||void 0===t||null===(t=t.call(e,J.A.SPECIAL_ID))||void 0===t||null===(i=t.postMessage)||void 0===i||i.call(t,{command:"processor_message_port",data:o.port2},[o.port2]),!this.checkIsRenderInWorker()||F.I4.getIsRenderSelfVideoInEncodeWorker(!0)){const e=new MessageChannel;this.processorWorker.postMessage({command:hh.ADD_SHADOW_PORT,data:e.port1},[e.port1]),this.shadowProcessorMessagePort=e.port2}}},processorInited:(e,t)=>new Promise((i=>{const r=a=>{a.data.name===e&&(a.data.cmd===hh.PROCESSOR_READY?(i(!0),t.removeEventListener("message",r)):a.data.cmd===hh.PROCESSOR_ERROR&&(i(!1),t.removeEventListener("message",r)))};try{t.addEventListener("message",r)}catch(e){console.error(e)}})),async addProcessor(e){let{url:t,name:i,type:r="video",options:a}=e;if("video"===r&&F.Ay.isSupportVideoProcessor(this.mediaFeatureOptions)){await this.initVideoProcessorWorker();const e=new MessageChannel;if(e.port1.start(),this.processorWorker.postMessage({url:t,name:i,command:hh.ADD_VIDEO_PROCESSOR,port:e.port2,options:a},[e.port2]),await this.processorInited(i,this.processorWorker))return{name:i,type:r,port:e.port1}}return null},startProcessor(e){let{name:t,type:i}=e;if(Y.A.add_monitor("SPMV"),"video"===i&&F.Ay.isSupportVideoProcessor(this.mediaFeatureOptions))if(this.webrtcConfig.webrtcflag||F.Ay.isSelfPreviewRenderWithVideo()){var r,a,n;if(wh.addCallback(t,((e,t)=>{e==lh.RESOLUTION_CHANGE&&Oh.onVBResolutionChange&&Oh.onVBResolutionChange(t)})),wh.addFrameCallback(t,(e=>{yi({command:"yuvVideoFrame",data:e,rotation:0},[e]),e.close()})),wh.startProcessor(t,new bh(t,this.processorMessagePort,3==this.platformType,!this.webrtcConfig.webrtcflag)),Oh.videoStream){wh.removeStream(),wh.setStream(Oh.videoStream);const e=wh.getStream();Oh.processedStream=e,this.webrtcConfig.webrtcflag?this.updateWebRTCVideoStream(e):this.render_self_video_wasm()}null===(r=J.A.localVideoEncMGR)||void 0===r||null===(r=r.map)||void 0===r||null===(a=r.get)||void 0===a||null===(a=a.call(r,J.A.SPECIAL_ID))||void 0===a||null===(n=a.postMessage)||void 0===n||n.call(a,{command:137,flag:!0})}else{var s,o,d;null===(s=J.A.localVideoEncMGR)||void 0===s||null===(s=s.map)||void 0===s||null===(o=s.get)||void 0===o||null===(o=o.call(s,J.A.SPECIAL_ID))||void 0===o||null===(d=o.postMessage)||void 0===d||d.call(o,{command:"start_processor",name:t}),this.checkIsRenderInWorker()&&!F.I4.getIsRenderSelfVideoInEncodeWorker(!0)||(wh.addFrameCallback(t,(e=>{var t;let i=Lh;1==Oh.facingMode&&(2==Lh?i=0:0==Lh&&(i=2)),Oh.isUsingFileInputVideoSource()&&(i=0),null===(t=this.VideoRenderObj)||void 0===t||t.Update_LocalVideo(e,i,!0),e.close()})),wh.startProcessor(t,new Ch(t,this.shadowProcessorMessagePort)))}},stopProcessor(e){let{name:t,type:i}=e;var r,a,n,s,o,d;(Y.A.add_monitor("EPMV"),"video"===i&&F.Ay.isSupportVideoProcessor(this.mediaFeatureOptions))&&(this.webrtcConfig.webrtcflag||null===(s=J.A.localVideoEncMGR)||void 0===s||null===(s=s.map)||void 0===s||null===(o=s.get)||void 0===o||null===(o=o.call(s,J.A.SPECIAL_ID))||void 0===o||null===(d=o.postMessage)||void 0===d||d.call(o,{command:"stop_processor",name:t}),wh.stopProcessor(t),!wh.hasProcessor()&&Oh.videoStream&&(Oh.processedStream=null,this.webrtcConfig.webrtcflag?this.updateWebRTCVideoStream(Oh.videoStream):this.render_self_video_wasm()),null===(r=J.A.localVideoEncMGR)||void 0===r||null===(r=r.map)||void 0===r||null===(a=r.get)||void 0===a||null===(a=a.call(r,J.A.SPECIAL_ID))||void 0===a||null===(n=a.postMessage)||void 0===n||n.call(a,{command:137,flag:!1}))},ScreenShot(e,t,i){return new Promise((async(i,r)=>{var a;if(Y.A.add_monitor("SCREENSHOT:".concat(e,":").concat(t)),"video"!=t&&"sharing"!=t)return void r("not support ".concat(t," type"));const n="video"==t,s=e>>10==this.userId>>10,o=qe(),d=e>>10<<10,c=this.webrtcConfig.webrtcflag,u=this.isStartVideoCapture,h=(null===(a=this.selfPreviewVideotagList)||void 0===a?void 0:a.length)||0,l=s&&this.isSelfViewWithVideo;try{if((c||l)&&n){let t=null;var p;c?t=null===(p=this.wmscManager)||void 0===p||null===(p=p.getUserIdVideo(e))||void 0===p?void 0:p[0]:(t=u&&this.videoCaptureValue.videoCtrl,!t&&u&&h&&(t=this.selfPreviewVideotagList[h-1]),t||!this.isMaskSettingOn&&!this.isVBSettingOn||(t=this.MaskSettingVideo));const a={x:0,y:0,width:t.videoWidth,height:t.videoHeight};return void(t?i(await o.captureFromVideoTag(t,a)):r("not found userid ".concat(e)))}const a=J.A.browserFeature;if(!this.checkIsRenderInWorker()||!a.isSupportOffScreenCanvasWebgl()){const a=n?this.VideoRenderObj:this.SharingRenderObj;if(!a)return void r("not ".concat(t," render"));const{canvas:s,options:c}=a.getUserIdVideo(d);return s?(a.reDraw(),void i(await o.captureFromCanvas(s,c))):void r("not found userid ".concat(e," render"))}const f=F.I4.getIsRenderSelfVideoInEncodeWorker(s),g=o.createTask((e=>{let i={command:139,ssrc:d,id:e,type:t},a=null;if(n){const e=f?J.A.localVideoEncMGR:J.A.localVideoDecMGR;a=null==e?void 0:e.map.get(0)}else{const e=this.isSupportVideoShare?J.A.localVideoDecMGR:J.A.localSharingDecMGR;a=null==e?void 0:e.map.get(0)}a?a.postMessage(i):r("no render")}));i(await g.get())}catch(e){r(e)}}))},getMediaStreamController:()=>Oh,async handlePermissionRequest(){let e=await Va.hasPermission("microphone"),t=await Va.hasPermission("camera");if(e&&t)return void this.requestPermissionCallback(u.xzH.GRANTED_AUDIO_VIDEO);let i=null,r=500;F.Ay.isTeslaMode()&&(r=2e3),0==(F.Ay.browser.isSafari&&F.Ay.isMac())&&0==F.Ay.isIpadOSNew()&&(i=setTimeout((()=>{J.A.Notify_APPUI_SAFE(u.Q$T),clearTimeout(i),i=null}),r));try{let e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0});e.getTracks().forEach((e=>e.stop())),e=null,i&&(clearTimeout(i),i=null),this.requestPermissionCallback(u.xzH.GRANTED_AUDIO_VIDEO)}catch(e){try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});e.getTracks().forEach((e=>e.stop())),e=null,i&&(clearTimeout(i),i=null),this.requestPermissionCallback(u.xzH.GRANTED_AUDIO)}catch(e){i&&(clearTimeout(i),i=null);const{errorCode:t}=Bh(e);t===u.sfr.USER_DENIED?this.requestPermissionCallback(u.xzH.DENIED):t===u.sfr.USER_DISMISS?this.requestPermissionCallback(u.xzH.DISMISS):this.requestPermissionCallback(u.xzH.EXCEPTION_FAILS)}}}};const Fh=Uh},5580:(e,t,i)=>{var r=i(6110)(i(9325),"DataView");e.exports=r},8223:(e,t,i)=>{var r=i(6110)(i(9325),"Map");e.exports=r},2804:(e,t,i)=>{var r=i(6110)(i(9325),"Promise");e.exports=r},6545:(e,t,i)=>{var r=i(6110)(i(9325),"Set");e.exports=r},1873:(e,t,i)=>{var r=i(9325).Symbol;e.exports=r},8303:(e,t,i)=>{var r=i(6110)(i(9325),"WeakMap");e.exports=r},2552:(e,t,i)=>{var r=i(1873),a=i(659),n=i(9350),s=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?a(e):n(e)}},7534:(e,t,i)=>{var r=i(2552),a=i(346);e.exports=function(e){return a(e)&&"[object Arguments]"==r(e)}},5083:(e,t,i)=>{var r=i(1882),a=i(7296),n=i(3805),s=i(7473),o=/^\[object .+?Constructor\]$/,d=Function.prototype,c=Object.prototype,u=d.toString,h=c.hasOwnProperty,l=RegExp("^"+u.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!n(e)||a(e))&&(r(e)?l:o).test(s(e))}},4901:(e,t,i)=>{var r=i(2552),a=i(294),n=i(346),s={};s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s["[object Arguments]"]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s["[object Function]"]=s["[object Map]"]=s["[object Number]"]=s["[object Object]"]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1,e.exports=function(e){return n(e)&&a(e.length)&&!!s[r(e)]}},8984:(e,t,i)=>{var r=i(5527),a=i(3650),n=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return a(e);var t=[];for(var i in Object(e))n.call(e,i)&&"constructor"!=i&&t.push(i);return t}},4128:(e,t,i)=>{var r=i(1800),a=/^\s+/;e.exports=function(e){return e?e.slice(0,r(e)+1).replace(a,""):e}},7301:e=>{e.exports=function(e){return function(t){return e(t)}}},5481:(e,t,i)=>{var r=i(9325)["__core-js_shared__"];e.exports=r},2459:(e,t,i)=>{var r="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g;e.exports=r},6110:(e,t,i)=>{var r=i(5083),a=i(392);e.exports=function(e,t){var i=a(e,t);return r(i)?i:void 0}},659:(e,t,i)=>{var r=i(1873),a=Object.prototype,n=a.hasOwnProperty,s=a.toString,o=r?r.toStringTag:void 0;e.exports=function(e){var t=n.call(e,o),i=e[o];try{e[o]=void 0;var r=!0}catch(e){}var a=s.call(e);return r&&(t?e[o]=i:delete e[o]),a}},5861:(e,t,i)=>{var r=i(5580),a=i(8223),n=i(2804),s=i(6545),o=i(8303),d=i(2552),c=i(7473),u="[object Map]",h="[object Promise]",l="[object Set]",p="[object WeakMap]",f="[object DataView]",g=c(r),m=c(a),v=c(n),A=c(s),S=c(o),_=d;(r&&_(new r(new ArrayBuffer(1)))!=f||a&&_(new a)!=u||n&&_(n.resolve())!=h||s&&_(new s)!=l||o&&_(new o)!=p)&&(_=function(e){var t=d(e),i="[object Object]"==t?e.constructor:void 0,r=i?c(i):"";if(r)switch(r){case g:return f;case m:return u;case v:return h;case A:return l;case S:return p}return t}),e.exports=_},392:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},7296:(e,t,i)=>{var r,a=i(5481),n=(r=/[^.]+$/.exec(a&&a.keys&&a.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!n&&n in e}},5527:e=>{var t=Object.prototype;e.exports=function(e){var i=e&&e.constructor;return e===("function"==typeof i&&i.prototype||t)}},3650:(e,t,i)=>{var r=i(4335)(Object.keys,Object);e.exports=r},6009:(e,t,i)=>{e=i.nmd(e);var r=i(2459),a=t&&!t.nodeType&&t,n=a&&e&&!e.nodeType&&e,s=n&&n.exports===a&&r.process,o=function(){try{return n&&n.require&&n.require("util").types||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=o},9350:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},4335:e=>{e.exports=function(e,t){return function(i){return e(t(i))}}},9325:(e,t,i)=>{var r=i(2459),a="object"==typeof self&&self&&self.Object===Object&&self,n=r||a||Function("return this")();e.exports=n},7473:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},1800:e=>{var t=/\s/;e.exports=function(e){for(var i=e.length;i--&&t.test(e.charAt(i)););return i}},8221:(e,t,i)=>{var r=i(3805),a=i(124),n=i(9374),s=Math.max,o=Math.min;e.exports=function(e,t,i){var d,c,u,h,l,p,f=0,g=!1,m=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function A(t){var i=d,r=c;return d=c=void 0,f=t,h=e.apply(r,i)}function S(e){var i=e-p;return void 0===p||i>=t||i<0||m&&e-f>=u}function _(){var e=a();if(S(e))return y(e);l=setTimeout(_,function(e){var i=t-(e-p);return m?o(i,u-(e-f)):i}(e))}function y(e){return l=void 0,v&&d?A(e):(d=c=void 0,h)}function C(){var e=a(),i=S(e);if(d=arguments,c=this,p=e,i){if(void 0===l)return function(e){return f=e,l=setTimeout(_,t),g?A(e):h}(p);if(m)return clearTimeout(l),l=setTimeout(_,t),A(p)}return void 0===l&&(l=setTimeout(_,t)),h}return t=n(t)||0,r(i)&&(g=!!i.leading,u=(m="maxWait"in i)?s(n(i.maxWait)||0,t):u,v="trailing"in i?!!i.trailing:v),C.cancel=function(){void 0!==l&&clearTimeout(l),f=0,d=p=c=l=void 0},C.flush=function(){return void 0===l?h:y(a())},C}},2428:(e,t,i)=>{var r=i(7534),a=i(346),n=Object.prototype,s=n.hasOwnProperty,o=n.propertyIsEnumerable,d=r(function(){return arguments}())?r:function(e){return a(e)&&s.call(e,"callee")&&!o.call(e,"callee")};e.exports=d},6449:e=>{var t=Array.isArray;e.exports=t},4894:(e,t,i)=>{var r=i(1882),a=i(294);e.exports=function(e){return null!=e&&a(e.length)&&!r(e)}},3812:(e,t,i)=>{var r=i(2552),a=i(346);e.exports=function(e){return!0===e||!1===e||a(e)&&"[object Boolean]"==r(e)}},3656:(e,t,i)=>{e=i.nmd(e);var r=i(9325),a=i(9935),n=t&&!t.nodeType&&t,s=n&&e&&!e.nodeType&&e,o=s&&s.exports===n?r.Buffer:void 0,d=(o?o.isBuffer:void 0)||a;e.exports=d},2193:(e,t,i)=>{var r=i(8984),a=i(5861),n=i(2428),s=i(6449),o=i(4894),d=i(3656),c=i(5527),u=i(7167),h=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(o(e)&&(s(e)||"string"==typeof e||"function"==typeof e.splice||d(e)||u(e)||n(e)))return!e.length;var t=a(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(c(e))return!r(e).length;for(var i in e)if(h.call(e,i))return!1;return!0}},1882:(e,t,i)=>{var r=i(2552),a=i(3805);e.exports=function(e){if(!a(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},294:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},8023:(e,t,i)=>{var r=i(2552),a=i(346);e.exports=function(e){return"number"==typeof e||a(e)&&"[object Number]"==r(e)}},3805:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},346:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},4394:(e,t,i)=>{var r=i(2552),a=i(346);e.exports=function(e){return"symbol"==typeof e||a(e)&&"[object Symbol]"==r(e)}},7167:(e,t,i)=>{var r=i(4901),a=i(7301),n=i(6009),s=n&&n.isTypedArray,o=s?a(s):r;e.exports=o},2543:function(e,t,i){var r;e=i.nmd(e),function(){var a,n="Expected a function",s="__lodash_hash_undefined__",o="__lodash_placeholder__",d=32,c=128,u=1/0,h=9007199254740991,l=NaN,p=4294967295,f=[["ary",c],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",d],["partialRight",64],["rearg",256]],g="[object Arguments]",m="[object Array]",v="[object Boolean]",A="[object Date]",S="[object Error]",_="[object Function]",y="[object GeneratorFunction]",C="[object Map]",b="[object Number]",w="[object Object]",E="[object Promise]",R="[object RegExp]",T="[object Set]",I="[object String]",M="[object Symbol]",D="[object WeakMap]",P="[object ArrayBuffer]",k="[object DataView]",O="[object Float32Array]",x="[object Float64Array]",V="[object Int8Array]",N="[object Int16Array]",L="[object Int32Array]",W="[object Uint8Array]",B="[object Uint8ClampedArray]",U="[object Uint16Array]",F="[object Uint32Array]",G=/\b__p \+= '';/g,H=/\b(__p \+=) '' \+/g,j=/(__e\(.*?\)|\b__t\)) \+\n'';/g,K=/&(?:amp|lt|gt|quot|#39);/g,q=/[&<>"']/g,z=RegExp(K.source),X=RegExp(q.source),Y=/<%-([\s\S]+?)%>/g,Q=/<%([\s\S]+?)%>/g,J=/<%=([\s\S]+?)%>/g,Z=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$=/^\w*$/,ee=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,te=/[\\^$.*+?()[\]{}|]/g,ie=RegExp(te.source),re=/^\s+/,ae=/\s/,ne=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,se=/\{\n\/\* \[wrapped with (.+)\] \*/,oe=/,? & /,de=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ce=/[()=,{}\[\]\/\s]/,ue=/\\(\\)?/g,he=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,le=/\w*$/,pe=/^[-+]0x[0-9a-f]+$/i,fe=/^0b[01]+$/i,ge=/^\[object .+?Constructor\]$/,me=/^0o[0-7]+$/i,ve=/^(?:0|[1-9]\d*)$/,Ae=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Se=/($^)/,_e=/['\n\r\u2028\u2029\\]/g,ye="\\ud800-\\udfff",Ce="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",be="\\u2700-\\u27bf",we="a-z\\xdf-\\xf6\\xf8-\\xff",Ee="A-Z\\xc0-\\xd6\\xd8-\\xde",Re="\\ufe0e\\ufe0f",Te="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ie="["+ye+"]",Me="["+Te+"]",De="["+Ce+"]",Pe="\\d+",ke="["+be+"]",Oe="["+we+"]",xe="[^"+ye+Te+Pe+be+we+Ee+"]",Ve="\\ud83c[\\udffb-\\udfff]",Ne="[^"+ye+"]",Le="(?:\\ud83c[\\udde6-\\uddff]){2}",We="[\\ud800-\\udbff][\\udc00-\\udfff]",Be="["+Ee+"]",Ue="\\u200d",Fe="(?:"+Oe+"|"+xe+")",Ge="(?:"+Be+"|"+xe+")",He="(?:['’](?:d|ll|m|re|s|t|ve))?",je="(?:['’](?:D|LL|M|RE|S|T|VE))?",Ke="(?:"+De+"|"+Ve+")?",qe="["+Re+"]?",ze=qe+Ke+"(?:"+Ue+"(?:"+[Ne,Le,We].join("|")+")"+qe+Ke+")*",Xe="(?:"+[ke,Le,We].join("|")+")"+ze,Ye="(?:"+[Ne+De+"?",De,Le,We,Ie].join("|")+")",Qe=RegExp("['’]","g"),Je=RegExp(De,"g"),Ze=RegExp(Ve+"(?="+Ve+")|"+Ye+ze,"g"),$e=RegExp([Be+"?"+Oe+"+"+He+"(?="+[Me,Be,"$"].join("|")+")",Ge+"+"+je+"(?="+[Me,Be+Fe,"$"].join("|")+")",Be+"?"+Fe+"+"+He,Be+"+"+je,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Pe,Xe].join("|"),"g"),et=RegExp("["+Ue+ye+Ce+Re+"]"),tt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,it=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],rt=-1,at={};at[O]=at[x]=at[V]=at[N]=at[L]=at[W]=at[B]=at[U]=at[F]=!0,at[g]=at[m]=at[P]=at[v]=at[k]=at[A]=at[S]=at[_]=at[C]=at[b]=at[w]=at[R]=at[T]=at[I]=at[D]=!1;var nt={};nt[g]=nt[m]=nt[P]=nt[k]=nt[v]=nt[A]=nt[O]=nt[x]=nt[V]=nt[N]=nt[L]=nt[C]=nt[b]=nt[w]=nt[R]=nt[T]=nt[I]=nt[M]=nt[W]=nt[B]=nt[U]=nt[F]=!0,nt[S]=nt[_]=nt[D]=!1;var st={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ot=parseFloat,dt=parseInt,ct="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,ut="object"==typeof self&&self&&self.Object===Object&&self,ht=ct||ut||Function("return this")(),lt=t&&!t.nodeType&&t,pt=lt&&e&&!e.nodeType&&e,ft=pt&&pt.exports===lt,gt=ft&&ct.process,mt=function(){try{return pt&&pt.require&&pt.require("util").types||gt&&gt.binding&&gt.binding("util")}catch(e){}}(),vt=mt&&mt.isArrayBuffer,At=mt&&mt.isDate,St=mt&&mt.isMap,_t=mt&&mt.isRegExp,yt=mt&&mt.isSet,Ct=mt&&mt.isTypedArray;function bt(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}function wt(e,t,i,r){for(var a=-1,n=null==e?0:e.length;++a<n;){var s=e[a];t(r,s,i(s),e)}return r}function Et(e,t){for(var i=-1,r=null==e?0:e.length;++i<r&&!1!==t(e[i],i,e););return e}function Rt(e,t){for(var i=null==e?0:e.length;i--&&!1!==t(e[i],i,e););return e}function Tt(e,t){for(var i=-1,r=null==e?0:e.length;++i<r;)if(!t(e[i],i,e))return!1;return!0}function It(e,t){for(var i=-1,r=null==e?0:e.length,a=0,n=[];++i<r;){var s=e[i];t(s,i,e)&&(n[a++]=s)}return n}function Mt(e,t){return!(null==e||!e.length)&&Bt(e,t,0)>-1}function Dt(e,t,i){for(var r=-1,a=null==e?0:e.length;++r<a;)if(i(t,e[r]))return!0;return!1}function Pt(e,t){for(var i=-1,r=null==e?0:e.length,a=Array(r);++i<r;)a[i]=t(e[i],i,e);return a}function kt(e,t){for(var i=-1,r=t.length,a=e.length;++i<r;)e[a+i]=t[i];return e}function Ot(e,t,i,r){var a=-1,n=null==e?0:e.length;for(r&&n&&(i=e[++a]);++a<n;)i=t(i,e[a],a,e);return i}function xt(e,t,i,r){var a=null==e?0:e.length;for(r&&a&&(i=e[--a]);a--;)i=t(i,e[a],a,e);return i}function Vt(e,t){for(var i=-1,r=null==e?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1}var Nt=Ht("length");function Lt(e,t,i){var r;return i(e,(function(e,i,a){if(t(e,i,a))return r=i,!1})),r}function Wt(e,t,i,r){for(var a=e.length,n=i+(r?1:-1);r?n--:++n<a;)if(t(e[n],n,e))return n;return-1}function Bt(e,t,i){return t==t?function(e,t,i){for(var r=i-1,a=e.length;++r<a;)if(e[r]===t)return r;return-1}(e,t,i):Wt(e,Ft,i)}function Ut(e,t,i,r){for(var a=i-1,n=e.length;++a<n;)if(r(e[a],t))return a;return-1}function Ft(e){return e!=e}function Gt(e,t){var i=null==e?0:e.length;return i?qt(e,t)/i:l}function Ht(e){return function(t){return null==t?a:t[e]}}function jt(e){return function(t){return null==e?a:e[t]}}function Kt(e,t,i,r,a){return a(e,(function(e,a,n){i=r?(r=!1,e):t(i,e,a,n)})),i}function qt(e,t){for(var i,r=-1,n=e.length;++r<n;){var s=t(e[r]);s!==a&&(i=i===a?s:i+s)}return i}function zt(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}function Xt(e){return e?e.slice(0,hi(e)+1).replace(re,""):e}function Yt(e){return function(t){return e(t)}}function Qt(e,t){return Pt(t,(function(t){return e[t]}))}function Jt(e,t){return e.has(t)}function Zt(e,t){for(var i=-1,r=e.length;++i<r&&Bt(t,e[i],0)>-1;);return i}function $t(e,t){for(var i=e.length;i--&&Bt(t,e[i],0)>-1;);return i}var ei=jt({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),ti=jt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function ii(e){return"\\"+st[e]}function ri(e){return et.test(e)}function ai(e){var t=-1,i=Array(e.size);return e.forEach((function(e,r){i[++t]=[r,e]})),i}function ni(e,t){return function(i){return e(t(i))}}function si(e,t){for(var i=-1,r=e.length,a=0,n=[];++i<r;){var s=e[i];s!==t&&s!==o||(e[i]=o,n[a++]=i)}return n}function oi(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=e})),i}function di(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=[e,e]})),i}function ci(e){return ri(e)?function(e){for(var t=Ze.lastIndex=0;Ze.test(e);)++t;return t}(e):Nt(e)}function ui(e){return ri(e)?function(e){return e.match(Ze)||[]}(e):function(e){return e.split("")}(e)}function hi(e){for(var t=e.length;t--&&ae.test(e.charAt(t)););return t}var li=jt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),pi=function e(t){var i,r=(t=null==t?ht:pi.defaults(ht.Object(),t,pi.pick(ht,it))).Array,ae=t.Date,ye=t.Error,Ce=t.Function,be=t.Math,we=t.Object,Ee=t.RegExp,Re=t.String,Te=t.TypeError,Ie=r.prototype,Me=Ce.prototype,De=we.prototype,Pe=t["__core-js_shared__"],ke=Me.toString,Oe=De.hasOwnProperty,xe=0,Ve=(i=/[^.]+$/.exec(Pe&&Pe.keys&&Pe.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"",Ne=De.toString,Le=ke.call(we),We=ht._,Be=Ee("^"+ke.call(Oe).replace(te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ue=ft?t.Buffer:a,Fe=t.Symbol,Ge=t.Uint8Array,He=Ue?Ue.allocUnsafe:a,je=ni(we.getPrototypeOf,we),Ke=we.create,qe=De.propertyIsEnumerable,ze=Ie.splice,Xe=Fe?Fe.isConcatSpreadable:a,Ye=Fe?Fe.iterator:a,Ze=Fe?Fe.toStringTag:a,et=function(){try{var e=dn(we,"defineProperty");return e({},"",{}),e}catch(e){}}(),st=t.clearTimeout!==ht.clearTimeout&&t.clearTimeout,ct=ae&&ae.now!==ht.Date.now&&ae.now,ut=t.setTimeout!==ht.setTimeout&&t.setTimeout,lt=be.ceil,pt=be.floor,gt=we.getOwnPropertySymbols,mt=Ue?Ue.isBuffer:a,Nt=t.isFinite,jt=Ie.join,fi=ni(we.keys,we),gi=be.max,mi=be.min,vi=ae.now,Ai=t.parseInt,Si=be.random,_i=Ie.reverse,yi=dn(t,"DataView"),Ci=dn(t,"Map"),bi=dn(t,"Promise"),wi=dn(t,"Set"),Ei=dn(t,"WeakMap"),Ri=dn(we,"create"),Ti=Ei&&new Ei,Ii={},Mi=Nn(yi),Di=Nn(Ci),Pi=Nn(bi),ki=Nn(wi),Oi=Nn(Ei),xi=Fe?Fe.prototype:a,Vi=xi?xi.valueOf:a,Ni=xi?xi.toString:a;function Li(e){if($s(e)&&!Gs(e)&&!(e instanceof Fi)){if(e instanceof Ui)return e;if(Oe.call(e,"__wrapped__"))return Ln(e)}return new Ui(e)}var Wi=function(){function e(){}return function(t){if(!Zs(t))return{};if(Ke)return Ke(t);e.prototype=t;var i=new e;return e.prototype=a,i}}();function Bi(){}function Ui(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=a}function Fi(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=p,this.__views__=[]}function Gi(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function Hi(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function ji(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function Ki(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new ji;++t<i;)this.add(e[t])}function qi(e){var t=this.__data__=new Hi(e);this.size=t.size}function zi(e,t){var i=Gs(e),r=!i&&Fs(e),a=!i&&!r&&qs(e),n=!i&&!r&&!a&&oo(e),s=i||r||a||n,o=s?zt(e.length,Re):[],d=o.length;for(var c in e)!t&&!Oe.call(e,c)||s&&("length"==c||a&&("offset"==c||"parent"==c)||n&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||gn(c,d))||o.push(c);return o}function Xi(e){var t=e.length;return t?e[jr(0,t-1)]:a}function Yi(e,t){return Pn(Ea(e),ar(t,0,e.length))}function Qi(e){return Pn(Ea(e))}function Ji(e,t,i){(i!==a&&!Ws(e[t],i)||i===a&&!(t in e))&&ir(e,t,i)}function Zi(e,t,i){var r=e[t];Oe.call(e,t)&&Ws(r,i)&&(i!==a||t in e)||ir(e,t,i)}function $i(e,t){for(var i=e.length;i--;)if(Ws(e[i][0],t))return i;return-1}function er(e,t,i,r){return cr(e,(function(e,a,n){t(r,e,i(e),n)})),r}function tr(e,t){return e&&Ra(t,Do(t),e)}function ir(e,t,i){"__proto__"==t&&et?et(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}function rr(e,t){for(var i=-1,n=t.length,s=r(n),o=null==e;++i<n;)s[i]=o?a:Eo(e,t[i]);return s}function ar(e,t,i){return e==e&&(i!==a&&(e=e<=i?e:i),t!==a&&(e=e>=t?e:t)),e}function nr(e,t,i,r,n,s){var o,d=1&t,c=2&t,u=4&t;if(i&&(o=n?i(e,r,n,s):i(e)),o!==a)return o;if(!Zs(e))return e;var h=Gs(e);if(h){if(o=function(e){var t=e.length,i=new e.constructor(t);return t&&"string"==typeof e[0]&&Oe.call(e,"index")&&(i.index=e.index,i.input=e.input),i}(e),!d)return Ea(e,o)}else{var l=hn(e),p=l==_||l==y;if(qs(e))return Sa(e,d);if(l==w||l==g||p&&!n){if(o=c||p?{}:pn(e),!d)return c?function(e,t){return Ra(e,un(e),t)}(e,function(e,t){return e&&Ra(t,Po(t),e)}(o,e)):function(e,t){return Ra(e,cn(e),t)}(e,tr(o,e))}else{if(!nt[l])return n?e:{};o=function(e,t,i){var r,a=e.constructor;switch(t){case P:return _a(e);case v:case A:return new a(+e);case k:return function(e,t){var i=t?_a(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}(e,i);case O:case x:case V:case N:case L:case W:case B:case U:case F:return ya(e,i);case C:return new a;case b:case I:return new a(e);case R:return function(e){var t=new e.constructor(e.source,le.exec(e));return t.lastIndex=e.lastIndex,t}(e);case T:return new a;case M:return r=e,Vi?we(Vi.call(r)):{}}}(e,l,d)}}s||(s=new qi);var f=s.get(e);if(f)return f;s.set(e,o),ao(e)?e.forEach((function(r){o.add(nr(r,t,i,r,e,s))})):eo(e)&&e.forEach((function(r,a){o.set(a,nr(r,t,i,a,e,s))}));var m=h?a:(u?c?en:$a:c?Po:Do)(e);return Et(m||e,(function(r,a){m&&(r=e[a=r]),Zi(o,a,nr(r,t,i,a,e,s))})),o}function sr(e,t,i){var r=i.length;if(null==e)return!r;for(e=we(e);r--;){var n=i[r],s=t[n],o=e[n];if(o===a&&!(n in e)||!s(o))return!1}return!0}function or(e,t,i){if("function"!=typeof e)throw new Te(n);return Tn((function(){e.apply(a,i)}),t)}function dr(e,t,i,r){var a=-1,n=Mt,s=!0,o=e.length,d=[],c=t.length;if(!o)return d;i&&(t=Pt(t,Yt(i))),r?(n=Dt,s=!1):t.length>=200&&(n=Jt,s=!1,t=new Ki(t));e:for(;++a<o;){var u=e[a],h=null==i?u:i(u);if(u=r||0!==u?u:0,s&&h==h){for(var l=c;l--;)if(t[l]===h)continue e;d.push(u)}else n(t,h,r)||d.push(u)}return d}Li.templateSettings={escape:Y,evaluate:Q,interpolate:J,variable:"",imports:{_:Li}},Li.prototype=Bi.prototype,Li.prototype.constructor=Li,Ui.prototype=Wi(Bi.prototype),Ui.prototype.constructor=Ui,Fi.prototype=Wi(Bi.prototype),Fi.prototype.constructor=Fi,Gi.prototype.clear=function(){this.__data__=Ri?Ri(null):{},this.size=0},Gi.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Gi.prototype.get=function(e){var t=this.__data__;if(Ri){var i=t[e];return i===s?a:i}return Oe.call(t,e)?t[e]:a},Gi.prototype.has=function(e){var t=this.__data__;return Ri?t[e]!==a:Oe.call(t,e)},Gi.prototype.set=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Ri&&t===a?s:t,this},Hi.prototype.clear=function(){this.__data__=[],this.size=0},Hi.prototype.delete=function(e){var t=this.__data__,i=$i(t,e);return!(i<0||(i==t.length-1?t.pop():ze.call(t,i,1),--this.size,0))},Hi.prototype.get=function(e){var t=this.__data__,i=$i(t,e);return i<0?a:t[i][1]},Hi.prototype.has=function(e){return $i(this.__data__,e)>-1},Hi.prototype.set=function(e,t){var i=this.__data__,r=$i(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this},ji.prototype.clear=function(){this.size=0,this.__data__={hash:new Gi,map:new(Ci||Hi),string:new Gi}},ji.prototype.delete=function(e){var t=sn(this,e).delete(e);return this.size-=t?1:0,t},ji.prototype.get=function(e){return sn(this,e).get(e)},ji.prototype.has=function(e){return sn(this,e).has(e)},ji.prototype.set=function(e,t){var i=sn(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this},Ki.prototype.add=Ki.prototype.push=function(e){return this.__data__.set(e,s),this},Ki.prototype.has=function(e){return this.__data__.has(e)},qi.prototype.clear=function(){this.__data__=new Hi,this.size=0},qi.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},qi.prototype.get=function(e){return this.__data__.get(e)},qi.prototype.has=function(e){return this.__data__.has(e)},qi.prototype.set=function(e,t){var i=this.__data__;if(i instanceof Hi){var r=i.__data__;if(!Ci||r.length<199)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new ji(r)}return i.set(e,t),this.size=i.size,this};var cr=Ma(vr),ur=Ma(Ar,!0);function hr(e,t){var i=!0;return cr(e,(function(e,r,a){return i=!!t(e,r,a)})),i}function lr(e,t,i){for(var r=-1,n=e.length;++r<n;){var s=e[r],o=t(s);if(null!=o&&(d===a?o==o&&!so(o):i(o,d)))var d=o,c=s}return c}function pr(e,t){var i=[];return cr(e,(function(e,r,a){t(e,r,a)&&i.push(e)})),i}function fr(e,t,i,r,a){var n=-1,s=e.length;for(i||(i=fn),a||(a=[]);++n<s;){var o=e[n];t>0&&i(o)?t>1?fr(o,t-1,i,r,a):kt(a,o):r||(a[a.length]=o)}return a}var gr=Da(),mr=Da(!0);function vr(e,t){return e&&gr(e,t,Do)}function Ar(e,t){return e&&mr(e,t,Do)}function Sr(e,t){return It(t,(function(t){return Ys(e[t])}))}function _r(e,t){for(var i=0,r=(t=ga(t,e)).length;null!=e&&i<r;)e=e[Vn(t[i++])];return i&&i==r?e:a}function yr(e,t,i){var r=t(e);return Gs(e)?r:kt(r,i(e))}function Cr(e){return null==e?e===a?"[object Undefined]":"[object Null]":Ze&&Ze in we(e)?function(e){var t=Oe.call(e,Ze),i=e[Ze];try{e[Ze]=a;var r=!0}catch(e){}var n=Ne.call(e);return r&&(t?e[Ze]=i:delete e[Ze]),n}(e):function(e){return Ne.call(e)}(e)}function br(e,t){return e>t}function wr(e,t){return null!=e&&Oe.call(e,t)}function Er(e,t){return null!=e&&t in we(e)}function Rr(e,t,i){for(var n=i?Dt:Mt,s=e[0].length,o=e.length,d=o,c=r(o),u=1/0,h=[];d--;){var l=e[d];d&&t&&(l=Pt(l,Yt(t))),u=mi(l.length,u),c[d]=!i&&(t||s>=120&&l.length>=120)?new Ki(d&&l):a}l=e[0];var p=-1,f=c[0];e:for(;++p<s&&h.length<u;){var g=l[p],m=t?t(g):g;if(g=i||0!==g?g:0,!(f?Jt(f,m):n(h,m,i))){for(d=o;--d;){var v=c[d];if(!(v?Jt(v,m):n(e[d],m,i)))continue e}f&&f.push(m),h.push(g)}}return h}function Tr(e,t,i){var r=null==(e=wn(e,t=ga(t,e)))?e:e[Vn(Xn(t))];return null==r?a:bt(r,e,i)}function Ir(e){return $s(e)&&Cr(e)==g}function Mr(e,t,i,r,n){return e===t||(null==e||null==t||!$s(e)&&!$s(t)?e!=e&&t!=t:function(e,t,i,r,n,s){var o=Gs(e),d=Gs(t),c=o?m:hn(e),u=d?m:hn(t),h=(c=c==g?w:c)==w,l=(u=u==g?w:u)==w,p=c==u;if(p&&qs(e)){if(!qs(t))return!1;o=!0,h=!1}if(p&&!h)return s||(s=new qi),o||oo(e)?Ja(e,t,i,r,n,s):function(e,t,i,r,a,n,s){switch(i){case k:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case P:return!(e.byteLength!=t.byteLength||!n(new Ge(e),new Ge(t)));case v:case A:case b:return Ws(+e,+t);case S:return e.name==t.name&&e.message==t.message;case R:case I:return e==t+"";case C:var o=ai;case T:var d=1&r;if(o||(o=oi),e.size!=t.size&&!d)return!1;var c=s.get(e);if(c)return c==t;r|=2,s.set(e,t);var u=Ja(o(e),o(t),r,a,n,s);return s.delete(e),u;case M:if(Vi)return Vi.call(e)==Vi.call(t)}return!1}(e,t,c,i,r,n,s);if(!(1&i)){var f=h&&Oe.call(e,"__wrapped__"),_=l&&Oe.call(t,"__wrapped__");if(f||_){var y=f?e.value():e,E=_?t.value():t;return s||(s=new qi),n(y,E,i,r,s)}}return!!p&&(s||(s=new qi),function(e,t,i,r,n,s){var o=1&i,d=$a(e),c=d.length;if(c!=$a(t).length&&!o)return!1;for(var u=c;u--;){var h=d[u];if(!(o?h in t:Oe.call(t,h)))return!1}var l=s.get(e),p=s.get(t);if(l&&p)return l==t&&p==e;var f=!0;s.set(e,t),s.set(t,e);for(var g=o;++u<c;){var m=e[h=d[u]],v=t[h];if(r)var A=o?r(v,m,h,t,e,s):r(m,v,h,e,t,s);if(!(A===a?m===v||n(m,v,i,r,s):A)){f=!1;break}g||(g="constructor"==h)}if(f&&!g){var S=e.constructor,_=t.constructor;S==_||!("constructor"in e)||!("constructor"in t)||"function"==typeof S&&S instanceof S&&"function"==typeof _&&_ instanceof _||(f=!1)}return s.delete(e),s.delete(t),f}(e,t,i,r,n,s))}(e,t,i,r,Mr,n))}function Dr(e,t,i,r){var n=i.length,s=n,o=!r;if(null==e)return!s;for(e=we(e);n--;){var d=i[n];if(o&&d[2]?d[1]!==e[d[0]]:!(d[0]in e))return!1}for(;++n<s;){var c=(d=i[n])[0],u=e[c],h=d[1];if(o&&d[2]){if(u===a&&!(c in e))return!1}else{var l=new qi;if(r)var p=r(u,h,c,e,t,l);if(!(p===a?Mr(h,u,3,r,l):p))return!1}}return!0}function Pr(e){return!(!Zs(e)||(t=e,Ve&&Ve in t))&&(Ys(e)?Be:ge).test(Nn(e));var t}function kr(e){return"function"==typeof e?e:null==e?id:"object"==typeof e?Gs(e)?Lr(e[0],e[1]):Nr(e):hd(e)}function Or(e){if(!_n(e))return fi(e);var t=[];for(var i in we(e))Oe.call(e,i)&&"constructor"!=i&&t.push(i);return t}function xr(e,t){return e<t}function Vr(e,t){var i=-1,a=js(e)?r(e.length):[];return cr(e,(function(e,r,n){a[++i]=t(e,r,n)})),a}function Nr(e){var t=on(e);return 1==t.length&&t[0][2]?Cn(t[0][0],t[0][1]):function(i){return i===e||Dr(i,e,t)}}function Lr(e,t){return vn(e)&&yn(t)?Cn(Vn(e),t):function(i){var r=Eo(i,e);return r===a&&r===t?Ro(i,e):Mr(t,r,3)}}function Wr(e,t,i,r,n){e!==t&&gr(t,(function(s,o){if(n||(n=new qi),Zs(s))!function(e,t,i,r,n,s,o){var d=En(e,i),c=En(t,i),u=o.get(c);if(u)Ji(e,i,u);else{var h=s?s(d,c,i+"",e,t,o):a,l=h===a;if(l){var p=Gs(c),f=!p&&qs(c),g=!p&&!f&&oo(c);h=c,p||f||g?Gs(d)?h=d:Ks(d)?h=Ea(d):f?(l=!1,h=Sa(c,!0)):g?(l=!1,h=ya(c,!0)):h=[]:io(c)||Fs(c)?(h=d,Fs(d)?h=mo(d):Zs(d)&&!Ys(d)||(h=pn(c))):l=!1}l&&(o.set(c,h),n(h,c,r,s,o),o.delete(c)),Ji(e,i,h)}}(e,t,o,i,Wr,r,n);else{var d=r?r(En(e,o),s,o+"",e,t,n):a;d===a&&(d=s),Ji(e,o,d)}}),Po)}function Br(e,t){var i=e.length;if(i)return gn(t+=t<0?i:0,i)?e[t]:a}function Ur(e,t,i){t=t.length?Pt(t,(function(e){return Gs(e)?function(t){return _r(t,1===e.length?e[0]:e)}:e})):[id];var r=-1;t=Pt(t,Yt(nn()));var a=Vr(e,(function(e,i,a){var n=Pt(t,(function(t){return t(e)}));return{criteria:n,index:++r,value:e}}));return function(e){var t=e.length;for(e.sort((function(e,t){return function(e,t,i){for(var r=-1,a=e.criteria,n=t.criteria,s=a.length,o=i.length;++r<s;){var d=Ca(a[r],n[r]);if(d)return r>=o?d:d*("desc"==i[r]?-1:1)}return e.index-t.index}(e,t,i)}));t--;)e[t]=e[t].value;return e}(a)}function Fr(e,t,i){for(var r=-1,a=t.length,n={};++r<a;){var s=t[r],o=_r(e,s);i(o,s)&&Yr(n,ga(s,e),o)}return n}function Gr(e,t,i,r){var a=r?Ut:Bt,n=-1,s=t.length,o=e;for(e===t&&(t=Ea(t)),i&&(o=Pt(e,Yt(i)));++n<s;)for(var d=0,c=t[n],u=i?i(c):c;(d=a(o,u,d,r))>-1;)o!==e&&ze.call(o,d,1),ze.call(e,d,1);return e}function Hr(e,t){for(var i=e?t.length:0,r=i-1;i--;){var a=t[i];if(i==r||a!==n){var n=a;gn(a)?ze.call(e,a,1):oa(e,a)}}return e}function jr(e,t){return e+pt(Si()*(t-e+1))}function Kr(e,t){var i="";if(!e||t<1||t>h)return i;do{t%2&&(i+=e),(t=pt(t/2))&&(e+=e)}while(t);return i}function qr(e,t){return In(bn(e,t,id),e+"")}function zr(e){return Xi(Bo(e))}function Xr(e,t){var i=Bo(e);return Pn(i,ar(t,0,i.length))}function Yr(e,t,i,r){if(!Zs(e))return e;for(var n=-1,s=(t=ga(t,e)).length,o=s-1,d=e;null!=d&&++n<s;){var c=Vn(t[n]),u=i;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(n!=o){var h=d[c];(u=r?r(h,c,d):a)===a&&(u=Zs(h)?h:gn(t[n+1])?[]:{})}Zi(d,c,u),d=d[c]}return e}var Qr=Ti?function(e,t){return Ti.set(e,t),e}:id,Jr=et?function(e,t){return et(e,"toString",{configurable:!0,enumerable:!1,value:$o(t),writable:!0})}:id;function Zr(e){return Pn(Bo(e))}function $r(e,t,i){var a=-1,n=e.length;t<0&&(t=-t>n?0:n+t),(i=i>n?n:i)<0&&(i+=n),n=t>i?0:i-t>>>0,t>>>=0;for(var s=r(n);++a<n;)s[a]=e[a+t];return s}function ea(e,t){var i;return cr(e,(function(e,r,a){return!(i=t(e,r,a))})),!!i}function ta(e,t,i){var r=0,a=null==e?r:e.length;if("number"==typeof t&&t==t&&a<=2147483647){for(;r<a;){var n=r+a>>>1,s=e[n];null!==s&&!so(s)&&(i?s<=t:s<t)?r=n+1:a=n}return a}return ia(e,t,id,i)}function ia(e,t,i,r){var n=0,s=null==e?0:e.length;if(0===s)return 0;for(var o=(t=i(t))!=t,d=null===t,c=so(t),u=t===a;n<s;){var h=pt((n+s)/2),l=i(e[h]),p=l!==a,f=null===l,g=l==l,m=so(l);if(o)var v=r||g;else v=u?g&&(r||p):d?g&&p&&(r||!f):c?g&&p&&!f&&(r||!m):!f&&!m&&(r?l<=t:l<t);v?n=h+1:s=h}return mi(s,4294967294)}function ra(e,t){for(var i=-1,r=e.length,a=0,n=[];++i<r;){var s=e[i],o=t?t(s):s;if(!i||!Ws(o,d)){var d=o;n[a++]=0===s?0:s}}return n}function aa(e){return"number"==typeof e?e:so(e)?l:+e}function na(e){if("string"==typeof e)return e;if(Gs(e))return Pt(e,na)+"";if(so(e))return Ni?Ni.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function sa(e,t,i){var r=-1,a=Mt,n=e.length,s=!0,o=[],d=o;if(i)s=!1,a=Dt;else if(n>=200){var c=t?null:Ka(e);if(c)return oi(c);s=!1,a=Jt,d=new Ki}else d=t?[]:o;e:for(;++r<n;){var u=e[r],h=t?t(u):u;if(u=i||0!==u?u:0,s&&h==h){for(var l=d.length;l--;)if(d[l]===h)continue e;t&&d.push(h),o.push(u)}else a(d,h,i)||(d!==o&&d.push(h),o.push(u))}return o}function oa(e,t){return null==(e=wn(e,t=ga(t,e)))||delete e[Vn(Xn(t))]}function da(e,t,i,r){return Yr(e,t,i(_r(e,t)),r)}function ca(e,t,i,r){for(var a=e.length,n=r?a:-1;(r?n--:++n<a)&&t(e[n],n,e););return i?$r(e,r?0:n,r?n+1:a):$r(e,r?n+1:0,r?a:n)}function ua(e,t){var i=e;return i instanceof Fi&&(i=i.value()),Ot(t,(function(e,t){return t.func.apply(t.thisArg,kt([e],t.args))}),i)}function ha(e,t,i){var a=e.length;if(a<2)return a?sa(e[0]):[];for(var n=-1,s=r(a);++n<a;)for(var o=e[n],d=-1;++d<a;)d!=n&&(s[n]=dr(s[n]||o,e[d],t,i));return sa(fr(s,1),t,i)}function la(e,t,i){for(var r=-1,n=e.length,s=t.length,o={};++r<n;){var d=r<s?t[r]:a;i(o,e[r],d)}return o}function pa(e){return Ks(e)?e:[]}function fa(e){return"function"==typeof e?e:id}function ga(e,t){return Gs(e)?e:vn(e,t)?[e]:xn(vo(e))}var ma=qr;function va(e,t,i){var r=e.length;return i=i===a?r:i,!t&&i>=r?e:$r(e,t,i)}var Aa=st||function(e){return ht.clearTimeout(e)};function Sa(e,t){if(t)return e.slice();var i=e.length,r=He?He(i):new e.constructor(i);return e.copy(r),r}function _a(e){var t=new e.constructor(e.byteLength);return new Ge(t).set(new Ge(e)),t}function ya(e,t){var i=t?_a(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}function Ca(e,t){if(e!==t){var i=e!==a,r=null===e,n=e==e,s=so(e),o=t!==a,d=null===t,c=t==t,u=so(t);if(!d&&!u&&!s&&e>t||s&&o&&c&&!d&&!u||r&&o&&c||!i&&c||!n)return 1;if(!r&&!s&&!u&&e<t||u&&i&&n&&!r&&!s||d&&i&&n||!o&&n||!c)return-1}return 0}function ba(e,t,i,a){for(var n=-1,s=e.length,o=i.length,d=-1,c=t.length,u=gi(s-o,0),h=r(c+u),l=!a;++d<c;)h[d]=t[d];for(;++n<o;)(l||n<s)&&(h[i[n]]=e[n]);for(;u--;)h[d++]=e[n++];return h}function wa(e,t,i,a){for(var n=-1,s=e.length,o=-1,d=i.length,c=-1,u=t.length,h=gi(s-d,0),l=r(h+u),p=!a;++n<h;)l[n]=e[n];for(var f=n;++c<u;)l[f+c]=t[c];for(;++o<d;)(p||n<s)&&(l[f+i[o]]=e[n++]);return l}function Ea(e,t){var i=-1,a=e.length;for(t||(t=r(a));++i<a;)t[i]=e[i];return t}function Ra(e,t,i,r){var n=!i;i||(i={});for(var s=-1,o=t.length;++s<o;){var d=t[s],c=r?r(i[d],e[d],d,i,e):a;c===a&&(c=e[d]),n?ir(i,d,c):Zi(i,d,c)}return i}function Ta(e,t){return function(i,r){var a=Gs(i)?wt:er,n=t?t():{};return a(i,e,nn(r,2),n)}}function Ia(e){return qr((function(t,i){var r=-1,n=i.length,s=n>1?i[n-1]:a,o=n>2?i[2]:a;for(s=e.length>3&&"function"==typeof s?(n--,s):a,o&&mn(i[0],i[1],o)&&(s=n<3?a:s,n=1),t=we(t);++r<n;){var d=i[r];d&&e(t,d,r,s)}return t}))}function Ma(e,t){return function(i,r){if(null==i)return i;if(!js(i))return e(i,r);for(var a=i.length,n=t?a:-1,s=we(i);(t?n--:++n<a)&&!1!==r(s[n],n,s););return i}}function Da(e){return function(t,i,r){for(var a=-1,n=we(t),s=r(t),o=s.length;o--;){var d=s[e?o:++a];if(!1===i(n[d],d,n))break}return t}}function Pa(e){return function(t){var i=ri(t=vo(t))?ui(t):a,r=i?i[0]:t.charAt(0),n=i?va(i,1).join(""):t.slice(1);return r[e]()+n}}function ka(e){return function(t){return Ot(Qo(Go(t).replace(Qe,"")),e,"")}}function Oa(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var i=Wi(e.prototype),r=e.apply(i,t);return Zs(r)?r:i}}function xa(e){return function(t,i,r){var n=we(t);if(!js(t)){var s=nn(i,3);t=Do(t),i=function(e){return s(n[e],e,n)}}var o=e(t,i,r);return o>-1?n[s?t[o]:o]:a}}function Va(e){return Za((function(t){var i=t.length,r=i,s=Ui.prototype.thru;for(e&&t.reverse();r--;){var o=t[r];if("function"!=typeof o)throw new Te(n);if(s&&!d&&"wrapper"==rn(o))var d=new Ui([],!0)}for(r=d?r:i;++r<i;){var c=rn(o=t[r]),u="wrapper"==c?tn(o):a;d=u&&An(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?d[rn(u[0])].apply(d,u[3]):1==o.length&&An(o)?d[c]():d.thru(o)}return function(){var e=arguments,r=e[0];if(d&&1==e.length&&Gs(r))return d.plant(r).value();for(var a=0,n=i?t[a].apply(this,e):r;++a<i;)n=t[a].call(this,n);return n}}))}function Na(e,t,i,n,s,o,d,u,h,l){var p=t&c,f=1&t,g=2&t,m=24&t,v=512&t,A=g?a:Oa(e);return function c(){for(var S=arguments.length,_=r(S),y=S;y--;)_[y]=arguments[y];if(m)var C=an(c),b=function(e,t){for(var i=e.length,r=0;i--;)e[i]===t&&++r;return r}(_,C);if(n&&(_=ba(_,n,s,m)),o&&(_=wa(_,o,d,m)),S-=b,m&&S<l){var w=si(_,C);return Ha(e,t,Na,c.placeholder,i,_,w,u,h,l-S)}var E=f?i:this,R=g?E[e]:e;return S=_.length,u?_=function(e,t){for(var i=e.length,r=mi(t.length,i),n=Ea(e);r--;){var s=t[r];e[r]=gn(s,i)?n[s]:a}return e}(_,u):v&&S>1&&_.reverse(),p&&h<S&&(_.length=h),this&&this!==ht&&this instanceof c&&(R=A||Oa(R)),R.apply(E,_)}}function La(e,t){return function(i,r){return function(e,t,i,r){return vr(e,(function(e,a,n){t(r,i(e),a,n)})),r}(i,e,t(r),{})}}function Wa(e,t){return function(i,r){var n;if(i===a&&r===a)return t;if(i!==a&&(n=i),r!==a){if(n===a)return r;"string"==typeof i||"string"==typeof r?(i=na(i),r=na(r)):(i=aa(i),r=aa(r)),n=e(i,r)}return n}}function Ba(e){return Za((function(t){return t=Pt(t,Yt(nn())),qr((function(i){var r=this;return e(t,(function(e){return bt(e,r,i)}))}))}))}function Ua(e,t){var i=(t=t===a?" ":na(t)).length;if(i<2)return i?Kr(t,e):t;var r=Kr(t,lt(e/ci(t)));return ri(t)?va(ui(r),0,e).join(""):r.slice(0,e)}function Fa(e){return function(t,i,n){return n&&"number"!=typeof n&&mn(t,i,n)&&(i=n=a),t=lo(t),i===a?(i=t,t=0):i=lo(i),function(e,t,i,a){for(var n=-1,s=gi(lt((t-e)/(i||1)),0),o=r(s);s--;)o[a?s:++n]=e,e+=i;return o}(t,i,n=n===a?t<i?1:-1:lo(n),e)}}function Ga(e){return function(t,i){return"string"==typeof t&&"string"==typeof i||(t=go(t),i=go(i)),e(t,i)}}function Ha(e,t,i,r,n,s,o,c,u,h){var l=8&t;t|=l?d:64,4&(t&=~(l?64:d))||(t&=-4);var p=[e,t,n,l?s:a,l?o:a,l?a:s,l?a:o,c,u,h],f=i.apply(a,p);return An(e)&&Rn(f,p),f.placeholder=r,Mn(f,e,t)}function ja(e){var t=be[e];return function(e,i){if(e=go(e),(i=null==i?0:mi(po(i),292))&&Nt(e)){var r=(vo(e)+"e").split("e");return+((r=(vo(t(r[0]+"e"+(+r[1]+i)))+"e").split("e"))[0]+"e"+(+r[1]-i))}return t(e)}}var Ka=wi&&1/oi(new wi([,-0]))[1]==u?function(e){return new wi(e)}:od;function qa(e){return function(t){var i=hn(t);return i==C?ai(t):i==T?di(t):function(e,t){return Pt(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function za(e,t,i,s,u,h,l,p){var f=2&t;if(!f&&"function"!=typeof e)throw new Te(n);var g=s?s.length:0;if(g||(t&=-97,s=u=a),l=l===a?l:gi(po(l),0),p=p===a?p:po(p),g-=u?u.length:0,64&t){var m=s,v=u;s=u=a}var A=f?a:tn(e),S=[e,t,i,s,u,m,v,h,l,p];if(A&&function(e,t){var i=e[1],r=t[1],a=i|r,n=a<131,s=r==c&&8==i||r==c&&256==i&&e[7].length<=t[8]||384==r&&t[7].length<=t[8]&&8==i;if(!n&&!s)return e;1&r&&(e[2]=t[2],a|=1&i?0:4);var d=t[3];if(d){var u=e[3];e[3]=u?ba(u,d,t[4]):d,e[4]=u?si(e[3],o):t[4]}(d=t[5])&&(u=e[5],e[5]=u?wa(u,d,t[6]):d,e[6]=u?si(e[5],o):t[6]),(d=t[7])&&(e[7]=d),r&c&&(e[8]=null==e[8]?t[8]:mi(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=a}(S,A),e=S[0],t=S[1],i=S[2],s=S[3],u=S[4],!(p=S[9]=S[9]===a?f?0:e.length:gi(S[9]-g,0))&&24&t&&(t&=-25),t&&1!=t)_=8==t||16==t?function(e,t,i){var n=Oa(e);return function s(){for(var o=arguments.length,d=r(o),c=o,u=an(s);c--;)d[c]=arguments[c];var h=o<3&&d[0]!==u&&d[o-1]!==u?[]:si(d,u);return(o-=h.length)<i?Ha(e,t,Na,s.placeholder,a,d,h,a,a,i-o):bt(this&&this!==ht&&this instanceof s?n:e,this,d)}}(e,t,p):t!=d&&33!=t||u.length?Na.apply(a,S):function(e,t,i,a){var n=1&t,s=Oa(e);return function t(){for(var o=-1,d=arguments.length,c=-1,u=a.length,h=r(u+d),l=this&&this!==ht&&this instanceof t?s:e;++c<u;)h[c]=a[c];for(;d--;)h[c++]=arguments[++o];return bt(l,n?i:this,h)}}(e,t,i,s);else var _=function(e,t,i){var r=1&t,a=Oa(e);return function t(){return(this&&this!==ht&&this instanceof t?a:e).apply(r?i:this,arguments)}}(e,t,i);return Mn((A?Qr:Rn)(_,S),e,t)}function Xa(e,t,i,r){return e===a||Ws(e,De[i])&&!Oe.call(r,i)?t:e}function Ya(e,t,i,r,n,s){return Zs(e)&&Zs(t)&&(s.set(t,e),Wr(e,t,a,Ya,s),s.delete(t)),e}function Qa(e){return io(e)?a:e}function Ja(e,t,i,r,n,s){var o=1&i,d=e.length,c=t.length;if(d!=c&&!(o&&c>d))return!1;var u=s.get(e),h=s.get(t);if(u&&h)return u==t&&h==e;var l=-1,p=!0,f=2&i?new Ki:a;for(s.set(e,t),s.set(t,e);++l<d;){var g=e[l],m=t[l];if(r)var v=o?r(m,g,l,t,e,s):r(g,m,l,e,t,s);if(v!==a){if(v)continue;p=!1;break}if(f){if(!Vt(t,(function(e,t){if(!Jt(f,t)&&(g===e||n(g,e,i,r,s)))return f.push(t)}))){p=!1;break}}else if(g!==m&&!n(g,m,i,r,s)){p=!1;break}}return s.delete(e),s.delete(t),p}function Za(e){return In(bn(e,a,Hn),e+"")}function $a(e){return yr(e,Do,cn)}function en(e){return yr(e,Po,un)}var tn=Ti?function(e){return Ti.get(e)}:od;function rn(e){for(var t=e.name+"",i=Ii[t],r=Oe.call(Ii,t)?i.length:0;r--;){var a=i[r],n=a.func;if(null==n||n==e)return a.name}return t}function an(e){return(Oe.call(Li,"placeholder")?Li:e).placeholder}function nn(){var e=Li.iteratee||rd;return e=e===rd?kr:e,arguments.length?e(arguments[0],arguments[1]):e}function sn(e,t){var i,r,a=e.__data__;return("string"==(r=typeof(i=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==i:null===i)?a["string"==typeof t?"string":"hash"]:a.map}function on(e){for(var t=Do(e),i=t.length;i--;){var r=t[i],a=e[r];t[i]=[r,a,yn(a)]}return t}function dn(e,t){var i=function(e,t){return null==e?a:e[t]}(e,t);return Pr(i)?i:a}var cn=gt?function(e){return null==e?[]:(e=we(e),It(gt(e),(function(t){return qe.call(e,t)})))}:fd,un=gt?function(e){for(var t=[];e;)kt(t,cn(e)),e=je(e);return t}:fd,hn=Cr;function ln(e,t,i){for(var r=-1,a=(t=ga(t,e)).length,n=!1;++r<a;){var s=Vn(t[r]);if(!(n=null!=e&&i(e,s)))break;e=e[s]}return n||++r!=a?n:!!(a=null==e?0:e.length)&&Js(a)&&gn(s,a)&&(Gs(e)||Fs(e))}function pn(e){return"function"!=typeof e.constructor||_n(e)?{}:Wi(je(e))}function fn(e){return Gs(e)||Fs(e)||!!(Xe&&e&&e[Xe])}function gn(e,t){var i=typeof e;return!!(t=null==t?h:t)&&("number"==i||"symbol"!=i&&ve.test(e))&&e>-1&&e%1==0&&e<t}function mn(e,t,i){if(!Zs(i))return!1;var r=typeof t;return!!("number"==r?js(i)&&gn(t,i.length):"string"==r&&t in i)&&Ws(i[t],e)}function vn(e,t){if(Gs(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!so(e))||$.test(e)||!Z.test(e)||null!=t&&e in we(t)}function An(e){var t=rn(e),i=Li[t];if("function"!=typeof i||!(t in Fi.prototype))return!1;if(e===i)return!0;var r=tn(i);return!!r&&e===r[0]}(yi&&hn(new yi(new ArrayBuffer(1)))!=k||Ci&&hn(new Ci)!=C||bi&&hn(bi.resolve())!=E||wi&&hn(new wi)!=T||Ei&&hn(new Ei)!=D)&&(hn=function(e){var t=Cr(e),i=t==w?e.constructor:a,r=i?Nn(i):"";if(r)switch(r){case Mi:return k;case Di:return C;case Pi:return E;case ki:return T;case Oi:return D}return t});var Sn=Pe?Ys:gd;function _n(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||De)}function yn(e){return e==e&&!Zs(e)}function Cn(e,t){return function(i){return null!=i&&i[e]===t&&(t!==a||e in we(i))}}function bn(e,t,i){return t=gi(t===a?e.length-1:t,0),function(){for(var a=arguments,n=-1,s=gi(a.length-t,0),o=r(s);++n<s;)o[n]=a[t+n];n=-1;for(var d=r(t+1);++n<t;)d[n]=a[n];return d[t]=i(o),bt(e,this,d)}}function wn(e,t){return t.length<2?e:_r(e,$r(t,0,-1))}function En(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var Rn=Dn(Qr),Tn=ut||function(e,t){return ht.setTimeout(e,t)},In=Dn(Jr);function Mn(e,t,i){var r=t+"";return In(e,function(e,t){var i=t.length;if(!i)return e;var r=i-1;return t[r]=(i>1?"& ":"")+t[r],t=t.join(i>2?", ":" "),e.replace(ne,"{\n/* [wrapped with "+t+"] */\n")}(r,function(e,t){return Et(f,(function(i){var r="_."+i[0];t&i[1]&&!Mt(e,r)&&e.push(r)})),e.sort()}(function(e){var t=e.match(se);return t?t[1].split(oe):[]}(r),i)))}function Dn(e){var t=0,i=0;return function(){var r=vi(),n=16-(r-i);if(i=r,n>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(a,arguments)}}function Pn(e,t){var i=-1,r=e.length,n=r-1;for(t=t===a?r:t;++i<t;){var s=jr(i,n),o=e[s];e[s]=e[i],e[i]=o}return e.length=t,e}var kn,On,xn=(kn=ks((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ee,(function(e,i,r,a){t.push(r?a.replace(ue,"$1"):i||e)})),t}),(function(e){return 500===On.size&&On.clear(),e})),On=kn.cache,kn);function Vn(e){if("string"==typeof e||so(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Nn(e){if(null!=e){try{return ke.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ln(e){if(e instanceof Fi)return e.clone();var t=new Ui(e.__wrapped__,e.__chain__);return t.__actions__=Ea(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Wn=qr((function(e,t){return Ks(e)?dr(e,fr(t,1,Ks,!0)):[]})),Bn=qr((function(e,t){var i=Xn(t);return Ks(i)&&(i=a),Ks(e)?dr(e,fr(t,1,Ks,!0),nn(i,2)):[]})),Un=qr((function(e,t){var i=Xn(t);return Ks(i)&&(i=a),Ks(e)?dr(e,fr(t,1,Ks,!0),a,i):[]}));function Fn(e,t,i){var r=null==e?0:e.length;if(!r)return-1;var a=null==i?0:po(i);return a<0&&(a=gi(r+a,0)),Wt(e,nn(t,3),a)}function Gn(e,t,i){var r=null==e?0:e.length;if(!r)return-1;var n=r-1;return i!==a&&(n=po(i),n=i<0?gi(r+n,0):mi(n,r-1)),Wt(e,nn(t,3),n,!0)}function Hn(e){return null!=e&&e.length?fr(e,1):[]}function jn(e){return e&&e.length?e[0]:a}var Kn=qr((function(e){var t=Pt(e,pa);return t.length&&t[0]===e[0]?Rr(t):[]})),qn=qr((function(e){var t=Xn(e),i=Pt(e,pa);return t===Xn(i)?t=a:i.pop(),i.length&&i[0]===e[0]?Rr(i,nn(t,2)):[]})),zn=qr((function(e){var t=Xn(e),i=Pt(e,pa);return(t="function"==typeof t?t:a)&&i.pop(),i.length&&i[0]===e[0]?Rr(i,a,t):[]}));function Xn(e){var t=null==e?0:e.length;return t?e[t-1]:a}var Yn=qr(Qn);function Qn(e,t){return e&&e.length&&t&&t.length?Gr(e,t):e}var Jn=Za((function(e,t){var i=null==e?0:e.length,r=rr(e,t);return Hr(e,Pt(t,(function(e){return gn(e,i)?+e:e})).sort(Ca)),r}));function Zn(e){return null==e?e:_i.call(e)}var $n=qr((function(e){return sa(fr(e,1,Ks,!0))})),es=qr((function(e){var t=Xn(e);return Ks(t)&&(t=a),sa(fr(e,1,Ks,!0),nn(t,2))})),ts=qr((function(e){var t=Xn(e);return t="function"==typeof t?t:a,sa(fr(e,1,Ks,!0),a,t)}));function is(e){if(!e||!e.length)return[];var t=0;return e=It(e,(function(e){if(Ks(e))return t=gi(e.length,t),!0})),zt(t,(function(t){return Pt(e,Ht(t))}))}function rs(e,t){if(!e||!e.length)return[];var i=is(e);return null==t?i:Pt(i,(function(e){return bt(t,a,e)}))}var as=qr((function(e,t){return Ks(e)?dr(e,t):[]})),ns=qr((function(e){return ha(It(e,Ks))})),ss=qr((function(e){var t=Xn(e);return Ks(t)&&(t=a),ha(It(e,Ks),nn(t,2))})),os=qr((function(e){var t=Xn(e);return t="function"==typeof t?t:a,ha(It(e,Ks),a,t)})),ds=qr(is),cs=qr((function(e){var t=e.length,i=t>1?e[t-1]:a;return i="function"==typeof i?(e.pop(),i):a,rs(e,i)}));function us(e){var t=Li(e);return t.__chain__=!0,t}function hs(e,t){return t(e)}var ls=Za((function(e){var t=e.length,i=t?e[0]:0,r=this.__wrapped__,n=function(t){return rr(t,e)};return!(t>1||this.__actions__.length)&&r instanceof Fi&&gn(i)?((r=r.slice(i,+i+(t?1:0))).__actions__.push({func:hs,args:[n],thisArg:a}),new Ui(r,this.__chain__).thru((function(e){return t&&!e.length&&e.push(a),e}))):this.thru(n)})),ps=Ta((function(e,t,i){Oe.call(e,i)?++e[i]:ir(e,i,1)})),fs=xa(Fn),gs=xa(Gn);function ms(e,t){return(Gs(e)?Et:cr)(e,nn(t,3))}function vs(e,t){return(Gs(e)?Rt:ur)(e,nn(t,3))}var As=Ta((function(e,t,i){Oe.call(e,i)?e[i].push(t):ir(e,i,[t])})),Ss=qr((function(e,t,i){var a=-1,n="function"==typeof t,s=js(e)?r(e.length):[];return cr(e,(function(e){s[++a]=n?bt(t,e,i):Tr(e,t,i)})),s})),_s=Ta((function(e,t,i){ir(e,i,t)}));function ys(e,t){return(Gs(e)?Pt:Vr)(e,nn(t,3))}var Cs=Ta((function(e,t,i){e[i?0:1].push(t)}),(function(){return[[],[]]})),bs=qr((function(e,t){if(null==e)return[];var i=t.length;return i>1&&mn(e,t[0],t[1])?t=[]:i>2&&mn(t[0],t[1],t[2])&&(t=[t[0]]),Ur(e,fr(t,1),[])})),ws=ct||function(){return ht.Date.now()};function Es(e,t,i){return t=i?a:t,t=e&&null==t?e.length:t,za(e,c,a,a,a,a,t)}function Rs(e,t){var i;if("function"!=typeof t)throw new Te(n);return e=po(e),function(){return--e>0&&(i=t.apply(this,arguments)),e<=1&&(t=a),i}}var Ts=qr((function(e,t,i){var r=1;if(i.length){var a=si(i,an(Ts));r|=d}return za(e,r,t,i,a)})),Is=qr((function(e,t,i){var r=3;if(i.length){var a=si(i,an(Is));r|=d}return za(t,r,e,i,a)}));function Ms(e,t,i){var r,s,o,d,c,u,h=0,l=!1,p=!1,f=!0;if("function"!=typeof e)throw new Te(n);function g(t){var i=r,n=s;return r=s=a,h=t,d=e.apply(n,i)}function m(e){var i=e-u;return u===a||i>=t||i<0||p&&e-h>=o}function v(){var e=ws();if(m(e))return A(e);c=Tn(v,function(e){var i=t-(e-u);return p?mi(i,o-(e-h)):i}(e))}function A(e){return c=a,f&&r?g(e):(r=s=a,d)}function S(){var e=ws(),i=m(e);if(r=arguments,s=this,u=e,i){if(c===a)return function(e){return h=e,c=Tn(v,t),l?g(e):d}(u);if(p)return Aa(c),c=Tn(v,t),g(u)}return c===a&&(c=Tn(v,t)),d}return t=go(t)||0,Zs(i)&&(l=!!i.leading,o=(p="maxWait"in i)?gi(go(i.maxWait)||0,t):o,f="trailing"in i?!!i.trailing:f),S.cancel=function(){c!==a&&Aa(c),h=0,r=u=s=c=a},S.flush=function(){return c===a?d:A(ws())},S}var Ds=qr((function(e,t){return or(e,1,t)})),Ps=qr((function(e,t,i){return or(e,go(t)||0,i)}));function ks(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new Te(n);var i=function(){var r=arguments,a=t?t.apply(this,r):r[0],n=i.cache;if(n.has(a))return n.get(a);var s=e.apply(this,r);return i.cache=n.set(a,s)||n,s};return i.cache=new(ks.Cache||ji),i}function Os(e){if("function"!=typeof e)throw new Te(n);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}ks.Cache=ji;var xs=ma((function(e,t){var i=(t=1==t.length&&Gs(t[0])?Pt(t[0],Yt(nn())):Pt(fr(t,1),Yt(nn()))).length;return qr((function(r){for(var a=-1,n=mi(r.length,i);++a<n;)r[a]=t[a].call(this,r[a]);return bt(e,this,r)}))})),Vs=qr((function(e,t){var i=si(t,an(Vs));return za(e,d,a,t,i)})),Ns=qr((function(e,t){var i=si(t,an(Ns));return za(e,64,a,t,i)})),Ls=Za((function(e,t){return za(e,256,a,a,a,t)}));function Ws(e,t){return e===t||e!=e&&t!=t}var Bs=Ga(br),Us=Ga((function(e,t){return e>=t})),Fs=Ir(function(){return arguments}())?Ir:function(e){return $s(e)&&Oe.call(e,"callee")&&!qe.call(e,"callee")},Gs=r.isArray,Hs=vt?Yt(vt):function(e){return $s(e)&&Cr(e)==P};function js(e){return null!=e&&Js(e.length)&&!Ys(e)}function Ks(e){return $s(e)&&js(e)}var qs=mt||gd,zs=At?Yt(At):function(e){return $s(e)&&Cr(e)==A};function Xs(e){if(!$s(e))return!1;var t=Cr(e);return t==S||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!io(e)}function Ys(e){if(!Zs(e))return!1;var t=Cr(e);return t==_||t==y||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Qs(e){return"number"==typeof e&&e==po(e)}function Js(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=h}function Zs(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function $s(e){return null!=e&&"object"==typeof e}var eo=St?Yt(St):function(e){return $s(e)&&hn(e)==C};function to(e){return"number"==typeof e||$s(e)&&Cr(e)==b}function io(e){if(!$s(e)||Cr(e)!=w)return!1;var t=je(e);if(null===t)return!0;var i=Oe.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&ke.call(i)==Le}var ro=_t?Yt(_t):function(e){return $s(e)&&Cr(e)==R},ao=yt?Yt(yt):function(e){return $s(e)&&hn(e)==T};function no(e){return"string"==typeof e||!Gs(e)&&$s(e)&&Cr(e)==I}function so(e){return"symbol"==typeof e||$s(e)&&Cr(e)==M}var oo=Ct?Yt(Ct):function(e){return $s(e)&&Js(e.length)&&!!at[Cr(e)]},co=Ga(xr),uo=Ga((function(e,t){return e<=t}));function ho(e){if(!e)return[];if(js(e))return no(e)?ui(e):Ea(e);if(Ye&&e[Ye])return function(e){for(var t,i=[];!(t=e.next()).done;)i.push(t.value);return i}(e[Ye]());var t=hn(e);return(t==C?ai:t==T?oi:Bo)(e)}function lo(e){return e?(e=go(e))===u||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function po(e){var t=lo(e),i=t%1;return t==t?i?t-i:t:0}function fo(e){return e?ar(po(e),0,p):0}function go(e){if("number"==typeof e)return e;if(so(e))return l;if(Zs(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Zs(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Xt(e);var i=fe.test(e);return i||me.test(e)?dt(e.slice(2),i?2:8):pe.test(e)?l:+e}function mo(e){return Ra(e,Po(e))}function vo(e){return null==e?"":na(e)}var Ao=Ia((function(e,t){if(_n(t)||js(t))Ra(t,Do(t),e);else for(var i in t)Oe.call(t,i)&&Zi(e,i,t[i])})),So=Ia((function(e,t){Ra(t,Po(t),e)})),_o=Ia((function(e,t,i,r){Ra(t,Po(t),e,r)})),yo=Ia((function(e,t,i,r){Ra(t,Do(t),e,r)})),Co=Za(rr),bo=qr((function(e,t){e=we(e);var i=-1,r=t.length,n=r>2?t[2]:a;for(n&&mn(t[0],t[1],n)&&(r=1);++i<r;)for(var s=t[i],o=Po(s),d=-1,c=o.length;++d<c;){var u=o[d],h=e[u];(h===a||Ws(h,De[u])&&!Oe.call(e,u))&&(e[u]=s[u])}return e})),wo=qr((function(e){return e.push(a,Ya),bt(Oo,a,e)}));function Eo(e,t,i){var r=null==e?a:_r(e,t);return r===a?i:r}function Ro(e,t){return null!=e&&ln(e,t,Er)}var To=La((function(e,t,i){null!=t&&"function"!=typeof t.toString&&(t=Ne.call(t)),e[t]=i}),$o(id)),Io=La((function(e,t,i){null!=t&&"function"!=typeof t.toString&&(t=Ne.call(t)),Oe.call(e,t)?e[t].push(i):e[t]=[i]}),nn),Mo=qr(Tr);function Do(e){return js(e)?zi(e):Or(e)}function Po(e){return js(e)?zi(e,!0):function(e){if(!Zs(e))return function(e){var t=[];if(null!=e)for(var i in we(e))t.push(i);return t}(e);var t=_n(e),i=[];for(var r in e)("constructor"!=r||!t&&Oe.call(e,r))&&i.push(r);return i}(e)}var ko=Ia((function(e,t,i){Wr(e,t,i)})),Oo=Ia((function(e,t,i,r){Wr(e,t,i,r)})),xo=Za((function(e,t){var i={};if(null==e)return i;var r=!1;t=Pt(t,(function(t){return t=ga(t,e),r||(r=t.length>1),t})),Ra(e,en(e),i),r&&(i=nr(i,7,Qa));for(var a=t.length;a--;)oa(i,t[a]);return i})),Vo=Za((function(e,t){return null==e?{}:function(e,t){return Fr(e,t,(function(t,i){return Ro(e,i)}))}(e,t)}));function No(e,t){if(null==e)return{};var i=Pt(en(e),(function(e){return[e]}));return t=nn(t),Fr(e,i,(function(e,i){return t(e,i[0])}))}var Lo=qa(Do),Wo=qa(Po);function Bo(e){return null==e?[]:Qt(e,Do(e))}var Uo=ka((function(e,t,i){return t=t.toLowerCase(),e+(i?Fo(t):t)}));function Fo(e){return Yo(vo(e).toLowerCase())}function Go(e){return(e=vo(e))&&e.replace(Ae,ei).replace(Je,"")}var Ho=ka((function(e,t,i){return e+(i?"-":"")+t.toLowerCase()})),jo=ka((function(e,t,i){return e+(i?" ":"")+t.toLowerCase()})),Ko=Pa("toLowerCase"),qo=ka((function(e,t,i){return e+(i?"_":"")+t.toLowerCase()})),zo=ka((function(e,t,i){return e+(i?" ":"")+Yo(t)})),Xo=ka((function(e,t,i){return e+(i?" ":"")+t.toUpperCase()})),Yo=Pa("toUpperCase");function Qo(e,t,i){return e=vo(e),(t=i?a:t)===a?function(e){return tt.test(e)}(e)?function(e){return e.match($e)||[]}(e):function(e){return e.match(de)||[]}(e):e.match(t)||[]}var Jo=qr((function(e,t){try{return bt(e,a,t)}catch(e){return Xs(e)?e:new ye(e)}})),Zo=Za((function(e,t){return Et(t,(function(t){t=Vn(t),ir(e,t,Ts(e[t],e))})),e}));function $o(e){return function(){return e}}var ed=Va(),td=Va(!0);function id(e){return e}function rd(e){return kr("function"==typeof e?e:nr(e,1))}var ad=qr((function(e,t){return function(i){return Tr(i,e,t)}})),nd=qr((function(e,t){return function(i){return Tr(e,i,t)}}));function sd(e,t,i){var r=Do(t),a=Sr(t,r);null!=i||Zs(t)&&(a.length||!r.length)||(i=t,t=e,e=this,a=Sr(t,Do(t)));var n=!(Zs(i)&&"chain"in i&&!i.chain),s=Ys(e);return Et(a,(function(i){var r=t[i];e[i]=r,s&&(e.prototype[i]=function(){var t=this.__chain__;if(n||t){var i=e(this.__wrapped__);return(i.__actions__=Ea(this.__actions__)).push({func:r,args:arguments,thisArg:e}),i.__chain__=t,i}return r.apply(e,kt([this.value()],arguments))})})),e}function od(){}var dd=Ba(Pt),cd=Ba(Tt),ud=Ba(Vt);function hd(e){return vn(e)?Ht(Vn(e)):function(e){return function(t){return _r(t,e)}}(e)}var ld=Fa(),pd=Fa(!0);function fd(){return[]}function gd(){return!1}var md,vd=Wa((function(e,t){return e+t}),0),Ad=ja("ceil"),Sd=Wa((function(e,t){return e/t}),1),_d=ja("floor"),yd=Wa((function(e,t){return e*t}),1),Cd=ja("round"),bd=Wa((function(e,t){return e-t}),0);return Li.after=function(e,t){if("function"!=typeof t)throw new Te(n);return e=po(e),function(){if(--e<1)return t.apply(this,arguments)}},Li.ary=Es,Li.assign=Ao,Li.assignIn=So,Li.assignInWith=_o,Li.assignWith=yo,Li.at=Co,Li.before=Rs,Li.bind=Ts,Li.bindAll=Zo,Li.bindKey=Is,Li.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Gs(e)?e:[e]},Li.chain=us,Li.chunk=function(e,t,i){t=(i?mn(e,t,i):t===a)?1:gi(po(t),0);var n=null==e?0:e.length;if(!n||t<1)return[];for(var s=0,o=0,d=r(lt(n/t));s<n;)d[o++]=$r(e,s,s+=t);return d},Li.compact=function(e){for(var t=-1,i=null==e?0:e.length,r=0,a=[];++t<i;){var n=e[t];n&&(a[r++]=n)}return a},Li.concat=function(){var e=arguments.length;if(!e)return[];for(var t=r(e-1),i=arguments[0],a=e;a--;)t[a-1]=arguments[a];return kt(Gs(i)?Ea(i):[i],fr(t,1))},Li.cond=function(e){var t=null==e?0:e.length,i=nn();return e=t?Pt(e,(function(e){if("function"!=typeof e[1])throw new Te(n);return[i(e[0]),e[1]]})):[],qr((function(i){for(var r=-1;++r<t;){var a=e[r];if(bt(a[0],this,i))return bt(a[1],this,i)}}))},Li.conforms=function(e){return function(e){var t=Do(e);return function(i){return sr(i,e,t)}}(nr(e,1))},Li.constant=$o,Li.countBy=ps,Li.create=function(e,t){var i=Wi(e);return null==t?i:tr(i,t)},Li.curry=function e(t,i,r){var n=za(t,8,a,a,a,a,a,i=r?a:i);return n.placeholder=e.placeholder,n},Li.curryRight=function e(t,i,r){var n=za(t,16,a,a,a,a,a,i=r?a:i);return n.placeholder=e.placeholder,n},Li.debounce=Ms,Li.defaults=bo,Li.defaultsDeep=wo,Li.defer=Ds,Li.delay=Ps,Li.difference=Wn,Li.differenceBy=Bn,Li.differenceWith=Un,Li.drop=function(e,t,i){var r=null==e?0:e.length;return r?$r(e,(t=i||t===a?1:po(t))<0?0:t,r):[]},Li.dropRight=function(e,t,i){var r=null==e?0:e.length;return r?$r(e,0,(t=r-(t=i||t===a?1:po(t)))<0?0:t):[]},Li.dropRightWhile=function(e,t){return e&&e.length?ca(e,nn(t,3),!0,!0):[]},Li.dropWhile=function(e,t){return e&&e.length?ca(e,nn(t,3),!0):[]},Li.fill=function(e,t,i,r){var n=null==e?0:e.length;return n?(i&&"number"!=typeof i&&mn(e,t,i)&&(i=0,r=n),function(e,t,i,r){var n=e.length;for((i=po(i))<0&&(i=-i>n?0:n+i),(r=r===a||r>n?n:po(r))<0&&(r+=n),r=i>r?0:fo(r);i<r;)e[i++]=t;return e}(e,t,i,r)):[]},Li.filter=function(e,t){return(Gs(e)?It:pr)(e,nn(t,3))},Li.flatMap=function(e,t){return fr(ys(e,t),1)},Li.flatMapDeep=function(e,t){return fr(ys(e,t),u)},Li.flatMapDepth=function(e,t,i){return i=i===a?1:po(i),fr(ys(e,t),i)},Li.flatten=Hn,Li.flattenDeep=function(e){return null!=e&&e.length?fr(e,u):[]},Li.flattenDepth=function(e,t){return null!=e&&e.length?fr(e,t=t===a?1:po(t)):[]},Li.flip=function(e){return za(e,512)},Li.flow=ed,Li.flowRight=td,Li.fromPairs=function(e){for(var t=-1,i=null==e?0:e.length,r={};++t<i;){var a=e[t];r[a[0]]=a[1]}return r},Li.functions=function(e){return null==e?[]:Sr(e,Do(e))},Li.functionsIn=function(e){return null==e?[]:Sr(e,Po(e))},Li.groupBy=As,Li.initial=function(e){return null!=e&&e.length?$r(e,0,-1):[]},Li.intersection=Kn,Li.intersectionBy=qn,Li.intersectionWith=zn,Li.invert=To,Li.invertBy=Io,Li.invokeMap=Ss,Li.iteratee=rd,Li.keyBy=_s,Li.keys=Do,Li.keysIn=Po,Li.map=ys,Li.mapKeys=function(e,t){var i={};return t=nn(t,3),vr(e,(function(e,r,a){ir(i,t(e,r,a),e)})),i},Li.mapValues=function(e,t){var i={};return t=nn(t,3),vr(e,(function(e,r,a){ir(i,r,t(e,r,a))})),i},Li.matches=function(e){return Nr(nr(e,1))},Li.matchesProperty=function(e,t){return Lr(e,nr(t,1))},Li.memoize=ks,Li.merge=ko,Li.mergeWith=Oo,Li.method=ad,Li.methodOf=nd,Li.mixin=sd,Li.negate=Os,Li.nthArg=function(e){return e=po(e),qr((function(t){return Br(t,e)}))},Li.omit=xo,Li.omitBy=function(e,t){return No(e,Os(nn(t)))},Li.once=function(e){return Rs(2,e)},Li.orderBy=function(e,t,i,r){return null==e?[]:(Gs(t)||(t=null==t?[]:[t]),Gs(i=r?a:i)||(i=null==i?[]:[i]),Ur(e,t,i))},Li.over=dd,Li.overArgs=xs,Li.overEvery=cd,Li.overSome=ud,Li.partial=Vs,Li.partialRight=Ns,Li.partition=Cs,Li.pick=Vo,Li.pickBy=No,Li.property=hd,Li.propertyOf=function(e){return function(t){return null==e?a:_r(e,t)}},Li.pull=Yn,Li.pullAll=Qn,Li.pullAllBy=function(e,t,i){return e&&e.length&&t&&t.length?Gr(e,t,nn(i,2)):e},Li.pullAllWith=function(e,t,i){return e&&e.length&&t&&t.length?Gr(e,t,a,i):e},Li.pullAt=Jn,Li.range=ld,Li.rangeRight=pd,Li.rearg=Ls,Li.reject=function(e,t){return(Gs(e)?It:pr)(e,Os(nn(t,3)))},Li.remove=function(e,t){var i=[];if(!e||!e.length)return i;var r=-1,a=[],n=e.length;for(t=nn(t,3);++r<n;){var s=e[r];t(s,r,e)&&(i.push(s),a.push(r))}return Hr(e,a),i},Li.rest=function(e,t){if("function"!=typeof e)throw new Te(n);return qr(e,t=t===a?t:po(t))},Li.reverse=Zn,Li.sampleSize=function(e,t,i){return t=(i?mn(e,t,i):t===a)?1:po(t),(Gs(e)?Yi:Xr)(e,t)},Li.set=function(e,t,i){return null==e?e:Yr(e,t,i)},Li.setWith=function(e,t,i,r){return r="function"==typeof r?r:a,null==e?e:Yr(e,t,i,r)},Li.shuffle=function(e){return(Gs(e)?Qi:Zr)(e)},Li.slice=function(e,t,i){var r=null==e?0:e.length;return r?(i&&"number"!=typeof i&&mn(e,t,i)?(t=0,i=r):(t=null==t?0:po(t),i=i===a?r:po(i)),$r(e,t,i)):[]},Li.sortBy=bs,Li.sortedUniq=function(e){return e&&e.length?ra(e):[]},Li.sortedUniqBy=function(e,t){return e&&e.length?ra(e,nn(t,2)):[]},Li.split=function(e,t,i){return i&&"number"!=typeof i&&mn(e,t,i)&&(t=i=a),(i=i===a?p:i>>>0)?(e=vo(e))&&("string"==typeof t||null!=t&&!ro(t))&&!(t=na(t))&&ri(e)?va(ui(e),0,i):e.split(t,i):[]},Li.spread=function(e,t){if("function"!=typeof e)throw new Te(n);return t=null==t?0:gi(po(t),0),qr((function(i){var r=i[t],a=va(i,0,t);return r&&kt(a,r),bt(e,this,a)}))},Li.tail=function(e){var t=null==e?0:e.length;return t?$r(e,1,t):[]},Li.take=function(e,t,i){return e&&e.length?$r(e,0,(t=i||t===a?1:po(t))<0?0:t):[]},Li.takeRight=function(e,t,i){var r=null==e?0:e.length;return r?$r(e,(t=r-(t=i||t===a?1:po(t)))<0?0:t,r):[]},Li.takeRightWhile=function(e,t){return e&&e.length?ca(e,nn(t,3),!1,!0):[]},Li.takeWhile=function(e,t){return e&&e.length?ca(e,nn(t,3)):[]},Li.tap=function(e,t){return t(e),e},Li.throttle=function(e,t,i){var r=!0,a=!0;if("function"!=typeof e)throw new Te(n);return Zs(i)&&(r="leading"in i?!!i.leading:r,a="trailing"in i?!!i.trailing:a),Ms(e,t,{leading:r,maxWait:t,trailing:a})},Li.thru=hs,Li.toArray=ho,Li.toPairs=Lo,Li.toPairsIn=Wo,Li.toPath=function(e){return Gs(e)?Pt(e,Vn):so(e)?[e]:Ea(xn(vo(e)))},Li.toPlainObject=mo,Li.transform=function(e,t,i){var r=Gs(e),a=r||qs(e)||oo(e);if(t=nn(t,4),null==i){var n=e&&e.constructor;i=a?r?new n:[]:Zs(e)&&Ys(n)?Wi(je(e)):{}}return(a?Et:vr)(e,(function(e,r,a){return t(i,e,r,a)})),i},Li.unary=function(e){return Es(e,1)},Li.union=$n,Li.unionBy=es,Li.unionWith=ts,Li.uniq=function(e){return e&&e.length?sa(e):[]},Li.uniqBy=function(e,t){return e&&e.length?sa(e,nn(t,2)):[]},Li.uniqWith=function(e,t){return t="function"==typeof t?t:a,e&&e.length?sa(e,a,t):[]},Li.unset=function(e,t){return null==e||oa(e,t)},Li.unzip=is,Li.unzipWith=rs,Li.update=function(e,t,i){return null==e?e:da(e,t,fa(i))},Li.updateWith=function(e,t,i,r){return r="function"==typeof r?r:a,null==e?e:da(e,t,fa(i),r)},Li.values=Bo,Li.valuesIn=function(e){return null==e?[]:Qt(e,Po(e))},Li.without=as,Li.words=Qo,Li.wrap=function(e,t){return Vs(fa(t),e)},Li.xor=ns,Li.xorBy=ss,Li.xorWith=os,Li.zip=ds,Li.zipObject=function(e,t){return la(e||[],t||[],Zi)},Li.zipObjectDeep=function(e,t){return la(e||[],t||[],Yr)},Li.zipWith=cs,Li.entries=Lo,Li.entriesIn=Wo,Li.extend=So,Li.extendWith=_o,sd(Li,Li),Li.add=vd,Li.attempt=Jo,Li.camelCase=Uo,Li.capitalize=Fo,Li.ceil=Ad,Li.clamp=function(e,t,i){return i===a&&(i=t,t=a),i!==a&&(i=(i=go(i))==i?i:0),t!==a&&(t=(t=go(t))==t?t:0),ar(go(e),t,i)},Li.clone=function(e){return nr(e,4)},Li.cloneDeep=function(e){return nr(e,5)},Li.cloneDeepWith=function(e,t){return nr(e,5,t="function"==typeof t?t:a)},Li.cloneWith=function(e,t){return nr(e,4,t="function"==typeof t?t:a)},Li.conformsTo=function(e,t){return null==t||sr(e,t,Do(t))},Li.deburr=Go,Li.defaultTo=function(e,t){return null==e||e!=e?t:e},Li.divide=Sd,Li.endsWith=function(e,t,i){e=vo(e),t=na(t);var r=e.length,n=i=i===a?r:ar(po(i),0,r);return(i-=t.length)>=0&&e.slice(i,n)==t},Li.eq=Ws,Li.escape=function(e){return(e=vo(e))&&X.test(e)?e.replace(q,ti):e},Li.escapeRegExp=function(e){return(e=vo(e))&&ie.test(e)?e.replace(te,"\\$&"):e},Li.every=function(e,t,i){var r=Gs(e)?Tt:hr;return i&&mn(e,t,i)&&(t=a),r(e,nn(t,3))},Li.find=fs,Li.findIndex=Fn,Li.findKey=function(e,t){return Lt(e,nn(t,3),vr)},Li.findLast=gs,Li.findLastIndex=Gn,Li.findLastKey=function(e,t){return Lt(e,nn(t,3),Ar)},Li.floor=_d,Li.forEach=ms,Li.forEachRight=vs,Li.forIn=function(e,t){return null==e?e:gr(e,nn(t,3),Po)},Li.forInRight=function(e,t){return null==e?e:mr(e,nn(t,3),Po)},Li.forOwn=function(e,t){return e&&vr(e,nn(t,3))},Li.forOwnRight=function(e,t){return e&&Ar(e,nn(t,3))},Li.get=Eo,Li.gt=Bs,Li.gte=Us,Li.has=function(e,t){return null!=e&&ln(e,t,wr)},Li.hasIn=Ro,Li.head=jn,Li.identity=id,Li.includes=function(e,t,i,r){e=js(e)?e:Bo(e),i=i&&!r?po(i):0;var a=e.length;return i<0&&(i=gi(a+i,0)),no(e)?i<=a&&e.indexOf(t,i)>-1:!!a&&Bt(e,t,i)>-1},Li.indexOf=function(e,t,i){var r=null==e?0:e.length;if(!r)return-1;var a=null==i?0:po(i);return a<0&&(a=gi(r+a,0)),Bt(e,t,a)},Li.inRange=function(e,t,i){return t=lo(t),i===a?(i=t,t=0):i=lo(i),function(e,t,i){return e>=mi(t,i)&&e<gi(t,i)}(e=go(e),t,i)},Li.invoke=Mo,Li.isArguments=Fs,Li.isArray=Gs,Li.isArrayBuffer=Hs,Li.isArrayLike=js,Li.isArrayLikeObject=Ks,Li.isBoolean=function(e){return!0===e||!1===e||$s(e)&&Cr(e)==v},Li.isBuffer=qs,Li.isDate=zs,Li.isElement=function(e){return $s(e)&&1===e.nodeType&&!io(e)},Li.isEmpty=function(e){if(null==e)return!0;if(js(e)&&(Gs(e)||"string"==typeof e||"function"==typeof e.splice||qs(e)||oo(e)||Fs(e)))return!e.length;var t=hn(e);if(t==C||t==T)return!e.size;if(_n(e))return!Or(e).length;for(var i in e)if(Oe.call(e,i))return!1;return!0},Li.isEqual=function(e,t){return Mr(e,t)},Li.isEqualWith=function(e,t,i){var r=(i="function"==typeof i?i:a)?i(e,t):a;return r===a?Mr(e,t,a,i):!!r},Li.isError=Xs,Li.isFinite=function(e){return"number"==typeof e&&Nt(e)},Li.isFunction=Ys,Li.isInteger=Qs,Li.isLength=Js,Li.isMap=eo,Li.isMatch=function(e,t){return e===t||Dr(e,t,on(t))},Li.isMatchWith=function(e,t,i){return i="function"==typeof i?i:a,Dr(e,t,on(t),i)},Li.isNaN=function(e){return to(e)&&e!=+e},Li.isNative=function(e){if(Sn(e))throw new ye("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Pr(e)},Li.isNil=function(e){return null==e},Li.isNull=function(e){return null===e},Li.isNumber=to,Li.isObject=Zs,Li.isObjectLike=$s,Li.isPlainObject=io,Li.isRegExp=ro,Li.isSafeInteger=function(e){return Qs(e)&&e>=-9007199254740991&&e<=h},Li.isSet=ao,Li.isString=no,Li.isSymbol=so,Li.isTypedArray=oo,Li.isUndefined=function(e){return e===a},Li.isWeakMap=function(e){return $s(e)&&hn(e)==D},Li.isWeakSet=function(e){return $s(e)&&"[object WeakSet]"==Cr(e)},Li.join=function(e,t){return null==e?"":jt.call(e,t)},Li.kebabCase=Ho,Li.last=Xn,Li.lastIndexOf=function(e,t,i){var r=null==e?0:e.length;if(!r)return-1;var n=r;return i!==a&&(n=(n=po(i))<0?gi(r+n,0):mi(n,r-1)),t==t?function(e,t,i){for(var r=i+1;r--;)if(e[r]===t)return r;return r}(e,t,n):Wt(e,Ft,n,!0)},Li.lowerCase=jo,Li.lowerFirst=Ko,Li.lt=co,Li.lte=uo,Li.max=function(e){return e&&e.length?lr(e,id,br):a},Li.maxBy=function(e,t){return e&&e.length?lr(e,nn(t,2),br):a},Li.mean=function(e){return Gt(e,id)},Li.meanBy=function(e,t){return Gt(e,nn(t,2))},Li.min=function(e){return e&&e.length?lr(e,id,xr):a},Li.minBy=function(e,t){return e&&e.length?lr(e,nn(t,2),xr):a},Li.stubArray=fd,Li.stubFalse=gd,Li.stubObject=function(){return{}},Li.stubString=function(){return""},Li.stubTrue=function(){return!0},Li.multiply=yd,Li.nth=function(e,t){return e&&e.length?Br(e,po(t)):a},Li.noConflict=function(){return ht._===this&&(ht._=We),this},Li.noop=od,Li.now=ws,Li.pad=function(e,t,i){e=vo(e);var r=(t=po(t))?ci(e):0;if(!t||r>=t)return e;var a=(t-r)/2;return Ua(pt(a),i)+e+Ua(lt(a),i)},Li.padEnd=function(e,t,i){e=vo(e);var r=(t=po(t))?ci(e):0;return t&&r<t?e+Ua(t-r,i):e},Li.padStart=function(e,t,i){e=vo(e);var r=(t=po(t))?ci(e):0;return t&&r<t?Ua(t-r,i)+e:e},Li.parseInt=function(e,t,i){return i||null==t?t=0:t&&(t=+t),Ai(vo(e).replace(re,""),t||0)},Li.random=function(e,t,i){if(i&&"boolean"!=typeof i&&mn(e,t,i)&&(t=i=a),i===a&&("boolean"==typeof t?(i=t,t=a):"boolean"==typeof e&&(i=e,e=a)),e===a&&t===a?(e=0,t=1):(e=lo(e),t===a?(t=e,e=0):t=lo(t)),e>t){var r=e;e=t,t=r}if(i||e%1||t%1){var n=Si();return mi(e+n*(t-e+ot("1e-"+((n+"").length-1))),t)}return jr(e,t)},Li.reduce=function(e,t,i){var r=Gs(e)?Ot:Kt,a=arguments.length<3;return r(e,nn(t,4),i,a,cr)},Li.reduceRight=function(e,t,i){var r=Gs(e)?xt:Kt,a=arguments.length<3;return r(e,nn(t,4),i,a,ur)},Li.repeat=function(e,t,i){return t=(i?mn(e,t,i):t===a)?1:po(t),Kr(vo(e),t)},Li.replace=function(){var e=arguments,t=vo(e[0]);return e.length<3?t:t.replace(e[1],e[2])},Li.result=function(e,t,i){var r=-1,n=(t=ga(t,e)).length;for(n||(n=1,e=a);++r<n;){var s=null==e?a:e[Vn(t[r])];s===a&&(r=n,s=i),e=Ys(s)?s.call(e):s}return e},Li.round=Cd,Li.runInContext=e,Li.sample=function(e){return(Gs(e)?Xi:zr)(e)},Li.size=function(e){if(null==e)return 0;if(js(e))return no(e)?ci(e):e.length;var t=hn(e);return t==C||t==T?e.size:Or(e).length},Li.snakeCase=qo,Li.some=function(e,t,i){var r=Gs(e)?Vt:ea;return i&&mn(e,t,i)&&(t=a),r(e,nn(t,3))},Li.sortedIndex=function(e,t){return ta(e,t)},Li.sortedIndexBy=function(e,t,i){return ia(e,t,nn(i,2))},Li.sortedIndexOf=function(e,t){var i=null==e?0:e.length;if(i){var r=ta(e,t);if(r<i&&Ws(e[r],t))return r}return-1},Li.sortedLastIndex=function(e,t){return ta(e,t,!0)},Li.sortedLastIndexBy=function(e,t,i){return ia(e,t,nn(i,2),!0)},Li.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var i=ta(e,t,!0)-1;if(Ws(e[i],t))return i}return-1},Li.startCase=zo,Li.startsWith=function(e,t,i){return e=vo(e),i=null==i?0:ar(po(i),0,e.length),t=na(t),e.slice(i,i+t.length)==t},Li.subtract=bd,Li.sum=function(e){return e&&e.length?qt(e,id):0},Li.sumBy=function(e,t){return e&&e.length?qt(e,nn(t,2)):0},Li.template=function(e,t,i){var r=Li.templateSettings;i&&mn(e,t,i)&&(t=a),e=vo(e),t=_o({},t,r,Xa);var n,s,o=_o({},t.imports,r.imports,Xa),d=Do(o),c=Qt(o,d),u=0,h=t.interpolate||Se,l="__p += '",p=Ee((t.escape||Se).source+"|"+h.source+"|"+(h===J?he:Se).source+"|"+(t.evaluate||Se).source+"|$","g"),f="//# sourceURL="+(Oe.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++rt+"]")+"\n";e.replace(p,(function(t,i,r,a,o,d){return r||(r=a),l+=e.slice(u,d).replace(_e,ii),i&&(n=!0,l+="' +\n__e("+i+") +\n'"),o&&(s=!0,l+="';\n"+o+";\n__p += '"),r&&(l+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=d+t.length,t})),l+="';\n";var g=Oe.call(t,"variable")&&t.variable;if(g){if(ce.test(g))throw new ye("Invalid `variable` option passed into `_.template`")}else l="with (obj) {\n"+l+"\n}\n";l=(s?l.replace(G,""):l).replace(H,"$1").replace(j,"$1;"),l="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(n?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+l+"return __p\n}";var m=Jo((function(){return Ce(d,f+"return "+l).apply(a,c)}));if(m.source=l,Xs(m))throw m;return m},Li.times=function(e,t){if((e=po(e))<1||e>h)return[];var i=p,r=mi(e,p);t=nn(t),e-=p;for(var a=zt(r,t);++i<e;)t(i);return a},Li.toFinite=lo,Li.toInteger=po,Li.toLength=fo,Li.toLower=function(e){return vo(e).toLowerCase()},Li.toNumber=go,Li.toSafeInteger=function(e){return e?ar(po(e),-9007199254740991,h):0===e?e:0},Li.toString=vo,Li.toUpper=function(e){return vo(e).toUpperCase()},Li.trim=function(e,t,i){if((e=vo(e))&&(i||t===a))return Xt(e);if(!e||!(t=na(t)))return e;var r=ui(e),n=ui(t);return va(r,Zt(r,n),$t(r,n)+1).join("")},Li.trimEnd=function(e,t,i){if((e=vo(e))&&(i||t===a))return e.slice(0,hi(e)+1);if(!e||!(t=na(t)))return e;var r=ui(e);return va(r,0,$t(r,ui(t))+1).join("")},Li.trimStart=function(e,t,i){if((e=vo(e))&&(i||t===a))return e.replace(re,"");if(!e||!(t=na(t)))return e;var r=ui(e);return va(r,Zt(r,ui(t))).join("")},Li.truncate=function(e,t){var i=30,r="...";if(Zs(t)){var n="separator"in t?t.separator:n;i="length"in t?po(t.length):i,r="omission"in t?na(t.omission):r}var s=(e=vo(e)).length;if(ri(e)){var o=ui(e);s=o.length}if(i>=s)return e;var d=i-ci(r);if(d<1)return r;var c=o?va(o,0,d).join(""):e.slice(0,d);if(n===a)return c+r;if(o&&(d+=c.length-d),ro(n)){if(e.slice(d).search(n)){var u,h=c;for(n.global||(n=Ee(n.source,vo(le.exec(n))+"g")),n.lastIndex=0;u=n.exec(h);)var l=u.index;c=c.slice(0,l===a?d:l)}}else if(e.indexOf(na(n),d)!=d){var p=c.lastIndexOf(n);p>-1&&(c=c.slice(0,p))}return c+r},Li.unescape=function(e){return(e=vo(e))&&z.test(e)?e.replace(K,li):e},Li.uniqueId=function(e){var t=++xe;return vo(e)+t},Li.upperCase=Xo,Li.upperFirst=Yo,Li.each=ms,Li.eachRight=vs,Li.first=jn,sd(Li,(md={},vr(Li,(function(e,t){Oe.call(Li.prototype,t)||(md[t]=e)})),md),{chain:!1}),Li.VERSION="4.17.21",Et(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){Li[e].placeholder=Li})),Et(["drop","take"],(function(e,t){Fi.prototype[e]=function(i){i=i===a?1:gi(po(i),0);var r=this.__filtered__&&!t?new Fi(this):this.clone();return r.__filtered__?r.__takeCount__=mi(i,r.__takeCount__):r.__views__.push({size:mi(i,p),type:e+(r.__dir__<0?"Right":"")}),r},Fi.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),Et(["filter","map","takeWhile"],(function(e,t){var i=t+1,r=1==i||3==i;Fi.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:nn(e,3),type:i}),t.__filtered__=t.__filtered__||r,t}})),Et(["head","last"],(function(e,t){var i="take"+(t?"Right":"");Fi.prototype[e]=function(){return this[i](1).value()[0]}})),Et(["initial","tail"],(function(e,t){var i="drop"+(t?"":"Right");Fi.prototype[e]=function(){return this.__filtered__?new Fi(this):this[i](1)}})),Fi.prototype.compact=function(){return this.filter(id)},Fi.prototype.find=function(e){return this.filter(e).head()},Fi.prototype.findLast=function(e){return this.reverse().find(e)},Fi.prototype.invokeMap=qr((function(e,t){return"function"==typeof e?new Fi(this):this.map((function(i){return Tr(i,e,t)}))})),Fi.prototype.reject=function(e){return this.filter(Os(nn(e)))},Fi.prototype.slice=function(e,t){e=po(e);var i=this;return i.__filtered__&&(e>0||t<0)?new Fi(i):(e<0?i=i.takeRight(-e):e&&(i=i.drop(e)),t!==a&&(i=(t=po(t))<0?i.dropRight(-t):i.take(t-e)),i)},Fi.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Fi.prototype.toArray=function(){return this.take(p)},vr(Fi.prototype,(function(e,t){var i=/^(?:filter|find|map|reject)|While$/.test(t),r=/^(?:head|last)$/.test(t),n=Li[r?"take"+("last"==t?"Right":""):t],s=r||/^find/.test(t);n&&(Li.prototype[t]=function(){var t=this.__wrapped__,o=r?[1]:arguments,d=t instanceof Fi,c=o[0],u=d||Gs(t),h=function(e){var t=n.apply(Li,kt([e],o));return r&&l?t[0]:t};u&&i&&"function"==typeof c&&1!=c.length&&(d=u=!1);var l=this.__chain__,p=!!this.__actions__.length,f=s&&!l,g=d&&!p;if(!s&&u){t=g?t:new Fi(this);var m=e.apply(t,o);return m.__actions__.push({func:hs,args:[h],thisArg:a}),new Ui(m,l)}return f&&g?e.apply(this,o):(m=this.thru(h),f?r?m.value()[0]:m.value():m)})})),Et(["pop","push","shift","sort","splice","unshift"],(function(e){var t=Ie[e],i=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);Li.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var a=this.value();return t.apply(Gs(a)?a:[],e)}return this[i]((function(i){return t.apply(Gs(i)?i:[],e)}))}})),vr(Fi.prototype,(function(e,t){var i=Li[t];if(i){var r=i.name+"";Oe.call(Ii,r)||(Ii[r]=[]),Ii[r].push({name:t,func:i})}})),Ii[Na(a,2).name]=[{name:"wrapper",func:a}],Fi.prototype.clone=function(){var e=new Fi(this.__wrapped__);return e.__actions__=Ea(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Ea(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Ea(this.__views__),e},Fi.prototype.reverse=function(){if(this.__filtered__){var e=new Fi(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Fi.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,i=Gs(e),r=t<0,a=i?e.length:0,n=function(e,t,i){for(var r=-1,a=i.length;++r<a;){var n=i[r],s=n.size;switch(n.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=mi(t,e+s);break;case"takeRight":e=gi(e,t-s)}}return{start:e,end:t}}(0,a,this.__views__),s=n.start,o=n.end,d=o-s,c=r?o:s-1,u=this.__iteratees__,h=u.length,l=0,p=mi(d,this.__takeCount__);if(!i||!r&&a==d&&p==d)return ua(e,this.__actions__);var f=[];e:for(;d--&&l<p;){for(var g=-1,m=e[c+=t];++g<h;){var v=u[g],A=v.iteratee,S=v.type,_=A(m);if(2==S)m=_;else if(!_){if(1==S)continue e;break e}}f[l++]=m}return f},Li.prototype.at=ls,Li.prototype.chain=function(){return us(this)},Li.prototype.commit=function(){return new Ui(this.value(),this.__chain__)},Li.prototype.next=function(){this.__values__===a&&(this.__values__=ho(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?a:this.__values__[this.__index__++]}},Li.prototype.plant=function(e){for(var t,i=this;i instanceof Bi;){var r=Ln(i);r.__index__=0,r.__values__=a,t?n.__wrapped__=r:t=r;var n=r;i=i.__wrapped__}return n.__wrapped__=e,t},Li.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Fi){var t=e;return this.__actions__.length&&(t=new Fi(this)),(t=t.reverse()).__actions__.push({func:hs,args:[Zn],thisArg:a}),new Ui(t,this.__chain__)}return this.thru(Zn)},Li.prototype.toJSON=Li.prototype.valueOf=Li.prototype.value=function(){return ua(this.__wrapped__,this.__actions__)},Li.prototype.first=Li.prototype.head,Ye&&(Li.prototype[Ye]=function(){return this}),Li}();ht._=pi,(r=function(){return pi}.call(t,i,t,e))===a||(e.exports=r)}.call(this)},124:(e,t,i)=>{var r=i(9325);e.exports=function(){return r.Date.now()}},9935:e=>{e.exports=function(){return!1}},7350:(e,t,i)=>{var r=i(8221),a=i(3805);e.exports=function(e,t,i){var n=!0,s=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return a(i)&&(n="leading"in i?!!i.leading:n,s="trailing"in i?!!i.trailing:s),r(e,t,{leading:n,maxWait:t,trailing:s})}},9374:(e,t,i)=>{var r=i(4128),a=i(3805),n=i(4394),s=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,d=/^0o[0-7]+$/i,c=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(n(e))return NaN;if(a(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=a(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=r(e);var i=o.test(e);return i||d.test(e)?c(e.slice(2),i?2:8):s.test(e)?NaN:+e}},3224:function(e,t,i){e=i.nmd(e),function(i){"use strict";var r={};i.PubSub?(r=i.PubSub,console.warn("PubSub already loaded, using existing version")):(i.PubSub=r,function(e){var t={},i=-1;function r(e,t,i){try{e(t,i)}catch(e){setTimeout(function(e){return function(){throw e}}(e),0)}}function a(e,t,i){e(t,i)}function n(e,i,n,s){var o,d=t[i],c=s?a:r;if(Object.prototype.hasOwnProperty.call(t,i))for(o in d)Object.prototype.hasOwnProperty.call(d,o)&&c(d[o],e,n)}function s(e){var i=String(e);return Boolean(Object.prototype.hasOwnProperty.call(t,i)&&function(e){var t;for(t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!0;return!1}(t[i]))}function o(e,t,i,r){var a=function(e,t,i){return function(){var r=String(e),a=r.lastIndexOf(".");for(n(e,e,t,i);-1!==a;)a=(r=r.substr(0,a)).lastIndexOf("."),n(e,r,t,i);n(e,"*",t,i)}}(e="symbol"==typeof e?e.toString():e,t,r);return!!function(e){for(var t=String(e),i=s(t)||s("*"),r=t.lastIndexOf(".");!i&&-1!==r;)r=(t=t.substr(0,r)).lastIndexOf("."),i=s(t);return i}(e)&&(!0===i?a():setTimeout(a,0),!0)}e.publish=function(t,i){return o(t,i,!1,e.immediateExceptions)},e.publishSync=function(t,i){return o(t,i,!0,e.immediateExceptions)},e.subscribe=function(e,r){if("function"!=typeof r)return!1;e="symbol"==typeof e?e.toString():e,Object.prototype.hasOwnProperty.call(t,e)||(t[e]={});var a="uid_"+String(++i);return t[e][a]=r,a},e.subscribeAll=function(t){return e.subscribe("*",t)},e.subscribeOnce=function(t,i){var r=e.subscribe(t,(function(){e.unsubscribe(r),i.apply(this,arguments)}));return e},e.clearAllSubscriptions=function(){t={}},e.clearSubscriptions=function(e){var i;for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&0===i.indexOf(e)&&delete t[i]},e.countSubscriptions=function(e){var i,r,a=0;for(i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&0===i.indexOf(e)){for(r in t[i])a++;break}return a},e.getSubscriptions=function(e){var i,r=[];for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&0===i.indexOf(e)&&r.push(i);return r},e.unsubscribe=function(i){var r,a,n,s="string"==typeof i&&(Object.prototype.hasOwnProperty.call(t,i)||function(e){var i;for(i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&0===i.indexOf(e))return!0;return!1}(i)),o=!s&&"string"==typeof i,d="function"==typeof i,c=!1;if(!s){for(r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(a=t[r],o&&a[i]){delete a[i],c=i;break}if(d)for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&a[n]===i&&(delete a[n],c=!0)}return c}e.clearSubscriptions(i)}}(r)),void 0!==e&&e.exports&&(t=e.exports=r),t.PubSub=r,e.exports=t=r}("object"==typeof window&&window||this||i.g)},7232:function(e,t,i){var r;!function(a,n){"use strict";var s="function",o="undefined",d="object",c="string",u="major",h="model",l="name",p="type",f="vendor",g="version",m="architecture",v="console",A="mobile",S="tablet",_="smarttv",y="wearable",C="embedded",b="Amazon",w="Apple",E="ASUS",R="BlackBerry",T="Browser",I="Chrome",M="Firefox",D="Google",P="Huawei",k="LG",O="Microsoft",x="Motorola",V="Opera",N="Samsung",L="Sharp",W="Sony",B="Xiaomi",U="Zebra",F="Facebook",G="Chromium OS",H="Mac OS",j=function(e){for(var t={},i=0;i<e.length;i++)t[e[i].toUpperCase()]=e[i];return t},K=function(e,t){return typeof e===c&&-1!==q(t).indexOf(q(e))},q=function(e){return e.toLowerCase()},z=function(e,t){if(typeof e===c)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,500)},X=function(e,t){for(var i,r,a,o,c,u,h=0;h<t.length&&!c;){var l=t[h],p=t[h+1];for(i=r=0;i<l.length&&!c&&l[i];)if(c=l[i++].exec(e))for(a=0;a<p.length;a++)u=c[++r],typeof(o=p[a])===d&&o.length>0?2===o.length?typeof o[1]==s?this[o[0]]=o[1].call(this,u):this[o[0]]=o[1]:3===o.length?typeof o[1]!==s||o[1].exec&&o[1].test?this[o[0]]=u?u.replace(o[1],o[2]):n:this[o[0]]=u?o[1].call(this,u,o[2]):n:4===o.length&&(this[o[0]]=u?o[3].call(this,u.replace(o[1],o[2])):n):this[o]=u||n;h+=2}},Y=function(e,t){for(var i in t)if(typeof t[i]===d&&t[i].length>0){for(var r=0;r<t[i].length;r++)if(K(t[i][r],e))return"?"===i?n:i}else if(K(t[i],e))return"?"===i?n:i;return e},Q={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},J={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[l,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[l,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[l,g],[/opios[\/ ]+([\w\.]+)/i],[g,[l,V+" Mini"]],[/\bopr\/([\w\.]+)/i],[g,[l,V]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[g,[l,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[l,g],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[l,"UC"+T]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[g,[l,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[l,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[l,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[g,[l,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[g,[l,"Smart Lenovo "+T]],[/(avast|avg)\/([\w\.]+)/i],[[l,/(.+)/,"$1 Secure "+T],g],[/\bfocus\/([\w\.]+)/i],[g,[l,M+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[l,V+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[l,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[l,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[l,V+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[l,"MIUI "+T]],[/fxios\/([-\w\.]+)/i],[g,[l,M]],[/\bqihu|(qi?ho?o?|360)browser/i],[[l,"360 "+T]],[/(oculus|sailfish|huawei|vivo)browser\/([\w\.]+)/i],[[l,/(.+)/,"$1 "+T],g],[/samsungbrowser\/([\w\.]+)/i],[g,[l,N+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[l,/_/g," "],g],[/metasr[\/ ]?([\d\.]+)/i],[g,[l,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[l,"Sogou Mobile"],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[l,g],[/(lbbrowser)/i,/\[(linkedin)app\]/i],[l],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[l,F],g],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[l,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[l,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[g,[l,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[l,I+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[l,I+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[l,"Android "+T]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[l,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[l,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,l],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[l,[g,Y,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[l,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[l,"Netscape"],g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[l,M+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[l,g],[/(cobalt)\/([\w\.]+)/i],[l,[g,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,q]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[m,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[m,"armhf"]],[/windows (ce|mobile); ppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[m,/ower/,"",q]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[m,q]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[f,N],[p,S]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[h,[f,N],[p,A]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[h,[f,w],[p,A]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[f,w],[p,S]],[/(macintosh);/i],[h,[f,w]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[f,L],[p,A]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[f,P],[p,S]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[f,P],[p,A]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[h,/_/g," "],[f,B],[p,A]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[f,B],[p,S]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[f,"OPPO"],[p,A]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[f,"Vivo"],[p,A]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[h,[f,"Realme"],[p,A]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[f,x],[p,A]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[f,x],[p,S]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[f,k],[p,S]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[f,k],[p,A]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[f,"Lenovo"],[p,S]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[f,"Nokia"],[p,A]],[/(pixel c)\b/i],[h,[f,D],[p,S]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[f,D],[p,A]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[f,W],[p,A]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[f,W],[p,S]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[f,"OnePlus"],[p,A]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[f,b],[p,S]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[f,b],[p,A]],[/(playbook);[-\w\),; ]+(rim)/i],[h,f,[p,S]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[f,R],[p,A]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[f,E],[p,S]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[f,E],[p,A]],[/(nexus 9)/i],[h,[f,"HTC"],[p,S]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[f,[h,/_/g," "],[p,A]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[f,"Acer"],[p,S]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[f,"Meizu"],[p,A]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[h,[f,"Ulefone"],[p,A]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[f,h,[p,A]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[f,h,[p,S]],[/(surface duo)/i],[h,[f,O],[p,S]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[f,"Fairphone"],[p,A]],[/(u304aa)/i],[h,[f,"AT&T"],[p,A]],[/\bsie-(\w*)/i],[h,[f,"Siemens"],[p,A]],[/\b(rct\w+) b/i],[h,[f,"RCA"],[p,S]],[/\b(venue[\d ]{2,7}) b/i],[h,[f,"Dell"],[p,S]],[/\b(q(?:mv|ta)\w+) b/i],[h,[f,"Verizon"],[p,S]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[f,"Barnes & Noble"],[p,S]],[/\b(tm\d{3}\w+) b/i],[h,[f,"NuVision"],[p,S]],[/\b(k88) b/i],[h,[f,"ZTE"],[p,S]],[/\b(nx\d{3}j) b/i],[h,[f,"ZTE"],[p,A]],[/\b(gen\d{3}) b.+49h/i],[h,[f,"Swiss"],[p,A]],[/\b(zur\d{3}) b/i],[h,[f,"Swiss"],[p,S]],[/\b((zeki)?tb.*\b) b/i],[h,[f,"Zeki"],[p,S]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[f,"Dragon Touch"],h,[p,S]],[/\b(ns-?\w{0,9}) b/i],[h,[f,"Insignia"],[p,S]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[f,"NextBook"],[p,S]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[f,"Voice"],h,[p,A]],[/\b(lvtel\-)?(v1[12]) b/i],[[f,"LvTel"],h,[p,A]],[/\b(ph-1) /i],[h,[f,"Essential"],[p,A]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[f,"Envizen"],[p,S]],[/\b(trio[-\w\. ]+) b/i],[h,[f,"MachSpeed"],[p,S]],[/\btu_(1491) b/i],[h,[f,"Rotor"],[p,S]],[/(shield[\w ]+) b/i],[h,[f,"Nvidia"],[p,S]],[/(sprint) (\w+)/i],[f,h,[p,A]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[f,O],[p,A]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[f,U],[p,S]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[f,U],[p,A]],[/smart-tv.+(samsung)/i],[f,[p,_]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[f,N],[p,_]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[f,k],[p,_]],[/(apple) ?tv/i],[f,[h,w+" TV"],[p,_]],[/crkey/i],[[h,I+"cast"],[f,D],[p,_]],[/droid.+aft(\w+)( bui|\))/i],[h,[f,b],[p,_]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[f,L],[p,_]],[/(bravia[\w ]+)( bui|\))/i],[h,[f,W],[p,_]],[/(mitv-\w{5}) bui/i],[h,[f,B],[p,_]],[/Hbbtv.*(technisat) (.*);/i],[f,h,[p,_]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[f,z],[h,z],[p,_]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[p,_]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[f,h,[p,v]],[/droid.+; (shield) bui/i],[h,[f,"Nvidia"],[p,v]],[/(playstation [345portablevi]+)/i],[h,[f,W],[p,v]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[f,O],[p,v]],[/((pebble))app/i],[f,h,[p,y]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[f,w],[p,y]],[/droid.+; (glass) \d/i],[h,[f,D],[p,y]],[/droid.+; (wt63?0{2,3})\)/i],[h,[f,U],[p,y]],[/(quest( 2| pro)?)/i],[h,[f,F],[p,y]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[f,[p,C]],[/(aeobc)\b/i],[h,[f,b],[p,C]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[h,[p,A]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[p,S]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[p,S]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[p,A]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[f,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[l,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[l,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[l,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,l]],os:[[/microsoft (windows) (vista|xp)/i],[l,g],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[l,[g,Y,Q]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[g,Y,Q],[l,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[l,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[l,H],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,l],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[l,g],[/\(bb(10);/i],[g,[l,R]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[l,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[l,M+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[l,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[l,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[l,I+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[l,G],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[l,g],[/(sunos) ?([\w\.\d]*)/i],[[l,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[l,g]]},Z=function(e,t){if(typeof e===d&&(t=e,e=n),!(this instanceof Z))return new Z(e,t).getResult();var i=typeof a!==o&&a.navigator?a.navigator:n,r=e||(i&&i.userAgent?i.userAgent:""),v=i&&i.userAgentData?i.userAgentData:n,_=t?function(e,t){var i={};for(var r in e)t[r]&&t[r].length%2==0?i[r]=t[r].concat(e[r]):i[r]=e[r];return i}(J,t):J,y=i&&i.userAgent==r;return this.getBrowser=function(){var e,t={};return t[l]=n,t[g]=n,X.call(t,r,_.browser),t[u]=typeof(e=t[g])===c?e.replace(/[^\d\.]/g,"").split(".")[0]:n,y&&i&&i.brave&&typeof i.brave.isBrave==s&&(t[l]="Brave"),t},this.getCPU=function(){var e={};return e[m]=n,X.call(e,r,_.cpu),e},this.getDevice=function(){var e={};return e[f]=n,e[h]=n,e[p]=n,X.call(e,r,_.device),y&&!e[p]&&v&&v.mobile&&(e[p]=A),y&&"Macintosh"==e[h]&&i&&typeof i.standalone!==o&&i.maxTouchPoints&&i.maxTouchPoints>2&&(e[h]="iPad",e[p]=S),e},this.getEngine=function(){var e={};return e[l]=n,e[g]=n,X.call(e,r,_.engine),e},this.getOS=function(){var e={};return e[l]=n,e[g]=n,X.call(e,r,_.os),y&&!e[l]&&v&&"Unknown"!=v.platform&&(e[l]=v.platform.replace(/chrome os/i,G).replace(/macos/i,H)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r},this.setUA=function(e){return r=typeof e===c&&e.length>500?z(e,500):e,this},this.setUA(r),this};Z.VERSION="1.0.37",Z.BROWSER=j([l,g,u]),Z.CPU=j([m]),Z.DEVICE=j([h,f,p,v,A,_,S,y,C]),Z.ENGINE=Z.OS=j([l,g]),typeof t!==o?(e.exports&&(t=e.exports=Z),t.UAParser=Z):i.amdO?(r=function(){return Z}.call(t,i,t,e))===n||(e.exports=r):typeof a!==o&&(a.UAParser=Z);var $=typeof a!==o&&(a.jQuery||a.Zepto);if($&&!$.ua){var ee=new Z;$.ua=ee.getResult(),$.ua.get=function(){return ee.getUA()},$.ua.set=function(e){ee.setUA(e);var t=ee.getResult();for(var i in t)$.ua[i]=t[i]}}}("object"==typeof window?window:this)},31:(e,t)=>{!function(e){var t,i,r,a=String.fromCharCode;function n(e){for(var t,i,r=[],a=0,n=e.length;a<n;)(t=e.charCodeAt(a++))>=55296&&t<=56319&&a<n?56320==(64512&(i=e.charCodeAt(a++)))?r.push(((1023&t)<<10)+(1023&i)+65536):(r.push(t),a--):r.push(t);return r}function s(e){if(e>=55296&&e<=57343)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function o(e,t){return a(e>>t&63|128)}function d(e){if(!(4294967168&e))return a(e);var t="";return 4294965248&e?4294901760&e?4292870144&e||(t=a(e>>18&7|240),t+=o(e,12),t+=o(e,6)):(s(e),t=a(e>>12&15|224),t+=o(e,6)):t=a(e>>6&31|192),t+a(63&e|128)}function c(){if(r>=i)throw Error("Invalid byte index");var e=255&t[r];if(r++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function u(){var e,a;if(r>i)throw Error("Invalid byte index");if(r==i)return!1;if(e=255&t[r],r++,!(128&e))return e;if(192==(224&e)){if((a=(31&e)<<6|c())>=128)return a;throw Error("Invalid continuation byte")}if(224==(240&e)){if((a=(15&e)<<12|c()<<6|c())>=2048)return s(a),a;throw Error("Invalid continuation byte")}if(240==(248&e)&&(a=(7&e)<<18|c()<<12|c()<<6|c())>=65536&&a<=1114111)return a;throw Error("Invalid UTF-8 detected")}e.version="3.0.0",e.encode=function(e){for(var t=n(e),i=t.length,r=-1,a="";++r<i;)a+=d(t[r]);return a},e.decode=function(e){t=n(e),i=t.length,r=0;for(var s,o=[];!1!==(s=u());)o.push(s);return function(e){for(var t,i=e.length,r=-1,n="";++r<i;)(t=e[r])>65535&&(n+=a((t-=65536)>>>10&1023|55296),t=56320|1023&t),n+=a(t);return n}(o)}}(t)},6206:t=>{"use strict";t.exports=e},7855:(e,t,i)=>{e.exports=i(4106)},129:(e,t,i)=>{e.exports=i(1086)},1265:(e,t,i)=>{e.exports=i(4598)},6984:(e,t,i)=>{e.exports=i(9792)},7201:(e,t,i)=>{e.exports=i(3042)},7358:(e,t,i)=>{"use strict";var r=i(6343);e.exports=r},1829:(e,t,i)=>{"use strict";var r=i(2222);e.exports=r},6040:(e,t,i)=>{"use strict";var r=i(8251);e.exports=r},7382:(e,t,i)=>{"use strict";var r=i(9563);e.exports=r},7264:(e,t,i)=>{"use strict";var r=i(4139);i(768),i(8549),i(7152),i(1372),e.exports=r},9692:(e,t,i)=>{"use strict";var r=i(7045);e.exports=r},5663:(e,t,i)=>{"use strict";var r=i(70);e.exports=r},1362:(e,t,i)=>{"use strict";i(9748);var r=i(1747);e.exports=r("Array","includes")},6429:(e,t,i)=>{"use strict";i(8559);var r=i(1747);e.exports=r("Array","reverse")},1263:(e,t,i)=>{"use strict";i(6737);var r=i(1747);e.exports=r("Array","sort")},6880:(e,t,i)=>{"use strict";var r=i(8280),a=i(1362),n=i(4378),s=Array.prototype,o=String.prototype;e.exports=function(e){var t=e.includes;return e===s||r(s,e)&&t===s.includes?a:"string"==typeof e||e===o||r(o,e)&&t===o.includes?n:t}},6823:(e,t,i)=>{"use strict";var r=i(8280),a=i(2017),n=String.prototype;e.exports=function(e){var t=e.replaceAll;return"string"==typeof e||e===n||r(n,e)&&t===n.replaceAll?a:t}},8059:(e,t,i)=>{"use strict";var r=i(8280),a=i(6429),n=Array.prototype;e.exports=function(e){var t=e.reverse;return e===n||r(n,e)&&t===n.reverse?a:t}},2757:(e,t,i)=>{"use strict";var r=i(8280),a=i(1263),n=Array.prototype;e.exports=function(e){var t=e.sort;return e===n||r(n,e)&&t===n.sort?a:t}},1042:(e,t,i)=>{"use strict";var r=i(8280),a=i(7511),n=String.prototype;e.exports=function(e){var t=e.trim;return"string"==typeof e||e===n||r(n,e)&&t===n.trim?a:t}},1926:(e,t,i)=>{"use strict";i(6750);var r=i(2046).Object,a=e.exports=function(e,t,i){return r.defineProperty(e,t,i)};r.defineProperty.sham&&(a.sham=!0)},4776:(e,t,i)=>{"use strict";i(4452);var r=i(2046);e.exports=r.Object.getOwnPropertySymbols},4378:(e,t,i)=>{"use strict";i(9770);var r=i(1747);e.exports=r("String","includes")},2017:(e,t,i)=>{"use strict";i(1398),i(1995),i(929);var r=i(1747);e.exports=r("String","replaceAll")},7511:(e,t,i)=>{"use strict";i(727);var r=i(1747);e.exports=r("String","trim")},3842:(e,t,i)=>{"use strict";i(8545),i(3643),i(4452),i(3997),i(5084),i(2596),i(5721),i(4954),i(4123),i(3377),i(2230),i(5344),i(1660),i(4610),i(3669),i(4810),i(3325),i(7024),i(8172),i(5205);var r=i(2046);e.exports=r.Symbol},1730:(e,t,i)=>{"use strict";i(9363),i(3643),i(7057),i(4954);var r=i(560);e.exports=r.f("iterator")},1661:(e,t,i)=>{"use strict";i(8537),i(3669);var r=i(560);e.exports=r.f("toPrimitive")},3042:(e,t,i)=>{"use strict";e.exports=i(9604)},3901:(e,t,i)=>{"use strict";var r=i(7358);e.exports=r},9604:(e,t,i)=>{"use strict";i(6038);var r=i(1829);e.exports=r},4997:(e,t,i)=>{"use strict";var r=i(6040);e.exports=r},913:(e,t,i)=>{"use strict";var r=i(7382);e.exports=r},2321:(e,t,i)=>{"use strict";var r=i(7264);i(3939),i(1785),i(1697),i(4664),i(3422),i(36),i(8703),i(6878),i(9671),i(359),e.exports=r},2231:(e,t,i)=>{"use strict";var r=i(9692);e.exports=r},9280:(e,t,i)=>{"use strict";var r=i(5663);e.exports=r},2159:(e,t,i)=>{"use strict";var r=i(2250),a=i(4640),n=TypeError;e.exports=function(e){if(r(e))return e;throw new n(a(e)+" is not a function")}},43:(e,t,i)=>{"use strict";var r=i(4018),a=String,n=TypeError;e.exports=function(e){if(r(e))return e;throw new n("Can't set "+a(e)+" as a prototype")}},2156:e=>{"use strict";e.exports=function(){}},9596:(e,t,i)=>{"use strict";var r=i(8280),a=TypeError;e.exports=function(e,t){if(r(t,e))return e;throw new a("Incorrect invocation")}},6624:(e,t,i)=>{"use strict";var r=i(6285),a=String,n=TypeError;e.exports=function(e){if(r(e))return e;throw new n(a(e)+" is not an object")}},1229:(e,t,i)=>{"use strict";var r=i(8311),a=i(3930),n=i(9298),s=i(6818),o=i(7812),d=i(5468),c=i(575),u=i(5543),h=i(300),l=i(3448),p=Array;e.exports=function(e){var t=n(e),i=d(this),f=arguments.length,g=f>1?arguments[1]:void 0,m=void 0!==g;m&&(g=r(g,f>2?arguments[2]:void 0));var v,A,S,_,y,C,b=l(t),w=0;if(!b||this===p&&o(b))for(v=c(t),A=i?new this(v):p(v);v>w;w++)C=m?g(t[w],w):t[w],u(A,w,C);else for(A=i?new this:[],y=(_=h(t,b)).next;!(S=a(y,_)).done;w++)C=m?s(_,g,[S.value,w],!0):S.value,u(A,w,C);return A.length=w,A}},4436:(e,t,i)=>{"use strict";var r=i(7374),a=i(4849),n=i(575),s=function(e){return function(t,i,s){var o=r(t),d=n(o);if(0===d)return!e&&-1;var c,u=a(s,d);if(e&&i!=i){for(;d>u;)if((c=o[u++])!=c)return!0}else for(;d>u;u++)if((e||u in o)&&o[u]===i)return e||u||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},726:(e,t,i)=>{"use strict";var r=i(8311),a=i(1907),n=i(6946),s=i(9298),o=i(575),d=i(6968),c=a([].push),u=function(e){var t=1===e,i=2===e,a=3===e,u=4===e,h=6===e,l=7===e,p=5===e||h;return function(f,g,m,v){for(var A,S,_=s(f),y=n(_),C=o(y),b=r(g,m),w=0,E=v||d,R=t?E(f,C):i||l?E(f,0):void 0;C>w;w++)if((p||w in y)&&(S=b(A=y[w],w,_),e))if(t)R[w]=S;else if(S)switch(e){case 3:return!0;case 5:return A;case 6:return w;case 2:c(R,A)}else switch(e){case 4:return!1;case 7:c(R,A)}return h?-1:a||u?u:R}};e.exports={forEach:u(0),map:u(1),filter:u(2),some:u(3),every:u(4),find:u(5),findIndex:u(6),filterReject:u(7)}},7171:(e,t,i)=>{"use strict";var r=i(8828),a=i(6264),n=i(798),s=a("species");e.exports=function(e){return n>=51||!r((function(){var t=[];return(t.constructor={})[s]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},7623:(e,t,i)=>{"use strict";var r=i(8828);e.exports=function(e,t){var i=[][e];return!!i&&r((function(){i.call(null,t||function(){return 1},1)}))}},3427:(e,t,i)=>{"use strict";var r=i(1907);e.exports=r([].slice)},4321:(e,t,i)=>{"use strict";var r=i(3427),a=Math.floor,n=function(e,t){var i=e.length;if(i<8)for(var s,o,d=1;d<i;){for(o=d,s=e[d];o&&t(e[o-1],s)>0;)e[o]=e[--o];o!==d++&&(e[o]=s)}else for(var c=a(i/2),u=n(r(e,0,c),t),h=n(r(e,c),t),l=u.length,p=h.length,f=0,g=0;f<l||g<p;)e[f+g]=f<l&&g<p?t(u[f],h[g])<=0?u[f++]:h[g++]:f<l?u[f++]:h[g++];return e};e.exports=n},4010:(e,t,i)=>{"use strict";var r=i(1793),a=i(5468),n=i(6285),s=i(6264)("species"),o=Array;e.exports=function(e){var t;return r(e)&&(t=e.constructor,(a(t)&&(t===o||r(t.prototype))||n(t)&&null===(t=t[s]))&&(t=void 0)),void 0===t?o:t}},6968:(e,t,i)=>{"use strict";var r=i(4010);e.exports=function(e,t){return new(r(e))(0===t?0:t)}},6818:(e,t,i)=>{"use strict";var r=i(6624),a=i(154);e.exports=function(e,t,i,n){try{return n?t(r(i)[0],i[1]):t(i)}catch(t){a(e,"throw",t)}}},5807:(e,t,i)=>{"use strict";var r=i(1907),a=r({}.toString),n=r("".slice);e.exports=function(e){return n(a(e),8,-1)}},3948:(e,t,i)=>{"use strict";var r=i(2623),a=i(2250),n=i(5807),s=i(6264)("toStringTag"),o=Object,d="Arguments"===n(function(){return arguments}());e.exports=r?n:function(e){var t,i,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=o(e),s))?i:d?n(t):"Object"===(r=n(t))&&a(t.callee)?"Arguments":r}},5735:(e,t,i)=>{"use strict";var r=i(6264)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(i){try{return t[r]=!1,"/./"[e](t)}catch(e){}}return!1}},5001:(e,t,i)=>{"use strict";var r=i(8828);e.exports=!r((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},9550:e=>{"use strict";e.exports=function(e,t){return{value:e,done:t}}},1626:(e,t,i)=>{"use strict";var r=i(9447),a=i(4284),n=i(5817);e.exports=r?function(e,t,i){return a.f(e,t,n(1,i))}:function(e,t,i){return e[t]=i,e}},5817:e=>{"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},5543:(e,t,i)=>{"use strict";var r=i(9447),a=i(4284),n=i(5817);e.exports=function(e,t,i){r?a.f(e,t,n(0,i)):e[t]=i}},9251:(e,t,i)=>{"use strict";var r=i(4284);e.exports=function(e,t,i){return r.f(e,t,i)}},8055:(e,t,i)=>{"use strict";var r=i(1626);e.exports=function(e,t,i,a){return a&&a.enumerable?e[t]=i:r(e,t,i),e}},2802:(e,t,i)=>{"use strict";var r=i(8055);e.exports=function(e,t,i){for(var a in t)i&&i.unsafe&&e[a]?e[a]=t[a]:r(e,a,t[a],i);return e}},2532:(e,t,i)=>{"use strict";var r=i(5951),a=Object.defineProperty;e.exports=function(e,t){try{a(r,e,{value:t,configurable:!0,writable:!0})}catch(i){r[e]=t}return t}},4535:(e,t,i)=>{"use strict";var r=i(4640),a=TypeError;e.exports=function(e,t){if(!delete e[t])throw new a("Cannot delete property "+r(t)+" of "+r(e))}},9447:(e,t,i)=>{"use strict";var r=i(8828);e.exports=!r((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},9552:(e,t,i)=>{"use strict";var r=i(5951),a=i(6285),n=r.document,s=a(n)&&a(n.createElement);e.exports=function(e){return s?n.createElement(e):{}}},8024:e=>{"use strict";var t=TypeError;e.exports=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}},9287:e=>{"use strict";e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},376:e=>{"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},3440:(e,t,i)=>{"use strict";var r=i(6794).match(/firefox\/(\d+)/i);e.exports=!!r&&+r[1]},4328:(e,t,i)=>{"use strict";var r=i(6794);e.exports=/MSIE|Trident/.test(r)},6794:(e,t,i)=>{"use strict";var r=i(5951).navigator,a=r&&r.userAgent;e.exports=a?String(a):""},798:(e,t,i)=>{"use strict";var r,a,n=i(5951),s=i(6794),o=n.process,d=n.Deno,c=o&&o.versions||d&&d.version,u=c&&c.v8;u&&(a=(r=u.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!a&&s&&(!(r=s.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=s.match(/Chrome\/(\d+)/))&&(a=+r[1]),e.exports=a},3786:(e,t,i)=>{"use strict";var r=i(6794).match(/AppleWebKit\/(\d+)\./);e.exports=!!r&&+r[1]},1091:(e,t,i)=>{"use strict";var r=i(5951),a=i(6024),n=i(2361),s=i(2250),o=i(3846).f,d=i(7463),c=i(2046),u=i(8311),h=i(1626),l=i(9724);i(6128);var p=function(e){var t=function(i,r,n){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,r)}return new e(i,r,n)}return a(e,this,arguments)};return t.prototype=e.prototype,t};e.exports=function(e,t){var i,a,f,g,m,v,A,S,_,y=e.target,C=e.global,b=e.stat,w=e.proto,E=C?r:b?r[y]:r[y]&&r[y].prototype,R=C?c:c[y]||h(c,y,{})[y],T=R.prototype;for(g in t)a=!(i=d(C?g:y+(b?".":"#")+g,e.forced))&&E&&l(E,g),v=R[g],a&&(A=e.dontCallGetSet?(_=o(E,g))&&_.value:E[g]),m=a&&A?A:t[g],(i||w||typeof v!=typeof m)&&(S=e.bind&&a?u(m,r):e.wrap&&a?p(m):w&&s(m)?n(m):m,(e.sham||m&&m.sham||v&&v.sham)&&h(S,"sham",!0),h(R,g,S),w&&(l(c,f=y+"Prototype")||h(c,f,{}),h(c[f],g,m),e.real&&T&&(i||!T[g])&&h(T,g,m)))}},8828:e=>{"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},6024:(e,t,i)=>{"use strict";var r=i(1505),a=Function.prototype,n=a.apply,s=a.call;e.exports="object"==typeof Reflect&&Reflect.apply||(r?s.bind(n):function(){return s.apply(n,arguments)})},8311:(e,t,i)=>{"use strict";var r=i(2361),a=i(2159),n=i(1505),s=r(r.bind);e.exports=function(e,t){return a(e),void 0===t?e:n?s(e,t):function(){return e.apply(t,arguments)}}},1505:(e,t,i)=>{"use strict";var r=i(8828);e.exports=!r((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},3930:(e,t,i)=>{"use strict";var r=i(1505),a=Function.prototype.call;e.exports=r?a.bind(a):function(){return a.apply(a,arguments)}},6833:(e,t,i)=>{"use strict";var r=i(9447),a=i(9724),n=Function.prototype,s=r&&Object.getOwnPropertyDescriptor,o=a(n,"name"),d=o&&"something"===function(){}.name,c=o&&(!r||r&&s(n,"name").configurable);e.exports={EXISTS:o,PROPER:d,CONFIGURABLE:c}},1871:(e,t,i)=>{"use strict";var r=i(1907),a=i(2159);e.exports=function(e,t,i){try{return r(a(Object.getOwnPropertyDescriptor(e,t)[i]))}catch(e){}}},2361:(e,t,i)=>{"use strict";var r=i(5807),a=i(1907);e.exports=function(e){if("Function"===r(e))return a(e)}},1907:(e,t,i)=>{"use strict";var r=i(1505),a=Function.prototype,n=a.call,s=r&&a.bind.bind(n,n);e.exports=r?s:function(e){return function(){return n.apply(e,arguments)}}},1747:(e,t,i)=>{"use strict";var r=i(5951),a=i(2046);e.exports=function(e,t){var i=a[e+"Prototype"],n=i&&i[t];if(n)return n;var s=r[e],o=s&&s.prototype;return o&&o[t]}},5582:(e,t,i)=>{"use strict";var r=i(2046),a=i(5951),n=i(2250),s=function(e){return n(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?s(r[e])||s(a[e]):r[e]&&r[e][t]||a[e]&&a[e][t]}},3448:(e,t,i)=>{"use strict";var r=i(3948),a=i(9367),n=i(7136),s=i(3742),o=i(6264)("iterator");e.exports=function(e){if(!n(e))return a(e,o)||a(e,"@@iterator")||s[r(e)]}},300:(e,t,i)=>{"use strict";var r=i(3930),a=i(2159),n=i(6624),s=i(4640),o=i(3448),d=TypeError;e.exports=function(e,t){var i=arguments.length<2?o(e):t;if(a(i))return n(r(i,e));throw new d(s(e)+" is not iterable")}},6656:(e,t,i)=>{"use strict";var r=i(1907),a=i(1793),n=i(2250),s=i(5807),o=i(160),d=r([].push);e.exports=function(e){if(n(e))return e;if(a(e)){for(var t=e.length,i=[],r=0;r<t;r++){var c=e[r];"string"==typeof c?d(i,c):"number"!=typeof c&&"Number"!==s(c)&&"String"!==s(c)||d(i,o(c))}var u=i.length,h=!0;return function(e,t){if(h)return h=!1,t;if(a(this))return t;for(var r=0;r<u;r++)if(i[r]===e)return t}}}},9367:(e,t,i)=>{"use strict";var r=i(2159),a=i(7136);e.exports=function(e,t){var i=e[t];return a(i)?void 0:r(i)}},7703:(e,t,i)=>{"use strict";var r=i(1907),a=i(9298),n=Math.floor,s=r("".charAt),o=r("".replace),d=r("".slice),c=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,u=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,i,r,h,l){var p=i+e.length,f=r.length,g=u;return void 0!==h&&(h=a(h),g=c),o(l,g,(function(a,o){var c;switch(s(o,0)){case"$":return"$";case"&":return e;case"`":return d(t,0,i);case"'":return d(t,p);case"<":c=h[d(o,1,-1)];break;default:var u=+o;if(0===u)return a;if(u>f){var l=n(u/10);return 0===l?a:l<=f?void 0===r[l-1]?s(o,1):r[l-1]+s(o,1):a}c=r[u-1]}return void 0===c?"":c}))}},5951:function(e,t,i){"use strict";var r=function(e){return e&&e.Math===Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof i.g&&i.g)||r("object"==typeof this&&this)||function(){return this}()||Function("return this")()},9724:(e,t,i)=>{"use strict";var r=i(1907),a=i(9298),n=r({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return n(a(e),t)}},8530:e=>{"use strict";e.exports={}},2416:(e,t,i)=>{"use strict";var r=i(5582);e.exports=r("document","documentElement")},3648:(e,t,i)=>{"use strict";var r=i(9447),a=i(8828),n=i(9552);e.exports=!r&&!a((function(){return 7!==Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a}))},6946:(e,t,i)=>{"use strict";var r=i(1907),a=i(8828),n=i(5807),s=Object,o=r("".split);e.exports=a((function(){return!s("z").propertyIsEnumerable(0)}))?function(e){return"String"===n(e)?o(e,""):s(e)}:s},2647:(e,t,i)=>{"use strict";var r=i(1907),a=i(2250),n=i(6128),s=r(Function.toString);a(n.inspectSource)||(n.inspectSource=function(e){return s(e)}),e.exports=n.inspectSource},4932:(e,t,i)=>{"use strict";var r,a,n,s=i(551),o=i(5951),d=i(6285),c=i(1626),u=i(9724),h=i(6128),l=i(2522),p=i(8530),f="Object already initialized",g=o.TypeError,m=o.WeakMap;if(s||h.state){var v=h.state||(h.state=new m);v.get=v.get,v.has=v.has,v.set=v.set,r=function(e,t){if(v.has(e))throw new g(f);return t.facade=e,v.set(e,t),t},a=function(e){return v.get(e)||{}},n=function(e){return v.has(e)}}else{var A=l("state");p[A]=!0,r=function(e,t){if(u(e,A))throw new g(f);return t.facade=e,c(e,A,t),t},a=function(e){return u(e,A)?e[A]:{}},n=function(e){return u(e,A)}}e.exports={set:r,get:a,has:n,enforce:function(e){return n(e)?a(e):r(e,{})},getterFor:function(e){return function(t){var i;if(!d(t)||(i=a(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return i}}}},7812:(e,t,i)=>{"use strict";var r=i(6264),a=i(3742),n=r("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(a.Array===e||s[n]===e)}},1793:(e,t,i)=>{"use strict";var r=i(5807);e.exports=Array.isArray||function(e){return"Array"===r(e)}},2250:e=>{"use strict";var t="object"==typeof document&&document.all;e.exports=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},5468:(e,t,i)=>{"use strict";var r=i(1907),a=i(8828),n=i(2250),s=i(3948),o=i(5582),d=i(2647),c=function(){},u=o("Reflect","construct"),h=/^\s*(?:class|function)\b/,l=r(h.exec),p=!h.test(c),f=function(e){if(!n(e))return!1;try{return u(c,[],e),!0}catch(e){return!1}},g=function(e){if(!n(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return p||!!l(h,d(e))}catch(e){return!0}};g.sham=!0,e.exports=!u||a((function(){var e;return f(f.call)||!f(Object)||!f((function(){e=!0}))||e}))?g:f},7463:(e,t,i)=>{"use strict";var r=i(8828),a=i(2250),n=/#|\.prototype\./,s=function(e,t){var i=d[o(e)];return i===u||i!==c&&(a(t)?r(t):!!t)},o=s.normalize=function(e){return String(e).replace(n,".").toLowerCase()},d=s.data={},c=s.NATIVE="N",u=s.POLYFILL="P";e.exports=s},7136:e=>{"use strict";e.exports=function(e){return null==e}},6285:(e,t,i)=>{"use strict";var r=i(2250);e.exports=function(e){return"object"==typeof e?null!==e:r(e)}},4018:(e,t,i)=>{"use strict";var r=i(6285);e.exports=function(e){return r(e)||null===e}},7376:e=>{"use strict";e.exports=!0},2087:(e,t,i)=>{"use strict";var r=i(6285),a=i(5807),n=i(6264)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[n])?!!t:"RegExp"===a(e))}},5594:(e,t,i)=>{"use strict";var r=i(5582),a=i(2250),n=i(8280),s=i(1175),o=Object;e.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=r("Symbol");return a(t)&&n(t.prototype,o(e))}},154:(e,t,i)=>{"use strict";var r=i(3930),a=i(6624),n=i(9367);e.exports=function(e,t,i){var s,o;a(e);try{if(!(s=n(e,"return"))){if("throw"===t)throw i;return i}s=r(s,e)}catch(e){o=!0,s=e}if("throw"===t)throw i;if(o)throw s;return a(s),i}},7181:(e,t,i)=>{"use strict";var r=i(5116).IteratorPrototype,a=i(8075),n=i(5817),s=i(4840),o=i(3742),d=function(){return this};e.exports=function(e,t,i,c){var u=t+" Iterator";return e.prototype=a(r,{next:n(+!c,i)}),s(e,u,!1,!0),o[u]=d,e}},183:(e,t,i)=>{"use strict";var r=i(1091),a=i(3930),n=i(7376),s=i(6833),o=i(2250),d=i(7181),c=i(5972),u=i(9192),h=i(4840),l=i(1626),p=i(8055),f=i(6264),g=i(3742),m=i(5116),v=s.PROPER,A=s.CONFIGURABLE,S=m.IteratorPrototype,_=m.BUGGY_SAFARI_ITERATORS,y=f("iterator"),C="keys",b="values",w="entries",E=function(){return this};e.exports=function(e,t,i,s,f,m,R){d(i,t,s);var T,I,M,D=function(e){if(e===f&&V)return V;if(!_&&e&&e in O)return O[e];switch(e){case C:case b:case w:return function(){return new i(this,e)}}return function(){return new i(this)}},P=t+" Iterator",k=!1,O=e.prototype,x=O[y]||O["@@iterator"]||f&&O[f],V=!_&&x||D(f),N="Array"===t&&O.entries||x;if(N&&(T=c(N.call(new e)))!==Object.prototype&&T.next&&(n||c(T)===S||(u?u(T,S):o(T[y])||p(T,y,E)),h(T,P,!0,!0),n&&(g[P]=E)),v&&f===b&&x&&x.name!==b&&(!n&&A?l(O,"name",b):(k=!0,V=function(){return a(x,this)})),f)if(I={values:D(b),keys:m?V:D(C),entries:D(w)},R)for(M in I)(_||k||!(M in O))&&p(O,M,I[M]);else r({target:t,proto:!0,forced:_||k},I);return n&&!R||O[y]===V||p(O,y,V,{name:f}),g[t]=V,I}},5116:(e,t,i)=>{"use strict";var r,a,n,s=i(8828),o=i(2250),d=i(6285),c=i(8075),u=i(5972),h=i(8055),l=i(6264),p=i(7376),f=l("iterator"),g=!1;[].keys&&("next"in(n=[].keys())?(a=u(u(n)))!==Object.prototype&&(r=a):g=!0),!d(r)||s((function(){var e={};return r[f].call(e)!==e}))?r={}:p&&(r=c(r)),o(r[f])||h(r,f,(function(){return this})),e.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:g}},3742:e=>{"use strict";e.exports={}},575:(e,t,i)=>{"use strict";var r=i(3121);e.exports=function(e){return r(e.length)}},1176:e=>{"use strict";var t=Math.ceil,i=Math.floor;e.exports=Math.trunc||function(e){var r=+e;return(r>0?i:t)(r)}},2074:(e,t,i)=>{"use strict";var r=i(2087),a=TypeError;e.exports=function(e){if(r(e))throw new a("The method doesn't accept regular expressions");return e}},9538:(e,t,i)=>{"use strict";var r=i(9447),a=i(1907),n=i(3930),s=i(8828),o=i(2875),d=i(7170),c=i(2574),u=i(9298),h=i(6946),l=Object.assign,p=Object.defineProperty,f=a([].concat);e.exports=!l||s((function(){if(r&&1!==l({b:1},l(p({},"a",{enumerable:!0,get:function(){p(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},i=Symbol("assign detection"),a="abcdefghijklmnopqrst";return e[i]=7,a.split("").forEach((function(e){t[e]=e})),7!==l({},e)[i]||o(l({},t)).join("")!==a}))?function(e,t){for(var i=u(e),a=arguments.length,s=1,l=d.f,p=c.f;a>s;)for(var g,m=h(arguments[s++]),v=l?f(o(m),l(m)):o(m),A=v.length,S=0;A>S;)g=v[S++],r&&!n(p,m,g)||(i[g]=m[g]);return i}:l},8075:(e,t,i)=>{"use strict";var r,a=i(6624),n=i(2220),s=i(376),o=i(8530),d=i(2416),c=i(9552),u=i(2522),h="prototype",l="script",p=u("IE_PROTO"),f=function(){},g=function(e){return"<"+l+">"+e+"</"+l+">"},m=function(e){e.write(g("")),e.close();var t=e.parentWindow.Object;return e=null,t},v=function(){try{r=new ActiveXObject("htmlfile")}catch(e){}var e,t,i;v="undefined"!=typeof document?document.domain&&r?m(r):(t=c("iframe"),i="java"+l+":",t.style.display="none",d.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(g("document.F=Object")),e.close(),e.F):m(r);for(var a=s.length;a--;)delete v[h][s[a]];return v()};o[p]=!0,e.exports=Object.create||function(e,t){var i;return null!==e?(f[h]=a(e),i=new f,f[h]=null,i[p]=e):i=v(),void 0===t?i:n.f(i,t)}},2220:(e,t,i)=>{"use strict";var r=i(9447),a=i(8661),n=i(4284),s=i(6624),o=i(7374),d=i(2875);t.f=r&&!a?Object.defineProperties:function(e,t){s(e);for(var i,r=o(t),a=d(t),c=a.length,u=0;c>u;)n.f(e,i=a[u++],r[i]);return e}},4284:(e,t,i)=>{"use strict";var r=i(9447),a=i(3648),n=i(8661),s=i(6624),o=i(470),d=TypeError,c=Object.defineProperty,u=Object.getOwnPropertyDescriptor,h="enumerable",l="configurable",p="writable";t.f=r?n?function(e,t,i){if(s(e),t=o(t),s(i),"function"==typeof e&&"prototype"===t&&"value"in i&&p in i&&!i[p]){var r=u(e,t);r&&r[p]&&(e[t]=i.value,i={configurable:l in i?i[l]:r[l],enumerable:h in i?i[h]:r[h],writable:!1})}return c(e,t,i)}:c:function(e,t,i){if(s(e),t=o(t),s(i),a)try{return c(e,t,i)}catch(e){}if("get"in i||"set"in i)throw new d("Accessors not supported");return"value"in i&&(e[t]=i.value),e}},3846:(e,t,i)=>{"use strict";var r=i(9447),a=i(3930),n=i(2574),s=i(5817),o=i(7374),d=i(470),c=i(9724),u=i(3648),h=Object.getOwnPropertyDescriptor;t.f=r?h:function(e,t){if(e=o(e),t=d(t),u)try{return h(e,t)}catch(e){}if(c(e,t))return s(!a(n.f,e,t),e[t])}},5407:(e,t,i)=>{"use strict";var r=i(5807),a=i(7374),n=i(4443).f,s=i(3427),o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"Window"===r(e)?function(e){try{return n(e)}catch(e){return s(o)}}(e):n(a(e))}},4443:(e,t,i)=>{"use strict";var r=i(3045),a=i(376).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,a)}},7170:(e,t)=>{"use strict";t.f=Object.getOwnPropertySymbols},5972:(e,t,i)=>{"use strict";var r=i(9724),a=i(2250),n=i(9298),s=i(2522),o=i(5001),d=s("IE_PROTO"),c=Object,u=c.prototype;e.exports=o?c.getPrototypeOf:function(e){var t=n(e);if(r(t,d))return t[d];var i=t.constructor;return a(i)&&t instanceof i?i.prototype:t instanceof c?u:null}},8280:(e,t,i)=>{"use strict";var r=i(1907);e.exports=r({}.isPrototypeOf)},3045:(e,t,i)=>{"use strict";var r=i(1907),a=i(9724),n=i(7374),s=i(4436).indexOf,o=i(8530),d=r([].push);e.exports=function(e,t){var i,r=n(e),c=0,u=[];for(i in r)!a(o,i)&&a(r,i)&&d(u,i);for(;t.length>c;)a(r,i=t[c++])&&(~s(u,i)||d(u,i));return u}},2875:(e,t,i)=>{"use strict";var r=i(3045),a=i(376);e.exports=Object.keys||function(e){return r(e,a)}},2574:(e,t)=>{"use strict";var i={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,a=r&&!i.call({1:2},1);t.f=a?function(e){var t=r(this,e);return!!t&&t.enumerable}:i},9192:(e,t,i)=>{"use strict";var r=i(1871),a=i(6285),n=i(4239),s=i(43);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,i={};try{(e=r(Object.prototype,"__proto__","set"))(i,[]),t=i instanceof Array}catch(e){}return function(i,r){return n(i),s(r),a(i)?(t?e(i,r):i.__proto__=r,i):i}}():void 0)},4878:(e,t,i)=>{"use strict";var r=i(2623),a=i(3948);e.exports=r?{}.toString:function(){return"[object "+a(this)+"]"}},581:(e,t,i)=>{"use strict";var r=i(3930),a=i(2250),n=i(6285),s=TypeError;e.exports=function(e,t){var i,o;if("string"===t&&a(i=e.toString)&&!n(o=r(i,e)))return o;if(a(i=e.valueOf)&&!n(o=r(i,e)))return o;if("string"!==t&&a(i=e.toString)&&!n(o=r(i,e)))return o;throw new s("Can't convert object to primitive value")}},2046:e=>{"use strict";e.exports={}},5606:(e,t,i)=>{"use strict";var r=i(6624);e.exports=function(){var e=r(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},663:(e,t,i)=>{"use strict";var r=i(3930),a=i(9724),n=i(8280),s=i(5606),o=RegExp.prototype;e.exports=function(e){var t=e.flags;return void 0!==t||"flags"in o||a(e,"flags")||!n(o,e)?t:r(s,e)}},4239:(e,t,i)=>{"use strict";var r=i(7136),a=TypeError;e.exports=function(e){if(r(e))throw new a("Can't call method on "+e);return e}},2098:(e,t,i)=>{"use strict";var r=i(5951),a=i(9447),n=Object.getOwnPropertyDescriptor;e.exports=function(e){if(!a)return r[e];var t=n(r,e);return t&&t.value}},4840:(e,t,i)=>{"use strict";var r=i(2623),a=i(4284).f,n=i(1626),s=i(9724),o=i(4878),d=i(6264)("toStringTag");e.exports=function(e,t,i,c){var u=i?e:e&&e.prototype;u&&(s(u,d)||a(u,d,{configurable:!0,value:t}),c&&!r&&n(u,"toString",o))}},2522:(e,t,i)=>{"use strict";var r=i(5816),a=i(6499),n=r("keys");e.exports=function(e){return n[e]||(n[e]=a(e))}},6128:(e,t,i)=>{"use strict";var r=i(7376),a=i(5951),n=i(2532),s="__core-js_shared__",o=e.exports=a[s]||n(s,{});(o.versions||(o.versions=[])).push({version:"3.39.0",mode:r?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"})},5816:(e,t,i)=>{"use strict";var r=i(6128);e.exports=function(e,t){return r[e]||(r[e]=t||{})}},1470:(e,t,i)=>{"use strict";var r=i(1907),a=i(5482),n=i(160),s=i(4239),o=r("".charAt),d=r("".charCodeAt),c=r("".slice),u=function(e){return function(t,i){var r,u,h=n(s(t)),l=a(i),p=h.length;return l<0||l>=p?e?"":void 0:(r=d(h,l))<55296||r>56319||l+1===p||(u=d(h,l+1))<56320||u>57343?e?o(h,l):r:e?c(h,l,l+2):u-56320+(r-55296<<10)+65536}};e.exports={codeAt:u(!1),charAt:u(!0)}},9156:(e,t,i)=>{"use strict";var r=i(1907),a=2147483647,n=/[^\0-\u007E]/,s=/[.\u3002\uFF0E\uFF61]/g,o="Overflow: input needs wider integers to process",d=RangeError,c=r(s.exec),u=Math.floor,h=String.fromCharCode,l=r("".charCodeAt),p=r([].join),f=r([].push),g=r("".replace),m=r("".split),v=r("".toLowerCase),A=function(e){return e+22+75*(e<26)},S=function(e,t,i){var r=0;for(e=i?u(e/700):e>>1,e+=u(e/t);e>455;)e=u(e/35),r+=36;return u(r+36*e/(e+38))},_=function(e){var t=[];e=function(e){for(var t=[],i=0,r=e.length;i<r;){var a=l(e,i++);if(a>=55296&&a<=56319&&i<r){var n=l(e,i++);56320==(64512&n)?f(t,((1023&a)<<10)+(1023&n)+65536):(f(t,a),i--)}else f(t,a)}return t}(e);var i,r,n=e.length,s=128,c=0,g=72;for(i=0;i<e.length;i++)(r=e[i])<128&&f(t,h(r));var m=t.length,v=m;for(m&&f(t,"-");v<n;){var _=a;for(i=0;i<e.length;i++)(r=e[i])>=s&&r<_&&(_=r);var y=v+1;if(_-s>u((a-c)/y))throw new d(o);for(c+=(_-s)*y,s=_,i=0;i<e.length;i++){if((r=e[i])<s&&++c>a)throw new d(o);if(r===s){for(var C=c,b=36;;){var w=b<=g?1:b>=g+26?26:b-g;if(C<w)break;var E=C-w,R=36-w;f(t,h(A(w+E%R))),C=u(E/R),b+=36}f(t,h(A(C))),g=S(c,y,v===m),c=0,v++}}c++,s++}return p(t,"")};e.exports=function(e){var t,i,r=[],a=m(g(v(e),s,"."),".");for(t=0;t<a.length;t++)i=a[t],f(r,c(n,i)?"xn--"+_(i):i);return p(r,".")}},5819:(e,t,i)=>{"use strict";var r=i(6833).PROPER,a=i(8828),n=i(6395);e.exports=function(e){return a((function(){return!!n[e]()||"​᠎"!=="​᠎"[e]()||r&&n[e].name!==e}))}},5993:(e,t,i)=>{"use strict";var r=i(1907),a=i(4239),n=i(160),s=i(6395),o=r("".replace),d=RegExp("^["+s+"]+"),c=RegExp("(^|[^"+s+"])["+s+"]+$"),u=function(e){return function(t){var i=n(a(t));return 1&e&&(i=o(i,d,"")),2&e&&(i=o(i,c,"$1")),i}};e.exports={start:u(1),end:u(2),trim:u(3)}},9846:(e,t,i)=>{"use strict";var r=i(798),a=i(8828),n=i(5951).String;e.exports=!!Object.getOwnPropertySymbols&&!a((function(){var e=Symbol("symbol detection");return!n(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},3467:(e,t,i)=>{"use strict";var r=i(3930),a=i(5582),n=i(6264),s=i(8055);e.exports=function(){var e=a("Symbol"),t=e&&e.prototype,i=t&&t.valueOf,o=n("toPrimitive");t&&!t[o]&&s(t,o,(function(e){return r(i,this)}),{arity:1})}},2595:(e,t,i)=>{"use strict";var r=i(5582),a=i(1907),n=r("Symbol"),s=n.keyFor,o=a(n.prototype.valueOf);e.exports=n.isRegisteredSymbol||function(e){try{return void 0!==s(o(e))}catch(e){return!1}}},9197:(e,t,i)=>{"use strict";for(var r=i(5816),a=i(5582),n=i(1907),s=i(5594),o=i(6264),d=a("Symbol"),c=d.isWellKnownSymbol,u=a("Object","getOwnPropertyNames"),h=n(d.prototype.valueOf),l=r("wks"),p=0,f=u(d),g=f.length;p<g;p++)try{var m=f[p];s(d[m])&&o(m)}catch(e){}e.exports=function(e){if(c&&c(e))return!0;try{for(var t=h(e),i=0,r=u(l),a=r.length;i<a;i++)if(l[r[i]]==t)return!0}catch(e){}return!1}},4411:(e,t,i)=>{"use strict";var r=i(9846);e.exports=r&&!!Symbol.for&&!!Symbol.keyFor},4849:(e,t,i)=>{"use strict";var r=i(5482),a=Math.max,n=Math.min;e.exports=function(e,t){var i=r(e);return i<0?a(i+t,0):n(i,t)}},7374:(e,t,i)=>{"use strict";var r=i(6946),a=i(4239);e.exports=function(e){return r(a(e))}},5482:(e,t,i)=>{"use strict";var r=i(1176);e.exports=function(e){var t=+e;return t!=t||0===t?0:r(t)}},3121:(e,t,i)=>{"use strict";var r=i(5482),a=Math.min;e.exports=function(e){var t=r(e);return t>0?a(t,9007199254740991):0}},9298:(e,t,i)=>{"use strict";var r=i(4239),a=Object;e.exports=function(e){return a(r(e))}},6028:(e,t,i)=>{"use strict";var r=i(3930),a=i(6285),n=i(5594),s=i(9367),o=i(581),d=i(6264),c=TypeError,u=d("toPrimitive");e.exports=function(e,t){if(!a(e)||n(e))return e;var i,d=s(e,u);if(d){if(void 0===t&&(t="default"),i=r(d,e,t),!a(i)||n(i))return i;throw new c("Can't convert object to primitive value")}return void 0===t&&(t="number"),o(e,t)}},470:(e,t,i)=>{"use strict";var r=i(6028),a=i(5594);e.exports=function(e){var t=r(e,"string");return a(t)?t:t+""}},2623:(e,t,i)=>{"use strict";var r={};r[i(6264)("toStringTag")]="z",e.exports="[object z]"===String(r)},160:(e,t,i)=>{"use strict";var r=i(3948),a=String;e.exports=function(e){if("Symbol"===r(e))throw new TypeError("Cannot convert a Symbol value to a string");return a(e)}},4640:e=>{"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},6499:(e,t,i)=>{"use strict";var r=i(1907),a=0,n=Math.random(),s=r(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++a+n,36)}},4791:(e,t,i)=>{"use strict";var r=i(8828),a=i(6264),n=i(9447),s=i(7376),o=a("iterator");e.exports=!r((function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,i=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach((function(e,i){t.delete("b"),r+=i+e})),i.delete("a",2),i.delete("b",void 0),s&&(!e.toJSON||!i.has("a",1)||i.has("a",2)||!i.has("a",void 0)||i.has("b"))||!t.size&&(s||!n)||!t.sort||"https://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[o]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://тест").host||"#%D0%B1"!==new URL("https://a#б").hash||"a1c3"!==r||"x"!==new URL("https://x",void 0).host}))},1175:(e,t,i)=>{"use strict";var r=i(9846);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},8661:(e,t,i)=>{"use strict";var r=i(9447),a=i(8828);e.exports=r&&a((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},4787:e=>{"use strict";var t=TypeError;e.exports=function(e,i){if(e<i)throw new t("Not enough arguments");return e}},551:(e,t,i)=>{"use strict";var r=i(5951),a=i(2250),n=r.WeakMap;e.exports=a(n)&&/native code/.test(String(n))},366:(e,t,i)=>{"use strict";var r=i(2046),a=i(9724),n=i(560),s=i(4284).f;e.exports=function(e){var t=r.Symbol||(r.Symbol={});a(t,e)||s(t,e,{value:n.f(e)})}},560:(e,t,i)=>{"use strict";var r=i(6264);t.f=r},6264:(e,t,i)=>{"use strict";var r=i(5951),a=i(5816),n=i(9724),s=i(6499),o=i(9846),d=i(1175),c=r.Symbol,u=a("wks"),h=d?c.for||c:c&&c.withoutSetter||s;e.exports=function(e){return n(u,e)||(u[e]=o&&n(c,e)?c[e]:h("Symbol."+e)),u[e]}},6395:e=>{"use strict";e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},8545:(e,t,i)=>{"use strict";var r=i(1091),a=i(8828),n=i(1793),s=i(6285),o=i(9298),d=i(575),c=i(8024),u=i(5543),h=i(6968),l=i(7171),p=i(6264),f=i(798),g=p("isConcatSpreadable"),m=f>=51||!a((function(){var e=[];return e[g]=!1,e.concat()[0]!==e})),v=function(e){if(!s(e))return!1;var t=e[g];return void 0!==t?!!t:n(e)};r({target:"Array",proto:!0,arity:1,forced:!m||!l("concat")},{concat:function(e){var t,i,r,a,n,s=o(this),l=h(s,0),p=0;for(t=-1,r=arguments.length;t<r;t++)if(v(n=-1===t?s:arguments[t]))for(a=d(n),c(p+a),i=0;i<a;i++,p++)i in n&&u(l,p,n[i]);else c(p+1),u(l,p++,n);return l.length=p,l}})},9748:(e,t,i)=>{"use strict";var r=i(1091),a=i(4436).includes,n=i(8828),s=i(2156);r({target:"Array",proto:!0,forced:n((function(){return!Array(1).includes()}))},{includes:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),s("includes")},9363:(e,t,i)=>{"use strict";var r=i(7374),a=i(2156),n=i(3742),s=i(4932),o=i(4284).f,d=i(183),c=i(9550),u=i(7376),h=i(9447),l="Array Iterator",p=s.set,f=s.getterFor(l);e.exports=d(Array,"Array",(function(e,t){p(this,{type:l,target:r(e),index:0,kind:t})}),(function(){var e=f(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=null,c(void 0,!0);switch(e.kind){case"keys":return c(i,!1);case"values":return c(t[i],!1)}return c([i,t[i]],!1)}),"values");var g=n.Arguments=n.Array;if(a("keys"),a("values"),a("entries"),!u&&h&&"values"!==g.name)try{o(g,"name",{value:"values"})}catch(e){}},8559:(e,t,i)=>{"use strict";var r=i(1091),a=i(1907),n=i(1793),s=a([].reverse),o=[1,2];r({target:"Array",proto:!0,forced:String(o)===String(o.reverse())},{reverse:function(){return n(this)&&(this.length=this.length),s(this)}})},6737:(e,t,i)=>{"use strict";var r=i(1091),a=i(1907),n=i(2159),s=i(9298),o=i(575),d=i(4535),c=i(160),u=i(8828),h=i(4321),l=i(7623),p=i(3440),f=i(4328),g=i(798),m=i(3786),v=[],A=a(v.sort),S=a(v.push),_=u((function(){v.sort(void 0)})),y=u((function(){v.sort(null)})),C=l("sort"),b=!u((function(){if(g)return g<70;if(!(p&&p>3)){if(f)return!0;if(m)return m<603;var e,t,i,r,a="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(r=0;r<47;r++)v.push({k:t+r,v:i})}for(v.sort((function(e,t){return t.v-e.v})),r=0;r<v.length;r++)t=v[r].k.charAt(0),a.charAt(a.length-1)!==t&&(a+=t);return"DGBEFHACIJK"!==a}}));r({target:"Array",proto:!0,forced:_||!y||!C||!b},{sort:function(e){void 0!==e&&n(e);var t=s(this);if(b)return void 0===e?A(t):A(t,e);var i,r,a=[],u=o(t);for(r=0;r<u;r++)r in t&&S(a,t[r]);for(h(a,function(e){return function(t,i){return void 0===i?-1:void 0===t?1:void 0!==e?+e(t,i)||0:c(t)>c(i)?1:-1}}(e)),i=o(a),r=0;r<i;)t[r]=a[r++];for(;r<u;)d(t,r++);return t}})},8537:()=>{},9721:(e,t,i)=>{"use strict";var r=i(1091),a=i(5582),n=i(6024),s=i(3930),o=i(1907),d=i(8828),c=i(2250),u=i(5594),h=i(3427),l=i(6656),p=i(9846),f=String,g=a("JSON","stringify"),m=o(/./.exec),v=o("".charAt),A=o("".charCodeAt),S=o("".replace),_=o(1..toString),y=/[\uD800-\uDFFF]/g,C=/^[\uD800-\uDBFF]$/,b=/^[\uDC00-\uDFFF]$/,w=!p||d((function(){var e=a("Symbol")("stringify detection");return"[null]"!==g([e])||"{}"!==g({a:e})||"{}"!==g(Object(e))})),E=d((function(){return'"\\udf06\\ud834"'!==g("\udf06\ud834")||'"\\udead"'!==g("\udead")})),R=function(e,t){var i=h(arguments),r=l(t);if(c(r)||void 0!==e&&!u(e))return i[1]=function(e,t){if(c(r)&&(t=s(r,this,f(e),t)),!u(t))return t},n(g,null,i)},T=function(e,t,i){var r=v(i,t-1),a=v(i,t+1);return m(C,e)&&!m(b,a)||m(b,e)&&!m(C,r)?"\\u"+_(A(e,0),16):e};g&&r({target:"JSON",stat:!0,arity:3,forced:w||E},{stringify:function(e,t,i){var r=h(arguments),a=n(w?R:g,null,r);return E&&"string"==typeof a?S(a,y,T):a}})},7024:(e,t,i)=>{"use strict";var r=i(5951);i(4840)(r.JSON,"JSON",!0)},8172:()=>{},6750:(e,t,i)=>{"use strict";var r=i(1091),a=i(9447),n=i(4284).f;r({target:"Object",stat:!0,forced:Object.defineProperty!==n,sham:!a},{defineProperty:n})},5264:(e,t,i)=>{"use strict";var r=i(1091),a=i(9846),n=i(8828),s=i(7170),o=i(9298);r({target:"Object",stat:!0,forced:!a||n((function(){s.f(1)}))},{getOwnPropertySymbols:function(e){var t=s.f;return t?t(o(e)):[]}})},3643:()=>{},5205:()=>{},1398:()=>{},1074:(e,t,i)=>{"use strict";var r=i(1091),a=i(1907),n=i(4849),s=RangeError,o=String.fromCharCode,d=String.fromCodePoint,c=a([].join);r({target:"String",stat:!0,arity:1,forced:!!d&&1!==d.length},{fromCodePoint:function(e){for(var t,i=[],r=arguments.length,a=0;r>a;){if(t=+arguments[a++],n(t,1114111)!==t)throw new s(t+" is not a valid code point");i[a]=t<65536?o(t):o(55296+((t-=65536)>>10),t%1024+56320)}return c(i,"")}})},9770:(e,t,i)=>{"use strict";var r=i(1091),a=i(1907),n=i(2074),s=i(4239),o=i(160),d=i(5735),c=a("".indexOf);r({target:"String",proto:!0,forced:!d("includes")},{includes:function(e){return!!~c(o(s(this)),o(n(e)),arguments.length>1?arguments[1]:void 0)}})},7057:(e,t,i)=>{"use strict";var r=i(1470).charAt,a=i(160),n=i(4932),s=i(183),o=i(9550),d="String Iterator",c=n.set,u=n.getterFor(d);s(String,"String",(function(e){c(this,{type:d,string:a(e),index:0})}),(function(){var e,t=u(this),i=t.string,a=t.index;return a>=i.length?o(void 0,!0):(e=r(i,a),t.index+=e.length,o(e,!1))}))},929:(e,t,i)=>{"use strict";var r=i(1091),a=i(3930),n=i(1907),s=i(4239),o=i(2250),d=i(7136),c=i(2087),u=i(160),h=i(9367),l=i(663),p=i(7703),f=i(6264),g=i(7376),m=f("replace"),v=TypeError,A=n("".indexOf),S=n("".replace),_=n("".slice),y=Math.max;r({target:"String",proto:!0},{replaceAll:function(e,t){var i,r,n,f,C,b,w,E,R,T,I=s(this),M=0,D="";if(!d(e)){if((i=c(e))&&(r=u(s(l(e))),!~A(r,"g")))throw new v("`.replaceAll` does not allow non-global regexes");if(n=h(e,m))return a(n,e,I,t);if(g&&i)return S(u(I),e,t)}for(f=u(I),C=u(e),(b=o(t))||(t=u(t)),w=C.length,E=y(1,w),R=A(f,C);-1!==R;)T=b?u(t(C,R,f)):p(C,f,R,[],void 0,t),D+=_(f,M,R)+T,M=R+w,R=R+E>f.length?-1:A(f,C,R+E);return M<f.length&&(D+=_(f,M)),D}})},1995:()=>{},727:(e,t,i)=>{"use strict";var r=i(1091),a=i(5993).trim;r({target:"String",proto:!0,forced:i(5819)("trim")},{trim:function(){return a(this)}})},3997:(e,t,i)=>{"use strict";i(366)("asyncIterator")},3674:(e,t,i)=>{"use strict";var r=i(1091),a=i(5951),n=i(3930),s=i(1907),o=i(7376),d=i(9447),c=i(9846),u=i(8828),h=i(9724),l=i(8280),p=i(6624),f=i(7374),g=i(470),m=i(160),v=i(5817),A=i(8075),S=i(2875),_=i(4443),y=i(5407),C=i(7170),b=i(3846),w=i(4284),E=i(2220),R=i(2574),T=i(8055),I=i(9251),M=i(5816),D=i(2522),P=i(8530),k=i(6499),O=i(6264),x=i(560),V=i(366),N=i(3467),L=i(4840),W=i(4932),B=i(726).forEach,U=D("hidden"),F="Symbol",G="prototype",H=W.set,j=W.getterFor(F),K=Object[G],q=a.Symbol,z=q&&q[G],X=a.RangeError,Y=a.TypeError,Q=a.QObject,J=b.f,Z=w.f,$=y.f,ee=R.f,te=s([].push),ie=M("symbols"),re=M("op-symbols"),ae=M("wks"),ne=!Q||!Q[G]||!Q[G].findChild,se=function(e,t,i){var r=J(K,t);r&&delete K[t],Z(e,t,i),r&&e!==K&&Z(K,t,r)},oe=d&&u((function(){return 7!==A(Z({},"a",{get:function(){return Z(this,"a",{value:7}).a}})).a}))?se:Z,de=function(e,t){var i=ie[e]=A(z);return H(i,{type:F,tag:e,description:t}),d||(i.description=t),i},ce=function(e,t,i){e===K&&ce(re,t,i),p(e);var r=g(t);return p(i),h(ie,r)?(i.enumerable?(h(e,U)&&e[U][r]&&(e[U][r]=!1),i=A(i,{enumerable:v(0,!1)})):(h(e,U)||Z(e,U,v(1,A(null))),e[U][r]=!0),oe(e,r,i)):Z(e,r,i)},ue=function(e,t){p(e);var i=f(t),r=S(i).concat(fe(i));return B(r,(function(t){d&&!n(he,i,t)||ce(e,t,i[t])})),e},he=function(e){var t=g(e),i=n(ee,this,t);return!(this===K&&h(ie,t)&&!h(re,t))&&(!(i||!h(this,t)||!h(ie,t)||h(this,U)&&this[U][t])||i)},le=function(e,t){var i=f(e),r=g(t);if(i!==K||!h(ie,r)||h(re,r)){var a=J(i,r);return!a||!h(ie,r)||h(i,U)&&i[U][r]||(a.enumerable=!0),a}},pe=function(e){var t=$(f(e)),i=[];return B(t,(function(e){h(ie,e)||h(P,e)||te(i,e)})),i},fe=function(e){var t=e===K,i=$(t?re:f(e)),r=[];return B(i,(function(e){!h(ie,e)||t&&!h(K,e)||te(r,ie[e])})),r};c||(T(z=(q=function(){if(l(z,this))throw new Y("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?m(arguments[0]):void 0,t=k(e),i=function(e){var r=void 0===this?a:this;r===K&&n(i,re,e),h(r,U)&&h(r[U],t)&&(r[U][t]=!1);var s=v(1,e);try{oe(r,t,s)}catch(e){if(!(e instanceof X))throw e;se(r,t,s)}};return d&&ne&&oe(K,t,{configurable:!0,set:i}),de(t,e)})[G],"toString",(function(){return j(this).tag})),T(q,"withoutSetter",(function(e){return de(k(e),e)})),R.f=he,w.f=ce,E.f=ue,b.f=le,_.f=y.f=pe,C.f=fe,x.f=function(e){return de(O(e),e)},d&&(I(z,"description",{configurable:!0,get:function(){return j(this).description}}),o||T(K,"propertyIsEnumerable",he,{unsafe:!0}))),r({global:!0,constructor:!0,wrap:!0,forced:!c,sham:!c},{Symbol:q}),B(S(ae),(function(e){V(e)})),r({target:F,stat:!0,forced:!c},{useSetter:function(){ne=!0},useSimple:function(){ne=!1}}),r({target:"Object",stat:!0,forced:!c,sham:!d},{create:function(e,t){return void 0===t?A(e):ue(A(e),t)},defineProperty:ce,defineProperties:ue,getOwnPropertyDescriptor:le}),r({target:"Object",stat:!0,forced:!c},{getOwnPropertyNames:pe}),N(),L(q,F),P[U]=!0},5084:()=>{},3313:(e,t,i)=>{"use strict";var r=i(1091),a=i(5582),n=i(9724),s=i(160),o=i(5816),d=i(4411),c=o("string-to-symbol-registry"),u=o("symbol-to-string-registry");r({target:"Symbol",stat:!0,forced:!d},{for:function(e){var t=s(e);if(n(c,t))return c[t];var i=a("Symbol")(t);return c[t]=i,u[i]=t,i}})},2596:(e,t,i)=>{"use strict";i(366)("hasInstance")},5721:(e,t,i)=>{"use strict";i(366)("isConcatSpreadable")},4954:(e,t,i)=>{"use strict";i(366)("iterator")},4452:(e,t,i)=>{"use strict";i(3674),i(3313),i(751),i(9721),i(5264)},751:(e,t,i)=>{"use strict";var r=i(1091),a=i(9724),n=i(5594),s=i(4640),o=i(5816),d=i(4411),c=o("symbol-to-string-registry");r({target:"Symbol",stat:!0,forced:!d},{keyFor:function(e){if(!n(e))throw new TypeError(s(e)+" is not a symbol");if(a(c,e))return c[e]}})},3377:(e,t,i)=>{"use strict";i(366)("matchAll")},4123:(e,t,i)=>{"use strict";i(366)("match")},2230:(e,t,i)=>{"use strict";i(366)("replace")},5344:(e,t,i)=>{"use strict";i(366)("search")},1660:(e,t,i)=>{"use strict";i(366)("species")},4610:(e,t,i)=>{"use strict";i(366)("split")},3669:(e,t,i)=>{"use strict";var r=i(366),a=i(3467);r("toPrimitive"),a()},4810:(e,t,i)=>{"use strict";var r=i(5582),a=i(366),n=i(4840);a("toStringTag"),n(r("Symbol"),"Symbol")},3325:(e,t,i)=>{"use strict";i(366)("unscopables")},768:(e,t,i)=>{"use strict";var r=i(6264),a=i(4284).f,n=r("metadata"),s=Function.prototype;void 0===s[n]&&a(s,n,{value:null})},6038:(e,t,i)=>{"use strict";i(929)},8549:(e,t,i)=>{"use strict";i(366)("asyncDispose")},1697:(e,t,i)=>{"use strict";i(366)("customMatcher")},7152:(e,t,i)=>{"use strict";i(366)("dispose")},3939:(e,t,i)=>{"use strict";i(1091)({target:"Symbol",stat:!0},{isRegisteredSymbol:i(2595)})},3422:(e,t,i)=>{"use strict";i(1091)({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:i(2595)})},1785:(e,t,i)=>{"use strict";i(1091)({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:i(9197)})},36:(e,t,i)=>{"use strict";i(1091)({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:i(9197)})},8703:(e,t,i)=>{"use strict";i(366)("matcher")},6878:(e,t,i)=>{"use strict";i(366)("metadataKey")},1372:(e,t,i)=>{"use strict";i(366)("metadata")},4664:(e,t,i)=>{"use strict";i(366)("observable")},9671:(e,t,i)=>{"use strict";i(366)("patternMatch")},359:(e,t,i)=>{"use strict";i(366)("replaceAll")},2560:(e,t,i)=>{"use strict";i(9363);var r=i(9287),a=i(5951),n=i(4840),s=i(3742);for(var o in r)n(a[o],o),s[o]=s.Array},7105:(e,t,i)=>{"use strict";i(9363),i(1074);var r=i(1091),a=i(5951),n=i(2098),s=i(5582),o=i(3930),d=i(1907),c=i(9447),u=i(4791),h=i(8055),l=i(9251),p=i(2802),f=i(4840),g=i(7181),m=i(4932),v=i(9596),A=i(2250),S=i(9724),_=i(8311),y=i(3948),C=i(6624),b=i(6285),w=i(160),E=i(8075),R=i(5817),T=i(300),I=i(3448),M=i(9550),D=i(4787),P=i(6264),k=i(4321),O=P("iterator"),x="URLSearchParams",V=x+"Iterator",N=m.set,L=m.getterFor(x),W=m.getterFor(V),B=n("fetch"),U=n("Request"),F=n("Headers"),G=U&&U.prototype,H=F&&F.prototype,j=a.TypeError,K=a.encodeURIComponent,q=String.fromCharCode,z=s("String","fromCodePoint"),X=parseInt,Y=d("".charAt),Q=d([].join),J=d([].push),Z=d("".replace),$=d([].shift),ee=d([].splice),te=d("".split),ie=d("".slice),re=d(/./.exec),ae=/\+/g,ne=/^[0-9a-f]+$/i,se=function(e,t){var i=ie(e,t,t+2);return re(ne,i)?X(i,16):NaN},oe=function(e){for(var t=0,i=128;i>0&&e&i;i>>=1)t++;return t},de=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},ce=function(e){for(var t=(e=Z(e,ae," ")).length,i="",r=0;r<t;){var a=Y(e,r);if("%"===a){if("%"===Y(e,r+1)||r+3>t){i+="%",r++;continue}var n=se(e,r+1);if(n!=n){i+=a,r++;continue}r+=2;var s=oe(n);if(0===s)a=q(n);else{if(1===s||s>4){i+="�",r++;continue}for(var o=[n],d=1;d<s&&!(3+ ++r>t||"%"!==Y(e,r));){var c=se(e,r+1);if(c!=c){r+=3;break}if(c>191||c<128)break;J(o,c),r+=2,d++}if(o.length!==s){i+="�";continue}var u=de(o);null===u?i+="�":a=z(u)}}i+=a,r++}return i},ue=/[!'()~]|%20/g,he={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},le=function(e){return he[e]},pe=function(e){return Z(K(e),ue,le)},fe=g((function(e,t){N(this,{type:V,target:L(e).entries,index:0,kind:t})}),x,(function(){var e=W(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=null,M(void 0,!0);var r=t[i];switch(e.kind){case"keys":return M(r.key,!1);case"values":return M(r.value,!1)}return M([r.key,r.value],!1)}),!0),ge=function(e){this.entries=[],this.url=null,void 0!==e&&(b(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===Y(e,0)?ie(e,1):e:w(e)))};ge.prototype={type:x,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,i,r,a,n,s,d,c=this.entries,u=I(e);if(u)for(i=(t=T(e,u)).next;!(r=o(i,t)).done;){if(n=(a=T(C(r.value))).next,(s=o(n,a)).done||(d=o(n,a)).done||!o(n,a).done)throw new j("Expected sequence with length 2");J(c,{key:w(s.value),value:w(d.value)})}else for(var h in e)S(e,h)&&J(c,{key:h,value:w(e[h])})},parseQuery:function(e){if(e)for(var t,i,r=this.entries,a=te(e,"&"),n=0;n<a.length;)(t=a[n++]).length&&(i=te(t,"="),J(r,{key:ce($(i)),value:ce(Q(i,"="))}))},serialize:function(){for(var e,t=this.entries,i=[],r=0;r<t.length;)e=t[r++],J(i,pe(e.key)+"="+pe(e.value));return Q(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var me=function(){v(this,ve);var e=N(this,new ge(arguments.length>0?arguments[0]:void 0));c||(this.size=e.entries.length)},ve=me.prototype;if(p(ve,{append:function(e,t){var i=L(this);D(arguments.length,2),J(i.entries,{key:w(e),value:w(t)}),c||this.length++,i.updateURL()},delete:function(e){for(var t=L(this),i=D(arguments.length,1),r=t.entries,a=w(e),n=i<2?void 0:arguments[1],s=void 0===n?n:w(n),o=0;o<r.length;){var d=r[o];if(d.key!==a||void 0!==s&&d.value!==s)o++;else if(ee(r,o,1),void 0!==s)break}c||(this.size=r.length),t.updateURL()},get:function(e){var t=L(this).entries;D(arguments.length,1);for(var i=w(e),r=0;r<t.length;r++)if(t[r].key===i)return t[r].value;return null},getAll:function(e){var t=L(this).entries;D(arguments.length,1);for(var i=w(e),r=[],a=0;a<t.length;a++)t[a].key===i&&J(r,t[a].value);return r},has:function(e){for(var t=L(this).entries,i=D(arguments.length,1),r=w(e),a=i<2?void 0:arguments[1],n=void 0===a?a:w(a),s=0;s<t.length;){var o=t[s++];if(o.key===r&&(void 0===n||o.value===n))return!0}return!1},set:function(e,t){var i=L(this);D(arguments.length,1);for(var r,a=i.entries,n=!1,s=w(e),o=w(t),d=0;d<a.length;d++)(r=a[d]).key===s&&(n?ee(a,d--,1):(n=!0,r.value=o));n||J(a,{key:s,value:o}),c||(this.size=a.length),i.updateURL()},sort:function(){var e=L(this);k(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,i=L(this).entries,r=_(e,arguments.length>1?arguments[1]:void 0),a=0;a<i.length;)r((t=i[a++]).value,t.key,this)},keys:function(){return new fe(this,"keys")},values:function(){return new fe(this,"values")},entries:function(){return new fe(this,"entries")}},{enumerable:!0}),h(ve,O,ve.entries,{name:"entries"}),h(ve,"toString",(function(){return L(this).serialize()}),{enumerable:!0}),c&&l(ve,"size",{get:function(){return L(this).entries.length},configurable:!0,enumerable:!0}),f(me,x),r({global:!0,constructor:!0,forced:!u},{URLSearchParams:me}),!u&&A(F)){var Ae=d(H.has),Se=d(H.set),_e=function(e){if(b(e)){var t,i=e.body;if(y(i)===x)return t=e.headers?new F(e.headers):new F,Ae(t,"content-type")||Se(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),E(e,{body:R(0,w(i)),headers:R(0,t)})}return e};if(A(B)&&r({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return B(e,arguments.length>1?_e(arguments[1]):{})}}),A(U)){var ye=function(e){return v(this,G),new U(e,arguments.length>1?_e(arguments[1]):{})};G.constructor=ye,ye.prototype=G,r({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:ye})}}e.exports={URLSearchParams:me,getState:L}},5042:()=>{},7649:()=>{},6299:(e,t,i)=>{"use strict";i(7105)},3604:()=>{},8669:(e,t,i)=>{"use strict";var r=i(1091),a=i(5582),n=i(8828),s=i(4787),o=i(160),d=i(4791),c=a("URL"),u=d&&n((function(){c.canParse()})),h=n((function(){return 1!==c.canParse.length}));r({target:"URL",stat:!0,forced:!u||h},{canParse:function(e){var t=s(arguments.length,1),i=o(e),r=t<2||void 0===arguments[1]?void 0:o(arguments[1]);try{return!!new c(i,r)}catch(e){return!1}}})},6909:(e,t,i)=>{"use strict";i(7057);var r,a=i(1091),n=i(9447),s=i(4791),o=i(5951),d=i(8311),c=i(1907),u=i(8055),h=i(9251),l=i(9596),p=i(9724),f=i(9538),g=i(1229),m=i(3427),v=i(1470).codeAt,A=i(9156),S=i(160),_=i(4840),y=i(4787),C=i(7105),b=i(4932),w=b.set,E=b.getterFor("URL"),R=C.URLSearchParams,T=C.getState,I=o.URL,M=o.TypeError,D=o.parseInt,P=Math.floor,k=Math.pow,O=c("".charAt),x=c(/./.exec),V=c([].join),N=c(1..toString),L=c([].pop),W=c([].push),B=c("".replace),U=c([].shift),F=c("".split),G=c("".slice),H=c("".toLowerCase),j=c([].unshift),K="Invalid scheme",q="Invalid host",z="Invalid port",X=/[a-z]/i,Y=/[\d+-.a-z]/i,Q=/\d/,J=/^0x/i,Z=/^[0-7]+$/,$=/^\d+$/,ee=/^[\da-f]+$/i,te=/[\0\t\n\r #%/:<>?@[\\\]^|]/,ie=/[\0\t\n\r #/:<>?@[\\\]^|]/,re=/^[\u0000-\u0020]+/,ae=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,ne=/[\t\n\r]/g,se=function(e){var t,i,r,a;if("number"==typeof e){for(t=[],i=0;i<4;i++)j(t,e%256),e=P(e/256);return V(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,i=1,r=null,a=0,n=0;n<8;n++)0!==e[n]?(a>i&&(t=r,i=a),r=null,a=0):(null===r&&(r=n),++a);return a>i?r:t}(e),i=0;i<8;i++)a&&0===e[i]||(a&&(a=!1),r===i?(t+=i?":":"::",a=!0):(t+=N(e[i],16),i<7&&(t+=":")));return"["+t+"]"}return e},oe={},de=f({},oe,{" ":1,'"':1,"<":1,">":1,"`":1}),ce=f({},de,{"#":1,"?":1,"{":1,"}":1}),ue=f({},ce,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),he=function(e,t){var i=v(e,0);return i>32&&i<127&&!p(t,e)?e:encodeURIComponent(e)},le={ftp:21,file:null,http:80,https:443,ws:80,wss:443},pe=function(e,t){var i;return 2===e.length&&x(X,O(e,0))&&(":"===(i=O(e,1))||!t&&"|"===i)},fe=function(e){var t;return e.length>1&&pe(G(e,0,2))&&(2===e.length||"/"===(t=O(e,2))||"\\"===t||"?"===t||"#"===t)},ge=function(e){return"."===e||"%2e"===H(e)},me={},ve={},Ae={},Se={},_e={},ye={},Ce={},be={},we={},Ee={},Re={},Te={},Ie={},Me={},De={},Pe={},ke={},Oe={},xe={},Ve={},Ne={},Le=function(e,t,i){var r,a,n,s=S(e);if(t){if(a=this.parse(s))throw new M(a);this.searchParams=null}else{if(void 0!==i&&(r=new Le(i,!0)),a=this.parse(s,null,r))throw new M(a);(n=T(new R)).bindURL(this),this.searchParams=n}};Le.prototype={type:"URL",parse:function(e,t,i){var a,n,s,o,d,c=this,u=t||me,h=0,l="",f=!1,v=!1,A=!1;for(e=S(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=B(e,re,""),e=B(e,ae,"$1")),e=B(e,ne,""),a=g(e);h<=a.length;){switch(n=a[h],u){case me:if(!n||!x(X,n)){if(t)return K;u=Ae;continue}l+=H(n),u=ve;break;case ve:if(n&&(x(Y,n)||"+"===n||"-"===n||"."===n))l+=H(n);else{if(":"!==n){if(t)return K;l="",u=Ae,h=0;continue}if(t&&(c.isSpecial()!==p(le,l)||"file"===l&&(c.includesCredentials()||null!==c.port)||"file"===c.scheme&&!c.host))return;if(c.scheme=l,t)return void(c.isSpecial()&&le[c.scheme]===c.port&&(c.port=null));l="","file"===c.scheme?u=Me:c.isSpecial()&&i&&i.scheme===c.scheme?u=Se:c.isSpecial()?u=be:"/"===a[h+1]?(u=_e,h++):(c.cannotBeABaseURL=!0,W(c.path,""),u=xe)}break;case Ae:if(!i||i.cannotBeABaseURL&&"#"!==n)return K;if(i.cannotBeABaseURL&&"#"===n){c.scheme=i.scheme,c.path=m(i.path),c.query=i.query,c.fragment="",c.cannotBeABaseURL=!0,u=Ne;break}u="file"===i.scheme?Me:ye;continue;case Se:if("/"!==n||"/"!==a[h+1]){u=ye;continue}u=we,h++;break;case _e:if("/"===n){u=Ee;break}u=Oe;continue;case ye:if(c.scheme=i.scheme,n===r)c.username=i.username,c.password=i.password,c.host=i.host,c.port=i.port,c.path=m(i.path),c.query=i.query;else if("/"===n||"\\"===n&&c.isSpecial())u=Ce;else if("?"===n)c.username=i.username,c.password=i.password,c.host=i.host,c.port=i.port,c.path=m(i.path),c.query="",u=Ve;else{if("#"!==n){c.username=i.username,c.password=i.password,c.host=i.host,c.port=i.port,c.path=m(i.path),c.path.length--,u=Oe;continue}c.username=i.username,c.password=i.password,c.host=i.host,c.port=i.port,c.path=m(i.path),c.query=i.query,c.fragment="",u=Ne}break;case Ce:if(!c.isSpecial()||"/"!==n&&"\\"!==n){if("/"!==n){c.username=i.username,c.password=i.password,c.host=i.host,c.port=i.port,u=Oe;continue}u=Ee}else u=we;break;case be:if(u=we,"/"!==n||"/"!==O(l,h+1))continue;h++;break;case we:if("/"!==n&&"\\"!==n){u=Ee;continue}break;case Ee:if("@"===n){f&&(l="%40"+l),f=!0,s=g(l);for(var _=0;_<s.length;_++){var y=s[_];if(":"!==y||A){var C=he(y,ue);A?c.password+=C:c.username+=C}else A=!0}l=""}else if(n===r||"/"===n||"?"===n||"#"===n||"\\"===n&&c.isSpecial()){if(f&&""===l)return"Invalid authority";h-=g(l).length+1,l="",u=Re}else l+=n;break;case Re:case Te:if(t&&"file"===c.scheme){u=Pe;continue}if(":"!==n||v){if(n===r||"/"===n||"?"===n||"#"===n||"\\"===n&&c.isSpecial()){if(c.isSpecial()&&""===l)return q;if(t&&""===l&&(c.includesCredentials()||null!==c.port))return;if(o=c.parseHost(l))return o;if(l="",u=ke,t)return;continue}"["===n?v=!0:"]"===n&&(v=!1),l+=n}else{if(""===l)return q;if(o=c.parseHost(l))return o;if(l="",u=Ie,t===Te)return}break;case Ie:if(!x(Q,n)){if(n===r||"/"===n||"?"===n||"#"===n||"\\"===n&&c.isSpecial()||t){if(""!==l){var b=D(l,10);if(b>65535)return z;c.port=c.isSpecial()&&b===le[c.scheme]?null:b,l=""}if(t)return;u=ke;continue}return z}l+=n;break;case Me:if(c.scheme="file","/"===n||"\\"===n)u=De;else{if(!i||"file"!==i.scheme){u=Oe;continue}switch(n){case r:c.host=i.host,c.path=m(i.path),c.query=i.query;break;case"?":c.host=i.host,c.path=m(i.path),c.query="",u=Ve;break;case"#":c.host=i.host,c.path=m(i.path),c.query=i.query,c.fragment="",u=Ne;break;default:fe(V(m(a,h),""))||(c.host=i.host,c.path=m(i.path),c.shortenPath()),u=Oe;continue}}break;case De:if("/"===n||"\\"===n){u=Pe;break}i&&"file"===i.scheme&&!fe(V(m(a,h),""))&&(pe(i.path[0],!0)?W(c.path,i.path[0]):c.host=i.host),u=Oe;continue;case Pe:if(n===r||"/"===n||"\\"===n||"?"===n||"#"===n){if(!t&&pe(l))u=Oe;else if(""===l){if(c.host="",t)return;u=ke}else{if(o=c.parseHost(l))return o;if("localhost"===c.host&&(c.host=""),t)return;l="",u=ke}continue}l+=n;break;case ke:if(c.isSpecial()){if(u=Oe,"/"!==n&&"\\"!==n)continue}else if(t||"?"!==n)if(t||"#"!==n){if(n!==r&&(u=Oe,"/"!==n))continue}else c.fragment="",u=Ne;else c.query="",u=Ve;break;case Oe:if(n===r||"/"===n||"\\"===n&&c.isSpecial()||!t&&("?"===n||"#"===n)){if(".."===(d=H(d=l))||"%2e."===d||".%2e"===d||"%2e%2e"===d?(c.shortenPath(),"/"===n||"\\"===n&&c.isSpecial()||W(c.path,"")):ge(l)?"/"===n||"\\"===n&&c.isSpecial()||W(c.path,""):("file"===c.scheme&&!c.path.length&&pe(l)&&(c.host&&(c.host=""),l=O(l,0)+":"),W(c.path,l)),l="","file"===c.scheme&&(n===r||"?"===n||"#"===n))for(;c.path.length>1&&""===c.path[0];)U(c.path);"?"===n?(c.query="",u=Ve):"#"===n&&(c.fragment="",u=Ne)}else l+=he(n,ce);break;case xe:"?"===n?(c.query="",u=Ve):"#"===n?(c.fragment="",u=Ne):n!==r&&(c.path[0]+=he(n,oe));break;case Ve:t||"#"!==n?n!==r&&("'"===n&&c.isSpecial()?c.query+="%27":c.query+="#"===n?"%23":he(n,oe)):(c.fragment="",u=Ne);break;case Ne:n!==r&&(c.fragment+=he(n,de))}h++}},parseHost:function(e){var t,i,r;if("["===O(e,0)){if("]"!==O(e,e.length-1))return q;if(t=function(e){var t,i,r,a,n,s,o,d=[0,0,0,0,0,0,0,0],c=0,u=null,h=0,l=function(){return O(e,h)};if(":"===l()){if(":"!==O(e,1))return;h+=2,u=++c}for(;l();){if(8===c)return;if(":"!==l()){for(t=i=0;i<4&&x(ee,l());)t=16*t+D(l(),16),h++,i++;if("."===l()){if(0===i)return;if(h-=i,c>6)return;for(r=0;l();){if(a=null,r>0){if(!("."===l()&&r<4))return;h++}if(!x(Q,l()))return;for(;x(Q,l());){if(n=D(l(),10),null===a)a=n;else{if(0===a)return;a=10*a+n}if(a>255)return;h++}d[c]=256*d[c]+a,2!=++r&&4!==r||c++}if(4!==r)return;break}if(":"===l()){if(h++,!l())return}else if(l())return;d[c++]=t}else{if(null!==u)return;h++,u=++c}}if(null!==u)for(s=c-u,c=7;0!==c&&s>0;)o=d[c],d[c--]=d[u+s-1],d[u+--s]=o;else if(8!==c)return;return d}(G(e,1,-1)),!t)return q;this.host=t}else if(this.isSpecial()){if(e=A(e),x(te,e))return q;if(t=function(e){var t,i,r,a,n,s,o,d=F(e,".");if(d.length&&""===d[d.length-1]&&d.length--,(t=d.length)>4)return e;for(i=[],r=0;r<t;r++){if(""===(a=d[r]))return e;if(n=10,a.length>1&&"0"===O(a,0)&&(n=x(J,a)?16:8,a=G(a,8===n?1:2)),""===a)s=0;else{if(!x(10===n?$:8===n?Z:ee,a))return e;s=D(a,n)}W(i,s)}for(r=0;r<t;r++)if(s=i[r],r===t-1){if(s>=k(256,5-t))return null}else if(s>255)return null;for(o=L(i),r=0;r<i.length;r++)o+=i[r]*k(256,3-r);return o}(e),null===t)return q;this.host=t}else{if(x(ie,e))return q;for(t="",i=g(e),r=0;r<i.length;r++)t+=he(i[r],oe);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return p(le,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"===this.scheme&&1===t&&pe(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,i=e.username,r=e.password,a=e.host,n=e.port,s=e.path,o=e.query,d=e.fragment,c=t+":";return null!==a?(c+="//",e.includesCredentials()&&(c+=i+(r?":"+r:"")+"@"),c+=se(a),null!==n&&(c+=":"+n)):"file"===t&&(c+="//"),c+=e.cannotBeABaseURL?s[0]:s.length?"/"+V(s,"/"):"",null!==o&&(c+="?"+o),null!==d&&(c+="#"+d),c},setHref:function(e){var t=this.parse(e);if(t)throw new M(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"===e)try{return new We(e.path[0]).origin}catch(e){return"null"}return"file"!==e&&this.isSpecial()?e+"://"+se(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(S(e)+":",me)},getUsername:function(){return this.username},setUsername:function(e){var t=g(S(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<t.length;i++)this.username+=he(t[i],ue)}},getPassword:function(){return this.password},setPassword:function(e){var t=g(S(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<t.length;i++)this.password+=he(t[i],ue)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?se(e):se(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Re)},getHostname:function(){var e=this.host;return null===e?"":se(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Te)},getPort:function(){var e=this.port;return null===e?"":S(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""===(e=S(e))?this.port=null:this.parse(e,Ie))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+V(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,ke))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""===(e=S(e))?this.query=null:("?"===O(e,0)&&(e=G(e,1)),this.query="",this.parse(e,Ve)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!==(e=S(e))?("#"===O(e,0)&&(e=G(e,1)),this.fragment="",this.parse(e,Ne)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var We=function(e){var t=l(this,Be),i=y(arguments.length,1)>1?arguments[1]:void 0,r=w(t,new Le(e,!1,i));n||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},Be=We.prototype,Ue=function(e,t){return{get:function(){return E(this)[e]()},set:t&&function(e){return E(this)[t](e)},configurable:!0,enumerable:!0}};if(n&&(h(Be,"href",Ue("serialize","setHref")),h(Be,"origin",Ue("getOrigin")),h(Be,"protocol",Ue("getProtocol","setProtocol")),h(Be,"username",Ue("getUsername","setUsername")),h(Be,"password",Ue("getPassword","setPassword")),h(Be,"host",Ue("getHost","setHost")),h(Be,"hostname",Ue("getHostname","setHostname")),h(Be,"port",Ue("getPort","setPort")),h(Be,"pathname",Ue("getPathname","setPathname")),h(Be,"search",Ue("getSearch","setSearch")),h(Be,"searchParams",Ue("getSearchParams")),h(Be,"hash",Ue("getHash","setHash"))),u(Be,"toJSON",(function(){return E(this).serialize()}),{enumerable:!0}),u(Be,"toString",(function(){return E(this).serialize()}),{enumerable:!0}),I){var Fe=I.createObjectURL,Ge=I.revokeObjectURL;Fe&&u(We,"createObjectURL",d(Fe,I)),Ge&&u(We,"revokeObjectURL",d(Ge,I))}_(We,"URL"),a({global:!0,constructor:!0,forced:!s,sham:!n},{URL:We})},3487:(e,t,i)=>{"use strict";i(6909)},8670:(e,t,i)=>{"use strict";var r=i(1091),a=i(5582),n=i(4787),s=i(160),o=i(4791),d=a("URL");r({target:"URL",stat:!0,forced:!o},{parse:function(e){var t=n(arguments.length,1),i=s(e),r=t<2||void 0===arguments[1]?void 0:s(arguments[1]);try{return new d(i,r)}catch(e){return null}}})},4783:()=>{},6343:(e,t,i)=>{"use strict";var r=i(6880);e.exports=r},2222:(e,t,i)=>{"use strict";var r=i(6823);e.exports=r},4106:(e,t,i)=>{"use strict";var r=i(8059);e.exports=r},1086:(e,t,i)=>{"use strict";var r=i(2757);e.exports=r},4598:(e,t,i)=>{"use strict";var r=i(1042);e.exports=r},8251:(e,t,i)=>{"use strict";var r=i(1926);e.exports=r},9563:(e,t,i)=>{"use strict";var r=i(4776);e.exports=r},4139:(e,t,i)=>{"use strict";var r=i(3842);i(2560),e.exports=r},7045:(e,t,i)=>{"use strict";var r=i(1730);i(2560),e.exports=r},70:(e,t,i)=>{"use strict";var r=i(1661);e.exports=r},9792:(e,t,i)=>{"use strict";var r=i(6908);e.exports=r},9076:(e,t,i)=>{"use strict";i(6299),i(5042),i(7649),i(3604);var r=i(2046);e.exports=r.URLSearchParams},6908:(e,t,i)=>{"use strict";i(9076),i(3487),i(8669),i(8670),i(4783);var r=i(2046);e.exports=r.URL},7857:(e,t,i)=>{"use strict";i.d(t,{A:()=>d});var r=i(4997),a=i(2321),n=i(2231);function s(e){return s="function"==typeof a&&"symbol"==typeof n?function(e){return typeof e}:function(e){return e&&"function"==typeof a&&e.constructor===a&&e!==a.prototype?"symbol":typeof e},s(e)}var o=i(9280);function d(e,t,i){return(t=function(e){var t=function(e){if("object"!=s(e)||!e)return e;var t=e[o];if(void 0!==t){var i=t.call(e,"string");if("object"!=s(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==s(t)?t:t+""}(t))in e?r(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}}},a={};function n(e){var t=a[e];if(void 0!==t)return t.exports;var i=a[e]={id:e,loaded:!1,exports:{}};return r[e].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}return n.m=r,n.amdO={},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,i)=>(n.f[i](e,t),t)),[])),n.u=e=>({208:"annoter",404:"pako",557:"wmsc"}[e]+".min.js"),n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},i="JsMediaSDK_Instance:",n.l=(e,r,a,s)=>{if(t[e])t[e].push(r);else{var o,d;if(void 0!==a)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==e||h.getAttribute("data-webpack")==i+a){o=h;break}}o||(d=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",i+a),o.src=e),t[e]=[r];var l=(i,r)=>{o.onerror=o.onload=null,clearTimeout(p);var a=t[e];if(delete t[e],o.parentNode&&o.parentNode.removeChild(o),a&&a.forEach((e=>e(r))),i)return i(r)},p=setTimeout(l.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=l.bind(null,o.onerror),o.onload=l.bind(null,o.onload),d&&document.head.appendChild(o)}},n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var r=i.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=i[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{var e={827:0};n.f.j=(t,i)=>{var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var a=new Promise(((i,a)=>r=e[t]=[i,a]));i.push(r[2]=a);var s=n.p+n.u(t),o=new Error;n.l(s,(i=>{if(n.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var a=i&&("load"===i.type?"missing":i.type),s=i&&i.target&&i.target.src;o.message="Loading chunk "+t+" failed.\n("+a+": "+s+")",o.name="ChunkLoadError",o.type=a,o.request=s,r[1](o)}}),"chunk-"+t,t)}};var t=(t,i)=>{var r,a,s=i[0],o=i[1],d=i[2],c=0;if(s.some((t=>0!==e[t]))){for(r in o)n.o(o,r)&&(n.m[r]=o[r]);d&&d(n)}for(t&&t(i);c<s.length;c++)a=s[c],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0},i=self.webpackChunkJsMediaSDK_Instance=self.webpackChunkJsMediaSDK_Instance||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),n(4497)})()));
//# sourceMappingURL=https://d1cdksi819e9z7.cloudfront.net/sourcemap/js_media.min.js-08ecfca1a31669235cc2.map