!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.VB=e():t.VB=e()}(window,(function(){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e,r){"use strict";r.r(e),r.d(e,"QOS_DEFAULT_POLLING_INTERVAL",(function(){return i})),r.d(e,"VIDEO_MONITOR_LOG_SECOENDS",(function(){return n})),r.d(e,"THREAD_STATE_IDLE",(function(){return o})),r.d(e,"THREAD_STATE_CREATING",(function(){return a})),r.d(e,"THREAD_STATE_CREATED",(function(){return s})),r.d(e,"MEDIA_S2C_KEEPALIVE",(function(){return u})),r.d(e,"MEDIA_AUDIO_DATA",(function(){return E})),r.d(e,"MEDIA_AUDIO_RTCP",(function(){return _})),r.d(e,"MEDIA_AUDIO_FEATURE",(function(){return c})),r.d(e,"MEDIA_VIDEO_DATA",(function(){return d})),r.d(e,"MEDIA_VIDEO_RTCP",(function(){return h})),r.d(e,"MEDIA_NTP_UPDATE",(function(){return T})),r.d(e,"VIDEO_CAPTURER_RESOLUTION_360P",(function(){return R})),r.d(e,"VIDEO_CAPTURER_RESOLUTION_720P",(function(){return f})),r.d(e,"VIDEO_CAPTURER_RESOLUTION_1080P",(function(){return A})),r.d(e,"UPDATE_ENCRYPTION_GCM_MODEL_KEY",(function(){return l})),r.d(e,"MEDIA_AUDIO_QOS_SESS_DATA",(function(){return O})),r.d(e,"INTERPRETATION_ENABLE",(function(){return I})),r.d(e,"INTERPRETATION_SET_LANG",(function(){return S})),r.d(e,"INTERPRETATION_MUTE",(function(){return D})),r.d(e,"INTERPRETATION_SET_INTERPRETER",(function(){return N})),r.d(e,"serverHeartbeatMaxTimeoutSeconds",(function(){return p})),r.d(e,"RQUEST_ANIMATION_MODE",(function(){return m})),r.d(e,"SET_INTERVAL_MODE",(function(){return C})),r.d(e,"VIDEO_INVALID",(function(){return g})),r.d(e,"VIDEO_RGBA",(function(){return v})),r.d(e,"VIDEO_I420",(function(){return U})),r.d(e,"VIDEO_NV12",(function(){return V})),r.d(e,"VIDEO_BGRA",(function(){return x})),r.d(e,"EVENT_ROLLBACK_BUFFER",(function(){return M})),r.d(e,"EVENT_NEEDMORE_DATA",(function(){return L})),r.d(e,"EVENT_CAPTURE_DATA",(function(){return P})),r.d(e,"EVENT_CACHE_SIZE",(function(){return B})),r.d(e,"WEBCODEC_ENCODE_OFF",(function(){return b})),r.d(e,"WEBCODEC_DECODE_OFF",(function(){return F})),r.d(e,"QosSession",(function(){return G})),r.d(e,"QosConnectType",(function(){return y})),r.d(e,"MAX_VIDEO_CAPTURE_FPS",(function(){return w})),r.d(e,"MIN_VIDEO_CAPTURE_FPS",(function(){return k})),r.d(e,"VIDEO_CAPTURE_FPS",(function(){return H})),r.d(e,"VIDEO_CAPTURE_20FPS",(function(){return W})),r.d(e,"DOWN_VIDEO_CAPTURE_FPS",(function(){return Y})),r.d(e,"LOWER_VIDEO_CAPTURE_FPS",(function(){return K})),r.d(e,"VIDEO_DATA_MAX_SIZE",(function(){return X})),r.d(e,"VIDEO_FRAME_BUFFER_SIZE",(function(){return j})),r.d(e,"SHARING_NULL",(function(){return Z})),r.d(e,"SHARING_NORMAL",(function(){return Q})),r.d(e,"SHARING_VIDEO_MODE",(function(){return z})),r.d(e,"SHARING_VIDEO_MODE_CAPTURED_FPS",(function(){return J})),r.d(e,"SHARING_NORMAL_MODE_CAPTURED_FPS",(function(){return q})),r.d(e,"VIDEO_RINGBUF_PKG_NUM",(function(){return $})),r.d(e,"ADDITIONNAL_MULTITHREAD_NUMBER_ENCODE_FOR_360P",(function(){return tt})),r.d(e,"ADDITIONNAL_MULTITHREAD_NUMBER_ENCODE_FOR_720P",(function(){return et})),r.d(e,"ADDITIONNAL_MULTITHREAD_NUMBER_ENCODE_FOR_1080p",(function(){return rt})),r.d(e,"WCL_PLATFORM_TYPE",(function(){return it})),r.d(e,"AS_CAPTURE_SOURCE",(function(){return nt})),r.d(e,"MEDIA_COMMAND",(function(){return ot})),r.d(e,"RENDER_UNSET",(function(){return at})),r.d(e,"RENDER_IN_WORKER",(function(){return st})),r.d(e,"RENDER_IN_MAIN",(function(){return ut})),r.d(e,"WEBRTC_NO_AUDIO_MODE",(function(){return Et})),r.d(e,"WEBRTC_COMMPUTER_AUDIO_MODE",(function(){return _t})),r.d(e,"WEBRTC_SHARE_AUDIO_MODE",(function(){return ct})),r.d(e,"WEBRTC_MULTI_AUDIO_MODE",(function(){return dt})),r.d(e,"VIDEO_FRAME",(function(){return ht})),r.d(e,"SHARING_FRAME",(function(){return Tt})),r.d(e,"MAX_RENDER_WITHOUT_SAB",(function(){return Rt})),r.d(e,"ACTIVE_SPEAKER_SSRC",(function(){return ft})),r.d(e,"FACE_MODE_UNKNOW",(function(){return At})),r.d(e,"FACE_MODE_USER",(function(){return lt})),r.d(e,"FACE_MODE_ENVIRONMENT",(function(){return Ot})),r.d(e,"ORIGINAL_SOUND_OFF",(function(){return It})),r.d(e,"ORIGINAL_SOUND_ON",(function(){return St})),r.d(e,"ORIGINAL_SOUND_STEREO",(function(){return Dt})),r.d(e,"ORIGINAL_SOUND_HIGHFIDELITY",(function(){return Nt})),r.d(e,"ORIGINAL_SOUND_HIGHFIDELITY_STEREO",(function(){return pt})),r.d(e,"SHARE_AUDIO",(function(){return mt})),r.d(e,"ORIGINAL_SOUND_OFF_HIGH_BITRATE",(function(){return Ct})),r.d(e,"PUBLISHER_ICEConnectionState_Failed",(function(){return gt})),r.d(e,"SUBSCRIBER_ICEConnectionState_Failed",(function(){return vt})),r.d(e,"NO_MESSAGE_FAILOVER",(function(){return Ut})),r.d(e,"WS_ERROR_FAILOVER",(function(){return Vt})),r.d(e,"WS_CLOSE_FAILOVER",(function(){return xt})),r.d(e,"VB_CONSTANT",(function(){return Mt})),r.d(e,"AUDIO_ENCODE_WORKER",(function(){return Lt})),r.d(e,"AUDIO_DECODE_WORKER",(function(){return Pt})),r.d(e,"AUDIO_WASM_WORKLET",(function(){return Bt})),r.d(e,"AUDIO_WEBRTC_WORKLET",(function(){return bt})),r.d(e,"DATACHANNEL_MONITOR_SEPARATOR",(function(){return Ft})),r.d(e,"LOADEDMETADATAT_IMEOUT",(function(){return Gt})),r.d(e,"MEDIA_SOLUTION_WEBRTC",(function(){return yt})),r.d(e,"MEDIA_SOLUTION_WASM",(function(){return wt})),r.d(e,"AudioProfile",(function(){return kt}));const i=1e3,n=5,o=43,a=44,s=45,u=0,E=1,_=6,c=146,d=2,h=7,T=9,R=10,f=11,A=12,l=102,O=107,I=0,S=1,D=2,N=3,p=65,m=0,C=1,g=-1,v=0,U=1,V=2,x=3,M=0,L=1,P=2,B=3,b=1,F=2,G={SESSION_TYPE_CONF:0,SESSION_TYPE_AUDIO:1,SESSION_TYPE_DESKSHARE:2,SESSION_TYPE_VIDEO:3,SESSION_TYPE_CHAT:4,SESSION_TYPE_TELEPHONE:5,SESSION_TYPE_ZC_PING:6,SESSION_TYPE_TOTAL_CNT:7},y={CONNECT_TYPE_UDP:0,CONNECT_TYPE_TCP:1},w=30,k=1,H=24,W=20,Y=15,K=10,X=8294400,j=5,Z=0,Q=1,z=2,J=15,q=5,$=400,tt=3,et=7,rt=8,it={DESKTOP:0,MOBILE:1,ANDROID:2,IPHONE:3},nt={DESKTOP_SOURCE:0,UAC_SOURCE:1},ot={SHARE_REMOTE_CONTROL_UAC_MOUSE:144,SHARE_REMOTE_CONTROL_UAC_JPEG_FRAME:145},at=-1,st=0,ut=1,Et=0,_t=1,ct=2,dt=_t+ct,ht=0,Tt=1,Rt=25,ft=1,At=-1,lt=0,Ot=1,It=0,St=1,Dt=2|St,Nt=4|St,pt=Dt|Nt,mt=8,Ct=16,gt=3,vt=107,Ut="100",Vt="101",xt="102",Mt="WCL_M,isWebEnabled:1, isLocalEnabled:1, isSmartBkgnd:1, bkgType:2",Lt=0,Pt=1,Bt=2,bt=3,Ft="{[WLCCONT]}",Gt=1e4,yt=1,wt=2,kt={[It]:new Map([["useinbandfec",{value:1,operater:"add"}],["maxaveragebitrate",{value:48e3,operater:"add"}],["maxplaybackrate",{value:24e3,operater:"add"}],["sprop-maxcapturerate",{value:24e3,operater:"add"}],["sprop-stereo",{value:1,operater:"sub"}],["stereo",{value:1,operater:"sub"}]]),[St]:new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:96e3,operater:"add"}],["maxplaybackrate",{value:48e3,operater:"add"}],["sprop-maxcapturerate",{value:48e3,operater:"add"}],["sprop-stereo",{value:1,operater:"add"}],["stereo",{value:1,operater:"add"}]]),[Dt]:new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:96e3,operater:"add"}],["maxplaybackrate",{value:48e3,operater:"add"}],["sprop-maxcapturerate",{value:48e3,operater:"add"}],["sprop-stereo",{value:1,operater:"add"}],["stereo",{value:1,operater:"add"}]]),[Nt]:new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:128e3,operater:"add"}],["maxplaybackrate",{value:48e3,operater:"add"}],["sprop-maxcapturerate",{value:48e3,operater:"add"}],["sprop-stereo",{value:1,operater:"add"}],["stereo",{value:1,operater:"add"}]]),[pt]:new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:128e3,operater:"add"}],["maxplaybackrate",{value:48e3,operater:"add"}],["sprop-maxcapturerate",{value:48e3,operater:"add"}],["sprop-stereo",{value:1,operater:"add"}],["stereo",{value:1,operater:"add"}]]),[mt]:new Map([["useinbandfec",{value:1,operater:"sub"}],["maxaveragebitrate",{value:"96000",operater:"add"}],["maxplaybackrate",{value:"48000",operater:"add"}],["sprop-maxcapturerate",{value:"48000",operater:"add"}]]),[Ct]:new Map([["useinbandfec",{value:1,operater:"add"}],["maxaveragebitrate",{value:64e3,operater:"add"}],["maxplaybackrate",{value:24e3,operater:"add"}],["sprop-maxcapturerate",{value:24e3,operater:"add"}],["sprop-stereo",{value:1,operater:"sub"}],["stereo",{value:1,operater:"sub"}]])}},function(t,e,r){"use strict";var i=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))((function(n,o){function a(t){try{u(i.next(t))}catch(t){o(t)}}function s(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((i=i.apply(t,e||[])).next())}))},n=this&&this.__rest||function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]])}return r},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=r(2),s=o(r(3)),u=r(4),E=o(r(5)),_=o(r(6));class c{constructor(t){this.isVBReady=!1,this.videoStream=null,this.isVBInitializing=!1,this.receiveTimer=null,this.msgChannel=null,this.isEnabled=!0,this.trackProcessor=null,this.isVBRunning=!1,this.frameRate=24,this.isStreamEnabled=!1,this.destoryed=!1,this._needFrame=!1,this._fps=0,this._backend="";const e=t||{},{canvas:r,canvasID:i,bgImage:o,cdnPath:a}=e,s=n(e,["canvas","canvasID","bgImage","cdnPath"]);if(this.cdnPath=a||c.cdnPath,!this.cdnPath)throw new Error("VB module: cdnPath is not provided");this.vbWorkerUrl=this.cdnPath+"/vb_worker.min.js",this.initParam=s,this._needFrame=s.needFrame,r&&(this.cvsEle="string"==typeof r?document.querySelector("#"+r):r),o&&(this.bgImage=o),this.handle_message_from_vb_worker=this.handle_message_from_vb_worker.bind(this);const u=navigator.userAgent.toLocaleLowerCase();this.isSafari=u.includes("safari")&&!u.includes("chrome")&&!u.includes("chromium"),this.vbLoadingTimer=new _.default}set needFrame(t){this._needFrame=t,this.postMessage({cmd:a.VB_EVENT_TYPE.VB_UPDATE_NEED_FRAME,payload:t})}get needFrame(){return this._needFrame}get fps(){return this._fps}get backend(){return this._backend}set ontimeout3s(t){this.vbLoadingTimer.ontimeout3s=t}set ontimeout10s(t){this.vbLoadingTimer.ontimeout10s=t}static isSupportVB(){return i(this,void 0,void 0,(function*(){try{const t=yield s.default.simd();return navigator.hardwareConcurrency&&navigator.hardwareConcurrency>2&&t&&"function"==typeof OffscreenCanvas}catch(t){return!1}}))}sendCanvas(){if(this.cvsEle){const t=this.cvsEle.transferControlToOffscreen();this.postMessage({cmd:a.VB_EVENT_TYPE.VB_RENDER_CANVAS,payload:t},[t])}}generateVBStream(){if(this.vbTrackGenerator){const t=this.vbTrackGenerator.writable;this.postMessage({cmd:a.VB_EVENT_TYPE.VB_GENERATE_STREAM,payload:t},[t])}else if(this.streamCanvas)if(this.isSafari){const t=this.streamCanvas.transferControlToOffscreen();this.postMessage({cmd:a.VB_EVENT_TYPE.VB_GENERATE_STREAM,payload:t},[t])}else this.streamRender=new E.default(this.streamCanvas,c.VB_STREAM_CANVAS),this.postMessage({cmd:a.VB_EVENT_TYPE.VB_GENERATE_STREAM})}initialize(){return this.isVBReady?Promise.resolve():(this.isVBInitializing||(this.isVBInitializing=!0,this.vbLoadingTimer.isVBPredictDone=!1,this.initPromise=new Promise((t,e)=>i(this,void 0,void 0,(function*(){this.initReject=e,this.initResolve=t;try{const t=yield fetch(this.vbWorkerUrl);if(t.ok){const e=yield t.arrayBuffer();if(this.destoryed)return;const r=window.URL.createObjectURL(new Blob([e]));this.worker=new Worker(r,{name:c.VB_WORKER_NAME}),this.worker.addEventListener("message",this.handle_message_from_vb_worker),this.postMessage({cmd:a.VB_EVENT_TYPE.VB_WORKER_INIT,payload:Object.assign(Object.assign({},this.initParam),{cdnPath:this.cdnPath})}),this.sendCanvas(),this.generateVBStream(),window.URL.revokeObjectURL(r)}else{const{url:r,status:i}=t;this.isVBInitializing=!1,e(`Fetch worker file failed. url: ${r}, status: ${i}`)}}catch(t){this.isVBInitializing=!1,e(t)}})))),this.initPromise)}send_frame(t){this.isVBReady&&("format"in t?this.postMessage({cmd:a.VB_EVENT_TYPE.VB_SEND_FRAME,payload:t},[t]):this.postMessage({cmd:a.VB_EVENT_TYPE.VB_SEND_FRAME,payload:t},[t.data.buffer]))}Crop_Mask_Bg_16V9(){let t,e,r,i=0,n=this.bgImage.width,o=this.bgImage.height;return 16/9*o>=n?(r=n,i=n/(16/9),t=0,e=(o-i)/2):(r=o*(16/9),i=o,t=(n-r)/2,e=0),{sx:t,sy:e,sw:r,sh:i}}set_background_image(t){if(this.bgImage=t,!this.isVBReady)return!1;const e=this.Crop_Mask_Bg_16V9();let r,i,n,o,s,u;r=e.sx,i=e.sy,n=e.sw,o=e.sh,n>1920?(s=1920,u=1080):(s=n,u=o),this.bgConvertCanvas||(this.bgConvertCanvas=new OffscreenCanvas(s,u)),this.bgConvertCanvas.width=s,this.bgConvertCanvas.height=u;let E=this.bgConvertCanvas.getContext("2d");if(!E)return!1;E.drawImage(t,r,i,n,o,0,0,this.bgConvertCanvas.width,this.bgConvertCanvas.height);let _=E.getImageData(0,0,this.bgConvertCanvas.width,this.bgConvertCanvas.height);return this.postMessage({cmd:a.VB_EVENT_TYPE.VB_UPDATE_BG,payload:_}),"close"in t&&t.close(),!0}set_background_blur(){this.isVBReady&&this.postMessage({cmd:a.VB_EVENT_TYPE.VB_UPDATE_BG,payload:"blur"})}handle_message_from_vb_worker(t){const{cmd:e}=t.data;switch(c.EXTERNAL_EVENTS.has(e)&&(e!==a.VB_EVENT_TYPE.VB_GENERATED_FRAME||this._needFrame)&&this.callback&&this.callback(t.data),e){case a.VB_EVENT_TYPE.VB_MODEL_READY:this.vbLoadingTimer.start();break;case a.VB_EVENT_TYPE.VB_PREDICT_DONE:{const{payload:e}=t.data;this.vbLoadingTimer.isVBPredictDone=!0,this.vbLoadingTimer.clear(),this._backend=e;break}case a.VB_EVENT_TYPE.VB_INIT_FAILED:{const{payload:e}=t.data;this.isVBInitializing=!1,this.initReject(e);break}case a.VB_EVENT_TYPE.VB_INIT_SUCCESS:this.isVBReady=!0,this.isVBInitializing=!1,this.bgImage&&this.set_background_image(this.bgImage),this.initResolve();break;case a.VB_EVENT_TYPE.VB_REQUEST_FRAME:if(this.updateConstraints(),this.captureVideoEle&&this.isVideoPlaying(this.captureVideoEle))if(window.VideoFrame){const t=new VideoFrame(this.captureVideoEle);this.send_frame(t),t.close()}else if(this.captureCtx){this.captureCtx.drawImage(this.captureVideoEle,0,0);const t=this.captureCtx.getImageData(0,0,this.captureVideoEle.videoWidth,this.captureVideoEle.videoHeight);this.streamRender&&this.isStreamEnabled&&!this.isEnabled&&this.streamRender.render(t),this.send_frame(t)}break;case a.VB_EVENT_TYPE.VB_GENERATED_FRAME:{const e=t.data.payload,{data_ptr:r}=e;this.streamRender&&this.isStreamEnabled&&this.streamRender.render(e),r&&this.freeMemory(r);break}case a.VB_EVENT_TYPE.VB_UPDATE_FPS:this._fps=t.data.payload}}onMessage(t){this.callback=t}createCaptureEle(){window.MediaStreamTrackProcessor||(this.captureVideoEle=document.querySelector("#"+c.VB_CAPTURE_VIDEO),this.captureVideoEle||(this.captureVideoEle=document.createElement("video"),this.captureVideoEle.autoplay=!0,this.captureVideoEle.playsInline=!0,this.captureVideoEle.id=c.VB_CAPTURE_VIDEO,this.captureVideoEle.style.position="fixed",this.captureVideoEle.style.width="1px",this.captureVideoEle.style.height="1px",this.captureVideoEle.style.bottom="0px",this.captureVideoEle.style.right="0px",this.captureVideoEle.muted=!0,document.body.appendChild(this.captureVideoEle)),this.captureCanvas||window.VideoFrame||(this.captureCanvas=document.createElement("canvas"),this.captureCtx=this.captureCanvas.getContext("2d")))}isVideoPlaying(t){return(t.paused||t.ended)&&t.play(),t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2}postMessage(t,e){var r,i;e?null===(r=this.worker)||void 0===r||r.postMessage(t,e):null===(i=this.worker)||void 0===i||i.postMessage(t)}updateStreamCanvasSize(t,e){this.streamCanvas&&(this.isSafari?this.postMessage({cmd:a.VB_EVENT_TYPE.VB_CHANGE_STREAM_CANVAS_SIZE,payload:{width:t,height:e}}):(this.streamCanvas.width=t,this.streamCanvas.height=e))}updateConstraints(){const t=this.videoStream.getVideoTracks()[0],{width:e,height:r,frameRate:i}=t.getSettings();e&&r&&(!this.streamCanvas||e===this.streamCanvas.width&&r===this.streamCanvas.height||this.updateStreamCanvasSize(e,r),this.captureCanvas&&(e!==this.captureCanvas.width&&(this.captureCanvas.width=e),r!==this.captureCanvas.height&&(this.captureCanvas.height=r))),i&&this.frameRate!=i&&(this.frameRate=Math.min(i,24),this.postMessage({cmd:a.VB_EVENT_TYPE.VB_UPDATE_FRAME_RATE,payload:this.frameRate}))}captureVideo(t){return i(this,void 0,void 0,(function*(){this.isVBReady||this.isVBInitializing?this.isVBInitializing&&(yield this.initPromise):yield this.initialize();let e=!0;if("id"in t){if(!t.active)return Promise.reject("stream is not active");this.videoStream&&this.videoStream.id===t.id?e=!1:(this.stopCapture(),this.videoStream=t)}else this.videoStream&&this.captureConf===t?e=!1:(this.stopCapture(),this.captureConf=t,this.videoStream=yield navigator.mediaDevices.getUserMedia(Object.assign(Object.assign({},t),{audio:!1})));if(this.createCaptureEle(),e){let t;if(!(t=this.videoStream.getVideoTracks()[0]))return Promise.reject("No video track in stream");{const e=t.getSettings(),{width:r=0,height:i=0,frameRate:n=24}=e;if(this.updateStreamCanvasSize(r,i),this.frameRate=Math.min(n,24),window.MediaStreamTrackProcessor){this.trackProcessor=new window.MediaStreamTrackProcessor({track:t});const e=this.trackProcessor.readable;this.postMessage({cmd:a.VB_EVENT_TYPE.VB_START,payload:{videoStream:e,frameRate:this.frameRate}},[e])}else this.captureVideoEle&&(this.captureVideoEle.srcObject=this.videoStream,this.captureVideoEle.play(),this.captureCanvas&&(this.captureCanvas.width=r,this.captureCanvas.height=i),this.postMessage({cmd:a.VB_EVENT_TYPE.VB_START,payload:{frameRate:this.frameRate}}))}}else{if(this.isVBRunning)return;this.videoStream.getVideoTracks()[0].enabled=!0,this.captureVideoEle&&this.captureVideoEle.play(),this.postMessage({cmd:a.VB_EVENT_TYPE.VB_START})}this.isVBRunning=!0}))}stopCapture(t=!0){this.postMessage({cmd:a.VB_EVENT_TYPE.VB_STOP,payload:t}),this.captureVideoEle&&this.captureVideoEle.pause(),this.videoStream&&t&&(this.videoStream.getTracks().forEach(t=>{t.stop()}),this.videoStream=null),this.isVBRunning=!1}setMirror(t){this.postMessage({cmd:a.VB_EVENT_TYPE.VB_MIRROR,payload:t})}freeMemory(t){this.isVBReady&&this.postMessage({cmd:a.VB_EVENT_TYPE.VB_FREE_MEMORY,payload:t})}startReceiveMode(t){return t&&(this.captureConf=t),this.msgChannel||(this.msgChannel=new MessageChannel,this.msgChannel.port1.onmessage=t=>{var e;const{type:r,frame:i}=t.data;this.receiveTimer&&clearTimeout(this.receiveTimer),r===u.UNIFIED_VB_FRAME&&i?(null===(e=this.msgChannel)||void 0===e||e.port1.postMessage({type:u.UNIFIED_VB_ACK}),this.isEnabled?(this.isVBRunning&&this.stopCapture(),this.renderFrame(i)):i.close(),this.isSafari||(this.receiveTimer=setTimeout(()=>{this.captureConf&&!this.isVBRunning&&this.captureVideo(this.captureConf)},1e3))):r!==u.UNIFIED_VB_PAUSE&&r!==u.UNIFIED_VB_STOP||(this.captureConf&&!this.isVBRunning&&this.captureVideo(this.captureConf),r===u.UNIFIED_VB_STOP&&this.msgChannel&&(this.msgChannel.port1.onmessage=null,this.msgChannel=null))}),this.msgChannel.port2}enable(){this.postMessage({cmd:a.VB_EVENT_TYPE.VB_TOGGLE_VB,payload:!0}),this.isEnabled=!0}disable(){this.postMessage({cmd:a.VB_EVENT_TYPE.VB_TOGGLE_VB,payload:!1}),this.isEnabled=!1,!this.isVBRunning&&this.msgChannel&&this.captureConf&&(this.captureVideo(this.captureConf).catch(t=>{}),clearTimeout(this.receiveTimer))}renderFrame(t){return i(this,void 0,void 0,(function*(){this.postMessage({cmd:a.VB_EVENT_TYPE.VB_RENDER_FRAME,payload:t}),"close"in t&&t.close()}))}destory(){this.destoryed=!0,this.stopCapture(),this.vbLoadingTimer.clear(),this.msgChannel&&(this.msgChannel.port2.onmessage=null),this.captureVideoEle&&document.body.removeChild(this.captureVideoEle),this.worker&&(this.worker.removeEventListener("message",this.handle_message_from_vb_worker),this.worker.terminate())}createStream(){if(this.isStreamEnabled=!0,this.vbStream)return this.postMessage({cmd:a.VB_EVENT_TYPE.VB_GENERATE_STREAM}),this.vbStream;if(window.MediaStreamTrackGenerator)this.vbTrackGenerator=new MediaStreamTrackGenerator({kind:"video"}),this.vbStream=new MediaStream([this.vbTrackGenerator]);else{if(this.streamCanvas=document.createElement("canvas"),this.videoStream){const t=this.videoStream.getVideoTracks()[0];if(t){const{width:e=0,height:r=0}=t.getSettings();this.streamCanvas.width=e,this.streamCanvas.height=r}}this.vbStream=this.streamCanvas.captureStream(24)}return this.isVBReady&&this.generateVBStream(),this.vbStream}stopStream(){this.vbStream&&(this.isStreamEnabled=!1,this.postMessage({cmd:a.VB_EVENT_TYPE.VB_STOP_STREAM}))}}if(c.VB_WORKER_NAME="vb_worker",c.VB_CAPTURE_VIDEO="VB_CAPTURE_VIDEO",c.VB_STREAM_CANVAS="VB_STREAM_CANVAS",c.EXTERNAL_EVENTS=new Set([a.VB_EVENT_TYPE.VB_GENERATED_FRAME,a.VB_EVENT_TYPE.VB_INIT_FAILED,a.VB_EVENT_TYPE.VB_INIT_SUCCESS,a.VB_EVENT_TYPE.VB_MODEL_READY,a.VB_EVENT_TYPE.VB_PREDICT_DONE,a.VB_EVENT_TYPE.VB_VIDEO_FORMAT_UNSUPPORTED,a.VB_EVENT_TYPE.VB_WORKER_ERROR,a.VB_EVENT_TYPE.VB_GENERATE_FIRST_FRAME]),e.default=c,document){const t=document.currentScript;if(t){const e=t.src;if(e){let t=e.indexOf("/vb.min.js");-1!==t&&(c.cdnPath=e.substring(0,t))}}}},function(t,e,r){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.VB_EVENT_TYPE=void 0,function(t){t.VB_INIT_SUCCESS="VB_INIT_SUCCESS",t.VB_INIT_FAILED="VB_INIT_FAILED",t.VB_GENERATED_FRAME="VB_GENERATED_FRAME",t.VB_SEND_FRAME="VB_SEND_FRAME",t.VB_UPDATE_BG="VB_UPDATE_BG",t.VB_PREDICT_DONE="VB_PREDICT_DONE",t.VB_MODEL_READY="VB_MODEL_READY",t.VB_FREE_MEMORY="VB_FREE_MEMORY",t.VB_VIDEO_FORMAT_UNSUPPORTED="VB_VIDEO_FORMAT_UNSUPPORTED",t.VB_WORKER_INIT="VB_WORKER_INIT",t.VB_WORKER_ERROR="VB_WORKER_ERROR",t.VB_RENDER_CANVAS="VB_RENDER_CANVAS",t.VB_RENDER_FRAME="VB_RENDER_FRAME",t.VB_START="VB_START",t.VB_REQUEST_FRAME="VB_REQUEST_FRAME",t.VB_TOGGLE_VB="VB_TOGGLE_VB",t.VB_STOP="VB_STOP",t.VB_MIRROR="VB_MIRROR",t.VB_GENERATE_STREAM="VB_GENERATE_STREAM",t.VB_STOP_STREAM="VB_STOP_STREAM",t.VB_CHANGE_STREAM_CANVAS_SIZE="VB_CHANGE_STREAM_CANVAS_SIZE",t.VB_GENERATE_FIRST_FRAME="VB_GENERATE_FIRST_FRAME",t.VB_UPDATE_FPS="VB_UPDATE_FPS",t.VB_UPDATE_NEED_FRAME="VB_UPDATE_NEED_FRAME",t.VB_UPDATE_FRAME_RATE="VB_UPDATE_FRAME_RATE"}(i||(e.VB_EVENT_TYPE=i={}))},function(t,e,r){"use strict";r.r(e);let i=function(){};i.prototype={threads:async()=>(async t=>{if(!WebAssembly.validate(t))return!1;try{return(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),!0}catch(t){return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),simd:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]))},e.default=new i},function(t,e,r){"use strict";r.r(e),r.d(e,"START_MEDIA",(function(){return i})),r.d(e,"ADD_RENDER_VIDEO",(function(){return n})),r.d(e,"STOP_RENDER_VIDEO",(function(){return o})),r.d(e,"START_CAPTURE_VIDEO",(function(){return a})),r.d(e,"STOP_CAPTURE_VIDEO",(function(){return s})),r.d(e,"ADD_RENDER_AUDIO",(function(){return u})),r.d(e,"STOP_RENDER_AUDIO",(function(){return E})),r.d(e,"UNMUTE_AUDIO",(function(){return _})),r.d(e,"MUTE_AUDIO",(function(){return c})),r.d(e,"CHANGE_FRAME_RATE",(function(){return d})),r.d(e,"CHANGE_VIDEO_RESOLUTION",(function(){return h})),r.d(e,"CHANGE_AUDIO_SPEAKER",(function(){return T})),r.d(e,"CHANGE_VIDEO_CAPTURE_DEVICE",(function(){return R})),r.d(e,"CHANGE_CURRENT_ACTIVE_SSRC",(function(){return f})),r.d(e,"REMOVE_AUDIO_CAPTURE",(function(){return A})),r.d(e,"LEAVE_MEETING",(function(){return l})),r.d(e,"MEETING_FAIL_OVER",(function(){return O})),r.d(e,"END_MEDIA",(function(){return I})),r.d(e,"CHANGE_AUDIO_MIC",(function(){return S})),r.d(e,"WEBRTC_RESTART",(function(){return D})),r.d(e,"REMOVE_RENDER_AUDIO",(function(){return N})),r.d(e,"LEAVE_COMPUTER_AUDIO",(function(){return p})),r.d(e,"JOIN_COMPUTER_AUDIO",(function(){return m})),r.d(e,"START_SHARING",(function(){return C})),r.d(e,"STOP_SHARING",(function(){return g})),r.d(e,"SWITCH_CANVAS_FOR_VIDEO_CAPTURE",(function(){return v})),r.d(e,"START_REMOTE_CONTROL",(function(){return U})),r.d(e,"UPDATE_REMOTE_CONTROL_PROPERTIES",(function(){return V})),r.d(e,"CANCEL_REMOTE_CONTROL",(function(){return x})),r.d(e,"UPDATE_SUBSCRIBE_VIDEO",(function(){return M})),r.d(e,"START_DESKTOP_SHARING",(function(){return L})),r.d(e,"START_SHARING_WHITEBOARD",(function(){return P})),r.d(e,"STOP_DESKTOP_SHARING",(function(){return B})),r.d(e,"STOP_SHARING_WHITEBOARD",(function(){return b})),r.d(e,"PAUSE_DESKTOP_SHARING",(function(){return F})),r.d(e,"RESUME_DESKTOP_SHARING",(function(){return G})),r.d(e,"CHECK_CHROME_SHARING_EXTENSION",(function(){return y})),r.d(e,"SWITCH_CANVAS_FOR_SHARING_CAPTURE",(function(){return w})),r.d(e,"CHANGE_CURRENT_SHARING_ACTIVE_SSRC",(function(){return k})),r.d(e,"COMMAND_SOCKET_MESSAGE_NOTIFY",(function(){return H})),r.d(e,"RESEND_REMOTE_CONTROL_POSITION_PDU",(function(){return W})),r.d(e,"AES_GCM_IV_VALUE",(function(){return Y})),r.d(e,"USER_NODE_LIST",(function(){return K})),r.d(e,"UPDATE_SHARING_DECODE_PARAM",(function(){return X})),r.d(e,"PAUSE_OR_RESUME_AUDIO_DECODE",(function(){return j})),r.d(e,"UPDATE_CANVAS_SIZE",(function(){return Z})),r.d(e,"CLEAR_CANVAS",(function(){return Q})),r.d(e,"ZOOM_RENDER",(function(){return z})),r.d(e,"CHANGE_SHARING_2ND_VIDEO_CAPTUREVIDEO_DEVICE",(function(){return J})),r.d(e,"SET_OTHER_AUDIO_VOLUME_LEVEL",(function(){return q})),r.d(e,"USER_NODE_AUDIO_STATUS_LIST",(function(){return $})),r.d(e,"UPDATE_MASK_CANVAS_SIZE",(function(){return tt})),r.d(e,"MOVE_PTZ_CAMERA",(function(){return et})),r.d(e,"START_STOP_REMOTE_CONTROL_CHECK",(function(){return rt})),r.d(e,"SEND_REMOTE_CONTROL_QR_CODE",(function(){return it})),r.d(e,"AUDIO_CC_SELECT_LANGUAGE",(function(){return nt})),r.d(e,"AUIOD_INTERPRETATION_MUTE",(function(){return ot})),r.d(e,"AUDIO_INTERPRETATION_SELECT_LANGUAGE",(function(){return at})),r.d(e,"AUDIO_INTERPRETATION_LIST_INFO",(function(){return st})),r.d(e,"AUDIO_INTERPRETATION_ENABLE",(function(){return ut})),r.d(e,"VIDEO_MASK_SETTING",(function(){return Et})),r.d(e,"UPDATE_BG_IMAGE",(function(){return _t})),r.d(e,"UPDATE_MASK_INFO",(function(){return ct})),r.d(e,"FINISH_MASK_SETTING",(function(){return dt})),r.d(e,"START_VIDEO_STREAM_IN_MASK_SETTING_SUCCESS",(function(){return ht})),r.d(e,"VIDEO_ENABLE_DECODE_HW",(function(){return Tt})),r.d(e,"VIDEO_ENABLE_ENCODE_HW",(function(){return Rt})),r.d(e,"JOIN_DESKTOP_AUDIO",(function(){return ft})),r.d(e,"LEAVE_DESKTOP_AUDIO",(function(){return At})),r.d(e,"SET_DESKTOP_VOLUME",(function(){return lt})),r.d(e,"MIRROR_MY_VIDEO",(function(){return Ot})),r.d(e,"REMOVE_EXPIRED_CANVAS",(function(){return It})),r.d(e,"WEBGL_LOST_REPLACE_CANVAS",(function(){return St})),r.d(e,"UPDATE_VIDEO_QUALITY",(function(){return Dt})),r.d(e,"SEND_RENDER_LOG",(function(){return Nt})),r.d(e,"USER_NODE_LIST_IN_MAIN_SESSION",(function(){return pt})),r.d(e,"UPDATE_MEDIA_PARAMS",(function(){return mt})),r.d(e,"SHARING_ADD_REV_CHANNEL_TYPE",(function(){return Ct})),r.d(e,"SHARING_REMOVE_REV_CHANNEL_TYPE",(function(){return gt})),r.d(e,"BUILD_MS_CHANNEL_IN_BO",(function(){return vt})),r.d(e,"BUILD_MA_CHANNEL_IN_BO",(function(){return Ut})),r.d(e,"ENABLE_SHARE_TO_BO",(function(){return Vt})),r.d(e,"ENABLE_BROADCAST_TO_BO",(function(){return xt})),r.d(e,"SWITCH_WATER_MARK_FLAG",(function(){return Mt})),r.d(e,"START_VIDEO_VB_SETTING",(function(){return Lt})),r.d(e,"UPDATE_VIDEO_VB_BG_IMAGE",(function(){return Pt})),r.d(e,"STOP_VIDEO_VB_SETTING",(function(){return Bt})),r.d(e,"START_VIDEO_STREAM_IN_VB_SETTING_SUCCESS",(function(){return bt})),r.d(e,"SWITCH_MASK_AND_VB",(function(){return Ft})),r.d(e,"VB_MODEL_PRELOADING_3S",(function(){return Gt})),r.d(e,"VB_MODEL_PRELOADING_10S",(function(){return yt})),r.d(e,"VB_MODEL_PRELOADING_OK",(function(){return wt})),r.d(e,"ENABLE_VIDEO_OBSERVER",(function(){return kt})),r.d(e,"SWITCH_SHARING_TYPE",(function(){return Ht})),r.d(e,"CHANGE_HID_ENABLE",(function(){return Wt})),r.d(e,"ADD_VIDEO_VB_SETTING_DOM",(function(){return Yt})),r.d(e,"REMOVE_VIDEO_VB_SETTING_DOM",(function(){return Kt})),r.d(e,"NEW_ACTIVE_SPEAKER_SSRC",(function(){return Xt})),r.d(e,"NEW_ACTIVE_SPEAKER_FIRST_FRAME_CALLBACK",(function(){return jt})),r.d(e,"CANCEL_NEW_ACTIVE_SPEAKER_BEFORE_CALL_BACK",(function(){return Zt})),r.d(e,"NOTIFY_SDK_JOIN_RWG_SUCCESS",(function(){return Qt})),r.d(e,"AUDIO_BRIDGE_FIRST_RECV_DATA",(function(){return zt})),r.d(e,"AUDIO_BRIDGE_CAN_SEND_DATA",(function(){return Jt})),r.d(e,"FIRST_VIDEO_FRAME",(function(){return qt})),r.d(e,"PREVIEW_INIT_VIDEO_DECODE_SUCCESS",(function(){return $t})),r.d(e,"PREVIEW_INIT_AUDIO_DECODE_SUCCESS",(function(){return te})),r.d(e,"WHITEBOARD_JOIN_MESSAGE",(function(){return ee})),r.d(e,"AUDIO_DENOISE_SWITCH",(function(){return re})),r.d(e,"SET_CODEC_MODE",(function(){return ie})),r.d(e,"STOP_AUDIO_INCOMING",(function(){return ne})),r.d(e,"MOBILE_ROTATE",(function(){return oe})),r.d(e,"SAVE_LOCAL_LOG",(function(){return ae})),r.d(e,"CHANGE_AUDIO_PROFILE",(function(){return se})),r.d(e,"AUDIO_JOIN_SUCCESS",(function(){return ue})),r.d(e,"SHARE_2ND_AUDIO_CAPTURE_DEVICE",(function(){return Ee})),r.d(e,"SUBSCRIBE_VIDEO",(function(){return _e})),r.d(e,"UNSUBSCRIBE_VIDEO",(function(){return ce})),r.d(e,"UI_SUBSCRIBE_VIDEO",(function(){return de})),r.d(e,"UI_UNSUBSCRIBE_VIDEO",(function(){return he})),r.d(e,"MOBILE_CAPTURE_DEVICE_CHANGE",(function(){return Te})),r.d(e,"ON_HOLD",(function(){return Re})),r.d(e,"SET_ALL_SPEECH_VOLUME",(function(){return fe})),r.d(e,"ENABLE_FILE_AUDIO_PLAYBACK_LOCALLY",(function(){return Ae})),r.d(e,"START_ANNOTATION_A",(function(){return le})),r.d(e,"ANNOTATION_ACTIONS",(function(){return Oe})),r.d(e,"STOP_ANNOTATION_A",(function(){return Ie})),r.d(e,"START_ANNOTATION_SUCCESS",(function(){return Se})),r.d(e,"INIT_SUCCESS",(function(){return De})),r.d(e,"INIT_SUCCESS_VIDEO",(function(){return Ne})),r.d(e,"INIT_SUCCESS_AUDIO",(function(){return pe})),r.d(e,"INIT_SUCCESS_SHARING",(function(){return me})),r.d(e,"USER_GRANT_CAPTURE_AUDIO",(function(){return Ce})),r.d(e,"CURRENT_VIDEO_RESOLUTION",(function(){return ge})),r.d(e,"SHARING_DEC_THREAD_OK",(function(){return ve})),r.d(e,"SHARING_DATA",(function(){return Ue})),r.d(e,"SHARING_PARA",(function(){return Ve})),r.d(e,"SHARING_MORE_INFO",(function(){return xe})),r.d(e,"VIDEO_DECODE_MAX_SIZE",(function(){return Me})),r.d(e,"CURRENT_CAPTURE_VIDEO_WIDTH_HEIGHT",(function(){return Le})),r.d(e,"START_VIDEO_CAPTURE_SUCCESS",(function(){return Pe})),r.d(e,"STOP_VIDEO_CAPTURE_SUCCESS",(function(){return Be})),r.d(e,"START_REMOTE_CONTROL_SUCCESS",(function(){return be})),r.d(e,"CANCEL_REMOTE_CONTROL_SUCCESS",(function(){return Fe})),r.d(e,"REMOTE_CONTROL_COPIED_TEXT_NOTIFY",(function(){return Ge})),r.d(e,"MONITOR_LOG",(function(){return ye})),r.d(e,"CURRENT_DESKTOP_SHARING_WIDTH_HEIGHT",(function(){return we})),r.d(e,"DESKTOP_SHARING_CAPTURE_SUCCESS",(function(){return ke})),r.d(e,"CHECK_CHROME_SHARING_EXTENSION_RESPONSE",(function(){return He})),r.d(e,"SHARING_DECODE_MAX_SIZE",(function(){return We})),r.d(e,"REQUEST_AUDIO_BRIDGE_TOKEN",(function(){return Ye})),r.d(e,"SEND_MESSAGE_TO_RWG",(function(){return Ke})),r.d(e,"AES_GCM_IV_RESPONSE",(function(){return Xe})),r.d(e,"WCL_SIP_CREATE_SUCCESS",(function(){return je})),r.d(e,"SHARING_DESKTOP_STREAM_HAVE_AUDIO",(function(){return Ze})),r.d(e,"JOIN_COMPUTER_AUDIO_COMPLETE",(function(){return Qe})),r.d(e,"JOIN_DESKTOP_AUDIO_COMPLETE",(function(){return ze})),r.d(e,"LEAVE_COMPUTER_AUDIO_COMPLETE",(function(){return Je})),r.d(e,"LEAVE_DESKTOP_AUDIO_COMPLETE",(function(){return qe})),r.d(e,"HID_STATUS_MUTE",(function(){return $e})),r.d(e,"HID_STATUS_OFF_HOOK",(function(){return tr})),r.d(e,"WB_MESSAGE",(function(){return er})),r.d(e,"AUDIO_STREAM_FAILED",(function(){return rr})),r.d(e,"VIDEO_STREAM_FAILED",(function(){return ir})),r.d(e,"AUDIO_SPEAKER_SET_SUCCESS",(function(){return nr})),r.d(e,"FIRST_IOS_FRAME",(function(){return or})),r.d(e,"AUDIOBRIDGE_EBABLE_SHARE_TO_BO_SUCCESS",(function(){return ar})),r.d(e,"AUDIOBRIDGE_SET_CC_LANG_SUCCESS",(function(){return sr})),r.d(e,"AUDIOBRIDGE_ENABLE_BROADCAST_TO_BO_SUCCESS",(function(){return ur})),r.d(e,"AUDIO_LEVEL_INDICATOR",(function(){return Er})),r.d(e,"SYNC_RENDERER_TYPE_RESPONSE",(function(){return _r})),r.d(e,"INIT_FAILED",(function(){return cr})),r.d(e,"INIT_FAILED_VIDEO",(function(){return dr})),r.d(e,"INIT_FAILED_AUDIO",(function(){return hr})),r.d(e,"INIT_FAILED_SHARING",(function(){return Tr})),r.d(e,"USER_FORBIDDED_CAPTURE_AUDIO",(function(){return Rr})),r.d(e,"AUDIO_WEBSOCKET_BROKEN",(function(){return fr})),r.d(e,"VIDEO_WEBSOCKET_BROKEN",(function(){return Ar})),r.d(e,"SHARING_DEC_THREAD_FAILED",(function(){return lr})),r.d(e,"AUDIO_ZERO_DATA",(function(){return Or})),r.d(e,"AUDIO_CTX_SAMPLERATE",(function(){return Ir})),r.d(e,"USER_FORBIDDED_CAPTURE_VIDEO",(function(){return Sr})),r.d(e,"USER_CAMERA_IS_TAKEN_BY_OTHER_PROGRAMS",(function(){return Dr})),r.d(e,"STOP_VIDEO_CAPTURE_FAILED",(function(){return Nr})),r.d(e,"START_REMOTE_CONTROL_FAILED",(function(){return pr})),r.d(e,"CANCEL_REMOTE_CONTROL_FAILED",(function(){return mr})),r.d(e,"REMOTE_CONTROL_PASTE_TEXT_LENGTH_OVERFLOW",(function(){return Cr})),r.d(e,"USER_STOP_DESKTOP_SHARING",(function(){return gr})),r.d(e,"USER_CANCEL_PERMISSION_REQUEST",(function(){return vr})),r.d(e,"DESKTOP_SHARING_CHROME_EXTENSION_UNINSTALLED",(function(){return Ur})),r.d(e,"DESKTOP_SHARING_PERMISSION_DENIED",(function(){return Vr})),r.d(e,"DESKTOP_SHARING_TIME_OUT",(function(){return xr})),r.d(e,"DESKTOP_SHARING_ERROR",(function(){return Mr})),r.d(e,"AUDIO_SPEAKER_SET_ERROR",(function(){return Lr})),r.d(e,"DESKTOP_SHARING_SYSTEM_ERROR",(function(){return Pr})),r.d(e,"AUDIO_CLIPPING",(function(){return Br})),r.d(e,"AUDIO_AUTO_PLAY_FAILED",(function(){return br})),r.d(e,"WCL_SIP_HUNGUP_FAILED",(function(){return Fr})),r.d(e,"WCL_SIP_WEBSOCKET_DISCONNECTED",(function(){return Gr})),r.d(e,"WCL_SIP_WEBSOCKET_CONNECT_ERROR",(function(){return yr})),r.d(e,"SHARING_DESKTOP_STREAM_HAVE_NO_AUDIO",(function(){return wr})),r.d(e,"WCL_AUDIO_BRIDGE_RECONNECT_START",(function(){return kr})),r.d(e,"WCL_AUDIO_BRIDGE_RECONNECT_END",(function(){return Hr})),r.d(e,"WCL_SIP_REJECT_INVITE",(function(){return Wr})),r.d(e,"WEBGL_LOST_IN_MULTI_VIEW",(function(){return Yr})),r.d(e,"MASK_SETTING_PARA_ERROR",(function(){return Kr})),r.d(e,"VIDEO_VB_SETTING_PARA_ERROR",(function(){return Xr})),r.d(e,"NOTIFY_UI_FAILOVER",(function(){return jr})),r.d(e,"AUDIO_CONNECT_HID_JOIN_FAILED",(function(){return Zr})),r.d(e,"JOIN_COMPUTER_AUDIO_FAILURE",(function(){return Qr})),r.d(e,"AUDIOBRIDGE_EBABLE_BROADCAST_TO_BO_FAILURE",(function(){return zr})),r.d(e,"AUDIOBRIDGE_SET_CC_LANG_FAILURE",(function(){return Jr})),r.d(e,"AUDIOBRIDGE_EBABLE_SHARE_TO_BO_FAILURE",(function(){return qr})),r.d(e,"AUDIO_MIC_SET_ERROR",(function(){return $r})),r.d(e,"NOTIFY_UI_WMSC_FAILOVER",(function(){return ti})),r.d(e,"NOTIFY_UI_WMSC_WSS_DISCONNECTED",(function(){return ei})),r.d(e,"RECOVER_WEBRTC_AUDIO",(function(){return ri})),r.d(e,"MEDIA_HEALTH_CHECK_FAILED",(function(){return ii})),r.d(e,"START_ANNOTATION_FAILED",(function(){return ni})),r.d(e,"AUDIO_STOP",(function(){return oi})),r.d(e,"AUDIO_START",(function(){return ai})),r.d(e,"AUDIO_REMOVE",(function(){return si})),r.d(e,"AUDIO_ILLEGAL",(function(){return ui})),r.d(e,"SHARING_PARAM_INFO_FROM_SOCKET",(function(){return Ei})),r.d(e,"VIDEO_DATA_FROM_WORKER",(function(){return _i})),r.d(e,"AUDIO_DATA_FROM_WORKER",(function(){return ci})),r.d(e,"VIDEO_ENCODE_DATA_FROM_WORKER",(function(){return di})),r.d(e,"ZOOM_CONNECTION_VIDEO_OFFER_EVT",(function(){return hi})),r.d(e,"ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT",(function(){return Ti})),r.d(e,"ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT",(function(){return Ri})),r.d(e,"ZOOM_CONNECTION_REMOVE_UDP_EVT",(function(){return fi})),r.d(e,"EVT_TYPE_WS_VIDEO_DATACHANNEL_ANSWER",(function(){return Ai})),r.d(e,"WS_CONF_AB_TOKEN_REQ",(function(){return li})),r.d(e,"WS_CONF_AB_TOKEN_RES",(function(){return Oi})),r.d(e,"WS_CONF_END_INDICATION",(function(){return Ii})),r.d(e,"WS_VIDEO_MULTI_SUBSCRIBE_REQ",(function(){return Si})),r.d(e,"WS_VIDEO_MULTI_UNSUBSCRIBE_REQ",(function(){return Di})),r.d(e,"RWG_MONITOR_LOG_EVENT",(function(){return Ni})),r.d(e,"WS_CONF_WCL_SET_FULL_HD_REQ",(function(){return pi})),r.d(e,"PUBSUB_EVT",(function(){return mi})),r.d(e,"SHARING_FIRST_DECODE_FRAME_RECEIVED_SSRC",(function(){return Ci})),r.d(e,"HAVE_NO_WATERMARK",(function(){return gi})),r.d(e,"HAVE_WATERMARK",(function(){return vi})),r.d(e,"DATA_DIRECTION_FROM_RECEIVE",(function(){return Ui})),r.d(e,"DATA_DIRECTION_FROM_SEND",(function(){return Vi})),r.d(e,"RWG_WCL_PDU_QOS_DATA",(function(){return xi})),r.d(e,"RWG_WCL_PDU_QOS_DATA_VIDEO",(function(){return Mi})),r.d(e,"SPEAKING_WHEN_MUTE",(function(){return Li})),r.d(e,"AUDIO_QOS_DATA",(function(){return Pi})),r.d(e,"VIDEO_QOS_DATA",(function(){return Bi})),r.d(e,"VIDEOSHARE_QOS_DATA",(function(){return bi})),r.d(e,"NETWORK_QUALITY_CHANGE",(function(){return Fi})),r.d(e,"NETWORK_QUALITY_CHANGE_AUDIO",(function(){return Gi})),r.d(e,"sdkIvTypeKeyEnum",(function(){return yi})),r.d(e,"CURRENT_DECODE_VIDEO_QUALITY",(function(){return wi})),r.d(e,"CURRENT_DECODE_VIDEO_FPS",(function(){return ki})),r.d(e,"ENABLE_REUSE_STREAM",(function(){return Hi})),r.d(e,"PRESET_MEDIA_CONSTRAINTS",(function(){return Wi})),r.d(e,"DESTORY_REUSE_STREAM",(function(){return Yi})),r.d(e,"VB_SETTING_PARA_ERROR_TYPE",(function(){return Ki})),r.d(e,"AUDIO_STREAM_MUTED",(function(){return Xi})),r.d(e,"AUDIO_STREAM_UNMUTED",(function(){return ji})),r.d(e,"EXPOSE_VB_FRAME",(function(){return Zi})),r.d(e,"UNIFIED_VB_FRAME",(function(){return Qi})),r.d(e,"UNIFIED_VB_STOP",(function(){return zi})),r.d(e,"UNIFIED_VB_PAUSE",(function(){return Ji})),r.d(e,"UNIFIED_VB_ACK",(function(){return qi})),r.d(e,"ANNO_UNDO_STATUS",(function(){return $i})),r.d(e,"ANNO_REDO_STATUS",(function(){return tn}));const i=0,n=1,o=2,a=3,s=4,u=5,E=6,_=7,c=8,d=9,h=10,T=11,R=12,f=13,A=14,l=15,O=16,I=17,S=18,D=19,N=20,p=21,m=22,C=23,g=24,v=25,U=26,V=27,x=28,M=29,L=30,P=30.1,B=31,b=31.1,F=32,G=33,y=34,w=35,k=36,H=40,W=41,Y=42,K=43,X=44,j=45,Z=46,Q=47,z=48,J=49,q=50,$=51,tt=52,et=53,rt=54,it=55,nt=57,ot=58,at=59,st=60,ut=61,Et=62,_t=63,ct=64,dt=65,ht=66,Tt=70,Rt=71,ft=72,At=73,lt=74,Ot=75,It=76,St=77,Dt=78,Nt=79,pt=80,mt=81,Ct=82,gt=83,vt=84,Ut=85,Vt=86,xt=87,Mt=90,Lt=91,Pt=92,Bt=93,bt=94,Ft=95,Gt=96,yt=97,wt=98,kt=99,Ht=101,Wt=100,Yt=102,Kt=103,Xt=110,jt=111,Zt=112,Qt=113,zt=114,Jt=115,qt=116,$t=117,te=118,ee=120,re=121,ie=122,ne=123,oe=124,ae=125,se=126,ue=127,Ee=129,_e=130,ce=131,de=132,he=133,Te=135,Re=136,fe=137,Ae=138,le=150,Oe=152,Ie=156,Se=158,De=1,Ne=1.1,pe=1.2,me=1.3,Ce=2,ge=3,ve=4,Ue=5,Ve=6,xe=6.1,Me=7,Le=8,Pe=9,Be=10,be=11,Fe=12,Ge=13,ye=14,we=15,ke=16,He=17,We=18,Ye=19,Ke=20,Xe=21,je=22,Ze=23,Qe=24,ze=25,Je=26,qe=27,$e=28,tr=29,er=30,rr=31,ir=32,nr=33,or=34,ar=35,sr=36,ur=37,Er=38,_r=39,cr=-1,dr=-1.1,hr=-1.2,Tr=-1.3,Rr=-2,fr=-3,Ar=-4,lr=-5,Or=-6,Ir=-7,Sr=-8,Dr=-9,Nr=-10,pr=-11,mr=-12,Cr=-14,gr=-15,vr=-16,Ur=-17,Vr=-18,xr=-19,Mr=-20,Lr=-21,Pr=-22,Br=-23,br=-24,Fr=-25,Gr=-26,yr=-28,wr=-27,kr=-29,Hr=-31,Wr=-30,Yr=-32,Kr=-33,Xr=-34,jr=-35,Zr=-24,Qr=-37,zr=-38,Jr=-39,qr=-40,$r=-41,ti=-42,ei=-43,ri=-44,ii=-129,ni=-130,oi=0,ai=1,si=2,ui=-1,Ei="SHARING_PARAM_INFO_FROM_SOCKET",_i="VIDEO_DATA_FROM_WORKER",ci="AUDIO_DATA_FROM_WORKER",di="VIDEO_ENCODE_DATA_FROM_WORKER",hi=24321,Ti=24322,Ri=24322,fi=24323,Ai=24322,li=4300,Oi=4299,Ii=7939,Si=12303,Di=12305,Ni=4167,pi=4355,mi={ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT:"ZOOM_CONNECTION_VIDEO_OFFER_RESPONSE_EVT",ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT:"ZOOM_CONNECTION_AUDIO_OFFER_RESPONSE_EVT",END_MEDIA:"END_MEDIA",DESTROY:"DESTROY",DC_COMING_MESSAGE:"DC_COMING_MESSAGE",AUDIO_BRIDGE_WS_TOKEN:"AUDIO_BRIDGE_WS_TOKEN"},Ci=70,gi=!1,vi=!0,Ui=0,Vi=1,xi=108,Mi=104,Li=121,Pi="AUDIO_QOS_DATA",Bi="VIDEO_QOS_DATA",bi="VIDEOSHARE_QOS_DATA",Fi="NETWORK_QUALITY_CHANGE",Gi="NETWORK_QUALITY_CHANGE_AUDIO",yi={VIDEO_ENCODE:"0",VIDEO_DECODE:"1",AUDIO_ENCODE:"2",AUDIO_DECODE:"3",SHARING_ENCODE:"4",SHARING_DECODE:"5"},wi=66.5,ki=66.6,Hi="ENABLE_REUSE_STREAM",Wi="PRESET_MEDIA_CONSTRAINTS",Yi="DESTORY_REUSE_STREAM",Ki={FAIL:4},Xi="AUDIO_STREAM_MUTED",ji="AUDIO_STREAM_UNMUTED",Zi="EXPOSE_VB_FRAME",Qi="UNIFIED_VB_FRAME",zi="UNIFIED_VB_STOP",Ji="UNIFIED_VB_PAUSE",qi="UNIFIED_VB_ACK",$i="ANNO_UNDO_STATUS",tn="ANNO_REDO_STATUS"},function(t,e,r){"use strict";var i=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))((function(n,o){function a(t){try{u(i.next(t))}catch(t){o(t)}}function s(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((i=i.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(7)),a=r(0);e.default=class{constructor(t,e){this.isMirror=!1,this.display=new o.default(t,e,0,void 0,{preserveDrawingBuffer:!1},void 0,!1,!1)}renderFrame(t,e,r,i){if(this.display){let n={x:0,y:0,width:this.display.canvasElement.width,height:this.display.canvasElement.height};this.display.updateRemoteVideoTextures(t,e,i,r,0,!0,n,!1),this.display.drawRemoteVideo(n,this.isMirror)}}render(t){return i(this,void 0,void 0,(function*(){let e=a.VIDEO_RGBA;if("data_ptr"in t){const{data:e,format_width:r,format_height:i,valid_x:n,valid_y:o,valid_width:s,valid_height:u}=t;let E={top:o,left:n,width:s,height:u};this.display.setVideoMode(a.VIDEO_I420),this.renderFrame(r,i,e,E)}else if(self.VideoFrame&&t instanceof VideoFrame){const{format:r,visibleRect:i}=t;if(r&&i){if("I420"===r||"I420A"===r)e=a.VIDEO_I420;else if("NV12"===r)e=a.VIDEO_NV12;else{if("BGRA"!==r)return void(this.onUnsupportedFrame&&this.onUnsupportedFrame(r));e=a.VIDEO_BGRA}const{width:n,height:o}=i,s=new Uint8Array(t.allocationSize()),u={top:0,left:0,width:n,height:o};this.display.setVideoMode(e);try{yield t.copyTo(s),this.renderFrame(n,o,s,u)}catch(t){}t.close()}}else if(t instanceof ImageData){const{width:e,height:r}=t,i={top:0,left:0,width:e,height:r};this.display.setVideoMode(a.VIDEO_RGBA),this.renderFrame(e,r,t.data,i)}}))}updateSize(t,e){this.display.canvasElement.width=t,this.display.canvasElement.height=e}setMirror(t){this.isMirror=t}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.timer3s=null,this.timer10s=null,this.isVBPredictDone=!1,this.inited=!1}start(){this.inited=!0,this.clear(),this.timer3s=setTimeout(()=>{this.isVBPredictDone||this.ontimeout3s()},3e3),this.timer10s=setTimeout(()=>{this.isVBPredictDone||this.ontimeout10s()},1e4)}clear(){clearTimeout(this.timer3s),clearTimeout(this.timer10s),this.timer3s=null,this.timer10s=null}}},function(t,e,r){"use strict";r.r(e);var i=r(0);const n=t=>0==(t&t-1);var o=new class{constructor(){this._highFrequencyLogs={}}setInstance(t){this._instance=t}getMessageFromErrorOrEvent(t,e){let r=t;return e instanceof ErrorEvent?(e.filename&&(r+=" File: ".concat(e.filename)),(e.lineno||e.colno)&&(r+=" Line: ".concat(e.lineno,":").concat(e.colno)),e.message&&(r+=" Message: ".concat(e.message)),e.error&&(r+="\nStack: ".concat(e.error.stack))):e instanceof Error?(e.fileName&&(r+=" File: ".concat(e.fileName)),(e.lineNumber||e.columnNumber)&&(r+=" Line: ".concat(e.lineNumber,":").concat(e.columnNumber)),e.message&&(r+=" Message: ".concat(e.message)),e.stack&&(r+=" Stack: ".concat(e.stack)),e.name&&(r+=" Name: ".concat(e.name)),e.constraint&&(r+=" Constraint: ".concat(e.constraint))):e instanceof CloseEvent?(e.code&&(r+=" Code: ".concat(e.code)),e.reason&&(r+=" Reason: ".concat(e.reason)),r+=" wasClean: ".concat(e.wasClean)):e instanceof DOMException?(e.message&&(r+=" Message: ".concat(e.message)),e.name&&(r+=" Name: ".concat(e.name))):r+=e?e.toString():"",r}error(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t=this.getMessageFromErrorOrEvent(t,e),this._highFrequencyLogs[t]?this._highFrequencyLogs[t]+=1:this._highFrequencyLogs[t]=1;const r=n(this._highFrequencyLogs[t]);this._instance&&r&&this._instance.error(t)}severityerror(t,e){this._instance&&this._instance.error(JSON.stringify(t),e)}directReport(t,e){var r,i;this._instance&&(e||(e=["MEDIASDK_INFO"]),null===(r=(i=this._instance).directReport)||void 0===r||r.call(i,{msg:t},e))}warn(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t=this.getMessageFromErrorOrEvent(t,e),this._instance&&this._instance.warn(t)}log(t){this._instance&&this._instance.log(t)}clearHighFrequencyLogs(){this._highFrequencyLogs={}}};const a="undefined"!=typeof window;function s(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;a?o.error(t,e):u(t,e)}function u(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var r,i,n,o;(e instanceof Error||e instanceof ErrorEvent)&&(t+=" Message: "+(null===(r=e)||void 0===r?void 0:r.message)+" Stack: "+(null!==(i=null===(n=e)||void 0===n||null===(n=n.error)||void 0===n?void 0:n.stack)&&void 0!==i?i:null===(o=e)||void 0===o?void 0:o.stack),e=null);postMessage({status:61,errorMessage:t,errorEvent:e})}function E(t){postMessage({status:61,errorMessage:t,level:"low"})}const _=["","MOZ_","OP_","WEBKIT_"];function c(t,e){for(var r=0;r<_.length;++r){var i=_[r]+e,n=t.getExtension(i);if(n)return n}}new Map,new class{constructor(){this.ssrcInfoMap=new Map,this.timer=null}updateSSRCInfo(t,e){this.ssrcInfoMap.has(t)||this.ssrcInfoMap.set(t,{firstTime:0,lastTime:0,frames:0,fps:0}),this._calculateFPS(t,e),this._removeZeroFPS()}_calculateFPS(t,e){const r=this.ssrcInfoMap.get(t);if(0===r.frames?r.firstTime=e:r.lastTime=e,r.frames+=1,r.frames>2&&r.frames%5==0&&r.lastTime-r.firstTime>=1e3){const e=Math.floor(1e3/((r.lastTime-r.firstTime)/(r.frames-1)));r.fps!==e&&(this._notifyFPS(t,e),r.fps=e),r.firstTime=r.lastTime,r.frames=1}}_removeZeroFPS(){let t=Date.now();this.ssrcInfoMap.forEach((e,r)=>{const i=this.ssrcInfoMap.get(r);i&&t-i.lastTime>2e3&&(this.ssrcInfoMap.delete(r),this._notifyFPS(r,0))})}_notifyFPS(t,e){postMessage({status:66.6,data:{ssrc:t,fps:e}})}_checkIfNewFrameComing(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(()=>{this._removeZeroFPS(),this.timer=null},2500)}};function d(t,e){const r=Math.pow(10,e);return Math.floor(t*r)/r}function h(t,e){const r=Math.pow(10,e);return Math.ceil(t*r)/r}function T(t,e,r,i){return f(t,e),R(r,"set"),function(t,e,r){if(e.set)e.set.call(t,r);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=r}}(t,r,i),i}function R(t,e){if(void 0===t)throw new TypeError("attempted to "+e+" private static field before its declaration")}function f(t,e){if(t!==e)throw new TypeError("Private static access of wrong provenance")}class A{static isEnableCanvasCtxOptionsOpt(){return e=l,f(t=A,A),R(e,"get"),function(t,e){return e.get?e.get.call(t):e.value}(t,e);var t,e}static setIsEnableCanvasCtxOptionsOpt(t){T(A,A,l,t)}}var l={writable:!0,value:!1},O=A;let I=new Map,S=[];function D(t){t.preventDefault()}function N(t,e,r,n,o,a,s){let u=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.canvasElement=t,this.canvasID=e,this.contextOptions=o,this.textureindex=r||0,this.texturestride=this.textureindex?3:s?4:6,this.initmask=s||!1,this.reuse=!1,this.isEnableCanvasAlphaChannel=u,N.prototype.ROTATION_CLOCK0=0,N.prototype.ROTATION_CLOCK90=1,N.prototype.ROTATION_CLOCK180=2,N.prototype.ROTATION_CLOCK270=3,this.webGLResources=a,a||(this.initContextGL(),this.contextGL&&(this.webGLContextLostProtect(),this.contextGL.isContextLost()&&this.restoreContext())),this.reinit(a);var E=new ArrayBuffer(4);this.dummpyCursor=new Uint8Array(E),this.dummpyWaterMark=new Uint8Array(E),this.cursorWidth=0,this.cursorHeight=0,this.hasCursor=0,this.hasWaterMark=0,this.watermarkOpacity=.15,this.watermarkData=null,this.watermarkWidth=0,this.watermarkHeight=0,this.isMultiView=!1,this.hasWholeFrame=0,this.croppingParams={},this.croppingParams.top=0,this.croppingParams.left=0,this.croppingParams.width=0,this.croppingParams.height=0,this.textureWidth=0,this.textureHeight=0,this.canvasWidth=0,this.canvasHeight=0,this.picRotation=-1,this.bgColor=[0,0,0],this.cx=0,this.cy=0,this.cw=0,this.ch=0,this.colorRange=-1,this.videoMode=i.VIDEO_INVALID,this.rotation=this.ROTATION_CLOCK0,this.fillMode=0,this.fillModeForResolution=0}function p(t,e,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;var o=t.contextGL;let a=o.canvas.width,s=o.canvas.height;n&&(a=n.width,s=n.height);var u,E,_,c,d=i==t.ROTATION_CLOCK90||i==t.ROTATION_CLOCK270?r:e,h=i==t.ROTATION_CLOCK90||i==t.ROTATION_CLOCK270?e:r,T=d/h*s,R=h/d*a;T>a?(u=0,_=1,c=1-(E=(s-R)/2/s)):(E=0,c=1,_=1-(u=(a-T)/2/a)),u=2*u-1,_=2*_-1,E=1-2*E,c=1-2*c;var f=new Float32Array([_,E,u,E,_,c,u,c,_,E,u,E,_,c,u,c]);o.bindBuffer(o.ARRAY_BUFFER,t.vertexPosBuffer),o.bufferData(o.ARRAY_BUFFER,f,o.DYNAMIC_DRAW)}function m(t,e,r,i,n){var o=t.contextGL,a=i.top/r,s=i.left/e,u=a+(i.height-1)/r,E=s+i.width/e,_=[s,a,E,a,E,u,s,u];n==t.ROTATION_CLOCK90&&(_.unshift(_[6],_[7]),_=_.slice(0,8)),n==t.ROTATION_CLOCK180&&(_.unshift(_[4],_[5],_[6],_[7]),_=_.slice(0,8)),n==t.ROTATION_CLOCK270&&(_.push(_[0],_[1]),_=_.slice(2));var c=_[0],d=_[1];_[0]=_[2],_[1]=_[3],_[2]=c,_[3]=d;var h=new Float32Array([..._,1,0,0,0,1,1,0,1]);o.bindBuffer(o.ARRAY_BUFFER,t.texturePosBuffer),o.bufferData(o.ARRAY_BUFFER,h,o.DYNAMIC_DRAW)}N.prototype.reinit=function(t){if(this.webGLResources=t,!this.contextGL||this.contextGL.isContextLost()||this.contextGL.glInitSucceed||this.webGLResources){if(this.webGLResources&&this.webGLResources.contextgl&&!this.webGLResources.contextgl.isContextLost()){this.contextGL=this.webGLResources.contextgl,this.shaderProgram=this.webGLResources.program,this.waterMarkTextureRef=this.webGLResources.waterMarkTextureRef,this.repeatedWaterMarkTextureRef=this.webGLResources.repeatedWaterMarkTextureRef,this.initTextures(!1),this.vertexPosBuffer=this.webGLResources.vBuffer,this.texturePosBuffer=this.webGLResources.tBuffer;let t=this.contextGL.getError();this.contextGL.glInitSucceed=t!=this.contextGL.NO_ERROR&&t!=this.contextGL.CONTEXT_LOST_WEBGL?0:1}}else{this.initProgram(),this.initmask?this.initTextures(!1):this.initTextures(!0),this.initBuffers();let t=this.contextGL.getError();this.contextGL.glInitSucceed=t!=this.contextGL.NO_ERROR&&t!=this.contextGL.CONTEXT_LOST_WEBGL?0:1}},N.prototype.webGLContextLostSimulate=function(){let t="undefined"==typeof window?self:window;t.webGLEXTSimulate=t.webGLEXTSimulate||[],t.webGLEXTSimulate.push(c(this.contextGL,"WEBGL_lose_context"))},N.prototype.restoreContext=function(){if(this.contextGL)try{var t,e;if(null!==(t=this.canvasElement)&&void 0!==t&&t.loseContextExtension&&this.contextGL.isContextLost())null===(e=this.canvasElement)||void 0===e||e.loseContextExtension.restoreContext()}catch(t){s("webgl restoreContext exception",t)}},N.prototype.webgGLContextLostCallback=function(t){E("webglcontextlost event: canvas listener size=".concat(S.length,",  canvas id: ").concat(this.canvasID,", , ids:").concat(S.join())),t.preventDefault(),this.contextGL.glInitSucceed=0,this.contextOptions&&this.contextOptions.webglcontextlostCallback&&this.contextOptions.webglcontextlostCallback(t,this.contextOptions.params)},N.prototype.removeEventListener=function(t,e){if(t&&e){0,t.removeEventListener("webglcontextlost",e.contextLostHandler),t.removeEventListener("webglcontextrestored",e.contextRestoredHandler);const r=S.indexOf(this.canvasID);S.splice(r,1),I.delete(t)}},N.prototype.webGLContextRestoredCallback=function(t){E("webglcontextrestored event from canvas id: ".concat(this.canvasID)),this.reinit(),this.contextOptions&&this.contextOptions.webglcontextrestoredCallback&&this.contextOptions.webglcontextrestoredCallback(t,this.contextOptions.params)},N.prototype.webGLContextLostProtect=function(){this.canvasElement&&!this.canvasElement.loseContextExtension&&(this.canvasElement.loseContextExtension=c(this.contextGL,"WEBGL_lose_context"));let t=this.canvasElement,e=I.get(t);e&&this.removeEventListener(t,e),I.set(t,this),this.contextLostHandler=this.webgGLContextLostCallback.bind(this),this.contextRestoredHandler=this.webGLContextRestoredCallback.bind(this),t.addEventListener("webglcontextlost",this.contextLostHandler,{capture:!1}),t.addEventListener("webglcontextrestored",this.contextRestoredHandler,{capture:!1}),-1===S.indexOf(this.canvasID)&&(S.push(this.canvasID),S.length>4&&E("webglcanvas listener size=".concat(S.length,", ids:").concat(S.join())))},N.prototype.isWebGL=function(){return this.contextGL},N.prototype.isAvaiable=function(){return this.contextGL&&!this.contextGL.isContextLost()&&this.contextGL.glInitSucceed},N.prototype.initContextGL=function(){for(var t,e,r=this.canvasElement,i=null,n=["webgl","experimental-webgl","moz-webgl","webkit-3d"],o=0;!i&&o<n.length;){var a=n[o];try{if(O.isEnableCanvasCtxOptionsOpt()){let t={depth:!1,stencil:!1,antialias:!1,alpha:this.isEnableCanvasAlphaChannel};if(this.contextOptions){let e={...this.contextOptions,...t};i=r.getContext(a,e)}else i=r.getContext(a,t)}else i=this.contextOptions?r.getContext(a,this.contextOptions):r.getContext(a)}catch(t){i=null}i&&"function"==typeof i.getParameter||(i=null),++o}(this.contextGL=i,i)?i.glInitSucceed=0:s("Failed when trying to get WebGLContext on canvas(".concat(null===(t=this.canvasElement)||void 0===t?void 0:t.width,",").concat(null===(e=this.canvasElement)||void 0===e?void 0:e.height,")"))},N.prototype.initProgram=function(){var t=this.contextGL,e=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 masktexturePos;","varying vec2 textureCoord;","varying vec2 masktextureCoord;","void main()","{","gl_Position = vertexPos;","textureCoord = texturePos.xy;","masktextureCoord = masktexturePos.xy;","}"].join("\n"),r=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 masktextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform sampler2D cursorSampler;","uniform sampler2D waterMarkSampler;","uniform sampler2D  previewVideoSampler;","uniform sampler2D maskSampler;","uniform vec4 cursorInfo;","uniform int onlyRGBA;","uniform int bgraMode;","uniform int colorRange;","uniform int waterMarkFlag;","uniform int cursorFlag;","uniform int maskFlag;","uniform int yuvmode;","const mat4 YUV2RGB_L = mat4","(","1.1643828125, 0, 1.59602734375, -.87078515625,","1.1643828125, -.39176171875, -.81296875, .52959375,","1.1643828125, 2.017234375, 0, -1.081390625,","0, 0, 0, 1",");","const mat4 YUV2RGB_F = mat4","(","1.0, 0, 1.402, -.701,","1.0, -.34413, -.71414, .529135,","1.0, 1.772, 0, -.886,","0, 0, 0, 1",");","void main(void) {","vec4 c;","if(waterMarkFlag!=1) {","if(onlyRGBA==0){","highp float y = texture2D(ySampler,  textureCoord).r;","highp float u;","highp float v;","if(yuvmode==1){","u = texture2D(uSampler,  textureCoord).r;","v = texture2D(vSampler,  textureCoord).r;","}","else{","u = texture2D(uSampler,  textureCoord).r;","v = texture2D(uSampler,  textureCoord).a;","}","if (colorRange == 0)","{","  c = vec4(y, u, v, 1) * YUV2RGB_L;","} else {","  c = vec4(y, u, v, 1) * YUV2RGB_F;","}","if(cursorFlag==1)","{","if (cursorInfo.z > 0.0 && textureCoord.x >= cursorInfo.x && textureCoord.y >= cursorInfo.y && ","    textureCoord.x < cursorInfo.x+cursorInfo.z && textureCoord.y < cursorInfo.y+cursorInfo.w ){"," vec2 cursorCoord = textureCoord - cursorInfo.xy;"," cursorCoord /= cursorInfo.zw;"," vec4 cursor = texture2D(cursorSampler, cursorCoord);"," c = c*(1.0-cursor.a) + cursor*cursor.a;","}","}","}","else{"," c = texture2D(previewVideoSampler, textureCoord);","if(bgraMode==1)","{"," c = vec4(c.b, c.g, c.r, c.a);","}","}","}","if(waterMarkFlag==1)","{"," c = texture2D(waterMarkSampler, textureCoord);","if(c.r == 0.0 && c.g == 0.0 && c.b == 0.0){"," c.a = 0.0;","}","}","if(maskFlag==1 && waterMarkFlag!=1)","{","vec4 mask = texture2D(maskSampler, masktextureCoord);","if(mask.r != 0.0 || mask.g != 0.0 || mask.b != 0.0){","c = mask* mask.a+ c*(1.0-mask.a);","}","}","if (waterMarkFlag!=1){","c.a = 1.0;","}","gl_FragColor = c;","}"].join("\n"),i=t.createShader(t.VERTEX_SHADER);t.shaderSource(i,e),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)||t.isContextLost()||E("webgl Vertex shader failed to compile: "+t.getShaderInfoLog(i));var n=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,r),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)||t.isContextLost()||E("webgl Fragment shader failed to compile: "+t.getShaderInfoLog(n));var o=t.createProgram();t.attachShader(o,i),t.attachShader(o,n),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS)||t.isContextLost()||E("webgl Program failed to compile: "+t.getProgramInfoLog(o)),t.useProgram(o),this.shaderProgram=o},N.prototype.initBuffers=function(){var t=this.contextGL,e=this.shaderProgram,r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1,1,1,-1,1,1,-1,-1,-1]),t.STATIC_DRAW);var i=t.getAttribLocation(e,"vertexPos");t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0),this.vertexPosBuffer=r;var n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1,1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var o=t.getAttribLocation(e,"texturePos");if(t.enableVertexAttribArray(o),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),this.initmask&&!this.masktexturePosBuffer){var a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var s=t.getAttribLocation(e,"masktexturePos");t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),this.masktexturePosBuffer=a}this.texturePosBuffer=n},N.prototype.initTextures=function(t){var e=this.contextGL,r=this.shaderProgram;e.pixelStorei(e.UNPACK_ALIGNMENT,1);var n=this.initTexture();this.yTextureRef=n,this.oyTextureRef=n;var o=this.initTexture();this.uTextureRef=o,this.ouTextureRef=o;var a=this.initTexture();if(this.vTextureRef=a,this.ovTextureRef=a,t){this.BindTextures(i.VIDEO_I420);var s=this.initTexture(),u=e.getUniformLocation(r,"cursorSampler");e.uniform1i(u,this.textureindex*this.texturestride+3),this.cursorTextureRef=s;var E=this.initTexture(),_=e.getUniformLocation(r,"waterMarkSampler");e.uniform1i(_,4),this.waterMarkTextureRef=E;var c=this.initTexture();this.repeatedWaterMarkTextureRef=c;var d=this.initTexture(),h=e.getUniformLocation(r,"previewVideoSampler");e.uniform1i(h,this.textureindex*this.texturestride+5),this.previewVideoTextureRef=d;var T=e.getUniformLocation(r,"cursorInfo");this.cursorInfoRef=T}if(this.initmask){e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1);var R=this.initTexture(),f=e.getUniformLocation(r,"maskSampler");e.uniform1i(f,this.textureindex*this.texturestride+6),this.maskTextureRef=R}var A=e.getUniformLocation(r,"colorRange");this.colorRangeRef=A,this.onlyRGBARef=e.getUniformLocation(r,"onlyRGBA"),this.bgraModeRef=e.getUniformLocation(r,"bgraMode"),this.waterMarkFlagRef=e.getUniformLocation(r,"waterMarkFlag"),this.maskFlagRef=e.getUniformLocation(r,"maskFlag"),this.cursorFlagRef=e.getUniformLocation(r,"cursorFlag"),this.yuvmodeRef=e.getUniformLocation(r,"yuvmode")},N.prototype.BindTextures=function(t){var e=this.contextGL,r=this.shaderProgram;if(e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,this.yTextureRef),e.activeTexture(e.TEXTURE0+1),e.bindTexture(e.TEXTURE_2D,this.uTextureRef),e.activeTexture(e.TEXTURE0+2),e.bindTexture(e.TEXTURE_2D,this.vTextureRef),t==i.VIDEO_I420){let t=e.getUniformLocation(r,"ySampler");e.uniform1i(t,0);let i=e.getUniformLocation(r,"uSampler");e.uniform1i(i,1);let n=e.getUniformLocation(r,"vSampler");e.uniform1i(n,2)}else if(this.isRGBAMode(t)){let t=e.getUniformLocation(r,"previewVideoSampler");e.uniform1i(t,0);let i=e.getUniformLocation(r,"ySampler");e.uniform1i(i,0);let n=e.getUniformLocation(r,"uSampler");e.uniform1i(n,0);let o=e.getUniformLocation(r,"vSampler");e.uniform1i(o,0)}else if(t==i.VIDEO_NV12){let t=e.getUniformLocation(r,"ySampler");e.uniform1i(t,0);let i=e.getUniformLocation(r,"uSampler");e.uniform1i(i,1);let n=e.getUniformLocation(r,"vSampler");e.uniform1i(n,0)}let n=e.getUniformLocation(r,"previewVideoSampler");e.uniform1i(n,0);let o=e.getUniformLocation(r,"maskSampler");this.initmask?(e.activeTexture(e.TEXTURE0+6),e.bindTexture(e.TEXTURE_2D,this.maskTextureRef),e.uniform1i(o,6)):e.uniform1i(o,0);let a=e.getUniformLocation(r,"cursorSampler");e.uniform1i(a,0);let s=e.getUniformLocation(this.shaderProgram,"waterMarkSampler");e.uniform1i(s,0)},N.prototype.initTexture=function(){var t=this.contextGL,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null),e},N.prototype.clearDisplay=function(){var t=this.contextGL;t&&(t.enable(t.BLEND),t.blendFunc(t.ZERO,t.ZERO)),this.render()},N.prototype.cleanup=function(){let t=this.canvasElement,e=I.get(t);if(e&&this.removeEventListener(t,e),t.defaultContextLostHandler||(t.defaultContextLostHandler=D,t.addEventListener("webglcontextlost",D,{capture:!1})),this.isAvaiable()){var r=this.contextGL;r.deleteProgram(this.program),r.activeTexture(r.TEXTURE0+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE1+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE2+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),this.textureindex||this.initmask||(r.activeTexture(r.TEXTURE3+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE4+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(this.getRepeatedWatermarkTextureValue(r)),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE5+this.textureindex*this.texturestride),r.bindTexture(r.TEXTURE_2D,null)),r.bindBuffer(r.ARRAY_BUFFER,null),r.deleteTexture(this.yTextureRef),r.deleteTexture(this.uTextureRef),r.deleteTexture(this.vTextureRef),this.textureindex||this.initmask||(r.deleteTexture(this.cursorTextureRef),r.deleteTexture(this.waterMarkTextureRef),r.deleteTexture(this.repeatedWaterMarkTextureRef),r.deleteTexture(this.previewVideoTextureRef),r.deleteBuffer(this.vertexPosBuffer),r.deleteBuffer(this.texturePosBuffer)),this.maskTextureRef&&r.deleteTexture(this.maskTextureRef),this.masktexturePosBuffer&&r.deleteBuffer(this.masktexturePosBuffer),r.glInitSucceed=0}},N.prototype.drawNextOutputPicture=function(t,e,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;var o=this.contextGL;o?this.drawNextOutputPictureFrame(t,e,r,i,n):this.drawNextOuptutPictureRGBA(t,e,r,i)},N.prototype.updateVertexInfoForMultiView=function(t,e,r,i,n){var o,a,s,u,E=this.contextGL;if(this.isUseFillMode({width:r,height:i,rotation:n}))o=0,a=0,s=1,u=1;else{var _=n==this.ROTATION_CLOCK90||n==this.ROTATION_CLOCK270?i:r,c=n==this.ROTATION_CLOCK90||n==this.ROTATION_CLOCK270?r:i,d=_/c*e;d>t?(o=0,s=1,u=1-(a=(e-c/_*t)/2/e)):(a=0,u=1,s=1-(o=(t-d)/2/t))}o=2*o-1,s=2*s-1,a=1-2*a,u=1-2*u;var h=new Float32Array([s,a,o,a,s,u,o,u,1,1,-1,1,1,-1,-1,-1]);E.bindBuffer(E.ARRAY_BUFFER,this.vertexPosBuffer),E.bufferData(E.ARRAY_BUFFER,h,E.DYNAMIC_DRAW)},N.prototype.updateTextureInfoForMultiView=function(t,e,r,i,n,o,a){var s,u,E,_,c=this.contextGL;if(this.isUseFillMode({width:r.width,height:r.height,rotation:i})){const n=i==this.ROTATION_CLOCK90||i==this.ROTATION_CLOCK270?a/o:o/a,c=r.left||0,d=r.top||0;if(r.width/r.height>n){const i=r.height*n;s=d/e,u=(Math.round((r.width-i)/2)+c)/t,E=s+(r.height-1)/e,_=u+i/t}else{const i=r.width/n;E=(s=(Math.round((r.height-i)/2)+d)/e)+(i-1)/e,_=(u=c/t)+r.width/t}}else s=h(r.top/e,2),u=h(r.left/t,2),E=d((r.top+r.height-1)/e,2),_=d((r.width-1+r.left)/t,2);var T=[u,s,_,s,_,E,u,E];i==this.ROTATION_CLOCK90&&(T.unshift(T[6],T[7]),T=T.slice(0,8)),i==this.ROTATION_CLOCK180&&(T.unshift(T[4],T[5],T[6],T[7]),T=T.slice(0,8)),i==this.ROTATION_CLOCK270&&(T.unshift(T[6],T[7]),(T=T.slice(0,8))[0]=1-T[0],T[2]=1-T[2],T[4]=1-T[4],T[6]=1-T[6]);var R=T[0],f=T[1];if(T[0]=T[2],T[1]=T[3],T[2]=R,T[3]=f,n)if(i==this.ROTATION_CLOCK90||i==this.ROTATION_CLOCK270){let t=T[1];T[1]=T[3],T[3]=t,t=T[5],T[5]=T[7],T[7]=t}else T[0]=1-T[0],T[2]=1-T[2],T[4]=1-T[4],T[6]=1-T[6];var A=new Float32Array([...T,1,0,0,0,1,1,0,1]);c.bindBuffer(c.ARRAY_BUFFER,this.texturePosBuffer),c.bufferData(c.ARRAY_BUFFER,A,c.DYNAMIC_DRAW)},N.prototype.drawNextOutputPictureFrame=function(t,e,r,n,o){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];if(!this.isAvaiable())return;var E=this.contextGL,_=(this.texturePosBuffer,this.yTextureRef),c=this.uTextureRef,d=this.vTextureRef;E.enable(E.BLEND),E.blendFunc(E.SRC_ALPHA,E.ONE_MINUS_SRC_ALPHA),o=o||this.ROTATION_CLOCK0;var h=(r=r||{top:0,left:0,width:t,height:e}).width!=this.croppingParams.width||r.height!=this.croppingParams.height,T=r.top!=this.croppingParams.top||r.left!=this.croppingParams.left,R=E.canvas.width!=this.canvasWidth||E.canvas.height!=this.canvasHeight,f=t!=this.textureWidth||e!=this.textureHeight,A=o!=this.picRotation;(h||R||A)&&p(this,r.width,r.height,o,s),(h||T||f||A)&&m(this,t,e,r,o);let l=a?0:1;l!=this.colorRange&&(E.uniform1i(this.colorRangeRef,l),this.colorRange=l),s?E.viewport(s.x,s.y,s.width,s.height):E.viewport(0,0,E.canvas.width,E.canvas.height),E.uniform1i(this.onlyRGBARef,0),E.uniform1i(this.yuvmodeRef,i.VIDEO_I420),Object.assign(this.croppingParams,r),this.textureWidth=t,this.textureHeight=e,this.picRotation=o,this.canvasWidth=E.canvas.width,this.canvasHeight=E.canvas.height,E.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),E.clear(E.COLOR_BUFFER_BIT);var O=n,I=t*e;if(E.activeTexture(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,_),u){var S=O.subarray(0,I);E.texImage2D(E.TEXTURE_2D,0,E.LUMINANCE,t,e,0,E.LUMINANCE,E.UNSIGNED_BYTE,S)}var D=t/2*e/2;if(E.activeTexture(E.TEXTURE1),E.bindTexture(E.TEXTURE_2D,c),u){var N=O.subarray(I,I+D);E.texImage2D(E.TEXTURE_2D,0,E.LUMINANCE,t/2,e/2,0,E.LUMINANCE,E.UNSIGNED_BYTE,N)}var C=D;if(E.activeTexture(E.TEXTURE2),E.bindTexture(E.TEXTURE_2D,d),u){var g=O.subarray(I+D,I+D+C);E.texImage2D(E.TEXTURE_2D,0,E.LUMINANCE,t/2,e/2,0,E.LUMINANCE,E.UNSIGNED_BYTE,g)}E.activeTexture(E.TEXTURE3),E.bindTexture(E.TEXTURE_2D,this.cursorTextureRef),this.hasCursor?E.uniform1i(this.cursorFlagRef,1):u&&E.texImage2D(E.TEXTURE_2D,0,E.RGBA,1,1,0,E.RGBA,E.UNSIGNED_BYTE,this.dummpyCursor),E.uniform4f(this.cursorInfoRef,this.cx,this.cy,this.cw,this.ch),E.activeTexture(E.TEXTURE5),E.bindTexture(E.TEXTURE_2D,this.previewVideoTextureRef),E.texImage2D(E.TEXTURE_2D,0,E.RGBA,1,1,0,E.RGBA,E.UNSIGNED_BYTE,this.dummpyWaterMark);var v=E.getUniformLocation(this.shaderProgram,"maskSampler");E.uniform1i(v,5),this.render(),this.hasWholeFrame=1},N.prototype.updateTextureBlock=function(t,e,r,i,n){if(this.isAvaiable()){var o=this.contextGL,a=n;if(!(!this.hasWholeFrame||t<=0||e<=0||r<0||i<0||r+t>this.textureWidth||i+e>this.textureHeight)&&n&&n.length==t*e*3/2){var s=this.yTextureRef,u=this.uTextureRef,E=this.vTextureRef,_=t*e,c=a.subarray(0,_);o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,s),o.texSubImage2D(o.TEXTURE_2D,0,r,i,t,e,o.LUMINANCE,o.UNSIGNED_BYTE,c);var d=t/2*e/2,h=a.subarray(_,_+d);o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,u),o.texSubImage2D(o.TEXTURE_2D,0,r/2,i/2,t/2,e/2,o.LUMINANCE,o.UNSIGNED_BYTE,h);var T=d,R=a.subarray(_+d,_+d+T);o.activeTexture(o.TEXTURE2),o.bindTexture(o.TEXTURE_2D,E),o.texSubImage2D(o.TEXTURE_2D,0,r/2,i/2,t/2,e/2,o.LUMINANCE,o.UNSIGNED_BYTE,R)}}},N.prototype.updateCursor=function(t,e,r){if(this.isAvaiable()){var i=this.contextGL;t<=0||e<=0||!r||r.length!=t*e*4||(i.activeTexture(i.TEXTURE3),i.bindTexture(i.TEXTURE_2D,this.cursorTextureRef),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,r),this.cursorWidth=t,this.cursorHeight=e,this.hasCursor=1)}},N.prototype.updateWatermark=function(t,e,r){if(this.isAvaiable()){this.contextGL;t<=0||e<=0||!r||r.length!=t*e*4||(this.watermarkData=r,this.watermarkWidth=t,this.watermarkHeight=e,this.hasWaterMark=1)}},N.prototype.drawWatermark=function(){if(this.isAvaiable()){var t=this.contextGL;if(this.isSetWatermark()&&this.watermarkData&&this.watermarkWidth&&this.watermarkHeight){t.uniform1i(this.waterMarkFlagRef,1),this.isWatermarkRepeated()?(t.activeTexture(this.getRepeatedWatermarkTextureValue(t)),t.bindTexture(t.TEXTURE_2D,this.repeatedWaterMarkTextureRef)):(t.activeTexture(t.TEXTURE4),t.bindTexture(t.TEXTURE_2D,this.waterMarkTextureRef)),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.watermarkWidth,this.watermarkHeight,0,t.RGBA,t.UNSIGNED_BYTE,this.watermarkData);let e=t.getUniformLocation(this.shaderProgram,"waterMarkSampler");t.uniform1i(e,this.isWatermarkRepeated()?this.getRepeatedWatermarkUniformValue():4),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.drawArrays(t.TRIANGLE_STRIP,4,4)}}},N.prototype.render=function(){if(this.isAvaiable()){var t=this.contextGL;t.uniform1i(this.waterMarkFlagRef,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),this.drawWatermark()}},N.prototype.drawCursor=function(t,e,r,i,n){if(this.isAvaiable()){var o=this.contextGL;if(!(!this.hasWholeFrame||t&&(i<0||n<0))){o.viewport(0,0,o.canvas.width,o.canvas.height);var a=this.yTextureRef,s=this.uTextureRef,u=this.vTextureRef,E=this.cursorTextureRef;if(o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,a),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,s),o.activeTexture(o.TEXTURE2),o.bindTexture(o.TEXTURE_2D,u),o.activeTexture(o.TEXTURE3),o.bindTexture(o.TEXTURE_2D,E),t&&this.hasCursor){let t=e/this.croppingParams.width,a=r/this.croppingParams.height,s=i/this.croppingParams.width,u=n/this.croppingParams.height;this.cx=t,this.cy=a,this.cw=s,this.ch=u,o.uniform4f(this.cursorInfoRef,t,a,s,u)}else o.uniform4f(this.cursorInfoRef,0,0,0,0);this.render()}}},N.prototype.clear=function(){this.hasWholeFrame=0,this.hasCursor=0},N.prototype.clearCanvas=function(t){if(this.isAvaiable()){var e=this.contextGL;t?e.clearColor(t.R,t.G,t.B,t.A):e.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],255),e.clear(e.COLOR_BUFFER_BIT)}},N.prototype.drawNextOuptutPictureRGBA=function(t,e,r,i){if(this.isAvaiable()){var n=i,o=this.canvasElement.getContext("2d"),a=o.getImageData(0,0,t,e);a.data.set(n),o.putImageData(a,0,0)}},N.prototype.isRGBAMode=function(t){return-1!==[i.VIDEO_RGBA,i.VIDEO_BGRA].indexOf(t)},N.prototype.updateRemoteVideoTextures=function(t,e,r,n,o){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if(!this.isAvaiable())return;var u=this.contextGL,E=this.yTextureRef,_=this.uTextureRef,c=this.vTextureRef;u.enable(u.BLEND),u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA);const d=this.isRGBAMode(this.videoMode);if(t<=0||e<=0||!n||!n.length||n.length!=t*e*3/2&&!d||r&&(r.top<0||r.left<0||r.left+r.width>t||r.top+r.height>e))return!1;let h=a?0:1;if(this.colorRange=h,this.rotation=o,Object.assign(this.croppingParams,r),this.textureWidth=t,this.textureHeight=e,this.canvasWidth=u.canvas.width,this.canvasHeight=u.canvas.height,!s)return;if(u.bindTexture(u.TEXTURE_2D,E),d)return void u.texImage2D(u.TEXTURE_2D,0,u.RGBA,t,e,0,u.RGBA,u.UNSIGNED_BYTE,n);var T=n,R=t*e,f=T.subarray(0,R);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,t,e,0,u.LUMINANCE,u.UNSIGNED_BYTE,f);let A=0,l=0;this.videoMode==i.VIDEO_I420?(A=t/2*e/2,l=A):this.videoMode==i.VIDEO_NV12&&(A=t*e/2,l=0);var O=T.subarray(R,R+A);if(u.bindTexture(u.TEXTURE_2D,_),l){u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,t/2,e/2,0,u.LUMINANCE,u.UNSIGNED_BYTE,O);var I=T.subarray(R+A,R+A+l);u.bindTexture(u.TEXTURE_2D,c),u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,t/2,e/2,0,u.LUMINANCE,u.UNSIGNED_BYTE,I)}else u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE_ALPHA,t/2,e/2,0,u.LUMINANCE_ALPHA,u.UNSIGNED_BYTE,O);return!0},N.prototype.updateRemoteVideoTexturesImageBitmap=function(t,e,r,i,n){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(t<=0||e<=0||!r)return;if(!this.isAvaiable())return;var a=this.contextGL;if(this.textureWidth=t,this.textureHeight=e,Number.isNaN(n)||(this.rotation=n),Object.assign(this.croppingParams,i),!o)return;a.bindTexture(a.TEXTURE_2D,this.yTextureRef);const s=0,u=a.RGBA,E=a.RGBA,_=a.UNSIGNED_BYTE;a.texImage2D(a.TEXTURE_2D,s,u,E,_,r)},N.prototype.updateSelfMaskImage=function(t,e,r){if(!(t<=0||e<=0)&&r&&r.length==t*e*4&&this.isAvaiable()){var i=this.contextGL;i.bindTexture(i.TEXTURE_2D,this.maskTextureRef),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,r)}},N.prototype.VideoFlip=function(){if(this.isAvaiable()){var t=this.contextGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1)}},N.prototype.drawRemoteVideo=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.isAvaiable())return;var r=this.contextGL;let i=this.isRGBAMode(this.videoMode)?1:0;r.uniform1i(this.colorRangeRef,this.colorRange),this.setUniformFlag(i,this.hasCursor,this.videoMode),this.initmask&&r.uniform1i(this.maskFlagRef,1),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,e,t.width,t.height),r.viewport(t.x,t.y,t.width,t.height),this.updateVertexInfoForMultiView(t.width,t.height,this.croppingParams.width,this.croppingParams.height,this.rotation),this.BindTextures(this.videoMode),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),this.render()},N.prototype.readPixelsSyncRequest=function(t,e,r,i){if(this.isAvaiable()){var n,o=this.contextGL;return this.destination&&this.destination.length==r*i*4||(this.destination=new Uint8Array(r*i*4)),n=this.destination,o.flush(),o.readPixels(t,e,r,i,o.RGBA,o.UNSIGNED_BYTE,n),n}},N.prototype.updateSelfVideoTextures=function(t,e,r,i){let n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(!(t<=0||e<=0)&&r&&r.length%4==0&&this.isAvaiable()){var a=this.contextGL;this.textureWidth=t,this.textureHeight=e,this.rotation=o,Object.assign(this.croppingParams,i),n&&(a.bindTexture(a.TEXTURE_2D,this.yTextureRef),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,t,e,0,a.RGBA,a.UNSIGNED_BYTE,r))}},N.prototype.drawSelfVideo=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.isAvaiable()){var n=this.contextGL;this.setUniformFlag(1,this.hasCursor,this.videoMode),this.updateTextureInfoForMultiView(this.textureWidth,this.textureHeight,this.croppingParams,this.rotation,r,t.width,t.height),n.viewport(t.x,t.y,t.width,t.height),e?(n.enable(n.BLEND),n.blendFunc(n.ZERO,n.ZERO),this.updateVertexInfoForMultiView(t.width,t.height,t.width,t.height,this.ROTATION_CLOCK0)):(n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.updateVertexInfoForMultiView(t.width,t.height,this.croppingParams.width,this.croppingParams.height,this.rotation)),this.BindTextures(i.VIDEO_RGBA),this.render()}},N.prototype.isSetWatermark=function(){return this.hasWaterMark},N.prototype.recoverTextures=function(){},N.prototype.setWatermarkFlag=function(t){this.hasWaterMark=t,t||(this.setWatermarkRepeated(!1),this.setWatermarkOpacity(),this.setWatermarkPosition(16))},N.prototype.setUniformFlag=function(t,e,r){if(this.isAvaiable()){var n=this.contextGL;n.uniform1i(this.onlyRGBARef,t),n.uniform1i(this.bgraModeRef,t&&r===i.VIDEO_BGRA?1:0),n.uniform1i(this.cursorFlagRef,e),t||n.uniform1i(this.yuvmodeRef,r)}},N.prototype.setVideoMode=function(t){this.videoMode=t},N.prototype.getVideoMode=function(t){return this.videoMode},N.prototype.setWatermarkRepeated=function(t){this.watermarkRepeated=t},N.prototype.isWatermarkRepeated=function(){return!!this.watermarkRepeated},N.prototype.setWatermarkOpacity=function(t){this.watermarkOpacity=t||.15},N.prototype.getWatermarkOpacity=function(){return this.watermarkOpacity},N.prototype.setWatermarkPosition=function(t){this.watermarkPosition=t||16},N.prototype.getWatermarkPosition=function(){return this.watermarkPosition},N.prototype.setMultiView=function(t){return this.isMultiView=t},N.prototype.getRepeatedWatermarkUniformValue=function(){return this.isMultiView?30:7},N.prototype.getRepeatedWatermarkTextureValue=function(t){return this.isMultiView?t.TEXTURE30:t.TEXTURE7},N.prototype.setFillMode=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.fillMode=t,this.fillModeForResolution=e},N.prototype.getFillMode=function(){return this.fillMode},N.prototype.getFillModeForResolution=function(){return this.fillModeForResolution},N.prototype.getTextureIndex=function(){return this.textureindex},N.prototype.getTextureWidth=function(){return this.textureWidth},N.prototype.getTextureHeight=function(){return this.textureHeight},N.prototype.getCroppingParams=function(){return this.croppingParams},N.prototype.getIndex=function(){return this.textureindex},N.prototype.getWatermarkWidth=function(){return this.watermarkWidth},N.prototype.getWatermarkHeight=function(){return this.watermarkHeight},N.prototype.getWatermarkOpacity=function(){return this.watermarkOpacity},N.prototype.getAttachedCanvas=function(){return this.canvasElement},N.prototype.resizeCanvasTo=function(t,e){this.contextGL.canvas.width=t,this.contextGL.canvas.height=e},N.prototype.isUseFillMode=function(t){let{width:e,height:r,rotation:i}=t;if(!this.fillMode)return!1;if(!this.fillModeForResolution)return!0;if(!e||!r)return!1;const n=i===this.ROTATION_CLOCK90||i==this.ROTATION_CLOCK270?r/e:e/r;return(Array.isArray(this.fillModeForResolution)?this.fillModeForResolution:[this.fillModeForResolution]).some(t=>Math.abs(n-t)<.01)};e.default=N}]).default}));
//# sourceMappingURL=https://d1cdksi819e9z7.cloudfront.net/sourcemap/vb.min.js-9a55adfb897d2a0d5164.map