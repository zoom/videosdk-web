!function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";var a=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(n,o){function i(e){try{s(a.next(e))}catch(e){o(e)}}function l(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,l)}s((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=r(1);function o(e){self.postMessage({cmd:n.VB_EVENT_TYPE.VB_WORKER_ERROR,payload:e.error||e.reason})}self.addEventListener("error",o),self.addEventListener("unhandledrejection",o);const i=!!self.SharedArrayBuffer;let l;var s,d,u,f,c={},_={},E={},m={},y=0;function b(){return self.GROWABLE_HEAP_U8?self.GROWABLE_HEAP_U8():Module.HEAPU8}function p(e){return a(this,void 0,void 0,(function*(){let t=new Uint8Array(e,0,12),r=new Uint8Array(e,12,32);const n=yield self.crypto.subtle.importKey("raw",r,"AES-GCM",!0,["encrypt","decrypt"]);let o=t.length+r.length,i=new Uint32Array(e.slice(o,o+4))[0];o+=4;let l=e.slice(o,o+i);o+=i,i=new Uint32Array(e.slice(o,o+4))[0],o+=4;let u=new Uint8Array(e,o,i);o+=i,i=new Uint32Array(e.slice(o,o+4))[0],o+=4;let f=e.slice(o,o+i);o+=i,i=new Uint32Array(e.slice(o,o+4))[0],o+=4;let y=new Uint8Array(e,o,i);yield Promise.all([(()=>a(this,void 0,void 0,(function*(){const e=yield V(y,n,t),r=(new TextDecoder).decode(e);yield function(e,t){return a(this,void 0,void 0,(function*(){var r=JSON.parse(t);if(c.modelTopology=r.modelTopology,c.format=r.format,c.generatedBy=r.generatedBy,c.convertedBy=r.convertedBy,r.weightsManifest)for(var a=0;a<r.weightsManifest.length;a++)c.weightSpecs=r.weightsManifest[a].weights;r.trainingConfig&&(c.trainingConfig=r.trainingConfig),r.userDefinedMetadata&&(c.userDefinedMetadata=r.userDefinedMetadata),c.weightData=e,s=yield tf.loadGraphModel(_),M();var n=new Float32Array(110592),o=new Float32Array(110592),i=new Float32Array(36864),l=tf.tensor4d(n,[1,144,256,3],"float32"),d=tf.tensor4d(o,[1,144,256,3],"float32"),u=tf.tensor4d(i,[1,144,256,1],"float32");s.predict([l,d,u])}))}(f,r)})))(),(()=>a(this,void 0,void 0,(function*(){const e=yield V(u,n,t),r=(new TextDecoder).decode(e);yield function(e,t){return a(this,void 0,void 0,(function*(){var r=JSON.parse(t);if(E.modelTopology=r.modelTopology,E.format=r.format,E.generatedBy=r.generatedBy,E.convertedBy=r.convertedBy,r.weightsManifest)for(var a=0;a<r.weightsManifest.length;a++)E.weightSpecs=r.weightsManifest[a].weights;r.trainingConfig&&(E.trainingConfig=r.trainingConfig),r.userDefinedMetadata&&(E.userDefinedMetadata=r.userDefinedMetadata),E.weightData=e,d=yield tf.loadGraphModel(m),M();var n=new Float32Array(110592),o=tf.tensor4d(n,[1,144,256,3],"float32");d.predict(o)}))}(l,r)})))()])}))}function V(e,t,r){return self.crypto.subtle.decrypt({name:"AES-GCM",iv:r},t,e)}function M(){2===++y&&self.postMessage({cmd:n.VB_EVENT_TYPE.VB_MODEL_READY})}let g,v,w,h,T;function A(){return a(this,void 0,void 0,(function*(){const e=new Promise((e,t)=>{Module.onRuntimeInitialized=()=>{g=Module.cwrap("_create_vb_no_sab_thread","number",[]),v=Module.cwrap("_signal_vb_thread_bg","number",["number","number","number","number"]),w=Module.cwrap("_signal_vb_thread_blur","number",["number","number"]),h=Module.cwrap("_signal_vb_thread_video_yuv","number",["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"]),T=Module.cwrap("_signal_vb_thread_video_rgba","number",["number","number","number","number","number","number","number","number"]),e()},Module.onAbort=()=>{t("wasm initialize failed")}}),t=function(){return a(this,void 0,void 0,(function*(){if("string"==typeof l){const e=yield fetch(l);if(!e.ok){const{url:t,status:r}=e;throw new Error(`Fetch model file failed. url: ${t}, status: ${r}`)}l=yield e.arrayBuffer()}yield p(l),self.postMessage({cmd:n.VB_EVENT_TYPE.VB_PREDICT_DONE})}))}();try{yield Promise.all([e,t]),g(),w(0,0),self.postMessage({cmd:n.VB_EVENT_TYPE.VB_INIT_SUCCESS})}catch(e){self.postMessage({cmd:n.VB_EVENT_TYPE.VB_INIT_FAILED,payload:e})}}))}_.load=function(){return c},_.save=function(){},m.load=function(){return E},m.save=function(){},self.processed_capture_data_callback=(e,t,r,a,o,l,s,d,u,f)=>{let c=b().subarray(t+0,t+r);self.postMessage({cmd:n.VB_EVENT_TYPE.VB_GENERATED_FRAME,payload:{data:c,format_width:a,format_height:o,valid_x:l,valid_y:s,valid_width:d,valid_height:u,len_of_data:r,data_ptr:i?t:0}}),i||Module._free(t)},self.execute_base=(e,t,r,a)=>(tf.tidy(()=>{var n=new Float32Array(wasmMemory.buffer,e,t),o=tf.tensor4d(n,[1,144,256,3],"float32"),i=d.predict(o);1==i[0].size?(u=Float32Array.from(i[0].as1D(36864).arraySync()),f=Float32Array.from(i[1].as1D(1).arraySync())):(u=Float32Array.from(i[1].as1D(36864).arraySync()),f=Float32Array.from(i[0].as1D(1).arraySync()));let l=new Float32Array(wasmMemory.buffer);l.set(f,r>>2),l.set(u,a>>2)}),0),self.execute_afn=(e,t,r,a,n)=>(tf.tidy(()=>{var o=new Float32Array(wasmMemory.buffer,e,a),i=new Float32Array(wasmMemory.buffer,t,a),l=new Float32Array(wasmMemory.buffer,r,a/3),d=tf.tensor4d(o,[1,144,256,3],"float32"),u=tf.tensor4d(i,[1,144,256,3],"float32"),c=tf.tensor4d(l,[1,144,256,1],"float32"),_=s.predict([d,u,c]);f=Float32Array.from(_.as1D(36864).arraySync()),(self.GROWABLE_HEAP_F32?self.GROWABLE_HEAP_F32():Module.HEAPF32).set(f,n>>2)}),0),self.LimitWebCodecsEncoderTo360_js=()=>!1,self.hardcodecpunumber=()=>navigator.hardwareConcurrency||1,self.IsSupportMultiThread=()=>0,self.js_info_from_wcl_video_data=(e,t,r,a,n,o)=>{Module._free(t)},self.GetLogLevel_js=()=>0,self.addEventListener("message",(function(e){const{cmd:t}=e.data;switch(t){case n.VB_EVENT_TYPE.VB_RECEIVE_VIDEOFRAME:{const t=e.data.payload,{format:r}=t,{width:a,height:o}=t.visibleRect;let i,l,s,d,u,f,c,_,E,m,y,p,V,M;if(l=a,s=o,m=t.allocationSize(),"NV12"===r){d=a*o,u=a*o/2,f=a,c=f,_=0,E=0,y=Module._malloc(m);const e=b().subarray(y,y+m);t.copyTo(e),h(y,0,l,s,y,d,y+d,u,y+d,u,f,c,c,_,E,3)}else if("BGRA"===r){f=a,p=o,_=0,E=0,i=4,y=Module._malloc(m);const e=b().subarray(y,y+m);t.copyTo(e),T(y,m,l,s,4*l,0,0,i)}else if("I420"===r||"I420A"===r){f=a,p=o,c=f/2,V=f/2,d=a*o,u=a*o/4,M=a*o/4,_=0,E=0,i=2,y=Module._malloc(m);const e=b().subarray(y,y+m);t.copyTo(e),h(y,0,l,s,y,d,y+d,u,y+d+u,u,f,c,c,_,E,i)}else self.postMessage({cmd:n.VB_EVENT_TYPE.VB_VIDEO_FORMAT_UNSUPPORTED,payload:{format:r}});t.close();break}case n.VB_EVENT_TYPE.VB_RECEIVE_IMAGEDATA:{const t=e.data.payload,{width:r,height:a,data:n}=t,o=Module._malloc(r*a*4);let i=b().subarray(o,o+n.length);const l=n.length;i.set(n,0),T(o,l,r,a,4*r,0,0,1);break}case n.VB_EVENT_TYPE.VB_UPDATE_BG:{const t=e.data.payload;if("blur"===t)w(0,0);else{const{data:e,width:r,height:a}=t,n=Module._malloc(e.length);let o=new Uint8Array(e);b().subarray(n,n+e.length).set(o,0),v(n,o.length,r,a)}break}case n.VB_EVENT_TYPE.VB_FREE_MEMORY:{const t=e.data.payload,{pointer:r}=t;Module._free(r);break}case n.VB_EVENT_TYPE.VB_WORKER_INIT:{const t=e.data.payload;let{tfJsUrl:r,wasmGlueCodeUrl:a,wasmUrl:o,model:s,cdnPath:d}=t||{};if(d){const e=(e=>({tfJsUrl:e+"/vb-resource/tf.min.js",modelUrl:e+"/vb-resource/dualModel.bin",wasmGlueCodeUrl:i?e+"/video.mtsimd.js":e+"/video.simd.js",wasmUrl:i?e+"/video.mtsimd.wasm":e+"/video.simd.wasm"}))(d);l=s||e.modelUrl,a?o&&(self.Module={locateFile:()=>o}):self.Module={locateFile:()=>e.wasmUrl},a||(a=e.wasmGlueCodeUrl),importScripts(r||e.tfJsUrl),tf.setBackend("webgl").then(e=>{if(!e)return Promise.reject("set webgl backend failed");importScripts(a),A()}).catch(e=>{self.postMessage({cmd:n.VB_EVENT_TYPE.VB_INIT_FAILED,payload:e})})}break}default:console.warn("unrecognize")}}))},function(e,t,r){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.VB_EVENT_TYPE=void 0,function(e){e.VB_INIT_SUCCESS="VB_INIT_SUCCESS",e.VB_INIT_FAILED="VB_INIT_FAILED",e.VB_GENERATED_FRAME="VB_GENERATED_FRAME",e.VB_RECEIVE_VIDEOFRAME="VB_RECEIVE_VIDEOFRAME",e.VB_RECEIVE_IMAGEDATA="VB_RECEIVE_IMAGEDATA",e.VB_UPDATE_BG="VB_UPDATE_BG",e.VB_PREDICT_DONE="vbPredictDone",e.VB_MODEL_READY="modelReady",e.VB_FREE_MEMORY="VB_FREE_MEMORY",e.VB_VIDEO_FORMAT_UNSUPPORTED="VB_VIDEO_FORMAT_UNSUPPORTED",e.VB_WORKER_INIT="VB_WORKER_INIT",e.VB_WORKER_ERROR="VB_WORKER_ERROR"}(a||(t.VB_EVENT_TYPE=a={}))}]);
//# sourceMappingURL=https://d1cdksi819e9z7.cloudfront.net/sourcemap/vb_worker.min.js-93388a10568d39cf65e3.map