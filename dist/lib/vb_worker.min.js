!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,o){function i(e){try{s(n.next(e))}catch(e){o(e)}}function l(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,l)}s((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=r(1);function o(e){self.postMessage({cmd:a.VB_EVENT_TYPE.VB_WORKER_ERROR,payload:e.error||e.reason})}self.addEventListener("error",o),self.addEventListener("unhandledrejection",o);const i=!!self.SharedArrayBuffer;let l;var s,d,f,u,c={},_={},E={},m={},y=0;function b(){return self.GROWABLE_HEAP_U8?self.GROWABLE_HEAP_U8():Module.HEAPU8}function V(e){return n(this,void 0,void 0,(function*(){let t=new Uint8Array(e,0,12),r=new Uint8Array(e,12,32);const a=yield self.crypto.subtle.importKey("raw",r,"AES-GCM",!0,["encrypt","decrypt"]);let o=t.length+r.length,i=new Uint32Array(e.slice(o,o+4))[0];o+=4;let l=e.slice(o,o+i);o+=i,i=new Uint32Array(e.slice(o,o+4))[0],o+=4;let f=new Uint8Array(e,o,i);o+=i,i=new Uint32Array(e.slice(o,o+4))[0],o+=4;let u=e.slice(o,o+i);o+=i,i=new Uint32Array(e.slice(o,o+4))[0],o+=4;let y=new Uint8Array(e,o,i);yield Promise.all([(()=>n(this,void 0,void 0,(function*(){const e=yield p(y,a,t),r=(new TextDecoder).decode(e);yield function(e,t){return n(this,void 0,void 0,(function*(){var r=JSON.parse(t);if(c.modelTopology=r.modelTopology,c.format=r.format,c.generatedBy=r.generatedBy,c.convertedBy=r.convertedBy,r.weightsManifest)for(var n=0;n<r.weightsManifest.length;n++)c.weightSpecs=r.weightsManifest[n].weights;r.trainingConfig&&(c.trainingConfig=r.trainingConfig),r.userDefinedMetadata&&(c.userDefinedMetadata=r.userDefinedMetadata),c.weightData=e,s=yield tf.loadGraphModel(_),v();var a=new Float32Array(110592),o=new Float32Array(110592),i=new Float32Array(36864),l=tf.tensor4d(a,[1,144,256,3],"float32"),d=tf.tensor4d(o,[1,144,256,3],"float32"),f=tf.tensor4d(i,[1,144,256,1],"float32");s.predict([l,d,f])}))}(u,r)})))(),(()=>n(this,void 0,void 0,(function*(){const e=yield p(f,a,t),r=(new TextDecoder).decode(e);yield function(e,t){return n(this,void 0,void 0,(function*(){var r=JSON.parse(t);if(E.modelTopology=r.modelTopology,E.format=r.format,E.generatedBy=r.generatedBy,E.convertedBy=r.convertedBy,r.weightsManifest)for(var n=0;n<r.weightsManifest.length;n++)E.weightSpecs=r.weightsManifest[n].weights;r.trainingConfig&&(E.trainingConfig=r.trainingConfig),r.userDefinedMetadata&&(E.userDefinedMetadata=r.userDefinedMetadata),E.weightData=e,d=yield tf.loadGraphModel(m),v();var a=new Float32Array(110592),o=tf.tensor4d(a,[1,144,256,3],"float32");d.predict(o)}))}(l,r)})))()])}))}function p(e,t,r){return self.crypto.subtle.decrypt({name:"AES-GCM",iv:r},t,e)}function v(){2===++y&&self.postMessage({cmd:a.VB_EVENT_TYPE.VB_MODEL_READY})}let M,w,B,h,g;function A(){return n(this,void 0,void 0,(function*(){const e=new Promise((e,t)=>{Module.onRuntimeInitialized=()=>{M=Module.cwrap("_create_vb_no_sab_thread","number",[]),w=Module.cwrap("_signal_vb_thread_bg","number",["number","number","number","number"]),B=Module.cwrap("_signal_vb_thread_blur","number",["number","number"]),h=Module.cwrap("_signal_vb_thread_video_yuv","number",["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"]),g=Module.cwrap("_signal_vb_thread_video_rgba","number",["number","number","number","number","number","number","number","number"]),e()},Module.onAbort=()=>{t("wasm initialize failed")}}),t=function(){return n(this,void 0,void 0,(function*(){if("string"==typeof l){const e=yield fetch(l);if(!e.ok){const{url:t,status:r}=e;throw new Error(`Fetch model file failed. url: ${t}, status: ${r}`)}l=yield e.arrayBuffer()}yield V(l),self.postMessage({cmd:a.VB_EVENT_TYPE.VB_PREDICT_DONE})}))}();try{yield Promise.all([e,t]),M(),B(0,0),self.postMessage({cmd:a.VB_EVENT_TYPE.VB_INIT_SUCCESS})}catch(e){self.postMessage({cmd:a.VB_EVENT_TYPE.VB_INIT_FAILED,payload:e})}}))}_.load=function(){return c},_.save=function(){},m.load=function(){return E},m.save=function(){},self.processed_capture_data_callback=(e,t,r,n,o,l,s,d,f,u)=>{let c=b().subarray(t+0,t+r);self.postMessage({cmd:a.VB_EVENT_TYPE.VB_GENERATED_FRAME,payload:{data:c,format_width:n,format_height:o,valid_x:l,valid_y:s,valid_width:d,valid_height:f,len_of_data:r,data_ptr:i?t:0}}),i||Module._free(t)},self.execute_base=(e,t,r,n)=>(tf.tidy(()=>{var a=new Float32Array(wasmMemory.buffer,e,t),o=tf.tensor4d(a,[1,144,256,3],"float32"),i=d.predict(o);1==i[1].size?(u=Float32Array.from(i[0].as1D(36864).arraySync()),f=Float32Array.from(i[1].as1D(1).arraySync())):(u=Float32Array.from(i[1].as1D(36864).arraySync()),f=Float32Array.from(i[0].as1D(1).arraySync()));let l=new Float32Array(wasmMemory.buffer);l.set(u,r>>2),l.set(f,n>>2)}),0),self.execute_afn=(e,t,r,n,a)=>(tf.tidy(()=>{var o=new Float32Array(wasmMemory.buffer,e,n),i=new Float32Array(wasmMemory.buffer,t,n),l=new Float32Array(wasmMemory.buffer,r,n/3),d=tf.tensor4d(o,[1,144,256,3],"float32"),f=tf.tensor4d(i,[1,144,256,3],"float32"),c=tf.tensor4d(l,[1,144,256,1],"float32"),_=s.predict([d,f,c]);u=Float32Array.from(_.as1D(36864).arraySync()),(self.GROWABLE_HEAP_F32?self.GROWABLE_HEAP_F32():Module.HEAPF32).set(u,a>>2)}),0),self.LimitWebCodecsEncoderTo360_js=()=>!1,self.hardcodecpunumber=()=>navigator.hardwareConcurrency||1,self.IsSupportMultiThread=()=>0,self.js_info_from_wcl_video_data=(e,t,r,n,a,o)=>{Module._free(t)},self.GetLogLevel_js=()=>0,self.addEventListener("message",(function(e){return n(this,void 0,void 0,(function*(){const{cmd:t}=e.data;switch(t){case a.VB_EVENT_TYPE.VB_RECEIVE_VIDEOFRAME:{const t=e.data.payload,{format:r}=t,{width:n,height:o}=t.visibleRect;let i,l,s,d,f,u,c,_,E,m,y,V,p,v;if(l=n,s=o,m=t.allocationSize(),"NV12"===r||"BGRA"===r||"I420"===r||"I420A"===r){y=Module._malloc(m);const e=b().subarray(y,y+m);try{yield t.copyTo(e),"NV12"===r?(d=n*o,f=n*o/2,u=n,c=u,_=0,E=0,h(y,0,l,s,y,d,y+d,f,y+d,f,u,c,c,_,E,3)):"BGRA"===r?(u=n,V=o,_=0,E=0,i=4,g(y,m,l,s,4*l,0,0,i)):"I420"!==r&&"I420A"!==r||(u=n,V=o,c=u/2,p=u/2,d=n*o,f=n*o/4,v=n*o/4,_=0,E=0,i=2,h(y,0,l,s,y,d,y+d,f,y+d+f,f,u,c,c,_,E,i))}catch(e){Module._free(y)}}else self.postMessage({cmd:a.VB_EVENT_TYPE.VB_VIDEO_FORMAT_UNSUPPORTED,payload:{format:r}});t.close();break}case a.VB_EVENT_TYPE.VB_RECEIVE_IMAGEDATA:{const t=e.data.payload,{width:r,height:n,data:a}=t,o=Module._malloc(r*n*4);let i=b().subarray(o,o+a.length);const l=a.length;i.set(a,0),g(o,l,r,n,4*r,0,0,1);break}case a.VB_EVENT_TYPE.VB_UPDATE_BG:{const t=e.data.payload;if("blur"===t)B(0,0);else{const{data:e,width:r,height:n}=t,a=Module._malloc(e.length);let o=new Uint8Array(e);b().subarray(a,a+e.length).set(o,0),w(a,o.length,r,n)}break}case a.VB_EVENT_TYPE.VB_FREE_MEMORY:{const t=e.data.payload,{pointer:r}=t;Module._free(r);break}case a.VB_EVENT_TYPE.VB_WORKER_INIT:{const t=e.data.payload;let{tfJsUrl:r,wasmGlueCodeUrl:o,wasmUrl:s,model:d,cdnPath:f,enableWasm:u}=t||{};if(f){const e=(e=>({tfJsUrl:e+"/vb-resource/tf.min.js",modelUrl:e+"/vb-resource/dualModel.bin",wasmGlueCodeUrl:i?e+"/video.mtsimd.js":e+"/video.simd.js",wasmUrl:i?e+"/video.mtsimd.wasm":e+"/video.simd.wasm",wasmBackendUrl:e+"/vb-resource/tf-backend-wasm.min.js"}))(f);l=d||e.modelUrl,o?s&&(self.Module={locateFile:()=>s}):self.Module={locateFile:()=>e.wasmUrl},o||(o=e.wasmGlueCodeUrl),importScripts(r||e.tfJsUrl),function(){n(this,void 0,void 0,(function*(){let t=!1,r=!1,n=null;try{t=yield tf.setBackend("webgl")}catch(e){n=e}if(!t&&u){importScripts(e.wasmBackendUrl),tf.wasm.setWasmPaths(f+"/vb-resource/");try{r=yield tf.setBackend("wasm")}catch(e){n=e}}t||r?(importScripts(o),A()):self.postMessage({cmd:a.VB_EVENT_TYPE.VB_INIT_FAILED,payload:n})}))}()}break}default:console.warn("unrecognize")}}))}))},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.VB_EVENT_TYPE=void 0,function(e){e.VB_INIT_SUCCESS="VB_INIT_SUCCESS",e.VB_INIT_FAILED="VB_INIT_FAILED",e.VB_GENERATED_FRAME="VB_GENERATED_FRAME",e.VB_RECEIVE_VIDEOFRAME="VB_RECEIVE_VIDEOFRAME",e.VB_RECEIVE_IMAGEDATA="VB_RECEIVE_IMAGEDATA",e.VB_UPDATE_BG="VB_UPDATE_BG",e.VB_PREDICT_DONE="VB_PREDICT_DONE",e.VB_MODEL_READY="VB_MODEL_READY",e.VB_FREE_MEMORY="VB_FREE_MEMORY",e.VB_VIDEO_FORMAT_UNSUPPORTED="VB_VIDEO_FORMAT_UNSUPPORTED",e.VB_WORKER_INIT="VB_WORKER_INIT",e.VB_WORKER_ERROR="VB_WORKER_ERROR"}(n||(t.VB_EVENT_TYPE=n={}))}]);
//# sourceMappingURL=https://d1cdksi819e9z7.cloudfront.net/sourcemap/vb_worker.min.js-90bb30b284b21116117d.map