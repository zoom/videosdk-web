(()=>{var e={129:(e,t,r)=>{e.exports=r(1086)},6040:(e,t,r)=>{"use strict";var i=r(8251);e.exports=i},7264:(e,t,r)=>{"use strict";var i=r(4139);r(768),r(8549),r(7152),r(1372),e.exports=i},9692:(e,t,r)=>{"use strict";var i=r(7045);e.exports=i},5663:(e,t,r)=>{"use strict";var i=r(70);e.exports=i},1263:(e,t,r)=>{"use strict";r(6737);var i=r(1747);e.exports=i("Array","sort")},2757:(e,t,r)=>{"use strict";var i=r(8280),n=r(1263),s=Array.prototype;e.exports=function(e){var t=e.sort;return e===s||i(s,e)&&t===s.sort?n:t}},1926:(e,t,r)=>{"use strict";r(6750);var i=r(2046).Object,n=e.exports=function(e,t,r){return i.defineProperty(e,t,r)};i.defineProperty.sham&&(n.sham=!0)},3842:(e,t,r)=>{"use strict";r(8545),r(3643),r(4452),r(5546),r(3997),r(5084),r(2499),r(2596),r(5721),r(4954),r(4123),r(3377),r(2230),r(5344),r(1660),r(4610),r(3669),r(4810),r(3325),r(7024),r(8172),r(5205);var i=r(2046);e.exports=i.Symbol},1730:(e,t,r)=>{"use strict";r(9363),r(3643),r(7057),r(4954);var i=r(560);e.exports=i.f("iterator")},1661:(e,t,r)=>{"use strict";r(8537),r(3669);var i=r(560);e.exports=i.f("toPrimitive")},4997:(e,t,r)=>{"use strict";var i=r(6040);e.exports=i},2321:(e,t,r)=>{"use strict";var i=r(7264);r(3939),r(1785),r(1697),r(4664),r(3422),r(36),r(8703),r(6878),r(9671),r(359),e.exports=i},2231:(e,t,r)=>{"use strict";var i=r(9692);e.exports=i},9280:(e,t,r)=>{"use strict";var i=r(5663);e.exports=i},2159:(e,t,r)=>{"use strict";var i=r(2250),n=r(4640),s=TypeError;e.exports=function(e){if(i(e))return e;throw new s(n(e)+" is not a function")}},43:(e,t,r)=>{"use strict";var i=r(4018),n=String,s=TypeError;e.exports=function(e){if(i(e))return e;throw new s("Can't set "+n(e)+" as a prototype")}},2156:e=>{"use strict";e.exports=function(){}},6624:(e,t,r)=>{"use strict";var i=r(6285),n=String,s=TypeError;e.exports=function(e){if(i(e))return e;throw new s(n(e)+" is not an object")}},4436:(e,t,r)=>{"use strict";var i=r(7374),n=r(4849),s=r(575),a=function(e){return function(t,r,a){var o=i(t),u=s(o);if(0===u)return!e&&-1;var l,c=n(a,u);if(e&&r!=r){for(;u>c;)if((l=o[c++])!=l)return!0}else for(;u>c;c++)if((e||c in o)&&o[c]===r)return e||c||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},726:(e,t,r)=>{"use strict";var i=r(8311),n=r(1907),s=r(6946),a=r(9298),o=r(575),u=r(6968),l=n([].push),c=function(e){var t=1===e,r=2===e,n=3===e,c=4===e,h=6===e,f=7===e,d=5===e||h;return function(p,g,v,m){for(var y,b,x=a(p),w=s(x),_=o(w),P=i(g,v),T=0,S=m||u,U=t?S(p,_):r||f?S(p,0):void 0;_>T;T++)if((d||T in w)&&(b=P(y=w[T],T,x),e))if(t)U[T]=b;else if(b)switch(e){case 3:return!0;case 5:return y;case 6:return T;case 2:l(U,y)}else switch(e){case 4:return!1;case 7:l(U,y)}return h?-1:n||c?c:U}};e.exports={forEach:c(0),map:c(1),filter:c(2),some:c(3),every:c(4),find:c(5),findIndex:c(6),filterReject:c(7)}},7171:(e,t,r)=>{"use strict";var i=r(8828),n=r(6264),s=r(798),a=n("species");e.exports=function(e){return s>=51||!i((function(){var t=[];return(t.constructor={})[a]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},7623:(e,t,r)=>{"use strict";var i=r(8828);e.exports=function(e,t){var r=[][e];return!!r&&i((function(){r.call(null,t||function(){return 1},1)}))}},3427:(e,t,r)=>{"use strict";var i=r(1907);e.exports=i([].slice)},4321:(e,t,r)=>{"use strict";var i=r(3427),n=Math.floor,s=function(e,t){var r=e.length;if(r<8)for(var a,o,u=1;u<r;){for(o=u,a=e[u];o&&t(e[o-1],a)>0;)e[o]=e[--o];o!==u++&&(e[o]=a)}else for(var l=n(r/2),c=s(i(e,0,l),t),h=s(i(e,l),t),f=c.length,d=h.length,p=0,g=0;p<f||g<d;)e[p+g]=p<f&&g<d?t(c[p],h[g])<=0?c[p++]:h[g++]:p<f?c[p++]:h[g++];return e};e.exports=s},4010:(e,t,r)=>{"use strict";var i=r(1793),n=r(5468),s=r(6285),a=r(6264)("species"),o=Array;e.exports=function(e){var t;return i(e)&&(t=e.constructor,(n(t)&&(t===o||i(t.prototype))||s(t)&&null===(t=t[a]))&&(t=void 0)),void 0===t?o:t}},6968:(e,t,r)=>{"use strict";var i=r(4010);e.exports=function(e,t){return new(i(e))(0===t?0:t)}},5807:(e,t,r)=>{"use strict";var i=r(1907),n=i({}.toString),s=i("".slice);e.exports=function(e){return s(n(e),8,-1)}},3948:(e,t,r)=>{"use strict";var i=r(2623),n=r(2250),s=r(5807),a=r(6264)("toStringTag"),o=Object,u="Arguments"===s(function(){return arguments}());e.exports=i?s:function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=o(e),a))?r:u?s(t):"Object"===(i=s(t))&&n(t.callee)?"Arguments":i}},7382:(e,t,r)=>{"use strict";var i=r(8828);e.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},9550:e=>{"use strict";e.exports=function(e,t){return{value:e,done:t}}},1626:(e,t,r)=>{"use strict";var i=r(9447),n=r(4284),s=r(5817);e.exports=i?function(e,t,r){return n.f(e,t,s(1,r))}:function(e,t,r){return e[t]=r,e}},5817:e=>{"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},5543:(e,t,r)=>{"use strict";var i=r(9447),n=r(4284),s=r(5817);e.exports=function(e,t,r){i?n.f(e,t,s(0,r)):e[t]=r}},9251:(e,t,r)=>{"use strict";var i=r(4284);e.exports=function(e,t,r){return i.f(e,t,r)}},8055:(e,t,r)=>{"use strict";var i=r(1626);e.exports=function(e,t,r,n){return n&&n.enumerable?e[t]=r:i(e,t,r),e}},2532:(e,t,r)=>{"use strict";var i=r(5951),n=Object.defineProperty;e.exports=function(e,t){try{n(i,e,{value:t,configurable:!0,writable:!0})}catch(r){i[e]=t}return t}},4535:(e,t,r)=>{"use strict";var i=r(4640),n=TypeError;e.exports=function(e,t){if(!delete e[t])throw new n("Cannot delete property "+i(t)+" of "+i(e))}},9447:(e,t,r)=>{"use strict";var i=r(8828);e.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},9552:(e,t,r)=>{"use strict";var i=r(5951),n=r(6285),s=i.document,a=n(s)&&n(s.createElement);e.exports=function(e){return a?s.createElement(e):{}}},8024:e=>{"use strict";var t=TypeError;e.exports=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}},9287:e=>{"use strict";e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},376:e=>{"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},3440:(e,t,r)=>{"use strict";var i=r(6794).match(/firefox\/(\d+)/i);e.exports=!!i&&+i[1]},4328:(e,t,r)=>{"use strict";var i=r(6794);e.exports=/MSIE|Trident/.test(i)},6794:(e,t,r)=>{"use strict";var i=r(5951).navigator,n=i&&i.userAgent;e.exports=n?String(n):""},798:(e,t,r)=>{"use strict";var i,n,s=r(5951),a=r(6794),o=s.process,u=s.Deno,l=o&&o.versions||u&&u.version,c=l&&l.v8;c&&(n=(i=c.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!n&&a&&(!(i=a.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=a.match(/Chrome\/(\d+)/))&&(n=+i[1]),e.exports=n},3786:(e,t,r)=>{"use strict";var i=r(6794).match(/AppleWebKit\/(\d+)\./);e.exports=!!i&&+i[1]},1091:(e,t,r)=>{"use strict";var i=r(5951),n=r(6024),s=r(2361),a=r(2250),o=r(3846).f,u=r(7463),l=r(2046),c=r(8311),h=r(1626),f=r(9724);r(6128);var d=function(e){var t=function(r,i,s){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,i)}return new e(r,i,s)}return n(e,this,arguments)};return t.prototype=e.prototype,t};e.exports=function(e,t){var r,n,p,g,v,m,y,b,x,w=e.target,_=e.global,P=e.stat,T=e.proto,S=_?i:P?i[w]:i[w]&&i[w].prototype,U=_?l:l[w]||h(l,w,{})[w],M=U.prototype;for(g in t)n=!(r=u(_?g:w+(P?".":"#")+g,e.forced))&&S&&f(S,g),m=U[g],n&&(y=e.dontCallGetSet?(x=o(S,g))&&x.value:S[g]),v=n&&y?y:t[g],(r||T||typeof m!=typeof v)&&(b=e.bind&&n?c(v,i):e.wrap&&n?d(v):T&&a(v)?s(v):v,(e.sham||v&&v.sham||m&&m.sham)&&h(b,"sham",!0),h(U,g,b),T&&(f(l,p=w+"Prototype")||h(l,p,{}),h(l[p],g,v),e.real&&M&&(r||!M[g])&&h(M,g,v)))}},8828:e=>{"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},6024:(e,t,r)=>{"use strict";var i=r(1505),n=Function.prototype,s=n.apply,a=n.call;e.exports="object"==typeof Reflect&&Reflect.apply||(i?a.bind(s):function(){return a.apply(s,arguments)})},8311:(e,t,r)=>{"use strict";var i=r(2361),n=r(2159),s=r(1505),a=i(i.bind);e.exports=function(e,t){return n(e),void 0===t?e:s?a(e,t):function(){return e.apply(t,arguments)}}},1505:(e,t,r)=>{"use strict";var i=r(8828);e.exports=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},3930:(e,t,r)=>{"use strict";var i=r(1505),n=Function.prototype.call;e.exports=i?n.bind(n):function(){return n.apply(n,arguments)}},6833:(e,t,r)=>{"use strict";var i=r(9447),n=r(9724),s=Function.prototype,a=i&&Object.getOwnPropertyDescriptor,o=n(s,"name"),u=o&&"something"===function(){}.name,l=o&&(!i||i&&a(s,"name").configurable);e.exports={EXISTS:o,PROPER:u,CONFIGURABLE:l}},1871:(e,t,r)=>{"use strict";var i=r(1907),n=r(2159);e.exports=function(e,t,r){try{return i(n(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(e){}}},2361:(e,t,r)=>{"use strict";var i=r(5807),n=r(1907);e.exports=function(e){if("Function"===i(e))return n(e)}},1907:(e,t,r)=>{"use strict";var i=r(1505),n=Function.prototype,s=n.call,a=i&&n.bind.bind(s,s);e.exports=i?a:function(e){return function(){return s.apply(e,arguments)}}},1747:(e,t,r)=>{"use strict";var i=r(5951),n=r(2046);e.exports=function(e,t){var r=n[e+"Prototype"],s=r&&r[t];if(s)return s;var a=i[e],o=a&&a.prototype;return o&&o[t]}},5582:(e,t,r)=>{"use strict";var i=r(2046),n=r(5951),s=r(2250),a=function(e){return s(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?a(i[e])||a(n[e]):i[e]&&i[e][t]||n[e]&&n[e][t]}},6656:(e,t,r)=>{"use strict";var i=r(1907),n=r(1793),s=r(2250),a=r(5807),o=r(160),u=i([].push);e.exports=function(e){if(s(e))return e;if(n(e)){for(var t=e.length,r=[],i=0;i<t;i++){var l=e[i];"string"==typeof l?u(r,l):"number"!=typeof l&&"Number"!==a(l)&&"String"!==a(l)||u(r,o(l))}var c=r.length,h=!0;return function(e,t){if(h)return h=!1,t;if(n(this))return t;for(var i=0;i<c;i++)if(r[i]===e)return t}}}},9367:(e,t,r)=>{"use strict";var i=r(2159),n=r(7136);e.exports=function(e,t){var r=e[t];return n(r)?void 0:i(r)}},5951:function(e,t,r){"use strict";var i=function(e){return e&&e.Math===Math&&e};e.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof r.g&&r.g)||i("object"==typeof this&&this)||function(){return this}()||Function("return this")()},9724:(e,t,r)=>{"use strict";var i=r(1907),n=r(9298),s=i({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return s(n(e),t)}},8530:e=>{"use strict";e.exports={}},2416:(e,t,r)=>{"use strict";var i=r(5582);e.exports=i("document","documentElement")},3648:(e,t,r)=>{"use strict";var i=r(9447),n=r(8828),s=r(9552);e.exports=!i&&!n((function(){return 7!==Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))},6946:(e,t,r)=>{"use strict";var i=r(1907),n=r(8828),s=r(5807),a=Object,o=i("".split);e.exports=n((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"===s(e)?o(e,""):a(e)}:a},2647:(e,t,r)=>{"use strict";var i=r(1907),n=r(2250),s=r(6128),a=i(Function.toString);n(s.inspectSource)||(s.inspectSource=function(e){return a(e)}),e.exports=s.inspectSource},4932:(e,t,r)=>{"use strict";var i,n,s,a=r(551),o=r(5951),u=r(6285),l=r(1626),c=r(9724),h=r(6128),f=r(2522),d=r(8530),p="Object already initialized",g=o.TypeError,v=o.WeakMap;if(a||h.state){var m=h.state||(h.state=new v);m.get=m.get,m.has=m.has,m.set=m.set,i=function(e,t){if(m.has(e))throw new g(p);return t.facade=e,m.set(e,t),t},n=function(e){return m.get(e)||{}},s=function(e){return m.has(e)}}else{var y=f("state");d[y]=!0,i=function(e,t){if(c(e,y))throw new g(p);return t.facade=e,l(e,y,t),t},n=function(e){return c(e,y)?e[y]:{}},s=function(e){return c(e,y)}}e.exports={set:i,get:n,has:s,enforce:function(e){return s(e)?n(e):i(e,{})},getterFor:function(e){return function(t){var r;if(!u(t)||(r=n(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return r}}}},1793:(e,t,r)=>{"use strict";var i=r(5807);e.exports=Array.isArray||function(e){return"Array"===i(e)}},2250:e=>{"use strict";var t="object"==typeof document&&document.all;e.exports=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},5468:(e,t,r)=>{"use strict";var i=r(1907),n=r(8828),s=r(2250),a=r(3948),o=r(5582),u=r(2647),l=function(){},c=o("Reflect","construct"),h=/^\s*(?:class|function)\b/,f=i(h.exec),d=!h.test(l),p=function(e){if(!s(e))return!1;try{return c(l,[],e),!0}catch(e){return!1}},g=function(e){if(!s(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return d||!!f(h,u(e))}catch(e){return!0}};g.sham=!0,e.exports=!c||n((function(){var e;return p(p.call)||!p(Object)||!p((function(){e=!0}))||e}))?g:p},7463:(e,t,r)=>{"use strict";var i=r(8828),n=r(2250),s=/#|\.prototype\./,a=function(e,t){var r=u[o(e)];return r===c||r!==l&&(n(t)?i(t):!!t)},o=a.normalize=function(e){return String(e).replace(s,".").toLowerCase()},u=a.data={},l=a.NATIVE="N",c=a.POLYFILL="P";e.exports=a},7136:e=>{"use strict";e.exports=function(e){return null==e}},6285:(e,t,r)=>{"use strict";var i=r(2250);e.exports=function(e){return"object"==typeof e?null!==e:i(e)}},4018:(e,t,r)=>{"use strict";var i=r(6285);e.exports=function(e){return i(e)||null===e}},7376:e=>{"use strict";e.exports=!0},5594:(e,t,r)=>{"use strict";var i=r(5582),n=r(2250),s=r(8280),a=r(1175),o=Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return n(t)&&s(t.prototype,o(e))}},7181:(e,t,r)=>{"use strict";var i=r(5116).IteratorPrototype,n=r(8075),s=r(5817),a=r(4840),o=r(3742),u=function(){return this};e.exports=function(e,t,r,l){var c=t+" Iterator";return e.prototype=n(i,{next:s(+!l,r)}),a(e,c,!1,!0),o[c]=u,e}},183:(e,t,r)=>{"use strict";var i=r(1091),n=r(3930),s=r(7376),a=r(6833),o=r(2250),u=r(7181),l=r(5972),c=r(9192),h=r(4840),f=r(1626),d=r(8055),p=r(6264),g=r(3742),v=r(5116),m=a.PROPER,y=a.CONFIGURABLE,b=v.IteratorPrototype,x=v.BUGGY_SAFARI_ITERATORS,w=p("iterator"),_="keys",P="values",T="entries",S=function(){return this};e.exports=function(e,t,r,a,p,v,U){u(r,t,a);var M,R,E,G=function(e){if(e===p&&F)return F;if(!x&&e&&e in W)return W[e];switch(e){case _:case P:case T:return function(){return new r(this,e)}}return function(){return new r(this)}},k=t+" Iterator",B=!1,W=e.prototype,C=W[w]||W["@@iterator"]||p&&W[p],F=!x&&C||G(p),L="Array"===t&&W.entries||C;if(L&&(M=l(L.call(new e)))!==Object.prototype&&M.next&&(s||l(M)===b||(c?c(M,b):o(M[w])||d(M,w,S)),h(M,k,!0,!0),s&&(g[k]=S)),m&&p===P&&C&&C.name!==P&&(!s&&y?f(W,"name",P):(B=!0,F=function(){return n(C,this)})),p)if(R={values:G(P),keys:v?F:G(_),entries:G(T)},U)for(E in R)(x||B||!(E in W))&&d(W,E,R[E]);else i({target:t,proto:!0,forced:x||B},R);return s&&!U||W[w]===F||d(W,w,F,{name:p}),g[t]=F,R}},5116:(e,t,r)=>{"use strict";var i,n,s,a=r(8828),o=r(2250),u=r(6285),l=r(8075),c=r(5972),h=r(8055),f=r(6264),d=r(7376),p=f("iterator"),g=!1;[].keys&&("next"in(s=[].keys())?(n=c(c(s)))!==Object.prototype&&(i=n):g=!0),!u(i)||a((function(){var e={};return i[p].call(e)!==e}))?i={}:d&&(i=l(i)),o(i[p])||h(i,p,(function(){return this})),e.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:g}},3742:e=>{"use strict";e.exports={}},575:(e,t,r)=>{"use strict";var i=r(3121);e.exports=function(e){return i(e.length)}},1176:e=>{"use strict";var t=Math.ceil,r=Math.floor;e.exports=Math.trunc||function(e){var i=+e;return(i>0?r:t)(i)}},8075:(e,t,r)=>{"use strict";var i,n=r(6624),s=r(2220),a=r(376),o=r(8530),u=r(2416),l=r(9552),c=r(2522),h="prototype",f="script",d=c("IE_PROTO"),p=function(){},g=function(e){return"<"+f+">"+e+"</"+f+">"},v=function(e){e.write(g("")),e.close();var t=e.parentWindow.Object;return e=null,t},m=function(){try{i=new ActiveXObject("htmlfile")}catch(e){}var e,t,r;m="undefined"!=typeof document?document.domain&&i?v(i):(t=l("iframe"),r="java"+f+":",t.style.display="none",u.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(g("document.F=Object")),e.close(),e.F):v(i);for(var n=a.length;n--;)delete m[h][a[n]];return m()};o[d]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(p[h]=n(e),r=new p,p[h]=null,r[d]=e):r=m(),void 0===t?r:s.f(r,t)}},2220:(e,t,r)=>{"use strict";var i=r(9447),n=r(8661),s=r(4284),a=r(6624),o=r(7374),u=r(2875);t.f=i&&!n?Object.defineProperties:function(e,t){a(e);for(var r,i=o(t),n=u(t),l=n.length,c=0;l>c;)s.f(e,r=n[c++],i[r]);return e}},4284:(e,t,r)=>{"use strict";var i=r(9447),n=r(3648),s=r(8661),a=r(6624),o=r(470),u=TypeError,l=Object.defineProperty,c=Object.getOwnPropertyDescriptor,h="enumerable",f="configurable",d="writable";t.f=i?s?function(e,t,r){if(a(e),t=o(t),a(r),"function"==typeof e&&"prototype"===t&&"value"in r&&d in r&&!r[d]){var i=c(e,t);i&&i[d]&&(e[t]=r.value,r={configurable:f in r?r[f]:i[f],enumerable:h in r?r[h]:i[h],writable:!1})}return l(e,t,r)}:l:function(e,t,r){if(a(e),t=o(t),a(r),n)try{return l(e,t,r)}catch(e){}if("get"in r||"set"in r)throw new u("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},3846:(e,t,r)=>{"use strict";var i=r(9447),n=r(3930),s=r(2574),a=r(5817),o=r(7374),u=r(470),l=r(9724),c=r(3648),h=Object.getOwnPropertyDescriptor;t.f=i?h:function(e,t){if(e=o(e),t=u(t),c)try{return h(e,t)}catch(e){}if(l(e,t))return a(!n(s.f,e,t),e[t])}},5407:(e,t,r)=>{"use strict";var i=r(5807),n=r(7374),s=r(4443).f,a=r(3427),o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"Window"===i(e)?function(e){try{return s(e)}catch(e){return a(o)}}(e):s(n(e))}},4443:(e,t,r)=>{"use strict";var i=r(3045),n=r(376).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,n)}},7170:(e,t)=>{"use strict";t.f=Object.getOwnPropertySymbols},5972:(e,t,r)=>{"use strict";var i=r(9724),n=r(2250),s=r(9298),a=r(2522),o=r(7382),u=a("IE_PROTO"),l=Object,c=l.prototype;e.exports=o?l.getPrototypeOf:function(e){var t=s(e);if(i(t,u))return t[u];var r=t.constructor;return n(r)&&t instanceof r?r.prototype:t instanceof l?c:null}},8280:(e,t,r)=>{"use strict";var i=r(1907);e.exports=i({}.isPrototypeOf)},3045:(e,t,r)=>{"use strict";var i=r(1907),n=r(9724),s=r(7374),a=r(4436).indexOf,o=r(8530),u=i([].push);e.exports=function(e,t){var r,i=s(e),l=0,c=[];for(r in i)!n(o,r)&&n(i,r)&&u(c,r);for(;t.length>l;)n(i,r=t[l++])&&(~a(c,r)||u(c,r));return c}},2875:(e,t,r)=>{"use strict";var i=r(3045),n=r(376);e.exports=Object.keys||function(e){return i(e,n)}},2574:(e,t)=>{"use strict";var r={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,n=i&&!r.call({1:2},1);t.f=n?function(e){var t=i(this,e);return!!t&&t.enumerable}:r},9192:(e,t,r)=>{"use strict";var i=r(1871),n=r(6285),s=r(4239),a=r(43);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=i(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch(e){}return function(r,i){return s(r),a(i),n(r)?(t?e(r,i):r.__proto__=i,r):r}}():void 0)},4878:(e,t,r)=>{"use strict";var i=r(2623),n=r(3948);e.exports=i?{}.toString:function(){return"[object "+n(this)+"]"}},581:(e,t,r)=>{"use strict";var i=r(3930),n=r(2250),s=r(6285),a=TypeError;e.exports=function(e,t){var r,o;if("string"===t&&n(r=e.toString)&&!s(o=i(r,e)))return o;if(n(r=e.valueOf)&&!s(o=i(r,e)))return o;if("string"!==t&&n(r=e.toString)&&!s(o=i(r,e)))return o;throw new a("Can't convert object to primitive value")}},2046:e=>{"use strict";e.exports={}},4239:(e,t,r)=>{"use strict";var i=r(7136),n=TypeError;e.exports=function(e){if(i(e))throw new n("Can't call method on "+e);return e}},4840:(e,t,r)=>{"use strict";var i=r(2623),n=r(4284).f,s=r(1626),a=r(9724),o=r(4878),u=r(6264)("toStringTag");e.exports=function(e,t,r,l){var c=r?e:e&&e.prototype;c&&(a(c,u)||n(c,u,{configurable:!0,value:t}),l&&!i&&s(c,"toString",o))}},2522:(e,t,r)=>{"use strict";var i=r(5816),n=r(6499),s=i("keys");e.exports=function(e){return s[e]||(s[e]=n(e))}},6128:(e,t,r)=>{"use strict";var i=r(7376),n=r(5951),s=r(2532),a="__core-js_shared__",o=e.exports=n[a]||s(a,{});(o.versions||(o.versions=[])).push({version:"3.46.0",mode:i?"pure":"global",copyright:"Â© 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"})},5816:(e,t,r)=>{"use strict";var i=r(6128);e.exports=function(e,t){return i[e]||(i[e]=t||{})}},1470:(e,t,r)=>{"use strict";var i=r(1907),n=r(5482),s=r(160),a=r(4239),o=i("".charAt),u=i("".charCodeAt),l=i("".slice),c=function(e){return function(t,r){var i,c,h=s(a(t)),f=n(r),d=h.length;return f<0||f>=d?e?"":void 0:(i=u(h,f))<55296||i>56319||f+1===d||(c=u(h,f+1))<56320||c>57343?e?o(h,f):i:e?l(h,f,f+2):c-56320+(i-55296<<10)+65536}};e.exports={codeAt:c(!1),charAt:c(!0)}},9846:(e,t,r)=>{"use strict";var i=r(798),n=r(8828),s=r(5951).String;e.exports=!!Object.getOwnPropertySymbols&&!n((function(){var e=Symbol("symbol detection");return!s(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41}))},3467:(e,t,r)=>{"use strict";var i=r(3930),n=r(5582),s=r(6264),a=r(8055);e.exports=function(){var e=n("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,o=s("toPrimitive");t&&!t[o]&&a(t,o,(function(e){return i(r,this)}),{arity:1})}},2595:(e,t,r)=>{"use strict";var i=r(5582),n=r(1907),s=i("Symbol"),a=s.keyFor,o=n(s.prototype.valueOf);e.exports=s.isRegisteredSymbol||function(e){try{return void 0!==a(o(e))}catch(e){return!1}}},9197:(e,t,r)=>{"use strict";for(var i=r(5816),n=r(5582),s=r(1907),a=r(5594),o=r(6264),u=n("Symbol"),l=u.isWellKnownSymbol,c=n("Object","getOwnPropertyNames"),h=s(u.prototype.valueOf),f=i("wks"),d=0,p=c(u),g=p.length;d<g;d++)try{var v=p[d];a(u[v])&&o(v)}catch(e){}e.exports=function(e){if(l&&l(e))return!0;try{for(var t=h(e),r=0,i=c(f),n=i.length;r<n;r++)if(f[i[r]]==t)return!0}catch(e){}return!1}},4411:(e,t,r)=>{"use strict";var i=r(9846);e.exports=i&&!!Symbol.for&&!!Symbol.keyFor},4849:(e,t,r)=>{"use strict";var i=r(5482),n=Math.max,s=Math.min;e.exports=function(e,t){var r=i(e);return r<0?n(r+t,0):s(r,t)}},7374:(e,t,r)=>{"use strict";var i=r(6946),n=r(4239);e.exports=function(e){return i(n(e))}},5482:(e,t,r)=>{"use strict";var i=r(1176);e.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}},3121:(e,t,r)=>{"use strict";var i=r(5482),n=Math.min;e.exports=function(e){var t=i(e);return t>0?n(t,9007199254740991):0}},9298:(e,t,r)=>{"use strict";var i=r(4239),n=Object;e.exports=function(e){return n(i(e))}},6028:(e,t,r)=>{"use strict";var i=r(3930),n=r(6285),s=r(5594),a=r(9367),o=r(581),u=r(6264),l=TypeError,c=u("toPrimitive");e.exports=function(e,t){if(!n(e)||s(e))return e;var r,u=a(e,c);if(u){if(void 0===t&&(t="default"),r=i(u,e,t),!n(r)||s(r))return r;throw new l("Can't convert object to primitive value")}return void 0===t&&(t="number"),o(e,t)}},470:(e,t,r)=>{"use strict";var i=r(6028),n=r(5594);e.exports=function(e){var t=i(e,"string");return n(t)?t:t+""}},2623:(e,t,r)=>{"use strict";var i={};i[r(6264)("toStringTag")]="z",e.exports="[object z]"===String(i)},160:(e,t,r)=>{"use strict";var i=r(3948),n=String;e.exports=function(e){if("Symbol"===i(e))throw new TypeError("Cannot convert a Symbol value to a string");return n(e)}},4640:e=>{"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},6499:(e,t,r)=>{"use strict";var i=r(1907),n=0,s=Math.random(),a=i(1.1.toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++n+s,36)}},1175:(e,t,r)=>{"use strict";var i=r(9846);e.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},8661:(e,t,r)=>{"use strict";var i=r(9447),n=r(8828);e.exports=i&&n((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},551:(e,t,r)=>{"use strict";var i=r(5951),n=r(2250),s=i.WeakMap;e.exports=n(s)&&/native code/.test(String(s))},366:(e,t,r)=>{"use strict";var i=r(2046),n=r(9724),s=r(560),a=r(4284).f;e.exports=function(e){var t=i.Symbol||(i.Symbol={});n(t,e)||a(t,e,{value:s.f(e)})}},560:(e,t,r)=>{"use strict";var i=r(6264);t.f=i},6264:(e,t,r)=>{"use strict";var i=r(5951),n=r(5816),s=r(9724),a=r(6499),o=r(9846),u=r(1175),l=i.Symbol,c=n("wks"),h=u?l.for||l:l&&l.withoutSetter||a;e.exports=function(e){return s(c,e)||(c[e]=o&&s(l,e)?l[e]:h("Symbol."+e)),c[e]}},8545:(e,t,r)=>{"use strict";var i=r(1091),n=r(8828),s=r(1793),a=r(6285),o=r(9298),u=r(575),l=r(8024),c=r(5543),h=r(6968),f=r(7171),d=r(6264),p=r(798),g=d("isConcatSpreadable"),v=p>=51||!n((function(){var e=[];return e[g]=!1,e.concat()[0]!==e})),m=function(e){if(!a(e))return!1;var t=e[g];return void 0!==t?!!t:s(e)};i({target:"Array",proto:!0,arity:1,forced:!v||!f("concat")},{concat:function(e){var t,r,i,n,s,a=o(this),f=h(a,0),d=0;for(t=-1,i=arguments.length;t<i;t++)if(m(s=-1===t?a:arguments[t]))for(n=u(s),l(d+n),r=0;r<n;r++,d++)r in s&&c(f,d,s[r]);else l(d+1),c(f,d++,s);return f.length=d,f}})},9363:(e,t,r)=>{"use strict";var i=r(7374),n=r(2156),s=r(3742),a=r(4932),o=r(4284).f,u=r(183),l=r(9550),c=r(7376),h=r(9447),f="Array Iterator",d=a.set,p=a.getterFor(f);e.exports=u(Array,"Array",(function(e,t){d(this,{type:f,target:i(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,l(void 0,!0);switch(e.kind){case"keys":return l(r,!1);case"values":return l(t[r],!1)}return l([r,t[r]],!1)}),"values");var g=s.Arguments=s.Array;if(n("keys"),n("values"),n("entries"),!c&&h&&"values"!==g.name)try{o(g,"name",{value:"values"})}catch(e){}},6737:(e,t,r)=>{"use strict";var i=r(1091),n=r(1907),s=r(2159),a=r(9298),o=r(575),u=r(4535),l=r(160),c=r(8828),h=r(4321),f=r(7623),d=r(3440),p=r(4328),g=r(798),v=r(3786),m=[],y=n(m.sort),b=n(m.push),x=c((function(){m.sort(void 0)})),w=c((function(){m.sort(null)})),_=f("sort"),P=!c((function(){if(g)return g<70;if(!(d&&d>3)){if(p)return!0;if(v)return v<603;var e,t,r,i,n="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(i=0;i<47;i++)m.push({k:t+i,v:r})}for(m.sort((function(e,t){return t.v-e.v})),i=0;i<m.length;i++)t=m[i].k.charAt(0),n.charAt(n.length-1)!==t&&(n+=t);return"DGBEFHACIJK"!==n}}));i({target:"Array",proto:!0,forced:x||!w||!_||!P},{sort:function(e){void 0!==e&&s(e);var t=a(this);if(P)return void 0===e?y(t):y(t,e);var r,i,n=[],c=o(t);for(i=0;i<c;i++)i in t&&b(n,t[i]);for(h(n,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:l(t)>l(r)?1:-1}}(e)),r=o(n),i=0;i<r;)t[i]=n[i++];for(;i<c;)u(t,i++);return t}})},8537:()=>{},9721:(e,t,r)=>{"use strict";var i=r(1091),n=r(5582),s=r(6024),a=r(3930),o=r(1907),u=r(8828),l=r(2250),c=r(5594),h=r(3427),f=r(6656),d=r(9846),p=String,g=n("JSON","stringify"),v=o(/./.exec),m=o("".charAt),y=o("".charCodeAt),b=o("".replace),x=o(1.1.toString),w=/[\uD800-\uDFFF]/g,_=/^[\uD800-\uDBFF]$/,P=/^[\uDC00-\uDFFF]$/,T=!d||u((function(){var e=n("Symbol")("stringify detection");return"[null]"!==g([e])||"{}"!==g({a:e})||"{}"!==g(Object(e))})),S=u((function(){return'"\\udf06\\ud834"'!==g("\udf06\ud834")||'"\\udead"'!==g("\udead")})),U=function(e,t){var r=h(arguments),i=f(t);if(l(i)||void 0!==e&&!c(e))return r[1]=function(e,t){if(l(i)&&(t=a(i,this,p(e),t)),!c(t))return t},s(g,null,r)},M=function(e,t,r){var i=m(r,t-1),n=m(r,t+1);return v(_,e)&&!v(P,n)||v(P,e)&&!v(_,i)?"\\u"+x(y(e,0),16):e};g&&i({target:"JSON",stat:!0,arity:3,forced:T||S},{stringify:function(e,t,r){var i=h(arguments),n=s(T?U:g,null,i);return S&&"string"==typeof n?b(n,w,M):n}})},7024:(e,t,r)=>{"use strict";var i=r(5951);r(4840)(i.JSON,"JSON",!0)},8172:()=>{},6750:(e,t,r)=>{"use strict";var i=r(1091),n=r(9447),s=r(4284).f;i({target:"Object",stat:!0,forced:Object.defineProperty!==s,sham:!n},{defineProperty:s})},5264:(e,t,r)=>{"use strict";var i=r(1091),n=r(9846),s=r(8828),a=r(7170),o=r(9298);i({target:"Object",stat:!0,forced:!n||s((function(){a.f(1)}))},{getOwnPropertySymbols:function(e){var t=a.f;return t?t(o(e)):[]}})},3643:()=>{},5205:()=>{},7057:(e,t,r)=>{"use strict";var i=r(1470).charAt,n=r(160),s=r(4932),a=r(183),o=r(9550),u="String Iterator",l=s.set,c=s.getterFor(u);a(String,"String",(function(e){l(this,{type:u,string:n(e),index:0})}),(function(){var e,t=c(this),r=t.string,n=t.index;return n>=r.length?o(void 0,!0):(e=i(r,n),t.index+=e.length,o(e,!1))}))},5546:(e,t,r)=>{"use strict";r(366)("asyncDispose")},3997:(e,t,r)=>{"use strict";r(366)("asyncIterator")},3674:(e,t,r)=>{"use strict";var i=r(1091),n=r(5951),s=r(3930),a=r(1907),o=r(7376),u=r(9447),l=r(9846),c=r(8828),h=r(9724),f=r(8280),d=r(6624),p=r(7374),g=r(470),v=r(160),m=r(5817),y=r(8075),b=r(2875),x=r(4443),w=r(5407),_=r(7170),P=r(3846),T=r(4284),S=r(2220),U=r(2574),M=r(8055),R=r(9251),E=r(5816),G=r(2522),k=r(8530),B=r(6499),W=r(6264),C=r(560),F=r(366),L=r(3467),O=r(4840),I=r(4932),A=r(726).forEach,V=G("hidden"),N="Symbol",D="prototype",j=I.set,z=I.getterFor(N),q=Object[D],Y=n.Symbol,H=Y&&Y[D],$=n.RangeError,X=n.TypeError,J=n.QObject,K=P.f,Z=T.f,Q=w.f,ee=U.f,te=a([].push),re=E("symbols"),ie=E("op-symbols"),ne=E("wks"),se=!J||!J[D]||!J[D].findChild,ae=function(e,t,r){var i=K(q,t);i&&delete q[t],Z(e,t,r),i&&e!==q&&Z(q,t,i)},oe=u&&c((function(){return 7!==y(Z({},"a",{get:function(){return Z(this,"a",{value:7}).a}})).a}))?ae:Z,ue=function(e,t){var r=re[e]=y(H);return j(r,{type:N,tag:e,description:t}),u||(r.description=t),r},le=function(e,t,r){e===q&&le(ie,t,r),d(e);var i=g(t);return d(r),h(re,i)?(r.enumerable?(h(e,V)&&e[V][i]&&(e[V][i]=!1),r=y(r,{enumerable:m(0,!1)})):(h(e,V)||Z(e,V,m(1,y(null))),e[V][i]=!0),oe(e,i,r)):Z(e,i,r)},ce=function(e,t){d(e);var r=p(t),i=b(r).concat(pe(r));return A(i,(function(t){u&&!s(he,r,t)||le(e,t,r[t])})),e},he=function(e){var t=g(e),r=s(ee,this,t);return!(this===q&&h(re,t)&&!h(ie,t))&&(!(r||!h(this,t)||!h(re,t)||h(this,V)&&this[V][t])||r)},fe=function(e,t){var r=p(e),i=g(t);if(r!==q||!h(re,i)||h(ie,i)){var n=K(r,i);return!n||!h(re,i)||h(r,V)&&r[V][i]||(n.enumerable=!0),n}},de=function(e){var t=Q(p(e)),r=[];return A(t,(function(e){h(re,e)||h(k,e)||te(r,e)})),r},pe=function(e){var t=e===q,r=Q(t?ie:p(e)),i=[];return A(r,(function(e){!h(re,e)||t&&!h(q,e)||te(i,re[e])})),i};l||(M(H=(Y=function(){if(f(H,this))throw new X("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?v(arguments[0]):void 0,t=B(e),r=function(e){var i=void 0===this?n:this;i===q&&s(r,ie,e),h(i,V)&&h(i[V],t)&&(i[V][t]=!1);var a=m(1,e);try{oe(i,t,a)}catch(e){if(!(e instanceof $))throw e;ae(i,t,a)}};return u&&se&&oe(q,t,{configurable:!0,set:r}),ue(t,e)})[D],"toString",(function(){return z(this).tag})),M(Y,"withoutSetter",(function(e){return ue(B(e),e)})),U.f=he,T.f=le,S.f=ce,P.f=fe,x.f=w.f=de,_.f=pe,C.f=function(e){return ue(W(e),e)},u&&(R(H,"description",{configurable:!0,get:function(){return z(this).description}}),o||M(q,"propertyIsEnumerable",he,{unsafe:!0}))),i({global:!0,constructor:!0,wrap:!0,forced:!l,sham:!l},{Symbol:Y}),A(b(ne),(function(e){F(e)})),i({target:N,stat:!0,forced:!l},{useSetter:function(){se=!0},useSimple:function(){se=!1}}),i({target:"Object",stat:!0,forced:!l,sham:!u},{create:function(e,t){return void 0===t?y(e):ce(y(e),t)},defineProperty:le,defineProperties:ce,getOwnPropertyDescriptor:fe}),i({target:"Object",stat:!0,forced:!l},{getOwnPropertyNames:de}),L(),O(Y,N),k[V]=!0},5084:()=>{},2499:(e,t,r)=>{"use strict";r(366)("dispose")},3313:(e,t,r)=>{"use strict";var i=r(1091),n=r(5582),s=r(9724),a=r(160),o=r(5816),u=r(4411),l=o("string-to-symbol-registry"),c=o("symbol-to-string-registry");i({target:"Symbol",stat:!0,forced:!u},{for:function(e){var t=a(e);if(s(l,t))return l[t];var r=n("Symbol")(t);return l[t]=r,c[r]=t,r}})},2596:(e,t,r)=>{"use strict";r(366)("hasInstance")},5721:(e,t,r)=>{"use strict";r(366)("isConcatSpreadable")},4954:(e,t,r)=>{"use strict";r(366)("iterator")},4452:(e,t,r)=>{"use strict";r(3674),r(3313),r(751),r(9721),r(5264)},751:(e,t,r)=>{"use strict";var i=r(1091),n=r(9724),s=r(5594),a=r(4640),o=r(5816),u=r(4411),l=o("symbol-to-string-registry");i({target:"Symbol",stat:!0,forced:!u},{keyFor:function(e){if(!s(e))throw new TypeError(a(e)+" is not a symbol");if(n(l,e))return l[e]}})},3377:(e,t,r)=>{"use strict";r(366)("matchAll")},4123:(e,t,r)=>{"use strict";r(366)("match")},2230:(e,t,r)=>{"use strict";r(366)("replace")},5344:(e,t,r)=>{"use strict";r(366)("search")},1660:(e,t,r)=>{"use strict";r(366)("species")},4610:(e,t,r)=>{"use strict";r(366)("split")},3669:(e,t,r)=>{"use strict";var i=r(366),n=r(3467);i("toPrimitive"),n()},4810:(e,t,r)=>{"use strict";var i=r(5582),n=r(366),s=r(4840);n("toStringTag"),s(i("Symbol"),"Symbol")},3325:(e,t,r)=>{"use strict";r(366)("unscopables")},768:(e,t,r)=>{"use strict";var i=r(6264),n=r(4284).f,s=i("metadata"),a=Function.prototype;void 0===a[s]&&n(a,s,{value:null})},8549:(e,t,r)=>{"use strict";r(5546)},1697:(e,t,r)=>{"use strict";r(366)("customMatcher")},7152:(e,t,r)=>{"use strict";r(2499)},3939:(e,t,r)=>{"use strict";r(1091)({target:"Symbol",stat:!0},{isRegisteredSymbol:r(2595)})},3422:(e,t,r)=>{"use strict";r(1091)({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:r(2595)})},1785:(e,t,r)=>{"use strict";r(1091)({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:r(9197)})},36:(e,t,r)=>{"use strict";r(1091)({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:r(9197)})},8703:(e,t,r)=>{"use strict";r(366)("matcher")},6878:(e,t,r)=>{"use strict";r(366)("metadataKey")},1372:(e,t,r)=>{"use strict";r(366)("metadata")},4664:(e,t,r)=>{"use strict";r(366)("observable")},9671:(e,t,r)=>{"use strict";r(366)("patternMatch")},359:(e,t,r)=>{"use strict";r(366)("replaceAll")},2560:(e,t,r)=>{"use strict";r(9363);var i=r(9287),n=r(5951),s=r(4840),a=r(3742);for(var o in i)s(n[o],o),a[o]=a.Array},1086:(e,t,r)=>{"use strict";var i=r(2757);e.exports=i},8251:(e,t,r)=>{"use strict";var i=r(1926);e.exports=i},4139:(e,t,r)=>{"use strict";var i=r(3842);r(2560),e.exports=i},7045:(e,t,r)=>{"use strict";var i=r(1730);r(2560),e.exports=i},70:(e,t,r)=>{"use strict";var i=r(1661);e.exports=i}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";let e;const t=()=>e;var i=r(4997),n=r(2321),s=r(2231);function a(e){return a="function"==typeof n&&"symbol"==typeof s?function(e){return typeof e}:function(e){return e&&"function"==typeof n&&e.constructor===n&&e!==n.prototype?"symbol":typeof e},a(e)}var o=r(9280);const u=[{u:1,v:0},{u:1,v:1},{u:0,v:1},{u:1,v:0},{u:0,v:0},{u:0,v:1}],l=[{x:1,y:1},{x:1,y:-1},{x:-1,y:-1},{x:1,y:1},{x:-1,y:1},{x:-1,y:-1}],c=[60,120,180,360,540,720,1080,2160],h=[180,360,540,720,1080,2160],f=0,d=3;function p(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}function g(e,t){return e.get(m(e,t))}function v(e,t,r){return e.set(m(e,t),r),r}function m(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}new Map([["useinbandfec",1],["maxaveragebitrate",48e3],["maxplaybackrate",24e3],["sprop-maxcapturerate",24e3],["sprop-stereo",null],["stereo",null]]),new Map([["useinbandfec",null],["maxaveragebitrate",96e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3],["sprop-stereo",1],["stereo",1]]),new Map([["useinbandfec",null],["maxaveragebitrate",96e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3],["sprop-stereo",1],["stereo",1]]),new Map([["useinbandfec",null],["maxaveragebitrate",128e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3],["sprop-stereo",1],["stereo",1]]),new Map([["useinbandfec",null],["maxaveragebitrate",128e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3],["sprop-stereo",1],["stereo",1]]),new Map([["useinbandfec",null],["maxaveragebitrate",96e3],["maxplaybackrate",48e3],["sprop-maxcapturerate",48e3]]),new Map([["useinbandfec",1],["maxaveragebitrate",64e3],["maxplaybackrate",24e3],["sprop-maxcapturerate",24e3],["sprop-stereo",null],["stereo",null]]),new Map([["stereo",1]]);var y=new WeakMap,b=new WeakMap,x=new WeakMap,w=new WeakMap,_=new WeakMap,P=new WeakMap,T=new WeakMap,S=new WeakMap,U=new WeakMap,M=new WeakMap,R=new WeakMap,E=new WeakMap,G=new WeakMap,k=new WeakMap,B=new WeakMap,W=new WeakMap,C=new WeakMap,F=new WeakMap;const L=class{constructor(e,t){p(this,y,0),p(this,b,-1),p(this,x,0),p(this,w,0),p(this,_,-1),p(this,P,null),p(this,T,-1),p(this,S,null),p(this,U,null),p(this,M,null),p(this,R,!1),p(this,E,null),p(this,G,null),p(this,k,null),p(this,B,null),p(this,W,null),p(this,C,!1),p(this,F,""),v(y,this,e),v(b,this,t)}getIndex(){return g(y,this)}lock(){v(R,this,!0)}unlock(){v(R,this,!1)}isLocked(){return g(R,this)}getZIndex(){return g(b,this)}setWidth(e){v(x,this,e)}setHeight(e){v(w,this,e)}getWidth(){return g(x,this)}getHeight(){return g(w,this)}getRawData(){return g(P,this)}setRawData(e){v(P,this,e)}setIsNew(e){v(C,this,e)}isNew(){return g(C,this)}setColorFormat(e){v(F,this,e)}getColorFormat(){return g(F,this)}setPendingVideoFrame(e){g(E,this)&&(g(E,this).close(),v(E,this,null)),v(E,this,e)}clearPendingVideoFrame(){g(E,this)&&(g(E,this).close(),v(E,this,null))}setTextureLayerType(e){v(_,this,e)}getTextureLayerType(){return g(_,this)}setTextureType(e){v(T,this,e)}getTextureType(){return g(T,this)}getPendingVideoFrame(){return g(E,this)}getUVCoords(){return g(U,this)}setUVCoords(e){v(U,this,e)}getUVCoordsBuffer(){return g(B,this)}setUVCoordsBuffer(e){v(B,this,e)}evalViewport(e,t,r,i,n){g(M,this)||v(M,this,{}),g(M,this).x=Math.floor(e),g(M,this).w=Math.floor(r),g(M,this).h=Math.floor(i),0==g(_,this)?g(M,this).y=Math.floor(n-(t+i)):g(M,this).y=Math.floor(t),g(M,this).x<0&&(g(M,this).x=0),g(M,this).y<0&&(g(M,this).y=0),g(M,this).minDepth=0,g(M,this).maxDepth=1}setViewport(e){v(M,this,e)}getViewport(){return g(M,this)}getTextureGroup(){return g(S,this)}setTextureGroup(e){v(S,this,e)}setUniformBuffer(e){v(G,this,e)}getUniformBuffer(){return g(G,this)}setClearColorUniformBuffer(e){v(k,this,e)}getClearColorUniformBuffer(){return g(k,this)}setTextureBufferGroup(e){v(W,this,e)}getTextureBufferGroup(){return g(W,this)}destroyTextureBufferGroup(){g(W,this)&&v(W,this,null)}recycle(e){this.destroyTextureBufferGroup(),e&&e.destroyTextureGroup(this),g(E,this)&&(g(E,this).close(),v(E,this,null)),g(G,this)&&(g(G,this).destroy(),v(G,this,null)),g(k,this)&&(g(k,this).destroy(),v(k,this,null)),v(y,this,-1),v(b,this,-1),v(_,this,-1),v(P,this,null),v(T,this,-1),v(U,this,null),v(M,this,null),v(R,this,!1),v(C,this,!1),v(F,this,"")}};function O(e,r,i){if(!e||r<0||i<0)throw new Error("isDimensionsOverMaxDimension2DSize() invalid parameters. res=".concat(e,", width=").concat(r,", height=").concat(i));let n=!1,s=0;const a=e.acquireGPUFeaturesHelper();return a&&(s=a.queryMaxTextureDimension2D(),s>0&&(n=r>s||i>s)),n&&t().tracing.Log_Error("WebGPU isDimensionsOverMaxDimension2DSize() w:".concat(r," h:").concat(i," max:").concat(s)),n}function I(e,t,r){A(e,t),t.set(e,r)}function A(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function V(e,t){return e.get(D(e,t))}function N(e,t,r){return e.set(D(e,t),r),r}function D(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var j=new WeakMap,z=new WeakMap,q=new WeakMap,Y=new WeakMap,H=new WeakMap,$=new WeakMap,X=new WeakMap,J=new WeakMap,K=new WeakMap,Z=new WeakMap,Q=new WeakMap,ee=new WeakMap,te=new WeakMap,re=new WeakMap,ie=new WeakMap,ne=new WeakMap,se=new WeakMap,ae=new WeakMap,oe=new WeakMap,ue=new WeakMap,le=new WeakMap,ce=new WeakMap,he=new WeakMap,fe=new WeakMap,de=new WeakMap,pe=new WeakMap,ge=new WeakMap,ve=new WeakMap,me=new WeakMap,ye=new WeakMap,be=new WeakMap,xe=new WeakMap,we=new WeakMap,_e=new WeakMap,Pe=new WeakMap,Te=new WeakMap,Se=new WeakMap,Ue=new WeakMap,Me=new WeakMap,Re=new WeakMap,Ee=new WeakMap,Ge=new WeakMap,ke=new WeakMap,Be=new WeakMap,We=new WeakMap,Ce=new WeakMap,Fe=new WeakMap,Le=new WeakMap,Oe=new WeakMap,Ie=new WeakMap,Ae=new WeakMap,Ve=new WeakMap,Ne=new WeakMap,De=new WeakMap,je=new WeakSet;function ze(e,r,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(D(je,this,tt).call(this),!V(re,this)||!V(ie,this)||!V(re,this).isGPUDeviceReady())return void(i instanceof VideoFrame&&i.close());const s=D(je,this,it).call(this,0);if(s.isLocked()){const a=s.getPendingVideoFrame();!a||a.codedWidth==e&&a.codedHeight==r?i instanceof VideoFrame&&i.close():i instanceof VideoFrame?s.setPendingVideoFrame(i):(n&&D(je,this,Ye).call(this,s,e,r,i),t().tracing.Log_Error("WebGPU [WebGPURenderDisplay] updateVideoFrameBaseTextureLayer() an unexpected case!"))}else i instanceof VideoFrame?s.getPendingVideoFrame()!=i&&s.setPendingVideoFrame(i):(n&&D(je,this,Ye).call(this,s,e,r,i),t().tracing.Log_Error("WebGPU [WebGPURenderDisplay] updateVideoFrameBaseTextureLayer() an unexpected case!")),s.setTextureLayerType(0),s.setTextureType(0),s.lock();this.markRenderingStateReady()}function qe(e,t,r,i,n,s){D(je,this,tt).call(this);const a=D(je,this,it).call(this,0);if(a.setTextureLayerType(0),a.setTextureType(1),a.clearPendingVideoFrame(),a.isLocked()){const e=a.getWidth(),i=a.getHeight();e==t&&i==r||(a.setWidth(t),a.setHeight(r),a.setIsNew(!0))}else a.setWidth(t),a.setHeight(r),a.setIsNew(!0),a.lock();const o=D(je,this,dt).call(this,i,t,r,s),u=V(re,this).writeToYuvTexturesBufferGroup(o,n);a.setTextureBufferGroup(u)}function Ye(e,t,r,i){const n=D(je,this,gt).call(this,t,r);n.label="RgbaTexBuffer(".concat(e.getIndex(),")-").concat(n.size);let s=e.getTextureBufferGroup();if(s=D(je,this,vt).call(this,e,s,n),!s||!s.buffer)return console.warn("[updateRgbaBaseTexLayer()] texLayer(".concat(e.getIndex(),") cannot apply a GPU buffer!")),void this.markRenderingStatePending();D(je,this,Xe).call(this,V(j,this),t,r,i,s),this.markRenderingStateReady()}function He(e,t,r,i,n){const s=D(je,this,it).call(this,1);if(s.setTextureLayerType(1),s.setTextureType(2),s.isLocked()){const e=s.getWidth(),i=s.getHeight();e==t&&i==r||(s.setWidth(t),s.setHeight(r),s.setIsNew(!0))}else s.setWidth(t),s.setHeight(r),s.setIsNew(!0),s.lock();const a=V(re,this).writeToRgbaTextureBuffer(e,t,r,i,n);s.setTextureBufferGroup(a)}function $e(e,t,r,i,n){const s=D(je,this,it).call(this,2);if(s.setTextureLayerType(1),s.setTextureType(2),s.isLocked()){const e=s.getWidth(),i=s.getHeight();e==t&&i==r||(s.setWidth(t),s.setHeight(r),s.setIsNew(!0))}else s.setWidth(t),s.setHeight(r),s.setIsNew(!0),s.lock();const a=V(re,this).writeToRgbaTextureBuffer(e,t,r,i,n);s.setTextureBufferGroup(a)}function Xe(e,t,r,i,n){const s=D(je,this,it).call(this,0);if(s.setTextureLayerType(0),s.setTextureType(2),s.isLocked()){const e=s.getWidth(),i=s.getHeight();e==t&&i==r||(s.setWidth(t),s.setHeight(r),s.setIsNew(!0))}else s.setWidth(t),s.setHeight(r),s.setIsNew(!0),s.lock();const a=V(re,this).writeToRgbaTextureBuffer(e,t,r,i,n);s.setTextureBufferGroup(a)}function Je(e,t,r){if(!D(je,this,yt).call(this,e))return;if(!D(je,this,bt).call(this,V(q,this)))return;if(!V(ie,this))return void console.log("drawVideoFrameBaseTextureLayer() canvas is invalid? canvas=".concat(V(ie,this)));const i=D(je,this,it).call(this,0);let n=i.getUVCoords(),s=D(je,this,Ze).call(this,V(Y,this),V(H,this),V(q,this),V(K,this),r,e.width,e.height).uvCoords;n||(n=new Float32Array(12)),n.set(s,0),i.setUVCoords(n);const a=V(q,this).width>V(q,this).height,o=V(ie,this).width>e.width,u=V(ie,this).height>e.height;let l=o?e.width:V(ie,this).width,c=u?e.height:V(ie,this).height;if(a){const r=Math.abs(t.left)*l,n=Math.abs(t.top)*c,s=e.x+(e.width-r)/2;let a=0;a=e.y>=0?e.y+(e.height-n)/2:0,i.evalViewport(s,a,r,n,V(ie,this).height)}else{let t=e.height*V(q,this).width/V(q,this).height;t>e.width&&(t=e.width);let r=V(q,this).height/V(q,this).width*t;const n=e.x+e.width/2-t/2;let s=0;s=e.y>0?e.y+(e.height-r)/2:0===e.y&&e.height>r?(e.height-r)/2:0,i.evalViewport(n,s,t,r,V(ie,this).height)}N(De,this,e);const h=D(je,this,st).call(this);h&&h.buffer&&i.setUniformBuffer(h.buffer)}function Ke(e,t,r){const i=D(je,this,it).call(this,0);let n=i.getUVCoords(),s=D(je,this,Ze).call(this,V(Y,this),V(H,this),V(q,this),V(K,this),r,e.width,e.height).uvCoords;n||(n=new Float32Array(12)),n.set(s,0),i.setUVCoords(n);const a=V(q,this).width>V(q,this).height,o=V(ie,this).width>e.width,u=V(ie,this).height>e.height;let l=o?e.width:V(ie,this).width,c=u?e.height:V(ie,this).height;if(a){const r=Math.abs(t.left)*l,n=Math.abs(t.top)*c,s=e.x+(e.width-r)/2;let a=0;a=e.y>=0?e.y+(e.height-n)/2:0,i.evalViewport(s,a,r,n,V(ie,this).height)}else{let t=e.height*V(q,this).width/V(q,this).height;t>e.width&&(t=e.width);let r=V(q,this).height/V(q,this).width*t;const n=e.x+e.width/2-t/2;let s=0;s=e.y>0?e.y+(e.height-r)/2:0===e.y&&e.height>r?(e.height-r)/2:0,i.evalViewport(n,s,t,r,V(ie,this).height)}N(De,this,e);let h=null;h=0==i.getTextureType()?D(je,this,st).call(this):D(je,this,at).call(this,V(K,this)),h&&h.buffer&&i.setUniformBuffer(h.buffer)}function Ze(e,r,i,n,s,a,o){const u=this.isUseFillMode({w:i.width,h:i.height,rotation:n}),l={width:a,height:o},c={width:e,height:r};return t().graphics.calculateUVCoordsForMultiView(u,l,c,i,n,s)}function Qe(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=e.width,a=e.height;n&&(s=n.width,a=n.height);let o,u,l,c,h=1==i||3==i?r:t,f=1==i||3==i?t:r,d=h/f*a;d>s?(o=0,l=1,u=(a-f/h*s)/2/a,c=1-u):(u=0,c=1,o=(s-d)/2/s,l=1-o),o=2*o-1,l=2*l-1,u=1-2*u,c=1-2*c;let p=[{x:l,y:u},{x:l,y:c},{x:o,y:c},{x:l,y:u},{x:o,y:u},{x:o,y:c}];V(re,this)&&V(re,this).updateVertexCoords(p)}function et(e,t,r,i,n){var s,a,o,u;if(this.isUseFillMode({w:r,h:i,rotation:n}))s=0,a=0,o=1,u=1;else{var l=1==n||3==n?i:r,c=1==n||3==n?r:i,h=l/c*t;h>e?(s=0,o=1,u=1-(a=(t-c/l*e)/2/t)):(a=0,u=1,o=1-(s=(e-h)/2/e))}const f={top:a=1-2*a,left:s=2*s-1,right:o=2*o-1,bottom:u=1-2*u};return N(Ge,this,f),f}function tt(){V(re,this)}function rt(e){if(e<0)throw new Error("[hasZIndexTexLayer] ".concat(e," is an invalid parameter!"));return V(Re,this).has(e)}function it(e){let t=null;return D(je,this,rt).call(this,e)?t=V(Re,this).get(e):(t=new L(V(j,this),e),V(Re,this).set(e,t)),t}function nt(e,t,r){V(ie,this)&&(N(be,this,e),N(Pe,this,e&&r===d?1:0),N(Te,this,t),e||N(xe,this,r))}function st(){var e;if(!V(De,this))return null;const t={rotation:V(K,this),enable_rounded_corner:V(Be,this),radius_lt_x:V(We,this),radius_lt_y:V(Ce,this),radius_lb_x:V(Fe,this),radius_lb_y:V(Le,this),radius_rt_x:V(Oe,this),radius_rt_y:V(Ie,this),radius_rb_x:V(Ae,this),radius_rb_y:V(Ve,this),aa_width:V(Ne,this),viewport_rect:V(De,this)};let r=null,i=V(Me,this).get(0);if(i){let e=i.buffer,n=i.uniform;if(n)if("yuvMode"in n)e&&e.destroy(),i=null;else if("rotation"in n){if(n.rotation!=t.rotation||n.enable_rounded_corner!=t.enable_rounded_corner||n.radius_lt_x!=t.radius_lt_x||n.radius_lt_y!=t.radius_lt_y||n.radius_lb_x!=t.radius_lb_x||n.radius_lb_y!=t.radius_lb_y||n.radius_rt_x!=t.radius_rt_x||n.radius_rt_y!=t.radius_rt_y||n.radius_rb_x!=t.radius_rb_x||n.radius_rb_y!=t.radius_rb_y||n.aa_width!=t.aa_width||n.viewport_rect!=t.viewport_rect){const i=D(je,this,lt).call(this,t);r=V(re,this).writeUniformBuffer("VideoFrameTexLayerUniformBuffer(idx=".concat(V(j,this),")"),i,e)}}else e&&e.destroy(),i=null}if(!i){const e=D(je,this,lt).call(this,t);r=V(re,this).writeUniformBuffer("VideoFrameTexLayerUniformBuffer(idx=".concat(V(j,this),")"),e)}return!r&&null!==(e=i)&&void 0!==e&&e.buffer&&(r=i.buffer),r?(i||(i={}),i.uniform=t,i.buffer=r,V(Me,this).set(0,i),i):null}function at(e){if(-1==V(we,this))return null;if(!V(De,this))return null;const t={yuvMode:1,colorRange:V(we,this),rotation:e,enable_rounded_corner:V(Be,this),radius_lt_x:V(We,this),radius_lt_y:V(Ce,this),radius_lb_x:V(Fe,this),radius_lb_y:V(Le,this),radius_rt_x:V(Oe,this),radius_rt_y:V(Ie,this),radius_rb_x:V(Ae,this),radius_rb_y:V(Ve,this),aa_width:V(Ne,this),viewport_rect:V(De,this)};let r=null,i=V(Me,this).get(0);if(i){const e=i.uniform;if(r=i.buffer,e.yuvMode!=t.yuvMode||e.colorRange!=t.colorRange||e.rotation!=t.rotation||e.enable_rounded_corner!=t.enable_rounded_corner||e.radius_lt_x!=t.radius_lt_x||e.radius_lt_y!=t.radius_lt_y||e.radius_lb_x!=t.radius_lb_x||e.radius_lb_y!=t.radius_lb_y||e.radius_rt_x!=t.radius_rt_x||e.radius_rt_y!=t.radius_rt_y||e.radius_rb_x!=t.radius_rb_x||e.radius_rb_y!=t.radius_rb_y||e.aa_width!=t.aa_width||e.viewport_rect!=t.viewport_rect){const e=D(je,this,ct).call(this,t);r=V(re,this).writeUniformBuffer("YuvTexLayerUniformBuffer(idx=".concat(V(j,this),")"),e,r)}}else{i={};const e=D(je,this,ct).call(this,t);r=V(re,this).writeUniformBuffer("YuvTexLayerUniformBuffer(idx=".concat(V(j,this),")"),e)}return r?(i.uniform=t,i.buffer=r,V(Me,this).set(0,i),i):null}function ot(){if(!V(Ue,this))return null;const e={cursorFlag:V(Te,this),cursorInfo:V(Ue,this)};let t=null,r=V(Me,this).get(1);if(r){const i=r.uniform;if(t=r.buffer,i.cursorFlag!=e.cursorFlag||i.cursorInfo!=e.cursorInfo){const r=D(je,this,ht).call(this,e);t=V(re,this).writeUniformBuffer("CursorTexLayerUniformBuffer(idx=".concat(V(j,this),")"),r,t)}}else{r={};const i=D(je,this,ht).call(this,e);t=V(re,this).writeUniformBuffer("CursorTexLayerUniformBuffer(idx=".concat(V(j,this),")"),i)}return t?(r.uniform=e,r.buffer=t,V(Me,this).set(1,r),r):null}function ut(e,t){return Math.ceil(e/t)*t}function lt(e){let t=D(je,this,ut).call(this,15*Float32Array.BYTES_PER_ELEMENT,16);const r=new Float32Array(t/Float32Array.BYTES_PER_ELEMENT);return r[0]=e.rotation,r[1]=e.enable_rounded_corner,r[2]=e.radius_lt_x,r[3]=e.radius_lt_y,r[4]=e.radius_lb_x,r[5]=e.radius_lb_y,r[6]=e.radius_rt_x,r[7]=e.radius_rt_y,r[8]=e.radius_rb_x,r[9]=e.radius_rb_y,r[10]=e.aa_width,r[11]=e.viewport_rect.x,r[12]=e.viewport_rect.y,r[13]=e.viewport_rect.width,r[14]=e.viewport_rect.height,r}function ct(e){let t=D(je,this,ut).call(this,17*Float32Array.BYTES_PER_ELEMENT,16);const r=new Float32Array(t/Float32Array.BYTES_PER_ELEMENT);return r[0]=e.yuvMode,r[1]=e.colorRange,r[2]=e.rotation,r[3]=e.enable_rounded_corner,r[4]=e.radius_lt_x,r[5]=e.radius_lt_y,r[6]=e.radius_lb_x,r[7]=e.radius_lb_y,r[8]=e.radius_rt_x,r[9]=e.radius_rt_y,r[10]=e.radius_rb_x,r[11]=e.radius_rb_y,r[12]=e.aa_width,r[13]=e.viewport_rect.x,r[14]=e.viewport_rect.y,r[15]=e.viewport_rect.width,r[16]=e.viewport_rect.height,r}function ht(e){const t=D(je,this,ut).call(this,5*Float32Array.BYTES_PER_ELEMENT,16),r=new Float32Array(t/Float32Array.BYTES_PER_ELEMENT);return r[0]=e.cursorFlag,r[1]=e.cursorInfo.x,r[2]=e.cursorInfo.y,r[3]=e.cursorInfo.w,r[4]=e.cursorInfo.h,r}function ft(e){if(!e||0==e.length)return null;const t=D(je,this,ut).call(this,4*Float32Array.BYTES_PER_ELEMENT,16),r=new Float32Array(t/Float32Array.BYTES_PER_ELEMENT);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function dt(e,t,r,i){let n=t*r,s=e.subarray(0,n),a=0,o=0;1==i?(o=t/2*r/2,a=o):2==i&&(o=t*r/2,a=0);let u=e.subarray(n,n+o);return{yPlane:{buffer:s,width:t,height:r},crPlane:{buffer:0!=a?e.subarray(n+o,n+o+a):null,width:t/2,height:r/2},cbPlane:{buffer:u,width:t/2,height:r/2}}}function pt(e,t,r){let i="",n=0,s=0,a=0;1==r?(n=e/2*t/2,s=n,i="i420",a=Uint8Array.BYTES_PER_ELEMENT):2==r&&(n=e*t/2,s=0,i="nv12",a=Uint16Array.BYTES_PER_ELEMENT);const o=D(je,this,ut).call(this,Uint8Array.BYTES_PER_ELEMENT*e,256),u=D(je,this,ut).call(this,a*e/2,256);let l=o*t+u*t/2;return s>0&&(l+=u*t/2),{colorFormat:i,size:l,yPlane:{width:o,height:t},uvPlane:{width:u,height:t/2}}}function gt(e,t){const r=D(je,this,ut).call(this,Uint32Array.BYTES_PER_ELEMENT*e,256);return{colorFormat:"rgba",width:r,height:t,size:r*t}}function vt(e,t,r){return t?t.buffer?r.size>t.buffer.size?(V(ye,this).recycleTextureBufferGroup(e),t.buffer=V(ye,this).requestTextureBuffer(r),t.bufferConfig=r):"mapped"==t.buffer.mapState?t.bufferArray&&t.bufferArray.byteLength<r.size&&(V(ye,this).recycleTextureBufferGroup(e),t.buffer=V(ye,this).requestTextureBuffer(r),t.bufferConfig=r):(V(ye,this).recycleTextureBufferGroup(e),t.buffer=V(ye,this).requestTextureBuffer(r),t.bufferConfig=r):(t.buffer=V(ye,this).requestTextureBuffer(r),t.bufferConfig=r):((t={}).buffer=V(ye,this).requestTextureBuffer(r),t.bufferConfig=r),t}function mt(){const e=[];for(let t=0;t<u.length;++t){let r=u[t];e.push(r.u),e.push(r.v)}return e}function yt(e){return e&&0!=e.width&&0!=e.height}function bt(e){return e&&0!=e.width&&0!=e.height}function xt(){if(V(ye,this))for(const[e,t]of V(Re,this))t&&(V(ye,this).recycleTextureBufferGroup(t,!1),V(ye,this).destroyTextureGroup(t,!0));else t().tracing.Log_Error("WebGPU [WebGPURenderDisplay] clearTexLayerResources() GPUResManager is not attached!")}function wt(){N(Be,this,1),N(We,this,0),N(Ce,this,0),N(Fe,this,0),N(Le,this,0),N(Oe,this,0),N(Ie,this,0),N(Ae,this,0),N(Ve,this,0),N(Ne,this,0),N(De,this,null)}const _t=class{constructor(e,t){var r;A(this,r=je),r.add(this),I(this,j,0),I(this,z,0),I(this,q,{}),I(this,Y,0),I(this,H,0),I(this,$,0),I(this,X,0),I(this,J,-1),I(this,K,0),I(this,Z,-1),I(this,Q,0),I(this,ee,0),I(this,te,!1),I(this,re,null),I(this,ie,null),I(this,ne,!1),I(this,se,0),I(this,ae,!1),I(this,oe,0),I(this,ue,0),I(this,le,0),I(this,ce,0),I(this,he,0),I(this,fe,0),I(this,de,0),I(this,pe,0),I(this,ge,!1),I(this,ve,-1),I(this,me,0),I(this,ye,null),I(this,be,0),I(this,xe,-1),I(this,we,-1),I(this,_e,0),I(this,Pe,0),I(this,Te,0),I(this,Se,0),I(this,Ue,null),I(this,Me,new Map),I(this,Re,new Map),I(this,Ee,{top:0,left:0,bottom:0,right:0}),I(this,Ge,null),I(this,ke,null),function(e,t,r){(t=function(e){var t=function(e){if("object"!=a(e)||!e)return e;var t=e[o];if(void 0!==t){var r=t.call(e,"string");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:t+""}(t))in e?i(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"reuse",!1),I(this,Be,1),I(this,We,0),I(this,Ce,0),I(this,Fe,0),I(this,Le,0),I(this,Oe,0),I(this,Ie,0),I(this,Ae,0),I(this,Ve,0),I(this,Ne,0),I(this,De,null),N(j,this,e),N(ye,this,t),N(z,this,e||0),V(q,this).top=0,V(q,this).left=0,V(q,this).width=0,V(q,this).height=0,N(Y,this,0),N(H,this,0),N($,this,0),N(X,this,0),N(Z,this,-1),N(Q,this,0),N(ee,this,0),this.markRenderingStateIdle()}addRenderer(e){N(re,this,e)}removeRenderer(){N(re,this,null)}setGPUResMgr(e){N(ye,this,e)}removeGPUResMgr(){N(ye,this,null)}attachCanvas(e,t){N(ie,this,e),N(ke,this,t)}getAttachedCanvas(){return V(ie,this)}getCanvasId(){return V(ke,this)}detachCanvas(){N(ie,this,null),N(ke,this,null)}bindSsrc(e){N(me,this,e)}unbindSsrc(){N(me,this,0)}drawSelfVideo(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!D(je,this,yt).call(this,e))return;if(!D(je,this,bt).call(this,V(q,this)))return;D(je,this,tt).call(this),D(je,this,nt).call(this,1,V(ge,this),V(Z,this));let i=null;i=t?D(je,this,et).call(this,e.width,e.height,e.width,e.height,0):D(je,this,et).call(this,e.width,e.height,V(q,this).width,V(q,this).height,V(K,this)),D(je,this,Je).call(this,e,i,r)}drawRemoteVideo(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!V(ie,this))return;if(!D(je,this,yt).call(this,e))return;if(!D(je,this,bt).call(this,V(q,this)))return;D(je,this,tt).call(this);const r=this.isRgbaMode(V(Z,this))?1:0;D(je,this,nt).call(this,r,V(ge,this),V(Z,this));const i=D(je,this,et).call(this,e.width,e.height,V(q,this).width,V(q,this).height,V(K,this));D(je,this,Ke).call(this,e,i,t)}updateCursorPosInfo(e,t,r,i,n){if(!V(fe,this)||e&&(i<0||n<0))return;const s=D(je,this,it).call(this,1),a=D(je,this,it).call(this,0);if(s.setUVCoords(a.getUVCoords()),s.evalViewport(t,r,i,n,V(ie,this).height),e&&V(ge,this)){const e=t/V(q,this).width,s=r/V(q,this).height,a=i/V(q,this).width,o=n/V(q,this).height;N(Ue,this,{x:e,y:s,w:a,h:o})}else N(Ue,this,{x:0,y:0,w:0,h:0});const o=D(je,this,ot).call(this);o&&o.buffer&&s.setUniformBuffer(o.buffer)}isHasWholeFrame(){return V(fe,this)}setMultiView(e){N(ne,this,e)}setFillMode(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;N(Q,this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:0),N(ee,this,e)}getFillMode(){return V(Q,this)}setColorRange(e){N(we,this,e)}getFillModeForResolution(){return V(ee,this)}getTextureIndex(){return V(z,this)}isUseFillMode(e){let{w:t,h:r,rotation:i}=e;if(!V(Q,this))return!1;if(!V(ee,this))return!0;if(!t||!r)return!1;const n=1===i||1===i?r/t:t/r;return(Array.isArray(V(ee,this))?V(ee,this):[V(ee,this)]).some((e=>Math.abs(n-e)<.01))}setVideoMode(e){N(Z,this,e)}getVideoMode(){return V(Z,this)}setWatermarkFlag(e){N(se,this,e),e||(this.setWatermarkRepeated(!1),this.setWatermarkOpacity(),this.setWatermarkPosition(16))}setWatermarkRepeated(e){N(ae,this,e)}isWatermarkRepeated(){return!!V(ae,this)}setWatermarkOpacity(e){N(oe,this,e||.15)}getWatermarkOpacity(){return V(oe,this)}setWatermarkPosition(e){N(ue,this,e||16)}getWatermarkPosition(){return V(ue,this)}isSetWatermark(){return V(se,this)}isRgbaMode(e){return-1!==[f,d].indexOf(e)}getTextureWidth(){return V(Y,this)}getTextureHeight(){return V(H,this)}getRotation(){return V(K,this)}getCroppingParams(){return V(q,this)}getViewPosition(){let e=[0,0,1,1];if(!V(Ge,this))return e;const{top:t,left:r,bottom:i,right:n}=V(Ge,this);return e[0]=(1-t)/2,e[1]=(1+r)/2,e[2]=(1-i)/2,e[3]=(1+n)/2,e}recoverTextures(){}setRoundedCornerRadius(e){e&&(N(We,this,e.radius_lt_x),N(Ce,this,e.radius_lt_y),N(Fe,this,e.radius_lb_x),N(Le,this,e.radius_lb_y),N(Oe,this,e.radius_rt_x),N(Ie,this,e.radius_rt_y),N(Ae,this,e.radius_rb_x),N(Ve,this,e.radius_rb_y))}setAntialiasWidth(e){N(Ne,this,e)}updateWatermark(e,r,i){const n=D(je,this,it).call(this,2);if(!V(ie,this)||!V(re,this))return D(je,this,xt).call(this),void this.markRenderingStatePending();if(e<=0||r<=0||!i||i.length!=e*r*4)return V(ye,this).recycleTextureBufferGroup(n),void this.markRenderingStatePending();if(O(V(ye,this),e,r))return V(ye,this).recycleTextureBufferGroup(n),void this.markRenderingStatePending();if(N(le,this,e),N(ce,this,r),N(se,this,1),N(_e,this,1),!D(je,this,rt).call(this,0)){console.log("[updateWatermark] base layer is not ready, set data to the texture layer for creating texture later."),V(ye,this).recycleTextureBufferGroup(n),this.markRenderingStatePending();const t={index:V(j,this),width:e,height:r,data:i};return void n.setRawData(t)}const s=D(je,this,it).call(this,0).getViewport();if(s)try{const t=D(je,this,gt).call(this,e,r);t.label="WatermarkTexBuffer(".concat(n.getIndex(),")-").concat(t.size);let a=n.getTextureBufferGroup();if(a=D(je,this,vt).call(this,n,a,t),!a||!a.buffer)return console.warn("[updateWatermark()] texLayer(".concat(n.getIndex(),") cannot apply a GPU buffer!")),void this.markRenderingStatePending();D(je,this,$e).call(this,V(j,this),e,r,i,a),s&&n.setViewport(s);let o=n.getUVCoords(),u=D(je,this,mt).call(this);o||(o=new Float32Array(12)),o.set(u,0),n.setUVCoords(o),n.setRawData(null),this.markRenderingStateReady()}catch(e){t().tracing.Log_Error("WebGPU WebGPURenderDisplay_updateWatermark() error:".concat(e.message)),V(ye,this).recycleTextureBufferGroup(n),this.markRenderingStatePending()}else{console.log("[updateWatermark] base layer's viewport is not ready, set data to the texture layer for creating texture later."),V(ye,this).recycleTextureBufferGroup(n),this.markRenderingStatePending();const t={index:V(j,this),width:e,height:r,data:i};n.setRawData(t)}}updateCursor(e,r,i,n){const s=D(je,this,it).call(this,1);if(!V(ie,this)||!V(re,this))return D(je,this,xt).call(this),void this.markRenderingStatePending();if(e<=0||r<=0||!i||i.length!=e*r*4)return V(ye,this).recycleTextureBufferGroup(s),void this.markRenderingStatePending();if(n!=V(ve,this)){N(ve,this,n),N(de,this,e),N(pe,this,r),N(ge,this,1);try{const t=D(je,this,gt).call(this,e,r);t.label="CursorTexBuffer(".concat(s.getIndex(),")-").concat(t.size);let n=s.getTextureBufferGroup();if(n=D(je,this,vt).call(this,s,n,t),!n||!n.buffer)return void console.warn("[updateCursor()] texLayer(".concat(s.getIndex(),") cannot apply a GPU buffer!"));if("mapped"!=n.buffer.mapState)return void console.error("updateCursor() why buffer state is not mapped!");D(je,this,He).call(this,V(j,this),e,r,i,n),this.markRenderingStateReady()}catch(e){t().tracing.Log_Error("WebGPU WebGPURenderDisplay_updateCursor() error:".concat(e.message)),V(ye,this).recycleTextureBufferGroup(s),this.markRenderingStatePending()}}}updateSelfVideoTextures(e,r,i,n){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;D(je,this,tt).call(this);const o=D(je,this,it).call(this,0);if(!V(ie,this)||!V(re,this))return i&&i instanceof VideoFrame&&i.close(),D(je,this,xt).call(this),void this.markRenderingStatePending();if(e<=0||r<=0||!i||i.length%4!=0)return i&&i instanceof VideoFrame&&i.close(),void this.markRenderingStatePending();if(1!=e||1!=r){if(N(Y,this,e),N(H,this,r),N(K,this,a),Object.assign(V(q,this),n),!s)return i&&i instanceof VideoFrame&&i.close(),void this.markRenderingStatePending();try{if(i instanceof VideoFrame)D(je,this,ze).call(this,e,r,i);else if(this.isRgbaMode(V(Z,this))){const t=new VideoFrame(i,{format:"RGBA",timestamp:1e3*performance.now(),codedWidth:e,codedHeight:r});D(je,this,ze).call(this,e,r,t)}else D(je,this,qe).call(this,V(j,this),e,r,i,o.getTextureBufferGroup(),V(Z,this));this.markRenderingStateReady()}catch(e){t().tracing.Log_Error("WebGPU WebGPURenderDisplay_updateSelfVideoTextures() error:".concat(e.message)),this.markRenderingStatePending(),i instanceof VideoFrame&&i.close(),D(je,this,it).call(this,0).setPendingVideoFrame(null)}}else{o.setPendingVideoFrame(null),D(je,this,xt).call(this),i&&i instanceof VideoFrame&&i.close();const e=D(je,this,ft).call(this,i);if(e)if(V(re,this)){let t=o.getClearColorUniformBuffer();t=V(re,this).writeUniformBuffer("ClearColorUniformBuffer",e,t),o.setClearColorUniformBuffer(t),o.setTextureType(3)}else t().tracing.Log_Error("WebGPU [WebGPURenderDisplay] updateSelfVideoTextures() renderer is not attached!");else t().tracing.Log_Error("WebGPU [WebGPURenderDisplay] updateSelfVideoTextures() cannot create the uniform buffer array.");this.markRenderingStateReady()}}updateRemoteVideoTexturesImageBitmap(e,r,i,n,s){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const o=D(je,this,it).call(this,0);if(!V(re,this)||!V(ie,this))return i&&i instanceof VideoFrame&&i.close(),D(je,this,xt).call(this),void this.markRenderingStatePending();if(e<=0||r<=0||!i)return i&&i instanceof VideoFrame&&i.close(),void this.markRenderingStatePending();if(N(Y,this,e),N(H,this,r),Number.isNaN(s)||N(K,this,s),Object.assign(V(q,this),n),!a)return i&&i instanceof VideoFrame&&i.close(),void this.markRenderingStatePending();try{D(je,this,ze).call(this,e,r,i),this.markRenderingStateReady()}catch(e){t().tracing.Log_Error("WebGPU WebGPURenderDisplay_updateRemoteVideoTexturesImageBitmap() error:".concat(e.message)),this.markRenderingStatePending(),i instanceof VideoFrame&&i.close(),o.setPendingVideoFrame(null)}}updateRemoteVideoTextures(e,r,i,n,s){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=arguments.length>6?arguments[6]:void 0;const u=D(je,this,it).call(this,0);if(!V(ie,this)||!V(re,this))return D(je,this,xt).call(this),void this.markRenderingStatePending();if(!D(je,this,yt).call(this,o))return V(ye,this).recycleTextureBufferGroup(u),void this.markRenderingStatePending();D(je,this,tt).call(this);const l=this.isRgbaMode(V(Z,this));if(e<=0||r<=0||!n||!n.length||n.length!=e*r*3/2&&!l||i&&(i.top<0||i.left<0||i.left+i.width>e||i.top+i.height>r))return V(ye,this).recycleTextureBufferGroup(u),void this.markRenderingStatePending();if(l)try{D(je,this,ze).call(this,e,r,n,!0),N(we,this,a?0:1),N(K,this,s),Object.assign(V(q,this),i),N(Y,this,e),N(H,this,r),N($,this,V(ie,this).width),N(X,this,V(ie,this).height)}catch(e){t().tracing.Log_Error("WebGPU WebGPURenderDisplay_updateRemoteVideoTextures() error:".concat(e.message)),u.setPendingVideoFrame(null),this.markRenderingStatePending()}finally{V(ye,this).recycleTextureBufferGroup(u)}else try{const t=D(je,this,pt).call(this,e,r,V(Z,this));t.label="YuvVideoTexBuffer(".concat(u.getIndex(),")-").concat(t.size),u.setColorFormat(t.colorFormat);let o=u.getTextureBufferGroup();if(o=D(je,this,vt).call(this,u,o,t),!o||!o.buffer)return console.warn("[updateRemoteVideoTextures()] texLayer(".concat(u.getIndex(),") cannot apply a GPUBuffer!")),void this.markRenderingStatePending();N(we,this,a?0:1),N(K,this,s),Object.assign(V(q,this),i),N(Y,this,e),N(H,this,r),N($,this,V(ie,this).width),N(X,this,V(ie,this).height),D(je,this,qe).call(this,V(j,this),e,r,n,o,V(Z,this)),this.markRenderingStateReady()}catch(e){t().tracing.Log_Error("WebGPU WebGPURenderDisplay_updateRemoteVideoTextures() error:".concat(e.message)),V(ye,this).recycleTextureBufferGroup(u),this.markRenderingStatePending()}}drawNextOutputPictureFrame(e,r,i,n,s){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=arguments.length>6?arguments[6]:void 0,u=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const l=D(je,this,it).call(this,0);if(!V(ie,this)||!V(re,this))return D(je,this,xt).call(this),void this.markRenderingStatePending();if(O(V(ye,this),e,r))return V(ye,this).recycleTextureBufferGroup(l),void this.markRenderingStatePending();s=s||0;let c=(i=i||{top:0,left:0,width:e,height:r}).width!=V(q,this).width||i.height!=V(q,this).height,h=i.top!=V(q,this).top||i.left!=V(q,this).left,f=o.width!=V($,this)||o.height!=V(X,this),d=e!=V(Y,this)||r!=V(H,this),p=s!=V(J,this);o.canvas=V(ie,this),(c||f||p)&&D(je,this,Qe).call(this,V(ie,this),i.width,i.height,s,o);const g=function(e,t){if(!e||null==t)throw new Error("evalCroppingRect() invalid parameters!");return 1===t||3===t?{top:e.top,left:e.left,width:e.height,height:e.width}:e}(i,s),v=function(e,t){let r=0,i=0,n=0,s=0;const a=t.width/t.height;return e.width/e.height>a?(i=e.height,r=i*a,n=(e.width-r)/2,s=0):(r=e.width,i=r/a,n=0,s=(e.height-i)/2),r<=e.canvas.width&&(n=(e.canvas.width-r)/2),i<=e.canvas.height&&(s=(e.canvas.height-i)/2),{x:n,y:s,width:r,height:i}}(o,g);if(l.evalViewport(v.x,v.y,v.width,v.height,V(ie,this).height),N(De,this,v),c||h||d||p||!l.getUVCoords()){let n=t().graphics.calculateUVCoord({width:e,height:r},i,V(ie,this),s),a=l.getUVCoords();a||(a=new Float32Array(12)),a.set(n.uvCoords),l.setUVCoords(a)}let m=a?0:1;m!=V(we,this)&&N(we,this,m),N(be,this,0),N(xe,this,1),Object.assign(V(q,this),i),N(Y,this,e),N(H,this,r),N(J,this,s),N($,this,V(ie,this).width),N(X,this,V(ie,this).height),l.setColorFormat("i420");try{const t=D(je,this,pt).call(this,e,r,1);if(t.label="YuvShareTexBuffer(".concat(l.getIndex(),")-").concat(t.size),u){let i=l.getTextureBufferGroup();if(i=D(je,this,vt).call(this,l,i,t),!i||!i.buffer)return console.warn("[drawNextOutputPictureFrame()] texLayer(".concat(l.getIndex(),") cannot apply a GPU buffer!")),void this.markRenderingStatePending();D(je,this,qe).call(this,V(j,this),e,r,n,i,1);const s=D(je,this,at).call(this,V(J,this));s&&s.buffer&&l.setUniformBuffer(s.buffer)}V(ge,this)?N(Te,this,1):N(Te,this,0),N(fe,this,1),this.markRenderingStateReady()}catch(e){t().tracing.Log_Error("WebGPU WebGPURenderDisplay_drawNextOutputPictureFrame() error:".concat(e.message)),V(ye,this).recycleTextureBufferGroup(l),this.markRenderingStatePending()}}clearCanvas(e){V(re,this)&&V(re,this).clearAttachedCanvas()}updateSelfMaskImage(e,r,i){const n=D(je,this,it).call(this,3);if(!V(ie,this))return V(ye,this).recycleTextureBufferGroup(n),void this.markRenderingStatePending();if(e<=0||r<=0||!i||i.length!=e*r*4)return V(ye,this).recycleTextureBufferGroup(n),void this.markRenderingStatePending();if(!D(je,this,rt).call(this,0))return console.log("[updateSelfMaskImage] base layer is not ready."),V(ye,this).recycleTextureBufferGroup(n),void this.markRenderingStatePending();try{const t=D(je,this,gt).call(this,e,r);let s=n.getTextureBufferGroup();if(s=D(je,this,vt).call(this,n,s,t),!s||!s.buffer)return console.warn("[updateSelfMaskImage()] texLayer(".concat(n.getIndex(),") cannot apply a GPU buffer!")),void this.markRenderingStatePending();if(s.buffer.label="SelfMaskImageTexBuffer(".concat(n.getIndex(),")-").concat(t.size),n.setTextureLayerType(1),n.setTextureType(2),n.isLocked()){const t=n.getWidth(),i=n.getHeight();t==e&&i==r||(n.setWidth(e),n.setHeight(r),n.setIsNew(!0))}else n.setWidth(e),n.setHeight(r),n.setIsNew(!0),n.lock();const a=V(re,this).writeToRgbaTextureBuffer(V(j,this),e,r,i,s);n.setTextureBufferGroup(a);const o=D(je,this,it).call(this,0),u=o.getViewport();u&&n.setViewport(u),n.setUVCoords(o.getUVCoords()),this.isSetWatermark()&&V(le,this)&&V(ce,this),this.markRenderingStateReady()}catch(e){t().tracing.Log_Error("WebGPU WebGPURenderDisplay_updateSelfMaskImage() error:".concat(e.message)),V(ye,this).recycleTextureBufferGroup(n),this.markRenderingStatePending()}}readPixelsSyncRequest(e,t,r,i){}isAvaiable(){return!0}markRenderingStateReady(){N(he,this,2)}markRenderingStateRendering(){N(he,this,3)}markRenderingStatePending(){N(he,this,1)}markRenderingStateIdle(){N(he,this,0)}isRenderingStateReady(){return 2===V(he,this)}isInTargetRenderingState(e){return V(he,this)===e}getWatermarkWidth(){return V(le,this)}getWatermarkHeight(){return V(ce,this)}getIndex(){return V(j,this)}getRenderingState(){return V(he,this)}recycle(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const[t,r]of V(Re,this))r&&(V(ye,this).recycleTextureBufferGroup(r,e),r.recycle(V(ye,this)));N(Ee,this,{top:0,left:0,bottom:0,right:0}),this.markRenderingStateIdle(),V(Re,this).clear(),V(Me,this).clear(),this.unbindSsrc(),D(je,this,wt).call(this)}cleanup(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.recycle(e),this.removeRenderer(),this.detachCanvas(),this.removeGPUResMgr()}clear(){this.clearCanvas(),N(fe,this,0),N(ge,this,0),N(ve,this,-1),this.recycle()}clearDisplay(){this.clearCanvas()}getTextureLayersMap(){return V(Re,this)}getTextureLayerByZIndex(e){return D(je,this,it).call(this,e)}getUsedBuffersCount(){let e=0;for(const[t,r]of V(Re,this))r&&r.getTextureBufferGroup()&&r.getTextureBufferGroup().buffer&&e++;return e}consumePendingGPUEvents(){if(V(se,this)){const e=D(je,this,it).call(this,2).getRawData();e&&this.updateWatermark(V(le,this),V(ce,this),e.data)}}resizeCanvasTo(e,t){V(ie,this)&&(V(ie,this).width=e,V(ie,this).height=t)}};function Pt(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}function Tt(e,t){return e.get(Ut(e,t))}function St(e,t,r){return e.set(Ut(e,t),r),r}function Ut(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var Mt=new WeakMap,Rt=new WeakMap,Et=new WeakMap,Gt=new WeakMap,kt=new WeakMap;const Bt=class{constructor(e,t,r){Pt(this,Mt,0),Pt(this,Rt,null),Pt(this,Et,null),Pt(this,Gt,0),Pt(this,kt,null),St(Mt,this,e),St(Gt,this,t),St(kt,this,r),St(Rt,this,[]),St(Et,this,[])}initPool(e){if(e>Tt(Mt,this))throw new Error("initSize=".concat(e," is larger than maxSize=").concat(Tt(Mt,this),", invalid!"));if(e<0)throw new Error("initSize=".concat(e," is smaller than 0, invalid!"));for(let t=0;t<e;t++){const e=new _t(t,Tt(kt,this));Tt(Rt,this).push(e)}}expandPool(e){if(Tt(Rt,this).length>=Tt(Mt,this))return;let t=0;if(Tt(Rt,this).length+e>=Tt(Mt,this)&&(t=Tt(Mt,this)-Tt(Rt,this).length),t>0){const e=Tt(Rt,this).length;for(let r=0;r<t;r++){const t=new _t(r+e,Tt(kt,this));Tt(Rt,this).push(t)}}}pop(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.isPoolEmpty()&&this.expandPool(4);const e=Tt(Rt,this).pop();return e&&(e.markRenderingStatePending(),Tt(Et,this).push(e)),e}recycle(e){if(Tt(Rt,this).length<Tt(Mt,this)){e.recycle(),Tt(Rt,this).push(e);const t=Tt(Et,this).indexOf(e);-1!=t&&Tt(Et,this).splice(t,1)}}clear(){if(Tt(Rt,this)){for(const e of Tt(Rt,this))e&&e.clear();Tt(Rt,this).length=0}}cleanup(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Tt(Rt,this).forEach((t=>{t.cleanup(e)})),Tt(Et,this).forEach((t=>{t.cleanup(e)})),St(Rt,this,[]),St(Et,this,[])}isPoolEmpty(){return 0==Tt(Rt,this).length}getInUseRenderDisplays(){return Tt(Et,this)}getAllRenderDisplays(){return Tt(Rt,this)}isServeForVideoRendering(){return 1===Tt(Gt,this)}isServeForShareRendering(){return 2===Tt(Gt,this)}isServingForNow(e){return Tt(Gt,this)===e}};class Wt{getVideoRenderDisplay(e,t,r,i,n){throw new Error("getVideoRenderDisplay() should be implemented by subclass.")}getRenderDisplay(e,t,r){throw new Error("getRenderDisplay() should be implemented by subclass.")}createVideoRenderDisplay(e,t,r){throw new Error("createVideoRenderDisplay() should be implemented by subclass.")}}function Ct(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}function Ft(e,t){return e.get(Lt(e,t))}function Lt(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var Ot=new WeakMap,It=new WeakMap,At=new WeakMap;class Vt extends Wt{constructor(){super(),Ct(this,Ot,new Map),Ct(this,It,new Map),Ct(this,At,null)}setGPUResourceMgrGetter(e){var t,r;r=e,(t=At).set(Lt(t,this),r)}getVideoRenderDisplay(e,t,r,i,n){let s=Ft(Ot,this).get(e);s||(s=new Bt(r,1,Ft(At,this)),s.initPool(r),Ft(Ot,this).set(e,s));let a=s.pop();return a?(a.setMultiView(!0),a):null}getRenderDisplay(e,t,r){r&&r.clearCache&&Ft(It,this).clear();let i=Ft(It,this).get(e);return i||(i=new Bt(1,2,Ft(At,this)),i.initPool(1),Ft(It,this).set(e,i)),i.pop()}createVideoRenderDisplay(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const n=new _t(r,Ft(At,this));return n.addRenderer(i),n.attachCanvas(e,t),n}getInUseCanvasRenderDisplayList(e){let t=[],r=null;if(1==e?r=Ft(Ot,this):2==e&&(r=Ft(It,this)),r)for(const[e,i]of r){let r={};r.canvas=e,r.renderDisplays=i.getInUseRenderDisplays(),r.renderDisplays.length>0&&t.push(r)}return t}recycleRenderDisplay(e,t){if(e){const t=e.getAttachedCanvas();if(t){let r=Ft(Ot,this).get(t);r&&(e.setWatermarkFlag(0),e.setVideoMode(-1),r.recycle(e));let i=Ft(It,this).get(t);i&&(e.setWatermarkFlag(0),e.setVideoMode(-1),i.recycle(e))}}}cleanup(e){var t;let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null==e||null===(t=e.cleanup)||void 0===t||t.call(e,r);for(const[e,t]of Ft(Ot,this))t.cleanup(r);for(const[e,t]of Ft(It,this))t.cleanup(r)}cleanupByCanvas(e){let t=Ft(Ot,this).get(e);t&&(t.cleanup(),Ft(Ot,this).delete(e));let r=Ft(It,this).get(e);r&&(r.cleanup(),Ft(It,this).delete(e))}collectInUseRenderDisplays(e){return this.getInUseCanvasRenderDisplayList(e)}collectInUseRenderDisplaysByCanvas(e,t){let r=null;return e&&(1==t?r=Ft(Ot,this).get(e).getInUseRenderDisplays():2==t&&(r=Ft(It,this).get(e).getInUseRenderDisplays())),r}getRenderDisplayMap(e){let t=null;return 1==e?t=Ft(Ot,this):2==e&&(t=Ft(It,this)),t}}const Nt="MEDIASDK_CACHE_INFO";function Dt(e){postMessage({status:-29,errorType:e})}new class{constructor(){this._highFrequencyLogs={},this.fixVersion="",this.cacheLogStack=[],this.isFlushing=!1}setInstance(e,t){this._instance=e,this.fixVersion=t}getMessageFromErrorOrEvent(e,t){let r=e;return t instanceof ErrorEvent?(t.filename&&(r+=` File: ${t.filename}`),(t.lineno||t.colno)&&(r+=` Line: ${t.lineno}:${t.colno}`),t.message&&(r+=` Message: ${t.message}`),t.error&&(r+=`\nStack: ${t.error.stack}`)):t instanceof Error?(t.message&&(r+=` Message: ${t.message}`),t.stack&&(r+=` Stack: ${t.stack}`),t.name&&(r+=` Name: ${t.name}`),t.constraint&&(r+=` Constraint: ${t.constraint}`)):t instanceof CloseEvent?(t.code&&(r+=` Code: ${t.code}`),t.reason&&(r+=` Reason: ${t.reason}`),r+=` wasClean: ${t.wasClean}`):t instanceof DOMException?(t.message&&(r+=` Message: ${t.message}`),t.name&&(r+=` Name: ${t.name}`)):r+=t?t.toString():"",r}_addCacheLog(e,t){this.cacheLogStack.length<100&&this.cacheLogStack.push({type:e,message:t})}flushCacheLog(){if(this._instance&&this.cacheLogStack.length>0&&!this.isFlushing){this.isFlushing=!0;let e="";this.cacheLogStack.forEach((t=>{let{type:r,message:{message:i="",tags:n=[]}}=t;const s=i?`${n.join("|")}:${i}|----|`:"";switch(r){case"log":this._log(i,[...n,Nt]);break;case"warn":case"error":case"severityerror":case"directReport":e+=s}})),e&&this._directReport(e,[Nt]),this.cacheLogStack=[],this.isFlushing=!1}}log(e,t=[]){this._instance?(this.flushCacheLog(),this._log(e,t)):this._addCacheLog("log",{message:e,tags:t})}warn(e,t=null,r=[]){e=this.getMessageFromErrorOrEvent(e,t),this._instance?(this.flushCacheLog(),this._warn(e,r)):this._addCacheLog("warn",{message:e,tags:r})}error(e,t=null,r=[]){var i;e=this.getMessageFromErrorOrEvent(e,t),this._highFrequencyLogs[e]?this._highFrequencyLogs[e]+=1:this._highFrequencyLogs[e]=1,!((i=this._highFrequencyLogs[e])&i-1)&&(this._instance?(this.flushCacheLog(),this._error(e,r)):this._addCacheLog("error",{message:e,tags:r}))}severityerror(e,t=[]){this._instance?(this.flushCacheLog(),this._severityerror(JSON.stringify(e),t)):this._addCacheLog("severityerror",{message:JSON.stringify(e),tags:t})}directReport(e,t=["MEDIASDK_INFO"]){var r;this._instance?(this.flushCacheLog(),null===(r=this._directReport)||void 0===r||r.call(this,e,t)):this._addCacheLog("directReport",{message:e,tags:t})}_log(e,t=[]){this._instance&&this._instance.log(e,t)}_warn(e,t=[]){this._instance&&this._instance.warn(e,t)}_error(e,t=[]){this._instance&&this._instance.error(e,[this.fixVersion,...t])}_severityerror(e,t=[]){this._instance&&this._instance.error(e,t)}_directReport(e,t=[]){var r,i;this._instance&&(null===(i=(r=this._instance).directReport)||void 0===i||i.call(r,{msg:e},t))}clearHighFrequencyLogs(){this._highFrequencyLogs={}}},new Error,new Map,new Map,new class{constructor(){this.ssrcInfoMap=new Map,this.timer=null}updateSSRCInfo(e,t){this.ssrcInfoMap.has(e)||this.ssrcInfoMap.set(e,{firstTime:0,lastTime:0,frames:0,fps:0}),this._calculateFPS(e,t),this._removeZeroFPS()}_calculateFPS(e,t){const r=this.ssrcInfoMap.get(e);if(0===r.frames?r.firstTime=t:r.lastTime=t,r.frames+=1,r.frames>2&&r.frames%5==0&&r.lastTime-r.firstTime>=1e3){const t=Math.floor(1e3/((r.lastTime-r.firstTime)/(r.frames-1)));r.fps!==t&&(this._notifyFPS(e,t),r.fps=t),r.firstTime=r.lastTime,r.frames=1}}_removeZeroFPS(){let e=Date.now();this.ssrcInfoMap.forEach(((t,r)=>{const i=this.ssrcInfoMap.get(r);i&&i.lastTime&&e-i.lastTime>2e3&&(this.ssrcInfoMap.delete(r),this._notifyFPS(r,0))}))}_notifyFPS(e,t){postMessage({status:66.6,data:{ssrc:e,fps:t}})}_checkIfNewFrameComing(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout((()=>{this._removeZeroFPS(),this.timer=null}),2500)}},new class{constructor(){this.ssrcInfoMap=new Map,this.timer=null}updateSSRCInfo(e,t){this.ssrcInfoMap.has(e)||this.ssrcInfoMap.set(e,{timeList:[],lastTime:0,fps:0}),this._calculateFPS(e,t),this._removeZeroFPS(),this._checkIfNewFrameComing()}_calculateFPS(e,t){const r=this.ssrcInfoMap.get(e);if(r.timeList.push(t),r.lastTime=t,r.timeList.length>2){const t=r.timeList[0],i=r.timeList[r.timeList.length-1];if(i-t>=1e3){const n=Math.floor(1e3/((i-t)/(r.timeList.length-1)));r.fps!==n&&(this._notifyFPS(e,n),r.fps=n),r.timeList=[]}}r.timeList.length>30&&(r.timeList=r.timeList.slice(r.timeList.length-30))}_removeZeroFPS(){this.ssrcInfoMap.forEach(((e,t)=>{const r=this.ssrcInfoMap.get(t);r&&Date.now()-r.lastTime>2e3&&(this.ssrcInfoMap.delete(t),this._notifyFPS(t,0))}))}_notifyFPS(e,t){postMessage({status:66.6,data:{ssrc:e,fps:t}})}_checkIfNewFrameComing(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout((()=>{this._removeZeroFPS(),this.timer=null}),2500)}};const jt="\n      @group(0) @binding(0) var watermarkSampler: sampler;\n      @group(0) @binding(1) var watermarkTex: texture_2d<f32>;\n  \n      struct VertexOutput {\n          @builtin(position) Position: vec4<f32>,\n          @location(0) uv: vec2<f32>,\n      };\n  \n      @vertex\n      fn v_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) pos: vec2<f32>,\n          @location(1) uvPos: vec2<f32>\n      ) -> VertexOutput {\n  \n          var output: VertexOutput;\n          output.Position = vec4<f32>(pos, 0.0, 1.0);\n          output.uv = vec2f(uvPos.x, uvPos.y);\n          return output;\n      }\n  \n      @fragment\n      fn f_main(@location(0) uv: vec2<f32>) -> @location(0) vec4<f32> {\n          var color: vec4<f32> = textureSampleBaseClampToEdge(watermarkTex, watermarkSampler, uv);\n          if (color.r == 0 && color.g == 0 && color.b == 0) {\n              color.a = 0;\n          }\n          return color;\n      }\n  ",zt="\n  \n      struct FsUniforms {\n          cursorFlag: f32,\n          cursorInfo: vec4f\n      };\n  \n      @group(0) @binding(0) var cursorSampler: sampler;\n      @group(0) @binding(1) var cursorTex: texture_2d<f32>;\n      @group(0) @binding(2) var<uniform> uniforms: FsUniforms;\n  \n      struct VertexOutput {\n          @builtin(position) Position: vec4<f32>,\n          @location(0) uv: vec2<f32>,\n      };\n  \n      @vertex\n      fn v_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) pos: vec2<f32>,\n          @location(1) uvPos: vec2<f32>\n      ) -> VertexOutput {\n  \n          var output: VertexOutput;\n          output.Position = vec4<f32>(pos, 0.0, 1.0);\n          output.uv = vec2f(uvPos.x, 1 - uvPos.y);\n          return output;\n      }\n  \n      @fragment\n      fn f_main(@location(0) uv: vec2<f32>) -> @location(0) vec4<f32> {\n          var color: vec4<f32> = textureSampleBaseClampToEdge(cursorTex, cursorSampler, uv);\n          // if (uniforms.cursorFlag == 1) {\n          //     if (uniforms.cursorInfo.z > 0.0 \n          //         && uv.x >= uniforms.cursorInfo.x\n          //         && uv.y >= uniforms.cursorInfo.y\n          //         && uv.x < uniforms.cursorInfo.x + uniforms.cursorInfo.z\n          //         && uv.y < uniforms.cursorInfo.y + uniforms.cursorInfo.w) {\n  \n          //         var cursorCoord: vec2f = uv - uniforms.cursorInfo.xy;\n          //         cursorCoord = cursorCoord / uniforms.cursorInfo.zw;\n          //         var cursorColor: vec4<f32> = textureSampleBaseClampToEdge(cursorTex, cursorSampler, cursorCoord);\n          //         color = color * (1.0 - cursorColor.a) + cursorColor * cursorColor.a;\n          //     }\n          // }\n  \n          return color;\n      }\n  ",qt="\n      @vertex\n      fn v_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) vtxPos: vec2<f32>,\n      ) -> @builtin(position) vec4<f32> {\n          return vec4<f32>(vtxPos, 0.0, 1.0);\n      }\n      \n      @fragment\n      fn f_main() -> @location(0) vec4<f32> {\n          return vec4(0.0, 0.0, 0.0, 1.0);\n      }\n  ";function Yt(e,t,r){Ht(e,t),t.set(e,r)}function Ht(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function $t(e,t){return e.get(Jt(e,t))}function Xt(e,t,r){return e.set(Jt(e,t),r),r}function Jt(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var Kt=new WeakMap,Zt=new WeakMap,Qt=new WeakMap,er=new WeakMap,tr=new WeakMap,rr=new WeakMap,ir=new WeakMap,nr=new WeakMap,sr=new WeakMap,ar=new WeakMap,or=new WeakMap,ur=new WeakMap,lr=new WeakMap,cr=new WeakMap,hr=new WeakMap,fr=new WeakMap,dr=new WeakMap,pr=new WeakMap,gr=new WeakMap,vr=new WeakMap,mr=new WeakMap,yr=new WeakMap,br=new WeakMap,xr=new WeakMap,wr=new WeakMap,_r=new WeakSet;function Pr(e){e&&e.forEach((e=>{e.markRenderingStatePending()}));const r=Jt(_r,this,Or).call(this,e);if($t(nr,this)&&$t(ir,this)&&$t(or,this))if($t(Kt,this)&&0!=$t(Kt,this).width&&0!=$t(Kt,this).height&&$t(ir,this)&&$t(ir,this).getCurrentTexture()&&0!=$t(ir,this).getCurrentTexture().width&&0!=$t(ir,this).getCurrentTexture().height){$t(nr,this).pushErrorScope("validation"),$t(nr,this).pushErrorScope("out-of-memory"),$t(nr,this).pushErrorScope("internal");try{if(!$t(cr,this)){const e=$t(wr,this).byteLength,t=e;Xt(cr,this,$t(or,this).acquireBuffer(t,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE,e,!0,!1)),new Float32Array($t(cr,this).getMappedRange()).set($t(wr,this)),$t(cr,this).unmap()}const e=Jt(_r,this,Er).call(this);for(const[t,i]of r)Jt(_r,this,Ar).call(this,t,i,e);const i=Jt(_r,this,Lr).call(this,$t(ir,this).getCurrentTexture().createView()),n=e.beginRenderPass(i);n.setVertexBuffer(0,$t(cr,this));for(const[e,t]of r)if(t&&0!=t.length)for(const e of t){if(e.unlock(),-1==e.getTextureLayerType())continue;const t=e.getTextureType();let r=e.getUVCoords();if(3!==t&&!r)continue;const i=$t(Kt,this).width,s=$t(Kt,this).height;let a=e.getViewport();if(!a||Number.isNaN(a.x)||Number.isNaN(a.y)||Number.isNaN(a.w)||Number.isNaN(a.h)||a.x<0||a.y<0)continue;if(a.x+a.w>i){let e=a.x+a.w-i;if(!(e>0&&e<=5))continue;a.w-=e,a.w<=0&&(a.w=1)}if(a.y+a.h>s){let e=a.y+a.h-s;if(!(e>0&&e<=5))continue;a.h-=e,a.h<=0&&(a.h=1)}const o=Jt(_r,this,Ir).call(this,e);if(!o)continue;if(5!==o.pipelineType){let t=e.getUVCoordsBuffer();if(!t){const i=r.byteLength;t=$t(or,this).acquireBuffer(i,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,r.byteLength,!1,!1),e.setUVCoordsBuffer(t)}$t(nr,this).queue.writeBuffer(t,0,r,0,r.length),n.setVertexBuffer(1,t)}n.setViewport(a.x,a.y,a.w,a.h,a.minDepth,a.maxDepth);const u=o.pipeline;n.setPipeline(u);const l=$t(nr,this).createBindGroup({layout:u.getBindGroupLayout(0),entries:o.entries});n.setBindGroup(0,l),n.draw(6,1,0,0)}n.end(),Jt(_r,this,Gr).call(this),$t(nr,this).popErrorScope().then((e=>{if(!e)return;t().tracing.globaltracing_error("WebGPU [WebGPURenderer] popErrorScope() error:".concat(JSON.stringify(e)));let r=5;r=e instanceof GPUValidationError?3:e instanceof GPUOutOfMemoryError?2:e instanceof GPUInternalError?4:5,3!=r&&Dt(r)}))}catch(e){t().tracing.globaltracing_error("WebGPU [WebGPURenderer] renderNoMsaa() error:".concat(e.message))}finally{$t(rr,this).recycleInUsedGPUBuffers(r)}}else $t(rr,this)&&$t(rr,this).recycleInUsedGPUBuffers(r);else $t(rr,this)&&$t(rr,this).recycleInUsedGPUBuffers(r)}function Tr(e){if(!$t(nr,this)||!$t(ir,this))return;const t=$t(nr,this).createBuffer({label:"VertexBuffer",size:$t(wr,this).byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE,mappedAtCreation:!0});new Float32Array(t.getMappedRange()).set($t(wr,this)),t.unmap();const r=Jt(_r,this,Er).call(this),i=Jt(_r,this,Or).call(this,e);for(const[e,t]of i)Jt(_r,this,Ar).call(this,e,t,r);const n=Jt(_r,this,Dr).call(this,$t(Kt,this)),s=Jt(_r,this,Fr).call(this,0,n.createView(),$t(ir,this).getCurrentTexture().createView()),a=r.beginRenderPass(s);a.setVertexBuffer(0,t);for(const[e,t]of i)if(t&&0!=t.length)for(const e of t){if(e.unlock(),-1==e.getTextureLayerType())continue;let t=e.getUVCoords();if(!t)continue;let r=e.getUVCoordsBuffer();if(!r){const i=t.byteLength;r=$t(or,this).acquireBuffer(i,GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,t.byteLength,!1,!0),e.setUVCoordsBuffer(r)}$t(nr,this).queue.writeBuffer(r,0,t,0,t.length),a.setVertexBuffer(1,r);const i=$t(Kt,this).width,n=$t(Kt,this).height;let s=e.getViewport();if(!s||Number.isNaN(s.x)||Number.isNaN(s.y)||Number.isNaN(s.w)||Number.isNaN(s.h)||s.x<0||s.y<0||s.x+s.w>i||s.y+s.h>n)continue;const o=Jt(_r,this,Ir).call(this,e,!0);if(!o)continue;a.setViewport(s.x,s.y,s.w,s.h,s.minDepth,s.maxDepth);const u=o.pipeline;a.setPipeline(u);const l=$t(nr,this).createBindGroup({layout:u.getBindGroupLayout(0),entries:o.entries});a.setBindGroup(0,l),a.draw(6,1,0,0)}a.end(),Jt(_r,this,Gr).call(this),e.forEach((e=>{e.markRenderingStatePending()}))}function Sr(e){if(!Array.isArray(e))return;let t=[];for(let r=0;r<e.length;++r){let i=e[r];t.push(i.x),t.push(i.y)}$t(wr,this).set(t,0)}function Ur(e,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=e.getTextureBufferGroup();if(!$t(nr,this))return n&&n.buffer&&n.buffer.unmap(),null;if(!r)return n&&n.buffer&&n.buffer.unmap(),null;if(!n)return i||null;"unmapped"!=n.buffer.mapState&&n.buffer.unmap();let s=null,a=null,o=null;const u=e.getWidth(),l=e.getHeight();(u<=0||l<=0)&&t().tracing.globaltracing_error("WebGPU [WebGPURenderer] #evalYuvTextureGroup() width=".concat(u,", height=").concat(l," is invalid!"));const c=null!=i&&(u!=i.yPlaneTex.width||l!=i.yPlaneTex.height);let h=!0;i&&(c?($t(rr,this).destroyTextureGroup(e),h=!0):(s=i.yPlaneTex,a=i.uPlaneTex,o=i.vPlaneTex,h=!1));let f=!1,d="r8unorm";if(n&&n.bufferConfig&&"nv12"==n.bufferConfig.colorFormat&&(d="rg8unorm",f=!0),h){const t=e.getIndex(),r=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC,i=$t(lr,this).assembleTextureConfig(u,l,r,"r8unorm",1),n=$t(lr,this).assembleTextureConfig(u/2,l/2,r,d,1);s=$t(lr,this).acquireTexture(i),s&&(s.label="RD(".concat(t,")-YPlaneTexture")),f?(a=$t(lr,this).acquireTexture(n),a&&(a.label="RD(".concat(t,")-UVPlaneTexture"))):(a=$t(lr,this).acquireTexture(n),a&&(a.label="RD(".concat(t,")-UPlaneTexture")),o=$t(lr,this).acquireTexture(n),o&&(o.label="RD(".concat(t,")-VPlaneTexture")))}r.copyBufferToTexture({buffer:n.buffer,offset:n.yPlaneBuffer.offset,bytesPerRow:n.yPlaneBuffer.bytesPerRow,rowsPerImage:n.yPlaneBuffer.rowsPerImage},{texture:s},[u,l,1]),r.copyBufferToTexture({buffer:n.buffer,offset:n.uPlaneBuffer.offset,bytesPerRow:n.uPlaneBuffer.bytesPerRow,rowsPerImage:n.uPlaneBuffer.rowsPerImage},{texture:a},[u/2,l/2,1]),n.vPlaneBuffer.offset>0&&!f&&r.copyBufferToTexture({buffer:n.buffer,offset:n.vPlaneBuffer.offset,bytesPerRow:n.vPlaneBuffer.bytesPerRow,rowsPerImage:n.vPlaneBuffer.rowsPerImage},{texture:o},[u/2,l/2,1]);let p={};return p.yPlaneTex=s,p.uPlaneTex=a,p.vPlaneTex=o,p}function Mr(e,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=e.getTextureBufferGroup();if(!$t(nr,this))return n&&n.buffer&&n.buffer.unmap(),null;if(!r)return n&&n.buffer&&n.buffer.unmap(),null;if(!n)return i||null;"unmapped"!=n.buffer.mapState&&n.buffer.unmap();const s=e.getIndex(),a=e.getWidth(),o=e.getHeight();(a<=0||o<=0)&&t().tracing.globaltracing_error("WebGPU [WebGPURenderer] #evalRgbaTexture() width=".concat(a,", height=").concat(o," is invalid!"));const u=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;let l=null;const c=null!=i&&(a!=i.width||o!=i.height);let h=!0;if(i&&(c?($t(rr,this).destroyTextureGroup(e),h=!0):(l=i,h=!1)),h){const e=$t(lr,this).assembleTextureConfig(a,o,u,"rgba8unorm",1);l=$t(lr,this).acquireTexture(e),l&&(l.label="RD(".concat(s,")-rgbaTexture"))}return r.copyBufferToTexture({buffer:n.buffer,offset:0,bytesPerRow:n.bytesPerRow,rowsPerImage:n.rowsPerImage},{texture:l},[a,o,1]),l}function Rr(e,t){return Math.ceil(e/t)*t}function Er(){return $t(nr,this)?($t(ar,this)||Xt(ar,this,$t(nr,this).createCommandEncoder()),$t(ar,this)):null}function Gr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;$t(ar,this)&&e?$t(nr,this).queue.submit([$t(ar,this).finish(),e.finish()]):$t(ar,this)?$t(nr,this).queue.submit([$t(ar,this).finish()]):e&&$t(nr,this).queue.submit([e.finish()]),Xt(ar,this,null)}function kr(e,t){if(!$t(nr,this))return null;if(!$t(yr,this)){let r=$t(nr,this).createBindGroupLayout({label:"CursorTexBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]});if(!r)return null;const i=$t(nr,this).createPipelineLayout({label:"CursorTexPipelineLayout(".concat(e,")"),bindGroupLayouts:[r]}),n={label:"CursorTexRenderPipeline(".concat(e,")"),layout:i,vertex:{module:$t(nr,this).createShaderModule({code:zt}),entryPoint:"v_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:$t(nr,this).createShaderModule({code:zt}),entryPoint:"f_main",targets:[{format:$t(sr,this),blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"}};t&&(n.multisample={count:4}),Xt(yr,this,$t(nr,this).createRenderPipeline(n))}return $t(yr,this)}function Br(e,t){if(!$t(nr,this))return null;if(!$t(mr,this)){let r=$t(nr,this).createBindGroupLayout({label:"WatermarkTexBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}}]});if(!r)return null;const i=$t(nr,this).createPipelineLayout({label:"WatermarkTexPipelineLayout(".concat(e,")"),bindGroupLayouts:[r]}),n={label:"WatermarkTexRenderPipeline(".concat(e,")"),layout:i,vertex:{module:$t(nr,this).createShaderModule({code:jt}),entryPoint:"v_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:$t(nr,this).createShaderModule({code:jt}),entryPoint:"f_main",targets:[{format:$t(sr,this),blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"}};t&&(n.multisample={count:4}),Xt(mr,this,$t(nr,this).createRenderPipeline(n))}return $t(mr,this)}function Wr(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!$t(nr,this)||!e)return null;if(!$t(pr,this)){const r=$t(nr,this).createBindGroupLayout({label:"YuvBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:4,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:5,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:6,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),i={label:"YuvRenderPipeline",layout:$t(nr,this).createPipelineLayout({label:"YuvPipelineLayout",bindGroupLayouts:[r]}),vertex:{module:$t(nr,this).createShaderModule({code:e}),entryPoint:"vertex_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:$t(nr,this).createShaderModule({code:e}),entryPoint:"fragment_main",targets:[{format:$t(sr,this),blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"}};t&&(i.multisample={count:4}),Xt(pr,this,$t(nr,this).createRenderPipeline(i))}return $t(pr,this)}function Cr(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!$t(nr,this)||!e)return null;if(!$t(gr,this)){const r=$t(nr,this).createBindGroupLayout({label:"YuvBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},{binding:4,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:5,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),i={label:"YuvRenderPipeline",layout:$t(nr,this).createPipelineLayout({label:"YuvPipelineLayout",bindGroupLayouts:[r]}),vertex:{module:$t(nr,this).createShaderModule({code:e}),entryPoint:"vertex_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:$t(nr,this).createShaderModule({code:e}),entryPoint:"fragment_main",targets:[{format:$t(sr,this)}]},primitive:{topology:"triangle-list"}};t&&(i.multisample={count:4}),Xt(gr,this,$t(nr,this).createRenderPipeline(i))}return $t(gr,this)}function Fr(e,t,r){return{label:"renderPass - ".concat(e),colorAttachments:[{view:t,resolveTarget:r,loadOp:"clear",storeOp:"discard"}]}}function Lr(e){return e&&(e.label="canvas-texture-view"),{label:"RenderPassNoMsaa",colorAttachments:[{view:e,loadOp:"clear",storeOp:"store"}]}}function Or(e){let t=new Map;for(let r=0;r<e.length;++r){const i=e[r],n=i.getTextureLayersMap(),s=i.isSetWatermark();for(let e=0;e<4;++e)if(n.has(e)){const r=n.get(e);if(r){let i=t.get(e);i||(i=[]),2===e?s&&(i.push(r),t.set(e,i)):(i.push(r),t.set(e,i))}}}return t}function Ir(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=null,i=null,n=null,s=null;const a=e.getZIndex(),o=e.getTextureType(),u=e.getColorFormat();if(0==a){if(0==o){s=0,r=this.acquireVideoFrameRenderPipeline("\n      struct VertexOutput {\n          @builtin(position) Position: vec4<f32>,\n          @location(0) uv: vec2<f32>,\n      };\n  \n      struct FsUniforms {\n        rotation: f32,\n        enable_rounded_corner: f32,\n        radius_lt_x: f32,\n        radius_lt_y: f32,\n        radius_lb_x: f32,\n        radius_lb_y: f32,\n        radius_rt_x: f32,\n        radius_rt_y: f32,\n        radius_rb_x: f32,\n        radius_rb_y: f32,\n        aa_width: f32,\n        viewport_x: f32,\n        viewport_y: f32,\n        viewport_w: f32,\n        viewport_h: f32,\n      };\n  \n      @group(0) @binding(0) var vfSampler: sampler;\n      @group(0) @binding(1) var vfTexture: texture_external;\n      @group(0) @binding(2) var<uniform> vsUniforms: FsUniforms;\n      @group(0) @binding(3) var<uniform> fsUniforms: FsUniforms;\n      \n      @vertex\n      fn vertex_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) vtxPos: vec2<f32>,\n          @location(1) uvPos: vec2<f32>\n      ) -> VertexOutput {\n      \n          var output: VertexOutput;\n          output.Position = vec4<f32>(vtxPos, 0.0, 1.0);\n          \n          if (vsUniforms.rotation == 0) {\n              output.uv = vec2f(uvPos.x, 1 - uvPos.y);    \n          } else if (vsUniforms.rotation == 1) {\n              output.uv = vec2f(1 - uvPos.y, 1 - uvPos.x);\n          } else if (vsUniforms.rotation == 2) {\n              output.uv = vec2f(uvPos.x, uvPos.y);\n          } else if (vsUniforms.rotation == 3) {\n              output.uv = vec2f(uvPos.y, uvPos.x);\n          } else {\n              output.uv = uvPos;\n          }\n  \n          return output;\n      }\n      \n      @fragment\n      fn fragment_main(@location(0) uv : vec2<f32>, @builtin(position) fragCoord: vec4<f32>) -> @location(0) vec4<f32> {\n          var color: vec4<f32> = textureSampleBaseClampToEdge(vfTexture, vfSampler, uv);\n\n          // rounded corner\n          var canvas_uv: vec2<f32> = (fragCoord.xy - vec2<f32>(fsUniforms.viewport_x, fsUniforms.viewport_y)) / vec2<f32>(fsUniforms.viewport_w, fsUniforms.viewport_h);\n          var corner_radius: vec2<f32> = mix(\n            mix(vec2(fsUniforms.radius_lb_x, fsUniforms.radius_lb_y), vec2(fsUniforms.radius_rb_x, fsUniforms.radius_rb_y), step(0.5, canvas_uv.x)),\n            mix(vec2(fsUniforms.radius_lt_x, fsUniforms.radius_lt_y), vec2(fsUniforms.radius_rt_x, fsUniforms.radius_rt_y), step(0.5, canvas_uv.x)),\n            step(0.5, canvas_uv.y)\n          );\n\n          var safe_corner_radius: vec2<f32> = max(corner_radius, vec2(0.0001));\n          var d: vec2<f32> = max(corner_radius - canvas_uv, canvas_uv - (1.0 - corner_radius));\n          d = max(d, vec2<f32>(0.0));   \n          var dist: f32 = length(d / safe_corner_radius);\n\n          var max_corner_radius: f32 = max(max(corner_radius.x, corner_radius.y), 0.001);\n          var is_zero_radius: f32 = step(0.001, max_corner_radius);\n          var rounded_alpha: f32 = smoothstep(1.0, 1.0 - fsUniforms.aa_width, dist);\n          var final_alpha: f32 = mix(1.0, rounded_alpha, fsUniforms.enable_rounded_corner * is_zero_radius);\n\n          return vec4<f32>(color.rgb, color.a * 1.0);\n      }\n  ",t),i=this.acquireVideoFrameSampler();const a=e.getPendingVideoFrame();if(!a||0==a.codedWidth||0==a.codedHeight||!a.format)return e.setPendingVideoFrame(null),null;const o=e.getUniformBuffer();if(!o)return null;n=[{binding:0,resource:i},{binding:1,resource:$t(nr,this).importExternalTexture({source:a})},{binding:2,resource:{buffer:o}},{binding:3,resource:{buffer:o}}]}else if(3==o){s=5,r=this.acquireClearColorRenderPipeline("\n      @vertex\n      fn v_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) vtxPos: vec2<f32>,\n      ) -> @builtin(position) vec4<f32> {\n          return vec4<f32>(vtxPos, 0.0, 1.0);\n      }\n  \n      struct ClearColorUniforms {\n          clearColor: vec4<f32>,\n      };\n  \n      @group(0) @binding(0) var<uniform> uniforms: ClearColorUniforms;\n      @fragment\n      fn f_main() -> @location(0) vec4<f32> {\n          return uniforms.clearColor;\n      }\n  ");const t=e.getClearColorUniformBuffer();if(!t)return null;n=[{binding:0,resource:{buffer:t}}]}else if(1==o){"i420"==u?(s=1,r=Jt(_r,this,Wr).call(this,"\n      struct VertexOutput {\n          @builtin(position) Position: vec4<f32>,\n          @location(0) uv: vec2<f32>,\n      };\n\n      struct FsUniforms {\n          yuvMode: f32,\n          colorRange: f32,\n          rotation: f32,\n          enable_rounded_corner: f32,\n          radius_lt_x: f32,\n          radius_lt_y: f32,\n          radius_lb_x: f32,\n          radius_lb_y: f32,\n          radius_rt_x: f32,\n          radius_rt_y: f32,\n          radius_rb_x: f32,\n          radius_rb_y: f32,\n          aa_width: f32,\n          viewport_x: f32,\n          viewport_y: f32,\n          viewport_w: f32,\n          viewport_h: f32,\n      };\n  \n      @group(0) @binding(0) var yPlaneSampler: sampler;\n      @group(0) @binding(1) var uvPlaneSampler: sampler;\n      @group(0) @binding(2) var yPlaneTex: texture_2d<f32>;\n      @group(0) @binding(3) var uPlaneTex: texture_2d<f32>;\n      @group(0) @binding(4) var vPlaneTex: texture_2d<f32>;\n      @group(0) @binding(5) var<uniform> fsUniforms: FsUniforms;\n      @group(0) @binding(6) var<uniform> vsUniforms: FsUniforms;\n      // @group(0) @binding(7) var<storage, read_write> outputBuffer: array<f32>;\n  \n      @vertex\n      fn vertex_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) vtxPos: vec2<f32>,\n          @location(1) uvPos: vec2<f32>\n      ) -> VertexOutput {\n      \n          var output: VertexOutput;\n          output.Position = vec4<f32>(vtxPos, 0.0, 1.0);\n  \n          if (vsUniforms.rotation == 0) {\n              output.uv = vec2f(uvPos.x, 1 - uvPos.y);    \n          } else if (vsUniforms.rotation == 1) {\n              output.uv = vec2f(1 - uvPos.y, 1 - uvPos.x);\n          } else if (vsUniforms.rotation == 2) {\n              output.uv = vec2f(uvPos.x, uvPos.y);\n          } else if (vsUniforms.rotation == 3) {\n              output.uv = vec2f(uvPos.y, uvPos.x);\n          } else {\n              output.uv = uvPos;\n          }\n          \n          return output;\n      }\n      \n      @fragment\n      fn fragment_main(@location(0) uv : vec2<f32>, @builtin(position) fragCoord: vec4<f32>) -> @location(0) vec4<f32> {\n          let y = textureSampleBaseClampToEdge(yPlaneTex, yPlaneSampler, uv).r;\n          var u: f32;\n          var v: f32;\n          if (fsUniforms.yuvMode == 1) {\n              u = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).r;\n              v = textureSampleBaseClampToEdge(vPlaneTex, uvPlaneSampler, uv).r;\n          } else {\n              u = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).r;\n              v = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).a;\n          }\n  \n          const yuv2RGB_L = mat4x4(\n              1.1643835616, 0, 1.7927410714, -0.9729450750,\n              1.1643835616, -0.2132486143, -0.5329093286, 0.3014826655,\n              1.1643835616, 2.1124017857, 0, -1.1334022179,\n              0, 0, 0, 1\n          );\n  \n          const yuv2RGB_F = mat4x4(\n              1.0, 0, 1.402, -.701,\n              1.0, -.34413, -.71414, .529135,\n              1.0, 1.772, 0, -.886,\n              0, 0, 0, 1\n          );\n  \n          var color = vec4<f32>(y, u, v, 1.0);\n          if (fsUniforms.colorRange == 0) {\n              color = color * yuv2RGB_L;\n          } else {\n              color = color * yuv2RGB_F;\n          }\n  \n          // support rounded corner\n          // rounded corner\n          var canvas_uv: vec2<f32> = (fragCoord.xy - vec2<f32>(fsUniforms.viewport_x, fsUniforms.viewport_y)) / vec2<f32>(fsUniforms.viewport_w, fsUniforms.viewport_h);\n          var corner_radius: vec2<f32> = mix(\n            mix(vec2(fsUniforms.radius_lb_x, fsUniforms.radius_lb_y), vec2(fsUniforms.radius_rb_x, fsUniforms.radius_rb_y), step(0.5, canvas_uv.x)),\n            mix(vec2(fsUniforms.radius_lt_x, fsUniforms.radius_lt_y), vec2(fsUniforms.radius_rt_x, fsUniforms.radius_rt_y), step(0.5, canvas_uv.x)),\n            step(0.5, canvas_uv.y)\n          );\n\n          var safe_corner_radius: vec2<f32> = max(corner_radius, vec2(0.0001));\n          var d: vec2<f32> = max(corner_radius - canvas_uv, canvas_uv - (1.0 - corner_radius));\n          d = max(d, vec2<f32>(0.0));\n          var dist: f32 = length(d / safe_corner_radius);\n\n          var max_corner_radius: f32 = max(max(corner_radius.x, corner_radius.y), 0.001);\n          var is_zero_radius: f32 = step(0.001, max_corner_radius);\n          var rounded_alpha: f32 = smoothstep(1.0, 1.0 - fsUniforms.aa_width, dist);\n          var final_alpha: f32 = mix(1.0, rounded_alpha, fsUniforms.enable_rounded_corner * is_zero_radius);\n\n          return vec4<f32>(color.rgb, color.a * 1.0);\n      }\n  ",t)):"nv12"==u&&(s=2,r=Jt(_r,this,Cr).call(this,"\n      struct VertexOutput {\n          @builtin(position) Position: vec4<f32>,\n          @location(0) uv: vec2<f32>,\n      };\n  \n      struct FsUniforms {\n          yuvMode: f32,\n          colorRange: f32,\n          rotation: f32,\n          enable_rounded_corner: f32,\n          radius_lt_x: f32,\n          radius_lt_y: f32,\n          radius_lb_x: f32,\n          radius_lb_y: f32,\n          radius_rt_x: f32,\n          radius_rt_y: f32,\n          radius_rb_x: f32,\n          radius_rb_y: f32,\n          aa_width: f32,\n          viewport_x: f32,\n          viewport_y: f32,\n          viewport_w: f32,\n          viewport_h: f32,\n      };\n      \n      @group(0) @binding(0) var yPlaneSampler: sampler;\n      @group(0) @binding(1) var uvPlaneSampler: sampler;\n      @group(0) @binding(2) var yPlaneTex: texture_2d<f32>;\n      @group(0) @binding(3) var uPlaneTex: texture_2d<f32>;\n      @group(0) @binding(4) var<uniform> fsUniforms: FsUniforms;\n      @group(0) @binding(5) var<uniform> vsUniforms: FsUniforms;\n      // @group(0) @binding(5) var<storage, read_write> outputBuffer: array<f32>;\n      \n      @vertex\n      fn vertex_main(\n          @builtin(vertex_index) VertexIndex: u32,\n          @location(0) vtxPos: vec2<f32>,\n          @location(1) uvPos: vec2<f32>\n      ) -> VertexOutput {\n      \n          var output: VertexOutput;\n          output.Position = vec4<f32>(vtxPos, 0.0, 1.0);\n          \n          if (vsUniforms.rotation == 0) {\n              output.uv = vec2f(uvPos.x, 1 - uvPos.y);    \n          } else if (vsUniforms.rotation == 1) {\n              output.uv = vec2f(1 - uvPos.y, 1 - uvPos.x);\n          } else if (vsUniforms.rotation == 2) {\n              output.uv = vec2f(uvPos.x, uvPos.y);\n          } else if (vsUniforms.rotation == 3) {\n              output.uv = vec2f(uvPos.y, uvPos.x);\n          } else {\n              output.uv = uvPos;\n          }\n              \n          return output;\n      }\n  \n      @fragment\n      fn fragment_main(@location(0) uv : vec2<f32>, @builtin(position) fragCoord: vec4<f32>) -> @location(0) vec4<f32> {\n          let y = textureSampleBaseClampToEdge(yPlaneTex, yPlaneSampler, uv).r;\n          var u: f32;\n          var v: f32;\n          u = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).r;\n          v = textureSampleBaseClampToEdge(uPlaneTex, uvPlaneSampler, uv).g;\n  \n          const yuv2RGB_L = mat4x4(\n              1.1643835616, 0, 1.7927410714, -0.9729450750,\n              1.1643835616, -0.2132486143, -0.5329093286, 0.3014826655,\n              1.1643835616, 2.1124017857, 0, -1.1334022179,\n              0, 0, 0, 1\n          );\n  \n          const yuv2RGB_F = mat4x4(\n              1.0, 0, 1.402, -.701,\n              1.0, -.34413, -.71414, .529135,\n              1.0, 1.772, 0, -.886,\n              0, 0, 0, 1\n          );\n  \n          var color = vec4<f32>(y, u, v, 1.0);\n          if (fsUniforms.colorRange == 0) {\n              color = color * yuv2RGB_L;\n          } else {\n              color = color * yuv2RGB_F;\n          }\n  \n          // outputBuffer[0] = y;\n          // outputBuffer[1] = u;\n          // outputBuffer[2] = v;\n          // outputBuffer[3] = color.r;\n          // outputBuffer[4] = color.g;\n          // outputBuffer[5] = color.b;\n          // outputBuffer[6] = color.a;\n  \n          // rounded corner\n          var canvas_uv: vec2<f32> = (fragCoord.xy - vec2<f32>(fsUniforms.viewport_x, fsUniforms.viewport_y)) / vec2<f32>(fsUniforms.viewport_w, fsUniforms.viewport_h);\n          var corner_radius: vec2<f32> = mix(\n            mix(vec2(fsUniforms.radius_lb_x, fsUniforms.radius_lb_y), vec2(fsUniforms.radius_rb_x, fsUniforms.radius_rb_y), step(0.5, canvas_uv.x)),\n            mix(vec2(fsUniforms.radius_lt_x, fsUniforms.radius_lt_y), vec2(fsUniforms.radius_rt_x, fsUniforms.radius_rt_y), step(0.5, canvas_uv.x)),\n            step(0.5, canvas_uv.y)\n          );\n\n          var safe_corner_radius: vec2<f32> = max(corner_radius, vec2(0.0001));\n          var d: vec2<f32> = max(corner_radius - canvas_uv, canvas_uv - (1.0 - corner_radius));\n          d = max(d, vec2<f32>(0.0));\n          var dist: f32 = length(d / safe_corner_radius);\n\n          var max_corner_radius: f32 = max(max(corner_radius.x, corner_radius.y), 0.001);\n          var is_zero_radius: f32 = step(0.001, max_corner_radius);\n          var rounded_alpha: f32 = smoothstep(1.0, 1.0 - fsUniforms.aa_width, dist);\n          var final_alpha: f32 = mix(1.0, rounded_alpha, fsUniforms.enable_rounded_corner * is_zero_radius);\n\n          // return vec4<f32>(color.rgb, color.a * 1.0);\n          return color;\n        }\n  ",t)),i=this.acquireYuvTexturesSamplers();const a=e.getUniformBuffer();if(!a)return null;const o=e.getTextureGroup();o&&("i420"==u?n=[{binding:0,resource:i[0]},{binding:1,resource:i[1]},{binding:2,resource:o.yPlaneTex.createView()},{binding:3,resource:o.uPlaneTex.createView()},{binding:4,resource:o.vPlaneTex.createView()},{binding:5,resource:{buffer:a}},{binding:6,resource:{buffer:a}}]:"nv12"==u&&(n=[{binding:0,resource:i[0]},{binding:1,resource:i[1]},{binding:2,resource:o.yPlaneTex.createView()},{binding:3,resource:o.uPlaneTex.createView()},{binding:4,resource:{buffer:a}},{binding:5,resource:{buffer:a}}]))}}else if(2==a||3==a){s=3,r=Jt(_r,this,Br).call(this,a,t),i=this.acquireBlendTextureSampler();const o=e.getTextureGroup();o&&(n=[{binding:0,resource:i},{binding:1,resource:o.createView()}])}else if(1==a){s=4,r=Jt(_r,this,kr).call(this,a,t),i=this.acquireBlendTextureSampler();const o=e.getUniformBuffer();if(!o)return null;const u=e.getTextureGroup();u&&(n=[{binding:0,resource:i},{binding:1,resource:u.createView()},{binding:2,resource:{buffer:o}}])}if(5===s){if(!r||!n)return null}else if(!r||!i||!n||null==s)return null;return{pipelineType:s,pipeline:r,entries:n}}function Ar(e,t,r){for(const i of t){const t=i.getTextureType();0!=t&&3!=t&&(0==e?Jt(_r,this,Vr).call(this,i,r):1!=e&&2!=e&&3!=e||Jt(_r,this,Nr).call(this,i,r))}}function Vr(e,t){let r=e.getTextureGroup();r?e.isNew()&&(r=Jt(_r,this,Ur).call(this,e,t,r),e.setIsNew(!1)):(r=Jt(_r,this,Ur).call(this,e,t,null),e.setIsNew(!1)),r&&e.setTextureGroup(r)}function Nr(e,t){let r=e.getTextureGroup();r?e.isNew()&&(r=Jt(_r,this,Mr).call(this,e,t,r),e.setIsNew(!1)):(r=Jt(_r,this,Mr).call(this,e,t,null),e.setIsNew(!1)),r&&e.setTextureGroup(r)}function Dr(e){if(!e||!$t(nr,this))return $t(xr,this)?$t(xr,this):null;if($t(xr,this)){if($t(xr,this).width!=e.width||$t(xr,this).height!=e.height){const t=$t(lr,this).assembleTextureConfig(e.width,e.height,GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT,$t(sr,this),4);Xt(xr,this,$t(lr,this).acquireTexture(t))}}else{const t=$t(lr,this).assembleTextureConfig(e.width,e.height,GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT,$t(sr,this),4);Xt(xr,this,$t(lr,this).acquireTexture(t))}return $t(xr,this)}const jr=class{constructor(e,t){var r;if(Ht(this,r=_r),r.add(this),Yt(this,Kt,null),Yt(this,Zt,0),Yt(this,Qt,0),Yt(this,er,!1),Yt(this,tr,!1),Yt(this,rr,null),Yt(this,ir,null),Yt(this,nr,null),Yt(this,sr,null),Yt(this,ar,null),Yt(this,or,null),Yt(this,ur,null),Yt(this,lr,null),Yt(this,cr,null),Yt(this,hr,null),Yt(this,fr,null),Yt(this,dr,null),Yt(this,pr,null),Yt(this,gr,null),Yt(this,vr,null),Yt(this,mr,null),Yt(this,yr,null),Yt(this,br,null),Yt(this,xr,null),Yt(this,wr,new Float32Array(12)),!t)throw new Error("[WebGPURenderer] resMgr is an invalid param! ".concat(t));Xt(Kt,this,e),Xt(rr,this,t),this.initialize(e)}switchMsaa(e){Xt(tr,this,e)}isMsaaEnabled(){return $t(tr,this)}setCanvas(e){e&&Xt(Kt,this,e)}setDevice(e){e&&Xt(nr,this,e)}setRenderArgs(e,t){Xt(Zt,this,e||0),Xt(Qt,this,$t(Zt,this)?3:t?4:6),Xt(er,this,t||!1)}setTextureIndex(e){Xt(Zt,this,e||0)}initialize(e){if(!$t(nr,this)){if(Xt(nr,this,$t(rr,this).acquireGPUDevice()),!$t(nr,this))return void t().tracing.globaltracing_error("WebGPU [WebGPURenderer] initialize() device is not ready!");$t(nr,this).addEventListener("uncapturederror",(e=>{let r=5;r=e.error instanceof GPUValidationError?3:e.error instanceof GPUOutOfMemoryError?2:e.error instanceof GPUInternalError?4:5,3!=r&&Dt(r),t().tracing.globaltracing_error("WebGPU [WebGPURenderer] uncapturederror message:".concat(e.error.message,", errorType:").concat(r))}))}$t(sr,this)||Xt(sr,this,$t(rr,this).acquireCanvasFormat()),$t(or,this)||Xt(or,this,$t(rr,this).acquireGPUBufferMgr()),$t(ur,this)||Xt(ur,this,$t(rr,this).acquireGPUBufferPool()),$t(lr,this)||Xt(lr,this,$t(rr,this).acquireGPUTextureMgr()),this.configureGPUContext(e),Jt(_r,this,Sr).call(this,l)}isGPUDeviceReady(){return null!=$t(nr,this)}render(e){$t(tr,this)?Jt(_r,this,Tr).call(this,e):Jt(_r,this,Pr).call(this,e)}updateVertexCoords(e){Jt(_r,this,Sr).call(this,e)}createRGBATexture(e,r,i,n,s){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(r<0)return t().tracing.globaltracing_error("WebGPU [WebGPURenderer] createRGBATexture() ".concat(r," is an invalid index!")),null;if(!$t(or,this))return null;if(!$t(nr,this))return null;if(null==s||void 0===s)return null;if(!e)return null;const o=Jt(_r,this,Rr).call(this,Uint32Array.BYTES_PER_ELEMENT*i,256),u=GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC,l=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;let c=null;const h=null!=a&&(i!=a.width||n!=a.height);let f=!0;if(a&&(h?($t(lr,this).recycleTexture(a),f=!0):(c=a,f=!1)),f){const e=$t(lr,this).assembleTextureConfig(i,n,l,"rgba8unorm",1);c=$t(lr,this).acquireTexture(e),c&&(c.label="RD(".concat(r,")-rgbaTexture"))}const d=$t(or,this).acquireBuffer("".concat(r,"_Y"),u,o*n,!0,!1),p=new Uint8Array(d.getMappedRange()),g=i*Uint32Array.BYTES_PER_ELEMENT;for(let e=0;e<n;++e)p.set(s.subarray(e*g,(e+1)*g),e*o);return d.unmap(),e.copyBufferToTexture({buffer:d,offset:0,bytesPerRow:o,rowsPerImage:n},{texture:c},[i,n,1]),c}writeToYuvTexturesBufferGroup(e,r){if(!($t(or,this)&&e&&r&&r.buffer&&r.bufferConfig&&"mapped"==r.buffer.mapState))return null;let i=e.yPlane,n=e.cbPlane,s=e.crPlane;const a=Jt(_r,this,Rr).call(this,Uint8Array.BYTES_PER_ELEMENT*i.width,256);let o=Uint8Array.BYTES_PER_ELEMENT;"nv12"==r.bufferConfig.colorFormat&&(o=Uint16Array.BYTES_PER_ELEMENT);const u=Jt(_r,this,Rr).call(this,o*n.width,256),l=a*i.height;let c=0,h=a*i.height+u*n.height;s&&s.buffer&&(h+=u*s.height,c=0+l+u*n.height);let f=r.buffer,d=r.bufferArray;d||(d=f.getMappedRange(0,h),r.bufferArray=d);const p=new Uint8Array(d),g=i.width*Uint8Array.BYTES_PER_ELEMENT;if(0+i.height*a>=p.length)return t().tracing.Log_Error("WebGPU [WebGPURenderer] write yPlane is out of range! yPlaneOffset=".concat(0,", yPlane.height=").concat(i.height,", yPlaneBytesPerRow=").concat(a,", mappedArray.len=").concat(p.length)),null;for(let e=0;e<i.height;++e)p.set(i.buffer.subarray(e*g,(e+1)*g),0+e*a);let v=g/2;if(0==c&&(v=n.width*Uint16Array.BYTES_PER_ELEMENT),l+n.height*u>p.length)return null;for(let e=0;e<n.height;++e)p.set(n.buffer.subarray(e*v,(e+1)*v),l+e*u);if(c>0){if(c+s.height*u>p.length)return null;for(let e=0;e<s.height;++e)p.set(s.buffer.subarray(e*v,(e+1)*v),c+e*u)}return r.buffer=f,r.yPlaneBuffer={bytesPerRow:a,rowsPerImage:i.height,offset:0},r.uPlaneBuffer={bytesPerRow:u,rowsPerImage:n.height,offset:l},r.vPlaneBuffer={bytesPerRow:u,rowsPerImage:s.height,offset:c},r}writeToRgbaTextureBuffer(e,t,r,i,n){if(!($t(or,this)&&i&&n&&n.buffer))return null;const s=Jt(_r,this,Rr).call(this,Uint32Array.BYTES_PER_ELEMENT*t,256),a=n.buffer;let o=n.bufferArray;o||(o=a.getMappedRange(),n.bufferArray=o);const u=new Uint8Array(o),l=t*Uint32Array.BYTES_PER_ELEMENT;for(let e=0;e<r;++e)u.set(i.subarray(e*l,(e+1)*l),e*s);return n.buffer=a,n.bytesPerRow=s,n.rowsPerImage=r,n}produceVideoFrame(e,t){return new VideoFrame(e,t)}writeUniformBuffer(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!$t(nr,this))return null;if(!t||0==t.length)return null;let i=r;return r&&t.byteLength>r.size&&(r.destroy(),r=null,i=null),i?i.label=e:i=$t(nr,this).createBuffer({label:e,size:t.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),$t(nr,this).queue.writeBuffer(i,0,t,0,t.length),i}acquireBlendTextureSampler(){return $t(nr,this)?($t(br,this)||Xt(br,this,$t(nr,this).createSampler({})),$t(br,this)):null}configureGPUContext(e){$t(ir,this)||(Xt(ir,this,e.getContext("webgpu")),$t(ir,this)?$t(ir,this).configure({device:$t(nr,this),format:$t(sr,this),alphaMode:"premultiplied"}):t().tracing.Log_Error("WebGPU [WebGPURenderer] configureGPUContext() webgpuContext is invalid! canvas=".concat(e)))}unconfigureGPUContext(){$t(ir,this)&&($t(ir,this).unconfigure(),Xt(ir,this,null))}acquireVideoFrameRenderPipeline(e,t){if(!$t(nr,this)||!e)return null;if(!$t(hr,this)){const r=$t(nr,this).createBindGroupLayout({label:"VideoFrameBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,externalTexture:{}},{binding:2,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:3,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]}),i={label:"VideoFrameRenderPipeline",layout:$t(nr,this).createPipelineLayout({label:"VideoFramePipelineLayout",bindGroupLayouts:[r]}),vertex:{module:$t(nr,this).createShaderModule({code:e}),entryPoint:"vertex_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:8,attributes:[{shaderLocation:1,format:"float32x2",offset:0}]}]},fragment:{module:$t(nr,this).createShaderModule({code:e}),entryPoint:"fragment_main",targets:[{format:$t(sr,this),blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"}};t&&(i.multisample={count:4}),Xt(hr,this,$t(nr,this).createRenderPipeline(i))}return $t(hr,this)}acquireClearColorRenderPipeline(e){if(!$t(nr,this)||!e)return null;if(!$t(fr,this)){const t=$t(nr,this).createBindGroupLayout({label:"ClearColorBindGroupLayout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]}),r={label:"ClearColorRenderPipeline",layout:$t(nr,this).createPipelineLayout({label:"ClearColorPipelineLayout",bindGroupLayouts:[t]}),vertex:{module:$t(nr,this).createShaderModule({code:e}),entryPoint:"v_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]}]},fragment:{module:$t(nr,this).createShaderModule({code:e}),entryPoint:"f_main",targets:[{format:$t(sr,this)}]},primitive:{topology:"triangle-list"}};Xt(fr,this,$t(nr,this).createRenderPipeline(r))}return $t(fr,this)}acquireVideoFrameSampler(){return $t(nr,this)?($t(dr,this)||Xt(dr,this,$t(nr,this).createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"})),$t(dr,this)):null}acquireYuvTexturesSamplers(){if(!$t(nr,this))return null;if(!$t(vr,this)){Xt(vr,this,[]);const e=$t(nr,this).createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"}),t=$t(nr,this).createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"});$t(vr,this).push(e),$t(vr,this).push(t)}return $t(vr,this)}clearAttachedCanvas(){if(!$t(nr,this)||!$t(ir,this)||!$t(cr,this))return;if(!$t(Kt,this)||0==$t(Kt,this).width||0==$t(Kt,this).height)return;const e=$t(nr,this).createCommandEncoder(),t=e.beginRenderPass({colorAttachments:[{view:$t(ir,this).getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]}),r=$t(nr,this).createRenderPipeline({layout:"auto",vertex:{module:$t(nr,this).createShaderModule({code:qt}),entryPoint:"v_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]}]},fragment:{module:$t(nr,this).createShaderModule({code:qt}),entryPoint:"f_main",targets:[{format:$t(sr,this)}]},primitive:{topology:"triangle-list"}});t.setVertexBuffer(0,$t(cr,this)),t.setPipeline(r),t.draw(6),t.end(),$t(nr,this).queue.submit([e.finish()])}clear(){}cleanup(){this.unconfigureGPUContext(),Xt(Kt,this,null),Xt(sr,this,null),Xt(ar,this,null),Xt(cr,this,null),Xt(hr,this,null),Xt(fr,this,null),Xt(dr,this,null),Xt(pr,this,null),Xt(gr,this,null),Xt(vr,this,null),Xt(mr,this,null),Xt(yr,this,null),Xt(br,this,null),Xt(xr,this,null),$t(or,this)&&Xt(or,this,null),$t(nr,this)&&Xt(nr,this,null)}};function zr(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}function qr(e,t){return e.get(Hr(e,t))}function Yr(e,t,r){return e.set(Hr(e,t),r),r}function Hr(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var $r=new WeakMap,Xr=new WeakMap,Jr=new WeakMap,Kr=new WeakMap,Zr=new WeakMap,Qr=new WeakMap,ei=new WeakMap;const ti=class{constructor(e){zr(this,$r,1),zr(this,Xr,{}),zr(this,Jr,null),zr(this,Kr,0),zr(this,Zr,0),zr(this,Qr,[]),zr(this,ei,new Map),Yr(Jr,this,e)}acquireBuffer(e,t,r){let i,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return arguments.length>4&&void 0!==arguments[4]&&!arguments[4]?i=qr(Jr,this).createBuffer({size:r,usage:t,mappedAtCreation:n}):qr(ei,this).has(e)?i=qr(ei,this).get(e):qr(Qr,this).length>0?(i=qr(Qr,this).pop(),qr(ei,this).set(e,i)):(i=qr(Jr,this).createBuffer({size:r,usage:t,mappedAtCreation:n}),qr(ei,this).set(e,i)),i}releaseBuffer(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(qr(ei,this).has(e)){const t=qr(ei,this).get(e);r?qr(Qr,this).push(t):t.destroy(),qr(ei,this).delete(e)}else r||-1!=qr(Qr,this).indexOf(t)&&(qr(Qr,this)[index]=qr(Qr,this)[qr(Qr,this).length-1],qr(Qr,this).pop(),t.destroy())}getNumUsedBuffers(){return qr(Kr,this)}getNumFreeBuffers(){return qr(Zr,this)}cleanup(){qr(Qr,this).forEach(((e,t)=>{e.forEach((e=>{e.destroy()}))})),qr(ei,this).forEach(((e,t)=>{e.forEach((e=>{e.destroy()}))})),qr(Qr,this).length=0,qr(ei,this).clear(),Yr(Kr,this,0),Yr(Zr,this,0)}release(e){3==e&&(qr(Qr,this).forEach(((e,t)=>{e.forEach((e=>{e.destroy()}))})),qr(Qr,this).length=0,Yr(Zr,this,0))}getResourceType(){return qr($r,this)}collectResourceInfo(){let e=0,t=0,r="";for(const[i,n]of qr(ei,this))e++,t+=n.size,r+="[GPUBufferMgr] entry{key:".concat(i,", buffer:{label:").concat(n.label," size:").concat(n.size,"}}\n");for(const r of qr(Qr,this))e++,t+=r.size;return r+="[GPUBufferMgr] freeBuffers{size:".concat(qr(Qr,this).length,"}\n"),r+="[GPUBufferMgr] total: count:".concat(e," usedBytes:").concat(t,"\n"),qr(Xr,this).type=qr($r,this),qr(Xr,this).count=e,qr(Xr,this).usedBytes=t,qr(Xr,this).output=r,qr(Xr,this)}onOccupancyLevelEvaluated(e){t().tracing.add_monitor("WebGPU_GBM_L:".concat(e)),this.release(e)}};function ri(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}function ii(e,t){return e.get(function(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}(e,t))}var ni=new WeakMap,si=new WeakMap,ai=new WeakMap;const oi=class{constructor(){ri(this,ni,2),ri(this,si,[]),ri(this,ai,[])}acquire(e){let t=null;const r=ii(si,this).findIndex((t=>t&&t.width==e.w&&t.height==e.h&&t.format==e.format&&t.usage==e.usage));return r>-1&&(t=ii(si,this).splice(r,1)[0]),t&&ii(ai,this).push(t),t}recycle(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=ii(ai,this).indexOf(e);-1!=r&&ii(ai,this).splice(r,1),t?e.destroy():(ii(si,this).push(e),e.label="")}pushToAvailablePool(e){e&&ii(si,this).push(e)}pushToInUsePool(e){e&&ii(ai,this).push(e)}release(e){if(3==e&&ii(si,this).length>0){for(const e of ii(si,this))e.destroy();ii(si,this).length=0}}cleanup(){for(const e of ii(si,this))e.destroy();for(const e of ii(ai,this))e.destroy();ii(si,this).length=0,ii(ai,this).length=0}getAvailablePool(){return ii(si,this)}getInUsedPool(){return ii(ai,this)}getResourceType(){return ii(ni,this)}};function ui(e,t,r){li(e,t),t.set(e,r)}function li(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ci(e,t){return e.get(hi(e,t))}function hi(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var fi=new WeakMap,di=new WeakMap,pi=new WeakMap,gi=new WeakMap,vi=new WeakSet;function mi(e){let t=ci(pi,this).get(e.level),r=null;return t?(r=t.acquire(e),r||(r=hi(vi,this,bi).call(this,e),r?t.pushToInUsePool(r):console.error("acquireTexture() cannot create an available tex. texConfig=".concat(JSON.stringify(e))))):(r=hi(vi,this,bi).call(this,e),r?(t=new oi,t.pushToInUsePool(r),ci(pi,this).set(e.level,t)):console.error("acquireTexture() cannot create an available tex. texConfig=".concat(JSON.stringify(e)))),r}function yi(e){const t=e.zOrder;let r=ci(gi,this).get(t);return r?(e.w>r.width||e.h>r.height)&&(r.destroy(),r=hi(vi,this,bi).call(this,e),ci(gi,this).set(t,r)):(r=hi(vi,this,bi).call(this,e),ci(gi,this).set(t,r)),r}function bi(e){if(!ci(fi,this))return null;if(0==e.w||0==e.h)return null;const t={size:{width:e.w,height:e.h},format:e.format,usage:e.usage};return e.sampleCount>0&&(t.sampleCount=e.sampleCount),ci(fi,this).createTexture(t)}function xi(e){let t=h[h.length-1];for(let r=0;r<h.length;++r)if(e<=h[r]){t=h[r];break}return t}function wi(e){return e&&e.zOrder&&e.zOrder==TEX_LAYER_Z_IDX.WATERMARK}const _i=class{constructor(e){var t;li(this,t=vi),t.add(this),ui(this,fi,null),ui(this,di,{}),ui(this,pi,new Map),ui(this,gi,new Map),function(e,t,r){e.set(hi(e,t),r)}(fi,this,e)}assembleTextureConfig(e,t,r,i,n){return{w:e,h:t,usage:r,format:i,sampleCount:n,level:hi(vi,this,xi).call(this,t)}}isSameTextureConfig(e,t){return!(!e||!t)&&e.w==t.w&&e.h==t.h&&e.usage==t.usage&&e.format==t.format&&e.sampleCount==t.sampleCount}evalTexConfig(e){if(!e)throw new Error("hasSameTextureConfig() invalid input!");const t=ci(pi,this).keys();let r=e;for(const i of t)if(this.isSameTextureConfig(i,e)){r=i;break}return r}needNewTexturesMapEntry(e,t){return!(!t||e&&e.w==t.w&&e.h==t.h&&e.usage==t.usage&&e.format==t.format&&e.sampleCount==t.sampleCount)}acquireTexture(e){if(!e||e.w<=0||e.h<=0)return t.tracing.Log_Error("WebGPU [GPUTextureMgr] acquireTexture() texConfig is invalid, texConfig:".concat(JSON.stringify(e))),null;let r=null;return r=hi(vi,this,wi).call(this,e)?hi(vi,this,yi).call(this,e):hi(vi,this,mi).call(this,e),r}recycleTexture(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return;const r=this.assembleTextureConfig(e.width,e.height,e.usage,e.format,e.sampleCount);let i=ci(pi,this).get(r.level);if(i)i.recycle(e,t);else if(console.warn("recycleTexture(".concat(e.label,") texture is not found in the map!, destroy:").concat(t)),t)e.destroy();else{const t=new oi;t.pushToAvailablePool(e),ci(pi,this).set(r.level,t)}}cleanup(){for(const[e,t]of ci(pi,this))t&&t.cleanup();ci(pi,this).clear()}collectResourceInfo(){let e=0,t=0,r="";for(const[i,n]of ci(pi,this))if(n){const s=n.getAvailablePool();for(const r of s)e++,"r8unorm"==r.format?t+=r.width*r.height:"rgba8unorm"==r.format&&(t+=r.width*r.height*Uint32Array.BYTES_PER_ELEMENT);const a=n.getInUsedPool();for(const r of a)e++,"r8unorm"==r.format?t+=r.width*r.height:"rgba8unorm"==r.format&&(t+=r.width*r.height*Uint32Array.BYTES_PER_ELEMENT);(s.length>0||a.length>0)&&(r+="[GPUTexturePool] level:".concat(i," pool:{ava_count:").concat(s.length," in_used_count:").concat(a.length,"}\n"))}return r+="[GPUTexturePool] total: count:".concat(e," usedBytes:").concat(t,"\n"),ci(di,this).type=2,ci(di,this).count=e,ci(di,this).usedBytes=t,ci(di,this).output=r,ci(di,this)}onOccupancyLevelEvaluated(e){if(t().tracing.Log_Error("WebGPU GPUTextureManager_onOccupancyLevelEvaluated() level:".concat(e)),3==e)for(const[t,r]of ci(pi,this))r&&r.release(e)}};var Pi=r(129),Ti=r.n(Pi);function Si(e,t,r){Ui(e,t),t.set(e,r)}function Ui(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Mi(e,t){return e.get(Ei(e,t))}function Ri(e,t,r){return e.set(Ei(e,t),r),r}function Ei(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var Gi=new WeakMap,ki=new WeakMap,Bi=new WeakMap,Wi=new WeakMap,Ci=new WeakSet;function Fi(e,t,r){if(Mi(Bi,this).set(e,t),r){let e=Array.from(Mi(Bi,this).entries());Ti()(e).call(e,((e,t)=>e[0]-t[0])),Mi(Bi,this).clear(),e.forEach((e=>{let[t,r]=e;Mi(Bi,this).set(t,r)}))}}function Li(e,t){if(!e||0==e.length)return null;let r=0,i=0,n=null;for(const s of e)"mapped"==s.mapState?(r+=1,n||s.size>=t&&(n=s)):i+=1;if(r>0&&0==i||r>=2&&0!=i){if(n){const t=e.indexOf(n);-1!=t&&e.splice(t,1)}return n}return null}const Oi=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;var r;Ui(this,r=Ci),r.add(this),Si(this,Gi,0),Si(this,ki,0),Si(this,Bi,new Map),Si(this,Wi,0),Ri(ki,this,e),Ri(Wi,this,t)}isUpToThreshold(e,t){if(e!=Mi(ki,this)||t<=0)return!1;if(0==Mi(Wi,this))return!1;const r=Mi(Bi,this).get(t);return!!r&&r.length>=Mi(Wi,this)}push(e,t,r){if(e!=Mi(ki,this)||!r||t<=0)return!1;let i=null,n=!1;if(Mi(Bi,this).has(t)){if(i=Mi(Bi,this).get(t),i||(i=[],n=!0),!(i.length<Mi(Wi,this)))return!1;i.push(r)}else i=[],i.push(r),n=!0;return n&&Ei(Ci,this,Fi).call(this,t,i,n),!0}acquire(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;let i=e.level,n=e.bytesPerRow,s=e.size;if(i!=Mi(ki,this)||n<=0)return t().tracing.Log_Error("WebGPU [GPUBufferPoolEntry] acquire() level(".concat(i,") or bpr=").concat(n," is invalid!")),null;let a=null,o=!1;if(Mi(Bi,this).has(n)){let e=Mi(Bi,this).get(n);if(e){const t=e.findIndex((e=>"mapped"==e.mapState&&e.size>=s));t>-1?a=e.splice(t,1)[0]:o=!0}else o=!0}else o=!0;if(o&&!a&&!r){let t=2,r=!1;i>=c[6]&&(r=!0);for(const[i,o]of Mi(Bi,this))if((t>0||r)&&i>n){if(a=Ei(Ci,this,Li).call(this,o,s),a){e.bytesPerRow=i;break}t--}}return a}recycle(e,t,r){if(e!=Mi(ki,this)||t<=0||!r)return!1;let i=!1;if(Mi(Bi,this).has(t)){let e=!1,n=Mi(Bi,this).get(t);n||(n=[],e=!0),n.push(r),e&&Ei(Ci,this,Fi).call(this,t,n,e),i=!0}else i=this.push(e,t,r);return i}release(e){if(3==e){for(const[e,t]of Mi(Bi,this))if(t){for(const e of t)"mapped"!=e.mapState&&"unmapped"!=e.mapState||e.destroy();t.length=0}Mi(Bi,this).clear()}}cleanup(){for(const[e,t]of Mi(Bi,this))if(t){for(const e of t)"mapped"!=e.mapState&&"unmapped"!=e.mapState||e.destroy();t.length=0}Mi(Bi,this).clear()}getPool(){return Mi(Bi,this)}hasBytesPerRowAsKey(e){return Mi(Bi,this).has(e)}getResourceType(){return Mi(Gi,this)}getPoolThreshold(){return Mi(Wi,this)}canLendBufferCrossLevel(e,t){let r=!0;if(Mi(Bi,this).has(t)){const i=Mi(Bi,this).get(t);if(i){let t=0,n=0;for(const e of i)"mapped"==e.mapState?t+=1:n+=1;r=e>=c[6]?t>0:t>0&&0==n||t>=2&&0!=n}}else r=!1;return r}};function Ii(e,t,r){Ai(e,t),t.set(e,r)}function Ai(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Vi(e,t){return e.get(Di(e,t))}function Ni(e,t,r){return e.set(Di(e,t),r),r}function Di(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var ji=new WeakMap,zi=new WeakMap,qi=new WeakMap,Yi=new WeakMap,Hi=new WeakMap,$i=new WeakMap,Xi=new WeakSet;function Ji(e){if(!e)return;const t=e.colorFormat;if("rgba"==t){const t=Di(Xi,this,Ki).call(this,e.height);t>0&&t<c[6]&&(e.size=e.width*t,e.height=t),e.level=t,e.bytesPerRow=e.width}else if("i420"==t){const t=Di(Xi,this,Ki).call(this,e.yPlane.height);t>0&&t<c[6]&&(e.size=e.yPlane.width*t+e.uvPlane.width*t,e.yPlane.height=t,e.uvPlane.height=t/2),e.level=t,e.bytesPerRow=e.yPlane.width}else if("nv12"==t){const t=Di(Xi,this,Ki).call(this,e.yPlane.height);t>0&&t<c[6]&&(e.size=e.yPlane.width*t+e.uvPlane.width*t/2,e.yPlane.height=t,e.uvPlane.height=t/2),e.level=t,e.bytesPerRow=e.yPlane.width}}function Ki(e){if(e<=0)return 0;let t=c[6];for(let r=0;r<c.length;++r)if(e<=c[r]){t=c[r];break}return t}function Zi(e){const t=c.indexOf(e);return t>-1&&t+1<=c.length-1?c[t+1]:e}function Qi(e){if(!e)return 0;let t=0;const r=e.colorFormat;if("rgba"==r?t=e.height:"i420"!=r&&"nv12"!=r||(t=e.yPlane.height),0==t)return 0;let i=0;return i=t<=c[2]?90:t>c[2]&&t<=c[5]?60:15,i}function en(e){return e.mapAsync(GPUMapMode.WRITE,0,e.size)}function tn(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(Vi(Hi,this).set(e,t),r){let e=Array.from(Vi(Hi,this).entries());Ti()(e).call(e,((e,t)=>e[0]-t[0])),Vi(Hi,this).clear(),e.forEach((e=>{let[t,r]=e;Vi(Hi,this).set(t,r)}))}}function rn(e){if(!e)return null;let t=e.level,r=e.bytesPerRow;e.size;const i=Di(Xi,this,Zi).call(this,t);if(i<=t)return null;if(!Vi(Hi,this).has(i))return null;const n=Vi(Hi,this).get(i);if(!n)return null;if(!n.hasBytesPerRowAsKey(r))return null;if(!n.canLendBufferCrossLevel(t,r))return null;const s={};Object.assign(s,e),s.level=i;const a=n.acquire(s,!0);return a&&(e.level=i,e.bytesPerRow=s.bytesPerRow),a}const nn=class{constructor(e){var t;Ai(this,t=Xi),t.add(this),Ii(this,ji,0),Ii(this,zi,{}),Ii(this,qi,null),Ii(this,Yi,[]),Ii(this,Hi,new Map),Ii(this,$i,0),Ni(qi,this,e)}acquire(e){if(!e)throw new Error("acquire() bufferConfig is invalid!");Di(Xi,this,Ji).call(this,e);let r=null,i=null;if(0==Vi(Hi,this).size){if(Vi(qi,this)){const t=Vi(qi,this).createBuffer({label:e.label,size:e.size,usage:e.usage,mappedAtCreation:!0});let n=!1;if(!i){const t=Di(Xi,this,Qi).call(this,e);i=new Oi(e.level,t),n=!0}t&&(Ni($i,this,Vi($i,this)+1),r=t,r.label="".concat(e.label,"-").concat(Vi($i,this))),Di(Xi,this,tn).call(this,e.level,i,n)}}else if(Vi(Hi,this).has(e.level)){i=Vi(Hi,this).get(e.level);let n=!1;if(!i){const t=Di(Xi,this,Qi).call(this,e);i=new Oi(e.level,t),n=!0}if(r=i.acquire(e),r)r.label="".concat(e.label,"-").concat(Vi($i,this));else if(r=Di(Xi,this,rn).call(this,e),!r)if(i.isUpToThreshold(e.level,e.bytesPerRow))t().tracing.Log_Error("WebGPU [GPUBufferPool] acquire() next level cant help and pool is up to threshold! Only to wait for a while...");else{const t=Vi(qi,this).createBuffer({label:e.label,size:e.size,usage:e.usage,mappedAtCreation:!0});t&&(Ni($i,this,Vi($i,this)+1),r=t,r.label="".concat(e.label,"-").concat(Vi($i,this)))}n&&Di(Xi,this,tn).call(this,e.level,i,n)}else{let t=!1;if(r=Di(Xi,this,rn).call(this,e),r)r.label="".concat(e.label,"-").concat(Vi($i,this));else{const n=Vi(qi,this).createBuffer({label:e.label,size:e.size,usage:e.usage,mappedAtCreation:!0});if(!i){const r=Di(Xi,this,Qi).call(this,e);i=new Oi(e.level,r),t=!0}n&&(Ni($i,this,Vi($i,this)+1),r=n,r.label="".concat(e.label,"-").concat(Vi($i,this)))}t&&Di(Xi,this,tn).call(this,e.level,i,t)}return r&&Vi(Yi,this).push(r),r}recycle(e,r){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e)return;const n=Vi(Yi,this).indexOf(e);if(-1!=n?Vi(Yi,this).splice(n,1):t().tracing.Log_Error("WebGPU [BufferPool] buffer can't be recycled. bufferConfig:".concat(JSON.stringify(r),", needToRecycle=").concat(i)),r)if(i){"unmapped"!=e.mapState&&e.unmap(),"unmapped"==e.mapState&&Di(Xi,this,en).call(this,e).then((()=>{})).catch((t=>{console.warn("mapAsyncBuffer() error:".concat(t)),e.destroy(),e=null}));let t=Vi(Hi,this).get(r.level);t&&t.recycle(r.level,r.bytesPerRow,e),e.label=""}else e.destroy(),e=null;else e.destroy()}recycleInUsedGPUBuffers(e,t){for(const[r,i]of e)for(const e of i)if(e){const r=e.getTextureBufferGroup();r&&r.buffer&&(r.bufferArray&&(r.bufferArray=null),this.recycle(r.buffer,r.bufferConfig)),e.destroyTextureBufferGroup(t)}}recycleTextureBufferGroup(e,t){if(e&&t){const r=t.acquireGPUBufferPool();if(r){const i=e.getTextureBufferGroup();i&&i.buffer&&(i.bufferArray&&(i.bufferArray=null),r.recycle(i.buffer,i.bufferConfig),e.destroyTextureBufferGroup(t))}}}cleanup(){for(const e of Vi(Yi,this))"unmapped"!=e.mapState&&e.unmap(),e.destroy();Vi(Yi,this).length=0;for(const[e,t]of Vi(Hi,this))t&&t.cleanup();Vi(Hi,this).clear()}release(e){if(3==e){for(const[t,r]of Vi(Hi,this))r&&r.release(e);Vi(Hi,this).clear()}}getResourceType(){return Vi(ji,this)}collectResourceInfo(){let e=0,t=0,r="";for(const[i,n]of Vi(Hi,this))if(n){const s=n.getPool();for(const[a,o]of s){e+=o.length;let s=0,u=0;for(const e of o)t+=e.size,"mapped"==e.mapState?s+=1:u+=1;r+="[GPUBufferPool] level:".concat(i," bpr:").concat(a," threshold:").concat(n.getPoolThreshold()," pool:{len:").concat(o.length," ava_count:").concat(s," pending_count:").concat(u,"}\n")}}let i=0;for(const r of Vi(Yi,this))e+=1,t+=r.size,i+=1;return r+="[GPUBufferPool] in_used_count:".concat(i,"\n"),r+="[GPUBufferPool] total: count:".concat(e," usedBytes:").concat(t,"\n"),Vi(zi,this).type=Vi(ji,this),Vi(zi,this).count=e,Vi(zi,this).usedBytes=t,Vi(zi,this).output=r,Vi(zi,this)}onOccupancyLevelEvaluated(e){t().tracing.add_monitor("WebGPU_GBP_L:".concat(e)),this.release(e)}getInUsedPoolCount(){return Vi(Yi,this).length}};function sn(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}function an(e,t){return e.get(un(e,t))}function on(e,t,r){return e.set(un(e,t),r),r}function un(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var ln=new WeakMap,cn=new WeakMap;const hn=class{constructor(e){sn(this,ln,null),sn(this,cn,null),on(ln,this,e),e&&on(cn,this,e.features)}getAdapterFeatures(){return an(cn,this)}getAdapterLimits(){return an(ln,this)?an(ln,this).limits:null}queryMaxTextureDimension2D(){const e=this.getAdapterLimits();return e?e.maxTextureDimension2D:0}queryMaxBufferSize(){const e=this.getAdapterLimits();return e?e.maxBufferSize:0}queryAdapterFeature(e){return!(!an(cn,this)||!e)&&an(cn,this).has(e)}isTimestampQuerySupported(){return this.queryAdapterFeature("timestamp-query")}getGPUAdapter(){return an(ln,this)}cleanup(){on(ln,this,null),on(cn,this,null)}};function fn(e,t,r){dn(e,t),t.set(e,r)}function dn(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function pn(e,t){return e.get(vn(e,t))}function gn(e,t,r){return e.set(vn(e,t),r),r}function vn(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var mn=new WeakMap,yn=new WeakMap,bn=new WeakMap,xn=new WeakMap,wn=new WeakSet;function _n(){let e=0;for(const t of pn(yn,this)){const r=t.collectResourceInfo(),i=vn(wn,this,Pn).call(this,r);t.onOccupancyLevelEvaluated(i),i>e&&(e=i)}const t=vn(wn,this,Tn).call(this,e);t!=pn(mn,this)&&(clearInterval(pn(bn,this)),gn(bn,this,null),gn(mn,this,t),this.monitor())}function Pn(e){let t=0;return 2==e.type?t=e.usedBytes<=31457280?0:e.usedBytes<=94371840?1:e.usedBytes<=157286400?2:3:1==e.type?t=e.usedBytes<=5242880?0:e.usedBytes<=10485760?1:e.usedBytes<=15728640?2:3:0==e.type&&(t=e.usedBytes<=52428800?0:e.usedBytes<=104857600?1:e.usedBytes<=209715200?2:3),t}function Tn(e){let t=0;switch(e){case 0:t=6e4;break;case 1:default:t=45e3;break;case 2:t=3e4;break;case 3:t=15e3}return t}const Sn=class{constructor(e){var t;dn(this,t=wn),t.add(this),fn(this,mn,3e4),fn(this,yn,[]),fn(this,bn,null),fn(this,xn,""),gn(xn,this,e)}addObservable(e){pn(yn,this).push(e)}removeObservable(e){const t=pn(yn,this).indexOf(e);-1!=t&&pn(yn,this).splice(t,1)}removeAllObservables(){pn(yn,this).length=0}monitor(){pn(bn,this)||gn(bn,this,setInterval((()=>{vn(wn,this,_n).call(this)}),pn(mn,this)))}cleanup(){this.removeAllObservables(),clearInterval(pn(bn,this)),gn(bn,this,null),gn(mn,this,0)}};function Un(e,t,r){Mn(e,t),t.set(e,r)}function Mn(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Rn(e,t){return e.get(Gn(e,t))}function En(e,t,r){return e.set(Gn(e,t),r),r}function Gn(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var kn=new WeakMap,Bn=new WeakMap,Wn=new WeakMap,Cn=new WeakMap,Fn=new WeakMap,Ln=new WeakMap,On=new WeakMap,In=new WeakMap,An=new WeakMap,Vn=new WeakMap,Nn=new WeakMap,Dn=new WeakSet;function jn(e){return void 0!==e&&"yPlaneTex"in e}const zn=class{constructor(){var e;Mn(this,e=Dn),e.add(this),Un(this,kn,null),Un(this,Bn,null),Un(this,Wn,null),Un(this,Cn,null),Un(this,Fn,null),Un(this,Ln,null),Un(this,On,null),Un(this,In,null),Un(this,An,null),Un(this,Vn,null),Un(this,Nn,"")}addRendererProviderModule(e){En(Vn,this,e)}setLabel(e){En(Nn,this,e)}async initialize(){navigator.gpu?Rn(kn,this)||(En(kn,this,await navigator.gpu.requestAdapter()),t().tracing.add_monitor("WebGPU_INIT_DONE"),Rn(kn,this))?(Rn(Wn,this)||(En(Wn,this,await Rn(kn,this).requestDevice()),Rn(Wn,this).lost.then((async e=>{"destroyed"!=e.reason&&(t().tracing.Log_Error("WebGPU [WebGPUResManager] DeviceLost callback message: ".concat(e.message," reason=").concat(e.reason)),Dt(1)),Rn(Vn,this)&&Rn(Vn,this).rendererUnconfigureGPUContext(),this.cleanup(),"destroyed"!=e.reason&&(En(Wn,this,null),await this.initialize(),Rn(Vn,this)&&Rn(Vn,this).rendererReinitialize())}))),Rn(Bn,this)||("function"==typeof Rn(kn,this).requestAdapterInfo?En(Bn,this,await Rn(kn,this).requestAdapterInfo()):"info"in Rn(kn,this)&&En(Bn,this,Rn(kn,this).info)),Rn(Cn,this)||En(Cn,this,navigator.gpu.getPreferredCanvasFormat()),Rn(Fn,this)||En(Fn,this,new ti(Rn(Wn,this))),Rn(Ln,this)||En(Ln,this,new _i(Rn(Wn,this))),Rn(On,this)||En(On,this,new nn(Rn(Wn,this))),Rn(In,this)||En(In,this,new hn(Rn(kn,this))),Rn(An,this)||(En(An,this,new Sn(Rn(Nn,this))),Rn(An,this).addObservable(Rn(Fn,this)),Rn(An,this).addObservable(Rn(Ln,this)),Rn(An,this).addObservable(Rn(On,this)),Rn(An,this).monitor())):t().tracing.Log_Error("WebGPU [WebGPUResManager] initialize() Couldn't request WebGPU adapter."):t().tracing.Log_Error("WebGPU [WebGPUResManager] initialize() WebGPU is not supported!")}acquireGPUDevice(){return Rn(Wn,this)}acquireCanvasFormat(){return Rn(Cn,this)}acquireGPUAdapterInfo(){return Rn(Bn,this)}destroyGPUDevice(){Rn(Wn,this)&&(Rn(Wn,this).destroy(),En(Wn,this,null))}acquireGPUBufferMgr(){return Rn(Fn,this)}acquireGPUTextureMgr(){return Rn(Ln,this)}acquireGPUBufferPool(){return Rn(On,this)}acquireGPUFeaturesHelper(){return Rn(In,this)}cleanup(){Rn(Fn,this)&&(Rn(Fn,this).cleanup(),En(Fn,this,null)),Rn(Ln,this)&&(Rn(Ln,this).cleanup(),En(Ln,this,null)),Rn(On,this)&&(Rn(On,this).cleanup(),En(On,this,null)),Rn(In,this)&&(Rn(In,this).cleanup(),En(In,this,null)),Rn(An,this)&&(Rn(An,this).cleanup(),En(An,this,null)),En(Vn,this,null),this.destroyGPUDevice()}recycleTextureBufferGroup(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e&&Rn(On,this)){const r=e.getTextureBufferGroup();r&&r.buffer&&(r.bufferArray&&(r.bufferArray=null),Rn(On,this).recycle(r.buffer,r.bufferConfig,t),e.destroyTextureBufferGroup(this))}}recycleInUsedGPUBuffers(e){for(const[t,r]of e)for(const e of r)if(e){const t=e.getTextureBufferGroup();t&&t.buffer&&(t.bufferArray&&(t.bufferArray=null),Rn(On,this).recycle(t.buffer,t.bufferConfig)),e.destroyTextureBufferGroup(this)}}requestTextureBuffer(e){if(!Rn(On,this))return null;if(function(e,r){if(!e||r<0)throw new Error("isBufferSizeOverMaxSize() invalid parameters. res=".concat(e,", bufferSize=").concat(r));let i=!1,n=0;const s=e.acquireGPUFeaturesHelper();return s&&(n=s.queryMaxBufferSize(),n>0&&(i=r>n)),i&&t().tracing.Log_Error("WebGPU isBufferSizeOverMaxSize() bufferSize:".concat(r," max:").concat(n)),i}(this,e.size))return t().tracing.Log_Error("WebGPU [WebGPUResManager] requestTextureBuffer() a buffer size that exceeds the max size of GPUBuffer is required.(size:".concat(e.size,")")),null;const r=GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC;return e.usage=r,Rn(On,this).acquire(e)}destroyTextureGroup(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return;const i=e.getTextureGroup();if(!i)return;if(!Rn(Ln,this))return void t().tracing.Log_Error("WebGPU [WebGPUResManager] destroyTextureGroup() mGPUTextureMgr is undefined!");const n=e.getTextureType();i&&(1==n?(Rn(Ln,this).recycleTexture(i.yPlaneTex,r),Rn(Ln,this).recycleTexture(i.uPlaneTex,r),i.vPlaneTex&&Rn(Ln,this).recycleTexture(i.vPlaneTex,r)):2==n?Rn(Ln,this).recycleTexture(i,r):Gn(Dn,this,jn).call(this,i)?(Rn(Ln,this).recycleTexture(i.yPlaneTex,r),Rn(Ln,this).recycleTexture(i.uPlaneTex,r),i.vPlaneTex&&Rn(Ln,this).recycleTexture(i.vPlaneTex,r)):Rn(Ln,this).recycleTexture(i,r),e.setTextureGroup(null))}};globalThis.__dyn_modules__.webgpu_renderer_dynmod={init:function(t){e=t},exports:{createWebGPUResManager:()=>new zn,createWebGPURenderer:(e,t)=>new jr(e,t),createWebGPURenderDisplayMgr:()=>new Vt}}})()})();
//# sourceMappingURL=https://d1cdksi819e9z7.cloudfront.net/sourcemap/webgpu_renderer_dynmod.min.js-0c47cb4a075bd4dd5ad7.map